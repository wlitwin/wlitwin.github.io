"use strict";
function _call(f, args) {
  while (args.length > 0) {
    const a = f._arity !== undefined ? f._arity : f.length;
    if (a === 0) { f = f(); continue; }
    if (args.length < a) return _partial(f, a, args);
    const taken = args.splice(0, a);
    f = f.apply(null, taken);
  }
  return f;
}
function _partial(fn, arity, args) {
  const p = function() {
    return _call(fn, args.concat(Array.from(arguments)));
  };
  p._arity = arity - args.length;
  return p;
}
function _eq(a, b) {
  if (a === b) return true;
  if (a == null || b == null) return a === b;
  if (typeof a !== "object") return false;
  if (Array.isArray(a)) {
    if (!Array.isArray(b) || a.length !== b.length) return false;
    for (let i = 0; i < a.length; i++) if (!_eq(a[i], b[i])) return false;
    return true;
  }
  if ("_arr" in a && "_arr" in b) {
    if (a._arr.length !== b._arr.length) return false;
    for (let i = 0; i < a._arr.length; i++) if (!_eq(a._arr[i], b._arr[i])) return false;
    return true;
  }
  if ("_hd" in a && "_hd" in b) {
    let ca = a, cb = b;
    while (ca !== null && cb !== null) {
      if (!("_hd" in ca) || !("_hd" in cb)) return ca === cb;
      if (!_eq(ca._hd, cb._hd)) return false;
      ca = ca._tl; cb = cb._tl;
    }
    return ca === cb;
  }
  if ("_tag" in a) return a._tag === b._tag && _eq(a._val, b._val);
  if ("_ref" in a) return _eq(a._ref, b._ref);
  const ka = Object.keys(a), kb = Object.keys(b);
  if (ka.length !== kb.length) return false;
  for (const k of ka) if (!_eq(a[k], b[k])) return false;
  return true;
}
function _compare(a, b) {
  if (a < b) return -1;
  if (a > b) return 1;
  return 0;
}
function _match_fail(loc) { throw new Error("Match failure at " + loc); }
function _pp(v) {
  if (v === undefined) return "()";
  if (v === null) return "[]";
  if (typeof v === "number") {
    if (!Number.isInteger(v)) {
      const s = String(v);
      return s.includes(".") || s.includes("e") ? s : s + ".";
    }
    return String(v);
  }
  if (typeof v === "boolean") return String(v);
  if (typeof v === "string") return v;
  if (Array.isArray(v)) return "(" + v.map(_pp).join(", ") + ")";
  if (v !== null && typeof v === "object") {
    if ("_arr" in v) return "#[" + v._arr.map(_pp).join("; ") + "]";
    if ("_hd" in v) {
      const r = [];
      let c = v;
      while (c !== null && typeof c === "object" && "_hd" in c) { r.push(_pp(c._hd)); c = c._tl; }
      return "[" + r.join("; ") + "]";
    }
    if ("_tag" in v) {
      if (v._val !== undefined) {
        const pv = _pp(v._val);
        if (Array.isArray(v._val) || (typeof v._val === "object" && v._val !== null && "_tag" in v._val && v._val._val !== undefined))
          return v._name + " (" + pv + ")";
        return v._name + " " + pv;
      }
      return v._name;
    }
    if ("_ref" in v) return "ref(" + _pp(v._ref) + ")";
    if (v instanceof Map) {
      const entries = Array.from(v.entries());
      const isSet = entries.every(([_,val]) => val === undefined);
      if (isSet) return "#{" + entries.map(([k]) => _pp(k)).join("; ") + "}";
      return "#{" + entries.map(([k,val]) => _pp(k) + ": " + _pp(val)).join("; ") + "}";
    }
    return "{ " + Object.entries(v).map(([k,val]) => k + " = " + _pp(val)).join("; ") + " }";
  }
  return String(v);
}
let _h = {};
function _bounce(fn) { fn._tramp = true; return fn; }
const _trampolining = new Set();
function _trampoline(fn, tag) {
  if (tag !== undefined && _trampolining.has(tag)) return fn();
  if (tag !== undefined) _trampolining.add(tag);
  try {
    let result = fn();
    while (typeof result === 'function' && result._tramp) {
      result = result();
    }
    return result;
  } finally { if (tag !== undefined) _trampolining.delete(tag); }
}
function _resolve(v) { while (typeof v === 'function' && v._tramp) v = v(); return v; }
// --- Builtins ---
function print(v) {
  const s = (typeof v === "string") ? v : _pp(v);
  if (typeof globalThis._jsOutput === "function") globalThis._jsOutput(s);
  else if (typeof process !== "undefined") process.stdout.write(s);
  return undefined;
}
function println(v) {
  const s = (typeof v === "string") ? v : _pp(v);
  if (typeof globalThis._jsOutput === "function") globalThis._jsOutput(s + "\n");
  else if (typeof process !== "undefined") process.stdout.write(s + "\n");
  return undefined;
}
function string_of_int(n) { return String(n); }
function int_of_string(s) { const n = parseInt(s, 10); if (isNaN(n)) throw new Error("int_of_string: " + s); return n; }
function float_of_int(n) { return n; }
function int_of_float(f) { return Math.trunc(f); }
function float_of_string(s) { const f = parseFloat(s); if (isNaN(f)) throw new Error("float_of_string: " + s); return f; }
function string_of_float(f) {
  const s = String(f);
  return s.includes(".") || s.includes("e") ? s : s + ".";
}
function string_of_bool(b) { return String(b); }
function failwith(msg) { throw new Error(msg); }
const not = (b) => !b;
function $caret(a, b) { return a + b; }
function $mod(a, b) { return a % b; }
function __show_value(v) { return _pp(v); }
function copy_continuation(k) { return k; }
const ignore = (_) => undefined;
function fst(t) { return t[0]; }
function snd(t) { return t[1]; }
function string_length(s) { return s.length; }
function string_sub(s, start, len) { return s.substring(start, start + len); }
function string_get(s, i) { return s.charCodeAt(i); }
function string_contains(s, sub) { return s.includes(sub); }
function string_concat(sep, parts) {
  const arr = [];
  let c = parts;
  while (c !== null) { arr.push(c._hd); c = c._tl; }
  return arr.join(sep);
}
function array_length(a) { return a._arr.length; }
function array_get(a, i) { return a._arr[i]; }
function array_set(a, i, v) { a._arr[i] = v; return undefined; }
function array_make(n, v) { return {_arr: new Array(n).fill(v)}; }
function array_of_list(lst) {
  const arr = [];
  let c = lst;
  while (c !== null) { arr.push(c._hd); c = c._tl; }
  return {_arr: arr};
}
function array_to_list(arr) {
  const a = arr._arr;
  let result = null;
  for (let i = a.length - 1; i >= 0; i--) result = {_hd: a[i], _tl: result};
  return result;
}
function array_copy(a) { return {_arr: a._arr.slice()}; }
function array_sub(a, start, len) { return {_arr: a._arr.slice(start, start + len)}; }
function __math_pow(a, b) { return Math.pow(a, b); }
function __math_sqrt(x) { return Math.sqrt(x); }
function __math_floor(x) { return Math.floor(x); }
function __math_ceil(x) { return Math.ceil(x); }
function __math_round(x) { return Math.round(x); }
function __math_abs(x) { return Math.abs(x); }
function __math_sin(x) { return Math.sin(x); }
function __math_cos(x) { return Math.cos(x); }
function __math_abs_float(x) { return Math.abs(x); }
function __byte_to_char(b) { return String.fromCharCode(b); }
function __byte_to_int(b) { return b; }
function __byte_of_int(n) { return n & 0xFF; }
function __byte_to_string(b) { return String.fromCharCode(b); }
function __char_to_byte(s) { return s.charCodeAt(0); }
function __rune_to_string(cp) {
  return String.fromCodePoint(cp);
}
function __string_to_runes(s) {
  const cps = Array.from(s).map(c => c.codePointAt(0));
  let result = null;
  for (let i = cps.length - 1; i >= 0; i--) result = {_hd: cps[i], _tl: result};
  return result;
}
function __map_has(m, k) { return m.has(k); }
function __map_get(m, k) { return m.get(k); }
function __rune_to_int(r) { return r; }
function __rune_of_int(n) { return n; }
function __int_to_hex(n) { return n.toString(16); }
function __int_to_oct(n) { return n.toString(8); }
function __int_to_bin(n) { return n.toString(2); }
function __fmt_float(prec, f) { return f.toFixed(prec); }
function __fmt_hex(n) { return n.toString(16); }
function __fmt_hex_upper(n) { return n.toString(16).toUpperCase(); }
function __fmt_oct(n) { return n.toString(8); }
function __fmt_bin(n) { return n.toString(2); }
function __fmt_zero_pad(width, s) { return s.padStart(width, "0"); }
function __fmt_pad_left(width, s) { return s.padStart(width, " "); }
function __fmt_pad_right(width, s) { return s.padEnd(width, " "); }
function __sys_time() { return Date.now() / 1000.0; }
function __sys_exit(code) { if (typeof process !== "undefined") process.exit(code); throw new Error("exit: " + code); }
// --- Module extern stubs ---
// String module
function String$length(s) { return s.length; }
function String$sub(s, start, len) {
  if (start < 0 || len < 0 || start + len > s.length)
    throw new Error("String.sub: index out of bounds");
  return s.substring(start, start + len);
}
function String$split(delim, input) {
  if (delim.length === 0) {
    let r = null;
    for (let i = input.length - 1; i >= 0; i--) r = {_hd: input[i], _tl: r};
    return r;
  }
  const parts = input.split(delim);
  let r = null;
  for (let i = parts.length - 1; i >= 0; i--) r = {_hd: parts[i], _tl: r};
  return r;
}
function String$trim(s) { return s.trim(); }
function String$starts_with(prefix, s) { return s.startsWith(prefix); }
function String$contains(sub, s) { return s.includes(sub); }
function String$replace(old_s, new_s, input) {
  if (old_s.length === 0) return input;
  return input.split(old_s).join(new_s);
}
function String$to_int(s) { const n = parseInt(s,10); return isNaN(n) ? {_tag:0,_name:"None"} : {_tag:1,_name:"Some",_val:n}; }
function String$to_float(s) { const f = parseFloat(s); return isNaN(f) ? {_tag:0,_name:"None"} : {_tag:1,_name:"Some",_val:f}; }
function String$uppercase(s) { return s.toUpperCase(); }
function String$lowercase(s) { return s.toLowerCase(); }
function String$get(s, i) {
  if (i < 0 || i >= s.length) throw new Error("String.get: index " + i + " out of bounds (length " + s.length + ")");
  return s.charCodeAt(i);
}
function String$to_bytes(s) {
  let r = null;
  for (let i = s.length - 1; i >= 0; i--) r = {_hd: s.charCodeAt(i), _tl: r};
  return r;
}
function String$of_bytes(lst) {
  let r = "";
  let c = lst;
  while (c !== null) { r += String.fromCharCode(c._hd); c = c._tl; }
  return r;
}
function String$to_byte_array(s) {
  const a = new Array(s.length);
  for (let i = 0; i < s.length; i++) a[i] = s.charCodeAt(i);
  return {_arr: a};
}
function String$of_byte_array(a) {
  let r = "";
  for (let i = 0; i < a._arr.length; i++) r += String.fromCharCode(a._arr[i]);
  return r;
}
function String$to_runes(s) { return __string_to_runes(s); }
function String$of_runes(lst) {
  let r = "";
  let c = lst;
  while (c !== null) { r += String.fromCodePoint(c._hd); c = c._tl; }
  return r;
}
function String$get_rune(s, n) {
  const cps = Array.from(s);
  if (n < 0 || n >= cps.length) throw new Error("String.get_rune: index " + n + " out of bounds");
  return cps[n].codePointAt(0);
}
function String$of_byte(b) { return String.fromCharCode(b); }
function String$rune_length(s) { return Array.from(s).length; }
function String$make(n, b) {
  if (n < 0) throw new Error("String.make: negative length");
  return String.fromCharCode(b).repeat(n);
}
function String$index_opt(s, b) { const i=s.indexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:"None"}:{_tag:1,_name:"Some",_val:i}; }
function String$rindex_opt(s, b) { const i=s.lastIndexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:"None"}:{_tag:1,_name:"Some",_val:i}; }
function String$concat(sep, lst) { return string_concat(sep, lst); }
function String$compare(a, b) { return a < b ? -1 : a > b ? 1 : 0; }
// Array module
function Array$make(n, v) { return array_make(n, v); }
function Array$get(a, i) { return array_get(a, i); }
function Array$set(a, i, v) { return array_set(a, i, v); }
function Array$length(a) { return array_length(a); }
function Array$to_list(a) { return array_to_list(a); }
function Array$of_list(l) { return array_of_list(l); }
function Array$copy(a) { return array_copy(a); }
function Array$sub(a, s, l) { return array_sub(a, s, l); }
// IO module
function IO$read_file(path) {
  if (typeof globalThis._jsReadFile === "function") return globalThis._jsReadFile(path);
  if (typeof require !== "undefined") return require("fs").readFileSync(path,"utf8");
  throw new Error("IO.read_file: not available in this environment");
}
function IO$write_file(path, data) {
  if (typeof require !== "undefined") { require("fs").writeFileSync(path,data); return undefined; }
  throw new Error("IO.write_file: not available in this environment");
}
function IO$append_file(path, data) {
  if (typeof require !== "undefined") { require("fs").appendFileSync(path,data); return undefined; }
  throw new Error("IO.append_file: not available in this environment");
}
function IO$read_line(u) {
  if (typeof require !== "undefined") {
    const buf = Buffer.alloc(1);
    let line = "";
    const fd = require("fs").openSync("/dev/stdin", "rs");
    while (true) {
      const n = require("fs").readSync(fd, buf, 0, 1);
      if (n === 0 || buf[0] === 10) break;
      line += String.fromCharCode(buf[0]);
    }
    return line;
  }
  return "";
}
function IO$file_exists(path) {
  if (typeof require !== "undefined") return require("fs").existsSync(path);
  return false;
}
// Sys module
function Sys$args(u) {
  if (globalThis._jsSysArgs) {
    const a = globalThis._jsSysArgs;
    let r = null;
    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};
    return r;
  }
  if (typeof process !== "undefined") {
    const a = process.argv.slice(1);
    let r = null;
    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};
    return r;
  }
  return null;
}
function Sys$getenv(name) {
  if (typeof process !== "undefined") {
    const v = process.env[name];
    return v === undefined ? {_tag:0,_name:"None"} : {_tag:1,_name:"Some",_val:v};
  }
  return {_tag:0,_name:"None"};
}
function Sys$exit(code) { __sys_exit(code); }
function Sys$time(u) { return __sys_time(); }
// Runtime module (stubs â€” eval not supported in compiled JS)
function Runtime$eval(s) { throw new Error("Runtime.eval: not supported in compiled JS"); }
function Runtime$eval_file(s) { throw new Error("Runtime.eval_file: not supported in compiled JS"); }
// --- Typeclass Dictionaries ---
const __dict_Num_int = { $star: (a, b) => a * b, $plus: (a, b) => a + b, $minus: (a, b) => a - b, $slash: (a, b) => (a / b) | 0, neg: (a) => -a };
const __dict_Num_float = { $star: (a, b) => a * b, $plus: (a, b) => a + b, $minus: (a, b) => a - b, $slash: (a, b) => a / b, neg: (a) => -a };
const __dict_Eq_int = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };
const __dict_Eq_float = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };
const __dict_Eq_string = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };
const __dict_Eq_bool = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };
const __dict_Eq_byte = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };
const __dict_Eq_rune = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };
const __dict_Ord_int = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };
const __dict_Ord_float = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };
const __dict_Ord_string = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };
const __dict_Ord_byte = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };
const __dict_Ord_rune = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };
const __dict_Bitwise_int = { land: (a, b) => a & b, lnot: (a) => ~a, lor: (a, b) => a | b, lsl: (a, b) => a << b, lsr: (a, b) => a >> b, lxor: (a, b) => a ^ b };
const __dict_Show_int = { show: (a) => String(a) };
const __dict_Show_float = { show: string_of_float };
const __dict_Show_bool = { show: (a) => String(a) };
const __dict_Show_string = { show: (a) => a };
const __dict_Show_unit = { show: (_) => "()" };
const __dict_Show_byte = { show: (a) => "#" + a.toString(16).padStart(2, "0") };
const __dict_Show_rune = { show: (a) => String.fromCodePoint(a) };
const __dict_Map_g0_g1_map__g0__g1 = {
  of_list: function(lst) {
    const m = new Map();
    let c = lst; while (c !== null) { m.set(c._hd[0], c._hd[1]); c = c._tl; }
    return m;
  },
  get: function(k, m) {
    return m.has(k) ? {_tag:1,_name:"Some",_val:m.get(k)} : {_tag:0,_name:"None"};
  },
  set: function(k, v, m) { const r = new Map(m); r.set(k, v); return r; },
  has: function(k, m) { return m.has(k); },
  remove: function(k, m) { const r = new Map(m); r.delete(k); return r; },
  size: function(m) { return m.size; },
  keys: function(m) {
    const a = Array.from(m.keys()); let r = null;
    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};
    return r;
  },
  values: function(m) {
    const a = Array.from(m.values()); let r = null;
    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};
    return r;
  },
  to_list: function(m) {
    const a = Array.from(m.entries()); let r = null;
    for (let i = a.length - 1; i >= 0; i--) r = {_hd: [a[i][0], a[i][1]], _tl: r};
    return r;
  }
};
const __dict_Index_g0_g1_map__g0__g1__g0__g1 = {
  at: function(k, m) {
    if (!m.has(k)) throw new Error("key not found: " + _pp(k));
    return m.get(k);
  }
};
// --- Canvas builtins (browser only) ---
function Canvas$init(w, h) {
  if (typeof globalThis._canvasInit === "function") globalThis._canvasInit(w, h);
  return undefined;
}
function Canvas$clear(color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height); }
  return undefined;
}
function Canvas$fill_rect(x, y, w, h, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.fillRect(x, y, w, h); }
  return undefined;
}
function Canvas$stroke_rect(x, y, w, h, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.strokeStyle = color; ctx.lineWidth = 1; ctx.strokeRect(x, y, w, h); }
  return undefined;
}
function Canvas$fill_circle(x, y, r, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x, y, r, 0, 2*Math.PI); ctx.fill(); }
  return undefined;
}
function Canvas$draw_text(text, x, y, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.textBaseline = "top"; ctx.fillText(text, x, y); }
  return undefined;
}
function Canvas$set_font(font) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.font = font; }
  return undefined;
}
function Canvas$mouse_x(_) { return globalThis._canvasMouseX || 0; }
function Canvas$mouse_y(_) { return globalThis._canvasMouseY || 0; }
function Canvas$mouse_down(_) { return !!globalThis._canvasMouseDown; }
function Canvas$mouse_clicked(_) { return !!globalThis._canvasMouseClicked; }
function Canvas$key_down(key) { return !!(globalThis._canvasKeysDown && globalThis._canvasKeysDown[key]); }
function Canvas$key_pressed(key) { return !!(globalThis._canvasKeysPressed && globalThis._canvasKeysPressed[key]); }
function Canvas$start_app(init_fn, frame_fn) {
  globalThis._canvasApp = { initFn: init_fn, frameFn: frame_fn, jsMode: true, call: _call };
  return undefined;
}
// --- Stdlib ---
function _t0(f, acc, xs) {
  function go(a, l) {
    while (true) {
      let _t2;
      const _t1 = l;
      _t3: {
        if (_t1 === null) {
          _t2 = a;
          break _t3;
        }
        if (_t1 !== null) {
          const x = _t1._hd;
          const rest = _t1._tl;
          const _t4 = f(a, x);
          const _t5 = rest;
          a = _t4;
          l = _t5;
          continue;
          _t2 = undefined;
          break _t3;
        }
        _match_fail("line 14");
      }
      return _t2;
    }
  }
  const _t6 = go(acc, xs);
  return _t6;
}
const __dict_Iter_g0_list__g0 = ({fold: _t0});
function _t7(f, acc, arr) {
  function go(a, i) {
    while (true) {
      let _t8;
      if ((i === array_length(arr))) {
        _t8 = a;
      } else {
        const _t9 = f(a, array_get(arr, i));
        const _t10 = (i + 1);
        a = _t9;
        i = _t10;
        continue;
        _t8 = undefined;
      }
      return _t8;
    }
  }
  const _t11 = go(acc, 0);
  return _t11;
}
const __dict_Iter_g0_array__g0 = ({fold: _t7});
function __dict_Show_g0_list(__dict_Show_0) {
  function _t12(xs) {
    let _t14;
    const _t13 = xs;
    _t15: {
      if (_t13 === null) {
        _t14 = "[]";
        break _t15;
      }
      if (true) {
        function _t16(acc, x) {
          let _t17;
          if ((acc === "")) {
            _t17 = __dict_Show_0.show(x);
          } else {
            _t17 = ((acc + "; ") + __dict_Show_0.show(x));
          }
          return _t17;
        }
        _t14 = (("[" + __dict_Iter_g0_list__g0.fold(_t16, "", xs)) + "]");
        break _t15;
      }
      _match_fail("line 32");
    }
    return _t14;
  }
  return ({show: _t12});
}
function __dict_Show_g0_array(__dict_Show_0) {
  function _t18(arr) {
    let _t19;
    if ((array_length(arr) === 0)) {
      _t19 = "#[]";
    } else {
      function _t20(acc, x) {
        let _t21;
        if ((acc === "")) {
          _t21 = __dict_Show_0.show(x);
        } else {
          _t21 = ((acc + "; ") + __dict_Show_0.show(x));
        }
        return _t21;
      }
      _t19 = (("#[" + __dict_Iter_g0_array__g0.fold(_t20, "", arr)) + "]");
    }
    return _t19;
  }
  return ({show: _t18});
}
function __dict_Show_g0_option(__dict_Show_0) {
  function _t22(opt) {
    let _t24;
    const _t23 = opt;
    _t25: {
      if (_t23._tag === 0) {
        _t24 = "None";
        break _t25;
      }
      if (_t23._tag === 1) {
        const x = _t23._val;
        _t24 = ("Some " + __dict_Show_0.show(x));
        break _t25;
      }
      _match_fail("line 32");
    }
    return _t24;
  }
  return ({show: _t22});
}
function __dict_Show_g0_g1_tup(__dict_Show_0, __dict_Show_1) {
  function _t26(p) {
    let _t28;
    const _t27 = p;
    _t29: {
      if (true) {
        const a = _t27[0];
        const b = _t27[1];
        _t28 = (((("(" + __dict_Show_0.show(a)) + ", ") + __dict_Show_1.show(b)) + ")");
        break _t29;
      }
      _match_fail("line 32");
    }
    return _t28;
  }
  return ({show: _t26});
}
function __dict_Show_g0_g1_g2_tup(__dict_Show_0, __dict_Show_1, __dict_Show_2) {
  function _t30(p) {
    let _t32;
    const _t31 = p;
    _t33: {
      if (true) {
        const a = _t31[0];
        const b = _t31[1];
        const c = _t31[2];
        _t32 = (((((("(" + __dict_Show_0.show(a)) + ", ") + __dict_Show_1.show(b)) + ", ") + __dict_Show_2.show(c)) + ")");
        break _t33;
      }
      _match_fail("line 32");
    }
    return _t32;
  }
  return ({show: _t30});
}
function _t34(f, acc, m) {
  function go(a, l) {
    while (true) {
      let _t36;
      const _t35 = l;
      _t37: {
        if (_t35 === null) {
          _t36 = a;
          break _t37;
        }
        if (_t35 !== null) {
          const x = _t35._hd;
          const rest = _t35._tl;
          const _t38 = f(a, x);
          const _t39 = rest;
          a = _t38;
          l = _t39;
          continue;
          _t36 = undefined;
          break _t37;
        }
        _match_fail("line 6");
      }
      return _t36;
    }
  }
  const _t40 = go(acc, __dict_Map_g0_g1_map__g0__g1.to_list(m));
  return _t40;
}
const __dict_Iter_g1_g0_map__g1_g0_tup = ({fold: _t34});
if (typeof String$length === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.length"]) var String$length = globalThis._mmlExterns["String.length"]; else throw new Error("extern " + "String.length" + " not provided"); }
if (typeof String$sub === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.sub"]) var String$sub = globalThis._mmlExterns["String.sub"]; else throw new Error("extern " + "String.sub" + " not provided"); }
if (typeof String$split === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.split"]) var String$split = globalThis._mmlExterns["String.split"]; else throw new Error("extern " + "String.split" + " not provided"); }
if (typeof String$trim === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.trim"]) var String$trim = globalThis._mmlExterns["String.trim"]; else throw new Error("extern " + "String.trim" + " not provided"); }
if (typeof String$starts_with === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.starts_with"]) var String$starts_with = globalThis._mmlExterns["String.starts_with"]; else throw new Error("extern " + "String.starts_with" + " not provided"); }
if (typeof String$contains === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.contains"]) var String$contains = globalThis._mmlExterns["String.contains"]; else throw new Error("extern " + "String.contains" + " not provided"); }
if (typeof String$replace === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.replace"]) var String$replace = globalThis._mmlExterns["String.replace"]; else throw new Error("extern " + "String.replace" + " not provided"); }
if (typeof String$to_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_int"]) var String$to_int = globalThis._mmlExterns["String.to_int"]; else throw new Error("extern " + "String.to_int" + " not provided"); }
if (typeof String$to_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_float"]) var String$to_float = globalThis._mmlExterns["String.to_float"]; else throw new Error("extern " + "String.to_float" + " not provided"); }
if (typeof String$uppercase === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.uppercase"]) var String$uppercase = globalThis._mmlExterns["String.uppercase"]; else throw new Error("extern " + "String.uppercase" + " not provided"); }
if (typeof String$lowercase === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.lowercase"]) var String$lowercase = globalThis._mmlExterns["String.lowercase"]; else throw new Error("extern " + "String.lowercase" + " not provided"); }
if (typeof String$get === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.get"]) var String$get = globalThis._mmlExterns["String.get"]; else throw new Error("extern " + "String.get" + " not provided"); }
if (typeof String$to_bytes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_bytes"]) var String$to_bytes = globalThis._mmlExterns["String.to_bytes"]; else throw new Error("extern " + "String.to_bytes" + " not provided"); }
if (typeof String$of_bytes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_bytes"]) var String$of_bytes = globalThis._mmlExterns["String.of_bytes"]; else throw new Error("extern " + "String.of_bytes" + " not provided"); }
if (typeof String$to_byte_array === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_byte_array"]) var String$to_byte_array = globalThis._mmlExterns["String.to_byte_array"]; else throw new Error("extern " + "String.to_byte_array" + " not provided"); }
if (typeof String$of_byte_array === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_byte_array"]) var String$of_byte_array = globalThis._mmlExterns["String.of_byte_array"]; else throw new Error("extern " + "String.of_byte_array" + " not provided"); }
if (typeof String$to_runes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_runes"]) var String$to_runes = globalThis._mmlExterns["String.to_runes"]; else throw new Error("extern " + "String.to_runes" + " not provided"); }
if (typeof String$of_runes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_runes"]) var String$of_runes = globalThis._mmlExterns["String.of_runes"]; else throw new Error("extern " + "String.of_runes" + " not provided"); }
if (typeof String$get_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.get_rune"]) var String$get_rune = globalThis._mmlExterns["String.get_rune"]; else throw new Error("extern " + "String.get_rune" + " not provided"); }
if (typeof String$of_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_byte"]) var String$of_byte = globalThis._mmlExterns["String.of_byte"]; else throw new Error("extern " + "String.of_byte" + " not provided"); }
if (typeof String$rune_length === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.rune_length"]) var String$rune_length = globalThis._mmlExterns["String.rune_length"]; else throw new Error("extern " + "String.rune_length" + " not provided"); }
if (typeof String$make === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.make"]) var String$make = globalThis._mmlExterns["String.make"]; else throw new Error("extern " + "String.make" + " not provided"); }
if (typeof String$index_opt === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.index_opt"]) var String$index_opt = globalThis._mmlExterns["String.index_opt"]; else throw new Error("extern " + "String.index_opt" + " not provided"); }
if (typeof String$rindex_opt === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.rindex_opt"]) var String$rindex_opt = globalThis._mmlExterns["String.rindex_opt"]; else throw new Error("extern " + "String.rindex_opt" + " not provided"); }
if (typeof String$concat === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.concat"]) var String$concat = globalThis._mmlExterns["String.concat"]; else throw new Error("extern " + "String.concat" + " not provided"); }
if (typeof String$compare === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.compare"]) var String$compare = globalThis._mmlExterns["String.compare"]; else throw new Error("extern " + "String.compare" + " not provided"); }
function String$iter(f, s) {
  const n_41 = String$length(s);
  function go(i) {
    while (true) {
      let _t43;
      if ((i >= n_41)) {
        _t43 = undefined;
      } else {
        f(String$get(s, i));
        const _t44 = (i + 1);
        i = _t44;
        continue;
        _t43 = undefined;
      }
      return _t43;
    }
  }
  const _t45 = go(0);
  const _t42 = _t45;
  return _t42;
}
function List$fold(f, acc, xs) {
  function go(a, l) {
    while (true) {
      let _t47;
      const _t46 = l;
      _t48: {
        if (_t46 === null) {
          _t47 = a;
          break _t48;
        }
        if (_t46 !== null) {
          const x = _t46._hd;
          const rest = _t46._tl;
          const _t49 = f(a, x);
          const _t50 = rest;
          a = _t49;
          l = _t50;
          continue;
          _t47 = undefined;
          break _t48;
        }
        _match_fail("line 259");
      }
      return _t47;
    }
  }
  const _t51 = go(acc, xs);
  return _t51;
}
function List$length(xs) {
  function _t52(acc, _) {
    return (acc + 1);
  }
  return List$fold(_t52, 0, xs);
}
function List$rev(xs) {
  function _t53(acc, x) {
    return ({_hd: x, _tl: acc});
  }
  return List$fold(_t53, null, xs);
}
function List$hd(xs) {
  let _t55;
  const _t54 = xs;
  _t56: {
    if (_t54 !== null) {
      const x = _t54._hd;
      _t55 = x;
      break _t56;
    }
    _match_fail("line 259");
  }
  return _t55;
}
function List$tl(xs) {
  let _t58;
  const _t57 = xs;
  _t59: {
    if (_t57 !== null) {
      const rest = _t57._tl;
      _t58 = rest;
      break _t59;
    }
    _match_fail("line 259");
  }
  return _t58;
}
function List$nth(xs, n) {
  function go(l, i) {
    while (true) {
      let _t61;
      const _t60 = l;
      _t62: {
        if (_t60 !== null) {
          const x = _t60._hd;
          const rest = _t60._tl;
          let _t63;
          if ((i === 0)) {
            _t63 = x;
          } else {
            const _t64 = rest;
            const _t65 = (i - 1);
            l = _t64;
            i = _t65;
            continue;
            _t63 = undefined;
          }
          _t61 = _t63;
          break _t62;
        }
        _match_fail("line 259");
      }
      return _t61;
    }
  }
  const _t66 = go(xs, n);
  return _t66;
}
function List$concat(a, b) {
  function _t67(acc, x) {
    return ({_hd: x, _tl: acc});
  }
  return List$fold(_t67, b, List$rev(a));
}
function List$is_empty(xs) {
  let _t69;
  const _t68 = xs;
  _t70: {
    if (_t68 === null) {
      _t69 = true;
      break _t70;
    }
    if (true) {
      _t69 = false;
      break _t70;
    }
    _match_fail("line 259");
  }
  return _t69;
}
function List$flatten(xss) {
  function _t71(acc, xs) {
    return List$concat(acc, xs);
  }
  return List$fold(_t71, null, xss);
}
function List$map(f, xs) {
  function go(acc, l) {
    while (true) {
      let _t73;
      const _t72 = l;
      _t74: {
        if (_t72 === null) {
          _t73 = List$rev(acc);
          break _t74;
        }
        if (_t72 !== null) {
          const x = _t72._hd;
          const rest = _t72._tl;
          const _t75 = ({_hd: f(x), _tl: acc});
          const _t76 = rest;
          acc = _t75;
          l = _t76;
          continue;
          _t73 = undefined;
          break _t74;
        }
        _match_fail("line 259");
      }
      return _t73;
    }
  }
  const _t77 = go(null, xs);
  return _t77;
}
function List$filter(f, xs) {
  function go(acc, l) {
    while (true) {
      let _t79;
      const _t78 = l;
      _t80: {
        if (_t78 === null) {
          _t79 = List$rev(acc);
          break _t80;
        }
        if (_t78 !== null) {
          const x = _t78._hd;
          const rest = _t78._tl;
          let _t81;
          if (f(x)) {
            const _t82 = ({_hd: x, _tl: acc});
            const _t83 = rest;
            acc = _t82;
            l = _t83;
            continue;
            _t81 = undefined;
          } else {
            const _t84 = acc;
            const _t85 = rest;
            acc = _t84;
            l = _t85;
            continue;
            _t81 = undefined;
          }
          _t79 = _t81;
          break _t80;
        }
        _match_fail("line 259");
      }
      return _t79;
    }
  }
  const _t86 = go(null, xs);
  return _t86;
}
function List$find(f, xs) {
  function go(l) {
    while (true) {
      let _t88;
      const _t87 = l;
      _t89: {
        if (_t87 === null) {
          _t88 = ({_tag: 0, _name: "None"});
          break _t89;
        }
        if (_t87 !== null) {
          const x = _t87._hd;
          const rest = _t87._tl;
          let _t90;
          if (f(x)) {
            _t90 = ({_tag: 1, _name: "Some", _val: x});
          } else {
            const _t91 = rest;
            l = _t91;
            continue;
            _t90 = undefined;
          }
          _t88 = _t90;
          break _t89;
        }
        _match_fail("line 259");
      }
      return _t88;
    }
  }
  const _t92 = go(xs);
  return _t92;
}
function List$exists(f, xs) {
  function go(l) {
    while (true) {
      let _t94;
      const _t93 = l;
      _t95: {
        if (_t93 === null) {
          _t94 = false;
          break _t95;
        }
        if (_t93 !== null) {
          const x = _t93._hd;
          const rest = _t93._tl;
          let _t96;
          if (f(x)) {
            _t96 = true;
          } else {
            const _t97 = rest;
            l = _t97;
            continue;
            _t96 = undefined;
          }
          _t94 = _t96;
          break _t95;
        }
        _match_fail("line 259");
      }
      return _t94;
    }
  }
  const _t98 = go(xs);
  return _t98;
}
function List$forall(f, xs) {
  function go(l) {
    while (true) {
      let _t100;
      const _t99 = l;
      _t101: {
        if (_t99 === null) {
          _t100 = true;
          break _t101;
        }
        if (_t99 !== null) {
          const x = _t99._hd;
          const rest = _t99._tl;
          let _t102;
          if (f(x)) {
            const _t103 = rest;
            l = _t103;
            continue;
            _t102 = undefined;
          } else {
            _t102 = false;
          }
          _t100 = _t102;
          break _t101;
        }
        _match_fail("line 259");
      }
      return _t100;
    }
  }
  const _t104 = go(xs);
  return _t104;
}
function List$zip(xs, ys) {
  function go(acc, a, b) {
    while (true) {
      let _t106;
      const _t105 = a;
      _t107: {
        if (_t105 === null) {
          _t106 = List$rev(acc);
          break _t107;
        }
        if (_t105 !== null) {
          const x = _t105._hd;
          const ra = _t105._tl;
          let _t109;
          const _t108 = b;
          _t110: {
            if (_t108 !== null) {
              const y = _t108._hd;
              const rb = _t108._tl;
              const _t111 = ({_hd: [x, y], _tl: acc});
              const _t112 = ra;
              const _t113 = rb;
              acc = _t111;
              a = _t112;
              b = _t113;
              continue;
              _t109 = undefined;
              break _t110;
            }
            _match_fail("line 259");
          }
          _t106 = _t109;
          break _t107;
        }
        _match_fail("line 259");
      }
      return _t106;
    }
  }
  const _t114 = go(null, xs, ys);
  return _t114;
}
function List$mapi(f, xs) {
  function go(i, acc, l) {
    while (true) {
      let _t116;
      const _t115 = l;
      _t117: {
        if (_t115 === null) {
          _t116 = List$rev(acc);
          break _t117;
        }
        if (_t115 !== null) {
          const x = _t115._hd;
          const rest = _t115._tl;
          const _t118 = (i + 1);
          const _t119 = ({_hd: f(i, x), _tl: acc});
          const _t120 = rest;
          i = _t118;
          acc = _t119;
          l = _t120;
          continue;
          _t116 = undefined;
          break _t117;
        }
        _match_fail("line 259");
      }
      return _t116;
    }
  }
  const _t121 = go(0, null, xs);
  return _t121;
}
function List$sort(cmp, xs) {
  function insert(x, sorted) {
    let _t123;
    const _t122 = sorted;
    _t124: {
      if (_t122 === null) {
        _t123 = ({_hd: x, _tl: null});
        break _t124;
      }
      if (_t122 !== null) {
        const y = _t122._hd;
        const rest = _t122._tl;
        let _t125;
        if ((cmp(x, y) < 1)) {
          _t125 = ({_hd: x, _tl: sorted});
        } else {
          _t125 = ({_hd: y, _tl: insert(x, rest)});
        }
        _t123 = _t125;
        break _t124;
      }
      _match_fail("line 259");
    }
    return _t123;
  }
  function _t127(acc, x) {
    return insert(x, acc);
  }
  const _t126 = List$fold(_t127, null, xs);
  return _t126;
}
function List$fold_right(f, xs, acc) {
  function go(l) {
    let _t129;
    const _t128 = l;
    _t130: {
      if (_t128 === null) {
        _t129 = acc;
        break _t130;
      }
      if (_t128 !== null) {
        const x = _t128._hd;
        const rest = _t128._tl;
        _t129 = f(x, go(rest));
        break _t130;
      }
      _match_fail("line 259");
    }
    return _t129;
  }
  const _t131 = go(xs);
  return _t131;
}
function List$find_map(f, xs) {
  function go(l) {
    while (true) {
      let _t133;
      const _t132 = l;
      _t134: {
        if (_t132 === null) {
          _t133 = ({_tag: 0, _name: "None"});
          break _t134;
        }
        if (_t132 !== null) {
          const x = _t132._hd;
          const rest = _t132._tl;
          let _t136;
          const _t135 = f(x);
          _t137: {
            if (_t135._tag === 1) {
              const result = _t135;
              _t136 = result;
              break _t137;
            }
            if (_t135._tag === 0) {
              const _t138 = rest;
              l = _t138;
              continue;
              _t136 = undefined;
              break _t137;
            }
            _match_fail("line 259");
          }
          _t133 = _t136;
          break _t134;
        }
        _match_fail("line 259");
      }
      return _t133;
    }
  }
  const _t139 = go(xs);
  return _t139;
}
function List$assoc_opt(key, xs) {
  function go(l) {
    while (true) {
      let _t141;
      const _t140 = l;
      _t142: {
        if (_t140 === null) {
          _t141 = ({_tag: 0, _name: "None"});
          break _t142;
        }
        if (_t140 !== null) {
          const k = _t140._hd[0];
          const v = _t140._hd[1];
          const rest = _t140._tl;
          let _t143;
          if (_eq(k, key)) {
            _t143 = ({_tag: 1, _name: "Some", _val: v});
          } else {
            const _t144 = rest;
            l = _t144;
            continue;
            _t143 = undefined;
          }
          _t141 = _t143;
          break _t142;
        }
        _match_fail("line 259");
      }
      return _t141;
    }
  }
  const _t145 = go(xs);
  return _t145;
}
function List$init(n, f) {
  function go(i, acc) {
    while (true) {
      let _t146;
      if ((i < 0)) {
        _t146 = acc;
      } else {
        const _t147 = (i - 1);
        const _t148 = ({_hd: f(i), _tl: acc});
        i = _t147;
        acc = _t148;
        continue;
        _t146 = undefined;
      }
      return _t146;
    }
  }
  const _t149 = go((n - 1), null);
  return _t149;
}
function List$concat_map(f, xs) {
  return List$flatten(List$map(f, xs));
}
function List$iter2(f, xs, ys) {
  function go(a, b) {
    while (true) {
      let _t151;
      const _t150 = a;
      _t152: {
        if (_t150 === null) {
          _t151 = undefined;
          break _t152;
        }
        if (_t150 !== null) {
          const x = _t150._hd;
          const ra = _t150._tl;
          let _t154;
          const _t153 = b;
          _t155: {
            if (_t153 !== null) {
              const y = _t153._hd;
              const rb = _t153._tl;
              f(x, y);
              const _t156 = ra;
              const _t157 = rb;
              a = _t156;
              b = _t157;
              continue;
              _t154 = undefined;
              break _t155;
            }
            _match_fail("line 259");
          }
          _t151 = _t154;
          break _t152;
        }
        _match_fail("line 259");
      }
      return _t151;
    }
  }
  const _t158 = go(xs, ys);
  return _t158;
}
function List$map2(f, xs, ys) {
  function go(acc, a, b) {
    while (true) {
      let _t160;
      const _t159 = a;
      _t161: {
        if (_t159 === null) {
          _t160 = List$rev(acc);
          break _t161;
        }
        if (_t159 !== null) {
          const x = _t159._hd;
          const ra = _t159._tl;
          let _t163;
          const _t162 = b;
          _t164: {
            if (_t162 !== null) {
              const y = _t162._hd;
              const rb = _t162._tl;
              const _t165 = ({_hd: f(x, y), _tl: acc});
              const _t166 = ra;
              const _t167 = rb;
              acc = _t165;
              a = _t166;
              b = _t167;
              continue;
              _t163 = undefined;
              break _t164;
            }
            _match_fail("line 259");
          }
          _t160 = _t163;
          break _t161;
        }
        _match_fail("line 259");
      }
      return _t160;
    }
  }
  const _t168 = go(null, xs, ys);
  return _t168;
}
function List$fold2(f, acc, xs, ys) {
  function go(a, l1, l2) {
    while (true) {
      let _t170;
      const _t169 = l1;
      _t171: {
        if (_t169 === null) {
          _t170 = a;
          break _t171;
        }
        if (_t169 !== null) {
          const x = _t169._hd;
          const r1 = _t169._tl;
          let _t173;
          const _t172 = l2;
          _t174: {
            if (_t172 !== null) {
              const y = _t172._hd;
              const r2 = _t172._tl;
              const _t175 = f(a, x, y);
              const _t176 = r1;
              const _t177 = r2;
              a = _t175;
              l1 = _t176;
              l2 = _t177;
              continue;
              _t173 = undefined;
              break _t174;
            }
            _match_fail("line 259");
          }
          _t170 = _t173;
          break _t171;
        }
        _match_fail("line 259");
      }
      return _t170;
    }
  }
  const _t178 = go(acc, xs, ys);
  return _t178;
}
function List$forall2(f, xs, ys) {
  function go(a, b) {
    while (true) {
      let _t180;
      const _t179 = a;
      _t181: {
        if (_t179 === null) {
          _t180 = true;
          break _t181;
        }
        if (_t179 !== null) {
          const x = _t179._hd;
          const ra = _t179._tl;
          let _t183;
          const _t182 = b;
          _t184: {
            if (_t182 !== null) {
              const y = _t182._hd;
              const rb = _t182._tl;
              let _t185;
              if (f(x, y)) {
                const _t186 = ra;
                const _t187 = rb;
                a = _t186;
                b = _t187;
                continue;
                _t185 = undefined;
              } else {
                _t185 = false;
              }
              _t183 = _t185;
              break _t184;
            }
            _match_fail("line 259");
          }
          _t180 = _t183;
          break _t181;
        }
        _match_fail("line 259");
      }
      return _t180;
    }
  }
  const _t188 = go(xs, ys);
  return _t188;
}
function List$iteri(f, xs) {
  function go(i, l) {
    while (true) {
      let _t190;
      const _t189 = l;
      _t191: {
        if (_t189 === null) {
          _t190 = undefined;
          break _t191;
        }
        if (_t189 !== null) {
          const x = _t189._hd;
          const rest = _t189._tl;
          f(i, x);
          const _t192 = (i + 1);
          const _t193 = rest;
          i = _t192;
          l = _t193;
          continue;
          _t190 = undefined;
          break _t191;
        }
        _match_fail("line 259");
      }
      return _t190;
    }
  }
  const _t194 = go(0, xs);
  return _t194;
}
function List$mem_assoc(key, xs) {
  function go(l) {
    while (true) {
      let _t196;
      const _t195 = l;
      _t197: {
        if (_t195 === null) {
          _t196 = false;
          break _t197;
        }
        if (_t195 !== null) {
          const k = _t195._hd[0];
          const rest = _t195._tl;
          let _t198;
          if (_eq(k, key)) {
            _t198 = true;
          } else {
            const _t199 = rest;
            l = _t199;
            continue;
            _t198 = undefined;
          }
          _t196 = _t198;
          break _t197;
        }
        _match_fail("line 259");
      }
      return _t196;
    }
  }
  const _t200 = go(xs);
  return _t200;
}
function List$assoc(key, xs) {
  let _t202;
  const _t201 = List$assoc_opt(key, xs);
  _t203: {
    if (_t201._tag === 1) {
      const v = _t201._val;
      _t202 = v;
      break _t203;
    }
    if (_t201._tag === 0) {
      _t202 = failwith("List.assoc: not found");
      break _t203;
    }
    _match_fail("line 259");
  }
  return _t202;
}
function List$iter(f, xs) {
  function go(xs) {
    while (true) {
      let _t205;
      const _t204 = xs;
      _t206: {
        if (_t204 === null) {
          _t205 = undefined;
          break _t206;
        }
        if (_t204 !== null) {
          const x = _t204._hd;
          const rest = _t204._tl;
          f(x);
          const _t207 = rest;
          xs = _t207;
          continue;
          _t205 = undefined;
          break _t206;
        }
        _match_fail("line 259");
      }
      return _t205;
    }
  }
  const _t208 = go(xs);
  return _t208;
}
function List$mem(x, xs) {
  function go(xs) {
    while (true) {
      let _t210;
      const _t209 = xs;
      _t211: {
        if (_t209 === null) {
          _t210 = false;
          break _t211;
        }
        if (_t209 !== null) {
          const y = _t209._hd;
          const rest = _t209._tl;
          let _t212;
          if (_eq(x, y)) {
            _t212 = true;
          } else {
            const _t213 = rest;
            xs = _t213;
            continue;
            _t212 = undefined;
          }
          _t210 = _t212;
          break _t211;
        }
        _match_fail("line 259");
      }
      return _t210;
    }
  }
  const _t214 = go(xs);
  return _t214;
}
function List$rev_append(xs, ys) {
  function go(xs, acc) {
    while (true) {
      let _t216;
      const _t215 = xs;
      _t217: {
        if (_t215 === null) {
          _t216 = acc;
          break _t217;
        }
        if (_t215 !== null) {
          const x = _t215._hd;
          const rest = _t215._tl;
          const _t218 = rest;
          const _t219 = ({_hd: x, _tl: acc});
          xs = _t218;
          acc = _t219;
          continue;
          _t216 = undefined;
          break _t217;
        }
        _match_fail("line 259");
      }
      return _t216;
    }
  }
  const _t220 = go(xs, ys);
  return _t220;
}
function List$nth_opt(xs, n) {
  function go(xs, i) {
    while (true) {
      let _t222;
      const _t221 = xs;
      _t223: {
        if (_t221 === null) {
          _t222 = ({_tag: 0, _name: "None"});
          break _t223;
        }
        if (_t221 !== null) {
          const x = _t221._hd;
          const rest = _t221._tl;
          let _t224;
          if ((i === 0)) {
            _t224 = ({_tag: 1, _name: "Some", _val: x});
          } else {
            const _t225 = rest;
            const _t226 = (i - 1);
            xs = _t225;
            i = _t226;
            continue;
            _t224 = undefined;
          }
          _t222 = _t224;
          break _t223;
        }
        _match_fail("line 259");
      }
      return _t222;
    }
  }
  const _t227 = go(xs, n);
  return _t227;
}
function List$find_index(f, xs) {
  function go(xs, i) {
    while (true) {
      let _t229;
      const _t228 = xs;
      _t230: {
        if (_t228 === null) {
          _t229 = ({_tag: 0, _name: "None"});
          break _t230;
        }
        if (_t228 !== null) {
          const x = _t228._hd;
          const rest = _t228._tl;
          let _t231;
          if (f(x)) {
            _t231 = ({_tag: 1, _name: "Some", _val: i});
          } else {
            const _t232 = rest;
            const _t233 = (i + 1);
            xs = _t232;
            i = _t233;
            continue;
            _t231 = undefined;
          }
          _t229 = _t231;
          break _t230;
        }
        _match_fail("line 259");
      }
      return _t229;
    }
  }
  const _t234 = go(xs, 0);
  return _t234;
}
function List$filteri(f, xs) {
  function go(xs, i, acc) {
    while (true) {
      let _t236;
      const _t235 = xs;
      _t237: {
        if (_t235 === null) {
          _t236 = List$rev(acc);
          break _t237;
        }
        if (_t235 !== null) {
          const x = _t235._hd;
          const rest = _t235._tl;
          let _t238;
          if (f(i, x)) {
            const _t239 = rest;
            const _t240 = (i + 1);
            const _t241 = ({_hd: x, _tl: acc});
            xs = _t239;
            i = _t240;
            acc = _t241;
            continue;
            _t238 = undefined;
          } else {
            const _t242 = rest;
            const _t243 = (i + 1);
            const _t244 = acc;
            xs = _t242;
            i = _t243;
            acc = _t244;
            continue;
            _t238 = undefined;
          }
          _t236 = _t238;
          break _t237;
        }
        _match_fail("line 259");
      }
      return _t236;
    }
  }
  const _t245 = go(xs, 0, null);
  return _t245;
}
function List$filter_map(f, xs) {
  function go(xs, acc) {
    while (true) {
      let _t247;
      const _t246 = xs;
      _t248: {
        if (_t246 === null) {
          _t247 = List$rev(acc);
          break _t248;
        }
        if (_t246 !== null) {
          const x = _t246._hd;
          const rest = _t246._tl;
          let _t250;
          const _t249 = f(x);
          _t251: {
            if (_t249._tag === 1) {
              const y = _t249._val;
              const _t252 = rest;
              const _t253 = ({_hd: y, _tl: acc});
              xs = _t252;
              acc = _t253;
              continue;
              _t250 = undefined;
              break _t251;
            }
            if (_t249._tag === 0) {
              const _t254 = rest;
              const _t255 = acc;
              xs = _t254;
              acc = _t255;
              continue;
              _t250 = undefined;
              break _t251;
            }
            _match_fail("line 259");
          }
          _t247 = _t250;
          break _t248;
        }
        _match_fail("line 259");
      }
      return _t247;
    }
  }
  const _t256 = go(xs, null);
  return _t256;
}
function List$sort_uniq(cmp, xs) {
  const sorted_257 = List$sort(cmp, xs);
  function dedup(xs) {
    while (true) {
      let _t260;
      const _t259 = xs;
      _t261: {
        if (_t259 === null) {
          _t260 = null;
          break _t261;
        }
        if (_t259 !== null && _t259._tl === null) {
          const x = _t259._hd;
          _t260 = ({_hd: x, _tl: null});
          break _t261;
        }
        if (_t259 !== null && _t259._tl !== null) {
          const x = _t259._hd;
          const y = _t259._tl._hd;
          const rest = _t259._tl._tl;
          let _t262;
          if ((cmp(x, y) === 0)) {
            const _t263 = ({_hd: y, _tl: rest});
            xs = _t263;
            continue;
            _t262 = undefined;
          } else {
            _t262 = ({_hd: x, _tl: dedup(({_hd: y, _tl: rest}))});
          }
          _t260 = _t262;
          break _t261;
        }
        _match_fail("line 259");
      }
      return _t260;
    }
  }
  const _t264 = dedup(sorted_257);
  const _t258 = _t264;
  return _t258;
}
if (typeof Array$make === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.make"]) var Array$make = globalThis._mmlExterns["Array.make"]; else throw new Error("extern " + "Array.make" + " not provided"); }
if (typeof Array$get === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.get"]) var Array$get = globalThis._mmlExterns["Array.get"]; else throw new Error("extern " + "Array.get" + " not provided"); }
if (typeof Array$set === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.set"]) var Array$set = globalThis._mmlExterns["Array.set"]; else throw new Error("extern " + "Array.set" + " not provided"); }
if (typeof Array$length === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.length"]) var Array$length = globalThis._mmlExterns["Array.length"]; else throw new Error("extern " + "Array.length" + " not provided"); }
if (typeof Array$to_list === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.to_list"]) var Array$to_list = globalThis._mmlExterns["Array.to_list"]; else throw new Error("extern " + "Array.to_list" + " not provided"); }
if (typeof Array$of_list === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.of_list"]) var Array$of_list = globalThis._mmlExterns["Array.of_list"]; else throw new Error("extern " + "Array.of_list" + " not provided"); }
if (typeof Array$copy === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.copy"]) var Array$copy = globalThis._mmlExterns["Array.copy"]; else throw new Error("extern " + "Array.copy" + " not provided"); }
if (typeof Array$sub === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.sub"]) var Array$sub = globalThis._mmlExterns["Array.sub"]; else throw new Error("extern " + "Array.sub" + " not provided"); }
function Array$init(n, f) {
  let _t265;
  if ((n <= 0)) {
    _t265 = {_arr: []};
  } else {
    const arr_266 = Array$make(n, f(0));
    function go(i) {
      while (true) {
        let _t268;
        if ((i >= n)) {
          _t268 = arr_266;
        } else {
          Array$set(arr_266, i, f(i));
          const _t269 = (i + 1);
          i = _t269;
          continue;
          _t268 = undefined;
        }
        return _t268;
      }
    }
    const _t270 = go(1);
    const _t267 = _t270;
    _t265 = _t267;
  }
  return _t265;
}
function Array$map(f, arr) {
  const n_271 = Array$length(arr);
  let _t273;
  if ((n_271 === 0)) {
    _t273 = {_arr: []};
  } else {
    const result_274 = Array$make(n_271, f(Array$get(arr, 0)));
    function go(i) {
      while (true) {
        let _t276;
        if ((i >= n_271)) {
          _t276 = result_274;
        } else {
          Array$set(result_274, i, f(Array$get(arr, i)));
          const _t277 = (i + 1);
          i = _t277;
          continue;
          _t276 = undefined;
        }
        return _t276;
      }
    }
    const _t278 = go(1);
    const _t275 = _t278;
    _t273 = _t275;
  }
  const _t272 = _t273;
  return _t272;
}
function Array$iter(f, arr) {
  const n_279 = Array$length(arr);
  function go(i) {
    while (true) {
      let _t281;
      if ((i >= n_279)) {
        _t281 = undefined;
      } else {
        f(Array$get(arr, i));
        const _t282 = (i + 1);
        i = _t282;
        continue;
        _t281 = undefined;
      }
      return _t281;
    }
  }
  const _t283 = go(0);
  const _t280 = _t283;
  return _t280;
}
function Array$iteri(f, arr) {
  const n_284 = Array$length(arr);
  function go(i) {
    while (true) {
      let _t286;
      if ((i >= n_284)) {
        _t286 = undefined;
      } else {
        f(i, Array$get(arr, i));
        const _t287 = (i + 1);
        i = _t287;
        continue;
        _t286 = undefined;
      }
      return _t286;
    }
  }
  const _t288 = go(0);
  const _t285 = _t288;
  return _t285;
}
function Array$forall(f, arr) {
  const n_289 = Array$length(arr);
  function go(i) {
    while (true) {
      let _t291;
      if ((i >= n_289)) {
        _t291 = true;
      } else {
        let _t292;
        if (f(Array$get(arr, i))) {
          const _t293 = (i + 1);
          i = _t293;
          continue;
          _t292 = undefined;
        } else {
          _t292 = false;
        }
        _t291 = _t292;
      }
      return _t291;
    }
  }
  const _t294 = go(0);
  const _t290 = _t294;
  return _t290;
}
function Array$fold(f, acc, arr) {
  const n_295 = Array$length(arr);
  function go(i, a) {
    while (true) {
      let _t297;
      if ((i >= n_295)) {
        _t297 = a;
      } else {
        const _t298 = (i + 1);
        const _t299 = f(a, Array$get(arr, i));
        i = _t298;
        a = _t299;
        continue;
        _t297 = undefined;
      }
      return _t297;
    }
  }
  const _t300 = go(0, acc);
  const _t296 = _t300;
  return _t296;
}
if (typeof IO$read_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.read_file"]) var IO$read_file = globalThis._mmlExterns["IO.read_file"]; else throw new Error("extern " + "IO.read_file" + " not provided"); }
if (typeof IO$write_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.write_file"]) var IO$write_file = globalThis._mmlExterns["IO.write_file"]; else throw new Error("extern " + "IO.write_file" + " not provided"); }
if (typeof IO$append_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.append_file"]) var IO$append_file = globalThis._mmlExterns["IO.append_file"]; else throw new Error("extern " + "IO.append_file" + " not provided"); }
if (typeof IO$read_line === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.read_line"]) var IO$read_line = globalThis._mmlExterns["IO.read_line"]; else throw new Error("extern " + "IO.read_line" + " not provided"); }
if (typeof IO$file_exists === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.file_exists"]) var IO$file_exists = globalThis._mmlExterns["IO.file_exists"]; else throw new Error("extern " + "IO.file_exists" + " not provided"); }
if (typeof Sys$args === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.args"]) var Sys$args = globalThis._mmlExterns["Sys.args"]; else throw new Error("extern " + "Sys.args" + " not provided"); }
if (typeof Sys$getenv === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.getenv"]) var Sys$getenv = globalThis._mmlExterns["Sys.getenv"]; else throw new Error("extern " + "Sys.getenv" + " not provided"); }
if (typeof Sys$exit === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.exit"]) var Sys$exit = globalThis._mmlExterns["Sys.exit"]; else throw new Error("extern " + "Sys.exit" + " not provided"); }
if (typeof Sys$time === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.time"]) var Sys$time = globalThis._mmlExterns["Sys.time"]; else throw new Error("extern " + "Sys.time" + " not provided"); }
function Math$abs(x) {
  let _t301;
  if ((x < 0)) {
    _t301 = (0 - x);
  } else {
    _t301 = x;
  }
  return _t301;
}
function Math$min(a, b) {
  let _t302;
  if ((a < b)) {
    _t302 = a;
  } else {
    _t302 = b;
  }
  return _t302;
}
function Math$max(a, b) {
  let _t303;
  if ((a > b)) {
    _t303 = a;
  } else {
    _t303 = b;
  }
  return _t303;
}
function Math$pow(a, b) {
  return __math_pow(a, b);
}
function Math$sqrt(x) {
  return __math_sqrt(x);
}
function Math$floor(x) {
  return __math_floor(x);
}
function Math$ceil(x) {
  return __math_ceil(x);
}
function Math$round(x) {
  return __math_round(x);
}
function Result$map(f, r) {
  let _t305;
  const _t304 = r;
  _t306: {
    if (_t304._tag === 0) {
      const v = _t304._val;
      _t305 = ({_tag: 0, _name: "Ok", _val: f(v)});
      break _t306;
    }
    if (_t304._tag === 1) {
      const e = _t304._val;
      _t305 = ({_tag: 1, _name: "Err", _val: e});
      break _t306;
    }
    _match_fail("line 14");
  }
  return _t305;
}
function Result$bind(f, r) {
  let _t308;
  const _t307 = r;
  _t309: {
    if (_t307._tag === 0) {
      const v = _t307._val;
      _t308 = f(v);
      break _t309;
    }
    if (_t307._tag === 1) {
      const e = _t307._val;
      _t308 = ({_tag: 1, _name: "Err", _val: e});
      break _t309;
    }
    _match_fail("line 14");
  }
  return _t308;
}
function Result$unwrap(r) {
  let _t311;
  const _t310 = r;
  _t312: {
    if (_t310._tag === 0) {
      const v = _t310._val;
      _t311 = v;
      break _t312;
    }
    _match_fail("line 14");
  }
  return _t311;
}
function Byte$to_int(b) {
  return __byte_to_int(b);
}
function Byte$of_int(n) {
  return __byte_of_int(n);
}
function Byte$to_string(b) {
  return __byte_to_string(b);
}
function Byte$is_alpha(b) {
  const n_313 = Byte$to_int(b);
  const _t314 = (((n_313 >= 65) && (n_313 <= 90)) || ((n_313 >= 97) && (n_313 <= 122)));
  return _t314;
}
function Byte$is_digit(b) {
  const n_315 = Byte$to_int(b);
  const _t316 = ((n_315 >= 48) && (n_315 <= 57));
  return _t316;
}
function Byte$is_space(b) {
  const n_317 = Byte$to_int(b);
  const _t318 = ((((n_317 === 32) || (n_317 === 9)) || (n_317 === 10)) || (n_317 === 13));
  return _t318;
}
function Byte$is_upper(b) {
  const n_319 = Byte$to_int(b);
  const _t320 = ((n_319 >= 65) && (n_319 <= 90));
  return _t320;
}
function Byte$is_lower(b) {
  const n_321 = Byte$to_int(b);
  const _t322 = ((n_321 >= 97) && (n_321 <= 122));
  return _t322;
}
function Byte$to_upper(b) {
  const n_323 = Byte$to_int(b);
  let _t325;
  if (((n_323 >= 97) && (n_323 <= 122))) {
    _t325 = Byte$of_int((n_323 - 32));
  } else {
    _t325 = b;
  }
  const _t324 = _t325;
  return _t324;
}
function Byte$to_lower(b) {
  const n_326 = Byte$to_int(b);
  let _t328;
  if (((n_326 >= 65) && (n_326 <= 90))) {
    _t328 = Byte$of_int((n_326 + 32));
  } else {
    _t328 = b;
  }
  const _t327 = _t328;
  return _t327;
}
function Rune$to_int(r) {
  return __rune_to_int(r);
}
function Rune$of_int(n) {
  return __rune_of_int(n);
}
function Rune$to_string(r) {
  return __rune_to_string(r);
}
function Rune$is_alpha(r) {
  const n_329 = Rune$to_int(r);
  const _t330 = (((n_329 >= 65) && (n_329 <= 90)) || ((n_329 >= 97) && (n_329 <= 122)));
  return _t330;
}
function Rune$is_digit(r) {
  const n_331 = Rune$to_int(r);
  const _t332 = ((n_331 >= 48) && (n_331 <= 57));
  return _t332;
}
function Rune$is_space(r) {
  const n_333 = Rune$to_int(r);
  const _t334 = ((((n_333 === 32) || (n_333 === 9)) || (n_333 === 10)) || (n_333 === 13));
  return _t334;
}
function Rune$is_upper(r) {
  const n_335 = Rune$to_int(r);
  const _t336 = ((n_335 >= 65) && (n_335 <= 90));
  return _t336;
}
function Rune$is_lower(r) {
  const n_337 = Rune$to_int(r);
  const _t338 = ((n_337 >= 97) && (n_337 <= 122));
  return _t338;
}
function Set$empty(_) {
  return new Map([]);
}
function Set$singleton(__dict_Map_0, x) {
  return __dict_Map_0.set(x, undefined, new Map([]));
}
function Set$of_list(__dict_Map_0, xs) {
  function _t339(acc, x) {
    return __dict_Map_0.set(x, undefined, acc);
  }
  return List$fold(_t339, new Map([]), xs);
}
function Set$add(__dict_Map_0, elem, s) {
  return __dict_Map_0.set(elem, undefined, s);
}
function Set$remove(elem, s) {
  return __dict_Map_g0_g1_map__g0__g1.remove(elem, s);
}
function Set$mem(elem, s) {
  return __dict_Map_g0_g1_map__g0__g1.has(elem, s);
}
function Set$size(s) {
  return __dict_Map_g0_g1_map__g0__g1.size(s);
}
function Set$to_list(s) {
  return __dict_Map_g0_g1_map__g0__g1.keys(s);
}
function Set$union(__dict_Map_0, s1, s2) {
  function _t340(acc, x) {
    return __dict_Map_0.set(x, undefined, acc);
  }
  return List$fold(_t340, s2, __dict_Map_0.keys(s1));
}
function Set$inter(__dict_Map_0, s1, s2) {
  function _t341(acc, x) {
    let _t342;
    if (__dict_Map_0.has(x, s2)) {
      _t342 = __dict_Map_0.set(x, undefined, acc);
    } else {
      _t342 = acc;
    }
    return _t342;
  }
  return List$fold(_t341, Set$empty(undefined), __dict_Map_0.keys(s1));
}
function Set$diff(__dict_Map_0, s1, s2) {
  function _t343(acc, x) {
    let _t344;
    if ((!__dict_Map_0.has(x, s2))) {
      _t344 = __dict_Map_0.set(x, undefined, acc);
    } else {
      _t344 = acc;
    }
    return _t344;
  }
  return List$fold(_t343, Set$empty(undefined), __dict_Map_0.keys(s1));
}
function Set$is_empty(s) {
  return (Set$size(s) === 0);
}
function Set$is_subset(s1, s2) {
  function _t345(x) {
    return __dict_Map_g0_g1_map__g0__g1.has(x, s2);
  }
  return List$forall(_t345, __dict_Map_g0_g1_map__g0__g1.keys(s1));
}
function _t346(f, acc, s) {
  function go(a, l) {
    while (true) {
      let _t348;
      const _t347 = l;
      _t349: {
        if (_t347 === null) {
          _t348 = a;
          break _t349;
        }
        if (_t347 !== null) {
          const x = _t347._hd;
          const rest = _t347._tl;
          const _t350 = f(a, x);
          const _t351 = rest;
          a = _t350;
          l = _t351;
          continue;
          _t348 = undefined;
          break _t349;
        }
        _match_fail("line 45");
      }
      return _t348;
    }
  }
  const _t352 = go(acc, Set$to_list(s));
  return _t352;
}
const __dict_Iter_g0_unit_map__g0 = ({fold: _t346});
function Enum$reduce(f, xs) {
  let _t354;
  const _t353 = xs;
  _t355: {
    if (_t353 !== null) {
      const x = _t353._hd;
      const rest = _t353._tl;
      _t354 = List$fold(f, x, rest);
      break _t355;
    }
    _match_fail("line 118");
  }
  return _t354;
}
function Enum$sum(xs) {
  function _t356(a, b) {
    return (a + b);
  }
  return List$fold(_t356, 0, xs);
}
function Enum$count(f, xs) {
  function _t357(acc, x) {
    let _t358;
    if (f(x)) {
      _t358 = (acc + 1);
    } else {
      _t358 = acc;
    }
    return _t358;
  }
  return List$fold(_t357, 0, xs);
}
function Enum$take(n, xs) {
  function go(i, acc, l) {
    while (true) {
      let _t359;
      if ((i >= n)) {
        _t359 = List$rev(acc);
      } else {
        let _t361;
        const _t360 = l;
        _t362: {
          if (_t360 === null) {
            _t361 = List$rev(acc);
            break _t362;
          }
          if (_t360 !== null) {
            const x = _t360._hd;
            const rest = _t360._tl;
            const _t363 = (i + 1);
            const _t364 = ({_hd: x, _tl: acc});
            const _t365 = rest;
            i = _t363;
            acc = _t364;
            l = _t365;
            continue;
            _t361 = undefined;
            break _t362;
          }
          _match_fail("line 118");
        }
        _t359 = _t361;
      }
      return _t359;
    }
  }
  const _t366 = go(0, null, xs);
  return _t366;
}
function Enum$drop(n, xs) {
  function go(i, l) {
    while (true) {
      let _t367;
      if ((i >= n)) {
        _t367 = l;
      } else {
        let _t369;
        const _t368 = l;
        _t370: {
          if (_t368 === null) {
            _t369 = null;
            break _t370;
          }
          if (_t368 !== null) {
            const rest = _t368._tl;
            const _t371 = (i + 1);
            const _t372 = rest;
            i = _t371;
            l = _t372;
            continue;
            _t369 = undefined;
            break _t370;
          }
          _match_fail("line 118");
        }
        _t367 = _t369;
      }
      return _t367;
    }
  }
  const _t373 = go(0, xs);
  return _t373;
}
function Enum$take_while(f, xs) {
  function go(acc, l) {
    while (true) {
      let _t375;
      const _t374 = l;
      _t376: {
        if (_t374 === null) {
          _t375 = List$rev(acc);
          break _t376;
        }
        if (_t374 !== null) {
          const x = _t374._hd;
          const rest = _t374._tl;
          let _t377;
          if (f(x)) {
            const _t378 = ({_hd: x, _tl: acc});
            const _t379 = rest;
            acc = _t378;
            l = _t379;
            continue;
            _t377 = undefined;
          } else {
            _t377 = List$rev(acc);
          }
          _t375 = _t377;
          break _t376;
        }
        _match_fail("line 118");
      }
      return _t375;
    }
  }
  const _t380 = go(null, xs);
  return _t380;
}
function Enum$drop_while(f, xs) {
  function go(l) {
    while (true) {
      let _t382;
      const _t381 = l;
      _t383: {
        if (_t381 === null) {
          _t382 = null;
          break _t383;
        }
        if (_t381 !== null) {
          const x = _t381._hd;
          const rest = _t381._tl;
          let _t384;
          if (f(x)) {
            const _t385 = rest;
            l = _t385;
            continue;
            _t384 = undefined;
          } else {
            _t384 = l;
          }
          _t382 = _t384;
          break _t383;
        }
        _match_fail("line 118");
      }
      return _t382;
    }
  }
  const _t386 = go(xs);
  return _t386;
}
function Enum$flat_map(f, xs) {
  return List$flatten(List$map(f, xs));
}
function Enum$each(f, xs) {
  function _t387(_, x) {
    return f(x);
  }
  return List$fold(_t387, undefined, xs);
}
function Enum$reject(f, xs) {
  function _t388(x) {
    return (!f(x));
  }
  return List$filter(_t388, xs);
}
function Enum$enumerate(xs) {
  function _t389(i, x) {
    return [i, x];
  }
  return List$mapi(_t389, xs);
}
function Enum$join(sep, xs) {
  let _t391;
  const _t390 = xs;
  _t392: {
    if (_t390 === null) {
      _t391 = "";
      break _t392;
    }
    if (_t390 !== null) {
      const first = _t390._hd;
      const rest = _t390._tl;
      function _t393(acc, x) {
        return ((acc + sep) + x);
      }
      _t391 = List$fold(_t393, first, rest);
      break _t392;
    }
    _match_fail("line 118");
  }
  return _t391;
}
function Enum$chunk(n, xs) {
  function go(acc, l) {
    while (true) {
      let _t395;
      const _t394 = l;
      _t396: {
        if (_t394 === null) {
          _t395 = List$rev(acc);
          break _t396;
        }
        if (true) {
          const _t397 = ({_hd: Enum$take(n, l), _tl: acc});
          const _t398 = Enum$drop(n, l);
          acc = _t397;
          l = _t398;
          continue;
          _t395 = undefined;
          break _t396;
        }
        _match_fail("line 118");
      }
      return _t395;
    }
  }
  const _t399 = go(null, xs);
  return _t399;
}
function Enum$dedup(xs) {
  function go(prev, acc, l) {
    while (true) {
      let _t401;
      const _t400 = l;
      _t402: {
        if (_t400 === null) {
          _t401 = List$rev(acc);
          break _t402;
        }
        if (_t400 !== null) {
          const x = _t400._hd;
          const rest = _t400._tl;
          let _t403;
          if (_eq(x, prev)) {
            const _t404 = prev;
            const _t405 = acc;
            const _t406 = rest;
            prev = _t404;
            acc = _t405;
            l = _t406;
            continue;
            _t403 = undefined;
          } else {
            const _t407 = x;
            const _t408 = ({_hd: x, _tl: acc});
            const _t409 = rest;
            prev = _t407;
            acc = _t408;
            l = _t409;
            continue;
            _t403 = undefined;
          }
          _t401 = _t403;
          break _t402;
        }
        _match_fail("line 118");
      }
      return _t401;
    }
  }
  let _t412;
  const _t411 = xs;
  _t413: {
    if (_t411 === null) {
      _t412 = null;
      break _t413;
    }
    if (_t411 !== null) {
      const x = _t411._hd;
      const rest = _t411._tl;
      _t412 = go(x, ({_hd: x, _tl: null}), rest);
      break _t413;
    }
    _match_fail("line 118");
  }
  const _t410 = _t412;
  return _t410;
}
function Enum$uniq(xs) {
  function _t414(acc, x) {
    function _t415(y) {
      return _eq(y, x);
    }
    let _t416;
    if (List$exists(_t415, acc)) {
      _t416 = acc;
    } else {
      _t416 = ({_hd: x, _tl: acc});
    }
    return _t416;
  }
  return List$rev(List$fold(_t414, null, xs));
}
function Enum$scan(f, init, xs) {
  function _t417(acc, x) {
    let _t419;
    const _t418 = acc;
    _t420: {
      if (_t418 === null) {
        _t419 = ({_hd: f(init, x), _tl: null});
        break _t420;
      }
      if (_t418 !== null) {
        const prev = _t418._hd;
        _t419 = ({_hd: f(prev, x), _tl: acc});
        break _t420;
      }
      _match_fail("line 118");
    }
    return _t419;
  }
  return List$rev(List$fold(_t417, ({_hd: init, _tl: null}), xs));
}
function Enum$intersperse(sep, xs) {
  let _t422;
  const _t421 = xs;
  _t423: {
    if (_t421 === null) {
      _t422 = null;
      break _t423;
    }
    if (_t421 !== null) {
      const first = _t421._hd;
      const rest = _t421._tl;
      function _t424(acc, x) {
        return List$concat(acc, ({_hd: sep, _tl: ({_hd: x, _tl: null})}));
      }
      _t422 = List$fold(_t424, ({_hd: first, _tl: null}), rest);
      break _t423;
    }
    _match_fail("line 118");
  }
  return _t422;
}
function Enum$zip_with(f, xs, ys) {
  function _t425(p) {
    let _t427;
    const _t426 = p;
    _t428: {
      if (true) {
        const a = _t426[0];
        const b = _t426[1];
        _t427 = f(a, b);
        break _t428;
      }
      _match_fail("line 118");
    }
    return _t427;
  }
  return List$map(_t425, List$zip(xs, ys));
}
function Enum$min_by(f, xs) {
  let _t430;
  const _t429 = xs;
  _t431: {
    if (_t429 !== null) {
      const x = _t429._hd;
      const rest = _t429._tl;
      function _t432(best, y) {
        let _t433;
        if ((f(y) < f(best))) {
          _t433 = y;
        } else {
          _t433 = best;
        }
        return _t433;
      }
      _t430 = List$fold(_t432, x, rest);
      break _t431;
    }
    _match_fail("line 118");
  }
  return _t430;
}
function Enum$max_by(f, xs) {
  let _t435;
  const _t434 = xs;
  _t436: {
    if (_t434 !== null) {
      const x = _t434._hd;
      const rest = _t434._tl;
      function _t437(best, y) {
        let _t438;
        if ((f(y) > f(best))) {
          _t438 = y;
        } else {
          _t438 = best;
        }
        return _t438;
      }
      _t435 = List$fold(_t437, x, rest);
      break _t436;
    }
    _match_fail("line 118");
  }
  return _t435;
}
function Enum$group_by(__dict_Map_1, __dict_Map_1_2, f, xs) {
  function _t439(m, x) {
    const k_440 = f(x);
    let _t443;
    const _t442 = __dict_Map_1_2.get(k_440, m);
    _t444: {
      if (_t442._tag === 0) {
        _t443 = __dict_Map_1_2.set(k_440, ({_hd: x, _tl: null}), m);
        break _t444;
      }
      if (_t442._tag === 1) {
        const vs = _t442._val;
        _t443 = __dict_Map_1_2.set(k_440, List$concat(vs, ({_hd: x, _tl: null})), m);
        break _t444;
      }
      _match_fail("line 118");
    }
    const _t441 = _t443;
    return _t441;
  }
  return List$fold(_t439, new Map([]), xs);
}
function Seq$range(start, stop, _mml$yield) {
  function go(i) {
    while (true) {
      let _t445;
      if ((i >= stop)) {
        _t445 = undefined;
      } else {
        _mml$yield(i);
        const _t446 = (i + 1);
        i = _t446;
        continue;
        _t445 = undefined;
      }
      return _t445;
    }
  }
  const _t447 = go(start);
  return _t447;
}
function Seq$of_list(xs, _mml$yield) {
  function go(l) {
    while (true) {
      let _t449;
      const _t448 = l;
      _t450: {
        if (_t448 === null) {
          _t449 = undefined;
          break _t450;
        }
        if (_t448 !== null) {
          const x = _t448._hd;
          const rest = _t448._tl;
          _mml$yield(x);
          const _t451 = rest;
          l = _t451;
          continue;
          _t449 = undefined;
          break _t450;
        }
        _match_fail("line 134");
      }
      return _t449;
    }
  }
  const _t452 = go(xs);
  return _t452;
}
function Seq$repeat(x, _mml$yield) {
  function go(u) {
    while (true) {
      _mml$yield(x);
      const _t453 = u;
      u = _t453;
      continue;
      return undefined;
    }
  }
  const _t454 = go(0);
  return _t454;
}
function Seq$iterate(seed, step, _mml$yield) {
  function go(x) {
    while (true) {
      _mml$yield(x);
      const _t455 = step(x);
      x = _t455;
      continue;
      return undefined;
    }
  }
  const _t456 = go(seed);
  return _t456;
}
function Seq$map(f, s, _mml$yield) {
  function _t457(x) {
    return _mml$yield(f(x));
  }
  return s(_t457);
}
function Seq$filter(f, s, _mml$yield) {
  function _t458(x) {
    let _t459;
    if (f(x)) {
      _t459 = _mml$yield(x);
    } else {
      _t459 = undefined;
    }
    return _t459;
  }
  return s(_t458);
}
function Seq$take(n, s, _mml$yield) {
  return _trampoline(function() {
    let i_460 = _resolve(0);
    const _t461 = (function() {
      const _t462 = _h;
      _h = Object.assign({}, _t462, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t463(x) {
          return _trampoline(function() {
            if ((i_460 >= n)) {
              return _h["__seq_stop"](undefined, function(_t464) {
                return _bounce(function() {
                  return _t464;
                });
              });
            } else {
              _mml$yield(x);
              return (i_460 = (i_460 + 1), undefined);
            }
          });
        }
        const __x_465 = s(_t463);
        return __x_465;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t462; }
    })();
    return _t461;
  }, Seq$take);
}
function Seq$take_while(f, s, _mml$yield) {
  return _trampoline(function() {
    const _t466 = (function() {
      const _t467 = _h;
      _h = Object.assign({}, _t467, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t468(x) {
          return _trampoline(function() {
            if (f(x)) {
              return _mml$yield(x);
            } else {
              return _h["__seq_stop"](undefined, function(_t469) {
                return _bounce(function() {
                  return _t469;
                });
              });
            }
          });
        }
        const __x_470 = s(_t468);
        return __x_470;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t467; }
    })();
    return _t466;
  }, Seq$take_while);
}
function Seq$drop(n, s, _mml$yield) {
  let i_471 = 0;
  function _t473(x) {
    let _t474;
    if ((i_471 >= n)) {
      _t474 = _mml$yield(x);
    } else {
      _t474 = (i_471 = (i_471 + 1), undefined);
    }
    return _t474;
  }
  const _t472 = s(_t473);
  return _t472;
}
function Seq$drop_while(f, s, _mml$yield) {
  let dropping_475 = true;
  function _t477(x) {
    let _t478;
    if (dropping_475) {
      let _t479;
      if (f(x)) {
        _t479 = undefined;
      } else {
        (dropping_475 = false, undefined);
        _t479 = _mml$yield(x);
      }
      _t478 = _t479;
    } else {
      _t478 = _mml$yield(x);
    }
    return _t478;
  }
  const _t476 = s(_t477);
  return _t476;
}
function Seq$flat_map(f, s, _mml$yield) {
  function _t480(x) {
    return f(x, _mml$yield);
  }
  return s(_t480);
}
function Seq$enumerate(s, _mml$yield) {
  let i_481 = 0;
  function _t483(x) {
    _mml$yield([i_481, x]);
    return (i_481 = (i_481 + 1), undefined);
  }
  const _t482 = s(_t483);
  return _t482;
}
function Seq$chunk(n, s, _mml$yield) {
  let buf_484 = null;
  let count_486 = 0;
  function _t488(x) {
    (buf_484 = List$concat(buf_484, ({_hd: x, _tl: null})), undefined);
    (count_486 = (count_486 + 1), undefined);
    let _t489;
    if ((count_486 >= n)) {
      _mml$yield(buf_484);
      (buf_484 = null, undefined);
      _t489 = (count_486 = 0, undefined);
    } else {
      _t489 = undefined;
    }
    return _t489;
  }
  s(_t488);
  let _t490;
  if ((count_486 > 0)) {
    _t490 = _mml$yield(buf_484);
  } else {
    _t490 = undefined;
  }
  const _t487 = _t490;
  const _t485 = _t487;
  return _t485;
}
function Seq$to_list(s) {
  let acc_491 = null;
  function _t493(x) {
    return (acc_491 = ({_hd: x, _tl: acc_491}), undefined);
  }
  s(_t493);
  const _t492 = List$rev(acc_491);
  return _t492;
}
function Seq$fold(f, init, s) {
  let acc_494 = init;
  function _t496(x) {
    return (acc_494 = f(acc_494, x), undefined);
  }
  s(_t496);
  const _t495 = acc_494;
  return _t495;
}
function Seq$each(f, s) {
  return s(f);
}
function Seq$count(s) {
  let n_497 = 0;
  function _t499(_) {
    return (n_497 = (n_497 + 1), undefined);
  }
  s(_t499);
  const _t498 = n_497;
  return _t498;
}
function Seq$sum(s) {
  let total_500 = 0;
  function _t502(x) {
    return (total_500 = (total_500 + x), undefined);
  }
  s(_t502);
  const _t501 = total_500;
  return _t501;
}
function Seq$find(f, s) {
  return _trampoline(function() {
    let result_503 = _resolve(({_tag: 0, _name: "None"}));
    const _t504 = (function() {
      const _t505 = _h;
      _h = Object.assign({}, _t505, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t506(x) {
          return _trampoline(function() {
            if (f(x)) {
              _resolve((result_503 = ({_tag: 1, _name: "Some", _val: x}), undefined));
              return _h["__seq_stop"](undefined, function(_t507) {
                return _bounce(function() {
                  return _t507;
                });
              });
            } else {
              return undefined;
            }
          });
        }
        const __x_508 = s(_t506);
        return __x_508;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t505; }
    })();
    const _t509 = _resolve(_t504);
    return result_503;
  }, Seq$find);
}
function Seq$any(f, s) {
  return _trampoline(function() {
    let result_510 = _resolve(false);
    const _t511 = (function() {
      const _t512 = _h;
      _h = Object.assign({}, _t512, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t513(x) {
          return _trampoline(function() {
            if (f(x)) {
              _resolve((result_510 = true, undefined));
              return _h["__seq_stop"](undefined, function(_t514) {
                return _bounce(function() {
                  return _t514;
                });
              });
            } else {
              return undefined;
            }
          });
        }
        const __x_515 = s(_t513);
        return __x_515;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t512; }
    })();
    const _t516 = _resolve(_t511);
    return result_510;
  }, Seq$any);
}
function Seq$all(f, s) {
  return _trampoline(function() {
    let result_517 = _resolve(true);
    const _t518 = (function() {
      const _t519 = _h;
      _h = Object.assign({}, _t519, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t520(x) {
          return _trampoline(function() {
            if (f(x)) {
              return undefined;
            } else {
              _resolve((result_517 = false, undefined));
              return _h["__seq_stop"](undefined, function(_t521) {
                return _bounce(function() {
                  return _t521;
                });
              });
            }
          });
        }
        const __x_522 = s(_t520);
        return __x_522;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t519; }
    })();
    const _t523 = _resolve(_t518);
    return result_517;
  }, Seq$all);
}
function Option$map(f, opt) {
  let _t525;
  const _t524 = opt;
  _t526: {
    if (_t524._tag === 1) {
      const x = _t524._val;
      _t525 = ({_tag: 1, _name: "Some", _val: f(x)});
      break _t526;
    }
    if (_t524._tag === 0) {
      _t525 = ({_tag: 0, _name: "None"});
      break _t526;
    }
    _match_fail("line 37");
  }
  return _t525;
}
function Option$bind(f, opt) {
  let _t528;
  const _t527 = opt;
  _t529: {
    if (_t527._tag === 1) {
      const x = _t527._val;
      _t528 = f(x);
      break _t529;
    }
    if (_t527._tag === 0) {
      _t528 = ({_tag: 0, _name: "None"});
      break _t529;
    }
    _match_fail("line 37");
  }
  return _t528;
}
function Option$unwrap(opt) {
  let _t531;
  const _t530 = opt;
  _t532: {
    if (_t530._tag === 1) {
      const x = _t530._val;
      _t531 = x;
      break _t532;
    }
    _match_fail("line 37");
  }
  return _t531;
}
function Option$unwrap_or(_mml$default, opt) {
  let _t534;
  const _t533 = opt;
  _t535: {
    if (_t533._tag === 1) {
      const x = _t533._val;
      _t534 = x;
      break _t535;
    }
    if (_t533._tag === 0) {
      _t534 = _mml$default;
      break _t535;
    }
    _match_fail("line 37");
  }
  return _t534;
}
function Option$is_some(opt) {
  let _t537;
  const _t536 = opt;
  _t538: {
    if (_t536._tag === 1) {
      _t537 = true;
      break _t538;
    }
    if (_t536._tag === 0) {
      _t537 = false;
      break _t538;
    }
    _match_fail("line 37");
  }
  return _t537;
}
function Option$is_none(opt) {
  let _t540;
  const _t539 = opt;
  _t541: {
    if (_t539._tag === 1) {
      _t540 = false;
      break _t541;
    }
    if (_t539._tag === 0) {
      _t540 = true;
      break _t541;
    }
    _match_fail("line 37");
  }
  return _t540;
}
function Option$to_list(opt) {
  let _t543;
  const _t542 = opt;
  _t544: {
    if (_t542._tag === 1) {
      const x = _t542._val;
      _t543 = ({_hd: x, _tl: null});
      break _t544;
    }
    if (_t542._tag === 0) {
      _t543 = null;
      break _t544;
    }
    _match_fail("line 37");
  }
  return _t543;
}
function Option$iter(f, opt) {
  let _t546;
  const _t545 = opt;
  _t547: {
    if (_t545._tag === 1) {
      const x = _t545._val;
      _t546 = f(x);
      break _t547;
    }
    if (_t545._tag === 0) {
      _t546 = undefined;
      break _t547;
    }
    _match_fail("line 37");
  }
  return _t546;
}
function Option$flat_map(f, opt) {
  let _t549;
  const _t548 = opt;
  _t550: {
    if (_t548._tag === 1) {
      const x = _t548._val;
      _t549 = f(x);
      break _t550;
    }
    if (_t548._tag === 0) {
      _t549 = ({_tag: 0, _name: "None"});
      break _t550;
    }
    _match_fail("line 37");
  }
  return _t549;
}
function Buffer$create(n) {
  let _t551;
  if ((n < 16)) {
    _t551 = 16;
  } else {
    _t551 = n;
  }
  return ({data: Array$make(_t551, 0), len: 0});
}
function Buffer$length(buf) {
  return buf.len;
}
function Buffer$clear(buf) {
  return (buf.len = 0, undefined);
}
function Buffer$grow(buf, needed) {
  const cap_552 = Array$length(buf.data);
  let _t554;
  if (((buf.len + needed) > cap_552)) {
    const new_cap_555 = Math$max((cap_552 * 2), (buf.len + needed));
    const new_data_557 = Array$make(new_cap_555, 0);
    function copy(i) {
      while (true) {
        let _t559;
        if ((i < buf.len)) {
          Array$set(new_data_557, i, Array$get(buf.data, i));
          const _t560 = (i + 1);
          i = _t560;
          continue;
          _t559 = undefined;
        } else {
          _t559 = undefined;
        }
        return _t559;
      }
    }
    copy(0);
    const _t561 = (buf.data = new_data_557, undefined);
    const _t558 = _t561;
    const _t556 = _t558;
    _t554 = _t556;
  } else {
    _t554 = undefined;
  }
  const _t553 = _t554;
  return _t553;
}
function Buffer$add_byte(buf, b) {
  Buffer$grow(buf, 1);
  Array$set(buf.data, buf.len, b);
  return (buf.len = (buf.len + 1), undefined);
}
function Buffer$add_string(buf, s) {
  const bytes_562 = String$to_byte_array(s);
  const n_564 = Array$length(bytes_562);
  Buffer$grow(buf, n_564);
  function copy(i) {
    while (true) {
      let _t566;
      if ((i < n_564)) {
        Array$set(buf.data, (buf.len + i), Array$get(bytes_562, i));
        const _t567 = (i + 1);
        i = _t567;
        continue;
        _t566 = undefined;
      } else {
        _t566 = undefined;
      }
      return _t566;
    }
  }
  copy(0);
  const _t568 = (buf.len = (buf.len + n_564), undefined);
  const _t565 = _t568;
  const _t563 = _t565;
  return _t563;
}
function Buffer$sub(buf, pos, len) {
  return String$of_byte_array(Array$sub(buf.data, pos, len));
}
function Buffer$truncate(buf, n) {
  return (buf.len = n, undefined);
}
function Buffer$contents(buf) {
  return String$of_byte_array(Array$sub(buf.data, 0, buf.len));
}
function Buffer$add_buffer(dst, src) {
  const n_569 = src.len;
  Buffer$grow(dst, n_569);
  function copy(i) {
    while (true) {
      let _t571;
      if ((i < n_569)) {
        Array$set(dst.data, (dst.len + i), Array$get(src.data, i));
        const _t572 = (i + 1);
        i = _t572;
        continue;
        _t571 = undefined;
      } else {
        _t571 = undefined;
      }
      return _t571;
    }
  }
  copy(0);
  const _t573 = (dst.len = (dst.len + n_569), undefined);
  const _t570 = _t573;
  return _t570;
}
function Fmt$pad_left(n, c, s) {
  const len_574 = String$length(s);
  let _t576;
  if ((len_574 >= n)) {
    _t576 = s;
  } else {
    function pad(acc, remaining) {
      while (true) {
        let _t577;
        if ((remaining <= 0)) {
          _t577 = (acc + s);
        } else {
          const _t578 = (acc + c);
          const _t579 = (remaining - 1);
          acc = _t578;
          remaining = _t579;
          continue;
          _t577 = undefined;
        }
        return _t577;
      }
    }
    const _t580 = pad("", (n - len_574));
    _t576 = _t580;
  }
  const _t575 = _t576;
  return _t575;
}
function Fmt$pad_right(n, c, s) {
  const len_581 = String$length(s);
  let _t583;
  if ((len_581 >= n)) {
    _t583 = s;
  } else {
    function pad(acc, remaining) {
      while (true) {
        let _t584;
        if ((remaining <= 0)) {
          _t584 = (s + acc);
        } else {
          const _t585 = (acc + c);
          const _t586 = (remaining - 1);
          acc = _t585;
          remaining = _t586;
          continue;
          _t584 = undefined;
        }
        return _t584;
      }
    }
    const _t587 = pad("", (n - len_581));
    _t583 = _t587;
  }
  const _t582 = _t583;
  return _t582;
}
function Fmt$int_to_hex(n) {
  const digits_588 = "0123456789abcdef";
  let _t590;
  if ((n === 0)) {
    _t590 = "0";
  } else {
    function go(num, acc) {
      while (true) {
        let _t591;
        if ((num === 0)) {
          _t591 = acc;
        } else {
          const d_592 = (num % 16);
          let _t594;
          if ((d_592 < 0)) {
            _t594 = (d_592 + 16);
          } else {
            _t594 = d_592;
          }
          const d_595 = _t594;
          const ch_597 = String$sub(digits_588, d_595, 1);
          const _t599 = ((num / 16) | 0);
          const _t600 = (ch_597 + acc);
          num = _t599;
          acc = _t600;
          continue;
          const _t598 = undefined;
          const _t596 = _t598;
          const _t593 = _t596;
          _t591 = _t593;
        }
        return _t591;
      }
    }
    let _t602;
    if ((n < 0)) {
      _t602 = (0 - n);
    } else {
      _t602 = n;
    }
    const abs_n_603 = _t602;
    const hex_605 = go(abs_n_603, "");
    let _t607;
    if ((n < 0)) {
      _t607 = ("-" + hex_605);
    } else {
      _t607 = hex_605;
    }
    const _t606 = _t607;
    const _t604 = _t606;
    const _t601 = _t604;
    _t590 = _t601;
  }
  const _t589 = _t590;
  return _t589;
}
function Fmt$int_to_bin(n) {
  let _t608;
  if ((n === 0)) {
    _t608 = "0";
  } else {
    function go(num, acc) {
      while (true) {
        let _t609;
        if ((num === 0)) {
          _t609 = acc;
        } else {
          let _t610;
          if (((num % 2) === 0)) {
            _t610 = "0";
          } else {
            _t610 = "1";
          }
          const bit_611 = _t610;
          const _t613 = ((num / 2) | 0);
          const _t614 = (bit_611 + acc);
          num = _t613;
          acc = _t614;
          continue;
          const _t612 = undefined;
          _t609 = _t612;
        }
        return _t609;
      }
    }
    let _t616;
    if ((n < 0)) {
      _t616 = (0 - n);
    } else {
      _t616 = n;
    }
    const abs_n_617 = _t616;
    const bin_619 = go(abs_n_617, "");
    let _t621;
    if ((n < 0)) {
      _t621 = ("-" + bin_619);
    } else {
      _t621 = bin_619;
    }
    const _t620 = _t621;
    const _t618 = _t620;
    const _t615 = _t618;
    _t608 = _t615;
  }
  return _t608;
}
function Fmt$int_to_oct(n) {
  let _t622;
  if ((n === 0)) {
    _t622 = "0";
  } else {
    function go(num, acc) {
      while (true) {
        let _t623;
        if ((num === 0)) {
          _t623 = acc;
        } else {
          const d_624 = (num % 8);
          let _t626;
          if ((d_624 < 0)) {
            _t626 = (d_624 + 8);
          } else {
            _t626 = d_624;
          }
          const d_627 = _t626;
          const _t629 = ((num / 8) | 0);
          const _t630 = (__dict_Show_int.show(d_627) + acc);
          num = _t629;
          acc = _t630;
          continue;
          const _t628 = undefined;
          const _t625 = _t628;
          _t623 = _t625;
        }
        return _t623;
      }
    }
    let _t632;
    if ((n < 0)) {
      _t632 = (0 - n);
    } else {
      _t632 = n;
    }
    const abs_n_633 = _t632;
    const oct_635 = go(abs_n_633, "");
    let _t637;
    if ((n < 0)) {
      _t637 = ("-" + oct_635);
    } else {
      _t637 = oct_635;
    }
    const _t636 = _t637;
    const _t634 = _t636;
    const _t631 = _t634;
    _t622 = _t631;
  }
  return _t622;
}
function Fmt$zero_pad(width, s) {
  return Fmt$pad_left(width, "0", s);
}
function _t638(n) {
  return n;
}
const __dict_Hash_int = ({hash: _t638});
function _t639(s) {
  const bytes_640 = String$to_byte_array(s);
  function _t642(h, b) {
    return ((h * 31) + Byte$to_int(b));
  }
  const _t641 = __dict_Iter_g0_array__g0.fold(_t642, 5381, bytes_640);
  return _t641;
}
const __dict_Hash_string = ({hash: _t639});
function _t643(b) {
  let _t644;
  if (b) {
    _t644 = 1;
  } else {
    _t644 = 0;
  }
  return _t644;
}
const __dict_Hash_bool = ({hash: _t643});
function _t645(b) {
  return Byte$to_int(b);
}
const __dict_Hash_byte = ({hash: _t645});
function _t646(r) {
  return Rune$to_int(r);
}
const __dict_Hash_rune = ({hash: _t646});
function Hashtbl$create(n) {
  let _t647;
  if ((n < 16)) {
    _t647 = 16;
  } else {
    _t647 = n;
  }
  const cap_648 = _t647;
  const _t649 = ({buckets: Array$make(cap_648, null), size: 0});
  return _t649;
}
function Hashtbl$clear(tbl) {
  const cap_650 = Array$length(tbl.buckets);
  (tbl.buckets = Array$make(cap_650, null), undefined);
  const _t651 = (tbl.size = 0, undefined);
  return _t651;
}
function Hashtbl$length(tbl) {
  return tbl.size;
}
function Hashtbl$bucket_index(__dict_Hash_0, tbl, key) {
  const h_652 = __dict_Hash_0.hash(key);
  let _t654;
  if ((h_652 < 0)) {
    _t654 = (0 - h_652);
  } else {
    _t654 = h_652;
  }
  const h_655 = _t654;
  const _t656 = (h_655 % Array$length(tbl.buckets));
  const _t653 = _t656;
  return _t653;
}
function Hashtbl$to_list(tbl) {
  const cap_657 = Array$length(tbl.buckets);
  function collect(i, acc) {
    while (true) {
      let _t659;
      if ((i >= cap_657)) {
        _t659 = acc;
      } else {
        const bucket_660 = Array$get(tbl.buckets, i);
        const _t662 = (i + 1);
        const _t663 = List$concat(bucket_660, acc);
        i = _t662;
        acc = _t663;
        continue;
        const _t661 = undefined;
        _t659 = _t661;
      }
      return _t659;
    }
  }
  const _t664 = collect(0, null);
  const _t658 = _t664;
  return _t658;
}
function Hashtbl$rehash(tbl, hash_fn) {
  const entries_665 = Hashtbl$to_list(tbl);
  const new_cap_667 = (Array$length(tbl.buckets) * 2);
  (tbl.buckets = Array$make(new_cap_667, null), undefined);
  (tbl.size = 0, undefined);
  function _t669(_, __p1) {
    let _t671;
    const _t670 = __p1;
    _t672: {
      if (true) {
        const k = _t670[0];
        const v = _t670[1];
        const h_673 = hash_fn(k);
        let _t675;
        if ((h_673 < 0)) {
          _t675 = (0 - h_673);
        } else {
          _t675 = h_673;
        }
        const h_676 = _t675;
        const idx_678 = (h_676 % new_cap_667);
        const bucket_680 = Array$get(tbl.buckets, idx_678);
        Array$set(tbl.buckets, idx_678, ({_hd: [k, v], _tl: bucket_680}));
        const _t681 = (tbl.size = (tbl.size + 1), undefined);
        const _t679 = _t681;
        const _t677 = _t679;
        const _t674 = _t677;
        _t671 = _t674;
        break _t672;
      }
      _match_fail("line 106");
    }
    return _t671;
  }
  const _t668 = List$fold(_t669, undefined, entries_665);
  const _t666 = _t668;
  return _t666;
}
function Hashtbl$set(__dict_Hash_1, __dict_Eq_1, tbl, key, value) {
  const idx_682 = _call(Hashtbl$bucket_index, [__dict_Hash_1, tbl, key]);
  const bucket_684 = Array$get(tbl.buckets, idx_682);
  function replace(__x) {
    let _t687;
    const _t686 = __x;
    _t688: {
      if (_t686 === null) {
        _t687 = ({_hd: [key, value], _tl: null});
        break _t688;
      }
      if (_t686 !== null) {
        const k = _t686._hd[0];
        const v = _t686._hd[1];
        const rest = _t686._tl;
        let _t689;
        if (_call(__dict_Eq_1.$eq, [k, key])) {
          _t689 = ({_hd: [key, value], _tl: rest});
        } else {
          _t689 = ({_hd: [k, v], _tl: replace(rest)});
        }
        _t687 = _t689;
        break _t688;
      }
      _match_fail("line 106");
    }
    return _t687;
  }
  const new_bucket_691 = replace(bucket_684);
  const grew_693 = (List$length(new_bucket_691) > List$length(bucket_684));
  Array$set(tbl.buckets, idx_682, new_bucket_691);
  let _t695;
  if (grew_693) {
    (tbl.size = (tbl.size + 1), undefined);
    let _t696;
    if ((tbl.size > (Array$length(tbl.buckets) * 2))) {
      _t696 = Hashtbl$rehash(tbl, __dict_Hash_1.hash);
    } else {
      _t696 = undefined;
    }
    _t695 = _t696;
  } else {
    _t695 = undefined;
  }
  const _t694 = _t695;
  const _t692 = _t694;
  const _t690 = _t692;
  const _t685 = _t690;
  const _t683 = _t685;
  return _t683;
}
function Hashtbl$get(__dict_Hash_1, __dict_Eq_1, tbl, key) {
  const idx_697 = _call(Hashtbl$bucket_index, [__dict_Hash_1, tbl, key]);
  const bucket_699 = Array$get(tbl.buckets, idx_697);
  function find(__x) {
    while (true) {
      let _t702;
      const _t701 = __x;
      _t703: {
        if (_t701 === null) {
          _t702 = ({_tag: 0, _name: "None"});
          break _t703;
        }
        if (_t701 !== null) {
          const k = _t701._hd[0];
          const v = _t701._hd[1];
          const rest = _t701._tl;
          let _t704;
          if (_call(__dict_Eq_1.$eq, [k, key])) {
            _t704 = ({_tag: 1, _name: "Some", _val: v});
          } else {
            const _t705 = rest;
            __x = _t705;
            continue;
            _t704 = undefined;
          }
          _t702 = _t704;
          break _t703;
        }
        _match_fail("line 106");
      }
      return _t702;
    }
  }
  const _t706 = find(bucket_699);
  const _t700 = _t706;
  const _t698 = _t700;
  return _t698;
}
function Hashtbl$has(__dict_Hash_0, __dict_Eq_0, tbl, key) {
  let _t708;
  const _t707 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, tbl, key]);
  _t709: {
    if (_t707._tag === 1) {
      _t708 = true;
      break _t709;
    }
    if (_t707._tag === 0) {
      _t708 = false;
      break _t709;
    }
    _match_fail("line 106");
  }
  return _t708;
}
function Hashtbl$remove(__dict_Hash_0, __dict_Eq_0, tbl, key) {
  const idx_710 = _call(Hashtbl$bucket_index, [__dict_Hash_0, tbl, key]);
  const bucket_712 = Array$get(tbl.buckets, idx_710);
  function _t714(__p2) {
    let _t716;
    const _t715 = __p2;
    _t717: {
      if (true) {
        const k = _t715[0];
        _t716 = _call(__dict_Eq_0.$lt$gt, [k, key]);
        break _t717;
      }
      _match_fail("line 106");
    }
    return _t716;
  }
  const new_bucket_718 = List$filter(_t714, bucket_712);
  let _t720;
  if ((List$length(new_bucket_718) < List$length(bucket_712))) {
    _t720 = (tbl.size = (tbl.size - 1), undefined);
  } else {
    _t720 = undefined;
  }
  _t720;
  const _t719 = Array$set(tbl.buckets, idx_710, new_bucket_718);
  const _t713 = _t719;
  const _t711 = _t713;
  return _t711;
}
function Hashtbl$find(__dict_Hash_1, __dict_Eq_1, tbl, key) {
  let _t722;
  const _t721 = _call(Hashtbl$get, [__dict_Hash_1, __dict_Eq_1, tbl, key]);
  _t723: {
    if (_t721._tag === 1) {
      const v = _t721._val;
      _t722 = v;
      break _t723;
    }
    if (_t721._tag === 0) {
      _t722 = failwith("Hashtbl.find: key not found");
      break _t723;
    }
    _match_fail("line 106");
  }
  return _t722;
}
function Hashtbl$fold(f, tbl, acc) {
  const entries_724 = Hashtbl$to_list(tbl);
  function _t726(a, __p3) {
    let _t728;
    const _t727 = __p3;
    _t729: {
      if (true) {
        const k = _t727[0];
        const v = _t727[1];
        _t728 = f(k, v, a);
        break _t729;
      }
      _match_fail("line 106");
    }
    return _t728;
  }
  const _t725 = List$fold(_t726, acc, entries_724);
  return _t725;
}
function Hashtbl$iter(f, tbl) {
  const entries_730 = Hashtbl$to_list(tbl);
  function _t732(__p4) {
    let _t734;
    const _t733 = __p4;
    _t735: {
      if (true) {
        const k = _t733[0];
        const v = _t733[1];
        _t734 = f(k, v);
        break _t735;
      }
      _match_fail("line 106");
    }
    return _t734;
  }
  const _t731 = List$iter(_t732, entries_730);
  return _t731;
}
function Hashtbl$keys(tbl) {
  function _t736(__p5) {
    let _t738;
    const _t737 = __p5;
    _t739: {
      if (true) {
        const k = _t737[0];
        _t738 = k;
        break _t739;
      }
      _match_fail("line 106");
    }
    return _t738;
  }
  return List$map(_t736, Hashtbl$to_list(tbl));
}
function Hashtbl$values(tbl) {
  function _t740(__p6) {
    let _t742;
    const _t741 = __p6;
    _t743: {
      if (true) {
        const v = _t741[1];
        _t742 = v;
        break _t743;
      }
      _match_fail("line 106");
    }
    return _t742;
  }
  return List$map(_t740, Hashtbl$to_list(tbl));
}
function Ref$create(v) {
  return ({contents: v});
}
function Ref$get(r) {
  return r.contents;
}
function Ref$set(r, v) {
  return (r.contents = v, undefined);
}
function Dynarray$create(n, _mml$default) {
  let _t744;
  if ((n < 16)) {
    _t744 = 16;
  } else {
    _t744 = n;
  }
  return ({arr: Array$make(_t744, _mml$default), count: 0});
}
function Dynarray$length(d) {
  return d.count;
}
function Dynarray$get(d, i) {
  let _t745;
  if (((i < 0) || (i >= d.count))) {
    _t745 = failwith("Dynarray.get: index out of bounds");
  } else {
    _t745 = Array$get(d.arr, i);
  }
  return _t745;
}
function Dynarray$set(d, i, v) {
  let _t746;
  if (((i < 0) || (i >= d.count))) {
    _t746 = failwith("Dynarray.set: index out of bounds");
  } else {
    _t746 = Array$set(d.arr, i, v);
  }
  return _t746;
}
function Dynarray$grow(d, needed, _mml$default) {
  const cap_747 = Array$length(d.arr);
  let _t749;
  if (((d.count + needed) > cap_747)) {
    const new_cap_750 = Math$max((cap_747 * 2), (d.count + needed));
    const new_arr_752 = Array$make(new_cap_750, _mml$default);
    function copy(i) {
      while (true) {
        let _t754;
        if ((i < d.count)) {
          Array$set(new_arr_752, i, Array$get(d.arr, i));
          const _t755 = (i + 1);
          i = _t755;
          continue;
          _t754 = undefined;
        } else {
          _t754 = undefined;
        }
        return _t754;
      }
    }
    copy(0);
    const _t756 = (d.arr = new_arr_752, undefined);
    const _t753 = _t756;
    const _t751 = _t753;
    _t749 = _t751;
  } else {
    _t749 = undefined;
  }
  const _t748 = _t749;
  return _t748;
}
function Dynarray$empty(_) {
  return ({arr: {_arr: []}, count: 0});
}
function Dynarray$push(d, v) {
  Dynarray$grow(d, 1, v);
  Array$set(d.arr, d.count, v);
  return (d.count = (d.count + 1), undefined);
}
function Dynarray$pop(d) {
  let _t757;
  if ((d.count === 0)) {
    _t757 = failwith("Dynarray.pop: empty");
  } else {
    _t757 = (d.count = (d.count - 1), undefined);
  }
  _t757;
  return Array$get(d.arr, d.count);
}
function Dynarray$clear(d) {
  return (d.count = 0, undefined);
}
function Dynarray$to_list(d) {
  function collect(i, acc) {
    while (true) {
      let _t758;
      if ((i < 0)) {
        _t758 = acc;
      } else {
        const _t759 = (i - 1);
        const _t760 = ({_hd: Dynarray$get(d, i), _tl: acc});
        i = _t759;
        acc = _t760;
        continue;
        _t758 = undefined;
      }
      return _t758;
    }
  }
  const _t761 = collect((d.count - 1), null);
  return _t761;
}
function Dynarray$to_array(d) {
  return Array$sub(d.arr, 0, d.count);
}
function compare(a, b) {
  let _t762;
  if ((a < b)) {
    _t762 = (-1);
  } else {
    let _t763;
    if ((a > b)) {
      _t763 = 1;
    } else {
      _t763 = 0;
    }
    _t762 = _t763;
  }
  return _t762;
}
function int_of_string(s) {
  let _t765;
  const _t764 = String$to_int(s);
  _t766: {
    if (_t764._tag === 1) {
      const n = _t764._val;
      _t765 = n;
      break _t766;
    }
    if (_t764._tag === 0) {
      _t765 = failwith((("int_of_string: invalid argument \"" + __dict_Show_string.show(s)) + "\""));
      break _t766;
    }
    _match_fail("line 27");
  }
  return _t765;
}
function float_of_string(s) {
  let _t768;
  const _t767 = String$to_float(s);
  _t769: {
    if (_t767._tag === 1) {
      const f = _t767._val;
      _t768 = f;
      break _t769;
    }
    if (_t767._tag === 0) {
      _t768 = failwith((("float_of_string: invalid argument \"" + __dict_Show_string.show(s)) + "\""));
      break _t769;
    }
    _match_fail("line 27");
  }
  return _t768;
}
function max(a, b) {
  let _t770;
  if ((a > b)) {
    _t770 = a;
  } else {
    _t770 = b;
  }
  return _t770;
}
function min(a, b) {
  let _t771;
  if ((a < b)) {
    _t771 = a;
  } else {
    _t771 = b;
  }
  return _t771;
}
function fst(__p7) {
  let _t773;
  const _t772 = __p7;
  _t774: {
    if (true) {
      const a = _t772[0];
      _t773 = a;
      break _t774;
    }
    _match_fail("line 27");
  }
  return _t773;
}
function snd(__p8) {
  let _t776;
  const _t775 = __p8;
  _t777: {
    if (true) {
      const b = _t775[1];
      _t776 = b;
      break _t777;
    }
    _match_fail("line 27");
  }
  return _t776;
}
function list_find(f, xs) {
  let _t779;
  const _t778 = List$find(f, xs);
  _t780: {
    if (_t778._tag === 1) {
      const x = _t778._val;
      _t779 = x;
      break _t780;
    }
    if (_t778._tag === 0) {
      _t779 = failwith("list_find: not found");
      break _t780;
    }
    _match_fail("line 27");
  }
  return _t779;
}
if (typeof Runtime$eval === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Runtime.eval"]) var Runtime$eval = globalThis._mmlExterns["Runtime.eval"]; else throw new Error("extern " + "Runtime.eval" + " not provided"); }
if (typeof Runtime$eval_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Runtime.eval_file"]) var Runtime$eval_file = globalThis._mmlExterns["Runtime.eval_file"]; else throw new Error("extern " + "Runtime.eval_file" + " not provided"); }
// --- Compiled MiniML ---
let _last_val;
const Token$dummy_loc = ({col: 0, line: 0, offset: 0});
function Token$pp_token_kind(__x) {
  let _t782;
  const _t781 = __x;
  _t783: {
    if (_t781._tag === 0) {
      const n = _t781._val;
      _t782 = (("INT(" + __dict_Show_int.show(n)) + ")");
      break _t783;
    }
    if (_t781._tag === 1) {
      const f = _t781._val;
      _t782 = (("FLOAT(" + __dict_Show_float.show(f)) + ")");
      break _t783;
    }
    if (_t781._tag === 2) {
      const s = _t781._val;
      _t782 = (("STRING(" + __dict_Show_string.show(s)) + ")");
      break _t783;
    }
    if (_t781._tag === 3) {
      _t782 = "INTERP_STRING";
      break _t783;
    }
    if (_t781._tag === 4) {
      const n = _t781._val;
      _t782 = (("BYTE(#" + __fmt_zero_pad(2, __fmt_hex(n))) + ")");
      break _t783;
    }
    if (_t781._tag === 5) {
      const n = _t781._val;
      _t782 = (("RUNE(" + __dict_Show_int.show(n)) + ")");
      break _t783;
    }
    if (_t781._tag === 6) {
      _t782 = "TRUE";
      break _t783;
    }
    if (_t781._tag === 7) {
      _t782 = "FALSE";
      break _t783;
    }
    if (_t781._tag === 8) {
      const s = _t781._val;
      _t782 = (("IDENT(" + __dict_Show_string.show(s)) + ")");
      break _t783;
    }
    if (_t781._tag === 9) {
      const s = _t781._val;
      _t782 = (("UIDENT(" + __dict_Show_string.show(s)) + ")");
      break _t783;
    }
    if (_t781._tag === 10) {
      const s = _t781._val;
      _t782 = (("TYVAR('" + __dict_Show_string.show(s)) + ")");
      break _t783;
    }
    if (_t781._tag === 11) {
      _t782 = "LET";
      break _t783;
    }
    if (_t781._tag === 12) {
      _t782 = "REC";
      break _t783;
    }
    if (_t781._tag === 13) {
      _t782 = "IN";
      break _t783;
    }
    if (_t781._tag === 14) {
      _t782 = "IF";
      break _t783;
    }
    if (_t781._tag === 15) {
      _t782 = "ELSE";
      break _t783;
    }
    if (_t781._tag === 16) {
      _t782 = "FN";
      break _t783;
    }
    if (_t781._tag === 17) {
      _t782 = "MATCH";
      break _t783;
    }
    if (_t781._tag === 18) {
      _t782 = "WITH";
      break _t783;
    }
    if (_t781._tag === 19) {
      _t782 = "TYPE";
      break _t783;
    }
    if (_t781._tag === 20) {
      _t782 = "OF";
      break _t783;
    }
    if (_t781._tag === 21) {
      _t782 = "CLASS";
      break _t783;
    }
    if (_t781._tag === 22) {
      _t782 = "INSTANCE";
      break _t783;
    }
    if (_t781._tag === 23) {
      _t782 = "EFFECT";
      break _t783;
    }
    if (_t781._tag === 24) {
      _t782 = "EXTERN";
      break _t783;
    }
    if (_t781._tag === 65) {
      _t782 = "PERFORM";
      break _t783;
    }
    if (_t781._tag === 66) {
      _t782 = "HANDLE";
      break _t783;
    }
    if (_t781._tag === 27) {
      _t782 = "TRY";
      break _t783;
    }
    if (_t781._tag === 28) {
      _t782 = "PROVIDE";
      break _t783;
    }
    if (_t781._tag === 29) {
      _t782 = "CONTINUE";
      break _t783;
    }
    if (_t781._tag === 67) {
      _t782 = "RESUME";
      break _t783;
    }
    if (_t781._tag === 44) {
      _t782 = "RETURN";
      break _t783;
    }
    if (_t781._tag === 32) {
      _t782 = "MUT";
      break _t783;
    }
    if (_t781._tag === 33) {
      _t782 = "FOR";
      break _t783;
    }
    if (_t781._tag === 34) {
      _t782 = "DO";
      break _t783;
    }
    if (_t781._tag === 35) {
      _t782 = "BREAK";
      break _t783;
    }
    if (_t781._tag === 36) {
      _t782 = "WHEN";
      break _t783;
    }
    if (_t781._tag === 37) {
      _t782 = "WHERE";
      break _t783;
    }
    if (_t781._tag === 38) {
      _t782 = "PARTIAL";
      break _t783;
    }
    if (_t781._tag === 30) {
      _t782 = "NOT";
      break _t783;
    }
    if (_t781._tag === 40) {
      _t782 = "HASH";
      break _t783;
    }
    if (_t781._tag === 41) {
      _t782 = "FATARROW";
      break _t783;
    }
    if (_t781._tag === 17) {
      _t782 = "MOD";
      break _t783;
    }
    if (_t781._tag === 43) {
      _t782 = "MODULE";
      break _t783;
    }
    if (_t781._tag === 44) {
      _t782 = "PUB";
      break _t783;
    }
    if (_t781._tag === 45) {
      _t782 = "OPEN";
      break _t783;
    }
    if (_t781._tag === 46) {
      _t782 = "END";
      break _t783;
    }
    if (_t781._tag === 47) {
      _t782 = "OPAQUE";
      break _t783;
    }
    if (_t781._tag === 48) {
      _t782 = "WHILE";
      break _t783;
    }
    if (_t781._tag === 49) {
      _t782 = "AND";
      break _t783;
    }
    if (_t781._tag === 50) {
      _t782 = "DERIVING";
      break _t783;
    }
    if (_t781._tag === 51) {
      _t782 = "LPAREN";
      break _t783;
    }
    if (_t781._tag === 52) {
      _t782 = "RPAREN";
      break _t783;
    }
    if (_t781._tag === 53) {
      _t782 = "LBRACE";
      break _t783;
    }
    if (_t781._tag === 54) {
      _t782 = "RBRACE";
      break _t783;
    }
    if (_t781._tag === 55) {
      _t782 = "LBRACKET";
      break _t783;
    }
    if (_t781._tag === 56) {
      _t782 = "RBRACKET";
      break _t783;
    }
    if (_t781._tag === 57) {
      _t782 = "ARROW";
      break _t783;
    }
    if (_t781._tag === 58) {
      _t782 = "COMMA";
      break _t783;
    }
    if (_t781._tag === 59) {
      _t782 = "SEMICOLON";
      break _t783;
    }
    if (_t781._tag === 60) {
      _t782 = "DOUBLE_SEMICOLON";
      break _t783;
    }
    if (_t781._tag === 61) {
      _t782 = "COLON";
      break _t783;
    }
    if (_t781._tag === 62) {
      _t782 = "DOT";
      break _t783;
    }
    if (_t781._tag === 63) {
      _t782 = "DOTDOT";
      break _t783;
    }
    if (_t781._tag === 64) {
      _t782 = "PIPE";
      break _t783;
    }
    if (_t781._tag === 65) {
      _t782 = "PIPEARROW";
      break _t783;
    }
    if (_t781._tag === 66) {
      _t782 = "UNDERSCORE";
      break _t783;
    }
    if (_t781._tag === 67) {
      _t782 = "PLUS";
      break _t783;
    }
    if (_t781._tag === 68) {
      _t782 = "MINUS";
      break _t783;
    }
    if (_t781._tag === 69) {
      _t782 = "STAR";
      break _t783;
    }
    if (_t781._tag === 70) {
      _t782 = "SLASH";
      break _t783;
    }
    if (_t781._tag === 71) {
      _t782 = "CARET";
      break _t783;
    }
    if (_t781._tag === 72) {
      _t782 = "COLONCOLON";
      break _t783;
    }
    if (_t781._tag === 73) {
      _t782 = "COLONEQUAL";
      break _t783;
    }
    if (_t781._tag === 24) {
      _t782 = "EQ";
      break _t783;
    }
    if (_t781._tag === 25) {
      _t782 = "NEQ";
      break _t783;
    }
    if (_t781._tag === 26) {
      _t782 = "LT";
      break _t783;
    }
    if (_t781._tag === 27) {
      _t782 = "GT";
      break _t783;
    }
    if (_t781._tag === 28) {
      _t782 = "LE";
      break _t783;
    }
    if (_t781._tag === 29) {
      _t782 = "GE";
      break _t783;
    }
    if (_t781._tag === 80) {
      _t782 = "AMPAMP";
      break _t783;
    }
    if (_t781._tag === 81) {
      _t782 = "PIPEPIPE";
      break _t783;
    }
    if (_t781._tag === 82) {
      _t782 = "LAND";
      break _t783;
    }
    if (_t781._tag === 83) {
      _t782 = "LOR";
      break _t783;
    }
    if (_t781._tag === 84) {
      _t782 = "LXOR";
      break _t783;
    }
    if (_t781._tag === 85) {
      _t782 = "LNOT";
      break _t783;
    }
    if (_t781._tag === 86) {
      _t782 = "LSL";
      break _t783;
    }
    if (_t781._tag === 87) {
      _t782 = "LSR";
      break _t783;
    }
    if (_t781._tag === 88) {
      const s = _t781._val;
      _t782 = (("POLYTAG(`" + __dict_Show_string.show(s)) + ")");
      break _t783;
    }
    if (_t781._tag === 89) {
      _t782 = "COLONGT";
      break _t783;
    }
    if (_t781._tag === 90) {
      _t782 = "EOF";
      break _t783;
    }
    _match_fail("line 16190");
  }
  return _t782;
}
function Token$pp_token(t) {
  return ((((__dict_Show_string.show(Token$pp_token_kind(t.kind)) + "@") + __dict_Show_int.show(t.loc.line)) + ":") + __dict_Show_int.show(t.loc.col));
}
function Bytecode$make_record_shape(field_names) {
  const fields_784 = Array$of_list(field_names);
  const index_786 = Hashtbl$create(Array$length(fields_784));
  function _t788(i, name) {
    return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, index_786, name, i]);
  }
  Array$iteri(_t788, fields_784);
  const _t787 = ({rs_fields: fields_784, rs_index: index_786});
  const _t785 = _t787;
  return _t785;
}
function Bytecode$make_record(field_names, values) {
  const shape_789 = Bytecode$make_record_shape(field_names);
  const _t790 = ({_tag: 9, _name: "VRecord", _val: [shape_789, values]});
  return _t790;
}
function Bytecode$pp_value(__x) {
  let _t792;
  const _t791 = __x;
  _t793: {
    if (_t791._tag === 0) {
      const n = _t791._val;
      _t792 = string_of_int(n);
      break _t793;
    }
    if (_t791._tag === 1) {
      const f = _t791._val;
      const s_794 = __dict_Show_float.show(f);
      let _t796;
      if ((String$contains(".", s_794) || String$contains("e", s_794))) {
        _t796 = s_794;
      } else {
        _t796 = (s_794 + ".");
      }
      const _t795 = _t796;
      _t792 = _t795;
      break _t793;
    }
    if (_t791._tag === 2 && _t791._val) {
      _t792 = "true";
      break _t793;
    }
    if (_t791._tag === 2 && !_t791._val) {
      _t792 = "false";
      break _t793;
    }
    if (_t791._tag === 3) {
      const s = _t791._val;
      _t792 = s;
      break _t793;
    }
    if (_t791._tag === 4) {
      const n = _t791._val;
      _t792 = ("#" + __fmt_zero_pad(2, __fmt_hex(n)));
      break _t793;
    }
    if (_t791._tag === 5) {
      const cp = _t791._val;
      let _t797;
      if ((cp < 128)) {
        _t797 = (("'" + __dict_Show_byte.show(Byte$of_int(cp))) + "'");
      } else {
        const buf_798 = Buffer$create(6);
        Buffer$add_byte(buf_798, 39);
        let _t800;
        if ((cp < 2048)) {
          Buffer$add_byte(buf_798, Byte$of_int((192 | (cp >> 6))));
          _t800 = Buffer$add_byte(buf_798, Byte$of_int((128 | (cp & 63))));
        } else {
          let _t801;
          if ((cp < 65536)) {
            Buffer$add_byte(buf_798, Byte$of_int((224 | (cp >> 12))));
            Buffer$add_byte(buf_798, Byte$of_int((128 | ((cp >> 6) & 63))));
            _t801 = Buffer$add_byte(buf_798, Byte$of_int((128 | (cp & 63))));
          } else {
            Buffer$add_byte(buf_798, Byte$of_int((240 | (cp >> 18))));
            Buffer$add_byte(buf_798, Byte$of_int((128 | ((cp >> 12) & 63))));
            Buffer$add_byte(buf_798, Byte$of_int((128 | ((cp >> 6) & 63))));
            _t801 = Buffer$add_byte(buf_798, Byte$of_int((128 | (cp & 63))));
          }
          _t800 = _t801;
        }
        _t800;
        Buffer$add_byte(buf_798, 39);
        const _t799 = Buffer$contents(buf_798);
        _t797 = _t799;
      }
      _t792 = _t797;
      break _t793;
    }
    if (_t791._tag === 6) {
      _t792 = "()";
      break _t793;
    }
    if (_t791._tag === 7) {
      const vs = _t791._val;
      _t792 = ("(" + (String$concat(", ", Array$to_list(Array$map(Bytecode$pp_value, vs))) + ")"));
      break _t793;
    }
    if (_t791._tag === 8) {
      const vs = _t791._val;
      _t792 = ("[" + (String$concat("; ", List$map(Bytecode$pp_value, vs)) + "]"));
      break _t793;
    }
    if (_t791._tag === 9) {
      const shape = _t791._val[0];
      const values = _t791._val[1];
      function _t802(i) {
        return (Array$get(shape.rs_fields, i) + (" = " + Bytecode$pp_value(Array$get(values, i))));
      }
      _t792 = ("{ " + (String$concat("; ", List$init(Array$length(shape.rs_fields), _t802)) + " }"));
      break _t793;
    }
    if (_t791._tag === 10 && _t791._val[2]._tag === 0) {
      const name = _t791._val[1];
      _t792 = name;
      break _t793;
    }
    if (_t791._tag === 10 && _t791._val[2]._tag === 1) {
      const name = _t791._val[1];
      const v = _t791._val[2]._val;
      let _t804;
      const _t803 = v;
      _t805: {
        if ((_t803._tag === 7 || _t803._tag === 10 && _t803._val[2]._tag === 1)) {
          _t804 = ("(" + (Bytecode$pp_value(v) + ")"));
          break _t805;
        }
        if (true) {
          _t804 = Bytecode$pp_value(v);
          break _t805;
        }
        _match_fail("line 16190");
      }
      _t792 = (name + (" " + _t804));
      break _t793;
    }
    if (_t791._tag === 11) {
      _t792 = "<fun>";
      break _t793;
    }
    if (_t791._tag === 12) {
      _t792 = "<fun>";
      break _t793;
    }
    if (_t791._tag === 14) {
      const ext = _t791._val;
      let _t806;
      if (_eq(ext.ext_args, null)) {
        _t806 = (("<external:" + __dict_Show_string.show(ext.ext_name)) + ">");
      } else {
        _t806 = "<fun>";
      }
      _t792 = _t806;
      break _t793;
    }
    if (_t791._tag === 13) {
      const p = _t791._val;
      _t792 = (("<proto:" + __dict_Show_string.show(p.name)) + ">");
      break _t793;
    }
    if (_t791._tag === 15) {
      _t792 = "<continuation>";
      break _t793;
    }
    if (_t791._tag === 16) {
      const r = _t791._val;
      _t792 = (("ref(" + __dict_Show_string.show(Bytecode$pp_value(Ref$get(r)))) + ")");
      break _t793;
    }
    if (_t791._tag === 17) {
      const pairs = _t791._val;
      function _t807(__p9) {
        let _t809;
        const _t808 = __p9;
        _t810: {
          if (true) {
            const v = _t808[1];
            _t809 = _eq(v, ({_tag: 6, _name: "VUnit"}));
            break _t810;
          }
          _match_fail("line 16190");
        }
        return _t809;
      }
      const is_set_811 = List$forall(_t807, pairs);
      let _t813;
      if (is_set_811) {
        function _t814(__p10) {
          let _t816;
          const _t815 = __p10;
          _t817: {
            if (true) {
              const k = _t815[0];
              _t816 = Bytecode$pp_value(k);
              break _t817;
            }
            _match_fail("line 16190");
          }
          return _t816;
        }
        _t813 = ("#{" + (String$concat("; ", List$map(_t814, pairs)) + "}"));
      } else {
        function _t818(__p11) {
          let _t820;
          const _t819 = __p11;
          _t821: {
            if (true) {
              const k = _t819[0];
              const v = _t819[1];
              _t820 = (Bytecode$pp_value(k) + (": " + Bytecode$pp_value(v)));
              break _t821;
            }
            _match_fail("line 16190");
          }
          return _t820;
        }
        _t813 = ("#{" + (String$concat("; ", List$map(_t818, pairs)) + "}"));
      }
      const _t812 = _t813;
      _t792 = _t812;
      break _t793;
    }
    if (_t791._tag === 18) {
      const arr = _t791._val;
      _t792 = ("#[" + (String$concat("; ", Array$to_list(Array$map(Bytecode$pp_value, arr))) + "]"));
      break _t793;
    }
    _match_fail("line 16190");
  }
  return _t792;
}
function Bytecode$pp_capture(__x) {
  let _t823;
  const _t822 = __x;
  _t824: {
    if (_t822._tag === 0) {
      const i = _t822._val;
      _t823 = (("local(" + __dict_Show_int.show(i)) + ")");
      break _t824;
    }
    if (_t822._tag === 1) {
      const i = _t822._val;
      _t823 = (("upvalue(" + __dict_Show_int.show(i)) + ")");
      break _t824;
    }
    _match_fail("line 16190");
  }
  return _t823;
}
function Bytecode$pp_opcode(__x) {
  let _t826;
  const _t825 = __x;
  _t827: {
    if (_t825._tag === 0) {
      const i = _t825._val;
      _t826 = ("CONST " + __dict_Show_int.show(i));
      break _t827;
    }
    if (_t825._tag === 1) {
      _t826 = "POP";
      break _t827;
    }
    if (_t825._tag === 2) {
      _t826 = "DUP";
      break _t827;
    }
    if (_t825._tag === 3) {
      const i = _t825._val;
      _t826 = ("GET_LOCAL " + __dict_Show_int.show(i));
      break _t827;
    }
    if (_t825._tag === 4) {
      const i = _t825._val;
      _t826 = ("SET_LOCAL " + __dict_Show_int.show(i));
      break _t827;
    }
    if (_t825._tag === 5) {
      const i = _t825._val;
      _t826 = ("GET_UPVALUE " + __dict_Show_int.show(i));
      break _t827;
    }
    if (_t825._tag === 6) {
      const i = _t825._val;
      _t826 = ("SET_UPVALUE " + __dict_Show_int.show(i));
      break _t827;
    }
    if (_t825._tag === 7) {
      _t826 = "MAKE_REF";
      break _t827;
    }
    if (_t825._tag === 8) {
      _t826 = "DEREF";
      break _t827;
    }
    if (_t825._tag === 9) {
      _t826 = "SET_REF";
      break _t827;
    }
    if (_t825._tag === 10) {
      const i = _t825._val;
      _t826 = ("GET_GLOBAL " + __dict_Show_int.show(i));
      break _t827;
    }
    if (_t825._tag === 11) {
      const i = _t825._val;
      _t826 = ("SET_GLOBAL " + __dict_Show_int.show(i));
      break _t827;
    }
    if (_t825._tag === 12) {
      const i = _t825._val;
      _t826 = ("DEF_GLOBAL " + __dict_Show_int.show(i));
      break _t827;
    }
    if (_t825._tag === 13) {
      _t826 = "ADD";
      break _t827;
    }
    if (_t825._tag === 14) {
      _t826 = "SUB";
      break _t827;
    }
    if (_t825._tag === 15) {
      _t826 = "MUL";
      break _t827;
    }
    if (_t825._tag === 16) {
      _t826 = "DIV";
      break _t827;
    }
    if (_t825._tag === 17) {
      _t826 = "MOD";
      break _t827;
    }
    if (_t825._tag === 18) {
      _t826 = "NEG";
      break _t827;
    }
    if (_t825._tag === 19) {
      _t826 = "FADD";
      break _t827;
    }
    if (_t825._tag === 20) {
      _t826 = "FSUB";
      break _t827;
    }
    if (_t825._tag === 21) {
      _t826 = "FMUL";
      break _t827;
    }
    if (_t825._tag === 22) {
      _t826 = "FDIV";
      break _t827;
    }
    if (_t825._tag === 23) {
      _t826 = "FNEG";
      break _t827;
    }
    if (_t825._tag === 24) {
      _t826 = "EQ";
      break _t827;
    }
    if (_t825._tag === 25) {
      _t826 = "NEQ";
      break _t827;
    }
    if (_t825._tag === 26) {
      _t826 = "LT";
      break _t827;
    }
    if (_t825._tag === 27) {
      _t826 = "GT";
      break _t827;
    }
    if (_t825._tag === 28) {
      _t826 = "LE";
      break _t827;
    }
    if (_t825._tag === 29) {
      _t826 = "GE";
      break _t827;
    }
    if (_t825._tag === 30) {
      _t826 = "NOT";
      break _t827;
    }
    if (_t825._tag === 31) {
      _t826 = "BAND";
      break _t827;
    }
    if (_t825._tag === 32) {
      _t826 = "BOR";
      break _t827;
    }
    if (_t825._tag === 33) {
      _t826 = "BXOR";
      break _t827;
    }
    if (_t825._tag === 34) {
      _t826 = "BNOT";
      break _t827;
    }
    if (_t825._tag === 35) {
      _t826 = "BSHL";
      break _t827;
    }
    if (_t825._tag === 36) {
      _t826 = "BSHR";
      break _t827;
    }
    if (_t825._tag === 37) {
      const off = _t825._val;
      _t826 = ("JUMP " + __dict_Show_int.show(off));
      break _t827;
    }
    if (_t825._tag === 38) {
      const off = _t825._val;
      _t826 = ("JUMP_IF_FALSE " + __dict_Show_int.show(off));
      break _t827;
    }
    if (_t825._tag === 39) {
      const off = _t825._val;
      _t826 = ("JUMP_IF_TRUE " + __dict_Show_int.show(off));
      break _t827;
    }
    if (_t825._tag === 40) {
      const i = _t825._val[0];
      const caps = _t825._val[1];
      _t826 = (((("CLOSURE " + __dict_Show_int.show(i)) + " [") + __dict_Show_string.show(String$concat(", ", List$map(Bytecode$pp_capture, caps)))) + "]");
      break _t827;
    }
    if (_t825._tag === 41) {
      const i = _t825._val[0];
      const caps = _t825._val[1];
      const self = _t825._val[2];
      _t826 = ((((("CLOSURE_REC " + __dict_Show_int.show(i)) + " [") + __dict_Show_string.show(String$concat(", ", List$map(Bytecode$pp_capture, caps)))) + "] self=") + __dict_Show_int.show(self));
      break _t827;
    }
    if (_t825._tag === 42) {
      const n = _t825._val;
      _t826 = ("CALL " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 43) {
      const n = _t825._val;
      _t826 = ("TAIL_CALL " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 44) {
      _t826 = "RETURN";
      break _t827;
    }
    if (_t825._tag === 45) {
      _t826 = "FUNC_RETURN";
      break _t827;
    }
    if (_t825._tag === 46) {
      _t826 = "ENTER_FUNC";
      break _t827;
    }
    if (_t825._tag === 47) {
      _t826 = "EXIT_FUNC";
      break _t827;
    }
    if (_t825._tag === 48) {
      const n = _t825._val;
      _t826 = ("MAKE_TUPLE " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 49) {
      const i = _t825._val;
      _t826 = ("TUPLE_GET " + __dict_Show_int.show(i));
      break _t827;
    }
    if (_t825._tag === 50) {
      const fields = _t825._val;
      _t826 = (("MAKE_RECORD [" + __dict_Show_string.show(String$concat(", ", fields))) + "]");
      break _t827;
    }
    if (_t825._tag === 51) {
      const name = _t825._val;
      _t826 = ("FIELD " + __dict_Show_string.show(name));
      break _t827;
    }
    if (_t825._tag === 52) {
      const name = _t825._val;
      _t826 = ("SET_FIELD " + __dict_Show_string.show(name));
      break _t827;
    }
    if (_t825._tag === 53) {
      const fields = _t825._val;
      _t826 = (("RECORD_UPDATE [" + __dict_Show_string.show(String$concat(", ", fields))) + "]");
      break _t827;
    }
    if (_t825._tag === 54) {
      const n = _t825._val;
      _t826 = ("RECORD_UPDATE_DYN " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 55) {
      const tag = _t825._val[0];
      const name = _t825._val[1];
      const has_payload = _t825._val[2];
      _t826 = ((((("MAKE_VARIANT " + __dict_Show_int.show(tag)) + " ") + __dict_Show_string.show(name)) + " ") + __dict_Show_bool.show(has_payload));
      break _t827;
    }
    if (_t825._tag === 56) {
      _t826 = "CONS";
      break _t827;
    }
    if (_t825._tag === 57) {
      _t826 = "NIL";
      break _t827;
    }
    if (_t825._tag === 58) {
      const tag = _t825._val;
      _t826 = ("TAG_EQ " + __dict_Show_int.show(tag));
      break _t827;
    }
    if (_t825._tag === 59) {
      _t826 = "IS_NIL";
      break _t827;
    }
    if (_t825._tag === 60) {
      _t826 = "IS_CONS";
      break _t827;
    }
    if (_t825._tag === 61) {
      _t826 = "HEAD";
      break _t827;
    }
    if (_t825._tag === 62) {
      _t826 = "TAIL";
      break _t827;
    }
    if (_t825._tag === 63) {
      _t826 = "VARIANT_PAYLOAD";
      break _t827;
    }
    if (_t825._tag === 64) {
      const loc = _t825._val;
      _t826 = ("MATCH_FAIL " + __dict_Show_string.show(loc));
      break _t827;
    }
    if (_t825._tag === 65) {
      const op = _t825._val;
      _t826 = ("PERFORM " + __dict_Show_string.show(op));
      break _t827;
    }
    if (_t825._tag === 66) {
      const n = _t825._val;
      _t826 = ("HANDLE " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 67) {
      _t826 = "RESUME";
      break _t827;
    }
    if (_t825._tag === 68) {
      const n = _t825._val;
      _t826 = ("ENTER_LOOP " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 69) {
      _t826 = "EXIT_LOOP";
      break _t827;
    }
    if (_t825._tag === 70) {
      _t826 = "LOOP_BREAK";
      break _t827;
    }
    if (_t825._tag === 71) {
      const n = _t825._val;
      _t826 = ("LOOP_CONTINUE " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 72) {
      const n = _t825._val;
      _t826 = ("FOLD_CONTINUE " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 73) {
      const n = _t825._val;
      _t826 = ("MAKE_MAP " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 74) {
      const n = _t825._val;
      _t826 = ("MAKE_ARRAY " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 75) {
      _t826 = "INDEX";
      break _t827;
    }
    if (_t825._tag === 76) {
      _t826 = "HALT";
      break _t827;
    }
    if (_t825._tag === 77) {
      const slot = _t825._val[0];
      const arity = _t825._val[1];
      _t826 = ((("GET_LOCAL_CALL " + __dict_Show_int.show(slot)) + " ") + __dict_Show_int.show(arity));
      break _t827;
    }
    if (_t825._tag === 78) {
      const slot = _t825._val[0];
      const idx = _t825._val[1];
      _t826 = ((("GET_LOCAL_TUPLE_GET " + __dict_Show_int.show(slot)) + " ") + __dict_Show_int.show(idx));
      break _t827;
    }
    if (_t825._tag === 79) {
      const slot = _t825._val[0];
      const name = _t825._val[1];
      _t826 = ((("GET_LOCAL_FIELD " + __dict_Show_int.show(slot)) + " ") + __dict_Show_string.show(name));
      break _t827;
    }
    if (_t825._tag === 80) {
      const idx = _t825._val[0];
      const arity = _t825._val[1];
      _t826 = ((("GET_GLOBAL_CALL " + __dict_Show_int.show(idx)) + " ") + __dict_Show_int.show(arity));
      break _t827;
    }
    if (_t825._tag === 81) {
      const idx = _t825._val[0];
      const name = _t825._val[1];
      _t826 = ((("GET_GLOBAL_FIELD " + __dict_Show_int.show(idx)) + " ") + __dict_Show_string.show(name));
      break _t827;
    }
    if (_t825._tag === 82) {
      const min_tag = _t825._val[0];
      const targets = _t825._val[1];
      const _mml$default = _t825._val[2];
      _t826 = ((((("JUMP_TABLE min=" + __dict_Show_int.show(min_tag)) + " [") + __dict_Show_string.show(String$concat(",", Array$to_list(Array$map(string_of_int, targets))))) + "] default=") + __dict_Show_int.show(_mml$default));
      break _t827;
    }
    if (_t825._tag === 83) {
      const n = _t825._val;
      _t826 = ("CALL_N " + __dict_Show_int.show(n));
      break _t827;
    }
    if (_t825._tag === 84) {
      const n = _t825._val;
      _t826 = ("TAIL_CALL_N " + __dict_Show_int.show(n));
      break _t827;
    }
    _match_fail("line 16190");
  }
  return _t826;
}
function Bytecode$disassemble(__dict_Show_2, __dict_Show_1, __dict_Show_0, __ev_arity_r0, __ev_code_r0, __ev_line_table_r0, __ev_name_r0, __ev_num_locals_r0, proto) {
  const buf_828 = Buffer$create(256);
  Buffer$add_string(buf_828, (((((("=== " + __dict_Show_2.show(proto.name)) + " (arity=") + __dict_Show_1.show(proto.arity)) + ", locals=") + __dict_Show_0.show(proto.num_locals)) + ") ===\n"));
  const prev_line_830 = Ref$create(0);
  function _t832(i, op) {
    let _t833;
    if ((i < Array$length(proto.line_table))) {
      _t833 = Array$get(proto.line_table, i);
    } else {
      _t833 = 0;
    }
    const line_834 = _t833;
    let _t836;
    if (((line_834 > 0) && (line_834 !== Ref$get(prev_line_830)))) {
      Ref$set(prev_line_830, line_834);
      _t836 = __dict_Show_int.show(line_834);
    } else {
      _t836 = "   |";
    }
    const line_str_837 = _t836;
    const _t838 = Buffer$add_string(buf_828, (((((__dict_Show_string.show(line_str_837) + " ") + __fmt_zero_pad(4, __dict_Show_int.show(i))) + "  ") + __dict_Show_string.show(Bytecode$pp_opcode(op))) + "\n"));
    const _t835 = _t838;
    return _t835;
  }
  Array$iteri(_t832, proto.code);
  const _t831 = Buffer$contents(buf_828);
  const _t829 = _t831;
  return _t829;
}
function Types$mono(ty) {
  return ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: 0, record_evidences: null, rquant: 0});
}
const Types$next_id = Ref$create(0);
function Types$fresh_id(_) {
  const id_839 = Ref$get(Types$next_id);
  Ref$set(Types$next_id, (id_839 + 1));
  const _t840 = id_839;
  return _t840;
}
function Types$new_tvar(level) {
  return ({_tag: 16, _name: "TVar", _val: Ref$create(({_tag: 0, _name: "Unbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$new_effvar(level) {
  return ({_tag: 0, _name: "EffVar", _val: Ref$create(({_tag: 0, _name: "EffUnbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$new_pvvar(level) {
  return ({_tag: 1, _name: "PVVar", _val: Ref$create(({_tag: 0, _name: "PVUnbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$new_rvar(level) {
  return ({_tag: 1, _name: "RVar", _val: Ref$create(({_tag: 0, _name: "RUnbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$repr(__x) {
  let _t842;
  const _t841 = __x;
  _t843: {
    if (_t841._tag === 16 && _t841._val.contents._tag === 1) {
      const ty = _t841._val.contents._val;
      const r = _t841._val;
      const ty_844 = Types$repr(ty);
      Ref$set(r, ({_tag: 1, _name: "Link", _val: ty_844}));
      const _t845 = ty_844;
      _t842 = _t845;
      break _t843;
    }
    if (true) {
      const ty = _t841;
      _t842 = ty;
      break _t843;
    }
    _match_fail("line 16190");
  }
  return _t842;
}
function Types$is_concrete(ty) {
  while (true) {
    let _t847;
    const _t846 = Types$repr(ty);
    _t848: {
      if (_t846._tag === 16 && _t846._val.contents._tag === 0) {
        _t847 = false;
        break _t848;
      }
      if (_t846._tag === 16 && _t846._val.contents._tag === 1) {
        _t847 = failwith("assert false");
        break _t848;
      }
      if ((_t846._tag === 7 || _t846._tag === 8)) {
        const a = _t846._val[0];
        const eff = _t846._val[1];
        const r = _t846._val[2];
        _t847 = (Types$is_concrete(a) && (Types$is_concrete_eff(eff) && Types$is_concrete(r)));
        break _t848;
      }
      if (_t846._tag === 9) {
        const ts = _t846._val;
        _t847 = List$forall(Types$is_concrete, ts);
        break _t848;
      }
      if ((_t846._tag === 10 || _t846._tag === 14)) {
        const t = _t846._val;
        const _t849 = t;
        ty = _t849;
        continue;
        _t847 = undefined;
        break _t848;
      }
      if (_t846._tag === 13) {
        const k = _t846._val[0];
        const v = _t846._val[1];
        _t847 = (Types$is_concrete(k) && Types$is_concrete(v));
        break _t848;
      }
      if (_t846._tag === 12) {
        const args = _t846._val[1];
        _t847 = List$forall(Types$is_concrete, args);
        break _t848;
      }
      if ((((((((_t846._tag === 0 || _t846._tag === 1) || _t846._tag === 2) || _t846._tag === 3) || _t846._tag === 4) || _t846._tag === 5) || _t846._tag === 6) || _t846._tag === 17)) {
        _t847 = true;
        break _t848;
      }
      if (_t846._tag === 11) {
        const row = _t846._val;
        _t847 = Types$is_concrete_rrow(row);
        break _t848;
      }
      if (_t846._tag === 15) {
        const row = _t846._val;
        _t847 = Types$is_concrete_pv(row);
        break _t848;
      }
      _match_fail("line 16190");
    }
    return _t847;
  }
}
function Types$is_concrete_eff(__x) {
  while (true) {
    let _t851;
    const _t850 = __x;
    _t852: {
      if (_t850._tag === 0 && _t850._val.contents._tag === 1) {
        const eff = _t850._val.contents._val;
        const _t853 = eff;
        __x = _t853;
        continue;
        _t851 = undefined;
        break _t852;
      }
      if (_t850._tag === 0 && _t850._val.contents._tag === 0) {
        _t851 = false;
        break _t852;
      }
      if (_t850._tag === 2) {
        const tys = _t850._val[1];
        const tail = _t850._val[2];
        _t851 = (List$forall(Types$is_concrete, tys) && Types$is_concrete_eff(tail));
        break _t852;
      }
      if (_t850._tag === 1) {
        _t851 = true;
        break _t852;
      }
      if (_t850._tag === 3) {
        _t851 = true;
        break _t852;
      }
      _match_fail("line 16190");
    }
    return _t851;
  }
}
function Types$is_concrete_rrow(__x) {
  while (true) {
    let _t855;
    const _t854 = __x;
    _t856: {
      if (_t854._tag === 0) {
        const ty = _t854._val[1];
        const tail = _t854._val[2];
        _t855 = (Types$is_concrete(ty) && Types$is_concrete_rrow(tail));
        break _t856;
      }
      if (_t854._tag === 1 && _t854._val.contents._tag === 1) {
        const row = _t854._val.contents._val;
        const _t857 = row;
        __x = _t857;
        continue;
        _t855 = undefined;
        break _t856;
      }
      if (_t854._tag === 1 && _t854._val.contents._tag === 0) {
        _t855 = false;
        break _t856;
      }
      if (_t854._tag === 2) {
        _t855 = true;
        break _t856;
      }
      if ((_t854._tag === 3 || _t854._tag === 4)) {
        _t855 = true;
        break _t856;
      }
      _match_fail("line 16190");
    }
    return _t855;
  }
}
function Types$is_concrete_pv(__x) {
  while (true) {
    let _t859;
    const _t858 = __x;
    _t860: {
      if (_t858._tag === 0 && _t858._val[1]._tag === 1) {
        const ty = _t858._val[1]._val;
        const tail = _t858._val[2];
        _t859 = (Types$is_concrete(ty) && Types$is_concrete_pv(tail));
        break _t860;
      }
      if (_t858._tag === 0 && _t858._val[1]._tag === 0) {
        const tail = _t858._val[2];
        const _t861 = tail;
        __x = _t861;
        continue;
        _t859 = undefined;
        break _t860;
      }
      if (_t858._tag === 1 && _t858._val.contents._tag === 1) {
        const row = _t858._val.contents._val;
        const _t862 = row;
        __x = _t862;
        continue;
        _t859 = undefined;
        break _t860;
      }
      if (_t858._tag === 1 && _t858._val.contents._tag === 0) {
        _t859 = false;
        break _t860;
      }
      if (_t858._tag === 2) {
        _t859 = true;
        break _t860;
      }
      if (_t858._tag === 3) {
        _t859 = true;
        break _t860;
      }
      _match_fail("line 16190");
    }
    return _t859;
  }
}
function Types$eff_repr(__x) {
  let _t864;
  const _t863 = __x;
  _t865: {
    if (_t863._tag === 0 && _t863._val.contents._tag === 1) {
      const eff = _t863._val.contents._val;
      const r = _t863._val;
      const eff_866 = Types$eff_repr(eff);
      Ref$set(r, ({_tag: 1, _name: "EffLink", _val: eff_866}));
      const _t867 = eff_866;
      _t864 = _t867;
      break _t865;
    }
    if (true) {
      const eff = _t863;
      _t864 = eff;
      break _t865;
    }
    _match_fail("line 16190");
  }
  return _t864;
}
function Types$pv_repr(__x) {
  let _t869;
  const _t868 = __x;
  _t870: {
    if (_t868._tag === 1 && _t868._val.contents._tag === 1) {
      const row = _t868._val.contents._val;
      const r = _t868._val;
      const row_871 = Types$pv_repr(row);
      Ref$set(r, ({_tag: 1, _name: "PVLink", _val: row_871}));
      const _t872 = row_871;
      _t869 = _t872;
      break _t870;
    }
    if (true) {
      const row = _t868;
      _t869 = row;
      break _t870;
    }
    _match_fail("line 16190");
  }
  return _t869;
}
function Types$rrow_repr(__x) {
  let _t874;
  const _t873 = __x;
  _t875: {
    if (_t873._tag === 1 && _t873._val.contents._tag === 1) {
      const row = _t873._val.contents._val;
      const r = _t873._val;
      const row_876 = Types$rrow_repr(row);
      Ref$set(r, ({_tag: 1, _name: "RLink", _val: row_876}));
      const _t877 = row_876;
      _t874 = _t877;
      break _t875;
    }
    if (true) {
      const row = _t873;
      _t874 = row;
      break _t875;
    }
    _match_fail("line 16190");
  }
  return _t874;
}
function Types$fields_to_closed_row(fields) {
  function _t878(__p12, acc) {
    let _t880;
    const _t879 = __p12;
    _t881: {
      if (true) {
        const n = _t879[0];
        const t = _t879[1];
        _t880 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
        break _t881;
      }
      _match_fail("line 16190");
    }
    return _t880;
  }
  return List$fold_right(_t878, fields, ({_tag: 2, _name: "REmpty"}));
}
function Types$record_row_to_fields(row) {
  function collect(r) {
    let _t883;
    const _t882 = Types$rrow_repr(r);
    _t884: {
      if (_t882._tag === 0) {
        const n = _t882._val[0];
        const t = _t882._val[1];
        const tail = _t882._val[2];
        _t883 = ({_hd: [n, t], _tl: collect(tail)});
        break _t884;
      }
      if (true) {
        _t883 = null;
        break _t884;
      }
      _match_fail("line 16190");
    }
    return _t883;
  }
  const _t885 = collect(row);
  return _t885;
}
const Types$empty_type_env = ({classes: null, constructors: null, effects: null, instances: null, modules: null, mutable_fields: null, records: null, type_aliases: null, type_synonyms: null, variants: null});
function Types$find_effect_op(type_env, op_name) {
  function _t886(edef) {
    function _t887(__p13) {
      let _t889;
      const _t888 = __p13;
      _t890: {
        if (true) {
          const name = _t888[0];
          const ty = _t888[1];
          let _t891;
          if ((name === op_name)) {
            _t891 = ({_tag: 1, _name: "Some", _val: [edef.effect_name, ty]});
          } else {
            _t891 = ({_tag: 0, _name: "None"});
          }
          _t889 = _t891;
          break _t890;
        }
        _match_fail("line 16190");
      }
      return _t889;
    }
    return List$find_map(_t887, edef.effect_ops);
  }
  return List$find_map(_t886, type_env.effects);
}
function Types$ty_to_str(__x) {
  let _t893;
  const _t892 = __x;
  _t894: {
    if (_t892._tag === 0) {
      _t893 = "int";
      break _t894;
    }
    if (_t892._tag === 1) {
      _t893 = "float";
      break _t894;
    }
    if (_t892._tag === 2) {
      _t893 = "bool";
      break _t894;
    }
    if (_t892._tag === 3) {
      _t893 = "string";
      break _t894;
    }
    if (_t892._tag === 4) {
      _t893 = "byte";
      break _t894;
    }
    if (_t892._tag === 5) {
      _t893 = "rune";
      break _t894;
    }
    if (_t892._tag === 6) {
      _t893 = "unit";
      break _t894;
    }
    if (_t892._tag === 12 && _t892._val[1] === null) {
      const name = _t892._val[0];
      _t893 = name;
      break _t894;
    }
    if (_t892._tag === 12) {
      const name = _t892._val[0];
      const args = _t892._val[1];
      _t893 = (String$concat("_", List$map(Types$ty_to_str, args)) + ("_" + name));
      break _t894;
    }
    if (_t892._tag === 10) {
      const t = _t892._val;
      _t893 = (Types$ty_to_str(t) + "_list");
      break _t894;
    }
    if (_t892._tag === 13) {
      const k = _t892._val[0];
      const v = _t892._val[1];
      _t893 = (Types$ty_to_str(k) + ("_" + (Types$ty_to_str(v) + "_map")));
      break _t894;
    }
    if (_t892._tag === 14) {
      const t = _t892._val;
      _t893 = (Types$ty_to_str(t) + "_array");
      break _t894;
    }
    if (_t892._tag === 9) {
      const ts = _t892._val;
      _t893 = (String$concat("_", List$map(Types$ty_to_str, ts)) + "_tup");
      break _t894;
    }
    if (_t892._tag === 15) {
      _t893 = "polyvar";
      break _t894;
    }
    if (_t892._tag === 17) {
      const i = _t892._val;
      _t893 = ("g" + __dict_Show_int.show(i));
      break _t894;
    }
    if ((_t892._tag === 7 || _t892._tag === 8)) {
      _t893 = "arrow";
      break _t894;
    }
    if (_t892._tag === 16) {
      _t893 = "tvar";
      break _t894;
    }
    if (true) {
      _t893 = "ty_other";
      break _t894;
    }
    _match_fail("line 16190");
  }
  return _t893;
}
function Types$dict_name(__dict_Show_0, class_name, tys) {
  const ty_strs_895 = List$map(Types$ty_to_str, tys);
  const _t896 = ((("__dict_" + __dict_Show_0.show(class_name)) + "_") + __dict_Show_string.show(String$concat("__", ty_strs_895)));
  return _t896;
}
function Types$find_method_class(classes, method_name) {
  function _t897(cls) {
    function _t898(__p14) {
      let _t900;
      const _t899 = __p14;
      _t901: {
        if (true) {
          const m = _t899[0];
          _t900 = (m === method_name);
          break _t901;
        }
        _match_fail("line 16190");
      }
      return _t900;
    }
    return List$exists(_t898, cls.class_methods);
  }
  return List$find(_t897, classes);
}
function Types$occurs_check(id, level, ty) {
  return _trampoline(function() {
    const _t902 = Types$repr(ty);
    let _t903 = false;
    if (!_t903 && _t902._tag === 16 && _t902._val.contents._tag === 0) {
      const id2 = _t902._val.contents._val[0];
      if ((id === id2)) {
        _t903 = true;
        return _h["unify_error"]("occurs check: infinite type", function(_t904) {
          return _bounce(function() {
            return _t904;
          });
        });
      }
    }
    if (!_t903 && _t902._tag === 16 && _t902._val.contents._tag === 0) {
      const id2 = _t902._val.contents._val[0];
      const level2 = _t902._val.contents._val[1];
      const r = _t902._val;
      _t903 = true;
      let _t905;
      if ((level2 > level)) {
        _t905 = Ref$set(r, ({_tag: 0, _name: "Unbound", _val: [id2, level]}));
      } else {
        _t905 = undefined;
      }
      return _t905;
    }
    if (!_t903 && _t902._tag === 16 && _t902._val.contents._tag === 1) {
      _t903 = true;
      return failwith("assert false");
    }
    if (!_t903 && (_t902._tag === 7 || _t902._tag === 8)) {
      const a = _t902._val[0];
      const eff = _t902._val[1];
      const b = _t902._val[2];
      _t903 = true;
      Types$occurs_check(id, level, a);
      Types$occurs_check_eff_for_ty(id, level, eff);
      return Types$occurs_check(id, level, b);
    }
    if (!_t903 && _t902._tag === 9) {
      const ts = _t902._val;
      _t903 = true;
      return List$iter(_call(Types$occurs_check, [id, level]), ts);
    }
    if (!_t903 && _t902._tag === 10) {
      const t = _t902._val;
      _t903 = true;
      return Types$occurs_check(id, level, t);
    }
    if (!_t903 && _t902._tag === 14) {
      const t = _t902._val;
      _t903 = true;
      return Types$occurs_check(id, level, t);
    }
    if (!_t903 && _t902._tag === 13) {
      const k = _t902._val[0];
      const v = _t902._val[1];
      _t903 = true;
      Types$occurs_check(id, level, k);
      return Types$occurs_check(id, level, v);
    }
    if (!_t903 && _t902._tag === 11) {
      const row = _t902._val;
      _t903 = true;
      return Types$occurs_check_rrow_for_ty(id, level, row);
    }
    if (!_t903 && _t902._tag === 12) {
      const args = _t902._val[1];
      _t903 = true;
      return List$iter(_call(Types$occurs_check, [id, level]), args);
    }
    if (!_t903 && _t902._tag === 15) {
      const row = _t902._val;
      _t903 = true;
      return Types$occurs_check_pv_for_ty(id, level, row);
    }
    if (!_t903 && (((((((_t902._tag === 0 || _t902._tag === 1) || _t902._tag === 2) || _t902._tag === 3) || _t902._tag === 4) || _t902._tag === 5) || _t902._tag === 6) || _t902._tag === 17)) {
      _t903 = true;
      return undefined;
    }
    if (!_t903) _match_fail("line 16190");
  }, Types$occurs_check);
}
function Types$occurs_check_pv_for_ty(id, level, row) {
  while (true) {
    let _t907;
    const _t906 = Types$pv_repr(row);
    _t908: {
      if (_t906._tag === 0) {
        const ty_opt = _t906._val[1];
        const tail = _t906._val[2];
        let _t910;
        const _t909 = ty_opt;
        _t911: {
          if (_t909._tag === 1) {
            const t = _t909._val;
            _t910 = Types$occurs_check(id, level, t);
            break _t911;
          }
          if (_t909._tag === 0) {
            _t910 = undefined;
            break _t911;
          }
          _match_fail("line 16190");
        }
        _t910;
        const _t912 = id;
        const _t913 = level;
        const _t914 = tail;
        id = _t912;
        level = _t913;
        row = _t914;
        continue;
        _t907 = undefined;
        break _t908;
      }
      if (true) {
        _t907 = undefined;
        break _t908;
      }
      _match_fail("line 16190");
    }
    return _t907;
  }
}
function Types$occurs_check_rrow_for_ty(id, level, row) {
  while (true) {
    let _t916;
    const _t915 = Types$rrow_repr(row);
    _t917: {
      if (_t915._tag === 0) {
        const ty = _t915._val[1];
        const tail = _t915._val[2];
        Types$occurs_check(id, level, ty);
        const _t918 = id;
        const _t919 = level;
        const _t920 = tail;
        id = _t918;
        level = _t919;
        row = _t920;
        continue;
        _t916 = undefined;
        break _t917;
      }
      if (true) {
        _t916 = undefined;
        break _t917;
      }
      _match_fail("line 16190");
    }
    return _t916;
  }
}
function Types$occurs_check_eff_for_ty(id, level, eff) {
  while (true) {
    let _t922;
    const _t921 = Types$eff_repr(eff);
    _t923: {
      if (_t921._tag === 2) {
        const params = _t921._val[1];
        const tail = _t921._val[2];
        List$iter(_call(Types$occurs_check, [id, level]), params);
        const _t924 = id;
        const _t925 = level;
        const _t926 = tail;
        id = _t924;
        level = _t925;
        eff = _t926;
        continue;
        _t922 = undefined;
        break _t923;
      }
      if (true) {
        _t922 = undefined;
        break _t923;
      }
      _match_fail("line 16190");
    }
    return _t922;
  }
}
function Types$occurs_check_eff(id, level, eff) {
  return _trampoline(function() {
    const _t927 = Types$eff_repr(eff);
    let _t928 = false;
    if (!_t928 && _t927._tag === 0 && _t927._val.contents._tag === 0) {
      const id2 = _t927._val.contents._val[0];
      if ((id === id2)) {
        _t928 = true;
        return _h["unify_error"]("occurs check: infinite effect row", function(_t929) {
          return _bounce(function() {
            return _t929;
          });
        });
      }
    }
    if (!_t928 && _t927._tag === 0 && _t927._val.contents._tag === 0) {
      const id2 = _t927._val.contents._val[0];
      const level2 = _t927._val.contents._val[1];
      const r = _t927._val;
      _t928 = true;
      let _t930;
      if ((level2 > level)) {
        _t930 = Ref$set(r, ({_tag: 0, _name: "EffUnbound", _val: [id2, level]}));
      } else {
        _t930 = undefined;
      }
      return _t930;
    }
    if (!_t928 && _t927._tag === 0 && _t927._val.contents._tag === 1) {
      _t928 = true;
      return failwith("assert false");
    }
    if (!_t928 && _t927._tag === 2) {
      const _params = _t927._val[1];
      const tail = _t927._val[2];
      _t928 = true;
      return Types$occurs_check_eff(id, level, tail);
    }
    if (!_t928 && (_t927._tag === 1 || _t927._tag === 3)) {
      _t928 = true;
      return undefined;
    }
    if (!_t928) _match_fail("line 16190");
  }, Types$occurs_check_eff);
}
function Types$occurs_check_pv(id, level, row) {
  return _trampoline(function() {
    const _t931 = Types$pv_repr(row);
    let _t932 = false;
    if (!_t932 && _t931._tag === 1 && _t931._val.contents._tag === 0) {
      const id2 = _t931._val.contents._val[0];
      if ((id === id2)) {
        _t932 = true;
        return _h["unify_error"]("occurs check: infinite polymorphic variant row", function(_t933) {
          return _bounce(function() {
            return _t933;
          });
        });
      }
    }
    if (!_t932 && _t931._tag === 1 && _t931._val.contents._tag === 0) {
      const id2 = _t931._val.contents._val[0];
      const level2 = _t931._val.contents._val[1];
      const r = _t931._val;
      _t932 = true;
      let _t934;
      if ((level2 > level)) {
        _t934 = Ref$set(r, ({_tag: 0, _name: "PVUnbound", _val: [id2, level]}));
      } else {
        _t934 = undefined;
      }
      return _t934;
    }
    if (!_t932 && _t931._tag === 1 && _t931._val.contents._tag === 1) {
      _t932 = true;
      return failwith("assert false");
    }
    if (!_t932 && _t931._tag === 0) {
      const ty_opt = _t931._val[1];
      const tail = _t931._val[2];
      _t932 = true;
      let _t936;
      const _t935 = ty_opt;
      _t937: {
        if (_t935._tag === 1) {
          const t = _t935._val;
          _t936 = Types$occurs_check(id, level, t);
          break _t937;
        }
        if (_t935._tag === 0) {
          _t936 = undefined;
          break _t937;
        }
        _match_fail("line 16190");
      }
      _t936;
      return Types$occurs_check_pv(id, level, tail);
    }
    if (!_t932 && (_t931._tag === 2 || _t931._tag === 3)) {
      _t932 = true;
      return undefined;
    }
    if (!_t932) _match_fail("line 16190");
  }, Types$occurs_check_pv);
}
function Types$occurs_check_rrow(id, level, row) {
  return _trampoline(function() {
    const _t938 = Types$rrow_repr(row);
    let _t939 = false;
    if (!_t939 && _t938._tag === 1 && _t938._val.contents._tag === 0) {
      const id2 = _t938._val.contents._val[0];
      if ((id === id2)) {
        _t939 = true;
        return _h["unify_error"]("occurs check: infinite record row", function(_t940) {
          return _bounce(function() {
            return _t940;
          });
        });
      }
    }
    if (!_t939 && _t938._tag === 1 && _t938._val.contents._tag === 0) {
      const id2 = _t938._val.contents._val[0];
      const level2 = _t938._val.contents._val[1];
      const r = _t938._val;
      _t939 = true;
      let _t941;
      if ((level2 > level)) {
        _t941 = Ref$set(r, ({_tag: 0, _name: "RUnbound", _val: [id2, level]}));
      } else {
        _t941 = undefined;
      }
      return _t941;
    }
    if (!_t939 && _t938._tag === 1 && _t938._val.contents._tag === 1) {
      _t939 = true;
      return failwith("assert false");
    }
    if (!_t939 && _t938._tag === 0) {
      const ty = _t938._val[1];
      const tail = _t938._val[2];
      _t939 = true;
      Types$occurs_check(id, level, ty);
      return Types$occurs_check_rrow(id, level, tail);
    }
    if (!_t939 && ((_t938._tag === 2 || _t938._tag === 3) || _t938._tag === 4)) {
      _t939 = true;
      return undefined;
    }
    if (!_t939) _match_fail("line 16190");
  }, Types$occurs_check_rrow);
}
const Types$pp_synonyms = Ref$create(null);
function _t942(_) {
  return "?";
}
const Types$pp_ty_arg_ref = Ref$create(_t942);
function Types$try_match_synonym(ty) {
  const synonyms_943 = Ref$get(Types$pp_synonyms);
  let _t945;
  if (_eq(synonyms_943, null)) {
    _t945 = ({_tag: 0, _name: "None"});
  } else {
    function _t946(__p15) {
      let _t948;
      const _t947 = __p15;
      _t949: {
        if (true) {
          const name = _t947[0];
          const num_params = _t947[1];
          const pattern = _t947[2];
          const bindings_950 = Array$make(num_params, ({_tag: 0, _name: "None"}));
          function go(pat, actual) {
            while (true) {
              const actual_952 = Types$repr(actual);
              let _t955;
              const _t954 = [pat, actual_952];
              _t956: {
                if (_t954[0]._tag === 17) {
                  const i = _t954[0]._val;
                  if ((i < num_params)) {
                    let _t958;
                    const _t957 = Array$get(bindings_950, i);
                    _t959: {
                      if (_t957._tag === 0) {
                        Array$set(bindings_950, i, ({_tag: 1, _name: "Some", _val: actual_952}));
                        _t958 = true;
                        break _t959;
                      }
                      if (_t957._tag === 1) {
                        const prev = _t957._val;
                        _t958 = _eq(prev, actual_952);
                        break _t959;
                      }
                      _match_fail("line 16190");
                    }
                    _t955 = _t958;
                    break _t956;
                  }
                }
                if (((((((_t954[0]._tag === 0 && _t954[1]._tag === 0 || _t954[0]._tag === 1 && _t954[1]._tag === 1) || _t954[0]._tag === 2 && _t954[1]._tag === 2) || _t954[0]._tag === 3 && _t954[1]._tag === 3) || _t954[0]._tag === 6 && _t954[1]._tag === 6) || _t954[0]._tag === 4 && _t954[1]._tag === 4) || _t954[0]._tag === 5 && _t954[1]._tag === 5)) {
                  _t955 = true;
                  break _t956;
                }
                if ((_t954[0]._tag === 7 && _t954[1]._tag === 7 || _t954[0]._tag === 8 && _t954[1]._tag === 8)) {
                  const p1 = _t954[0]._val[0];
                  const _pe = _t954[0]._val[1];
                  const p2 = _t954[0]._val[2];
                  const a1 = _t954[1]._val[0];
                  const _ae = _t954[1]._val[1];
                  const a2 = _t954[1]._val[2];
                  _t955 = (go(p1, a1) && go(p2, a2));
                  break _t956;
                }
                if (_t954[0]._tag === 10 && _t954[1]._tag === 10) {
                  const p1 = _t954[0]._val;
                  const a1 = _t954[1]._val;
                  const _t960 = p1;
                  const _t961 = a1;
                  pat = _t960;
                  actual = _t961;
                  continue;
                  _t955 = undefined;
                  break _t956;
                }
                if (_t954[0]._tag === 14 && _t954[1]._tag === 14) {
                  const p1 = _t954[0]._val;
                  const a1 = _t954[1]._val;
                  const _t962 = p1;
                  const _t963 = a1;
                  pat = _t962;
                  actual = _t963;
                  continue;
                  _t955 = undefined;
                  break _t956;
                }
                if (_t954[0]._tag === 13 && _t954[1]._tag === 13) {
                  const pk = _t954[0]._val[0];
                  const pv = _t954[0]._val[1];
                  const ak = _t954[1]._val[0];
                  const av = _t954[1]._val[1];
                  _t955 = (go(pk, ak) && go(pv, av));
                  break _t956;
                }
                if (_t954[0]._tag === 9 && _t954[1]._tag === 9) {
                  const ps = _t954[0]._val;
                  const acts = _t954[1]._val;
                  if ((List$length(ps) === List$length(acts))) {
                    _t955 = List$forall2(go, ps, acts);
                    break _t956;
                  }
                }
                if (_t954[0]._tag === 12 && _t954[1]._tag === 12) {
                  const pn = _t954[0]._val[0];
                  const ps = _t954[0]._val[1];
                  const an = _t954[1]._val[0];
                  const acts = _t954[1]._val[1];
                  if (((pn === an) && (List$length(ps) === List$length(acts)))) {
                    _t955 = List$forall2(go, ps, acts);
                    break _t956;
                  }
                }
                if (_t954[0]._tag === 16 && _t954[1]._tag === 16) {
                  const r1 = _t954[0]._val;
                  const r2 = _t954[1]._val;
                  if (_eq(r1, r2)) {
                    _t955 = true;
                    break _t956;
                  }
                }
                if (_t954[0]._tag === 17 && _t954[1]._tag === 17) {
                  const i = _t954[0]._val;
                  const j = _t954[1]._val;
                  if ((i === j)) {
                    _t955 = true;
                    break _t956;
                  }
                }
                if (true) {
                  _t955 = false;
                  break _t956;
                }
                _match_fail("line 16190");
              }
              const _t953 = _t955;
              return _t953;
            }
          }
          let _t966;
          if (go(pattern, ty)) {
          function _t965(x) {
            return !_eq(x, ({_tag: 0, _name: "None"}));
          }
            _t966 = Array$forall(_t965, bindings_950);
          } else {
            _t966 = false;
          }
          let _t967;
          if (_t966) {
            function _t968(x) {
              return Option$unwrap(x);
            }
            _t967 = ({_tag: 1, _name: "Some", _val: [name, Array$to_list(Array$map(_t968, bindings_950))]});
          } else {
            _t967 = ({_tag: 0, _name: "None"});
          }
          const _t964 = _t967;
          const _t951 = _t964;
          _t948 = _t951;
          break _t949;
        }
        _match_fail("line 16190");
      }
      return _t948;
    }
    _t945 = List$find_map(_t946, synonyms_943);
  }
  const _t944 = _t945;
  return _t944;
}
function Types$pp_eff(eff) {
  let _t970;
  const _t969 = Types$eff_repr(eff);
  _t971: {
    if (_t969._tag === 1) {
      _t970 = "";
      break _t971;
    }
    if (_t969._tag === 0 && _t969._val.contents._tag === 0) {
      const id = _t969._val.contents._val[0];
      _t970 = ("'" + String$make(1, Byte$of_int((Byte$to_int(101) + (id % 22)))));
      break _t971;
    }
    if (_t969._tag === 2) {
      const label = _t969._val[0];
      const params = _t969._val[1];
      const tail = _t969._val[2];
      let _t973;
      const _t972 = params;
      _t974: {
        if (_t972 === null) {
          _t973 = "";
          break _t974;
        }
        if (true) {
          const ps = _t972;
          _t973 = (" " + String$concat(" ", List$map(_call(Ref$get, [Types$pp_ty_arg_ref]), ps)));
          break _t974;
        }
        _match_fail("line 16190");
      }
      const param_str_975 = _t973;
      let _t978;
      const _t977 = Types$eff_repr(tail);
      _t979: {
        if (_t977._tag === 1) {
          _t978 = "";
          break _t979;
        }
        if (_t977._tag === 0 && _t977._val.contents._tag === 0) {
          _t978 = (", " + Types$pp_eff(tail));
          break _t979;
        }
        if (_t977._tag === 2) {
          _t978 = (", " + Types$pp_eff(tail));
          break _t979;
        }
        if (true) {
          _t978 = "";
          break _t979;
        }
        _match_fail("line 16190");
      }
      const tail_str_980 = _t978;
      const _t981 = (label + (param_str_975 + tail_str_980));
      const _t976 = _t981;
      _t970 = _t976;
      break _t971;
    }
    if (_t969._tag === 3) {
      const id = _t969._val;
      _t970 = ("'" + String$make(1, Byte$of_int((Byte$to_int(101) + (id % 22)))));
      break _t971;
    }
    if (_t969._tag === 0 && _t969._val.contents._tag === 1) {
      _t970 = failwith("assert false");
      break _t971;
    }
    _match_fail("line 16190");
  }
  return _t970;
}
function Types$eff_is_trivial(eff) {
  let _t983;
  const _t982 = Types$eff_repr(eff);
  _t984: {
    if (_t982._tag === 1) {
      _t983 = true;
      break _t984;
    }
    if (_t982._tag === 0 && _t982._val.contents._tag === 0) {
      _t983 = true;
      break _t984;
    }
    if (_t982._tag === 3) {
      _t983 = true;
      break _t984;
    }
    if (true) {
      _t983 = false;
      break _t984;
    }
    _match_fail("line 16190");
  }
  return _t983;
}
function Types$pp_ty(ty) {
  const ty_985 = Types$repr(ty);
  let _t988;
  const _t987 = Types$try_match_synonym(ty_985);
  _t989: {
    if (_t987._tag === 1) {
      const name = _t987._val[0];
      const args = _t987._val[1];
      let _t991;
      const _t990 = ty_985;
      _t992: {
        if ((_t990._tag === 7 || _t990._tag === 8)) {
          const a = _t990._val[0];
          if (!_eq(Types$try_match_synonym(Types$repr(a)), ({_tag: 0, _name: "None"}))) {
            _t991 = Types$pp_ty_raw(ty_985);
            break _t992;
          }
        }
        if (true) {
          _t991 = Types$pp_type_con(name, args);
          break _t992;
        }
        _match_fail("line 16190");
      }
      _t988 = _t991;
      break _t989;
    }
    if (_t987._tag === 0) {
      _t988 = Types$pp_ty_raw(ty_985);
      break _t989;
    }
    _match_fail("line 16190");
  }
  const _t986 = _t988;
  return _t986;
}
function Types$pp_type_con(name, __x) {
  let _t994;
  const _t993 = __x;
  _t995: {
    if (_t993 === null) {
      _t994 = name;
      break _t995;
    }
    if (_t993 !== null && _t993._tl === null) {
      const arg = _t993._hd;
      let _t997;
      const _t996 = Types$repr(arg);
      _t998: {
        if (((_t996._tag === 7 || _t996._tag === 8) || _t996._tag === 9)) {
          _t997 = ("(" + (Types$pp_ty(arg) + ")"));
          break _t998;
        }
        if (true) {
          _t997 = Types$pp_ty(arg);
          break _t998;
        }
        _match_fail("line 16190");
      }
      _t994 = (_t997 + (" " + name));
      break _t995;
    }
    if (true) {
      const args = _t993;
      _t994 = ("(" + (String$concat(", ", List$map(Types$pp_ty, args)) + (") " + name)));
      break _t995;
    }
    _match_fail("line 16190");
  }
  return _t994;
}
function Types$needs_parens(ty) {
  const ty_999 = Types$repr(ty);
  let _t1002;
  const _t1001 = Types$try_match_synonym(ty_999);
  _t1003: {
    if (_t1001._tag === 1) {
      _t1002 = false;
      break _t1003;
    }
    if (_t1001._tag === 0) {
      let _t1005;
      const _t1004 = ty_999;
      _t1006: {
        if (((_t1004._tag === 7 || _t1004._tag === 8) || _t1004._tag === 9)) {
          _t1005 = true;
          break _t1006;
        }
        if (true) {
          _t1005 = false;
          break _t1006;
        }
        _match_fail("line 16190");
      }
      _t1002 = _t1005;
      break _t1003;
    }
    _match_fail("line 16190");
  }
  const _t1000 = _t1002;
  return _t1000;
}
function Types$pp_ty_arg(ty) {
  let _t1007;
  if (Types$needs_parens(ty)) {
    _t1007 = ("(" + (Types$pp_ty(ty) + ")"));
  } else {
    _t1007 = Types$pp_ty(ty);
  }
  return _t1007;
}
function Types$pp_ty_raw(ty) {
  let _t1009;
  const _t1008 = ty;
  _t1010: {
    if (_t1008._tag === 0) {
      _t1009 = "int";
      break _t1010;
    }
    if (_t1008._tag === 1) {
      _t1009 = "float";
      break _t1010;
    }
    if (_t1008._tag === 2) {
      _t1009 = "bool";
      break _t1010;
    }
    if (_t1008._tag === 3) {
      _t1009 = "string";
      break _t1010;
    }
    if (_t1008._tag === 4) {
      _t1009 = "byte";
      break _t1010;
    }
    if (_t1008._tag === 5) {
      _t1009 = "rune";
      break _t1010;
    }
    if (_t1008._tag === 6) {
      _t1009 = "unit";
      break _t1010;
    }
    if (_t1008._tag === 7) {
      const a = _t1008._val[0];
      const eff = _t1008._val[1];
      const r = _t1008._val[2];
      let _t1012;
      const _t1011 = Types$repr(a);
      _t1013: {
        if (_t1011._tag === 7) {
          if (_eq(Types$try_match_synonym(Types$repr(a)), ({_tag: 0, _name: "None"}))) {
            _t1012 = ("(" + (Types$pp_ty(a) + ")"));
            break _t1013;
          }
        }
        if (true) {
          _t1012 = Types$pp_ty(a);
          break _t1013;
        }
        _match_fail("line 16190");
      }
      const a_str_1014 = _t1012;
      let _t1016;
      if (Types$eff_is_trivial(eff)) {
        _t1016 = (a_str_1014 + (" -> " + Types$pp_ty(r)));
      } else {
        _t1016 = (a_str_1014 + (" -> " + (Types$pp_ty(r) + (" / " + Types$pp_eff(eff)))));
      }
      const _t1015 = _t1016;
      _t1009 = _t1015;
      break _t1010;
    }
    if (_t1008._tag === 8) {
      const a = _t1008._val[0];
      const eff = _t1008._val[1];
      const r = _t1008._val[2];
      let _t1018;
      const _t1017 = Types$repr(a);
      _t1019: {
        if ((_t1017._tag === 7 || _t1017._tag === 8)) {
          if (_eq(Types$try_match_synonym(Types$repr(a)), ({_tag: 0, _name: "None"}))) {
            _t1018 = ("(" + (Types$pp_ty(a) + ")"));
            break _t1019;
          }
        }
        if (true) {
          _t1018 = Types$pp_ty(a);
          break _t1019;
        }
        _match_fail("line 16190");
      }
      const a_str_1020 = _t1018;
      let _t1022;
      if (Types$eff_is_trivial(eff)) {
        _t1022 = (a_str_1020 + (" -> " + Types$pp_ty(r)));
      } else {
        _t1022 = (a_str_1020 + (" -> " + (Types$pp_ty(r) + (" / " + Types$pp_eff(eff)))));
      }
      const _t1021 = _t1022;
      const inner_1023 = _t1021;
      const _t1024 = ("continuation(" + (inner_1023 + ")"));
      _t1009 = _t1024;
      break _t1010;
    }
    if (_t1008._tag === 9) {
      const ts = _t1008._val;
      function _t1025(t) {
        let _t1027;
        const _t1026 = Types$repr(t);
        _t1028: {
          if ((_t1026._tag === 7 || _t1026._tag === 8)) {
            if (_eq(Types$try_match_synonym(Types$repr(t)), ({_tag: 0, _name: "None"}))) {
              _t1027 = ("(" + (Types$pp_ty(t) + ")"));
              break _t1028;
            }
          }
          if (true) {
            _t1027 = Types$pp_ty(t);
            break _t1028;
          }
          _match_fail("line 16190");
        }
        return _t1027;
      }
      _t1009 = String$concat(" * ", List$map(_t1025, ts));
      break _t1010;
    }
    if (_t1008._tag === 10) {
      const t = _t1008._val;
      _t1009 = (Types$pp_ty_arg(t) + " list");
      break _t1010;
    }
    if (_t1008._tag === 13) {
      const k = _t1008._val[0];
      const v = _t1008._val[1];
      _t1009 = ("(" + (Types$pp_ty(k) + (", " + (Types$pp_ty(v) + ") map"))));
      break _t1010;
    }
    if (_t1008._tag === 14) {
      const t = _t1008._val;
      _t1009 = (Types$pp_ty_arg(t) + " array");
      break _t1010;
    }
    if (_t1008._tag === 11) {
      const row = _t1008._val;
      function collect(r) {
        let _t1030;
        const _t1029 = Types$rrow_repr(r);
        _t1031: {
          if (_t1029._tag === 0) {
            const name = _t1029._val[0];
            const ty = _t1029._val[1];
            const tail = _t1029._val[2];
            _t1030 = ({_hd: [name, ty], _tl: collect(tail)});
            break _t1031;
          }
          if (true) {
            _t1030 = null;
            break _t1031;
          }
          _match_fail("line 16190");
        }
        return _t1030;
      }
      function is_open(r) {
        while (true) {
          let _t1034;
          const _t1033 = Types$rrow_repr(r);
          _t1035: {
            if (_t1033._tag === 0) {
              const tail = _t1033._val[2];
              const _t1036 = tail;
              r = _t1036;
              continue;
              _t1034 = undefined;
              break _t1035;
            }
            if (((_t1033._tag === 1 && _t1033._val.contents._tag === 0 || _t1033._tag === 3) || _t1033._tag === 4)) {
              _t1034 = true;
              break _t1035;
            }
            if (true) {
              _t1034 = false;
              break _t1035;
            }
            _match_fail("line 16190");
          }
          return _t1034;
        }
      }
      function _t1038(__p16) {
        let _t1040;
        const _t1039 = __p16;
        _t1041: {
          if (true) {
            const n = _t1039[0];
            const t = _t1039[1];
            _t1040 = (n + (": " + Types$pp_ty(t)));
            break _t1041;
          }
          _match_fail("line 16190");
        }
        return _t1040;
      }
      const fields_str_1042 = String$concat("; ", List$map(_t1038, collect(row)));
      let _t1044;
      if (is_open(row)) {
        let _t1045;
        if ((fields_str_1042 === "")) {
          _t1045 = "..";
        } else {
          _t1045 = "; ..";
        }
        _t1044 = ("{ " + (fields_str_1042 + (_t1045 + " }")));
      } else {
        _t1044 = ("{ " + (fields_str_1042 + " }"));
      }
      const _t1043 = _t1044;
      const _t1037 = _t1043;
      const _t1032 = _t1037;
      _t1009 = _t1032;
      break _t1010;
    }
    if (_t1008._tag === 12 && _t1008._val[1] === null) {
      const name = _t1008._val[0];
      _t1009 = name;
      break _t1010;
    }
    if (_t1008._tag === 12 && _t1008._val[1] !== null && _t1008._val[1]._tl === null) {
      const name = _t1008._val[0];
      const arg = _t1008._val[1]._hd;
      _t1009 = (Types$pp_ty_arg(arg) + (" " + name));
      break _t1010;
    }
    if (_t1008._tag === 12) {
      const name = _t1008._val[0];
      const args = _t1008._val[1];
      _t1009 = ("(" + (String$concat(", ", List$map(Types$pp_ty, args)) + (") " + name)));
      break _t1010;
    }
    if (_t1008._tag === 15) {
      const row = _t1008._val;
      function collect_tags(r) {
        let _t1047;
        const _t1046 = Types$pv_repr(r);
        _t1048: {
          if (_t1046._tag === 0) {
            const tag = _t1046._val[0];
            const ty_opt = _t1046._val[1];
            const tail = _t1046._val[2];
            _t1047 = ({_hd: [tag, ty_opt], _tl: collect_tags(tail)});
            break _t1048;
          }
          if (true) {
            _t1047 = null;
            break _t1048;
          }
          _match_fail("line 16190");
        }
        return _t1047;
      }
      let _t1051;
      const _t1050 = Types$pv_repr(row);
      _t1052: {
        if (_t1050._tag === 1) {
          _t1051 = true;
          break _t1052;
        }
        if (_t1050._tag === 0) {
          function check(r) {
            while (true) {
              let _t1054;
              const _t1053 = Types$pv_repr(r);
              _t1055: {
                if (_t1053._tag === 0) {
                  const tail = _t1053._val[2];
                  const _t1056 = tail;
                  r = _t1056;
                  continue;
                  _t1054 = undefined;
                  break _t1055;
                }
                if (_t1053._tag === 1) {
                  _t1054 = true;
                  break _t1055;
                }
                if (true) {
                  _t1054 = false;
                  break _t1055;
                }
                _match_fail("line 16190");
              }
              return _t1054;
            }
          }
          const _t1057 = check(row);
          _t1051 = _t1057;
          break _t1052;
        }
        if (true) {
          _t1051 = false;
          break _t1052;
        }
        _match_fail("line 16190");
      }
      const is_open_1058 = _t1051;
      const tags_1060 = collect_tags(row);
      function _t1062(__p17) {
        let _t1064;
        const _t1063 = __p17;
        _t1065: {
          if (true) {
            const tag = _t1063[0];
            const ty_opt = _t1063[1];
            let _t1067;
            const _t1066 = ty_opt;
            _t1068: {
              if (_t1066._tag === 0) {
                _t1067 = ("`" + tag);
                break _t1068;
              }
              if (_t1066._tag === 1) {
                const t = _t1066._val;
                _t1067 = ("`" + (tag + (" of " + Types$pp_ty(t))));
                break _t1068;
              }
              _match_fail("line 16190");
            }
            _t1064 = _t1067;
            break _t1065;
          }
          _match_fail("line 16190");
        }
        return _t1064;
      }
      const tag_strs_1069 = List$map(_t1062, tags_1060);
      let _t1071;
      if (is_open_1058) {
        _t1071 = "> ";
      } else {
        _t1071 = "";
      }
      const marker_1072 = _t1071;
      const _t1073 = ("[" + (marker_1072 + (String$concat(" | ", tag_strs_1069) + "]")));
      const _t1070 = _t1073;
      const _t1061 = _t1070;
      const _t1059 = _t1061;
      const _t1049 = _t1059;
      _t1009 = _t1049;
      break _t1010;
    }
    if (_t1008._tag === 16 && _t1008._val.contents._tag === 0) {
      const id = _t1008._val.contents._val[0];
      _t1009 = ("'" + String$make(1, Byte$of_int((Byte$to_int(97) + (id % 26)))));
      break _t1010;
    }
    if (_t1008._tag === 16 && _t1008._val.contents._tag === 1) {
      _t1009 = failwith("assert false");
      break _t1010;
    }
    if (_t1008._tag === 17) {
      const id = _t1008._val;
      _t1009 = ("'" + String$make(1, Byte$of_int((Byte$to_int(97) + (id % 26)))));
      break _t1010;
    }
    _match_fail("line 16190");
  }
  return _t1009;
}
const Types$__destruct = Ref$set(Types$pp_ty_arg_ref, Types$pp_ty_arg);
function Types$unify_error(t1, t2) {
  return _trampoline(function() {
    return _h["unify_error"](((("cannot unify " + __dict_Show_string.show(Types$pp_ty(t1))) + " with ") + __dict_Show_string.show(Types$pp_ty(t2))), function(_t1074) {
      return _bounce(function() {
        return _t1074;
      });
    });
  }, Types$unify_error);
}
function Types$unify_eff(e1, e2) {
  return _trampoline(function() {
    const e1_1075 = _resolve(Types$eff_repr(e1));
    const e2_1076 = _resolve(Types$eff_repr(e2));
    if (_eq(e1_1075, e2_1076)) {
      return undefined;
    } else {
      const _t1077 = [e1_1075, e2_1076];
      let _t1078 = false;
      if (!_t1078 && (_t1077[0]._tag === 0 && _t1077[0]._val.contents._tag === 0 || _t1077[1]._tag === 0 && _t1077[1]._val.contents._tag === 0)) {
        const id = (_t1077[0]._tag === 0 && _t1077[0]._val.contents._tag === 0 ? _t1077[0]._val.contents._val[0] : _t1077[1]._val.contents._val[0]);
        const level = (_t1077[0]._tag === 0 && _t1077[0]._val.contents._tag === 0 ? _t1077[0]._val.contents._val[1] : _t1077[1]._val.contents._val[1]);
        const r = (_t1077[0]._tag === 0 && _t1077[0]._val.contents._tag === 0 ? _t1077[0]._val : _t1077[1]._val);
        const eff = (_t1077[0]._tag === 0 && _t1077[0]._val.contents._tag === 0 ? _t1077[1] : _t1077[0]);
        _t1078 = true;
        Types$occurs_check_eff(id, level, eff);
        return Ref$set(r, ({_tag: 1, _name: "EffLink", _val: eff}));
      }
      if (!_t1078 && _t1077[0]._tag === 1 && _t1077[1]._tag === 1) {
        _t1078 = true;
        return undefined;
      }
      if (!_t1078 && _t1077[0]._tag === 2 && _t1077[1]._tag === 2) {
        const label1 = _t1077[0]._val[0];
        const params1 = _t1077[0]._val[1];
        const tail1 = _t1077[0]._val[2];
        const label2 = _t1077[1]._val[0];
        const params2 = _t1077[1]._val[1];
        const tail2 = _t1077[1]._val[2];
        if (((label1 === label2) && (List$length(params1) === List$length(params2)))) {
          _t1078 = true;
          List$iter2(Types$unify, params1, params2);
          return Types$unify_eff(tail1, tail2);
        }
      }
      if (!_t1078 && _t1077[0]._tag === 2) {
        const label1 = _t1077[0]._val[0];
        const params1 = _t1077[0]._val[1];
        const tail1 = _t1077[0]._val[2];
        _t1078 = true;
        const tail2_1079 = Types$rewrite_row(label1, params1, e2_1076);
        const _t1080 = Types$unify_eff(tail1, tail2_1079);
        return _t1080;
      }
      if (!_t1078 && _t1077[1]._tag === 2) {
        _t1078 = true;
        return Types$unify_eff(e2_1076, e1_1075);
      }
      if (!_t1078 && _t1077[0]._tag === 3 && _t1077[1]._tag === 3) {
        const i = _t1077[0]._val;
        const j = _t1077[1]._val;
        if ((i === j)) {
          _t1078 = true;
          return undefined;
        }
      }
      if (!_t1078 && true) {
        _t1078 = true;
        return _h["unify_error"](((("cannot unify effects " + __dict_Show_string.show(Types$pp_eff(e1_1075))) + " and ") + __dict_Show_string.show(Types$pp_eff(e2_1076))), function(_t1081) {
          return _bounce(function() {
            return _t1081;
          });
        });
      }
      if (!_t1078) _match_fail("line 16190");
    }
  }, Types$unify_eff);
}
function Types$rewrite_row(label, params_to_unify, eff) {
  return _trampoline(function() {
    const _t1082 = Types$eff_repr(eff);
    let _t1083 = false;
    if (!_t1083 && _t1082._tag === 2) {
      const l = _t1082._val[0];
      const found_params = _t1082._val[1];
      const tail = _t1082._val[2];
      if ((l === label)) {
        _t1083 = true;
        let _t1084;
        if ((List$length(params_to_unify) === List$length(found_params))) {
          _t1084 = List$iter2(Types$unify, params_to_unify, found_params);
        } else {
          _t1084 = undefined;
        }
        _t1084;
        return tail;
      }
    }
    if (!_t1083 && _t1082._tag === 2) {
      const l = _t1082._val[0];
      const params = _t1082._val[1];
      const tail = _t1082._val[2];
      _t1083 = true;
      return ({_tag: 2, _name: "EffRow", _val: [l, params, Types$rewrite_row(label, params_to_unify, tail)]});
    }
    if (!_t1083 && _t1082._tag === 0 && _t1082._val.contents._tag === 0) {
      const id = _t1082._val.contents._val[0];
      const level = _t1082._val.contents._val[1];
      const r = _t1082._val;
      _t1083 = true;
      const new_tail_1085 = Types$new_effvar(level);
      const new_row_1087 = ({_tag: 2, _name: "EffRow", _val: [label, params_to_unify, new_tail_1085]});
      Types$occurs_check_eff(id, level, new_row_1087);
      Ref$set(r, ({_tag: 1, _name: "EffLink", _val: new_row_1087}));
      const _t1088 = new_tail_1085;
      const _t1086 = _t1088;
      return _t1086;
    }
    if (!_t1083 && _t1082._tag === 1) {
      _t1083 = true;
      return _h["unify_error"]((("effect " + __dict_Show_string.show(label)) + " not handled"), function(_t1089) {
        return _bounce(function() {
          return _t1089;
        });
      });
    }
    if (!_t1083 && true) {
      _t1083 = true;
      return _h["unify_error"](("cannot rewrite effect row for " + __dict_Show_string.show(label)), function(_t1090) {
        return _bounce(function() {
          return _t1090;
        });
      });
    }
    if (!_t1083) _match_fail("line 16190");
  }, Types$rewrite_row);
}
function Types$subeffect(source, target) {
  while (true) {
    const source_1091 = Types$eff_repr(source);
    const target_1093 = Types$eff_repr(target);
    let _t1095;
    if (_eq(source_1091, target_1093)) {
      _t1095 = undefined;
    } else {
      let _t1097;
      const _t1096 = source_1091;
      _t1098: {
        if (_t1096._tag === 1) {
          _t1097 = undefined;
          break _t1098;
        }
        if (_t1096._tag === 0 && _t1096._val.contents._tag === 0) {
          _t1097 = Types$unify_eff(source_1091, target_1093);
          break _t1098;
        }
        if (_t1096._tag === 2) {
          const label = _t1096._val[0];
          const params = _t1096._val[1];
          const tail = _t1096._val[2];
          const target_tail_1099 = Types$rewrite_row(label, params, target_1093);
          const _t1101 = Types$eff_repr(tail);
          const _t1102 = target_tail_1099;
          source = _t1101;
          target = _t1102;
          continue;
          const _t1100 = undefined;
          _t1097 = _t1100;
          break _t1098;
        }
        if (_t1096._tag === 3) {
          _t1097 = undefined;
          break _t1098;
        }
        if (true) {
          _t1097 = Types$unify_eff(source_1091, target_1093);
          break _t1098;
        }
        _match_fail("line 16190");
      }
      _t1095 = _t1097;
    }
    const _t1094 = _t1095;
    const _t1092 = _t1094;
    return _t1092;
  }
}
function Types$unify_pv_row(r1, r2) {
  return _trampoline(function() {
    const r1_1103 = _resolve(Types$pv_repr(r1));
    const r2_1104 = _resolve(Types$pv_repr(r2));
    if (_eq(r1_1103, r2_1104)) {
      return undefined;
    } else {
      const _t1105 = [r1_1103, r2_1104];
      let _t1106 = false;
      if (!_t1106 && (_t1105[0]._tag === 1 && _t1105[0]._val.contents._tag === 0 || _t1105[1]._tag === 1 && _t1105[1]._val.contents._tag === 0)) {
        const id = (_t1105[0]._tag === 1 && _t1105[0]._val.contents._tag === 0 ? _t1105[0]._val.contents._val[0] : _t1105[1]._val.contents._val[0]);
        const level = (_t1105[0]._tag === 1 && _t1105[0]._val.contents._tag === 0 ? _t1105[0]._val.contents._val[1] : _t1105[1]._val.contents._val[1]);
        const r = (_t1105[0]._tag === 1 && _t1105[0]._val.contents._tag === 0 ? _t1105[0]._val : _t1105[1]._val);
        const row = (_t1105[0]._tag === 1 && _t1105[0]._val.contents._tag === 0 ? _t1105[1] : _t1105[0]);
        _t1106 = true;
        Types$occurs_check_pv(id, level, row);
        return Ref$set(r, ({_tag: 1, _name: "PVLink", _val: row}));
      }
      if (!_t1106 && _t1105[0]._tag === 2 && _t1105[1]._tag === 2) {
        _t1106 = true;
        return undefined;
      }
      if (!_t1106 && _t1105[0]._tag === 0 && _t1105[1]._tag === 0) {
        const tag1 = _t1105[0]._val[0];
        const ty1 = _t1105[0]._val[1];
        const tail1 = _t1105[0]._val[2];
        const tag2 = _t1105[1]._val[0];
        const ty2 = _t1105[1]._val[1];
        const tail2 = _t1105[1]._val[2];
        if ((tag1 === tag2)) {
          _t1106 = true;
          Types$unify_pv_payload(ty1, ty2);
          return Types$unify_pv_row(tail1, tail2);
        }
      }
      if (!_t1106 && _t1105[0]._tag === 0) {
        const tag1 = _t1105[0]._val[0];
        const ty1 = _t1105[0]._val[1];
        const tail1 = _t1105[0]._val[2];
        _t1106 = true;
        let _t1108;
        const _t1107 = Types$rewrite_pv_row(tag1, ty1, r2_1104);
        _t1109: {
          if (true) {
            const ty2 = _t1107[0];
            const tail2 = _t1107[1];
            Types$unify_pv_payload(ty1, ty2);
            _t1108 = Types$unify_pv_row(tail1, tail2);
            break _t1109;
          }
          _match_fail("line 16190");
        }
        return _t1108;
      }
      if (!_t1106 && _t1105[1]._tag === 0) {
        _t1106 = true;
        return Types$unify_pv_row(r2_1104, r1_1103);
      }
      if (!_t1106 && _t1105[0]._tag === 3 && _t1105[1]._tag === 3) {
        const i = _t1105[0]._val;
        const j = _t1105[1]._val;
        if ((i === j)) {
          _t1106 = true;
          return undefined;
        }
      }
      if (!_t1106 && true) {
        _t1106 = true;
        return _h["unify_error"]("cannot unify polymorphic variant types", function(_t1110) {
          return _bounce(function() {
            return _t1110;
          });
        });
      }
      if (!_t1106) _match_fail("line 16190");
    }
  }, Types$unify_pv_row);
}
function Types$unify_pv_payload(ty1, ty2) {
  return _trampoline(function() {
    const _t1111 = [ty1, ty2];
    let _t1112 = false;
    if (!_t1112 && _t1111[0]._tag === 0 && _t1111[1]._tag === 0) {
      _t1112 = true;
      return undefined;
    }
    if (!_t1112 && _t1111[0]._tag === 1 && _t1111[1]._tag === 1) {
      const t1 = _t1111[0]._val;
      const t2 = _t1111[1]._val;
      _t1112 = true;
      return Types$unify(t1, t2);
    }
    if (!_t1112 && true) {
      _t1112 = true;
      return _h["unify_error"]("polymorphic variant payload mismatch", function(_t1113) {
        return _bounce(function() {
          return _t1113;
        });
      });
    }
    if (!_t1112) _match_fail("line 16190");
  }, Types$unify_pv_payload);
}
function Types$rewrite_pv_row(tag, default_payload, row) {
  return _trampoline(function() {
    const _t1114 = Types$pv_repr(row);
    let _t1115 = false;
    if (!_t1115 && _t1114._tag === 0) {
      const t = _t1114._val[0];
      const ty_opt = _t1114._val[1];
      const tail = _t1114._val[2];
      if ((t === tag)) {
        _t1115 = true;
        return [ty_opt, tail];
      }
    }
    if (!_t1115 && _t1114._tag === 0) {
      const t = _t1114._val[0];
      const ty_opt = _t1114._val[1];
      const tail = _t1114._val[2];
      _t1115 = true;
      let _t1117;
      const _t1116 = Types$rewrite_pv_row(tag, default_payload, tail);
      _t1118: {
        if (true) {
          const found = _t1116[0];
          const rest = _t1116[1];
          _t1117 = [found, ({_tag: 0, _name: "PVRow", _val: [t, ty_opt, rest]})];
          break _t1118;
        }
        _match_fail("line 16190");
      }
      return _t1117;
    }
    if (!_t1115 && _t1114._tag === 1 && _t1114._val.contents._tag === 0) {
      const id = _t1114._val.contents._val[0];
      const level = _t1114._val.contents._val[1];
      const r = _t1114._val;
      _t1115 = true;
      const new_tail_1119 = Types$new_pvvar(level);
      const new_row_1121 = ({_tag: 0, _name: "PVRow", _val: [tag, default_payload, new_tail_1119]});
      Types$occurs_check_pv(id, level, new_row_1121);
      Ref$set(r, ({_tag: 1, _name: "PVLink", _val: new_row_1121}));
      const _t1122 = [default_payload, new_tail_1119];
      const _t1120 = _t1122;
      return _t1120;
    }
    if (!_t1115 && _t1114._tag === 2) {
      _t1115 = true;
      return _h["unify_error"]((("tag `" + __dict_Show_string.show(tag)) + " not in closed polymorphic variant type"), function(_t1123) {
        return _bounce(function() {
          return _t1123;
        });
      });
    }
    if (!_t1115 && true) {
      _t1115 = true;
      return _h["unify_error"](("cannot rewrite polymorphic variant row for `" + __dict_Show_string.show(tag)), function(_t1124) {
        return _bounce(function() {
          return _t1124;
        });
      });
    }
    if (!_t1115) _match_fail("line 16190");
  }, Types$rewrite_pv_row);
}
function Types$unify_record_row(r1, r2) {
  return _trampoline(function() {
    const r1_1125 = _resolve(Types$rrow_repr(r1));
    const r2_1126 = _resolve(Types$rrow_repr(r2));
    if (_eq(r1_1125, r2_1126)) {
      return undefined;
    } else {
      const _t1127 = [r1_1125, r2_1126];
      let _t1128 = false;
      if (!_t1128 && (_t1127[0]._tag === 1 && _t1127[0]._val.contents._tag === 0 || _t1127[1]._tag === 1 && _t1127[1]._val.contents._tag === 0)) {
        const id = (_t1127[0]._tag === 1 && _t1127[0]._val.contents._tag === 0 ? _t1127[0]._val.contents._val[0] : _t1127[1]._val.contents._val[0]);
        const level = (_t1127[0]._tag === 1 && _t1127[0]._val.contents._tag === 0 ? _t1127[0]._val.contents._val[1] : _t1127[1]._val.contents._val[1]);
        const r = (_t1127[0]._tag === 1 && _t1127[0]._val.contents._tag === 0 ? _t1127[0]._val : _t1127[1]._val);
        const row = (_t1127[0]._tag === 1 && _t1127[0]._val.contents._tag === 0 ? _t1127[1] : _t1127[0]);
        _t1128 = true;
        Types$occurs_check_rrow(id, level, row);
        return Ref$set(r, ({_tag: 1, _name: "RLink", _val: row}));
      }
      if (!_t1128 && (_t1127[0]._tag === 4 || _t1127[1]._tag === 4)) {
        _t1128 = true;
        return undefined;
      }
      if (!_t1128 && _t1127[0]._tag === 2 && _t1127[1]._tag === 2) {
        _t1128 = true;
        return undefined;
      }
      if (!_t1128 && _t1127[0]._tag === 0 && _t1127[1]._tag === 0) {
        const f1 = _t1127[0]._val[0];
        const ty1 = _t1127[0]._val[1];
        const tail1 = _t1127[0]._val[2];
        const f2 = _t1127[1]._val[0];
        const ty2 = _t1127[1]._val[1];
        const tail2 = _t1127[1]._val[2];
        if ((f1 === f2)) {
          _t1128 = true;
          Types$unify(ty1, ty2);
          return Types$unify_record_row(tail1, tail2);
        }
      }
      if (!_t1128 && _t1127[0]._tag === 0) {
        const f1 = _t1127[0]._val[0];
        const ty1 = _t1127[0]._val[1];
        const tail1 = _t1127[0]._val[2];
        _t1128 = true;
        let _t1130;
        const _t1129 = Types$rewrite_record_row(f1, r2_1126);
        _t1131: {
          if (true) {
            const ty2 = _t1129[0];
            const tail2 = _t1129[1];
            Types$unify(ty1, ty2);
            _t1130 = Types$unify_record_row(tail1, tail2);
            break _t1131;
          }
          _match_fail("line 16190");
        }
        return _t1130;
      }
      if (!_t1128 && _t1127[1]._tag === 0) {
        _t1128 = true;
        return Types$unify_record_row(r2_1126, r1_1125);
      }
      if (!_t1128 && _t1127[0]._tag === 3 && _t1127[1]._tag === 3) {
        const i = _t1127[0]._val;
        const j = _t1127[1]._val;
        if ((i === j)) {
          _t1128 = true;
          return undefined;
        }
      }
      if (!_t1128 && true) {
        _t1128 = true;
        return _h["unify_error"]("cannot unify record types", function(_t1132) {
          return _bounce(function() {
            return _t1132;
          });
        });
      }
      if (!_t1128) _match_fail("line 16190");
    }
  }, Types$unify_record_row);
}
function Types$rewrite_record_row(field, row) {
  return _trampoline(function() {
    const _t1133 = Types$rrow_repr(row);
    let _t1134 = false;
    if (!_t1134 && _t1133._tag === 0) {
      const f = _t1133._val[0];
      const ty = _t1133._val[1];
      const tail = _t1133._val[2];
      if ((f === field)) {
        _t1134 = true;
        return [ty, tail];
      }
    }
    if (!_t1134 && _t1133._tag === 0) {
      const f = _t1133._val[0];
      const ty = _t1133._val[1];
      const tail = _t1133._val[2];
      _t1134 = true;
      let _t1136;
      const _t1135 = Types$rewrite_record_row(field, tail);
      _t1137: {
        if (true) {
          const found = _t1135[0];
          const rest = _t1135[1];
          _t1136 = [found, ({_tag: 0, _name: "RRow", _val: [f, ty, rest]})];
          break _t1137;
        }
        _match_fail("line 16190");
      }
      return _t1136;
    }
    if (!_t1134 && _t1133._tag === 1 && _t1133._val.contents._tag === 0) {
      const id = _t1133._val.contents._val[0];
      const level = _t1133._val.contents._val[1];
      const r = _t1133._val;
      _t1134 = true;
      const new_tail_1138 = Types$new_rvar(level);
      const field_ty_1140 = Types$new_tvar(level);
      const new_row_1142 = ({_tag: 0, _name: "RRow", _val: [field, field_ty_1140, new_tail_1138]});
      Types$occurs_check_rrow(id, level, new_row_1142);
      Ref$set(r, ({_tag: 1, _name: "RLink", _val: new_row_1142}));
      const _t1143 = [field_ty_1140, new_tail_1138];
      const _t1141 = _t1143;
      const _t1139 = _t1141;
      return _t1139;
    }
    if (!_t1134 && _t1133._tag === 4) {
      _t1134 = true;
      const field_ty_1144 = Types$new_tvar(0);
      const _t1145 = [field_ty_1144, ({_tag: 4, _name: "RWild"})];
      return _t1145;
    }
    if (!_t1134 && _t1133._tag === 2) {
      _t1134 = true;
      return _h["unify_error"](("record has no field " + __dict_Show_string.show(field)), function(_t1146) {
        return _bounce(function() {
          return _t1146;
        });
      });
    }
    if (!_t1134 && true) {
      _t1134 = true;
      return _h["unify_error"](("cannot rewrite record row for " + __dict_Show_string.show(field)), function(_t1147) {
        return _bounce(function() {
          return _t1147;
        });
      });
    }
    if (!_t1134) _match_fail("line 16190");
  }, Types$rewrite_record_row);
}
function Types$unify(t1, t2) {
  while (true) {
    const t1_1148 = Types$repr(t1);
    const t2_1150 = Types$repr(t2);
    let _t1152;
    if (_eq(t1_1148, t2_1150)) {
      _t1152 = undefined;
    } else {
      let _t1154;
      const _t1153 = [t1_1148, t2_1150];
      _t1155: {
        if ((_t1153[0]._tag === 16 && _t1153[0]._val.contents._tag === 0 || _t1153[1]._tag === 16 && _t1153[1]._val.contents._tag === 0)) {
          const id = (_t1153[0]._tag === 16 && _t1153[0]._val.contents._tag === 0 ? _t1153[0]._val.contents._val[0] : _t1153[1]._val.contents._val[0]);
          const level = (_t1153[0]._tag === 16 && _t1153[0]._val.contents._tag === 0 ? _t1153[0]._val.contents._val[1] : _t1153[1]._val.contents._val[1]);
          const r = (_t1153[0]._tag === 16 && _t1153[0]._val.contents._tag === 0 ? _t1153[0]._val : _t1153[1]._val);
          const ty = (_t1153[0]._tag === 16 && _t1153[0]._val.contents._tag === 0 ? _t1153[1] : _t1153[0]);
          Types$occurs_check(id, level, ty);
          _t1154 = Ref$set(r, ({_tag: 1, _name: "Link", _val: ty}));
          break _t1155;
        }
        if ((_t1153[0]._tag === 7 && _t1153[1]._tag === 7 || _t1153[0]._tag === 8 && _t1153[1]._tag === 8)) {
          const a1 = _t1153[0]._val[0];
          const e1 = _t1153[0]._val[1];
          const r1 = _t1153[0]._val[2];
          const a2 = _t1153[1]._val[0];
          const e2 = _t1153[1]._val[1];
          const r2 = _t1153[1]._val[2];
          Types$unify(a1, a2);
          Types$unify_eff(e1, e2);
          const _t1156 = r1;
          const _t1157 = r2;
          t1 = _t1156;
          t2 = _t1157;
          continue;
          _t1154 = undefined;
          break _t1155;
        }
        if (_t1153[0]._tag === 9 && _t1153[1]._tag === 9) {
          const ts1 = _t1153[0]._val;
          const ts2 = _t1153[1]._val;
          let _t1158;
          if ((List$length(ts1) !== List$length(ts2))) {
            _t1158 = Types$unify_error(t1_1148, t2_1150);
          } else {
            _t1158 = undefined;
          }
          _t1158;
          _t1154 = List$iter2(Types$unify, ts1, ts2);
          break _t1155;
        }
        if (_t1153[0]._tag === 10 && _t1153[1]._tag === 10) {
          const t1$p = _t1153[0]._val;
          const t2$p = _t1153[1]._val;
          const _t1159 = t1$p;
          const _t1160 = t2$p;
          t1 = _t1159;
          t2 = _t1160;
          continue;
          _t1154 = undefined;
          break _t1155;
        }
        if (_t1153[0]._tag === 14 && _t1153[1]._tag === 14) {
          const t1$p = _t1153[0]._val;
          const t2$p = _t1153[1]._val;
          const _t1161 = t1$p;
          const _t1162 = t2$p;
          t1 = _t1161;
          t2 = _t1162;
          continue;
          _t1154 = undefined;
          break _t1155;
        }
        if (_t1153[0]._tag === 13 && _t1153[1]._tag === 13) {
          const k1 = _t1153[0]._val[0];
          const v1 = _t1153[0]._val[1];
          const k2 = _t1153[1]._val[0];
          const v2 = _t1153[1]._val[1];
          Types$unify(k1, k2);
          const _t1163 = v1;
          const _t1164 = v2;
          t1 = _t1163;
          t2 = _t1164;
          continue;
          _t1154 = undefined;
          break _t1155;
        }
        if (_t1153[0]._tag === 11 && _t1153[1]._tag === 11) {
          const r1 = _t1153[0]._val;
          const r2 = _t1153[1]._val;
          _t1154 = Types$unify_record_row(r1, r2);
          break _t1155;
        }
        if (((((((_t1153[0]._tag === 0 && _t1153[1]._tag === 0 || _t1153[0]._tag === 1 && _t1153[1]._tag === 1) || _t1153[0]._tag === 2 && _t1153[1]._tag === 2) || _t1153[0]._tag === 3 && _t1153[1]._tag === 3) || _t1153[0]._tag === 4 && _t1153[1]._tag === 4) || _t1153[0]._tag === 5 && _t1153[1]._tag === 5) || _t1153[0]._tag === 6 && _t1153[1]._tag === 6)) {
          _t1154 = undefined;
          break _t1155;
        }
        if (_t1153[0]._tag === 12 && _t1153[1]._tag === 12) {
          const a = _t1153[0]._val[0];
          const args_a = _t1153[0]._val[1];
          const b = _t1153[1]._val[0];
          const args_b = _t1153[1]._val[1];
          if ((a === b)) {
            let _t1165;
            if ((List$length(args_a) !== List$length(args_b))) {
              _t1165 = Types$unify_error(t1_1148, t2_1150);
            } else {
              _t1165 = undefined;
            }
            _t1165;
            _t1154 = List$iter2(Types$unify, args_a, args_b);
            break _t1155;
          }
        }
        if (_t1153[0]._tag === 15 && _t1153[1]._tag === 15) {
          const r1 = _t1153[0]._val;
          const r2 = _t1153[1]._val;
          _t1154 = Types$unify_pv_row(r1, r2);
          break _t1155;
        }
        if (true) {
          _t1154 = Types$unify_error(t1_1148, t2_1150);
          break _t1155;
        }
        _match_fail("line 16190");
      }
      _t1152 = _t1154;
    }
    const _t1151 = _t1152;
    const _t1149 = _t1151;
    return _t1149;
  }
}
function Types$generalize(level, ty) {
  let _t1167;
  const _t1166 = Hashtbl$create(8);
  _t1168: {
    if (true) {
      const id_map = _t1166;
      const counter_1169 = Ref$create(0);
      let _t1172;
      const _t1171 = Hashtbl$create(4);
      _t1173: {
        if (true) {
          const eff_id_map = _t1171;
          const ecounter_1174 = Ref$create(0);
          let _t1177;
          const _t1176 = Hashtbl$create(4);
          _t1178: {
            if (true) {
              const pv_id_map = _t1176;
              const pvcounter_1179 = Ref$create(0);
              let _t1182;
              const _t1181 = Hashtbl$create(4);
              _t1183: {
                if (true) {
                  const r_id_map = _t1181;
                  const rcounter_1184 = Ref$create(0);
                  function go(ty) {
                    let _t1187;
                    const _t1186 = Types$repr(ty);
                    _t1188: {
                      if (_t1186._tag === 16 && _t1186._val.contents._tag === 0) {
                        const id = _t1186._val.contents._val[0];
                        const level$p = _t1186._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1190;
                          const _t1189 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, id]);
                          _t1191: {
                            if (_t1189._tag === 1) {
                              const gen_id = _t1189._val;
                              _t1190 = ({_tag: 17, _name: "TGen", _val: gen_id});
                              break _t1191;
                            }
                            if (_t1189._tag === 0) {
                              const gen_id_1192 = Ref$get(counter_1169);
                              Ref$set(counter_1169, (gen_id_1192 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, id_map, id, gen_id_1192]);
                              const _t1193 = ({_tag: 17, _name: "TGen", _val: gen_id_1192});
                              _t1190 = _t1193;
                              break _t1191;
                            }
                            _match_fail("line 16190");
                          }
                          _t1187 = _t1190;
                          break _t1188;
                        }
                      }
                      if (_t1186._tag === 16 && _t1186._val.contents._tag === 0) {
                        const t = _t1186;
                        _t1187 = t;
                        break _t1188;
                      }
                      if (_t1186._tag === 16 && _t1186._val.contents._tag === 1) {
                        _t1187 = failwith("assert false");
                        break _t1188;
                      }
                      if (_t1186._tag === 7) {
                        const a = _t1186._val[0];
                        const eff = _t1186._val[1];
                        const r = _t1186._val[2];
                        _t1187 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1188;
                      }
                      if (_t1186._tag === 8) {
                        const a = _t1186._val[0];
                        const eff = _t1186._val[1];
                        const r = _t1186._val[2];
                        _t1187 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1188;
                      }
                      if (_t1186._tag === 9) {
                        const ts = _t1186._val;
                        _t1187 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
                        break _t1188;
                      }
                      if (_t1186._tag === 10) {
                        const t = _t1186._val;
                        _t1187 = ({_tag: 10, _name: "TList", _val: go(t)});
                        break _t1188;
                      }
                      if (_t1186._tag === 14) {
                        const t = _t1186._val;
                        _t1187 = ({_tag: 14, _name: "TArray", _val: go(t)});
                        break _t1188;
                      }
                      if (_t1186._tag === 13) {
                        const k = _t1186._val[0];
                        const v = _t1186._val[1];
                        _t1187 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
                        break _t1188;
                      }
                      if (_t1186._tag === 11) {
                        const row = _t1186._val;
                        _t1187 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
                        break _t1188;
                      }
                      if (_t1186._tag === 12) {
                        const name = _t1186._val[0];
                        const args = _t1186._val[1];
                        _t1187 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
                        break _t1188;
                      }
                      if (_t1186._tag === 15) {
                        const row = _t1186._val;
                        _t1187 = ({_tag: 15, _name: "TPolyVariant", _val: go_pv(row)});
                        break _t1188;
                      }
                      if (true) {
                        const t = _t1186;
                        _t1187 = t;
                        break _t1188;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1187;
                  }
                  function go_eff(eff) {
                    let _t1195;
                    const _t1194 = Types$eff_repr(eff);
                    _t1196: {
                      if (_t1194._tag === 0 && _t1194._val.contents._tag === 0) {
                        const id = _t1194._val.contents._val[0];
                        const level$p = _t1194._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1198;
                          const _t1197 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id]);
                          _t1199: {
                            if (_t1197._tag === 1) {
                              const gen_id = _t1197._val;
                              _t1198 = ({_tag: 3, _name: "EffGen", _val: gen_id});
                              break _t1199;
                            }
                            if (_t1197._tag === 0) {
                              const gen_id_1200 = Ref$get(ecounter_1174);
                              Ref$set(ecounter_1174, (gen_id_1200 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id, gen_id_1200]);
                              const _t1201 = ({_tag: 3, _name: "EffGen", _val: gen_id_1200});
                              _t1198 = _t1201;
                              break _t1199;
                            }
                            _match_fail("line 16190");
                          }
                          _t1195 = _t1198;
                          break _t1196;
                        }
                      }
                      if (_t1194._tag === 0 && _t1194._val.contents._tag === 0) {
                        const e = _t1194;
                        _t1195 = e;
                        break _t1196;
                      }
                      if (_t1194._tag === 0 && _t1194._val.contents._tag === 1) {
                        _t1195 = failwith("assert false");
                        break _t1196;
                      }
                      if (_t1194._tag === 2) {
                        const label = _t1194._val[0];
                        const params = _t1194._val[1];
                        const tail = _t1194._val[2];
                        _t1195 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
                        break _t1196;
                      }
                      if (_t1194._tag === 1) {
                        _t1195 = ({_tag: 1, _name: "EffEmpty"});
                        break _t1196;
                      }
                      if (_t1194._tag === 3) {
                        const e = _t1194;
                        _t1195 = e;
                        break _t1196;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1195;
                  }
                  function go_pv(row) {
                    let _t1203;
                    const _t1202 = Types$pv_repr(row);
                    _t1204: {
                      if (_t1202._tag === 1 && _t1202._val.contents._tag === 0) {
                        const id = _t1202._val.contents._val[0];
                        const level$p = _t1202._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1206;
                          const _t1205 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id]);
                          _t1207: {
                            if (_t1205._tag === 1) {
                              const gen_id = _t1205._val;
                              _t1206 = ({_tag: 3, _name: "PVGen", _val: gen_id});
                              break _t1207;
                            }
                            if (_t1205._tag === 0) {
                              const gen_id_1208 = Ref$get(pvcounter_1179);
                              Ref$set(pvcounter_1179, (gen_id_1208 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id, gen_id_1208]);
                              const _t1209 = ({_tag: 3, _name: "PVGen", _val: gen_id_1208});
                              _t1206 = _t1209;
                              break _t1207;
                            }
                            _match_fail("line 16190");
                          }
                          _t1203 = _t1206;
                          break _t1204;
                        }
                      }
                      if (_t1202._tag === 1 && _t1202._val.contents._tag === 0) {
                        const r = _t1202;
                        _t1203 = r;
                        break _t1204;
                      }
                      if (_t1202._tag === 1 && _t1202._val.contents._tag === 1) {
                        _t1203 = failwith("assert false");
                        break _t1204;
                      }
                      if (_t1202._tag === 0) {
                        const tag = _t1202._val[0];
                        const ty_opt = _t1202._val[1];
                        const tail = _t1202._val[2];
                        _t1203 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
                        break _t1204;
                      }
                      if (_t1202._tag === 2) {
                        _t1203 = ({_tag: 2, _name: "PVEmpty"});
                        break _t1204;
                      }
                      if (_t1202._tag === 3) {
                        const r = _t1202;
                        _t1203 = r;
                        break _t1204;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1203;
                  }
                  function go_rrow(row) {
                    let _t1211;
                    const _t1210 = Types$rrow_repr(row);
                    _t1212: {
                      if (_t1210._tag === 1 && _t1210._val.contents._tag === 0) {
                        const id = _t1210._val.contents._val[0];
                        const level$p = _t1210._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1214;
                          const _t1213 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, r_id_map, id]);
                          _t1215: {
                            if (_t1213._tag === 1) {
                              const gen_id = _t1213._val;
                              _t1214 = ({_tag: 3, _name: "RGen", _val: gen_id});
                              break _t1215;
                            }
                            if (_t1213._tag === 0) {
                              const gen_id_1216 = Ref$get(rcounter_1184);
                              Ref$set(rcounter_1184, (gen_id_1216 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, r_id_map, id, gen_id_1216]);
                              const _t1217 = ({_tag: 3, _name: "RGen", _val: gen_id_1216});
                              _t1214 = _t1217;
                              break _t1215;
                            }
                            _match_fail("line 16190");
                          }
                          _t1211 = _t1214;
                          break _t1212;
                        }
                      }
                      if (_t1210._tag === 1 && _t1210._val.contents._tag === 0) {
                        const r = _t1210;
                        _t1211 = r;
                        break _t1212;
                      }
                      if (_t1210._tag === 1 && _t1210._val.contents._tag === 1) {
                        _t1211 = failwith("assert false");
                        break _t1212;
                      }
                      if (_t1210._tag === 0) {
                        const name = _t1210._val[0];
                        const ty = _t1210._val[1];
                        const tail = _t1210._val[2];
                        _t1211 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
                        break _t1212;
                      }
                      if (_t1210._tag === 2) {
                        _t1211 = ({_tag: 2, _name: "REmpty"});
                        break _t1212;
                      }
                      if (_t1210._tag === 3) {
                        const r = _t1210;
                        _t1211 = r;
                        break _t1212;
                      }
                      if (_t1210._tag === 4) {
                        _t1211 = ({_tag: 4, _name: "RWild"});
                        break _t1212;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1211;
                  }
                  const body_1219 = go(ty);
                  const _t1220 = ({body: body_1219, constraints: null, equant: Ref$get(ecounter_1174), pvquant: Ref$get(pvcounter_1179), quant: Ref$get(counter_1169), record_evidences: null, rquant: Ref$get(rcounter_1184)});
                  const _t1218 = _t1220;
                  const _t1185 = _t1218;
                  _t1182 = _t1185;
                  break _t1183;
                }
                _match_fail("line 16190");
              }
              const _t1180 = _t1182;
              _t1177 = _t1180;
              break _t1178;
            }
            _match_fail("line 16190");
          }
          const _t1175 = _t1177;
          _t1172 = _t1175;
          break _t1173;
        }
        _match_fail("line 16190");
      }
      const _t1170 = _t1172;
      _t1167 = _t1170;
      break _t1168;
    }
    _match_fail("line 16190");
  }
  return _t1167;
}
function Types$generalize_with_map(level, ty) {
  const counter_1221 = Ref$create(0);
  let _t1224;
  const _t1223 = Hashtbl$create(8);
  _t1225: {
    if (true) {
      const id_map = _t1223;
      const ecounter_1226 = Ref$create(0);
      let _t1229;
      const _t1228 = Hashtbl$create(4);
      _t1230: {
        if (true) {
          const eff_id_map = _t1228;
          const pvcounter_1231 = Ref$create(0);
          let _t1234;
          const _t1233 = Hashtbl$create(4);
          _t1235: {
            if (true) {
              const pv_id_map = _t1233;
              const rcounter_1236 = Ref$create(0);
              let _t1239;
              const _t1238 = Hashtbl$create(4);
              _t1240: {
                if (true) {
                  const r_id_map = _t1238;
                  function go(ty) {
                    let _t1242;
                    const _t1241 = Types$repr(ty);
                    _t1243: {
                      if (_t1241._tag === 16 && _t1241._val.contents._tag === 0) {
                        const id = _t1241._val.contents._val[0];
                        const l = _t1241._val.contents._val[1];
                        if ((l > level)) {
                          let _t1245;
                          const _t1244 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, id]);
                          _t1246: {
                            if (_t1244._tag === 1) {
                              const gen = _t1244._val;
                              _t1245 = gen;
                              break _t1246;
                            }
                            if (_t1244._tag === 0) {
                              const gen_1247 = ({_tag: 17, _name: "TGen", _val: Ref$get(counter_1221)});
                              Ref$set(counter_1221, (Ref$get(counter_1221) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, id_map, id, gen_1247]);
                              const _t1248 = gen_1247;
                              _t1245 = _t1248;
                              break _t1246;
                            }
                            _match_fail("line 16190");
                          }
                          _t1242 = _t1245;
                          break _t1243;
                        }
                      }
                      if ((_t1241._tag === 16 && _t1241._val.contents._tag === 0 || _t1241._tag === 16 && _t1241._val.contents._tag === 1)) {
                        _t1242 = ty;
                        break _t1243;
                      }
                      if (_t1241._tag === 7) {
                        const a = _t1241._val[0];
                        const eff = _t1241._val[1];
                        const r = _t1241._val[2];
                        _t1242 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1243;
                      }
                      if (_t1241._tag === 8) {
                        const a = _t1241._val[0];
                        const eff = _t1241._val[1];
                        const r = _t1241._val[2];
                        _t1242 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1243;
                      }
                      if (_t1241._tag === 9) {
                        const ts = _t1241._val;
                        _t1242 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
                        break _t1243;
                      }
                      if (_t1241._tag === 10) {
                        const t = _t1241._val;
                        _t1242 = ({_tag: 10, _name: "TList", _val: go(t)});
                        break _t1243;
                      }
                      if (_t1241._tag === 14) {
                        const t = _t1241._val;
                        _t1242 = ({_tag: 14, _name: "TArray", _val: go(t)});
                        break _t1243;
                      }
                      if (_t1241._tag === 13) {
                        const k = _t1241._val[0];
                        const v = _t1241._val[1];
                        _t1242 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
                        break _t1243;
                      }
                      if (_t1241._tag === 11) {
                        const row = _t1241._val;
                        _t1242 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
                        break _t1243;
                      }
                      if (_t1241._tag === 12) {
                        const name = _t1241._val[0];
                        const args = _t1241._val[1];
                        _t1242 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
                        break _t1243;
                      }
                      if (_t1241._tag === 15) {
                        const row = _t1241._val;
                        _t1242 = ({_tag: 15, _name: "TPolyVariant", _val: go_pv(row)});
                        break _t1243;
                      }
                      if (true) {
                        const t = _t1241;
                        _t1242 = t;
                        break _t1243;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1242;
                  }
                  function go_eff(eff) {
                    let _t1250;
                    const _t1249 = Types$eff_repr(eff);
                    _t1251: {
                      if (_t1249._tag === 0 && _t1249._val.contents._tag === 0) {
                        const id = _t1249._val.contents._val[0];
                        const l = _t1249._val.contents._val[1];
                        if ((l > level)) {
                          let _t1253;
                          const _t1252 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id]);
                          _t1254: {
                            if (_t1252._tag === 1) {
                              const gen = _t1252._val;
                              _t1253 = gen;
                              break _t1254;
                            }
                            if (_t1252._tag === 0) {
                              const gen_1255 = ({_tag: 3, _name: "EffGen", _val: Ref$get(ecounter_1226)});
                              Ref$set(ecounter_1226, (Ref$get(ecounter_1226) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id, gen_1255]);
                              const _t1256 = gen_1255;
                              _t1253 = _t1256;
                              break _t1254;
                            }
                            _match_fail("line 16190");
                          }
                          _t1250 = _t1253;
                          break _t1251;
                        }
                      }
                      if ((_t1249._tag === 0 && _t1249._val.contents._tag === 0 || _t1249._tag === 0 && _t1249._val.contents._tag === 1)) {
                        _t1250 = eff;
                        break _t1251;
                      }
                      if (_t1249._tag === 2) {
                        const label = _t1249._val[0];
                        const params = _t1249._val[1];
                        const tail = _t1249._val[2];
                        _t1250 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
                        break _t1251;
                      }
                      if (_t1249._tag === 1) {
                        _t1250 = ({_tag: 1, _name: "EffEmpty"});
                        break _t1251;
                      }
                      if (_t1249._tag === 3) {
                        const e = _t1249;
                        _t1250 = e;
                        break _t1251;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1250;
                  }
                  function go_pv(row) {
                    let _t1258;
                    const _t1257 = Types$pv_repr(row);
                    _t1259: {
                      if (_t1257._tag === 1 && _t1257._val.contents._tag === 0) {
                        const id = _t1257._val.contents._val[0];
                        const l = _t1257._val.contents._val[1];
                        if ((l > level)) {
                          let _t1261;
                          const _t1260 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id]);
                          _t1262: {
                            if (_t1260._tag === 1) {
                              const gen = _t1260._val;
                              _t1261 = gen;
                              break _t1262;
                            }
                            if (_t1260._tag === 0) {
                              const gen_1263 = ({_tag: 3, _name: "PVGen", _val: Ref$get(pvcounter_1231)});
                              Ref$set(pvcounter_1231, (Ref$get(pvcounter_1231) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id, gen_1263]);
                              const _t1264 = gen_1263;
                              _t1261 = _t1264;
                              break _t1262;
                            }
                            _match_fail("line 16190");
                          }
                          _t1258 = _t1261;
                          break _t1259;
                        }
                      }
                      if ((_t1257._tag === 1 && _t1257._val.contents._tag === 0 || _t1257._tag === 1 && _t1257._val.contents._tag === 1)) {
                        _t1258 = row;
                        break _t1259;
                      }
                      if (_t1257._tag === 0) {
                        const tag = _t1257._val[0];
                        const ty_opt = _t1257._val[1];
                        const tail = _t1257._val[2];
                        _t1258 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
                        break _t1259;
                      }
                      if (_t1257._tag === 2) {
                        _t1258 = ({_tag: 2, _name: "PVEmpty"});
                        break _t1259;
                      }
                      if (_t1257._tag === 3) {
                        const r = _t1257;
                        _t1258 = r;
                        break _t1259;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1258;
                  }
                  function go_rrow(row) {
                    let _t1266;
                    const _t1265 = Types$rrow_repr(row);
                    _t1267: {
                      if (_t1265._tag === 1 && _t1265._val.contents._tag === 0) {
                        const id = _t1265._val.contents._val[0];
                        const l = _t1265._val.contents._val[1];
                        if ((l > level)) {
                          let _t1269;
                          const _t1268 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, r_id_map, id]);
                          _t1270: {
                            if (_t1268._tag === 1) {
                              const gen = _t1268._val;
                              _t1269 = gen;
                              break _t1270;
                            }
                            if (_t1268._tag === 0) {
                              const gen_1271 = ({_tag: 3, _name: "RGen", _val: Ref$get(rcounter_1236)});
                              Ref$set(rcounter_1236, (Ref$get(rcounter_1236) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, r_id_map, id, gen_1271]);
                              const _t1272 = gen_1271;
                              _t1269 = _t1272;
                              break _t1270;
                            }
                            _match_fail("line 16190");
                          }
                          _t1266 = _t1269;
                          break _t1267;
                        }
                      }
                      if ((_t1265._tag === 1 && _t1265._val.contents._tag === 0 || _t1265._tag === 1 && _t1265._val.contents._tag === 1)) {
                        _t1266 = row;
                        break _t1267;
                      }
                      if (_t1265._tag === 0) {
                        const name = _t1265._val[0];
                        const ty = _t1265._val[1];
                        const tail = _t1265._val[2];
                        _t1266 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
                        break _t1267;
                      }
                      if (_t1265._tag === 2) {
                        _t1266 = ({_tag: 2, _name: "REmpty"});
                        break _t1267;
                      }
                      if (_t1265._tag === 3) {
                        const r = _t1265;
                        _t1266 = r;
                        break _t1267;
                      }
                      if (_t1265._tag === 4) {
                        _t1266 = ({_tag: 4, _name: "RWild"});
                        break _t1267;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1266;
                  }
                  const body_1274 = go(ty);
                  const _t1275 = [({body: body_1274, constraints: null, equant: Ref$get(ecounter_1226), pvquant: Ref$get(pvcounter_1231), quant: Ref$get(counter_1221), record_evidences: null, rquant: Ref$get(rcounter_1236)}), id_map];
                  const _t1273 = _t1275;
                  _t1239 = _t1273;
                  break _t1240;
                }
                _match_fail("line 16190");
              }
              const _t1237 = _t1239;
              _t1234 = _t1237;
              break _t1235;
            }
            _match_fail("line 16190");
          }
          const _t1232 = _t1234;
          _t1229 = _t1232;
          break _t1230;
        }
        _match_fail("line 16190");
      }
      const _t1227 = _t1229;
      _t1224 = _t1227;
      break _t1225;
    }
    _match_fail("line 16190");
  }
  const _t1222 = _t1224;
  return _t1222;
}
function Types$instantiate_with_mapping(level, s) {
  let _t1276;
  if (((s.quant === 0) && ((s.equant === 0) && ((s.pvquant === 0) && (s.rquant === 0))))) {
    _t1276 = [s.body, null];
  } else {
    function _t1277(_) {
      return Types$new_tvar(level);
    }
    const vars_1278 = Array$init(s.quant, _t1277);
    function _t1280(_) {
      return Types$new_effvar(level);
    }
    const evars_1281 = Array$init(s.equant, _t1280);
    function _t1283(_) {
      return Types$new_pvvar(level);
    }
    const pvvars_1284 = Array$init(s.pvquant, _t1283);
    function _t1286(_) {
      return Types$new_rvar(level);
    }
    const rvars_1287 = Array$init(s.rquant, _t1286);
    function _t1289(_) {
      return Types$new_effvar(level);
    }
    const shared_eff_1290 = _t1289;
    function _t1292(i) {
      return [i, Array$get(vars_1278, i)];
    }
    const mapping_1293 = List$init(s.quant, _t1292);
    function go(__x) {
      let _t1296;
      const _t1295 = __x;
      _t1297: {
        if (_t1295._tag === 17) {
          const id = _t1295._val;
          if ((id < s.quant)) {
            _t1296 = Array$get(vars_1278, id);
            break _t1297;
          }
        }
        if (_t1295._tag === 7) {
          const a = _t1295._val[0];
          const eff = _t1295._val[1];
          const r = _t1295._val[2];
          _t1296 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
          break _t1297;
        }
        if (_t1295._tag === 8) {
          const a = _t1295._val[0];
          const eff = _t1295._val[1];
          const r = _t1295._val[2];
          _t1296 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
          break _t1297;
        }
        if (_t1295._tag === 9) {
          const ts = _t1295._val;
          _t1296 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t1297;
        }
        if (_t1295._tag === 10) {
          const t = _t1295._val;
          _t1296 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t1297;
        }
        if (_t1295._tag === 14) {
          const t = _t1295._val;
          _t1296 = ({_tag: 14, _name: "TArray", _val: go(t)});
          break _t1297;
        }
        if (_t1295._tag === 13) {
          const k = _t1295._val[0];
          const v = _t1295._val[1];
          _t1296 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
          break _t1297;
        }
        if (_t1295._tag === 11) {
          const row = _t1295._val;
          _t1296 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
          break _t1297;
        }
        if (_t1295._tag === 12) {
          const name = _t1295._val[0];
          const args = _t1295._val[1];
          _t1296 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
          break _t1297;
        }
        if (_t1295._tag === 15) {
          const row = _t1295._val;
          _t1296 = ({_tag: 15, _name: "TPolyVariant", _val: go_pv(row)});
          break _t1297;
        }
        if (true) {
          const t = _t1295;
          _t1296 = t;
          break _t1297;
        }
        _match_fail("line 16190");
      }
      return _t1296;
    }
    function go_eff(__x) {
      let _t1299;
      const _t1298 = __x;
      _t1300: {
        if (_t1298._tag === 3) {
          const id = _t1298._val;
          if ((id < s.equant)) {
            _t1299 = Array$get(evars_1281, id);
            break _t1300;
          }
        }
        if (_t1298._tag === 2) {
          const label = _t1298._val[0];
          const params = _t1298._val[1];
          const tail = _t1298._val[2];
          _t1299 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
          break _t1300;
        }
        if (_t1298._tag === 1) {
          _t1299 = shared_eff_1290(undefined);
          break _t1300;
        }
        if (true) {
          const e = _t1298;
          _t1299 = e;
          break _t1300;
        }
        _match_fail("line 16190");
      }
      return _t1299;
    }
    function go_pv(__x) {
      let _t1302;
      const _t1301 = __x;
      _t1303: {
        if (_t1301._tag === 3) {
          const id = _t1301._val;
          if ((id < s.pvquant)) {
            _t1302 = Array$get(pvvars_1284, id);
            break _t1303;
          }
        }
        if (_t1301._tag === 0) {
          const tag = _t1301._val[0];
          const ty_opt = _t1301._val[1];
          const tail = _t1301._val[2];
          _t1302 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
          break _t1303;
        }
        if (true) {
          const r = _t1301;
          _t1302 = r;
          break _t1303;
        }
        _match_fail("line 16190");
      }
      return _t1302;
    }
    function go_rrow(__x) {
      let _t1305;
      const _t1304 = __x;
      _t1306: {
        if (_t1304._tag === 3) {
          const id = _t1304._val;
          if ((id < s.rquant)) {
            _t1305 = Array$get(rvars_1287, id);
            break _t1306;
          }
        }
        if (_t1304._tag === 0) {
          const name = _t1304._val[0];
          const ty = _t1304._val[1];
          const tail = _t1304._val[2];
          _t1305 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
          break _t1306;
        }
        if (true) {
          const r = _t1304;
          _t1305 = r;
          break _t1306;
        }
        _match_fail("line 16190");
      }
      return _t1305;
    }
    const _t1307 = [go(s.body), mapping_1293];
    const _t1294 = _t1307;
    const _t1291 = _t1294;
    const _t1288 = _t1291;
    const _t1285 = _t1288;
    const _t1282 = _t1285;
    const _t1279 = _t1282;
    _t1276 = _t1279;
  }
  return _t1276;
}
function Types$instantiate(level, s) {
  let _t1308;
  if (((s.quant === 0) && ((s.equant === 0) && ((s.pvquant === 0) && (s.rquant === 0))))) {
    _t1308 = s.body;
  } else {
    function _t1309(_) {
      return Types$new_tvar(level);
    }
    const vars_1310 = Array$init(s.quant, _t1309);
    function _t1312(_) {
      return Types$new_effvar(level);
    }
    const evars_1313 = Array$init(s.equant, _t1312);
    function _t1315(_) {
      return Types$new_pvvar(level);
    }
    const pvvars_1316 = Array$init(s.pvquant, _t1315);
    function _t1318(_) {
      return Types$new_rvar(level);
    }
    const rvars_1319 = Array$init(s.rquant, _t1318);
    function _t1321(_) {
      return Types$new_effvar(level);
    }
    const shared_eff_1322 = _t1321;
    function go(__x) {
      while (true) {
        let _t1325;
        const _t1324 = __x;
        _t1326: {
          if (_t1324._tag === 17) {
            const id = _t1324._val;
            if ((id < s.quant)) {
              _t1325 = Array$get(vars_1310, id);
              break _t1326;
            }
          }
          if (_t1324._tag === 7) {
            const a = _t1324._val[0];
            const eff = _t1324._val[1];
            const r = _t1324._val[2];
            _t1325 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
            break _t1326;
          }
          if (_t1324._tag === 8) {
            const a = _t1324._val[0];
            const eff = _t1324._val[1];
            const r = _t1324._val[2];
            _t1325 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
            break _t1326;
          }
          if (_t1324._tag === 9) {
            const ts = _t1324._val;
            _t1325 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
            break _t1326;
          }
          if (_t1324._tag === 10) {
            const t = _t1324._val;
            _t1325 = ({_tag: 10, _name: "TList", _val: go(t)});
            break _t1326;
          }
          if (_t1324._tag === 14) {
            const t = _t1324._val;
            _t1325 = ({_tag: 14, _name: "TArray", _val: go(t)});
            break _t1326;
          }
          if (_t1324._tag === 13) {
            const k = _t1324._val[0];
            const v = _t1324._val[1];
            _t1325 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
            break _t1326;
          }
          if (_t1324._tag === 11) {
            const row = _t1324._val;
            _t1325 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
            break _t1326;
          }
          if (_t1324._tag === 12) {
            const name = _t1324._val[0];
            const args = _t1324._val[1];
            _t1325 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
            break _t1326;
          }
          if (_t1324._tag === 15) {
            const row = _t1324._val;
            _t1325 = ({_tag: 15, _name: "TPolyVariant", _val: go_pv(row)});
            break _t1326;
          }
          if (_t1324._tag === 16 && _t1324._val.contents._tag === 1) {
            const ty = _t1324._val.contents._val;
            const _t1327 = ty;
            __x = _t1327;
            continue;
            _t1325 = undefined;
            break _t1326;
          }
          if (true) {
            const t = _t1324;
            _t1325 = t;
            break _t1326;
          }
          _match_fail("line 16190");
        }
        return _t1325;
      }
    }
    function go_eff(__x) {
      let _t1329;
      const _t1328 = __x;
      _t1330: {
        if (_t1328._tag === 3) {
          const id = _t1328._val;
          if ((id < s.equant)) {
            _t1329 = Array$get(evars_1313, id);
            break _t1330;
          }
        }
        if (_t1328._tag === 2) {
          const label = _t1328._val[0];
          const params = _t1328._val[1];
          const tail = _t1328._val[2];
          _t1329 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
          break _t1330;
        }
        if (_t1328._tag === 1) {
          _t1329 = shared_eff_1322(undefined);
          break _t1330;
        }
        if (true) {
          const e = _t1328;
          _t1329 = e;
          break _t1330;
        }
        _match_fail("line 16190");
      }
      return _t1329;
    }
    function go_pv(__x) {
      let _t1332;
      const _t1331 = __x;
      _t1333: {
        if (_t1331._tag === 3) {
          const id = _t1331._val;
          if ((id < s.pvquant)) {
            _t1332 = Array$get(pvvars_1316, id);
            break _t1333;
          }
        }
        if (_t1331._tag === 0) {
          const tag = _t1331._val[0];
          const ty_opt = _t1331._val[1];
          const tail = _t1331._val[2];
          _t1332 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
          break _t1333;
        }
        if (true) {
          const r = _t1331;
          _t1332 = r;
          break _t1333;
        }
        _match_fail("line 16190");
      }
      return _t1332;
    }
    function go_rrow(__x) {
      let _t1335;
      const _t1334 = __x;
      _t1336: {
        if (_t1334._tag === 3) {
          const id = _t1334._val;
          if ((id < s.rquant)) {
            _t1335 = Array$get(rvars_1319, id);
            break _t1336;
          }
        }
        if (_t1334._tag === 0) {
          const name = _t1334._val[0];
          const ty = _t1334._val[1];
          const tail = _t1334._val[2];
          _t1335 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
          break _t1336;
        }
        if (true) {
          const r = _t1334;
          _t1335 = r;
          break _t1336;
        }
        _match_fail("line 16190");
      }
      return _t1335;
    }
    const _t1337 = go(s.body);
    const _t1323 = _t1337;
    const _t1320 = _t1323;
    const _t1317 = _t1320;
    const _t1314 = _t1317;
    const _t1311 = _t1314;
    _t1308 = _t1311;
  }
  return _t1308;
}
function Types$deep_repr(ty) {
  let _t1339;
  const _t1338 = Types$repr(ty);
  _t1340: {
    if (_t1338._tag === 7) {
      const a = _t1338._val[0];
      const eff = _t1338._val[1];
      const b = _t1338._val[2];
      _t1339 = ({_tag: 7, _name: "TArrow", _val: [Types$deep_repr(a), Types$deep_repr_eff(eff), Types$deep_repr(b)]});
      break _t1340;
    }
    if (_t1338._tag === 8) {
      const a = _t1338._val[0];
      const eff = _t1338._val[1];
      const b = _t1338._val[2];
      _t1339 = ({_tag: 8, _name: "TCont", _val: [Types$deep_repr(a), Types$deep_repr_eff(eff), Types$deep_repr(b)]});
      break _t1340;
    }
    if (_t1338._tag === 9) {
      const ts = _t1338._val;
      _t1339 = ({_tag: 9, _name: "TTuple", _val: List$map(Types$deep_repr, ts)});
      break _t1340;
    }
    if (_t1338._tag === 10) {
      const t = _t1338._val;
      _t1339 = ({_tag: 10, _name: "TList", _val: Types$deep_repr(t)});
      break _t1340;
    }
    if (_t1338._tag === 14) {
      const t = _t1338._val;
      _t1339 = ({_tag: 14, _name: "TArray", _val: Types$deep_repr(t)});
      break _t1340;
    }
    if (_t1338._tag === 13) {
      const k = _t1338._val[0];
      const v = _t1338._val[1];
      _t1339 = ({_tag: 13, _name: "TMap", _val: [Types$deep_repr(k), Types$deep_repr(v)]});
      break _t1340;
    }
    if (_t1338._tag === 11) {
      const row = _t1338._val;
      _t1339 = ({_tag: 11, _name: "TRecord", _val: Types$deep_repr_rrow(row)});
      break _t1340;
    }
    if (_t1338._tag === 12) {
      const name = _t1338._val[0];
      const args = _t1338._val[1];
      _t1339 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(Types$deep_repr, args)]});
      break _t1340;
    }
    if (_t1338._tag === 15) {
      const row = _t1338._val;
      _t1339 = ({_tag: 15, _name: "TPolyVariant", _val: Types$deep_repr_pv(row)});
      break _t1340;
    }
    if (true) {
      const t = _t1338;
      _t1339 = t;
      break _t1340;
    }
    _match_fail("line 16190");
  }
  return _t1339;
}
function Types$deep_repr_eff(eff) {
  let _t1342;
  const _t1341 = Types$eff_repr(eff);
  _t1343: {
    if (_t1341._tag === 2) {
      const label = _t1341._val[0];
      const params = _t1341._val[1];
      const tail = _t1341._val[2];
      _t1342 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(Types$deep_repr, params), Types$deep_repr_eff(tail)]});
      break _t1343;
    }
    if (true) {
      const e = _t1341;
      _t1342 = e;
      break _t1343;
    }
    _match_fail("line 16190");
  }
  return _t1342;
}
function Types$deep_repr_pv(row) {
  let _t1345;
  const _t1344 = Types$pv_repr(row);
  _t1346: {
    if (_t1344._tag === 0) {
      const tag = _t1344._val[0];
      const ty_opt = _t1344._val[1];
      const tail = _t1344._val[2];
      _t1345 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(Types$deep_repr, ty_opt), Types$deep_repr_pv(tail)]});
      break _t1346;
    }
    if (true) {
      const r = _t1344;
      _t1345 = r;
      break _t1346;
    }
    _match_fail("line 16190");
  }
  return _t1345;
}
function Types$deep_repr_rrow(row) {
  let _t1348;
  const _t1347 = Types$rrow_repr(row);
  _t1349: {
    if (_t1347._tag === 0) {
      const name = _t1347._val[0];
      const ty = _t1347._val[1];
      const tail = _t1347._val[2];
      _t1348 = ({_tag: 0, _name: "RRow", _val: [name, Types$deep_repr(ty), Types$deep_repr_rrow(tail)]});
      break _t1349;
    }
    if (true) {
      const r = _t1347;
      _t1348 = r;
      break _t1349;
    }
    _match_fail("line 16190");
  }
  return _t1348;
}
function Types$types_compatible(t1, t2) {
  while (true) {
    const t1_1350 = Types$repr(t1);
    const t2_1352 = Types$repr(t2);
    let _t1355;
    const _t1354 = [t1_1350, t2_1352];
    _t1356: {
      if ((_t1354[0]._tag === 16 || _t1354[1]._tag === 16)) {
        _t1355 = true;
        break _t1356;
      }
      if (((((((_t1354[0]._tag === 0 && _t1354[1]._tag === 0 || _t1354[0]._tag === 1 && _t1354[1]._tag === 1) || _t1354[0]._tag === 2 && _t1354[1]._tag === 2) || _t1354[0]._tag === 3 && _t1354[1]._tag === 3) || _t1354[0]._tag === 4 && _t1354[1]._tag === 4) || _t1354[0]._tag === 5 && _t1354[1]._tag === 5) || _t1354[0]._tag === 6 && _t1354[1]._tag === 6)) {
        _t1355 = true;
        break _t1356;
      }
      if ((_t1354[0]._tag === 7 && _t1354[1]._tag === 7 || _t1354[0]._tag === 8 && _t1354[1]._tag === 8)) {
        const a1 = _t1354[0]._val[0];
        const r1 = _t1354[0]._val[2];
        const a2 = _t1354[1]._val[0];
        const r2 = _t1354[1]._val[2];
        _t1355 = (Types$types_compatible(a1, a2) && Types$types_compatible(r1, r2));
        break _t1356;
      }
      if (_t1354[0]._tag === 9 && _t1354[1]._tag === 9) {
        const ts1 = _t1354[0]._val;
        const ts2 = _t1354[1]._val;
        _t1355 = ((List$length(ts1) === List$length(ts2)) && List$forall2(Types$types_compatible, ts1, ts2));
        break _t1356;
      }
      if (_t1354[0]._tag === 10 && _t1354[1]._tag === 10) {
        const t1 = _t1354[0]._val;
        const t2 = _t1354[1]._val;
        const _t1357 = t1;
        const _t1358 = t2;
        t1 = _t1357;
        t2 = _t1358;
        continue;
        _t1355 = undefined;
        break _t1356;
      }
      if (_t1354[0]._tag === 14 && _t1354[1]._tag === 14) {
        const t1 = _t1354[0]._val;
        const t2 = _t1354[1]._val;
        const _t1359 = t1;
        const _t1360 = t2;
        t1 = _t1359;
        t2 = _t1360;
        continue;
        _t1355 = undefined;
        break _t1356;
      }
      if (_t1354[0]._tag === 13 && _t1354[1]._tag === 13) {
        const k1 = _t1354[0]._val[0];
        const v1 = _t1354[0]._val[1];
        const k2 = _t1354[1]._val[0];
        const v2 = _t1354[1]._val[1];
        _t1355 = (Types$types_compatible(k1, k2) && Types$types_compatible(v1, v2));
        break _t1356;
      }
      if (_t1354[0]._tag === 11 && _t1354[1]._tag === 11) {
        const r1 = _t1354[0]._val;
        const r2 = _t1354[1]._val;
        const f1_1361 = Types$record_row_to_fields(r1);
        const f2_1363 = Types$record_row_to_fields(r2);
        let _t1372;
        if ((List$length(f1_1361) === List$length(f2_1363))) {
        function _t1365(__p18, __p19) {
          let _t1367;
          const _t1366 = __p18;
          _t1368: {
            if (true) {
              const n1 = _t1366[0];
              const t1 = _t1366[1];
              let _t1370;
              const _t1369 = __p19;
              _t1371: {
                if (true) {
                  const n2 = _t1369[0];
                  const t2 = _t1369[1];
                  _t1370 = ((n1 === n2) && Types$types_compatible(t1, t2));
                  break _t1371;
                }
                _match_fail("line 16190");
              }
              _t1367 = _t1370;
              break _t1368;
            }
            _match_fail("line 16190");
          }
          return _t1367;
        }
          _t1372 = List$forall2(_t1365, f1_1361, f2_1363);
        } else {
          _t1372 = false;
        }
        const _t1364 = _t1372;
        const _t1362 = _t1364;
        _t1355 = _t1362;
        break _t1356;
      }
      if (_t1354[0]._tag === 12 && _t1354[1]._tag === 12) {
        const a = _t1354[0]._val[0];
        const args_a = _t1354[0]._val[1];
        const b = _t1354[1]._val[0];
        const args_b = _t1354[1]._val[1];
        _t1355 = ((a === b) && ((List$length(args_a) === List$length(args_b)) && List$forall2(Types$types_compatible, args_a, args_b)));
        break _t1356;
      }
      if (_t1354[0]._tag === 15 && _t1354[1]._tag === 15) {
        const r1 = _t1354[0]._val;
        const r2 = _t1354[1]._val;
        _t1355 = Types$pvrows_compatible(r1, r2);
        break _t1356;
      }
      if (true) {
        _t1355 = false;
        break _t1356;
      }
      _match_fail("line 16190");
    }
    const _t1353 = _t1355;
    const _t1351 = _t1353;
    return _t1351;
  }
}
function Types$pvrows_compatible(r1, r2) {
  function collect(r) {
    let _t1374;
    const _t1373 = Types$pv_repr(r);
    _t1375: {
      if (_t1373._tag === 0) {
        const tag = _t1373._val[0];
        const ty_opt = _t1373._val[1];
        const tail = _t1373._val[2];
        _t1374 = ({_hd: [tag, ty_opt], _tl: collect(tail)});
        break _t1375;
      }
      if (true) {
        _t1374 = null;
        break _t1375;
      }
      _match_fail("line 16190");
    }
    return _t1374;
  }
  const tags1_1377 = collect(r1);
  const tags2_1379 = collect(r2);
  let _t1392;
  if ((List$length(tags1_1377) === List$length(tags2_1379))) {
  function _t1381(__p20, __p21) {
    let _t1383;
    const _t1382 = __p20;
    _t1384: {
      if (true) {
        const t1 = _t1382[0];
        const ty1 = _t1382[1];
        let _t1386;
        const _t1385 = __p21;
        _t1387: {
          if (true) {
            const t2 = _t1385[0];
            const ty2 = _t1385[1];
            let _t1391;
            if ((t1 === t2)) {
            let _t1389;
            const _t1388 = [ty1, ty2];
            _t1390: {
              if (_t1388[0]._tag === 0 && _t1388[1]._tag === 0) {
                _t1389 = true;
                break _t1390;
              }
              if (_t1388[0]._tag === 1 && _t1388[1]._tag === 1) {
                const a = _t1388[0]._val;
                const b = _t1388[1]._val;
                _t1389 = Types$types_compatible(a, b);
                break _t1390;
              }
              if (true) {
                _t1389 = false;
                break _t1390;
              }
              _match_fail("line 16190");
            }
              _t1391 = _t1389;
            } else {
              _t1391 = false;
            }
            _t1386 = _t1391;
            break _t1387;
          }
          _match_fail("line 16190");
        }
        _t1383 = _t1386;
        break _t1384;
      }
      _match_fail("line 16190");
    }
    return _t1383;
  }
    _t1392 = List$forall2(_t1381, tags1_1377, tags2_1379);
  } else {
    _t1392 = false;
  }
  const _t1380 = _t1392;
  const _t1378 = _t1380;
  const _t1376 = _t1378;
  return _t1376;
}
function Types$subtype(t1, t2) {
  while (true) {
    const t1_1393 = Types$repr(t1);
    const t2_1395 = Types$repr(t2);
    let _t1398;
    const _t1397 = [t1_1393, t2_1395];
    _t1399: {
      if (((((((_t1397[0]._tag === 0 && _t1397[1]._tag === 0 || _t1397[0]._tag === 1 && _t1397[1]._tag === 1) || _t1397[0]._tag === 2 && _t1397[1]._tag === 2) || _t1397[0]._tag === 3 && _t1397[1]._tag === 3) || _t1397[0]._tag === 4 && _t1397[1]._tag === 4) || _t1397[0]._tag === 5 && _t1397[1]._tag === 5) || _t1397[0]._tag === 6 && _t1397[1]._tag === 6)) {
        _t1398 = true;
        break _t1399;
      }
      if (_t1397[0]._tag === 12 && _t1397[1]._tag === 12) {
        const a = _t1397[0]._val[0];
        const args_a = _t1397[0]._val[1];
        const b = _t1397[1]._val[0];
        const args_b = _t1397[1]._val[1];
        _t1398 = ((a === b) && ((List$length(args_a) === List$length(args_b)) && List$forall2(Types$subtype, args_a, args_b)));
        break _t1399;
      }
      if ((_t1397[0]._tag === 7 && _t1397[1]._tag === 7 || _t1397[0]._tag === 8 && _t1397[1]._tag === 8)) {
        const a1 = _t1397[0]._val[0];
        const _e1 = _t1397[0]._val[1];
        const r1 = _t1397[0]._val[2];
        const a2 = _t1397[1]._val[0];
        const _e2 = _t1397[1]._val[1];
        const r2 = _t1397[1]._val[2];
        _t1398 = (Types$subtype(a2, a1) && Types$subtype(r1, r2));
        break _t1399;
      }
      if (_t1397[0]._tag === 11 && _t1397[1]._tag === 11) {
        const r1 = _t1397[0]._val;
        const r2 = _t1397[1]._val;
        const f1_1400 = Types$record_row_to_fields(r1);
        const f2_1402 = Types$record_row_to_fields(r2);
        function _t1404(__p22) {
          let _t1406;
          const _t1405 = __p22;
          _t1407: {
            if (true) {
              const f = _t1405[0];
              const t2$p = _t1405[1];
              let _t1409;
              const _t1408 = List$assoc_opt(f, f1_1400);
              _t1410: {
                if (_t1408._tag === 1) {
                  const t1$p = _t1408._val;
                  _t1409 = Types$subtype(t1$p, t2$p);
                  break _t1410;
                }
                if (_t1408._tag === 0) {
                  _t1409 = false;
                  break _t1410;
                }
                _match_fail("line 16190");
              }
              _t1406 = _t1409;
              break _t1407;
            }
            _match_fail("line 16190");
          }
          return _t1406;
        }
        const _t1403 = List$forall(_t1404, f2_1402);
        const _t1401 = _t1403;
        _t1398 = _t1401;
        break _t1399;
      }
      if (_t1397[0]._tag === 10 && _t1397[1]._tag === 10) {
        const t1$p = _t1397[0]._val;
        const t2$p = _t1397[1]._val;
        const _t1411 = t1$p;
        const _t1412 = t2$p;
        t1 = _t1411;
        t2 = _t1412;
        continue;
        _t1398 = undefined;
        break _t1399;
      }
      if (_t1397[0]._tag === 14 && _t1397[1]._tag === 14) {
        const t1$p = _t1397[0]._val;
        const t2$p = _t1397[1]._val;
        const _t1413 = t1$p;
        const _t1414 = t2$p;
        t1 = _t1413;
        t2 = _t1414;
        continue;
        _t1398 = undefined;
        break _t1399;
      }
      if (_t1397[0]._tag === 13 && _t1397[1]._tag === 13) {
        const k1 = _t1397[0]._val[0];
        const v1 = _t1397[0]._val[1];
        const k2 = _t1397[1]._val[0];
        const v2 = _t1397[1]._val[1];
        _t1398 = (Types$subtype(k1, k2) && Types$subtype(v1, v2));
        break _t1399;
      }
      if (_t1397[0]._tag === 9 && _t1397[1]._tag === 9) {
        const ts1 = _t1397[0]._val;
        const ts2 = _t1397[1]._val;
        _t1398 = ((List$length(ts1) === List$length(ts2)) && List$forall2(Types$subtype, ts1, ts2));
        break _t1399;
      }
      if (_t1397[0]._tag === 16 && _t1397[1]._tag === 16) {
        const r1 = _t1397[0]._val;
        const r2 = _t1397[1]._val;
        if (_eq(r1, r2)) {
          _t1398 = true;
          break _t1399;
        }
      }
      if (true) {
        _t1398 = false;
        break _t1399;
      }
      _match_fail("line 16190");
    }
    const _t1396 = _t1398;
    const _t1394 = _t1396;
    return _t1394;
  }
}
function Types$equal_ty(t1, t2) {
  while (true) {
    const t1_1415 = Types$repr(t1);
    const t2_1417 = Types$repr(t2);
    let _t1420;
    const _t1419 = [t1_1415, t2_1417];
    _t1421: {
      if (((((((_t1419[0]._tag === 0 && _t1419[1]._tag === 0 || _t1419[0]._tag === 1 && _t1419[1]._tag === 1) || _t1419[0]._tag === 2 && _t1419[1]._tag === 2) || _t1419[0]._tag === 3 && _t1419[1]._tag === 3) || _t1419[0]._tag === 4 && _t1419[1]._tag === 4) || _t1419[0]._tag === 5 && _t1419[1]._tag === 5) || _t1419[0]._tag === 6 && _t1419[1]._tag === 6)) {
        _t1420 = true;
        break _t1421;
      }
      if (_t1419[0]._tag === 12 && _t1419[1]._tag === 12) {
        const a = _t1419[0]._val[0];
        const args_a = _t1419[0]._val[1];
        const b = _t1419[1]._val[0];
        const args_b = _t1419[1]._val[1];
        _t1420 = ((a === b) && ((List$length(args_a) === List$length(args_b)) && List$forall2(Types$equal_ty, args_a, args_b)));
        break _t1421;
      }
      if ((_t1419[0]._tag === 7 && _t1419[1]._tag === 7 || _t1419[0]._tag === 8 && _t1419[1]._tag === 8)) {
        const a1 = _t1419[0]._val[0];
        const _e1 = _t1419[0]._val[1];
        const r1 = _t1419[0]._val[2];
        const a2 = _t1419[1]._val[0];
        const _e2 = _t1419[1]._val[1];
        const r2 = _t1419[1]._val[2];
        _t1420 = (Types$equal_ty(a1, a2) && Types$equal_ty(r1, r2));
        break _t1421;
      }
      if (_t1419[0]._tag === 11 && _t1419[1]._tag === 11) {
        const r1 = _t1419[0]._val;
        const r2 = _t1419[1]._val;
        const f1_1422 = Types$record_row_to_fields(r1);
        const f2_1424 = Types$record_row_to_fields(r2);
        let _t1433;
        if ((List$length(f1_1422) === List$length(f2_1424))) {
        function _t1426(__p23, __p24) {
          let _t1428;
          const _t1427 = __p23;
          _t1429: {
            if (true) {
              const n1 = _t1427[0];
              const t1 = _t1427[1];
              let _t1431;
              const _t1430 = __p24;
              _t1432: {
                if (true) {
                  const n2 = _t1430[0];
                  const t2 = _t1430[1];
                  _t1431 = ((n1 === n2) && Types$equal_ty(t1, t2));
                  break _t1432;
                }
                _match_fail("line 16190");
              }
              _t1428 = _t1431;
              break _t1429;
            }
            _match_fail("line 16190");
          }
          return _t1428;
        }
          _t1433 = List$forall2(_t1426, f1_1422, f2_1424);
        } else {
          _t1433 = false;
        }
        const _t1425 = _t1433;
        const _t1423 = _t1425;
        _t1420 = _t1423;
        break _t1421;
      }
      if (_t1419[0]._tag === 10 && _t1419[1]._tag === 10) {
        const t1$p = _t1419[0]._val;
        const t2$p = _t1419[1]._val;
        const _t1434 = t1$p;
        const _t1435 = t2$p;
        t1 = _t1434;
        t2 = _t1435;
        continue;
        _t1420 = undefined;
        break _t1421;
      }
      if (_t1419[0]._tag === 14 && _t1419[1]._tag === 14) {
        const t1$p = _t1419[0]._val;
        const t2$p = _t1419[1]._val;
        const _t1436 = t1$p;
        const _t1437 = t2$p;
        t1 = _t1436;
        t2 = _t1437;
        continue;
        _t1420 = undefined;
        break _t1421;
      }
      if (_t1419[0]._tag === 13 && _t1419[1]._tag === 13) {
        const k1 = _t1419[0]._val[0];
        const v1 = _t1419[0]._val[1];
        const k2 = _t1419[1]._val[0];
        const v2 = _t1419[1]._val[1];
        _t1420 = (Types$equal_ty(k1, k2) && Types$equal_ty(v1, v2));
        break _t1421;
      }
      if (_t1419[0]._tag === 9 && _t1419[1]._tag === 9) {
        const ts1 = _t1419[0]._val;
        const ts2 = _t1419[1]._val;
        _t1420 = ((List$length(ts1) === List$length(ts2)) && List$forall2(Types$equal_ty, ts1, ts2));
        break _t1421;
      }
      if (_t1419[0]._tag === 16 && _t1419[1]._tag === 16) {
        const r1 = _t1419[0]._val;
        const r2 = _t1419[1]._val;
        _t1420 = _eq(r1, r2);
        break _t1421;
      }
      if (true) {
        _t1420 = false;
        break _t1421;
      }
      _match_fail("line 16190");
    }
    const _t1418 = _t1420;
    const _t1416 = _t1418;
    return _t1416;
  }
}
function Types$freshen_unbound(ty) {
  const tbl_1438 = Hashtbl$create(4);
  function go(ty) {
    let _t1441;
    const _t1440 = Types$repr(ty);
    _t1442: {
      if (_t1440._tag === 16 && _t1440._val.contents._tag === 0) {
        const id = _t1440._val.contents._val[0];
        const level = _t1440._val.contents._val[1];
        let _t1444;
        const _t1443 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tbl_1438, id]);
        _t1445: {
          if (_t1443._tag === 1) {
            const tv = _t1443._val;
            _t1444 = tv;
            break _t1445;
          }
          if (_t1443._tag === 0) {
            const tv_1446 = Types$new_tvar(level);
            _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tbl_1438, id, tv_1446]);
            const _t1447 = tv_1446;
            _t1444 = _t1447;
            break _t1445;
          }
          _match_fail("line 16190");
        }
        _t1441 = _t1444;
        break _t1442;
      }
      if (_t1440._tag === 7) {
        const a = _t1440._val[0];
        const eff = _t1440._val[1];
        const r = _t1440._val[2];
        _t1441 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
        break _t1442;
      }
      if (_t1440._tag === 8) {
        const a = _t1440._val[0];
        const eff = _t1440._val[1];
        const r = _t1440._val[2];
        _t1441 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
        break _t1442;
      }
      if (_t1440._tag === 9) {
        const ts = _t1440._val;
        _t1441 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
        break _t1442;
      }
      if (_t1440._tag === 10) {
        const t = _t1440._val;
        _t1441 = ({_tag: 10, _name: "TList", _val: go(t)});
        break _t1442;
      }
      if (_t1440._tag === 14) {
        const t = _t1440._val;
        _t1441 = ({_tag: 14, _name: "TArray", _val: go(t)});
        break _t1442;
      }
      if (_t1440._tag === 13) {
        const k = _t1440._val[0];
        const v = _t1440._val[1];
        _t1441 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
        break _t1442;
      }
      if (_t1440._tag === 11) {
        const row = _t1440._val;
        _t1441 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
        break _t1442;
      }
      if (_t1440._tag === 15) {
        const row = _t1440._val;
        _t1441 = ({_tag: 15, _name: "TPolyVariant", _val: go_pv(row)});
        break _t1442;
      }
      if (_t1440._tag === 12) {
        const name = _t1440._val[0];
        const args = _t1440._val[1];
        _t1441 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
        break _t1442;
      }
      if (true) {
        const t = _t1440;
        _t1441 = t;
        break _t1442;
      }
      _match_fail("line 16190");
    }
    return _t1441;
  }
  function go_eff(eff) {
    let _t1449;
    const _t1448 = Types$eff_repr(eff);
    _t1450: {
      if (_t1448._tag === 2) {
        const label = _t1448._val[0];
        const tys = _t1448._val[1];
        const tail = _t1448._val[2];
        _t1449 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, tys), go_eff(tail)]});
        break _t1450;
      }
      if (true) {
        const e = _t1448;
        _t1449 = e;
        break _t1450;
      }
      _match_fail("line 16190");
    }
    return _t1449;
  }
  function go_rrow(__x) {
    let _t1452;
    const _t1451 = __x;
    _t1453: {
      if (_t1451._tag === 0) {
        const name = _t1451._val[0];
        const ty = _t1451._val[1];
        const tail = _t1451._val[2];
        _t1452 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
        break _t1453;
      }
      if (true) {
        const r = _t1451;
        _t1452 = r;
        break _t1453;
      }
      _match_fail("line 16190");
    }
    return _t1452;
  }
  function go_pv(__x) {
    let _t1455;
    const _t1454 = __x;
    _t1456: {
      if (_t1454._tag === 0) {
        const tag = _t1454._val[0];
        const payload = _t1454._val[1];
        const tail = _t1454._val[2];
        _t1455 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload), go_pv(tail)]});
        break _t1456;
      }
      if (true) {
        const p = _t1454;
        _t1455 = p;
        break _t1456;
      }
      _match_fail("line 16190");
    }
    return _t1455;
  }
  const _t1457 = go(ty);
  const _t1439 = _t1457;
  return _t1439;
}
function Types$match_partial_inst(inst_tys, partial) {
  let _t1459;
  const _t1458 = Hashtbl$create(4);
  _t1460: {
    if (true) {
      const bindings = _t1458;
      function match_one(inst, conc) {
        while (true) {
          let _t1462;
          const _t1461 = inst;
          _t1463: {
            if (_t1461._tag === 17) {
              const i = _t1461._val;
              let _t1465;
              const _t1464 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, bindings, i]);
              _t1466: {
                if (_t1464._tag === 1) {
                  const prev = _t1464._val;
                  let _t1467;
                  if (Types$equal_ty(prev, conc)) {
                    _t1467 = true;
                  } else {
                    const _t1468 = (function() {
                      const _t1469 = _h;
                      _h = Object.assign({}, _t1469, {
                        "unify_error": function(_, __k_try) { throw {_e: "unify_error", _v: _}; },
                      });
                      try {
                        Types$unify(prev, conc);
                        const __x_1470 = true;
                        return __x_1470;
                      } catch (_exc) {
                        if (_exc && _exc._e === "unify_error") {
                          const _ = _exc._v;
                          return false;
                        } else { throw _exc; }
                      } finally { _h = _t1469; }
                    })();
                    _t1467 = _t1468;
                  }
                  _t1465 = _t1467;
                  break _t1466;
                }
                if (_t1464._tag === 0) {
                  _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, bindings, i, conc]);
                  _t1465 = true;
                  break _t1466;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1465;
              break _t1463;
            }
            if (_t1461._tag === 0) {
              let _t1472;
              const _t1471 = Types$repr(conc);
              _t1473: {
                if (_t1471._tag === 0) {
                  _t1472 = true;
                  break _t1473;
                }
                if (true) {
                  _t1472 = false;
                  break _t1473;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1472;
              break _t1463;
            }
            if (_t1461._tag === 1) {
              let _t1475;
              const _t1474 = Types$repr(conc);
              _t1476: {
                if (_t1474._tag === 1) {
                  _t1475 = true;
                  break _t1476;
                }
                if (true) {
                  _t1475 = false;
                  break _t1476;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1475;
              break _t1463;
            }
            if (_t1461._tag === 2) {
              let _t1478;
              const _t1477 = Types$repr(conc);
              _t1479: {
                if (_t1477._tag === 2) {
                  _t1478 = true;
                  break _t1479;
                }
                if (true) {
                  _t1478 = false;
                  break _t1479;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1478;
              break _t1463;
            }
            if (_t1461._tag === 3) {
              let _t1481;
              const _t1480 = Types$repr(conc);
              _t1482: {
                if (_t1480._tag === 3) {
                  _t1481 = true;
                  break _t1482;
                }
                if (true) {
                  _t1481 = false;
                  break _t1482;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1481;
              break _t1463;
            }
            if (_t1461._tag === 6) {
              let _t1484;
              const _t1483 = Types$repr(conc);
              _t1485: {
                if (_t1483._tag === 6) {
                  _t1484 = true;
                  break _t1485;
                }
                if (true) {
                  _t1484 = false;
                  break _t1485;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1484;
              break _t1463;
            }
            if (_t1461._tag === 10) {
              const a = _t1461._val;
              let _t1487;
              const _t1486 = Types$repr(conc);
              _t1488: {
                if (_t1486._tag === 10) {
                  const b = _t1486._val;
                  const _t1489 = a;
                  const _t1490 = b;
                  inst = _t1489;
                  conc = _t1490;
                  continue;
                  _t1487 = undefined;
                  break _t1488;
                }
                if (true) {
                  _t1487 = false;
                  break _t1488;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1487;
              break _t1463;
            }
            if (_t1461._tag === 14) {
              const a = _t1461._val;
              let _t1492;
              const _t1491 = Types$repr(conc);
              _t1493: {
                if (_t1491._tag === 14) {
                  const b = _t1491._val;
                  const _t1494 = a;
                  const _t1495 = b;
                  inst = _t1494;
                  conc = _t1495;
                  continue;
                  _t1492 = undefined;
                  break _t1493;
                }
                if (true) {
                  _t1492 = false;
                  break _t1493;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1492;
              break _t1463;
            }
            if (_t1461._tag === 13) {
              const k1 = _t1461._val[0];
              const v1 = _t1461._val[1];
              let _t1497;
              const _t1496 = Types$repr(conc);
              _t1498: {
                if (_t1496._tag === 13) {
                  const k2 = _t1496._val[0];
                  const v2 = _t1496._val[1];
                  _t1497 = (match_one(k1, k2) && match_one(v1, v2));
                  break _t1498;
                }
                if (true) {
                  _t1497 = false;
                  break _t1498;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1497;
              break _t1463;
            }
            if (_t1461._tag === 9) {
              const ts1 = _t1461._val;
              let _t1500;
              const _t1499 = Types$repr(conc);
              _t1501: {
                if (_t1499._tag === 9) {
                  const ts2 = _t1499._val;
                  if ((List$length(ts1) === List$length(ts2))) {
                    _t1500 = List$forall2(match_one, ts1, ts2);
                    break _t1501;
                  }
                }
                if (true) {
                  _t1500 = false;
                  break _t1501;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1500;
              break _t1463;
            }
            if (_t1461._tag === 7) {
              const a1 = _t1461._val[0];
              const _e1 = _t1461._val[1];
              const a2 = _t1461._val[2];
              let _t1503;
              const _t1502 = Types$repr(conc);
              _t1504: {
                if (_t1502._tag === 7) {
                  const b1 = _t1502._val[0];
                  const _e2 = _t1502._val[1];
                  const b2 = _t1502._val[2];
                  _t1503 = (match_one(a1, b1) && match_one(a2, b2));
                  break _t1504;
                }
                if (true) {
                  _t1503 = false;
                  break _t1504;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1503;
              break _t1463;
            }
            if (_t1461._tag === 8) {
              const a1 = _t1461._val[0];
              const _e1 = _t1461._val[1];
              const a2 = _t1461._val[2];
              let _t1506;
              const _t1505 = Types$repr(conc);
              _t1507: {
                if (_t1505._tag === 8) {
                  const b1 = _t1505._val[0];
                  const _e2 = _t1505._val[1];
                  const b2 = _t1505._val[2];
                  _t1506 = (match_one(a1, b1) && match_one(a2, b2));
                  break _t1507;
                }
                if (true) {
                  _t1506 = false;
                  break _t1507;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1506;
              break _t1463;
            }
            if (_t1461._tag === 11) {
              const r1 = _t1461._val;
              let _t1509;
              const _t1508 = Types$repr(conc);
              _t1510: {
                if (_t1508._tag === 11) {
                  const r2 = _t1508._val;
                  const f1_1511 = Types$record_row_to_fields(r1);
                  const f2_1513 = Types$record_row_to_fields(r2);
                  let _t1522;
                  if ((List$length(f1_1511) === List$length(f2_1513))) {
                  function _t1515(__p25, __p26) {
                    let _t1517;
                    const _t1516 = __p25;
                    _t1518: {
                      if (true) {
                        const n1 = _t1516[0];
                        const t1 = _t1516[1];
                        let _t1520;
                        const _t1519 = __p26;
                        _t1521: {
                          if (true) {
                            const n2 = _t1519[0];
                            const t2 = _t1519[1];
                            _t1520 = ((n1 === n2) && match_one(t1, t2));
                            break _t1521;
                          }
                          _match_fail("line 16190");
                        }
                        _t1517 = _t1520;
                        break _t1518;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1517;
                  }
                    _t1522 = List$forall2(_t1515, f1_1511, f2_1513);
                  } else {
                    _t1522 = false;
                  }
                  const _t1514 = _t1522;
                  const _t1512 = _t1514;
                  _t1509 = _t1512;
                  break _t1510;
                }
                if (true) {
                  _t1509 = false;
                  break _t1510;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1509;
              break _t1463;
            }
            if (_t1461._tag === 12) {
              const a = _t1461._val[0];
              const args_inst = _t1461._val[1];
              let _t1524;
              const _t1523 = Types$repr(conc);
              _t1525: {
                if (_t1523._tag === 12) {
                  const b = _t1523._val[0];
                  const args_conc = _t1523._val[1];
                  if (((a === b) && (List$length(args_inst) === List$length(args_conc)))) {
                    _t1524 = List$forall2(match_one, args_inst, args_conc);
                    break _t1525;
                  }
                }
                if (true) {
                  _t1524 = false;
                  break _t1525;
                }
                _match_fail("line 16190");
              }
              _t1462 = _t1524;
              break _t1463;
            }
            if (true) {
              _t1462 = Types$equal_ty(inst, conc);
              break _t1463;
            }
            _match_fail("line 16190");
          }
          return _t1462;
        }
      }
      let _t1531;
      if ((List$length(inst_tys) === List$length(partial))) {
      function _t1527(inst_ty, found_opt) {
        let _t1529;
        const _t1528 = found_opt;
        _t1530: {
          if (_t1528._tag === 0) {
            _t1529 = true;
            break _t1530;
          }
          if (_t1528._tag === 1) {
            const conc_ty = _t1528._val;
            _t1529 = match_one(inst_ty, conc_ty);
            break _t1530;
          }
          _match_fail("line 16190");
        }
        return _t1529;
      }
        _t1531 = List$forall2(_t1527, inst_tys, partial);
      } else {
        _t1531 = false;
      }
      const _t1526 = _t1531;
      _t1459 = _t1526;
      break _t1460;
    }
    _match_fail("line 16190");
  }
  return _t1459;
}
function Types$inst_specificity(inst) {
  function count(__x) {
    while (true) {
      let _t1533;
      const _t1532 = __x;
      _t1534: {
        if (_t1532._tag === 17) {
          _t1533 = 0;
          break _t1534;
        }
        if (((((((_t1532._tag === 0 || _t1532._tag === 1) || _t1532._tag === 2) || _t1532._tag === 3) || _t1532._tag === 4) || _t1532._tag === 5) || _t1532._tag === 6)) {
          _t1533 = 1;
          break _t1534;
        }
        if ((_t1532._tag === 7 || _t1532._tag === 8)) {
          const a = _t1532._val[0];
          const b = _t1532._val[2];
          _t1533 = (count(a) + count(b));
          break _t1534;
        }
        if (_t1532._tag === 9) {
          const ts = _t1532._val;
          function _t1535(acc, t) {
            return (acc + count(t));
          }
          _t1533 = List$fold(_t1535, 0, ts);
          break _t1534;
        }
        if ((_t1532._tag === 10 || _t1532._tag === 14)) {
          const a = _t1532._val;
          const _t1536 = a;
          __x = _t1536;
          continue;
          _t1533 = undefined;
          break _t1534;
        }
        if (_t1532._tag === 13) {
          const k = _t1532._val[0];
          const v = _t1532._val[1];
          _t1533 = (count(k) + count(v));
          break _t1534;
        }
        if (_t1532._tag === 11) {
          const row = _t1532._val;
          function _t1537(acc, __p27) {
            let _t1539;
            const _t1538 = __p27;
            _t1540: {
              if (true) {
                const t = _t1538[1];
                _t1539 = (acc + count(t));
                break _t1540;
              }
              _match_fail("line 16190");
            }
            return _t1539;
          }
          _t1533 = List$fold(_t1537, 0, Types$record_row_to_fields(row));
          break _t1534;
        }
        if (_t1532._tag === 12) {
          const ts = _t1532._val[1];
          function _t1541(acc, t) {
            return (acc + count(t));
          }
          _t1533 = List$fold(_t1541, 0, ts);
          break _t1534;
        }
        if (_t1532._tag === 15) {
          _t1533 = 0;
          break _t1534;
        }
        if (_t1532._tag === 16 && _t1532._val.contents._tag === 1) {
          const t = _t1532._val.contents._val;
          const _t1542 = t;
          __x = _t1542;
          continue;
          _t1533 = undefined;
          break _t1534;
        }
        if (_t1532._tag === 16 && _t1532._val.contents._tag === 0) {
          _t1533 = 0;
          break _t1534;
        }
        _match_fail("line 16190");
      }
      return _t1533;
    }
  }
  function _t1544(acc, ty) {
    return (acc + count(ty));
  }
  const _t1543 = List$fold(_t1544, 0, inst.inst_tys);
  return _t1543;
}
function Types$most_specific_inst(insts) {
  let _t1546;
  const _t1545 = insts;
  _t1547: {
    if (_t1545 === null) {
      _t1546 = ({_tag: 0, _name: "None"});
      break _t1547;
    }
    if (_t1545 !== null && _t1545._tl === null) {
      const x = _t1545._hd;
      _t1546 = ({_tag: 1, _name: "Some", _val: x});
      break _t1547;
    }
    if (true) {
      function _t1548(i) {
        return [Types$inst_specificity(i), i];
      }
      const scored_1549 = List$map(_t1548, insts);
      function _t1551(__p28, __p29) {
        let _t1553;
        const _t1552 = __p28;
        _t1554: {
          if (true) {
            const a = _t1552[0];
            let _t1556;
            const _t1555 = __p29;
            _t1557: {
              if (true) {
                const b = _t1555[0];
                _t1556 = compare(b, a);
                break _t1557;
              }
              _match_fail("line 16190");
            }
            _t1553 = _t1556;
            break _t1554;
          }
          _match_fail("line 16190");
        }
        return _t1553;
      }
      const sorted_1558 = List$sort(_t1551, scored_1549);
      let _t1561;
      const _t1560 = sorted_1558;
      _t1562: {
        if (_t1560 !== null && _t1560._tl !== null) {
          const s1 = _t1560._hd[0];
          const i1 = _t1560._hd[1];
          const s2 = _t1560._tl._hd[0];
          if ((s1 > s2)) {
            _t1561 = ({_tag: 1, _name: "Some", _val: i1});
            break _t1562;
          }
        }
        if (true) {
          _t1561 = ({_tag: 0, _name: "None"});
          break _t1562;
        }
        _match_fail("line 16190");
      }
      const _t1559 = _t1561;
      const _t1550 = _t1559;
      _t1546 = _t1550;
      break _t1547;
    }
    _match_fail("line 16190");
  }
  return _t1546;
}
function Types$find_instance(instances, class_name, tys) {
  function _t1563(inst) {
    let _t1565;
    if ((inst.inst_class === class_name)) {
    function _t1564(t) {
      return ({_tag: 1, _name: "Some", _val: t});
    }
      _t1565 = Types$match_partial_inst(inst.inst_tys, List$map(_t1564, tys));
    } else {
      _t1565 = false;
    }
    return _t1565;
  }
  return List$find(_t1563, instances);
}
function Types$check_fundep_consistency(class_def, new_inst, existing_instances) {
  return _trampoline(function() {
    function _t1566(fd) {
      return _trampoline(function() {
        function _t1567(existing) {
          return _trampoline(function() {
            if ((!(existing.inst_class === new_inst.inst_class))) {
              return undefined;
            } else {
              if ((List$length(existing.inst_tys) !== List$length(new_inst.inst_tys))) {
                return undefined;
              } else {
                function _t1568(i) {
                  const ex_ty_1569 = List$nth(existing.inst_tys, i);
                  const new_ty_1571 = List$nth(new_inst.inst_tys, i);
                  const _t1572 = Types$equal_ty(ex_ty_1569, new_ty_1571);
                  const _t1570 = _t1572;
                  return _t1570;
                }
                const from_match_1573 = _resolve(List$forall(_t1568, fd.fd_from));
                if (from_match_1573) {
                  function _t1574(i) {
                    const ex_ty_1575 = List$nth(existing.inst_tys, i);
                    const new_ty_1577 = List$nth(new_inst.inst_tys, i);
                    const _t1578 = Types$equal_ty(ex_ty_1575, new_ty_1577);
                    const _t1576 = _t1578;
                    return _t1576;
                  }
                  const to_match_1579 = _resolve(List$forall(_t1574, fd.fd_to));
                  if ((!to_match_1579)) {
                    function _t1580(i) {
                      return Types$pp_ty(List$nth(new_inst.inst_tys, i));
                    }
                    const from_strs_1581 = _resolve(List$map(_t1580, fd.fd_from));
                    function _t1582(i) {
                      return Types$pp_ty(List$nth(new_inst.inst_tys, i));
                    }
                    const to_strs_new_1583 = _resolve(List$map(_t1582, fd.fd_to));
                    function _t1584(i) {
                      return Types$pp_ty(List$nth(existing.inst_tys, i));
                    }
                    const to_strs_ex_1585 = _resolve(List$map(_t1584, fd.fd_to));
                    return _h["unify_error"](((((((("functional dependency violation in class " + __dict_Show_string.show(class_def.class_name)) + ": type(s) ") + __dict_Show_string.show(String$concat(", ", from_strs_1581))) + " determine ") + __dict_Show_string.show(String$concat(", ", to_strs_new_1583))) + ", but existing instance has ") + __dict_Show_string.show(String$concat(", ", to_strs_ex_1585))), function(_t1586) {
                      return _bounce(function() {
                        return _t1586;
                      });
                    });
                  } else {
                    return undefined;
                  }
                } else {
                  return undefined;
                }
              }
            }
          });
        }
        const _t1587 = _resolve(List$iter(_t1567, existing_instances));
        return _t1587;
      });
    }
    const _t1588 = _resolve(List$iter(_t1566, class_def.class_fundeps));
    return _t1588;
  }, Types$check_fundep_consistency);
}
function Types$improve_with_fundeps(instances, class_def, partial) {
  function _t1589(partial, fd) {
    function _t1590(i) {
      return ((i < List$length(partial)) && !_eq(List$nth(partial, i), ({_tag: 0, _name: "None"})));
    }
    const from_known_1591 = List$forall(_t1590, fd.fd_from);
    let _t1593;
    if ((!from_known_1591)) {
      _t1593 = partial;
    } else {
      function _t1594(i, opt) {
        let _t1595;
        if (List$mem(i, fd.fd_from)) {
          _t1595 = opt;
        } else {
          _t1595 = ({_tag: 0, _name: "None"});
        }
        return _t1595;
      }
      const from_partial_1596 = List$mapi(_t1594, partial);
      function _t1598(inst) {
        return ((inst.inst_class === class_def.class_name) && ((List$length(inst.inst_tys) === List$length(partial)) && Types$match_partial_inst(inst.inst_tys, from_partial_1596)));
      }
      const matching_1599 = List$filter(_t1598, instances);
      let _t1602;
      const _t1601 = matching_1599;
      _t1603: {
        if (_t1601 !== null && _t1601._tl === null) {
          const inst = _t1601._hd;
          let _t1605;
          const _t1604 = Hashtbl$create(4);
          _t1606: {
            if (true) {
              const subst = _t1604;
              function _t1607(i) {
                const inst_ty_1608 = List$nth(inst.inst_tys, i);
                const conc_ty_1610 = Option$unwrap(List$nth(partial, i));
                function extract_bindings(pat, conc) {
                  while (true) {
                    let _t1613;
                    const _t1612 = [pat, Types$repr(conc)];
                    _t1614: {
                      if (_t1612[0]._tag === 17) {
                        const g = _t1612[0]._val;
                        const ty = _t1612[1];
                        _t1613 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, subst, g, ty]);
                        break _t1614;
                      }
                      if (_t1612[0]._tag === 10 && _t1612[1]._tag === 10) {
                        const a = _t1612[0]._val;
                        const b = _t1612[1]._val;
                        const _t1615 = a;
                        const _t1616 = b;
                        pat = _t1615;
                        conc = _t1616;
                        continue;
                        _t1613 = undefined;
                        break _t1614;
                      }
                      if (_t1612[0]._tag === 14 && _t1612[1]._tag === 14) {
                        const a = _t1612[0]._val;
                        const b = _t1612[1]._val;
                        const _t1617 = a;
                        const _t1618 = b;
                        pat = _t1617;
                        conc = _t1618;
                        continue;
                        _t1613 = undefined;
                        break _t1614;
                      }
                      if (_t1612[0]._tag === 13 && _t1612[1]._tag === 13) {
                        const k1 = _t1612[0]._val[0];
                        const v1 = _t1612[0]._val[1];
                        const k2 = _t1612[1]._val[0];
                        const v2 = _t1612[1]._val[1];
                        extract_bindings(k1, k2);
                        const _t1619 = v1;
                        const _t1620 = v2;
                        pat = _t1619;
                        conc = _t1620;
                        continue;
                        _t1613 = undefined;
                        break _t1614;
                      }
                      if (_t1612[0]._tag === 9 && _t1612[1]._tag === 9) {
                        const ts1 = _t1612[0]._val;
                        const ts2 = _t1612[1]._val;
                        if ((List$length(ts1) === List$length(ts2))) {
                          _t1613 = List$iter2(extract_bindings, ts1, ts2);
                          break _t1614;
                        }
                      }
                      if (_t1612[0]._tag === 12 && _t1612[1]._tag === 12) {
                        const args1 = _t1612[0]._val[1];
                        const args2 = _t1612[1]._val[1];
                        if ((List$length(args1) === List$length(args2))) {
                          _t1613 = List$iter2(extract_bindings, args1, args2);
                          break _t1614;
                        }
                      }
                      if ((_t1612[0]._tag === 7 && _t1612[1]._tag === 7 || _t1612[0]._tag === 8 && _t1612[1]._tag === 8)) {
                        const a1 = _t1612[0]._val[0];
                        const r1 = _t1612[0]._val[2];
                        const a2 = _t1612[1]._val[0];
                        const r2 = _t1612[1]._val[2];
                        extract_bindings(a1, a2);
                        const _t1621 = r1;
                        const _t1622 = r2;
                        pat = _t1621;
                        conc = _t1622;
                        continue;
                        _t1613 = undefined;
                        break _t1614;
                      }
                      if (true) {
                        _t1613 = undefined;
                        break _t1614;
                      }
                      _match_fail("line 16190");
                    }
                    return _t1613;
                  }
                }
                const _t1623 = extract_bindings(inst_ty_1608, conc_ty_1610);
                const _t1611 = _t1623;
                const _t1609 = _t1611;
                return _t1609;
              }
              List$iter(_t1607, fd.fd_from);
              function apply_subst(ty) {
                let _t1625;
                const _t1624 = ty;
                _t1626: {
                  if (_t1624._tag === 17) {
                    const g = _t1624._val;
                    let _t1628;
                    const _t1627 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, subst, g]);
                    _t1629: {
                      if (_t1627._tag === 1) {
                        const t = _t1627._val;
                        _t1628 = t;
                        break _t1629;
                      }
                      if (_t1627._tag === 0) {
                        _t1628 = ty;
                        break _t1629;
                      }
                      _match_fail("line 16190");
                    }
                    _t1625 = _t1628;
                    break _t1626;
                  }
                  if (_t1624._tag === 10) {
                    const a = _t1624._val;
                    _t1625 = ({_tag: 10, _name: "TList", _val: apply_subst(a)});
                    break _t1626;
                  }
                  if (_t1624._tag === 14) {
                    const a = _t1624._val;
                    _t1625 = ({_tag: 14, _name: "TArray", _val: apply_subst(a)});
                    break _t1626;
                  }
                  if (_t1624._tag === 13) {
                    const k = _t1624._val[0];
                    const v = _t1624._val[1];
                    _t1625 = ({_tag: 13, _name: "TMap", _val: [apply_subst(k), apply_subst(v)]});
                    break _t1626;
                  }
                  if (_t1624._tag === 9) {
                    const ts = _t1624._val;
                    _t1625 = ({_tag: 9, _name: "TTuple", _val: List$map(apply_subst, ts)});
                    break _t1626;
                  }
                  if (_t1624._tag === 12) {
                    const n = _t1624._val[0];
                    const args = _t1624._val[1];
                    _t1625 = ({_tag: 12, _name: "TVariant", _val: [n, List$map(apply_subst, args)]});
                    break _t1626;
                  }
                  if (_t1624._tag === 7) {
                    const a = _t1624._val[0];
                    const e = _t1624._val[1];
                    const r = _t1624._val[2];
                    _t1625 = ({_tag: 7, _name: "TArrow", _val: [apply_subst(a), e, apply_subst(r)]});
                    break _t1626;
                  }
                  if (_t1624._tag === 8) {
                    const a = _t1624._val[0];
                    const e = _t1624._val[1];
                    const r = _t1624._val[2];
                    _t1625 = ({_tag: 8, _name: "TCont", _val: [apply_subst(a), e, apply_subst(r)]});
                    break _t1626;
                  }
                  if (true) {
                    _t1625 = ty;
                    break _t1626;
                  }
                  _match_fail("line 16190");
                }
                return _t1625;
              }
              function _t1631(i, opt) {
                let _t1632;
                if (!_eq(opt, ({_tag: 0, _name: "None"}))) {
                  _t1632 = opt;
                } else {
                  let _t1633;
                  if (List$mem(i, fd.fd_to)) {
                    _t1633 = ({_tag: 1, _name: "Some", _val: apply_subst(List$nth(inst.inst_tys, i))});
                  } else {
                    _t1633 = opt;
                  }
                  _t1632 = _t1633;
                }
                return _t1632;
              }
              const _t1630 = List$mapi(_t1631, partial);
              _t1605 = _t1630;
              break _t1606;
            }
            _match_fail("line 16190");
          }
          _t1602 = _t1605;
          break _t1603;
        }
        if (true) {
          _t1602 = partial;
          break _t1603;
        }
        _match_fail("line 16190");
      }
      const _t1600 = _t1602;
      const _t1597 = _t1600;
      _t1593 = _t1597;
    }
    const _t1592 = _t1593;
    return _t1592;
  }
  return List$fold(_t1589, partial, class_def.class_fundeps);
}
function Lexer$create(source) {
  return ({col: 1, cursor: 0, len: String$length(source), line: 1, source: source});
}
function Lexer$current_loc(l) {
  return ({col: l.col, line: l.line, offset: l.cursor});
}
function Lexer$make_token(l, kind, loc) {
  return ({end_offset: l.cursor, kind: kind, loc: loc});
}
function Lexer$at_end(l) {
  return (l.cursor >= l.len);
}
function Lexer$peek(l) {
  let _t1634;
  if (Lexer$at_end(l)) {
    _t1634 = 0;
  } else {
    _t1634 = String$get(l.source, l.cursor);
  }
  return _t1634;
}
function Lexer$peek2(l) {
  let _t1635;
  if (((l.cursor + 1) >= l.len)) {
    _t1635 = 0;
  } else {
    _t1635 = String$get(l.source, (l.cursor + 1));
  }
  return _t1635;
}
function Lexer$peek3(l) {
  let _t1636;
  if (((l.cursor + 2) >= l.len)) {
    _t1636 = 0;
  } else {
    _t1636 = String$get(l.source, (l.cursor + 2));
  }
  return _t1636;
}
function Lexer$advance(l) {
  const c_1637 = String$get(l.source, l.cursor);
  (l.cursor = (l.cursor + 1), undefined);
  let _t1639;
  if ((c_1637 === 10)) {
    (l.line = (l.line + 1), undefined);
    _t1639 = (l.col = 1, undefined);
  } else {
    _t1639 = (l.col = (l.col + 1), undefined);
  }
  _t1639;
  const _t1638 = c_1637;
  return _t1638;
}
function Lexer$error(l, msg) {
  return _trampoline(function() {
    return _h["lex_error"]([msg, Lexer$current_loc(l)], function(_t1640) {
      return _bounce(function() {
        return _t1640;
      });
    });
  }, Lexer$error);
}
function Lexer$skip_whitespace(l) {
  let _t1641 = undefined;
  let _t1642 = false, _t1643;
  while (true) {
    if (!(((!Lexer$at_end(l)) && ((Lexer$peek(l) === 32) || ((Lexer$peek(l) === 9) || ((Lexer$peek(l) === 10) || (Lexer$peek(l) === 13))))))) break;
    Lexer$advance(l);
    undefined;
    if (_t1642) break;
  }
  _t1641 = _t1642 ? _t1643 : undefined;
  return _t1641;
}
function Lexer$skip_comment(l) {
  const depth_1644 = Ref$create(1);
  let _t1646 = undefined;
  let _t1647 = false, _t1648;
  while (true) {
    if (!((Ref$get(depth_1644) > 0))) break;
    let _t1649;
    if (Lexer$at_end(l)) {
      _t1649 = Lexer$error(l, "unterminated comment");
    } else {
      _t1649 = undefined;
    }
    _t1649;
    let _t1650;
    if (((Lexer$peek(l) === 40) && (Lexer$peek2(l) === 42))) {
      Lexer$advance(l);
      undefined;
      Lexer$advance(l);
      undefined;
      _t1650 = Ref$set(depth_1644, (Ref$get(depth_1644) + 1));
    } else {
      let _t1651;
      if (((Lexer$peek(l) === 42) && (Lexer$peek2(l) === 41))) {
        Lexer$advance(l);
        undefined;
        Lexer$advance(l);
        undefined;
        _t1651 = Ref$set(depth_1644, (Ref$get(depth_1644) - 1));
      } else {
        Lexer$advance(l);
        _t1651 = undefined;
      }
      _t1650 = _t1651;
    }
    _t1650;
    if (_t1647) break;
  }
  _t1646 = _t1647 ? _t1648 : undefined;
  const _t1645 = _t1646;
  return _t1645;
}
function Lexer$skip_whitespace_and_comments(l) {
  const changed_1652 = Ref$create(true);
  let _t1654 = undefined;
  let _t1655 = false, _t1656;
  while (true) {
    if (!(Ref$get(changed_1652))) break;
    Ref$set(changed_1652, false);
    const p_1657 = l.cursor;
    Lexer$skip_whitespace(l);
    let _t1659;
    if (((!Lexer$at_end(l)) && ((Lexer$peek(l) === 40) && ((Lexer$peek2(l) === 42) && (Lexer$peek3(l) !== 41))))) {
      Lexer$advance(l);
      undefined;
      Lexer$advance(l);
      undefined;
      Lexer$skip_comment(l);
      _t1659 = Ref$set(changed_1652, true);
    } else {
      _t1659 = undefined;
    }
    _t1659;
    let _t1660;
    if ((l.cursor !== p_1657)) {
      _t1660 = Ref$set(changed_1652, true);
    } else {
      _t1660 = undefined;
    }
    const _t1658 = _t1660;
    _t1658;
    if (_t1655) break;
  }
  _t1654 = _t1655 ? _t1656 : undefined;
  const _t1653 = _t1654;
  return _t1653;
}
function Lexer$is_digit(c) {
  return ((c >= 48) && (c <= 57));
}
function Lexer$is_hex_digit(c) {
  return (Lexer$is_digit(c) || (((c >= 97) && (c <= 102)) || ((c >= 65) && (c <= 70))));
}
function Lexer$hex_val(c) {
  let _t1661;
  if (((c >= 48) && (c <= 57))) {
    _t1661 = (Byte$to_int(c) - Byte$to_int(48));
  } else {
    let _t1662;
    if (((c >= 97) && (c <= 102))) {
      _t1662 = ((Byte$to_int(c) - Byte$to_int(97)) + 10);
    } else {
      _t1662 = ((Byte$to_int(c) - Byte$to_int(65)) + 10);
    }
    _t1661 = _t1662;
  }
  return _t1661;
}
function Lexer$is_alpha(c) {
  return (((c >= 97) && (c <= 122)) || ((c >= 65) && (c <= 90)));
}
function Lexer$is_ident_start(c) {
  return (Lexer$is_alpha(c) || (c === 95));
}
function Lexer$is_ident_char(c) {
  return (Lexer$is_alpha(c) || (Lexer$is_digit(c) || ((c === 95) || (c === 39))));
}
const Lexer$keywords = ({_hd: ["let", ({_tag: 11, _name: "LET"})], _tl: ({_hd: ["rec", ({_tag: 12, _name: "REC"})], _tl: ({_hd: ["in", ({_tag: 13, _name: "IN"})], _tl: ({_hd: ["if", ({_tag: 14, _name: "IF"})], _tl: ({_hd: ["else", ({_tag: 15, _name: "ELSE"})], _tl: ({_hd: ["fn", ({_tag: 16, _name: "FN"})], _tl: ({_hd: ["match", ({_tag: 17, _name: "MATCH"})], _tl: ({_hd: ["with", ({_tag: 18, _name: "WITH"})], _tl: ({_hd: ["type", ({_tag: 19, _name: "TYPE"})], _tl: ({_hd: ["of", ({_tag: 20, _name: "OF"})], _tl: ({_hd: ["not", ({_tag: 39, _name: "NOT"})], _tl: ({_hd: ["mod", ({_tag: 42, _name: "MOD"})], _tl: ({_hd: ["true", ({_tag: 6, _name: "TRUE"})], _tl: ({_hd: ["false", ({_tag: 7, _name: "FALSE"})], _tl: ({_hd: ["class", ({_tag: 21, _name: "CLASS"})], _tl: ({_hd: ["instance", ({_tag: 22, _name: "INSTANCE"})], _tl: ({_hd: ["effect", ({_tag: 23, _name: "EFFECT"})], _tl: ({_hd: ["extern", ({_tag: 24, _name: "EXTERN"})], _tl: ({_hd: ["perform", ({_tag: 25, _name: "PERFORM"})], _tl: ({_hd: ["handle", ({_tag: 26, _name: "HANDLE"})], _tl: ({_hd: ["try", ({_tag: 27, _name: "TRY"})], _tl: ({_hd: ["provide", ({_tag: 28, _name: "PROVIDE"})], _tl: ({_hd: ["resume", ({_tag: 30, _name: "RESUME"})], _tl: ({_hd: ["return", ({_tag: 31, _name: "RETURN"})], _tl: ({_hd: ["continue", ({_tag: 29, _name: "CONTINUE"})], _tl: ({_hd: ["mut", ({_tag: 32, _name: "MUT"})], _tl: ({_hd: ["for", ({_tag: 33, _name: "FOR"})], _tl: ({_hd: ["do", ({_tag: 34, _name: "DO"})], _tl: ({_hd: ["break", ({_tag: 35, _name: "BREAK"})], _tl: ({_hd: ["when", ({_tag: 36, _name: "WHEN"})], _tl: ({_hd: ["where", ({_tag: 37, _name: "WHERE"})], _tl: ({_hd: ["module", ({_tag: 43, _name: "MODULE"})], _tl: ({_hd: ["pub", ({_tag: 44, _name: "PUB"})], _tl: ({_hd: ["open", ({_tag: 45, _name: "OPEN"})], _tl: ({_hd: ["end", ({_tag: 46, _name: "END"})], _tl: ({_hd: ["opaque", ({_tag: 47, _name: "OPAQUE"})], _tl: ({_hd: ["and", ({_tag: 49, _name: "AND"})], _tl: ({_hd: ["deriving", ({_tag: 50, _name: "DERIVING"})], _tl: ({_hd: ["land", ({_tag: 82, _name: "LAND"})], _tl: ({_hd: ["lor", ({_tag: 83, _name: "LOR"})], _tl: ({_hd: ["lxor", ({_tag: 84, _name: "LXOR"})], _tl: ({_hd: ["lnot", ({_tag: 85, _name: "LNOT"})], _tl: ({_hd: ["lsl", ({_tag: 86, _name: "LSL"})], _tl: ({_hd: ["lsr", ({_tag: 87, _name: "LSR"})], _tl: null})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})});
function Lexer$read_number(l) {
  const loc_1663 = Lexer$current_loc(l);
  const buf_1665 = Buffer$create(16);
  const c_1667 = Lexer$advance(l);
  Buffer$add_byte(buf_1665, c_1667);
  let _t1669;
  if (((c_1667 === 48) && ((!Lexer$at_end(l)) && ((Lexer$peek(l) === 120) || (Lexer$peek(l) === 88))))) {
    Buffer$add_byte(buf_1665, Lexer$advance(l));
    let _t1670 = undefined;
    let _t1671 = false, _t1672;
    while (true) {
      if (!(((!Lexer$at_end(l)) && Lexer$is_hex_digit(Lexer$peek(l))))) break;
      Buffer$add_byte(buf_1665, Lexer$advance(l));
      if (_t1671) break;
    }
    _t1670 = _t1671 ? _t1672 : undefined;
    _t1670;
    const n_1673 = int_of_string(Buffer$contents(buf_1665));
    const _t1674 = Lexer$make_token(l, ({_tag: 0, _name: "INT", _val: n_1673}), loc_1663);
    _t1669 = _t1674;
  } else {
    let _t1675;
    if (((c_1667 === 48) && ((!Lexer$at_end(l)) && ((Lexer$peek(l) === 98) || (Lexer$peek(l) === 66))))) {
      Buffer$add_byte(buf_1665, Lexer$advance(l));
      let _t1676 = undefined;
      let _t1677 = false, _t1678;
      while (true) {
        if (!(((!Lexer$at_end(l)) && ((Lexer$peek(l) === 48) || (Lexer$peek(l) === 49))))) break;
        Buffer$add_byte(buf_1665, Lexer$advance(l));
        if (_t1677) break;
      }
      _t1676 = _t1677 ? _t1678 : undefined;
      _t1676;
      const n_1679 = int_of_string(Buffer$contents(buf_1665));
      const _t1680 = Lexer$make_token(l, ({_tag: 0, _name: "INT", _val: n_1679}), loc_1663);
      _t1675 = _t1680;
    } else {
      let _t1681 = undefined;
      let _t1682 = false, _t1683;
      while (true) {
        if (!(((!Lexer$at_end(l)) && Lexer$is_digit(Lexer$peek(l))))) break;
        Buffer$add_byte(buf_1665, Lexer$advance(l));
        if (_t1682) break;
      }
      _t1681 = _t1682 ? _t1683 : undefined;
      _t1681;
      let _t1684;
      if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 46))) {
        Buffer$add_byte(buf_1665, Lexer$advance(l));
        let _t1685 = undefined;
        let _t1686 = false, _t1687;
        while (true) {
          if (!(((!Lexer$at_end(l)) && Lexer$is_digit(Lexer$peek(l))))) break;
          Buffer$add_byte(buf_1665, Lexer$advance(l));
          if (_t1686) break;
        }
        _t1685 = _t1686 ? _t1687 : undefined;
        _t1685;
        const f_1688 = float_of_string(Buffer$contents(buf_1665));
        const _t1689 = Lexer$make_token(l, ({_tag: 1, _name: "FLOAT", _val: f_1688}), loc_1663);
        _t1684 = _t1689;
      } else {
        const n_1690 = int_of_string(Buffer$contents(buf_1665));
        const _t1691 = Lexer$make_token(l, ({_tag: 0, _name: "INT", _val: n_1690}), loc_1663);
        _t1684 = _t1691;
      }
      _t1675 = _t1684;
    }
    _t1669 = _t1675;
  }
  const _t1668 = _t1669;
  const _t1666 = _t1668;
  const _t1664 = _t1666;
  return _t1664;
}
function Lexer$read_string(l) {
  const loc_1692 = Lexer$current_loc(l);
  Lexer$advance(l);
  undefined;
  const buf_1694 = Buffer$create(64);
  let _t1696 = undefined;
  let _t1697 = false, _t1698;
  while (true) {
    if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 34)))) break;
    let _t1699;
    if ((Lexer$peek(l) === 92)) {
      Lexer$advance(l);
      undefined;
      let _t1700;
      if (Lexer$at_end(l)) {
        _t1700 = Lexer$error(l, "unterminated string");
      } else {
        _t1700 = undefined;
      }
      _t1700;
      const c_1701 = Lexer$advance(l);
      let _t1704;
      const _t1703 = c_1701;
      _t1705: {
        if (true) {
          const _c = _t1703;
          if ((_c === 110)) {
            _t1704 = Buffer$add_byte(buf_1694, 10);
            break _t1705;
          }
        }
        if (true) {
          const _c = _t1703;
          if ((_c === 116)) {
            _t1704 = Buffer$add_byte(buf_1694, 9);
            break _t1705;
          }
        }
        if (true) {
          const _c = _t1703;
          if ((_c === 92)) {
            _t1704 = Buffer$add_byte(buf_1694, 92);
            break _t1705;
          }
        }
        if (true) {
          const _c = _t1703;
          if ((_c === 34)) {
            _t1704 = Buffer$add_byte(buf_1694, 34);
            break _t1705;
          }
        }
        if (true) {
          _t1704 = Lexer$error(l, ("unknown escape: \\" + __dict_Show_byte.show(c_1701)));
          break _t1705;
        }
        _match_fail("line 16190");
      }
      const _t1702 = _t1704;
      _t1699 = _t1702;
    } else {
      _t1699 = Buffer$add_byte(buf_1694, Lexer$advance(l));
    }
    _t1699;
    if (_t1697) break;
  }
  _t1696 = _t1697 ? _t1698 : undefined;
  _t1696;
  let _t1706;
  if (Lexer$at_end(l)) {
    _t1706 = Lexer$error(l, "unterminated string");
  } else {
    _t1706 = undefined;
  }
  _t1706;
  Lexer$advance(l);
  undefined;
  const _t1695 = Lexer$make_token(l, ({_tag: 2, _name: "STRING", _val: Buffer$contents(buf_1694)}), loc_1692);
  const _t1693 = _t1695;
  return _t1693;
}
function Lexer$dedent_raw(s) {
  const lines_1707 = String$split("\n", s);
  let _t1710;
  const _t1709 = lines_1707;
  _t1711: {
    if (_t1709 !== null) {
      const first = _t1709._hd;
      const rest = _t1709._tl;
      if ((String$trim(first) === "")) {
        _t1710 = rest;
        break _t1711;
      }
    }
    if (true) {
      _t1710 = lines_1707;
      break _t1711;
    }
    _match_fail("line 16190");
  }
  const lines_1712 = _t1710;
  let _t1715;
  const _t1714 = List$rev(lines_1712);
  _t1716: {
    if (_t1714 !== null) {
      const last = _t1714._hd;
      const rest = _t1714._tl;
      if ((String$trim(last) === "")) {
        _t1715 = List$rev(rest);
        break _t1716;
      }
    }
    if (true) {
      _t1715 = lines_1712;
      break _t1716;
    }
    _match_fail("line 16190");
  }
  const lines_1717 = _t1715;
  function _t1719(acc, line) {
    let _t1720;
    if ((String$trim(line) === "")) {
      _t1720 = acc;
    } else {
      const len_1721 = String$length(line);
      const i_1723 = Ref$create(0);
      let _t1725 = undefined;
      let _t1726 = false, _t1727;
      while (true) {
        if (!(((Ref$get(i_1723) < len_1721) && ((String$get(line, Ref$get(i_1723)) === 32) || (String$get(line, Ref$get(i_1723)) === 9))))) break;
        Ref$set(i_1723, (Ref$get(i_1723) + 1));
        if (_t1726) break;
      }
      _t1725 = _t1726 ? _t1727 : undefined;
      _t1725;
      let _t1729;
      const _t1728 = acc;
      _t1730: {
        if (_t1728._tag === 0) {
          _t1729 = ({_tag: 1, _name: "Some", _val: Ref$get(i_1723)});
          break _t1730;
        }
        if (_t1728._tag === 1) {
          const prev = _t1728._val;
          _t1729 = ({_tag: 1, _name: "Some", _val: min(prev, Ref$get(i_1723))});
          break _t1730;
        }
        _match_fail("line 16190");
      }
      const _t1724 = _t1729;
      const _t1722 = _t1724;
      _t1720 = _t1722;
    }
    return _t1720;
  }
  const indent_1731 = List$fold(_t1719, ({_tag: 0, _name: "None"}), lines_1717);
  let _t1734;
  const _t1733 = indent_1731;
  _t1735: {
    if (_t1733._tag === 1) {
      const n = _t1733._val;
      _t1734 = n;
      break _t1735;
    }
    if (_t1733._tag === 0) {
      _t1734 = 0;
      break _t1735;
    }
    _match_fail("line 16190");
  }
  const indent_1736 = _t1734;
  function _t1738(line) {
    const len_1739 = String$length(line);
    let _t1741;
    if ((len_1739 >= indent_1736)) {
      _t1741 = String$sub(line, indent_1736, (len_1739 - indent_1736));
    } else {
      _t1741 = line;
    }
    const _t1740 = _t1741;
    return _t1740;
  }
  const lines_1742 = List$map(_t1738, lines_1717);
  const _t1743 = String$concat("\n", lines_1742);
  const _t1737 = _t1743;
  const _t1732 = _t1737;
  const _t1718 = _t1732;
  const _t1713 = _t1718;
  const _t1708 = _t1713;
  return _t1708;
}
function Lexer$read_raw_string(l) {
  const loc_1744 = Lexer$current_loc(l);
  Lexer$advance(l);
  undefined;
  Lexer$advance(l);
  undefined;
  const buf_1746 = Buffer$create(256);
  let _t1748 = undefined;
  let _t1749 = false, _t1750;
  while (true) {
    if (!(((!Lexer$at_end(l)) && (!((Lexer$peek(l) === 124) && (Lexer$peek2(l) === 125)))))) break;
    Buffer$add_byte(buf_1746, Lexer$advance(l));
    if (_t1749) break;
  }
  _t1748 = _t1749 ? _t1750 : undefined;
  _t1748;
  let _t1751;
  if (Lexer$at_end(l)) {
    _t1751 = Lexer$error(l, "unterminated raw string");
  } else {
    _t1751 = undefined;
  }
  _t1751;
  Lexer$advance(l);
  undefined;
  Lexer$advance(l);
  undefined;
  const raw_1752 = Buffer$contents(buf_1746);
  const _t1753 = Lexer$make_token(l, ({_tag: 2, _name: "STRING", _val: Lexer$dedent_raw(raw_1752)}), loc_1744);
  const _t1747 = _t1753;
  const _t1745 = _t1747;
  return _t1745;
}
function Lexer$read_interp_string(l) {
  const loc_1754 = Lexer$current_loc(l);
  Lexer$advance(l);
  undefined;
  Lexer$advance(l);
  undefined;
  const parts_1756 = Ref$create(null);
  const buf_1758 = Buffer$create(64);
  function _t1760(_) {
    let _t1761;
    if ((Buffer$length(buf_1758) > 0)) {
      Ref$set(parts_1756, ({_hd: ({_tag: 0, _name: "IPLit", _val: Buffer$contents(buf_1758)}), _tl: Ref$get(parts_1756)}));
      _t1761 = Buffer$clear(buf_1758);
    } else {
      _t1761 = undefined;
    }
    return _t1761;
  }
  const flush_lit_1762 = _t1760;
  let _t1764 = undefined;
  let _t1765 = false, _t1766;
  while (true) {
    if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 34)))) break;
    let _t1767;
    if ((Lexer$peek(l) === 92)) {
      Lexer$advance(l);
      undefined;
      let _t1768;
      if (Lexer$at_end(l)) {
        _t1768 = Lexer$error(l, "unterminated interpolated string");
      } else {
        _t1768 = undefined;
      }
      _t1768;
      const c_1769 = Lexer$advance(l);
      let _t1772;
      const _t1771 = c_1769;
      _t1773: {
        if (true) {
          const _c = _t1771;
          if ((_c === 110)) {
            _t1772 = Buffer$add_byte(buf_1758, 10);
            break _t1773;
          }
        }
        if (true) {
          const _c = _t1771;
          if ((_c === 116)) {
            _t1772 = Buffer$add_byte(buf_1758, 9);
            break _t1773;
          }
        }
        if (true) {
          const _c = _t1771;
          if ((_c === 92)) {
            _t1772 = Buffer$add_byte(buf_1758, 92);
            break _t1773;
          }
        }
        if (true) {
          const _c = _t1771;
          if ((_c === 34)) {
            _t1772 = Buffer$add_byte(buf_1758, 34);
            break _t1773;
          }
        }
        if (true) {
          const _c = _t1771;
          if ((_c === 123)) {
            _t1772 = Buffer$add_byte(buf_1758, 123);
            break _t1773;
          }
        }
        if (true) {
          const _c = _t1771;
          if ((_c === 125)) {
            _t1772 = Buffer$add_byte(buf_1758, 125);
            break _t1773;
          }
        }
        if (true) {
          _t1772 = Lexer$error(l, ("unknown escape: \\" + __dict_Show_byte.show(c_1769)));
          break _t1773;
        }
        _match_fail("line 16190");
      }
      const _t1770 = _t1772;
      _t1767 = _t1770;
    } else {
      let _t1774;
      if ((Lexer$peek(l) === 123)) {
        flush_lit_1762(undefined);
        Lexer$advance(l);
        undefined;
        const expr_buf_1775 = Buffer$create(64);
        const fmt_buf_1777 = Buffer$create(16);
        const depth_1779 = Ref$create(1);
        const paren_depth_1781 = Ref$create(0);
        const in_fmt_1783 = Ref$create(false);
        let _t1785 = undefined;
        let _t1786 = false, _t1787;
        while (true) {
          if (!((Ref$get(depth_1779) > 0))) break;
          let _t1788;
          if (Lexer$at_end(l)) {
            _t1788 = Lexer$error(l, "unterminated interpolation expression");
          } else {
            _t1788 = undefined;
          }
          _t1788;
          const c_1789 = Lexer$peek(l);
          let _t1791;
          if ((c_1789 === 123)) {
            Ref$set(depth_1779, (Ref$get(depth_1779) + 1));
            let _t1792;
            if (Ref$get(in_fmt_1783)) {
              _t1792 = fmt_buf_1777;
            } else {
              _t1792 = expr_buf_1775;
            }
            _t1791 = Buffer$add_byte(_t1792, Lexer$advance(l));
          } else {
            let _t1793;
            if ((c_1789 === 125)) {
              Ref$set(depth_1779, (Ref$get(depth_1779) - 1));
              let _t1794;
              if ((Ref$get(depth_1779) > 0)) {
                let _t1795;
                if (Ref$get(in_fmt_1783)) {
                  _t1795 = fmt_buf_1777;
                } else {
                  _t1795 = expr_buf_1775;
                }
                _t1794 = Buffer$add_byte(_t1795, Lexer$advance(l));
              } else {
                Lexer$advance(l);
                _t1794 = undefined;
              }
              _t1793 = _t1794;
            } else {
              let _t1796;
              if ((c_1789 === 40)) {
                Ref$set(paren_depth_1781, (Ref$get(paren_depth_1781) + 1));
                let _t1797;
                if (Ref$get(in_fmt_1783)) {
                  _t1797 = fmt_buf_1777;
                } else {
                  _t1797 = expr_buf_1775;
                }
                _t1796 = Buffer$add_byte(_t1797, Lexer$advance(l));
              } else {
                let _t1798;
                if ((c_1789 === 41)) {
                  let _t1799;
                  if ((Ref$get(paren_depth_1781) > 0)) {
                    _t1799 = Ref$set(paren_depth_1781, (Ref$get(paren_depth_1781) - 1));
                  } else {
                    _t1799 = undefined;
                  }
                  _t1799;
                  let _t1800;
                  if (Ref$get(in_fmt_1783)) {
                    _t1800 = fmt_buf_1777;
                  } else {
                    _t1800 = expr_buf_1775;
                  }
                  _t1798 = Buffer$add_byte(_t1800, Lexer$advance(l));
                } else {
                  let _t1801;
                  if (((c_1789 === 58) && ((Ref$get(depth_1779) === 1) && ((Ref$get(paren_depth_1781) === 0) && (!Ref$get(in_fmt_1783)))))) {
                    Lexer$advance(l);
                    undefined;
                    _t1801 = Ref$set(in_fmt_1783, true);
                  } else {
                    let _t1802;
                    if ((c_1789 === 34)) {
                      let _t1803;
                      if (Ref$get(in_fmt_1783)) {
                        _t1803 = fmt_buf_1777;
                      } else {
                        _t1803 = expr_buf_1775;
                      }
                      const buf_1804 = _t1803;
                      Buffer$add_byte(buf_1804, Lexer$advance(l));
                      let _t1806 = undefined;
                      let _t1807 = false, _t1808;
                      while (true) {
                        if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 34)))) break;
                        let _t1809;
                        if ((Lexer$peek(l) === 92)) {
                          Buffer$add_byte(buf_1804, Lexer$advance(l));
                          let _t1810;
                          if ((!Lexer$at_end(l))) {
                            _t1810 = Buffer$add_byte(buf_1804, Lexer$advance(l));
                          } else {
                            _t1810 = undefined;
                          }
                          _t1809 = _t1810;
                        } else {
                          _t1809 = Buffer$add_byte(buf_1804, Lexer$advance(l));
                        }
                        _t1809;
                        if (_t1807) break;
                      }
                      _t1806 = _t1807 ? _t1808 : undefined;
                      _t1806;
                      let _t1811;
                      if ((!Lexer$at_end(l))) {
                        _t1811 = Buffer$add_byte(buf_1804, Lexer$advance(l));
                      } else {
                        _t1811 = undefined;
                      }
                      const _t1805 = _t1811;
                      _t1802 = _t1805;
                    } else {
                      let _t1812;
                      if (Ref$get(in_fmt_1783)) {
                        _t1812 = fmt_buf_1777;
                      } else {
                        _t1812 = expr_buf_1775;
                      }
                      _t1802 = Buffer$add_byte(_t1812, Lexer$advance(l));
                    }
                    _t1801 = _t1802;
                  }
                  _t1798 = _t1801;
                }
                _t1796 = _t1798;
              }
              _t1793 = _t1796;
            }
            _t1791 = _t1793;
          }
          const _t1790 = _t1791;
          _t1790;
          if (_t1786) break;
        }
        _t1785 = _t1786 ? _t1787 : undefined;
        _t1785;
        let _t1813;
        if (Ref$get(in_fmt_1783)) {
          _t1813 = ({_tag: 1, _name: "Some", _val: Buffer$contents(fmt_buf_1777)});
        } else {
          _t1813 = ({_tag: 0, _name: "None"});
        }
        const fmt_1814 = _t1813;
        const _t1815 = Ref$set(parts_1756, ({_hd: ({_tag: 1, _name: "IPExpr", _val: [Buffer$contents(expr_buf_1775), fmt_1814]}), _tl: Ref$get(parts_1756)}));
        const _t1784 = _t1815;
        const _t1782 = _t1784;
        const _t1780 = _t1782;
        const _t1778 = _t1780;
        const _t1776 = _t1778;
        _t1774 = _t1776;
      } else {
        _t1774 = Buffer$add_byte(buf_1758, Lexer$advance(l));
      }
      _t1767 = _t1774;
    }
    _t1767;
    if (_t1765) break;
  }
  _t1764 = _t1765 ? _t1766 : undefined;
  _t1764;
  let _t1816;
  if (Lexer$at_end(l)) {
    _t1816 = Lexer$error(l, "unterminated interpolated string");
  } else {
    _t1816 = undefined;
  }
  _t1816;
  Lexer$advance(l);
  undefined;
  flush_lit_1762(undefined);
  const _t1763 = Lexer$make_token(l, ({_tag: 3, _name: "INTERP_STRING", _val: List$rev(Ref$get(parts_1756))}), loc_1754);
  const _t1759 = _t1763;
  const _t1757 = _t1759;
  const _t1755 = _t1757;
  return _t1755;
}
function Lexer$read_ident_or_keyword(l) {
  const loc_1817 = Lexer$current_loc(l);
  const buf_1819 = Buffer$create(32);
  let _t1821 = undefined;
  let _t1822 = false, _t1823;
  while (true) {
    if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
    Buffer$add_byte(buf_1819, Lexer$advance(l));
    if (_t1822) break;
  }
  _t1821 = _t1822 ? _t1823 : undefined;
  _t1821;
  const s_1824 = Buffer$contents(buf_1819);
  let _t1827;
  const _t1826 = List$assoc_opt(s_1824, Lexer$keywords);
  _t1828: {
    if (_t1826._tag === 1) {
      const kw = _t1826._val;
      _t1827 = kw;
      break _t1828;
    }
    if (_t1826._tag === 0) {
      let _t1829;
      if ((s_1824 === "_")) {
        _t1829 = ({_tag: 66, _name: "UNDERSCORE"});
      } else {
        let _t1830;
        if (((Byte$to_upper(String$get(s_1824, 0)) === String$get(s_1824, 0)) && (String$get(s_1824, 0) !== 95))) {
          _t1830 = ({_tag: 9, _name: "UIDENT", _val: s_1824});
        } else {
          _t1830 = ({_tag: 8, _name: "IDENT", _val: s_1824});
        }
        _t1829 = _t1830;
      }
      _t1827 = _t1829;
      break _t1828;
    }
    _match_fail("line 16190");
  }
  const kind_1831 = _t1827;
  const _t1832 = Lexer$make_token(l, kind_1831, loc_1817);
  const _t1825 = _t1832;
  const _t1820 = _t1825;
  const _t1818 = _t1820;
  return _t1818;
}
function Lexer$next_token(l) {
  while (true) {
    Lexer$skip_whitespace_and_comments(l);
    let _t1833;
    if (Lexer$at_end(l)) {
      _t1833 = Lexer$make_token(l, ({_tag: 90, _name: "EOF"}), Lexer$current_loc(l));
    } else {
      const loc_1834 = Lexer$current_loc(l);
      const c_1836 = Lexer$peek(l);
      let _t1839;
      const _t1838 = c_1836;
      _t1840: {
        if (true) {
          const _c = _t1838;
          if (((_c >= 48) && (_c <= 57))) {
            _t1839 = Lexer$read_number(l);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((((_c === 36) && (!Lexer$at_end(l))) && (Lexer$peek2(l) === 34))) {
            _t1839 = Lexer$read_interp_string(l);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 34)) {
            _t1839 = Lexer$read_string(l);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((((_c === 39) && (Lexer$peek2(l) >= 97)) && ((Lexer$peek2(l) <= 122) && (Lexer$peek3(l) !== 39)))) {
            const loc_1841 = Lexer$current_loc(l);
            Lexer$advance(l);
            undefined;
            const buf_1843 = Buffer$create(8);
            let _t1845 = undefined;
            let _t1846 = false, _t1847;
            while (true) {
              if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
              Buffer$add_byte(buf_1843, Lexer$advance(l));
              if (_t1846) break;
            }
            _t1845 = _t1846 ? _t1847 : undefined;
            _t1845;
            const _t1844 = Lexer$make_token(l, ({_tag: 10, _name: "TYVAR", _val: Buffer$contents(buf_1843)}), loc_1841);
            const _t1842 = _t1844;
            _t1839 = _t1842;
            break _t1840;
          }
        }
        if (true) {
          if (Lexer$is_ident_start(c_1836)) {
            _t1839 = Lexer$read_ident_or_keyword(l);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 39)) {
            const loc_1848 = Lexer$current_loc(l);
            Lexer$advance(l);
            undefined;
            let _t1850;
            if (Lexer$at_end(l)) {
              _t1850 = Lexer$error(l, "unterminated rune literal");
            } else {
              _t1850 = undefined;
            }
            _t1850;
            let _t1851;
            if ((Lexer$peek(l) === 92)) {
              Lexer$advance(l);
              undefined;
              let _t1852;
              if (Lexer$at_end(l)) {
                _t1852 = Lexer$error(l, "unterminated rune escape");
              } else {
                _t1852 = undefined;
              }
              _t1852;
              const c_1853 = Lexer$advance(l);
              let _t1856;
              const _t1855 = c_1853;
              _t1857: {
                if (true) {
                  const _c = _t1855;
                  if ((_c === 110)) {
                    _t1856 = 10;
                    break _t1857;
                  }
                }
                if (true) {
                  const _c = _t1855;
                  if ((_c === 116)) {
                    _t1856 = 9;
                    break _t1857;
                  }
                }
                if (true) {
                  const _c = _t1855;
                  if ((_c === 92)) {
                    _t1856 = 92;
                    break _t1857;
                  }
                }
                if (true) {
                  const _c = _t1855;
                  if ((_c === 39)) {
                    _t1856 = 39;
                    break _t1857;
                  }
                }
                if (true) {
                  const _c = _t1855;
                  if ((_c === 48)) {
                    _t1856 = 0;
                    break _t1857;
                  }
                }
                if (true) {
                  _t1856 = Lexer$error(l, ("unknown rune escape: \\" + __dict_Show_byte.show(c_1853)));
                  break _t1857;
                }
                _match_fail("line 16190");
              }
              const _t1854 = _t1856;
              _t1851 = _t1854;
            } else {
              const b_1858 = Byte$to_int(Lexer$advance(l));
              let _t1860;
              if ((b_1858 < 128)) {
                _t1860 = b_1858;
              } else {
                let _t1861;
                if (((b_1858 & 224) === 192)) {
                  _t1861 = 2;
                } else {
                  let _t1862;
                  if (((b_1858 & 240) === 224)) {
                    _t1862 = 3;
                  } else {
                    let _t1863;
                    if (((b_1858 & 248) === 240)) {
                      _t1863 = 4;
                    } else {
                      _t1863 = Lexer$error(l, "invalid UTF-8 leading byte in rune literal");
                    }
                    _t1862 = _t1863;
                  }
                  _t1861 = _t1862;
                }
                const nbytes_1864 = _t1861;
                const cp_1866 = Ref$create((b_1858 & (255 >> (nbytes_1864 + 1))));
                let _loop_var_1868 = 2;
                let _t1870 = undefined;
                let _t1871 = false, _t1872;
                while (true) {
                  if (!((_loop_var_1868 <= nbytes_1864))) break;
                  let _t1873;
                  if (Lexer$at_end(l)) {
                    _t1873 = Lexer$error(l, "unterminated UTF-8 rune literal");
                  } else {
                    _t1873 = undefined;
                  }
                  _t1873;
                  const cont_1874 = Byte$to_int(Lexer$advance(l));
                  let _t1876;
                  if (((cont_1874 & 192) !== 128)) {
                    _t1876 = Lexer$error(l, "invalid UTF-8 continuation byte");
                  } else {
                    _t1876 = undefined;
                  }
                  _t1876;
                  Ref$set(cp_1866, ((Ref$get(cp_1866) << 6) | (cont_1874 & 63)));
                  const _t1875 = (_loop_var_1868 = (_loop_var_1868 + 1), undefined);
                  _t1875;
                  if (_t1871) break;
                }
                _t1870 = _t1871 ? _t1872 : undefined;
                _t1870;
                const _t1869 = Ref$get(cp_1866);
                const _t1867 = _t1869;
                const _t1865 = _t1867;
                _t1860 = _t1865;
              }
              const _t1859 = _t1860;
              _t1851 = _t1859;
            }
            const cp_1877 = _t1851;
            let _t1879;
            if ((Lexer$at_end(l) || (Lexer$peek(l) !== 39))) {
              _t1879 = Lexer$error(l, "unterminated rune literal");
            } else {
              _t1879 = undefined;
            }
            _t1879;
            Lexer$advance(l);
            undefined;
            const _t1878 = Lexer$make_token(l, ({_tag: 5, _name: "RUNE", _val: cp_1877}), loc_1848);
            const _t1849 = _t1878;
            _t1839 = _t1849;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 40)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 51, _name: "LPAREN"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 41)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 52, _name: "RPAREN"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 35)) {
            Lexer$advance(l);
            undefined;
            let _t1880;
            if (((!Lexer$at_end(l)) && (Lexer$is_hex_digit(Lexer$peek(l)) && (((l.cursor + 1) < l.len) && Lexer$is_hex_digit(Lexer$peek2(l)))))) {
              const c1_1881 = Lexer$peek(l);
              Lexer$advance(l);
              undefined;
              const c2_1883 = Lexer$advance(l);
              const v_1885 = ((Lexer$hex_val(c1_1881) * 16) + Lexer$hex_val(c2_1883));
              const _t1886 = Lexer$make_token(l, ({_tag: 4, _name: "BYTE", _val: v_1885}), loc_1834);
              const _t1884 = _t1886;
              const _t1882 = _t1884;
              _t1880 = _t1882;
            } else {
              _t1880 = Lexer$make_token(l, ({_tag: 40, _name: "HASH"}), loc_1834);
            }
            _t1839 = _t1880;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 123)) {
            let _t1887;
            if ((Lexer$peek2(l) === 124)) {
              _t1887 = Lexer$read_raw_string(l);
            } else {
              Lexer$advance(l);
              undefined;
              _t1887 = Lexer$make_token(l, ({_tag: 53, _name: "LBRACE"}), loc_1834);
            }
            _t1839 = _t1887;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 125)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 54, _name: "RBRACE"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 91)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 55, _name: "LBRACKET"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 93)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 56, _name: "RBRACKET"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 44)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 58, _name: "COMMA"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 46)) {
            Lexer$advance(l);
            undefined;
            let _t1888;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 46))) {
              Lexer$advance(l);
              undefined;
              _t1888 = Lexer$make_token(l, ({_tag: 63, _name: "DOTDOT"}), loc_1834);
            } else {
              _t1888 = Lexer$make_token(l, ({_tag: 62, _name: "DOT"}), loc_1834);
            }
            _t1839 = _t1888;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 94)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 71, _name: "CARET"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 64)) {
            Lexer$advance(l);
            undefined;
            const buf_1889 = Buffer$create(16);
            let _t1891 = undefined;
            let _t1892 = false, _t1893;
            while (true) {
              let _t1896;
              if ((!Lexer$at_end(l))) {
              const c_1894 = Lexer$peek(l);
              const _t1895 = (((c_1894 >= 97) && (c_1894 <= 122)) || (c_1894 === 95));
                _t1896 = _t1895;
              } else {
                _t1896 = false;
              }
              if (!(_t1896)) break;
              Buffer$add_byte(buf_1889, Lexer$advance(l));
              if (_t1892) break;
            }
            _t1891 = _t1892 ? _t1893 : undefined;
            _t1891;
            const name_1897 = Buffer$contents(buf_1889);
            let _t1899;
            if ((name_1897 === "partial")) {
              _t1899 = Lexer$make_token(l, ({_tag: 38, _name: "PARTIAL"}), loc_1834);
            } else {
              _t1899 = Lexer$error(l, ("unknown annotation @" + __dict_Show_string.show(name_1897)));
            }
            const _t1898 = _t1899;
            const _t1890 = _t1898;
            _t1839 = _t1890;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 43)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 67, _name: "PLUS"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 42)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 69, _name: "STAR"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 47)) {
            Lexer$advance(l);
            undefined;
            _t1839 = Lexer$make_token(l, ({_tag: 70, _name: "SLASH"}), loc_1834);
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 45)) {
            Lexer$advance(l);
            undefined;
            let _t1900;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 45))) {
              Lexer$advance(l);
              undefined;
              let _t1901 = undefined;
              let _t1902 = false, _t1903;
              while (true) {
                if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 10)))) break;
                Lexer$advance(l);
                undefined;
                if (_t1902) break;
              }
              _t1901 = _t1902 ? _t1903 : undefined;
              _t1901;
              const _t1904 = l;
              l = _t1904;
              continue;
              _t1900 = undefined;
            } else {
              let _t1905;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                Lexer$advance(l);
                undefined;
                _t1905 = Lexer$make_token(l, ({_tag: 57, _name: "ARROW"}), loc_1834);
              } else {
                _t1905 = Lexer$make_token(l, ({_tag: 68, _name: "MINUS"}), loc_1834);
              }
              _t1900 = _t1905;
            }
            _t1839 = _t1900;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 59)) {
            Lexer$advance(l);
            undefined;
            let _t1906;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 59))) {
              Lexer$advance(l);
              undefined;
              _t1906 = Lexer$make_token(l, ({_tag: 60, _name: "DOUBLE_SEMICOLON"}), loc_1834);
            } else {
              _t1906 = Lexer$make_token(l, ({_tag: 59, _name: "SEMICOLON"}), loc_1834);
            }
            _t1839 = _t1906;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 58)) {
            Lexer$advance(l);
            undefined;
            let _t1907;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 61))) {
              Lexer$advance(l);
              undefined;
              _t1907 = Lexer$make_token(l, ({_tag: 73, _name: "COLONEQUAL"}), loc_1834);
            } else {
              let _t1908;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 58))) {
                Lexer$advance(l);
                undefined;
                _t1908 = Lexer$make_token(l, ({_tag: 72, _name: "COLONCOLON"}), loc_1834);
              } else {
                let _t1909;
                if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                  Lexer$advance(l);
                  undefined;
                  _t1909 = Lexer$make_token(l, ({_tag: 89, _name: "COLONGT"}), loc_1834);
                } else {
                  _t1909 = Lexer$make_token(l, ({_tag: 61, _name: "COLON"}), loc_1834);
                }
                _t1908 = _t1909;
              }
              _t1907 = _t1908;
            }
            _t1839 = _t1907;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 61)) {
            Lexer$advance(l);
            undefined;
            let _t1910;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
              Lexer$advance(l);
              undefined;
              _t1910 = Lexer$make_token(l, ({_tag: 41, _name: "FATARROW"}), loc_1834);
            } else {
              _t1910 = Lexer$make_token(l, ({_tag: 74, _name: "EQ"}), loc_1834);
            }
            _t1839 = _t1910;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 60)) {
            Lexer$advance(l);
            undefined;
            let _t1911;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 61))) {
              Lexer$advance(l);
              undefined;
              _t1911 = Lexer$make_token(l, ({_tag: 78, _name: "LE"}), loc_1834);
            } else {
              let _t1912;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                Lexer$advance(l);
                undefined;
                _t1912 = Lexer$make_token(l, ({_tag: 75, _name: "NEQ"}), loc_1834);
              } else {
                _t1912 = Lexer$make_token(l, ({_tag: 76, _name: "LT"}), loc_1834);
              }
              _t1911 = _t1912;
            }
            _t1839 = _t1911;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 62)) {
            Lexer$advance(l);
            undefined;
            let _t1913;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 61))) {
              Lexer$advance(l);
              undefined;
              _t1913 = Lexer$make_token(l, ({_tag: 79, _name: "GE"}), loc_1834);
            } else {
              _t1913 = Lexer$make_token(l, ({_tag: 77, _name: "GT"}), loc_1834);
            }
            _t1839 = _t1913;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 38)) {
            Lexer$advance(l);
            undefined;
            let _t1914;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 38))) {
              Lexer$advance(l);
              undefined;
              _t1914 = Lexer$make_token(l, ({_tag: 80, _name: "AMPAMP"}), loc_1834);
            } else {
              _t1914 = Lexer$error(l, "unexpected '&', did you mean '&&'?");
            }
            _t1839 = _t1914;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 124)) {
            Lexer$advance(l);
            undefined;
            let _t1915;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 124))) {
              Lexer$advance(l);
              undefined;
              _t1915 = Lexer$make_token(l, ({_tag: 81, _name: "PIPEPIPE"}), loc_1834);
            } else {
              let _t1916;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                Lexer$advance(l);
                undefined;
                _t1916 = Lexer$make_token(l, ({_tag: 65, _name: "PIPEARROW"}), loc_1834);
              } else {
                _t1916 = Lexer$make_token(l, ({_tag: 64, _name: "PIPE"}), loc_1834);
              }
              _t1915 = _t1916;
            }
            _t1839 = _t1915;
            break _t1840;
          }
        }
        if (true) {
          const _c = _t1838;
          if ((_c === 96)) {
            Lexer$advance(l);
            undefined;
            let _t1917;
            if (((!Lexer$at_end(l)) && ((Lexer$peek(l) >= 65) && (Lexer$peek(l) <= 90)))) {
              const buf_1918 = Buffer$create(16);
              let _t1920 = undefined;
              let _t1921 = false, _t1922;
              while (true) {
                if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
                Buffer$add_byte(buf_1918, Lexer$advance(l));
                if (_t1921) break;
              }
              _t1920 = _t1921 ? _t1922 : undefined;
              _t1920;
              const _t1919 = Lexer$make_token(l, ({_tag: 88, _name: "POLYTAG", _val: Buffer$contents(buf_1918)}), loc_1834);
              _t1917 = _t1919;
            } else {
              _t1917 = Lexer$error(l, "expected uppercase identifier after backtick");
            }
            _t1839 = _t1917;
            break _t1840;
          }
        }
        if (true) {
          _t1839 = Lexer$error(l, ("unexpected character: " + __dict_Show_byte.show(c_1836)));
          break _t1840;
        }
        _match_fail("line 16190");
      }
      const _t1837 = _t1839;
      const _t1835 = _t1837;
      _t1833 = _t1835;
    }
    return _t1833;
  }
}
function Lexer$tokenize(source) {
  const l_1923 = Lexer$create(source);
  const tokens_1925 = Ref$create(null);
  const stop_1927 = Ref$create(false);
  let _t1929 = undefined;
  let _t1930 = false, _t1931;
  while (true) {
    if (!((!Ref$get(stop_1927)))) break;
    const tok_1932 = Lexer$next_token(l_1923);
    Ref$set(tokens_1925, ({_hd: tok_1932, _tl: Ref$get(tokens_1925)}));
    let _t1934;
    if (_eq(tok_1932.kind, ({_tag: 90, _name: "EOF"}))) {
      _t1934 = Ref$set(stop_1927, true);
    } else {
      _t1934 = undefined;
    }
    const _t1933 = _t1934;
    _t1933;
    if (_t1930) break;
  }
  _t1929 = _t1930 ? _t1931 : undefined;
  _t1929;
  const _t1928 = List$rev(Ref$get(tokens_1925));
  const _t1926 = _t1928;
  const _t1924 = _t1926;
  return _t1924;
}
function Parser$create(tokens) {
  return ({pos: 0, tokens: Array$of_list(tokens)});
}
function Parser$peek(p) {
  return Array$get(p.tokens, p.pos);
}
function Parser$peek_kind(p) {
  return Parser$peek(p).kind;
}
function Parser$peek_kind_at(p, offset) {
  const idx_1935 = (p.pos + offset);
  let _t1937;
  if ((idx_1935 < Array$length(p.tokens))) {
    _t1937 = Array$get(p.tokens, idx_1935).kind;
  } else {
    _t1937 = ({_tag: 90, _name: "EOF"});
  }
  const _t1936 = _t1937;
  return _t1936;
}
function Parser$advance(p) {
  const tok_1938 = Array$get(p.tokens, p.pos);
  let _t1940;
  if (!_eq(tok_1938.kind, ({_tag: 90, _name: "EOF"}))) {
    _t1940 = (p.pos = (p.pos + 1), undefined);
  } else {
    _t1940 = undefined;
  }
  _t1940;
  const _t1939 = tok_1938;
  return _t1939;
}
function Parser$error(p, msg) {
  return _trampoline(function() {
    const tok_1941 = _resolve(Parser$peek(p));
    return _h["parse_error"]([msg, tok_1941.loc], function(_t1942) {
      return _bounce(function() {
        return _t1942;
      });
    });
  }, Parser$error);
}
function Parser$expect(p, kind) {
  const tok_1943 = Parser$peek(p);
  let _t1945;
  if (_eq(tok_1943.kind, kind)) {
    Parser$advance(p);
    _t1945 = undefined;
  } else {
    _t1945 = Parser$error(p, ((("expected " + __dict_Show_string.show(Token$pp_token_kind(kind))) + ", got ") + __dict_Show_string.show(Token$pp_token_kind(tok_1943.kind))));
  }
  const _t1944 = _t1945;
  return _t1944;
}
function Parser$expect_ident(p) {
  let _t1947;
  const _t1946 = Parser$peek(p).kind;
  _t1948: {
    if (_t1946._tag === 8) {
      const s = _t1946._val;
      Parser$advance(p);
      undefined;
      _t1947 = s;
      break _t1948;
    }
    if (_t1946._tag === 66) {
      Parser$advance(p);
      undefined;
      _t1947 = "_";
      break _t1948;
    }
    if (true) {
      _t1947 = Parser$error(p, "expected identifier");
      break _t1948;
    }
    _match_fail("line 16190");
  }
  return _t1947;
}
function Parser$expect_uident(p) {
  let _t1950;
  const _t1949 = Parser$peek(p).kind;
  _t1951: {
    if (_t1949._tag === 9) {
      const s = _t1949._val;
      Parser$advance(p);
      undefined;
      _t1950 = s;
      break _t1951;
    }
    if (true) {
      _t1950 = Parser$error(p, "expected constructor name");
      break _t1951;
    }
    _match_fail("line 16190");
  }
  return _t1950;
}
function Parser$keyword_as_ident(__x) {
  let _t1953;
  const _t1952 = __x;
  _t1954: {
    if (_t1952._tag === 42) {
      _t1953 = ({_tag: 1, _name: "Some", _val: "mod"});
      break _t1954;
    }
    if (_t1952._tag === 39) {
      _t1953 = ({_tag: 1, _name: "Some", _val: "not"});
      break _t1954;
    }
    if (_t1952._tag === 82) {
      _t1953 = ({_tag: 1, _name: "Some", _val: "land"});
      break _t1954;
    }
    if (_t1952._tag === 83) {
      _t1953 = ({_tag: 1, _name: "Some", _val: "lor"});
      break _t1954;
    }
    if (_t1952._tag === 84) {
      _t1953 = ({_tag: 1, _name: "Some", _val: "lxor"});
      break _t1954;
    }
    if (_t1952._tag === 85) {
      _t1953 = ({_tag: 1, _name: "Some", _val: "lnot"});
      break _t1954;
    }
    if (_t1952._tag === 86) {
      _t1953 = ({_tag: 1, _name: "Some", _val: "lsl"});
      break _t1954;
    }
    if (_t1952._tag === 87) {
      _t1953 = ({_tag: 1, _name: "Some", _val: "lsr"});
      break _t1954;
    }
    if (true) {
      _t1953 = ({_tag: 0, _name: "None"});
      break _t1954;
    }
    _match_fail("line 16190");
  }
  return _t1953;
}
function Parser$token_to_op_name(__x) {
  let _t1956;
  const _t1955 = __x;
  _t1957: {
    if (_t1955._tag === 67) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "+"});
      break _t1957;
    }
    if (_t1955._tag === 68) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "-"});
      break _t1957;
    }
    if (_t1955._tag === 69) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "*"});
      break _t1957;
    }
    if (_t1955._tag === 70) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "/"});
      break _t1957;
    }
    if (_t1955._tag === 42) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "mod"});
      break _t1957;
    }
    if (_t1955._tag === 71) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "^"});
      break _t1957;
    }
    if (_t1955._tag === 80) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "&&"});
      break _t1957;
    }
    if (_t1955._tag === 81) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "||"});
      break _t1957;
    }
    if (_t1955._tag === 39) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "not"});
      break _t1957;
    }
    if (_t1955._tag === 76) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "<"});
      break _t1957;
    }
    if (_t1955._tag === 77) {
      _t1956 = ({_tag: 1, _name: "Some", _val: ">"});
      break _t1957;
    }
    if (_t1955._tag === 78) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "<="});
      break _t1957;
    }
    if (_t1955._tag === 79) {
      _t1956 = ({_tag: 1, _name: "Some", _val: ">="});
      break _t1957;
    }
    if (_t1955._tag === 74) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "="});
      break _t1957;
    }
    if (_t1955._tag === 75) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "<>"});
      break _t1957;
    }
    if (_t1955._tag === 82) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "land"});
      break _t1957;
    }
    if (_t1955._tag === 83) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "lor"});
      break _t1957;
    }
    if (_t1955._tag === 84) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "lxor"});
      break _t1957;
    }
    if (_t1955._tag === 85) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "lnot"});
      break _t1957;
    }
    if (_t1955._tag === 86) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "lsl"});
      break _t1957;
    }
    if (_t1955._tag === 87) {
      _t1956 = ({_tag: 1, _name: "Some", _val: "lsr"});
      break _t1957;
    }
    if (true) {
      _t1956 = ({_tag: 0, _name: "None"});
      break _t1957;
    }
    _match_fail("line 16190");
  }
  return _t1956;
}
function Parser$read_qualified_path(p, first_uident) {
  const path_1958 = Ref$create(({_hd: first_uident, _tl: null}));
  const result_1960 = Ref$create(({_tag: 0, _name: "None"}));
  const continue__1962 = Ref$create(true);
  let _t1964 = undefined;
  let _t1965 = false, _t1966;
  while (true) {
    if (!(Ref$get(continue__1962))) break;
    let _t1967;
    if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "DOT"}))) {
      const next_1968 = Parser$peek_kind_at(p, 1);
      let _t1971;
      const _t1970 = next_1968;
      _t1972: {
        if (_t1970._tag === 8) {
          const s = _t1970._val;
          Parser$advance(p);
          undefined;
          Parser$advance(p);
          undefined;
          const qualified_1973 = (String$concat(".", List$rev(Ref$get(path_1958))) + ("." + s));
          Ref$set(result_1960, ({_tag: 1, _name: "Some", _val: ({_tag: 958595272, _name: "`Var", _val: qualified_1973})}));
          const _t1974 = Ref$set(continue__1962, false);
          _t1971 = _t1974;
          break _t1972;
        }
        if (_t1970._tag === 9) {
          const s = _t1970._val;
          Parser$advance(p);
          undefined;
          Parser$advance(p);
          undefined;
          _t1971 = Ref$set(path_1958, ({_hd: s, _tl: Ref$get(path_1958)}));
          break _t1972;
        }
        if (_t1970._tag === 51) {
          let _t1976;
          const _t1975 = Parser$token_to_op_name(Parser$peek_kind_at(p, 2));
          _t1977: {
            if (_t1975._tag === 1) {
              const op = _t1975._val;
              if (_eq(Parser$peek_kind_at(p, 3), ({_tag: 52, _name: "RPAREN"}))) {
                Parser$advance(p);
                undefined;
                Parser$advance(p);
                undefined;
                Parser$advance(p);
                undefined;
                Parser$advance(p);
                undefined;
                const qualified_1978 = (String$concat(".", List$rev(Ref$get(path_1958))) + ("." + op));
                Ref$set(result_1960, ({_tag: 1, _name: "Some", _val: ({_tag: 958595272, _name: "`Var", _val: qualified_1978})}));
                const _t1979 = Ref$set(continue__1962, false);
                _t1976 = _t1979;
                break _t1977;
              }
            }
            if (true) {
              Parser$advance(p);
              undefined;
              const mod_path_1980 = String$concat(".", List$rev(Ref$get(path_1958)));
              Ref$set(result_1960, ({_tag: 1, _name: "Some", _val: ({_tag: 982234060, _name: "`LocalOpen", _val: mod_path_1980})}));
              const _t1981 = Ref$set(continue__1962, false);
              _t1976 = _t1981;
              break _t1977;
            }
            _match_fail("line 16190");
          }
          _t1971 = _t1976;
          break _t1972;
        }
        if (true) {
          const kw = _t1970;
          let _t1983;
          const _t1982 = Parser$keyword_as_ident(kw);
          _t1984: {
            if (_t1982._tag === 1) {
              const s = _t1982._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              const qualified_1985 = (String$concat(".", List$rev(Ref$get(path_1958))) + ("." + s));
              Ref$set(result_1960, ({_tag: 1, _name: "Some", _val: ({_tag: 958595272, _name: "`Var", _val: qualified_1985})}));
              const _t1986 = Ref$set(continue__1962, false);
              _t1983 = _t1986;
              break _t1984;
            }
            if (_t1982._tag === 0) {
              _t1983 = Ref$set(continue__1962, false);
              break _t1984;
            }
            _match_fail("line 16190");
          }
          _t1971 = _t1983;
          break _t1972;
        }
        _match_fail("line 16190");
      }
      const _t1969 = _t1971;
      _t1967 = _t1969;
    } else {
      _t1967 = Ref$set(continue__1962, false);
    }
    _t1967;
    if (_t1965) break;
  }
  _t1964 = _t1965 ? _t1966 : undefined;
  _t1964;
  let _t1988;
  const _t1987 = Ref$get(result_1960);
  _t1989: {
    if (_t1987._tag === 1) {
      const r = _t1987._val;
      _t1988 = r;
      break _t1989;
    }
    if (_t1987._tag === 0) {
      let _t1991;
      const _t1990 = Ref$get(path_1958);
      _t1992: {
        if (_t1990 !== null && _t1990._tl === null) {
          const single = _t1990._hd;
          _t1991 = ({_tag: 1067578635, _name: "`Constructor", _val: single});
          break _t1992;
        }
        if (true) {
          const rev_1993 = List$rev(Ref$get(path_1958));
          const last_1995 = List$hd(List$rev(rev_1993));
          const prefix_1997 = List$rev(List$tl(List$rev(rev_1993)));
          const qualified_1999 = (String$concat(".", prefix_1997) + ("." + last_1995));
          const _t2000 = ({_tag: 1067578635, _name: "`Constructor", _val: qualified_1999});
          const _t1998 = _t2000;
          const _t1996 = _t1998;
          const _t1994 = _t1996;
          _t1991 = _t1994;
          break _t1992;
        }
        _match_fail("line 16190");
      }
      _t1988 = _t1991;
      break _t1989;
    }
    _match_fail("line 16190");
  }
  const _t1963 = _t1988;
  const _t1961 = _t1963;
  const _t1959 = _t1961;
  return _t1959;
}
function Parser$at_expr_start(p) {
  let _t2002;
  const _t2001 = Parser$peek_kind(p);
  _t2003: {
    if ((((((((((((((((((((((((((((((((_t2001._tag === 0 || _t2001._tag === 1) || _t2001._tag === 2) || _t2001._tag === 3) || _t2001._tag === 4) || _t2001._tag === 5) || _t2001._tag === 6) || _t2001._tag === 7) || _t2001._tag === 8) || _t2001._tag === 9) || _t2001._tag === 51) || _t2001._tag === 53) || _t2001._tag === 55) || _t2001._tag === 16) || _t2001._tag === 14) || _t2001._tag === 11) || _t2001._tag === 17) || _t2001._tag === 68) || _t2001._tag === 39) || _t2001._tag === 85) || _t2001._tag === 25) || _t2001._tag === 26) || _t2001._tag === 27) || _t2001._tag === 28) || _t2001._tag === 30) || _t2001._tag === 33) || _t2001._tag === 35) || _t2001._tag === 29) || _t2001._tag === 31) || _t2001._tag === 40) || _t2001._tag === 34) || _t2001._tag === 88)) {
      _t2002 = true;
      break _t2003;
    }
    if (true) {
      _t2002 = false;
      break _t2003;
    }
    _match_fail("line 16190");
  }
  return _t2002;
}
function Parser$parse_ty_atom(p) {
  let _t2005;
  const _t2004 = Parser$peek_kind(p);
  _t2006: {
    if (_t2004._tag === 8 && _t2004._val === "int") {
      Parser$advance(p);
      undefined;
      _t2005 = ({_tag: 0, _name: "TyName", _val: "int"});
      break _t2006;
    }
    if (_t2004._tag === 8 && _t2004._val === "bool") {
      Parser$advance(p);
      undefined;
      _t2005 = ({_tag: 0, _name: "TyName", _val: "bool"});
      break _t2006;
    }
    if (_t2004._tag === 8 && _t2004._val === "string") {
      Parser$advance(p);
      undefined;
      _t2005 = ({_tag: 0, _name: "TyName", _val: "string"});
      break _t2006;
    }
    if (_t2004._tag === 8 && _t2004._val === "unit") {
      Parser$advance(p);
      undefined;
      _t2005 = ({_tag: 0, _name: "TyName", _val: "unit"});
      break _t2006;
    }
    if (_t2004._tag === 8) {
      const s = _t2004._val;
      Parser$advance(p);
      undefined;
      _t2005 = ({_tag: 0, _name: "TyName", _val: s});
      break _t2006;
    }
    if (_t2004._tag === 9) {
      const s = _t2004._val;
      Parser$advance(p);
      undefined;
      const mod_parts_2007 = Ref$create(({_hd: s, _tl: null}));
      const final_name_2009 = Ref$create(({_tag: 0, _name: "None"}));
      const continue_reading_2011 = Ref$create(true);
      let _t2013 = undefined;
      let _t2014 = false, _t2015;
      while (true) {
        if (!(Ref$get(continue_reading_2011))) break;
        let _t2016;
        if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "DOT"}))) {
          let _t2018;
          const _t2017 = Parser$peek_kind_at(p, 1);
          _t2019: {
            if (_t2017._tag === 9) {
              const s2 = _t2017._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2018 = Ref$set(mod_parts_2007, ({_hd: s2, _tl: Ref$get(mod_parts_2007)}));
              break _t2019;
            }
            if (_t2017._tag === 8) {
              const s2 = _t2017._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              Ref$set(final_name_2009, ({_tag: 1, _name: "Some", _val: s2}));
              _t2018 = Ref$set(continue_reading_2011, false);
              break _t2019;
            }
            if (true) {
              _t2018 = Ref$set(continue_reading_2011, false);
              break _t2019;
            }
            _match_fail("line 16190");
          }
          _t2016 = _t2018;
        } else {
          _t2016 = Ref$set(continue_reading_2011, false);
        }
        _t2016;
        if (_t2014) break;
      }
      _t2013 = _t2014 ? _t2015 : undefined;
      _t2013;
      let _t2021;
      const _t2020 = Ref$get(final_name_2009);
      _t2022: {
        if (_t2020._tag === 1) {
          const name = _t2020._val;
          _t2021 = ({_tag: 9, _name: "TyQualified", _val: [List$rev(Ref$get(mod_parts_2007)), name]});
          break _t2022;
        }
        if (_t2020._tag === 0) {
          _t2021 = ({_tag: 0, _name: "TyName", _val: s});
          break _t2022;
        }
        _match_fail("line 16190");
      }
      const _t2012 = _t2021;
      const _t2010 = _t2012;
      const _t2008 = _t2010;
      _t2005 = _t2008;
      break _t2006;
    }
    if (_t2004._tag === 10) {
      const s = _t2004._val;
      Parser$advance(p);
      undefined;
      _t2005 = ({_tag: 1, _name: "TyVar", _val: s});
      break _t2006;
    }
    if (_t2004._tag === 51) {
      Parser$advance(p);
      undefined;
      const ty_2023 = Parser$parse_ty(p);
      let _t2025;
      if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"}))) {
        const parts_2026 = Ref$create(({_hd: ty_2023, _tl: null}));
        let _t2028 = undefined;
        let _t2029 = false, _t2030;
        while (true) {
          if (!(_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"})))) break;
          Parser$advance(p);
          undefined;
          Ref$set(parts_2026, ({_hd: Parser$parse_ty(p), _tl: Ref$get(parts_2026)}));
          if (_t2029) break;
        }
        _t2028 = _t2029 ? _t2030 : undefined;
        _t2028;
        Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
        const _t2027 = ({_tag: 6, _name: "TyTuple", _val: List$rev(Ref$get(parts_2026))});
        _t2025 = _t2027;
      } else {
        Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
        _t2025 = ty_2023;
      }
      const _t2024 = _t2025;
      _t2005 = _t2024;
      break _t2006;
    }
    if (_t2004._tag === 53) {
      Parser$advance(p);
      undefined;
      let _t2032;
      const _t2031 = Parser$parse_ty_record_fields(p);
      _t2033: {
        if (true) {
          const fields = _t2031[0];
          const is_open = _t2031[1];
          Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
          function _t2034(__p30) {
            let _t2036;
            const _t2035 = __p30;
            _t2037: {
              if (true) {
                const n = _t2035[1];
                const t = _t2035[2];
                _t2036 = [n, t];
                break _t2037;
              }
              _match_fail("line 16190");
            }
            return _t2036;
          }
          _t2032 = ({_tag: 3, _name: "TyRecord", _val: [List$map(_t2034, fields), is_open]});
          break _t2033;
        }
        _match_fail("line 16190");
      }
      _t2005 = _t2032;
      break _t2006;
    }
    if (_t2004._tag === 55) {
      Parser$advance(p);
      undefined;
      let _t2039;
      const _t2038 = Parser$peek_kind(p);
      _t2040: {
        if (_t2038._tag === 77) {
          Parser$advance(p);
          undefined;
          _t2039 = ({_tag: 1, _name: "PVLower"});
          break _t2040;
        }
        if (_t2038._tag === 76) {
          Parser$advance(p);
          undefined;
          _t2039 = ({_tag: 2, _name: "PVUpper"});
          break _t2040;
        }
        if (true) {
          _t2039 = ({_tag: 0, _name: "PVExact"});
          break _t2040;
        }
        _match_fail("line 16190");
      }
      const kind_2041 = _t2039;
      let _t2043;
      if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
        Parser$advance(p);
        _t2043 = undefined;
      } else {
        _t2043 = undefined;
      }
      _t2043;
      const tags_2044 = Ref$create(null);
      let _t2046 = undefined;
      let _t2047 = false, _t2048;
      while (true) {
        let _t2050;
        const _t2049 = Parser$peek_kind(p);
        _t2051: {
          if (_t2049._tag === 88) {
            _t2050 = true;
            break _t2051;
          }
          if (true) {
            _t2050 = false;
            break _t2051;
          }
          _match_fail("line 16190");
        }
        if (!(_t2050)) break;
        let _t2053;
        const _t2052 = Parser$advance(p).kind;
        _t2054: {
          if (_t2052._tag === 88) {
            const s = _t2052._val;
            _t2053 = s;
            break _t2054;
          }
          if (true) {
            _t2053 = failwith("assert false");
            break _t2054;
          }
          _match_fail("line 16190");
        }
        const tag_2055 = _t2053;
        let _t2057;
        if (_eq(Parser$peek_kind(p), ({_tag: 20, _name: "OF"}))) {
          Parser$advance(p);
          undefined;
          _t2057 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
        } else {
          _t2057 = ({_tag: 0, _name: "None"});
        }
        const payload_2058 = _t2057;
        Ref$set(tags_2044, ({_hd: [tag_2055, payload_2058], _tl: Ref$get(tags_2044)}));
        let _t2060;
        if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
          Parser$advance(p);
          _t2060 = undefined;
        } else {
          _t2060 = undefined;
        }
        const _t2059 = _t2060;
        const _t2056 = _t2059;
        _t2056;
        if (_t2047) break;
      }
      _t2046 = _t2047 ? _t2048 : undefined;
      _t2046;
      Parser$expect(p, ({_tag: 56, _name: "RBRACKET"}));
      const _t2045 = ({_tag: 10, _name: "TyPolyVariant", _val: [kind_2041, List$rev(Ref$get(tags_2044))]});
      const _t2042 = _t2045;
      _t2005 = _t2042;
      break _t2006;
    }
    if (true) {
      _t2005 = Parser$error(p, "expected type");
      break _t2006;
    }
    _match_fail("line 16190");
  }
  return _t2005;
}
function Parser$parse_ty_postfix(p) {
  const ty_2061 = Parser$parse_ty_atom(p);
  function loop(ty) {
    while (true) {
      let _t2064;
      const _t2063 = Parser$peek_kind(p);
      _t2065: {
        if (_t2063._tag === 8 && _t2063._val === "list") {
          Parser$advance(p);
          undefined;
          const _t2066 = ({_tag: 4, _name: "TyList", _val: ty});
          ty = _t2066;
          continue;
          _t2064 = undefined;
          break _t2065;
        }
        if (_t2063._tag === 8 && _t2063._val === "array") {
          Parser$advance(p);
          undefined;
          const _t2067 = ({_tag: 5, _name: "TyArray", _val: ty});
          ty = _t2067;
          continue;
          _t2064 = undefined;
          break _t2065;
        }
        if (_t2063._tag === 8 && _t2063._val === "map") {
          Parser$advance(p);
          undefined;
          let _t2069;
          const _t2068 = ty;
          _t2070: {
            if (_t2068._tag === 6 && _t2068._val !== null && _t2068._val._tl !== null && _t2068._val._tl._tl === null) {
              const k = _t2068._val._hd;
              const v = _t2068._val._tl._hd;
              const _t2071 = ({_tag: 8, _name: "TyMap", _val: [k, v]});
              ty = _t2071;
              continue;
              _t2069 = undefined;
              break _t2070;
            }
            if (true) {
              _t2069 = Parser$error(p, "map type requires two type arguments: (k, v) map");
              break _t2070;
            }
            _match_fail("line 16190");
          }
          _t2064 = _t2069;
          break _t2065;
        }
        if (_t2063._tag === 8) {
          const name = _t2063._val;
          if (!_eq(Parser$peek_kind_at(p, 1), ({_tag: 61, _name: "COLON"}))) {
            Parser$advance(p);
            undefined;
            let _t2073;
            const _t2072 = ty;
            _t2074: {
              if (_t2072._tag === 6) {
                const parts = _t2072._val;
                _t2073 = parts;
                break _t2074;
              }
              if (true) {
                _t2073 = ({_hd: ty, _tl: null});
                break _t2074;
              }
              _match_fail("line 16190");
            }
            const args_2075 = _t2073;
            const _t2077 = ({_tag: 7, _name: "TyApp", _val: [args_2075, name]});
            ty = _t2077;
            continue;
            const _t2076 = undefined;
            _t2064 = _t2076;
            break _t2065;
          }
        }
        if (_t2063._tag === 9) {
          if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 62, _name: "DOT"}))) {
            const mod_parts_2078 = Ref$create(null);
            let _t2081;
            const _t2080 = Parser$advance(p).kind;
            _t2082: {
              if (_t2080._tag === 9) {
                const s = _t2080._val;
                _t2081 = s;
                break _t2082;
              }
              if (true) {
                _t2081 = failwith("assert false");
                break _t2082;
              }
              _match_fail("line 16190");
            }
            const first_mod_2083 = _t2081;
            Ref$set(mod_parts_2078, ({_hd: first_mod_2083, _tl: null}));
            const final_name_2085 = Ref$create("");
            const continue_reading_2087 = Ref$create(true);
            let _t2089 = undefined;
            let _t2090 = false, _t2091;
            while (true) {
              if (!(Ref$get(continue_reading_2087))) break;
              let _t2092;
              if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "DOT"}))) {
                let _t2094;
                const _t2093 = Parser$peek_kind_at(p, 1);
                _t2095: {
                  if (_t2093._tag === 9) {
                    const s2 = _t2093._val;
                    Parser$advance(p);
                    undefined;
                    Parser$advance(p);
                    undefined;
                    _t2094 = Ref$set(mod_parts_2078, ({_hd: s2, _tl: Ref$get(mod_parts_2078)}));
                    break _t2095;
                  }
                  if (_t2093._tag === 8) {
                    const s2 = _t2093._val;
                    Parser$advance(p);
                    undefined;
                    Parser$advance(p);
                    undefined;
                    Ref$set(final_name_2085, s2);
                    _t2094 = Ref$set(continue_reading_2087, false);
                    break _t2095;
                  }
                  if (true) {
                    _t2094 = Ref$set(continue_reading_2087, false);
                    break _t2095;
                  }
                  _match_fail("line 16190");
                }
                _t2092 = _t2094;
              } else {
                _t2092 = Ref$set(continue_reading_2087, false);
              }
              _t2092;
              if (_t2090) break;
            }
            _t2089 = _t2090 ? _t2091 : undefined;
            _t2089;
            let _t2096;
            if ((Ref$get(final_name_2085) === "")) {
              _t2096 = Parser$error(p, "expected Module.typename in type annotation");
            } else {
              const qualified_2097 = (String$concat(".", List$rev(Ref$get(mod_parts_2078))) + ("." + Ref$get(final_name_2085)));
              let _t2100;
              const _t2099 = ty;
              _t2101: {
                if (_t2099._tag === 6) {
                  const parts = _t2099._val;
                  _t2100 = parts;
                  break _t2101;
                }
                if (true) {
                  _t2100 = ({_hd: ty, _tl: null});
                  break _t2101;
                }
                _match_fail("line 16190");
              }
              const args_2102 = _t2100;
              const _t2104 = ({_tag: 7, _name: "TyApp", _val: [args_2102, qualified_2097]});
              ty = _t2104;
              continue;
              const _t2103 = undefined;
              const _t2098 = _t2103;
              _t2096 = _t2098;
            }
            const _t2088 = _t2096;
            const _t2086 = _t2088;
            const _t2084 = _t2086;
            const _t2079 = _t2084;
            _t2064 = _t2079;
            break _t2065;
          }
        }
        if (true) {
          _t2064 = ty;
          break _t2065;
        }
        _match_fail("line 16190");
      }
      return _t2064;
    }
  }
  const _t2105 = loop(ty_2061);
  const _t2062 = _t2105;
  return _t2062;
}
function Parser$parse_ty_tuple(p) {
  const first_2106 = Parser$parse_ty_postfix(p);
  let _t2109;
  const _t2108 = Parser$peek_kind(p);
  _t2110: {
    if (_t2108._tag === 69) {
      const parts_2111 = Ref$create(({_hd: first_2106, _tl: null}));
      let _t2113 = undefined;
      let _t2114 = false, _t2115;
      while (true) {
        if (!(_eq(Parser$peek_kind(p), ({_tag: 69, _name: "STAR"})))) break;
        Parser$advance(p);
        undefined;
        Ref$set(parts_2111, ({_hd: Parser$parse_ty_postfix(p), _tl: Ref$get(parts_2111)}));
        if (_t2114) break;
      }
      _t2113 = _t2114 ? _t2115 : undefined;
      _t2113;
      const _t2112 = ({_tag: 6, _name: "TyTuple", _val: List$rev(Ref$get(parts_2111))});
      _t2109 = _t2112;
      break _t2110;
    }
    if (true) {
      _t2109 = first_2106;
      break _t2110;
    }
    _match_fail("line 16190");
  }
  const _t2107 = _t2109;
  return _t2107;
}
function Parser$parse_ty(p) {
  const left_2116 = Parser$parse_ty_tuple(p);
  let _t2119;
  const _t2118 = Parser$peek_kind(p);
  _t2120: {
    if (_t2118._tag === 57) {
      Parser$advance(p);
      undefined;
      const right_2121 = Parser$parse_ty(p);
      let _t2123;
      if (_eq(Parser$peek_kind(p), ({_tag: 70, _name: "SLASH"}))) {
        Parser$advance(p);
        undefined;
        let _t2124;
        if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
          Parser$advance(p);
          undefined;
          _t2124 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "EffAnnotPure"})});
        } else {
          _t2124 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)})});
        }
        _t2123 = _t2124;
      } else {
        _t2123 = ({_tag: 0, _name: "None"});
      }
      const eff_2125 = _t2123;
      const _t2126 = ({_tag: 2, _name: "TyArrow", _val: [left_2116, right_2121, eff_2125]});
      const _t2122 = _t2126;
      _t2119 = _t2122;
      break _t2120;
    }
    if (true) {
      _t2119 = left_2116;
      break _t2120;
    }
    _match_fail("line 16190");
  }
  const _t2117 = _t2119;
  return _t2117;
}
function Parser$is_eff_param_start(__x) {
  let _t2128;
  const _t2127 = __x;
  _t2129: {
    if ((((_t2127._tag === 8 || _t2127._tag === 10) || _t2127._tag === 51) || _t2127._tag === 53)) {
      _t2128 = true;
      break _t2129;
    }
    if (true) {
      _t2128 = false;
      break _t2129;
    }
    _match_fail("line 16190");
  }
  return _t2128;
}
function Parser$parse_eff_type_params(p) {
  const params_2130 = Ref$create(null);
  let _t2132 = undefined;
  let _t2133 = false, _t2134;
  while (true) {
    if (!(Parser$is_eff_param_start(Parser$peek_kind(p)))) break;
    Ref$set(params_2130, ({_hd: Parser$parse_ty_atom(p), _tl: Ref$get(params_2130)}));
    if (_t2133) break;
  }
  _t2132 = _t2133 ? _t2134 : undefined;
  _t2132;
  const _t2131 = List$rev(Ref$get(params_2130));
  return _t2131;
}
function Parser$parse_eff_items(p) {
  const items_2135 = Ref$create(null);
  const continue_parsing_2137 = Ref$create(true);
  let _t2139 = undefined;
  let _t2140 = false, _t2141;
  while (true) {
    if (!(Ref$get(continue_parsing_2137))) break;
    let _t2143;
    const _t2142 = Parser$peek_kind(p);
    _t2144: {
      if (_t2142._tag === 9) {
        const name_2145 = Parser$expect_uident(p);
        const params_2147 = Parser$parse_eff_type_params(p);
        Ref$set(items_2135, ({_hd: ({_tag: 0, _name: "EffLabel", _val: [name_2145, params_2147]}), _tl: Ref$get(items_2135)}));
        let _t2149;
        if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"}))) {
          Parser$advance(p);
          _t2149 = undefined;
        } else {
          _t2149 = Ref$set(continue_parsing_2137, false);
        }
        const _t2148 = _t2149;
        const _t2146 = _t2148;
        _t2143 = _t2146;
        break _t2144;
      }
      if (_t2142._tag === 10) {
        const s = _t2142._val;
        Parser$advance(p);
        undefined;
        Ref$set(items_2135, ({_hd: ({_tag: 1, _name: "EffVar", _val: s}), _tl: Ref$get(items_2135)}));
        let _t2150;
        if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"}))) {
          Parser$advance(p);
          _t2150 = undefined;
        } else {
          _t2150 = Ref$set(continue_parsing_2137, false);
        }
        _t2143 = _t2150;
        break _t2144;
      }
      if (true) {
        _t2143 = Ref$set(continue_parsing_2137, false);
        break _t2144;
      }
      _match_fail("line 16190");
    }
    _t2143;
    if (_t2140) break;
  }
  _t2139 = _t2140 ? _t2141 : undefined;
  _t2139;
  const _t2138 = List$rev(Ref$get(items_2135));
  const _t2136 = _t2138;
  return _t2136;
}
function Parser$parse_ty_record_fields(p) {
  const fields_2151 = Ref$create(null);
  const is_open_2153 = Ref$create(false);
  const first_2155 = Ref$create(true);
  let _t2157 = undefined;
  let _t2158 = false, _t2159;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"})))) break;
    let _t2160;
    if ((!Ref$get(first_2155))) {
      _t2160 = Parser$expect(p, ({_tag: 59, _name: "SEMICOLON"}));
    } else {
      _t2160 = undefined;
    }
    _t2160;
    let _t2161;
    if (_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
      _t2161 = undefined;
    } else {
      let _t2162;
      if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOTDOT"}))) {
        Parser$advance(p);
        undefined;
        _t2162 = Ref$set(is_open_2153, true);
      } else {
        Ref$set(first_2155, false);
        const is_mut_2163 = _eq(Parser$peek_kind(p), ({_tag: 32, _name: "MUT"}));
        let _t2165;
        if (is_mut_2163) {
          Parser$advance(p);
          _t2165 = undefined;
        } else {
          _t2165 = undefined;
        }
        _t2165;
        const name_2166 = Parser$expect_ident(p);
        Parser$expect(p, ({_tag: 61, _name: "COLON"}));
        const ty_2168 = Parser$parse_ty(p);
        const _t2169 = Ref$set(fields_2151, ({_hd: [is_mut_2163, name_2166, ty_2168], _tl: Ref$get(fields_2151)}));
        const _t2167 = _t2169;
        const _t2164 = _t2167;
        _t2162 = _t2164;
      }
      _t2161 = _t2162;
    }
    _t2161;
    if (_t2158) break;
  }
  _t2157 = _t2158 ? _t2159 : undefined;
  _t2157;
  const _t2156 = [List$rev(Ref$get(fields_2151)), Ref$get(is_open_2153)];
  const _t2154 = _t2156;
  const _t2152 = _t2154;
  return _t2152;
}
function Parser$parse_pattern_atom(p) {
  let _t2171;
  const _t2170 = Parser$peek_kind(p);
  _t2172: {
    if (_t2170._tag === 66) {
      Parser$advance(p);
      undefined;
      _t2171 = ({_tag: 0, _name: "PatWild"});
      break _t2172;
    }
    if (_t2170._tag === 0) {
      const n = _t2170._val;
      Parser$advance(p);
      undefined;
      _t2171 = ({_tag: 2, _name: "PatInt", _val: n});
      break _t2172;
    }
    if (_t2170._tag === 1) {
      const f = _t2170._val;
      Parser$advance(p);
      undefined;
      _t2171 = ({_tag: 3, _name: "PatFloat", _val: f});
      break _t2172;
    }
    if (_t2170._tag === 6) {
      Parser$advance(p);
      undefined;
      _t2171 = ({_tag: 4, _name: "PatBool", _val: true});
      break _t2172;
    }
    if (_t2170._tag === 7) {
      Parser$advance(p);
      undefined;
      _t2171 = ({_tag: 4, _name: "PatBool", _val: false});
      break _t2172;
    }
    if (_t2170._tag === 2) {
      const s = _t2170._val;
      Parser$advance(p);
      undefined;
      _t2171 = ({_tag: 5, _name: "PatString", _val: s});
      break _t2172;
    }
    if (_t2170._tag === 8) {
      const s = _t2170._val;
      Parser$advance(p);
      undefined;
      _t2171 = ({_tag: 1, _name: "PatVar", _val: s});
      break _t2172;
    }
    if (_t2170._tag === 9) {
      const s = _t2170._val;
      Parser$advance(p);
      undefined;
      const path_2173 = Ref$create(({_hd: s, _tl: null}));
      const continue_reading_2175 = Ref$create(true);
      let _t2177 = undefined;
      let _t2178 = false, _t2179;
      while (true) {
        if (!(Ref$get(continue_reading_2175))) break;
        let _t2180;
        if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "DOT"}))) {
          let _t2182;
          const _t2181 = Parser$peek_kind_at(p, 1);
          _t2183: {
            if (_t2181._tag === 9) {
              const s2 = _t2181._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2182 = Ref$set(path_2173, ({_hd: s2, _tl: Ref$get(path_2173)}));
              break _t2183;
            }
            if (true) {
              _t2182 = Ref$set(continue_reading_2175, false);
              break _t2183;
            }
            _match_fail("line 16190");
          }
          _t2180 = _t2182;
        } else {
          _t2180 = Ref$set(continue_reading_2175, false);
        }
        _t2180;
        if (_t2178) break;
      }
      _t2177 = _t2178 ? _t2179 : undefined;
      _t2177;
      let _t2185;
      const _t2184 = Ref$get(path_2173);
      _t2186: {
        if (_t2184 !== null && _t2184._tl === null) {
          const single = _t2184._hd;
          _t2185 = single;
          break _t2186;
        }
        if (true) {
          const rev_path = _t2184;
          const parts_2187 = List$rev(rev_path);
          const _t2188 = String$concat(".", parts_2187);
          _t2185 = _t2188;
          break _t2186;
        }
        _match_fail("line 16190");
      }
      const _t2176 = _t2185;
      const _t2174 = _t2176;
      const ctor_name_2189 = _t2174;
      let _t2191;
      if (Parser$at_pattern_arg_start(p)) {
        _t2191 = ({_tag: 1, _name: "Some", _val: Parser$parse_pattern_atom(p)});
      } else {
        _t2191 = ({_tag: 0, _name: "None"});
      }
      const arg_2192 = _t2191;
      const _t2193 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name_2189, arg_2192]});
      const _t2190 = _t2193;
      _t2171 = _t2190;
      break _t2172;
    }
    if (_t2170._tag === 55) {
      Parser$advance(p);
      undefined;
      let _t2194;
      if (_eq(Parser$peek_kind(p), ({_tag: 56, _name: "RBRACKET"}))) {
        Parser$advance(p);
        undefined;
        _t2194 = ({_tag: 9, _name: "PatNil"});
      } else {
        const pats_2195 = Parser$parse_pattern_list_elems(p);
        Parser$expect(p, ({_tag: 56, _name: "RBRACKET"}));
        function _t2197(pat, acc) {
          return ({_tag: 8, _name: "PatCons", _val: [pat, acc]});
        }
        const _t2196 = List$fold_right(_t2197, pats_2195, ({_tag: 9, _name: "PatNil"}));
        _t2194 = _t2196;
      }
      _t2171 = _t2194;
      break _t2172;
    }
    if (_t2170._tag === 51) {
      Parser$advance(p);
      undefined;
      let _t2198;
      if (_eq(Parser$peek_kind(p), ({_tag: 52, _name: "RPAREN"}))) {
        Parser$advance(p);
        undefined;
        _t2198 = ({_tag: 6, _name: "PatUnit"});
      } else {
        const pat_2199 = Parser$parse_pattern(p);
        let _t2202;
        const _t2201 = Parser$peek_kind(p);
        _t2203: {
          if (_t2201._tag === 58) {
            const pats_2204 = Ref$create(({_hd: pat_2199, _tl: null}));
            let _t2206 = undefined;
            let _t2207 = false, _t2208;
            while (true) {
              if (!(_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"})))) break;
              Parser$advance(p);
              undefined;
              Ref$set(pats_2204, ({_hd: Parser$parse_pattern(p), _tl: Ref$get(pats_2204)}));
              if (_t2207) break;
            }
            _t2206 = _t2207 ? _t2208 : undefined;
            _t2206;
            Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
            const _t2205 = ({_tag: 7, _name: "PatTuple", _val: List$rev(Ref$get(pats_2204))});
            _t2202 = _t2205;
            break _t2203;
          }
          if (_t2201._tag === 61) {
            Parser$advance(p);
            undefined;
            const ty_2209 = Parser$parse_ty(p);
            Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
            const _t2210 = ({_tag: 18, _name: "PatAnnot", _val: [pat_2199, ty_2209]});
            _t2202 = _t2210;
            break _t2203;
          }
          if (true) {
            Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
            _t2202 = pat_2199;
            break _t2203;
          }
          _match_fail("line 16190");
        }
        const _t2200 = _t2202;
        _t2198 = _t2200;
      }
      _t2171 = _t2198;
      break _t2172;
    }
    if (_t2170._tag === 53) {
      Parser$advance(p);
      undefined;
      const fields_2211 = Parser$parse_pattern_record_fields(p);
      Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
      const _t2212 = ({_tag: 11, _name: "PatRecord", _val: fields_2211});
      _t2171 = _t2212;
      break _t2172;
    }
    if (_t2170._tag === 88) {
      const tag = _t2170._val;
      Parser$advance(p);
      undefined;
      let _t2213;
      if (Parser$at_pattern_arg_start(p)) {
        _t2213 = ({_tag: 16, _name: "PatPolyVariant", _val: [tag, ({_tag: 1, _name: "Some", _val: Parser$parse_pattern_atom(p)})]});
      } else {
        _t2213 = ({_tag: 16, _name: "PatPolyVariant", _val: [tag, ({_tag: 0, _name: "None"})]});
      }
      _t2171 = _t2213;
      break _t2172;
    }
    if (_t2170._tag === 71) {
      Parser$advance(p);
      undefined;
      const name_2214 = Parser$expect_ident(p);
      const _t2215 = ({_tag: 17, _name: "PatPin", _val: name_2214});
      _t2171 = _t2215;
      break _t2172;
    }
    if (_t2170._tag === 40) {
      Parser$advance(p);
      undefined;
      let _t2217;
      const _t2216 = Parser$peek_kind(p);
      _t2218: {
        if (_t2216._tag === 55) {
          Parser$advance(p);
          undefined;
          let _t2219;
          if (_eq(Parser$peek_kind(p), ({_tag: 56, _name: "RBRACKET"}))) {
            Parser$advance(p);
            undefined;
            _t2219 = ({_tag: 14, _name: "PatArray", _val: null});
          } else {
            const pats_2220 = Parser$parse_pattern_list_elems(p);
            Parser$expect(p, ({_tag: 56, _name: "RBRACKET"}));
            const _t2221 = ({_tag: 14, _name: "PatArray", _val: pats_2220});
            _t2219 = _t2221;
          }
          _t2217 = _t2219;
          break _t2218;
        }
        if (_t2216._tag === 53) {
          Parser$advance(p);
          undefined;
          let _t2222;
          if (_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
            Parser$advance(p);
            undefined;
            _t2222 = ({_tag: 15, _name: "PatMap", _val: null});
          } else {
            const entries_2223 = Parser$parse_pattern_map_entries(p);
            Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
            const _t2224 = ({_tag: 15, _name: "PatMap", _val: entries_2223});
            _t2222 = _t2224;
          }
          _t2217 = _t2222;
          break _t2218;
        }
        if (true) {
          _t2217 = Parser$error(p, "expected '[' or '{' after '#' in pattern");
          break _t2218;
        }
        _match_fail("line 16190");
      }
      _t2171 = _t2217;
      break _t2172;
    }
    if (true) {
      _t2171 = Parser$error(p, "expected pattern");
      break _t2172;
    }
    _match_fail("line 16190");
  }
  return _t2171;
}
function Parser$parse_pattern_cons(p) {
  const pat_2225 = Parser$parse_pattern_atom(p);
  let _t2228;
  const _t2227 = Parser$peek_kind(p);
  _t2229: {
    if (_t2227._tag === 72) {
      Parser$advance(p);
      undefined;
      const rest_2230 = Parser$parse_pattern_cons(p);
      const _t2231 = ({_tag: 8, _name: "PatCons", _val: [pat_2225, rest_2230]});
      _t2228 = _t2231;
      break _t2229;
    }
    if (true) {
      _t2228 = pat_2225;
      break _t2229;
    }
    _match_fail("line 16190");
  }
  const _t2226 = _t2228;
  return _t2226;
}
function Parser$parse_pattern_as(p) {
  const pat_2232 = Parser$parse_pattern_cons(p);
  let _t2235;
  const _t2234 = Parser$peek_kind(p);
  _t2236: {
    if (_t2234._tag === 8 && _t2234._val === "as") {
      Parser$advance(p);
      undefined;
      const name_2237 = Parser$expect_ident(p);
      const _t2238 = ({_tag: 12, _name: "PatAs", _val: [pat_2232, name_2237]});
      _t2235 = _t2238;
      break _t2236;
    }
    if (true) {
      _t2235 = pat_2232;
      break _t2236;
    }
    _match_fail("line 16190");
  }
  const _t2233 = _t2235;
  return _t2233;
}
function Parser$parse_pattern(p) {
  const pat_2239 = Ref$create(Parser$parse_pattern_as(p));
  let _t2241 = undefined;
  let _t2242 = false, _t2243;
  while (true) {
    if (!(_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"})))) break;
    Parser$advance(p);
    undefined;
    const next_pat_2244 = Parser$parse_pattern_as(p);
    const _t2245 = Ref$set(pat_2239, ({_tag: 13, _name: "PatOr", _val: [Ref$get(pat_2239), next_pat_2244]}));
    _t2245;
    if (_t2242) break;
  }
  _t2241 = _t2242 ? _t2243 : undefined;
  _t2241;
  const _t2240 = Ref$get(pat_2239);
  return _t2240;
}
function Parser$at_pattern_arg_start(p) {
  let _t2247;
  const _t2246 = Parser$peek_kind(p);
  _t2248: {
    if (_t2246._tag === 8 && _t2246._val === "as") {
      _t2247 = false;
      break _t2248;
    }
    if (((((((((((((_t2246._tag === 0 || _t2246._tag === 6) || _t2246._tag === 7) || _t2246._tag === 2) || _t2246._tag === 8) || _t2246._tag === 9) || _t2246._tag === 51) || _t2246._tag === 55) || _t2246._tag === 53) || _t2246._tag === 66) || _t2246._tag === 40) || _t2246._tag === 88) || _t2246._tag === 71)) {
      _t2247 = true;
      break _t2248;
    }
    if (true) {
      _t2247 = false;
      break _t2248;
    }
    _match_fail("line 16190");
  }
  return _t2247;
}
function Parser$parse_pattern_list_elems(p) {
  const first_2249 = Parser$parse_pattern(p);
  const pats_2251 = Ref$create(({_hd: first_2249, _tl: null}));
  let _t2253 = undefined;
  let _t2254 = false, _t2255;
  while (true) {
    if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "SEMICOLON"})))) break;
    Parser$advance(p);
    undefined;
    let _t2256;
    if (!_eq(Parser$peek_kind(p), ({_tag: 56, _name: "RBRACKET"}))) {
      _t2256 = Ref$set(pats_2251, ({_hd: Parser$parse_pattern(p), _tl: Ref$get(pats_2251)}));
    } else {
      _t2256 = undefined;
    }
    _t2256;
    if (_t2254) break;
  }
  _t2253 = _t2254 ? _t2255 : undefined;
  _t2253;
  const _t2252 = List$rev(Ref$get(pats_2251));
  const _t2250 = _t2252;
  return _t2250;
}
function Parser$parse_pattern_record_fields(p) {
  const fields_2257 = Ref$create(null);
  const first_2259 = Ref$create(true);
  let _t2261 = undefined;
  let _t2262 = false, _t2263;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"})))) break;
    let _t2264;
    if ((!Ref$get(first_2259))) {
      _t2264 = Parser$expect(p, ({_tag: 59, _name: "SEMICOLON"}));
    } else {
      _t2264 = undefined;
    }
    _t2264;
    let _t2265;
    if (_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
      _t2265 = undefined;
    } else {
      Ref$set(first_2259, false);
      let _t2266;
      if (_eq(Parser$peek_kind(p), ({_tag: 66, _name: "UNDERSCORE"}))) {
        Parser$advance(p);
        _t2266 = undefined;
      } else {
        const name_2267 = Parser$expect_ident(p);
        let _t2269;
        if (_eq(Parser$peek_kind(p), ({_tag: 74, _name: "EQ"}))) {
          Parser$advance(p);
          undefined;
          _t2269 = Parser$parse_pattern(p);
        } else {
          _t2269 = ({_tag: 1, _name: "PatVar", _val: name_2267});
        }
        const pat_2270 = _t2269;
        const _t2271 = Ref$set(fields_2257, ({_hd: [name_2267, pat_2270], _tl: Ref$get(fields_2257)}));
        const _t2268 = _t2271;
        _t2266 = _t2268;
      }
      _t2265 = _t2266;
    }
    _t2265;
    if (_t2262) break;
  }
  _t2261 = _t2262 ? _t2263 : undefined;
  _t2261;
  const _t2260 = List$rev(Ref$get(fields_2257));
  const _t2258 = _t2260;
  return _t2258;
}
function Parser$parse_pattern_map_entries(p) {
  const entries_2272 = Ref$create(null);
  const first_2274 = Ref$create(true);
  let _t2276 = undefined;
  let _t2277 = false, _t2278;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"})))) break;
    let _t2279;
    if ((!Ref$get(first_2274))) {
      _t2279 = Parser$expect(p, ({_tag: 59, _name: "SEMICOLON"}));
    } else {
      _t2279 = undefined;
    }
    _t2279;
    let _t2280;
    if (_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
      _t2280 = undefined;
    } else {
      Ref$set(first_2274, false);
      const key_2281 = Parser$parse_pattern_atom(p);
      Parser$expect(p, ({_tag: 61, _name: "COLON"}));
      const value_2283 = Parser$parse_pattern(p);
      const _t2284 = Ref$set(entries_2272, ({_hd: [key_2281, value_2283], _tl: Ref$get(entries_2272)}));
      const _t2282 = _t2284;
      _t2280 = _t2282;
    }
    _t2280;
    if (_t2277) break;
  }
  _t2276 = _t2277 ? _t2278 : undefined;
  _t2276;
  const _t2275 = List$rev(Ref$get(entries_2272));
  const _t2273 = _t2275;
  return _t2273;
}
function Parser$bp_of_binop(__x) {
  let _t2286;
  const _t2285 = __x;
  _t2287: {
    if (_t2285._tag === 65) {
      _t2286 = [1, 2];
      break _t2287;
    }
    if (_t2285._tag === 81) {
      _t2286 = [2, 3];
      break _t2287;
    }
    if (_t2285._tag === 80) {
      _t2286 = [4, 5];
      break _t2287;
    }
    if ((((((_t2285._tag === 74 || _t2285._tag === 75) || _t2285._tag === 76) || _t2285._tag === 77) || _t2285._tag === 78) || _t2285._tag === 79)) {
      _t2286 = [6, 7];
      break _t2287;
    }
    if (_t2285._tag === 72) {
      _t2286 = [9, 8];
      break _t2287;
    }
    if ((_t2285._tag === 67 || _t2285._tag === 68)) {
      _t2286 = [10, 11];
      break _t2287;
    }
    if (_t2285._tag === 71) {
      _t2286 = [10, 11];
      break _t2287;
    }
    if (((_t2285._tag === 69 || _t2285._tag === 70) || _t2285._tag === 42)) {
      _t2286 = [12, 13];
      break _t2287;
    }
    if ((_t2285._tag === 83 || _t2285._tag === 84)) {
      _t2286 = [10, 11];
      break _t2287;
    }
    if (((_t2285._tag === 82 || _t2285._tag === 86) || _t2285._tag === 87)) {
      _t2286 = [12, 13];
      break _t2287;
    }
    if (true) {
      _t2286 = [(-1), (-1)];
      break _t2287;
    }
    _match_fail("line 16190");
  }
  return _t2286;
}
function Parser$is_binop(__x) {
  let _t2289;
  const _t2288 = __x;
  _t2290: {
    if (((((((((((((((((((((_t2288._tag === 67 || _t2288._tag === 68) || _t2288._tag === 69) || _t2288._tag === 70) || _t2288._tag === 42) || _t2288._tag === 74) || _t2288._tag === 75) || _t2288._tag === 76) || _t2288._tag === 77) || _t2288._tag === 78) || _t2288._tag === 79) || _t2288._tag === 80) || _t2288._tag === 81) || _t2288._tag === 71) || _t2288._tag === 72) || _t2288._tag === 82) || _t2288._tag === 83) || _t2288._tag === 84) || _t2288._tag === 86) || _t2288._tag === 87) || _t2288._tag === 65)) {
      _t2289 = true;
      break _t2290;
    }
    if (true) {
      _t2289 = false;
      break _t2290;
    }
    _match_fail("line 16190");
  }
  return _t2289;
}
function Parser$binop_of_token(__x) {
  let _t2292;
  const _t2291 = __x;
  _t2293: {
    if (_t2291._tag === 67) {
      _t2292 = ({_tag: 0, _name: "Add"});
      break _t2293;
    }
    if (_t2291._tag === 68) {
      _t2292 = ({_tag: 1, _name: "Sub"});
      break _t2293;
    }
    if (_t2291._tag === 69) {
      _t2292 = ({_tag: 2, _name: "Mul"});
      break _t2293;
    }
    if (_t2291._tag === 70) {
      _t2292 = ({_tag: 3, _name: "Div"});
      break _t2293;
    }
    if (_t2291._tag === 42) {
      _t2292 = ({_tag: 4, _name: "Mod"});
      break _t2293;
    }
    if (_t2291._tag === 74) {
      _t2292 = ({_tag: 5, _name: "Eq"});
      break _t2293;
    }
    if (_t2291._tag === 75) {
      _t2292 = ({_tag: 6, _name: "Neq"});
      break _t2293;
    }
    if (_t2291._tag === 76) {
      _t2292 = ({_tag: 7, _name: "Lt"});
      break _t2293;
    }
    if (_t2291._tag === 77) {
      _t2292 = ({_tag: 8, _name: "Gt"});
      break _t2293;
    }
    if (_t2291._tag === 78) {
      _t2292 = ({_tag: 9, _name: "Le"});
      break _t2293;
    }
    if (_t2291._tag === 79) {
      _t2292 = ({_tag: 10, _name: "Ge"});
      break _t2293;
    }
    if (_t2291._tag === 80) {
      _t2292 = ({_tag: 11, _name: "And"});
      break _t2293;
    }
    if (_t2291._tag === 81) {
      _t2292 = ({_tag: 12, _name: "Or"});
      break _t2293;
    }
    if (_t2291._tag === 71) {
      _t2292 = ({_tag: 13, _name: "Concat"});
      break _t2293;
    }
    if (_t2291._tag === 82) {
      _t2292 = ({_tag: 14, _name: "Land"});
      break _t2293;
    }
    if (_t2291._tag === 83) {
      _t2292 = ({_tag: 15, _name: "Lor"});
      break _t2293;
    }
    if (_t2291._tag === 84) {
      _t2292 = ({_tag: 16, _name: "Lxor"});
      break _t2293;
    }
    if (_t2291._tag === 86) {
      _t2292 = ({_tag: 17, _name: "Lsl"});
      break _t2293;
    }
    if (_t2291._tag === 87) {
      _t2292 = ({_tag: 18, _name: "Lsr"});
      break _t2293;
    }
    if (_t2291._tag === 65) {
      _t2292 = ({_tag: 19, _name: "Pipe"});
      break _t2293;
    }
    if (true) {
      _t2292 = failwith("assert false");
      break _t2293;
    }
    _match_fail("line 16190");
  }
  return _t2292;
}
function Parser$resolve_fun_params(fun_params, body) {
  function _t2294(body, fp) {
    let _t2296;
    const _t2295 = fp;
    _t2297: {
      if (_t2295._tag === 0) {
        _t2296 = body;
        break _t2297;
      }
      if (_t2295._tag === 1) {
        const name = _t2295._val[0];
        const pat = _t2295._val[1];
        _t2296 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
        break _t2297;
      }
      _match_fail("line 16190");
    }
    return _t2296;
  }
  const body_2298 = List$fold(_t2294, body, fun_params);
  function _t2300(fp) {
    let _t2302;
    const _t2301 = fp;
    _t2303: {
      if (_t2301._tag === 0) {
        const param = _t2301._val;
        _t2302 = param;
        break _t2303;
      }
      if (_t2301._tag === 1) {
        const name = _t2301._val[0];
        const annot = _t2301._val[2];
        _t2302 = ({annot: annot, is_generated: true, name: name});
        break _t2303;
      }
      _match_fail("line 16190");
    }
    return _t2302;
  }
  const params_2304 = List$map(_t2300, fun_params);
  const _t2305 = [params_2304, body_2298];
  const _t2299 = _t2305;
  return _t2299;
}
const Parser$fresh_param_counter = Ref$create(0);
function Parser$fresh_param_name(_) {
  Ref$set(Parser$fresh_param_counter, (Ref$get(Parser$fresh_param_counter) + 1));
  return ("__p" + __dict_Show_int.show(Ref$get(Parser$fresh_param_counter)));
}
function Parser$parse_format_spec(spec, expr) {
  const len_2306 = String$length(spec);
  const i_2308 = Ref$create(0);
  let _t2310;
  if (((Ref$get(i_2308) < len_2306) && ((String$get(spec, Ref$get(i_2308)) === 60) || (String$get(spec, Ref$get(i_2308)) === 62)))) {
    const a_2311 = String$get(spec, Ref$get(i_2308));
    Ref$set(i_2308, (Ref$get(i_2308) + 1));
    const _t2312 = ({_tag: 1, _name: "Some", _val: a_2311});
    _t2310 = _t2312;
  } else {
    _t2310 = ({_tag: 0, _name: "None"});
  }
  const align_2313 = _t2310;
  let _t2315;
  if (((Ref$get(i_2308) < len_2306) && ((String$get(spec, Ref$get(i_2308)) === 48) && (((Ref$get(i_2308) + 1) < len_2306) && ((String$get(spec, (Ref$get(i_2308) + 1)) >= 49) && (String$get(spec, (Ref$get(i_2308) + 1)) <= 57)))))) {
    Ref$set(i_2308, (Ref$get(i_2308) + 1));
    _t2315 = true;
  } else {
    _t2315 = false;
  }
  const zero_pad_2316 = _t2315;
  const width_start_2318 = Ref$get(i_2308);
  let _t2320 = undefined;
  let _t2321 = false, _t2322;
  while (true) {
    if (!(((Ref$get(i_2308) < len_2306) && ((String$get(spec, Ref$get(i_2308)) >= 48) && (String$get(spec, Ref$get(i_2308)) <= 57))))) break;
    Ref$set(i_2308, (Ref$get(i_2308) + 1));
    if (_t2321) break;
  }
  _t2320 = _t2321 ? _t2322 : undefined;
  _t2320;
  let _t2323;
  if ((Ref$get(i_2308) > width_start_2318)) {
    _t2323 = ({_tag: 1, _name: "Some", _val: int_of_string(String$sub(spec, width_start_2318, (Ref$get(i_2308) - width_start_2318)))});
  } else {
    _t2323 = ({_tag: 0, _name: "None"});
  }
  const width_2324 = _t2323;
  let _t2326;
  if (((Ref$get(i_2308) < len_2306) && (String$get(spec, Ref$get(i_2308)) === 46))) {
    Ref$set(i_2308, (Ref$get(i_2308) + 1));
    const ps_2327 = Ref$get(i_2308);
    let _t2329 = undefined;
    let _t2330 = false, _t2331;
    while (true) {
      if (!(((Ref$get(i_2308) < len_2306) && ((String$get(spec, Ref$get(i_2308)) >= 48) && (String$get(spec, Ref$get(i_2308)) <= 57))))) break;
      Ref$set(i_2308, (Ref$get(i_2308) + 1));
      if (_t2330) break;
    }
    _t2329 = _t2330 ? _t2331 : undefined;
    _t2329;
    let _t2332;
    if ((Ref$get(i_2308) > ps_2327)) {
      _t2332 = int_of_string(String$sub(spec, ps_2327, (Ref$get(i_2308) - ps_2327)));
    } else {
      _t2332 = 0;
    }
    const n_2333 = _t2332;
    let _t2335;
    if (((Ref$get(i_2308) < len_2306) && (String$get(spec, Ref$get(i_2308)) === 102))) {
      Ref$set(i_2308, (Ref$get(i_2308) + 1));
      _t2335 = ({_tag: 1, _name: "Some", _val: n_2333});
    } else {
      _t2335 = ({_tag: 0, _name: "None"});
    }
    const _t2334 = _t2335;
    const _t2328 = _t2334;
    _t2326 = _t2328;
  } else {
    _t2326 = ({_tag: 0, _name: "None"});
  }
  const float_prec_2336 = _t2326;
  let _t2338;
  if ((Ref$get(i_2308) < len_2306)) {
    let _t2340;
    const _t2339 = String$get(spec, Ref$get(i_2308));
    _t2341: {
      if (true) {
        const _c = _t2339;
        if ((_c === 120)) {
          Ref$set(i_2308, (Ref$get(i_2308) + 1));
          _t2340 = ({_tag: 1, _name: "Some", _val: 120});
          break _t2341;
        }
      }
      if (true) {
        const _c = _t2339;
        if ((_c === 88)) {
          Ref$set(i_2308, (Ref$get(i_2308) + 1));
          _t2340 = ({_tag: 1, _name: "Some", _val: 88});
          break _t2341;
        }
      }
      if (true) {
        const _c = _t2339;
        if ((_c === 111)) {
          Ref$set(i_2308, (Ref$get(i_2308) + 1));
          _t2340 = ({_tag: 1, _name: "Some", _val: 111});
          break _t2341;
        }
      }
      if (true) {
        const _c = _t2339;
        if ((_c === 98)) {
          Ref$set(i_2308, (Ref$get(i_2308) + 1));
          _t2340 = ({_tag: 1, _name: "Some", _val: 98});
          break _t2341;
        }
      }
      if (true) {
        _t2340 = ({_tag: 0, _name: "None"});
        break _t2341;
      }
      _match_fail("line 16190");
    }
    _t2338 = _t2340;
  } else {
    _t2338 = ({_tag: 0, _name: "None"});
  }
  const type_spec_2342 = _t2338;
  let _t2345;
  const _t2344 = float_prec_2336;
  _t2346: {
    if (_t2344._tag === 1) {
      const n = _t2344._val;
      _t2345 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_float"}), ({_tag: 0, _name: "EInt", _val: n})]}), expr]});
      break _t2346;
    }
    if (_t2344._tag === 0) {
      let _t2348;
      const _t2347 = type_spec_2342;
      _t2349: {
        if (_t2347._tag === 1) {
          const _c = _t2347._val;
          if ((_c === 120)) {
            _t2348 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_hex"}), expr]});
            break _t2349;
          }
        }
        if (_t2347._tag === 1) {
          const _c = _t2347._val;
          if ((_c === 88)) {
            _t2348 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_hex_upper"}), expr]});
            break _t2349;
          }
        }
        if (_t2347._tag === 1) {
          const _c = _t2347._val;
          if ((_c === 111)) {
            _t2348 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_oct"}), expr]});
            break _t2349;
          }
        }
        if (_t2347._tag === 1) {
          const _c = _t2347._val;
          if ((_c === 98)) {
            _t2348 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_bin"}), expr]});
            break _t2349;
          }
        }
        if (true) {
          _t2348 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), expr]});
          break _t2349;
        }
        _match_fail("line 16190");
      }
      _t2345 = _t2348;
      break _t2346;
    }
    _match_fail("line 16190");
  }
  const inner_2350 = _t2345;
  let _t2352;
  if (zero_pad_2316) {
    let _t2354;
    const _t2353 = width_2324;
    _t2355: {
      if (_t2353._tag === 1) {
        const w = _t2353._val;
        _t2354 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_zero_pad"}), ({_tag: 0, _name: "EInt", _val: w})]}), inner_2350]});
        break _t2355;
      }
      if (_t2353._tag === 0) {
        _t2354 = inner_2350;
        break _t2355;
      }
      _match_fail("line 16190");
    }
    _t2352 = _t2354;
  } else {
    _t2352 = inner_2350;
  }
  const inner_2356 = _t2352;
  let _t2358;
  if ((!zero_pad_2316)) {
    let _t2360;
    const _t2359 = [align_2313, width_2324];
    _t2361: {
      if (_t2359[0]._tag === 1 && _t2359[1]._tag === 1) {
        const _c = _t2359[0]._val;
        const w = _t2359[1]._val;
        if ((_c === 62)) {
          _t2360 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_pad_left"}), ({_tag: 0, _name: "EInt", _val: w})]}), inner_2356]});
          break _t2361;
        }
      }
      if (_t2359[0]._tag === 1 && _t2359[1]._tag === 1) {
        const _c = _t2359[0]._val;
        const w = _t2359[1]._val;
        if ((_c === 60)) {
          _t2360 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_pad_right"}), ({_tag: 0, _name: "EInt", _val: w})]}), inner_2356]});
          break _t2361;
        }
      }
      if (true) {
        _t2360 = inner_2356;
        break _t2361;
      }
      _match_fail("line 16190");
    }
    _t2358 = _t2360;
  } else {
    _t2358 = inner_2356;
  }
  const inner_2362 = _t2358;
  const _t2363 = inner_2362;
  const _t2357 = _t2363;
  const _t2351 = _t2357;
  const _t2343 = _t2351;
  const _t2337 = _t2343;
  const _t2325 = _t2337;
  const _t2319 = _t2325;
  const _t2317 = _t2319;
  const _t2314 = _t2317;
  const _t2309 = _t2314;
  const _t2307 = _t2309;
  return _t2307;
}
function Parser$parse_atom(p) {
  const loc_2364 = Parser$peek(p).loc;
  const expr_2366 = Parser$parse_atom_inner(p);
  const _t2367 = ({_tag: 49, _name: "ELoc", _val: [loc_2364, expr_2366]});
  const _t2365 = _t2367;
  return _t2365;
}
function Parser$parse_atom_inner(p) {
  let _t2369;
  const _t2368 = Parser$peek_kind(p);
  _t2370: {
    if (_t2368._tag === 0) {
      const n = _t2368._val;
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 0, _name: "EInt", _val: n});
      break _t2370;
    }
    if (_t2368._tag === 1) {
      const f = _t2368._val;
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 1, _name: "EFloat", _val: f});
      break _t2370;
    }
    if (_t2368._tag === 2) {
      const s = _t2368._val;
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 3, _name: "EString", _val: s});
      break _t2370;
    }
    if (_t2368._tag === 3) {
      const parts = _t2368._val;
      Parser$advance(p);
      undefined;
      function _t2371(part) {
        let _t2373;
        const _t2372 = part;
        _t2374: {
          if (_t2372._tag === 0) {
            const s = _t2372._val;
            _t2373 = ({_tag: 3, _name: "EString", _val: s});
            break _t2374;
          }
          if (_t2372._tag === 1) {
            const src = _t2372._val[0];
            const fmt = _t2372._val[1];
            const tokens_2375 = Lexer$tokenize(src);
            const inner_p_2377 = Parser$create(tokens_2375);
            const inner_expr_2379 = Parser$parse_expr(inner_p_2377);
            let _t2382;
            const _t2381 = fmt;
            _t2383: {
              if (_t2381._tag === 0) {
                _t2382 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), inner_expr_2379]});
                break _t2383;
              }
              if (_t2381._tag === 1) {
                const spec = _t2381._val;
                _t2382 = Parser$parse_format_spec(spec, inner_expr_2379);
                break _t2383;
              }
              _match_fail("line 16190");
            }
            const _t2380 = _t2382;
            const _t2378 = _t2380;
            const _t2376 = _t2378;
            _t2373 = _t2376;
            break _t2374;
          }
          _match_fail("line 16190");
        }
        return _t2373;
      }
      const exprs_2384 = List$map(_t2371, parts);
      let _t2387;
      const _t2386 = exprs_2384;
      _t2388: {
        if (_t2386 === null) {
          _t2387 = ({_tag: 3, _name: "EString", _val: ""});
          break _t2388;
        }
        if (_t2386 !== null && _t2386._tl === null) {
          const e = _t2386._hd;
          _t2387 = e;
          break _t2388;
        }
        if (_t2386 !== null) {
          const first = _t2386._hd;
          const rest = _t2386._tl;
          function _t2389(acc, e) {
            return ({_tag: 13, _name: "EBinop", _val: [({_tag: 13, _name: "Concat"}), acc, e]});
          }
          _t2387 = List$fold(_t2389, first, rest);
          break _t2388;
        }
        _match_fail("line 16190");
      }
      const _t2385 = _t2387;
      _t2369 = _t2385;
      break _t2370;
    }
    if (_t2368._tag === 6) {
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 2, _name: "EBool", _val: true});
      break _t2370;
    }
    if (_t2368._tag === 7) {
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 2, _name: "EBool", _val: false});
      break _t2370;
    }
    if (_t2368._tag === 4) {
      const n = _t2368._val;
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 4, _name: "EByte", _val: n});
      break _t2370;
    }
    if (_t2368._tag === 5) {
      const n = _t2368._val;
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 5, _name: "ERune", _val: n});
      break _t2370;
    }
    if (_t2368._tag === 8) {
      const s = _t2368._val;
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 7, _name: "EVar", _val: s});
      break _t2370;
    }
    if (_t2368._tag === 9) {
      const s = _t2368._val;
      Parser$advance(p);
      undefined;
      let _t2391;
      const _t2390 = Parser$read_qualified_path(p, s);
      _t2392: {
        if (_t2390._tag === 958595272) {
          const qualified = _t2390._val;
          _t2391 = ({_tag: 7, _name: "EVar", _val: qualified});
          break _t2392;
        }
        if (_t2390._tag === 1067578635) {
          const qualified = _t2390._val;
          _t2391 = ({_tag: 24, _name: "EConstruct", _val: [qualified, ({_tag: 0, _name: "None"})]});
          break _t2392;
        }
        if (_t2390._tag === 982234060) {
          const mod_path = _t2390._val;
          Parser$advance(p);
          undefined;
          const inner_2393 = Parser$parse_expr(p);
          Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
          const _t2394 = ({_tag: 48, _name: "ELocalOpen", _val: [mod_path, inner_2393]});
          _t2391 = _t2394;
          break _t2392;
        }
        _match_fail("line 16190");
      }
      _t2369 = _t2391;
      break _t2370;
    }
    if (_t2368._tag === 51) {
      Parser$advance(p);
      undefined;
      const op_name_2395 = Parser$token_to_op_name(Parser$peek_kind(p));
      let _t2398;
      const _t2397 = op_name_2395;
      _t2399: {
        if (_t2397._tag === 1) {
          const name = _t2397._val;
          if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 52, _name: "RPAREN"}))) {
            Parser$advance(p);
            undefined;
            Parser$advance(p);
            undefined;
            _t2398 = ({_tag: 7, _name: "EVar", _val: name});
            break _t2399;
          }
        }
        if (true) {
          let _t2400;
          if (_eq(Parser$peek_kind(p), ({_tag: 52, _name: "RPAREN"}))) {
            Parser$advance(p);
            undefined;
            _t2400 = ({_tag: 6, _name: "EUnit"});
          } else {
            const expr_2401 = Parser$parse_expr(p);
            let _t2404;
            const _t2403 = Parser$peek_kind(p);
            _t2405: {
              if (_t2403._tag === 58) {
                const exprs_2406 = Ref$create(({_hd: expr_2401, _tl: null}));
                let _t2408 = undefined;
                let _t2409 = false, _t2410;
                while (true) {
                  if (!(_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"})))) break;
                  Parser$advance(p);
                  undefined;
                  Ref$set(exprs_2406, ({_hd: Parser$parse_expr(p), _tl: Ref$get(exprs_2406)}));
                  if (_t2409) break;
                }
                _t2408 = _t2409 ? _t2410 : undefined;
                _t2408;
                Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
                const _t2407 = ({_tag: 15, _name: "ETuple", _val: List$rev(Ref$get(exprs_2406))});
                _t2404 = _t2407;
                break _t2405;
              }
              if (_t2403._tag === 61) {
                Parser$advance(p);
                undefined;
                const ty_2411 = Parser$parse_ty(p);
                Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
                const _t2412 = ({_tag: 30, _name: "EAnnot", _val: [expr_2401, ty_2411]});
                _t2404 = _t2412;
                break _t2405;
              }
              if (_t2403._tag === 89) {
                Parser$advance(p);
                undefined;
                const ty_2413 = Parser$parse_ty(p);
                Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
                const _t2414 = ({_tag: 47, _name: "ECoerce", _val: [expr_2401, ty_2413]});
                _t2404 = _t2414;
                break _t2405;
              }
              if (true) {
                Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
                _t2404 = expr_2401;
                break _t2405;
              }
              _match_fail("line 16190");
            }
            const _t2402 = _t2404;
            _t2400 = _t2402;
          }
          _t2398 = _t2400;
          break _t2399;
        }
        _match_fail("line 16190");
      }
      const _t2396 = _t2398;
      _t2369 = _t2396;
      break _t2370;
    }
    if (_t2368._tag === 53) {
      Parser$advance(p);
      undefined;
      let _t2415;
      if (_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
        Parser$advance(p);
        undefined;
        _t2415 = ({_tag: 16, _name: "ERecord", _val: null});
      } else {
        let _t2417;
        const _t2416 = Parser$peek_kind(p);
        _t2418: {
          if (_t2416._tag === 8) {
            const next_2419 = Parser$peek_kind_at(p, 1);
            const _t2420 = (_eq(next_2419, ({_tag: 74, _name: "EQ"})) || (_eq(next_2419, ({_tag: 59, _name: "SEMICOLON"})) || _eq(next_2419, ({_tag: 54, _name: "RBRACE"}))));
            _t2417 = _t2420;
            break _t2418;
          }
          if (true) {
            _t2417 = false;
            break _t2418;
          }
          _match_fail("line 16190");
        }
        let _t2421;
        if (_t2417) {
          const fields_2422 = Parser$parse_record_fields(p);
          Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
          const _t2423 = ({_tag: 16, _name: "ERecord", _val: fields_2422});
          _t2421 = _t2423;
        } else {
          const base_2424 = Parser$parse_expr(p);
          Parser$expect(p, ({_tag: 18, _name: "WITH"}));
          const fields_2426 = Parser$parse_record_fields(p);
          Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
          const _t2427 = ({_tag: 17, _name: "ERecordUpdate", _val: [base_2424, fields_2426]});
          const _t2425 = _t2427;
          _t2421 = _t2425;
        }
        _t2415 = _t2421;
      }
      _t2369 = _t2415;
      break _t2370;
    }
    if (_t2368._tag === 55) {
      Parser$advance(p);
      undefined;
      let _t2428;
      if (_eq(Parser$peek_kind(p), ({_tag: 56, _name: "RBRACKET"}))) {
        Parser$advance(p);
        undefined;
        _t2428 = ({_tag: 21, _name: "ENil"});
      } else {
        const elems_2429 = Parser$parse_list_elems(p);
        Parser$expect(p, ({_tag: 56, _name: "RBRACKET"}));
        const _t2430 = ({_tag: 22, _name: "EList", _val: elems_2429});
        _t2428 = _t2430;
      }
      _t2369 = _t2428;
      break _t2370;
    }
    if (_t2368._tag === 40) {
      Parser$advance(p);
      undefined;
      let _t2432;
      const _t2431 = Parser$peek_kind(p);
      _t2433: {
        if (_t2431._tag === 53) {
          Parser$advance(p);
          undefined;
          let _t2435;
          const _t2434 = Parser$parse_set_or_map(p);
          _t2436: {
            if (_t2434._tag === 887353506) {
              const pairs = _t2434._val;
              Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
              _t2435 = ({_tag: 42, _name: "EMap", _val: pairs});
              break _t2436;
            }
            if (_t2434._tag === 98602162) {
              const elems = _t2434._val;
              Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
              _t2435 = ({_tag: 44, _name: "ESet", _val: elems});
              break _t2436;
            }
            if (_t2434._tag === 533146490) {
              const expr = _t2434._val;
              Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
              _t2435 = expr;
              break _t2436;
            }
            _match_fail("line 16190");
          }
          _t2432 = _t2435;
          break _t2433;
        }
        if (_t2431._tag === 55) {
          Parser$advance(p);
          undefined;
          let _t2437;
          if (_eq(Parser$peek_kind(p), ({_tag: 56, _name: "RBRACKET"}))) {
            Parser$advance(p);
            undefined;
            _t2437 = ({_tag: 23, _name: "EArray", _val: null});
          } else {
            const elems_2438 = Parser$parse_list_elems(p);
            Parser$expect(p, ({_tag: 56, _name: "RBRACKET"}));
            const _t2439 = ({_tag: 23, _name: "EArray", _val: elems_2438});
            _t2437 = _t2439;
          }
          _t2432 = _t2437;
          break _t2433;
        }
        if ((_t2431._tag === 9 || _t2431._tag === 8)) {
          const name = _t2431._val;
          Parser$advance(p);
          undefined;
          let _t2441;
          const _t2440 = Parser$peek_kind(p);
          _t2442: {
            if (_t2440._tag === 53) {
              Parser$advance(p);
              undefined;
              let _t2444;
              const _t2443 = Parser$parse_set_or_map(p);
              _t2445: {
                if (_t2443._tag === 887353506) {
                  const pairs = _t2443._val;
                  Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
                  _t2444 = ({_tag: 43, _name: "EMapTyped", _val: [name, pairs]});
                  break _t2445;
                }
                if (_t2443._tag === 98602162) {
                  const elems = _t2443._val;
                  Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
                  _t2444 = ({_tag: 45, _name: "ECollTyped", _val: [name, elems]});
                  break _t2445;
                }
                if (_t2443._tag === 533146490) {
                  const expr = _t2443._val;
                  Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
                  _t2444 = expr;
                  break _t2445;
                }
                _match_fail("line 16190");
              }
              _t2441 = _t2444;
              break _t2442;
            }
            if (_t2440._tag === 55) {
              Parser$advance(p);
              undefined;
              let _t2446;
              if (_eq(Parser$peek_kind(p), ({_tag: 56, _name: "RBRACKET"}))) {
                Parser$advance(p);
                undefined;
                _t2446 = ({_tag: 45, _name: "ECollTyped", _val: [name, null]});
              } else {
                const elems_2447 = Parser$parse_list_elems(p);
                Parser$expect(p, ({_tag: 56, _name: "RBRACKET"}));
                const _t2448 = ({_tag: 45, _name: "ECollTyped", _val: [name, elems_2447]});
                _t2446 = _t2448;
              }
              _t2441 = _t2446;
              break _t2442;
            }
            if (true) {
              _t2441 = Parser$error(p, "expected '{' or '[' after type name");
              break _t2442;
            }
            _match_fail("line 16190");
          }
          _t2432 = _t2441;
          break _t2433;
        }
        if (true) {
          _t2432 = Parser$error(p, "expected '{', '[', or type name after '#'");
          break _t2433;
        }
        _match_fail("line 16190");
      }
      _t2369 = _t2432;
      break _t2370;
    }
    if (_t2368._tag === 88) {
      const tag = _t2368._val;
      Parser$advance(p);
      undefined;
      let _t2449;
      if ((Parser$at_atom_start(p) && (!Parser$is_keyword_expr_start(p)))) {
        _t2449 = ({_tag: 46, _name: "EPolyVariant", _val: [tag, ({_tag: 1, _name: "Some", _val: Parser$parse_postfix(p)})]});
      } else {
        _t2449 = ({_tag: 46, _name: "EPolyVariant", _val: [tag, ({_tag: 0, _name: "None"})]});
      }
      _t2369 = _t2449;
      break _t2370;
    }
    if (_t2368._tag === 34) {
      Parser$advance(p);
      undefined;
      const e_2450 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 46, _name: "END"}));
      const _t2451 = e_2450;
      _t2369 = _t2451;
      break _t2370;
    }
    if (_t2368._tag === 16) {
      _t2369 = Parser$parse_fun(p);
      break _t2370;
    }
    if (_t2368._tag === 14) {
      _t2369 = Parser$parse_if(p);
      break _t2370;
    }
    if (_t2368._tag === 11) {
      _t2369 = Parser$parse_let_expr(p);
      break _t2370;
    }
    if (_t2368._tag === 17) {
      _t2369 = Parser$parse_match(p, false);
      break _t2370;
    }
    if (_t2368._tag === 38) {
      Parser$advance(p);
      undefined;
      _t2369 = Parser$parse_match(p, true);
      break _t2370;
    }
    if (_t2368._tag === 68) {
      Parser$advance(p);
      undefined;
      const expr_2452 = Parser$parse_postfix(p);
      const _t2453 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 0, _name: "Neg"}), expr_2452]});
      _t2369 = _t2453;
      break _t2370;
    }
    if (_t2368._tag === 39) {
      Parser$advance(p);
      undefined;
      const expr_2454 = Parser$parse_postfix(p);
      const _t2455 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 1, _name: "Not"}), expr_2454]});
      _t2369 = _t2455;
      break _t2370;
    }
    if (_t2368._tag === 85) {
      Parser$advance(p);
      undefined;
      const expr_2456 = Parser$parse_postfix(p);
      const _t2457 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 2, _name: "Lnot"}), expr_2456]});
      _t2369 = _t2457;
      break _t2370;
    }
    if (_t2368._tag === 25) {
      Parser$advance(p);
      undefined;
      const op_name_2458 = Parser$expect_ident(p);
      let _t2460;
      if (Parser$at_atom_start(p)) {
        _t2460 = Parser$parse_postfix(p);
      } else {
        _t2460 = ({_tag: 6, _name: "EUnit"});
      }
      const arg_2461 = _t2460;
      const _t2462 = ({_tag: 39, _name: "EPerform", _val: [op_name_2458, arg_2461]});
      const _t2459 = _t2462;
      _t2369 = _t2459;
      break _t2370;
    }
    if (_t2368._tag === 26) {
      _t2369 = Parser$parse_handle_expr(p);
      break _t2370;
    }
    if (_t2368._tag === 27) {
      _t2369 = Parser$parse_try_expr(p);
      break _t2370;
    }
    if (_t2368._tag === 28) {
      _t2369 = Parser$parse_provide_expr(p);
      break _t2370;
    }
    if (_t2368._tag === 30) {
      Parser$advance(p);
      undefined;
      const k_2463 = Parser$parse_atom(p);
      const v_2465 = Parser$parse_atom(p);
      const _t2466 = ({_tag: 41, _name: "EResume", _val: [k_2463, v_2465]});
      const _t2464 = _t2466;
      _t2369 = _t2464;
      break _t2370;
    }
    if (_t2368._tag === 33) {
      _t2369 = Parser$parse_for_expr(p);
      break _t2370;
    }
    if (_t2368._tag === 35) {
      Parser$advance(p);
      undefined;
      let _t2467;
      if (Parser$at_atom_start(p)) {
        _t2467 = ({_tag: 35, _name: "EBreak", _val: ({_tag: 1, _name: "Some", _val: Parser$parse_atom(p)})});
      } else {
        _t2467 = ({_tag: 35, _name: "EBreak", _val: ({_tag: 0, _name: "None"})});
      }
      _t2369 = _t2467;
      break _t2370;
    }
    if (_t2368._tag === 29) {
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 36, _name: "EContinueLoop"});
      break _t2370;
    }
    if (_t2368._tag === 31) {
      Parser$advance(p);
      undefined;
      _t2369 = ({_tag: 37, _name: "EReturn", _val: Parser$parse_expr_bp(p, 0)});
      break _t2370;
    }
    if (_t2368._tag === 62) {
      Parser$advance(p);
      undefined;
      const field_2468 = Parser$expect_ident(p);
      const r_2470 = ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__r"});
      const _t2471 = ({_tag: 10, _name: "EFun", _val: [r_2470, ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__r"}), field_2468]})]});
      const _t2469 = _t2471;
      _t2369 = _t2469;
      break _t2370;
    }
    if (true) {
      _t2369 = Parser$error(p, "expected expression");
      break _t2370;
    }
    _match_fail("line 16190");
  }
  return _t2369;
}
function Parser$at_atom_start(p) {
  let _t2473;
  const _t2472 = Parser$peek_kind(p);
  _t2474: {
    if ((((((((((((((((_t2472._tag === 0 || _t2472._tag === 1) || _t2472._tag === 2) || _t2472._tag === 3) || _t2472._tag === 4) || _t2472._tag === 5) || _t2472._tag === 6) || _t2472._tag === 7) || _t2472._tag === 8) || _t2472._tag === 9) || _t2472._tag === 51) || _t2472._tag === 53) || _t2472._tag === 55) || _t2472._tag === 40) || _t2472._tag === 62) || _t2472._tag === 88)) {
      _t2473 = true;
      break _t2474;
    }
    if (true) {
      _t2473 = false;
      break _t2474;
    }
    _match_fail("line 16190");
  }
  return _t2473;
}
function Parser$is_adjacent(p) {
  let _t2479;
  if ((p.pos > 0)) {
  const prev_2475 = Array$get(p.tokens, (p.pos - 1));
  const cur_2477 = Parser$peek(p);
  const _t2478 = (prev_2475.end_offset === cur_2477.loc.offset);
  const _t2476 = _t2478;
    _t2479 = _t2476;
  } else {
    _t2479 = false;
  }
  return _t2479;
}
function Parser$parse_postfix(p) {
  const expr_2480 = Parser$parse_atom(p);
  function loop(expr) {
    while (true) {
      let _t2483;
      const _t2482 = Parser$peek_kind(p);
      _t2484: {
        if (_t2482._tag === 62) {
          if (Parser$is_adjacent(p)) {
            Parser$advance(p);
            undefined;
            let _t2485;
            if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "LBRACKET"}))) {
              Parser$advance(p);
              undefined;
              const idx_2486 = Parser$parse_expr(p);
              Parser$expect(p, ({_tag: 56, _name: "RBRACKET"}));
              const _t2488 = ({_tag: 19, _name: "EIndex", _val: [expr, idx_2486]});
              expr = _t2488;
              continue;
              const _t2487 = undefined;
              _t2485 = _t2487;
            } else {
              const field_2489 = Parser$expect_ident(p);
              const _t2491 = ({_tag: 18, _name: "EField", _val: [expr, field_2489]});
              expr = _t2491;
              continue;
              const _t2490 = undefined;
              _t2485 = _t2490;
            }
            _t2483 = _t2485;
            break _t2484;
          }
        }
        if (true) {
          _t2483 = expr;
          break _t2484;
        }
        _match_fail("line 16190");
      }
      return _t2483;
    }
  }
  const _t2492 = loop(expr_2480);
  const _t2481 = _t2492;
  return _t2481;
}
function Parser$parse_app(p) {
  const fn__2493 = Parser$parse_postfix(p);
  function loop(expr) {
    while (true) {
      let _t2496;
      const _t2495 = Parser$peek_kind(p);
      _t2497: {
        if (true) {
          if ((Parser$at_atom_start(p) && (!Parser$is_keyword_expr_start(p)))) {
            const arg_2498 = Parser$parse_postfix(p);
            let _t2501;
            const _t2500 = expr;
            _t2502: {
              if ((_t2500._tag === 24 && _t2500._val[1]._tag === 0 || _t2500._tag === 49 && _t2500._val[1]._tag === 24 && _t2500._val[1]._val[1]._tag === 0)) {
                const name = (_t2500._tag === 24 && _t2500._val[1]._tag === 0 ? _t2500._val[0] : _t2500._val[1]._val[0]);
                const _t2503 = ({_tag: 24, _name: "EConstruct", _val: [name, ({_tag: 1, _name: "Some", _val: arg_2498})]});
                expr = _t2503;
                continue;
                _t2501 = undefined;
                break _t2502;
              }
              if (true) {
                const _t2504 = ({_tag: 11, _name: "EApp", _val: [expr, arg_2498]});
                expr = _t2504;
                continue;
                _t2501 = undefined;
                break _t2502;
              }
              _match_fail("line 16190");
            }
            const _t2499 = _t2501;
            _t2496 = _t2499;
            break _t2497;
          }
        }
        if (true) {
          _t2496 = expr;
          break _t2497;
        }
        _match_fail("line 16190");
      }
      return _t2496;
    }
  }
  const _t2505 = loop(fn__2493);
  const _t2494 = _t2505;
  return _t2494;
}
function Parser$is_keyword_expr_start(p) {
  let _t2507;
  const _t2506 = Parser$peek_kind(p);
  _t2508: {
    if (((((((((((((_t2506._tag === 16 || _t2506._tag === 14) || _t2506._tag === 11) || _t2506._tag === 17) || _t2506._tag === 25) || _t2506._tag === 26) || _t2506._tag === 27) || _t2506._tag === 28) || _t2506._tag === 30) || _t2506._tag === 33) || _t2506._tag === 35) || _t2506._tag === 29) || _t2506._tag === 31)) {
      _t2507 = true;
      break _t2508;
    }
    if (true) {
      _t2507 = false;
      break _t2508;
    }
    _match_fail("line 16190");
  }
  return _t2507;
}
function Parser$parse_expr_bp(p, min_bp) {
  const lhs_2509 = Parser$parse_app(p);
  function loop(lhs) {
    while (true) {
      const kind_2511 = Parser$peek_kind(p);
      let _t2513;
      if (Parser$is_binop(kind_2511)) {
        let _t2515;
        const _t2514 = Parser$bp_of_binop(kind_2511);
        _t2516: {
          if (true) {
            const l_bp = _t2514[0];
            const r_bp = _t2514[1];
            let _t2517;
            if ((l_bp < min_bp)) {
              _t2517 = lhs;
            } else {
              Parser$advance(p);
              undefined;
              let _t2518;
              if (_eq(kind_2511, ({_tag: 72, _name: "COLONCOLON"}))) {
                const rhs_2519 = Parser$parse_expr_bp(p, r_bp);
                const _t2521 = ({_tag: 20, _name: "ECons", _val: [lhs, rhs_2519]});
                lhs = _t2521;
                continue;
                const _t2520 = undefined;
                _t2518 = _t2520;
              } else {
                const rhs_2522 = Parser$parse_expr_bp(p, r_bp);
                const _t2524 = ({_tag: 13, _name: "EBinop", _val: [Parser$binop_of_token(kind_2511), lhs, rhs_2522]});
                lhs = _t2524;
                continue;
                const _t2523 = undefined;
                _t2518 = _t2523;
              }
              _t2517 = _t2518;
            }
            _t2515 = _t2517;
            break _t2516;
          }
          _match_fail("line 16190");
        }
        _t2513 = _t2515;
      } else {
        _t2513 = lhs;
      }
      const _t2512 = _t2513;
      return _t2512;
    }
  }
  const _t2525 = loop(lhs_2509);
  const _t2510 = _t2525;
  return _t2510;
}
function Parser$parse_expr_no_seq(p) {
  const e_2526 = Parser$parse_expr_bp(p, 0);
  let _t2529;
  const _t2528 = Parser$peek_kind(p);
  _t2530: {
    if (_t2528._tag === 73) {
      Parser$advance(p);
      undefined;
      const rhs_2531 = Parser$parse_expr_bp(p, 0);
      let _t2534;
      const _t2533 = e_2526;
      _t2535: {
        if (_t2533._tag === 49) {
          const inner = _t2533._val[1];
          _t2534 = inner;
          break _t2535;
        }
        if (true) {
          const e = _t2533;
          _t2534 = e;
          break _t2535;
        }
        _match_fail("line 16190");
      }
      const e_inner_2536 = _t2534;
      let _t2539;
      const _t2538 = e_inner_2536;
      _t2540: {
        if (_t2538._tag === 7) {
          const name = _t2538._val;
          _t2539 = ({_tag: 27, _name: "EAssign", _val: [name, rhs_2531]});
          break _t2540;
        }
        if (_t2538._tag === 18) {
          const obj = _t2538._val[0];
          const field = _t2538._val[1];
          _t2539 = ({_tag: 28, _name: "EFieldAssign", _val: [obj, field, rhs_2531]});
          break _t2540;
        }
        if (true) {
          _t2539 = Parser$error(p, "left side of := must be a variable or field access");
          break _t2540;
        }
        _match_fail("line 16190");
      }
      const _t2537 = _t2539;
      const _t2532 = _t2537;
      _t2529 = _t2532;
      break _t2530;
    }
    if (true) {
      _t2529 = e_2526;
      break _t2530;
    }
    _match_fail("line 16190");
  }
  const _t2527 = _t2529;
  return _t2527;
}
function Parser$parse_expr(p) {
  const e_2541 = Parser$parse_expr_bp(p, 0);
  let _t2544;
  const _t2543 = Parser$peek_kind(p);
  _t2545: {
    if (_t2543._tag === 73) {
      Parser$advance(p);
      undefined;
      const rhs_2546 = Parser$parse_expr_bp(p, 0);
      let _t2549;
      const _t2548 = e_2541;
      _t2550: {
        if (_t2548._tag === 49) {
          const inner = _t2548._val[1];
          _t2549 = inner;
          break _t2550;
        }
        if (true) {
          const e = _t2548;
          _t2549 = e;
          break _t2550;
        }
        _match_fail("line 16190");
      }
      const e_inner_2551 = _t2549;
      let _t2554;
      const _t2553 = e_inner_2551;
      _t2555: {
        if (_t2553._tag === 7) {
          const name = _t2553._val;
          _t2554 = ({_tag: 27, _name: "EAssign", _val: [name, rhs_2546]});
          break _t2555;
        }
        if (_t2553._tag === 18) {
          const obj = _t2553._val[0];
          const field = _t2553._val[1];
          _t2554 = ({_tag: 28, _name: "EFieldAssign", _val: [obj, field, rhs_2546]});
          break _t2555;
        }
        if (true) {
          _t2554 = Parser$error(p, "left side of := must be a variable or field access");
          break _t2555;
        }
        _match_fail("line 16190");
      }
      const assign_2556 = _t2554;
      let _t2559;
      const _t2558 = Parser$peek_kind(p);
      _t2560: {
        if (_t2558._tag === 59) {
          if (!_eq(Parser$peek_next_kind(p), ({_tag: 1, _name: "Some", _val: ({_tag: 59, _name: "SEMICOLON"})}))) {
            Parser$advance(p);
            undefined;
            let _t2561;
            if (Parser$at_expr_start(p)) {
              _t2561 = ({_tag: 29, _name: "ESeq", _val: [assign_2556, Parser$parse_expr(p)]});
            } else {
              _t2561 = assign_2556;
            }
            _t2559 = _t2561;
            break _t2560;
          }
        }
        if (true) {
          _t2559 = assign_2556;
          break _t2560;
        }
        _match_fail("line 16190");
      }
      const _t2557 = _t2559;
      const _t2552 = _t2557;
      const _t2547 = _t2552;
      _t2544 = _t2547;
      break _t2545;
    }
    if (_t2543._tag === 59) {
      if (!_eq(Parser$peek_next_kind(p), ({_tag: 1, _name: "Some", _val: ({_tag: 59, _name: "SEMICOLON"})}))) {
        Parser$advance(p);
        undefined;
        let _t2562;
        if (Parser$at_expr_start(p)) {
          const e2_2563 = Parser$parse_expr(p);
          const _t2564 = ({_tag: 29, _name: "ESeq", _val: [e_2541, e2_2563]});
          _t2562 = _t2564;
        } else {
          _t2562 = e_2541;
        }
        _t2544 = _t2562;
        break _t2545;
      }
    }
    if (true) {
      _t2544 = e_2541;
      break _t2545;
    }
    _match_fail("line 16190");
  }
  const _t2542 = _t2544;
  return _t2542;
}
function Parser$peek_next_kind(p) {
  let _t2565;
  if (((p.pos + 1) < Array$length(p.tokens))) {
    _t2565 = ({_tag: 1, _name: "Some", _val: Array$get(p.tokens, (p.pos + 1)).kind});
  } else {
    _t2565 = ({_tag: 0, _name: "None"});
  }
  return _t2565;
}
function Parser$parse_fun_param(p) {
  let _t2567;
  const _t2566 = Parser$peek_kind(p);
  _t2568: {
    if (_t2566._tag === 51) {
      Parser$advance(p);
      undefined;
      let _t2569;
      if (_eq(Parser$peek_kind(p), ({_tag: 52, _name: "RPAREN"}))) {
        Parser$advance(p);
        undefined;
        _t2569 = ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "TyName", _val: "unit"})}), is_generated: false, name: "_"})});
      } else {
        const pat_2570 = Parser$parse_pattern(p);
        let _t2572;
        if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"}))) {
          const pats_2573 = Ref$create(({_hd: pat_2570, _tl: null}));
          let _t2575 = undefined;
          let _t2576 = false, _t2577;
          while (true) {
            if (!(_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"})))) break;
            Parser$advance(p);
            undefined;
            Ref$set(pats_2573, ({_hd: Parser$parse_pattern(p), _tl: Ref$get(pats_2573)}));
            if (_t2576) break;
          }
          _t2575 = _t2576 ? _t2577 : undefined;
          _t2575;
          const _t2574 = ({_tag: 7, _name: "PatTuple", _val: List$rev(Ref$get(pats_2573))});
          _t2572 = _t2574;
        } else {
          _t2572 = pat_2570;
        }
        const pat_2578 = _t2572;
        let _t2580;
        if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
          Parser$advance(p);
          undefined;
          _t2580 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
        } else {
          _t2580 = ({_tag: 0, _name: "None"});
        }
        const annot_2581 = _t2580;
        Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
        let _t2584;
        const _t2583 = [pat_2578, annot_2581];
        _t2585: {
          if (_t2583[0]._tag === 1) {
            const name = _t2583[0]._val;
            _t2584 = ({_tag: 0, _name: "FPParam", _val: ({annot: annot_2581, is_generated: false, name: name})});
            break _t2585;
          }
          if (true) {
            const pname_2586 = Parser$fresh_param_name(undefined);
            const _t2587 = ({_tag: 1, _name: "FPPat", _val: [pname_2586, pat_2578, annot_2581]});
            _t2584 = _t2587;
            break _t2585;
          }
          _match_fail("line 16190");
        }
        const _t2582 = _t2584;
        const _t2579 = _t2582;
        const _t2571 = _t2579;
        _t2569 = _t2571;
      }
      _t2567 = _t2569;
      break _t2568;
    }
    if (_t2566._tag === 53) {
      const pat_2588 = Parser$parse_pattern_atom(p);
      const pname_2590 = Parser$fresh_param_name(undefined);
      const _t2591 = ({_tag: 1, _name: "FPPat", _val: [pname_2590, pat_2588, ({_tag: 0, _name: "None"})]});
      const _t2589 = _t2591;
      _t2567 = _t2589;
      break _t2568;
    }
    if (_t2566._tag === 8) {
      const s = _t2566._val;
      Parser$advance(p);
      undefined;
      _t2567 = ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: s})});
      break _t2568;
    }
    if (_t2566._tag === 66) {
      Parser$advance(p);
      undefined;
      _t2567 = ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "_"})});
      break _t2568;
    }
    if (true) {
      _t2567 = Parser$error(p, "expected parameter");
      break _t2568;
    }
    _match_fail("line 16190");
  }
  return _t2567;
}
function Parser$parse_fun(p) {
  Parser$expect(p, ({_tag: 16, _name: "FN"}));
  let _t2592;
  if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
    Parser$advance(p);
    undefined;
    const arms_2593 = Ref$create(null);
    const continue__2595 = Ref$create(true);
    let _t2597 = undefined;
    let _t2598 = false, _t2599;
    while (true) {
      if (!(Ref$get(continue__2595))) break;
      const pat_2600 = Parser$parse_pattern(p);
      let _t2602;
      if (_eq(Parser$peek_kind(p), ({_tag: 36, _name: "WHEN"}))) {
        Parser$advance(p);
        undefined;
        _t2602 = ({_tag: 1, _name: "Some", _val: Parser$parse_expr(p)});
      } else {
        _t2602 = ({_tag: 0, _name: "None"});
      }
      const guard_2603 = _t2602;
      Parser$expect(p, ({_tag: 57, _name: "ARROW"}));
      const body_2605 = Parser$parse_expr(p);
      Ref$set(arms_2593, ({_hd: [pat_2600, guard_2603, body_2605], _tl: Ref$get(arms_2593)}));
      let _t2607;
      if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
        Parser$advance(p);
        _t2607 = undefined;
      } else {
        _t2607 = Ref$set(continue__2595, false);
      }
      const _t2606 = _t2607;
      const _t2604 = _t2606;
      const _t2601 = _t2604;
      _t2601;
      if (_t2598) break;
    }
    _t2597 = _t2598 ? _t2599 : undefined;
    _t2597;
    const param_2608 = ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__x"});
    const _t2609 = ({_tag: 10, _name: "EFun", _val: [param_2608, ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: "__x"}), List$rev(Ref$get(arms_2593)), false]})]});
    const _t2596 = _t2609;
    const _t2594 = _t2596;
    _t2592 = _t2594;
  } else {
    const fun_params_2610 = Ref$create(null);
    let _t2612 = undefined;
    let _t2613 = false, _t2614;
    while (true) {
      if (!(!_eq(Parser$peek_kind(p), ({_tag: 57, _name: "ARROW"})))) break;
      Ref$set(fun_params_2610, ({_hd: Parser$parse_fun_param(p), _tl: Ref$get(fun_params_2610)}));
      if (_t2613) break;
    }
    _t2612 = _t2613 ? _t2614 : undefined;
    _t2612;
    let _t2615;
    if (_eq(Ref$get(fun_params_2610), null)) {
      _t2615 = Ref$set(fun_params_2610, ({_hd: ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "TyName", _val: "unit"})}), is_generated: false, name: "_"})}), _tl: null}));
    } else {
      _t2615 = undefined;
    }
    _t2615;
    Parser$expect(p, ({_tag: 57, _name: "ARROW"}));
    const body_2616 = Parser$parse_expr(p);
    function _t2618(body, fp) {
      let _t2620;
      const _t2619 = fp;
      _t2621: {
        if (_t2619._tag === 0) {
          _t2620 = body;
          break _t2621;
        }
        if (_t2619._tag === 1) {
          const name = _t2619._val[0];
          const pat = _t2619._val[1];
          _t2620 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
          break _t2621;
        }
        _match_fail("line 16190");
      }
      return _t2620;
    }
    const body_2622 = List$fold(_t2618, body_2616, Ref$get(fun_params_2610));
    function _t2624(fp) {
      let _t2626;
      const _t2625 = fp;
      _t2627: {
        if (_t2625._tag === 0) {
          const param = _t2625._val;
          _t2626 = param;
          break _t2627;
        }
        if (_t2625._tag === 1) {
          const name = _t2625._val[0];
          const annot = _t2625._val[2];
          _t2626 = ({annot: annot, is_generated: false, name: name});
          break _t2627;
        }
        _match_fail("line 16190");
      }
      return _t2626;
    }
    const params_2628 = List$map(_t2624, Ref$get(fun_params_2610));
    function _t2630(body, param) {
      return ({_tag: 10, _name: "EFun", _val: [param, body]});
    }
    const _t2629 = List$fold(_t2630, body_2622, params_2628);
    const _t2623 = _t2629;
    const _t2617 = _t2623;
    const _t2611 = _t2617;
    _t2592 = _t2611;
  }
  return _t2592;
}
function Parser$parse_param(p) {
  return Parser$parse_fun_param(p);
}
function Parser$parse_if(p) {
  Parser$expect(p, ({_tag: 14, _name: "IF"}));
  const cond_2631 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 34, _name: "DO"}));
  const then_e_2633 = Parser$parse_expr(p);
  let _t2636;
  const _t2635 = Parser$peek_kind(p);
  _t2637: {
    if (_t2635._tag === 15) {
      Parser$advance(p);
      undefined;
      const else_e_2638 = Parser$parse_expr_no_seq(p);
      const _t2639 = ({_tag: 12, _name: "EIf", _val: [cond_2631, then_e_2633, else_e_2638]});
      _t2636 = _t2639;
      break _t2637;
    }
    if (_t2635._tag === 46) {
      Parser$advance(p);
      undefined;
      _t2636 = ({_tag: 12, _name: "EIf", _val: [cond_2631, then_e_2633, ({_tag: 6, _name: "EUnit"})]});
      break _t2637;
    }
    if (true) {
      _t2636 = Parser$error(p, "expected 'else' or 'end' after if body");
      break _t2637;
    }
    _match_fail("line 16190");
  }
  const _t2634 = _t2636;
  const _t2632 = _t2634;
  return _t2632;
}
function Parser$parse_type_params(p) {
  let _t2640;
  if ((_eq(Parser$peek_kind(p), ({_tag: 51, _name: "LPAREN"})) && _eq(Parser$peek_kind_at(p, 1), ({_tag: 19, _name: "TYPE"})))) {
    Parser$advance(p);
    undefined;
    Parser$advance(p);
    undefined;
    const tyvars_2641 = Ref$create(null);
    let _t2643 = undefined;
    let _t2644 = false, _t2645;
    while (true) {
      let _t2647;
      const _t2646 = Parser$peek_kind(p);
      _t2648: {
        if (_t2646._tag === 10) {
          _t2647 = true;
          break _t2648;
        }
        if (true) {
          _t2647 = false;
          break _t2648;
        }
        _match_fail("line 16190");
      }
      if (!(_t2647)) break;
      let _t2650;
      const _t2649 = Parser$advance(p);
      _t2651: {
        if (_t2649.kind._tag === 10) {
          const s = _t2649.kind._val;
          _t2650 = Ref$set(tyvars_2641, ({_hd: s, _tl: Ref$get(tyvars_2641)}));
          break _t2651;
        }
        if (true) {
          _t2650 = undefined;
          break _t2651;
        }
        _match_fail("line 16190");
      }
      _t2650;
      if (_t2644) break;
    }
    _t2643 = _t2644 ? _t2645 : undefined;
    _t2643;
    let _t2652;
    if (_eq(Ref$get(tyvars_2641), null)) {
      _t2652 = Parser$error(p, "expected type variable after 'type'");
    } else {
      _t2652 = undefined;
    }
    _t2652;
    Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
    const _t2642 = List$rev(Ref$get(tyvars_2641));
    _t2640 = _t2642;
  } else {
    _t2640 = null;
  }
  return _t2640;
}
function Parser$parse_let_expr(p) {
  Parser$expect(p, ({_tag: 11, _name: "LET"}));
  const is_rec_2653 = _eq(Parser$peek_kind(p), ({_tag: 12, _name: "REC"}));
  let _t2655;
  if (is_rec_2653) {
    Parser$advance(p);
    _t2655 = undefined;
  } else {
    _t2655 = undefined;
  }
  _t2655;
  const is_mut_2656 = _eq(Parser$peek_kind(p), ({_tag: 32, _name: "MUT"}));
  let _t2658;
  if (is_mut_2656) {
    Parser$advance(p);
    _t2658 = undefined;
  } else {
    _t2658 = undefined;
  }
  _t2658;
  let _t2659;
  if ((is_rec_2653 && is_mut_2656)) {
    _t2659 = Parser$error(p, "let rec mut is not supported");
  } else {
    _t2659 = undefined;
  }
  _t2659;
  let _t2660;
  if (((!is_rec_2653) && ((!is_mut_2656) && Parser$is_destruct_start(p)))) {
    const pat_2661 = Parser$parse_pattern(p);
    Parser$expect(p, ({_tag: 74, _name: "EQ"}));
    const e1_2663 = Parser$parse_expr(p);
    Parser$expect(p, ({_tag: 13, _name: "IN"}));
    const e2_2665 = Parser$parse_expr(p);
    const _t2666 = ({_tag: 25, _name: "EMatch", _val: [e1_2663, ({_hd: [pat_2661, ({_tag: 0, _name: "None"}), e2_2665], _tl: null}), true]});
    const _t2664 = _t2666;
    const _t2662 = _t2664;
    _t2660 = _t2662;
  } else {
    let _t2667;
    if (is_rec_2653) {
      _t2667 = Parser$parse_type_params(p);
    } else {
      _t2667 = null;
    }
    const type_params_2668 = _t2667;
    const name_2670 = Parser$expect_ident(p);
    let _t2672;
    if (is_mut_2656) {
      let _t2673;
      if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        _t2673 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
      } else {
        _t2673 = ({_tag: 0, _name: "None"});
      }
      const annot_2674 = _t2673;
      Parser$expect(p, ({_tag: 74, _name: "EQ"}));
      const body_2676 = Parser$parse_expr(p);
      let _t2679;
      const _t2678 = annot_2674;
      _t2680: {
        if (_t2678._tag === 1) {
          const ty = _t2678._val;
          _t2679 = ({_tag: 30, _name: "EAnnot", _val: [body_2676, ty]});
          break _t2680;
        }
        if (_t2678._tag === 0) {
          _t2679 = body_2676;
          break _t2680;
        }
        _match_fail("line 16190");
      }
      const body_2681 = _t2679;
      Parser$expect(p, ({_tag: 13, _name: "IN"}));
      const rest_2683 = Parser$parse_expr(p);
      const _t2684 = ({_tag: 26, _name: "ELetMut", _val: [name_2670, body_2681, rest_2683]});
      const _t2682 = _t2684;
      const _t2677 = _t2682;
      const _t2675 = _t2677;
      _t2672 = _t2675;
    } else {
      const params_2685 = Ref$create(null);
      let _t2687 = undefined;
      let _t2688 = false, _t2689;
      while (true) {
        if (!((!_eq(Parser$peek_kind(p), ({_tag: 74, _name: "EQ"})) && !_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))))) break;
        Ref$set(params_2685, ({_hd: Parser$parse_param(p), _tl: Ref$get(params_2685)}));
        if (_t2688) break;
      }
      _t2687 = _t2688 ? _t2689 : undefined;
      _t2687;
      let _t2690;
      if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        const ty_2691 = Parser$parse_ty(p);
        let _t2693;
        if (_eq(Parser$peek_kind(p), ({_tag: 70, _name: "SLASH"}))) {
          Parser$advance(p);
          undefined;
          let _t2694;
          if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
            Parser$advance(p);
            undefined;
            _t2694 = ({_tag: 0, _name: "EffAnnotPure"});
          } else {
            _t2694 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
          }
          const eff_2695 = _t2694;
          const _t2696 = ({_tag: 1, _name: "Some", _val: ({_tag: 11, _name: "TyWithEffect", _val: [ty_2691, eff_2695]})});
          _t2693 = _t2696;
        } else {
          _t2693 = ({_tag: 1, _name: "Some", _val: ty_2691});
        }
        const _t2692 = _t2693;
        _t2690 = _t2692;
      } else {
        _t2690 = ({_tag: 0, _name: "None"});
      }
      const ret_annot_2697 = _t2690;
      Parser$expect(p, ({_tag: 74, _name: "EQ"}));
      const body_2699 = Parser$parse_expr(p);
      const full_body_2701 = Parser$wrap_params_expr(List$rev(Ref$get(params_2685)), ret_annot_2697, body_2699);
      let _t2703;
      if ((is_rec_2653 && _eq(Parser$peek_kind(p), ({_tag: 49, _name: "AND"})))) {
        const bindings_2704 = Ref$create(({_hd: [name_2670, type_params_2668, full_body_2701], _tl: null}));
        let _t2706 = undefined;
        let _t2707 = false, _t2708;
        while (true) {
          if (!(_eq(Parser$peek_kind(p), ({_tag: 49, _name: "AND"})))) break;
          Parser$advance(p);
          undefined;
          const and_name_2709 = Parser$expect_ident(p);
          const and_type_params_2711 = Parser$parse_type_params(p);
          const and_params_2713 = Ref$create(null);
          let _t2715 = undefined;
          let _t2716 = false, _t2717;
          while (true) {
            if (!((!_eq(Parser$peek_kind(p), ({_tag: 74, _name: "EQ"})) && !_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))))) break;
            Ref$set(and_params_2713, ({_hd: Parser$parse_param(p), _tl: Ref$get(and_params_2713)}));
            if (_t2716) break;
          }
          _t2715 = _t2716 ? _t2717 : undefined;
          _t2715;
          let _t2718;
          if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
            Parser$advance(p);
            undefined;
            const ty_2719 = Parser$parse_ty(p);
            let _t2721;
            if (_eq(Parser$peek_kind(p), ({_tag: 70, _name: "SLASH"}))) {
              Parser$advance(p);
              undefined;
              let _t2722;
              if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
                Parser$advance(p);
                undefined;
                _t2722 = ({_tag: 0, _name: "EffAnnotPure"});
              } else {
                _t2722 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
              }
              const eff_2723 = _t2722;
              const _t2724 = ({_tag: 1, _name: "Some", _val: ({_tag: 11, _name: "TyWithEffect", _val: [ty_2719, eff_2723]})});
              _t2721 = _t2724;
            } else {
              _t2721 = ({_tag: 1, _name: "Some", _val: ty_2719});
            }
            const _t2720 = _t2721;
            _t2718 = _t2720;
          } else {
            _t2718 = ({_tag: 0, _name: "None"});
          }
          const and_ret_annot_2725 = _t2718;
          Parser$expect(p, ({_tag: 74, _name: "EQ"}));
          const and_body_2727 = Parser$parse_expr(p);
          const and_full_body_2729 = Parser$wrap_params_expr(List$rev(Ref$get(and_params_2713)), and_ret_annot_2725, and_body_2727);
          const _t2730 = Ref$set(bindings_2704, ({_hd: [and_name_2709, and_type_params_2711, and_full_body_2729], _tl: Ref$get(bindings_2704)}));
          const _t2728 = _t2730;
          const _t2726 = _t2728;
          const _t2714 = _t2726;
          const _t2712 = _t2714;
          const _t2710 = _t2712;
          _t2710;
          if (_t2707) break;
        }
        _t2706 = _t2707 ? _t2708 : undefined;
        _t2706;
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const rest_2731 = Parser$parse_expr(p);
        const _t2732 = ({_tag: 38, _name: "ELetRecAnd", _val: [List$rev(Ref$get(bindings_2704)), rest_2731]});
        const _t2705 = _t2732;
        _t2703 = _t2705;
      } else {
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const rest_2733 = Parser$parse_expr(p);
        let _t2735;
        if (is_rec_2653) {
          _t2735 = ({_tag: 9, _name: "ELetRec", _val: [name_2670, type_params_2668, full_body_2701, rest_2733]});
        } else {
          _t2735 = ({_tag: 8, _name: "ELet", _val: [name_2670, full_body_2701, rest_2733]});
        }
        const _t2734 = _t2735;
        _t2703 = _t2734;
      }
      const _t2702 = _t2703;
      const _t2700 = _t2702;
      const _t2698 = _t2700;
      const _t2686 = _t2698;
      _t2672 = _t2686;
    }
    const _t2671 = _t2672;
    const _t2669 = _t2671;
    _t2660 = _t2669;
  }
  const _t2657 = _t2660;
  const _t2654 = _t2657;
  return _t2654;
}
function Parser$is_destruct_start(p) {
  let _t2737;
  const _t2736 = Parser$peek_kind(p);
  _t2738: {
    if ((((_t2736._tag === 51 || _t2736._tag === 53) || _t2736._tag === 55) || _t2736._tag === 9)) {
      _t2737 = true;
      break _t2738;
    }
    if (_t2736._tag === 8) {
      if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 72, _name: "COLONCOLON"}))) {
        _t2737 = true;
        break _t2738;
      }
    }
    if (true) {
      _t2737 = false;
      break _t2738;
    }
    _match_fail("line 16190");
  }
  return _t2737;
}
function Parser$wrap_params_expr(fun_params, ret_annot, body) {
  function _t2739(body, fp) {
    let _t2741;
    const _t2740 = fp;
    _t2742: {
      if (_t2740._tag === 0) {
        _t2741 = body;
        break _t2742;
      }
      if (_t2740._tag === 1) {
        const name = _t2740._val[0];
        const pat = _t2740._val[1];
        _t2741 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
        break _t2742;
      }
      _match_fail("line 16190");
    }
    return _t2741;
  }
  const body_2743 = List$fold(_t2739, body, fun_params);
  function _t2745(fp) {
    let _t2747;
    const _t2746 = fp;
    _t2748: {
      if (_t2746._tag === 0) {
        const param = _t2746._val;
        _t2747 = param;
        break _t2748;
      }
      if (_t2746._tag === 1) {
        const name = _t2746._val[0];
        const annot = _t2746._val[2];
        _t2747 = ({annot: annot, is_generated: true, name: name});
        break _t2748;
      }
      _match_fail("line 16190");
    }
    return _t2747;
  }
  const params_2749 = List$map(_t2745, fun_params);
  let _t2752;
  const _t2751 = ret_annot;
  _t2753: {
    if (_t2751._tag === 1 && _t2751._val._tag === 11) {
      const ret_ty = _t2751._val._val[0];
      const eff_annot = _t2751._val._val[1];
      if (!_eq(params_2749, null)) {
        const body_2754 = ({_tag: 30, _name: "EAnnot", _val: [body_2743, ret_ty]});
        function _t2756(param, body) {
          return ({_tag: 10, _name: "EFun", _val: [param, body]});
        }
        const full_fun_2757 = List$fold_right(_t2756, params_2749, body_2754);
        function build_arrow(__x) {
          let _t2760;
          const _t2759 = __x;
          _t2761: {
            if (_t2759 === null) {
              _t2760 = ret_ty;
              break _t2761;
            }
            if (_t2759 !== null && _t2759._tl === null) {
              const p = _t2759._hd;
              let _t2763;
              const _t2762 = p.annot;
              _t2764: {
                if (_t2762._tag === 1) {
                  const t = _t2762._val;
                  _t2763 = t;
                  break _t2764;
                }
                if (_t2762._tag === 0) {
                  _t2763 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t2764;
                }
                _match_fail("line 16190");
              }
              const pty_2765 = _t2763;
              const _t2766 = ({_tag: 2, _name: "TyArrow", _val: [pty_2765, ret_ty, ({_tag: 1, _name: "Some", _val: eff_annot})]});
              _t2760 = _t2766;
              break _t2761;
            }
            if (_t2759 !== null) {
              const p = _t2759._hd;
              const rest = _t2759._tl;
              let _t2768;
              const _t2767 = p.annot;
              _t2769: {
                if (_t2767._tag === 1) {
                  const t = _t2767._val;
                  _t2768 = t;
                  break _t2769;
                }
                if (_t2767._tag === 0) {
                  _t2768 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t2769;
                }
                _match_fail("line 16190");
              }
              const pty_2770 = _t2768;
              const _t2771 = ({_tag: 2, _name: "TyArrow", _val: [pty_2770, build_arrow(rest), ({_tag: 0, _name: "None"})]});
              _t2760 = _t2771;
              break _t2761;
            }
            _match_fail("line 16190");
          }
          return _t2760;
        }
        const _t2772 = ({_tag: 30, _name: "EAnnot", _val: [full_fun_2757, build_arrow(params_2749)]});
        const _t2758 = _t2772;
        const _t2755 = _t2758;
        _t2752 = _t2755;
        break _t2753;
      }
    }
    if (true) {
      let _t2774;
      const _t2773 = ret_annot;
      _t2775: {
        if (_t2773._tag === 1) {
          const ty = _t2773._val;
          _t2774 = ({_tag: 30, _name: "EAnnot", _val: [body_2743, ty]});
          break _t2775;
        }
        if (_t2773._tag === 0) {
          _t2774 = body_2743;
          break _t2775;
        }
        _match_fail("line 16190");
      }
      const body_2776 = _t2774;
      function _t2778(param, body) {
        return ({_tag: 10, _name: "EFun", _val: [param, body]});
      }
      const _t2777 = List$fold_right(_t2778, params_2749, body_2776);
      _t2752 = _t2777;
      break _t2753;
    }
    _match_fail("line 16190");
  }
  const _t2750 = _t2752;
  const _t2744 = _t2750;
  return _t2744;
}
function Parser$parse_match(p, partial) {
  Parser$expect(p, ({_tag: 17, _name: "MATCH"}));
  const scrut_2779 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t2781;
  if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
    Parser$advance(p);
    _t2781 = undefined;
  } else {
    _t2781 = undefined;
  }
  _t2781;
  const arms_2782 = Ref$create(null);
  const continue__2784 = Ref$create(true);
  let _t2786 = undefined;
  let _t2787 = false, _t2788;
  while (true) {
    if (!(Ref$get(continue__2784))) break;
    const pat_2789 = Parser$parse_pattern(p);
    let _t2791;
    if (_eq(Parser$peek_kind(p), ({_tag: 36, _name: "WHEN"}))) {
      Parser$advance(p);
      undefined;
      _t2791 = ({_tag: 1, _name: "Some", _val: Parser$parse_expr(p)});
    } else {
      _t2791 = ({_tag: 0, _name: "None"});
    }
    const guard_2792 = _t2791;
    Parser$expect(p, ({_tag: 57, _name: "ARROW"}));
    const body_2794 = Parser$parse_expr(p);
    Ref$set(arms_2782, ({_hd: [pat_2789, guard_2792, body_2794], _tl: Ref$get(arms_2782)}));
    let _t2796;
    if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
      Parser$advance(p);
      _t2796 = undefined;
    } else {
      _t2796 = Ref$set(continue__2784, false);
    }
    const _t2795 = _t2796;
    const _t2793 = _t2795;
    const _t2790 = _t2793;
    _t2790;
    if (_t2787) break;
  }
  _t2786 = _t2787 ? _t2788 : undefined;
  _t2786;
  const _t2785 = ({_tag: 25, _name: "EMatch", _val: [scrut_2779, List$rev(Ref$get(arms_2782)), partial]});
  const _t2783 = _t2785;
  const _t2780 = _t2783;
  return _t2780;
}
function Parser$parse_handle_expr(p) {
  Parser$expect(p, ({_tag: 26, _name: "HANDLE"}));
  const body_2797 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t2799;
  if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
    Parser$advance(p);
    _t2799 = undefined;
  } else {
    _t2799 = undefined;
  }
  _t2799;
  const arms_2800 = Ref$create(null);
  const continue_parsing_2802 = Ref$create(true);
  let _t2804 = undefined;
  let _t2805 = false, _t2806;
  while (true) {
    if (!(Ref$get(continue_parsing_2802))) break;
    let _t2808;
    const _t2807 = Parser$peek_kind(p);
    _t2809: {
      if (_t2807._tag === 31) {
        Parser$advance(p);
        undefined;
        const name_2810 = Parser$expect_ident(p);
        Parser$expect(p, ({_tag: 57, _name: "ARROW"}));
        const handler_body_2812 = Parser$parse_expr(p);
        Ref$set(arms_2800, ({_hd: ({_tag: 0, _name: "HReturn", _val: [name_2810, handler_body_2812]}), _tl: Ref$get(arms_2800)}));
        let _t2814;
        if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
          Parser$advance(p);
          _t2814 = undefined;
        } else {
          _t2814 = Ref$set(continue_parsing_2802, false);
        }
        const _t2813 = _t2814;
        const _t2811 = _t2813;
        _t2808 = _t2811;
        break _t2809;
      }
      if (_t2807._tag === 8) {
        const s = _t2807._val;
        Parser$advance(p);
        undefined;
        let _t2816;
        const _t2815 = Parser$peek_kind(p);
        _t2817: {
          if (_t2815._tag === 57) {
            _t2816 = ["_", "__k"];
            break _t2817;
          }
          if (_t2815._tag === 51) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 52, _name: "RPAREN"}))) {
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              let _t2818;
              if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "ARROW"}))) {
                _t2818 = ["_", "__k"];
              } else {
                _t2818 = ["_", Parser$expect_ident(p)];
              }
              _t2816 = _t2818;
              break _t2817;
            }
          }
          if (_t2815._tag === 8) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 57, _name: "ARROW"}))) {
              _t2816 = ["_", Parser$expect_ident(p)];
              break _t2817;
            }
          }
          if (true) {
            const arg_2819 = Parser$expect_ident(p);
            const k_2821 = Parser$expect_ident(p);
            const _t2822 = [arg_2819, k_2821];
            const _t2820 = _t2822;
            _t2816 = _t2820;
            break _t2817;
          }
          _match_fail("line 16190");
        }
        let _t2824;
        const _t2823 = _t2816;
        _t2825: {
          if (true) {
            const arg_name = _t2823[0];
            const k_name = _t2823[1];
            Parser$expect(p, ({_tag: 57, _name: "ARROW"}));
            const handler_body_2826 = Parser$parse_expr(p);
            Ref$set(arms_2800, ({_hd: ({_tag: 1, _name: "HOp", _val: [s, arg_name, k_name, handler_body_2826]}), _tl: Ref$get(arms_2800)}));
            let _t2828;
            if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
              Parser$advance(p);
              _t2828 = undefined;
            } else {
              _t2828 = Ref$set(continue_parsing_2802, false);
            }
            const _t2827 = _t2828;
            _t2824 = _t2827;
            break _t2825;
          }
          _match_fail("line 16190");
        }
        _t2808 = _t2824;
        break _t2809;
      }
      if (true) {
        _t2808 = Ref$set(continue_parsing_2802, false);
        break _t2809;
      }
      _match_fail("line 16190");
    }
    _t2808;
    if (_t2805) break;
  }
  _t2804 = _t2805 ? _t2806 : undefined;
  _t2804;
  const _t2803 = ({_tag: 40, _name: "EHandle", _val: [body_2797, List$rev(Ref$get(arms_2800))]});
  const _t2801 = _t2803;
  const _t2798 = _t2801;
  return _t2798;
}
function Parser$parse_try_expr(p) {
  Parser$expect(p, ({_tag: 27, _name: "TRY"}));
  const body_2829 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t2831;
  if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
    Parser$advance(p);
    _t2831 = undefined;
  } else {
    _t2831 = undefined;
  }
  _t2831;
  const arms_2832 = Ref$create(({_hd: ({_tag: 0, _name: "HReturn", _val: ["__x", ({_tag: 7, _name: "EVar", _val: "__x"})]}), _tl: null}));
  const continue_parsing_2834 = Ref$create(true);
  let _t2836 = undefined;
  let _t2837 = false, _t2838;
  while (true) {
    if (!(Ref$get(continue_parsing_2834))) break;
    let _t2840;
    const _t2839 = Parser$peek_kind(p);
    _t2841: {
      if (_t2839._tag === 8) {
        const s = _t2839._val;
        Parser$advance(p);
        undefined;
        let _t2843;
        const _t2842 = Parser$peek_kind(p);
        _t2844: {
          if (_t2842._tag === 57) {
            _t2843 = "_";
            break _t2844;
          }
          if (_t2842._tag === 51) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 52, _name: "RPAREN"}))) {
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2843 = "_";
              break _t2844;
            }
          }
          if (true) {
            _t2843 = Parser$expect_ident(p);
            break _t2844;
          }
          _match_fail("line 16190");
        }
        const arg_name_2845 = _t2843;
        Parser$expect(p, ({_tag: 57, _name: "ARROW"}));
        const handler_body_2847 = Parser$parse_expr(p);
        Ref$set(arms_2832, ({_hd: ({_tag: 1, _name: "HOp", _val: [s, arg_name_2845, "__k", handler_body_2847]}), _tl: Ref$get(arms_2832)}));
        let _t2849;
        if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
          Parser$advance(p);
          _t2849 = undefined;
        } else {
          _t2849 = Ref$set(continue_parsing_2834, false);
        }
        const _t2848 = _t2849;
        const _t2846 = _t2848;
        _t2840 = _t2846;
        break _t2841;
      }
      if (true) {
        _t2840 = Ref$set(continue_parsing_2834, false);
        break _t2841;
      }
      _match_fail("line 16190");
    }
    _t2840;
    if (_t2837) break;
  }
  _t2836 = _t2837 ? _t2838 : undefined;
  _t2836;
  const _t2835 = ({_tag: 40, _name: "EHandle", _val: [body_2829, List$rev(Ref$get(arms_2832))]});
  const _t2833 = _t2835;
  const _t2830 = _t2833;
  return _t2830;
}
function Parser$parse_provide_expr(p) {
  Parser$expect(p, ({_tag: 28, _name: "PROVIDE"}));
  const body_2850 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t2852;
  if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
    Parser$advance(p);
    _t2852 = undefined;
  } else {
    _t2852 = undefined;
  }
  _t2852;
  const arms_2853 = Ref$create(({_hd: ({_tag: 0, _name: "HReturn", _val: ["__x", ({_tag: 7, _name: "EVar", _val: "__x"})]}), _tl: null}));
  const continue_parsing_2855 = Ref$create(true);
  let _t2857 = undefined;
  let _t2858 = false, _t2859;
  while (true) {
    if (!(Ref$get(continue_parsing_2855))) break;
    let _t2861;
    const _t2860 = Parser$peek_kind(p);
    _t2862: {
      if (_t2860._tag === 8) {
        const s = _t2860._val;
        Parser$advance(p);
        undefined;
        let _t2864;
        const _t2863 = Parser$peek_kind(p);
        _t2865: {
          if (_t2863._tag === 57) {
            _t2864 = "_";
            break _t2865;
          }
          if (_t2863._tag === 51) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 52, _name: "RPAREN"}))) {
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2864 = "_";
              break _t2865;
            }
          }
          if (true) {
            _t2864 = Parser$expect_ident(p);
            break _t2865;
          }
          _match_fail("line 16190");
        }
        const arg_name_2866 = _t2864;
        Parser$expect(p, ({_tag: 57, _name: "ARROW"}));
        const handler_body_2868 = Parser$parse_expr(p);
        const resume_expr_2870 = ({_tag: 41, _name: "EResume", _val: [({_tag: 7, _name: "EVar", _val: "__k"}), handler_body_2868]});
        Ref$set(arms_2853, ({_hd: ({_tag: 1, _name: "HOp", _val: [s, arg_name_2866, "__k", resume_expr_2870]}), _tl: Ref$get(arms_2853)}));
        let _t2872;
        if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
          Parser$advance(p);
          _t2872 = undefined;
        } else {
          _t2872 = Ref$set(continue_parsing_2855, false);
        }
        const _t2871 = _t2872;
        const _t2869 = _t2871;
        const _t2867 = _t2869;
        _t2861 = _t2867;
        break _t2862;
      }
      if (true) {
        _t2861 = Ref$set(continue_parsing_2855, false);
        break _t2862;
      }
      _match_fail("line 16190");
    }
    _t2861;
    if (_t2858) break;
  }
  _t2857 = _t2858 ? _t2859 : undefined;
  _t2857;
  const _t2856 = ({_tag: 40, _name: "EHandle", _val: [body_2850, List$rev(Ref$get(arms_2853))]});
  const _t2854 = _t2856;
  const _t2851 = _t2854;
  return _t2851;
}
function Parser$lookahead_in_after_balanced(p) {
  const depth_2873 = Ref$create(1);
  const i_2875 = Ref$create(1);
  const hit_eof_2877 = Ref$create(false);
  let _t2879 = undefined;
  let _t2880 = false, _t2881;
  while (true) {
    if (!(((Ref$get(depth_2873) > 0) && (!Ref$get(hit_eof_2877))))) break;
    let _t2883;
    const _t2882 = Parser$peek_kind_at(p, Ref$get(i_2875));
    _t2884: {
      if (((_t2882._tag === 51 || _t2882._tag === 53) || _t2882._tag === 55)) {
        _t2883 = Ref$set(depth_2873, (Ref$get(depth_2873) + 1));
        break _t2884;
      }
      if (((_t2882._tag === 52 || _t2882._tag === 54) || _t2882._tag === 56)) {
        _t2883 = Ref$set(depth_2873, (Ref$get(depth_2873) - 1));
        break _t2884;
      }
      if (_t2882._tag === 90) {
        _t2883 = Ref$set(hit_eof_2877, true);
        break _t2884;
      }
      if (true) {
        _t2883 = undefined;
        break _t2884;
      }
      _match_fail("line 16190");
    }
    _t2883;
    Ref$set(i_2875, (Ref$get(i_2875) + 1));
    if (_t2880) break;
  }
  _t2879 = _t2880 ? _t2881 : undefined;
  _t2879;
  const _t2878 = ((!Ref$get(hit_eof_2877)) && ((Ref$get(depth_2873) === 0) && _eq(Parser$peek_kind_at(p, Ref$get(i_2875)), ({_tag: 13, _name: "IN"}))));
  const _t2876 = _t2878;
  const _t2874 = _t2876;
  return _t2874;
}
function Parser$pat_to_name_and_wrap(pat) {
  let _t2886;
  const _t2885 = pat;
  _t2887: {
    if (_t2885._tag === 1) {
      const name = _t2885._val;
      function _t2888(body) {
        return body;
      }
      _t2886 = [name, _t2888];
      break _t2887;
    }
    if (_t2885._tag === 0) {
      function _t2889(body) {
        return body;
      }
      _t2886 = ["_", _t2889];
      break _t2887;
    }
    if (true) {
      const pname_2890 = Parser$fresh_param_name(undefined);
      function _t2892(body) {
        return ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: pname_2890}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
      }
      const _t2891 = [pname_2890, _t2892];
      _t2886 = _t2891;
      break _t2887;
    }
    _match_fail("line 16190");
  }
  return _t2886;
}
function Parser$parse_for_in_rest(p, elem_name, elem_wrap, coll) {
  let _t2894;
  const _t2893 = Parser$peek_kind(p);
  _t2895: {
    if (_t2893._tag === 18) {
      Parser$advance(p);
      undefined;
      let _t2897;
      const _t2896 = Parser$peek_kind(p);
      _t2898: {
        if (((_t2896._tag === 51 || _t2896._tag === 53) || _t2896._tag === 55)) {
          _t2897 = Parser$parse_pattern_atom(p);
          break _t2898;
        }
        if (true) {
          const name_2899 = Parser$expect_ident(p);
          const _t2900 = ({_tag: 1, _name: "PatVar", _val: name_2899});
          _t2897 = _t2900;
          break _t2898;
        }
        _match_fail("line 16190");
      }
      const acc_pat_2901 = _t2897;
      let _t2904;
      const _t2903 = Parser$pat_to_name_and_wrap(acc_pat_2901);
      _t2905: {
        if (true) {
          const acc_name = _t2903[0];
          const acc_wrap = _t2903[1];
          Parser$expect(p, ({_tag: 74, _name: "EQ"}));
          const init_2906 = Parser$parse_expr_bp(p, 0);
          Parser$expect(p, ({_tag: 34, _name: "DO"}));
          const body_2908 = Parser$parse_expr(p);
          Parser$expect(p, ({_tag: 46, _name: "END"}));
          const _t2909 = ({_tag: 33, _name: "EForFold", _val: [elem_name, coll, acc_name, init_2906, elem_wrap(acc_wrap(body_2908))]});
          const _t2907 = _t2909;
          _t2904 = _t2907;
          break _t2905;
        }
        _match_fail("line 16190");
      }
      const _t2902 = _t2904;
      _t2894 = _t2902;
      break _t2895;
    }
    if (_t2893._tag === 34) {
      Parser$advance(p);
      undefined;
      const body_2910 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 46, _name: "END"}));
      const _t2911 = ({_tag: 32, _name: "EFor", _val: [elem_name, coll, elem_wrap(body_2910)]});
      _t2894 = _t2911;
      break _t2895;
    }
    if (true) {
      _t2894 = Parser$error(p, "expected 'do' or 'with' after for collection");
      break _t2895;
    }
    _match_fail("line 16190");
  }
  return _t2894;
}
function Parser$parse_for_expr(p) {
  Parser$expect(p, ({_tag: 33, _name: "FOR"}));
  let _t2913;
  const _t2912 = Parser$peek_kind(p);
  _t2914: {
    if (_t2912._tag === 34) {
      Parser$advance(p);
      undefined;
      const body_2915 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 46, _name: "END"}));
      const _t2916 = ({_tag: 31, _name: "EWhile", _val: [({_tag: 2, _name: "EBool", _val: true}), body_2915]});
      _t2913 = _t2916;
      break _t2914;
    }
    if (_t2912._tag === 11) {
      Parser$advance(p);
      undefined;
      const pat_2917 = Parser$parse_pattern(p);
      Parser$expect(p, ({_tag: 74, _name: "EQ"}));
      const scrutinee_2919 = Parser$parse_expr_bp(p, 0);
      Parser$expect(p, ({_tag: 34, _name: "DO"}));
      const body_2921 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 46, _name: "END"}));
      const _t2922 = ({_tag: 34, _name: "EWhileLet", _val: [pat_2917, scrutinee_2919, body_2921]});
      const _t2920 = _t2922;
      const _t2918 = _t2920;
      _t2913 = _t2918;
      break _t2914;
    }
    if ((_t2912._tag === 8 || _t2912._tag === 66)) {
      if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 13, _name: "IN"}))) {
        let _t2923;
        if (_eq(Parser$peek_kind(p), ({_tag: 66, _name: "UNDERSCORE"}))) {
          Parser$advance(p);
          undefined;
          _t2923 = "_";
        } else {
          _t2923 = Parser$expect_ident(p);
        }
        const var_name_2924 = _t2923;
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const coll_2926 = Parser$parse_expr_bp(p, 0);
        function _t2928(body) {
          return body;
        }
        const _t2927 = Parser$parse_for_in_rest(p, var_name_2924, _t2928, coll_2926);
        const _t2925 = _t2927;
        _t2913 = _t2925;
        break _t2914;
      }
    }
    if (((_t2912._tag === 51 || _t2912._tag === 53) || _t2912._tag === 55)) {
      if (Parser$lookahead_in_after_balanced(p)) {
        const pat_2929 = Parser$parse_pattern_atom(p);
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const coll_2931 = Parser$parse_expr_bp(p, 0);
        let _t2934;
        const _t2933 = Parser$pat_to_name_and_wrap(pat_2929);
        _t2935: {
          if (true) {
            const elem_name = _t2933[0];
            const elem_wrap = _t2933[1];
            _t2934 = Parser$parse_for_in_rest(p, elem_name, elem_wrap, coll_2931);
            break _t2935;
          }
          _match_fail("line 16190");
        }
        const _t2932 = _t2934;
        const _t2930 = _t2932;
        _t2913 = _t2930;
        break _t2914;
      }
    }
    if (true) {
      const cond_2936 = Parser$parse_expr_bp(p, 0);
      Parser$expect(p, ({_tag: 34, _name: "DO"}));
      const body_2938 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 46, _name: "END"}));
      const _t2939 = ({_tag: 31, _name: "EWhile", _val: [cond_2936, body_2938]});
      const _t2937 = _t2939;
      _t2913 = _t2937;
      break _t2914;
    }
    _match_fail("line 16190");
  }
  return _t2913;
}
function Parser$parse_record_fields(p) {
  const fields_2940 = Ref$create(null);
  const first_2942 = Ref$create(true);
  let _t2944 = undefined;
  let _t2945 = false, _t2946;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"})))) break;
    let _t2947;
    if ((!Ref$get(first_2942))) {
      _t2947 = Parser$expect(p, ({_tag: 59, _name: "SEMICOLON"}));
    } else {
      _t2947 = undefined;
    }
    _t2947;
    let _t2948;
    if (_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
      _t2948 = undefined;
    } else {
      Ref$set(first_2942, false);
      const name_2949 = Parser$expect_ident(p);
      let _t2951;
      if (_eq(Parser$peek_kind(p), ({_tag: 74, _name: "EQ"}))) {
        Parser$advance(p);
        undefined;
        _t2951 = Parser$parse_expr_bp(p, 0);
      } else {
        _t2951 = ({_tag: 7, _name: "EVar", _val: name_2949});
      }
      const expr_2952 = _t2951;
      const _t2953 = Ref$set(fields_2940, ({_hd: [name_2949, expr_2952], _tl: Ref$get(fields_2940)}));
      const _t2950 = _t2953;
      _t2948 = _t2950;
    }
    _t2948;
    if (_t2945) break;
  }
  _t2944 = _t2945 ? _t2946 : undefined;
  _t2944;
  const _t2943 = List$rev(Ref$get(fields_2940));
  const _t2941 = _t2943;
  return _t2941;
}
function Parser$parse_map_pairs(p) {
  let _t2954;
  if (_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
    _t2954 = null;
  } else {
    const pairs_2955 = Ref$create(null);
    const first_2957 = Ref$create(true);
    let _t2959 = undefined;
    let _t2960 = false, _t2961;
    while (true) {
      if (!(!_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"})))) break;
      let _t2962;
      if ((!Ref$get(first_2957))) {
        _t2962 = Parser$expect(p, ({_tag: 59, _name: "SEMICOLON"}));
      } else {
        _t2962 = undefined;
      }
      _t2962;
      Ref$set(first_2957, false);
      const key_2963 = Parser$parse_expr_bp(p, 0);
      Parser$expect(p, ({_tag: 61, _name: "COLON"}));
      const value_2965 = Parser$parse_expr_bp(p, 0);
      const _t2966 = Ref$set(pairs_2955, ({_hd: [key_2963, value_2965], _tl: Ref$get(pairs_2955)}));
      const _t2964 = _t2966;
      _t2964;
      if (_t2960) break;
    }
    _t2959 = _t2960 ? _t2961 : undefined;
    _t2959;
    const _t2958 = List$rev(Ref$get(pairs_2955));
    const _t2956 = _t2958;
    _t2954 = _t2956;
  }
  return _t2954;
}
function Parser$parse_set_or_map(p) {
  let _t2967;
  if (_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
    _t2967 = ({_tag: 887353506, _name: "`Map", _val: null});
  } else {
    const first_expr_2968 = Parser$parse_expr_bp(p, 0);
    let _t2970;
    if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
      Parser$advance(p);
      undefined;
      const first_val_2971 = Parser$parse_expr_bp(p, 0);
      const pairs_2973 = Ref$create(({_hd: [first_expr_2968, first_val_2971], _tl: null}));
      let _t2975 = undefined;
      let _t2976 = false, _t2977;
      while (true) {
        if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "SEMICOLON"})))) break;
        Parser$advance(p);
        undefined;
        let _t2978;
        if (!_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
          const key_2979 = Parser$parse_expr_bp(p, 0);
          Parser$expect(p, ({_tag: 61, _name: "COLON"}));
          const value_2981 = Parser$parse_expr_bp(p, 0);
          const _t2982 = Ref$set(pairs_2973, ({_hd: [key_2979, value_2981], _tl: Ref$get(pairs_2973)}));
          const _t2980 = _t2982;
          _t2978 = _t2980;
        } else {
          _t2978 = undefined;
        }
        _t2978;
        if (_t2976) break;
      }
      _t2975 = _t2976 ? _t2977 : undefined;
      _t2975;
      const _t2974 = ({_tag: 887353506, _name: "`Map", _val: List$rev(Ref$get(pairs_2973))});
      const _t2972 = _t2974;
      _t2970 = _t2972;
    } else {
      let _t2983;
      if (_eq(Parser$peek_kind(p), ({_tag: 18, _name: "WITH"}))) {
        Parser$advance(p);
        undefined;
        const pairs_2984 = Ref$create(null);
        const continue__2986 = Ref$create(true);
        let _t2988 = undefined;
        let _t2989 = false, _t2990;
        while (true) {
          if (!(Ref$get(continue__2986))) break;
          const key_2991 = Parser$parse_expr_bp(p, 0);
          Parser$expect(p, ({_tag: 61, _name: "COLON"}));
          const value_2993 = Parser$parse_expr_bp(p, 0);
          Ref$set(pairs_2984, ({_hd: [key_2991, value_2993], _tl: Ref$get(pairs_2984)}));
          let _t2995;
          if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "SEMICOLON"}))) {
            Parser$advance(p);
            undefined;
            let _t2996;
            if (_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
              _t2996 = Ref$set(continue__2986, false);
            } else {
              _t2996 = undefined;
            }
            _t2995 = _t2996;
          } else {
            _t2995 = Ref$set(continue__2986, false);
          }
          const _t2994 = _t2995;
          const _t2992 = _t2994;
          _t2992;
          if (_t2989) break;
        }
        _t2988 = _t2989 ? _t2990 : undefined;
        _t2988;
        function _t2997(acc, __p31) {
          let _t2999;
          const _t2998 = __p31;
          _t3000: {
            if (true) {
              const k = _t2998[0];
              const v = _t2998[1];
              _t2999 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "set"}), k]}), v]}), acc]});
              break _t3000;
            }
            _match_fail("line 16190");
          }
          return _t2999;
        }
        const result_3001 = List$fold(_t2997, first_expr_2968, List$rev(Ref$get(pairs_2984)));
        const _t3002 = ({_tag: 533146490, _name: "`Update", _val: result_3001});
        const _t2987 = _t3002;
        const _t2985 = _t2987;
        _t2983 = _t2985;
      } else {
        const elems_3003 = Ref$create(({_hd: first_expr_2968, _tl: null}));
        let _t3005 = undefined;
        let _t3006 = false, _t3007;
        while (true) {
          if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "SEMICOLON"})))) break;
          Parser$advance(p);
          undefined;
          let _t3008;
          if (!_eq(Parser$peek_kind(p), ({_tag: 54, _name: "RBRACE"}))) {
            _t3008 = Ref$set(elems_3003, ({_hd: Parser$parse_expr_bp(p, 0), _tl: Ref$get(elems_3003)}));
          } else {
            _t3008 = undefined;
          }
          _t3008;
          if (_t3006) break;
        }
        _t3005 = _t3006 ? _t3007 : undefined;
        _t3005;
        const _t3004 = ({_tag: 98602162, _name: "`Set", _val: List$rev(Ref$get(elems_3003))});
        _t2983 = _t3004;
      }
      _t2970 = _t2983;
    }
    const _t2969 = _t2970;
    _t2967 = _t2969;
  }
  return _t2967;
}
function Parser$parse_list_elems(p) {
  const first_3009 = Parser$parse_expr_bp(p, 0);
  const elems_3011 = Ref$create(({_hd: first_3009, _tl: null}));
  let _t3013 = undefined;
  let _t3014 = false, _t3015;
  while (true) {
    if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "SEMICOLON"})))) break;
    Parser$advance(p);
    undefined;
    let _t3016;
    if (!_eq(Parser$peek_kind(p), ({_tag: 56, _name: "RBRACKET"}))) {
      _t3016 = Ref$set(elems_3011, ({_hd: Parser$parse_expr_bp(p, 0), _tl: Ref$get(elems_3011)}));
    } else {
      _t3016 = undefined;
    }
    _t3016;
    if (_t3014) break;
  }
  _t3013 = _t3014 ? _t3015 : undefined;
  _t3013;
  const _t3012 = List$rev(Ref$get(elems_3011));
  const _t3010 = _t3012;
  return _t3010;
}
function Parser$is_tyvar_token(__x) {
  let _t3018;
  const _t3017 = __x;
  _t3019: {
    if (_t3017._tag === 10) {
      _t3018 = true;
      break _t3019;
    }
    if (true) {
      _t3018 = false;
      break _t3019;
    }
    _match_fail("line 16190");
  }
  return _t3018;
}
function Parser$decompose_gadt_sig(ty) {
  function collect_args(__x) {
    let _t3021;
    const _t3020 = __x;
    _t3022: {
      if (_t3020._tag === 2) {
        const arg = _t3020._val[0];
        const rest = _t3020._val[1];
        let _t3024;
        const _t3023 = collect_args(rest);
        _t3025: {
          if (true) {
            const more_args = _t3023[0];
            const ret = _t3023[1];
            _t3024 = [({_hd: arg, _tl: more_args}), ret];
            break _t3025;
          }
          _match_fail("line 16190");
        }
        _t3021 = _t3024;
        break _t3022;
      }
      if (true) {
        const other = _t3020;
        _t3021 = [null, other];
        break _t3022;
      }
      _match_fail("line 16190");
    }
    return _t3021;
  }
  let _t3028;
  const _t3027 = collect_args(ty);
  _t3029: {
    if (_t3027[0] === null) {
      const ret = _t3027[1];
      _t3028 = [({_tag: 0, _name: "None"}), ret];
      break _t3029;
    }
    if (_t3027[0] !== null && _t3027[0]._tl === null) {
      const arg = _t3027[0]._hd;
      const ret = _t3027[1];
      _t3028 = [({_tag: 1, _name: "Some", _val: arg}), ret];
      break _t3029;
    }
    if (true) {
      const args = _t3027[0];
      const ret = _t3027[1];
      _t3028 = [({_tag: 1, _name: "Some", _val: ({_tag: 6, _name: "TyTuple", _val: args})}), ret];
      break _t3029;
    }
    _match_fail("line 16190");
  }
  const _t3026 = _t3028;
  return _t3026;
}
function Parser$parse_type_decl(p) {
  Parser$expect(p, ({_tag: 19, _name: "TYPE"}));
  let _t3031;
  const _t3030 = Parser$peek_kind(p);
  _t3032: {
    if (_t3030._tag === 10) {
      const s = _t3030._val;
      Parser$advance(p);
      undefined;
      _t3031 = ({_hd: s, _tl: null});
      break _t3032;
    }
    if (_t3030._tag === 51) {
      if (Parser$is_tyvar_token(Parser$peek_kind_at(p, 1))) {
        Parser$advance(p);
        undefined;
        const params_3033 = Ref$create(null);
        const first_3035 = Ref$create(true);
        let _t3037 = undefined;
        let _t3038 = false, _t3039;
        while (true) {
          if (!(!_eq(Parser$peek_kind(p), ({_tag: 52, _name: "RPAREN"})))) break;
          let _t3040;
          if ((!Ref$get(first_3035))) {
            _t3040 = Parser$expect(p, ({_tag: 58, _name: "COMMA"}));
          } else {
            _t3040 = undefined;
          }
          _t3040;
          Ref$set(first_3035, false);
          let _t3042;
          const _t3041 = Parser$peek_kind(p);
          _t3043: {
            if (_t3041._tag === 10) {
              const s = _t3041._val;
              Parser$advance(p);
              undefined;
              _t3042 = Ref$set(params_3033, ({_hd: s, _tl: Ref$get(params_3033)}));
              break _t3043;
            }
            if (true) {
              _t3042 = Parser$error(p, "expected type variable in type parameter list");
              break _t3043;
            }
            _match_fail("line 16190");
          }
          _t3042;
          if (_t3038) break;
        }
        _t3037 = _t3038 ? _t3039 : undefined;
        _t3037;
        Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
        const _t3036 = List$rev(Ref$get(params_3033));
        const _t3034 = _t3036;
        _t3031 = _t3034;
        break _t3032;
      }
    }
    if (true) {
      _t3031 = null;
      break _t3032;
    }
    _match_fail("line 16190");
  }
  const type_params_3044 = _t3031;
  const name_3046 = Parser$expect_ident(p);
  Parser$expect(p, ({_tag: 74, _name: "EQ"}));
  let _t3049;
  const _t3048 = Parser$peek_kind(p);
  _t3050: {
    if (_t3048._tag === 53) {
      Parser$advance(p);
      undefined;
      let _t3052;
      const _t3051 = Parser$parse_ty_record_fields(p);
      _t3053: {
        if (true) {
          const fields = _t3051[0];
          const _is_open = _t3051[1];
          Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
          _t3052 = ({_tag: 1, _name: "TDRecord", _val: fields});
          break _t3053;
        }
        _match_fail("line 16190");
      }
      _t3049 = _t3052;
      break _t3050;
    }
    if ((_t3048._tag === 64 || _t3048._tag === 9)) {
      let _t3054;
      if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
        Parser$advance(p);
        _t3054 = undefined;
      } else {
        _t3054 = undefined;
      }
      _t3054;
      const ctors_3055 = Ref$create(null);
      const continue__3057 = Ref$create(true);
      let _t3059 = undefined;
      let _t3060 = false, _t3061;
      while (true) {
        if (!(Ref$get(continue__3057))) break;
        const ctor_name_3062 = Parser$expect_uident(p);
        let _t3064;
        if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
          Parser$advance(p);
          undefined;
          const full_sig_3065 = Parser$parse_ty(p);
          let _t3068;
          const _t3067 = Parser$decompose_gadt_sig(full_sig_3065);
          _t3069: {
            if (true) {
              const arg_ty = _t3067[0];
              const ret_ty = _t3067[1];
              _t3068 = Ref$set(ctors_3055, ({_hd: [ctor_name_3062, arg_ty, ({_tag: 1, _name: "Some", _val: ret_ty})], _tl: Ref$get(ctors_3055)}));
              break _t3069;
            }
            _match_fail("line 16190");
          }
          const _t3066 = _t3068;
          _t3064 = _t3066;
        } else {
          let _t3070;
          if (_eq(Parser$peek_kind(p), ({_tag: 20, _name: "OF"}))) {
            Parser$advance(p);
            undefined;
            _t3070 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
          } else {
            _t3070 = ({_tag: 0, _name: "None"});
          }
          const arg_3071 = _t3070;
          const _t3072 = Ref$set(ctors_3055, ({_hd: [ctor_name_3062, arg_3071, ({_tag: 0, _name: "None"})], _tl: Ref$get(ctors_3055)}));
          _t3064 = _t3072;
        }
        _t3064;
        let _t3073;
        if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
          Parser$advance(p);
          _t3073 = undefined;
        } else {
          _t3073 = Ref$set(continue__3057, false);
        }
        const _t3063 = _t3073;
        _t3063;
        if (_t3060) break;
      }
      _t3059 = _t3060 ? _t3061 : undefined;
      _t3059;
      const _t3058 = ({_tag: 0, _name: "TDVariant", _val: List$rev(Ref$get(ctors_3055))});
      const _t3056 = _t3058;
      _t3049 = _t3056;
      break _t3050;
    }
    if (true) {
      const rhs_3074 = Parser$parse_ty(p);
      const _t3075 = ({_tag: 2, _name: "TDAlias", _val: rhs_3074});
      _t3049 = _t3075;
      break _t3050;
    }
    _match_fail("line 16190");
  }
  const def_3076 = _t3049;
  let _t3078;
  if (_eq(Parser$peek_kind(p), ({_tag: 50, _name: "DERIVING"}))) {
    Parser$advance(p);
    undefined;
    const classes_3079 = Ref$create(null);
    const continue__3081 = Ref$create(true);
    let _t3083 = undefined;
    let _t3084 = false, _t3085;
    while (true) {
      let _t3089;
      if (Ref$get(continue__3081)) {
      let _t3087;
      const _t3086 = Parser$peek_kind(p);
      _t3088: {
        if (_t3086._tag === 9) {
          _t3087 = true;
          break _t3088;
        }
        if (true) {
          _t3087 = false;
          break _t3088;
        }
        _match_fail("line 16190");
      }
        _t3089 = _t3087;
      } else {
        _t3089 = false;
      }
      if (!(_t3089)) break;
      const cls_3090 = Parser$expect_uident(p);
      Ref$set(classes_3079, ({_hd: cls_3090, _tl: Ref$get(classes_3079)}));
      let _t3092;
      if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"}))) {
        Parser$advance(p);
        _t3092 = undefined;
      } else {
        _t3092 = Ref$set(continue__3081, false);
      }
      const _t3091 = _t3092;
      _t3091;
      if (_t3084) break;
    }
    _t3083 = _t3084 ? _t3085 : undefined;
    _t3083;
    const _t3082 = List$rev(Ref$get(classes_3079));
    const _t3080 = _t3082;
    _t3078 = _t3080;
  } else {
    _t3078 = null;
  }
  const deriving__3093 = _t3078;
  let _t3095;
  if (!_eq(Parser$peek_kind(p), ({_tag: 49, _name: "AND"}))) {
    _t3095 = ({_tag: 4, _name: "DType", _val: [type_params_3044, name_3046, def_3076, deriving__3093]});
  } else {
    const defs_3096 = Ref$create(({_hd: [type_params_3044, name_3046, def_3076, deriving__3093], _tl: null}));
    let _t3098 = undefined;
    let _t3099 = false, _t3100;
    while (true) {
      if (!(_eq(Parser$peek_kind(p), ({_tag: 49, _name: "AND"})))) break;
      Parser$advance(p);
      undefined;
      let _t3102;
      const _t3101 = Parser$peek_kind(p);
      _t3103: {
        if (_t3101._tag === 10) {
          const s = _t3101._val;
          Parser$advance(p);
          undefined;
          _t3102 = ({_hd: s, _tl: null});
          break _t3103;
        }
        if (_t3101._tag === 51) {
          if (Parser$is_tyvar_token(Parser$peek_kind_at(p, 1))) {
            Parser$advance(p);
            undefined;
            const params_3104 = Ref$create(null);
            const first_3106 = Ref$create(true);
            let _t3108 = undefined;
            let _t3109 = false, _t3110;
            while (true) {
              if (!(!_eq(Parser$peek_kind(p), ({_tag: 52, _name: "RPAREN"})))) break;
              let _t3111;
              if ((!Ref$get(first_3106))) {
                _t3111 = Parser$expect(p, ({_tag: 58, _name: "COMMA"}));
              } else {
                _t3111 = undefined;
              }
              _t3111;
              Ref$set(first_3106, false);
              let _t3113;
              const _t3112 = Parser$peek_kind(p);
              _t3114: {
                if (_t3112._tag === 10) {
                  const s = _t3112._val;
                  Parser$advance(p);
                  undefined;
                  _t3113 = Ref$set(params_3104, ({_hd: s, _tl: Ref$get(params_3104)}));
                  break _t3114;
                }
                if (true) {
                  _t3113 = Parser$error(p, "expected type variable in type parameter list");
                  break _t3114;
                }
                _match_fail("line 16190");
              }
              _t3113;
              if (_t3109) break;
            }
            _t3108 = _t3109 ? _t3110 : undefined;
            _t3108;
            Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
            const _t3107 = List$rev(Ref$get(params_3104));
            const _t3105 = _t3107;
            _t3102 = _t3105;
            break _t3103;
          }
        }
        if (true) {
          _t3102 = null;
          break _t3103;
        }
        _match_fail("line 16190");
      }
      const and_type_params_3115 = _t3102;
      const and_name_3117 = Parser$expect_ident(p);
      Parser$expect(p, ({_tag: 74, _name: "EQ"}));
      let _t3120;
      const _t3119 = Parser$peek_kind(p);
      _t3121: {
        if (_t3119._tag === 53) {
          Parser$advance(p);
          undefined;
          let _t3123;
          const _t3122 = Parser$parse_ty_record_fields(p);
          _t3124: {
            if (true) {
              const fields = _t3122[0];
              const _is_open = _t3122[1];
              Parser$expect(p, ({_tag: 54, _name: "RBRACE"}));
              _t3123 = ({_tag: 1, _name: "TDRecord", _val: fields});
              break _t3124;
            }
            _match_fail("line 16190");
          }
          _t3120 = _t3123;
          break _t3121;
        }
        if ((_t3119._tag === 64 || _t3119._tag === 9)) {
          let _t3125;
          if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
            Parser$advance(p);
            _t3125 = undefined;
          } else {
            _t3125 = undefined;
          }
          _t3125;
          const ctors_3126 = Ref$create(null);
          const cont_3128 = Ref$create(true);
          let _t3130 = undefined;
          let _t3131 = false, _t3132;
          while (true) {
            if (!(Ref$get(cont_3128))) break;
            const ctor_name_3133 = Parser$expect_uident(p);
            let _t3135;
            if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
              Parser$advance(p);
              undefined;
              const full_sig_3136 = Parser$parse_ty(p);
              let _t3139;
              const _t3138 = Parser$decompose_gadt_sig(full_sig_3136);
              _t3140: {
                if (true) {
                  const arg_ty = _t3138[0];
                  const ret_ty = _t3138[1];
                  _t3139 = Ref$set(ctors_3126, ({_hd: [ctor_name_3133, arg_ty, ({_tag: 1, _name: "Some", _val: ret_ty})], _tl: Ref$get(ctors_3126)}));
                  break _t3140;
                }
                _match_fail("line 16190");
              }
              const _t3137 = _t3139;
              _t3135 = _t3137;
            } else {
              let _t3141;
              if (_eq(Parser$peek_kind(p), ({_tag: 20, _name: "OF"}))) {
                Parser$advance(p);
                undefined;
                _t3141 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
              } else {
                _t3141 = ({_tag: 0, _name: "None"});
              }
              const arg_3142 = _t3141;
              const _t3143 = Ref$set(ctors_3126, ({_hd: [ctor_name_3133, arg_3142, ({_tag: 0, _name: "None"})], _tl: Ref$get(ctors_3126)}));
              _t3135 = _t3143;
            }
            _t3135;
            let _t3144;
            if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "PIPE"}))) {
              Parser$advance(p);
              _t3144 = undefined;
            } else {
              _t3144 = Ref$set(cont_3128, false);
            }
            const _t3134 = _t3144;
            _t3134;
            if (_t3131) break;
          }
          _t3130 = _t3131 ? _t3132 : undefined;
          _t3130;
          const _t3129 = ({_tag: 0, _name: "TDVariant", _val: List$rev(Ref$get(ctors_3126))});
          const _t3127 = _t3129;
          _t3120 = _t3127;
          break _t3121;
        }
        if (true) {
          const rhs_3145 = Parser$parse_ty(p);
          const _t3146 = ({_tag: 2, _name: "TDAlias", _val: rhs_3145});
          _t3120 = _t3146;
          break _t3121;
        }
        _match_fail("line 16190");
      }
      const and_def_3147 = _t3120;
      let _t3149;
      if (_eq(Parser$peek_kind(p), ({_tag: 50, _name: "DERIVING"}))) {
        Parser$advance(p);
        undefined;
        const classes_3150 = Ref$create(null);
        const cont_3152 = Ref$create(true);
        let _t3154 = undefined;
        let _t3155 = false, _t3156;
        while (true) {
          let _t3160;
          if (Ref$get(cont_3152)) {
          let _t3158;
          const _t3157 = Parser$peek_kind(p);
          _t3159: {
            if (_t3157._tag === 9) {
              _t3158 = true;
              break _t3159;
            }
            if (true) {
              _t3158 = false;
              break _t3159;
            }
            _match_fail("line 16190");
          }
            _t3160 = _t3158;
          } else {
            _t3160 = false;
          }
          if (!(_t3160)) break;
          const cls_3161 = Parser$expect_uident(p);
          Ref$set(classes_3150, ({_hd: cls_3161, _tl: Ref$get(classes_3150)}));
          let _t3163;
          if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"}))) {
            Parser$advance(p);
            _t3163 = undefined;
          } else {
            _t3163 = Ref$set(cont_3152, false);
          }
          const _t3162 = _t3163;
          _t3162;
          if (_t3155) break;
        }
        _t3154 = _t3155 ? _t3156 : undefined;
        _t3154;
        const _t3153 = List$rev(Ref$get(classes_3150));
        const _t3151 = _t3153;
        _t3149 = _t3151;
      } else {
        _t3149 = null;
      }
      const and_deriving_3164 = _t3149;
      const _t3165 = Ref$set(defs_3096, ({_hd: [and_type_params_3115, and_name_3117, and_def_3147, and_deriving_3164], _tl: Ref$get(defs_3096)}));
      const _t3148 = _t3165;
      const _t3118 = _t3148;
      const _t3116 = _t3118;
      _t3116;
      if (_t3099) break;
    }
    _t3098 = _t3099 ? _t3100 : undefined;
    _t3098;
    const _t3097 = ({_tag: 5, _name: "DTypeAnd", _val: List$rev(Ref$get(defs_3096))});
    _t3095 = _t3097;
  }
  const _t3094 = _t3095;
  const _t3077 = _t3094;
  const _t3047 = _t3077;
  const _t3045 = _t3047;
  return _t3045;
}
function Parser$extract_pat_vars(__x) {
  while (true) {
    let _t3167;
    const _t3166 = __x;
    _t3168: {
      if (_t3166._tag === 1) {
        const name = _t3166._val;
        _t3167 = ({_hd: name, _tl: null});
        break _t3168;
      }
      if (((((((_t3166._tag === 0 || _t3166._tag === 2) || _t3166._tag === 3) || _t3166._tag === 4) || _t3166._tag === 5) || _t3166._tag === 6) || _t3166._tag === 9)) {
        _t3167 = null;
        break _t3168;
      }
      if (_t3166._tag === 7) {
        const pats = _t3166._val;
        _t3167 = List$concat_map(Parser$extract_pat_vars, pats);
        break _t3168;
      }
      if (_t3166._tag === 8) {
        const hd = _t3166._val[0];
        const tl = _t3166._val[1];
        _t3167 = List$concat(Parser$extract_pat_vars(hd), Parser$extract_pat_vars(tl));
        break _t3168;
      }
      if (_t3166._tag === 10 && _t3166._val[1]._tag === 0) {
        _t3167 = null;
        break _t3168;
      }
      if (_t3166._tag === 10 && _t3166._val[1]._tag === 1) {
        const p = _t3166._val[1]._val;
        const _t3169 = p;
        __x = _t3169;
        continue;
        _t3167 = undefined;
        break _t3168;
      }
      if (_t3166._tag === 11) {
        const fields = _t3166._val;
        function _t3170(__p32) {
          let _t3172;
          const _t3171 = __p32;
          _t3173: {
            if (true) {
              const p = _t3171[1];
              _t3172 = Parser$extract_pat_vars(p);
              break _t3173;
            }
            _match_fail("line 16190");
          }
          return _t3172;
        }
        _t3167 = List$concat_map(_t3170, fields);
        break _t3168;
      }
      if (_t3166._tag === 12) {
        const inner = _t3166._val[0];
        const name = _t3166._val[1];
        _t3167 = ({_hd: name, _tl: Parser$extract_pat_vars(inner)});
        break _t3168;
      }
      if (_t3166._tag === 13) {
        const p1 = _t3166._val[0];
        const _t3174 = p1;
        __x = _t3174;
        continue;
        _t3167 = undefined;
        break _t3168;
      }
      if (_t3166._tag === 14) {
        const pats = _t3166._val;
        _t3167 = List$concat_map(Parser$extract_pat_vars, pats);
        break _t3168;
      }
      if (_t3166._tag === 15) {
        const entries = _t3166._val;
        function _t3175(__p33) {
          let _t3177;
          const _t3176 = __p33;
          _t3178: {
            if (true) {
              const k = _t3176[0];
              const v = _t3176[1];
              _t3177 = List$concat(Parser$extract_pat_vars(k), Parser$extract_pat_vars(v));
              break _t3178;
            }
            _match_fail("line 16190");
          }
          return _t3177;
        }
        _t3167 = List$concat_map(_t3175, entries);
        break _t3168;
      }
      if (_t3166._tag === 16 && _t3166._val[1]._tag === 0) {
        _t3167 = null;
        break _t3168;
      }
      if (_t3166._tag === 16 && _t3166._val[1]._tag === 1) {
        const p = _t3166._val[1]._val;
        const _t3179 = p;
        __x = _t3179;
        continue;
        _t3167 = undefined;
        break _t3168;
      }
      if (_t3166._tag === 17) {
        _t3167 = null;
        break _t3168;
      }
      if (_t3166._tag === 18) {
        const p = _t3166._val[0];
        const _t3180 = p;
        __x = _t3180;
        continue;
        _t3167 = undefined;
        break _t3168;
      }
      _match_fail("line 16190");
    }
    return _t3167;
  }
}
function Parser$parse_constraints(p) {
  let _t3181;
  if (!_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHERE"}))) {
    _t3181 = null;
  } else {
    Parser$advance(p);
    undefined;
    const constraints_3182 = Ref$create(null);
    const continue__3184 = Ref$create(true);
    let _t3186 = undefined;
    let _t3187 = false, _t3188;
    while (true) {
      if (!(Ref$get(continue__3184))) break;
      let _t3190;
      const _t3189 = Parser$peek_kind(p);
      _t3191: {
        if (_t3189._tag === 9) {
          const class_name_start = _t3189._val;
          Parser$advance(p);
          undefined;
          let _t3192;
          if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "DOT"}))) {
            Parser$advance(p);
            undefined;
            let _t3194;
            const _t3193 = Parser$peek_kind(p);
            _t3195: {
              if (_t3193._tag === 9) {
                const s2 = _t3193._val;
                Parser$advance(p);
                undefined;
                _t3194 = (class_name_start + ("." + s2));
                break _t3195;
              }
              if (true) {
                _t3194 = Parser$error(p, "expected class name after dot");
                break _t3195;
              }
              _match_fail("line 16190");
            }
            _t3192 = _t3194;
          } else {
            _t3192 = class_name_start;
          }
          const class_name_3196 = _t3192;
          const tyvars_3198 = Ref$create(null);
          let _t3200 = undefined;
          let _t3201 = false, _t3202;
          while (true) {
            let _t3204;
            const _t3203 = Parser$peek_kind(p);
            _t3205: {
              if (_t3203._tag === 10) {
                _t3204 = true;
                break _t3205;
              }
              if (true) {
                _t3204 = false;
                break _t3205;
              }
              _match_fail("line 16190");
            }
            if (!(_t3204)) break;
            let _t3207;
            const _t3206 = Parser$advance(p).kind;
            _t3208: {
              if (_t3206._tag === 10) {
                const s = _t3206._val;
                _t3207 = Ref$set(tyvars_3198, ({_hd: s, _tl: Ref$get(tyvars_3198)}));
                break _t3208;
              }
              if (true) {
                _t3207 = undefined;
                break _t3208;
              }
              _match_fail("line 16190");
            }
            _t3207;
            if (_t3201) break;
          }
          _t3200 = _t3201 ? _t3202 : undefined;
          _t3200;
          let _t3209;
          if (_eq(Ref$get(tyvars_3198), null)) {
            _t3209 = Parser$error(p, "constraint requires at least one type variable");
          } else {
            _t3209 = undefined;
          }
          _t3209;
          Ref$set(constraints_3182, ({_hd: [class_name_3196, List$rev(Ref$get(tyvars_3198))], _tl: Ref$get(constraints_3182)}));
          let _t3210;
          if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"}))) {
            Parser$advance(p);
            _t3210 = undefined;
          } else {
            _t3210 = Ref$set(continue__3184, false);
          }
          const _t3199 = _t3210;
          const _t3197 = _t3199;
          _t3190 = _t3197;
          break _t3191;
        }
        if (true) {
          _t3190 = Ref$set(continue__3184, false);
          break _t3191;
        }
        _match_fail("line 16190");
      }
      _t3190;
      if (_t3187) break;
    }
    _t3186 = _t3187 ? _t3188 : undefined;
    _t3186;
    const _t3185 = List$rev(Ref$get(constraints_3182));
    const _t3183 = _t3185;
    _t3181 = _t3183;
  }
  return _t3181;
}
function Parser$parse_let_decl(p) {
  Parser$expect(p, ({_tag: 11, _name: "LET"}));
  const is_rec_3211 = _eq(Parser$peek_kind(p), ({_tag: 12, _name: "REC"}));
  let _t3213;
  if (is_rec_3211) {
    Parser$advance(p);
    _t3213 = undefined;
  } else {
    _t3213 = undefined;
  }
  _t3213;
  const is_mut_3214 = _eq(Parser$peek_kind(p), ({_tag: 32, _name: "MUT"}));
  let _t3216;
  if (is_mut_3214) {
    Parser$advance(p);
    _t3216 = undefined;
  } else {
    _t3216 = undefined;
  }
  _t3216;
  let _t3217;
  if ((is_rec_3211 && is_mut_3214)) {
    _t3217 = Parser$error(p, "let rec mut is not supported");
  } else {
    _t3217 = undefined;
  }
  _t3217;
  let _t3218;
  if (((!is_rec_3211) && ((!is_mut_3214) && Parser$is_destruct_start(p)))) {
    const pat_3219 = Parser$parse_pattern(p);
    Parser$expect(p, ({_tag: 74, _name: "EQ"}));
    const body_3221 = Parser$parse_expr(p);
    let _t3223;
    if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
      Parser$advance(p);
      undefined;
      const rest_3224 = Parser$parse_expr(p);
      const _t3225 = ({_hd: ({_tag: 6, _name: "DExpr", _val: ({_tag: 25, _name: "EMatch", _val: [body_3221, ({_hd: [pat_3219, ({_tag: 0, _name: "None"}), rest_3224], _tl: null}), true]})}), _tl: null});
      _t3223 = _t3225;
    } else {
      const tmp_3226 = "__destruct";
      const vars_3228 = Parser$extract_pat_vars(pat_3219);
      const decls_3230 = ({_hd: ({_tag: 0, _name: "DLet", _val: [tmp_3226, null, ({_tag: 0, _name: "None"}), null, body_3221]}), _tl: null});
      function _t3232(v) {
        return ({_tag: 0, _name: "DLet", _val: [v, null, ({_tag: 0, _name: "None"}), null, ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: tmp_3226}), ({_hd: [pat_3219, ({_tag: 0, _name: "None"}), ({_tag: 7, _name: "EVar", _val: v})], _tl: null}), true]})]});
      }
      const _t3231 = List$concat(decls_3230, List$map(_t3232, vars_3228));
      const _t3229 = _t3231;
      const _t3227 = _t3229;
      _t3223 = _t3227;
    }
    const _t3222 = _t3223;
    const _t3220 = _t3222;
    _t3218 = _t3220;
  } else {
    let _t3233;
    if (is_mut_3214) {
      const name_3234 = Parser$expect_ident(p);
      let _t3236;
      if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        _t3236 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
      } else {
        _t3236 = ({_tag: 0, _name: "None"});
      }
      const annot_3237 = _t3236;
      Parser$expect(p, ({_tag: 74, _name: "EQ"}));
      const body_3239 = Parser$parse_expr(p);
      let _t3242;
      const _t3241 = annot_3237;
      _t3243: {
        if (_t3241._tag === 1) {
          const ty = _t3241._val;
          _t3242 = ({_tag: 30, _name: "EAnnot", _val: [body_3239, ty]});
          break _t3243;
        }
        if (_t3241._tag === 0) {
          _t3242 = body_3239;
          break _t3243;
        }
        _match_fail("line 16190");
      }
      const body_3244 = _t3242;
      let _t3246;
      if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
        Parser$advance(p);
        undefined;
        const rest_3247 = Parser$parse_expr(p);
        const _t3248 = ({_hd: ({_tag: 6, _name: "DExpr", _val: ({_tag: 26, _name: "ELetMut", _val: [name_3234, body_3244, rest_3247]})}), _tl: null});
        _t3246 = _t3248;
      } else {
        _t3246 = ({_hd: ({_tag: 1, _name: "DLetMut", _val: [name_3234, body_3244]}), _tl: null});
      }
      const _t3245 = _t3246;
      const _t3240 = _t3245;
      const _t3238 = _t3240;
      const _t3235 = _t3238;
      _t3233 = _t3235;
    } else {
      let _t3249;
      if (is_rec_3211) {
        _t3249 = Parser$parse_type_params(p);
      } else {
        _t3249 = null;
      }
      const type_params_3250 = _t3249;
      const name_3252 = Parser$expect_ident(p);
      const fun_params_3254 = Ref$create(null);
      let _t3256 = undefined;
      let _t3257 = false, _t3258;
      while (true) {
        if (!((!_eq(Parser$peek_kind(p), ({_tag: 74, _name: "EQ"})) && (!_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"})) && !_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHERE"})))))) break;
        Ref$set(fun_params_3254, ({_hd: Parser$parse_param(p), _tl: Ref$get(fun_params_3254)}));
        if (_t3257) break;
      }
      _t3256 = _t3257 ? _t3258 : undefined;
      _t3256;
      let _t3259;
      if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        const ty_3260 = Parser$parse_ty(p);
        let _t3262;
        if (_eq(Parser$peek_kind(p), ({_tag: 70, _name: "SLASH"}))) {
          Parser$advance(p);
          undefined;
          let _t3263;
          if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
            Parser$advance(p);
            undefined;
            _t3263 = ({_tag: 0, _name: "EffAnnotPure"});
          } else {
            _t3263 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
          }
          const eff_3264 = _t3263;
          const _t3265 = ({_tag: 1, _name: "Some", _val: ({_tag: 11, _name: "TyWithEffect", _val: [ty_3260, eff_3264]})});
          _t3262 = _t3265;
        } else {
          _t3262 = ({_tag: 1, _name: "Some", _val: ty_3260});
        }
        const _t3261 = _t3262;
        _t3259 = _t3261;
      } else {
        _t3259 = ({_tag: 0, _name: "None"});
      }
      const ret_annot_3266 = _t3259;
      const constraints_3268 = Parser$parse_constraints(p);
      Parser$expect(p, ({_tag: 74, _name: "EQ"}));
      const body_3270 = Parser$parse_expr(p);
      const fun_params_3272 = List$rev(Ref$get(fun_params_3254));
      let _t3275;
      const _t3274 = Parser$resolve_fun_params(fun_params_3272, body_3270);
      _t3276: {
        if (true) {
          const params = _t3274[0];
          const body = _t3274[1];
          let _t3277;
          if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
            Parser$advance(p);
            undefined;
            const rest_3278 = Parser$parse_expr(p);
            const full_body_3280 = Parser$wrap_params_expr(fun_params_3272, ret_annot_3266, body);
            let _t3282;
            if (is_rec_3211) {
              _t3282 = ({_tag: 9, _name: "ELetRec", _val: [name_3252, type_params_3250, full_body_3280, rest_3278]});
            } else {
              _t3282 = ({_tag: 8, _name: "ELet", _val: [name_3252, full_body_3280, rest_3278]});
            }
            const expr_3283 = _t3282;
            const _t3284 = ({_hd: ({_tag: 6, _name: "DExpr", _val: expr_3283}), _tl: null});
            const _t3281 = _t3284;
            const _t3279 = _t3281;
            _t3277 = _t3279;
          } else {
            let _t3285;
            if ((is_rec_3211 && _eq(Parser$peek_kind(p), ({_tag: 49, _name: "AND"})))) {
              const bindings_3286 = Ref$create(({_hd: [name_3252, type_params_3250, params, ret_annot_3266, constraints_3268, body], _tl: null}));
              let _t3288 = undefined;
              let _t3289 = false, _t3290;
              while (true) {
                if (!(_eq(Parser$peek_kind(p), ({_tag: 49, _name: "AND"})))) break;
                Parser$advance(p);
                undefined;
                const and_name_3291 = Parser$expect_ident(p);
                const and_type_params_3293 = Parser$parse_type_params(p);
                const and_fun_params_3295 = Ref$create(null);
                let _t3297 = undefined;
                let _t3298 = false, _t3299;
                while (true) {
                  if (!((!_eq(Parser$peek_kind(p), ({_tag: 74, _name: "EQ"})) && (!_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"})) && !_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHERE"})))))) break;
                  Ref$set(and_fun_params_3295, ({_hd: Parser$parse_param(p), _tl: Ref$get(and_fun_params_3295)}));
                  if (_t3298) break;
                }
                _t3297 = _t3298 ? _t3299 : undefined;
                _t3297;
                let _t3300;
                if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
                  Parser$advance(p);
                  undefined;
                  const ty_3301 = Parser$parse_ty(p);
                  let _t3303;
                  if (_eq(Parser$peek_kind(p), ({_tag: 70, _name: "SLASH"}))) {
                    Parser$advance(p);
                    undefined;
                    let _t3304;
                    if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
                      Parser$advance(p);
                      undefined;
                      _t3304 = ({_tag: 0, _name: "EffAnnotPure"});
                    } else {
                      _t3304 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
                    }
                    const eff_3305 = _t3304;
                    const _t3306 = ({_tag: 1, _name: "Some", _val: ({_tag: 11, _name: "TyWithEffect", _val: [ty_3301, eff_3305]})});
                    _t3303 = _t3306;
                  } else {
                    _t3303 = ({_tag: 1, _name: "Some", _val: ty_3301});
                  }
                  const _t3302 = _t3303;
                  _t3300 = _t3302;
                } else {
                  _t3300 = ({_tag: 0, _name: "None"});
                }
                const and_ret_annot_3307 = _t3300;
                const and_constraints_3309 = Parser$parse_constraints(p);
                Parser$expect(p, ({_tag: 74, _name: "EQ"}));
                const and_body_3311 = Parser$parse_expr(p);
                const and_fun_params_3313 = List$rev(Ref$get(and_fun_params_3295));
                let _t3316;
                const _t3315 = Parser$resolve_fun_params(and_fun_params_3313, and_body_3311);
                _t3317: {
                  if (true) {
                    const and_params = _t3315[0];
                    const and_body = _t3315[1];
                    _t3316 = Ref$set(bindings_3286, ({_hd: [and_name_3291, and_type_params_3293, and_params, and_ret_annot_3307, and_constraints_3309, and_body], _tl: Ref$get(bindings_3286)}));
                    break _t3317;
                  }
                  _match_fail("line 16190");
                }
                const _t3314 = _t3316;
                const _t3312 = _t3314;
                const _t3310 = _t3312;
                const _t3308 = _t3310;
                const _t3296 = _t3308;
                const _t3294 = _t3296;
                const _t3292 = _t3294;
                _t3292;
                if (_t3289) break;
              }
              _t3288 = _t3289 ? _t3290 : undefined;
              _t3288;
              let _t3318;
              if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
                Parser$advance(p);
                undefined;
                const rest_3319 = Parser$parse_expr(p);
                function _t3321(__p34) {
                  let _t3323;
                  const _t3322 = __p34;
                  _t3324: {
                    if (true) {
                      const n = _t3322[0];
                      const tp = _t3322[1];
                      const ps = _t3322[2];
                      const ra = _t3322[3];
                      const _cs = _t3322[4];
                      const b = _t3322[5];
                      function _t3325(p) {
                        return ({_tag: 0, _name: "FPParam", _val: p});
                      }
                      const full_3326 = Parser$wrap_params_expr(List$map(_t3325, ps), ra, b);
                      const _t3327 = [n, tp, full_3326];
                      _t3323 = _t3327;
                      break _t3324;
                    }
                    _match_fail("line 16190");
                  }
                  return _t3323;
                }
                const expr_bindings_3328 = List$map(_t3321, List$rev(Ref$get(bindings_3286)));
                const _t3329 = ({_hd: ({_tag: 6, _name: "DExpr", _val: ({_tag: 38, _name: "ELetRecAnd", _val: [expr_bindings_3328, rest_3319]})}), _tl: null});
                const _t3320 = _t3329;
                _t3318 = _t3320;
              } else {
                _t3318 = ({_hd: ({_tag: 3, _name: "DLetRecAnd", _val: List$rev(Ref$get(bindings_3286))}), _tl: null});
              }
              const _t3287 = _t3318;
              _t3285 = _t3287;
            } else {
              let _t3330;
              if (is_rec_3211) {
                _t3330 = ({_hd: ({_tag: 2, _name: "DLetRec", _val: [name_3252, type_params_3250, params, ret_annot_3266, constraints_3268, body]}), _tl: null});
              } else {
                _t3330 = ({_hd: ({_tag: 0, _name: "DLet", _val: [name_3252, params, ret_annot_3266, constraints_3268, body]}), _tl: null});
              }
              _t3285 = _t3330;
            }
            _t3277 = _t3285;
          }
          _t3275 = _t3277;
          break _t3276;
        }
        _match_fail("line 16190");
      }
      const _t3273 = _t3275;
      const _t3271 = _t3273;
      const _t3269 = _t3271;
      const _t3267 = _t3269;
      const _t3255 = _t3267;
      const _t3253 = _t3255;
      const _t3251 = _t3253;
      _t3233 = _t3251;
    }
    _t3218 = _t3233;
  }
  const _t3215 = _t3218;
  const _t3212 = _t3215;
  return _t3212;
}
function Parser$parse_class_name(p) {
  let _t3332;
  const _t3331 = Parser$peek_kind(p);
  _t3333: {
    if (_t3331._tag === 9) {
      const s = _t3331._val;
      Parser$advance(p);
      undefined;
      let _t3334;
      if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "DOT"}))) {
        Parser$advance(p);
        undefined;
        let _t3336;
        const _t3335 = Parser$peek_kind(p);
        _t3337: {
          if (_t3335._tag === 9) {
            const s2 = _t3335._val;
            Parser$advance(p);
            undefined;
            _t3336 = (s + ("." + s2));
            break _t3337;
          }
          if (true) {
            _t3336 = Parser$error(p, "expected class name after dot");
            break _t3337;
          }
          _match_fail("line 16190");
        }
        _t3334 = _t3336;
      } else {
        _t3334 = s;
      }
      _t3332 = _t3334;
      break _t3333;
    }
    if (true) {
      _t3332 = Parser$error(p, "expected class name");
      break _t3333;
    }
    _match_fail("line 16190");
  }
  return _t3332;
}
function Parser$parse_class_decl(p) {
  Parser$expect(p, ({_tag: 21, _name: "CLASS"}));
  const class_name_3338 = Parser$expect_uident(p);
  let _t3340;
  if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "DOT"}))) {
    _t3340 = Parser$error(p, "class declarations cannot use qualified names; define the class inside a module instead");
  } else {
    _t3340 = undefined;
  }
  _t3340;
  const tyvars_3341 = Ref$create(null);
  const continue_tyvars_3343 = Ref$create(true);
  let _t3345 = undefined;
  let _t3346 = false, _t3347;
  while (true) {
    if (!(Ref$get(continue_tyvars_3343))) break;
    let _t3349;
    const _t3348 = Parser$peek_kind(p);
    _t3350: {
      if (_t3348._tag === 10) {
        const s = _t3348._val;
        Parser$advance(p);
        undefined;
        _t3349 = Ref$set(tyvars_3341, ({_hd: s, _tl: Ref$get(tyvars_3341)}));
        break _t3350;
      }
      if (true) {
        _t3349 = Ref$set(continue_tyvars_3343, false);
        break _t3350;
      }
      _match_fail("line 16190");
    }
    _t3349;
    if (_t3346) break;
  }
  _t3345 = _t3346 ? _t3347 : undefined;
  _t3345;
  const tyvars_3351 = List$rev(Ref$get(tyvars_3341));
  let _t3353;
  if (_eq(tyvars_3351, null)) {
    _t3353 = Parser$error(p, "expected at least one type variable");
  } else {
    _t3353 = undefined;
  }
  _t3353;
  let _t3354;
  if (_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHERE"}))) {
    Parser$advance(p);
    undefined;
    const deps_3355 = Ref$create(null);
    const continue__3357 = Ref$create(true);
    let _t3359 = undefined;
    let _t3360 = false, _t3361;
    while (true) {
      if (!(Ref$get(continue__3357))) break;
      const from_vars_3362 = Ref$create(null);
      let _t3364 = undefined;
      let _t3365 = false, _t3366;
      while (true) {
        let _t3368;
        const _t3367 = Parser$peek_kind(p);
        _t3369: {
          if (_t3367._tag === 10) {
            _t3368 = true;
            break _t3369;
          }
          if (true) {
            _t3368 = false;
            break _t3369;
          }
          _match_fail("line 16190");
        }
        if (!(_t3368)) break;
        let _t3371;
        const _t3370 = Parser$advance(p).kind;
        _t3372: {
          if (_t3370._tag === 10) {
            const s = _t3370._val;
            let _t3373;
            if ((!List$mem(s, tyvars_3351))) {
              _t3373 = Parser$error(p, (("functional dependency type variable '" + __dict_Show_string.show(s)) + " not in class parameters"));
            } else {
              _t3373 = undefined;
            }
            _t3373;
            _t3371 = Ref$set(from_vars_3362, ({_hd: s, _tl: Ref$get(from_vars_3362)}));
            break _t3372;
          }
          if (true) {
            _t3371 = undefined;
            break _t3372;
          }
          _match_fail("line 16190");
        }
        _t3371;
        if (_t3365) break;
      }
      _t3364 = _t3365 ? _t3366 : undefined;
      _t3364;
      let _t3374;
      if (_eq(Ref$get(from_vars_3362), null)) {
        _t3374 = Parser$error(p, "expected type variable(s) before '->'");
      } else {
        _t3374 = undefined;
      }
      _t3374;
      Parser$expect(p, ({_tag: 57, _name: "ARROW"}));
      const to_vars_3375 = Ref$create(null);
      let _t3377 = undefined;
      let _t3378 = false, _t3379;
      while (true) {
        let _t3381;
        const _t3380 = Parser$peek_kind(p);
        _t3382: {
          if (_t3380._tag === 10) {
            _t3381 = true;
            break _t3382;
          }
          if (true) {
            _t3381 = false;
            break _t3382;
          }
          _match_fail("line 16190");
        }
        if (!(_t3381)) break;
        let _t3384;
        const _t3383 = Parser$advance(p).kind;
        _t3385: {
          if (_t3383._tag === 10) {
            const s = _t3383._val;
            let _t3386;
            if ((!List$mem(s, tyvars_3351))) {
              _t3386 = Parser$error(p, (("functional dependency type variable '" + __dict_Show_string.show(s)) + " not in class parameters"));
            } else {
              _t3386 = undefined;
            }
            _t3386;
            _t3384 = Ref$set(to_vars_3375, ({_hd: s, _tl: Ref$get(to_vars_3375)}));
            break _t3385;
          }
          if (true) {
            _t3384 = undefined;
            break _t3385;
          }
          _match_fail("line 16190");
        }
        _t3384;
        if (_t3378) break;
      }
      _t3377 = _t3378 ? _t3379 : undefined;
      _t3377;
      let _t3387;
      if (_eq(Ref$get(to_vars_3375), null)) {
        _t3387 = Parser$error(p, "expected type variable(s) after '->'");
      } else {
        _t3387 = undefined;
      }
      _t3387;
      Ref$set(deps_3355, ({_hd: [List$rev(Ref$get(from_vars_3362)), List$rev(Ref$get(to_vars_3375))], _tl: Ref$get(deps_3355)}));
      let _t3388;
      if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "COMMA"}))) {
        Parser$advance(p);
        _t3388 = undefined;
      } else {
        _t3388 = Ref$set(continue__3357, false);
      }
      const _t3376 = _t3388;
      const _t3363 = _t3376;
      _t3363;
      if (_t3360) break;
    }
    _t3359 = _t3360 ? _t3361 : undefined;
    _t3359;
    const _t3358 = List$rev(Ref$get(deps_3355));
    const _t3356 = _t3358;
    _t3354 = _t3356;
  } else {
    _t3354 = null;
  }
  const fundeps_3389 = _t3354;
  Parser$expect(p, ({_tag: 74, _name: "EQ"}));
  const methods_3391 = Ref$create(null);
  let _t3393 = undefined;
  let _t3394 = false, _t3395;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 46, _name: "END"})))) break;
    const s_3396 = Parser$expect_ident(p);
    Parser$expect(p, ({_tag: 61, _name: "COLON"}));
    const ty_3398 = Parser$parse_ty(p);
    Ref$set(methods_3391, ({_hd: [s_3396, ty_3398], _tl: Ref$get(methods_3391)}));
    let _t3400;
    if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "SEMICOLON"}))) {
      Parser$advance(p);
      _t3400 = undefined;
    } else {
      _t3400 = undefined;
    }
    const _t3399 = _t3400;
    const _t3397 = _t3399;
    _t3397;
    if (_t3394) break;
  }
  _t3393 = _t3394 ? _t3395 : undefined;
  _t3393;
  Parser$expect(p, ({_tag: 46, _name: "END"}));
  let _t3401;
  if (_eq(Ref$get(methods_3391), null)) {
    _t3401 = Parser$error(p, "class must have at least one method");
  } else {
    _t3401 = undefined;
  }
  _t3401;
  const _t3392 = ({_tag: 7, _name: "DClass", _val: [class_name_3338, tyvars_3351, fundeps_3389, List$rev(Ref$get(methods_3391))]});
  const _t3390 = _t3392;
  const _t3352 = _t3390;
  const _t3344 = _t3352;
  const _t3342 = _t3344;
  const _t3339 = _t3342;
  return _t3339;
}
function Parser$parse_instance_decl(p) {
  Parser$expect(p, ({_tag: 22, _name: "INSTANCE"}));
  const class_name_3402 = Parser$parse_class_name(p);
  const inst_tys_3404 = Ref$create(null);
  let _t3406 = undefined;
  let _t3407 = false, _t3408;
  while (true) {
    if (!((!_eq(Parser$peek_kind(p), ({_tag: 74, _name: "EQ"})) && !_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHERE"}))))) break;
    Ref$set(inst_tys_3404, ({_hd: Parser$parse_ty_atom(p), _tl: Ref$get(inst_tys_3404)}));
    if (_t3407) break;
  }
  _t3406 = _t3407 ? _t3408 : undefined;
  _t3406;
  const inst_tys_3409 = List$rev(Ref$get(inst_tys_3404));
  let _t3411;
  if (_eq(inst_tys_3409, null)) {
    _t3411 = Parser$error(p, "expected at least one instance type");
  } else {
    _t3411 = undefined;
  }
  _t3411;
  const constraints_3412 = Parser$parse_constraints(p);
  Parser$expect(p, ({_tag: 74, _name: "EQ"}));
  const methods_3414 = Ref$create(null);
  let _t3416 = undefined;
  let _t3417 = false, _t3418;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 46, _name: "END"})))) break;
    Parser$expect(p, ({_tag: 11, _name: "LET"}));
    let _t3419;
    if (_eq(Parser$peek_kind(p), ({_tag: 51, _name: "LPAREN"}))) {
      Parser$advance(p);
      undefined;
      let _t3421;
      const _t3420 = Parser$peek_kind(p);
      _t3422: {
        if (_t3420._tag === 67) {
          _t3421 = "+";
          break _t3422;
        }
        if (_t3420._tag === 68) {
          _t3421 = "-";
          break _t3422;
        }
        if (_t3420._tag === 69) {
          _t3421 = "*";
          break _t3422;
        }
        if (_t3420._tag === 70) {
          _t3421 = "/";
          break _t3422;
        }
        if (_t3420._tag === 76) {
          _t3421 = "<";
          break _t3422;
        }
        if (_t3420._tag === 77) {
          _t3421 = ">";
          break _t3422;
        }
        if (_t3420._tag === 78) {
          _t3421 = "<=";
          break _t3422;
        }
        if (_t3420._tag === 79) {
          _t3421 = ">=";
          break _t3422;
        }
        if (_t3420._tag === 74) {
          _t3421 = "=";
          break _t3422;
        }
        if (_t3420._tag === 75) {
          _t3421 = "<>";
          break _t3422;
        }
        if (_t3420._tag === 82) {
          _t3421 = "land";
          break _t3422;
        }
        if (_t3420._tag === 83) {
          _t3421 = "lor";
          break _t3422;
        }
        if (_t3420._tag === 84) {
          _t3421 = "lxor";
          break _t3422;
        }
        if (_t3420._tag === 85) {
          _t3421 = "lnot";
          break _t3422;
        }
        if (_t3420._tag === 86) {
          _t3421 = "lsl";
          break _t3422;
        }
        if (_t3420._tag === 87) {
          _t3421 = "lsr";
          break _t3422;
        }
        if (true) {
          _t3421 = Parser$error(p, "expected operator");
          break _t3422;
        }
        _match_fail("line 16190");
      }
      const name_3423 = _t3421;
      Parser$advance(p);
      undefined;
      Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
      const _t3424 = name_3423;
      _t3419 = _t3424;
    } else {
      _t3419 = Parser$expect_ident(p);
    }
    const method_name_3425 = _t3419;
    const params_3427 = Ref$create(null);
    let _t3429 = undefined;
    let _t3430 = false, _t3431;
    while (true) {
      if (!((!_eq(Parser$peek_kind(p), ({_tag: 74, _name: "EQ"})) && (!_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"})) && !_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHERE"})))))) break;
      Ref$set(params_3427, ({_hd: Parser$parse_param(p), _tl: Ref$get(params_3427)}));
      if (_t3430) break;
    }
    _t3429 = _t3430 ? _t3431 : undefined;
    _t3429;
    let _t3432;
    if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "COLON"}))) {
      Parser$advance(p);
      undefined;
      _t3432 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
    } else {
      _t3432 = ({_tag: 0, _name: "None"});
    }
    const ret_annot_3433 = _t3432;
    const _constraints_3435 = Parser$parse_constraints(p);
    Parser$expect(p, ({_tag: 74, _name: "EQ"}));
    const body_3437 = Parser$parse_expr(p);
    const fun_params_3439 = List$rev(Ref$get(params_3427));
    function _t3441(body, fp) {
      let _t3443;
      const _t3442 = fp;
      _t3444: {
        if (_t3442._tag === 0) {
          _t3443 = body;
          break _t3444;
        }
        if (_t3442._tag === 1) {
          const name = _t3442._val[0];
          const pat = _t3442._val[1];
          _t3443 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
          break _t3444;
        }
        _match_fail("line 16190");
      }
      return _t3443;
    }
    const body_3445 = List$fold(_t3441, body_3437, fun_params_3439);
    let _t3448;
    const _t3447 = ret_annot_3433;
    _t3449: {
      if (_t3447._tag === 1) {
        const ty = _t3447._val;
        _t3448 = ({_tag: 30, _name: "EAnnot", _val: [body_3445, ty]});
        break _t3449;
      }
      if (_t3447._tag === 0) {
        _t3448 = body_3445;
        break _t3449;
      }
      _match_fail("line 16190");
    }
    const body_3450 = _t3448;
    function _t3452(fp) {
      let _t3454;
      const _t3453 = fp;
      _t3455: {
        if (_t3453._tag === 0) {
          const param = _t3453._val;
          _t3454 = param;
          break _t3455;
        }
        if (_t3453._tag === 1) {
          const name = _t3453._val[0];
          const annot = _t3453._val[2];
          _t3454 = ({annot: annot, is_generated: true, name: name});
          break _t3455;
        }
        _match_fail("line 16190");
      }
      return _t3454;
    }
    const plain_params_3456 = List$map(_t3452, fun_params_3439);
    const _t3457 = Ref$set(methods_3414, ({_hd: [method_name_3425, plain_params_3456, body_3450], _tl: Ref$get(methods_3414)}));
    const _t3451 = _t3457;
    const _t3446 = _t3451;
    const _t3440 = _t3446;
    const _t3438 = _t3440;
    const _t3436 = _t3438;
    const _t3434 = _t3436;
    const _t3428 = _t3434;
    const _t3426 = _t3428;
    _t3426;
    if (_t3417) break;
  }
  _t3416 = _t3417 ? _t3418 : undefined;
  _t3416;
  Parser$expect(p, ({_tag: 46, _name: "END"}));
  let _t3458;
  if (_eq(Ref$get(methods_3414), null)) {
    _t3458 = Parser$error(p, "instance must implement at least one method");
  } else {
    _t3458 = undefined;
  }
  _t3458;
  const _t3415 = ({_tag: 8, _name: "DInstance", _val: [class_name_3402, inst_tys_3409, constraints_3412, List$rev(Ref$get(methods_3414))]});
  const _t3413 = _t3415;
  const _t3410 = _t3413;
  const _t3405 = _t3410;
  const _t3403 = _t3405;
  return _t3403;
}
function Parser$parse_effect_decl(p) {
  Parser$expect(p, ({_tag: 23, _name: "EFFECT"}));
  const name_3459 = Parser$parse_class_name(p);
  const type_params_3461 = Ref$create(null);
  let _t3463 = undefined;
  let _t3464 = false, _t3465;
  while (true) {
    let _t3467;
    const _t3466 = Parser$peek_kind(p);
    _t3468: {
      if (_t3466._tag === 10) {
        _t3467 = true;
        break _t3468;
      }
      if (true) {
        _t3467 = false;
        break _t3468;
      }
      _match_fail("line 16190");
    }
    if (!(_t3467)) break;
    let _t3470;
    const _t3469 = Parser$advance(p).kind;
    _t3471: {
      if (_t3469._tag === 10) {
        const s = _t3469._val;
        _t3470 = Ref$set(type_params_3461, ({_hd: s, _tl: Ref$get(type_params_3461)}));
        break _t3471;
      }
      if (true) {
        _t3470 = undefined;
        break _t3471;
      }
      _match_fail("line 16190");
    }
    _t3470;
    if (_t3464) break;
  }
  _t3463 = _t3464 ? _t3465 : undefined;
  _t3463;
  const type_params_3472 = List$rev(Ref$get(type_params_3461));
  Parser$expect(p, ({_tag: 74, _name: "EQ"}));
  const ops_3474 = Ref$create(null);
  let _t3476 = undefined;
  let _t3477 = false, _t3478;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 46, _name: "END"})))) break;
    const s_3479 = Parser$expect_ident(p);
    Parser$expect(p, ({_tag: 61, _name: "COLON"}));
    const ty_3481 = Parser$parse_ty(p);
    Ref$set(ops_3474, ({_hd: [s_3479, ty_3481], _tl: Ref$get(ops_3474)}));
    let _t3483;
    if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "SEMICOLON"}))) {
      Parser$advance(p);
      _t3483 = undefined;
    } else {
      _t3483 = undefined;
    }
    const _t3482 = _t3483;
    const _t3480 = _t3482;
    _t3480;
    if (_t3477) break;
  }
  _t3476 = _t3477 ? _t3478 : undefined;
  _t3476;
  Parser$expect(p, ({_tag: 46, _name: "END"}));
  let _t3484;
  if (_eq(Ref$get(ops_3474), null)) {
    _t3484 = Parser$error(p, "effect must have at least one operation");
  } else {
    _t3484 = undefined;
  }
  _t3484;
  const _t3475 = ({_tag: 9, _name: "DEffect", _val: [name_3459, type_params_3472, List$rev(Ref$get(ops_3474))]});
  const _t3473 = _t3475;
  const _t3462 = _t3473;
  const _t3460 = _t3462;
  return _t3460;
}
function Parser$parse_extern_decl(p) {
  Parser$expect(p, ({_tag: 24, _name: "EXTERN"}));
  let _t3486;
  const _t3485 = Parser$peek_kind(p);
  _t3487: {
    if (_t3485._tag === 9) {
      const mod_name = _t3485._val;
      Parser$advance(p);
      undefined;
      Parser$expect(p, ({_tag: 62, _name: "DOT"}));
      const field_3488 = Parser$expect_ident(p);
      const _t3489 = (mod_name + ("." + field_3488));
      _t3486 = _t3489;
      break _t3487;
    }
    if (true) {
      _t3486 = Parser$expect_ident(p);
      break _t3487;
    }
    _match_fail("line 16190");
  }
  const name_3490 = _t3486;
  Parser$expect(p, ({_tag: 61, _name: "COLON"}));
  const ty_3492 = Parser$parse_ty(p);
  const _t3493 = ({_tag: 10, _name: "DExtern", _val: [name_3490, ty_3492]});
  const _t3491 = _t3493;
  return _t3491;
}
function Parser$parse_module_body_item(p) {
  let _t3495;
  const _t3494 = Parser$peek_kind(p);
  _t3496: {
    if (_t3494._tag === 44) {
      Parser$advance(p);
      undefined;
      const decls_3497 = Parser$parse_inner_decl(p);
      function _t3499(d) {
        return ({decl: d, vis: ({_tag: 0, _name: "Public"})});
      }
      const _t3498 = List$map(_t3499, decls_3497);
      _t3495 = _t3498;
      break _t3496;
    }
    if (_t3494._tag === 47) {
      Parser$advance(p);
      undefined;
      const decl_3500 = Parser$parse_type_decl(p);
      const _t3501 = ({_hd: ({decl: decl_3500, vis: ({_tag: 2, _name: "Opaque"})}), _tl: null});
      _t3495 = _t3501;
      break _t3496;
    }
    if (true) {
      const decls_3502 = Parser$parse_inner_decl(p);
      function _t3504(d) {
        return ({decl: d, vis: ({_tag: 1, _name: "Private"})});
      }
      const _t3503 = List$map(_t3504, decls_3502);
      _t3495 = _t3503;
      break _t3496;
    }
    _match_fail("line 16190");
  }
  return _t3495;
}
function Parser$parse_inner_decl(p) {
  let _t3506;
  const _t3505 = Parser$peek_kind(p);
  _t3507: {
    if (_t3505._tag === 19) {
      _t3506 = ({_hd: Parser$parse_type_decl(p), _tl: null});
      break _t3507;
    }
    if (_t3505._tag === 11) {
      _t3506 = Parser$parse_let_decl(p);
      break _t3507;
    }
    if (_t3505._tag === 21) {
      _t3506 = ({_hd: Parser$parse_class_decl(p), _tl: null});
      break _t3507;
    }
    if (_t3505._tag === 22) {
      _t3506 = ({_hd: Parser$parse_instance_decl(p), _tl: null});
      break _t3507;
    }
    if (_t3505._tag === 23) {
      _t3506 = ({_hd: Parser$parse_effect_decl(p), _tl: null});
      break _t3507;
    }
    if (_t3505._tag === 24) {
      _t3506 = ({_hd: Parser$parse_extern_decl(p), _tl: null});
      break _t3507;
    }
    if (_t3505._tag === 43) {
      _t3506 = ({_hd: Parser$parse_module_decl(p), _tl: null});
      break _t3507;
    }
    if (_t3505._tag === 45) {
      _t3506 = ({_hd: Parser$parse_open_decl(p), _tl: null});
      break _t3507;
    }
    if (true) {
      _t3506 = Parser$error(p, "expected declaration inside module");
      break _t3507;
    }
    _match_fail("line 16190");
  }
  return _t3506;
}
function Parser$parse_module_decl(p) {
  Parser$expect(p, ({_tag: 43, _name: "MODULE"}));
  const name_3508 = Parser$expect_uident(p);
  Parser$expect(p, ({_tag: 74, _name: "EQ"}));
  const items_3510 = Ref$create(null);
  let _t3512 = undefined;
  let _t3513 = false, _t3514;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 46, _name: "END"})))) break;
    const module_items_3515 = Parser$parse_module_body_item(p);
    Ref$set(items_3510, List$rev_append(module_items_3515, Ref$get(items_3510)));
    let _t3517;
    if (_eq(Parser$peek_kind(p), ({_tag: 60, _name: "DOUBLE_SEMICOLON"}))) {
      Parser$advance(p);
      _t3517 = undefined;
    } else {
      _t3517 = undefined;
    }
    const _t3516 = _t3517;
    _t3516;
    if (_t3513) break;
  }
  _t3512 = _t3513 ? _t3514 : undefined;
  _t3512;
  Parser$expect(p, ({_tag: 46, _name: "END"}));
  const _t3511 = ({_tag: 11, _name: "DModule", _val: [name_3508, List$rev(Ref$get(items_3510))]});
  const _t3509 = _t3511;
  return _t3509;
}
function Parser$parse_open_decl(p) {
  Parser$expect(p, ({_tag: 45, _name: "OPEN"}));
  const name_3518 = Parser$expect_uident(p);
  let _t3520;
  if (_eq(Parser$peek_kind(p), ({_tag: 51, _name: "LPAREN"}))) {
    Parser$advance(p);
    undefined;
    const names_3521 = Ref$create(null);
    const first_3523 = Ref$create(true);
    let _t3525 = undefined;
    let _t3526 = false, _t3527;
    while (true) {
      if (!(!_eq(Parser$peek_kind(p), ({_tag: 52, _name: "RPAREN"})))) break;
      let _t3528;
      if ((!Ref$get(first_3523))) {
        _t3528 = Parser$expect(p, ({_tag: 58, _name: "COMMA"}));
      } else {
        _t3528 = undefined;
      }
      _t3528;
      Ref$set(first_3523, false);
      const n_3529 = Parser$expect_ident(p);
      const _t3530 = Ref$set(names_3521, ({_hd: n_3529, _tl: Ref$get(names_3521)}));
      _t3530;
      if (_t3526) break;
    }
    _t3525 = _t3526 ? _t3527 : undefined;
    _t3525;
    Parser$expect(p, ({_tag: 52, _name: "RPAREN"}));
    const _t3524 = ({_tag: 12, _name: "DOpen", _val: [name_3518, ({_tag: 1, _name: "Some", _val: List$rev(Ref$get(names_3521))})]});
    const _t3522 = _t3524;
    _t3520 = _t3522;
  } else {
    _t3520 = ({_tag: 12, _name: "DOpen", _val: [name_3518, ({_tag: 0, _name: "None"})]});
  }
  const _t3519 = _t3520;
  return _t3519;
}
function Parser$parse_decl(p) {
  let _t3532;
  const _t3531 = Parser$peek_kind(p);
  _t3533: {
    if (_t3531._tag === 19) {
      _t3532 = ({_hd: Parser$parse_type_decl(p), _tl: null});
      break _t3533;
    }
    if (_t3531._tag === 11) {
      _t3532 = Parser$parse_let_decl(p);
      break _t3533;
    }
    if (_t3531._tag === 21) {
      _t3532 = ({_hd: Parser$parse_class_decl(p), _tl: null});
      break _t3533;
    }
    if (_t3531._tag === 22) {
      _t3532 = ({_hd: Parser$parse_instance_decl(p), _tl: null});
      break _t3533;
    }
    if (_t3531._tag === 23) {
      _t3532 = ({_hd: Parser$parse_effect_decl(p), _tl: null});
      break _t3533;
    }
    if (_t3531._tag === 24) {
      _t3532 = ({_hd: Parser$parse_extern_decl(p), _tl: null});
      break _t3533;
    }
    if (_t3531._tag === 43) {
      _t3532 = ({_hd: Parser$parse_module_decl(p), _tl: null});
      break _t3533;
    }
    if (_t3531._tag === 45) {
      _t3532 = ({_hd: Parser$parse_open_decl(p), _tl: null});
      break _t3533;
    }
    if (true) {
      const expr_3534 = Parser$parse_expr(p);
      const _t3535 = ({_hd: ({_tag: 6, _name: "DExpr", _val: expr_3534}), _tl: null});
      _t3532 = _t3535;
      break _t3533;
    }
    _match_fail("line 16190");
  }
  return _t3532;
}
function Parser$parse_program(tokens) {
  const p_3536 = Parser$create(tokens);
  const decls_3538 = Ref$create(null);
  let _t3540 = undefined;
  let _t3541 = false, _t3542;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p_3536), ({_tag: 90, _name: "EOF"})))) break;
    const ds_3543 = Parser$parse_decl(p_3536);
    Ref$set(decls_3538, List$rev_append(ds_3543, Ref$get(decls_3538)));
    let _t3545;
    if (_eq(Parser$peek_kind(p_3536), ({_tag: 60, _name: "DOUBLE_SEMICOLON"}))) {
      Parser$advance(p_3536);
      _t3545 = undefined;
    } else {
      _t3545 = undefined;
    }
    const _t3544 = _t3545;
    _t3544;
    if (_t3541) break;
  }
  _t3540 = _t3541 ? _t3542 : undefined;
  _t3540;
  const _t3539 = List$rev(Ref$get(decls_3538));
  const _t3537 = _t3539;
  return _t3537;
}
function Parser$parse_expr_string(tokens) {
  const p_3546 = Parser$create(tokens);
  const _t3547 = Parser$parse_expr(p_3546);
  return _t3547;
}
const Typechecker$current_loc = Ref$create(({col: 0, line: 0, offset: 0}));
function Typechecker$error(msg) {
  return _trampoline(function() {
    return _h["type_error"]([msg, Ref$get(Typechecker$current_loc)], function(_t3548) {
      return _bounce(function() {
        return _t3548;
      });
    });
  }, Typechecker$error);
}
function Typechecker$strip_loc(expr) {
  while (true) {
    let _t3550;
    const _t3549 = expr;
    _t3551: {
      if (_t3549._tag === 49) {
        const inner = _t3549._val[1];
        const _t3552 = inner;
        expr = _t3552;
        continue;
        _t3550 = undefined;
        break _t3551;
      }
      if (true) {
        const e = _t3549;
        _t3550 = e;
        break _t3551;
      }
      _match_fail("line 16190");
    }
    return _t3550;
  }
}
function Typechecker$try_unify(t1, t2) {
  const _t3553 = (function() {
    const _t3554 = _h;
    _h = Object.assign({}, _t3554, {
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const __x_3555 = Types$unify(t1, t2);
      return __x_3555;
    } catch (_exc) {
      if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return Typechecker$error(msg);
      } else { throw _exc; }
    } finally { _h = _t3554; }
  })();
  return _t3553;
}
function Typechecker$try_unify_eff(e1, e2) {
  const _t3556 = (function() {
    const _t3557 = _h;
    _h = Object.assign({}, _t3557, {
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const __x_3558 = Types$unify_eff(e1, e2);
      return __x_3558;
    } catch (_exc) {
      if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return Typechecker$error(msg);
      } else { throw _exc; }
    } finally { _h = _t3557; }
  })();
  return _t3556;
}
function Typechecker$try_subeffect(source, target) {
  const _t3559 = (function() {
    const _t3560 = _h;
    _h = Object.assign({}, _t3560, {
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const __x_3561 = Types$subeffect(source, target);
      return __x_3561;
    } catch (_exc) {
      if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return Typechecker$error(msg);
      } else { throw _exc; }
    } finally { _h = _t3560; }
  })();
  return _t3559;
}
function Typechecker$max_tgen_in_ty(__x) {
  while (true) {
    let _t3563;
    const _t3562 = __x;
    _t3564: {
      if (_t3562._tag === 17) {
        const i = _t3562._val;
        _t3563 = i;
        break _t3564;
      }
      if ((_t3562._tag === 7 || _t3562._tag === 8)) {
        const a = _t3562._val[0];
        const b = _t3562._val[2];
        _t3563 = max(Typechecker$max_tgen_in_ty(a), Typechecker$max_tgen_in_ty(b));
        break _t3564;
      }
      if (_t3562._tag === 9) {
        const ts = _t3562._val;
        function _t3565(acc, t) {
          return max(acc, Typechecker$max_tgen_in_ty(t));
        }
        _t3563 = List$fold(_t3565, (-1), ts);
        break _t3564;
      }
      if (_t3562._tag === 10) {
        const t = _t3562._val;
        const _t3566 = t;
        __x = _t3566;
        continue;
        _t3563 = undefined;
        break _t3564;
      }
      if (_t3562._tag === 11) {
        const row = _t3562._val;
        _t3563 = Typechecker$max_tgen_in_rrow(row);
        break _t3564;
      }
      if (_t3562._tag === 12) {
        const args = _t3562._val[1];
        function _t3567(acc, t) {
          return max(acc, Typechecker$max_tgen_in_ty(t));
        }
        _t3563 = List$fold(_t3567, (-1), args);
        break _t3564;
      }
      if (_t3562._tag === 13) {
        const k = _t3562._val[0];
        const v = _t3562._val[1];
        _t3563 = max(Typechecker$max_tgen_in_ty(k), Typechecker$max_tgen_in_ty(v));
        break _t3564;
      }
      if (_t3562._tag === 14) {
        const t = _t3562._val;
        const _t3568 = t;
        __x = _t3568;
        continue;
        _t3563 = undefined;
        break _t3564;
      }
      if (true) {
        _t3563 = (-1);
        break _t3564;
      }
      _match_fail("line 16190");
    }
    return _t3563;
  }
}
function Typechecker$max_tgen_in_rrow(__x) {
  let _t3570;
  const _t3569 = __x;
  _t3571: {
    if (_t3569._tag === 0) {
      const ty = _t3569._val[1];
      const tail = _t3569._val[2];
      _t3570 = max(Typechecker$max_tgen_in_ty(ty), Typechecker$max_tgen_in_rrow(tail));
      break _t3571;
    }
    if (_t3569._tag === 3) {
      _t3570 = (-1);
      break _t3571;
    }
    if (true) {
      _t3570 = (-1);
      break _t3571;
    }
    _match_fail("line 16190");
  }
  return _t3570;
}
function Typechecker$max_effgen_in_eff(__x) {
  let _t3573;
  const _t3572 = __x;
  _t3574: {
    if (_t3572._tag === 3) {
      const i = _t3572._val;
      _t3573 = i;
      break _t3574;
    }
    if (_t3572._tag === 2) {
      const params = _t3572._val[1];
      const tail = _t3572._val[2];
      function _t3575(acc, t) {
        return max(acc, Typechecker$max_tgen_in_ty(t));
      }
      const ty_max_3576 = List$fold(_t3575, (-1), params);
      const _t3577 = max(ty_max_3576, Typechecker$max_effgen_in_eff(tail));
      _t3573 = _t3577;
      break _t3574;
    }
    if (true) {
      _t3573 = (-1);
      break _t3574;
    }
    _match_fail("line 16190");
  }
  return _t3573;
}
function Typechecker$max_effgen_in_ty(__x) {
  let _t3579;
  const _t3578 = __x;
  _t3580: {
    if ((_t3578._tag === 7 || _t3578._tag === 8)) {
      const a = _t3578._val[0];
      const eff = _t3578._val[1];
      const b = _t3578._val[2];
      _t3579 = max(max(Typechecker$max_tgen_in_ty(a), Typechecker$max_tgen_in_ty(b)), Typechecker$max_effgen_in_eff(eff));
      break _t3580;
    }
    if (true) {
      _t3579 = (-1);
      break _t3580;
    }
    _match_fail("line 16190");
  }
  return _t3579;
}
function Typechecker$lookup_var(ctx, level, name) {
  let _t3582;
  const _t3581 = List$assoc_opt(name, ctx.vars);
  _t3583: {
    if (_t3581._tag === 1) {
      const scheme = _t3581._val;
      _t3582 = Types$instantiate(level, scheme);
      break _t3583;
    }
    if (_t3581._tag === 0) {
      let _t3585;
      const _t3584 = String$rindex_opt(name, 46);
      _t3586: {
        if (_t3584._tag === 1) {
          const i = _t3584._val;
          const class_prefix_3587 = String$sub(name, 0, i);
          const method_name_3589 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
          function _t3591(cls) {
            let _t3596;
            if ((cls.class_name === class_prefix_3587)) {
            function _t3592(__p35) {
              let _t3594;
              const _t3593 = __p35;
              _t3595: {
                if (true) {
                  const m = _t3593[0];
                  _t3594 = (m === method_name_3589);
                  break _t3595;
                }
                _match_fail("line 16190");
              }
              return _t3594;
            }
              _t3596 = List$exists(_t3592, cls.class_methods);
            } else {
              _t3596 = false;
            }
            return _t3596;
          }
          let _t3598;
          const _t3597 = List$find(_t3591, ctx.type_env.classes);
          _t3599: {
            if (_t3597._tag === 1) {
              const class_def = _t3597._val;
              const method_ty_3600 = List$assoc(method_name_3589, class_def.class_methods);
              const num_class_params_3602 = List$length(class_def.class_params);
              const max_gen_3604 = Typechecker$max_tgen_in_ty(method_ty_3600);
              const quant_3606 = max((max_gen_3604 + 1), num_class_params_3602);
              const max_effgen_3608 = Typechecker$max_effgen_in_ty(method_ty_3600);
              let _t3610;
              if ((max_effgen_3608 >= 0)) {
                _t3610 = (max_effgen_3608 + 1);
              } else {
                _t3610 = 0;
              }
              const equant_3611 = _t3610;
              const scheme_3613 = ({body: method_ty_3600, constraints: null, equant: equant_3611, pvquant: 0, quant: quant_3606, record_evidences: null, rquant: 0});
              const _t3614 = Types$instantiate(level, scheme_3613);
              const _t3612 = _t3614;
              const _t3609 = _t3612;
              const _t3607 = _t3609;
              const _t3605 = _t3607;
              const _t3603 = _t3605;
              const _t3601 = _t3603;
              _t3598 = _t3601;
              break _t3599;
            }
            if (_t3597._tag === 0) {
              _t3598 = Typechecker$error(("unbound variable: " + __dict_Show_string.show(name)));
              break _t3599;
            }
            _match_fail("line 16190");
          }
          const _t3590 = _t3598;
          const _t3588 = _t3590;
          _t3585 = _t3588;
          break _t3586;
        }
        if (_t3584._tag === 0) {
          _t3585 = Typechecker$error(("unbound variable: " + __dict_Show_string.show(name)));
          break _t3586;
        }
        _match_fail("line 16190");
      }
      _t3582 = _t3585;
      break _t3583;
    }
    _match_fail("line 16190");
  }
  return _t3582;
}
function Typechecker$extend_var(ctx, name, scheme) {
  const __rec_upd_3615 = ctx;
  function _t3617(n) {
    return (n !== name);
  }
  const _t3616 = ({constraint_tvars: __rec_upd_3615.constraint_tvars, current_eff: __rec_upd_3615.current_eff, current_module: __rec_upd_3615.current_module, inside_handler: __rec_upd_3615.inside_handler, loop_info: __rec_upd_3615.loop_info, mutable_vars: List$filter(_t3617, ctx.mutable_vars), return_type: __rec_upd_3615.return_type, return_used: __rec_upd_3615.return_used, type_env: __rec_upd_3615.type_env, vars: ({_hd: [name, scheme], _tl: ctx.vars})});
  return _t3616;
}
function Typechecker$extend_var_mono(ctx, name, ty) {
  return Typechecker$extend_var(ctx, name, Types$mono(ty));
}
function Typechecker$extend_var_mutable(ctx, name, scheme) {
  const __rec_upd_3618 = ctx;
  function _t3620(n) {
    return (n !== name);
  }
  const _t3619 = ({constraint_tvars: __rec_upd_3618.constraint_tvars, current_eff: __rec_upd_3618.current_eff, current_module: __rec_upd_3618.current_module, inside_handler: __rec_upd_3618.inside_handler, loop_info: __rec_upd_3618.loop_info, mutable_vars: ({_hd: name, _tl: List$filter(_t3620, ctx.mutable_vars)}), return_type: __rec_upd_3618.return_type, return_used: __rec_upd_3618.return_used, type_env: __rec_upd_3618.type_env, vars: ({_hd: [name, scheme], _tl: ctx.vars})});
  return _t3619;
}
function Typechecker$resolve_type_alias(type_env, name) {
  let _t3622;
  const _t3621 = List$assoc_opt(name, type_env.type_aliases);
  _t3623: {
    if (_t3621._tag === 1) {
      const canonical = _t3621._val;
      _t3622 = canonical;
      break _t3623;
    }
    if (_t3621._tag === 0) {
      _t3622 = name;
      break _t3623;
    }
    _match_fail("line 16190");
  }
  return _t3622;
}
function Typechecker$find_variant_info(type_env, name) {
  const name_3624 = Typechecker$resolve_type_alias(type_env, name);
  function _t3626(__p36) {
    let _t3628;
    const _t3627 = __p36;
    _t3629: {
      if (true) {
        const n = _t3627[0];
        _t3628 = (n === name_3624);
        break _t3629;
      }
      _match_fail("line 16190");
    }
    return _t3628;
  }
  const _t3625 = List$find(_t3626, type_env.variants);
  return _t3625;
}
function Typechecker$subst_tgens(inst_tys, ty) {
  const arr_3630 = Array$of_list(inst_tys);
  function go(__x) {
    let _t3633;
    const _t3632 = __x;
    _t3634: {
      if (_t3632._tag === 17) {
        const i = _t3632._val;
        if ((i < Array$length(arr_3630))) {
          _t3633 = Array$get(arr_3630, i);
          break _t3634;
        }
      }
      if (_t3632._tag === 7) {
        const a = _t3632._val[0];
        const eff = _t3632._val[1];
        const b = _t3632._val[2];
        _t3633 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(b)]});
        break _t3634;
      }
      if (_t3632._tag === 8) {
        const a = _t3632._val[0];
        const eff = _t3632._val[1];
        const b = _t3632._val[2];
        _t3633 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(b)]});
        break _t3634;
      }
      if (_t3632._tag === 9) {
        const ts = _t3632._val;
        _t3633 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
        break _t3634;
      }
      if (_t3632._tag === 10) {
        const t = _t3632._val;
        _t3633 = ({_tag: 10, _name: "TList", _val: go(t)});
        break _t3634;
      }
      if (_t3632._tag === 14) {
        const t = _t3632._val;
        _t3633 = ({_tag: 14, _name: "TArray", _val: go(t)});
        break _t3634;
      }
      if (_t3632._tag === 11) {
        const row = _t3632._val;
        _t3633 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
        break _t3634;
      }
      if (_t3632._tag === 12) {
        const name = _t3632._val[0];
        const args = _t3632._val[1];
        _t3633 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
        break _t3634;
      }
      if (_t3632._tag === 15) {
        const row = _t3632._val;
        _t3633 = ({_tag: 15, _name: "TPolyVariant", _val: go_pv(row)});
        break _t3634;
      }
      if (_t3632._tag === 13) {
        const k = _t3632._val[0];
        const v = _t3632._val[1];
        _t3633 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
        break _t3634;
      }
      if (true) {
        const t = _t3632;
        _t3633 = t;
        break _t3634;
      }
      _match_fail("line 16190");
    }
    return _t3633;
  }
  function go_eff(__x) {
    let _t3636;
    const _t3635 = __x;
    _t3637: {
      if (_t3635._tag === 2) {
        const label = _t3635._val[0];
        const params = _t3635._val[1];
        const tail = _t3635._val[2];
        _t3636 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
        break _t3637;
      }
      if (true) {
        const e = _t3635;
        _t3636 = e;
        break _t3637;
      }
      _match_fail("line 16190");
    }
    return _t3636;
  }
  function go_pv(__x) {
    let _t3639;
    const _t3638 = __x;
    _t3640: {
      if (_t3638._tag === 0) {
        const tag = _t3638._val[0];
        const ty_opt = _t3638._val[1];
        const tail = _t3638._val[2];
        _t3639 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
        break _t3640;
      }
      if (true) {
        const r = _t3638;
        _t3639 = r;
        break _t3640;
      }
      _match_fail("line 16190");
    }
    return _t3639;
  }
  function go_rrow(__x) {
    let _t3642;
    const _t3641 = __x;
    _t3643: {
      if (_t3641._tag === 0) {
        const name = _t3641._val[0];
        const ty = _t3641._val[1];
        const tail = _t3641._val[2];
        _t3642 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
        break _t3643;
      }
      if (true) {
        const r = _t3641;
        _t3642 = r;
        break _t3643;
      }
      _match_fail("line 16190");
    }
    return _t3642;
  }
  const _t3644 = go(ty);
  const _t3631 = _t3644;
  return _t3631;
}
function Typechecker$freshen_arrow_effects(level, ty) {
  function go(__x) {
    let _t3646;
    const _t3645 = __x;
    _t3647: {
      if (_t3645._tag === 7) {
        const a = _t3645._val[0];
        const eff = _t3645._val[1];
        const b = _t3645._val[2];
        let _t3649;
        const _t3648 = eff;
        _t3650: {
          if (_t3648._tag === 1) {
            _t3649 = Types$new_effvar(level);
            break _t3650;
          }
          if (true) {
            const e = _t3648;
            _t3649 = e;
            break _t3650;
          }
          _match_fail("line 16190");
        }
        const eff$p_3651 = _t3649;
        const _t3652 = ({_tag: 7, _name: "TArrow", _val: [go(a), eff$p_3651, go(b)]});
        _t3646 = _t3652;
        break _t3647;
      }
      if (_t3645._tag === 8) {
        const a = _t3645._val[0];
        const eff = _t3645._val[1];
        const b = _t3645._val[2];
        let _t3654;
        const _t3653 = eff;
        _t3655: {
          if (_t3653._tag === 1) {
            _t3654 = Types$new_effvar(level);
            break _t3655;
          }
          if (true) {
            const e = _t3653;
            _t3654 = e;
            break _t3655;
          }
          _match_fail("line 16190");
        }
        const eff$p_3656 = _t3654;
        const _t3657 = ({_tag: 8, _name: "TCont", _val: [go(a), eff$p_3656, go(b)]});
        _t3646 = _t3657;
        break _t3647;
      }
      if (_t3645._tag === 9) {
        const ts = _t3645._val;
        _t3646 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
        break _t3647;
      }
      if (_t3645._tag === 10) {
        const t = _t3645._val;
        _t3646 = ({_tag: 10, _name: "TList", _val: go(t)});
        break _t3647;
      }
      if (_t3645._tag === 14) {
        const t = _t3645._val;
        _t3646 = ({_tag: 14, _name: "TArray", _val: go(t)});
        break _t3647;
      }
      if (_t3645._tag === 11) {
        const row = _t3645._val;
        _t3646 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
        break _t3647;
      }
      if (_t3645._tag === 12) {
        const name = _t3645._val[0];
        const args = _t3645._val[1];
        _t3646 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
        break _t3647;
      }
      if (_t3645._tag === 15) {
        const row = _t3645._val;
        _t3646 = ({_tag: 15, _name: "TPolyVariant", _val: go_pv(row)});
        break _t3647;
      }
      if (_t3645._tag === 13) {
        const k = _t3645._val[0];
        const v = _t3645._val[1];
        _t3646 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
        break _t3647;
      }
      if (true) {
        const t = _t3645;
        _t3646 = t;
        break _t3647;
      }
      _match_fail("line 16190");
    }
    return _t3646;
  }
  function go_pv(__x) {
    let _t3659;
    const _t3658 = __x;
    _t3660: {
      if (_t3658._tag === 0) {
        const tag = _t3658._val[0];
        const ty_opt = _t3658._val[1];
        const tail = _t3658._val[2];
        _t3659 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
        break _t3660;
      }
      if (true) {
        const r = _t3658;
        _t3659 = r;
        break _t3660;
      }
      _match_fail("line 16190");
    }
    return _t3659;
  }
  function go_rrow(__x) {
    let _t3662;
    const _t3661 = __x;
    _t3663: {
      if (_t3661._tag === 0) {
        const name = _t3661._val[0];
        const ty = _t3661._val[1];
        const tail = _t3661._val[2];
        _t3662 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
        break _t3663;
      }
      if (true) {
        const r = _t3661;
        _t3662 = r;
        break _t3663;
      }
      _match_fail("line 16190");
    }
    return _t3662;
  }
  const _t3664 = go(ty);
  return _t3664;
}
function Typechecker$freshen_tvars(level, ty) {
  const mapping_3665 = Hashtbl$create(4);
  function go(__x) {
    while (true) {
      let _t3668;
      const _t3667 = __x;
      _t3669: {
        if (_t3667._tag === 16 && _t3667._val.contents._tag === 0) {
          const id = _t3667._val.contents._val[0];
          let _t3671;
          const _t3670 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, mapping_3665, id]);
          _t3672: {
            if (_t3670._tag === 1) {
              const fresh = _t3670._val;
              _t3671 = fresh;
              break _t3672;
            }
            if (_t3670._tag === 0) {
              const fresh_3673 = Types$new_tvar(level);
              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, mapping_3665, id, fresh_3673]);
              const _t3674 = fresh_3673;
              _t3671 = _t3674;
              break _t3672;
            }
            _match_fail("line 16190");
          }
          _t3668 = _t3671;
          break _t3669;
        }
        if (_t3667._tag === 16 && _t3667._val.contents._tag === 1) {
          const t = _t3667._val.contents._val;
          const _t3675 = t;
          __x = _t3675;
          continue;
          _t3668 = undefined;
          break _t3669;
        }
        if (_t3667._tag === 7) {
          const a = _t3667._val[0];
          const eff = _t3667._val[1];
          const b = _t3667._val[2];
          _t3668 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(b)]});
          break _t3669;
        }
        if (_t3667._tag === 8) {
          const a = _t3667._val[0];
          const eff = _t3667._val[1];
          const b = _t3667._val[2];
          _t3668 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(b)]});
          break _t3669;
        }
        if (_t3667._tag === 9) {
          const ts = _t3667._val;
          _t3668 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t3669;
        }
        if (_t3667._tag === 10) {
          const t = _t3667._val;
          _t3668 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t3669;
        }
        if (_t3667._tag === 14) {
          const t = _t3667._val;
          _t3668 = ({_tag: 14, _name: "TArray", _val: go(t)});
          break _t3669;
        }
        if (_t3667._tag === 11) {
          const row = _t3667._val;
          _t3668 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
          break _t3669;
        }
        if (_t3667._tag === 12) {
          const name = _t3667._val[0];
          const args = _t3667._val[1];
          _t3668 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
          break _t3669;
        }
        if (_t3667._tag === 15) {
          const row = _t3667._val;
          _t3668 = ({_tag: 15, _name: "TPolyVariant", _val: go_pv(row)});
          break _t3669;
        }
        if (_t3667._tag === 13) {
          const k = _t3667._val[0];
          const v = _t3667._val[1];
          _t3668 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
          break _t3669;
        }
        if (true) {
          const t = _t3667;
          _t3668 = t;
          break _t3669;
        }
        _match_fail("line 16190");
      }
      return _t3668;
    }
  }
  function go_eff(__x) {
    while (true) {
      let _t3677;
      const _t3676 = __x;
      _t3678: {
        if (_t3676._tag === 0 && _t3676._val.contents._tag === 0) {
          const e = _t3676;
          _t3677 = e;
          break _t3678;
        }
        if (_t3676._tag === 0 && _t3676._val.contents._tag === 1) {
          const e = _t3676._val.contents._val;
          const _t3679 = e;
          __x = _t3679;
          continue;
          _t3677 = undefined;
          break _t3678;
        }
        if (_t3676._tag === 2) {
          const label = _t3676._val[0];
          const params = _t3676._val[1];
          const tail = _t3676._val[2];
          _t3677 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
          break _t3678;
        }
        if (true) {
          const e = _t3676;
          _t3677 = e;
          break _t3678;
        }
        _match_fail("line 16190");
      }
      return _t3677;
    }
  }
  function go_pv(__x) {
    let _t3681;
    const _t3680 = __x;
    _t3682: {
      if (_t3680._tag === 0) {
        const tag = _t3680._val[0];
        const ty_opt = _t3680._val[1];
        const tail = _t3680._val[2];
        _t3681 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
        break _t3682;
      }
      if (true) {
        const r = _t3680;
        _t3681 = r;
        break _t3682;
      }
      _match_fail("line 16190");
    }
    return _t3681;
  }
  function go_rrow(__x) {
    while (true) {
      let _t3684;
      const _t3683 = __x;
      _t3685: {
        if (_t3683._tag === 0) {
          const name = _t3683._val[0];
          const ty = _t3683._val[1];
          const tail = _t3683._val[2];
          _t3684 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
          break _t3685;
        }
        if (_t3683._tag === 1 && _t3683._val.contents._tag === 0) {
          _t3684 = Types$new_rvar(level);
          break _t3685;
        }
        if (_t3683._tag === 1 && _t3683._val.contents._tag === 1) {
          const r = _t3683._val.contents._val;
          const _t3686 = r;
          __x = _t3686;
          continue;
          _t3684 = undefined;
          break _t3685;
        }
        if (true) {
          const r = _t3683;
          _t3684 = r;
          break _t3685;
        }
        _match_fail("line 16190");
      }
      return _t3684;
    }
  }
  const _t3687 = go(ty);
  const _t3666 = _t3687;
  return _t3666;
}
function Typechecker$resolve_ty_annot_shared(ctx, level, tvars, annot) {
  function go(__x) {
    while (true) {
      let _t3689;
      const _t3688 = __x;
      _t3690: {
        if (_t3688._tag === 1) {
          const name = _t3688._val;
          let _t3692;
          const _t3691 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars, name]);
          _t3693: {
            if (_t3691._tag === 1) {
              const tv = _t3691._val;
              _t3692 = tv;
              break _t3693;
            }
            if (_t3691._tag === 0) {
              const tv_3694 = Types$new_tvar(level);
              _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars, name, tv_3694]);
              const _t3695 = tv_3694;
              _t3692 = _t3695;
              break _t3693;
            }
            _match_fail("line 16190");
          }
          _t3689 = _t3692;
          break _t3690;
        }
        if (_t3688._tag === 0 && _t3688._val === "int") {
          _t3689 = ({_tag: 0, _name: "TInt"});
          break _t3690;
        }
        if (_t3688._tag === 0 && _t3688._val === "float") {
          _t3689 = ({_tag: 1, _name: "TFloat"});
          break _t3690;
        }
        if (_t3688._tag === 0 && _t3688._val === "bool") {
          _t3689 = ({_tag: 2, _name: "TBool"});
          break _t3690;
        }
        if (_t3688._tag === 0 && _t3688._val === "string") {
          _t3689 = ({_tag: 3, _name: "TString"});
          break _t3690;
        }
        if (_t3688._tag === 0 && _t3688._val === "byte") {
          _t3689 = ({_tag: 4, _name: "TByte"});
          break _t3690;
        }
        if (_t3688._tag === 0 && _t3688._val === "rune") {
          _t3689 = ({_tag: 5, _name: "TRune"});
          break _t3690;
        }
        if (_t3688._tag === 0 && _t3688._val === "unit") {
          _t3689 = ({_tag: 6, _name: "TUnit"});
          break _t3690;
        }
        if (_t3688._tag === 0) {
          const name = _t3688._val;
          const canonical_3696 = Typechecker$resolve_type_alias(ctx.type_env, name);
          function _t3698(__p37) {
            let _t3700;
            const _t3699 = __p37;
            _t3701: {
              if (true) {
                const n = _t3699[0];
                _t3700 = (n === canonical_3696);
                break _t3701;
              }
              _match_fail("line 16190");
            }
            return _t3700;
          }
          let _t3703;
          const _t3702 = List$find(_t3698, ctx.type_env.type_synonyms);
          _t3704: {
            if (_t3702._tag === 1 && _t3702._val[1] === 0) {
              const ty = _t3702._val[2];
              _t3703 = Typechecker$freshen_tvars(level, Typechecker$freshen_arrow_effects(level, ty));
              break _t3704;
            }
            if (_t3702._tag === 1) {
              const n = _t3702._val[1];
              _t3703 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
              break _t3704;
            }
            if (_t3702._tag === 0) {
              let _t3706;
              const _t3705 = Typechecker$find_variant_info(ctx.type_env, name);
              _t3707: {
                if (_t3705._tag === 1 && _t3705._val[1] === 0) {
                  _t3706 = ({_tag: 12, _name: "TVariant", _val: [canonical_3696, null]});
                  break _t3707;
                }
                if (_t3705._tag === 1) {
                  const n = _t3705._val[1];
                  _t3706 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                  break _t3707;
                }
                if (_t3705._tag === 0) {
                  let _t3708;
                  if (!_eq(List$assoc_opt(canonical_3696, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                    const fields_3709 = List$assoc(canonical_3696, ctx.type_env.records);
                    let _t3711;
                    if (_eq(fields_3709, null)) {
                      _t3711 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                    } else {
                      _t3711 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_3709)});
                    }
                    const _t3710 = _t3711;
                    _t3708 = _t3710;
                  } else {
                    _t3708 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                  }
                  _t3706 = _t3708;
                  break _t3707;
                }
                _match_fail("line 16190");
              }
              _t3703 = _t3706;
              break _t3704;
            }
            _match_fail("line 16190");
          }
          const _t3697 = _t3703;
          _t3689 = _t3697;
          break _t3690;
        }
        if (_t3688._tag === 2) {
          const a = _t3688._val[0];
          const b = _t3688._val[1];
          const eff_opt = _t3688._val[2];
          let _t3713;
          const _t3712 = eff_opt;
          _t3714: {
            if (_t3712._tag === 0) {
              _t3713 = Types$new_effvar(level);
              break _t3714;
            }
            if (_t3712._tag === 1 && _t3712._val._tag === 0) {
              _t3713 = ({_tag: 1, _name: "EffEmpty"});
              break _t3714;
            }
            if (_t3712._tag === 1 && _t3712._val._tag === 1) {
              const items = _t3712._val._val;
              _t3713 = Typechecker$resolve_eff_items(ctx, level, tvars, items);
              break _t3714;
            }
            _match_fail("line 16190");
          }
          const eff_3715 = _t3713;
          const _t3716 = ({_tag: 7, _name: "TArrow", _val: [go(a), eff_3715, go(b)]});
          _t3689 = _t3716;
          break _t3690;
        }
        if (_t3688._tag === 6) {
          const ts = _t3688._val;
          _t3689 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t3690;
        }
        if (_t3688._tag === 4) {
          const t = _t3688._val;
          _t3689 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t3690;
        }
        if (_t3688._tag === 5) {
          const t = _t3688._val;
          _t3689 = ({_tag: 14, _name: "TArray", _val: go(t)});
          break _t3690;
        }
        if (_t3688._tag === 8) {
          const k = _t3688._val[0];
          const v = _t3688._val[1];
          _t3689 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
          break _t3690;
        }
        if (_t3688._tag === 7) {
          const args = _t3688._val[0];
          const name = _t3688._val[1];
          const canonical_3717 = Typechecker$resolve_type_alias(ctx.type_env, name);
          const arg_tys_3719 = List$map(go, args);
          function _t3721(__p38) {
            let _t3723;
            const _t3722 = __p38;
            _t3724: {
              if (true) {
                const n = _t3722[0];
                _t3723 = (n === canonical_3717);
                break _t3724;
              }
              _match_fail("line 16190");
            }
            return _t3723;
          }
          let _t3726;
          const _t3725 = List$find(_t3721, ctx.type_env.type_synonyms);
          _t3727: {
            if (_t3725._tag === 1) {
              const np = _t3725._val[1];
              const ty = _t3725._val[2];
              let _t3728;
              if ((List$length(arg_tys_3719) !== np)) {
                _t3728 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_3719))));
              } else {
                _t3728 = undefined;
              }
              _t3728;
              _t3726 = Typechecker$freshen_tvars(level, Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(arg_tys_3719, ty)));
              break _t3727;
            }
            if (_t3725._tag === 0) {
              let _t3730;
              const _t3729 = Typechecker$find_variant_info(ctx.type_env, name);
              _t3731: {
                if (_t3729._tag === 1) {
                  const np = _t3729._val[1];
                  let _t3732;
                  if ((List$length(arg_tys_3719) !== np)) {
                    _t3732 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_3719))));
                  } else {
                    _t3732 = undefined;
                  }
                  _t3732;
                  _t3730 = ({_tag: 12, _name: "TVariant", _val: [canonical_3717, arg_tys_3719]});
                  break _t3731;
                }
                if (_t3729._tag === 0) {
                  _t3730 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
                  break _t3731;
                }
                _match_fail("line 16190");
              }
              _t3726 = _t3730;
              break _t3727;
            }
            _match_fail("line 16190");
          }
          const _t3720 = _t3726;
          const _t3718 = _t3720;
          _t3689 = _t3718;
          break _t3690;
        }
        if (_t3688._tag === 3) {
          const fields = _t3688._val[0];
          const is_open = _t3688._val[1];
          function _t3733(__p39) {
            let _t3735;
            const _t3734 = __p39;
            _t3736: {
              if (true) {
                const n = _t3734[0];
                const t = _t3734[1];
                _t3735 = [n, go(t)];
                break _t3736;
              }
              _match_fail("line 16190");
            }
            return _t3735;
          }
          const fields_3737 = List$map(_t3733, fields);
          function _t3739(__p40, __p41) {
            let _t3741;
            const _t3740 = __p40;
            _t3742: {
              if (true) {
                const a = _t3740[0];
                let _t3744;
                const _t3743 = __p41;
                _t3745: {
                  if (true) {
                    const b = _t3743[0];
                    _t3744 = String$compare(a, b);
                    break _t3745;
                  }
                  _match_fail("line 16190");
                }
                _t3741 = _t3744;
                break _t3742;
              }
              _match_fail("line 16190");
            }
            return _t3741;
          }
          const fields_3746 = List$sort(_t3739, fields_3737);
          let _t3748;
          if (is_open) {
            _t3748 = Types$new_rvar(level);
          } else {
            _t3748 = ({_tag: 2, _name: "REmpty"});
          }
          const tail_3749 = _t3748;
          function _t3751(__p42, acc) {
            let _t3753;
            const _t3752 = __p42;
            _t3754: {
              if (true) {
                const n = _t3752[0];
                const t = _t3752[1];
                _t3753 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                break _t3754;
              }
              _match_fail("line 16190");
            }
            return _t3753;
          }
          const _t3750 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t3751, fields_3746, tail_3749)});
          const _t3747 = _t3750;
          const _t3738 = _t3747;
          _t3689 = _t3738;
          break _t3690;
        }
        if (_t3688._tag === 9) {
          const path = _t3688._val[0];
          const name = _t3688._val[1];
          const qualified_3755 = (String$concat(".", path) + ("." + name));
          const _t3757 = ({_tag: 0, _name: "TyName", _val: qualified_3755});
          __x = _t3757;
          continue;
          const _t3756 = undefined;
          _t3689 = _t3756;
          break _t3690;
        }
        if (_t3688._tag === 10) {
          const kind = _t3688._val[0];
          const tags = _t3688._val[1];
          let _t3759;
          const _t3758 = kind;
          _t3760: {
            if ((_t3758._tag === 0 || _t3758._tag === 2)) {
              _t3759 = ({_tag: 2, _name: "PVEmpty"});
              break _t3760;
            }
            if (_t3758._tag === 1) {
              _t3759 = Types$new_pvvar(level);
              break _t3760;
            }
            _match_fail("line 16190");
          }
          const tail_3761 = _t3759;
          function _t3763(__p43, acc) {
            let _t3765;
            const _t3764 = __p43;
            _t3766: {
              if (true) {
                const tag = _t3764[0];
                const payload_annot = _t3764[1];
                _t3765 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload_annot), acc]});
                break _t3766;
              }
              _match_fail("line 16190");
            }
            return _t3765;
          }
          const row_3767 = List$fold_right(_t3763, tags, tail_3761);
          const _t3768 = ({_tag: 15, _name: "TPolyVariant", _val: row_3767});
          const _t3762 = _t3768;
          _t3689 = _t3762;
          break _t3690;
        }
        if (_t3688._tag === 11) {
          const ty = _t3688._val[0];
          const _eff = _t3688._val[1];
          const _t3769 = ty;
          __x = _t3769;
          continue;
          _t3689 = undefined;
          break _t3690;
        }
        _match_fail("line 16190");
      }
      return _t3689;
    }
  }
  const _t3770 = go(annot);
  return _t3770;
}
function Typechecker$resolve_eff_items(ctx, level, tvars, items) {
  const labels_3771 = Ref$create(null);
  const row_var_3773 = Ref$create(({_tag: 0, _name: "None"}));
  function _t3775(item) {
    let _t3777;
    const _t3776 = item;
    _t3778: {
      if (_t3776._tag === 0) {
        const name = _t3776._val[0];
        const param_annots = _t3776._val[1];
        let _t3779;
        if (!_eq(Ref$get(row_var_3773), ({_tag: 0, _name: "None"}))) {
          _t3779 = Typechecker$error("effect labels must come before row variable");
        } else {
          _t3779 = undefined;
        }
        _t3779;
        function _t3780(e) {
          return (e.effect_name === name);
        }
        let _t3782;
        const _t3781 = List$find(_t3780, ctx.type_env.effects);
        _t3783: {
          if (_t3781._tag === 1) {
            const e = _t3781._val;
            _t3782 = e;
            break _t3783;
          }
          if (_t3781._tag === 0) {
            _t3782 = Typechecker$error(("unknown effect: " + __dict_Show_string.show(name)));
            break _t3783;
          }
          _match_fail("line 16190");
        }
        const edef_3784 = _t3782;
        const expected_params_3786 = List$length(edef_3784.effect_params);
        const actual_params_3788 = List$length(param_annots);
        let _t3790;
        if ((expected_params_3786 !== actual_params_3788)) {
          _t3790 = Typechecker$error(((((("effect " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(expected_params_3786)) + " type parameter(s), got ") + __dict_Show_int.show(actual_params_3788)));
        } else {
          _t3790 = undefined;
        }
        _t3790;
        const _t3789 = Ref$set(labels_3771, ({_hd: [name, param_annots], _tl: Ref$get(labels_3771)}));
        const _t3787 = _t3789;
        const _t3785 = _t3787;
        _t3777 = _t3785;
        break _t3778;
      }
      if (_t3776._tag === 1) {
        const name = _t3776._val;
        let _t3791;
        if (!_eq(Ref$get(row_var_3773), ({_tag: 0, _name: "None"}))) {
          _t3791 = Typechecker$error("at most one effect row variable allowed");
        } else {
          _t3791 = undefined;
        }
        _t3791;
        _t3777 = Ref$set(row_var_3773, ({_tag: 1, _name: "Some", _val: name}));
        break _t3778;
      }
      _match_fail("line 16190");
    }
    return _t3777;
  }
  List$iter(_t3775, items);
  const labels_3792 = List$rev(Ref$get(labels_3771));
  let _t3795;
  const _t3794 = Ref$get(row_var_3773);
  _t3796: {
    if (_t3794._tag === 0) {
      _t3795 = Types$new_effvar(level);
      break _t3796;
    }
    if (_t3794._tag === 1) {
      const _name = _t3794._val;
      _t3795 = Types$new_effvar(level);
      break _t3796;
    }
    _match_fail("line 16190");
  }
  const tail_3797 = _t3795;
  function _t3799(__p44, acc) {
    let _t3801;
    const _t3800 = __p44;
    _t3802: {
      if (true) {
        const name = _t3800[0];
        const param_annots = _t3800[1];
        const resolved_params_3803 = List$map(_call(Typechecker$resolve_ty_annot_shared, [ctx, level, tvars]), param_annots);
        const _t3804 = ({_tag: 2, _name: "EffRow", _val: [name, resolved_params_3803, acc]});
        _t3801 = _t3804;
        break _t3802;
      }
      _match_fail("line 16190");
    }
    return _t3801;
  }
  const _t3798 = List$fold_right(_t3799, labels_3792, tail_3797);
  const _t3793 = _t3798;
  const _t3774 = _t3793;
  const _t3772 = _t3774;
  return _t3772;
}
function Typechecker$resolve_ty_annot(ctx, level, annot) {
  const tvars_3805 = Hashtbl$create(4);
  const _t3806 = Typechecker$resolve_ty_annot_shared(ctx, level, tvars_3805, annot);
  return _t3806;
}
function Typechecker$instantiate_record_fields(level, fields) {
  function _t3807(acc, __p45) {
    let _t3809;
    const _t3808 = __p45;
    _t3810: {
      if (true) {
        const ty = _t3808[1];
        _t3809 = max(acc, Typechecker$max_tgen_in_ty(ty));
        break _t3810;
      }
      _match_fail("line 16190");
    }
    return _t3809;
  }
  const max_gen_3811 = List$fold(_t3807, (-1), fields);
  let _t3813;
  if ((max_gen_3811 < 0)) {
    _t3813 = fields;
  } else {
    function _t3814(_) {
      return Types$new_tvar(level);
    }
    const fresh_3815 = List$init((max_gen_3811 + 1), _t3814);
    function _t3817(__p46) {
      let _t3819;
      const _t3818 = __p46;
      _t3820: {
        if (true) {
          const n = _t3818[0];
          const ty = _t3818[1];
          _t3819 = [n, Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(fresh_3815, ty))];
          break _t3820;
        }
        _match_fail("line 16190");
      }
      return _t3819;
    }
    const _t3816 = List$map(_t3817, fields);
    _t3813 = _t3816;
  }
  const _t3812 = _t3813;
  return _t3812;
}
function Typechecker$instantiate_record_row(level, fields) {
  const fields_3821 = Typechecker$instantiate_record_fields(level, fields);
  const _t3822 = Types$fields_to_closed_row(fields_3821);
  return _t3822;
}
function _t3823(_, __2) {
  return failwith("find_module_in_env not yet initialized");
}
const Typechecker$find_module_in_env_ref = Ref$create(_t3823);
function _t3824(_, __2, __3) {
  return failwith("open_module_into_ctx not yet initialized");
}
const Typechecker$open_module_into_ctx_ref = Ref$create(_t3824);
function _t3825(_, __2, __3) {
  return undefined;
}
const Typechecker$exhaustiveness_check_ref = Ref$create(_t3825);
function Typechecker$mk(te, ty) {
  return ({expr: te, loc: Ref$get(Typechecker$current_loc), ty: ty});
}
function Typechecker$extract_fn_info(expr) {
  while (true) {
    let _t3827;
    const _t3826 = expr;
    _t3828: {
      if (_t3826._tag === 49) {
        const inner = _t3826._val[1];
        const _t3829 = inner;
        expr = _t3829;
        continue;
        _t3827 = undefined;
        break _t3828;
      }
      if (_t3826._tag === 30) {
        const inner = _t3826._val[0];
        let _t3831;
        const _t3830 = inner;
        _t3832: {
          if ((_t3830._tag === 10 || _t3830._tag === 49 && _t3830._val[1]._tag === 10)) {
            _t3831 = true;
            break _t3832;
          }
          if (true) {
            _t3831 = false;
            break _t3832;
          }
          _match_fail("line 16190");
        }
        if (_t3831) {
          const _t3833 = inner;
          expr = _t3833;
          continue;
          _t3827 = undefined;
          break _t3828;
        }
      }
      if (_t3826._tag === 10) {
        const param = _t3826._val[0];
        const body = _t3826._val[1];
        let _t3835;
        const _t3834 = Typechecker$extract_fn_info(body);
        _t3836: {
          if (true) {
            const params = _t3834[0];
            const ret = _t3834[1];
            const inner = _t3834[2];
            _t3835 = [({_hd: param, _tl: params}), ret, inner];
            break _t3836;
          }
          _match_fail("line 16190");
        }
        _t3827 = _t3835;
        break _t3828;
      }
      if (_t3826._tag === 30) {
        const inner = _t3826._val[0];
        const annot = _t3826._val[1];
        _t3827 = [null, ({_tag: 1, _name: "Some", _val: annot}), inner];
        break _t3828;
      }
      if (true) {
        _t3827 = [null, ({_tag: 0, _name: "None"}), expr];
        break _t3828;
      }
      _match_fail("line 16190");
    }
    return _t3827;
  }
}
function Typechecker$resolve_module_name(ctx, name) {
  let _t3838;
  const _t3837 = ctx.current_module;
  _t3839: {
    if (_t3837._tag === 1) {
      const prefix = _t3837._val;
      function try_prefix(p) {
        while (true) {
          const qualified_3840 = (p + name);
          function _t3842(__p47) {
            let _t3844;
            const _t3843 = __p47;
            _t3845: {
              if (true) {
                const n = _t3843[0];
                _t3844 = (n === qualified_3840);
                break _t3845;
              }
              _match_fail("line 16190");
            }
            return _t3844;
          }
          let _t3846;
          if (List$exists(_t3842, ctx.vars)) {
            _t3846 = qualified_3840;
          } else {
            const p$p_3847 = String$sub(p, 0, max(0, (String$length(p) - 1)));
            let _t3850;
            const _t3849 = String$rindex_opt(p$p_3847, 46);
            _t3851: {
              if (_t3849._tag === 1) {
                const idx = _t3849._val;
                const _t3852 = String$sub(p$p_3847, 0, (idx + 1));
                p = _t3852;
                continue;
                _t3850 = undefined;
                break _t3851;
              }
              if (_t3849._tag === 0) {
                _t3850 = name;
                break _t3851;
              }
              _match_fail("line 16190");
            }
            const _t3848 = _t3850;
            _t3846 = _t3848;
          }
          const _t3841 = _t3846;
          return _t3841;
        }
      }
      const _t3853 = try_prefix(prefix);
      _t3838 = _t3853;
      break _t3839;
    }
    if (_t3837._tag === 0) {
      _t3838 = name;
      break _t3839;
    }
    _match_fail("line 16190");
  }
  return _t3838;
}
function Typechecker$find_var_type_in(target_name, te) {
  const result_3854 = Ref$create(({_tag: 0, _name: "None"}));
  function go(te) {
    while (true) {
      let _t3856;
      if (Option$is_some(Ref$get(result_3854))) {
        _t3856 = undefined;
      } else {
        let _t3858;
        const _t3857 = te.expr;
        _t3859: {
          if (_t3857._tag === 7) {
            const n = _t3857._val;
            if ((n === target_name)) {
              _t3858 = Ref$set(result_3854, ({_tag: 1, _name: "Some", _val: te.ty}));
              break _t3859;
            }
          }
          if ((((((((((_t3857._tag === 7 || _t3857._tag === 0) || _t3857._tag === 1) || _t3857._tag === 2) || _t3857._tag === 3) || _t3857._tag === 4) || _t3857._tag === 5) || _t3857._tag === 6) || _t3857._tag === 22) || _t3857._tag === 34)) {
            _t3858 = undefined;
            break _t3859;
          }
          if (_t3857._tag === 11) {
            const fn_ = _t3857._val[0];
            const arg = _t3857._val[1];
            go(fn_);
            const _t3860 = arg;
            te = _t3860;
            continue;
            _t3858 = undefined;
            break _t3859;
          }
          if (((((((((_t3857._tag === 10 || _t3857._tag === 14) || _t3857._tag === 19) || _t3857._tag === 33) || _t3857._tag === 35) || _t3857._tag === 36) || _t3857._tag === 40) || _t3857._tag === 26) || _t3857._tag === 29)) {
            const body = ((((((((_t3857._tag === 10 || _t3857._tag === 14) || _t3857._tag === 19) || _t3857._tag === 33) || _t3857._tag === 35) || _t3857._tag === 36) || _t3857._tag === 40) || _t3857._tag === 26) ? (((((((_t3857._tag === 10 || _t3857._tag === 14) || _t3857._tag === 19) || _t3857._tag === 33) || _t3857._tag === 35) || _t3857._tag === 36) || _t3857._tag === 40) ? ((((((_t3857._tag === 10 || _t3857._tag === 14) || _t3857._tag === 19) || _t3857._tag === 33) || _t3857._tag === 35) || _t3857._tag === 36) ? (((((_t3857._tag === 10 || _t3857._tag === 14) || _t3857._tag === 19) || _t3857._tag === 33) || _t3857._tag === 35) ? ((((_t3857._tag === 10 || _t3857._tag === 14) || _t3857._tag === 19) || _t3857._tag === 33) ? (((_t3857._tag === 10 || _t3857._tag === 14) || _t3857._tag === 19) ? ((_t3857._tag === 10 || _t3857._tag === 14) ? _t3857._val[1] : _t3857._val[0]) : _t3857._val) : _t3857._val) : _t3857._val) : _t3857._val) : _t3857._val[1]) : _t3857._val[1]);
            const _t3861 = body;
            te = _t3861;
            continue;
            _t3858 = undefined;
            break _t3859;
          }
          if ((((((((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) || _t3857._tag === 28) || _t3857._tag === 32) || _t3857._tag === 31) || _t3857._tag === 27) || _t3857._tag === 20)) {
            const e1 = (((((((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) || _t3857._tag === 28) || _t3857._tag === 32) || _t3857._tag === 31) || _t3857._tag === 27) ? ((((((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) || _t3857._tag === 28) || _t3857._tag === 32) || _t3857._tag === 31) ? (((((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) || _t3857._tag === 28) || _t3857._tag === 32) ? ((((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) || _t3857._tag === 28) ? (((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) ? ((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) ? (((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) ? ((_t3857._tag === 8 || _t3857._tag === 9) ? _t3857._val[2] : _t3857._val[1]) : _t3857._val[1]) : _t3857._val[0]) : _t3857._val[0]) : _t3857._val[0]) : _t3857._val[0]) : _t3857._val[0]) : _t3857._val[0]);
            const e2 = (((((((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) || _t3857._tag === 28) || _t3857._tag === 32) || _t3857._tag === 31) || _t3857._tag === 27) ? ((((((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) || _t3857._tag === 28) || _t3857._tag === 32) || _t3857._tag === 31) ? (((((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) || _t3857._tag === 28) || _t3857._tag === 32) ? ((((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) || _t3857._tag === 28) ? (((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) || _t3857._tag === 21) ? ((((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) || _t3857._tag === 13) ? (((_t3857._tag === 8 || _t3857._tag === 9) || _t3857._tag === 25) ? ((_t3857._tag === 8 || _t3857._tag === 9) ? _t3857._val[3] : _t3857._val[2]) : _t3857._val[2]) : _t3857._val[1]) : _t3857._val[1]) : _t3857._val[1]) : _t3857._val[1]) : _t3857._val[2]) : _t3857._val[1]);
            go(e1);
            const _t3862 = e2;
            te = _t3862;
            continue;
            _t3858 = undefined;
            break _t3859;
          }
          if (_t3857._tag === 12) {
            const c = _t3857._val[0];
            const t = _t3857._val[1];
            const e = _t3857._val[2];
            go(c);
            go(t);
            const _t3863 = e;
            te = _t3863;
            continue;
            _t3858 = undefined;
            break _t3859;
          }
          if ((_t3857._tag === 15 || _t3857._tag === 39)) {
            const es = _t3857._val;
            _t3858 = List$iter(go, es);
            break _t3859;
          }
          if (_t3857._tag === 38) {
            const kvs = _t3857._val;
            function _t3864(__p48) {
              let _t3866;
              const _t3865 = __p48;
              _t3867: {
                if (true) {
                  const k = _t3865[0];
                  const v = _t3865[1];
                  go(k);
                  _t3866 = go(v);
                  break _t3867;
                }
                _match_fail("line 16190");
              }
              return _t3866;
            }
            _t3858 = List$iter(_t3864, kvs);
            break _t3859;
          }
          if (_t3857._tag === 16) {
            const fields = _t3857._val;
            function _t3868(__p49) {
              let _t3870;
              const _t3869 = __p49;
              _t3871: {
                if (true) {
                  const e = _t3869[1];
                  _t3870 = go(e);
                  break _t3871;
                }
                _match_fail("line 16190");
              }
              return _t3870;
            }
            _t3858 = List$iter(_t3868, fields);
            break _t3859;
          }
          if (_t3857._tag === 17) {
            const base = _t3857._val[0];
            const overrides = _t3857._val[1];
            go(base);
            function _t3872(__p50) {
              let _t3874;
              const _t3873 = __p50;
              _t3875: {
                if (true) {
                  const e = _t3873[1];
                  _t3874 = go(e);
                  break _t3875;
                }
                _match_fail("line 16190");
              }
              return _t3874;
            }
            _t3858 = List$iter(_t3872, overrides);
            break _t3859;
          }
          if (_t3857._tag === 18) {
            const base = _t3857._val[0];
            const pairs = _t3857._val[1];
            go(base);
            function _t3876(__p51) {
              let _t3878;
              const _t3877 = __p51;
              _t3879: {
                if (true) {
                  const i = _t3877[0];
                  const v = _t3877[1];
                  go(i);
                  _t3878 = go(v);
                  break _t3879;
                }
                _match_fail("line 16190");
              }
              return _t3878;
            }
            _t3858 = List$iter(_t3876, pairs);
            break _t3859;
          }
          if (_t3857._tag === 23) {
            const arg = _t3857._val[1];
            _t3858 = Option$iter(go, arg);
            break _t3859;
          }
          if (_t3857._tag === 24) {
            const scr = _t3857._val[0];
            const arms = _t3857._val[1];
            go(scr);
            function _t3880(__p52) {
              let _t3882;
              const _t3881 = __p52;
              _t3883: {
                if (true) {
                  const g = _t3881[1];
                  const body = _t3881[2];
                  Option$iter(go, g);
                  _t3882 = go(body);
                  break _t3883;
                }
                _match_fail("line 16190");
              }
              return _t3882;
            }
            _t3858 = List$iter(_t3880, arms);
            break _t3859;
          }
          if (_t3857._tag === 30) {
            const body = _t3857._val[0];
            const arms = _t3857._val[1];
            go(body);
            function _t3884(arm) {
              let _t3886;
              const _t3885 = arm;
              _t3887: {
                if ((((_t3885._tag === 0 || _t3885._tag === 1) || _t3885._tag === 2) || _t3885._tag === 3)) {
                  const e = (((_t3885._tag === 0 || _t3885._tag === 1) || _t3885._tag === 2) ? ((_t3885._tag === 0 || _t3885._tag === 1) ? (_t3885._tag === 0 ? _t3885._val[1] : _t3885._val[3]) : _t3885._val[2]) : _t3885._val[2]);
                  _t3886 = go(e);
                  break _t3887;
                }
                _match_fail("line 16190");
              }
              return _t3886;
            }
            _t3858 = List$iter(_t3884, arms);
            break _t3859;
          }
          if (_t3857._tag === 37) {
            const bindings = _t3857._val[0];
            const body = _t3857._val[1];
            function _t3888(__p53) {
              let _t3890;
              const _t3889 = __p53;
              _t3891: {
                if (true) {
                  const e = _t3889[1];
                  _t3890 = go(e);
                  break _t3891;
                }
                _match_fail("line 16190");
              }
              return _t3890;
            }
            List$iter(_t3888, bindings);
            const _t3892 = body;
            te = _t3892;
            continue;
            _t3858 = undefined;
            break _t3859;
          }
          _match_fail("line 16190");
        }
        _t3856 = _t3858;
      }
      return _t3856;
    }
  }
  go(te);
  const _t3893 = Ref$get(result_3854);
  const _t3855 = _t3893;
  return _t3855;
}
function Typechecker$infer_implicit_constraints(binding_name, type_env, vars, te, scheme) {
  let _t3894;
  if ((!_eq(scheme.constraints, null) || (scheme.quant === 0))) {
    _t3894 = scheme;
  } else {
    const id_map_3895 = Hashtbl$create(8);
    function build_map(s, a) {
      while (true) {
        const a_3897 = Types$repr(a);
        let _t3900;
        const _t3899 = s;
        _t3901: {
          if (_t3899._tag === 17) {
            const i = _t3899._val;
            let _t3903;
            const _t3902 = a_3897;
            _t3904: {
              if (_t3902._tag === 16 && _t3902._val.contents._tag === 0) {
                const id = _t3902._val.contents._val[0];
                _t3903 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, id_map_3895, id, ({_tag: 17, _name: "TGen", _val: i})]);
                break _t3904;
              }
              if (true) {
                _t3903 = undefined;
                break _t3904;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3903;
            break _t3901;
          }
          if (_t3899._tag === 7) {
            const s1 = _t3899._val[0];
            const s2 = _t3899._val[2];
            let _t3906;
            const _t3905 = a_3897;
            _t3907: {
              if (_t3905._tag === 7) {
                const a1 = _t3905._val[0];
                const a2 = _t3905._val[2];
                build_map(s1, a1);
                const _t3908 = s2;
                const _t3909 = a2;
                s = _t3908;
                a = _t3909;
                continue;
                _t3906 = undefined;
                break _t3907;
              }
              if (true) {
                _t3906 = undefined;
                break _t3907;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3906;
            break _t3901;
          }
          if (_t3899._tag === 8) {
            const s1 = _t3899._val[0];
            const s2 = _t3899._val[2];
            let _t3911;
            const _t3910 = a_3897;
            _t3912: {
              if (_t3910._tag === 8) {
                const a1 = _t3910._val[0];
                const a2 = _t3910._val[2];
                build_map(s1, a1);
                const _t3913 = s2;
                const _t3914 = a2;
                s = _t3913;
                a = _t3914;
                continue;
                _t3911 = undefined;
                break _t3912;
              }
              if (true) {
                _t3911 = undefined;
                break _t3912;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3911;
            break _t3901;
          }
          if (_t3899._tag === 9) {
            const ss = _t3899._val;
            let _t3916;
            const _t3915 = a_3897;
            _t3917: {
              if (_t3915._tag === 9) {
                const aa = _t3915._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t3916 = List$iter2(build_map, ss, aa);
                  break _t3917;
                }
              }
              if (true) {
                _t3916 = undefined;
                break _t3917;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3916;
            break _t3901;
          }
          if (_t3899._tag === 10) {
            const s1 = _t3899._val;
            let _t3919;
            const _t3918 = a_3897;
            _t3920: {
              if (_t3918._tag === 10) {
                const a1 = _t3918._val;
                const _t3921 = s1;
                const _t3922 = a1;
                s = _t3921;
                a = _t3922;
                continue;
                _t3919 = undefined;
                break _t3920;
              }
              if (true) {
                _t3919 = undefined;
                break _t3920;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3919;
            break _t3901;
          }
          if (_t3899._tag === 14) {
            const s1 = _t3899._val;
            let _t3924;
            const _t3923 = a_3897;
            _t3925: {
              if (_t3923._tag === 14) {
                const a1 = _t3923._val;
                const _t3926 = s1;
                const _t3927 = a1;
                s = _t3926;
                a = _t3927;
                continue;
                _t3924 = undefined;
                break _t3925;
              }
              if (true) {
                _t3924 = undefined;
                break _t3925;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3924;
            break _t3901;
          }
          if (_t3899._tag === 13) {
            const sk = _t3899._val[0];
            const sv = _t3899._val[1];
            let _t3929;
            const _t3928 = a_3897;
            _t3930: {
              if (_t3928._tag === 13) {
                const ak = _t3928._val[0];
                const av = _t3928._val[1];
                build_map(sk, ak);
                const _t3931 = sv;
                const _t3932 = av;
                s = _t3931;
                a = _t3932;
                continue;
                _t3929 = undefined;
                break _t3930;
              }
              if (true) {
                _t3929 = undefined;
                break _t3930;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3929;
            break _t3901;
          }
          if (_t3899._tag === 12) {
            const ss = _t3899._val[1];
            let _t3934;
            const _t3933 = a_3897;
            _t3935: {
              if (_t3933._tag === 12) {
                const aa = _t3933._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t3934 = List$iter2(build_map, ss, aa);
                  break _t3935;
                }
              }
              if (true) {
                _t3934 = undefined;
                break _t3935;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3934;
            break _t3901;
          }
          if (_t3899._tag === 15) {
            const srow = _t3899._val;
            let _t3937;
            const _t3936 = a_3897;
            _t3938: {
              if (_t3936._tag === 15) {
                const arow = _t3936._val;
                _t3937 = build_map_pvrows(srow, arow);
                break _t3938;
              }
              if (true) {
                _t3937 = undefined;
                break _t3938;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3937;
            break _t3901;
          }
          if (_t3899._tag === 11) {
            const srow = _t3899._val;
            let _t3940;
            const _t3939 = a_3897;
            _t3941: {
              if (_t3939._tag === 11) {
                const arow = _t3939._val;
                _t3940 = build_map_rrows(srow, arow);
                break _t3941;
              }
              if (true) {
                _t3940 = undefined;
                break _t3941;
              }
              _match_fail("line 16190");
            }
            _t3900 = _t3940;
            break _t3901;
          }
          if (true) {
            _t3900 = undefined;
            break _t3901;
          }
          _match_fail("line 16190");
        }
        const _t3898 = _t3900;
        return _t3898;
      }
    }
    function build_map_rrows(srow, arow) {
      const sf_3942 = Types$record_row_to_fields(srow);
      const af_3944 = Types$record_row_to_fields(arow);
      let _t3946;
      if ((List$length(sf_3942) === List$length(af_3944))) {
        function _t3947(__p54, __p55) {
          let _t3949;
          const _t3948 = __p54;
          _t3950: {
            if (true) {
              const st = _t3948[1];
              let _t3952;
              const _t3951 = __p55;
              _t3953: {
                if (true) {
                  const at_ = _t3951[1];
                  _t3952 = build_map(st, at_);
                  break _t3953;
                }
                _match_fail("line 16190");
              }
              _t3949 = _t3952;
              break _t3950;
            }
            _match_fail("line 16190");
          }
          return _t3949;
        }
        _t3946 = List$iter2(_t3947, sf_3942, af_3944);
      } else {
        _t3946 = undefined;
      }
      const _t3945 = _t3946;
      const _t3943 = _t3945;
      return _t3943;
    }
    function build_map_pvrows(srow, arow) {
      function collect_tags(row) {
        while (true) {
          let _t3955;
          const _t3954 = row;
          _t3956: {
            if (_t3954._tag === 0) {
              const tag = _t3954._val[0];
              const ty_opt = _t3954._val[1];
              const tail = _t3954._val[2];
              _t3955 = ({_hd: [tag, ty_opt], _tl: collect_tags(tail)});
              break _t3956;
            }
            if (_t3954._tag === 1 && _t3954._val.contents._tag === 1) {
              const r = _t3954._val.contents._val;
              const _t3957 = r;
              row = _t3957;
              continue;
              _t3955 = undefined;
              break _t3956;
            }
            if (true) {
              _t3955 = null;
              break _t3956;
            }
            _match_fail("line 16190");
          }
          return _t3955;
        }
      }
      const atags_3959 = collect_tags(arow);
      function go(row) {
        while (true) {
          let _t3962;
          const _t3961 = row;
          _t3963: {
            if (_t3961._tag === 0) {
              const stag = _t3961._val[0];
              const sty_opt = _t3961._val[1];
              const stail = _t3961._val[2];
              let _t3965;
              const _t3964 = List$assoc_opt(stag, atags_3959);
              _t3966: {
                if (_t3964._tag === 1) {
                  const aty_opt = _t3964._val;
                  let _t3968;
                  const _t3967 = [sty_opt, aty_opt];
                  _t3969: {
                    if (_t3967[0]._tag === 1 && _t3967[1]._tag === 1) {
                      const sty = _t3967[0]._val;
                      const aty = _t3967[1]._val;
                      _t3968 = build_map(sty, aty);
                      break _t3969;
                    }
                    if (true) {
                      _t3968 = undefined;
                      break _t3969;
                    }
                    _match_fail("line 16190");
                  }
                  _t3965 = _t3968;
                  break _t3966;
                }
                if (_t3964._tag === 0) {
                  _t3965 = undefined;
                  break _t3966;
                }
                _match_fail("line 16190");
              }
              _t3965;
              const _t3970 = stail;
              row = _t3970;
              continue;
              _t3962 = undefined;
              break _t3963;
            }
            if (_t3961._tag === 1 && _t3961._val.contents._tag === 1) {
              const r = _t3961._val.contents._val;
              const _t3971 = r;
              row = _t3971;
              continue;
              _t3962 = undefined;
              break _t3963;
            }
            if (true) {
              _t3962 = undefined;
              break _t3963;
            }
            _match_fail("line 16190");
          }
          return _t3962;
        }
      }
      const _t3972 = go(srow);
      const _t3960 = _t3972;
      const _t3958 = _t3960;
      return _t3958;
    }
    build_map(scheme.body, te.ty);
    const found_multi_3974 = Ref$create(null);
    const pending_caty_3976 = Ref$create(null);
    const phantom_counter_3978 = Ref$create(scheme.quant);
    const tvar_to_phantom_3980 = Hashtbl$create(4);
    function _t3982(tbl, key) {
      function _t3983(k) {
        return _eq(k, key);
      }
      let _t3984;
      if ((!List$exists(_t3983, Ref$get(tbl)))) {
        _t3984 = Ref$set(tbl, ({_hd: key, _tl: Ref$get(tbl)}));
      } else {
        _t3984 = undefined;
      }
      return _t3984;
    }
    const set_add_3985 = _t3982;
    function _t3987(local_sch, actual_ty) {
      const call_map_3988 = Hashtbl$create(4);
      const phantom_remap_3990 = Hashtbl$create(4);
      function map_tgens(s, a) {
        while (true) {
          const a_3992 = Types$repr(a);
          let _t3995;
          const _t3994 = s;
          _t3996: {
            if (_t3994._tag === 17) {
              const i = _t3994._val;
              let _t3997;
              if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, call_map_3988, i]))) {
                _t3997 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, call_map_3988, i, a_3992]);
              } else {
                _t3997 = undefined;
              }
              _t3995 = _t3997;
              break _t3996;
            }
            if (_t3994._tag === 7) {
              const s1 = _t3994._val[0];
              const s2 = _t3994._val[2];
              let _t3999;
              const _t3998 = a_3992;
              _t4000: {
                if (_t3998._tag === 7) {
                  const a1 = _t3998._val[0];
                  const a2 = _t3998._val[2];
                  map_tgens(s1, a1);
                  const _t4001 = s2;
                  const _t4002 = a2;
                  s = _t4001;
                  a = _t4002;
                  continue;
                  _t3999 = undefined;
                  break _t4000;
                }
                if (true) {
                  _t3999 = undefined;
                  break _t4000;
                }
                _match_fail("line 16190");
              }
              _t3995 = _t3999;
              break _t3996;
            }
            if (_t3994._tag === 8) {
              const s1 = _t3994._val[0];
              const s2 = _t3994._val[2];
              let _t4004;
              const _t4003 = a_3992;
              _t4005: {
                if (_t4003._tag === 8) {
                  const a1 = _t4003._val[0];
                  const a2 = _t4003._val[2];
                  map_tgens(s1, a1);
                  const _t4006 = s2;
                  const _t4007 = a2;
                  s = _t4006;
                  a = _t4007;
                  continue;
                  _t4004 = undefined;
                  break _t4005;
                }
                if (true) {
                  _t4004 = undefined;
                  break _t4005;
                }
                _match_fail("line 16190");
              }
              _t3995 = _t4004;
              break _t3996;
            }
            if (_t3994._tag === 9) {
              const ss = _t3994._val;
              let _t4009;
              const _t4008 = a_3992;
              _t4010: {
                if (_t4008._tag === 9) {
                  const aa = _t4008._val;
                  if ((List$length(ss) === List$length(aa))) {
                    _t4009 = List$iter2(map_tgens, ss, aa);
                    break _t4010;
                  }
                }
                if (true) {
                  _t4009 = undefined;
                  break _t4010;
                }
                _match_fail("line 16190");
              }
              _t3995 = _t4009;
              break _t3996;
            }
            if (_t3994._tag === 10) {
              const s1 = _t3994._val;
              let _t4012;
              const _t4011 = a_3992;
              _t4013: {
                if (_t4011._tag === 10) {
                  const a1 = _t4011._val;
                  const _t4014 = s1;
                  const _t4015 = a1;
                  s = _t4014;
                  a = _t4015;
                  continue;
                  _t4012 = undefined;
                  break _t4013;
                }
                if (true) {
                  _t4012 = undefined;
                  break _t4013;
                }
                _match_fail("line 16190");
              }
              _t3995 = _t4012;
              break _t3996;
            }
            if (_t3994._tag === 14) {
              const s1 = _t3994._val;
              let _t4017;
              const _t4016 = a_3992;
              _t4018: {
                if (_t4016._tag === 14) {
                  const a1 = _t4016._val;
                  const _t4019 = s1;
                  const _t4020 = a1;
                  s = _t4019;
                  a = _t4020;
                  continue;
                  _t4017 = undefined;
                  break _t4018;
                }
                if (true) {
                  _t4017 = undefined;
                  break _t4018;
                }
                _match_fail("line 16190");
              }
              _t3995 = _t4017;
              break _t3996;
            }
            if (_t3994._tag === 13) {
              const sk = _t3994._val[0];
              const sv = _t3994._val[1];
              let _t4022;
              const _t4021 = a_3992;
              _t4023: {
                if (_t4021._tag === 13) {
                  const ak = _t4021._val[0];
                  const av = _t4021._val[1];
                  map_tgens(sk, ak);
                  const _t4024 = sv;
                  const _t4025 = av;
                  s = _t4024;
                  a = _t4025;
                  continue;
                  _t4022 = undefined;
                  break _t4023;
                }
                if (true) {
                  _t4022 = undefined;
                  break _t4023;
                }
                _match_fail("line 16190");
              }
              _t3995 = _t4022;
              break _t3996;
            }
            if (_t3994._tag === 12) {
              const ss = _t3994._val[1];
              let _t4027;
              const _t4026 = a_3992;
              _t4028: {
                if (_t4026._tag === 12) {
                  const aa = _t4026._val[1];
                  if ((List$length(ss) === List$length(aa))) {
                    _t4027 = List$iter2(map_tgens, ss, aa);
                    break _t4028;
                  }
                }
                if (true) {
                  _t4027 = undefined;
                  break _t4028;
                }
                _match_fail("line 16190");
              }
              _t3995 = _t4027;
              break _t3996;
            }
            if (true) {
              _t3995 = undefined;
              break _t3996;
            }
            _match_fail("line 16190");
          }
          const _t3993 = _t3995;
          return _t3993;
        }
      }
      map_tgens(local_sch.body, actual_ty);
      function _t4030(cc) {
        function _t4031(ca) {
          let _t4033;
          const _t4032 = ca;
          _t4034: {
            if (_t4032._tag === 0) {
              const tgen_idx = _t4032._val;
              let _t4036;
              const _t4035 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, call_map_3988, tgen_idx]);
              _t4037: {
                if (_t4035._tag === 1 && _t4035._val._tag === 16 && _t4035._val._val.contents._tag === 0) {
                  const id = _t4035._val._val.contents._val[0];
                  const tv = _t4035._val;
                  let _t4039;
                  const _t4038 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map_3895, id]);
                  _t4040: {
                    if (_t4038._tag === 1 && _t4038._val._tag === 17) {
                      const outer_tgen = _t4038._val._val;
                      _t4039 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "CATGen", _val: outer_tgen})});
                      break _t4040;
                    }
                    if (true) {
                      _t4039 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "CATy", _val: tv})});
                      break _t4040;
                    }
                    _match_fail("line 16190");
                  }
                  _t4036 = _t4039;
                  break _t4037;
                }
                if (_t4035._tag === 1) {
                  _t4036 = ({_tag: 0, _name: "None"});
                  break _t4037;
                }
                if (_t4035._tag === 0) {
                  _t4036 = ({_tag: 0, _name: "None"});
                  break _t4037;
                }
                _match_fail("line 16190");
              }
              _t4033 = _t4036;
              break _t4034;
            }
            if (_t4032._tag === 1) {
              const ty = _t4032._val;
              let _t4042;
              const _t4041 = Types$repr(ty);
              _t4043: {
                if (_t4041._tag === 16 && _t4041._val.contents._tag === 0) {
                  const id = _t4041._val.contents._val[0];
                  let _t4045;
                  const _t4044 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map_3895, id]);
                  _t4046: {
                    if (_t4044._tag === 1 && _t4044._val._tag === 17) {
                      const outer_tgen = _t4044._val._val;
                      _t4045 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "CATGen", _val: outer_tgen})});
                      break _t4046;
                    }
                    if (true) {
                      _t4045 = ({_tag: 1, _name: "Some", _val: ca});
                      break _t4046;
                    }
                    _match_fail("line 16190");
                  }
                  _t4042 = _t4045;
                  break _t4043;
                }
                if (true) {
                  _t4042 = ({_tag: 1, _name: "Some", _val: ca});
                  break _t4043;
                }
                _match_fail("line 16190");
              }
              _t4033 = _t4042;
              break _t4034;
            }
            if (_t4032._tag === 2) {
              _t4033 = ({_tag: 1, _name: "Some", _val: ({_tag: 2, _name: "CAWild"})});
              break _t4034;
            }
            if (_t4032._tag === 3) {
              const inner_idx = _t4032._val[0];
              let _t4048;
              const _t4047 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, phantom_remap_3990, inner_idx]);
              _t4049: {
                if (_t4047._tag === 1) {
                  const pair = _t4047._val;
                  _t4048 = pair;
                  break _t4049;
                }
                if (_t4047._tag === 0) {
                  const idx_4050 = Ref$get(phantom_counter_3978);
                  Ref$set(phantom_counter_3978, (Ref$get(phantom_counter_3978) + 1));
                  const tv_4052 = Types$new_tvar(1);
                  _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, phantom_remap_3990, inner_idx, [idx_4050, tv_4052]]);
                  const _t4053 = [idx_4050, tv_4052];
                  const _t4051 = _t4053;
                  _t4048 = _t4051;
                  break _t4049;
                }
                _match_fail("line 16190");
              }
              let _t4055;
              const _t4054 = _t4048;
              _t4056: {
                if (true) {
                  const outer_idx = _t4054[0];
                  const outer_tv = _t4054[1];
                  _t4055 = ({_tag: 1, _name: "Some", _val: ({_tag: 3, _name: "CAPhantom", _val: [outer_idx, outer_tv]})});
                  break _t4056;
                }
                _match_fail("line 16190");
              }
              _t4033 = _t4055;
              break _t4034;
            }
            _match_fail("line 16190");
          }
          return _t4033;
        }
        const outer_tgens_4057 = List$filter_map(_t4031, cc.cc_args);
        let _t4059;
        if ((List$length(outer_tgens_4057) === List$length(cc.cc_args))) {
          _t4059 = set_add_3985(found_multi_3974, [cc.cc_class, outer_tgens_4057]);
        } else {
          _t4059 = undefined;
        }
        const _t4058 = _t4059;
        return _t4058;
      }
      const _t4029 = List$iter(_t4030, local_sch.constraints);
      const _t3991 = _t4029;
      const _t3989 = _t3991;
      return _t3989;
    }
    const propagate_constrained_ref_4060 = _t3987;
    function walk(locals, te) {
      let _t4063;
      const _t4062 = te.expr;
      _t4064: {
        if (_t4062._tag === 7) {
          const name = _t4062._val;
          let _t4066;
          const _t4065 = List$assoc_opt(name, locals);
          _t4067: {
            if (_t4065._tag === 1) {
              const local_sch = _t4065._val;
              if (!_eq(local_sch.constraints, null)) {
                _t4066 = propagate_constrained_ref_4060(local_sch, te.ty);
                break _t4067;
              }
            }
            if (true) {
              _t4066 = undefined;
              break _t4067;
            }
            _match_fail("line 16190");
          }
          _t4066;
          let _t4069;
          const _t4068 = List$assoc_opt(name, vars);
          _t4070: {
            if (_t4068._tag === 1) {
              const var_sch = _t4068._val;
              if (!_eq(var_sch.constraints, null)) {
                _t4069 = propagate_constrained_ref_4060(var_sch, te.ty);
                break _t4070;
              }
            }
            if (true) {
              _t4069 = undefined;
              break _t4070;
            }
            _match_fail("line 16190");
          }
          _t4069;
          let _t4072;
          const _t4071 = Types$find_method_class(type_env.classes, name);
          _t4073: {
            if (_t4071._tag === 1) {
              const class_def = _t4071._val;
              if ((!(name === binding_name))) {
                const method_ty_4074 = List$assoc(name, class_def.class_methods);
                let _t4077;
                const _t4076 = List$assoc_opt(name, vars);
                _t4078: {
                  if (_t4076._tag === 1) {
                    const s = _t4076._val;
                    let _t4079;
                    if (_eq(s.body, method_ty_4074)) {
                      _t4079 = [({_tag: 1, _name: "Some", _val: class_def}), name];
                    } else {
                      _t4079 = [({_tag: 0, _name: "None"}), name];
                    }
                    _t4077 = _t4079;
                    break _t4078;
                  }
                  if (_t4076._tag === 0) {
                    _t4077 = [({_tag: 0, _name: "None"}), name];
                    break _t4078;
                  }
                  _match_fail("line 16190");
                }
                const _t4075 = _t4077;
                _t4072 = _t4075;
                break _t4073;
              }
            }
            if (true) {
              let _t4081;
              const _t4080 = String$rindex_opt(name, 46);
              _t4082: {
                if (_t4080._tag === 0) {
                  _t4081 = [({_tag: 0, _name: "None"}), name];
                  break _t4082;
                }
                if (_t4080._tag === 1) {
                  const i = _t4080._val;
                  const _mml$short_4083 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                  const class_prefix_4085 = String$sub(name, 0, i);
                  const mod_prefix_4087 = String$sub(name, 0, (i + 1));
                  let _t4090;
                  const _t4089 = Types$find_method_class(type_env.classes, _mml$short_4083);
                  _t4091: {
                    if (_t4089._tag === 1) {
                      const class_def = _t4089._val;
                      if (((!(_mml$short_4083 === binding_name)) && ((class_def.class_name === class_prefix_4085) || ((String$length(class_def.class_name) > String$length(mod_prefix_4087)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_4087)) === mod_prefix_4087))))) {
                        const method_ty_4092 = List$assoc(_mml$short_4083, class_def.class_methods);
                        let _t4095;
                        const _t4094 = List$assoc_opt(name, vars);
                        _t4096: {
                          if (_t4094._tag === 1) {
                            const r = _t4094;
                            _t4095 = r;
                            break _t4096;
                          }
                          if (_t4094._tag === 0) {
                            _t4095 = List$assoc_opt(_mml$short_4083, vars);
                            break _t4096;
                          }
                          _match_fail("line 16190");
                        }
                        const var_sch_4097 = _t4095;
                        let _t4100;
                        const _t4099 = var_sch_4097;
                        _t4101: {
                          if (_t4099._tag === 1) {
                            const s = _t4099._val;
                            let _t4102;
                            if (_eq(s.body, method_ty_4092)) {
                              _t4102 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_4083];
                            } else {
                              _t4102 = [({_tag: 0, _name: "None"}), name];
                            }
                            _t4100 = _t4102;
                            break _t4101;
                          }
                          if (_t4099._tag === 0) {
                            _t4100 = [({_tag: 0, _name: "None"}), name];
                            break _t4101;
                          }
                          _match_fail("line 16190");
                        }
                        const _t4098 = _t4100;
                        const _t4093 = _t4098;
                        _t4090 = _t4093;
                        break _t4091;
                      }
                    }
                    if (true) {
                      _t4090 = [({_tag: 0, _name: "None"}), name];
                      break _t4091;
                    }
                    _match_fail("line 16190");
                  }
                  const _t4088 = _t4090;
                  const _t4086 = _t4088;
                  const _t4084 = _t4086;
                  _t4081 = _t4084;
                  break _t4082;
                }
                _match_fail("line 16190");
              }
              _t4072 = _t4081;
              break _t4073;
            }
            _match_fail("line 16190");
          }
          let _t4104;
          const _t4103 = _t4072;
          _t4105: {
            if (true) {
              const class_match = _t4103[0];
              const method_name = _t4103[1];
              let _t4107;
              const _t4106 = class_match;
              _t4108: {
                if (_t4106._tag === 1) {
                  const class_def = _t4106._val;
                  const method_schema_ty_4109 = List$assoc(method_name, class_def.class_methods);
                  const num_params_4111 = List$length(class_def.class_params);
                  const param_map_4113 = Hashtbl$create(num_params_4111);
                  function go(s, r) {
                    while (true) {
                      const r_4115 = Types$repr(r);
                      let _t4118;
                      const _t4117 = [s, r_4115];
                      _t4119: {
                        if (_t4117[0]._tag === 17) {
                          const i = _t4117[0]._val;
                          if ((i < num_params_4111)) {
                            let _t4120;
                            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, param_map_4113, i]))) {
                              _t4120 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, param_map_4113, i, r_4115]);
                            } else {
                              _t4120 = undefined;
                            }
                            _t4118 = _t4120;
                            break _t4119;
                          }
                        }
                        if ((_t4117[0]._tag === 7 && _t4117[1]._tag === 7 || _t4117[0]._tag === 8 && _t4117[1]._tag === 8)) {
                          const s1 = _t4117[0]._val[0];
                          const s2 = _t4117[0]._val[2];
                          const r1 = _t4117[1]._val[0];
                          const r2 = _t4117[1]._val[2];
                          go(s1, r1);
                          const _t4121 = s2;
                          const _t4122 = r2;
                          s = _t4121;
                          r = _t4122;
                          continue;
                          _t4118 = undefined;
                          break _t4119;
                        }
                        if (_t4117[0]._tag === 9 && _t4117[1]._tag === 9) {
                          const ss = _t4117[0]._val;
                          const rs = _t4117[1]._val;
                          if ((List$length(ss) === List$length(rs))) {
                            _t4118 = List$iter2(go, ss, rs);
                            break _t4119;
                          }
                        }
                        if (_t4117[0]._tag === 10 && _t4117[1]._tag === 10) {
                          const s1 = _t4117[0]._val;
                          const r1 = _t4117[1]._val;
                          const _t4123 = s1;
                          const _t4124 = r1;
                          s = _t4123;
                          r = _t4124;
                          continue;
                          _t4118 = undefined;
                          break _t4119;
                        }
                        if (_t4117[0]._tag === 14 && _t4117[1]._tag === 14) {
                          const s1 = _t4117[0]._val;
                          const r1 = _t4117[1]._val;
                          const _t4125 = s1;
                          const _t4126 = r1;
                          s = _t4125;
                          r = _t4126;
                          continue;
                          _t4118 = undefined;
                          break _t4119;
                        }
                        if (_t4117[0]._tag === 13 && _t4117[1]._tag === 13) {
                          const sk = _t4117[0]._val[0];
                          const sv = _t4117[0]._val[1];
                          const rk = _t4117[1]._val[0];
                          const rv = _t4117[1]._val[1];
                          go(sk, rk);
                          const _t4127 = sv;
                          const _t4128 = rv;
                          s = _t4127;
                          r = _t4128;
                          continue;
                          _t4118 = undefined;
                          break _t4119;
                        }
                        if (_t4117[0]._tag === 12 && _t4117[1]._tag === 12) {
                          const ss = _t4117[0]._val[1];
                          const rs = _t4117[1]._val[1];
                          if ((List$length(ss) === List$length(rs))) {
                            _t4118 = List$iter2(go, ss, rs);
                            break _t4119;
                          }
                        }
                        if (true) {
                          _t4118 = undefined;
                          break _t4119;
                        }
                        _match_fail("line 16190");
                      }
                      const _t4116 = _t4118;
                      return _t4116;
                    }
                  }
                  go(method_schema_ty_4109, te.ty);
                  function _t4130(i) {
                    let _t4132;
                    const _t4131 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, param_map_4113, i]);
                    _t4133: {
                      if (_t4131._tag === 1 && _t4131._val._tag === 16 && _t4131._val._val.contents._tag === 0) {
                        const id = _t4131._val._val.contents._val[0];
                        const tv = _t4131._val;
                        let _t4135;
                        const _t4134 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map_3895, id]);
                        _t4136: {
                          if (_t4134._tag === 1 && _t4134._val._tag === 17) {
                            const tgen_idx = _t4134._val._val;
                            _t4135 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "CATGen", _val: tgen_idx})});
                            break _t4136;
                          }
                          if (true) {
                            function _t4137(fd) {
                              return List$mem(i, fd.fd_to);
                            }
                            const is_fundep_target_4138 = List$exists(_t4137, class_def.class_fundeps);
                            let _t4140;
                            if (is_fundep_target_4138) {
                              let _t4142;
                              const _t4141 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tvar_to_phantom_3980, id]);
                              _t4143: {
                                if (_t4141._tag === 1) {
                                  const idx = _t4141._val;
                                  _t4142 = idx;
                                  break _t4143;
                                }
                                if (_t4141._tag === 0) {
                                  const idx_4144 = Ref$get(phantom_counter_3978);
                                  Ref$set(phantom_counter_3978, (Ref$get(phantom_counter_3978) + 1));
                                  _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tvar_to_phantom_3980, id, idx_4144]);
                                  const _t4145 = idx_4144;
                                  _t4142 = _t4145;
                                  break _t4143;
                                }
                                _match_fail("line 16190");
                              }
                              const phantom_idx_4146 = _t4142;
                              const _t4147 = ({_tag: 1, _name: "Some", _val: ({_tag: 3, _name: "CAPhantom", _val: [phantom_idx_4146, tv]})});
                              _t4140 = _t4147;
                            } else {
                              _t4140 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "CATy", _val: tv})});
                            }
                            const _t4139 = _t4140;
                            _t4135 = _t4139;
                            break _t4136;
                          }
                          _match_fail("line 16190");
                        }
                        _t4132 = _t4135;
                        break _t4133;
                      }
                      if (_t4131._tag === 1) {
                        const ty = _t4131._val;
                        _t4132 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "CATy", _val: ty})});
                        break _t4133;
                      }
                      if (_t4131._tag === 0) {
                        function _t4148(fd) {
                          return List$mem(i, fd.fd_to);
                        }
                        const is_fundep_target_4149 = List$exists(_t4148, class_def.class_fundeps);
                        let _t4151;
                        if (is_fundep_target_4149) {
                          _t4151 = ({_tag: 1, _name: "Some", _val: ({_tag: 2, _name: "CAWild"})});
                        } else {
                          _t4151 = ({_tag: 0, _name: "None"});
                        }
                        const _t4150 = _t4151;
                        _t4132 = _t4150;
                        break _t4133;
                      }
                      _match_fail("line 16190");
                    }
                    return _t4132;
                  }
                  const cc_args_4152 = List$init(num_params_4111, _t4130);
                  function _t4154(opt) {
                    let _t4156;
                    const _t4155 = opt;
                    _t4157: {
                      if (_t4155._tag === 1 && _t4155._val._tag === 1) {
                        const ty = _t4155._val._val;
                        _t4156 = (!Types$is_concrete(ty));
                        break _t4157;
                      }
                      if (true) {
                        _t4156 = false;
                        break _t4157;
                      }
                      _match_fail("line 16190");
                    }
                    return _t4156;
                  }
                  const has_nonconc_caty_4158 = List$exists(_t4154, cc_args_4152);
                  function _t4160(opt) {
                    let _t4162;
                    const _t4161 = opt;
                    _t4163: {
                      if (_t4161._tag === 1 && _t4161._val._tag === 1) {
                        _t4162 = true;
                        break _t4163;
                      }
                      if (true) {
                        _t4162 = false;
                        break _t4163;
                      }
                      _match_fail("line 16190");
                    }
                    return _t4162;
                  }
                  const has_any_caty_4164 = List$exists(_t4160, cc_args_4152);
                  let _t4166;
                  if (has_nonconc_caty_4158) {
                    function _t4167(opt) {
                      let _t4169;
                      const _t4168 = opt;
                      _t4170: {
                        if (_t4168._tag === 1 && _t4168._val._tag === 2) {
                          _t4169 = ({_tag: 0, _name: "None"});
                          break _t4170;
                        }
                        if (_t4168._tag === 1 && _t4168._val._tag === 3) {
                          _t4169 = ({_tag: 0, _name: "None"});
                          break _t4170;
                        }
                        if (true) {
                          _t4169 = opt;
                          break _t4170;
                        }
                        _match_fail("line 16190");
                      }
                      return _t4169;
                    }
                    _t4166 = List$map(_t4167, cc_args_4152);
                  } else {
                    _t4166 = cc_args_4152;
                  }
                  const cc_args_4171 = _t4166;
                  function _t4173(opt) {
                    let _t4175;
                    const _t4174 = opt;
                    _t4176: {
                      if (_t4174._tag === 1 && _t4174._val._tag === 0) {
                        _t4175 = true;
                        break _t4176;
                      }
                      if (true) {
                        _t4175 = false;
                        break _t4176;
                      }
                      _match_fail("line 16190");
                    }
                    return _t4175;
                  }
                  const has_tgen_4177 = List$exists(_t4173, cc_args_4171);
                  const has_caty_4179 = has_any_caty_4164;
                  function _t4181(opt) {
                    return !_eq(opt, ({_tag: 0, _name: "None"}));
                  }
                  const all_resolved_4182 = List$forall(_t4181, cc_args_4171);
                  let _t4189;
                  if (has_tgen_4177) {
                  let _t4188;
                  if (all_resolved_4182) {
                  let _t4187;
                  if ((!has_caty_4179)) {
                    _t4187 = true;
                  } else {
                  let _t4185;
                  const _t4184 = scheme.body;
                  _t4186: {
                    if ((_t4184._tag === 7 || _t4184._tag === 8)) {
                      _t4185 = true;
                      break _t4186;
                    }
                    if (true) {
                      _t4185 = false;
                      break _t4186;
                    }
                    _match_fail("line 16190");
                  }
                    _t4187 = _t4185;
                  }
                    _t4188 = _t4187;
                  } else {
                    _t4188 = false;
                  }
                    _t4189 = _t4188;
                  } else {
                    _t4189 = false;
                  }
                  const allow_4190 = _t4189;
                  let _t4192;
                  if (allow_4190) {
                    function _t4193(x) {
                      return x;
                    }
                    const cc_args_4194 = List$filter_map(_t4193, cc_args_4171);
                    const _t4195 = set_add_3985(found_multi_3974, [class_def.class_name, cc_args_4194]);
                    _t4192 = _t4195;
                  } else {
                    let _t4196;
                    if (((!has_tgen_4177) && all_resolved_4182)) {
                      function _t4197(opt) {
                        let _t4199;
                        const _t4198 = opt;
                        _t4200: {
                          if (_t4198._tag === 1 && _t4198._val._tag === 1 && _t4198._val._val._tag === 16 && _t4198._val._val._val.contents._tag === 0) {
                            _t4199 = true;
                            break _t4200;
                          }
                          if (true) {
                            _t4199 = false;
                            break _t4200;
                          }
                          _match_fail("line 16190");
                        }
                        return _t4199;
                      }
                      const has_unbound_caty_4201 = List$exists(_t4197, cc_args_4171);
                      let _t4204;
                      const _t4203 = scheme.body;
                      _t4205: {
                        if ((_t4203._tag === 7 || _t4203._tag === 8)) {
                          _t4204 = true;
                          break _t4205;
                        }
                        if (true) {
                          _t4204 = false;
                          break _t4205;
                        }
                        _match_fail("line 16190");
                      }
                      const is_arrow_4206 = _t4204;
                      let _t4208;
                      if ((has_unbound_caty_4201 && is_arrow_4206)) {
                        function _t4209(x) {
                          return x;
                        }
                        const cc_args_4210 = List$filter_map(_t4209, cc_args_4171);
                        const _t4211 = set_add_3985(pending_caty_3976, [class_def.class_name, cc_args_4210]);
                        _t4208 = _t4211;
                      } else {
                        _t4208 = undefined;
                      }
                      const _t4207 = _t4208;
                      const _t4202 = _t4207;
                      _t4196 = _t4202;
                    } else {
                      _t4196 = undefined;
                    }
                    _t4192 = _t4196;
                  }
                  const _t4191 = _t4192;
                  const _t4183 = _t4191;
                  const _t4180 = _t4183;
                  const _t4178 = _t4180;
                  const _t4172 = _t4178;
                  const _t4165 = _t4172;
                  const _t4159 = _t4165;
                  const _t4153 = _t4159;
                  const _t4129 = _t4153;
                  const _t4114 = _t4129;
                  const _t4112 = _t4114;
                  const _t4110 = _t4112;
                  _t4107 = _t4110;
                  break _t4108;
                }
                if (_t4106._tag === 0) {
                  _t4107 = undefined;
                  break _t4108;
                }
                _match_fail("line 16190");
              }
              _t4104 = _t4107;
              break _t4105;
            }
            _match_fail("line 16190");
          }
          _t4063 = _t4104;
          break _t4064;
        }
        if (true) {
          _t4063 = undefined;
          break _t4064;
        }
        _match_fail("line 16190");
      }
      _t4063;
      return walk_children(locals, te);
    }
    function walk_children(locals, te) {
      let _t4213;
      const _t4212 = te.expr;
      _t4214: {
        if ((((((((((_t4212._tag === 0 || _t4212._tag === 1) || _t4212._tag === 2) || _t4212._tag === 3) || _t4212._tag === 4) || _t4212._tag === 5) || _t4212._tag === 6) || _t4212._tag === 7) || _t4212._tag === 22) || _t4212._tag === 34)) {
          _t4213 = undefined;
          break _t4214;
        }
        if ((_t4212._tag === 8 && _t4212._val[1]._tag === 1 || _t4212._tag === 9 && _t4212._val[1]._tag === 1)) {
          const name = _t4212._val[0];
          const sch = _t4212._val[1]._val;
          const _e1 = _t4212._val[2];
          const e2 = _t4212._val[3];
          _t4213 = walk(({_hd: [name, sch], _tl: locals}), e2);
          break _t4214;
        }
        if ((_t4212._tag === 8 && _t4212._val[1]._tag === 0 || _t4212._tag === 9 && _t4212._val[1]._tag === 0)) {
          const name = _t4212._val[0];
          const e1 = _t4212._val[2];
          const e2 = _t4212._val[3];
          let _t4216;
          const _t4215 = Types$repr(e1.ty);
          _t4217: {
            if (_t4215._tag === 16 && _t4215._val.contents._tag === 0) {
              let _t4219;
              const _t4218 = Typechecker$find_var_type_in(name, e2);
              _t4220: {
                if (_t4218._tag === 1) {
                  const inst_ty = _t4218._val;
                  let _t4222;
                  const _t4221 = Types$repr(inst_ty);
                  _t4223: {
                    if (_t4221._tag === 16 && _t4221._val.contents._tag === 0) {
                      _t4222 = Types$unify(e1.ty, inst_ty);
                      break _t4223;
                    }
                    if (true) {
                      _t4222 = undefined;
                      break _t4223;
                    }
                    _match_fail("line 16190");
                  }
                  _t4219 = _t4222;
                  break _t4220;
                }
                if (_t4218._tag === 0) {
                  _t4219 = undefined;
                  break _t4220;
                }
                _match_fail("line 16190");
              }
              _t4216 = _t4219;
              break _t4217;
            }
            if (true) {
              _t4216 = undefined;
              break _t4217;
            }
            _match_fail("line 16190");
          }
          _t4216;
          walk(locals, e1);
          _t4213 = walk(locals, e2);
          break _t4214;
        }
        if ((((((((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) || _t4212._tag === 28) || _t4212._tag === 32) || _t4212._tag === 31) || _t4212._tag === 27) || _t4212._tag === 20)) {
          const e1 = (((((((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) || _t4212._tag === 28) || _t4212._tag === 32) || _t4212._tag === 31) || _t4212._tag === 27) ? ((((((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) || _t4212._tag === 28) || _t4212._tag === 32) || _t4212._tag === 31) ? (((((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) || _t4212._tag === 28) || _t4212._tag === 32) ? ((((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) || _t4212._tag === 28) ? (((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) ? ((_t4212._tag === 25 || _t4212._tag === 13) ? _t4212._val[1] : _t4212._val[0]) : _t4212._val[0]) : _t4212._val[0]) : _t4212._val[0]) : _t4212._val[0]) : _t4212._val[0]);
          const e2 = (((((((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) || _t4212._tag === 28) || _t4212._tag === 32) || _t4212._tag === 31) || _t4212._tag === 27) ? ((((((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) || _t4212._tag === 28) || _t4212._tag === 32) || _t4212._tag === 31) ? (((((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) || _t4212._tag === 28) || _t4212._tag === 32) ? ((((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) || _t4212._tag === 28) ? (((_t4212._tag === 25 || _t4212._tag === 13) || _t4212._tag === 21) ? ((_t4212._tag === 25 || _t4212._tag === 13) ? _t4212._val[2] : _t4212._val[1]) : _t4212._val[1]) : _t4212._val[1]) : _t4212._val[1]) : _t4212._val[2]) : _t4212._val[1]);
          walk(locals, e1);
          _t4213 = walk(locals, e2);
          break _t4214;
        }
        if (_t4212._tag === 11) {
          const fn_ = _t4212._val[0];
          const arg = _t4212._val[1];
          walk(locals, fn_);
          _t4213 = walk(locals, arg);
          break _t4214;
        }
        if (((((((((_t4212._tag === 29 || _t4212._tag === 14) || _t4212._tag === 10) || _t4212._tag === 19) || _t4212._tag === 33) || _t4212._tag === 35) || _t4212._tag === 36) || _t4212._tag === 40) || _t4212._tag === 26)) {
          const e = ((((((((_t4212._tag === 29 || _t4212._tag === 14) || _t4212._tag === 10) || _t4212._tag === 19) || _t4212._tag === 33) || _t4212._tag === 35) || _t4212._tag === 36) || _t4212._tag === 40) ? (((((((_t4212._tag === 29 || _t4212._tag === 14) || _t4212._tag === 10) || _t4212._tag === 19) || _t4212._tag === 33) || _t4212._tag === 35) || _t4212._tag === 36) ? ((((((_t4212._tag === 29 || _t4212._tag === 14) || _t4212._tag === 10) || _t4212._tag === 19) || _t4212._tag === 33) || _t4212._tag === 35) ? (((((_t4212._tag === 29 || _t4212._tag === 14) || _t4212._tag === 10) || _t4212._tag === 19) || _t4212._tag === 33) ? ((((_t4212._tag === 29 || _t4212._tag === 14) || _t4212._tag === 10) || _t4212._tag === 19) ? (((_t4212._tag === 29 || _t4212._tag === 14) || _t4212._tag === 10) ? _t4212._val[1] : _t4212._val[0]) : _t4212._val) : _t4212._val) : _t4212._val) : _t4212._val) : _t4212._val[1]);
          _t4213 = walk(locals, e);
          break _t4214;
        }
        if (_t4212._tag === 12) {
          const c = _t4212._val[0];
          const t = _t4212._val[1];
          const e = _t4212._val[2];
          walk(locals, c);
          walk(locals, t);
          _t4213 = walk(locals, e);
          break _t4214;
        }
        if ((_t4212._tag === 15 || _t4212._tag === 39)) {
          const es = _t4212._val;
          _t4213 = List$iter(_call(walk, [locals]), es);
          break _t4214;
        }
        if (_t4212._tag === 38) {
          const kvs = _t4212._val;
          function _t4224(__p56) {
            let _t4226;
            const _t4225 = __p56;
            _t4227: {
              if (true) {
                const k = _t4225[0];
                const v = _t4225[1];
                walk(locals, k);
                _t4226 = walk(locals, v);
                break _t4227;
              }
              _match_fail("line 16190");
            }
            return _t4226;
          }
          _t4213 = List$iter(_t4224, kvs);
          break _t4214;
        }
        if (_t4212._tag === 16) {
          const fields = _t4212._val;
          function _t4228(__p57) {
            let _t4230;
            const _t4229 = __p57;
            _t4231: {
              if (true) {
                const e = _t4229[1];
                _t4230 = walk(locals, e);
                break _t4231;
              }
              _match_fail("line 16190");
            }
            return _t4230;
          }
          _t4213 = List$iter(_t4228, fields);
          break _t4214;
        }
        if (_t4212._tag === 17) {
          const base = _t4212._val[0];
          const overrides = _t4212._val[1];
          walk(locals, base);
          function _t4232(__p58) {
            let _t4234;
            const _t4233 = __p58;
            _t4235: {
              if (true) {
                const e = _t4233[1];
                _t4234 = walk(locals, e);
                break _t4235;
              }
              _match_fail("line 16190");
            }
            return _t4234;
          }
          _t4213 = List$iter(_t4232, overrides);
          break _t4214;
        }
        if (_t4212._tag === 18) {
          const base = _t4212._val[0];
          const pairs = _t4212._val[1];
          walk(locals, base);
          function _t4236(__p59) {
            let _t4238;
            const _t4237 = __p59;
            _t4239: {
              if (true) {
                const i = _t4237[0];
                const v = _t4237[1];
                walk(locals, i);
                _t4238 = walk(locals, v);
                break _t4239;
              }
              _match_fail("line 16190");
            }
            return _t4238;
          }
          _t4213 = List$iter(_t4236, pairs);
          break _t4214;
        }
        if (_t4212._tag === 23) {
          const arg = _t4212._val[1];
          _t4213 = Option$iter(_call(walk, [locals]), arg);
          break _t4214;
        }
        if (_t4212._tag === 24) {
          const scrutinee = _t4212._val[0];
          const arms = _t4212._val[1];
          walk(locals, scrutinee);
          function _t4240(__p60) {
            let _t4242;
            const _t4241 = __p60;
            _t4243: {
              if (true) {
                const guard = _t4241[1];
                const body = _t4241[2];
                Option$iter(_call(walk, [locals]), guard);
                _t4242 = walk(locals, body);
                break _t4243;
              }
              _match_fail("line 16190");
            }
            return _t4242;
          }
          _t4213 = List$iter(_t4240, arms);
          break _t4214;
        }
        if (_t4212._tag === 30) {
          const body = _t4212._val[0];
          const arms = _t4212._val[1];
          walk(locals, body);
          function _t4244(arm) {
            let _t4246;
            const _t4245 = arm;
            _t4247: {
              if ((((_t4245._tag === 0 || _t4245._tag === 1) || _t4245._tag === 2) || _t4245._tag === 3)) {
                const e = (((_t4245._tag === 0 || _t4245._tag === 1) || _t4245._tag === 2) ? ((_t4245._tag === 0 || _t4245._tag === 1) ? (_t4245._tag === 0 ? _t4245._val[1] : _t4245._val[3]) : _t4245._val[2]) : _t4245._val[2]);
                _t4246 = walk(locals, e);
                break _t4247;
              }
              _match_fail("line 16190");
            }
            return _t4246;
          }
          _t4213 = List$iter(_t4244, arms);
          break _t4214;
        }
        if (_t4212._tag === 37) {
          const bindings = _t4212._val[0];
          const body = _t4212._val[1];
          function _t4248(__p61) {
            let _t4250;
            const _t4249 = __p61;
            _t4251: {
              if (true) {
                const e = _t4249[1];
                _t4250 = walk(locals, e);
                break _t4251;
              }
              _match_fail("line 16190");
            }
            return _t4250;
          }
          List$iter(_t4248, bindings);
          _t4213 = walk(locals, body);
          break _t4214;
        }
        _match_fail("line 16190");
      }
      return _t4213;
    }
    walk(null, te);
    const changed_4253 = Ref$create(true);
    let _t4255 = undefined;
    let _t4256 = false, _t4257;
    while (true) {
      if (!(Ref$get(changed_4253))) break;
      Ref$set(changed_4253, false);
      function _t4258(acc, __p62) {
        let _t4260;
        const _t4259 = __p62;
        _t4261: {
          if (true) {
            const cls = _t4259[0];
            const args = _t4259[1];
            function _t4262(ca) {
              let _t4264;
              const _t4263 = ca;
              _t4265: {
                if (_t4263._tag === 1 && _t4263._val._tag === 16 && _t4263._val._val.contents._tag === 0) {
                  const id = _t4263._val._val.contents._val[0];
                  function _t4266(__p63) {
                    let _t4268;
                    const _t4267 = __p63;
                    _t4269: {
                      if (true) {
                        const _c = _t4267[0];
                        const fargs = _t4267[1];
                        function _t4270(fa) {
                          let _t4272;
                          const _t4271 = fa;
                          _t4273: {
                            if (_t4271._tag === 1 && _t4271._val._tag === 16 && _t4271._val._val.contents._tag === 0) {
                              const fid = _t4271._val._val.contents._val[0];
                              _t4272 = (fid === id);
                              break _t4273;
                            }
                            if (_t4271._tag === 3 && _t4271._val[1]._tag === 16 && _t4271._val[1]._val.contents._tag === 0) {
                              const fid = _t4271._val[1]._val.contents._val[0];
                              _t4272 = (fid === id);
                              break _t4273;
                            }
                            if (true) {
                              _t4272 = false;
                              break _t4273;
                            }
                            _match_fail("line 16190");
                          }
                          return _t4272;
                        }
                        _t4268 = List$exists(_t4270, fargs);
                        break _t4269;
                      }
                      _match_fail("line 16190");
                    }
                    return _t4268;
                  }
                  _t4264 = List$exists(_t4266, Ref$get(found_multi_3974));
                  break _t4265;
                }
                if (true) {
                  _t4264 = false;
                  break _t4265;
                }
                _match_fail("line 16190");
              }
              return _t4264;
            }
            const dominated_4274 = List$exists(_t4262, args);
            let _t4276;
            if (dominated_4274) {
              _t4276 = ({_hd: [cls, args], _tl: acc});
            } else {
              _t4276 = acc;
            }
            const _t4275 = _t4276;
            _t4260 = _t4275;
            break _t4261;
          }
          _match_fail("line 16190");
        }
        return _t4260;
      }
      const to_promote_4277 = List$fold(_t4258, null, Ref$get(pending_caty_3976));
      function _t4279(__p64) {
        let _t4281;
        const _t4280 = __p64;
        _t4282: {
          if (true) {
            const cls = _t4280[0];
            const args = _t4280[1];
            function _t4283(ca) {
              let _t4285;
              const _t4284 = ca;
              _t4286: {
                if (_t4284._tag === 1 && _t4284._val._tag === 16 && _t4284._val._val.contents._tag === 0) {
                  const id = _t4284._val._val.contents._val[0];
                  const tv = _t4284._val;
                  const phantom_idx_4287 = Ref$create(({_tag: 0, _name: "None"}));
                  function _t4289(__p65) {
                    let _t4291;
                    const _t4290 = __p65;
                    _t4292: {
                      if (true) {
                        const _c = _t4290[0];
                        const fargs = _t4290[1];
                        function _t4293(fa) {
                          let _t4295;
                          const _t4294 = fa;
                          _t4296: {
                            if (_t4294._tag === 3 && _t4294._val[1]._tag === 16 && _t4294._val[1]._val.contents._tag === 0) {
                              const idx = _t4294._val[0];
                              const fid = _t4294._val[1]._val.contents._val[0];
                              if ((fid === id)) {
                                _t4295 = Ref$set(phantom_idx_4287, ({_tag: 1, _name: "Some", _val: idx}));
                                break _t4296;
                              }
                            }
                            if (true) {
                              _t4295 = undefined;
                              break _t4296;
                            }
                            _match_fail("line 16190");
                          }
                          return _t4295;
                        }
                        _t4291 = List$iter(_t4293, fargs);
                        break _t4292;
                      }
                      _match_fail("line 16190");
                    }
                    return _t4291;
                  }
                  List$iter(_t4289, Ref$get(found_multi_3974));
                  let _t4298;
                  const _t4297 = Ref$get(phantom_idx_4287);
                  _t4299: {
                    if (_t4297._tag === 1) {
                      const idx = _t4297._val;
                      _t4298 = ({_tag: 3, _name: "CAPhantom", _val: [idx, tv]});
                      break _t4299;
                    }
                    if (_t4297._tag === 0) {
                      _t4298 = ca;
                      break _t4299;
                    }
                    _match_fail("line 16190");
                  }
                  const _t4288 = _t4298;
                  _t4285 = _t4288;
                  break _t4286;
                }
                if (true) {
                  _t4285 = ca;
                  break _t4286;
                }
                _match_fail("line 16190");
              }
              return _t4285;
            }
            const promoted_args_4300 = List$map(_t4283, args);
            function _t4302(k) {
              return !_eq(k, [cls, args]);
            }
            Ref$set(pending_caty_3976, List$filter(_t4302, Ref$get(pending_caty_3976)));
            set_add_3985(found_multi_3974, [cls, promoted_args_4300]);
            const _t4301 = Ref$set(changed_4253, true);
            _t4281 = _t4301;
            break _t4282;
          }
          _match_fail("line 16190");
        }
        return _t4281;
      }
      const _t4278 = List$iter(_t4279, to_promote_4277);
      _t4278;
      if (_t4256) break;
    }
    _t4255 = _t4256 ? _t4257 : undefined;
    _t4255;
    function _t4303(acc, __p66) {
      let _t4305;
      const _t4304 = __p66;
      _t4306: {
        if (true) {
          const class_name = _t4304[0];
          const cc_args = _t4304[1];
          function _t4307(cc) {
            return ((cc.cc_class === class_name) && _eq(cc.cc_args, cc_args));
          }
          const exists_4308 = List$exists(_t4307, acc);
          let _t4310;
          if (exists_4308) {
            _t4310 = acc;
          } else {
            _t4310 = ({_hd: ({cc_args: cc_args, cc_class: class_name}), _tl: acc});
          }
          const _t4309 = _t4310;
          _t4305 = _t4309;
          break _t4306;
        }
        _match_fail("line 16190");
      }
      return _t4305;
    }
    const cc_list_4311 = List$fold(_t4303, null, Ref$get(found_multi_3974));
    let _t4313;
    if (_eq(cc_list_4311, null)) {
      _t4313 = scheme;
    } else {
      function _t4314(a, b) {
        function _t4315(args) {
          function _t4316(ca) {
            let _t4318;
            const _t4317 = ca;
            _t4319: {
              if (_t4317._tag === 0) {
                _t4318 = true;
                break _t4319;
              }
              if (true) {
                _t4318 = false;
                break _t4319;
              }
              _match_fail("line 16190");
            }
            return _t4318;
          }
          return List$length(List$filter(_t4316, args));
        }
        const count_catgen_4320 = _t4315;
        const _t4321 = compare(count_catgen_4320(b.cc_args), count_catgen_4320(a.cc_args));
        return _t4321;
      }
      const cc_list_4322 = List$sort(_t4314, cc_list_4311);
      const __rec_upd_4324 = scheme;
      const _t4325 = ({body: __rec_upd_4324.body, constraints: cc_list_4322, equant: __rec_upd_4324.equant, pvquant: __rec_upd_4324.pvquant, quant: __rec_upd_4324.quant, record_evidences: __rec_upd_4324.record_evidences, rquant: __rec_upd_4324.rquant});
      const _t4323 = _t4325;
      _t4313 = _t4323;
    }
    const _t4312 = _t4313;
    const _t4254 = _t4312;
    const _t4252 = _t4254;
    const _t4061 = _t4252;
    const _t3986 = _t4061;
    const _t3981 = _t3986;
    const _t3979 = _t3981;
    const _t3977 = _t3979;
    const _t3975 = _t3977;
    const _t3973 = _t3975;
    const _t3896 = _t3973;
    _t3894 = _t3896;
  }
  return _t3894;
}
function Typechecker$build_rgen_map(schema_ty, actual_ty) {
  const map_4326 = Hashtbl$create(4);
  function walk(s, a) {
    while (true) {
      const a_4328 = Types$repr(a);
      let _t4331;
      const _t4330 = s;
      _t4332: {
        if (_t4330._tag === 7) {
          const s1 = _t4330._val[0];
          const s2 = _t4330._val[2];
          let _t4334;
          const _t4333 = a_4328;
          _t4335: {
            if (_t4333._tag === 7) {
              const a1 = _t4333._val[0];
              const a2 = _t4333._val[2];
              walk(s1, a1);
              const _t4336 = s2;
              const _t4337 = a2;
              s = _t4336;
              a = _t4337;
              continue;
              _t4334 = undefined;
              break _t4335;
            }
            if (true) {
              _t4334 = undefined;
              break _t4335;
            }
            _match_fail("line 16190");
          }
          _t4331 = _t4334;
          break _t4332;
        }
        if (_t4330._tag === 8) {
          const s1 = _t4330._val[0];
          const s2 = _t4330._val[2];
          let _t4339;
          const _t4338 = a_4328;
          _t4340: {
            if (_t4338._tag === 8) {
              const a1 = _t4338._val[0];
              const a2 = _t4338._val[2];
              walk(s1, a1);
              const _t4341 = s2;
              const _t4342 = a2;
              s = _t4341;
              a = _t4342;
              continue;
              _t4339 = undefined;
              break _t4340;
            }
            if (true) {
              _t4339 = undefined;
              break _t4340;
            }
            _match_fail("line 16190");
          }
          _t4331 = _t4339;
          break _t4332;
        }
        if (_t4330._tag === 9) {
          const ss = _t4330._val;
          let _t4344;
          const _t4343 = a_4328;
          _t4345: {
            if (_t4343._tag === 9) {
              const aa = _t4343._val;
              if ((List$length(ss) === List$length(aa))) {
                _t4344 = List$iter2(walk, ss, aa);
                break _t4345;
              }
            }
            if (true) {
              _t4344 = undefined;
              break _t4345;
            }
            _match_fail("line 16190");
          }
          _t4331 = _t4344;
          break _t4332;
        }
        if (_t4330._tag === 10) {
          const s1 = _t4330._val;
          let _t4347;
          const _t4346 = a_4328;
          _t4348: {
            if (_t4346._tag === 10) {
              const a1 = _t4346._val;
              const _t4349 = s1;
              const _t4350 = a1;
              s = _t4349;
              a = _t4350;
              continue;
              _t4347 = undefined;
              break _t4348;
            }
            if (true) {
              _t4347 = undefined;
              break _t4348;
            }
            _match_fail("line 16190");
          }
          _t4331 = _t4347;
          break _t4332;
        }
        if (_t4330._tag === 14) {
          const s1 = _t4330._val;
          let _t4352;
          const _t4351 = a_4328;
          _t4353: {
            if (_t4351._tag === 14) {
              const a1 = _t4351._val;
              const _t4354 = s1;
              const _t4355 = a1;
              s = _t4354;
              a = _t4355;
              continue;
              _t4352 = undefined;
              break _t4353;
            }
            if (true) {
              _t4352 = undefined;
              break _t4353;
            }
            _match_fail("line 16190");
          }
          _t4331 = _t4352;
          break _t4332;
        }
        if (_t4330._tag === 13) {
          const sk = _t4330._val[0];
          const sv = _t4330._val[1];
          let _t4357;
          const _t4356 = a_4328;
          _t4358: {
            if (_t4356._tag === 13) {
              const ak = _t4356._val[0];
              const av = _t4356._val[1];
              walk(sk, ak);
              const _t4359 = sv;
              const _t4360 = av;
              s = _t4359;
              a = _t4360;
              continue;
              _t4357 = undefined;
              break _t4358;
            }
            if (true) {
              _t4357 = undefined;
              break _t4358;
            }
            _match_fail("line 16190");
          }
          _t4331 = _t4357;
          break _t4332;
        }
        if (_t4330._tag === 12) {
          const ss = _t4330._val[1];
          let _t4362;
          const _t4361 = a_4328;
          _t4363: {
            if (_t4361._tag === 12) {
              const aa = _t4361._val[1];
              if ((List$length(ss) === List$length(aa))) {
                _t4362 = List$iter2(walk, ss, aa);
                break _t4363;
              }
            }
            if (true) {
              _t4362 = undefined;
              break _t4363;
            }
            _match_fail("line 16190");
          }
          _t4331 = _t4362;
          break _t4332;
        }
        if (_t4330._tag === 11) {
          const srow = _t4330._val;
          let _t4365;
          const _t4364 = a_4328;
          _t4366: {
            if (_t4364._tag === 11) {
              const arow = _t4364._val;
              walk_rrows(srow, arow);
              const sf_4367 = Types$record_row_to_fields(srow);
              const af_4369 = Types$record_row_to_fields(arow);
              function _t4371(__p67) {
                let _t4373;
                const _t4372 = __p67;
                _t4374: {
                  if (true) {
                    const name = _t4372[0];
                    const sty = _t4372[1];
                    let _t4376;
                    const _t4375 = List$assoc_opt(name, af_4369);
                    _t4377: {
                      if (_t4375._tag === 1) {
                        const aty = _t4375._val;
                        _t4376 = walk(sty, aty);
                        break _t4377;
                      }
                      if (_t4375._tag === 0) {
                        _t4376 = undefined;
                        break _t4377;
                      }
                      _match_fail("line 16190");
                    }
                    _t4373 = _t4376;
                    break _t4374;
                  }
                  _match_fail("line 16190");
                }
                return _t4373;
              }
              const _t4370 = List$iter(_t4371, sf_4367);
              const _t4368 = _t4370;
              _t4365 = _t4368;
              break _t4366;
            }
            if (true) {
              _t4365 = undefined;
              break _t4366;
            }
            _match_fail("line 16190");
          }
          _t4331 = _t4365;
          break _t4332;
        }
        if (true) {
          _t4331 = undefined;
          break _t4332;
        }
        _match_fail("line 16190");
      }
      const _t4329 = _t4331;
      return _t4329;
    }
  }
  function walk_rrows(srow, arow) {
    while (true) {
      let _t4379;
      const _t4378 = srow;
      _t4380: {
        if (_t4378._tag === 3) {
          const i = _t4378._val;
          let _t4381;
          if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, map_4326, i]))) {
            _t4381 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, map_4326, i, arow]);
          } else {
            _t4381 = undefined;
          }
          _t4379 = _t4381;
          break _t4380;
        }
        if (_t4378._tag === 0) {
          const stail = _t4378._val[2];
          const _t4382 = stail;
          const _t4383 = arow;
          srow = _t4382;
          arow = _t4383;
          continue;
          _t4379 = undefined;
          break _t4380;
        }
        if (true) {
          _t4379 = undefined;
          break _t4380;
        }
        _match_fail("line 16190");
      }
      return _t4379;
    }
  }
  walk(schema_ty, actual_ty);
  const _t4384 = map_4326;
  const _t4327 = _t4384;
  return _t4327;
}
function Typechecker$infer_record_evidence(vars, te, scheme) {
  let _t4385;
  if ((scheme.rquant === 0)) {
    _t4385 = scheme;
  } else {
    const rvar_to_rgen_4386 = Hashtbl$create(4);
    function walk_rmap(s, a) {
      while (true) {
        const a_4388 = Types$repr(a);
        let _t4391;
        const _t4390 = s;
        _t4392: {
          if (_t4390._tag === 7) {
            const s1 = _t4390._val[0];
            const s2 = _t4390._val[2];
            let _t4394;
            const _t4393 = a_4388;
            _t4395: {
              if (_t4393._tag === 7) {
                const a1 = _t4393._val[0];
                const a2 = _t4393._val[2];
                walk_rmap(s1, a1);
                const _t4396 = s2;
                const _t4397 = a2;
                s = _t4396;
                a = _t4397;
                continue;
                _t4394 = undefined;
                break _t4395;
              }
              if (true) {
                _t4394 = undefined;
                break _t4395;
              }
              _match_fail("line 16190");
            }
            _t4391 = _t4394;
            break _t4392;
          }
          if (_t4390._tag === 8) {
            const s1 = _t4390._val[0];
            const s2 = _t4390._val[2];
            let _t4399;
            const _t4398 = a_4388;
            _t4400: {
              if (_t4398._tag === 8) {
                const a1 = _t4398._val[0];
                const a2 = _t4398._val[2];
                walk_rmap(s1, a1);
                const _t4401 = s2;
                const _t4402 = a2;
                s = _t4401;
                a = _t4402;
                continue;
                _t4399 = undefined;
                break _t4400;
              }
              if (true) {
                _t4399 = undefined;
                break _t4400;
              }
              _match_fail("line 16190");
            }
            _t4391 = _t4399;
            break _t4392;
          }
          if (_t4390._tag === 9) {
            const ss = _t4390._val;
            let _t4404;
            const _t4403 = a_4388;
            _t4405: {
              if (_t4403._tag === 9) {
                const aa = _t4403._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t4404 = List$iter2(walk_rmap, ss, aa);
                  break _t4405;
                }
              }
              if (true) {
                _t4404 = undefined;
                break _t4405;
              }
              _match_fail("line 16190");
            }
            _t4391 = _t4404;
            break _t4392;
          }
          if (_t4390._tag === 10) {
            const s1 = _t4390._val;
            let _t4407;
            const _t4406 = a_4388;
            _t4408: {
              if (_t4406._tag === 10) {
                const a1 = _t4406._val;
                const _t4409 = s1;
                const _t4410 = a1;
                s = _t4409;
                a = _t4410;
                continue;
                _t4407 = undefined;
                break _t4408;
              }
              if (true) {
                _t4407 = undefined;
                break _t4408;
              }
              _match_fail("line 16190");
            }
            _t4391 = _t4407;
            break _t4392;
          }
          if (_t4390._tag === 14) {
            const s1 = _t4390._val;
            let _t4412;
            const _t4411 = a_4388;
            _t4413: {
              if (_t4411._tag === 14) {
                const a1 = _t4411._val;
                const _t4414 = s1;
                const _t4415 = a1;
                s = _t4414;
                a = _t4415;
                continue;
                _t4412 = undefined;
                break _t4413;
              }
              if (true) {
                _t4412 = undefined;
                break _t4413;
              }
              _match_fail("line 16190");
            }
            _t4391 = _t4412;
            break _t4392;
          }
          if (_t4390._tag === 13) {
            const sk = _t4390._val[0];
            const sv = _t4390._val[1];
            let _t4417;
            const _t4416 = a_4388;
            _t4418: {
              if (_t4416._tag === 13) {
                const ak = _t4416._val[0];
                const av = _t4416._val[1];
                walk_rmap(sk, ak);
                const _t4419 = sv;
                const _t4420 = av;
                s = _t4419;
                a = _t4420;
                continue;
                _t4417 = undefined;
                break _t4418;
              }
              if (true) {
                _t4417 = undefined;
                break _t4418;
              }
              _match_fail("line 16190");
            }
            _t4391 = _t4417;
            break _t4392;
          }
          if (_t4390._tag === 12) {
            const ss = _t4390._val[1];
            let _t4422;
            const _t4421 = a_4388;
            _t4423: {
              if (_t4421._tag === 12) {
                const aa = _t4421._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t4422 = List$iter2(walk_rmap, ss, aa);
                  break _t4423;
                }
              }
              if (true) {
                _t4422 = undefined;
                break _t4423;
              }
              _match_fail("line 16190");
            }
            _t4391 = _t4422;
            break _t4392;
          }
          if (_t4390._tag === 11) {
            const srow = _t4390._val;
            let _t4425;
            const _t4424 = a_4388;
            _t4426: {
              if (_t4424._tag === 11) {
                const arow = _t4424._val;
                _t4425 = walk_rmap_rrows(srow, arow);
                break _t4426;
              }
              if (true) {
                _t4425 = undefined;
                break _t4426;
              }
              _match_fail("line 16190");
            }
            _t4391 = _t4425;
            break _t4392;
          }
          if (true) {
            _t4391 = undefined;
            break _t4392;
          }
          _match_fail("line 16190");
        }
        const _t4389 = _t4391;
        return _t4389;
      }
    }
    function walk_rmap_rrows(srow, arow) {
      while (true) {
        let _t4428;
        const _t4427 = [srow, Types$rrow_repr(arow)];
        _t4429: {
          if (_t4427[0]._tag === 3 && _t4427[1]._tag === 1 && _t4427[1]._val.contents._tag === 0) {
            const i = _t4427[0]._val;
            const id = _t4427[1]._val.contents._val[0];
            _t4428 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4386, id, i]);
            break _t4429;
          }
          if (_t4427[0]._tag === 0 && _t4427[1]._tag === 0) {
            const sty = _t4427[0]._val[1];
            const stail = _t4427[0]._val[2];
            const aty = _t4427[1]._val[1];
            const atail = _t4427[1]._val[2];
            walk_rmap(sty, aty);
            const _t4430 = stail;
            const _t4431 = atail;
            srow = _t4430;
            arow = _t4431;
            continue;
            _t4428 = undefined;
            break _t4429;
          }
          if (true) {
            _t4428 = undefined;
            break _t4429;
          }
          _match_fail("line 16190");
        }
        return _t4428;
      }
    }
    walk_rmap(scheme.body, te.ty);
    const found_evidences_4433 = Hashtbl$create(4);
    function _t4435(__dict_Hash_resolved_0, __dict_Eq_resolved_1, rgen_idx, fields) {
      let _t4437;
      const _t4436 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_evidences_4433, rgen_idx]);
      _t4438: {
        if (_t4436._tag === 1) {
          const fs = _t4436._val;
          _t4437 = fs;
          break _t4438;
        }
        if (_t4436._tag === 0) {
          _t4437 = null;
          break _t4438;
        }
        _match_fail("line 16190");
      }
      const existing_4439 = _t4437;
      function _t4441(fs, f) {
        let _t4442;
        if (List$mem(f, fs)) {
          _t4442 = fs;
        } else {
          _t4442 = ({_hd: f, _tl: fs});
        }
        return _t4442;
      }
      const merged_4443 = List$fold(_t4441, existing_4439, fields);
      const _t4444 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_evidences_4433, rgen_idx, merged_4443]);
      const _t4440 = _t4444;
      return _t4440;
    }
    const add_evidence_4445 = _t4435;
    function get_row_tail(row) {
      while (true) {
        let _t4448;
        const _t4447 = Types$rrow_repr(row);
        _t4449: {
          if (_t4447._tag === 0) {
            const tail = _t4447._val[2];
            const _t4450 = tail;
            row = _t4450;
            continue;
            _t4448 = undefined;
            break _t4449;
          }
          if (true) {
            const tail = _t4447;
            _t4448 = tail;
            break _t4449;
          }
          _match_fail("line 16190");
        }
        return _t4448;
      }
    }
    function walk(te) {
      let _t4453;
      const _t4452 = te.expr;
      _t4454: {
        if (_t4452._tag === 17) {
          const _base = _t4452._val[0];
          const overrides = _t4452._val[1];
          let _t4456;
          const _t4455 = Types$repr(te.ty);
          _t4457: {
            if (_t4455._tag === 11) {
              const row = _t4455._val;
              let _t4459;
              const _t4458 = get_row_tail(row);
              _t4460: {
                if (_t4458._tag === 1 && _t4458._val.contents._tag === 0) {
                  const id = _t4458._val.contents._val[0];
                  let _t4462;
                  const _t4461 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4386, id]);
                  _t4463: {
                    if (_t4461._tag === 1) {
                      const rgen_idx = _t4461._val;
                      _t4462 = _call(add_evidence_4445, [__dict_Hash_int, __dict_Eq_int, rgen_idx, List$map(fst, overrides)]);
                      break _t4463;
                    }
                    if (_t4461._tag === 0) {
                      _t4462 = undefined;
                      break _t4463;
                    }
                    _match_fail("line 16190");
                  }
                  _t4459 = _t4462;
                  break _t4460;
                }
                if (true) {
                  _t4459 = undefined;
                  break _t4460;
                }
                _match_fail("line 16190");
              }
              _t4456 = _t4459;
              break _t4457;
            }
            if (true) {
              _t4456 = undefined;
              break _t4457;
            }
            _match_fail("line 16190");
          }
          _t4453 = _t4456;
          break _t4454;
        }
        if (_t4452._tag === 19) {
          const base_e = _t4452._val[0];
          const field_name = _t4452._val[1];
          let _t4465;
          const _t4464 = Types$repr(base_e.ty);
          _t4466: {
            if (_t4464._tag === 11) {
              const row = _t4464._val;
              let _t4468;
              const _t4467 = get_row_tail(row);
              _t4469: {
                if (_t4467._tag === 1 && _t4467._val.contents._tag === 0) {
                  const id = _t4467._val.contents._val[0];
                  let _t4471;
                  const _t4470 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4386, id]);
                  _t4472: {
                    if (_t4470._tag === 1) {
                      const rgen_idx = _t4470._val;
                      _t4471 = _call(add_evidence_4445, [__dict_Hash_int, __dict_Eq_int, rgen_idx, ({_hd: field_name, _tl: null})]);
                      break _t4472;
                    }
                    if (_t4470._tag === 0) {
                      _t4471 = undefined;
                      break _t4472;
                    }
                    _match_fail("line 16190");
                  }
                  _t4468 = _t4471;
                  break _t4469;
                }
                if (true) {
                  _t4468 = undefined;
                  break _t4469;
                }
                _match_fail("line 16190");
              }
              _t4465 = _t4468;
              break _t4466;
            }
            if (true) {
              _t4465 = undefined;
              break _t4466;
            }
            _match_fail("line 16190");
          }
          _t4453 = _t4465;
          break _t4454;
        }
        if (_t4452._tag === 27) {
          const base_e = _t4452._val[0];
          const field_name = _t4452._val[1];
          let _t4474;
          const _t4473 = Types$repr(base_e.ty);
          _t4475: {
            if (_t4473._tag === 11) {
              const row = _t4473._val;
              let _t4477;
              const _t4476 = get_row_tail(row);
              _t4478: {
                if (_t4476._tag === 1 && _t4476._val.contents._tag === 0) {
                  const id = _t4476._val.contents._val[0];
                  let _t4480;
                  const _t4479 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4386, id]);
                  _t4481: {
                    if (_t4479._tag === 1) {
                      const rgen_idx = _t4479._val;
                      _t4480 = _call(add_evidence_4445, [__dict_Hash_int, __dict_Eq_int, rgen_idx, ({_hd: field_name, _tl: null})]);
                      break _t4481;
                    }
                    if (_t4479._tag === 0) {
                      _t4480 = undefined;
                      break _t4481;
                    }
                    _match_fail("line 16190");
                  }
                  _t4477 = _t4480;
                  break _t4478;
                }
                if (true) {
                  _t4477 = undefined;
                  break _t4478;
                }
                _match_fail("line 16190");
              }
              _t4474 = _t4477;
              break _t4475;
            }
            if (true) {
              _t4474 = undefined;
              break _t4475;
            }
            _match_fail("line 16190");
          }
          _t4453 = _t4474;
          break _t4454;
        }
        if (_t4452._tag === 7) {
          const name = _t4452._val;
          let _t4483;
          const _t4482 = List$assoc_opt(name, vars);
          _t4484: {
            if (_t4482._tag === 1) {
              const callee_sch = _t4482._val;
              if (!_eq(callee_sch.record_evidences, null)) {
                const rgen_map_4485 = Typechecker$build_rgen_map(callee_sch.body, te.ty);
                function _t4487(re) {
                  let _t4489;
                  const _t4488 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rgen_map_4485, re.re_rgen]);
                  _t4490: {
                    if (_t4488._tag === 1) {
                      const arow = _t4488._val;
                      function is_open(r) {
                        while (true) {
                          let _t4492;
                          const _t4491 = Types$rrow_repr(r);
                          _t4493: {
                            if (_t4491._tag === 0) {
                              const tail = _t4491._val[2];
                              const _t4494 = tail;
                              r = _t4494;
                              continue;
                              _t4492 = undefined;
                              break _t4493;
                            }
                            if (_t4491._tag === 1 && _t4491._val.contents._tag === 0) {
                              _t4492 = true;
                              break _t4493;
                            }
                            if (true) {
                              _t4492 = false;
                              break _t4493;
                            }
                            _match_fail("line 16190");
                          }
                          return _t4492;
                        }
                      }
                      let _t4496;
                      if (is_open(arow)) {
                        let _t4498;
                        const _t4497 = get_row_tail(arow);
                        _t4499: {
                          if (_t4497._tag === 1 && _t4497._val.contents._tag === 0) {
                            const id = _t4497._val.contents._val[0];
                            let _t4501;
                            const _t4500 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4386, id]);
                            _t4502: {
                              if (_t4500._tag === 1) {
                                const caller_rgen = _t4500._val;
                                _t4501 = _call(add_evidence_4445, [__dict_Hash_int, __dict_Eq_int, caller_rgen, re.re_fields]);
                                break _t4502;
                              }
                              if (_t4500._tag === 0) {
                                _t4501 = undefined;
                                break _t4502;
                              }
                              _match_fail("line 16190");
                            }
                            _t4498 = _t4501;
                            break _t4499;
                          }
                          if (true) {
                            _t4498 = undefined;
                            break _t4499;
                          }
                          _match_fail("line 16190");
                        }
                        _t4496 = _t4498;
                      } else {
                        _t4496 = undefined;
                      }
                      const _t4495 = _t4496;
                      _t4489 = _t4495;
                      break _t4490;
                    }
                    if (_t4488._tag === 0) {
                      _t4489 = undefined;
                      break _t4490;
                    }
                    _match_fail("line 16190");
                  }
                  return _t4489;
                }
                const _t4486 = List$iter(_t4487, callee_sch.record_evidences);
                _t4483 = _t4486;
                break _t4484;
              }
            }
            if (true) {
              _t4483 = undefined;
              break _t4484;
            }
            _match_fail("line 16190");
          }
          _t4453 = _t4483;
          break _t4454;
        }
        if (true) {
          _t4453 = undefined;
          break _t4454;
        }
        _match_fail("line 16190");
      }
      _t4453;
      return walk_children(te);
    }
    function walk_children(te) {
      let _t4504;
      const _t4503 = te.expr;
      _t4505: {
        if ((((((((((_t4503._tag === 0 || _t4503._tag === 1) || _t4503._tag === 2) || _t4503._tag === 3) || _t4503._tag === 4) || _t4503._tag === 5) || _t4503._tag === 6) || _t4503._tag === 7) || _t4503._tag === 22) || _t4503._tag === 34)) {
          _t4504 = undefined;
          break _t4505;
        }
        if (((_t4503._tag === 8 || _t4503._tag === 9) || _t4503._tag === 25)) {
          const e1 = ((_t4503._tag === 8 || _t4503._tag === 9) ? _t4503._val[2] : _t4503._val[1]);
          const e2 = ((_t4503._tag === 8 || _t4503._tag === 9) ? _t4503._val[3] : _t4503._val[2]);
          walk(e1);
          _t4504 = walk(e2);
          break _t4505;
        }
        if (((((((_t4503._tag === 13 || _t4503._tag === 21) || _t4503._tag === 28) || _t4503._tag === 32) || _t4503._tag === 31) || _t4503._tag === 27) || _t4503._tag === 20)) {
          const e1 = ((((((_t4503._tag === 13 || _t4503._tag === 21) || _t4503._tag === 28) || _t4503._tag === 32) || _t4503._tag === 31) || _t4503._tag === 27) ? (((((_t4503._tag === 13 || _t4503._tag === 21) || _t4503._tag === 28) || _t4503._tag === 32) || _t4503._tag === 31) ? ((((_t4503._tag === 13 || _t4503._tag === 21) || _t4503._tag === 28) || _t4503._tag === 32) ? (((_t4503._tag === 13 || _t4503._tag === 21) || _t4503._tag === 28) ? ((_t4503._tag === 13 || _t4503._tag === 21) ? (_t4503._tag === 13 ? _t4503._val[1] : _t4503._val[0]) : _t4503._val[0]) : _t4503._val[0]) : _t4503._val[0]) : _t4503._val[0]) : _t4503._val[0]);
          const e2 = ((((((_t4503._tag === 13 || _t4503._tag === 21) || _t4503._tag === 28) || _t4503._tag === 32) || _t4503._tag === 31) || _t4503._tag === 27) ? (((((_t4503._tag === 13 || _t4503._tag === 21) || _t4503._tag === 28) || _t4503._tag === 32) || _t4503._tag === 31) ? ((((_t4503._tag === 13 || _t4503._tag === 21) || _t4503._tag === 28) || _t4503._tag === 32) ? (((_t4503._tag === 13 || _t4503._tag === 21) || _t4503._tag === 28) ? ((_t4503._tag === 13 || _t4503._tag === 21) ? (_t4503._tag === 13 ? _t4503._val[2] : _t4503._val[1]) : _t4503._val[1]) : _t4503._val[1]) : _t4503._val[1]) : _t4503._val[2]) : _t4503._val[1]);
          walk(e1);
          _t4504 = walk(e2);
          break _t4505;
        }
        if (_t4503._tag === 11) {
          const fn_ = _t4503._val[0];
          const arg = _t4503._val[1];
          walk(fn_);
          _t4504 = walk(arg);
          break _t4505;
        }
        if (((((((((_t4503._tag === 29 || _t4503._tag === 14) || _t4503._tag === 10) || _t4503._tag === 19) || _t4503._tag === 33) || _t4503._tag === 35) || _t4503._tag === 36) || _t4503._tag === 40) || _t4503._tag === 26)) {
          const e = ((((((((_t4503._tag === 29 || _t4503._tag === 14) || _t4503._tag === 10) || _t4503._tag === 19) || _t4503._tag === 33) || _t4503._tag === 35) || _t4503._tag === 36) || _t4503._tag === 40) ? (((((((_t4503._tag === 29 || _t4503._tag === 14) || _t4503._tag === 10) || _t4503._tag === 19) || _t4503._tag === 33) || _t4503._tag === 35) || _t4503._tag === 36) ? ((((((_t4503._tag === 29 || _t4503._tag === 14) || _t4503._tag === 10) || _t4503._tag === 19) || _t4503._tag === 33) || _t4503._tag === 35) ? (((((_t4503._tag === 29 || _t4503._tag === 14) || _t4503._tag === 10) || _t4503._tag === 19) || _t4503._tag === 33) ? ((((_t4503._tag === 29 || _t4503._tag === 14) || _t4503._tag === 10) || _t4503._tag === 19) ? (((_t4503._tag === 29 || _t4503._tag === 14) || _t4503._tag === 10) ? _t4503._val[1] : _t4503._val[0]) : _t4503._val) : _t4503._val) : _t4503._val) : _t4503._val) : _t4503._val[1]);
          _t4504 = walk(e);
          break _t4505;
        }
        if (_t4503._tag === 12) {
          const c = _t4503._val[0];
          const t = _t4503._val[1];
          const e = _t4503._val[2];
          walk(c);
          walk(t);
          _t4504 = walk(e);
          break _t4505;
        }
        if ((_t4503._tag === 15 || _t4503._tag === 39)) {
          const es = _t4503._val;
          _t4504 = List$iter(walk, es);
          break _t4505;
        }
        if (_t4503._tag === 38) {
          const kvs = _t4503._val;
          function _t4506(__p68) {
            let _t4508;
            const _t4507 = __p68;
            _t4509: {
              if (true) {
                const k = _t4507[0];
                const v = _t4507[1];
                walk(k);
                _t4508 = walk(v);
                break _t4509;
              }
              _match_fail("line 16190");
            }
            return _t4508;
          }
          _t4504 = List$iter(_t4506, kvs);
          break _t4505;
        }
        if (_t4503._tag === 16) {
          const fields = _t4503._val;
          function _t4510(__p69) {
            let _t4512;
            const _t4511 = __p69;
            _t4513: {
              if (true) {
                const e = _t4511[1];
                _t4512 = walk(e);
                break _t4513;
              }
              _match_fail("line 16190");
            }
            return _t4512;
          }
          _t4504 = List$iter(_t4510, fields);
          break _t4505;
        }
        if (_t4503._tag === 17) {
          const base = _t4503._val[0];
          const overrides = _t4503._val[1];
          walk(base);
          function _t4514(__p70) {
            let _t4516;
            const _t4515 = __p70;
            _t4517: {
              if (true) {
                const e = _t4515[1];
                _t4516 = walk(e);
                break _t4517;
              }
              _match_fail("line 16190");
            }
            return _t4516;
          }
          _t4504 = List$iter(_t4514, overrides);
          break _t4505;
        }
        if (_t4503._tag === 18) {
          const base = _t4503._val[0];
          const pairs = _t4503._val[1];
          walk(base);
          function _t4518(__p71) {
            let _t4520;
            const _t4519 = __p71;
            _t4521: {
              if (true) {
                const i = _t4519[0];
                const v = _t4519[1];
                walk(i);
                _t4520 = walk(v);
                break _t4521;
              }
              _match_fail("line 16190");
            }
            return _t4520;
          }
          _t4504 = List$iter(_t4518, pairs);
          break _t4505;
        }
        if (_t4503._tag === 23) {
          const arg = _t4503._val[1];
          _t4504 = Option$iter(walk, arg);
          break _t4505;
        }
        if (_t4503._tag === 24) {
          const scrutinee = _t4503._val[0];
          const arms = _t4503._val[1];
          walk(scrutinee);
          function _t4522(__p72) {
            let _t4524;
            const _t4523 = __p72;
            _t4525: {
              if (true) {
                const guard = _t4523[1];
                const body = _t4523[2];
                Option$iter(walk, guard);
                _t4524 = walk(body);
                break _t4525;
              }
              _match_fail("line 16190");
            }
            return _t4524;
          }
          _t4504 = List$iter(_t4522, arms);
          break _t4505;
        }
        if (_t4503._tag === 30) {
          const body = _t4503._val[0];
          const arms = _t4503._val[1];
          walk(body);
          function _t4526(arm) {
            let _t4528;
            const _t4527 = arm;
            _t4529: {
              if ((((_t4527._tag === 0 || _t4527._tag === 1) || _t4527._tag === 2) || _t4527._tag === 3)) {
                const e = (((_t4527._tag === 0 || _t4527._tag === 1) || _t4527._tag === 2) ? ((_t4527._tag === 0 || _t4527._tag === 1) ? (_t4527._tag === 0 ? _t4527._val[1] : _t4527._val[3]) : _t4527._val[2]) : _t4527._val[2]);
                _t4528 = walk(e);
                break _t4529;
              }
              _match_fail("line 16190");
            }
            return _t4528;
          }
          _t4504 = List$iter(_t4526, arms);
          break _t4505;
        }
        if (_t4503._tag === 37) {
          const bindings = _t4503._val[0];
          const body = _t4503._val[1];
          function _t4530(__p73) {
            let _t4532;
            const _t4531 = __p73;
            _t4533: {
              if (true) {
                const e = _t4531[1];
                _t4532 = walk(e);
                break _t4533;
              }
              _match_fail("line 16190");
            }
            return _t4532;
          }
          List$iter(_t4530, bindings);
          _t4504 = walk(body);
          break _t4505;
        }
        _match_fail("line 16190");
      }
      return _t4504;
    }
    walk(te);
    function _t4535(rgen_idx, fields, acc) {
      return ({_hd: ({re_fields: List$sort(String$compare, fields), re_rgen: rgen_idx}), _tl: acc});
    }
    const ev_list_4536 = Hashtbl$fold(_t4535, found_evidences_4433, null);
    let _t4538;
    if (_eq(ev_list_4536, null)) {
      _t4538 = scheme;
    } else {
      const __rec_upd_4539 = scheme;
      const _t4540 = ({body: __rec_upd_4539.body, constraints: __rec_upd_4539.constraints, equant: __rec_upd_4539.equant, pvquant: __rec_upd_4539.pvquant, quant: __rec_upd_4539.quant, record_evidences: ev_list_4536, rquant: __rec_upd_4539.rquant});
      _t4538 = _t4540;
    }
    const _t4537 = _t4538;
    const _t4534 = _t4537;
    const _t4451 = _t4534;
    const _t4446 = _t4451;
    const _t4434 = _t4446;
    const _t4432 = _t4434;
    const _t4387 = _t4432;
    _t4385 = _t4387;
  }
  return _t4385;
}
function Typechecker$scheme_needs_xform(scheme) {
  return (!_eq(scheme.constraints, null) || !_eq(scheme.record_evidences, null));
}
function Typechecker$improve_fundeps_in_expr(vars, type_env, te) {
  const classes_4541 = type_env.classes;
  const instances_4543 = type_env.instances;
  function _t4545(sch, ty) {
    const tgen_to_actual_4546 = Hashtbl$create(sch.quant);
    function map_tgens(s, a) {
      while (true) {
        const a_4548 = Types$repr(a);
        let _t4551;
        const _t4550 = s;
        _t4552: {
          if (_t4550._tag === 17) {
            const i = _t4550._val;
            let _t4553;
            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4546, i]))) {
              _t4553 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4546, i, a_4548]);
            } else {
              _t4553 = undefined;
            }
            _t4551 = _t4553;
            break _t4552;
          }
          if (_t4550._tag === 7) {
            const s1 = _t4550._val[0];
            const s2 = _t4550._val[2];
            let _t4555;
            const _t4554 = a_4548;
            _t4556: {
              if (_t4554._tag === 7) {
                const a1 = _t4554._val[0];
                const a2 = _t4554._val[2];
                map_tgens(s1, a1);
                const _t4557 = s2;
                const _t4558 = a2;
                s = _t4557;
                a = _t4558;
                continue;
                _t4555 = undefined;
                break _t4556;
              }
              if (true) {
                _t4555 = undefined;
                break _t4556;
              }
              _match_fail("line 16190");
            }
            _t4551 = _t4555;
            break _t4552;
          }
          if (_t4550._tag === 8) {
            const s1 = _t4550._val[0];
            const s2 = _t4550._val[2];
            let _t4560;
            const _t4559 = a_4548;
            _t4561: {
              if (_t4559._tag === 8) {
                const a1 = _t4559._val[0];
                const a2 = _t4559._val[2];
                map_tgens(s1, a1);
                const _t4562 = s2;
                const _t4563 = a2;
                s = _t4562;
                a = _t4563;
                continue;
                _t4560 = undefined;
                break _t4561;
              }
              if (true) {
                _t4560 = undefined;
                break _t4561;
              }
              _match_fail("line 16190");
            }
            _t4551 = _t4560;
            break _t4552;
          }
          if (_t4550._tag === 9) {
            const ss = _t4550._val;
            let _t4565;
            const _t4564 = a_4548;
            _t4566: {
              if (_t4564._tag === 9) {
                const aa = _t4564._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t4565 = List$iter2(map_tgens, ss, aa);
                  break _t4566;
                }
              }
              if (true) {
                _t4565 = undefined;
                break _t4566;
              }
              _match_fail("line 16190");
            }
            _t4551 = _t4565;
            break _t4552;
          }
          if (_t4550._tag === 10) {
            const s1 = _t4550._val;
            let _t4568;
            const _t4567 = a_4548;
            _t4569: {
              if (_t4567._tag === 10) {
                const a1 = _t4567._val;
                const _t4570 = s1;
                const _t4571 = a1;
                s = _t4570;
                a = _t4571;
                continue;
                _t4568 = undefined;
                break _t4569;
              }
              if (true) {
                _t4568 = undefined;
                break _t4569;
              }
              _match_fail("line 16190");
            }
            _t4551 = _t4568;
            break _t4552;
          }
          if (_t4550._tag === 14) {
            const s1 = _t4550._val;
            let _t4573;
            const _t4572 = a_4548;
            _t4574: {
              if (_t4572._tag === 14) {
                const a1 = _t4572._val;
                const _t4575 = s1;
                const _t4576 = a1;
                s = _t4575;
                a = _t4576;
                continue;
                _t4573 = undefined;
                break _t4574;
              }
              if (true) {
                _t4573 = undefined;
                break _t4574;
              }
              _match_fail("line 16190");
            }
            _t4551 = _t4573;
            break _t4552;
          }
          if (_t4550._tag === 13) {
            const sk = _t4550._val[0];
            const sv = _t4550._val[1];
            let _t4578;
            const _t4577 = a_4548;
            _t4579: {
              if (_t4577._tag === 13) {
                const ak = _t4577._val[0];
                const av = _t4577._val[1];
                map_tgens(sk, ak);
                const _t4580 = sv;
                const _t4581 = av;
                s = _t4580;
                a = _t4581;
                continue;
                _t4578 = undefined;
                break _t4579;
              }
              if (true) {
                _t4578 = undefined;
                break _t4579;
              }
              _match_fail("line 16190");
            }
            _t4551 = _t4578;
            break _t4552;
          }
          if (_t4550._tag === 12) {
            const ss = _t4550._val[1];
            let _t4583;
            const _t4582 = a_4548;
            _t4584: {
              if (_t4582._tag === 12) {
                const aa = _t4582._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t4583 = List$iter2(map_tgens, ss, aa);
                  break _t4584;
                }
              }
              if (true) {
                _t4583 = undefined;
                break _t4584;
              }
              _match_fail("line 16190");
            }
            _t4551 = _t4583;
            break _t4552;
          }
          if (true) {
            _t4551 = undefined;
            break _t4552;
          }
          _match_fail("line 16190");
        }
        const _t4549 = _t4551;
        return _t4549;
      }
    }
    map_tgens(sch.body, ty);
    function _t4586(cc) {
      function _t4587(cls) {
        return (cls.class_name === cc.cc_class);
      }
      let _t4589;
      const _t4588 = List$find(_t4587, classes_4541);
      _t4590: {
        if (_t4588._tag === 0) {
          _t4589 = undefined;
          break _t4590;
        }
        if (_t4588._tag === 1) {
          const class_def = _t4588._val;
          if (_eq(class_def.class_fundeps, null)) {
            _t4589 = undefined;
            break _t4590;
          }
        }
        if (_t4588._tag === 1) {
          const class_def = _t4588._val;
          const num_params_4591 = List$length(class_def.class_params);
          function _t4593(ca) {
            let _t4595;
            const _t4594 = ca;
            _t4596: {
              if (_t4594._tag === 0) {
                const tgen_idx = _t4594._val;
                let _t4598;
                const _t4597 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4546, tgen_idx]);
                _t4599: {
                  if (_t4597._tag === 1 && _t4597._val._tag === 16 && _t4597._val._val.contents._tag === 0) {
                    _t4598 = ({_tag: 0, _name: "None"});
                    break _t4599;
                  }
                  if (_t4597._tag === 1) {
                    const t = _t4597._val;
                    _t4598 = ({_tag: 1, _name: "Some", _val: t});
                    break _t4599;
                  }
                  if (_t4597._tag === 0) {
                    _t4598 = ({_tag: 0, _name: "None"});
                    break _t4599;
                  }
                  _match_fail("line 16190");
                }
                _t4595 = _t4598;
                break _t4596;
              }
              if (_t4594._tag === 1) {
                const ty = _t4594._val;
                let _t4601;
                const _t4600 = Types$repr(ty);
                _t4602: {
                  if (_t4600._tag === 16 && _t4600._val.contents._tag === 0) {
                    _t4601 = ({_tag: 0, _name: "None"});
                    break _t4602;
                  }
                  if (true) {
                    const t = _t4600;
                    _t4601 = ({_tag: 1, _name: "Some", _val: t});
                    break _t4602;
                  }
                  _match_fail("line 16190");
                }
                _t4595 = _t4601;
                break _t4596;
              }
              if (_t4594._tag === 2) {
                _t4595 = ({_tag: 0, _name: "None"});
                break _t4596;
              }
              if (_t4594._tag === 3) {
                _t4595 = ({_tag: 0, _name: "None"});
                break _t4596;
              }
              _match_fail("line 16190");
            }
            return _t4595;
          }
          const partial_4603 = List$map(_t4593, cc.cc_args);
          const improved_4605 = Types$improve_with_fundeps(instances_4543, class_def, partial_4603);
          function _t4607(i, opt) {
            let _t4608;
            if ((i < num_params_4591)) {
              let _t4610;
              const _t4609 = [opt, List$nth(partial_4603, i)];
              _t4611: {
                if (_t4609[0]._tag === 1 && _t4609[1]._tag === 0) {
                  const resolved_ty = _t4609[0]._val;
                  const ca_4612 = List$nth(cc.cc_args, i);
                  let _t4615;
                  const _t4614 = ca_4612;
                  _t4616: {
                    if (_t4614._tag === 0) {
                      const tgen_idx = _t4614._val;
                      _t4615 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4546, tgen_idx]);
                      break _t4616;
                    }
                    if (_t4614._tag === 1) {
                      const ty = _t4614._val;
                      _t4615 = ({_tag: 1, _name: "Some", _val: ty});
                      break _t4616;
                    }
                    if (_t4614._tag === 2) {
                      _t4615 = ({_tag: 0, _name: "None"});
                      break _t4616;
                    }
                    if (_t4614._tag === 3) {
                      _t4615 = ({_tag: 0, _name: "None"});
                      break _t4616;
                    }
                    _match_fail("line 16190");
                  }
                  const tvar_opt_4617 = _t4615;
                  let _t4620;
                  const _t4619 = tvar_opt_4617;
                  _t4621: {
                    if (_t4619._tag === 1 && _t4619._val._tag === 16 && _t4619._val._val.contents._tag === 0) {
                      const r = _t4619._val._val;
                      _t4620 = Types$unify(({_tag: 16, _name: "TVar", _val: r}), resolved_ty);
                      break _t4621;
                    }
                    if (true) {
                      _t4620 = undefined;
                      break _t4621;
                    }
                    _match_fail("line 16190");
                  }
                  const _t4618 = _t4620;
                  const _t4613 = _t4618;
                  _t4610 = _t4613;
                  break _t4611;
                }
                if (true) {
                  _t4610 = undefined;
                  break _t4611;
                }
                _match_fail("line 16190");
              }
              _t4608 = _t4610;
            } else {
              _t4608 = undefined;
            }
            return _t4608;
          }
          const _t4606 = List$iteri(_t4607, improved_4605);
          const _t4604 = _t4606;
          const _t4592 = _t4604;
          _t4589 = _t4592;
          break _t4590;
        }
        _match_fail("line 16190");
      }
      return _t4589;
    }
    const _t4585 = List$iter(_t4586, sch.constraints);
    const _t4547 = _t4585;
    return _t4547;
  }
  const improve_constrained_call_with_scheme_4622 = _t4545;
  function _t4624(name, ty) {
    let _t4626;
    const _t4625 = Types$find_method_class(classes_4541, name);
    _t4627: {
      if (_t4625._tag === 1) {
        const result = _t4625;
        _t4626 = [result, name];
        break _t4627;
      }
      if (_t4625._tag === 0) {
        let _t4629;
        const _t4628 = String$rindex_opt(name, 46);
        _t4630: {
          if (_t4628._tag === 0) {
            _t4629 = [({_tag: 0, _name: "None"}), name];
            break _t4630;
          }
          if (_t4628._tag === 1) {
            const i = _t4628._val;
            const mod_prefix_4631 = String$sub(name, 0, (i + 1));
            const _mml$short_4633 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
            const class_prefix_4635 = String$sub(name, 0, i);
            let _t4638;
            const _t4637 = Types$find_method_class(classes_4541, _mml$short_4633);
            _t4639: {
              if (_t4637._tag === 1) {
                const class_def = _t4637._val;
                if ((class_def.class_name === class_prefix_4635)) {
                  _t4638 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_4633];
                  break _t4639;
                }
              }
              if (_t4637._tag === 1) {
                const class_def = _t4637._val;
                if (((String$length(class_def.class_name) > String$length(mod_prefix_4631)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_4631)) === mod_prefix_4631))) {
                  _t4638 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_4633];
                  break _t4639;
                }
              }
              if (true) {
                _t4638 = [({_tag: 0, _name: "None"}), name];
                break _t4639;
              }
              _match_fail("line 16190");
            }
            const _t4636 = _t4638;
            const _t4634 = _t4636;
            const _t4632 = _t4634;
            _t4629 = _t4632;
            break _t4630;
          }
          _match_fail("line 16190");
        }
        _t4626 = _t4629;
        break _t4627;
      }
      _match_fail("line 16190");
    }
    let _t4641;
    const _t4640 = _t4626;
    _t4642: {
      if (true) {
        const class_opt = _t4640[0];
        const method_name = _t4640[1];
        let _t4644;
        const _t4643 = class_opt;
        _t4645: {
          if (_t4643._tag === 1) {
            const class_def = _t4643._val;
            if (!_eq(class_def.class_fundeps, null)) {
              const method_schema_ty_4646 = List$assoc(method_name, class_def.class_methods);
              const num_params_4648 = List$length(class_def.class_params);
              const found_4650 = Hashtbl$create(num_params_4648);
              function go(s, r) {
                while (true) {
                  const r_4652 = Types$repr(r);
                  let _t4655;
                  const _t4654 = [s, r_4652];
                  _t4656: {
                    if (_t4654[0]._tag === 17) {
                      const i = _t4654[0]._val;
                      if ((i < num_params_4648)) {
                        let _t4657;
                        if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, found_4650, i]))) {
                          _t4657 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_4650, i, r_4652]);
                        } else {
                          _t4657 = undefined;
                        }
                        _t4655 = _t4657;
                        break _t4656;
                      }
                    }
                    if ((_t4654[0]._tag === 7 && _t4654[1]._tag === 7 || _t4654[0]._tag === 8 && _t4654[1]._tag === 8)) {
                      const s1 = _t4654[0]._val[0];
                      const s2 = _t4654[0]._val[2];
                      const r1 = _t4654[1]._val[0];
                      const r2 = _t4654[1]._val[2];
                      go(s1, r1);
                      const _t4658 = s2;
                      const _t4659 = r2;
                      s = _t4658;
                      r = _t4659;
                      continue;
                      _t4655 = undefined;
                      break _t4656;
                    }
                    if (_t4654[0]._tag === 9 && _t4654[1]._tag === 9) {
                      const ss = _t4654[0]._val;
                      const rs = _t4654[1]._val;
                      if ((List$length(ss) === List$length(rs))) {
                        _t4655 = List$iter2(go, ss, rs);
                        break _t4656;
                      }
                    }
                    if (_t4654[0]._tag === 10 && _t4654[1]._tag === 10) {
                      const s1 = _t4654[0]._val;
                      const r1 = _t4654[1]._val;
                      const _t4660 = s1;
                      const _t4661 = r1;
                      s = _t4660;
                      r = _t4661;
                      continue;
                      _t4655 = undefined;
                      break _t4656;
                    }
                    if (_t4654[0]._tag === 14 && _t4654[1]._tag === 14) {
                      const s1 = _t4654[0]._val;
                      const r1 = _t4654[1]._val;
                      const _t4662 = s1;
                      const _t4663 = r1;
                      s = _t4662;
                      r = _t4663;
                      continue;
                      _t4655 = undefined;
                      break _t4656;
                    }
                    if (_t4654[0]._tag === 13 && _t4654[1]._tag === 13) {
                      const sk = _t4654[0]._val[0];
                      const sv = _t4654[0]._val[1];
                      const rk = _t4654[1]._val[0];
                      const rv = _t4654[1]._val[1];
                      go(sk, rk);
                      const _t4664 = sv;
                      const _t4665 = rv;
                      s = _t4664;
                      r = _t4665;
                      continue;
                      _t4655 = undefined;
                      break _t4656;
                    }
                    if (_t4654[0]._tag === 12 && _t4654[1]._tag === 12) {
                      const ss = _t4654[0]._val[1];
                      const rs = _t4654[1]._val[1];
                      if ((List$length(ss) === List$length(rs))) {
                        _t4655 = List$iter2(go, ss, rs);
                        break _t4656;
                      }
                    }
                    if (true) {
                      _t4655 = undefined;
                      break _t4656;
                    }
                    _match_fail("line 16190");
                  }
                  const _t4653 = _t4655;
                  return _t4653;
                }
              }
              go(method_schema_ty_4646, ty);
              function _t4667(i) {
                let _t4669;
                const _t4668 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_4650, i]);
                _t4670: {
                  if (_t4668._tag === 1 && _t4668._val._tag === 16 && _t4668._val._val.contents._tag === 0) {
                    _t4669 = ({_tag: 0, _name: "None"});
                    break _t4670;
                  }
                  if (_t4668._tag === 1) {
                    const t = _t4668._val;
                    _t4669 = ({_tag: 1, _name: "Some", _val: t});
                    break _t4670;
                  }
                  if (_t4668._tag === 0) {
                    _t4669 = ({_tag: 0, _name: "None"});
                    break _t4670;
                  }
                  _match_fail("line 16190");
                }
                return _t4669;
              }
              const partial_4671 = List$init(num_params_4648, _t4667);
              const improved_4673 = Types$improve_with_fundeps(instances_4543, class_def, partial_4671);
              function _t4675(i, opt) {
                let _t4677;
                const _t4676 = [opt, List$nth(partial_4671, i)];
                _t4678: {
                  if (_t4676[0]._tag === 1 && _t4676[1]._tag === 0) {
                    const resolved_ty = _t4676[0]._val;
                    let _t4680;
                    const _t4679 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_4650, i]);
                    _t4681: {
                      if (_t4679._tag === 1 && _t4679._val._tag === 16 && _t4679._val._val.contents._tag === 0) {
                        const r = _t4679._val._val;
                        _t4680 = Types$unify(({_tag: 16, _name: "TVar", _val: r}), resolved_ty);
                        break _t4681;
                      }
                      if (true) {
                        _t4680 = undefined;
                        break _t4681;
                      }
                      _match_fail("line 16190");
                    }
                    _t4677 = _t4680;
                    break _t4678;
                  }
                  if (true) {
                    _t4677 = undefined;
                    break _t4678;
                  }
                  _match_fail("line 16190");
                }
                return _t4677;
              }
              const _t4674 = List$iteri(_t4675, improved_4673);
              const _t4672 = _t4674;
              const _t4666 = _t4672;
              const _t4651 = _t4666;
              const _t4649 = _t4651;
              const _t4647 = _t4649;
              _t4644 = _t4647;
              break _t4645;
            }
          }
          if (true) {
            _t4644 = undefined;
            break _t4645;
          }
          _match_fail("line 16190");
        }
        _t4641 = _t4644;
        break _t4642;
      }
      _match_fail("line 16190");
    }
    return _t4641;
  }
  const improve_method_call_4682 = _t4624;
  function walk(locals, te) {
    let _t4685;
    const _t4684 = te.expr;
    _t4686: {
      if (_t4684._tag === 7) {
        const name = _t4684._val;
        improve_method_call_4682(name, te.ty);
        _t4685 = improve_constrained_call_local(locals, name, te.ty);
        break _t4686;
      }
      if (true) {
        _t4685 = undefined;
        break _t4686;
      }
      _match_fail("line 16190");
    }
    _t4685;
    return walk_children(locals, te);
  }
  function improve_constrained_call_local(locals, name, ty) {
    let _t4688;
    const _t4687 = List$assoc_opt(name, locals);
    _t4689: {
      if (_t4687._tag === 1) {
        const s = _t4687;
        _t4688 = s;
        break _t4689;
      }
      if (_t4687._tag === 0) {
        let _t4691;
        const _t4690 = List$assoc_opt(name, vars);
        _t4692: {
          if (_t4690._tag === 1) {
            const s = _t4690._val;
            if (!_eq(s.constraints, null)) {
              _t4691 = ({_tag: 1, _name: "Some", _val: s});
              break _t4692;
            }
          }
          if (true) {
            _t4691 = ({_tag: 0, _name: "None"});
            break _t4692;
          }
          _match_fail("line 16190");
        }
        _t4688 = _t4691;
        break _t4689;
      }
      _match_fail("line 16190");
    }
    const scheme_4693 = _t4688;
    let _t4696;
    const _t4695 = scheme_4693;
    _t4697: {
      if (_t4695._tag === 0) {
        _t4696 = undefined;
        break _t4697;
      }
      if (_t4695._tag === 1) {
        const sch = _t4695._val;
        _t4696 = improve_constrained_call_with_scheme_4622(sch, ty);
        break _t4697;
      }
      _match_fail("line 16190");
    }
    const _t4694 = _t4696;
    return _t4694;
  }
  function walk_children(locals, te) {
    let _t4699;
    const _t4698 = te.expr;
    _t4700: {
      if (((((((((_t4698._tag === 0 || _t4698._tag === 1) || _t4698._tag === 2) || _t4698._tag === 3) || _t4698._tag === 4) || _t4698._tag === 5) || _t4698._tag === 6) || _t4698._tag === 7) || _t4698._tag === 22)) {
        _t4699 = undefined;
        break _t4700;
      }
      if (_t4698._tag === 8) {
        const name = _t4698._val[0];
        const sch_opt = _t4698._val[1];
        const e1 = _t4698._val[2];
        const e2 = _t4698._val[3];
        walk(locals, e1);
        let _t4702;
        const _t4701 = sch_opt;
        _t4703: {
          if (_t4701._tag === 1) {
            const sch = _t4701._val;
            if (!_eq(sch.constraints, null)) {
              _t4702 = ({_hd: [name, sch], _tl: locals});
              break _t4703;
            }
          }
          if (true) {
            _t4702 = locals;
            break _t4703;
          }
          _match_fail("line 16190");
        }
        const locals$p_4704 = _t4702;
        const _t4705 = walk(locals$p_4704, e2);
        _t4699 = _t4705;
        break _t4700;
      }
      if (_t4698._tag === 9) {
        const name = _t4698._val[0];
        const sch_opt = _t4698._val[1];
        const e1 = _t4698._val[2];
        const e2 = _t4698._val[3];
        let _t4707;
        const _t4706 = sch_opt;
        _t4708: {
          if (_t4706._tag === 1) {
            const sch = _t4706._val;
            if (!_eq(sch.constraints, null)) {
              _t4707 = ({_hd: [name, sch], _tl: locals});
              break _t4708;
            }
          }
          if (true) {
            _t4707 = locals;
            break _t4708;
          }
          _match_fail("line 16190");
        }
        const locals$p_4709 = _t4707;
        walk(locals$p_4709, e1);
        const _t4710 = walk(locals$p_4709, e2);
        _t4699 = _t4710;
        break _t4700;
      }
      if (_t4698._tag === 25) {
        const e1 = _t4698._val[1];
        const e2 = _t4698._val[2];
        walk(locals, e1);
        _t4699 = walk(locals, e2);
        break _t4700;
      }
      if (_t4698._tag === 10) {
        const body = _t4698._val[1];
        _t4699 = walk(locals, body);
        break _t4700;
      }
      if (_t4698._tag === 11) {
        const f = _t4698._val[0];
        const a = _t4698._val[1];
        walk(locals, f);
        _t4699 = walk(locals, a);
        break _t4700;
      }
      if (_t4698._tag === 12) {
        const c = _t4698._val[0];
        const t = _t4698._val[1];
        const e = _t4698._val[2];
        walk(locals, c);
        walk(locals, t);
        _t4699 = walk(locals, e);
        break _t4700;
      }
      if (_t4698._tag === 13) {
        const l = _t4698._val[1];
        const r = _t4698._val[2];
        walk(locals, l);
        _t4699 = walk(locals, r);
        break _t4700;
      }
      if (_t4698._tag === 14) {
        const e = _t4698._val[1];
        _t4699 = walk(locals, e);
        break _t4700;
      }
      if (_t4698._tag === 15) {
        const es = _t4698._val;
        _t4699 = List$iter(_call(walk, [locals]), es);
        break _t4700;
      }
      if (_t4698._tag === 16) {
        const fs = _t4698._val;
        function _t4711(__p74) {
          let _t4713;
          const _t4712 = __p74;
          _t4714: {
            if (true) {
              const e = _t4712[1];
              _t4713 = walk(locals, e);
              break _t4714;
            }
            _match_fail("line 16190");
          }
          return _t4713;
        }
        _t4699 = List$iter(_t4711, fs);
        break _t4700;
      }
      if (_t4698._tag === 17) {
        const base = _t4698._val[0];
        const overrides = _t4698._val[1];
        walk(locals, base);
        function _t4715(__p75) {
          let _t4717;
          const _t4716 = __p75;
          _t4718: {
            if (true) {
              const e = _t4716[1];
              _t4717 = walk(locals, e);
              break _t4718;
            }
            _match_fail("line 16190");
          }
          return _t4717;
        }
        _t4699 = List$iter(_t4715, overrides);
        break _t4700;
      }
      if (_t4698._tag === 18) {
        const base = _t4698._val[0];
        const pairs = _t4698._val[1];
        walk(locals, base);
        function _t4719(__p76) {
          let _t4721;
          const _t4720 = __p76;
          _t4722: {
            if (true) {
              const i = _t4720[0];
              const v = _t4720[1];
              walk(locals, i);
              _t4721 = walk(locals, v);
              break _t4722;
            }
            _match_fail("line 16190");
          }
          return _t4721;
        }
        _t4699 = List$iter(_t4719, pairs);
        break _t4700;
      }
      if (_t4698._tag === 19) {
        const e = _t4698._val[0];
        _t4699 = walk(locals, e);
        break _t4700;
      }
      if (_t4698._tag === 20) {
        const e = _t4698._val[0];
        const i = _t4698._val[1];
        walk(locals, e);
        _t4699 = walk(locals, i);
        break _t4700;
      }
      if (_t4698._tag === 21) {
        const h = _t4698._val[0];
        const t = _t4698._val[1];
        walk(locals, h);
        _t4699 = walk(locals, t);
        break _t4700;
      }
      if (_t4698._tag === 23) {
        const arg = _t4698._val[1];
        _t4699 = Option$iter(_call(walk, [locals]), arg);
        break _t4700;
      }
      if (_t4698._tag === 24) {
        const s = _t4698._val[0];
        const arms = _t4698._val[1];
        walk(locals, s);
        function _t4723(__p77) {
          let _t4725;
          const _t4724 = __p77;
          _t4726: {
            if (true) {
              const g = _t4724[1];
              const b = _t4724[2];
              Option$iter(_call(walk, [locals]), g);
              _t4725 = walk(locals, b);
              break _t4726;
            }
            _match_fail("line 16190");
          }
          return _t4725;
        }
        _t4699 = List$iter(_t4723, arms);
        break _t4700;
      }
      if (_t4698._tag === 26) {
        const e = _t4698._val[1];
        _t4699 = walk(locals, e);
        break _t4700;
      }
      if (_t4698._tag === 27) {
        const e = _t4698._val[0];
        const v = _t4698._val[2];
        walk(locals, e);
        _t4699 = walk(locals, v);
        break _t4700;
      }
      if (_t4698._tag === 28) {
        const e1 = _t4698._val[0];
        const e2 = _t4698._val[1];
        walk(locals, e1);
        _t4699 = walk(locals, e2);
        break _t4700;
      }
      if (_t4698._tag === 39) {
        const es = _t4698._val;
        _t4699 = List$iter(_call(walk, [locals]), es);
        break _t4700;
      }
      if (_t4698._tag === 38) {
        const kvs = _t4698._val;
        function _t4727(__p78) {
          let _t4729;
          const _t4728 = __p78;
          _t4730: {
            if (true) {
              const k = _t4728[0];
              const v = _t4728[1];
              walk(locals, k);
              _t4729 = walk(locals, v);
              break _t4730;
            }
            _match_fail("line 16190");
          }
          return _t4729;
        }
        _t4699 = List$iter(_t4727, kvs);
        break _t4700;
      }
      if (_t4698._tag === 32) {
        const c = _t4698._val[0];
        const b = _t4698._val[1];
        walk(locals, c);
        _t4699 = walk(locals, b);
        break _t4700;
      }
      if (_t4698._tag === 36) {
        const e = _t4698._val;
        _t4699 = walk(locals, e);
        break _t4700;
      }
      if (_t4698._tag === 40) {
        const e = _t4698._val;
        _t4699 = walk(locals, e);
        break _t4700;
      }
      if (_t4698._tag === 33) {
        const e = _t4698._val;
        _t4699 = walk(locals, e);
        break _t4700;
      }
      if ((_t4698._tag === 34 || _t4698._tag === 35)) {
        _t4699 = undefined;
        break _t4700;
      }
      if (_t4698._tag === 29) {
        const e = _t4698._val[1];
        _t4699 = walk(locals, e);
        break _t4700;
      }
      if (_t4698._tag === 30) {
        const e = _t4698._val[0];
        const arms = _t4698._val[1];
        walk(locals, e);
        function _t4731(arm) {
          let _t4733;
          const _t4732 = arm;
          _t4734: {
            if ((((_t4732._tag === 0 || _t4732._tag === 1) || _t4732._tag === 2) || _t4732._tag === 3)) {
              const body = (((_t4732._tag === 0 || _t4732._tag === 1) || _t4732._tag === 2) ? ((_t4732._tag === 0 || _t4732._tag === 1) ? (_t4732._tag === 0 ? _t4732._val[1] : _t4732._val[3]) : _t4732._val[2]) : _t4732._val[2]);
              _t4733 = walk(locals, body);
              break _t4734;
            }
            _match_fail("line 16190");
          }
          return _t4733;
        }
        _t4699 = List$iter(_t4731, arms);
        break _t4700;
      }
      if (_t4698._tag === 31) {
        const e1 = _t4698._val[0];
        const e2 = _t4698._val[1];
        walk(locals, e1);
        _t4699 = walk(locals, e2);
        break _t4700;
      }
      if (_t4698._tag === 37) {
        const bindings = _t4698._val[0];
        const body = _t4698._val[1];
        function _t4735(__p79) {
          let _t4737;
          const _t4736 = __p79;
          _t4738: {
            if (true) {
              const e = _t4736[1];
              _t4737 = walk(locals, e);
              break _t4738;
            }
            _match_fail("line 16190");
          }
          return _t4737;
        }
        List$iter(_t4735, bindings);
        _t4699 = walk(locals, body);
        break _t4700;
      }
      _match_fail("line 16190");
    }
    return _t4699;
  }
  const _t4739 = walk(null, te);
  const _t4683 = _t4739;
  const _t4623 = _t4683;
  const _t4544 = _t4623;
  const _t4542 = _t4544;
  return _t4542;
}
function Typechecker$is_syntactic_value(expr) {
  while (true) {
    let _t4741;
    const _t4740 = expr;
    _t4742: {
      if (((((((_t4740._tag === 0 || _t4740._tag === 1) || _t4740._tag === 2) || _t4740._tag === 3) || _t4740._tag === 4) || _t4740._tag === 5) || _t4740._tag === 6)) {
        _t4741 = true;
        break _t4742;
      }
      if (_t4740._tag === 7) {
        _t4741 = true;
        break _t4742;
      }
      if (_t4740._tag === 10) {
        _t4741 = true;
        break _t4742;
      }
      if (_t4740._tag === 21) {
        _t4741 = true;
        break _t4742;
      }
      if (_t4740._tag === 24 && _t4740._val[1]._tag === 0) {
        _t4741 = true;
        break _t4742;
      }
      if (_t4740._tag === 24 && _t4740._val[1]._tag === 1) {
        const e = _t4740._val[1]._val;
        const _t4743 = e;
        expr = _t4743;
        continue;
        _t4741 = undefined;
        break _t4742;
      }
      if ((_t4740._tag === 15 || _t4740._tag === 22)) {
        const es = _t4740._val;
        _t4741 = List$forall(Typechecker$is_syntactic_value, es);
        break _t4742;
      }
      if (_t4740._tag === 16) {
        const fields = _t4740._val;
        function _t4744(__p80) {
          let _t4746;
          const _t4745 = __p80;
          _t4747: {
            if (true) {
              const e = _t4745[1];
              _t4746 = Typechecker$is_syntactic_value(e);
              break _t4747;
            }
            _match_fail("line 16190");
          }
          return _t4746;
        }
        _t4741 = List$forall(_t4744, fields);
        break _t4742;
      }
      if (_t4740._tag === 20) {
        const a = _t4740._val[0];
        const b = _t4740._val[1];
        _t4741 = (Typechecker$is_syntactic_value(a) && Typechecker$is_syntactic_value(b));
        break _t4742;
      }
      if (_t4740._tag === 46 && _t4740._val[1]._tag === 0) {
        _t4741 = true;
        break _t4742;
      }
      if (_t4740._tag === 46 && _t4740._val[1]._tag === 1) {
        const e = _t4740._val[1]._val;
        const _t4748 = e;
        expr = _t4748;
        continue;
        _t4741 = undefined;
        break _t4742;
      }
      if (((_t4740._tag === 30 || _t4740._tag === 47) || _t4740._tag === 49)) {
        const e = ((_t4740._tag === 30 || _t4740._tag === 47) ? _t4740._val[0] : _t4740._val[1]);
        const _t4749 = e;
        expr = _t4749;
        continue;
        _t4741 = undefined;
        break _t4742;
      }
      if (true) {
        _t4741 = false;
        break _t4742;
      }
      _match_fail("line 16190");
    }
    return _t4741;
  }
}
function Typechecker$mono_scheme(ty) {
  return ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: 0, record_evidences: null, rquant: 0});
}
function Typechecker$synth(ctx, level, expr) {
  while (true) {
    let _t4751;
    const _t4750 = expr;
    _t4752: {
      if (_t4750._tag === 49) {
        const loc = _t4750._val[0];
        const inner = _t4750._val[1];
        Ref$set(Typechecker$current_loc, loc);
        const _t4753 = ctx;
        const _t4754 = level;
        const _t4755 = inner;
        ctx = _t4753;
        level = _t4754;
        expr = _t4755;
        continue;
        _t4751 = undefined;
        break _t4752;
      }
      if (_t4750._tag === 0) {
        const n = _t4750._val;
        _t4751 = Typechecker$mk(({_tag: 0, _name: "TEInt", _val: n}), ({_tag: 0, _name: "TInt"}));
        break _t4752;
      }
      if (_t4750._tag === 1) {
        const f = _t4750._val;
        _t4751 = Typechecker$mk(({_tag: 1, _name: "TEFloat", _val: f}), ({_tag: 1, _name: "TFloat"}));
        break _t4752;
      }
      if (_t4750._tag === 2) {
        const b = _t4750._val;
        _t4751 = Typechecker$mk(({_tag: 2, _name: "TEBool", _val: b}), ({_tag: 2, _name: "TBool"}));
        break _t4752;
      }
      if (_t4750._tag === 3) {
        const s = _t4750._val;
        _t4751 = Typechecker$mk(({_tag: 3, _name: "TEString", _val: s}), ({_tag: 3, _name: "TString"}));
        break _t4752;
      }
      if (_t4750._tag === 4) {
        const n = _t4750._val;
        _t4751 = Typechecker$mk(({_tag: 4, _name: "TEByte", _val: n}), ({_tag: 4, _name: "TByte"}));
        break _t4752;
      }
      if (_t4750._tag === 5) {
        const n = _t4750._val;
        _t4751 = Typechecker$mk(({_tag: 5, _name: "TERune", _val: n}), ({_tag: 5, _name: "TRune"}));
        break _t4752;
      }
      if (_t4750._tag === 6) {
        _t4751 = Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}));
        break _t4752;
      }
      if (_t4750._tag === 21) {
        _t4751 = Typechecker$mk(({_tag: 22, _name: "TENil"}), ({_tag: 10, _name: "TList", _val: Types$new_tvar(level)}));
        break _t4752;
      }
      if (_t4750._tag === 7) {
        const name = _t4750._val;
        const ty_4756 = Typechecker$lookup_var(ctx, level, name);
        const resolved_name_4758 = Typechecker$resolve_module_name(ctx, name);
        const _t4759 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: resolved_name_4758}), ty_4756);
        const _t4757 = _t4759;
        _t4751 = _t4757;
        break _t4752;
      }
      if (_t4750._tag === 13) {
        const op = _t4750._val[0];
        const e1 = _t4750._val[1];
        const e2 = _t4750._val[2];
        _t4751 = Typechecker$synth_binop(ctx, level, op, e1, e2);
        break _t4752;
      }
      if (_t4750._tag === 14) {
        const op = _t4750._val[0];
        const e = _t4750._val[1];
        _t4751 = Typechecker$synth_unop(ctx, level, op, e);
        break _t4752;
      }
      if (_t4750._tag === 11) {
        const fn_ = _t4750._val[0];
        const arg = _t4750._val[1];
        const fn_te_4760 = Typechecker$synth(ctx, level, fn_);
        const arg_te_4762 = Typechecker$synth(ctx, level, arg);
        const ret_ty_4764 = Types$new_tvar(level);
        const call_eff_4766 = Types$new_effvar(level);
        Typechecker$try_unify(fn_te_4760.ty, ({_tag: 7, _name: "TArrow", _val: [arg_te_4762.ty, call_eff_4766, ret_ty_4764]}));
        Typechecker$try_subeffect(call_eff_4766, ctx.current_eff);
        const _t4767 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_te_4760, arg_te_4762]}), ret_ty_4764);
        const _t4765 = _t4767;
        const _t4763 = _t4765;
        const _t4761 = _t4763;
        _t4751 = _t4761;
        break _t4752;
      }
      if (_t4750._tag === 10) {
        const param = _t4750._val[0];
        const body = _t4750._val[1];
        let _t4769;
        const _t4768 = param.annot;
        _t4770: {
          if (_t4768._tag === 1) {
            const annot = _t4768._val;
            _t4769 = Typechecker$resolve_ty_annot(ctx, level, annot);
            break _t4770;
          }
          if (_t4768._tag === 0) {
            _t4769 = Types$new_tvar(level);
            break _t4770;
          }
          _match_fail("line 16190");
        }
        const param_ty_4771 = _t4769;
        const body_eff_4773 = Types$new_effvar(level);
        const ret_ty_4775 = Types$new_tvar(level);
        let _t4777;
        if (param.is_generated) {
          const __rec_upd_4778 = ctx;
          const _t4779 = ({constraint_tvars: __rec_upd_4778.constraint_tvars, current_eff: body_eff_4773, current_module: __rec_upd_4778.current_module, inside_handler: __rec_upd_4778.inside_handler, loop_info: __rec_upd_4778.loop_info, mutable_vars: __rec_upd_4778.mutable_vars, return_type: __rec_upd_4778.return_type, return_used: __rec_upd_4778.return_used, type_env: __rec_upd_4778.type_env, vars: __rec_upd_4778.vars});
          _t4777 = _t4779;
        } else {
          const return_used_4780 = Ref$create(false);
          const __rec_upd_4782 = ctx;
          const _t4783 = ({constraint_tvars: __rec_upd_4782.constraint_tvars, current_eff: body_eff_4773, current_module: __rec_upd_4782.current_module, inside_handler: false, loop_info: __rec_upd_4782.loop_info, mutable_vars: __rec_upd_4782.mutable_vars, return_type: ({_tag: 1, _name: "Some", _val: ret_ty_4775}), return_used: return_used_4780, type_env: __rec_upd_4782.type_env, vars: __rec_upd_4782.vars});
          const _t4781 = _t4783;
          _t4777 = _t4781;
        }
        const ctx$p_4784 = _t4777;
        const ctx$p_4786 = Typechecker$extend_var_mono(ctx$p_4784, param.name, param_ty_4771);
        const body_te_4788 = Typechecker$synth(ctx$p_4786, level, body);
        Typechecker$try_unify(body_te_4788.ty, ret_ty_4775);
        let _t4790;
        if (param.is_generated) {
          _t4790 = false;
        } else {
          _t4790 = Ref$get(ctx$p_4786.return_used);
        }
        const has_return_4791 = _t4790;
        const _t4792 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param.name, body_te_4788, has_return_4791]}), ({_tag: 7, _name: "TArrow", _val: [param_ty_4771, body_eff_4773, ret_ty_4775]}));
        const _t4789 = _t4792;
        const _t4787 = _t4789;
        const _t4785 = _t4787;
        const _t4776 = _t4785;
        const _t4774 = _t4776;
        const _t4772 = _t4774;
        _t4751 = _t4772;
        break _t4752;
      }
      if (_t4750._tag === 8) {
        const name = _t4750._val[0];
        const e1 = _t4750._val[1];
        const e2 = _t4750._val[2];
        const e1_te_4793 = Typechecker$synth(ctx, (level + 1), e1);
        Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, e1_te_4793);
        let _t4795;
        if (Typechecker$is_syntactic_value(e1)) {
          _t4795 = Types$generalize(level, e1_te_4793.ty);
        } else {
          _t4795 = Typechecker$mono_scheme(e1_te_4793.ty);
        }
        const scheme_4796 = _t4795;
        const scheme_4798 = Typechecker$infer_implicit_constraints("", ctx.type_env, ctx.vars, e1_te_4793, scheme_4796);
        const scheme_4800 = Typechecker$infer_record_evidence(ctx.vars, e1_te_4793, scheme_4798);
        let _t4802;
        if (Typechecker$scheme_needs_xform(scheme_4800)) {
          _t4802 = ({_tag: 1, _name: "Some", _val: scheme_4800});
        } else {
          _t4802 = ({_tag: 0, _name: "None"});
        }
        const stored_scheme_4803 = _t4802;
        const ctx$p_4805 = Typechecker$extend_var(ctx, name, scheme_4800);
        const e2_te_4807 = Typechecker$synth(ctx$p_4805, level, e2);
        const _t4808 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [name, stored_scheme_4803, e1_te_4793, e2_te_4807]}), e2_te_4807.ty);
        const _t4806 = _t4808;
        const _t4804 = _t4806;
        const _t4801 = _t4804;
        const _t4799 = _t4801;
        const _t4797 = _t4799;
        const _t4794 = _t4797;
        _t4751 = _t4794;
        break _t4752;
      }
      if (_t4750._tag === 26) {
        const name = _t4750._val[0];
        const e1 = _t4750._val[1];
        const e2 = _t4750._val[2];
        const e1_te_4809 = Typechecker$synth(ctx, (level + 1), e1);
        const scheme_4811 = ({body: e1_te_4809.ty, constraints: null, equant: 0, pvquant: 0, quant: 0, record_evidences: null, rquant: 0});
        const ctx$p_4813 = Typechecker$extend_var_mutable(ctx, name, scheme_4811);
        const e2_te_4815 = Typechecker$synth(ctx$p_4813, level, e2);
        const _t4816 = Typechecker$mk(({_tag: 25, _name: "TELetMut", _val: [name, e1_te_4809, e2_te_4815]}), e2_te_4815.ty);
        const _t4814 = _t4816;
        const _t4812 = _t4814;
        const _t4810 = _t4812;
        _t4751 = _t4810;
        break _t4752;
      }
      if (_t4750._tag === 27) {
        const name = _t4750._val[0];
        const e = _t4750._val[1];
        let _t4817;
        if ((!List$mem(name, ctx.mutable_vars))) {
          _t4817 = Typechecker$error((("variable " + __dict_Show_string.show(name)) + " is not mutable"));
        } else {
          _t4817 = undefined;
        }
        _t4817;
        const var_ty_4818 = Typechecker$lookup_var(ctx, level, name);
        const e_te_4820 = Typechecker$check(ctx, level, e, var_ty_4818);
        const resolved_name_4822 = Typechecker$resolve_module_name(ctx, name);
        const _t4823 = Typechecker$mk(({_tag: 26, _name: "TEAssign", _val: [resolved_name_4822, e_te_4820]}), ({_tag: 6, _name: "TUnit"}));
        const _t4821 = _t4823;
        const _t4819 = _t4821;
        _t4751 = _t4819;
        break _t4752;
      }
      if (_t4750._tag === 28) {
        const record_expr = _t4750._val[0];
        const field = _t4750._val[1];
        const value_expr = _t4750._val[2];
        const r_te_4824 = Typechecker$synth(ctx, level, record_expr);
        const field_ty_4826 = Types$new_tvar(level);
        const row_tail_4828 = Types$new_rvar(level);
        let _t4831;
        const _t4830 = Types$repr(r_te_4824.ty);
        _t4832: {
          if (_t4830._tag === 16) {
            function _t4833(__p81) {
              let _t4835;
              const _t4834 = __p81;
              _t4836: {
                if (true) {
                  const _name = _t4834[0];
                  const fields = _t4834[1];
                  _t4835 = List$mem_assoc(field, fields);
                  break _t4836;
                }
                _match_fail("line 16190");
              }
              return _t4835;
            }
            const candidates_4837 = List$filter(_t4833, ctx.type_env.records);
            let _t4840;
            const _t4839 = candidates_4837;
            _t4841: {
              if (_t4839 !== null && _t4839._tl === null) {
                const _name = _t4839._hd[0];
                const fields = _t4839._hd[1];
                const row_4842 = Typechecker$instantiate_record_row(level, fields);
                const _t4843 = Typechecker$try_unify(r_te_4824.ty, ({_tag: 11, _name: "TRecord", _val: row_4842}));
                _t4840 = _t4843;
                break _t4841;
              }
              if (true) {
                _t4840 = Typechecker$try_unify(r_te_4824.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_4826, row_tail_4828]})}));
                break _t4841;
              }
              _match_fail("line 16190");
            }
            const _t4838 = _t4840;
            _t4831 = _t4838;
            break _t4832;
          }
          if (true) {
            _t4831 = Typechecker$try_unify(r_te_4824.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_4826, row_tail_4828]})}));
            break _t4832;
          }
          _match_fail("line 16190");
        }
        _t4831;
        let _t4845;
        const _t4844 = Types$repr(r_te_4824.ty);
        _t4846: {
          if (_t4844._tag === 11) {
            const row = _t4844._val;
            const fields_4847 = Types$record_row_to_fields(row);
            let _t4850;
            const _t4849 = List$assoc_opt(field, fields_4847);
            _t4851: {
              if (_t4849._tag === 1) {
                const ty = _t4849._val;
                _t4850 = ty;
                break _t4851;
              }
              if (_t4849._tag === 0) {
                _t4850 = Typechecker$error(("record has no field " + __dict_Show_string.show(field)));
                break _t4851;
              }
              _match_fail("line 16190");
            }
            const _t4848 = _t4850;
            _t4845 = _t4848;
            break _t4846;
          }
          if (true) {
            _t4845 = Typechecker$error("field assignment on non-record type");
            break _t4846;
          }
          _match_fail("line 16190");
        }
        const actual_field_ty_4852 = _t4845;
        let _t4854;
        if ((!List$mem(field, ctx.type_env.mutable_fields))) {
          _t4854 = Typechecker$error((("field " + __dict_Show_string.show(field)) + " is not mutable"));
        } else {
          _t4854 = undefined;
        }
        _t4854;
        const v_te_4855 = Typechecker$check(ctx, level, value_expr, actual_field_ty_4852);
        const _t4856 = Typechecker$mk(({_tag: 27, _name: "TEFieldAssign", _val: [r_te_4824, field, v_te_4855]}), ({_tag: 6, _name: "TUnit"}));
        const _t4853 = _t4856;
        const _t4829 = _t4853;
        const _t4827 = _t4829;
        const _t4825 = _t4827;
        _t4751 = _t4825;
        break _t4752;
      }
      if (_t4750._tag === 9) {
        const name = _t4750._val[0];
        const type_params = _t4750._val[1];
        const e1 = _t4750._val[2];
        const e2 = _t4750._val[3];
        let _t4858;
        const _t4857 = Typechecker$strip_loc(e1);
        _t4859: {
          if ((_t4857._tag === 10 || _t4857._tag === 30 && _t4857._val[0]._tag === 10)) {
            let _t4860;
            if (!_eq(type_params, null)) {
              let _t4862;
              const _t4861 = Typechecker$extract_fn_info(e1);
              _t4863: {
                if (true) {
                  const params = _t4861[0];
                  const ret_annot = _t4861[1];
                  const body = _t4861[2];
                  let _t4865;
                  const _t4864 = Typechecker$synth_poly_rec_fn(ctx, level, name, "", type_params, params, ret_annot, body);
                  _t4866: {
                    if (true) {
                      const e1_te = _t4864[0];
                      const scheme = _t4864[1];
                      const ctx$p_4867 = Typechecker$extend_var(ctx, name, scheme);
                      const e2_te_4869 = Typechecker$synth(ctx$p_4867, level, e2);
                      const _t4870 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 0, _name: "None"}), e1_te, e2_te_4869]}), e2_te_4869.ty);
                      const _t4868 = _t4870;
                      _t4865 = _t4868;
                      break _t4866;
                    }
                    _match_fail("line 16190");
                  }
                  _t4862 = _t4865;
                  break _t4863;
                }
                _match_fail("line 16190");
              }
              _t4860 = _t4862;
            } else {
              const fn_var_4871 = Types$new_tvar((level + 1));
              const ctx$p_4873 = Typechecker$extend_var_mono(ctx, name, fn_var_4871);
              const e1_te_4875 = Typechecker$synth(ctx$p_4873, (level + 1), e1);
              Typechecker$try_unify(fn_var_4871, e1_te_4875.ty);
              Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, e1_te_4875);
              const scheme_4877 = Types$generalize(level, e1_te_4875.ty);
              const scheme_4879 = Typechecker$infer_implicit_constraints(name, ctx.type_env, ctx.vars, e1_te_4875, scheme_4877);
              const scheme_4881 = Typechecker$infer_record_evidence(ctx.vars, e1_te_4875, scheme_4879);
              let _t4883;
              if (Typechecker$scheme_needs_xform(scheme_4881)) {
                _t4883 = ({_tag: 1, _name: "Some", _val: scheme_4881});
              } else {
                _t4883 = ({_tag: 0, _name: "None"});
              }
              const stored_scheme_4884 = _t4883;
              const ctx$p$p_4886 = Typechecker$extend_var(ctx, name, scheme_4881);
              const e2_te_4888 = Typechecker$synth(ctx$p$p_4886, level, e2);
              const _t4889 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, stored_scheme_4884, e1_te_4875, e2_te_4888]}), e2_te_4888.ty);
              const _t4887 = _t4889;
              const _t4885 = _t4887;
              const _t4882 = _t4885;
              const _t4880 = _t4882;
              const _t4878 = _t4880;
              const _t4876 = _t4878;
              const _t4874 = _t4876;
              const _t4872 = _t4874;
              _t4860 = _t4872;
            }
            _t4858 = _t4860;
            break _t4859;
          }
          if (true) {
            _t4858 = Typechecker$error("let rec binding must be a function");
            break _t4859;
          }
          _match_fail("line 16190");
        }
        _t4751 = _t4858;
        break _t4752;
      }
      if (_t4750._tag === 12) {
        const cond = _t4750._val[0];
        const then_e = _t4750._val[1];
        const else_e = _t4750._val[2];
        const cond_te_4890 = Typechecker$check(ctx, level, cond, ({_tag: 2, _name: "TBool"}));
        const then_te_4892 = Typechecker$synth(ctx, level, then_e);
        const else_te_4894 = Typechecker$check(ctx, level, else_e, then_te_4892.ty);
        const _t4895 = Typechecker$mk(({_tag: 12, _name: "TEIf", _val: [cond_te_4890, then_te_4892, else_te_4894]}), then_te_4892.ty);
        const _t4893 = _t4895;
        const _t4891 = _t4893;
        _t4751 = _t4891;
        break _t4752;
      }
      if (_t4750._tag === 15) {
        const exprs = _t4750._val;
        const tes_4896 = List$map(_call(Typechecker$synth, [ctx, level]), exprs);
        function _t4898(te) {
          return te.ty;
        }
        const tys_4899 = List$map(_t4898, tes_4896);
        const _t4900 = Typechecker$mk(({_tag: 15, _name: "TETuple", _val: tes_4896}), ({_tag: 9, _name: "TTuple", _val: tys_4899}));
        const _t4897 = _t4900;
        _t4751 = _t4897;
        break _t4752;
      }
      if (_t4750._tag === 16) {
        const fields = _t4750._val;
        function _t4901(__p82) {
          let _t4903;
          const _t4902 = __p82;
          _t4904: {
            if (true) {
              const n = _t4902[0];
              const e = _t4902[1];
              const te_4905 = Typechecker$synth(ctx, level, e);
              const _t4906 = [n, te_4905];
              _t4903 = _t4906;
              break _t4904;
            }
            _match_fail("line 16190");
          }
          return _t4903;
        }
        const typed_fields_4907 = List$map(_t4901, fields);
        function _t4909(__p83) {
          let _t4911;
          const _t4910 = __p83;
          _t4912: {
            if (true) {
              const n = _t4910[0];
              const te = _t4910[1];
              _t4911 = [n, te.ty];
              break _t4912;
            }
            _match_fail("line 16190");
          }
          return _t4911;
        }
        const field_tys_4913 = List$map(_t4909, typed_fields_4907);
        function _t4915(__p84, __p85) {
          let _t4917;
          const _t4916 = __p84;
          _t4918: {
            if (true) {
              const a = _t4916[0];
              let _t4920;
              const _t4919 = __p85;
              _t4921: {
                if (true) {
                  const b = _t4919[0];
                  _t4920 = String$compare(a, b);
                  break _t4921;
                }
                _match_fail("line 16190");
              }
              _t4917 = _t4920;
              break _t4918;
            }
            _match_fail("line 16190");
          }
          return _t4917;
        }
        const field_tys_4922 = List$sort(_t4915, field_tys_4913);
        const row_4924 = Types$fields_to_closed_row(field_tys_4922);
        const _t4925 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: typed_fields_4907}), ({_tag: 11, _name: "TRecord", _val: row_4924}));
        const _t4923 = _t4925;
        const _t4914 = _t4923;
        const _t4908 = _t4914;
        _t4751 = _t4908;
        break _t4752;
      }
      if (_t4750._tag === 17) {
        const base = _t4750._val[0];
        const overrides = _t4750._val[1];
        const base_te_4926 = Typechecker$synth(ctx, level, base);
        let _t4929;
        const _t4928 = Types$repr(base_te_4926.ty);
        _t4930: {
          if (_t4928._tag === 16) {
            const override_names_4931 = List$map(fst, overrides);
            function _t4933(__p86) {
              let _t4935;
              const _t4934 = __p86;
              _t4936: {
                if (true) {
                  const _name = _t4934[0];
                  const rfields = _t4934[1];
                  function _t4937(f) {
                    return List$mem_assoc(f, rfields);
                  }
                  _t4935 = List$forall(_t4937, override_names_4931);
                  break _t4936;
                }
                _match_fail("line 16190");
              }
              return _t4935;
            }
            const candidates_4938 = List$filter(_t4933, ctx.type_env.records);
            let _t4941;
            const _t4940 = candidates_4938;
            _t4942: {
              if (_t4940 !== null && _t4940._tl === null) {
                const rfields = _t4940._hd[1];
                const row_4943 = Typechecker$instantiate_record_row(level, rfields);
                const _t4944 = Typechecker$try_unify(base_te_4926.ty, ({_tag: 11, _name: "TRecord", _val: row_4943}));
                _t4941 = _t4944;
                break _t4942;
              }
              if (true) {
                const row_tail_4945 = Types$new_rvar(level);
                function _t4947(name, acc) {
                  return ({_tag: 0, _name: "RRow", _val: [name, Types$new_tvar(level), acc]});
                }
                const row_4948 = List$fold_right(_t4947, override_names_4931, row_tail_4945);
                const _t4949 = Typechecker$try_unify(base_te_4926.ty, ({_tag: 11, _name: "TRecord", _val: row_4948}));
                const _t4946 = _t4949;
                _t4941 = _t4946;
                break _t4942;
              }
              _match_fail("line 16190");
            }
            const _t4939 = _t4941;
            const _t4932 = _t4939;
            _t4929 = _t4932;
            break _t4930;
          }
          if (_t4928._tag === 11) {
            _t4929 = undefined;
            break _t4930;
          }
          if (true) {
            _t4929 = Typechecker$error("record update on non-record type");
            break _t4930;
          }
          _match_fail("line 16190");
        }
        _t4929;
        function _t4950(__p87) {
          let _t4952;
          const _t4951 = __p87;
          _t4953: {
            if (true) {
              const name = _t4951[0];
              const field_ty_4954 = Types$new_tvar(level);
              const row_tail_4956 = Types$new_rvar(level);
              Typechecker$try_unify(base_te_4926.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [name, field_ty_4954, row_tail_4956]})}));
              let _t4959;
              const _t4958 = Types$repr(base_te_4926.ty);
              _t4960: {
                if (_t4958._tag === 11) {
                  const row = _t4958._val;
                  const fields_4961 = Types$record_row_to_fields(row);
                  let _t4964;
                  const _t4963 = List$assoc_opt(name, fields_4961);
                  _t4965: {
                    if (_t4963._tag === 1) {
                      const ty = _t4963._val;
                      _t4964 = ty;
                      break _t4965;
                    }
                    if (_t4963._tag === 0) {
                      _t4964 = field_ty_4954;
                      break _t4965;
                    }
                    _match_fail("line 16190");
                  }
                  const _t4962 = _t4964;
                  _t4959 = _t4962;
                  break _t4960;
                }
                if (true) {
                  _t4959 = field_ty_4954;
                  break _t4960;
                }
                _match_fail("line 16190");
              }
              const actual_ty_4966 = _t4959;
              const _t4967 = [name, actual_ty_4966];
              const _t4957 = _t4967;
              const _t4955 = _t4957;
              _t4952 = _t4955;
              break _t4953;
            }
            _match_fail("line 16190");
          }
          return _t4952;
        }
        const override_field_tys_4968 = List$map(_t4950, overrides);
        function _t4970(__p88, __p89) {
          let _t4972;
          const _t4971 = __p88;
          _t4973: {
            if (true) {
              const name = _t4971[0];
              const e = _t4971[1];
              let _t4975;
              const _t4974 = __p89;
              _t4976: {
                if (true) {
                  const expected_ty = _t4974[1];
                  const te_4977 = Typechecker$check(ctx, level, e, expected_ty);
                  const _t4978 = [name, te_4977];
                  _t4975 = _t4978;
                  break _t4976;
                }
                _match_fail("line 16190");
              }
              _t4972 = _t4975;
              break _t4973;
            }
            _match_fail("line 16190");
          }
          return _t4972;
        }
        const typed_overrides_4979 = List$map2(_t4970, overrides, override_field_tys_4968);
        function has_open_tail(row) {
          while (true) {
            let _t4982;
            const _t4981 = Types$rrow_repr(row);
            _t4983: {
              if (_t4981._tag === 0) {
                const tail = _t4981._val[2];
                const _t4984 = tail;
                row = _t4984;
                continue;
                _t4982 = undefined;
                break _t4983;
              }
              if (_t4981._tag === 1 && _t4981._val.contents._tag === 0) {
                _t4982 = true;
                break _t4983;
              }
              if (true) {
                _t4982 = false;
                break _t4983;
              }
              _match_fail("line 16190");
            }
            return _t4982;
          }
        }
        let _t4987;
        const _t4986 = Types$repr(base_te_4926.ty);
        _t4988: {
          if (_t4986._tag === 11) {
            const row = _t4986._val;
            _t4987 = has_open_tail(row);
            break _t4988;
          }
          if (true) {
            _t4987 = false;
            break _t4988;
          }
          _match_fail("line 16190");
        }
        const is_open_4989 = _t4987;
        let _t4991;
        if (is_open_4989) {
          _t4991 = Typechecker$mk(({_tag: 17, _name: "TERecordUpdate", _val: [base_te_4926, typed_overrides_4979]}), base_te_4926.ty);
        } else {
          let _t4993;
          const _t4992 = Types$repr(base_te_4926.ty);
          _t4994: {
            if (_t4992._tag === 11) {
              const row = _t4992._val;
              _t4993 = Types$record_row_to_fields(row);
              break _t4994;
            }
            if (true) {
              _t4993 = Typechecker$error("record update on non-record type");
              break _t4994;
            }
            _match_fail("line 16190");
          }
          const field_tys_4995 = _t4993;
          const tmp_4997 = "__rec_upd";
          const tmp_ty_4999 = base_te_4926.ty;
          function _t5001(__p90) {
            let _t5003;
            const _t5002 = __p90;
            _t5004: {
              if (true) {
                const name = _t5002[0];
                const ty = _t5002[1];
                let _t5006;
                const _t5005 = List$assoc_opt(name, typed_overrides_4979);
                _t5007: {
                  if (_t5005._tag === 1) {
                    const te = _t5005._val;
                    _t5006 = [name, te];
                    break _t5007;
                  }
                  if (_t5005._tag === 0) {
                    _t5006 = [name, Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: tmp_4997}), tmp_ty_4999), name]}), ty)];
                    break _t5007;
                  }
                  _match_fail("line 16190");
                }
                _t5003 = _t5006;
                break _t5004;
              }
              _match_fail("line 16190");
            }
            return _t5003;
          }
          const all_fields_5008 = List$map(_t5001, field_tys_4995);
          const record_row_5010 = Types$fields_to_closed_row(field_tys_4995);
          const record_expr_5012 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: all_fields_5008}), ({_tag: 11, _name: "TRecord", _val: record_row_5010}));
          const _t5013 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [tmp_4997, ({_tag: 0, _name: "None"}), base_te_4926, record_expr_5012]}), ({_tag: 11, _name: "TRecord", _val: record_row_5010}));
          const _t5011 = _t5013;
          const _t5009 = _t5011;
          const _t5000 = _t5009;
          const _t4998 = _t5000;
          const _t4996 = _t4998;
          _t4991 = _t4996;
        }
        const _t4990 = _t4991;
        const _t4985 = _t4990;
        const _t4980 = _t4985;
        const _t4969 = _t4980;
        const _t4927 = _t4969;
        _t4751 = _t4927;
        break _t4752;
      }
      if (_t4750._tag === 18) {
        const e = _t4750._val[0];
        const field = _t4750._val[1];
        const te_5014 = Typechecker$synth(ctx, level, e);
        const field_ty_5016 = Types$new_tvar(level);
        const row_tail_5018 = Types$new_rvar(level);
        let _t5021;
        const _t5020 = Types$repr(te_5014.ty);
        _t5022: {
          if (_t5020._tag === 16) {
            function _t5023(__p91) {
              let _t5025;
              const _t5024 = __p91;
              _t5026: {
                if (true) {
                  const _name = _t5024[0];
                  const fields = _t5024[1];
                  _t5025 = List$mem_assoc(field, fields);
                  break _t5026;
                }
                _match_fail("line 16190");
              }
              return _t5025;
            }
            const candidates_5027 = List$filter(_t5023, ctx.type_env.records);
            let _t5030;
            const _t5029 = candidates_5027;
            _t5031: {
              if (_t5029 !== null && _t5029._tl === null) {
                const _name = _t5029._hd[0];
                const fields = _t5029._hd[1];
                const row_5032 = Typechecker$instantiate_record_row(level, fields);
                const _t5033 = Typechecker$try_unify(te_5014.ty, ({_tag: 11, _name: "TRecord", _val: row_5032}));
                _t5030 = _t5033;
                break _t5031;
              }
              if (true) {
                _t5030 = Typechecker$try_unify(te_5014.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_5016, row_tail_5018]})}));
                break _t5031;
              }
              _match_fail("line 16190");
            }
            const _t5028 = _t5030;
            _t5021 = _t5028;
            break _t5022;
          }
          if (true) {
            _t5021 = Typechecker$try_unify(te_5014.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_5016, row_tail_5018]})}));
            break _t5022;
          }
          _match_fail("line 16190");
        }
        _t5021;
        let _t5035;
        const _t5034 = Types$repr(te_5014.ty);
        _t5036: {
          if (_t5034._tag === 11) {
            const row = _t5034._val;
            const fields_5037 = Types$record_row_to_fields(row);
            let _t5040;
            const _t5039 = List$assoc_opt(field, fields_5037);
            _t5041: {
              if (_t5039._tag === 1) {
                const ty = _t5039._val;
                _t5040 = ty;
                break _t5041;
              }
              if (_t5039._tag === 0) {
                _t5040 = field_ty_5016;
                break _t5041;
              }
              _match_fail("line 16190");
            }
            const _t5038 = _t5040;
            _t5035 = _t5038;
            break _t5036;
          }
          if (true) {
            _t5035 = field_ty_5016;
            break _t5036;
          }
          _match_fail("line 16190");
        }
        const actual_field_ty_5042 = _t5035;
        const _t5043 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [te_5014, field]}), actual_field_ty_5042);
        const _t5019 = _t5043;
        const _t5017 = _t5019;
        const _t5015 = _t5017;
        _t4751 = _t5015;
        break _t4752;
      }
      if (_t4750._tag === 19) {
        const base = _t4750._val[0];
        const idx = _t4750._val[1];
        const te_base_5044 = Typechecker$synth(ctx, level, base);
        let _t5047;
        const _t5046 = Types$repr(te_base_5044.ty);
        _t5048: {
          if (_t5046._tag === 3) {
            const te_idx_5049 = Typechecker$check(ctx, level, idx, ({_tag: 0, _name: "TInt"}));
            const _t5050 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [te_base_5044, te_idx_5049]}), ({_tag: 4, _name: "TByte"}));
            _t5047 = _t5050;
            break _t5048;
          }
          if (_t5046._tag === 14) {
            const t = _t5046._val;
            const te_idx_5051 = Typechecker$check(ctx, level, idx, ({_tag: 0, _name: "TInt"}));
            const _t5052 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [te_base_5044, te_idx_5051]}), t);
            _t5047 = _t5052;
            break _t5048;
          }
          if (true) {
            const te_5053 = Typechecker$synth(ctx, level, ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "at"}), idx]}), base]}));
            function _t5055(c) {
              return (c.class_name === "Index");
            }
            let _t5057;
            const _t5056 = List$find(_t5055, ctx.type_env.classes);
            _t5058: {
              if (_t5056._tag === 1) {
                const class_def = _t5056._val;
                if (!_eq(class_def.class_fundeps, null)) {
                  const container_ty_5059 = Types$repr(te_base_5044.ty);
                  const partial_5061 = ({_hd: ({_tag: 1, _name: "Some", _val: container_ty_5059}), _tl: ({_hd: ({_tag: 0, _name: "None"}), _tl: ({_hd: ({_tag: 0, _name: "None"}), _tl: null})})});
                  const improved_5063 = Types$improve_with_fundeps(ctx.type_env.instances, class_def, partial_5061);
                  let _t5066;
                  const _t5065 = List$nth_opt(improved_5063, 2);
                  _t5067: {
                    if (_t5065._tag === 1 && _t5065._val._tag === 1) {
                      const val_ty = _t5065._val._val;
                      _t5066 = Typechecker$try_unify(te_5053.ty, val_ty);
                      break _t5067;
                    }
                    if (true) {
                      _t5066 = undefined;
                      break _t5067;
                    }
                    _match_fail("line 16190");
                  }
                  const _t5064 = _t5066;
                  const _t5062 = _t5064;
                  const _t5060 = _t5062;
                  _t5057 = _t5060;
                  break _t5058;
                }
              }
              if (true) {
                _t5057 = undefined;
                break _t5058;
              }
              _match_fail("line 16190");
            }
            _t5057;
            const _t5054 = te_5053;
            _t5047 = _t5054;
            break _t5048;
          }
          _match_fail("line 16190");
        }
        const _t5045 = _t5047;
        _t4751 = _t5045;
        break _t4752;
      }
      if (_t4750._tag === 20) {
        const hd = _t4750._val[0];
        const tl = _t4750._val[1];
        const hd_te_5068 = Typechecker$synth(ctx, level, hd);
        const list_ty_5070 = ({_tag: 10, _name: "TList", _val: hd_te_5068.ty});
        const tl_te_5072 = Typechecker$check(ctx, level, tl, list_ty_5070);
        const _t5073 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [hd_te_5068, tl_te_5072]}), list_ty_5070);
        const _t5071 = _t5073;
        const _t5069 = _t5071;
        _t4751 = _t5069;
        break _t4752;
      }
      if (_t4750._tag === 22 && _t4750._val !== null) {
        const first = _t4750._val._hd;
        const rest = _t4750._val._tl;
        const first_te_5074 = Typechecker$synth(ctx, level, first);
        function _t5076(e) {
          return Typechecker$check(ctx, level, e, first_te_5074.ty);
        }
        const rest_tes_5077 = List$map(_t5076, rest);
        const list_ty_5079 = ({_tag: 10, _name: "TList", _val: first_te_5074.ty});
        function _t5081(te, acc) {
          return Typechecker$mk(({_tag: 21, _name: "TECons", _val: [te, acc]}), list_ty_5079);
        }
        const _t5080 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [first_te_5074, List$fold_right(_t5081, rest_tes_5077, Typechecker$mk(({_tag: 22, _name: "TENil"}), list_ty_5079))]}), list_ty_5079);
        const _t5078 = _t5080;
        const _t5075 = _t5078;
        _t4751 = _t5075;
        break _t4752;
      }
      if (_t4750._tag === 22 && _t4750._val === null) {
        _t4751 = Typechecker$mk(({_tag: 22, _name: "TENil"}), ({_tag: 10, _name: "TList", _val: Types$new_tvar(level)}));
        break _t4752;
      }
      if (_t4750._tag === 23 && _t4750._val !== null) {
        const first = _t4750._val._hd;
        const rest = _t4750._val._tl;
        const first_te_5082 = Typechecker$synth(ctx, level, first);
        function _t5084(e) {
          return Typechecker$check(ctx, level, e, first_te_5082.ty);
        }
        const rest_tes_5085 = List$map(_t5084, rest);
        const _t5086 = Typechecker$mk(({_tag: 39, _name: "TEArray", _val: ({_hd: first_te_5082, _tl: rest_tes_5085})}), ({_tag: 14, _name: "TArray", _val: first_te_5082.ty}));
        const _t5083 = _t5086;
        _t4751 = _t5083;
        break _t4752;
      }
      if (_t4750._tag === 23 && _t4750._val === null) {
        _t4751 = Typechecker$mk(({_tag: 39, _name: "TEArray", _val: null}), ({_tag: 14, _name: "TArray", _val: Types$new_tvar(level)}));
        break _t4752;
      }
      if (_t4750._tag === 24) {
        const name = _t4750._val[0];
        const arg = _t4750._val[1];
        _t4751 = Typechecker$synth_construct(ctx, level, name, arg);
        break _t4752;
      }
      if (_t4750._tag === 25) {
        const scrut = _t4750._val[0];
        const arms = _t4750._val[1];
        const partial = _t4750._val[2];
        _t4751 = Typechecker$synth_match(({_tag: 0, _name: "None"}), ctx, level, scrut, arms, partial);
        break _t4752;
      }
      if (_t4750._tag === 29) {
        const e1 = _t4750._val[0];
        const e2 = _t4750._val[1];
        const e1_te_5087 = Typechecker$synth(ctx, level, e1);
        const e2_te_5089 = Typechecker$synth(ctx, level, e2);
        const _t5090 = Typechecker$mk(({_tag: 28, _name: "TESeq", _val: [e1_te_5087, e2_te_5089]}), e2_te_5089.ty);
        const _t5088 = _t5090;
        _t4751 = _t5088;
        break _t4752;
      }
      if (_t4750._tag === 30) {
        const e = _t4750._val[0];
        const annot = _t4750._val[1];
        const ty_5091 = Typechecker$resolve_ty_annot(ctx, level, annot);
        const te_5093 = Typechecker$check(ctx, level, e, ty_5091);
        const _t5094 = te_5093;
        const _t5092 = _t5094;
        _t4751 = _t5092;
        break _t4752;
      }
      if (_t4750._tag === 46 && _t4750._val[1]._tag === 0) {
        const tag = _t4750._val[0];
        const tail_5095 = Types$new_pvvar(level);
        const row_5097 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 0, _name: "None"}), tail_5095]});
        const _t5098 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [("`" + tag), ({_tag: 0, _name: "None"})]}), ({_tag: 15, _name: "TPolyVariant", _val: row_5097}));
        const _t5096 = _t5098;
        _t4751 = _t5096;
        break _t4752;
      }
      if (_t4750._tag === 46 && _t4750._val[1]._tag === 1) {
        const tag = _t4750._val[0];
        const arg = _t4750._val[1]._val;
        const arg_te_5099 = Typechecker$synth(ctx, level, arg);
        const tail_5101 = Types$new_pvvar(level);
        const row_5103 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 1, _name: "Some", _val: arg_te_5099.ty}), tail_5101]});
        const _t5104 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [("`" + tag), ({_tag: 1, _name: "Some", _val: arg_te_5099})]}), ({_tag: 15, _name: "TPolyVariant", _val: row_5103}));
        const _t5102 = _t5104;
        const _t5100 = _t5102;
        _t4751 = _t5100;
        break _t4752;
      }
      if (_t4750._tag === 47) {
        const inner = _t4750._val[0];
        const target_annot = _t4750._val[1];
        const inner_te_5105 = Typechecker$synth(ctx, level, inner);
        const target_ty_5107 = Typechecker$resolve_ty_annot(ctx, level, target_annot);
        Typechecker$try_unify(inner_te_5105.ty, target_ty_5107);
        const __rec_upd_5109 = inner_te_5105;
        const _t5110 = ({expr: __rec_upd_5109.expr, loc: __rec_upd_5109.loc, ty: target_ty_5107});
        const _t5108 = _t5110;
        const _t5106 = _t5108;
        _t4751 = _t5106;
        break _t4752;
      }
      if (_t4750._tag === 39) {
        const op_name = _t4750._val[0];
        const arg = _t4750._val[1];
        _t4751 = Typechecker$synth_perform(ctx, level, op_name, arg);
        break _t4752;
      }
      if (_t4750._tag === 40) {
        const body = _t4750._val[0];
        const arms = _t4750._val[1];
        _t4751 = Typechecker$synth_handle(ctx, level, body, arms);
        break _t4752;
      }
      if (_t4750._tag === 31) {
        const cond = _t4750._val[0];
        const body = _t4750._val[1];
        const __rec_upd_5111 = ctx;
        const _t5112 = ({constraint_tvars: __rec_upd_5111.constraint_tvars, current_eff: __rec_upd_5111.current_eff, current_module: __rec_upd_5111.current_module, inside_handler: __rec_upd_5111.inside_handler, loop_info: ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "WhileLoop"})}), mutable_vars: __rec_upd_5111.mutable_vars, return_type: __rec_upd_5111.return_type, return_used: __rec_upd_5111.return_used, type_env: __rec_upd_5111.type_env, vars: __rec_upd_5111.vars});
        const ctx$p_5113 = _t5112;
        const cond_te_5115 = Typechecker$check(ctx$p_5113, level, cond, ({_tag: 2, _name: "TBool"}));
        const body_te_5117 = Typechecker$check(ctx$p_5113, level, body, ({_tag: 6, _name: "TUnit"}));
        const _t5118 = Typechecker$mk(({_tag: 32, _name: "TEWhile", _val: [cond_te_5115, body_te_5117]}), ({_tag: 6, _name: "TUnit"}));
        const _t5116 = _t5118;
        const _t5114 = _t5116;
        _t4751 = _t5114;
        break _t4752;
      }
      if (_t4750._tag === 32) {
        const var_name = _t4750._val[0];
        const coll_expr = _t4750._val[1];
        const body_expr = _t4750._val[2];
        const __rec_upd_5119 = ctx;
        const _t5120 = ({constraint_tvars: __rec_upd_5119.constraint_tvars, current_eff: __rec_upd_5119.current_eff, current_module: __rec_upd_5119.current_module, inside_handler: __rec_upd_5119.inside_handler, loop_info: ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "UnitLoop"})}), mutable_vars: __rec_upd_5119.mutable_vars, return_type: __rec_upd_5119.return_type, return_used: __rec_upd_5119.return_used, type_env: __rec_upd_5119.type_env, vars: __rec_upd_5119.vars});
        const ctx$p_5121 = _t5120;
        const desugared_5123 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "fold"}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: "_"}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: var_name}), ({_tag: 29, _name: "ESeq", _val: [body_expr, ({_tag: 6, _name: "EUnit"})]})]})]})]}), ({_tag: 6, _name: "EUnit"})]}), coll_expr]});
        const fold_te_5125 = Typechecker$synth(ctx$p_5121, level, desugared_5123);
        const _t5126 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: fold_te_5125}), ({_tag: 6, _name: "TUnit"}));
        const _t5124 = _t5126;
        const _t5122 = _t5124;
        _t4751 = _t5122;
        break _t4752;
      }
      if (_t4750._tag === 33) {
        const var_name = _t4750._val[0];
        const coll_expr = _t4750._val[1];
        const acc_name = _t4750._val[2];
        const init_expr = _t4750._val[3];
        const body_expr = _t4750._val[4];
        const __rec_upd_5127 = ctx;
        const _t5128 = ({constraint_tvars: __rec_upd_5127.constraint_tvars, current_eff: __rec_upd_5127.current_eff, current_module: __rec_upd_5127.current_module, inside_handler: __rec_upd_5127.inside_handler, loop_info: ({_tag: 1, _name: "Some", _val: ({_tag: 2, _name: "FoldLoop", _val: acc_name})}), mutable_vars: __rec_upd_5127.mutable_vars, return_type: __rec_upd_5127.return_type, return_used: __rec_upd_5127.return_used, type_env: __rec_upd_5127.type_env, vars: __rec_upd_5127.vars});
        const ctx$p_5129 = _t5128;
        const desugared_5131 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "fold"}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: acc_name}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: var_name}), body_expr]})]})]}), init_expr]}), coll_expr]});
        const fold_te_5133 = Typechecker$synth(ctx$p_5129, level, desugared_5131);
        const _t5134 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: fold_te_5133}), fold_te_5133.ty);
        const _t5132 = _t5134;
        const _t5130 = _t5132;
        _t4751 = _t5130;
        break _t4752;
      }
      if (_t4750._tag === 35) {
        const value_opt = _t4750._val;
        let _t5136;
        const _t5135 = ctx.loop_info;
        _t5137: {
          if (_t5135._tag === 0) {
            _t5136 = Typechecker$error("break outside of loop");
            break _t5137;
          }
          if (_t5135._tag === 1 && _t5135._val._tag === 0) {
            let _t5138;
            if (!_eq(value_opt, ({_tag: 0, _name: "None"}))) {
              _t5138 = Typechecker$error("break with value only allowed in fold loops");
            } else {
              _t5138 = undefined;
            }
            _t5138;
            _t5136 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}))}), ({_tag: 6, _name: "TUnit"}));
            break _t5137;
          }
          if (_t5135._tag === 1 && _t5135._val._tag === 1) {
            let _t5139;
            if (!_eq(value_opt, ({_tag: 0, _name: "None"}))) {
              _t5139 = Typechecker$error("break with value only allowed in fold loops");
            } else {
              _t5139 = undefined;
            }
            _t5139;
            _t5136 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}))}), ({_tag: 6, _name: "TUnit"}));
            break _t5137;
          }
          if (_t5135._tag === 1 && _t5135._val._tag === 2) {
            const acc_name = _t5135._val._val;
            let _t5141;
            const _t5140 = value_opt;
            _t5142: {
              if (_t5140._tag === 1) {
                const e = _t5140._val;
                _t5141 = Typechecker$synth(ctx, level, e);
                break _t5142;
              }
              if (_t5140._tag === 0) {
                _t5141 = Typechecker$synth(ctx, level, ({_tag: 7, _name: "EVar", _val: acc_name}));
                break _t5142;
              }
              _match_fail("line 16190");
            }
            const v_te_5143 = _t5141;
            const _t5144 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: v_te_5143}), Types$new_tvar(level));
            _t5136 = _t5144;
            break _t5137;
          }
          _match_fail("line 16190");
        }
        _t4751 = _t5136;
        break _t4752;
      }
      if (_t4750._tag === 36) {
        let _t5146;
        const _t5145 = ctx.loop_info;
        _t5147: {
          if (_t5145._tag === 0) {
            _t5146 = Typechecker$error("continue outside of loop");
            break _t5147;
          }
          if (_t5145._tag === 1 && _t5145._val._tag === 0) {
            _t5146 = Typechecker$mk(({_tag: 34, _name: "TEContinueLoop"}), ({_tag: 6, _name: "TUnit"}));
            break _t5147;
          }
          if (_t5145._tag === 1 && _t5145._val._tag === 1) {
            _t5146 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}))}), ({_tag: 6, _name: "TUnit"}));
            break _t5147;
          }
          if (_t5145._tag === 1 && _t5145._val._tag === 2) {
            const acc_name = _t5145._val._val;
            const acc_te_5148 = Typechecker$synth(ctx, level, ({_tag: 7, _name: "EVar", _val: acc_name}));
            const _t5149 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: acc_te_5148}), Types$new_tvar(level));
            _t5146 = _t5149;
            break _t5147;
          }
          _match_fail("line 16190");
        }
        _t4751 = _t5146;
        break _t4752;
      }
      if (_t4750._tag === 37) {
        const e = _t4750._val;
        let _t5151;
        const _t5150 = ctx.return_type;
        _t5152: {
          if (_t5150._tag === 0) {
            _t5151 = Typechecker$error("return outside of function");
            break _t5152;
          }
          if (_t5150._tag === 1) {
            const ret_ty = _t5150._val;
            let _t5153;
            if (ctx.inside_handler) {
              _t5153 = Typechecker$error("Type error: return inside try/with is not supported");
            } else {
              _t5153 = undefined;
            }
            _t5153;
            Ref$set(ctx.return_used, true);
            const e_te_5154 = Typechecker$synth(ctx, level, e);
            Typechecker$try_unify(e_te_5154.ty, ret_ty);
            const _t5155 = Typechecker$mk(({_tag: 40, _name: "TEReturn", _val: e_te_5154}), Types$new_tvar(level));
            _t5151 = _t5155;
            break _t5152;
          }
          _match_fail("line 16190");
        }
        _t4751 = _t5151;
        break _t4752;
      }
      if (_t4750._tag === 34) {
        const pat = _t4750._val[0];
        const scrutinee = _t4750._val[1];
        const body = _t4750._val[2];
        const desugared_5156 = ({_tag: 31, _name: "EWhile", _val: [({_tag: 2, _name: "EBool", _val: true}), ({_tag: 25, _name: "EMatch", _val: [scrutinee, ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: ({_hd: [({_tag: 0, _name: "PatWild"}), ({_tag: 0, _name: "None"}), ({_tag: 35, _name: "EBreak", _val: ({_tag: 0, _name: "None"})})], _tl: null})}), false]})]});
        const _t5157 = Typechecker$synth(ctx, level, desugared_5156);
        _t4751 = _t5157;
        break _t4752;
      }
      if (_t4750._tag === 41) {
        const k_expr = _t4750._val[0];
        const v_expr = _t4750._val[1];
        const k_te_5158 = Typechecker$synth(ctx, level, k_expr);
        const v_te_5160 = Typechecker$synth(ctx, level, v_expr);
        const ret_ty_5162 = Types$new_tvar(level);
        const call_eff_5164 = Types$new_effvar(level);
        Typechecker$try_unify(k_te_5158.ty, ({_tag: 8, _name: "TCont", _val: [v_te_5160.ty, call_eff_5164, ret_ty_5162]}));
        Typechecker$try_subeffect(call_eff_5164, ctx.current_eff);
        const _t5165 = Typechecker$mk(({_tag: 31, _name: "TEResume", _val: [k_te_5158, v_te_5160]}), ret_ty_5162);
        const _t5163 = _t5165;
        const _t5161 = _t5163;
        const _t5159 = _t5161;
        _t4751 = _t5159;
        break _t4752;
      }
      if (_t4750._tag === 42 && _t4750._val === null) {
        const kt_5166 = Types$new_tvar(level);
        const vt_5168 = Types$new_tvar(level);
        const _t5169 = Typechecker$mk(({_tag: 38, _name: "TEMap", _val: null}), ({_tag: 13, _name: "TMap", _val: [kt_5166, vt_5168]}));
        const _t5167 = _t5169;
        _t4751 = _t5167;
        break _t4752;
      }
      if (_t4750._tag === 42 && _t4750._val !== null) {
        const k1 = _t4750._val._hd[0];
        const v1 = _t4750._val._hd[1];
        const rest = _t4750._val._tl;
        const k1_te_5170 = Typechecker$synth(ctx, level, k1);
        const v1_te_5172 = Typechecker$synth(ctx, level, v1);
        function _t5174(__p92) {
          let _t5176;
          const _t5175 = __p92;
          _t5177: {
            if (true) {
              const k = _t5175[0];
              const v = _t5175[1];
              const kt_5178 = Typechecker$check(ctx, level, k, k1_te_5170.ty);
              const vt_5180 = Typechecker$check(ctx, level, v, v1_te_5172.ty);
              const _t5181 = [kt_5178, vt_5180];
              const _t5179 = _t5181;
              _t5176 = _t5179;
              break _t5177;
            }
            _match_fail("line 16190");
          }
          return _t5176;
        }
        const rest_tes_5182 = List$map(_t5174, rest);
        const _t5183 = Typechecker$mk(({_tag: 38, _name: "TEMap", _val: ({_hd: [k1_te_5170, v1_te_5172], _tl: rest_tes_5182})}), ({_tag: 13, _name: "TMap", _val: [k1_te_5170.ty, v1_te_5172.ty]}));
        const _t5173 = _t5183;
        const _t5171 = _t5173;
        _t4751 = _t5171;
        break _t4752;
      }
      if (_t4750._tag === 43) {
        const mod_name = _t4750._val[0];
        const pairs = _t4750._val[1];
        function _t5184(__p93) {
          let _t5186;
          const _t5185 = __p93;
          _t5187: {
            if (true) {
              const k = _t5185[0];
              const v = _t5185[1];
              _t5186 = ({_tag: 15, _name: "ETuple", _val: ({_hd: k, _tl: ({_hd: v, _tl: null})})});
              break _t5187;
            }
            _match_fail("line 16190");
          }
          return _t5186;
        }
        const pair_list_5188 = ({_tag: 22, _name: "EList", _val: List$map(_t5184, pairs)});
        const desugared_5190 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: (mod_name + ".of_list")}), pair_list_5188]});
        const _t5191 = Typechecker$synth(ctx, level, desugared_5190);
        const _t5189 = _t5191;
        _t4751 = _t5189;
        break _t4752;
      }
      if (_t4750._tag === 44) {
        const elems = _t4750._val;
        const list_expr_5192 = ({_tag: 22, _name: "EList", _val: elems});
        const desugared_5194 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "Set.of_list"}), list_expr_5192]});
        const _t5195 = Typechecker$synth(ctx, level, desugared_5194);
        const _t5193 = _t5195;
        _t4751 = _t5193;
        break _t4752;
      }
      if (_t4750._tag === 45) {
        const mod_name = _t4750._val[0];
        const elems = _t4750._val[1];
        const list_expr_5196 = ({_tag: 22, _name: "EList", _val: elems});
        const desugared_5198 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: (mod_name + ".of_list")}), list_expr_5196]});
        const _t5199 = Typechecker$synth(ctx, level, desugared_5198);
        const _t5197 = _t5199;
        _t4751 = _t5197;
        break _t4752;
      }
      if (_t4750._tag === 48) {
        const mod_name = _t4750._val[0];
        const inner_expr = _t4750._val[1];
        let _t5201;
        const _t5200 = Ref$get(Typechecker$find_module_in_env_ref, ctx.type_env, mod_name);
        _t5202: {
          if (_t5200._tag === 1) {
            const m = _t5200._val;
            _t5201 = m;
            break _t5202;
          }
          if (_t5200._tag === 0) {
            _t5201 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
            break _t5202;
          }
          _match_fail("line 16190");
        }
        const minfo_5203 = _t5201;
        function _t5205(body, __p94) {
          let _t5207;
          const _t5206 = __p94;
          _t5208: {
            if (true) {
              const _mml$short = _t5206[0];
              const _scheme = _t5206[1];
              const qualified_5209 = (mod_name + ("." + _mml$short));
              const _t5210 = ({_tag: 8, _name: "ELet", _val: [_mml$short, ({_tag: 7, _name: "EVar", _val: qualified_5209}), body]});
              _t5207 = _t5210;
              break _t5208;
            }
            _match_fail("line 16190");
          }
          return _t5207;
        }
        const desugared_5211 = List$fold(_t5205, inner_expr, minfo_5203.mod_pub_vars);
        const _t5212 = Typechecker$synth(ctx, level, desugared_5211);
        const _t5204 = _t5212;
        _t4751 = _t5204;
        break _t4752;
      }
      if (_t4750._tag === 38) {
        const bindings = _t4750._val[0];
        const body = _t4750._val[1];
        function _t5213(__p95) {
          let _t5215;
          const _t5214 = __p95;
          _t5216: {
            if (true) {
              const tp = _t5214[1];
              _t5215 = !_eq(tp, null);
              break _t5216;
            }
            _match_fail("line 16190");
          }
          return _t5215;
        }
        const has_poly_5217 = List$exists(_t5213, bindings);
        let _t5219;
        if (has_poly_5217) {
          function _t5220(__p96) {
            let _t5222;
            const _t5221 = __p96;
            _t5223: {
              if (true) {
                const name = _t5221[0];
                const type_params = _t5221[1];
                const fn_expr = _t5221[2];
                let _t5225;
                const _t5224 = Typechecker$extract_fn_info(fn_expr);
                _t5226: {
                  if (true) {
                    const params = _t5224[0];
                    const ret_annot = _t5224[1];
                    const inner_body = _t5224[2];
                    _t5225 = [name, type_params, params, ret_annot, inner_body];
                    break _t5226;
                  }
                  _match_fail("line 16190");
                }
                _t5222 = _t5225;
                break _t5223;
              }
              _match_fail("line 16190");
            }
            return _t5222;
          }
          const infos_5227 = List$map(_t5220, bindings);
          function _t5229(__p97) {
            let _t5231;
            const _t5230 = __p97;
            _t5232: {
              if (true) {
                const type_params = _t5230[1];
                const params = _t5230[2];
                const ret_annot = _t5230[3];
                const shared_tvars_5233 = Hashtbl$create(4);
                function _t5235(tp) {
                  return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_5233, tp, Types$new_tvar((level + 1))]);
                }
                List$iter(_t5235, type_params);
                function _t5236(p) {
                  let _t5238;
                  const _t5237 = p.annot;
                  _t5239: {
                    if (_t5237._tag === 1) {
                      const annot = _t5237._val;
                      _t5238 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5233, annot);
                      break _t5239;
                    }
                    if (_t5237._tag === 0) {
                      _t5238 = Types$new_tvar((level + 1));
                      break _t5239;
                    }
                    _match_fail("line 16190");
                  }
                  return _t5238;
                }
                const param_tys_5240 = List$map(_t5236, params);
                let _t5243;
                const _t5242 = ret_annot;
                _t5244: {
                  if (_t5242._tag === 1 && _t5242._val._tag === 11) {
                    const ty = _t5242._val._val[0];
                    const eff_annot = _t5242._val._val[1];
                    const ty$p_5245 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5233, ty);
                    let _t5248;
                    const _t5247 = eff_annot;
                    _t5249: {
                      if (_t5247._tag === 0) {
                        _t5248 = ({_tag: 1, _name: "EffEmpty"});
                        break _t5249;
                      }
                      if (_t5247._tag === 1) {
                        const items = _t5247._val;
                        _t5248 = Typechecker$resolve_eff_items(ctx, (level + 1), shared_tvars_5233, items);
                        break _t5249;
                      }
                      _match_fail("line 16190");
                    }
                    const eff_5250 = _t5248;
                    const _t5251 = [ty$p_5245, eff_5250];
                    const _t5246 = _t5251;
                    _t5243 = _t5246;
                    break _t5244;
                  }
                  if (_t5242._tag === 1) {
                    const annot = _t5242._val;
                    _t5243 = [Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5233, annot), Types$new_effvar((level + 1))];
                    break _t5244;
                  }
                  if (_t5242._tag === 0) {
                    _t5243 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
                    break _t5244;
                  }
                  _match_fail("line 16190");
                }
                let _t5253;
                const _t5252 = _t5243;
                _t5254: {
                  if (true) {
                    const ret_ty = _t5252[0];
                    const body_eff = _t5252[1];
                    let _t5256;
                    const _t5255 = List$rev(param_tys_5240);
                    _t5257: {
                      if (_t5255 === null) {
                        _t5256 = ret_ty;
                        break _t5257;
                      }
                      if (_t5255 !== null) {
                        const last = _t5255._hd;
                        const rest = _t5255._tl;
                        const inner_5258 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
                        function _t5260(acc, pty) {
                          return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
                        }
                        const _t5259 = List$fold(_t5260, inner_5258, rest);
                        _t5256 = _t5259;
                        break _t5257;
                      }
                      _match_fail("line 16190");
                    }
                    const fn_ty_5261 = _t5256;
                    const _t5262 = [param_tys_5240, ret_ty, body_eff, fn_ty_5261];
                    _t5253 = _t5262;
                    break _t5254;
                  }
                  _match_fail("line 16190");
                }
                const _t5241 = _t5253;
                const _t5234 = _t5241;
                _t5231 = _t5234;
                break _t5232;
              }
              _match_fail("line 16190");
            }
            return _t5231;
          }
          const tvars_list_5263 = List$map(_t5229, infos_5227);
          function _t5265(__p98) {
            let _t5267;
            const _t5266 = __p98;
            _t5268: {
              if (true) {
                const fn_ty = _t5266[3];
                _t5267 = Types$generalize(level, fn_ty);
                break _t5268;
              }
              _match_fail("line 16190");
            }
            return _t5267;
          }
          const schemes_5269 = List$map(_t5265, tvars_list_5263);
          function _t5271(ctx, __p99, scheme) {
            let _t5273;
            const _t5272 = __p99;
            _t5274: {
              if (true) {
                const name = _t5272[0];
                _t5273 = Typechecker$extend_var(ctx, name, scheme);
                break _t5274;
              }
              _match_fail("line 16190");
            }
            return _t5273;
          }
          const ctx$p_5275 = List$fold2(_t5271, ctx, infos_5227, schemes_5269);
          function _t5277(__p100, __p101) {
            let _t5279;
            const _t5278 = __p100;
            _t5280: {
              if (true) {
                const params = _t5278[2];
                const inner_body = _t5278[4];
                let _t5282;
                const _t5281 = __p101;
                _t5283: {
                  if (true) {
                    const param_tys = _t5281[0];
                    const ret_ty = _t5281[1];
                    const body_eff = _t5281[2];
                    function _t5284(c, p, ty) {
                      return Typechecker$extend_var_mono(c, p.name, ty);
                    }
                    const __rec_upd_5285 = ctx$p_5275;
                    const _t5286 = ({constraint_tvars: __rec_upd_5285.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_5285.current_module, inside_handler: __rec_upd_5285.inside_handler, loop_info: __rec_upd_5285.loop_info, mutable_vars: __rec_upd_5285.mutable_vars, return_type: __rec_upd_5285.return_type, return_used: __rec_upd_5285.return_used, type_env: __rec_upd_5285.type_env, vars: __rec_upd_5285.vars});
                    const inner_ctx_5287 = List$fold2(_t5284, _t5286, params, param_tys);
                    const body_te_5289 = Typechecker$check(inner_ctx_5287, (level + 1), inner_body, ret_ty);
                    let _t5292;
                    const _t5291 = [List$rev(params), List$rev(param_tys)];
                    _t5293: {
                      if (_t5291[0] === null && _t5291[1] === null) {
                        _t5292 = body_te_5289;
                        break _t5293;
                      }
                      if (_t5291[0] !== null && _t5291[1] !== null) {
                        const last_p = _t5291[0]._hd;
                        const rest_ps = _t5291[0]._tl;
                        const last_pty = _t5291[1]._hd;
                        const rest_ptys = _t5291[1]._tl;
                        const inner_5294 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_5289, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_5289.ty]}));
                        function _t5296(acc, p, pty) {
                          return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
                        }
                        const _t5295 = List$fold2(_t5296, inner_5294, rest_ps, rest_ptys);
                        _t5292 = _t5295;
                        break _t5293;
                      }
                      if (true) {
                        _t5292 = failwith("assert false");
                        break _t5293;
                      }
                      _match_fail("line 16190");
                    }
                    const _t5290 = _t5292;
                    const _t5288 = _t5290;
                    _t5282 = _t5288;
                    break _t5283;
                  }
                  _match_fail("line 16190");
                }
                _t5279 = _t5282;
                break _t5280;
              }
              _match_fail("line 16190");
            }
            return _t5279;
          }
          const body_tes_5297 = List$map2(_t5277, infos_5227, tvars_list_5263);
          function _t5299(ctx, __p102, scheme) {
            let _t5301;
            const _t5300 = __p102;
            _t5302: {
              if (true) {
                const name = _t5300[0];
                _t5301 = Typechecker$extend_var(ctx, name, scheme);
                break _t5302;
              }
              _match_fail("line 16190");
            }
            return _t5301;
          }
          const ctx$p$p_5303 = List$fold2(_t5299, ctx, infos_5227, schemes_5269);
          const body_te_5305 = Typechecker$synth(ctx$p$p_5303, level, body);
          function _t5307(__p103, te) {
            let _t5309;
            const _t5308 = __p103;
            _t5310: {
              if (true) {
                const name = _t5308[0];
                _t5309 = [name, te];
                break _t5310;
              }
              _match_fail("line 16190");
            }
            return _t5309;
          }
          const typed_bindings_5311 = List$map2(_t5307, infos_5227, body_tes_5297);
          const _t5312 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [typed_bindings_5311, body_te_5305]}), body_te_5305.ty);
          const _t5306 = _t5312;
          const _t5304 = _t5306;
          const _t5298 = _t5304;
          const _t5276 = _t5298;
          const _t5270 = _t5276;
          const _t5264 = _t5270;
          const _t5228 = _t5264;
          _t5219 = _t5228;
        } else {
          function _t5313(__p104) {
            let _t5315;
            const _t5314 = __p104;
            _t5316: {
              if (true) {
                const name = _t5314[0];
                _t5315 = [name, Types$new_tvar((level + 1))];
                break _t5316;
              }
              _match_fail("line 16190");
            }
            return _t5315;
          }
          const fn_vars_5317 = List$map(_t5313, bindings);
          function _t5319(ctx, __p105) {
            let _t5321;
            const _t5320 = __p105;
            _t5322: {
              if (true) {
                const name = _t5320[0];
                const tv = _t5320[1];
                _t5321 = Typechecker$extend_var_mono(ctx, name, tv);
                break _t5322;
              }
              _match_fail("line 16190");
            }
            return _t5321;
          }
          const ctx$p_5323 = List$fold(_t5319, ctx, fn_vars_5317);
          function _t5325(__p106, __p107) {
            let _t5327;
            const _t5326 = __p106;
            _t5328: {
              if (true) {
                const fn_expr = _t5326[2];
                let _t5330;
                const _t5329 = __p107;
                _t5331: {
                  if (true) {
                    const tv = _t5329[1];
                    const te_5332 = Typechecker$synth(ctx$p_5323, (level + 1), fn_expr);
                    Typechecker$try_unify(tv, te_5332.ty);
                    const _t5333 = te_5332;
                    _t5330 = _t5333;
                    break _t5331;
                  }
                  _match_fail("line 16190");
                }
                _t5327 = _t5330;
                break _t5328;
              }
              _match_fail("line 16190");
            }
            return _t5327;
          }
          const body_tes_5334 = List$map2(_t5325, bindings, fn_vars_5317);
          function _t5336(ctx, __p108, __p109) {
            let _t5338;
            const _t5337 = __p108;
            _t5339: {
              if (true) {
                const name = _t5337[0];
                let _t5341;
                const _t5340 = __p109;
                _t5342: {
                  if (true) {
                    const tv = _t5340[1];
                    const scheme_5343 = Types$generalize(level, tv);
                    const _t5344 = Typechecker$extend_var(ctx, name, scheme_5343);
                    _t5341 = _t5344;
                    break _t5342;
                  }
                  _match_fail("line 16190");
                }
                _t5338 = _t5341;
                break _t5339;
              }
              _match_fail("line 16190");
            }
            return _t5338;
          }
          const ctx$p$p_5345 = List$fold2(_t5336, ctx, bindings, fn_vars_5317);
          const body_te_5347 = Typechecker$synth(ctx$p$p_5345, level, body);
          function _t5349(__p110, te) {
            let _t5351;
            const _t5350 = __p110;
            _t5352: {
              if (true) {
                const name = _t5350[0];
                _t5351 = [name, te];
                break _t5352;
              }
              _match_fail("line 16190");
            }
            return _t5351;
          }
          const typed_bindings_5353 = List$map2(_t5349, bindings, body_tes_5334);
          const _t5354 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [typed_bindings_5353, body_te_5347]}), body_te_5347.ty);
          const _t5348 = _t5354;
          const _t5346 = _t5348;
          const _t5335 = _t5346;
          const _t5324 = _t5335;
          const _t5318 = _t5324;
          _t5219 = _t5318;
        }
        const _t5218 = _t5219;
        _t4751 = _t5218;
        break _t4752;
      }
      _match_fail("line 16190");
    }
    return _t4751;
  }
}
function Typechecker$synth_perform(ctx, level, op_name, arg) {
  let _t5356;
  const _t5355 = Types$find_effect_op(ctx.type_env, op_name);
  _t5357: {
    if (_t5355._tag === 0) {
      _t5356 = Typechecker$error(("unknown effect operation: " + __dict_Show_string.show(op_name)));
      break _t5357;
    }
    if (_t5355._tag === 1) {
      const effect_name = _t5355._val[0];
      const op_ty = _t5355._val[1];
      function _t5358(e) {
        return (e.effect_name === effect_name);
      }
      const edef_5359 = list_find(_t5358, ctx.type_env.effects);
      function _t5361(_) {
        return Types$new_tvar(level);
      }
      const fresh_params_5362 = List$map(_t5361, edef_5359.effect_params);
      const concrete_op_ty_5364 = Typechecker$freshen_tvars(level, op_ty);
      let _t5366;
      if (_eq(fresh_params_5362, null)) {
        _t5366 = concrete_op_ty_5364;
      } else {
        _t5366 = Typechecker$subst_tgens(fresh_params_5362, concrete_op_ty_5364);
      }
      const concrete_op_ty_5367 = _t5366;
      let _t5370;
      const _t5369 = Types$repr(concrete_op_ty_5367);
      _t5371: {
        if (_t5369._tag === 7) {
          const param_ty = _t5369._val[0];
          const ret_ty = _t5369._val[2];
          const arg_te_5372 = Typechecker$check(ctx, level, arg, param_ty);
          const fresh_tail_5374 = Types$new_effvar(level);
          Typechecker$try_unify_eff(ctx.current_eff, ({_tag: 2, _name: "EffRow", _val: [effect_name, fresh_params_5362, fresh_tail_5374]}));
          const _t5375 = Typechecker$mk(({_tag: 29, _name: "TEPerform", _val: [op_name, arg_te_5372]}), ret_ty);
          const _t5373 = _t5375;
          _t5370 = _t5373;
          break _t5371;
        }
        if (true) {
          _t5370 = Typechecker$error((("effect operation " + __dict_Show_string.show(op_name)) + " must have function type"));
          break _t5371;
        }
        _match_fail("line 16190");
      }
      const _t5368 = _t5370;
      const _t5365 = _t5368;
      const _t5363 = _t5365;
      const _t5360 = _t5363;
      _t5356 = _t5360;
      break _t5357;
    }
    _match_fail("line 16190");
  }
  return _t5356;
}
function Typechecker$synth_handle(ctx, level, body, arms) {
  const body_eff_5376 = Types$new_effvar(level);
  const __rec_upd_5378 = ctx;
  const _t5379 = ({constraint_tvars: __rec_upd_5378.constraint_tvars, current_eff: body_eff_5376, current_module: __rec_upd_5378.current_module, inside_handler: true, loop_info: __rec_upd_5378.loop_info, mutable_vars: __rec_upd_5378.mutable_vars, return_type: __rec_upd_5378.return_type, return_used: __rec_upd_5378.return_used, type_env: __rec_upd_5378.type_env, vars: __rec_upd_5378.vars});
  const body_ctx_5380 = _t5379;
  const body_te_5382 = Typechecker$synth(body_ctx_5380, level, body);
  const result_ty_5384 = Types$new_tvar(level);
  function _t5386(arm) {
    let _t5388;
    const _t5387 = arm;
    _t5389: {
      if (_t5387._tag === 1) {
        const op_name = _t5387._val[0];
        let _t5391;
        const _t5390 = Types$find_effect_op(ctx.type_env, op_name);
        _t5392: {
          if (_t5390._tag === 1) {
            const effect_name = _t5390._val[0];
            _t5391 = ({_tag: 1, _name: "Some", _val: effect_name});
            break _t5392;
          }
          if (_t5390._tag === 0) {
            _t5391 = Typechecker$error(("unknown effect operation in handler: " + __dict_Show_string.show(op_name)));
            break _t5392;
          }
          _match_fail("line 16190");
        }
        _t5388 = _t5391;
        break _t5389;
      }
      if (true) {
        _t5388 = ({_tag: 0, _name: "None"});
        break _t5389;
      }
      _match_fail("line 16190");
    }
    return _t5388;
  }
  const handled_effects_5393 = List$filter_map(_t5386, arms);
  const unique_effects_5395 = List$sort_uniq(String$compare, handled_effects_5393);
  function _t5397(effect_name) {
    function _t5398(e) {
      return (e.effect_name === effect_name);
    }
    const edef_5399 = list_find(_t5398, ctx.type_env.effects);
    function _t5401(_) {
      return Types$new_tvar(level);
    }
    const fresh_params_5402 = List$map(_t5401, edef_5399.effect_params);
    const _t5403 = [effect_name, fresh_params_5402];
    const _t5400 = _t5403;
    return _t5400;
  }
  const effect_fresh_params_5404 = List$map(_t5397, unique_effects_5395);
  function _t5406(eff, __p111) {
    let _t5408;
    const _t5407 = __p111;
    _t5409: {
      if (true) {
        const effect_name = _t5407[0];
        const fresh_params = _t5407[1];
        const _t5410 = (function() {
          const _t5411 = _h;
          _h = Object.assign({}, _t5411, {
            "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
          });
          try {
            const __x_5412 = Types$rewrite_row(effect_name, fresh_params, eff);
            return __x_5412;
          } catch (_exc) {
            if (_exc && _exc._e === "unify_error") {
              const msg = _exc._v;
              return Typechecker$error(msg);
            } else { throw _exc; }
          } finally { _h = _t5411; }
        })();
        _t5408 = _t5410;
        break _t5409;
      }
      _match_fail("line 16190");
    }
    return _t5408;
  }
  const remaining_eff_5413 = List$fold(_t5406, Types$eff_repr(body_eff_5376), effect_fresh_params_5404);
  Typechecker$try_unify_eff(remaining_eff_5413, ctx.current_eff);
  function _t5415(arm) {
    let _t5417;
    const _t5416 = arm;
    _t5418: {
      if (_t5416._tag === 0) {
        const name = _t5416._val[0];
        const handler_body = _t5416._val[1];
        const ctx$p_5419 = Typechecker$extend_var_mono(ctx, name, body_te_5382.ty);
        const handler_te_5421 = Typechecker$check(ctx$p_5419, level, handler_body, result_ty_5384);
        const _t5422 = ({_tag: 0, _name: "THReturn", _val: [name, handler_te_5421]});
        const _t5420 = _t5422;
        _t5417 = _t5420;
        break _t5418;
      }
      if (_t5416._tag === 1) {
        const op_name = _t5416._val[0];
        const arg_name = _t5416._val[1];
        const k_name = _t5416._val[2];
        const handler_body = _t5416._val[3];
        let _t5424;
        const _t5423 = Types$find_effect_op(ctx.type_env, op_name);
        _t5425: {
          if (_t5423._tag === 0) {
            _t5424 = Typechecker$error(("unknown effect operation in handler: " + __dict_Show_string.show(op_name)));
            break _t5425;
          }
          if (_t5423._tag === 1) {
            const effect_name = _t5423._val[0];
            const op_ty = _t5423._val[1];
            let _t5427;
            const _t5426 = List$assoc_opt(effect_name, effect_fresh_params_5404);
            _t5428: {
              if (_t5426._tag === 1) {
                const p = _t5426._val;
                _t5427 = p;
                break _t5428;
              }
              if (_t5426._tag === 0) {
                _t5427 = null;
                break _t5428;
              }
              _match_fail("line 16190");
            }
            const fresh_params_5429 = _t5427;
            let _t5431;
            if (_eq(fresh_params_5429, null)) {
              _t5431 = op_ty;
            } else {
              _t5431 = Typechecker$subst_tgens(fresh_params_5429, op_ty);
            }
            const concrete_op_ty_5432 = _t5431;
            let _t5435;
            const _t5434 = Types$repr(concrete_op_ty_5432);
            _t5436: {
              if (_t5434._tag === 7) {
                const a = _t5434._val[0];
                const b = _t5434._val[2];
                _t5435 = [a, b];
                break _t5436;
              }
              if (true) {
                _t5435 = Typechecker$error((("effect operation " + __dict_Show_string.show(op_name)) + " must have function type"));
                break _t5436;
              }
              _match_fail("line 16190");
            }
            let _t5438;
            const _t5437 = _t5435;
            _t5439: {
              if (true) {
                const param_ty = _t5437[0];
                const ret_ty_op = _t5437[1];
                const k_ty_5440 = ({_tag: 8, _name: "TCont", _val: [ret_ty_op, ctx.current_eff, result_ty_5384]});
                const ctx$p_5442 = Typechecker$extend_var_mono(ctx, arg_name, param_ty);
                const ctx$p_5444 = Typechecker$extend_var_mono(ctx$p_5442, k_name, k_ty_5440);
                const handler_te_5446 = Typechecker$check(ctx$p_5444, level, handler_body, result_ty_5384);
                const _t5447 = ({_tag: 1, _name: "THOp", _val: [op_name, arg_name, k_name, handler_te_5446]});
                const _t5445 = _t5447;
                const _t5443 = _t5445;
                const _t5441 = _t5443;
                _t5438 = _t5441;
                break _t5439;
              }
              _match_fail("line 16190");
            }
            const _t5433 = _t5438;
            const _t5430 = _t5433;
            _t5424 = _t5430;
            break _t5425;
          }
          _match_fail("line 16190");
        }
        _t5417 = _t5424;
        break _t5418;
      }
      _match_fail("line 16190");
    }
    return _t5417;
  }
  const typed_arms_5448 = List$map(_t5415, arms);
  const _t5449 = Typechecker$mk(({_tag: 30, _name: "TEHandle", _val: [body_te_5382, typed_arms_5448]}), result_ty_5384);
  const _t5414 = _t5449;
  const _t5405 = _t5414;
  const _t5396 = _t5405;
  const _t5394 = _t5396;
  const _t5385 = _t5394;
  const _t5383 = _t5385;
  const _t5381 = _t5383;
  const _t5377 = _t5381;
  return _t5377;
}
function Typechecker$synth_binop(ctx, level, op, e1, e2) {
  let _t5451;
  const _t5450 = op;
  _t5452: {
    if ((((_t5450._tag === 0 || _t5450._tag === 1) || _t5450._tag === 2) || _t5450._tag === 3)) {
      const te1_5453 = Typechecker$synth(ctx, level, e1);
      const te2_5455 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5453.ty, te2_5455.ty);
      const resolved_5457 = Types$repr(te1_5453.ty);
      let _t5460;
      const _t5459 = resolved_5457;
      _t5461: {
        if (_t5459._tag === 1) {
          _t5460 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5453, te2_5455]}), ({_tag: 1, _name: "TFloat"}));
          break _t5461;
        }
        if (_t5459._tag === 16 && _t5459._val.contents._tag === 0) {
          const id = _t5459._val.contents._val[0];
          let _t5462;
          if (List$mem(id, ctx.constraint_tvars)) {
            _t5462 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5453, te2_5455]}), Types$repr(te1_5453.ty));
          } else {
            Typechecker$try_unify(te1_5453.ty, ({_tag: 0, _name: "TInt"}));
            _t5462 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5453, te2_5455]}), ({_tag: 0, _name: "TInt"}));
          }
          _t5460 = _t5462;
          break _t5461;
        }
        if (_t5459._tag === 0) {
          _t5460 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5453, te2_5455]}), ({_tag: 0, _name: "TInt"}));
          break _t5461;
        }
        if (true) {
          _t5460 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5453, te2_5455]}), Types$repr(te1_5453.ty));
          break _t5461;
        }
        _match_fail("line 16190");
      }
      const _t5458 = _t5460;
      const _t5456 = _t5458;
      const _t5454 = _t5456;
      _t5451 = _t5454;
      break _t5452;
    }
    if (_t5450._tag === 4) {
      const te1_5463 = Typechecker$check(ctx, level, e1, ({_tag: 0, _name: "TInt"}));
      const te2_5465 = Typechecker$check(ctx, level, e2, ({_tag: 0, _name: "TInt"}));
      const _t5466 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5463, te2_5465]}), ({_tag: 0, _name: "TInt"}));
      const _t5464 = _t5466;
      _t5451 = _t5464;
      break _t5452;
    }
    if ((((_t5450._tag === 7 || _t5450._tag === 8) || _t5450._tag === 9) || _t5450._tag === 10)) {
      const te1_5467 = Typechecker$synth(ctx, level, e1);
      const te2_5469 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5467.ty, te2_5469.ty);
      const _t5470 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5467, te2_5469]}), ({_tag: 2, _name: "TBool"}));
      const _t5468 = _t5470;
      _t5451 = _t5468;
      break _t5452;
    }
    if ((_t5450._tag === 5 || _t5450._tag === 6)) {
      const te1_5471 = Typechecker$synth(ctx, level, e1);
      const te2_5473 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5471.ty, te2_5473.ty);
      const _t5474 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5471, te2_5473]}), ({_tag: 2, _name: "TBool"}));
      const _t5472 = _t5474;
      _t5451 = _t5472;
      break _t5452;
    }
    if ((_t5450._tag === 11 || _t5450._tag === 12)) {
      const te1_5475 = Typechecker$check(ctx, level, e1, ({_tag: 2, _name: "TBool"}));
      const te2_5477 = Typechecker$check(ctx, level, e2, ({_tag: 2, _name: "TBool"}));
      const _t5478 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5475, te2_5477]}), ({_tag: 2, _name: "TBool"}));
      const _t5476 = _t5478;
      _t5451 = _t5476;
      break _t5452;
    }
    if (_t5450._tag === 13) {
      const te1_5479 = Typechecker$check(ctx, level, e1, ({_tag: 3, _name: "TString"}));
      const te2_5481 = Typechecker$check(ctx, level, e2, ({_tag: 3, _name: "TString"}));
      const _t5482 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5479, te2_5481]}), ({_tag: 3, _name: "TString"}));
      const _t5480 = _t5482;
      _t5451 = _t5480;
      break _t5452;
    }
    if (((((_t5450._tag === 14 || _t5450._tag === 15) || _t5450._tag === 16) || _t5450._tag === 17) || _t5450._tag === 18)) {
      const te1_5483 = Typechecker$synth(ctx, level, e1);
      const te2_5485 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5483.ty, te2_5485.ty);
      const resolved_5487 = Types$repr(te1_5483.ty);
      let _t5490;
      const _t5489 = resolved_5487;
      _t5491: {
        if (_t5489._tag === 0) {
          _t5490 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5483, te2_5485]}), ({_tag: 0, _name: "TInt"}));
          break _t5491;
        }
        if (_t5489._tag === 16 && _t5489._val.contents._tag === 0) {
          const id = _t5489._val.contents._val[0];
          let _t5492;
          if (List$mem(id, ctx.constraint_tvars)) {
            _t5492 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5483, te2_5485]}), Types$repr(te1_5483.ty));
          } else {
            Typechecker$try_unify(te1_5483.ty, ({_tag: 0, _name: "TInt"}));
            _t5492 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5483, te2_5485]}), ({_tag: 0, _name: "TInt"}));
          }
          _t5490 = _t5492;
          break _t5491;
        }
        if (true) {
          _t5490 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5483, te2_5485]}), Types$repr(te1_5483.ty));
          break _t5491;
        }
        _match_fail("line 16190");
      }
      const _t5488 = _t5490;
      const _t5486 = _t5488;
      const _t5484 = _t5486;
      _t5451 = _t5484;
      break _t5452;
    }
    if (_t5450._tag === 19) {
      const te1_5493 = Typechecker$synth(ctx, level, e1);
      const te2_5495 = Typechecker$synth(ctx, level, e2);
      const ret_ty_5497 = Types$new_tvar(level);
      const call_eff_5499 = Types$new_effvar(level);
      Typechecker$try_unify(te2_5495.ty, ({_tag: 7, _name: "TArrow", _val: [te1_5493.ty, call_eff_5499, ret_ty_5497]}));
      Typechecker$try_subeffect(call_eff_5499, ctx.current_eff);
      const _t5500 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5493, te2_5495]}), ret_ty_5497);
      const _t5498 = _t5500;
      const _t5496 = _t5498;
      const _t5494 = _t5496;
      _t5451 = _t5494;
      break _t5452;
    }
    _match_fail("line 16190");
  }
  return _t5451;
}
function Typechecker$synth_unop(ctx, level, op, e) {
  let _t5502;
  const _t5501 = op;
  _t5503: {
    if (_t5501._tag === 0) {
      const te_5504 = Typechecker$synth(ctx, level, e);
      const resolved_5506 = Types$repr(te_5504.ty);
      let _t5509;
      const _t5508 = resolved_5506;
      _t5510: {
        if (_t5508._tag === 1) {
          _t5509 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5504]}), ({_tag: 1, _name: "TFloat"}));
          break _t5510;
        }
        if (_t5508._tag === 16 && _t5508._val.contents._tag === 0) {
          const id = _t5508._val.contents._val[0];
          let _t5511;
          if (List$mem(id, ctx.constraint_tvars)) {
            _t5511 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5504]}), Types$repr(te_5504.ty));
          } else {
            Typechecker$try_unify(te_5504.ty, ({_tag: 0, _name: "TInt"}));
            _t5511 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5504]}), ({_tag: 0, _name: "TInt"}));
          }
          _t5509 = _t5511;
          break _t5510;
        }
        if (_t5508._tag === 0) {
          _t5509 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5504]}), ({_tag: 0, _name: "TInt"}));
          break _t5510;
        }
        if (true) {
          _t5509 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5504]}), te_5504.ty);
          break _t5510;
        }
        _match_fail("line 16190");
      }
      const _t5507 = _t5509;
      const _t5505 = _t5507;
      _t5502 = _t5505;
      break _t5503;
    }
    if (_t5501._tag === 1) {
      const te_5512 = Typechecker$check(ctx, level, e, ({_tag: 2, _name: "TBool"}));
      const _t5513 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5512]}), ({_tag: 2, _name: "TBool"}));
      _t5502 = _t5513;
      break _t5503;
    }
    if (_t5501._tag === 2) {
      const te_5514 = Typechecker$synth(ctx, level, e);
      const resolved_5516 = Types$repr(te_5514.ty);
      let _t5519;
      const _t5518 = resolved_5516;
      _t5520: {
        if (_t5518._tag === 0) {
          _t5519 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5514]}), ({_tag: 0, _name: "TInt"}));
          break _t5520;
        }
        if (_t5518._tag === 16 && _t5518._val.contents._tag === 0) {
          Typechecker$try_unify(te_5514.ty, ({_tag: 0, _name: "TInt"}));
          _t5519 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5514]}), ({_tag: 0, _name: "TInt"}));
          break _t5520;
        }
        if (true) {
          _t5519 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5514]}), te_5514.ty);
          break _t5520;
        }
        _match_fail("line 16190");
      }
      const _t5517 = _t5519;
      const _t5515 = _t5517;
      _t5502 = _t5515;
      break _t5503;
    }
    _match_fail("line 16190");
  }
  return _t5502;
}
function Typechecker$qualify_ctor_name(type_env, name, info) {
  let _t5521;
  if (String$contains(".", name)) {
    _t5521 = name;
  } else {
    let _t5523;
    const _t5522 = String$rindex_opt(info.ctor_type_name, 46);
    _t5524: {
      if (_t5522._tag === 1) {
        const i = _t5522._val;
        const qualified_5525 = (String$sub(info.ctor_type_name, 0, (i + 1)) + name);
        let _t5527;
        if (!_eq(List$assoc_opt(qualified_5525, type_env.constructors), ({_tag: 0, _name: "None"}))) {
          _t5527 = qualified_5525;
        } else {
          _t5527 = name;
        }
        const _t5526 = _t5527;
        _t5523 = _t5526;
        break _t5524;
      }
      if (_t5522._tag === 0) {
        _t5523 = name;
        break _t5524;
      }
      _match_fail("line 16190");
    }
    _t5521 = _t5523;
  }
  return _t5521;
}
function Typechecker$qualify_pattern(type_env, pat) {
  function go(pat) {
    let _t5529;
    const _t5528 = pat;
    _t5530: {
      if (_t5528._tag === 10) {
        const name = _t5528._val[0];
        const arg = _t5528._val[1];
        let _t5532;
        const _t5531 = List$assoc_opt(name, type_env.constructors);
        _t5533: {
          if (_t5531._tag === 1) {
            const info = _t5531._val;
            _t5532 = Typechecker$qualify_ctor_name(type_env, name, info);
            break _t5533;
          }
          if (_t5531._tag === 0) {
            _t5532 = name;
            break _t5533;
          }
          _match_fail("line 16190");
        }
        const qname_5534 = _t5532;
        const _t5535 = ({_tag: 10, _name: "PatConstruct", _val: [qname_5534, Option$map(go, arg)]});
        _t5529 = _t5535;
        break _t5530;
      }
      if (_t5528._tag === 7) {
        const ps = _t5528._val;
        _t5529 = ({_tag: 7, _name: "PatTuple", _val: List$map(go, ps)});
        break _t5530;
      }
      if (_t5528._tag === 8) {
        const hd = _t5528._val[0];
        const tl = _t5528._val[1];
        _t5529 = ({_tag: 8, _name: "PatCons", _val: [go(hd), go(tl)]});
        break _t5530;
      }
      if (_t5528._tag === 13) {
        const p1 = _t5528._val[0];
        const p2 = _t5528._val[1];
        _t5529 = ({_tag: 13, _name: "PatOr", _val: [go(p1), go(p2)]});
        break _t5530;
      }
      if (_t5528._tag === 12) {
        const p = _t5528._val[0];
        const n = _t5528._val[1];
        _t5529 = ({_tag: 12, _name: "PatAs", _val: [go(p), n]});
        break _t5530;
      }
      if (_t5528._tag === 11) {
        const fields = _t5528._val;
        function _t5536(__p112) {
          let _t5538;
          const _t5537 = __p112;
          _t5539: {
            if (true) {
              const f = _t5537[0];
              const p = _t5537[1];
              _t5538 = [f, go(p)];
              break _t5539;
            }
            _match_fail("line 16190");
          }
          return _t5538;
        }
        _t5529 = ({_tag: 11, _name: "PatRecord", _val: List$map(_t5536, fields)});
        break _t5530;
      }
      if (_t5528._tag === 14) {
        const ps = _t5528._val;
        _t5529 = ({_tag: 14, _name: "PatArray", _val: List$map(go, ps)});
        break _t5530;
      }
      if (_t5528._tag === 15) {
        const kvs = _t5528._val;
        function _t5540(__p113) {
          let _t5542;
          const _t5541 = __p113;
          _t5543: {
            if (true) {
              const k = _t5541[0];
              const v = _t5541[1];
              _t5542 = [go(k), go(v)];
              break _t5543;
            }
            _match_fail("line 16190");
          }
          return _t5542;
        }
        _t5529 = ({_tag: 15, _name: "PatMap", _val: List$map(_t5540, kvs)});
        break _t5530;
      }
      if (_t5528._tag === 18) {
        const p = _t5528._val[0];
        const a = _t5528._val[1];
        _t5529 = ({_tag: 18, _name: "PatAnnot", _val: [go(p), a]});
        break _t5530;
      }
      if (true) {
        _t5529 = pat;
        break _t5530;
      }
      _match_fail("line 16190");
    }
    return _t5529;
  }
  const _t5544 = go(pat);
  return _t5544;
}
function Typechecker$synth_construct(ctx, level, name, arg) {
  let _t5546;
  const _t5545 = List$assoc_opt(name, ctx.type_env.constructors);
  _t5547: {
    if (_t5545._tag === 0) {
      _t5546 = Typechecker$error(("unknown constructor: " + __dict_Show_string.show(name)));
      break _t5547;
    }
    if (_t5545._tag === 1) {
      const info = _t5545._val;
      const qname_5548 = Typechecker$qualify_ctor_name(ctx.type_env, name, info);
      const num_fresh_5550 = (info.ctor_num_params + info.ctor_existentials);
      function _t5552(_) {
        return Types$new_tvar(level);
      }
      const all_fresh_5553 = List$init(num_fresh_5550, _t5552);
      function _t5555(i, _) {
        return (i < info.ctor_num_params);
      }
      const fresh_universals_5556 = List$filteri(_t5555, all_fresh_5553);
      let _t5559;
      const _t5558 = info.ctor_return_ty_params;
      _t5560: {
        if (_t5558._tag === 0) {
          _t5559 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, fresh_universals_5556]});
          break _t5560;
        }
        if (_t5558._tag === 1) {
          const params = _t5558._val;
          _t5559 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, List$map(_call(Typechecker$subst_tgens, [all_fresh_5553]), params)]});
          break _t5560;
        }
        _match_fail("line 16190");
      }
      const result_ty_5561 = _t5559;
      let _t5564;
      const _t5563 = [info.ctor_arg_ty, arg];
      _t5565: {
        if (_t5563[0]._tag === 0 && _t5563[1]._tag === 0) {
          _t5564 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [qname_5548, ({_tag: 0, _name: "None"})]}), result_ty_5561);
          break _t5565;
        }
        if (_t5563[0]._tag === 1 && _t5563[1]._tag === 1) {
          const expected_ty = _t5563[0]._val;
          const arg_expr = _t5563[1]._val;
          const concrete_ty_5566 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(all_fresh_5553, expected_ty));
          const arg_te_5568 = Typechecker$check(ctx, level, arg_expr, concrete_ty_5566);
          const _t5569 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [qname_5548, ({_tag: 1, _name: "Some", _val: arg_te_5568})]}), result_ty_5561);
          const _t5567 = _t5569;
          _t5564 = _t5567;
          break _t5565;
        }
        if (_t5563[0]._tag === 0 && _t5563[1]._tag === 1) {
          _t5564 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " takes no arguments"));
          break _t5565;
        }
        if (_t5563[0]._tag === 1 && _t5563[1]._tag === 0) {
          const expected_ty = _t5563[0]._val;
          const concrete_ty_5570 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(all_fresh_5553, expected_ty));
          const param_5572 = "__x";
          const param_var_5574 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: param_5572}), concrete_ty_5570);
          const body_5576 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [qname_5548, ({_tag: 1, _name: "Some", _val: param_var_5574})]}), result_ty_5561);
          const _t5577 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param_5572, body_5576, false]}), ({_tag: 7, _name: "TArrow", _val: [concrete_ty_5570, ({_tag: 1, _name: "EffEmpty"}), result_ty_5561]}));
          const _t5575 = _t5577;
          const _t5573 = _t5575;
          const _t5571 = _t5573;
          _t5564 = _t5571;
          break _t5565;
        }
        _match_fail("line 16190");
      }
      const _t5562 = _t5564;
      const _t5557 = _t5562;
      const _t5554 = _t5557;
      const _t5551 = _t5554;
      const _t5549 = _t5551;
      _t5546 = _t5549;
      break _t5547;
    }
    _match_fail("line 16190");
  }
  return _t5546;
}
function Typechecker$freeze_texpr(te) {
  const ft_5578 = Types$deep_repr(te.ty);
  let _t5581;
  const _t5580 = te.expr;
  _t5582: {
    if (((((((((_t5580._tag === 0 || _t5580._tag === 1) || _t5580._tag === 2) || _t5580._tag === 3) || _t5580._tag === 4) || _t5580._tag === 5) || _t5580._tag === 6) || _t5580._tag === 7) || _t5580._tag === 22)) {
      _t5581 = te.expr;
      break _t5582;
    }
    if (_t5580._tag === 8) {
      const n = _t5580._val[0];
      const s = _t5580._val[1];
      const e1 = _t5580._val[2];
      const e2 = _t5580._val[3];
      _t5581 = ({_tag: 8, _name: "TELet", _val: [n, s, Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5582;
    }
    if (_t5580._tag === 9) {
      const n = _t5580._val[0];
      const s = _t5580._val[1];
      const e1 = _t5580._val[2];
      const e2 = _t5580._val[3];
      _t5581 = ({_tag: 9, _name: "TELetRec", _val: [n, s, Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5582;
    }
    if (_t5580._tag === 10) {
      const p = _t5580._val[0];
      const body = _t5580._val[1];
      const hr = _t5580._val[2];
      _t5581 = ({_tag: 10, _name: "TEFun", _val: [p, Typechecker$freeze_texpr(body), hr]});
      break _t5582;
    }
    if (_t5580._tag === 11) {
      const f = _t5580._val[0];
      const a = _t5580._val[1];
      _t5581 = ({_tag: 11, _name: "TEApp", _val: [Typechecker$freeze_texpr(f), Typechecker$freeze_texpr(a)]});
      break _t5582;
    }
    if (_t5580._tag === 12) {
      const c = _t5580._val[0];
      const t = _t5580._val[1];
      const e = _t5580._val[2];
      _t5581 = ({_tag: 12, _name: "TEIf", _val: [Typechecker$freeze_texpr(c), Typechecker$freeze_texpr(t), Typechecker$freeze_texpr(e)]});
      break _t5582;
    }
    if (_t5580._tag === 13) {
      const op = _t5580._val[0];
      const l = _t5580._val[1];
      const r = _t5580._val[2];
      _t5581 = ({_tag: 13, _name: "TEBinop", _val: [op, Typechecker$freeze_texpr(l), Typechecker$freeze_texpr(r)]});
      break _t5582;
    }
    if (_t5580._tag === 14) {
      const op = _t5580._val[0];
      const e = _t5580._val[1];
      _t5581 = ({_tag: 14, _name: "TEUnop", _val: [op, Typechecker$freeze_texpr(e)]});
      break _t5582;
    }
    if (_t5580._tag === 15) {
      const es = _t5580._val;
      _t5581 = ({_tag: 15, _name: "TETuple", _val: List$map(Typechecker$freeze_texpr, es)});
      break _t5582;
    }
    if (_t5580._tag === 16) {
      const fs = _t5580._val;
      function _t5583(__p114) {
        let _t5585;
        const _t5584 = __p114;
        _t5586: {
          if (true) {
            const n = _t5584[0];
            const e = _t5584[1];
            _t5585 = [n, Typechecker$freeze_texpr(e)];
            break _t5586;
          }
          _match_fail("line 16190");
        }
        return _t5585;
      }
      _t5581 = ({_tag: 16, _name: "TERecord", _val: List$map(_t5583, fs)});
      break _t5582;
    }
    if (_t5580._tag === 17) {
      const base = _t5580._val[0];
      const overrides = _t5580._val[1];
      function _t5587(__p115) {
        let _t5589;
        const _t5588 = __p115;
        _t5590: {
          if (true) {
            const n = _t5588[0];
            const e = _t5588[1];
            _t5589 = [n, Typechecker$freeze_texpr(e)];
            break _t5590;
          }
          _match_fail("line 16190");
        }
        return _t5589;
      }
      _t5581 = ({_tag: 17, _name: "TERecordUpdate", _val: [Typechecker$freeze_texpr(base), List$map(_t5587, overrides)]});
      break _t5582;
    }
    if (_t5580._tag === 18) {
      const base = _t5580._val[0];
      const pairs = _t5580._val[1];
      function _t5591(__p116) {
        let _t5593;
        const _t5592 = __p116;
        _t5594: {
          if (true) {
            const i = _t5592[0];
            const v = _t5592[1];
            _t5593 = [Typechecker$freeze_texpr(i), Typechecker$freeze_texpr(v)];
            break _t5594;
          }
          _match_fail("line 16190");
        }
        return _t5593;
      }
      _t5581 = ({_tag: 18, _name: "TERecordUpdateIdx", _val: [Typechecker$freeze_texpr(base), List$map(_t5591, pairs)]});
      break _t5582;
    }
    if (_t5580._tag === 19) {
      const e = _t5580._val[0];
      const f = _t5580._val[1];
      _t5581 = ({_tag: 19, _name: "TEField", _val: [Typechecker$freeze_texpr(e), f]});
      break _t5582;
    }
    if (_t5580._tag === 20) {
      const e = _t5580._val[0];
      const i = _t5580._val[1];
      _t5581 = ({_tag: 20, _name: "TEIndex", _val: [Typechecker$freeze_texpr(e), Typechecker$freeze_texpr(i)]});
      break _t5582;
    }
    if (_t5580._tag === 21) {
      const h = _t5580._val[0];
      const t = _t5580._val[1];
      _t5581 = ({_tag: 21, _name: "TECons", _val: [Typechecker$freeze_texpr(h), Typechecker$freeze_texpr(t)]});
      break _t5582;
    }
    if (_t5580._tag === 23) {
      const n = _t5580._val[0];
      const arg = _t5580._val[1];
      _t5581 = ({_tag: 23, _name: "TEConstruct", _val: [n, Option$map(Typechecker$freeze_texpr, arg)]});
      break _t5582;
    }
    if (_t5580._tag === 24) {
      const s = _t5580._val[0];
      const arms = _t5580._val[1];
      const p = _t5580._val[2];
      function _t5595(__p117) {
        let _t5597;
        const _t5596 = __p117;
        _t5598: {
          if (true) {
            const pat = _t5596[0];
            const g = _t5596[1];
            const b = _t5596[2];
            _t5597 = [pat, Option$map(Typechecker$freeze_texpr, g), Typechecker$freeze_texpr(b)];
            break _t5598;
          }
          _match_fail("line 16190");
        }
        return _t5597;
      }
      _t5581 = ({_tag: 24, _name: "TEMatch", _val: [Typechecker$freeze_texpr(s), List$map(_t5595, arms), p]});
      break _t5582;
    }
    if (_t5580._tag === 25) {
      const n = _t5580._val[0];
      const e1 = _t5580._val[1];
      const e2 = _t5580._val[2];
      _t5581 = ({_tag: 25, _name: "TELetMut", _val: [n, Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5582;
    }
    if (_t5580._tag === 26) {
      const n = _t5580._val[0];
      const e = _t5580._val[1];
      _t5581 = ({_tag: 26, _name: "TEAssign", _val: [n, Typechecker$freeze_texpr(e)]});
      break _t5582;
    }
    if (_t5580._tag === 27) {
      const e = _t5580._val[0];
      const f = _t5580._val[1];
      const v = _t5580._val[2];
      _t5581 = ({_tag: 27, _name: "TEFieldAssign", _val: [Typechecker$freeze_texpr(e), f, Typechecker$freeze_texpr(v)]});
      break _t5582;
    }
    if (_t5580._tag === 28) {
      const e1 = _t5580._val[0];
      const e2 = _t5580._val[1];
      _t5581 = ({_tag: 28, _name: "TESeq", _val: [Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5582;
    }
    if (_t5580._tag === 29) {
      const name = _t5580._val[0];
      const e = _t5580._val[1];
      _t5581 = ({_tag: 29, _name: "TEPerform", _val: [name, Typechecker$freeze_texpr(e)]});
      break _t5582;
    }
    if (_t5580._tag === 30) {
      const e = _t5580._val[0];
      const arms = _t5580._val[1];
      function _t5599(arm) {
        let _t5601;
        const _t5600 = arm;
        _t5602: {
          if (_t5600._tag === 0) {
            const n = _t5600._val[0];
            const b = _t5600._val[1];
            _t5601 = ({_tag: 0, _name: "THReturn", _val: [n, Typechecker$freeze_texpr(b)]});
            break _t5602;
          }
          if (_t5600._tag === 1) {
            const eff = _t5600._val[0];
            const x = _t5600._val[1];
            const k = _t5600._val[2];
            const b = _t5600._val[3];
            _t5601 = ({_tag: 1, _name: "THOp", _val: [eff, x, k, Typechecker$freeze_texpr(b)]});
            break _t5602;
          }
          if (_t5600._tag === 2) {
            const eff = _t5600._val[0];
            const x = _t5600._val[1];
            const b = _t5600._val[2];
            _t5601 = ({_tag: 2, _name: "THOpProvide", _val: [eff, x, Typechecker$freeze_texpr(b)]});
            break _t5602;
          }
          if (_t5600._tag === 3) {
            const eff = _t5600._val[0];
            const x = _t5600._val[1];
            const b = _t5600._val[2];
            _t5601 = ({_tag: 3, _name: "THOpTry", _val: [eff, x, Typechecker$freeze_texpr(b)]});
            break _t5602;
          }
          _match_fail("line 16190");
        }
        return _t5601;
      }
      _t5581 = ({_tag: 30, _name: "TEHandle", _val: [Typechecker$freeze_texpr(e), List$map(_t5599, arms)]});
      break _t5582;
    }
    if (_t5580._tag === 31) {
      const k = _t5580._val[0];
      const v = _t5580._val[1];
      _t5581 = ({_tag: 31, _name: "TEResume", _val: [Typechecker$freeze_texpr(k), Typechecker$freeze_texpr(v)]});
      break _t5582;
    }
    if (_t5580._tag === 32) {
      const c = _t5580._val[0];
      const b = _t5580._val[1];
      _t5581 = ({_tag: 32, _name: "TEWhile", _val: [Typechecker$freeze_texpr(c), Typechecker$freeze_texpr(b)]});
      break _t5582;
    }
    if (_t5580._tag === 33) {
      const e = _t5580._val;
      _t5581 = ({_tag: 33, _name: "TEBreak", _val: Typechecker$freeze_texpr(e)});
      break _t5582;
    }
    if (_t5580._tag === 34) {
      _t5581 = ({_tag: 34, _name: "TEContinueLoop"});
      break _t5582;
    }
    if (_t5580._tag === 35) {
      const e = _t5580._val;
      _t5581 = ({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$freeze_texpr(e)});
      break _t5582;
    }
    if (_t5580._tag === 36) {
      const e = _t5580._val;
      _t5581 = ({_tag: 36, _name: "TEForLoop", _val: Typechecker$freeze_texpr(e)});
      break _t5582;
    }
    if (_t5580._tag === 37) {
      const binds = _t5580._val[0];
      const body = _t5580._val[1];
      function _t5603(__p118) {
        let _t5605;
        const _t5604 = __p118;
        _t5606: {
          if (true) {
            const n = _t5604[0];
            const e = _t5604[1];
            _t5605 = [n, Typechecker$freeze_texpr(e)];
            break _t5606;
          }
          _match_fail("line 16190");
        }
        return _t5605;
      }
      _t5581 = ({_tag: 37, _name: "TELetRecAnd", _val: [List$map(_t5603, binds), Typechecker$freeze_texpr(body)]});
      break _t5582;
    }
    if (_t5580._tag === 38) {
      const pairs = _t5580._val;
      function _t5607(__p119) {
        let _t5609;
        const _t5608 = __p119;
        _t5610: {
          if (true) {
            const k = _t5608[0];
            const v = _t5608[1];
            _t5609 = [Typechecker$freeze_texpr(k), Typechecker$freeze_texpr(v)];
            break _t5610;
          }
          _match_fail("line 16190");
        }
        return _t5609;
      }
      _t5581 = ({_tag: 38, _name: "TEMap", _val: List$map(_t5607, pairs)});
      break _t5582;
    }
    if (_t5580._tag === 39) {
      const es = _t5580._val;
      _t5581 = ({_tag: 39, _name: "TEArray", _val: List$map(Typechecker$freeze_texpr, es)});
      break _t5582;
    }
    if (_t5580._tag === 40) {
      const e = _t5580._val;
      _t5581 = ({_tag: 40, _name: "TEReturn", _val: Typechecker$freeze_texpr(e)});
      break _t5582;
    }
    _match_fail("line 16190");
  }
  const fe_5611 = _t5581;
  const _t5612 = ({expr: fe_5611, loc: te.loc, ty: ft_5578});
  const _t5579 = _t5612;
  return _t5579;
}
function Typechecker$check_pattern_gadt(ctx, level, pat, scrut_ty) {
  let _t5614;
  const _t5613 = pat;
  _t5615: {
    if (_t5613._tag === 10) {
      const name = _t5613._val[0];
      const arg_pat = _t5613._val[1];
      let _t5617;
      const _t5616 = List$assoc_opt(name, ctx.type_env.constructors);
      _t5618: {
        if (_t5616._tag === 0) {
          _t5617 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
          break _t5618;
        }
        if (_t5616._tag === 1) {
          const info = _t5616._val;
          const num_fresh_5619 = (info.ctor_num_params + info.ctor_existentials);
          function _t5621(_) {
            return Types$new_tvar(level);
          }
          const all_fresh_5622 = List$init(num_fresh_5619, _t5621);
          function _t5624(i) {
            let _t5625;
            if ((i >= info.ctor_num_params)) {
              let _t5627;
              const _t5626 = List$nth(all_fresh_5622, i);
              _t5628: {
                if (_t5626._tag === 16) {
                  const r = _t5626._val;
                  _t5627 = ({_tag: 1, _name: "Some", _val: r});
                  break _t5628;
                }
                if (true) {
                  _t5627 = ({_tag: 0, _name: "None"});
                  break _t5628;
                }
                _match_fail("line 16190");
              }
              _t5625 = _t5627;
            } else {
              _t5625 = ({_tag: 0, _name: "None"});
            }
            return _t5625;
          }
          function _t5629(x) {
            return x;
          }
          const existential_refs_5630 = List$filter_map(_t5624, List$init(num_fresh_5619, _t5629));
          let _t5633;
          const _t5632 = info.ctor_return_ty_params;
          _t5634: {
            if (_t5632._tag === 1) {
              const params = _t5632._val;
              _t5633 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, List$map(_call(Typechecker$subst_tgens, [all_fresh_5622]), params)]});
              break _t5634;
            }
            if (_t5632._tag === 0) {
              function _t5635(i, _) {
                return (i < info.ctor_num_params);
              }
              const fresh_universals_5636 = List$filteri(_t5635, all_fresh_5622);
              const _t5637 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, fresh_universals_5636]});
              _t5633 = _t5637;
              break _t5634;
            }
            _match_fail("line 16190");
          }
          const return_ty_5638 = _t5633;
          Typechecker$try_unify(scrut_ty, return_ty_5638);
          let _t5641;
          const _t5640 = [info.ctor_arg_ty, arg_pat];
          _t5642: {
            if (_t5640[0]._tag === 0 && _t5640[1]._tag === 0) {
              _t5641 = null;
              break _t5642;
            }
            if (_t5640[0]._tag === 1 && _t5640[1]._tag === 1) {
              const arg_ty = _t5640[0]._val;
              const p = _t5640[1]._val;
              const concrete_ty_5643 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(all_fresh_5622, arg_ty));
              const _t5644 = Typechecker$check_pattern(ctx, level, p, concrete_ty_5643);
              _t5641 = _t5644;
              break _t5642;
            }
            if (_t5640[0]._tag === 0 && _t5640[1]._tag === 1) {
              _t5641 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " takes no arguments"));
              break _t5642;
            }
            if (_t5640[0]._tag === 1 && _t5640[1]._tag === 0) {
              _t5641 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " requires an argument"));
              break _t5642;
            }
            _match_fail("line 16190");
          }
          const bindings_5645 = _t5641;
          const _t5646 = [bindings_5645, existential_refs_5630];
          const _t5639 = _t5646;
          const _t5631 = _t5639;
          const _t5623 = _t5631;
          const _t5620 = _t5623;
          _t5617 = _t5620;
          break _t5618;
        }
        _match_fail("line 16190");
      }
      _t5614 = _t5617;
      break _t5615;
    }
    if (true) {
      _t5614 = [Typechecker$check_pattern(ctx, level, pat, scrut_ty), null];
      break _t5615;
    }
    _match_fail("line 16190");
  }
  return _t5614;
}
function Typechecker$check_existential_escape(existential_refs, result_ty) {
  function collect_tvar_refs(acc, ty) {
    while (true) {
      let _t5648;
      const _t5647 = Types$repr(ty);
      _t5649: {
        if (_t5647._tag === 16 && _t5647._val.contents._tag === 0) {
          const r = _t5647._val;
          function _t5650(x) {
            return _eq(x, r);
          }
          let _t5651;
          if (List$exists(_t5650, acc)) {
            _t5651 = acc;
          } else {
            _t5651 = ({_hd: r, _tl: acc});
          }
          _t5648 = _t5651;
          break _t5649;
        }
        if ((_t5647._tag === 7 || _t5647._tag === 8)) {
          const a = _t5647._val[0];
          const b = _t5647._val[2];
          const _t5652 = collect_tvar_refs(acc, a);
          const _t5653 = b;
          acc = _t5652;
          ty = _t5653;
          continue;
          _t5648 = undefined;
          break _t5649;
        }
        if (_t5647._tag === 9) {
          const ts = _t5647._val;
          _t5648 = List$fold(collect_tvar_refs, acc, ts);
          break _t5649;
        }
        if (_t5647._tag === 10) {
          const t = _t5647._val;
          const _t5654 = acc;
          const _t5655 = t;
          acc = _t5654;
          ty = _t5655;
          continue;
          _t5648 = undefined;
          break _t5649;
        }
        if (_t5647._tag === 14) {
          const t = _t5647._val;
          const _t5656 = acc;
          const _t5657 = t;
          acc = _t5656;
          ty = _t5657;
          continue;
          _t5648 = undefined;
          break _t5649;
        }
        if (_t5647._tag === 13) {
          const k = _t5647._val[0];
          const v = _t5647._val[1];
          const _t5658 = collect_tvar_refs(acc, k);
          const _t5659 = v;
          acc = _t5658;
          ty = _t5659;
          continue;
          _t5648 = undefined;
          break _t5649;
        }
        if (_t5647._tag === 11) {
          const row = _t5647._val;
          function _t5660(a, __p120) {
            let _t5662;
            const _t5661 = __p120;
            _t5663: {
              if (true) {
                const t = _t5661[1];
                _t5662 = collect_tvar_refs(a, t);
                break _t5663;
              }
              _match_fail("line 16190");
            }
            return _t5662;
          }
          _t5648 = List$fold(_t5660, acc, Types$record_row_to_fields(row));
          break _t5649;
        }
        if (_t5647._tag === 12) {
          const args = _t5647._val[1];
          _t5648 = List$fold(collect_tvar_refs, acc, args);
          break _t5649;
        }
        if (_t5647._tag === 15) {
          const row = _t5647._val;
          function collect_pv(a, __x) {
            while (true) {
              let _t5665;
              const _t5664 = __x;
              _t5666: {
                if (_t5664._tag === 0 && _t5664._val[1]._tag === 1) {
                  const t = _t5664._val[1]._val;
                  const tail = _t5664._val[2];
                  const _t5667 = collect_tvar_refs(a, t);
                  const _t5668 = tail;
                  a = _t5667;
                  __x = _t5668;
                  continue;
                  _t5665 = undefined;
                  break _t5666;
                }
                if (_t5664._tag === 0 && _t5664._val[1]._tag === 0) {
                  const tail = _t5664._val[2];
                  const _t5669 = a;
                  const _t5670 = tail;
                  a = _t5669;
                  __x = _t5670;
                  continue;
                  _t5665 = undefined;
                  break _t5666;
                }
                if (true) {
                  _t5665 = a;
                  break _t5666;
                }
                _match_fail("line 16190");
              }
              return _t5665;
            }
          }
          const _t5671 = collect_pv(acc, row);
          _t5648 = _t5671;
          break _t5649;
        }
        if (true) {
          _t5648 = acc;
          break _t5649;
        }
        _match_fail("line 16190");
      }
      return _t5648;
    }
  }
  const result_refs_5673 = collect_tvar_refs(null, Types$deep_repr(result_ty));
  function _t5675(exist_ref) {
    let _t5677;
    const _t5676 = Types$repr(({_tag: 16, _name: "TVar", _val: exist_ref}));
    _t5678: {
      if (_t5676._tag === 16 && _t5676._val.contents._tag === 0) {
        const resolved_ref = _t5676._val;
        function _t5679(r) {
          return _eq(r, resolved_ref);
        }
        _t5677 = List$exists(_t5679, result_refs_5673);
        break _t5678;
      }
      if (true) {
        const resolved = _t5676;
        const exist_refs_5680 = collect_tvar_refs(null, resolved);
        function _t5682(er) {
          function _t5683(rr) {
            return _eq(er, rr);
          }
          return List$exists(_t5683, result_refs_5673);
        }
        const _t5681 = List$exists(_t5682, exist_refs_5680);
        _t5677 = _t5681;
        break _t5678;
      }
      _match_fail("line 16190");
    }
    return _t5677;
  }
  const has_escape_5684 = List$exists(_t5675, existential_refs);
  let _t5686;
  if (has_escape_5684) {
    _t5686 = Typechecker$error("existential type variable would escape the scope of its GADT match arm");
  } else {
    _t5686 = undefined;
  }
  const _t5685 = _t5686;
  const _t5674 = _t5685;
  const _t5672 = _t5674;
  return _t5672;
}
function Typechecker$synth_match(expected_ty, ctx, level, scrut, arms, partial) {
  const scrut_te_5687 = Typechecker$synth(ctx, level, scrut);
  let _t5690;
  const _t5689 = Types$repr(scrut_te_5687.ty);
  _t5691: {
    if (_t5689._tag === 12) {
      const name = _t5689._val[0];
      const params = _t5689._val[1];
      let _t5693;
      const _t5692 = Typechecker$find_variant_info(ctx.type_env, name);
      _t5694: {
        if (_t5692._tag === 1 && _t5692._val[3]) {
          _t5693 = ({_tag: 1, _name: "Some", _val: [name, params]});
          break _t5694;
        }
        if (true) {
          _t5693 = ({_tag: 0, _name: "None"});
          break _t5694;
        }
        _match_fail("line 16190");
      }
      _t5690 = _t5693;
      break _t5691;
    }
    if (true) {
      _t5690 = ({_tag: 0, _name: "None"});
      break _t5691;
    }
    _match_fail("line 16190");
  }
  const gadt_info_5695 = _t5690;
  let _t5698;
  const _t5697 = gadt_info_5695;
  _t5699: {
    if (_t5697._tag === 1) {
      const _gadt_name = _t5697._val[0];
      const scrut_params = _t5697._val[1];
      let _t5701;
      const _t5700 = expected_ty;
      _t5702: {
        if (_t5700._tag === 1) {
          const ty = _t5700._val;
          _t5701 = ty;
          break _t5702;
        }
        if (_t5700._tag === 0) {
          _t5701 = Types$new_tvar(level);
          break _t5702;
        }
        _match_fail("line 16190");
      }
      const result_ty_5703 = _t5701;
      function _t5705(ty) {
        let _t5707;
        const _t5706 = Types$repr(ty);
        _t5708: {
          if (_t5706._tag === 16) {
            const r = _t5706._val;
            _t5707 = ({_tag: 1, _name: "Some", _val: r});
            break _t5708;
          }
          if (true) {
            _t5707 = ({_tag: 0, _name: "None"});
            break _t5708;
          }
          _match_fail("line 16190");
        }
        return _t5707;
      }
      const get_tvar_ref_5709 = _t5705;
      function _t5711(p) {
        let _t5713;
        const _t5712 = get_tvar_ref_5709(p);
        _t5714: {
          if (_t5712._tag === 1) {
            const r = _t5712._val;
            _t5713 = ({_tag: 1, _name: "Some", _val: [r, Ref$get(r)]});
            break _t5714;
          }
          if (_t5712._tag === 0) {
            _t5713 = ({_tag: 0, _name: "None"});
            break _t5714;
          }
          _match_fail("line 16190");
        }
        return _t5713;
      }
      const param_refs_5715 = List$filter_map(_t5711, scrut_params);
      function _t5717(_) {
        function _t5718(__p121) {
          let _t5720;
          const _t5719 = __p121;
          _t5721: {
            if (true) {
              const r = _t5719[0];
              _t5720 = [r, Ref$get(r)];
              break _t5721;
            }
            _match_fail("line 16190");
          }
          return _t5720;
        }
        return List$map(_t5718, param_refs_5715);
      }
      const save_snapshot_5722 = _t5717;
      function _t5724(saved) {
        function _t5725(__p122) {
          let _t5727;
          const _t5726 = __p122;
          _t5728: {
            if (true) {
              const r = _t5726[0];
              const v = _t5726[1];
              _t5727 = Ref$set(r, v);
              break _t5728;
            }
            _match_fail("line 16190");
          }
          return _t5727;
        }
        return List$iter(_t5725, saved);
      }
      const restore_snapshot_5729 = _t5724;
      function _t5731(__p123) {
        let _t5733;
        const _t5732 = __p123;
        _t5734: {
          if (true) {
            const pat = _t5732[0];
            const guard = _t5732[1];
            const body = _t5732[2];
            const snapshot_5735 = save_snapshot_5722(undefined);
            let _t5738;
            const _t5737 = pat;
            _t5739: {
              if (_t5737._tag === 10) {
                const name = _t5737._val[0];
                _t5738 = ({_tag: 1, _name: "Some", _val: name});
                break _t5739;
              }
              if (true) {
                _t5738 = ({_tag: 0, _name: "None"});
                break _t5739;
              }
              _match_fail("line 16190");
            }
            const ctor_name_5740 = _t5738;
            let _t5743;
            const _t5742 = ctor_name_5740;
            _t5744: {
              if (_t5742._tag === 1) {
                const name = _t5742._val;
                let _t5746;
                const _t5745 = List$assoc_opt(name, ctx.type_env.constructors);
                _t5747: {
                  if (_t5745._tag === 1) {
                    const info = _t5745._val;
                    _t5746 = !_eq(info.ctor_return_ty_params, ({_tag: 0, _name: "None"}));
                    break _t5747;
                  }
                  if (_t5745._tag === 0) {
                    _t5746 = false;
                    break _t5747;
                  }
                  _match_fail("line 16190");
                }
                _t5743 = _t5746;
                break _t5744;
              }
              if (_t5742._tag === 0) {
                _t5743 = false;
                break _t5744;
              }
              _match_fail("line 16190");
            }
            const is_gadt_ctor_5748 = _t5743;
            let _t5750;
            if (is_gadt_ctor_5748) {
              _t5750 = Typechecker$check_pattern_gadt(ctx, level, pat, scrut_te_5687.ty);
            } else {
              _t5750 = [Typechecker$check_pattern(ctx, level, pat, scrut_te_5687.ty), null];
            }
            let _t5752;
            const _t5751 = _t5750;
            _t5753: {
              if (true) {
                const bindings = _t5751[0];
                const existential_refs = _t5751[1];
                function _t5754(c, __p124) {
                  let _t5756;
                  const _t5755 = __p124;
                  _t5757: {
                    if (true) {
                      const n = _t5755[0];
                      const t = _t5755[1];
                      _t5756 = Typechecker$extend_var_mono(c, n, t);
                      break _t5757;
                    }
                    _match_fail("line 16190");
                  }
                  return _t5756;
                }
                const ctx$p_5758 = List$fold(_t5754, ctx, bindings);
                let _t5761;
                const _t5760 = guard;
                _t5762: {
                  if (_t5760._tag === 1) {
                    const g = _t5760._val;
                    _t5761 = ({_tag: 1, _name: "Some", _val: Typechecker$check(ctx$p_5758, level, g, ({_tag: 2, _name: "TBool"}))});
                    break _t5762;
                  }
                  if (_t5760._tag === 0) {
                    _t5761 = ({_tag: 0, _name: "None"});
                    break _t5762;
                  }
                  _match_fail("line 16190");
                }
                const guard_te_5763 = _t5761;
                const body_te_5765 = Typechecker$check(ctx$p_5758, level, body, result_ty_5703);
                const guard_te_5767 = Option$map(Typechecker$freeze_texpr, guard_te_5763);
                const body_te_5769 = Typechecker$freeze_texpr(body_te_5765);
                let _t5771;
                if (!_eq(existential_refs, null)) {
                  _t5771 = Typechecker$check_existential_escape(existential_refs, result_ty_5703);
                } else {
                  _t5771 = undefined;
                }
                _t5771;
                restore_snapshot_5729(snapshot_5735);
                const _t5770 = [Typechecker$qualify_pattern(ctx.type_env, pat), guard_te_5767, body_te_5769];
                const _t5768 = _t5770;
                const _t5766 = _t5768;
                const _t5764 = _t5766;
                const _t5759 = _t5764;
                _t5752 = _t5759;
                break _t5753;
              }
              _match_fail("line 16190");
            }
            const _t5749 = _t5752;
            const _t5741 = _t5749;
            const _t5736 = _t5741;
            _t5733 = _t5736;
            break _t5734;
          }
          _match_fail("line 16190");
        }
        return _t5733;
      }
      const check_gadt_arm_5772 = _t5731;
      let _t5775;
      const _t5774 = arms;
      _t5776: {
        if (_t5774 === null) {
          _t5775 = Typechecker$error("match expression has no arms");
          break _t5776;
        }
        if (_t5774 !== null) {
          const first = _t5774._hd;
          const rest = _t5774._tl;
          const first_arm_5777 = check_gadt_arm_5772(first);
          const rest_arms_5779 = List$map(check_gadt_arm_5772, rest);
          const all_arms_5781 = ({_hd: first_arm_5777, _tl: rest_arms_5779});
          let _t5783;
          if ((!partial)) {
            _t5783 = Ref$get(Typechecker$exhaustiveness_check_ref, ctx, Types$repr(scrut_te_5687.ty), all_arms_5781);
          } else {
            _t5783 = undefined;
          }
          _t5783;
          const _t5782 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [scrut_te_5687, all_arms_5781, partial]}), result_ty_5703);
          const _t5780 = _t5782;
          const _t5778 = _t5780;
          _t5775 = _t5778;
          break _t5776;
        }
        _match_fail("line 16190");
      }
      const _t5773 = _t5775;
      const _t5730 = _t5773;
      const _t5723 = _t5730;
      const _t5716 = _t5723;
      const _t5710 = _t5716;
      const _t5704 = _t5710;
      _t5698 = _t5704;
      break _t5699;
    }
    if (_t5697._tag === 0) {
      function _t5784(ctx, __p125) {
        let _t5786;
        const _t5785 = __p125;
        _t5787: {
          if (true) {
            const pat = _t5785[0];
            const guard = _t5785[1];
            const body = _t5785[2];
            const bindings_5788 = Typechecker$check_pattern(ctx, level, pat, scrut_te_5687.ty);
            function _t5790(c, __p126) {
              let _t5792;
              const _t5791 = __p126;
              _t5793: {
                if (true) {
                  const n = _t5791[0];
                  const t = _t5791[1];
                  _t5792 = Typechecker$extend_var_mono(c, n, t);
                  break _t5793;
                }
                _match_fail("line 16190");
              }
              return _t5792;
            }
            const ctx$p_5794 = List$fold(_t5790, ctx, bindings_5788);
            let _t5797;
            const _t5796 = guard;
            _t5798: {
              if (_t5796._tag === 1) {
                const g = _t5796._val;
                const gte_5799 = Typechecker$check(ctx$p_5794, level, g, ({_tag: 2, _name: "TBool"}));
                const _t5800 = ({_tag: 1, _name: "Some", _val: gte_5799});
                _t5797 = _t5800;
                break _t5798;
              }
              if (_t5796._tag === 0) {
                _t5797 = ({_tag: 0, _name: "None"});
                break _t5798;
              }
              _match_fail("line 16190");
            }
            const guard_te_5801 = _t5797;
            const body_te_5803 = Typechecker$synth(ctx$p_5794, level, body);
            const _t5804 = [Typechecker$qualify_pattern(ctx.type_env, pat), guard_te_5801, body_te_5803];
            const _t5802 = _t5804;
            const _t5795 = _t5802;
            const _t5789 = _t5795;
            _t5786 = _t5789;
            break _t5787;
          }
          _match_fail("line 16190");
        }
        return _t5786;
      }
      const check_arm_5805 = _t5784;
      let _t5808;
      const _t5807 = arms;
      _t5809: {
        if (_t5807 === null) {
          _t5808 = Typechecker$error("match expression has no arms");
          break _t5809;
        }
        if (_t5807 !== null) {
          const first = _t5807._hd;
          const rest = _t5807._tl;
          let _t5811;
          const _t5810 = check_arm_5805(ctx, first);
          _t5812: {
            if (true) {
              const fp = _t5810[0];
              const fg = _t5810[1];
              const fb = _t5810[2];
              const result_ty_5813 = fb.ty;
              function _t5815(arm) {
                let _t5817;
                const _t5816 = check_arm_5805(ctx, arm);
                _t5818: {
                  if (true) {
                    const p = _t5816[0];
                    const g = _t5816[1];
                    const b = _t5816[2];
                    Typechecker$try_unify(b.ty, result_ty_5813);
                    _t5817 = [p, g, b];
                    break _t5818;
                  }
                  _match_fail("line 16190");
                }
                return _t5817;
              }
              const all_arms_5819 = ({_hd: [fp, fg, fb], _tl: List$map(_t5815, rest)});
              let _t5821;
              if ((!partial)) {
                _t5821 = Ref$get(Typechecker$exhaustiveness_check_ref, ctx, Types$repr(scrut_te_5687.ty), all_arms_5819);
              } else {
                _t5821 = undefined;
              }
              _t5821;
              const _t5820 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [scrut_te_5687, all_arms_5819, partial]}), result_ty_5813);
              const _t5814 = _t5820;
              _t5811 = _t5814;
              break _t5812;
            }
            _match_fail("line 16190");
          }
          _t5808 = _t5811;
          break _t5809;
        }
        _match_fail("line 16190");
      }
      const _t5806 = _t5808;
      _t5698 = _t5806;
      break _t5699;
    }
    _match_fail("line 16190");
  }
  const _t5696 = _t5698;
  const _t5688 = _t5696;
  return _t5688;
}
function Typechecker$check(ctx, level, expr, expected) {
  while (true) {
    let _t5823;
    const _t5822 = expr;
    _t5824: {
      if (_t5822._tag === 49) {
        const loc = _t5822._val[0];
        const inner = _t5822._val[1];
        Ref$set(Typechecker$current_loc, loc);
        const _t5825 = ctx;
        const _t5826 = level;
        const _t5827 = inner;
        const _t5828 = expected;
        ctx = _t5825;
        level = _t5826;
        expr = _t5827;
        expected = _t5828;
        continue;
        _t5823 = undefined;
        break _t5824;
      }
      if (_t5822._tag === 10) {
        const param = _t5822._val[0];
        const body = _t5822._val[1];
        if (_eq(param.annot, ({_tag: 0, _name: "None"}))) {
          const arg_ty_5829 = Types$new_tvar(level);
          const ret_ty_5831 = Types$new_tvar(level);
          const fn_eff_5833 = Types$new_effvar(level);
          Typechecker$try_unify(expected, ({_tag: 7, _name: "TArrow", _val: [arg_ty_5829, fn_eff_5833, ret_ty_5831]}));
          const return_used_5835 = Ref$create(false);
          const __rec_upd_5837 = ctx;
          const _t5838 = ({constraint_tvars: __rec_upd_5837.constraint_tvars, current_eff: fn_eff_5833, current_module: __rec_upd_5837.current_module, inside_handler: false, loop_info: __rec_upd_5837.loop_info, mutable_vars: __rec_upd_5837.mutable_vars, return_type: ({_tag: 1, _name: "Some", _val: ret_ty_5831}), return_used: return_used_5835, type_env: __rec_upd_5837.type_env, vars: __rec_upd_5837.vars});
          const ctx$p_5839 = Typechecker$extend_var_mono(_t5838, param.name, Types$repr(arg_ty_5829));
          const body_te_5841 = Typechecker$check(ctx$p_5839, level, body, ret_ty_5831);
          let _t5843;
          if (param.is_generated) {
            _t5843 = false;
          } else {
            _t5843 = Ref$get(return_used_5835);
          }
          const has_return_5844 = _t5843;
          const _t5845 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param.name, body_te_5841, has_return_5844]}), ({_tag: 7, _name: "TArrow", _val: [arg_ty_5829, fn_eff_5833, body_te_5841.ty]}));
          const _t5842 = _t5845;
          const _t5840 = _t5842;
          const _t5836 = _t5840;
          const _t5834 = _t5836;
          const _t5832 = _t5834;
          const _t5830 = _t5832;
          _t5823 = _t5830;
          break _t5824;
        }
      }
      if (_t5822._tag === 25) {
        const scrut = _t5822._val[0];
        const arms = _t5822._val[1];
        const partial = _t5822._val[2];
        _t5823 = Typechecker$synth_match(({_tag: 1, _name: "Some", _val: expected}), ctx, level, scrut, arms, partial);
        break _t5824;
      }
      if (true) {
        const te_5846 = Typechecker$synth(ctx, level, expr);
        Typechecker$try_unify(te_5846.ty, expected);
        const __rec_upd_5848 = te_5846;
        const _t5849 = ({expr: __rec_upd_5848.expr, loc: __rec_upd_5848.loc, ty: expected});
        const _t5847 = _t5849;
        _t5823 = _t5847;
        break _t5824;
      }
      _match_fail("line 16190");
    }
    return _t5823;
  }
}
function Typechecker$check_pattern(ctx, level, pat, ty) {
  while (true) {
    let _t5851;
    const _t5850 = pat;
    _t5852: {
      if (_t5850._tag === 0) {
        _t5851 = null;
        break _t5852;
      }
      if (_t5850._tag === 1) {
        const name = _t5850._val;
        _t5851 = ({_hd: [name, ty], _tl: null});
        break _t5852;
      }
      if (_t5850._tag === 2) {
        Typechecker$try_unify(ty, ({_tag: 0, _name: "TInt"}));
        _t5851 = null;
        break _t5852;
      }
      if (_t5850._tag === 3) {
        Typechecker$try_unify(ty, ({_tag: 1, _name: "TFloat"}));
        _t5851 = null;
        break _t5852;
      }
      if (_t5850._tag === 4) {
        Typechecker$try_unify(ty, ({_tag: 2, _name: "TBool"}));
        _t5851 = null;
        break _t5852;
      }
      if (_t5850._tag === 5) {
        Typechecker$try_unify(ty, ({_tag: 3, _name: "TString"}));
        _t5851 = null;
        break _t5852;
      }
      if (_t5850._tag === 6) {
        Typechecker$try_unify(ty, ({_tag: 6, _name: "TUnit"}));
        _t5851 = null;
        break _t5852;
      }
      if (_t5850._tag === 7) {
        const pats = _t5850._val;
        function _t5853(_) {
          return Types$new_tvar(level);
        }
        const tys_5854 = List$map(_t5853, pats);
        Typechecker$try_unify(ty, ({_tag: 9, _name: "TTuple", _val: tys_5854}));
        const _t5855 = List$flatten(List$map2(_call(Typechecker$check_pattern, [ctx, level]), pats, tys_5854));
        _t5851 = _t5855;
        break _t5852;
      }
      if (_t5850._tag === 8) {
        const hd_pat = _t5850._val[0];
        const tl_pat = _t5850._val[1];
        const elem_ty_5856 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 10, _name: "TList", _val: elem_ty_5856}));
        const hd_bindings_5858 = Typechecker$check_pattern(ctx, level, hd_pat, elem_ty_5856);
        const tl_bindings_5860 = Typechecker$check_pattern(ctx, level, tl_pat, ty);
        const _t5861 = List$concat(hd_bindings_5858, tl_bindings_5860);
        const _t5859 = _t5861;
        const _t5857 = _t5859;
        _t5851 = _t5857;
        break _t5852;
      }
      if (_t5850._tag === 9) {
        const elem_ty_5862 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 10, _name: "TList", _val: elem_ty_5862}));
        const _t5863 = null;
        _t5851 = _t5863;
        break _t5852;
      }
      if (_t5850._tag === 10) {
        const name = _t5850._val[0];
        const arg_pat = _t5850._val[1];
        let _t5865;
        const _t5864 = List$assoc_opt(name, ctx.type_env.constructors);
        _t5866: {
          if (_t5864._tag === 0) {
            _t5865 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
            break _t5866;
          }
          if (_t5864._tag === 1) {
            const info = _t5864._val;
            function _t5867(_) {
              return Types$new_tvar(level);
            }
            const fresh_args_5868 = List$init(info.ctor_num_params, _t5867);
            const expected_variant_5870 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, fresh_args_5868]});
            Typechecker$try_unify(ty, expected_variant_5870);
            let _t5873;
            const _t5872 = [info.ctor_arg_ty, arg_pat];
            _t5874: {
              if (_t5872[0]._tag === 0 && _t5872[1]._tag === 0) {
                _t5873 = null;
                break _t5874;
              }
              if (_t5872[0]._tag === 1 && _t5872[1]._tag === 1) {
                const arg_ty = _t5872[0]._val;
                const p = _t5872[1]._val;
                const concrete_ty_5875 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(fresh_args_5868, arg_ty));
                const _t5877 = ctx;
                const _t5878 = level;
                const _t5879 = p;
                const _t5880 = concrete_ty_5875;
                ctx = _t5877;
                level = _t5878;
                pat = _t5879;
                ty = _t5880;
                continue;
                const _t5876 = undefined;
                _t5873 = _t5876;
                break _t5874;
              }
              if (_t5872[0]._tag === 0 && _t5872[1]._tag === 1) {
                _t5873 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " takes no arguments"));
                break _t5874;
              }
              if (_t5872[0]._tag === 1 && _t5872[1]._tag === 0) {
                _t5873 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " requires an argument"));
                break _t5874;
              }
              _match_fail("line 16190");
            }
            const _t5871 = _t5873;
            const _t5869 = _t5871;
            _t5865 = _t5869;
            break _t5866;
          }
          _match_fail("line 16190");
        }
        _t5851 = _t5865;
        break _t5852;
      }
      if (_t5850._tag === 11) {
        const field_pats = _t5850._val;
        let _t5882;
        const _t5881 = Types$repr(ty);
        _t5883: {
          if (_t5881._tag === 11) {
            const row = _t5881._val;
            _t5882 = Types$record_row_to_fields(row);
            break _t5883;
          }
          if (true) {
            const pat_field_names_5884 = List$map(fst, field_pats);
            function _t5886(__p127) {
              let _t5888;
              const _t5887 = __p127;
              _t5889: {
                if (true) {
                  const _name = _t5887[0];
                  const fields = _t5887[1];
                  function _t5890(fn_) {
                    return List$mem_assoc(fn_, fields);
                  }
                  _t5888 = List$forall(_t5890, pat_field_names_5884);
                  break _t5889;
                }
                _match_fail("line 16190");
              }
              return _t5888;
            }
            const candidates_5891 = List$filter(_t5886, ctx.type_env.records);
            let _t5894;
            const _t5893 = candidates_5891;
            _t5895: {
              if (_t5893 !== null && _t5893._tl === null) {
                const _name = _t5893._hd[0];
                const fields = _t5893._hd[1];
                const row_5896 = Typechecker$instantiate_record_row(level, fields);
                Typechecker$try_unify(ty, ({_tag: 11, _name: "TRecord", _val: row_5896}));
                const _t5897 = Typechecker$instantiate_record_fields(level, fields);
                _t5894 = _t5897;
                break _t5895;
              }
              if (_t5893 === null) {
                let _t5899;
                const _t5898 = Types$repr(ty);
                _t5900: {
                  if (_t5898._tag === 16) {
                    function _t5901(fname, rest) {
                      return ({_tag: 0, _name: "RRow", _val: [fname, Types$new_tvar(level), rest]});
                    }
                    const row_5902 = List$fold_right(_t5901, pat_field_names_5884, Types$new_rvar(level));
                    Typechecker$try_unify(ty, ({_tag: 11, _name: "TRecord", _val: row_5902}));
                    let _t5905;
                    const _t5904 = Types$repr(ty);
                    _t5906: {
                      if (_t5904._tag === 11) {
                        const r = _t5904._val;
                        _t5905 = r;
                        break _t5906;
                      }
                      if (true) {
                        _t5905 = Typechecker$error("record pattern used with non-record type");
                        break _t5906;
                      }
                      _match_fail("line 16190");
                    }
                    const _t5903 = Types$record_row_to_fields(_t5905);
                    _t5899 = _t5903;
                    break _t5900;
                  }
                  if (true) {
                    _t5899 = Typechecker$error("record pattern used with non-record type");
                    break _t5900;
                  }
                  _match_fail("line 16190");
                }
                _t5894 = _t5899;
                break _t5895;
              }
              if (true) {
                _t5894 = Typechecker$error("ambiguous record pattern â€” annotate the type");
                break _t5895;
              }
              _match_fail("line 16190");
            }
            const _t5892 = _t5894;
            const _t5885 = _t5892;
            _t5882 = _t5885;
            break _t5883;
          }
          _match_fail("line 16190");
        }
        const field_tys_5907 = _t5882;
        function _t5909(__p128) {
          let _t5911;
          const _t5910 = __p128;
          _t5912: {
            if (true) {
              const name = _t5910[0];
              const pat = _t5910[1];
              let _t5914;
              const _t5913 = List$assoc_opt(name, field_tys_5907);
              _t5915: {
                if (_t5913._tag === 1) {
                  const fty = _t5913._val;
                  _t5914 = Typechecker$check_pattern(ctx, level, pat, fty);
                  break _t5915;
                }
                if (_t5913._tag === 0) {
                  _t5914 = Typechecker$error(("record type has no field " + __dict_Show_string.show(name)));
                  break _t5915;
                }
                _match_fail("line 16190");
              }
              _t5911 = _t5914;
              break _t5912;
            }
            _match_fail("line 16190");
          }
          return _t5911;
        }
        const _t5908 = List$flatten(List$map(_t5909, field_pats));
        _t5851 = _t5908;
        break _t5852;
      }
      if (_t5850._tag === 12) {
        const inner_pat = _t5850._val[0];
        const name = _t5850._val[1];
        const bindings_5916 = Typechecker$check_pattern(ctx, level, inner_pat, ty);
        const _t5917 = ({_hd: [name, ty], _tl: bindings_5916});
        _t5851 = _t5917;
        break _t5852;
      }
      if (_t5850._tag === 13) {
        const p1 = _t5850._val[0];
        const p2 = _t5850._val[1];
        const bindings1_5918 = Typechecker$check_pattern(ctx, level, p1, ty);
        const bindings2_5920 = Typechecker$check_pattern(ctx, level, p2, ty);
        const names1_5922 = _call(_call(List$sort, [String$compare]), [List$map(fst, bindings1_5918)]);
        const names2_5924 = _call(_call(List$sort, [String$compare]), [List$map(fst, bindings2_5920)]);
        let _t5926;
        if (!_eq(names1_5922, names2_5924)) {
          _t5926 = Typechecker$error("or-pattern branches must bind the same variables");
        } else {
          _t5926 = undefined;
        }
        _t5926;
        function _t5927(__p129) {
          let _t5929;
          const _t5928 = __p129;
          _t5930: {
            if (true) {
              const name = _t5928[0];
              const ty1 = _t5928[1];
              let _t5932;
              const _t5931 = List$assoc_opt(name, bindings2_5920);
              _t5933: {
                if (_t5931._tag === 1) {
                  const ty2 = _t5931._val;
                  _t5932 = Typechecker$try_unify(ty1, ty2);
                  break _t5933;
                }
                if (_t5931._tag === 0) {
                  _t5932 = undefined;
                  break _t5933;
                }
                _match_fail("line 16190");
              }
              _t5929 = _t5932;
              break _t5930;
            }
            _match_fail("line 16190");
          }
          return _t5929;
        }
        List$iter(_t5927, bindings1_5918);
        const _t5925 = bindings1_5918;
        const _t5923 = _t5925;
        const _t5921 = _t5923;
        const _t5919 = _t5921;
        _t5851 = _t5919;
        break _t5852;
      }
      if (_t5850._tag === 14) {
        const pats = _t5850._val;
        const elem_ty_5934 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 14, _name: "TArray", _val: elem_ty_5934}));
        function _t5936(p) {
          return Typechecker$check_pattern(ctx, level, p, elem_ty_5934);
        }
        const _t5935 = List$concat_map(_t5936, pats);
        _t5851 = _t5935;
        break _t5852;
      }
      if (_t5850._tag === 15) {
        const entries = _t5850._val;
        const key_ty_5937 = Types$new_tvar(level);
        const val_ty_5939 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 13, _name: "TMap", _val: [key_ty_5937, val_ty_5939]}));
        function _t5941(__p130) {
          let _t5943;
          const _t5942 = __p130;
          _t5944: {
            if (true) {
              const kpat = _t5942[0];
              const vpat = _t5942[1];
              _t5943 = List$concat(Typechecker$check_pattern(ctx, level, kpat, key_ty_5937), Typechecker$check_pattern(ctx, level, vpat, val_ty_5939));
              break _t5944;
            }
            _match_fail("line 16190");
          }
          return _t5943;
        }
        const _t5940 = List$concat_map(_t5941, entries);
        const _t5938 = _t5940;
        _t5851 = _t5938;
        break _t5852;
      }
      if (_t5850._tag === 16 && _t5850._val[1]._tag === 0) {
        const tag = _t5850._val[0];
        const tail_5945 = Types$new_pvvar(level);
        const row_5947 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 0, _name: "None"}), tail_5945]});
        Typechecker$try_unify(ty, ({_tag: 15, _name: "TPolyVariant", _val: row_5947}));
        const _t5948 = null;
        const _t5946 = _t5948;
        _t5851 = _t5946;
        break _t5852;
      }
      if (_t5850._tag === 16 && _t5850._val[1]._tag === 1) {
        const tag = _t5850._val[0];
        const sub_pat = _t5850._val[1]._val;
        const payload_ty_5949 = Types$new_tvar(level);
        const tail_5951 = Types$new_pvvar(level);
        const row_5953 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 1, _name: "Some", _val: payload_ty_5949}), tail_5951]});
        Typechecker$try_unify(ty, ({_tag: 15, _name: "TPolyVariant", _val: row_5953}));
        const _t5955 = ctx;
        const _t5956 = level;
        const _t5957 = sub_pat;
        const _t5958 = payload_ty_5949;
        ctx = _t5955;
        level = _t5956;
        pat = _t5957;
        ty = _t5958;
        continue;
        const _t5954 = undefined;
        const _t5952 = _t5954;
        const _t5950 = _t5952;
        _t5851 = _t5950;
        break _t5852;
      }
      if (_t5850._tag === 17) {
        const name = _t5850._val;
        let _t5960;
        const _t5959 = List$assoc_opt(name, ctx.vars);
        _t5961: {
          if (_t5959._tag === 1) {
            const scheme = _t5959._val;
            const var_ty_5962 = Types$instantiate(level, scheme);
            Typechecker$try_unify(ty, var_ty_5962);
            const _t5963 = null;
            _t5960 = _t5963;
            break _t5961;
          }
          if (_t5959._tag === 0) {
            _t5960 = Typechecker$error(("unbound variable in pin pattern: " + __dict_Show_string.show(name)));
            break _t5961;
          }
          _match_fail("line 16190");
        }
        _t5851 = _t5960;
        break _t5852;
      }
      if (_t5850._tag === 18) {
        const inner_pat = _t5850._val[0];
        const annot = _t5850._val[1];
        const annot_ty_5964 = Typechecker$resolve_ty_annot(ctx, level, annot);
        Typechecker$try_unify(ty, annot_ty_5964);
        const _t5966 = ctx;
        const _t5967 = level;
        const _t5968 = inner_pat;
        const _t5969 = ty;
        ctx = _t5966;
        level = _t5967;
        pat = _t5968;
        ty = _t5969;
        continue;
        const _t5965 = undefined;
        _t5851 = _t5965;
        break _t5852;
      }
      _match_fail("line 16190");
    }
    return _t5851;
  }
}
function Typechecker$synth_poly_rec_fn(ctx, level, name, qualified_name, type_params, params, ret_annot, body) {
  const shared_tvars_5970 = Hashtbl$create(4);
  function _t5972(tp) {
    return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_5970, tp, Types$new_tvar((level + 1))]);
  }
  List$iter(_t5972, type_params);
  function _t5973(p) {
    let _t5975;
    const _t5974 = p.annot;
    _t5976: {
      if (_t5974._tag === 1) {
        const annot = _t5974._val;
        _t5975 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5970, annot);
        break _t5976;
      }
      if (_t5974._tag === 0) {
        _t5975 = Types$new_tvar((level + 1));
        break _t5976;
      }
      _match_fail("line 16190");
    }
    return _t5975;
  }
  const param_tys_5977 = List$map(_t5973, params);
  let _t5980;
  const _t5979 = ret_annot;
  _t5981: {
    if (_t5979._tag === 1 && _t5979._val._tag === 11) {
      const ty = _t5979._val._val[0];
      const eff_annot = _t5979._val._val[1];
      const ty$p_5982 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5970, ty);
      let _t5985;
      const _t5984 = eff_annot;
      _t5986: {
        if (_t5984._tag === 0) {
          _t5985 = ({_tag: 1, _name: "EffEmpty"});
          break _t5986;
        }
        if (_t5984._tag === 1) {
          const items = _t5984._val;
          _t5985 = Typechecker$resolve_eff_items(ctx, (level + 1), shared_tvars_5970, items);
          break _t5986;
        }
        _match_fail("line 16190");
      }
      const eff_5987 = _t5985;
      const _t5988 = [ty$p_5982, eff_5987];
      const _t5983 = _t5988;
      _t5980 = _t5983;
      break _t5981;
    }
    if (_t5979._tag === 1) {
      const annot = _t5979._val;
      _t5980 = [Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5970, annot), Types$new_effvar((level + 1))];
      break _t5981;
    }
    if (_t5979._tag === 0) {
      _t5980 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
      break _t5981;
    }
    _match_fail("line 16190");
  }
  let _t5990;
  const _t5989 = _t5980;
  _t5991: {
    if (true) {
      const ret_ty = _t5989[0];
      const body_eff = _t5989[1];
      let _t5993;
      const _t5992 = List$rev(param_tys_5977);
      _t5994: {
        if (_t5992 === null) {
          _t5993 = ret_ty;
          break _t5994;
        }
        if (_t5992 !== null) {
          const last = _t5992._hd;
          const rest = _t5992._tl;
          const inner_5995 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
          function _t5997(acc, pty) {
            return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
          }
          const _t5996 = List$fold(_t5997, inner_5995, rest);
          _t5993 = _t5996;
          break _t5994;
        }
        _match_fail("line 16190");
      }
      const fn_ty_5998 = _t5993;
      const scheme_6000 = Types$generalize(level, fn_ty_5998);
      const ctx_with_self_6002 = Typechecker$extend_var(ctx, name, scheme_6000);
      let _t6004;
      if ((qualified_name !== "")) {
        _t6004 = Typechecker$extend_var(ctx_with_self_6002, qualified_name, scheme_6000);
      } else {
        _t6004 = ctx_with_self_6002;
      }
      const ctx_with_self_6005 = _t6004;
      function _t6007(c, p, ty) {
        return Typechecker$extend_var_mono(c, p.name, ty);
      }
      const __rec_upd_6008 = ctx_with_self_6005;
      const _t6009 = ({constraint_tvars: __rec_upd_6008.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_6008.current_module, inside_handler: __rec_upd_6008.inside_handler, loop_info: __rec_upd_6008.loop_info, mutable_vars: __rec_upd_6008.mutable_vars, return_type: __rec_upd_6008.return_type, return_used: __rec_upd_6008.return_used, type_env: __rec_upd_6008.type_env, vars: __rec_upd_6008.vars});
      const inner_ctx_6010 = List$fold2(_t6007, _t6009, params, param_tys_5977);
      const body_te_6012 = Typechecker$check(inner_ctx_6010, (level + 1), body, ret_ty);
      let _t6015;
      const _t6014 = [List$rev(params), List$rev(param_tys_5977)];
      _t6016: {
        if (_t6014[0] === null && _t6014[1] === null) {
          _t6015 = body_te_6012;
          break _t6016;
        }
        if (_t6014[0] !== null && _t6014[1] !== null) {
          const last_p = _t6014[0]._hd;
          const rest_ps = _t6014[0]._tl;
          const last_pty = _t6014[1]._hd;
          const rest_ptys = _t6014[1]._tl;
          const inner_6017 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_6012, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_6012.ty]}));
          function _t6019(acc, p, pty) {
            return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
          }
          const _t6018 = List$fold2(_t6019, inner_6017, rest_ps, rest_ptys);
          _t6015 = _t6018;
          break _t6016;
        }
        if (true) {
          _t6015 = failwith("assert false");
          break _t6016;
        }
        _match_fail("line 16190");
      }
      const te_6020 = _t6015;
      const _t6021 = [te_6020, scheme_6000];
      const _t6013 = _t6021;
      const _t6011 = _t6013;
      const _t6006 = _t6011;
      const _t6003 = _t6006;
      const _t6001 = _t6003;
      const _t5999 = _t6001;
      _t5990 = _t5999;
      break _t5991;
    }
    _match_fail("line 16190");
  }
  const _t5978 = _t5990;
  const _t5971 = _t5978;
  return _t5971;
}
function Typechecker$normalize_pattern(pat) {
  while (true) {
    let _t6023;
    const _t6022 = pat;
    _t6024: {
      if (_t6022._tag === 12) {
        const inner = _t6022._val[0];
        const _t6025 = inner;
        pat = _t6025;
        continue;
        _t6023 = undefined;
        break _t6024;
      }
      if (_t6022._tag === 13) {
        const p1 = _t6022._val[0];
        const p2 = _t6022._val[1];
        _t6023 = List$concat(Typechecker$normalize_pattern(p1), Typechecker$normalize_pattern(p2));
        break _t6024;
      }
      if (true) {
        const p = _t6022;
        _t6023 = ({_hd: p, _tl: null});
        break _t6024;
      }
      _match_fail("line 16190");
    }
    return _t6023;
  }
}
function Typechecker$ctor_short_name(name) {
  let _t6027;
  const _t6026 = String$rindex_opt(name, 46);
  _t6028: {
    if (_t6026._tag === 1) {
      const i = _t6026._val;
      _t6027 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
      break _t6028;
    }
    if (_t6026._tag === 0) {
      _t6027 = name;
      break _t6028;
    }
    _match_fail("line 16190");
  }
  return _t6027;
}
function Typechecker$specialize_variant(pats, ctor_name) {
  function _t6029(pat) {
    let _t6031;
    const _t6030 = pat;
    _t6032: {
      if (_t6030._tag === 10) {
        const name = _t6030._val[0];
        const sub = _t6030._val[1];
        if ((Typechecker$ctor_short_name(name) === ctor_name)) {
          let _t6034;
          const _t6033 = sub;
          _t6035: {
            if (_t6033._tag === 1) {
              const p = _t6033._val;
              _t6034 = Typechecker$normalize_pattern(p);
              break _t6035;
            }
            if (_t6033._tag === 0) {
              _t6034 = ({_hd: ({_tag: 0, _name: "PatWild"}), _tl: null});
              break _t6035;
            }
            _match_fail("line 16190");
          }
          _t6031 = _t6034;
          break _t6032;
        }
      }
      if (_t6030._tag === 10) {
        _t6031 = null;
        break _t6032;
      }
      if ((_t6030._tag === 0 || _t6030._tag === 1)) {
        _t6031 = ({_hd: ({_tag: 0, _name: "PatWild"}), _tl: null});
        break _t6032;
      }
      if (_t6030._tag === 12) {
        const inner = _t6030._val[0];
        _t6031 = Typechecker$specialize_variant(Typechecker$normalize_pattern(inner), ctor_name);
        break _t6032;
      }
      if (_t6030._tag === 13) {
        const p1 = _t6030._val[0];
        const p2 = _t6030._val[1];
        _t6031 = List$concat(Typechecker$specialize_variant(Typechecker$normalize_pattern(p1), ctor_name), Typechecker$specialize_variant(Typechecker$normalize_pattern(p2), ctor_name));
        break _t6032;
      }
      if (true) {
        _t6031 = null;
        break _t6032;
      }
      _match_fail("line 16190");
    }
    return _t6031;
  }
  return List$concat_map(_t6029, pats);
}
function Typechecker$has_wildcard(pats) {
  function _t6036(p) {
    let _t6038;
    const _t6037 = p;
    _t6039: {
      if ((_t6037._tag === 0 || _t6037._tag === 1)) {
        _t6038 = true;
        break _t6039;
      }
      if (true) {
        _t6038 = false;
        break _t6039;
      }
      _match_fail("line 16190");
    }
    return _t6038;
  }
  return List$exists(_t6036, pats);
}
function Typechecker$uncovered_patterns(type_env, ty, pats) {
  const pats_6040 = List$concat_map(Typechecker$normalize_pattern, pats);
  let _t6042;
  if (Typechecker$has_wildcard(pats_6040)) {
    _t6042 = null;
  } else {
    let _t6044;
    const _t6043 = Types$repr(ty);
    _t6045: {
      if (_t6043._tag === 12) {
        const name = _t6043._val[0];
        const args = _t6043._val[1];
        let _t6047;
        const _t6046 = Typechecker$find_variant_info(type_env, name);
        _t6048: {
          if (_t6046._tag === 0) {
            _t6047 = null;
            break _t6048;
          }
          if (_t6046._tag === 1) {
            const ctors = _t6046._val[2];
            const is_gadt = _t6046._val[3];
            let _t6049;
            if (is_gadt) {
              function _t6050(__p131) {
                let _t6052;
                const _t6051 = __p131;
                _t6053: {
                  if (true) {
                    const ctor_name = _t6051[0];
                    let _t6055;
                    const _t6054 = List$assoc_opt(ctor_name, type_env.constructors);
                    _t6056: {
                      if (_t6054._tag === 1) {
                        const info = _t6054._val;
                        let _t6058;
                        const _t6057 = info.ctor_return_ty_params;
                        _t6059: {
                          if (_t6057._tag === 0) {
                            _t6058 = true;
                            break _t6059;
                          }
                          if (_t6057._tag === 1) {
                            const ret_params = _t6057._val;
                            let _t6061;
                            if ((List$length(ret_params) === List$length(args))) {
                            function _t6060(p) {
                              return Typechecker$subst_tgens(args, p);
                            }
                              _t6061 = List$forall2(Types$types_compatible, List$map(_t6060, ret_params), args);
                            } else {
                              _t6061 = false;
                            }
                            _t6058 = _t6061;
                            break _t6059;
                          }
                          _match_fail("line 16190");
                        }
                        _t6055 = _t6058;
                        break _t6056;
                      }
                      if (_t6054._tag === 0) {
                        _t6055 = true;
                        break _t6056;
                      }
                      _match_fail("line 16190");
                    }
                    _t6052 = _t6055;
                    break _t6053;
                  }
                  _match_fail("line 16190");
                }
                return _t6052;
              }
              _t6049 = List$filter(_t6050, ctors);
            } else {
              _t6049 = ctors;
            }
            const reachable_ctors_6062 = _t6049;
            function _t6064(__p132) {
              let _t6066;
              const _t6065 = __p132;
              _t6067: {
                if (true) {
                  const ctor_name = _t6065[0];
                  const ctor_arg_ty = _t6065[1];
                  const sub_pats_6068 = Typechecker$specialize_variant(pats_6040, ctor_name);
                  let _t6071;
                  const _t6070 = ctor_arg_ty;
                  _t6072: {
                    if (_t6070._tag === 0) {
                      let _t6073;
                      if ((List$length(sub_pats_6068) === 0)) {
                        _t6073 = ({_hd: ctor_name, _tl: null});
                      } else {
                        _t6073 = null;
                      }
                      _t6071 = _t6073;
                      break _t6072;
                    }
                    if (_t6070._tag === 1) {
                      const arg_ty = _t6070._val;
                      let _t6074;
                      if ((List$length(sub_pats_6068) === 0)) {
                        _t6074 = ({_hd: (ctor_name + " _"), _tl: null});
                      } else {
                        const sub_missing_6075 = Typechecker$uncovered_patterns(type_env, arg_ty, sub_pats_6068);
                        function _t6077(m) {
                          return (ctor_name + (" (" + (m + ")")));
                        }
                        const _t6076 = List$map(_t6077, sub_missing_6075);
                        _t6074 = _t6076;
                      }
                      _t6071 = _t6074;
                      break _t6072;
                    }
                    _match_fail("line 16190");
                  }
                  const _t6069 = _t6071;
                  _t6066 = _t6069;
                  break _t6067;
                }
                _match_fail("line 16190");
              }
              return _t6066;
            }
            const _t6063 = List$concat_map(_t6064, reachable_ctors_6062);
            _t6047 = _t6063;
            break _t6048;
          }
          _match_fail("line 16190");
        }
        _t6044 = _t6047;
        break _t6045;
      }
      if (_t6043._tag === 2) {
        function _t6078(p) {
          let _t6080;
          const _t6079 = p;
          _t6081: {
            if (_t6079._tag === 4 && _t6079._val) {
              _t6080 = true;
              break _t6081;
            }
            if (true) {
              _t6080 = false;
              break _t6081;
            }
            _match_fail("line 16190");
          }
          return _t6080;
        }
        const has_true_6082 = List$exists(_t6078, pats_6040);
        function _t6084(p) {
          let _t6086;
          const _t6085 = p;
          _t6087: {
            if (_t6085._tag === 4 && !_t6085._val) {
              _t6086 = true;
              break _t6087;
            }
            if (true) {
              _t6086 = false;
              break _t6087;
            }
            _match_fail("line 16190");
          }
          return _t6086;
        }
        const has_false_6088 = List$exists(_t6084, pats_6040);
        const missing_6090 = Ref$create(null);
        let _t6092;
        if ((!has_true_6082)) {
          _t6092 = Ref$set(missing_6090, ({_hd: "true", _tl: Ref$get(missing_6090)}));
        } else {
          _t6092 = undefined;
        }
        _t6092;
        let _t6093;
        if ((!has_false_6088)) {
          _t6093 = Ref$set(missing_6090, ({_hd: "false", _tl: Ref$get(missing_6090)}));
        } else {
          _t6093 = undefined;
        }
        _t6093;
        const _t6091 = Ref$get(missing_6090);
        const _t6089 = _t6091;
        const _t6083 = _t6089;
        _t6044 = _t6083;
        break _t6045;
      }
      if (_t6043._tag === 10) {
        function _t6094(p) {
          let _t6096;
          const _t6095 = p;
          _t6097: {
            if (_t6095._tag === 9) {
              _t6096 = true;
              break _t6097;
            }
            if (true) {
              _t6096 = false;
              break _t6097;
            }
            _match_fail("line 16190");
          }
          return _t6096;
        }
        const has_nil_6098 = List$exists(_t6094, pats_6040);
        function _t6100(p) {
          let _t6102;
          const _t6101 = p;
          _t6103: {
            if (_t6101._tag === 8) {
              _t6102 = true;
              break _t6103;
            }
            if (true) {
              _t6102 = false;
              break _t6103;
            }
            _match_fail("line 16190");
          }
          return _t6102;
        }
        const has_cons_6104 = List$exists(_t6100, pats_6040);
        const missing_6106 = Ref$create(null);
        let _t6108;
        if ((!has_nil_6098)) {
          _t6108 = Ref$set(missing_6106, ({_hd: "[]", _tl: Ref$get(missing_6106)}));
        } else {
          _t6108 = undefined;
        }
        _t6108;
        let _t6109;
        if ((!has_cons_6104)) {
          _t6109 = Ref$set(missing_6106, ({_hd: "_ :: _", _tl: Ref$get(missing_6106)}));
        } else {
          _t6109 = undefined;
        }
        _t6109;
        const _t6107 = Ref$get(missing_6106);
        const _t6105 = _t6107;
        const _t6099 = _t6105;
        _t6044 = _t6099;
        break _t6045;
      }
      if (_t6043._tag === 14) {
        function _t6110(p) {
          let _t6112;
          const _t6111 = p;
          _t6113: {
            if (_t6111._tag === 14) {
              const elems = _t6111._val;
              _t6112 = ({_tag: 1, _name: "Some", _val: List$length(elems)});
              break _t6113;
            }
            if (true) {
              _t6112 = ({_tag: 0, _name: "None"});
              break _t6113;
            }
            _match_fail("line 16190");
          }
          return _t6112;
        }
        const lengths_6114 = List$filter_map(_t6110, pats_6040);
        const lengths_set_6116 = List$sort_uniq(compare, lengths_6114);
        function find_missing(n) {
          while (true) {
            let _t6118;
            if (List$mem(n, lengths_set_6116)) {
              const _t6119 = (n + 1);
              n = _t6119;
              continue;
              _t6118 = undefined;
            } else {
              _t6118 = n;
            }
            return _t6118;
          }
        }
        const missing_len_6121 = find_missing(0);
        let _t6123;
        if ((missing_len_6121 === 0)) {
          _t6123 = "#[]";
        } else {
          function _t6124(_) {
            return "_";
          }
          _t6123 = ("#[" + (String$concat("; ", List$init(missing_len_6121, _t6124)) + "]"));
        }
        const missing_pat_6125 = _t6123;
        const _t6126 = ({_hd: missing_pat_6125, _tl: null});
        const _t6122 = _t6126;
        const _t6120 = _t6122;
        const _t6117 = _t6120;
        const _t6115 = _t6117;
        _t6044 = _t6115;
        break _t6045;
      }
      if (_t6043._tag === 13) {
        _t6044 = ({_hd: "_", _tl: null});
        break _t6045;
      }
      if (((_t6043._tag === 0 || _t6043._tag === 1) || _t6043._tag === 3)) {
        _t6044 = ({_hd: "_", _tl: null});
        break _t6045;
      }
      if (_t6043._tag === 6) {
        function _t6127(p) {
          let _t6129;
          const _t6128 = p;
          _t6130: {
            if (_t6128._tag === 6) {
              _t6129 = true;
              break _t6130;
            }
            if (true) {
              _t6129 = false;
              break _t6130;
            }
            _match_fail("line 16190");
          }
          return _t6129;
        }
        const has_unit_6131 = List$exists(_t6127, pats_6040);
        let _t6133;
        if (has_unit_6131) {
          _t6133 = null;
        } else {
          _t6133 = ({_hd: "()", _tl: null});
        }
        const _t6132 = _t6133;
        _t6044 = _t6132;
        break _t6045;
      }
      if (_t6043._tag === 9) {
        const ts = _t6043._val;
        function _t6134(p) {
          let _t6136;
          const _t6135 = p;
          _t6137: {
            if (_t6135._tag === 7) {
              const ps = _t6135._val;
              if ((List$length(ps) === List$length(ts))) {
                _t6136 = ({_tag: 1, _name: "Some", _val: ps});
                break _t6137;
              }
            }
            if (true) {
              _t6136 = ({_tag: 0, _name: "None"});
              break _t6137;
            }
            _match_fail("line 16190");
          }
          return _t6136;
        }
        const tuple_pats_6138 = List$filter_map(_t6134, pats_6040);
        let _t6140;
        if (_eq(tuple_pats_6138, null)) {
          function _t6141(_) {
            return "_";
          }
          _t6140 = ({_hd: ("(" + (String$concat(", ", List$init(List$length(ts), _t6141)) + ")")), _tl: null});
        } else {
          function check_positions(i, __x) {
            while (true) {
              let _t6143;
              const _t6142 = __x;
              _t6144: {
                if (_t6142 === null) {
                  _t6143 = null;
                  break _t6144;
                }
                if (_t6142 !== null) {
                  const elem_ty = _t6142._hd;
                  const rest_tys = _t6142._tl;
                  function _t6145(ps) {
                    return List$nth(ps, i);
                  }
                  const position_pats_6146 = List$map(_t6145, tuple_pats_6138);
                  const sub_missing_6148 = Typechecker$uncovered_patterns(type_env, elem_ty, position_pats_6146);
                  let _t6150;
                  if (!_eq(sub_missing_6148, null)) {
                    function _t6151(j) {
                      let _t6152;
                      if ((j === i)) {
                        _t6152 = List$hd(sub_missing_6148);
                      } else {
                        _t6152 = "_";
                      }
                      return _t6152;
                    }
                    const template_6153 = List$init(List$length(ts), _t6151);
                    const _t6154 = ({_hd: ("(" + (String$concat(", ", template_6153) + ")")), _tl: null});
                    _t6150 = _t6154;
                  } else {
                    const _t6155 = (i + 1);
                    const _t6156 = rest_tys;
                    i = _t6155;
                    __x = _t6156;
                    continue;
                    _t6150 = undefined;
                  }
                  const _t6149 = _t6150;
                  const _t6147 = _t6149;
                  _t6143 = _t6147;
                  break _t6144;
                }
                _match_fail("line 16190");
              }
              return _t6143;
            }
          }
          const _t6157 = check_positions(0, ts);
          _t6140 = _t6157;
        }
        const _t6139 = _t6140;
        _t6044 = _t6139;
        break _t6045;
      }
      if (true) {
        _t6044 = null;
        break _t6045;
      }
      _match_fail("line 16190");
    }
    _t6042 = _t6044;
  }
  const _t6041 = _t6042;
  return _t6041;
}
function Typechecker$exhaustiveness_check(ctx, ty, arms) {
  function _t6158(__p133) {
    let _t6160;
    const _t6159 = __p133;
    _t6161: {
      if (true) {
        const pat = _t6159[0];
        const guard = _t6159[1];
        const _body = _t6159[2];
        let _t6163;
        const _t6162 = guard;
        _t6164: {
          if (_t6162._tag === 0) {
            _t6163 = ({_tag: 1, _name: "Some", _val: pat});
            break _t6164;
          }
          if (_t6162._tag === 1) {
            _t6163 = ({_tag: 0, _name: "None"});
            break _t6164;
          }
          _match_fail("line 16190");
        }
        _t6160 = _t6163;
        break _t6161;
      }
      _match_fail("line 16190");
    }
    return _t6160;
  }
  const unguarded_pats_6165 = List$filter_map(_t6158, arms);
  const missing_6167 = Typechecker$uncovered_patterns(ctx.type_env, ty, unguarded_pats_6165);
  let _t6169;
  if (!_eq(missing_6167, null)) {
    _t6169 = Typechecker$error(("non-exhaustive match, missing: " + __dict_Show_string.show(String$concat(", ", missing_6167))));
  } else {
    _t6169 = undefined;
  }
  const _t6168 = _t6169;
  const _t6166 = _t6168;
  return _t6166;
}
const Typechecker$__destruct = Ref$set(Typechecker$exhaustiveness_check_ref, Typechecker$exhaustiveness_check);
function Typechecker$process_type_def(ctx, type_params, type_name, def) {
  const num_params_6170 = List$length(type_params);
  let _t6173;
  const _t6172 = def;
  _t6174: {
    if (_t6172._tag === 0) {
      const ctors = _t6172._val;
      const __rec_upd_6175 = ctx;
      const __rec_upd_6177 = ctx.type_env;
      const _t6178 = ({classes: __rec_upd_6177.classes, constructors: __rec_upd_6177.constructors, effects: __rec_upd_6177.effects, instances: __rec_upd_6177.instances, modules: __rec_upd_6177.modules, mutable_fields: __rec_upd_6177.mutable_fields, records: __rec_upd_6177.records, type_aliases: __rec_upd_6177.type_aliases, type_synonyms: __rec_upd_6177.type_synonyms, variants: ({_hd: [type_name, num_params_6170, null, false], _tl: ctx.type_env.variants})});
      const _t6176 = ({constraint_tvars: __rec_upd_6175.constraint_tvars, current_eff: __rec_upd_6175.current_eff, current_module: __rec_upd_6175.current_module, inside_handler: __rec_upd_6175.inside_handler, loop_info: __rec_upd_6175.loop_info, mutable_vars: __rec_upd_6175.mutable_vars, return_type: __rec_upd_6175.return_type, return_used: __rec_upd_6175.return_used, type_env: _t6178, vars: __rec_upd_6175.vars});
      const pre_ctx_6179 = _t6176;
      const param_tbl_6181 = Hashtbl$create(4);
      function _t6183(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6181, name, i]);
      }
      List$iteri(_t6183, type_params);
      function _t6184(annot) {
        const tvars_6185 = Hashtbl$create(4);
        function go(__x) {
          while (true) {
            let _t6188;
            const _t6187 = __x;
            _t6189: {
              if (_t6187._tag === 1) {
                const name = _t6187._val;
                let _t6191;
                const _t6190 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6181, name]);
                _t6192: {
                  if (_t6190._tag === 1) {
                    const idx = _t6190._val;
                    _t6191 = ({_tag: 17, _name: "TGen", _val: idx});
                    break _t6192;
                  }
                  if (_t6190._tag === 0) {
                    let _t6194;
                    const _t6193 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6185, name]);
                    _t6195: {
                      if (_t6193._tag === 1) {
                        const tv = _t6193._val;
                        _t6194 = tv;
                        break _t6195;
                      }
                      if (_t6193._tag === 0) {
                        const tv_6196 = Types$new_tvar(0);
                        _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6185, name, tv_6196]);
                        const _t6197 = tv_6196;
                        _t6194 = _t6197;
                        break _t6195;
                      }
                      _match_fail("line 16190");
                    }
                    _t6191 = _t6194;
                    break _t6192;
                  }
                  _match_fail("line 16190");
                }
                _t6188 = _t6191;
                break _t6189;
              }
              if (_t6187._tag === 0 && _t6187._val === "int") {
                _t6188 = ({_tag: 0, _name: "TInt"});
                break _t6189;
              }
              if (_t6187._tag === 0 && _t6187._val === "float") {
                _t6188 = ({_tag: 1, _name: "TFloat"});
                break _t6189;
              }
              if (_t6187._tag === 0 && _t6187._val === "bool") {
                _t6188 = ({_tag: 2, _name: "TBool"});
                break _t6189;
              }
              if (_t6187._tag === 0 && _t6187._val === "string") {
                _t6188 = ({_tag: 3, _name: "TString"});
                break _t6189;
              }
              if (_t6187._tag === 0 && _t6187._val === "unit") {
                _t6188 = ({_tag: 6, _name: "TUnit"});
                break _t6189;
              }
              if (_t6187._tag === 0) {
                const name = _t6187._val;
                const canonical_6198 = Typechecker$resolve_type_alias(pre_ctx_6179.type_env, name);
                function _t6200(__p134) {
                  let _t6202;
                  const _t6201 = __p134;
                  _t6203: {
                    if (true) {
                      const n = _t6201[0];
                      _t6202 = (n === canonical_6198);
                      break _t6203;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6202;
                }
                let _t6205;
                const _t6204 = List$find(_t6200, pre_ctx_6179.type_env.type_synonyms);
                _t6206: {
                  if (_t6204._tag === 1 && _t6204._val[1] === 0) {
                    const ty = _t6204._val[2];
                    _t6205 = ty;
                    break _t6206;
                  }
                  if (_t6204._tag === 1) {
                    const n = _t6204._val[1];
                    _t6205 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                    break _t6206;
                  }
                  if (_t6204._tag === 0) {
                    let _t6208;
                    const _t6207 = Typechecker$find_variant_info(pre_ctx_6179.type_env, name);
                    _t6209: {
                      if (_t6207._tag === 1 && _t6207._val[1] === 0) {
                        _t6208 = ({_tag: 12, _name: "TVariant", _val: [canonical_6198, null]});
                        break _t6209;
                      }
                      if (_t6207._tag === 1) {
                        const n = _t6207._val[1];
                        _t6208 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                        break _t6209;
                      }
                      if (_t6207._tag === 0) {
                        let _t6210;
                        if (!_eq(List$assoc_opt(canonical_6198, pre_ctx_6179.type_env.records), ({_tag: 0, _name: "None"}))) {
                          const fields_6211 = List$assoc(canonical_6198, pre_ctx_6179.type_env.records);
                          const _t6212 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6211)});
                          _t6210 = _t6212;
                        } else {
                          _t6210 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                        }
                        _t6208 = _t6210;
                        break _t6209;
                      }
                      _match_fail("line 16190");
                    }
                    _t6205 = _t6208;
                    break _t6206;
                  }
                  _match_fail("line 16190");
                }
                const _t6199 = _t6205;
                _t6188 = _t6199;
                break _t6189;
              }
              if (_t6187._tag === 2) {
                const a = _t6187._val[0];
                const b = _t6187._val[1];
                _t6188 = ({_tag: 7, _name: "TArrow", _val: [go(a), ({_tag: 1, _name: "EffEmpty"}), go(b)]});
                break _t6189;
              }
              if (_t6187._tag === 6) {
                const ts = _t6187._val;
                _t6188 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
                break _t6189;
              }
              if (_t6187._tag === 4) {
                const t = _t6187._val;
                _t6188 = ({_tag: 10, _name: "TList", _val: go(t)});
                break _t6189;
              }
              if (_t6187._tag === 5) {
                const t = _t6187._val;
                _t6188 = ({_tag: 14, _name: "TArray", _val: go(t)});
                break _t6189;
              }
              if (_t6187._tag === 8) {
                const k = _t6187._val[0];
                const v = _t6187._val[1];
                _t6188 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
                break _t6189;
              }
              if (_t6187._tag === 7) {
                const args = _t6187._val[0];
                const tname = _t6187._val[1];
                const canonical_6213 = Typechecker$resolve_type_alias(pre_ctx_6179.type_env, tname);
                const arg_tys_6215 = List$map(go, args);
                function _t6217(__p135) {
                  let _t6219;
                  const _t6218 = __p135;
                  _t6220: {
                    if (true) {
                      const n = _t6218[0];
                      _t6219 = (n === canonical_6213);
                      break _t6220;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6219;
                }
                let _t6222;
                const _t6221 = List$find(_t6217, pre_ctx_6179.type_env.type_synonyms);
                _t6223: {
                  if (_t6221._tag === 1) {
                    const np = _t6221._val[1];
                    const ty = _t6221._val[2];
                    let _t6224;
                    if ((List$length(arg_tys_6215) !== np)) {
                      _t6224 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6215))));
                    } else {
                      _t6224 = undefined;
                    }
                    _t6224;
                    _t6222 = Typechecker$subst_tgens(arg_tys_6215, ty);
                    break _t6223;
                  }
                  if (_t6221._tag === 0) {
                    let _t6226;
                    const _t6225 = Typechecker$find_variant_info(pre_ctx_6179.type_env, tname);
                    _t6227: {
                      if (_t6225._tag === 1) {
                        const np = _t6225._val[1];
                        let _t6228;
                        if ((List$length(arg_tys_6215) !== np)) {
                          _t6228 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6215))));
                        } else {
                          _t6228 = undefined;
                        }
                        _t6228;
                        _t6226 = ({_tag: 12, _name: "TVariant", _val: [canonical_6213, arg_tys_6215]});
                        break _t6227;
                      }
                      if (_t6225._tag === 0) {
                        _t6226 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                        break _t6227;
                      }
                      _match_fail("line 16190");
                    }
                    _t6222 = _t6226;
                    break _t6223;
                  }
                  _match_fail("line 16190");
                }
                const _t6216 = _t6222;
                const _t6214 = _t6216;
                _t6188 = _t6214;
                break _t6189;
              }
              if (_t6187._tag === 3) {
                const fields = _t6187._val[0];
                const is_open = _t6187._val[1];
                function _t6229(__p136) {
                  let _t6231;
                  const _t6230 = __p136;
                  _t6232: {
                    if (true) {
                      const n = _t6230[0];
                      const t = _t6230[1];
                      _t6231 = [n, go(t)];
                      break _t6232;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6231;
                }
                const fields_6233 = List$map(_t6229, fields);
                function _t6235(__p137, __p138) {
                  let _t6237;
                  const _t6236 = __p137;
                  _t6238: {
                    if (true) {
                      const a = _t6236[0];
                      let _t6240;
                      const _t6239 = __p138;
                      _t6241: {
                        if (true) {
                          const b = _t6239[0];
                          _t6240 = String$compare(a, b);
                          break _t6241;
                        }
                        _match_fail("line 16190");
                      }
                      _t6237 = _t6240;
                      break _t6238;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6237;
                }
                const fields_6242 = List$sort(_t6235, fields_6233);
                let _t6244;
                if (is_open) {
                  _t6244 = Types$new_rvar(0);
                } else {
                  _t6244 = ({_tag: 2, _name: "REmpty"});
                }
                const tail_6245 = _t6244;
                function _t6247(__p139, acc) {
                  let _t6249;
                  const _t6248 = __p139;
                  _t6250: {
                    if (true) {
                      const n = _t6248[0];
                      const t = _t6248[1];
                      _t6249 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                      break _t6250;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6249;
                }
                const _t6246 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6247, fields_6242, tail_6245)});
                const _t6243 = _t6246;
                const _t6234 = _t6243;
                _t6188 = _t6234;
                break _t6189;
              }
              if (_t6187._tag === 9) {
                const path = _t6187._val[0];
                const name = _t6187._val[1];
                const qualified_6251 = (String$concat(".", path) + ("." + name));
                const _t6253 = ({_tag: 0, _name: "TyName", _val: qualified_6251});
                __x = _t6253;
                continue;
                const _t6252 = undefined;
                _t6188 = _t6252;
                break _t6189;
              }
              if (_t6187._tag === 10) {
                const _kind = _t6187._val[0];
                const tags = _t6187._val[1];
                function _t6254(__p140, acc) {
                  let _t6256;
                  const _t6255 = __p140;
                  _t6257: {
                    if (true) {
                      const tag = _t6255[0];
                      const payload_annot = _t6255[1];
                      _t6256 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload_annot), acc]});
                      break _t6257;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6256;
                }
                const row_6258 = List$fold_right(_t6254, tags, ({_tag: 2, _name: "PVEmpty"}));
                const _t6259 = ({_tag: 15, _name: "TPolyVariant", _val: row_6258});
                _t6188 = _t6259;
                break _t6189;
              }
              if (_t6187._tag === 11) {
                const ty = _t6187._val[0];
                const _t6260 = ty;
                __x = _t6260;
                continue;
                _t6188 = undefined;
                break _t6189;
              }
              _match_fail("line 16190");
            }
            return _t6188;
          }
        }
        const _t6261 = go(annot);
        const _t6186 = _t6261;
        return _t6186;
      }
      const resolve_with_params_6262 = _t6184;
      function _t6264(__p141) {
        let _t6266;
        const _t6265 = __p141;
        _t6267: {
          if (true) {
            const ret = _t6265[2];
            _t6266 = !_eq(ret, ({_tag: 0, _name: "None"}));
            break _t6267;
          }
          _match_fail("line 16190");
        }
        return _t6266;
      }
      const is_gadt_6268 = List$exists(_t6264, ctors);
      function collect_annot_vars(acc, __x) {
        while (true) {
          let _t6271;
          const _t6270 = __x;
          _t6272: {
            if (_t6270._tag === 1) {
              const name = _t6270._val;
              let _t6273;
              if (List$mem(name, acc)) {
                _t6273 = acc;
              } else {
                _t6273 = ({_hd: name, _tl: acc});
              }
              _t6271 = _t6273;
              break _t6272;
            }
            if (_t6270._tag === 2) {
              const a = _t6270._val[0];
              const b = _t6270._val[1];
              const _t6274 = collect_annot_vars(acc, a);
              const _t6275 = b;
              acc = _t6274;
              __x = _t6275;
              continue;
              _t6271 = undefined;
              break _t6272;
            }
            if (_t6270._tag === 6) {
              const ts = _t6270._val;
              _t6271 = List$fold(collect_annot_vars, acc, ts);
              break _t6272;
            }
            if ((_t6270._tag === 4 || _t6270._tag === 5)) {
              const t = _t6270._val;
              const _t6276 = acc;
              const _t6277 = t;
              acc = _t6276;
              __x = _t6277;
              continue;
              _t6271 = undefined;
              break _t6272;
            }
            if (_t6270._tag === 8) {
              const k = _t6270._val[0];
              const v = _t6270._val[1];
              const _t6278 = collect_annot_vars(acc, k);
              const _t6279 = v;
              acc = _t6278;
              __x = _t6279;
              continue;
              _t6271 = undefined;
              break _t6272;
            }
            if (_t6270._tag === 7) {
              const args = _t6270._val[0];
              _t6271 = List$fold(collect_annot_vars, acc, args);
              break _t6272;
            }
            if (_t6270._tag === 3) {
              const fs = _t6270._val[0];
              function _t6280(a, __p142) {
                let _t6282;
                const _t6281 = __p142;
                _t6283: {
                  if (true) {
                    const t = _t6281[1];
                    _t6282 = collect_annot_vars(a, t);
                    break _t6283;
                  }
                  _match_fail("line 16190");
                }
                return _t6282;
              }
              _t6271 = List$fold(_t6280, acc, fs);
              break _t6272;
            }
            if ((_t6270._tag === 9 || _t6270._tag === 0)) {
              _t6271 = acc;
              break _t6272;
            }
            if (_t6270._tag === 10) {
              const tags = _t6270._val[1];
              function _t6284(a, __p143) {
                let _t6286;
                const _t6285 = __p143;
                _t6287: {
                  if (true) {
                    const ty_opt = _t6285[1];
                    let _t6289;
                    const _t6288 = ty_opt;
                    _t6290: {
                      if (_t6288._tag === 1) {
                        const t = _t6288._val;
                        _t6289 = collect_annot_vars(a, t);
                        break _t6290;
                      }
                      if (_t6288._tag === 0) {
                        _t6289 = a;
                        break _t6290;
                      }
                      _match_fail("line 16190");
                    }
                    _t6286 = _t6289;
                    break _t6287;
                  }
                  _match_fail("line 16190");
                }
                return _t6286;
              }
              _t6271 = List$fold(_t6284, acc, tags);
              break _t6272;
            }
            if (_t6270._tag === 11) {
              const ty = _t6270._val[0];
              const _t6291 = acc;
              const _t6292 = ty;
              acc = _t6291;
              __x = _t6292;
              continue;
              _t6271 = undefined;
              break _t6272;
            }
            _match_fail("line 16190");
          }
          return _t6271;
        }
      }
      function _t6294(__dict_Show_0, __p144) {
        let _t6296;
        const _t6295 = __p144;
        _t6297: {
          if (true) {
            const name = _t6295[0];
            const arg_annot = _t6295[1];
            const ret_annot = _t6295[2];
            let _t6299;
            const _t6298 = ret_annot;
            _t6300: {
              if (_t6298._tag === 0) {
                const arg_ty_6301 = Option$map(resolve_with_params_6262, arg_annot);
                const info_6303 = ({ctor_arg_ty: arg_ty_6301, ctor_existentials: 0, ctor_num_params: num_params_6170, ctor_return_ty_params: ({_tag: 0, _name: "None"}), ctor_type_name: type_name});
                const _t6304 = [[name, arg_ty_6301], [name, info_6303]];
                const _t6302 = _t6304;
                _t6299 = _t6302;
                break _t6300;
              }
              if (_t6298._tag === 1) {
                const ret = _t6298._val;
                let _t6306;
                const _t6305 = ret;
                _t6307: {
                  if (_t6305._tag === 0) {
                    const n = _t6305._val;
                    _t6306 = [n, null];
                    break _t6307;
                  }
                  if (_t6305._tag === 7) {
                    const args = _t6305._val[0];
                    const n = _t6305._val[1];
                    _t6306 = [n, args];
                    break _t6307;
                  }
                  if (true) {
                    _t6306 = Typechecker$error(((("GADT constructor " + __dict_Show_0.show(name)) + ": return type must be ") + __dict_Show_string.show(type_name)));
                    break _t6307;
                  }
                  _match_fail("line 16190");
                }
                let _t6309;
                const _t6308 = _t6306;
                _t6310: {
                  if (true) {
                    const ret_type_name = _t6308[0];
                    const ret_type_args = _t6308[1];
                    const canonical_ret_6311 = Typechecker$resolve_type_alias(pre_ctx_6179.type_env, ret_type_name);
                    let _t6318;
                    if ((canonical_ret_6311 === type_name)) {
                      _t6318 = true;
                    } else {
                    let _t6314;
                    const _t6313 = String$rindex_opt(type_name, 46);
                    _t6315: {
                      if (_t6313._tag === 1) {
                        const i = _t6313._val;
                        const _mml$short_6316 = String$sub(type_name, (i + 1), ((String$length(type_name) - i) - 1));
                        const _t6317 = (ret_type_name === _mml$short_6316);
                        _t6314 = _t6317;
                        break _t6315;
                      }
                      if (_t6313._tag === 0) {
                        _t6314 = false;
                        break _t6315;
                      }
                      _match_fail("line 16190");
                    }
                      _t6318 = _t6314;
                    }
                    const name_matches_6319 = _t6318;
                    let _t6321;
                    if ((!name_matches_6319)) {
                      _t6321 = Typechecker$error(((((("GADT constructor " + __dict_Show_0.show(name)) + ": return type must be ") + __dict_Show_string.show(type_name)) + ", got ") + __dict_Show_string.show(ret_type_name)));
                    } else {
                      _t6321 = undefined;
                    }
                    _t6321;
                    let _t6322;
                    if ((List$length(ret_type_args) !== num_params_6170)) {
                      _t6322 = Typechecker$error(((((("GADT constructor " + __dict_Show_0.show(name)) + ": return type has ") + __dict_Show_int.show(List$length(ret_type_args))) + " type arg(s), expected ") + __dict_Show_int.show(num_params_6170)));
                    } else {
                      _t6322 = undefined;
                    }
                    _t6322;
                    const ret_vars_6323 = List$fold(collect_annot_vars, null, ret_type_args);
                    let _t6326;
                    const _t6325 = arg_annot;
                    _t6327: {
                      if (_t6325._tag === 0) {
                        _t6326 = null;
                        break _t6327;
                      }
                      if (_t6325._tag === 1) {
                        const a = _t6325._val;
                        _t6326 = collect_annot_vars(null, a);
                        break _t6327;
                      }
                      _match_fail("line 16190");
                    }
                    const arg_vars_6328 = _t6326;
                    function _t6330(v) {
                      return ((!List$mem(v, ret_vars_6323)) && (!List$mem(v, type_params)));
                    }
                    const existentials_6331 = List$filter(_t6330, arg_vars_6328);
                    const num_exist_6333 = List$length(existentials_6331);
                    const gadt_tbl_6335 = Hashtbl$create(8);
                    function _t6337(i, p) {
                      return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, gadt_tbl_6335, p, i]);
                    }
                    List$iteri(_t6337, type_params);
                    function _t6338(i, e) {
                      return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, gadt_tbl_6335, e, (num_params_6170 + i)]);
                    }
                    List$iteri(_t6338, existentials_6331);
                    const gadt_tvars_6339 = Hashtbl$create(4);
                    function gadt_resolve(__x) {
                      while (true) {
                        let _t6342;
                        const _t6341 = __x;
                        _t6343: {
                          if (_t6341._tag === 1) {
                            const vname = _t6341._val;
                            let _t6345;
                            const _t6344 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, gadt_tbl_6335, vname]);
                            _t6346: {
                              if (_t6344._tag === 1) {
                                const idx = _t6344._val;
                                _t6345 = ({_tag: 17, _name: "TGen", _val: idx});
                                break _t6346;
                              }
                              if (_t6344._tag === 0) {
                                let _t6348;
                                const _t6347 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, gadt_tvars_6339, vname]);
                                _t6349: {
                                  if (_t6347._tag === 1) {
                                    const tv = _t6347._val;
                                    _t6348 = tv;
                                    break _t6349;
                                  }
                                  if (_t6347._tag === 0) {
                                    const tv_6350 = Types$new_tvar(0);
                                    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, gadt_tvars_6339, vname, tv_6350]);
                                    const _t6351 = tv_6350;
                                    _t6348 = _t6351;
                                    break _t6349;
                                  }
                                  _match_fail("line 16190");
                                }
                                _t6345 = _t6348;
                                break _t6346;
                              }
                              _match_fail("line 16190");
                            }
                            _t6342 = _t6345;
                            break _t6343;
                          }
                          if (_t6341._tag === 0 && _t6341._val === "int") {
                            _t6342 = ({_tag: 0, _name: "TInt"});
                            break _t6343;
                          }
                          if (_t6341._tag === 0 && _t6341._val === "float") {
                            _t6342 = ({_tag: 1, _name: "TFloat"});
                            break _t6343;
                          }
                          if (_t6341._tag === 0 && _t6341._val === "bool") {
                            _t6342 = ({_tag: 2, _name: "TBool"});
                            break _t6343;
                          }
                          if (_t6341._tag === 0 && _t6341._val === "string") {
                            _t6342 = ({_tag: 3, _name: "TString"});
                            break _t6343;
                          }
                          if (_t6341._tag === 0 && _t6341._val === "unit") {
                            _t6342 = ({_tag: 6, _name: "TUnit"});
                            break _t6343;
                          }
                          if (_t6341._tag === 0) {
                            const n = _t6341._val;
                            const canonical_6352 = Typechecker$resolve_type_alias(pre_ctx_6179.type_env, n);
                            function _t6354(__p145) {
                              let _t6356;
                              const _t6355 = __p145;
                              _t6357: {
                                if (true) {
                                  const tn = _t6355[0];
                                  _t6356 = (tn === canonical_6352);
                                  break _t6357;
                                }
                                _match_fail("line 16190");
                              }
                              return _t6356;
                            }
                            let _t6359;
                            const _t6358 = List$find(_t6354, pre_ctx_6179.type_env.type_synonyms);
                            _t6360: {
                              if (_t6358._tag === 1 && _t6358._val[1] === 0) {
                                const ty = _t6358._val[2];
                                _t6359 = ty;
                                break _t6360;
                              }
                              if (_t6358._tag === 1) {
                                const np = _t6358._val[1];
                                _t6359 = Typechecker$error((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s)"));
                                break _t6360;
                              }
                              if (_t6358._tag === 0) {
                                let _t6362;
                                const _t6361 = Typechecker$find_variant_info(pre_ctx_6179.type_env, n);
                                _t6363: {
                                  if (_t6361._tag === 1 && _t6361._val[1] === 0) {
                                    _t6362 = ({_tag: 12, _name: "TVariant", _val: [canonical_6352, null]});
                                    break _t6363;
                                  }
                                  if (_t6361._tag === 1) {
                                    const np = _t6361._val[1];
                                    _t6362 = Typechecker$error((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s)"));
                                    break _t6363;
                                  }
                                  if (_t6361._tag === 0) {
                                    let _t6364;
                                    if (!_eq(List$assoc_opt(canonical_6352, pre_ctx_6179.type_env.records), ({_tag: 0, _name: "None"}))) {
                                      const fields_6365 = List$assoc(canonical_6352, pre_ctx_6179.type_env.records);
                                      let _t6367;
                                      if (_eq(fields_6365, null)) {
                                        _t6367 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                                      } else {
                                        _t6367 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6365)});
                                      }
                                      const _t6366 = _t6367;
                                      _t6364 = _t6366;
                                    } else {
                                      _t6364 = Typechecker$error(("unknown type: " + __dict_Show_string.show(n)));
                                    }
                                    _t6362 = _t6364;
                                    break _t6363;
                                  }
                                  _match_fail("line 16190");
                                }
                                _t6359 = _t6362;
                                break _t6360;
                              }
                              _match_fail("line 16190");
                            }
                            const _t6353 = _t6359;
                            _t6342 = _t6353;
                            break _t6343;
                          }
                          if (_t6341._tag === 2) {
                            const a = _t6341._val[0];
                            const b = _t6341._val[1];
                            _t6342 = ({_tag: 7, _name: "TArrow", _val: [gadt_resolve(a), ({_tag: 1, _name: "EffEmpty"}), gadt_resolve(b)]});
                            break _t6343;
                          }
                          if (_t6341._tag === 6) {
                            const ts = _t6341._val;
                            _t6342 = ({_tag: 9, _name: "TTuple", _val: List$map(gadt_resolve, ts)});
                            break _t6343;
                          }
                          if (_t6341._tag === 4) {
                            const t = _t6341._val;
                            _t6342 = ({_tag: 10, _name: "TList", _val: gadt_resolve(t)});
                            break _t6343;
                          }
                          if (_t6341._tag === 5) {
                            const t = _t6341._val;
                            _t6342 = ({_tag: 14, _name: "TArray", _val: gadt_resolve(t)});
                            break _t6343;
                          }
                          if (_t6341._tag === 8) {
                            const k = _t6341._val[0];
                            const v = _t6341._val[1];
                            _t6342 = ({_tag: 13, _name: "TMap", _val: [gadt_resolve(k), gadt_resolve(v)]});
                            break _t6343;
                          }
                          if (_t6341._tag === 7) {
                            const args = _t6341._val[0];
                            const tname = _t6341._val[1];
                            const canonical_6368 = Typechecker$resolve_type_alias(pre_ctx_6179.type_env, tname);
                            const arg_tys_6370 = List$map(gadt_resolve, args);
                            function _t6372(__p146) {
                              let _t6374;
                              const _t6373 = __p146;
                              _t6375: {
                                if (true) {
                                  const tn = _t6373[0];
                                  _t6374 = (tn === canonical_6368);
                                  break _t6375;
                                }
                                _match_fail("line 16190");
                              }
                              return _t6374;
                            }
                            let _t6377;
                            const _t6376 = List$find(_t6372, pre_ctx_6179.type_env.type_synonyms);
                            _t6378: {
                              if (_t6376._tag === 1) {
                                const np = _t6376._val[1];
                                const ty = _t6376._val[2];
                                let _t6379;
                                if ((List$length(arg_tys_6370) !== np)) {
                                  _t6379 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6370))));
                                } else {
                                  _t6379 = undefined;
                                }
                                _t6379;
                                _t6377 = Typechecker$subst_tgens(arg_tys_6370, ty);
                                break _t6378;
                              }
                              if (_t6376._tag === 0) {
                                let _t6381;
                                const _t6380 = Typechecker$find_variant_info(pre_ctx_6179.type_env, tname);
                                _t6382: {
                                  if (_t6380._tag === 1) {
                                    const np = _t6380._val[1];
                                    let _t6383;
                                    if ((List$length(arg_tys_6370) !== np)) {
                                      _t6383 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6370))));
                                    } else {
                                      _t6383 = undefined;
                                    }
                                    _t6383;
                                    _t6381 = ({_tag: 12, _name: "TVariant", _val: [canonical_6368, arg_tys_6370]});
                                    break _t6382;
                                  }
                                  if (_t6380._tag === 0) {
                                    _t6381 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                                    break _t6382;
                                  }
                                  _match_fail("line 16190");
                                }
                                _t6377 = _t6381;
                                break _t6378;
                              }
                              _match_fail("line 16190");
                            }
                            const _t6371 = _t6377;
                            const _t6369 = _t6371;
                            _t6342 = _t6369;
                            break _t6343;
                          }
                          if (_t6341._tag === 3) {
                            const fields = _t6341._val[0];
                            const is_open = _t6341._val[1];
                            function _t6384(__p147, __p148) {
                              let _t6386;
                              const _t6385 = __p147;
                              _t6387: {
                                if (true) {
                                  const a = _t6385[0];
                                  let _t6389;
                                  const _t6388 = __p148;
                                  _t6390: {
                                    if (true) {
                                      const b = _t6388[0];
                                      _t6389 = String$compare(a, b);
                                      break _t6390;
                                    }
                                    _match_fail("line 16190");
                                  }
                                  _t6386 = _t6389;
                                  break _t6387;
                                }
                                _match_fail("line 16190");
                              }
                              return _t6386;
                            }
                            function _t6391(__p149) {
                              let _t6393;
                              const _t6392 = __p149;
                              _t6394: {
                                if (true) {
                                  const fn_ = _t6392[0];
                                  const ft = _t6392[1];
                                  _t6393 = [fn_, gadt_resolve(ft)];
                                  break _t6394;
                                }
                                _match_fail("line 16190");
                              }
                              return _t6393;
                            }
                            const fields_6395 = List$sort(_t6384, List$map(_t6391, fields));
                            let _t6397;
                            if (is_open) {
                              _t6397 = Types$new_rvar(0);
                            } else {
                              _t6397 = ({_tag: 2, _name: "REmpty"});
                            }
                            const tail_6398 = _t6397;
                            function _t6400(__p150, acc) {
                              let _t6402;
                              const _t6401 = __p150;
                              _t6403: {
                                if (true) {
                                  const n = _t6401[0];
                                  const t = _t6401[1];
                                  _t6402 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                                  break _t6403;
                                }
                                _match_fail("line 16190");
                              }
                              return _t6402;
                            }
                            const _t6399 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6400, fields_6395, tail_6398)});
                            const _t6396 = _t6399;
                            _t6342 = _t6396;
                            break _t6343;
                          }
                          if (_t6341._tag === 9) {
                            const path = _t6341._val[0];
                            const n = _t6341._val[1];
                            const qualified_6404 = (String$concat(".", path) + ("." + n));
                            const _t6406 = ({_tag: 0, _name: "TyName", _val: qualified_6404});
                            __x = _t6406;
                            continue;
                            const _t6405 = undefined;
                            _t6342 = _t6405;
                            break _t6343;
                          }
                          if (_t6341._tag === 10) {
                            const _kind = _t6341._val[0];
                            const tags = _t6341._val[1];
                            function _t6407(__p151, acc) {
                              let _t6409;
                              const _t6408 = __p151;
                              _t6410: {
                                if (true) {
                                  const tag = _t6408[0];
                                  const payload_annot = _t6408[1];
                                  _t6409 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(gadt_resolve, payload_annot), acc]});
                                  break _t6410;
                                }
                                _match_fail("line 16190");
                              }
                              return _t6409;
                            }
                            const row_6411 = List$fold_right(_t6407, tags, ({_tag: 2, _name: "PVEmpty"}));
                            const _t6412 = ({_tag: 15, _name: "TPolyVariant", _val: row_6411});
                            _t6342 = _t6412;
                            break _t6343;
                          }
                          if (_t6341._tag === 11) {
                            const ty = _t6341._val[0];
                            const _t6413 = ty;
                            __x = _t6413;
                            continue;
                            _t6342 = undefined;
                            break _t6343;
                          }
                          _match_fail("line 16190");
                        }
                        return _t6342;
                      }
                    }
                    const arg_ty_6415 = Option$map(gadt_resolve, arg_annot);
                    const ret_params_6417 = List$map(gadt_resolve, ret_type_args);
                    const info_6419 = ({ctor_arg_ty: arg_ty_6415, ctor_existentials: num_exist_6333, ctor_num_params: num_params_6170, ctor_return_ty_params: ({_tag: 1, _name: "Some", _val: ret_params_6417}), ctor_type_name: type_name});
                    const _t6420 = [[name, arg_ty_6415], [name, info_6419]];
                    const _t6418 = _t6420;
                    const _t6416 = _t6418;
                    const _t6414 = _t6416;
                    const _t6340 = _t6414;
                    const _t6336 = _t6340;
                    const _t6334 = _t6336;
                    const _t6332 = _t6334;
                    const _t6329 = _t6332;
                    const _t6324 = _t6329;
                    const _t6320 = _t6324;
                    const _t6312 = _t6320;
                    _t6309 = _t6312;
                    break _t6310;
                  }
                  _match_fail("line 16190");
                }
                _t6299 = _t6309;
                break _t6300;
              }
              _match_fail("line 16190");
            }
            _t6296 = _t6299;
            break _t6297;
          }
          _match_fail("line 16190");
        }
        return _t6296;
      }
      const process_ctor_6421 = _t6294;
      const results_6423 = List$map(_call(process_ctor_6421, [__dict_Show_string]), ctors);
      const variant_def_6425 = List$map(fst, results_6423);
      const ctor_infos_6427 = List$map(snd, results_6423);
      const __rec_upd_6429 = ctx.type_env;
      const _t6430 = ({classes: __rec_upd_6429.classes, constructors: List$concat(ctor_infos_6427, ctx.type_env.constructors), effects: __rec_upd_6429.effects, instances: __rec_upd_6429.instances, modules: __rec_upd_6429.modules, mutable_fields: __rec_upd_6429.mutable_fields, records: __rec_upd_6429.records, type_aliases: __rec_upd_6429.type_aliases, type_synonyms: __rec_upd_6429.type_synonyms, variants: ({_hd: [type_name, num_params_6170, variant_def_6425, is_gadt_6268], _tl: ctx.type_env.variants})});
      const type_env_6431 = _t6430;
      const __rec_upd_6433 = ctx;
      const _t6434 = ({constraint_tvars: __rec_upd_6433.constraint_tvars, current_eff: __rec_upd_6433.current_eff, current_module: __rec_upd_6433.current_module, inside_handler: __rec_upd_6433.inside_handler, loop_info: __rec_upd_6433.loop_info, mutable_vars: __rec_upd_6433.mutable_vars, return_type: __rec_upd_6433.return_type, return_used: __rec_upd_6433.return_used, type_env: type_env_6431, vars: __rec_upd_6433.vars});
      const _t6432 = _t6434;
      const _t6428 = _t6432;
      const _t6426 = _t6428;
      const _t6424 = _t6426;
      const _t6422 = _t6424;
      const _t6293 = _t6422;
      const _t6269 = _t6293;
      const _t6263 = _t6269;
      const _t6182 = _t6263;
      const _t6180 = _t6182;
      _t6173 = _t6180;
      break _t6174;
    }
    if (_t6172._tag === 1) {
      const fields = _t6172._val;
      const __rec_upd_6435 = ctx;
      const __rec_upd_6437 = ctx.type_env;
      const _t6438 = ({classes: __rec_upd_6437.classes, constructors: __rec_upd_6437.constructors, effects: __rec_upd_6437.effects, instances: __rec_upd_6437.instances, modules: __rec_upd_6437.modules, mutable_fields: __rec_upd_6437.mutable_fields, records: ({_hd: [type_name, null], _tl: ctx.type_env.records}), type_aliases: __rec_upd_6437.type_aliases, type_synonyms: __rec_upd_6437.type_synonyms, variants: __rec_upd_6437.variants});
      const _t6436 = ({constraint_tvars: __rec_upd_6435.constraint_tvars, current_eff: __rec_upd_6435.current_eff, current_module: __rec_upd_6435.current_module, inside_handler: __rec_upd_6435.inside_handler, loop_info: __rec_upd_6435.loop_info, mutable_vars: __rec_upd_6435.mutable_vars, return_type: __rec_upd_6435.return_type, return_used: __rec_upd_6435.return_used, type_env: _t6438, vars: __rec_upd_6435.vars});
      const pre_ctx_6439 = _t6436;
      const param_tbl_6441 = Hashtbl$create(4);
      function _t6443(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6441, name, i]);
      }
      List$iteri(_t6443, type_params);
      function _t6444(__p152) {
        let _t6446;
        const _t6445 = __p152;
        _t6447: {
          if (true) {
            const _is_mut = _t6445[0];
            const name = _t6445[1];
            const annot = _t6445[2];
            const tvars_6448 = Hashtbl$create(4);
            function resolve_field(__x) {
              while (true) {
                let _t6451;
                const _t6450 = __x;
                _t6452: {
                  if (_t6450._tag === 1) {
                    const vname = _t6450._val;
                    let _t6454;
                    const _t6453 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6441, vname]);
                    _t6455: {
                      if (_t6453._tag === 1) {
                        const idx = _t6453._val;
                        _t6454 = ({_tag: 17, _name: "TGen", _val: idx});
                        break _t6455;
                      }
                      if (_t6453._tag === 0) {
                        let _t6457;
                        const _t6456 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6448, vname]);
                        _t6458: {
                          if (_t6456._tag === 1) {
                            const tv = _t6456._val;
                            _t6457 = tv;
                            break _t6458;
                          }
                          if (_t6456._tag === 0) {
                            const tv_6459 = Types$new_tvar(0);
                            _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6448, vname, tv_6459]);
                            const _t6460 = tv_6459;
                            _t6457 = _t6460;
                            break _t6458;
                          }
                          _match_fail("line 16190");
                        }
                        _t6454 = _t6457;
                        break _t6455;
                      }
                      _match_fail("line 16190");
                    }
                    _t6451 = _t6454;
                    break _t6452;
                  }
                  if (_t6450._tag === 0 && _t6450._val === "int") {
                    _t6451 = ({_tag: 0, _name: "TInt"});
                    break _t6452;
                  }
                  if (_t6450._tag === 0 && _t6450._val === "float") {
                    _t6451 = ({_tag: 1, _name: "TFloat"});
                    break _t6452;
                  }
                  if (_t6450._tag === 0 && _t6450._val === "bool") {
                    _t6451 = ({_tag: 2, _name: "TBool"});
                    break _t6452;
                  }
                  if (_t6450._tag === 0 && _t6450._val === "string") {
                    _t6451 = ({_tag: 3, _name: "TString"});
                    break _t6452;
                  }
                  if (_t6450._tag === 0 && _t6450._val === "unit") {
                    _t6451 = ({_tag: 6, _name: "TUnit"});
                    break _t6452;
                  }
                  if (_t6450._tag === 0) {
                    const n = _t6450._val;
                    _t6451 = Typechecker$resolve_ty_annot(pre_ctx_6439, 0, ({_tag: 0, _name: "TyName", _val: n}));
                    break _t6452;
                  }
                  if (_t6450._tag === 2) {
                    const a = _t6450._val[0];
                    const b = _t6450._val[1];
                    _t6451 = ({_tag: 7, _name: "TArrow", _val: [resolve_field(a), ({_tag: 1, _name: "EffEmpty"}), resolve_field(b)]});
                    break _t6452;
                  }
                  if (_t6450._tag === 6) {
                    const ts = _t6450._val;
                    _t6451 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve_field, ts)});
                    break _t6452;
                  }
                  if (_t6450._tag === 4) {
                    const t = _t6450._val;
                    _t6451 = ({_tag: 10, _name: "TList", _val: resolve_field(t)});
                    break _t6452;
                  }
                  if (_t6450._tag === 5) {
                    const t = _t6450._val;
                    _t6451 = ({_tag: 14, _name: "TArray", _val: resolve_field(t)});
                    break _t6452;
                  }
                  if (_t6450._tag === 8) {
                    const k = _t6450._val[0];
                    const v = _t6450._val[1];
                    _t6451 = ({_tag: 13, _name: "TMap", _val: [resolve_field(k), resolve_field(v)]});
                    break _t6452;
                  }
                  if (_t6450._tag === 7) {
                    const args = _t6450._val[0];
                    const n = _t6450._val[1];
                    const arg_tys_6461 = List$map(resolve_field, args);
                    function _t6463(__p153) {
                      let _t6465;
                      const _t6464 = __p153;
                      _t6466: {
                        if (true) {
                          const tn = _t6464[0];
                          _t6465 = (tn === n);
                          break _t6466;
                        }
                        _match_fail("line 16190");
                      }
                      return _t6465;
                    }
                    let _t6468;
                    const _t6467 = List$find(_t6463, pre_ctx_6439.type_env.type_synonyms);
                    _t6469: {
                      if (_t6467._tag === 1) {
                        const np = _t6467._val[1];
                        const ty = _t6467._val[2];
                        let _t6470;
                        if ((List$length(arg_tys_6461) !== np)) {
                          _t6470 = Typechecker$error(((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " arg(s), got ") + __dict_Show_int.show(List$length(arg_tys_6461))));
                        } else {
                          _t6470 = undefined;
                        }
                        _t6470;
                        _t6468 = Typechecker$subst_tgens(arg_tys_6461, ty);
                        break _t6469;
                      }
                      if (_t6467._tag === 0) {
                        let _t6472;
                        const _t6471 = Typechecker$find_variant_info(pre_ctx_6439.type_env, n);
                        _t6473: {
                          if (_t6471._tag === 1) {
                            const np = _t6471._val[1];
                            let _t6474;
                            if ((List$length(arg_tys_6461) !== np)) {
                              _t6474 = Typechecker$error(((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " arg(s), got ") + __dict_Show_int.show(List$length(arg_tys_6461))));
                            } else {
                              _t6474 = undefined;
                            }
                            _t6474;
                            const canonical_6475 = Typechecker$resolve_type_alias(pre_ctx_6439.type_env, n);
                            const _t6476 = ({_tag: 12, _name: "TVariant", _val: [canonical_6475, arg_tys_6461]});
                            _t6472 = _t6476;
                            break _t6473;
                          }
                          if (_t6471._tag === 0) {
                            _t6472 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(n)));
                            break _t6473;
                          }
                          _match_fail("line 16190");
                        }
                        _t6468 = _t6472;
                        break _t6469;
                      }
                      _match_fail("line 16190");
                    }
                    const _t6462 = _t6468;
                    _t6451 = _t6462;
                    break _t6452;
                  }
                  if (_t6450._tag === 3) {
                    const fs = _t6450._val[0];
                    const is_open = _t6450._val[1];
                    function _t6477(__p154, __p155) {
                      let _t6479;
                      const _t6478 = __p154;
                      _t6480: {
                        if (true) {
                          const a = _t6478[0];
                          let _t6482;
                          const _t6481 = __p155;
                          _t6483: {
                            if (true) {
                              const b = _t6481[0];
                              _t6482 = String$compare(a, b);
                              break _t6483;
                            }
                            _match_fail("line 16190");
                          }
                          _t6479 = _t6482;
                          break _t6480;
                        }
                        _match_fail("line 16190");
                      }
                      return _t6479;
                    }
                    function _t6484(__p156) {
                      let _t6486;
                      const _t6485 = __p156;
                      _t6487: {
                        if (true) {
                          const fn_ = _t6485[0];
                          const ft = _t6485[1];
                          _t6486 = [fn_, resolve_field(ft)];
                          break _t6487;
                        }
                        _match_fail("line 16190");
                      }
                      return _t6486;
                    }
                    const fields_6488 = List$sort(_t6477, List$map(_t6484, fs));
                    let _t6490;
                    if (is_open) {
                      _t6490 = Types$new_rvar(0);
                    } else {
                      _t6490 = ({_tag: 2, _name: "REmpty"});
                    }
                    const tail_6491 = _t6490;
                    function _t6493(__p157, acc) {
                      let _t6495;
                      const _t6494 = __p157;
                      _t6496: {
                        if (true) {
                          const n = _t6494[0];
                          const t = _t6494[1];
                          _t6495 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                          break _t6496;
                        }
                        _match_fail("line 16190");
                      }
                      return _t6495;
                    }
                    const _t6492 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6493, fields_6488, tail_6491)});
                    const _t6489 = _t6492;
                    _t6451 = _t6489;
                    break _t6452;
                  }
                  if (_t6450._tag === 9) {
                    const path = _t6450._val[0];
                    const n = _t6450._val[1];
                    const qualified_6497 = (String$concat(".", path) + ("." + n));
                    const _t6499 = ({_tag: 0, _name: "TyName", _val: qualified_6497});
                    __x = _t6499;
                    continue;
                    const _t6498 = undefined;
                    _t6451 = _t6498;
                    break _t6452;
                  }
                  if (_t6450._tag === 10) {
                    const _kind = _t6450._val[0];
                    const tags = _t6450._val[1];
                    function _t6500(__p158, acc) {
                      let _t6502;
                      const _t6501 = __p158;
                      _t6503: {
                        if (true) {
                          const tag = _t6501[0];
                          const payload_annot = _t6501[1];
                          _t6502 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve_field, payload_annot), acc]});
                          break _t6503;
                        }
                        _match_fail("line 16190");
                      }
                      return _t6502;
                    }
                    const row_6504 = List$fold_right(_t6500, tags, ({_tag: 2, _name: "PVEmpty"}));
                    const _t6505 = ({_tag: 15, _name: "TPolyVariant", _val: row_6504});
                    _t6451 = _t6505;
                    break _t6452;
                  }
                  if (_t6450._tag === 11) {
                    const ty = _t6450._val[0];
                    const _t6506 = ty;
                    __x = _t6506;
                    continue;
                    _t6451 = undefined;
                    break _t6452;
                  }
                  _match_fail("line 16190");
                }
                return _t6451;
              }
            }
            const _t6507 = [name, resolve_field(annot)];
            const _t6449 = _t6507;
            _t6446 = _t6449;
            break _t6447;
          }
          _match_fail("line 16190");
        }
        return _t6446;
      }
      const typed_fields_6508 = List$map(_t6444, fields);
      function _t6510(__p159) {
        let _t6512;
        const _t6511 = __p159;
        _t6513: {
          if (true) {
            const is_mut = _t6511[0];
            const name = _t6511[1];
            let _t6514;
            if (is_mut) {
              _t6514 = ({_tag: 1, _name: "Some", _val: name});
            } else {
              _t6514 = ({_tag: 0, _name: "None"});
            }
            _t6512 = _t6514;
            break _t6513;
          }
          _match_fail("line 16190");
        }
        return _t6512;
      }
      const mut_fields_6515 = List$filter_map(_t6510, fields);
      function _t6517(__p160, __p161) {
        let _t6519;
        const _t6518 = __p160;
        _t6520: {
          if (true) {
            const a = _t6518[0];
            let _t6522;
            const _t6521 = __p161;
            _t6523: {
              if (true) {
                const b = _t6521[0];
                _t6522 = String$compare(a, b);
                break _t6523;
              }
              _match_fail("line 16190");
            }
            _t6519 = _t6522;
            break _t6520;
          }
          _match_fail("line 16190");
        }
        return _t6519;
      }
      const sorted_fields_6524 = List$sort(_t6517, typed_fields_6508);
      const __rec_upd_6526 = ctx.type_env;
      const _t6527 = ({classes: __rec_upd_6526.classes, constructors: __rec_upd_6526.constructors, effects: __rec_upd_6526.effects, instances: __rec_upd_6526.instances, modules: __rec_upd_6526.modules, mutable_fields: List$concat(mut_fields_6515, ctx.type_env.mutable_fields), records: ({_hd: [type_name, sorted_fields_6524], _tl: ctx.type_env.records}), type_aliases: __rec_upd_6526.type_aliases, type_synonyms: ({_hd: [type_name, num_params_6170, ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(sorted_fields_6524)})], _tl: ctx.type_env.type_synonyms}), variants: __rec_upd_6526.variants});
      const type_env_6528 = _t6527;
      const __rec_upd_6530 = ctx;
      const _t6531 = ({constraint_tvars: __rec_upd_6530.constraint_tvars, current_eff: __rec_upd_6530.current_eff, current_module: __rec_upd_6530.current_module, inside_handler: __rec_upd_6530.inside_handler, loop_info: __rec_upd_6530.loop_info, mutable_vars: __rec_upd_6530.mutable_vars, return_type: __rec_upd_6530.return_type, return_used: __rec_upd_6530.return_used, type_env: type_env_6528, vars: __rec_upd_6530.vars});
      const _t6529 = _t6531;
      const _t6525 = _t6529;
      const _t6516 = _t6525;
      const _t6509 = _t6516;
      const _t6442 = _t6509;
      const _t6440 = _t6442;
      _t6173 = _t6440;
      break _t6174;
    }
    if (_t6172._tag === 2) {
      const annot = _t6172._val;
      const param_tbl_6532 = Hashtbl$create(4);
      function _t6534(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6532, name, i]);
      }
      List$iteri(_t6534, type_params);
      const tvars_6535 = Hashtbl$create(4);
      function resolve_alias(__x) {
        while (true) {
          let _t6538;
          const _t6537 = __x;
          _t6539: {
            if (_t6537._tag === 1) {
              const name = _t6537._val;
              let _t6541;
              const _t6540 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6532, name]);
              _t6542: {
                if (_t6540._tag === 1) {
                  const idx = _t6540._val;
                  _t6541 = ({_tag: 17, _name: "TGen", _val: idx});
                  break _t6542;
                }
                if (_t6540._tag === 0) {
                  let _t6544;
                  const _t6543 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6535, name]);
                  _t6545: {
                    if (_t6543._tag === 1) {
                      const tv = _t6543._val;
                      _t6544 = tv;
                      break _t6545;
                    }
                    if (_t6543._tag === 0) {
                      const tv_6546 = Types$new_tvar(0);
                      _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6535, name, tv_6546]);
                      const _t6547 = tv_6546;
                      _t6544 = _t6547;
                      break _t6545;
                    }
                    _match_fail("line 16190");
                  }
                  _t6541 = _t6544;
                  break _t6542;
                }
                _match_fail("line 16190");
              }
              _t6538 = _t6541;
              break _t6539;
            }
            if (_t6537._tag === 0 && _t6537._val === "int") {
              _t6538 = ({_tag: 0, _name: "TInt"});
              break _t6539;
            }
            if (_t6537._tag === 0 && _t6537._val === "float") {
              _t6538 = ({_tag: 1, _name: "TFloat"});
              break _t6539;
            }
            if (_t6537._tag === 0 && _t6537._val === "bool") {
              _t6538 = ({_tag: 2, _name: "TBool"});
              break _t6539;
            }
            if (_t6537._tag === 0 && _t6537._val === "string") {
              _t6538 = ({_tag: 3, _name: "TString"});
              break _t6539;
            }
            if (_t6537._tag === 0 && _t6537._val === "unit") {
              _t6538 = ({_tag: 6, _name: "TUnit"});
              break _t6539;
            }
            if (_t6537._tag === 0) {
              const name = _t6537._val;
              const canonical_6548 = Typechecker$resolve_type_alias(ctx.type_env, name);
              function _t6550(__p162) {
                let _t6552;
                const _t6551 = __p162;
                _t6553: {
                  if (true) {
                    const n = _t6551[0];
                    _t6552 = (n === canonical_6548);
                    break _t6553;
                  }
                  _match_fail("line 16190");
                }
                return _t6552;
              }
              let _t6555;
              const _t6554 = List$find(_t6550, ctx.type_env.type_synonyms);
              _t6556: {
                if (_t6554._tag === 1 && _t6554._val[1] === 0) {
                  const ty = _t6554._val[2];
                  _t6555 = ty;
                  break _t6556;
                }
                if (_t6554._tag === 1) {
                  const n = _t6554._val[1];
                  _t6555 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                  break _t6556;
                }
                if (_t6554._tag === 0) {
                  let _t6558;
                  const _t6557 = Typechecker$find_variant_info(ctx.type_env, name);
                  _t6559: {
                    if (_t6557._tag === 1 && _t6557._val[1] === 0) {
                      _t6558 = ({_tag: 12, _name: "TVariant", _val: [canonical_6548, null]});
                      break _t6559;
                    }
                    if (_t6557._tag === 1) {
                      const n = _t6557._val[1];
                      _t6558 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                      break _t6559;
                    }
                    if (_t6557._tag === 0) {
                      let _t6560;
                      if (!_eq(List$assoc_opt(canonical_6548, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                        const fields_6561 = List$assoc(canonical_6548, ctx.type_env.records);
                        let _t6563;
                        if (_eq(fields_6561, null)) {
                          _t6563 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                        } else {
                          _t6563 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6561)});
                        }
                        const _t6562 = _t6563;
                        _t6560 = _t6562;
                      } else {
                        _t6560 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                      }
                      _t6558 = _t6560;
                      break _t6559;
                    }
                    _match_fail("line 16190");
                  }
                  _t6555 = _t6558;
                  break _t6556;
                }
                _match_fail("line 16190");
              }
              const _t6549 = _t6555;
              _t6538 = _t6549;
              break _t6539;
            }
            if (_t6537._tag === 2) {
              const a = _t6537._val[0];
              const b = _t6537._val[1];
              _t6538 = ({_tag: 7, _name: "TArrow", _val: [resolve_alias(a), ({_tag: 1, _name: "EffEmpty"}), resolve_alias(b)]});
              break _t6539;
            }
            if (_t6537._tag === 6) {
              const ts = _t6537._val;
              _t6538 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve_alias, ts)});
              break _t6539;
            }
            if (_t6537._tag === 4) {
              const t = _t6537._val;
              _t6538 = ({_tag: 10, _name: "TList", _val: resolve_alias(t)});
              break _t6539;
            }
            if (_t6537._tag === 5) {
              const t = _t6537._val;
              _t6538 = ({_tag: 14, _name: "TArray", _val: resolve_alias(t)});
              break _t6539;
            }
            if (_t6537._tag === 8) {
              const k = _t6537._val[0];
              const v = _t6537._val[1];
              _t6538 = ({_tag: 13, _name: "TMap", _val: [resolve_alias(k), resolve_alias(v)]});
              break _t6539;
            }
            if (_t6537._tag === 7) {
              const args = _t6537._val[0];
              const tname = _t6537._val[1];
              const canonical_6564 = Typechecker$resolve_type_alias(ctx.type_env, tname);
              const arg_tys_6566 = List$map(resolve_alias, args);
              function _t6568(__p163) {
                let _t6570;
                const _t6569 = __p163;
                _t6571: {
                  if (true) {
                    const n = _t6569[0];
                    _t6570 = (n === canonical_6564);
                    break _t6571;
                  }
                  _match_fail("line 16190");
                }
                return _t6570;
              }
              let _t6573;
              const _t6572 = List$find(_t6568, ctx.type_env.type_synonyms);
              _t6574: {
                if (_t6572._tag === 1) {
                  const np = _t6572._val[1];
                  const ty = _t6572._val[2];
                  let _t6575;
                  if ((List$length(arg_tys_6566) !== np)) {
                    _t6575 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6566))));
                  } else {
                    _t6575 = undefined;
                  }
                  _t6575;
                  _t6573 = Typechecker$subst_tgens(arg_tys_6566, ty);
                  break _t6574;
                }
                if (_t6572._tag === 0) {
                  let _t6577;
                  const _t6576 = Typechecker$find_variant_info(ctx.type_env, tname);
                  _t6578: {
                    if (_t6576._tag === 1) {
                      const np = _t6576._val[1];
                      let _t6579;
                      if ((List$length(arg_tys_6566) !== np)) {
                        _t6579 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6566))));
                      } else {
                        _t6579 = undefined;
                      }
                      _t6579;
                      _t6577 = ({_tag: 12, _name: "TVariant", _val: [canonical_6564, arg_tys_6566]});
                      break _t6578;
                    }
                    if (_t6576._tag === 0) {
                      _t6577 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                      break _t6578;
                    }
                    _match_fail("line 16190");
                  }
                  _t6573 = _t6577;
                  break _t6574;
                }
                _match_fail("line 16190");
              }
              const _t6567 = _t6573;
              const _t6565 = _t6567;
              _t6538 = _t6565;
              break _t6539;
            }
            if (_t6537._tag === 3) {
              const fields = _t6537._val[0];
              const is_open = _t6537._val[1];
              function _t6580(__p164) {
                let _t6582;
                const _t6581 = __p164;
                _t6583: {
                  if (true) {
                    const n = _t6581[0];
                    const t = _t6581[1];
                    _t6582 = [n, resolve_alias(t)];
                    break _t6583;
                  }
                  _match_fail("line 16190");
                }
                return _t6582;
              }
              const fields_6584 = List$map(_t6580, fields);
              function _t6586(__p165, __p166) {
                let _t6588;
                const _t6587 = __p165;
                _t6589: {
                  if (true) {
                    const a = _t6587[0];
                    let _t6591;
                    const _t6590 = __p166;
                    _t6592: {
                      if (true) {
                        const b = _t6590[0];
                        _t6591 = String$compare(a, b);
                        break _t6592;
                      }
                      _match_fail("line 16190");
                    }
                    _t6588 = _t6591;
                    break _t6589;
                  }
                  _match_fail("line 16190");
                }
                return _t6588;
              }
              const fields_6593 = List$sort(_t6586, fields_6584);
              let _t6595;
              if (is_open) {
                _t6595 = Types$new_rvar(0);
              } else {
                _t6595 = ({_tag: 2, _name: "REmpty"});
              }
              const tail_6596 = _t6595;
              function _t6598(__p167, acc) {
                let _t6600;
                const _t6599 = __p167;
                _t6601: {
                  if (true) {
                    const n = _t6599[0];
                    const t = _t6599[1];
                    _t6600 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                    break _t6601;
                  }
                  _match_fail("line 16190");
                }
                return _t6600;
              }
              const _t6597 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6598, fields_6593, tail_6596)});
              const _t6594 = _t6597;
              const _t6585 = _t6594;
              _t6538 = _t6585;
              break _t6539;
            }
            if (_t6537._tag === 9) {
              const path = _t6537._val[0];
              const name = _t6537._val[1];
              const qualified_6602 = (String$concat(".", path) + ("." + name));
              const _t6604 = ({_tag: 0, _name: "TyName", _val: qualified_6602});
              __x = _t6604;
              continue;
              const _t6603 = undefined;
              _t6538 = _t6603;
              break _t6539;
            }
            if (_t6537._tag === 10) {
              const _kind = _t6537._val[0];
              const tags = _t6537._val[1];
              function _t6605(__p168, acc) {
                let _t6607;
                const _t6606 = __p168;
                _t6608: {
                  if (true) {
                    const tag = _t6606[0];
                    const payload_annot = _t6606[1];
                    _t6607 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve_alias, payload_annot), acc]});
                    break _t6608;
                  }
                  _match_fail("line 16190");
                }
                return _t6607;
              }
              const row_6609 = List$fold_right(_t6605, tags, ({_tag: 2, _name: "PVEmpty"}));
              const _t6610 = ({_tag: 15, _name: "TPolyVariant", _val: row_6609});
              _t6538 = _t6610;
              break _t6539;
            }
            if (_t6537._tag === 11) {
              const ty = _t6537._val[0];
              const _t6611 = ty;
              __x = _t6611;
              continue;
              _t6538 = undefined;
              break _t6539;
            }
            _match_fail("line 16190");
          }
          return _t6538;
        }
      }
      const resolved_ty_6613 = resolve_alias(annot);
      const __rec_upd_6615 = ctx.type_env;
      const _t6616 = ({classes: __rec_upd_6615.classes, constructors: __rec_upd_6615.constructors, effects: __rec_upd_6615.effects, instances: __rec_upd_6615.instances, modules: __rec_upd_6615.modules, mutable_fields: __rec_upd_6615.mutable_fields, records: __rec_upd_6615.records, type_aliases: __rec_upd_6615.type_aliases, type_synonyms: ({_hd: [type_name, num_params_6170, resolved_ty_6613], _tl: ctx.type_env.type_synonyms}), variants: __rec_upd_6615.variants});
      const type_env_6617 = _t6616;
      const __rec_upd_6619 = ctx;
      const _t6620 = ({constraint_tvars: __rec_upd_6619.constraint_tvars, current_eff: __rec_upd_6619.current_eff, current_module: __rec_upd_6619.current_module, inside_handler: __rec_upd_6619.inside_handler, loop_info: __rec_upd_6619.loop_info, mutable_vars: __rec_upd_6619.mutable_vars, return_type: __rec_upd_6619.return_type, return_used: __rec_upd_6619.return_used, type_env: type_env_6617, vars: __rec_upd_6619.vars});
      const _t6618 = _t6620;
      const _t6614 = _t6618;
      const _t6612 = _t6614;
      const _t6536 = _t6612;
      const _t6533 = _t6536;
      _t6173 = _t6533;
      break _t6174;
    }
    _match_fail("line 16190");
  }
  const _t6171 = _t6173;
  return _t6171;
}
function Typechecker$wrap_params_decl(params, ret_annot, body) {
  let _t6622;
  const _t6621 = ret_annot;
  _t6623: {
    if (_t6621._tag === 1 && _t6621._val._tag === 11) {
      const ret_ty = _t6621._val._val[0];
      const eff_annot = _t6621._val._val[1];
      if (!_eq(params, null)) {
        const body_6624 = ({_tag: 30, _name: "EAnnot", _val: [body, ret_ty]});
        function _t6626(param, body) {
          return ({_tag: 10, _name: "EFun", _val: [param, body]});
        }
        const full_fun_6627 = List$fold_right(_t6626, params, body_6624);
        function build_arrow(__x) {
          let _t6630;
          const _t6629 = __x;
          _t6631: {
            if (_t6629 === null) {
              _t6630 = ret_ty;
              break _t6631;
            }
            if (_t6629 !== null && _t6629._tl === null) {
              const p = _t6629._hd;
              let _t6633;
              const _t6632 = p.annot;
              _t6634: {
                if (_t6632._tag === 1) {
                  const t = _t6632._val;
                  _t6633 = t;
                  break _t6634;
                }
                if (_t6632._tag === 0) {
                  _t6633 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t6634;
                }
                _match_fail("line 16190");
              }
              const pty_6635 = _t6633;
              const _t6636 = ({_tag: 2, _name: "TyArrow", _val: [pty_6635, ret_ty, ({_tag: 1, _name: "Some", _val: eff_annot})]});
              _t6630 = _t6636;
              break _t6631;
            }
            if (_t6629 !== null) {
              const p = _t6629._hd;
              const rest = _t6629._tl;
              let _t6638;
              const _t6637 = p.annot;
              _t6639: {
                if (_t6637._tag === 1) {
                  const t = _t6637._val;
                  _t6638 = t;
                  break _t6639;
                }
                if (_t6637._tag === 0) {
                  _t6638 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t6639;
                }
                _match_fail("line 16190");
              }
              const pty_6640 = _t6638;
              const _t6641 = ({_tag: 2, _name: "TyArrow", _val: [pty_6640, build_arrow(rest), ({_tag: 0, _name: "None"})]});
              _t6630 = _t6641;
              break _t6631;
            }
            _match_fail("line 16190");
          }
          return _t6630;
        }
        const _t6642 = ({_tag: 30, _name: "EAnnot", _val: [full_fun_6627, build_arrow(params)]});
        const _t6628 = _t6642;
        const _t6625 = _t6628;
        _t6622 = _t6625;
        break _t6623;
      }
    }
    if (true) {
      let _t6644;
      const _t6643 = ret_annot;
      _t6645: {
        if (_t6643._tag === 1) {
          const ty = _t6643._val;
          _t6644 = ({_tag: 30, _name: "EAnnot", _val: [body, ty]});
          break _t6645;
        }
        if (_t6643._tag === 0) {
          _t6644 = body;
          break _t6645;
        }
        _match_fail("line 16190");
      }
      const body_6646 = _t6644;
      function _t6648(param, body) {
        return ({_tag: 10, _name: "EFun", _val: [param, body]});
      }
      const _t6647 = List$fold_right(_t6648, params, body_6646);
      _t6622 = _t6647;
      break _t6623;
    }
    _match_fail("line 16190");
  }
  return _t6622;
}
function Typechecker$process_class_def(ctx, class_name, tyvar_names, fundep_annots, methods) {
  function _t6649(c) {
    return (c.class_name === class_name);
  }
  let _t6650;
  if (List$exists(_t6649, ctx.type_env.classes)) {
    _t6650 = Typechecker$error(("duplicate class definition: " + __dict_Show_string.show(class_name)));
  } else {
    _t6650 = undefined;
  }
  _t6650;
  const num_class_params_6651 = List$length(tyvar_names);
  function _t6653(__p169) {
    let _t6655;
    const _t6654 = __p169;
    _t6656: {
      if (true) {
        const mname = _t6654[0];
        const annot = _t6654[1];
        const tvars_6657 = Hashtbl$create(4);
        function _t6659(i, name) {
          return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6657, name, ({_tag: 17, _name: "TGen", _val: i})]);
        }
        List$iteri(_t6659, tyvar_names);
        const next_gen_6660 = Ref$create(num_class_params_6651);
        const eff_tvars_6662 = Hashtbl$create(2);
        const next_effgen_6664 = Ref$create(0);
        function _t6666(__dict_Hash_0, __dict_Eq_0, name) {
          let _t6668;
          const _t6667 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, eff_tvars_6662, name]);
          _t6669: {
            if (_t6667._tag === 1) {
              const eg = _t6667._val;
              _t6668 = eg;
              break _t6669;
            }
            if (_t6667._tag === 0) {
              const idx_6670 = Ref$get(next_effgen_6664);
              Ref$set(next_effgen_6664, (idx_6670 + 1));
              const eg_6672 = ({_tag: 3, _name: "EffGen", _val: idx_6670});
              _call(Hashtbl$set, [__dict_Hash_0, __dict_Eq_0, eff_tvars_6662, name, eg_6672]);
              const _t6673 = eg_6672;
              const _t6671 = _t6673;
              _t6668 = _t6671;
              break _t6669;
            }
            _match_fail("line 16190");
          }
          return _t6668;
        }
        const resolve_eff_var_6674 = _t6666;
        function resolve(__x) {
          while (true) {
            let _t6677;
            const _t6676 = __x;
            _t6678: {
              if (_t6676._tag === 1) {
                const name = _t6676._val;
                let _t6680;
                const _t6679 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6657, name]);
                _t6681: {
                  if (_t6679._tag === 1) {
                    const tv = _t6679._val;
                    _t6680 = tv;
                    break _t6681;
                  }
                  if (_t6679._tag === 0) {
                    const idx_6682 = Ref$get(next_gen_6660);
                    Ref$set(next_gen_6660, (idx_6682 + 1));
                    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6657, name, ({_tag: 17, _name: "TGen", _val: idx_6682})]);
                    const _t6683 = ({_tag: 17, _name: "TGen", _val: idx_6682});
                    _t6680 = _t6683;
                    break _t6681;
                  }
                  _match_fail("line 16190");
                }
                _t6677 = _t6680;
                break _t6678;
              }
              if (_t6676._tag === 0 && _t6676._val === "int") {
                _t6677 = ({_tag: 0, _name: "TInt"});
                break _t6678;
              }
              if (_t6676._tag === 0 && _t6676._val === "float") {
                _t6677 = ({_tag: 1, _name: "TFloat"});
                break _t6678;
              }
              if (_t6676._tag === 0 && _t6676._val === "bool") {
                _t6677 = ({_tag: 2, _name: "TBool"});
                break _t6678;
              }
              if (_t6676._tag === 0 && _t6676._val === "string") {
                _t6677 = ({_tag: 3, _name: "TString"});
                break _t6678;
              }
              if (_t6676._tag === 0 && _t6676._val === "unit") {
                _t6677 = ({_tag: 6, _name: "TUnit"});
                break _t6678;
              }
              if (_t6676._tag === 0) {
                const name = _t6676._val;
                const canonical_6684 = Typechecker$resolve_type_alias(ctx.type_env, name);
                let _t6687;
                const _t6686 = Typechecker$find_variant_info(ctx.type_env, name);
                _t6688: {
                  if (_t6686._tag === 1 && _t6686._val[1] === 0) {
                    _t6687 = ({_tag: 12, _name: "TVariant", _val: [canonical_6684, null]});
                    break _t6688;
                  }
                  if (_t6686._tag === 1) {
                    const n = _t6686._val[1];
                    _t6687 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                    break _t6688;
                  }
                  if (_t6686._tag === 0) {
                    _t6687 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                    break _t6688;
                  }
                  _match_fail("line 16190");
                }
                const _t6685 = _t6687;
                _t6677 = _t6685;
                break _t6678;
              }
              if (_t6676._tag === 2) {
                const a = _t6676._val[0];
                const b = _t6676._val[1];
                const eff_opt = _t6676._val[2];
                let _t6690;
                const _t6689 = eff_opt;
                _t6691: {
                  if (_t6689._tag === 0) {
                    _t6690 = ({_tag: 1, _name: "EffEmpty"});
                    break _t6691;
                  }
                  if (_t6689._tag === 1 && _t6689._val._tag === 0) {
                    _t6690 = ({_tag: 1, _name: "EffEmpty"});
                    break _t6691;
                  }
                  if (_t6689._tag === 1 && _t6689._val._tag === 1) {
                    const items = _t6689._val._val;
                    _t6690 = resolve_class_eff_items(items);
                    break _t6691;
                  }
                  _match_fail("line 16190");
                }
                const eff_6692 = _t6690;
                const _t6693 = ({_tag: 7, _name: "TArrow", _val: [resolve(a), eff_6692, resolve(b)]});
                _t6677 = _t6693;
                break _t6678;
              }
              if (_t6676._tag === 6) {
                const ts = _t6676._val;
                _t6677 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve, ts)});
                break _t6678;
              }
              if (_t6676._tag === 4) {
                const t = _t6676._val;
                _t6677 = ({_tag: 10, _name: "TList", _val: resolve(t)});
                break _t6678;
              }
              if (_t6676._tag === 5) {
                const t = _t6676._val;
                _t6677 = ({_tag: 14, _name: "TArray", _val: resolve(t)});
                break _t6678;
              }
              if (_t6676._tag === 8) {
                const k = _t6676._val[0];
                const v = _t6676._val[1];
                _t6677 = ({_tag: 13, _name: "TMap", _val: [resolve(k), resolve(v)]});
                break _t6678;
              }
              if (_t6676._tag === 7) {
                const args = _t6676._val[0];
                const name = _t6676._val[1];
                const canonical_6694 = Typechecker$resolve_type_alias(ctx.type_env, name);
                const arg_tys_6696 = List$map(resolve, args);
                let _t6699;
                const _t6698 = Typechecker$find_variant_info(ctx.type_env, name);
                _t6700: {
                  if (_t6698._tag === 1) {
                    const np = _t6698._val[1];
                    let _t6701;
                    if ((List$length(arg_tys_6696) !== np)) {
                      _t6701 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6696))));
                    } else {
                      _t6701 = undefined;
                    }
                    _t6701;
                    _t6699 = ({_tag: 12, _name: "TVariant", _val: [canonical_6694, arg_tys_6696]});
                    break _t6700;
                  }
                  if (_t6698._tag === 0) {
                    _t6699 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
                    break _t6700;
                  }
                  _match_fail("line 16190");
                }
                const _t6697 = _t6699;
                const _t6695 = _t6697;
                _t6677 = _t6695;
                break _t6678;
              }
              if (_t6676._tag === 3) {
                const fields = _t6676._val[0];
                const is_open = _t6676._val[1];
                function _t6702(__p170, __p171) {
                  let _t6704;
                  const _t6703 = __p170;
                  _t6705: {
                    if (true) {
                      const a = _t6703[0];
                      let _t6707;
                      const _t6706 = __p171;
                      _t6708: {
                        if (true) {
                          const b = _t6706[0];
                          _t6707 = String$compare(a, b);
                          break _t6708;
                        }
                        _match_fail("line 16190");
                      }
                      _t6704 = _t6707;
                      break _t6705;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6704;
                }
                function _t6709(__p172) {
                  let _t6711;
                  const _t6710 = __p172;
                  _t6712: {
                    if (true) {
                      const n = _t6710[0];
                      const t = _t6710[1];
                      _t6711 = [n, resolve(t)];
                      break _t6712;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6711;
                }
                const fields_6713 = List$sort(_t6702, List$map(_t6709, fields));
                let _t6715;
                if (is_open) {
                  _t6715 = Types$new_rvar(0);
                } else {
                  _t6715 = ({_tag: 2, _name: "REmpty"});
                }
                const tail_6716 = _t6715;
                function _t6718(__p173, acc) {
                  let _t6720;
                  const _t6719 = __p173;
                  _t6721: {
                    if (true) {
                      const n = _t6719[0];
                      const t = _t6719[1];
                      _t6720 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                      break _t6721;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6720;
                }
                const _t6717 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6718, fields_6713, tail_6716)});
                const _t6714 = _t6717;
                _t6677 = _t6714;
                break _t6678;
              }
              if (_t6676._tag === 9) {
                const path = _t6676._val[0];
                const name = _t6676._val[1];
                const qualified_6722 = (String$concat(".", path) + ("." + name));
                const _t6724 = ({_tag: 0, _name: "TyName", _val: qualified_6722});
                __x = _t6724;
                continue;
                const _t6723 = undefined;
                _t6677 = _t6723;
                break _t6678;
              }
              if (_t6676._tag === 10) {
                const _kind = _t6676._val[0];
                const tags = _t6676._val[1];
                function _t6725(__p174, acc) {
                  let _t6727;
                  const _t6726 = __p174;
                  _t6728: {
                    if (true) {
                      const tag = _t6726[0];
                      const payload_annot = _t6726[1];
                      _t6727 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve, payload_annot), acc]});
                      break _t6728;
                    }
                    _match_fail("line 16190");
                  }
                  return _t6727;
                }
                const row_6729 = List$fold_right(_t6725, tags, ({_tag: 2, _name: "PVEmpty"}));
                const _t6730 = ({_tag: 15, _name: "TPolyVariant", _val: row_6729});
                _t6677 = _t6730;
                break _t6678;
              }
              if (_t6676._tag === 11) {
                const ty = _t6676._val[0];
                const _t6731 = ty;
                __x = _t6731;
                continue;
                _t6677 = undefined;
                break _t6678;
              }
              _match_fail("line 16190");
            }
            return _t6677;
          }
        }
        function resolve_class_eff_items(items) {
          const labels_6732 = Ref$create(null);
          const tail_6734 = Ref$create(({_tag: 1, _name: "EffEmpty"}));
          function _t6736(item) {
            let _t6738;
            const _t6737 = item;
            _t6739: {
              if (_t6737._tag === 0) {
                const name = _t6737._val[0];
                const param_annots = _t6737._val[1];
                const resolved_params_6740 = List$map(resolve, param_annots);
                const _t6741 = Ref$set(labels_6732, ({_hd: [name, resolved_params_6740], _tl: Ref$get(labels_6732)}));
                _t6738 = _t6741;
                break _t6739;
              }
              if (_t6737._tag === 1) {
                const name = _t6737._val;
                _t6738 = Ref$set(tail_6734, _call(resolve_eff_var_6674, [__dict_Hash_string, __dict_Eq_string, name]));
                break _t6739;
              }
              _match_fail("line 16190");
            }
            return _t6738;
          }
          List$iter(_t6736, items);
          function _t6742(__p175, acc) {
            let _t6744;
            const _t6743 = __p175;
            _t6745: {
              if (true) {
                const name = _t6743[0];
                const params = _t6743[1];
                _t6744 = ({_tag: 2, _name: "EffRow", _val: [name, params, acc]});
                break _t6745;
              }
              _match_fail("line 16190");
            }
            return _t6744;
          }
          const _t6735 = List$fold_right(_t6742, List$rev(Ref$get(labels_6732)), Ref$get(tail_6734));
          const _t6733 = _t6735;
          return _t6733;
        }
        const ty_6747 = resolve(annot);
        const method_quant_6749 = Ref$get(next_gen_6660);
        const method_equant_6751 = Ref$get(next_effgen_6664);
        const _t6752 = [mname, ty_6747, method_quant_6749, method_equant_6751];
        const _t6750 = _t6752;
        const _t6748 = _t6750;
        const _t6746 = _t6748;
        const _t6675 = _t6746;
        const _t6665 = _t6675;
        const _t6663 = _t6665;
        const _t6661 = _t6663;
        const _t6658 = _t6661;
        _t6655 = _t6658;
        break _t6656;
      }
      _match_fail("line 16190");
    }
    return _t6655;
  }
  const method_tys_6753 = List$map(_t6653, methods);
  function _t6755(__p176) {
    let _t6757;
    const _t6756 = __p176;
    _t6758: {
      if (true) {
        const from_names = _t6756[0];
        const to_names = _t6756[1];
        function _t6759(name) {
          function _t6760(n) {
            return (n === name);
          }
          let _t6762;
          const _t6761 = List$find_index(_t6760, tyvar_names);
          _t6763: {
            if (_t6761._tag === 1) {
              const i = _t6761._val;
              _t6762 = i;
              break _t6763;
            }
            if (_t6761._tag === 0) {
              _t6762 = Typechecker$error((("functional dependency type variable '" + __dict_Show_string.show(name)) + " not in class parameters"));
              break _t6763;
            }
            _match_fail("line 16190");
          }
          return _t6762;
        }
        const resolve_idx_6764 = _t6759;
        const _t6765 = ({fd_from: List$map(resolve_idx_6764, from_names), fd_to: List$map(resolve_idx_6764, to_names)});
        _t6757 = _t6765;
        break _t6758;
      }
      _match_fail("line 16190");
    }
    return _t6757;
  }
  const class_fundeps_6766 = List$map(_t6755, fundep_annots);
  function _t6768(__p177) {
    let _t6770;
    const _t6769 = __p177;
    _t6771: {
      if (true) {
        const m = _t6769[0];
        const t = _t6769[1];
        _t6770 = [m, t];
        break _t6771;
      }
      _match_fail("line 16190");
    }
    return _t6770;
  }
  const class_def_6772 = ({class_fundeps: class_fundeps_6766, class_methods: List$map(_t6768, method_tys_6753), class_name: class_name, class_params: tyvar_names});
  function _t6774(ctx, __p178) {
    let _t6776;
    const _t6775 = __p178;
    _t6777: {
      if (true) {
        const mname = _t6775[0];
        const mty = _t6775[1];
        const mquant = _t6775[2];
        const mequant = _t6775[3];
        const scheme_6778 = ({body: mty, constraints: null, equant: mequant, pvquant: 0, quant: mquant, record_evidences: null, rquant: 0});
        const _t6779 = Typechecker$extend_var(ctx, mname, scheme_6778);
        _t6776 = _t6779;
        break _t6777;
      }
      _match_fail("line 16190");
    }
    return _t6776;
  }
  const ctx_6780 = List$fold(_t6774, ctx, method_tys_6753);
  const __rec_upd_6782 = ctx_6780.type_env;
  const _t6783 = ({classes: ({_hd: class_def_6772, _tl: ctx_6780.type_env.classes}), constructors: __rec_upd_6782.constructors, effects: __rec_upd_6782.effects, instances: __rec_upd_6782.instances, modules: __rec_upd_6782.modules, mutable_fields: __rec_upd_6782.mutable_fields, records: __rec_upd_6782.records, type_aliases: __rec_upd_6782.type_aliases, type_synonyms: __rec_upd_6782.type_synonyms, variants: __rec_upd_6782.variants});
  const type_env_6784 = _t6783;
  const __rec_upd_6786 = ctx_6780;
  const _t6787 = ({constraint_tvars: __rec_upd_6786.constraint_tvars, current_eff: __rec_upd_6786.current_eff, current_module: __rec_upd_6786.current_module, inside_handler: __rec_upd_6786.inside_handler, loop_info: __rec_upd_6786.loop_info, mutable_vars: __rec_upd_6786.mutable_vars, return_type: __rec_upd_6786.return_type, return_used: __rec_upd_6786.return_used, type_env: type_env_6784, vars: __rec_upd_6786.vars});
  const ctx_6788 = _t6787;
  const _t6789 = [ctx_6788, ({_tag: 6, _name: "TDClass", _val: class_name})];
  const _t6785 = _t6789;
  const _t6781 = _t6785;
  const _t6773 = _t6781;
  const _t6767 = _t6773;
  const _t6754 = _t6767;
  const _t6652 = _t6754;
  return _t6652;
}
function Typechecker$resolve_inst_tys(ctx, annots) {
  const tvars_6790 = Hashtbl$create(4);
  const next_idx_6792 = Ref$create(0);
  function go(__x) {
    while (true) {
      let _t6795;
      const _t6794 = __x;
      _t6796: {
        if (_t6794._tag === 1) {
          const name = _t6794._val;
          let _t6798;
          const _t6797 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6790, name]);
          _t6799: {
            if (_t6797._tag === 1) {
              const idx = _t6797._val;
              _t6798 = ({_tag: 17, _name: "TGen", _val: idx});
              break _t6799;
            }
            if (_t6797._tag === 0) {
              const idx_6800 = Ref$get(next_idx_6792);
              Ref$set(next_idx_6792, (idx_6800 + 1));
              _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6790, name, idx_6800]);
              const _t6801 = ({_tag: 17, _name: "TGen", _val: idx_6800});
              _t6798 = _t6801;
              break _t6799;
            }
            _match_fail("line 16190");
          }
          _t6795 = _t6798;
          break _t6796;
        }
        if (_t6794._tag === 0 && _t6794._val === "int") {
          _t6795 = ({_tag: 0, _name: "TInt"});
          break _t6796;
        }
        if (_t6794._tag === 0 && _t6794._val === "float") {
          _t6795 = ({_tag: 1, _name: "TFloat"});
          break _t6796;
        }
        if (_t6794._tag === 0 && _t6794._val === "bool") {
          _t6795 = ({_tag: 2, _name: "TBool"});
          break _t6796;
        }
        if (_t6794._tag === 0 && _t6794._val === "string") {
          _t6795 = ({_tag: 3, _name: "TString"});
          break _t6796;
        }
        if (_t6794._tag === 0 && _t6794._val === "byte") {
          _t6795 = ({_tag: 4, _name: "TByte"});
          break _t6796;
        }
        if (_t6794._tag === 0 && _t6794._val === "rune") {
          _t6795 = ({_tag: 5, _name: "TRune"});
          break _t6796;
        }
        if (_t6794._tag === 0 && _t6794._val === "unit") {
          _t6795 = ({_tag: 6, _name: "TUnit"});
          break _t6796;
        }
        if (_t6794._tag === 0) {
          const name = _t6794._val;
          const canonical_6802 = Typechecker$resolve_type_alias(ctx.type_env, name);
          let _t6805;
          const _t6804 = Typechecker$find_variant_info(ctx.type_env, name);
          _t6806: {
            if (_t6804._tag === 1 && _t6804._val[1] === 0) {
              _t6805 = ({_tag: 12, _name: "TVariant", _val: [canonical_6802, null]});
              break _t6806;
            }
            if (_t6804._tag === 1) {
              const n = _t6804._val[1];
              _t6805 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
              break _t6806;
            }
            if (_t6804._tag === 0) {
              let _t6807;
              if (!_eq(List$assoc_opt(name, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                const fields_6808 = List$assoc(name, ctx.type_env.records);
                let _t6810;
                if (_eq(fields_6808, null)) {
                  _t6810 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                } else {
                  _t6810 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6808)});
                }
                const _t6809 = _t6810;
                _t6807 = _t6809;
              } else {
                _t6807 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
              }
              _t6805 = _t6807;
              break _t6806;
            }
            _match_fail("line 16190");
          }
          const _t6803 = _t6805;
          _t6795 = _t6803;
          break _t6796;
        }
        if (_t6794._tag === 2) {
          const a = _t6794._val[0];
          const b = _t6794._val[1];
          _t6795 = ({_tag: 7, _name: "TArrow", _val: [go(a), ({_tag: 1, _name: "EffEmpty"}), go(b)]});
          break _t6796;
        }
        if (_t6794._tag === 6) {
          const ts = _t6794._val;
          _t6795 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t6796;
        }
        if (_t6794._tag === 4) {
          const t = _t6794._val;
          _t6795 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t6796;
        }
        if (_t6794._tag === 5) {
          const t = _t6794._val;
          _t6795 = ({_tag: 14, _name: "TArray", _val: go(t)});
          break _t6796;
        }
        if (_t6794._tag === 8) {
          const k = _t6794._val[0];
          const v = _t6794._val[1];
          _t6795 = ({_tag: 13, _name: "TMap", _val: [go(k), go(v)]});
          break _t6796;
        }
        if (_t6794._tag === 7) {
          const args = _t6794._val[0];
          const name = _t6794._val[1];
          const canonical_6811 = Typechecker$resolve_type_alias(ctx.type_env, name);
          const arg_tys_6813 = List$map(go, args);
          let _t6816;
          const _t6815 = Typechecker$find_variant_info(ctx.type_env, name);
          _t6817: {
            if (_t6815._tag === 1) {
              const np = _t6815._val[1];
              let _t6818;
              if ((List$length(arg_tys_6813) !== np)) {
                _t6818 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6813))));
              } else {
                _t6818 = undefined;
              }
              _t6818;
              _t6816 = ({_tag: 12, _name: "TVariant", _val: [canonical_6811, arg_tys_6813]});
              break _t6817;
            }
            if (_t6815._tag === 0) {
              _t6816 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
              break _t6817;
            }
            _match_fail("line 16190");
          }
          const _t6814 = _t6816;
          const _t6812 = _t6814;
          _t6795 = _t6812;
          break _t6796;
        }
        if (_t6794._tag === 3) {
          const fields = _t6794._val[0];
          const is_open = _t6794._val[1];
          function _t6819(__p179) {
            let _t6821;
            const _t6820 = __p179;
            _t6822: {
              if (true) {
                const n = _t6820[0];
                const t = _t6820[1];
                _t6821 = [n, go(t)];
                break _t6822;
              }
              _match_fail("line 16190");
            }
            return _t6821;
          }
          const fields_6823 = List$map(_t6819, fields);
          function _t6825(__p180, __p181) {
            let _t6827;
            const _t6826 = __p180;
            _t6828: {
              if (true) {
                const a = _t6826[0];
                let _t6830;
                const _t6829 = __p181;
                _t6831: {
                  if (true) {
                    const b = _t6829[0];
                    _t6830 = String$compare(a, b);
                    break _t6831;
                  }
                  _match_fail("line 16190");
                }
                _t6827 = _t6830;
                break _t6828;
              }
              _match_fail("line 16190");
            }
            return _t6827;
          }
          const fields_6832 = List$sort(_t6825, fields_6823);
          let _t6834;
          if (is_open) {
            _t6834 = Types$new_rvar(0);
          } else {
            _t6834 = ({_tag: 2, _name: "REmpty"});
          }
          const tail_6835 = _t6834;
          function _t6837(__p182, acc) {
            let _t6839;
            const _t6838 = __p182;
            _t6840: {
              if (true) {
                const n = _t6838[0];
                const t = _t6838[1];
                _t6839 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                break _t6840;
              }
              _match_fail("line 16190");
            }
            return _t6839;
          }
          const _t6836 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6837, fields_6832, tail_6835)});
          const _t6833 = _t6836;
          const _t6824 = _t6833;
          _t6795 = _t6824;
          break _t6796;
        }
        if (_t6794._tag === 9) {
          const path = _t6794._val[0];
          const name = _t6794._val[1];
          const qualified_6841 = (String$concat(".", path) + ("." + name));
          const _t6843 = ({_tag: 0, _name: "TyName", _val: qualified_6841});
          __x = _t6843;
          continue;
          const _t6842 = undefined;
          _t6795 = _t6842;
          break _t6796;
        }
        if (_t6794._tag === 10) {
          const _kind = _t6794._val[0];
          const tags = _t6794._val[1];
          function _t6844(__p183, acc) {
            let _t6846;
            const _t6845 = __p183;
            _t6847: {
              if (true) {
                const tag = _t6845[0];
                const payload_annot = _t6845[1];
                _t6846 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload_annot), acc]});
                break _t6847;
              }
              _match_fail("line 16190");
            }
            return _t6846;
          }
          const row_6848 = List$fold_right(_t6844, tags, ({_tag: 2, _name: "PVEmpty"}));
          const _t6849 = ({_tag: 15, _name: "TPolyVariant", _val: row_6848});
          _t6795 = _t6849;
          break _t6796;
        }
        if (_t6794._tag === 11) {
          const ty = _t6794._val[0];
          const _t6850 = ty;
          __x = _t6850;
          continue;
          _t6795 = undefined;
          break _t6796;
        }
        _match_fail("line 16190");
      }
      return _t6795;
    }
  }
  const tys_6852 = List$map(go, annots);
  const _t6853 = [tys_6852, Ref$get(next_idx_6792), tvars_6790];
  const _t6851 = _t6853;
  const _t6793 = _t6851;
  const _t6791 = _t6793;
  return _t6791;
}
function Typechecker$process_instance_def(ctx, level, class_name, inst_ty_annots, constraints, methods) {
  const class_name_6854 = Typechecker$resolve_type_alias(ctx.type_env, class_name);
  function _t6856(c) {
    return (c.class_name === class_name_6854);
  }
  let _t6858;
  const _t6857 = List$find(_t6856, ctx.type_env.classes);
  _t6859: {
    if (_t6857._tag === 1) {
      const c = _t6857._val;
      _t6858 = c;
      break _t6859;
    }
    if (_t6857._tag === 0) {
      _t6858 = Typechecker$error(("unknown class: " + __dict_Show_string.show(class_name_6854)));
      break _t6859;
    }
    _match_fail("line 16190");
  }
  const class_def_6860 = _t6858;
  const num_class_params_6862 = List$length(class_def_6860.class_params);
  let _t6865;
  const _t6864 = Typechecker$resolve_inst_tys(ctx, inst_ty_annots);
  _t6866: {
    if (true) {
      const stored_tys = _t6864[0];
      const num_inst_vars = _t6864[1];
      const inst_tvars = _t6864[2];
      let _t6867;
      if ((List$length(stored_tys) !== num_class_params_6862)) {
        _t6867 = Typechecker$error(((((("class " + __dict_Show_string.show(class_name_6854)) + " expects ") + __dict_Show_int.show(num_class_params_6862)) + " type parameters, got ") + __dict_Show_int.show(List$length(stored_tys))));
      } else {
        _t6867 = undefined;
      }
      _t6867;
      const dname_6868 = _call(Types$dict_name, [__dict_Show_string, class_name_6854, stored_tys]);
      function _t6870(_) {
        return Types$new_tvar((level + 1));
      }
      const check_tvar_list_6871 = List$init(num_inst_vars, _t6870);
      function _t6873(t) {
        return Typechecker$subst_tgens(check_tvar_list_6871, t);
      }
      const check_tys_6874 = List$map(_t6873, stored_tys);
      function _t6876(i) {
        let _t6879;
        if ((i.inst_class === class_name_6854)) {
        let _t6878;
        if ((List$length(i.inst_tys) === List$length(stored_tys))) {
        function _t6877(t) {
          return ({_tag: 1, _name: "Some", _val: t});
        }
          _t6878 = Types$match_partial_inst(i.inst_tys, List$map(_t6877, stored_tys));
        } else {
          _t6878 = false;
        }
          _t6879 = _t6878;
        } else {
          _t6879 = false;
        }
        return _t6879;
      }
      let _t6880;
      if (List$exists(_t6876, ctx.type_env.instances)) {
        _t6880 = Typechecker$error(((("duplicate instance " + __dict_Show_string.show(class_name_6854)) + " for types ") + __dict_Show_string.show(String$concat(", ", List$map(Types$pp_ty, stored_tys)))));
      } else {
        _t6880 = undefined;
      }
      _t6880;
      function _t6881(__p184) {
        let _t6883;
        const _t6882 = __p184;
        _t6884: {
          if (true) {
            const mname = _t6882[0];
            function _t6885(__p185) {
              let _t6887;
              const _t6886 = __p185;
              _t6888: {
                if (true) {
                  const n = _t6886[0];
                  _t6887 = (n === mname);
                  break _t6888;
                }
                _match_fail("line 16190");
              }
              return _t6887;
            }
            let _t6889;
            if ((!List$exists(_t6885, methods))) {
              _t6889 = Typechecker$error(((((("instance " + __dict_Show_string.show(class_name_6854)) + " ") + __dict_Show_string.show(String$concat(" ", List$map(Types$pp_ty, stored_tys)))) + " missing method: ") + __dict_Show_string.show(mname)));
            } else {
              _t6889 = undefined;
            }
            _t6883 = _t6889;
            break _t6884;
          }
          _match_fail("line 16190");
        }
        return _t6883;
      }
      List$iter(_t6881, class_def_6860.class_methods);
      function _t6890(__p186) {
        let _t6892;
        const _t6891 = __p186;
        _t6893: {
          if (true) {
            const mname = _t6891[0];
            const params = _t6891[1];
            const body = _t6891[2];
            let _t6895;
            const _t6894 = List$assoc_opt(mname, class_def_6860.class_methods);
            _t6896: {
              if (_t6894._tag === 1) {
                const ty = _t6894._val;
                _t6895 = ty;
                break _t6896;
              }
              if (_t6894._tag === 0) {
                _t6895 = Typechecker$error(((__dict_Show_string.show(mname) + " is not a method of class ") + __dict_Show_string.show(class_name_6854)));
                break _t6896;
              }
              _match_fail("line 16190");
            }
            const method_schema_ty_6897 = _t6895;
            const concrete_method_ty_6899 = Typechecker$subst_tgens(check_tys_6874, method_schema_ty_6897);
            const max_tgen_6901 = Typechecker$max_tgen_in_ty(concrete_method_ty_6899);
            const max_effgen_6903 = Typechecker$max_effgen_in_ty(concrete_method_ty_6899);
            let _t6905;
            if ((max_tgen_6901 >= 0)) {
              _t6905 = (max_tgen_6901 + 1);
            } else {
              _t6905 = 0;
            }
            const quant_6906 = _t6905;
            let _t6908;
            if ((max_effgen_6903 >= 0)) {
              _t6908 = (max_effgen_6903 + 1);
            } else {
              _t6908 = 0;
            }
            const equant_6909 = _t6908;
            let _t6911;
            if (((quant_6906 > 0) || (equant_6909 > 0))) {
              _t6911 = Types$instantiate((level + 1), ({body: concrete_method_ty_6899, constraints: null, equant: equant_6909, pvquant: 0, quant: quant_6906, record_evidences: null, rquant: 0}));
            } else {
              _t6911 = concrete_method_ty_6899;
            }
            const concrete_method_ty_6912 = _t6911;
            const full_body_6914 = Typechecker$wrap_params_decl(params, ({_tag: 0, _name: "None"}), body);
            const te_6916 = Typechecker$check(ctx, (level + 1), full_body_6914, concrete_method_ty_6912);
            const _t6917 = [mname, te_6916];
            const _t6915 = _t6917;
            const _t6913 = _t6915;
            const _t6910 = _t6913;
            const _t6907 = _t6910;
            const _t6904 = _t6907;
            const _t6902 = _t6904;
            const _t6900 = _t6902;
            const _t6898 = _t6900;
            _t6892 = _t6898;
            break _t6893;
          }
          _match_fail("line 16190");
        }
        return _t6892;
      }
      const typed_methods_6918 = List$map(_t6890, methods);
      function _t6920(__p187, __p188) {
        let _t6922;
        const _t6921 = __p187;
        _t6923: {
          if (true) {
            const a = _t6921[0];
            let _t6925;
            const _t6924 = __p188;
            _t6926: {
              if (true) {
                const b = _t6924[0];
                _t6925 = String$compare(a, b);
                break _t6926;
              }
              _match_fail("line 16190");
            }
            _t6922 = _t6925;
            break _t6923;
          }
          _match_fail("line 16190");
        }
        return _t6922;
      }
      const sorted_methods_6927 = List$sort(_t6920, typed_methods_6918);
      function _t6929(__p189) {
        let _t6931;
        const _t6930 = __p189;
        _t6932: {
          if (true) {
            const n = _t6930[0];
            const te = _t6930[1];
            _t6931 = [n, te.ty];
            break _t6932;
          }
          _match_fail("line 16190");
        }
        return _t6931;
      }
      const record_ty_6933 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(List$map(_t6929, sorted_methods_6927))});
      const dict_expr_6935 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: sorted_methods_6927}), record_ty_6933);
      function _t6937(__p190) {
        let _t6939;
        const _t6938 = __p190;
        _t6940: {
          if (true) {
            const cclass = _t6938[0];
            const tyvar_names = _t6938[1];
            const cclass_6941 = Typechecker$resolve_type_alias(ctx.type_env, cclass);
            function _t6943(tvname) {
              let _t6945;
              const _t6944 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, inst_tvars, tvname]);
              _t6946: {
                if (_t6944._tag === 1) {
                  const idx = _t6944._val;
                  _t6945 = ({_tag: 0, _name: "CATGen", _val: idx});
                  break _t6946;
                }
                if (_t6944._tag === 0) {
                  _t6945 = Typechecker$error((("constraint type variable '" + __dict_Show_string.show(tvname)) + " not found in instance type parameters"));
                  break _t6946;
                }
                _match_fail("line 16190");
              }
              return _t6945;
            }
            const cc_args_6947 = List$map(_t6943, tyvar_names);
            const _t6948 = ({cc_args: cc_args_6947, cc_class: cclass_6941});
            const _t6942 = _t6948;
            _t6939 = _t6942;
            break _t6940;
          }
          _match_fail("line 16190");
        }
        return _t6939;
      }
      const inst_constraints_6949 = List$map(_t6937, constraints);
      const inst_def_6951 = ({inst_class: class_name_6854, inst_constraints: inst_constraints_6949, inst_dict_name: dname_6868, inst_tys: stored_tys});
      const _t6953 = (function() {
        const _t6954 = _h;
        _h = Object.assign({}, _t6954, {
          "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
        });
        try {
          const __x_6955 = Types$check_fundep_consistency(class_def_6860, inst_def_6951, ctx.type_env.instances);
          return __x_6955;
        } catch (_exc) {
          if (_exc && _exc._e === "unify_error") {
            const msg = _exc._v;
            return Typechecker$error(msg);
          } else { throw _exc; }
        } finally { _h = _t6954; }
      })();
      _t6953;
      const __rec_upd_6956 = ctx.type_env;
      const _t6957 = ({classes: __rec_upd_6956.classes, constructors: __rec_upd_6956.constructors, effects: __rec_upd_6956.effects, instances: ({_hd: inst_def_6951, _tl: ctx.type_env.instances}), modules: __rec_upd_6956.modules, mutable_fields: __rec_upd_6956.mutable_fields, records: __rec_upd_6956.records, type_aliases: __rec_upd_6956.type_aliases, type_synonyms: __rec_upd_6956.type_synonyms, variants: __rec_upd_6956.variants});
      const type_env_6958 = _t6957;
      const __rec_upd_6960 = ctx;
      const _t6961 = ({constraint_tvars: __rec_upd_6960.constraint_tvars, current_eff: __rec_upd_6960.current_eff, current_module: __rec_upd_6960.current_module, inside_handler: __rec_upd_6960.inside_handler, loop_info: __rec_upd_6960.loop_info, mutable_vars: __rec_upd_6960.mutable_vars, return_type: __rec_upd_6960.return_type, return_used: __rec_upd_6960.return_used, type_env: type_env_6958, vars: __rec_upd_6960.vars});
      const ctx_6962 = _t6961;
      const _t6963 = [ctx_6962, ({_tag: 0, _name: "TDLet", _val: [dname_6868, dict_expr_6935]})];
      const _t6959 = _t6963;
      const _t6952 = _t6959;
      const _t6950 = _t6952;
      const _t6936 = _t6950;
      const _t6934 = _t6936;
      const _t6928 = _t6934;
      const _t6919 = _t6928;
      const _t6875 = _t6919;
      const _t6872 = _t6875;
      const _t6869 = _t6872;
      _t6865 = _t6869;
      break _t6866;
    }
    _match_fail("line 16190");
  }
  const _t6863 = _t6865;
  const _t6861 = _t6863;
  const _t6855 = _t6861;
  return _t6855;
}
function Typechecker$extract_tyvar_ids(annot, ty) {
  let _t6965;
  const _t6964 = Hashtbl$create(4);
  _t6966: {
    if (true) {
      const mapping = _t6964;
      function walk(annot, ty) {
        while (true) {
          let _t6968;
          const _t6967 = [annot, Types$repr(ty)];
          _t6969: {
            if (_t6967[0]._tag === 1 && _t6967[1]._tag === 16 && _t6967[1]._val.contents._tag === 0) {
              const name = _t6967[0]._val;
              const id = _t6967[1]._val.contents._val[0];
              let _t6970;
              if ((!_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, mapping, name]))) {
                _t6970 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, mapping, name, id]);
              } else {
                _t6970 = undefined;
              }
              _t6968 = _t6970;
              break _t6969;
            }
            if (_t6967[0]._tag === 2 && (_t6967[1]._tag === 7 || _t6967[1]._tag === 8)) {
              const a1 = _t6967[0]._val[0];
              const a2 = _t6967[0]._val[1];
              const t1 = _t6967[1]._val[0];
              const t2 = _t6967[1]._val[2];
              walk(a1, t1);
              const _t6971 = a2;
              const _t6972 = t2;
              annot = _t6971;
              ty = _t6972;
              continue;
              _t6968 = undefined;
              break _t6969;
            }
            if (_t6967[0]._tag === 6 && _t6967[1]._tag === 9) {
              const anns = _t6967[0]._val;
              const tys = _t6967[1]._val;
              if ((List$length(anns) === List$length(tys))) {
                _t6968 = List$iter2(walk, anns, tys);
                break _t6969;
              }
            }
            if (_t6967[0]._tag === 4 && _t6967[1]._tag === 10) {
              const a = _t6967[0]._val;
              const t = _t6967[1]._val;
              const _t6973 = a;
              const _t6974 = t;
              annot = _t6973;
              ty = _t6974;
              continue;
              _t6968 = undefined;
              break _t6969;
            }
            if (_t6967[0]._tag === 5 && _t6967[1]._tag === 14) {
              const a = _t6967[0]._val;
              const t = _t6967[1]._val;
              const _t6975 = a;
              const _t6976 = t;
              annot = _t6975;
              ty = _t6976;
              continue;
              _t6968 = undefined;
              break _t6969;
            }
            if (_t6967[0]._tag === 8 && _t6967[1]._tag === 13) {
              const k1 = _t6967[0]._val[0];
              const v1 = _t6967[0]._val[1];
              const k2 = _t6967[1]._val[0];
              const v2 = _t6967[1]._val[1];
              walk(k1, k2);
              const _t6977 = v1;
              const _t6978 = v2;
              annot = _t6977;
              ty = _t6978;
              continue;
              _t6968 = undefined;
              break _t6969;
            }
            if (_t6967[0]._tag === 7 && _t6967[1]._tag === 12) {
              const args = _t6967[0]._val[0];
              const tys = _t6967[1]._val[1];
              if ((List$length(args) === List$length(tys))) {
                _t6968 = List$iter2(walk, args, tys);
                break _t6969;
              }
            }
            if (_t6967[0]._tag === 11) {
              const a = _t6967[0]._val[0];
              const _t6979 = a;
              const _t6980 = ty;
              annot = _t6979;
              ty = _t6980;
              continue;
              _t6968 = undefined;
              break _t6969;
            }
            if (true) {
              _t6968 = undefined;
              break _t6969;
            }
            _match_fail("line 16190");
          }
          return _t6968;
        }
      }
      walk(annot, ty);
      const _t6981 = mapping;
      _t6965 = _t6981;
      break _t6966;
    }
    _match_fail("line 16190");
  }
  return _t6965;
}
function Typechecker$resolve_let_constraints(type_env, level, constraints, params, ret_annot, te_ty, shared_tvars) {
  let _t6982;
  if (_eq(constraints, null)) {
    _t6982 = Types$generalize(level, te_ty);
  } else {
    let _t6984;
    const _t6983 = Hashtbl$create(4);
    _t6985: {
      if (true) {
        const name_to_tvar = _t6983;
        function _t6986(tbl) {
          function _t6987(k, v) {
            let _t6988;
            if ((!_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, name_to_tvar, k]))) {
              _t6988 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, name_to_tvar, k, v]);
            } else {
              _t6988 = undefined;
            }
            return _t6988;
          }
          return Hashtbl$iter(_t6987, tbl);
        }
        const merge_into_6989 = _t6986;
        function walk_params(params, ty) {
          while (true) {
            let _t6992;
            const _t6991 = [params, Types$repr(ty)];
            _t6993: {
              if (_t6991[0] !== null && (_t6991[1]._tag === 7 || _t6991[1]._tag === 8)) {
                const p = _t6991[0]._hd;
                const rest = _t6991[0]._tl;
                const param_ty = _t6991[1]._val[0];
                const ret_ty = _t6991[1]._val[2];
                let _t6995;
                const _t6994 = p.annot;
                _t6996: {
                  if (_t6994._tag === 1) {
                    const annot = _t6994._val;
                    _t6995 = merge_into_6989(Typechecker$extract_tyvar_ids(annot, param_ty));
                    break _t6996;
                  }
                  if (_t6994._tag === 0) {
                    _t6995 = undefined;
                    break _t6996;
                  }
                  _match_fail("line 16190");
                }
                _t6995;
                const _t6997 = rest;
                const _t6998 = ret_ty;
                params = _t6997;
                ty = _t6998;
                continue;
                _t6992 = undefined;
                break _t6993;
              }
              if (true) {
                _t6992 = undefined;
                break _t6993;
              }
              _match_fail("line 16190");
            }
            return _t6992;
          }
        }
        walk_params(params, te_ty);
        let _t7001;
        const _t7000 = ret_annot;
        _t7002: {
          if (_t7000._tag === 1) {
            const annot = _t7000._val;
            function skip_arrows(ty, n) {
              while (true) {
                let _t7003;
                if ((n === 0)) {
                  _t7003 = ty;
                } else {
                  let _t7005;
                  const _t7004 = Types$repr(ty);
                  _t7006: {
                    if ((_t7004._tag === 7 || _t7004._tag === 8)) {
                      const rest = _t7004._val[2];
                      const _t7007 = rest;
                      const _t7008 = (n - 1);
                      ty = _t7007;
                      n = _t7008;
                      continue;
                      _t7005 = undefined;
                      break _t7006;
                    }
                    if (true) {
                      _t7005 = ty;
                      break _t7006;
                    }
                    _match_fail("line 16190");
                  }
                  _t7003 = _t7005;
                }
                return _t7003;
              }
            }
            const ret_ty_7010 = skip_arrows(te_ty, List$length(params));
            const _t7011 = merge_into_6989(Typechecker$extract_tyvar_ids(annot, ret_ty_7010));
            const _t7009 = _t7011;
            _t7001 = _t7009;
            break _t7002;
          }
          if (_t7000._tag === 0) {
            _t7001 = undefined;
            break _t7002;
          }
          _match_fail("line 16190");
        }
        _t7001;
        let _t7013;
        const _t7012 = Types$generalize_with_map(level, te_ty);
        _t7014: {
          if (true) {
            const scheme = _t7012[0];
            const id_map = _t7012[1];
            const phantom_counter_7015 = Ref$create(scheme.quant);
            const phantom_map_7017 = Hashtbl$create(4);
            function _t7019(__p191) {
              let _t7021;
              const _t7020 = __p191;
              _t7022: {
                if (true) {
                  const cclass = _t7020[0];
                  const tyvar_names = _t7020[1];
                  const cclass_7023 = Typechecker$resolve_type_alias(type_env, cclass);
                  function _t7025(tvname) {
                    let _t7027;
                    const _t7026 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, name_to_tvar, tvname]);
                    _t7028: {
                      if (_t7026._tag === 1) {
                        const tvar_id = _t7026._val;
                        let _t7030;
                        const _t7029 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, tvar_id]);
                        _t7031: {
                          if (_t7029._tag === 1 && _t7029._val._tag === 17) {
                            const idx = _t7029._val._val;
                            _t7030 = ({_tag: 0, _name: "CATGen", _val: idx});
                            break _t7031;
                          }
                          if (true) {
                            _t7030 = Typechecker$error((("constraint type variable '" + __dict_Show_string.show(tvname)) + " is not polymorphic"));
                            break _t7031;
                          }
                          _match_fail("line 16190");
                        }
                        _t7027 = _t7030;
                        break _t7028;
                      }
                      if (_t7026._tag === 0) {
                        let _t7033;
                        const _t7032 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, shared_tvars, tvname]);
                        _t7034: {
                          if (_t7032._tag === 1) {
                            const tv = _t7032._val;
                            let _t7036;
                            const _t7035 = Types$repr(tv);
                            _t7037: {
                              if (_t7035._tag === 16 && _t7035._val.contents._tag === 0) {
                                const id = _t7035._val.contents._val[0];
                                _t7036 = ({_tag: 1, _name: "Some", _val: id});
                                break _t7037;
                              }
                              if (true) {
                                _t7036 = ({_tag: 0, _name: "None"});
                                break _t7037;
                              }
                              _match_fail("line 16190");
                            }
                            const tv_id_7038 = _t7036;
                            let _t7041;
                            const _t7040 = tv_id_7038;
                            _t7042: {
                              if (_t7040._tag === 1) {
                                const id = _t7040._val;
                                _t7041 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, id]);
                                break _t7042;
                              }
                              if (_t7040._tag === 0) {
                                _t7041 = ({_tag: 0, _name: "None"});
                                break _t7042;
                              }
                              _match_fail("line 16190");
                            }
                            const tgen_from_map_7043 = _t7041;
                            let _t7046;
                            const _t7045 = tgen_from_map_7043;
                            _t7047: {
                              if (_t7045._tag === 1 && _t7045._val._tag === 17) {
                                const idx = _t7045._val._val;
                                _t7046 = ({_tag: 0, _name: "CATGen", _val: idx});
                                break _t7047;
                              }
                              if (true) {
                                let _t7049;
                                const _t7048 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, phantom_map_7017, tvname]);
                                _t7050: {
                                  if (_t7048._tag === 1) {
                                    const idx = _t7048._val;
                                    _t7049 = idx;
                                    break _t7050;
                                  }
                                  if (_t7048._tag === 0) {
                                    const idx_7051 = Ref$get(phantom_counter_7015);
                                    Ref$set(phantom_counter_7015, (Ref$get(phantom_counter_7015) + 1));
                                    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, phantom_map_7017, tvname, idx_7051]);
                                    const _t7052 = idx_7051;
                                    _t7049 = _t7052;
                                    break _t7050;
                                  }
                                  _match_fail("line 16190");
                                }
                                const idx_7053 = _t7049;
                                const _t7054 = ({_tag: 3, _name: "CAPhantom", _val: [idx_7053, tv]});
                                _t7046 = _t7054;
                                break _t7047;
                              }
                              _match_fail("line 16190");
                            }
                            const _t7044 = _t7046;
                            const _t7039 = _t7044;
                            _t7033 = _t7039;
                            break _t7034;
                          }
                          if (_t7032._tag === 0) {
                            _t7033 = Typechecker$error((("constraint type variable '" + __dict_Show_string.show(tvname)) + " not found in function signature"));
                            break _t7034;
                          }
                          _match_fail("line 16190");
                        }
                        _t7027 = _t7033;
                        break _t7028;
                      }
                      _match_fail("line 16190");
                    }
                    return _t7027;
                  }
                  const cc_args_7055 = List$map(_t7025, tyvar_names);
                  const _t7056 = ({cc_args: cc_args_7055, cc_class: cclass_7023});
                  const _t7024 = _t7056;
                  _t7021 = _t7024;
                  break _t7022;
                }
                _match_fail("line 16190");
              }
              return _t7021;
            }
            const cc_list_7057 = List$map(_t7019, constraints);
            const __rec_upd_7059 = scheme;
            const _t7060 = ({body: __rec_upd_7059.body, constraints: cc_list_7057, equant: __rec_upd_7059.equant, pvquant: __rec_upd_7059.pvquant, quant: __rec_upd_7059.quant, record_evidences: __rec_upd_7059.record_evidences, rquant: __rec_upd_7059.rquant});
            const _t7058 = _t7060;
            const _t7018 = _t7058;
            const _t7016 = _t7018;
            _t7013 = _t7016;
            break _t7014;
          }
          _match_fail("line 16190");
        }
        const _t6999 = _t7013;
        const _t6990 = _t6999;
        _t6984 = _t6990;
        break _t6985;
      }
      _match_fail("line 16190");
    }
    _t6982 = _t6984;
  }
  return _t6982;
}
function Typechecker$unify_constraint_tvars(__dict_Hash_0, __dict_Eq_0, type_env, constraints, shared_tvars, body_te) {
  const classes_7061 = type_env.classes;
  function walk(te) {
    let _t7064;
    const _t7063 = te.expr;
    _t7065: {
      if (_t7063._tag === 7) {
        const name = _t7063._val;
        let _t7067;
        const _t7066 = Types$find_method_class(classes_7061, name);
        _t7068: {
          if (_t7066._tag === 1) {
            const r = _t7066;
            _t7067 = r;
            break _t7068;
          }
          if (_t7066._tag === 0) {
            let _t7070;
            const _t7069 = String$rindex_opt(name, 46);
            _t7071: {
              if (_t7069._tag === 0) {
                _t7070 = ({_tag: 0, _name: "None"});
                break _t7071;
              }
              if (_t7069._tag === 1) {
                const i = _t7069._val;
                const _mml$short_7072 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                const _t7073 = Types$find_method_class(classes_7061, _mml$short_7072);
                _t7070 = _t7073;
                break _t7071;
              }
              _match_fail("line 16190");
            }
            _t7067 = _t7070;
            break _t7068;
          }
          _match_fail("line 16190");
        }
        const class_opt_7074 = _t7067;
        let _t7077;
        const _t7076 = class_opt_7074;
        _t7078: {
          if (_t7076._tag === 1) {
            const class_def = _t7076._val;
            let _t7080;
            const _t7079 = String$rindex_opt(name, 46);
            _t7081: {
              if (_t7079._tag === 1) {
                const i = _t7079._val;
                _t7080 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                break _t7081;
              }
              if (_t7079._tag === 0) {
                _t7080 = name;
                break _t7081;
              }
              _match_fail("line 16190");
            }
            const method_name_7082 = _t7080;
            let _t7085;
            const _t7084 = List$assoc_opt(method_name_7082, class_def.class_methods);
            _t7086: {
              if (_t7084._tag === 1) {
                const method_schema_ty = _t7084._val;
                const num_params_7087 = List$length(class_def.class_params);
                const param_map_7089 = Hashtbl$create(num_params_7087);
                function go(s, r) {
                  while (true) {
                    const r_7091 = Types$repr(r);
                    let _t7094;
                    const _t7093 = [s, r_7091];
                    _t7095: {
                      if (_t7093[0]._tag === 17) {
                        const i = _t7093[0]._val;
                        if ((i < num_params_7087)) {
                          let _t7096;
                          if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, param_map_7089, i]))) {
                            _t7096 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, param_map_7089, i, r_7091]);
                          } else {
                            _t7096 = undefined;
                          }
                          _t7094 = _t7096;
                          break _t7095;
                        }
                      }
                      if ((_t7093[0]._tag === 7 && _t7093[1]._tag === 7 || _t7093[0]._tag === 8 && _t7093[1]._tag === 8)) {
                        const s1 = _t7093[0]._val[0];
                        const s2 = _t7093[0]._val[2];
                        const r1 = _t7093[1]._val[0];
                        const r2 = _t7093[1]._val[2];
                        go(s1, r1);
                        const _t7097 = s2;
                        const _t7098 = r2;
                        s = _t7097;
                        r = _t7098;
                        continue;
                        _t7094 = undefined;
                        break _t7095;
                      }
                      if (_t7093[0]._tag === 9 && _t7093[1]._tag === 9) {
                        const ss = _t7093[0]._val;
                        const rs = _t7093[1]._val;
                        if ((List$length(ss) === List$length(rs))) {
                          _t7094 = List$iter2(go, ss, rs);
                          break _t7095;
                        }
                      }
                      if (_t7093[0]._tag === 10 && _t7093[1]._tag === 10) {
                        const s1 = _t7093[0]._val;
                        const r1 = _t7093[1]._val;
                        const _t7099 = s1;
                        const _t7100 = r1;
                        s = _t7099;
                        r = _t7100;
                        continue;
                        _t7094 = undefined;
                        break _t7095;
                      }
                      if (_t7093[0]._tag === 14 && _t7093[1]._tag === 14) {
                        const s1 = _t7093[0]._val;
                        const r1 = _t7093[1]._val;
                        const _t7101 = s1;
                        const _t7102 = r1;
                        s = _t7101;
                        r = _t7102;
                        continue;
                        _t7094 = undefined;
                        break _t7095;
                      }
                      if (_t7093[0]._tag === 13 && _t7093[1]._tag === 13) {
                        const sk = _t7093[0]._val[0];
                        const sv = _t7093[0]._val[1];
                        const rk = _t7093[1]._val[0];
                        const rv = _t7093[1]._val[1];
                        go(sk, rk);
                        const _t7103 = sv;
                        const _t7104 = rv;
                        s = _t7103;
                        r = _t7104;
                        continue;
                        _t7094 = undefined;
                        break _t7095;
                      }
                      if (_t7093[0]._tag === 12 && _t7093[1]._tag === 12) {
                        const ss = _t7093[0]._val[1];
                        const rs = _t7093[1]._val[1];
                        if ((List$length(ss) === List$length(rs))) {
                          _t7094 = List$iter2(go, ss, rs);
                          break _t7095;
                        }
                      }
                      if (true) {
                        _t7094 = undefined;
                        break _t7095;
                      }
                      _match_fail("line 16190");
                    }
                    const _t7092 = _t7094;
                    return _t7092;
                  }
                }
                go(method_schema_ty, te.ty);
                function _t7106(__p192) {
                  let _t7108;
                  const _t7107 = __p192;
                  _t7109: {
                    if (true) {
                      const cclass = _t7107[0];
                      const tyvar_names = _t7107[1];
                      let _t7110;
                      if (((cclass === class_def.class_name) && (List$length(tyvar_names) === num_params_7087))) {
                        function _t7111(fd) {
                          function _t7112(fi) {
                            let _t7114;
                            const _t7113 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, param_map_7089, fi]);
                            _t7115: {
                              if (_t7113._tag === 1) {
                                const body_tv = _t7113._val;
                                const tvname_7116 = List$nth(tyvar_names, fi);
                                let _t7119;
                                const _t7118 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, shared_tvars, tvname_7116]);
                                _t7120: {
                                  if (_t7118._tag === 1) {
                                    const constraint_tv = _t7118._val;
                                    _t7119 = _eq(Types$repr(body_tv), Types$repr(constraint_tv));
                                    break _t7120;
                                  }
                                  if (_t7118._tag === 0) {
                                    _t7119 = true;
                                    break _t7120;
                                  }
                                  _match_fail("line 16190");
                                }
                                const _t7117 = _t7119;
                                _t7114 = _t7117;
                                break _t7115;
                              }
                              if (_t7113._tag === 0) {
                                _t7114 = true;
                                break _t7115;
                              }
                              _match_fail("line 16190");
                            }
                            return _t7114;
                          }
                          return List$forall(_t7112, fd.fd_from);
                        }
                        const from_match_7121 = List$forall(_t7111, class_def.class_fundeps);
                        let _t7123;
                        if (from_match_7121) {
                          function _t7124(fd) {
                            function _t7125(ti) {
                              let _t7127;
                              const _t7126 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, param_map_7089, ti]);
                              _t7128: {
                                if (_t7126._tag === 1) {
                                  const body_tv = _t7126._val;
                                  const tvname_7129 = List$nth(tyvar_names, ti);
                                  let _t7132;
                                  const _t7131 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, shared_tvars, tvname_7129]);
                                  _t7133: {
                                    if (_t7131._tag === 1) {
                                      const constraint_tv = _t7131._val;
                                      _t7132 = Types$unify(body_tv, constraint_tv);
                                      break _t7133;
                                    }
                                    if (_t7131._tag === 0) {
                                      _t7132 = undefined;
                                      break _t7133;
                                    }
                                    _match_fail("line 16190");
                                  }
                                  const _t7130 = _t7132;
                                  _t7127 = _t7130;
                                  break _t7128;
                                }
                                if (_t7126._tag === 0) {
                                  _t7127 = undefined;
                                  break _t7128;
                                }
                                _match_fail("line 16190");
                              }
                              return _t7127;
                            }
                            return List$iter(_t7125, fd.fd_to);
                          }
                          _t7123 = List$iter(_t7124, class_def.class_fundeps);
                        } else {
                          _t7123 = undefined;
                        }
                        const _t7122 = _t7123;
                        _t7110 = _t7122;
                      } else {
                        _t7110 = undefined;
                      }
                      _t7108 = _t7110;
                      break _t7109;
                    }
                    _match_fail("line 16190");
                  }
                  return _t7108;
                }
                const _t7105 = List$iter(_t7106, constraints);
                const _t7090 = _t7105;
                const _t7088 = _t7090;
                _t7085 = _t7088;
                break _t7086;
              }
              if (_t7084._tag === 0) {
                _t7085 = undefined;
                break _t7086;
              }
              _match_fail("line 16190");
            }
            const _t7083 = _t7085;
            _t7077 = _t7083;
            break _t7078;
          }
          if (_t7076._tag === 0) {
            _t7077 = undefined;
            break _t7078;
          }
          _match_fail("line 16190");
        }
        const _t7075 = _t7077;
        _t7064 = _t7075;
        break _t7065;
      }
      if (_t7063._tag === 11) {
        const f = _t7063._val[0];
        const x = _t7063._val[1];
        walk(f);
        _t7064 = walk(x);
        break _t7065;
      }
      if (_t7063._tag === 10) {
        const body = _t7063._val[1];
        _t7064 = walk(body);
        break _t7065;
      }
      if (_t7063._tag === 8) {
        const e1 = _t7063._val[2];
        const e2 = _t7063._val[3];
        walk(e1);
        _t7064 = walk(e2);
        break _t7065;
      }
      if (_t7063._tag === 9) {
        const e1 = _t7063._val[2];
        const e2 = _t7063._val[3];
        walk(e1);
        _t7064 = walk(e2);
        break _t7065;
      }
      if (_t7063._tag === 12) {
        const c = _t7063._val[0];
        const t = _t7063._val[1];
        const e = _t7063._val[2];
        walk(c);
        walk(t);
        _t7064 = walk(e);
        break _t7065;
      }
      if (_t7063._tag === 13) {
        const a = _t7063._val[1];
        const b = _t7063._val[2];
        walk(a);
        _t7064 = walk(b);
        break _t7065;
      }
      if (_t7063._tag === 14) {
        const a = _t7063._val[1];
        _t7064 = walk(a);
        break _t7065;
      }
      if (_t7063._tag === 15) {
        const es = _t7063._val;
        _t7064 = List$iter(walk, es);
        break _t7065;
      }
      if (_t7063._tag === 16) {
        const fields = _t7063._val;
        function _t7134(__p193) {
          let _t7136;
          const _t7135 = __p193;
          _t7137: {
            if (true) {
              const e = _t7135[1];
              _t7136 = walk(e);
              break _t7137;
            }
            _match_fail("line 16190");
          }
          return _t7136;
        }
        _t7064 = List$iter(_t7134, fields);
        break _t7065;
      }
      if (_t7063._tag === 17) {
        const e = _t7063._val[0];
        const fields = _t7063._val[1];
        walk(e);
        function _t7138(__p194) {
          let _t7140;
          const _t7139 = __p194;
          _t7141: {
            if (true) {
              const e = _t7139[1];
              _t7140 = walk(e);
              break _t7141;
            }
            _match_fail("line 16190");
          }
          return _t7140;
        }
        _t7064 = List$iter(_t7138, fields);
        break _t7065;
      }
      if (_t7063._tag === 18) {
        const e = _t7063._val[0];
        const pairs = _t7063._val[1];
        walk(e);
        function _t7142(__p195) {
          let _t7144;
          const _t7143 = __p195;
          _t7145: {
            if (true) {
              const i = _t7143[0];
              const v = _t7143[1];
              walk(i);
              _t7144 = walk(v);
              break _t7145;
            }
            _match_fail("line 16190");
          }
          return _t7144;
        }
        _t7064 = List$iter(_t7142, pairs);
        break _t7065;
      }
      if (_t7063._tag === 19) {
        const e = _t7063._val[0];
        _t7064 = walk(e);
        break _t7065;
      }
      if (_t7063._tag === 20) {
        const e1 = _t7063._val[0];
        const e2 = _t7063._val[1];
        walk(e1);
        _t7064 = walk(e2);
        break _t7065;
      }
      if (_t7063._tag === 21) {
        const hd = _t7063._val[0];
        const tl = _t7063._val[1];
        walk(hd);
        _t7064 = walk(tl);
        break _t7065;
      }
      if (_t7063._tag === 24) {
        const scrut = _t7063._val[0];
        const branches = _t7063._val[1];
        walk(scrut);
        function _t7146(__p196) {
          let _t7148;
          const _t7147 = __p196;
          _t7149: {
            if (true) {
              const guard = _t7147[1];
              const body = _t7147[2];
              let _t7151;
              const _t7150 = guard;
              _t7152: {
                if (_t7150._tag === 1) {
                  const g = _t7150._val;
                  _t7151 = walk(g);
                  break _t7152;
                }
                if (_t7150._tag === 0) {
                  _t7151 = undefined;
                  break _t7152;
                }
                _match_fail("line 16190");
              }
              _t7151;
              _t7148 = walk(body);
              break _t7149;
            }
            _match_fail("line 16190");
          }
          return _t7148;
        }
        _t7064 = List$iter(_t7146, branches);
        break _t7065;
      }
      if (_t7063._tag === 28) {
        const e1 = _t7063._val[0];
        const e2 = _t7063._val[1];
        walk(e1);
        _t7064 = walk(e2);
        break _t7065;
      }
      if (_t7063._tag === 25) {
        const e1 = _t7063._val[1];
        const e2 = _t7063._val[2];
        walk(e1);
        _t7064 = walk(e2);
        break _t7065;
      }
      if (_t7063._tag === 26) {
        const e = _t7063._val[1];
        _t7064 = walk(e);
        break _t7065;
      }
      if (_t7063._tag === 27) {
        const e1 = _t7063._val[0];
        const e2 = _t7063._val[2];
        walk(e1);
        _t7064 = walk(e2);
        break _t7065;
      }
      if (_t7063._tag === 23 && _t7063._val[1]._tag === 1) {
        const e = _t7063._val[1]._val;
        _t7064 = walk(e);
        break _t7065;
      }
      if (_t7063._tag === 29) {
        const e = _t7063._val[1];
        _t7064 = walk(e);
        break _t7065;
      }
      if (_t7063._tag === 30) {
        const body = _t7063._val[0];
        _t7064 = walk(body);
        break _t7065;
      }
      if (_t7063._tag === 31) {
        const e1 = _t7063._val[0];
        const e2 = _t7063._val[1];
        walk(e1);
        _t7064 = walk(e2);
        break _t7065;
      }
      if (_t7063._tag === 32) {
        const cond = _t7063._val[0];
        const body = _t7063._val[1];
        walk(cond);
        _t7064 = walk(body);
        break _t7065;
      }
      if (_t7063._tag === 36) {
        const body = _t7063._val;
        _t7064 = walk(body);
        break _t7065;
      }
      if (_t7063._tag === 38) {
        const kvs = _t7063._val;
        function _t7153(__p197) {
          let _t7155;
          const _t7154 = __p197;
          _t7156: {
            if (true) {
              const k = _t7154[0];
              const v = _t7154[1];
              walk(k);
              _t7155 = walk(v);
              break _t7156;
            }
            _match_fail("line 16190");
          }
          return _t7155;
        }
        _t7064 = List$iter(_t7153, kvs);
        break _t7065;
      }
      if (_t7063._tag === 39) {
        const es = _t7063._val;
        _t7064 = List$iter(walk, es);
        break _t7065;
      }
      if (_t7063._tag === 40) {
        const e = _t7063._val;
        _t7064 = walk(e);
        break _t7065;
      }
      if (_t7063._tag === 33) {
        const e = _t7063._val;
        _t7064 = walk(e);
        break _t7065;
      }
      if (_t7063._tag === 35) {
        const e = _t7063._val;
        _t7064 = walk(e);
        break _t7065;
      }
      if (_t7063._tag === 37) {
        const bindings = _t7063._val[0];
        const body = _t7063._val[1];
        function _t7157(__p198) {
          let _t7159;
          const _t7158 = __p198;
          _t7160: {
            if (true) {
              const e = _t7158[1];
              _t7159 = walk(e);
              break _t7160;
            }
            _match_fail("line 16190");
          }
          return _t7159;
        }
        List$iter(_t7157, bindings);
        _t7064 = walk(body);
        break _t7065;
      }
      if (true) {
        _t7064 = undefined;
        break _t7065;
      }
      _match_fail("line 16190");
    }
    return _t7064;
  }
  const _t7161 = walk(body_te);
  const _t7062 = _t7161;
  return _t7062;
}
function Typechecker$synth_constrained_fn(ctx, level, constraints, params, ret_annot, body) {
  const shared_tvars_7162 = Hashtbl$create(4);
  function _t7164(__p199) {
    let _t7166;
    const _t7165 = __p199;
    _t7167: {
      if (true) {
        const names = _t7165[1];
        _t7166 = names;
        break _t7167;
      }
      _match_fail("line 16190");
    }
    return _t7166;
  }
  const constraint_tyvar_names_7168 = _call(_call(List$sort_uniq, [String$compare]), [List$flatten(List$map(_t7164, constraints))]);
  function _t7170(tvname) {
    return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_7162, tvname, Types$new_tvar((level + 1))]);
  }
  List$iter(_t7170, constraint_tyvar_names_7168);
  function _t7171(tvname) {
    let _t7173;
    const _t7172 = Types$repr(_call(Hashtbl$find, [__dict_Hash_string, __dict_Eq_string, shared_tvars_7162, tvname]));
    _t7174: {
      if (_t7172._tag === 16 && _t7172._val.contents._tag === 0) {
        const id = _t7172._val.contents._val[0];
        _t7173 = ({_tag: 1, _name: "Some", _val: id});
        break _t7174;
      }
      if (true) {
        _t7173 = ({_tag: 0, _name: "None"});
        break _t7174;
      }
      _match_fail("line 16190");
    }
    return _t7173;
  }
  const constraint_tvar_ids_7175 = List$filter_map(_t7171, constraint_tyvar_names_7168);
  function _t7177(p) {
    let _t7179;
    const _t7178 = p.annot;
    _t7180: {
      if (_t7178._tag === 1) {
        const annot = _t7178._val;
        _t7179 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_7162, annot);
        break _t7180;
      }
      if (_t7178._tag === 0) {
        _t7179 = Types$new_tvar((level + 1));
        break _t7180;
      }
      _match_fail("line 16190");
    }
    return _t7179;
  }
  const param_tys_7181 = List$map(_t7177, params);
  let _t7184;
  const _t7183 = ret_annot;
  _t7185: {
    if (_t7183._tag === 1) {
      const annot = _t7183._val;
      _t7184 = ({_tag: 1, _name: "Some", _val: Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_7162, annot)});
      break _t7185;
    }
    if (_t7183._tag === 0) {
      _t7184 = ({_tag: 0, _name: "None"});
      break _t7185;
    }
    _match_fail("line 16190");
  }
  const ret_ty_opt_7186 = _t7184;
  const body_eff_7188 = Types$new_effvar((level + 1));
  function _t7190(c, p, ty) {
    return Typechecker$extend_var_mono(c, p.name, ty);
  }
  const __rec_upd_7191 = ctx;
  const _t7192 = ({constraint_tvars: List$concat(constraint_tvar_ids_7175, ctx.constraint_tvars), current_eff: body_eff_7188, current_module: __rec_upd_7191.current_module, inside_handler: __rec_upd_7191.inside_handler, loop_info: __rec_upd_7191.loop_info, mutable_vars: __rec_upd_7191.mutable_vars, return_type: __rec_upd_7191.return_type, return_used: __rec_upd_7191.return_used, type_env: __rec_upd_7191.type_env, vars: __rec_upd_7191.vars});
  const inner_ctx_7193 = List$fold2(_t7190, _t7192, params, param_tys_7181);
  let _t7196;
  const _t7195 = ret_ty_opt_7186;
  _t7197: {
    if (_t7195._tag === 1) {
      const ret_ty = _t7195._val;
      _t7196 = Typechecker$check(inner_ctx_7193, (level + 1), body, ret_ty);
      break _t7197;
    }
    if (_t7195._tag === 0) {
      _t7196 = Typechecker$synth(inner_ctx_7193, (level + 1), body);
      break _t7197;
    }
    _match_fail("line 16190");
  }
  const body_te_7198 = _t7196;
  _call(Typechecker$unify_constraint_tvars, [__dict_Hash_string, __dict_Eq_string, ctx.type_env, constraints, shared_tvars_7162, body_te_7198]);
  let _t7201;
  const _t7200 = [List$rev(params), List$rev(param_tys_7181)];
  _t7202: {
    if (_t7200[0] === null && _t7200[1] === null) {
      _t7201 = body_te_7198;
      break _t7202;
    }
    if (_t7200[0] !== null && _t7200[1] !== null) {
      const last_p = _t7200[0]._hd;
      const rest_ps = _t7200[0]._tl;
      const last_pty = _t7200[1]._hd;
      const rest_ptys = _t7200[1]._tl;
      const inner_7203 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_7198, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff_7188, body_te_7198.ty]}));
      function _t7205(acc, p, pty) {
        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
      }
      const _t7204 = List$fold2(_t7205, inner_7203, rest_ps, rest_ptys);
      _t7201 = _t7204;
      break _t7202;
    }
    if (true) {
      _t7201 = failwith("assert false");
      break _t7202;
    }
    _match_fail("line 16190");
  }
  const te_7206 = _t7201;
  const scheme_7208 = Typechecker$resolve_let_constraints(ctx.type_env, level, constraints, params, ret_annot, te_7206.ty, shared_tvars_7162);
  const _t7209 = [te_7206, scheme_7208];
  const _t7207 = _t7209;
  const _t7199 = _t7207;
  const _t7194 = _t7199;
  const _t7189 = _t7194;
  const _t7187 = _t7189;
  const _t7182 = _t7187;
  const _t7176 = _t7182;
  const _t7169 = _t7176;
  const _t7163 = _t7169;
  return _t7163;
}
function Typechecker$find_module_in_env(type_env, mod_name) {
  let _t7211;
  const _t7210 = String$split(".", mod_name);
  _t7212: {
    if (_t7210 === null) {
      _t7211 = ({_tag: 0, _name: "None"});
      break _t7212;
    }
    if (_t7210 !== null && _t7210._tl === null) {
      const name = _t7210._hd;
      _t7211 = List$assoc_opt(name, type_env.modules);
      break _t7212;
    }
    if (_t7210 !== null) {
      const first = _t7210._hd;
      const rest = _t7210._tl;
      let _t7214;
      const _t7213 = List$assoc_opt(first, type_env.modules);
      _t7215: {
        if (_t7213._tag === 0) {
          _t7214 = ({_tag: 0, _name: "None"});
          break _t7215;
        }
        if (_t7213._tag === 1) {
          const minfo = _t7213._val;
          function drill(mi, __x) {
            while (true) {
              let _t7217;
              const _t7216 = __x;
              _t7218: {
                if (_t7216 === null) {
                  _t7217 = ({_tag: 1, _name: "Some", _val: mi});
                  break _t7218;
                }
                if (_t7216 !== null) {
                  const seg = _t7216._hd;
                  const rest = _t7216._tl;
                  let _t7220;
                  const _t7219 = List$assoc_opt(seg, mi.mod_submodules);
                  _t7221: {
                    if (_t7219._tag === 0) {
                      _t7220 = ({_tag: 0, _name: "None"});
                      break _t7221;
                    }
                    if (_t7219._tag === 1) {
                      const sub = _t7219._val;
                      const _t7222 = sub;
                      const _t7223 = rest;
                      mi = _t7222;
                      __x = _t7223;
                      continue;
                      _t7220 = undefined;
                      break _t7221;
                    }
                    _match_fail("line 16190");
                  }
                  _t7217 = _t7220;
                  break _t7218;
                }
                _match_fail("line 16190");
              }
              return _t7217;
            }
          }
          const _t7224 = drill(minfo, rest);
          _t7214 = _t7224;
          break _t7215;
        }
        _match_fail("line 16190");
      }
      _t7211 = _t7214;
      break _t7212;
    }
    _match_fail("line 16190");
  }
  return _t7211;
}
function Typechecker$open_module_into_ctx(ctx, mod_name, names_opt) {
  let _t7226;
  const _t7225 = Typechecker$find_module_in_env(ctx.type_env, mod_name);
  _t7227: {
    if (_t7225._tag === 0) {
      _t7226 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
      break _t7227;
    }
    if (_t7225._tag === 1) {
      const minfo = _t7225._val;
      function _t7228(name) {
        let _t7230;
        const _t7229 = names_opt;
        _t7231: {
          if (_t7229._tag === 0) {
            _t7230 = true;
            break _t7231;
          }
          if (_t7229._tag === 1) {
            const names = _t7229._val;
            _t7230 = List$mem(name, names);
            break _t7231;
          }
          _match_fail("line 16190");
        }
        return _t7230;
      }
      const filter_7232 = _t7228;
      function _t7234(ctx, __p200) {
        let _t7236;
        const _t7235 = __p200;
        _t7237: {
          if (true) {
            const _mml$short = _t7235[0];
            const scheme = _t7235[1];
            let _t7238;
            if (filter_7232(_mml$short)) {
              let _t7239;
              if (List$mem(_mml$short, minfo.mod_pub_mutable_vars)) {
                _t7239 = Typechecker$extend_var_mutable(ctx, _mml$short, scheme);
              } else {
                _t7239 = Typechecker$extend_var(ctx, _mml$short, scheme);
              }
              _t7238 = _t7239;
            } else {
              _t7238 = ctx;
            }
            _t7236 = _t7238;
            break _t7237;
          }
          _match_fail("line 16190");
        }
        return _t7236;
      }
      const ctx_7240 = List$fold(_t7234, ctx, minfo.mod_pub_vars);
      function _t7242(te, __p201) {
        let _t7244;
        const _t7243 = __p201;
        _t7245: {
          if (true) {
            const _mml$short = _t7243[0];
            const info = _t7243[1];
            let _t7246;
            if (filter_7232(_mml$short)) {
              const __rec_upd_7247 = te;
              const _t7248 = ({classes: __rec_upd_7247.classes, constructors: ({_hd: [_mml$short, info], _tl: te.constructors}), effects: __rec_upd_7247.effects, instances: __rec_upd_7247.instances, modules: __rec_upd_7247.modules, mutable_fields: __rec_upd_7247.mutable_fields, records: __rec_upd_7247.records, type_aliases: __rec_upd_7247.type_aliases, type_synonyms: __rec_upd_7247.type_synonyms, variants: __rec_upd_7247.variants});
              _t7246 = _t7248;
            } else {
              _t7246 = te;
            }
            _t7244 = _t7246;
            break _t7245;
          }
          _match_fail("line 16190");
        }
        return _t7244;
      }
      const type_env_7249 = List$fold(_t7242, ctx_7240.type_env, minfo.mod_pub_constructors);
      function _t7251(te, qname) {
        let _t7253;
        const _t7252 = String$rindex_opt(qname, 46);
        _t7254: {
          if (_t7252._tag === 1) {
            const i = _t7252._val;
            _t7253 = String$sub(qname, (i + 1), ((String$length(qname) - i) - 1));
            break _t7254;
          }
          if (_t7252._tag === 0) {
            _t7253 = qname;
            break _t7254;
          }
          _match_fail("line 16190");
        }
        const _mml$short_7255 = _t7253;
        let _t7257;
        if (filter_7232(_mml$short_7255)) {
          function _t7258(__p202) {
            let _t7260;
            const _t7259 = __p202;
            _t7261: {
              if (true) {
                const n = _t7259[0];
                _t7260 = (n === qname);
                break _t7261;
              }
              _match_fail("line 16190");
            }
            return _t7260;
          }
          let _t7263;
          const _t7262 = List$find(_t7258, te.variants);
          _t7264: {
            if (_t7262._tag === 1) {
              const np = _t7262._val[1];
              const vdef = _t7262._val[2];
              const is_gadt = _t7262._val[3];
              function _t7265(__p203) {
                let _t7267;
                const _t7266 = __p203;
                _t7268: {
                  if (true) {
                    const n = _t7266[0];
                    _t7267 = (n === _mml$short_7255);
                    break _t7268;
                  }
                  _match_fail("line 16190");
                }
                return _t7267;
              }
              let _t7269;
              if (List$exists(_t7265, te.variants)) {
                _t7269 = te;
              } else {
                const __rec_upd_7270 = te;
                const _t7271 = ({classes: __rec_upd_7270.classes, constructors: __rec_upd_7270.constructors, effects: __rec_upd_7270.effects, instances: __rec_upd_7270.instances, modules: __rec_upd_7270.modules, mutable_fields: __rec_upd_7270.mutable_fields, records: __rec_upd_7270.records, type_aliases: __rec_upd_7270.type_aliases, type_synonyms: __rec_upd_7270.type_synonyms, variants: ({_hd: [_mml$short_7255, np, vdef, is_gadt], _tl: te.variants})});
                _t7269 = _t7271;
              }
              _t7263 = _t7269;
              break _t7264;
            }
            if (_t7262._tag === 0) {
              _t7263 = te;
              break _t7264;
            }
            _match_fail("line 16190");
          }
          const te_7272 = _t7263;
          let _t7275;
          const _t7274 = List$assoc_opt(qname, te_7272.records);
          _t7276: {
            if (_t7274._tag === 1) {
              const fields = _t7274._val;
              let _t7277;
              if (!_eq(List$assoc_opt(_mml$short_7255, te_7272.records), ({_tag: 0, _name: "None"}))) {
                _t7277 = te_7272;
              } else {
                const __rec_upd_7278 = te_7272;
                const _t7279 = ({classes: __rec_upd_7278.classes, constructors: __rec_upd_7278.constructors, effects: __rec_upd_7278.effects, instances: __rec_upd_7278.instances, modules: __rec_upd_7278.modules, mutable_fields: __rec_upd_7278.mutable_fields, records: ({_hd: [_mml$short_7255, fields], _tl: te_7272.records}), type_aliases: __rec_upd_7278.type_aliases, type_synonyms: __rec_upd_7278.type_synonyms, variants: __rec_upd_7278.variants});
                _t7277 = _t7279;
              }
              _t7275 = _t7277;
              break _t7276;
            }
            if (_t7274._tag === 0) {
              _t7275 = te_7272;
              break _t7276;
            }
            _match_fail("line 16190");
          }
          const te_7280 = _t7275;
          function _t7282(__p204) {
            let _t7284;
            const _t7283 = __p204;
            _t7285: {
              if (true) {
                const n = _t7283[0];
                _t7284 = (n === qname);
                break _t7285;
              }
              _match_fail("line 16190");
            }
            return _t7284;
          }
          let _t7287;
          const _t7286 = List$find(_t7282, te_7280.type_synonyms);
          _t7288: {
            if (_t7286._tag === 1) {
              const np = _t7286._val[1];
              const expanded = _t7286._val[2];
              function _t7289(__p205) {
                let _t7291;
                const _t7290 = __p205;
                _t7292: {
                  if (true) {
                    const n = _t7290[0];
                    _t7291 = (n === _mml$short_7255);
                    break _t7292;
                  }
                  _match_fail("line 16190");
                }
                return _t7291;
              }
              let _t7293;
              if (List$exists(_t7289, te_7280.type_synonyms)) {
                _t7293 = te_7280;
              } else {
                const __rec_upd_7294 = te_7280;
                const _t7295 = ({classes: __rec_upd_7294.classes, constructors: __rec_upd_7294.constructors, effects: __rec_upd_7294.effects, instances: __rec_upd_7294.instances, modules: __rec_upd_7294.modules, mutable_fields: __rec_upd_7294.mutable_fields, records: __rec_upd_7294.records, type_aliases: __rec_upd_7294.type_aliases, type_synonyms: ({_hd: [_mml$short_7255, np, expanded], _tl: te_7280.type_synonyms}), variants: __rec_upd_7294.variants});
                _t7293 = _t7295;
              }
              _t7287 = _t7293;
              break _t7288;
            }
            if (_t7286._tag === 0) {
              _t7287 = te_7280;
              break _t7288;
            }
            _match_fail("line 16190");
          }
          const te_7296 = _t7287;
          let _t7298;
          if ((_mml$short_7255 === qname)) {
            _t7298 = te_7296;
          } else {
            const __rec_upd_7299 = te_7296;
            const _t7300 = ({classes: __rec_upd_7299.classes, constructors: __rec_upd_7299.constructors, effects: __rec_upd_7299.effects, instances: __rec_upd_7299.instances, modules: __rec_upd_7299.modules, mutable_fields: __rec_upd_7299.mutable_fields, records: __rec_upd_7299.records, type_aliases: ({_hd: [_mml$short_7255, qname], _tl: te_7296.type_aliases}), type_synonyms: __rec_upd_7299.type_synonyms, variants: __rec_upd_7299.variants});
            _t7298 = _t7300;
          }
          const te_7301 = _t7298;
          const _t7302 = te_7301;
          const _t7297 = _t7302;
          const _t7281 = _t7297;
          const _t7273 = _t7281;
          _t7257 = _t7273;
        } else {
          _t7257 = te;
        }
        const _t7256 = _t7257;
        return _t7256;
      }
      const type_env_7303 = List$fold(_t7251, type_env_7249, minfo.mod_pub_types);
      function _t7305(te, __p206) {
        let _t7307;
        const _t7306 = __p206;
        _t7308: {
          if (true) {
            const sub_name = _t7306[0];
            const sub_info = _t7306[1];
            let _t7309;
            if (filter_7232(sub_name)) {
              const __rec_upd_7310 = te;
              const _t7311 = ({classes: __rec_upd_7310.classes, constructors: __rec_upd_7310.constructors, effects: __rec_upd_7310.effects, instances: __rec_upd_7310.instances, modules: ({_hd: [sub_name, sub_info], _tl: te.modules}), mutable_fields: __rec_upd_7310.mutable_fields, records: __rec_upd_7310.records, type_aliases: __rec_upd_7310.type_aliases, type_synonyms: __rec_upd_7310.type_synonyms, variants: __rec_upd_7310.variants});
              _t7309 = _t7311;
            } else {
              _t7309 = te;
            }
            _t7307 = _t7309;
            break _t7308;
          }
          _match_fail("line 16190");
        }
        return _t7307;
      }
      const type_env_7312 = List$fold(_t7305, type_env_7303, minfo.mod_submodules);
      function _t7314(te, qname) {
        let _t7316;
        const _t7315 = String$rindex_opt(qname, 46);
        _t7317: {
          if (_t7315._tag === 1) {
            const i = _t7315._val;
            _t7316 = String$sub(qname, (i + 1), ((String$length(qname) - i) - 1));
            break _t7317;
          }
          if (_t7315._tag === 0) {
            _t7316 = qname;
            break _t7317;
          }
          _match_fail("line 16190");
        }
        const _mml$short_7318 = _t7316;
        let _t7320;
        if (filter_7232(_mml$short_7318)) {
          const __rec_upd_7321 = te;
          const _t7322 = ({classes: __rec_upd_7321.classes, constructors: __rec_upd_7321.constructors, effects: __rec_upd_7321.effects, instances: __rec_upd_7321.instances, modules: __rec_upd_7321.modules, mutable_fields: __rec_upd_7321.mutable_fields, records: __rec_upd_7321.records, type_aliases: ({_hd: [_mml$short_7318, qname], _tl: te.type_aliases}), type_synonyms: __rec_upd_7321.type_synonyms, variants: __rec_upd_7321.variants});
          _t7320 = _t7322;
        } else {
          _t7320 = te;
        }
        const _t7319 = _t7320;
        return _t7319;
      }
      const type_env_7323 = List$fold(_t7314, type_env_7312, minfo.mod_pub_classes);
      const __rec_upd_7325 = ctx_7240;
      const _t7326 = ({constraint_tvars: __rec_upd_7325.constraint_tvars, current_eff: __rec_upd_7325.current_eff, current_module: __rec_upd_7325.current_module, inside_handler: __rec_upd_7325.inside_handler, loop_info: __rec_upd_7325.loop_info, mutable_vars: __rec_upd_7325.mutable_vars, return_type: __rec_upd_7325.return_type, return_used: __rec_upd_7325.return_used, type_env: type_env_7323, vars: __rec_upd_7325.vars});
      const _t7324 = _t7326;
      const _t7313 = _t7324;
      const _t7304 = _t7313;
      const _t7250 = _t7304;
      const _t7241 = _t7250;
      const _t7233 = _t7241;
      _t7226 = _t7233;
      break _t7227;
    }
    _match_fail("line 16190");
  }
  return _t7226;
}
const _t7327_Typechecker$__destruct = Ref$set(Typechecker$find_module_in_env_ref, Typechecker$find_module_in_env);
const _t7328_Typechecker$__destruct = Ref$set(Typechecker$open_module_into_ctx_ref, Typechecker$open_module_into_ctx);
function Typechecker$collect_tyvars_annot(__x) {
  while (true) {
    let _t7330;
    const _t7329 = __x;
    _t7331: {
      if (_t7329._tag === 1) {
        const s = _t7329._val;
        _t7330 = ({_hd: s, _tl: null});
        break _t7331;
      }
      if (_t7329._tag === 2) {
        const a = _t7329._val[0];
        const b = _t7329._val[1];
        _t7330 = List$concat(Typechecker$collect_tyvars_annot(a), Typechecker$collect_tyvars_annot(b));
        break _t7331;
      }
      if (_t7329._tag === 6) {
        const ts = _t7329._val;
        _t7330 = List$concat_map(Typechecker$collect_tyvars_annot, ts);
        break _t7331;
      }
      if ((_t7329._tag === 4 || _t7329._tag === 5)) {
        const t = _t7329._val;
        const _t7332 = t;
        __x = _t7332;
        continue;
        _t7330 = undefined;
        break _t7331;
      }
      if (_t7329._tag === 7) {
        const args = _t7329._val[0];
        _t7330 = List$concat_map(Typechecker$collect_tyvars_annot, args);
        break _t7331;
      }
      if (_t7329._tag === 8) {
        const k = _t7329._val[0];
        const v = _t7329._val[1];
        _t7330 = List$concat(Typechecker$collect_tyvars_annot(k), Typechecker$collect_tyvars_annot(v));
        break _t7331;
      }
      if (_t7329._tag === 3) {
        const fs = _t7329._val[0];
        function _t7333(__p207) {
          let _t7335;
          const _t7334 = __p207;
          _t7336: {
            if (true) {
              const t = _t7334[1];
              _t7335 = Typechecker$collect_tyvars_annot(t);
              break _t7336;
            }
            _match_fail("line 16190");
          }
          return _t7335;
        }
        _t7330 = List$concat_map(_t7333, fs);
        break _t7331;
      }
      if ((_t7329._tag === 0 || _t7329._tag === 9)) {
        _t7330 = null;
        break _t7331;
      }
      if (_t7329._tag === 10) {
        const tags = _t7329._val[1];
        function _t7337(__p208) {
          let _t7339;
          const _t7338 = __p208;
          _t7340: {
            if (true) {
              const ty_opt = _t7338[1];
              let _t7342;
              const _t7341 = ty_opt;
              _t7343: {
                if (_t7341._tag === 1) {
                  const t = _t7341._val;
                  _t7342 = Typechecker$collect_tyvars_annot(t);
                  break _t7343;
                }
                if (_t7341._tag === 0) {
                  _t7342 = null;
                  break _t7343;
                }
                _match_fail("line 16190");
              }
              _t7339 = _t7342;
              break _t7340;
            }
            _match_fail("line 16190");
          }
          return _t7339;
        }
        _t7330 = List$concat_map(_t7337, tags);
        break _t7331;
      }
      if (_t7329._tag === 11) {
        const ty = _t7329._val[0];
        const _t7344 = ty;
        __x = _t7344;
        continue;
        _t7330 = undefined;
        break _t7331;
      }
      _match_fail("line 16190");
    }
    return _t7330;
  }
}
function Typechecker$concat_str_exprs(__x) {
  let _t7346;
  const _t7345 = __x;
  _t7347: {
    if (_t7345 === null) {
      _t7346 = ({_tag: 3, _name: "EString", _val: ""});
      break _t7347;
    }
    if (_t7345 !== null && _t7345._tl === null) {
      const e = _t7345._hd;
      _t7346 = e;
      break _t7347;
    }
    if (_t7345 !== null) {
      const first = _t7345._hd;
      const rest = _t7345._tl;
      function _t7348(acc, e) {
        return ({_tag: 13, _name: "EBinop", _val: [({_tag: 13, _name: "Concat"}), acc, e]});
      }
      _t7346 = List$fold(_t7348, first, rest);
      break _t7347;
    }
    _match_fail("line 16190");
  }
  return _t7346;
}
function Typechecker$make_inst_ty(type_params, name) {
  let _t7349;
  if (_eq(type_params, null)) {
    _t7349 = ({_tag: 0, _name: "TyName", _val: name});
  } else {
    function _t7350(p) {
      return ({_tag: 1, _name: "TyVar", _val: p});
    }
    _t7349 = ({_tag: 7, _name: "TyApp", _val: [List$map(_t7350, type_params), name]});
  }
  return _t7349;
}
function Typechecker$make_constraints(class_name, type_params, annots) {
  function _t7351(ann) {
    return Typechecker$collect_tyvars_annot(ann);
  }
  const all_vars_7352 = List$concat_map(_t7351, annots);
  const unique_vars_7354 = List$sort_uniq(String$compare, all_vars_7352);
  function _t7356(v) {
    return List$mem(v, type_params);
  }
  const param_vars_7357 = List$filter(_t7356, unique_vars_7354);
  function _t7359(v) {
    return [class_name, ({_hd: v, _tl: null})];
  }
  const _t7358 = List$map(_t7359, param_vars_7357);
  const _t7355 = _t7358;
  const _t7353 = _t7355;
  return _t7353;
}
function Typechecker$gen_show_variant(type_params, name, ctors) {
  const inst_ty_7360 = Typechecker$make_inst_ty(type_params, name);
  function _t7362(__p209) {
    let _t7364;
    const _t7363 = __p209;
    _t7365: {
      if (true) {
        const a = _t7363[1];
        _t7364 = a;
        break _t7365;
      }
      _match_fail("line 16190");
    }
    return _t7364;
  }
  const annots_7366 = List$filter_map(_t7362, ctors);
  const constraints_7368 = Typechecker$make_constraints("Show", type_params, annots_7366);
  function _t7370(__p210) {
    let _t7372;
    const _t7371 = __p210;
    _t7373: {
      if (true) {
        const ctor_name = _t7371[0];
        const arg_annot = _t7371[1];
        let _t7375;
        const _t7374 = arg_annot;
        _t7376: {
          if (_t7374._tag === 0) {
            _t7375 = [({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 0, _name: "None"})]}), ({_tag: 0, _name: "None"}), ({_tag: 3, _name: "EString", _val: ctor_name})];
            break _t7376;
          }
          if (_t7374._tag === 1 && _t7374._val._tag === 6) {
            const tys = _t7374._val._val;
            const n_7377 = List$length(tys);
            function _t7379(i) {
              return ("__v" + __dict_Show_int.show(i));
            }
            const vars_7380 = List$init(n_7377, _t7379);
            function _t7382(v) {
              return ({_tag: 1, _name: "PatVar", _val: v});
            }
            const pat_7383 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 7, _name: "PatTuple", _val: List$map(_t7382, vars_7380)})})]});
            function _t7385(i, v) {
              const sv_7386 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), ({_tag: 7, _name: "EVar", _val: v})]});
              let _t7388;
              if ((i === 0)) {
                _t7388 = ({_hd: sv_7386, _tl: null});
              } else {
                _t7388 = ({_hd: ({_tag: 3, _name: "EString", _val: ", "}), _tl: ({_hd: sv_7386, _tl: null})});
              }
              const _t7387 = _t7388;
              return _t7387;
            }
            const parts_7389 = List$concat(({_hd: ({_tag: 3, _name: "EString", _val: (ctor_name + "(")}), _tl: null}), List$concat(List$flatten(List$mapi(_t7385, vars_7380)), ({_hd: ({_tag: 3, _name: "EString", _val: ")"}), _tl: null})));
            const _t7390 = [pat_7383, ({_tag: 0, _name: "None"}), Typechecker$concat_str_exprs(parts_7389)];
            const _t7384 = _t7390;
            const _t7381 = _t7384;
            const _t7378 = _t7381;
            _t7375 = _t7378;
            break _t7376;
          }
          if (_t7374._tag === 1) {
            const pat_7391 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "PatVar", _val: "__v0"})})]});
            const body_7393 = Typechecker$concat_str_exprs(({_hd: ({_tag: 3, _name: "EString", _val: (ctor_name + "(")}), _tl: ({_hd: ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), ({_tag: 7, _name: "EVar", _val: "__v0"})]}), _tl: ({_hd: ({_tag: 3, _name: "EString", _val: ")"}), _tl: null})})}));
            const _t7394 = [pat_7391, ({_tag: 0, _name: "None"}), body_7393];
            const _t7392 = _t7394;
            _t7375 = _t7392;
            break _t7376;
          }
          _match_fail("line 16190");
        }
        _t7372 = _t7375;
        break _t7373;
      }
      _match_fail("line 16190");
    }
    return _t7372;
  }
  const arms_7395 = List$map(_t7370, ctors);
  const body_7397 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: "__x"}), arms_7395, false]});
  const _t7398 = ["Show", ({_hd: inst_ty_7360, _tl: null}), constraints_7368, ({_hd: ["show", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__x"}), _tl: null}), body_7397], _tl: null})];
  const _t7396 = _t7398;
  const _t7369 = _t7396;
  const _t7367 = _t7369;
  const _t7361 = _t7367;
  return _t7361;
}
function Typechecker$gen_show_record(type_params, name, fields) {
  const inst_ty_7399 = Typechecker$make_inst_ty(type_params, name);
  function _t7401(__p211) {
    let _t7403;
    const _t7402 = __p211;
    _t7404: {
      if (true) {
        const a = _t7402[2];
        _t7403 = a;
        break _t7404;
      }
      _match_fail("line 16190");
    }
    return _t7403;
  }
  const annots_7405 = List$map(_t7401, fields);
  const constraints_7407 = Typechecker$make_constraints("Show", type_params, annots_7405);
  function _t7409(i, __p212) {
    let _t7411;
    const _t7410 = __p212;
    _t7412: {
      if (true) {
        const fname = _t7410[1];
        const sf_7413 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__x"}), fname]})]});
        let _t7415;
        if ((i === 0)) {
          _t7415 = ({_hd: ({_tag: 3, _name: "EString", _val: (fname + " = ")}), _tl: ({_hd: sf_7413, _tl: null})});
        } else {
          _t7415 = ({_hd: ({_tag: 3, _name: "EString", _val: ("; " + (fname + " = "))}), _tl: ({_hd: sf_7413, _tl: null})});
        }
        const _t7414 = _t7415;
        _t7411 = _t7414;
        break _t7412;
      }
      _match_fail("line 16190");
    }
    return _t7411;
  }
  const parts_7416 = List$concat(({_hd: ({_tag: 3, _name: "EString", _val: "{ "}), _tl: null}), List$concat(List$flatten(List$mapi(_t7409, fields)), ({_hd: ({_tag: 3, _name: "EString", _val: " }"}), _tl: null})));
  const body_7418 = Typechecker$concat_str_exprs(parts_7416);
  const _t7419 = ["Show", ({_hd: inst_ty_7399, _tl: null}), constraints_7407, ({_hd: ["show", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__x"}), _tl: null}), body_7418], _tl: null})];
  const _t7417 = _t7419;
  const _t7408 = _t7417;
  const _t7406 = _t7408;
  const _t7400 = _t7406;
  return _t7400;
}
function Typechecker$gen_eq_variant(type_params, name, ctors) {
  const inst_ty_7420 = Typechecker$make_inst_ty(type_params, name);
  function _t7422(__p213) {
    let _t7424;
    const _t7423 = __p213;
    _t7425: {
      if (true) {
        const a = _t7423[1];
        _t7424 = a;
        break _t7425;
      }
      _match_fail("line 16190");
    }
    return _t7424;
  }
  const annots_7426 = List$filter_map(_t7422, ctors);
  const constraints_7428 = Typechecker$make_constraints("Eq", type_params, annots_7426);
  function _t7430(__x) {
    let _t7432;
    const _t7431 = __x;
    _t7433: {
      if (_t7431 === null) {
        _t7432 = ({_tag: 2, _name: "EBool", _val: true});
        break _t7433;
      }
      if (_t7431 !== null && _t7431._tl === null) {
        const e = _t7431._hd;
        _t7432 = e;
        break _t7433;
      }
      if (_t7431 !== null) {
        const first = _t7431._hd;
        const rest = _t7431._tl;
        function _t7434(a, e) {
          return ({_tag: 13, _name: "EBinop", _val: [({_tag: 11, _name: "And"}), a, e]});
        }
        _t7432 = List$fold(_t7434, first, rest);
        break _t7433;
      }
      _match_fail("line 16190");
    }
    return _t7432;
  }
  const and_exprs_7435 = _t7430;
  function _t7437(__p214) {
    let _t7439;
    const _t7438 = __p214;
    _t7440: {
      if (true) {
        const ctor_name = _t7438[0];
        const arg_annot = _t7438[1];
        let _t7442;
        const _t7441 = arg_annot;
        _t7443: {
          if (_t7441._tag === 0) {
            const pat_7444 = ({_tag: 7, _name: "PatTuple", _val: ({_hd: ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 0, _name: "None"})]}), _tl: ({_hd: ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 0, _name: "None"})]}), _tl: null})})});
            const _t7445 = [pat_7444, ({_tag: 0, _name: "None"}), ({_tag: 2, _name: "EBool", _val: true})];
            _t7442 = _t7445;
            break _t7443;
          }
          if (_t7441._tag === 1 && _t7441._val._tag === 6) {
            const tys = _t7441._val._val;
            const n_7446 = List$length(tys);
            function _t7448(i) {
              return ("__v" + __dict_Show_int.show(i));
            }
            const vs_7449 = List$init(n_7446, _t7448);
            function _t7451(i) {
              return ("__w" + __dict_Show_int.show(i));
            }
            const ws_7452 = List$init(n_7446, _t7451);
            function _t7454(v) {
              return ({_tag: 1, _name: "PatVar", _val: v});
            }
            const lp_7455 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 7, _name: "PatTuple", _val: List$map(_t7454, vs_7449)})})]});
            function _t7457(v) {
              return ({_tag: 1, _name: "PatVar", _val: v});
            }
            const rp_7458 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 7, _name: "PatTuple", _val: List$map(_t7457, ws_7452)})})]});
            function _t7460(v, w) {
              return ({_tag: 13, _name: "EBinop", _val: [({_tag: 5, _name: "Eq"}), ({_tag: 7, _name: "EVar", _val: v}), ({_tag: 7, _name: "EVar", _val: w})]});
            }
            const eqs_7461 = List$map2(_t7460, vs_7449, ws_7452);
            const _t7462 = [({_tag: 7, _name: "PatTuple", _val: ({_hd: lp_7455, _tl: ({_hd: rp_7458, _tl: null})})}), ({_tag: 0, _name: "None"}), and_exprs_7435(eqs_7461)];
            const _t7459 = _t7462;
            const _t7456 = _t7459;
            const _t7453 = _t7456;
            const _t7450 = _t7453;
            const _t7447 = _t7450;
            _t7442 = _t7447;
            break _t7443;
          }
          if (_t7441._tag === 1) {
            const lp_7463 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "PatVar", _val: "__v0"})})]});
            const rp_7465 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "PatVar", _val: "__w0"})})]});
            const _t7466 = [({_tag: 7, _name: "PatTuple", _val: ({_hd: lp_7463, _tl: ({_hd: rp_7465, _tl: null})})}), ({_tag: 0, _name: "None"}), ({_tag: 13, _name: "EBinop", _val: [({_tag: 5, _name: "Eq"}), ({_tag: 7, _name: "EVar", _val: "__v0"}), ({_tag: 7, _name: "EVar", _val: "__w0"})]})];
            const _t7464 = _t7466;
            _t7442 = _t7464;
            break _t7443;
          }
          _match_fail("line 16190");
        }
        _t7439 = _t7442;
        break _t7440;
      }
      _match_fail("line 16190");
    }
    return _t7439;
  }
  const arms_7467 = List$map(_t7437, ctors);
  const arms_7469 = List$concat(arms_7467, ({_hd: [({_tag: 0, _name: "PatWild"}), ({_tag: 0, _name: "None"}), ({_tag: 2, _name: "EBool", _val: false})], _tl: null}));
  const eq_body_7471 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 15, _name: "ETuple", _val: ({_hd: ({_tag: 7, _name: "EVar", _val: "__a"}), _tl: ({_hd: ({_tag: 7, _name: "EVar", _val: "__b"}), _tl: null})})}), arms_7469, false]});
  function _t7473(__p215) {
    let _t7475;
    const _t7474 = __p215;
    _t7476: {
      if (true) {
        const p = _t7474[0];
        const g = _t7474[1];
        const e = _t7474[2];
        _t7475 = [p, g, e];
        break _t7476;
      }
      _match_fail("line 16190");
    }
    return _t7475;
  }
  const neq_body_7477 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 1, _name: "Not"}), ({_tag: 25, _name: "EMatch", _val: [({_tag: 15, _name: "ETuple", _val: ({_hd: ({_tag: 7, _name: "EVar", _val: "__a"}), _tl: ({_hd: ({_tag: 7, _name: "EVar", _val: "__b"}), _tl: null})})}), List$map(_t7473, arms_7469), false]})]});
  const _t7478 = ["Eq", ({_hd: inst_ty_7420, _tl: null}), constraints_7428, ({_hd: ["=", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), eq_body_7471], _tl: ({_hd: ["<>", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), neq_body_7477], _tl: null})})];
  const _t7472 = _t7478;
  const _t7470 = _t7472;
  const _t7468 = _t7470;
  const _t7436 = _t7468;
  const _t7429 = _t7436;
  const _t7427 = _t7429;
  const _t7421 = _t7427;
  return _t7421;
}
function Typechecker$gen_eq_record(type_params, name, fields) {
  const inst_ty_7479 = Typechecker$make_inst_ty(type_params, name);
  function _t7481(__p216) {
    let _t7483;
    const _t7482 = __p216;
    _t7484: {
      if (true) {
        const a = _t7482[2];
        _t7483 = a;
        break _t7484;
      }
      _match_fail("line 16190");
    }
    return _t7483;
  }
  const annots_7485 = List$map(_t7481, fields);
  const constraints_7487 = Typechecker$make_constraints("Eq", type_params, annots_7485);
  function _t7489(__p217) {
    let _t7491;
    const _t7490 = __p217;
    _t7492: {
      if (true) {
        const fname = _t7490[1];
        _t7491 = ({_tag: 13, _name: "EBinop", _val: [({_tag: 5, _name: "Eq"}), ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__a"}), fname]}), ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__b"}), fname]})]});
        break _t7492;
      }
      _match_fail("line 16190");
    }
    return _t7491;
  }
  const eqs_7493 = List$map(_t7489, fields);
  let _t7496;
  const _t7495 = eqs_7493;
  _t7497: {
    if (_t7495 === null) {
      _t7496 = ({_tag: 2, _name: "EBool", _val: true});
      break _t7497;
    }
    if (_t7495 !== null && _t7495._tl === null) {
      const e = _t7495._hd;
      _t7496 = e;
      break _t7497;
    }
    if (_t7495 !== null) {
      const first = _t7495._hd;
      const rest = _t7495._tl;
      function _t7498(a, e) {
        return ({_tag: 13, _name: "EBinop", _val: [({_tag: 11, _name: "And"}), a, e]});
      }
      _t7496 = List$fold(_t7498, first, rest);
      break _t7497;
    }
    _match_fail("line 16190");
  }
  const eq_body_7499 = _t7496;
  const neq_body_7501 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 1, _name: "Not"}), eq_body_7499]});
  const _t7502 = ["Eq", ({_hd: inst_ty_7479, _tl: null}), constraints_7487, ({_hd: ["=", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), eq_body_7499], _tl: ({_hd: ["<>", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), neq_body_7501], _tl: null})})];
  const _t7500 = _t7502;
  const _t7494 = _t7500;
  const _t7488 = _t7494;
  const _t7486 = _t7488;
  const _t7480 = _t7486;
  return _t7480;
}
function Typechecker$generate_derived_instance(type_params, name, def, class_name) {
  let _t7504;
  const _t7503 = [class_name, def];
  _t7505: {
    if (_t7503[1]._tag === 0) {
      const ctors = _t7503[1]._val;
      function _t7506(__p218) {
        let _t7508;
        const _t7507 = __p218;
        _t7509: {
          if (true) {
            const ret = _t7507[2];
            _t7508 = !_eq(ret, ({_tag: 0, _name: "None"}));
            break _t7509;
          }
          _match_fail("line 16190");
        }
        return _t7508;
      }
      if (List$exists(_t7506, ctors)) {
        _t7504 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(class_name)) + " for GADT type ") + __dict_Show_string.show(name)));
        break _t7505;
      }
    }
    if (_t7503[0] === "Show" && _t7503[1]._tag === 0) {
      const ctors = _t7503[1]._val;
      _t7504 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_show_variant(type_params, name, ctors)});
      break _t7505;
    }
    if (_t7503[0] === "Show" && _t7503[1]._tag === 1) {
      const fields = _t7503[1]._val;
      _t7504 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_show_record(type_params, name, fields)});
      break _t7505;
    }
    if (_t7503[0] === "Eq" && _t7503[1]._tag === 0) {
      const ctors = _t7503[1]._val;
      _t7504 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_eq_variant(type_params, name, ctors)});
      break _t7505;
    }
    if (_t7503[0] === "Eq" && _t7503[1]._tag === 1) {
      const fields = _t7503[1]._val;
      _t7504 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_eq_record(type_params, name, fields)});
      break _t7505;
    }
    if (true) {
      _t7504 = ({_tag: 0, _name: "None"});
      break _t7505;
    }
    _match_fail("line 16190");
  }
  return _t7504;
}
function Typechecker$process_module_def(ctx, level, mod_name, items) {
  let _t7511;
  const _t7510 = ctx.current_module;
  _t7512: {
    if (_t7510._tag === 0) {
      _t7511 = (mod_name + ".");
      break _t7512;
    }
    if (_t7510._tag === 1) {
      const parent = _t7510._val;
      _t7511 = (parent + (mod_name + "."));
      break _t7512;
    }
    _match_fail("line 16190");
  }
  const prefix_7513 = _t7511;
  const __rec_upd_7515 = ctx;
  const _t7516 = ({constraint_tvars: __rec_upd_7515.constraint_tvars, current_eff: __rec_upd_7515.current_eff, current_module: ({_tag: 1, _name: "Some", _val: prefix_7513}), inside_handler: __rec_upd_7515.inside_handler, loop_info: __rec_upd_7515.loop_info, mutable_vars: __rec_upd_7515.mutable_vars, return_type: __rec_upd_7515.return_type, return_used: __rec_upd_7515.return_used, type_env: __rec_upd_7515.type_env, vars: __rec_upd_7515.vars});
  const sub_ctx_7517 = _t7516;
  const pub_vars_7519 = Ref$create(null);
  const pub_mutable_vars_7521 = Ref$create(null);
  const pub_types_7523 = Ref$create(null);
  const opaque_types_7525 = Ref$create(null);
  const pub_constructors_7527 = Ref$create(null);
  const all_instances_7529 = Ref$create(null);
  const submodules_7531 = Ref$create(null);
  const pub_classes_7533 = Ref$create(null);
  const typed_decls_7535 = Ref$create(null);
  function _t7537(sub_ctx, item) {
    let _t7539;
    const _t7538 = Typechecker$check_module_item(sub_ctx, level, prefix_7513, item, pub_vars_7519, pub_mutable_vars_7521, pub_types_7523, opaque_types_7525, pub_constructors_7527, all_instances_7529, submodules_7531, pub_classes_7533, typed_decls_7535);
    _t7540: {
      if (true) {
        const sub_ctx$p = _t7538[0];
        const tdecl = _t7538[1];
        Ref$set(typed_decls_7535, ({_hd: tdecl, _tl: Ref$get(typed_decls_7535)}));
        _t7539 = sub_ctx$p;
        break _t7540;
      }
      _match_fail("line 16190");
    }
    return _t7539;
  }
  const sub_ctx_7541 = List$fold(_t7537, sub_ctx_7517, items);
  const minfo_7543 = ({mod_instances: Ref$get(all_instances_7529), mod_name: mod_name, mod_opaque_types: Ref$get(opaque_types_7525), mod_pub_classes: Ref$get(pub_classes_7533), mod_pub_constructors: Ref$get(pub_constructors_7527), mod_pub_mutable_vars: Ref$get(pub_mutable_vars_7521), mod_pub_types: Ref$get(pub_types_7523), mod_pub_vars: Ref$get(pub_vars_7519), mod_submodules: Ref$get(submodules_7531)});
  const __rec_upd_7545 = sub_ctx_7541.type_env;
  const _t7546 = ({classes: __rec_upd_7545.classes, constructors: __rec_upd_7545.constructors, effects: __rec_upd_7545.effects, instances: __rec_upd_7545.instances, modules: ({_hd: [mod_name, minfo_7543], _tl: ctx.type_env.modules}), mutable_fields: __rec_upd_7545.mutable_fields, records: __rec_upd_7545.records, type_aliases: __rec_upd_7545.type_aliases, type_synonyms: __rec_upd_7545.type_synonyms, variants: __rec_upd_7545.variants});
  const outer_type_env_7547 = _t7546;
  const __rec_upd_7549 = outer_type_env_7547;
  const _t7550 = ({classes: __rec_upd_7549.classes, constructors: __rec_upd_7549.constructors, effects: __rec_upd_7549.effects, instances: __rec_upd_7549.instances, modules: __rec_upd_7549.modules, mutable_fields: __rec_upd_7549.mutable_fields, records: __rec_upd_7549.records, type_aliases: ctx.type_env.type_aliases, type_synonyms: __rec_upd_7549.type_synonyms, variants: __rec_upd_7549.variants});
  const outer_type_env_7551 = _t7550;
  function _t7553(vars, __p219) {
    let _t7555;
    const _t7554 = __p219;
    _t7556: {
      if (true) {
        const _mml$short = _t7554[0];
        const scheme = _t7554[1];
        const qualified_7557 = (prefix_7513 + _mml$short);
        const _t7558 = ({_hd: [qualified_7557, scheme], _tl: vars});
        _t7555 = _t7558;
        break _t7556;
      }
      _match_fail("line 16190");
    }
    return _t7555;
  }
  const outer_vars_7559 = List$fold(_t7553, ctx.vars, Ref$get(pub_vars_7519));
  function _t7561(te, __p220) {
    let _t7563;
    const _t7562 = __p220;
    _t7564: {
      if (true) {
        const _mml$short = _t7562[0];
        const info = _t7562[1];
        const qualified_7565 = (prefix_7513 + _mml$short);
        const __rec_upd_7567 = te;
        const _t7568 = ({classes: __rec_upd_7567.classes, constructors: ({_hd: [qualified_7565, info], _tl: te.constructors}), effects: __rec_upd_7567.effects, instances: __rec_upd_7567.instances, modules: __rec_upd_7567.modules, mutable_fields: __rec_upd_7567.mutable_fields, records: __rec_upd_7567.records, type_aliases: __rec_upd_7567.type_aliases, type_synonyms: __rec_upd_7567.type_synonyms, variants: __rec_upd_7567.variants});
        const _t7566 = _t7568;
        _t7563 = _t7566;
        break _t7564;
      }
      _match_fail("line 16190");
    }
    return _t7563;
  }
  const outer_type_env_7569 = List$fold(_t7561, outer_type_env_7551, Ref$get(pub_constructors_7527));
  function _t7571(i) {
    return i.inst_dict_name;
  }
  const existing_dict_names_7572 = List$map(_t7571, outer_type_env_7569.instances);
  function _t7574(inst) {
    return (!List$mem(inst.inst_dict_name, existing_dict_names_7572));
  }
  const new_insts_7575 = List$filter(_t7574, Ref$get(all_instances_7529));
  const __rec_upd_7577 = outer_type_env_7569;
  const _t7578 = ({classes: __rec_upd_7577.classes, constructors: __rec_upd_7577.constructors, effects: __rec_upd_7577.effects, instances: List$concat(new_insts_7575, outer_type_env_7569.instances), modules: __rec_upd_7577.modules, mutable_fields: __rec_upd_7577.mutable_fields, records: __rec_upd_7577.records, type_aliases: __rec_upd_7577.type_aliases, type_synonyms: __rec_upd_7577.type_synonyms, variants: __rec_upd_7577.variants});
  const outer_type_env_7579 = _t7578;
  function _t7581(mvs, _mml$short) {
    const qualified_7582 = (prefix_7513 + _mml$short);
    const _t7583 = ({_hd: qualified_7582, _tl: mvs});
    return _t7583;
  }
  const outer_mutable_vars_7584 = List$fold(_t7581, ctx.mutable_vars, Ref$get(pub_mutable_vars_7521));
  const __rec_upd_7586 = ctx;
  const _t7587 = ({constraint_tvars: __rec_upd_7586.constraint_tvars, current_eff: __rec_upd_7586.current_eff, current_module: __rec_upd_7586.current_module, inside_handler: __rec_upd_7586.inside_handler, loop_info: __rec_upd_7586.loop_info, mutable_vars: outer_mutable_vars_7584, return_type: __rec_upd_7586.return_type, return_used: __rec_upd_7586.return_used, type_env: outer_type_env_7579, vars: outer_vars_7559});
  const outer_ctx_7588 = _t7587;
  const _t7589 = [outer_ctx_7588, ({_tag: 9, _name: "TDModule", _val: [mod_name, List$rev(Ref$get(typed_decls_7535))]})];
  const _t7585 = _t7589;
  const _t7580 = _t7585;
  const _t7576 = _t7580;
  const _t7573 = _t7576;
  const _t7570 = _t7573;
  const _t7560 = _t7570;
  const _t7552 = _t7560;
  const _t7548 = _t7552;
  const _t7544 = _t7548;
  const _t7542 = _t7544;
  const _t7536 = _t7542;
  const _t7534 = _t7536;
  const _t7532 = _t7534;
  const _t7530 = _t7532;
  const _t7528 = _t7530;
  const _t7526 = _t7528;
  const _t7524 = _t7526;
  const _t7522 = _t7524;
  const _t7520 = _t7522;
  const _t7518 = _t7520;
  const _t7514 = _t7518;
  return _t7514;
}
function Typechecker$check_module_item(sub_ctx, level, prefix, item, pub_vars, pub_mutable_vars, pub_types, opaque_types, pub_constructors, all_instances, submodules, pub_classes, typed_decls) {
  const decl_7590 = item.decl;
  let _t7593;
  const _t7592 = decl_7590;
  _t7594: {
    if (_t7592._tag === 11) {
      const inner_name = _t7592._val[0];
      const inner_items = _t7592._val[1];
      let _t7596;
      const _t7595 = Typechecker$process_module_def(sub_ctx, level, inner_name, inner_items);
      _t7597: {
        if (true) {
          const sub_ctx$p = _t7595[0];
          const tdecl = _t7595[1];
          let _t7599;
          const _t7598 = item.vis;
          _t7600: {
            if (_t7598._tag === 0) {
              let _t7602;
              const _t7601 = Typechecker$find_module_in_env(sub_ctx$p.type_env, inner_name);
              _t7603: {
                if (_t7601._tag === 1) {
                  const inner_info = _t7601._val;
                  Ref$set(submodules, ({_hd: [inner_name, inner_info], _tl: Ref$get(submodules)}));
                  function _t7604(__p221) {
                    let _t7606;
                    const _t7605 = __p221;
                    _t7607: {
                      if (true) {
                        const _mml$short = _t7605[0];
                        const scheme = _t7605[1];
                        _t7606 = Ref$set(pub_vars, ({_hd: [(inner_name + ("." + _mml$short)), scheme], _tl: Ref$get(pub_vars)}));
                        break _t7607;
                      }
                      _match_fail("line 16190");
                    }
                    return _t7606;
                  }
                  List$iter(_t7604, inner_info.mod_pub_vars);
                  function _t7608(__p222) {
                    let _t7610;
                    const _t7609 = __p222;
                    _t7611: {
                      if (true) {
                        const _mml$short = _t7609[0];
                        const info = _t7609[1];
                        _t7610 = Ref$set(pub_constructors, ({_hd: [(inner_name + ("." + _mml$short)), info], _tl: Ref$get(pub_constructors)}));
                        break _t7611;
                      }
                      _match_fail("line 16190");
                    }
                    return _t7610;
                  }
                  _t7602 = List$iter(_t7608, inner_info.mod_pub_constructors);
                  break _t7603;
                }
                if (_t7601._tag === 0) {
                  _t7602 = undefined;
                  break _t7603;
                }
                _match_fail("line 16190");
              }
              _t7599 = _t7602;
              break _t7600;
            }
            if (true) {
              _t7599 = undefined;
              break _t7600;
            }
            _match_fail("line 16190");
          }
          _t7599;
          _t7596 = [sub_ctx$p, tdecl];
          break _t7597;
        }
        _match_fail("line 16190");
      }
      _t7593 = _t7596;
      break _t7594;
    }
    if (_t7592._tag === 4) {
      const type_params = _t7592._val[0];
      const name = _t7592._val[1];
      const def = _t7592._val[2];
      const deriving_ = _t7592._val[3];
      const qualified_name_7612 = (prefix + name);
      const __rec_upd_7614 = sub_ctx;
      const __rec_upd_7616 = sub_ctx.type_env;
      const _t7617 = ({classes: __rec_upd_7616.classes, constructors: __rec_upd_7616.constructors, effects: __rec_upd_7616.effects, instances: __rec_upd_7616.instances, modules: __rec_upd_7616.modules, mutable_fields: __rec_upd_7616.mutable_fields, records: __rec_upd_7616.records, type_aliases: ({_hd: [name, qualified_name_7612], _tl: sub_ctx.type_env.type_aliases}), type_synonyms: __rec_upd_7616.type_synonyms, variants: __rec_upd_7616.variants});
      const _t7615 = ({constraint_tvars: __rec_upd_7614.constraint_tvars, current_eff: __rec_upd_7614.current_eff, current_module: __rec_upd_7614.current_module, inside_handler: __rec_upd_7614.inside_handler, loop_info: __rec_upd_7614.loop_info, mutable_vars: __rec_upd_7614.mutable_vars, return_type: __rec_upd_7614.return_type, return_used: __rec_upd_7614.return_used, type_env: _t7617, vars: __rec_upd_7614.vars});
      const sub_ctx_with_alias_7618 = _t7615;
      const sub_ctx$p_7620 = Typechecker$process_type_def(sub_ctx_with_alias_7618, type_params, qualified_name_7612, def);
      let _t7623;
      const _t7622 = item.vis;
      _t7624: {
        if (_t7622._tag === 0) {
          Ref$set(pub_types, ({_hd: qualified_name_7612, _tl: Ref$get(pub_types)}));
          let _t7626;
          const _t7625 = def;
          _t7627: {
            if (_t7625._tag === 0) {
              const ctors = _t7625._val;
              function _t7628(__p223) {
                let _t7630;
                const _t7629 = __p223;
                _t7631: {
                  if (true) {
                    const ctor_name = _t7629[0];
                    let _t7633;
                    const _t7632 = List$assoc_opt(ctor_name, sub_ctx$p_7620.type_env.constructors);
                    _t7634: {
                      if (_t7632._tag === 1) {
                        const info = _t7632._val;
                        const __rec_upd_7635 = info;
                        const _t7636 = ({ctor_arg_ty: __rec_upd_7635.ctor_arg_ty, ctor_existentials: __rec_upd_7635.ctor_existentials, ctor_num_params: __rec_upd_7635.ctor_num_params, ctor_return_ty_params: __rec_upd_7635.ctor_return_ty_params, ctor_type_name: qualified_name_7612});
                        const qual_info_7637 = _t7636;
                        const _t7638 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_7637], _tl: Ref$get(pub_constructors)}));
                        _t7633 = _t7638;
                        break _t7634;
                      }
                      if (_t7632._tag === 0) {
                        _t7633 = undefined;
                        break _t7634;
                      }
                      _match_fail("line 16190");
                    }
                    _t7630 = _t7633;
                    break _t7631;
                  }
                  _match_fail("line 16190");
                }
                return _t7630;
              }
              _t7626 = List$iter(_t7628, ctors);
              break _t7627;
            }
            if ((_t7625._tag === 1 || _t7625._tag === 2)) {
              _t7626 = undefined;
              break _t7627;
            }
            _match_fail("line 16190");
          }
          _t7623 = _t7626;
          break _t7624;
        }
        if (_t7622._tag === 2) {
          Ref$set(pub_types, ({_hd: qualified_name_7612, _tl: Ref$get(pub_types)}));
          _t7623 = Ref$set(opaque_types, ({_hd: qualified_name_7612, _tl: Ref$get(opaque_types)}));
          break _t7624;
        }
        if (_t7622._tag === 1) {
          _t7623 = undefined;
          break _t7624;
        }
        _match_fail("line 16190");
      }
      _t7623;
      function _t7639(ctx, cls) {
        let _t7641;
        const _t7640 = Typechecker$generate_derived_instance(type_params, name, def, cls);
        _t7642: {
          if (_t7640._tag === 1) {
            const class_name = _t7640._val[0];
            const inst_tys = _t7640._val[1];
            const constraints = _t7640._val[2];
            const methods = _t7640._val[3];
            let _t7644;
            const _t7643 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
            _t7645: {
              if (true) {
                const ctx$p = _t7643[0];
                const tdecl = _t7643[1];
                Ref$set(typed_decls, ({_hd: tdecl, _tl: Ref$get(typed_decls)}));
                Ref$set(all_instances, ctx$p.type_env.instances);
                _t7644 = ctx$p;
                break _t7645;
              }
              _match_fail("line 16190");
            }
            _t7641 = _t7644;
            break _t7642;
          }
          if (_t7640._tag === 0) {
            _t7641 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
            break _t7642;
          }
          _match_fail("line 16190");
        }
        return _t7641;
      }
      const sub_ctx$p_7646 = List$fold(_t7639, sub_ctx$p_7620, deriving_);
      const _t7647 = [sub_ctx$p_7646, ({_tag: 4, _name: "TDType", _val: [qualified_name_7612, def]})];
      const _t7621 = _t7647;
      const _t7619 = _t7621;
      const _t7613 = _t7619;
      _t7593 = _t7613;
      break _t7594;
    }
    if (_t7592._tag === 0) {
      const name = _t7592._val[0];
      const params = _t7592._val[1];
      const ret_annot = _t7592._val[2];
      const constraints = _t7592._val[3];
      const body = _t7592._val[4];
      const qualified_name_7648 = (prefix + name);
      let _t7650;
      if (!_eq(constraints, null)) {
        _t7650 = Typechecker$synth_constrained_fn(sub_ctx, level, constraints, params, ret_annot, body);
      } else {
        const full_body_7651 = Typechecker$wrap_params_decl(params, ret_annot, body);
        const te_7653 = Typechecker$synth(sub_ctx, (level + 1), full_body_7651);
        Typechecker$improve_fundeps_in_expr(sub_ctx.vars, sub_ctx.type_env, te_7653);
        let _t7655;
        if ((_eq(params, null) && (!Typechecker$is_syntactic_value(body)))) {
          _t7655 = Typechecker$mono_scheme(te_7653.ty);
        } else {
          _t7655 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, te_7653.ty, Hashtbl$create(0));
        }
        const scheme_7656 = _t7655;
        const scheme_7658 = Typechecker$infer_implicit_constraints("", sub_ctx.type_env, sub_ctx.vars, te_7653, scheme_7656);
        const scheme_7660 = Typechecker$infer_record_evidence(sub_ctx.vars, te_7653, scheme_7658);
        const _t7661 = [te_7653, scheme_7660];
        const _t7659 = _t7661;
        const _t7657 = _t7659;
        const _t7654 = _t7657;
        const _t7652 = _t7654;
        _t7650 = _t7652;
      }
      let _t7663;
      const _t7662 = _t7650;
      _t7664: {
        if (true) {
          const te = _t7662[0];
          const scheme = _t7662[1];
          const sub_ctx$p_7665 = Typechecker$extend_var(sub_ctx, name, scheme);
          const sub_ctx$p_7667 = Typechecker$extend_var(sub_ctx$p_7665, qualified_name_7648, scheme);
          let _t7670;
          const _t7669 = item.vis;
          _t7671: {
            if (_t7669._tag === 0) {
              _t7670 = Ref$set(pub_vars, ({_hd: [name, scheme], _tl: Ref$get(pub_vars)}));
              break _t7671;
            }
            if (true) {
              _t7670 = undefined;
              break _t7671;
            }
            _match_fail("line 16190");
          }
          _t7670;
          const _t7668 = [sub_ctx$p_7667, ({_tag: 0, _name: "TDLet", _val: [qualified_name_7648, te]})];
          const _t7666 = _t7668;
          _t7663 = _t7666;
          break _t7664;
        }
        _match_fail("line 16190");
      }
      const _t7649 = _t7663;
      _t7593 = _t7649;
      break _t7594;
    }
    if (_t7592._tag === 1) {
      const name = _t7592._val[0];
      const body = _t7592._val[1];
      const qualified_name_7672 = (prefix + name);
      const te_7674 = Typechecker$synth(sub_ctx, (level + 1), body);
      const scheme_7676 = Typechecker$mono_scheme(te_7674.ty);
      const sub_ctx$p_7678 = Typechecker$extend_var_mutable(sub_ctx, name, scheme_7676);
      const sub_ctx$p_7680 = Typechecker$extend_var_mutable(sub_ctx$p_7678, qualified_name_7672, scheme_7676);
      let _t7683;
      const _t7682 = item.vis;
      _t7684: {
        if (_t7682._tag === 0) {
          Ref$set(pub_vars, ({_hd: [name, scheme_7676], _tl: Ref$get(pub_vars)}));
          _t7683 = Ref$set(pub_mutable_vars, ({_hd: name, _tl: Ref$get(pub_mutable_vars)}));
          break _t7684;
        }
        if (true) {
          _t7683 = undefined;
          break _t7684;
        }
        _match_fail("line 16190");
      }
      _t7683;
      const _t7681 = [sub_ctx$p_7680, ({_tag: 1, _name: "TDLetMut", _val: [qualified_name_7672, te_7674]})];
      const _t7679 = _t7681;
      const _t7677 = _t7679;
      const _t7675 = _t7677;
      const _t7673 = _t7675;
      _t7593 = _t7673;
      break _t7594;
    }
    if (_t7592._tag === 2) {
      const name = _t7592._val[0];
      const type_params = _t7592._val[1];
      const params = _t7592._val[2];
      const ret_annot = _t7592._val[3];
      const constraints = _t7592._val[4];
      const body = _t7592._val[5];
      const qualified_name_7685 = (prefix + name);
      let _t7687;
      if (!_eq(type_params, null)) {
        _t7687 = Typechecker$synth_poly_rec_fn(sub_ctx, level, name, qualified_name_7685, type_params, params, ret_annot, body);
      } else {
        let _t7688;
        if (!_eq(constraints, null)) {
          const fn_var_7689 = Types$new_tvar((level + 1));
          const sub_ctx_self_7691 = Typechecker$extend_var_mono(sub_ctx, name, fn_var_7689);
          const sub_ctx_self_7693 = Typechecker$extend_var_mono(sub_ctx_self_7691, qualified_name_7685, fn_var_7689);
          let _t7696;
          const _t7695 = Typechecker$synth_constrained_fn(sub_ctx_self_7693, level, constraints, params, ret_annot, body);
          _t7697: {
            if (true) {
              const te = _t7695[0];
              const scheme = _t7695[1];
              Typechecker$try_unify(fn_var_7689, te.ty);
              _t7696 = [te, scheme];
              break _t7697;
            }
            _match_fail("line 16190");
          }
          const _t7694 = _t7696;
          const _t7692 = _t7694;
          const _t7690 = _t7692;
          _t7688 = _t7690;
        } else {
          const full_body_7698 = Typechecker$wrap_params_decl(params, ret_annot, body);
          const fn_var_7700 = Types$new_tvar((level + 1));
          const sub_ctx$p_7702 = Typechecker$extend_var_mono(sub_ctx, name, fn_var_7700);
          const sub_ctx$p_7704 = Typechecker$extend_var_mono(sub_ctx$p_7702, qualified_name_7685, fn_var_7700);
          const fn_te_7706 = Typechecker$synth(sub_ctx$p_7704, (level + 1), full_body_7698);
          Typechecker$try_unify(fn_var_7700, fn_te_7706.ty);
          Typechecker$improve_fundeps_in_expr(sub_ctx.vars, sub_ctx.type_env, fn_te_7706);
          const scheme_7708 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, fn_te_7706.ty, Hashtbl$create(0));
          const scheme_7710 = Typechecker$infer_implicit_constraints(name, sub_ctx.type_env, sub_ctx.vars, fn_te_7706, scheme_7708);
          const scheme_7712 = Typechecker$infer_record_evidence(sub_ctx.vars, fn_te_7706, scheme_7710);
          const _t7713 = [fn_te_7706, scheme_7712];
          const _t7711 = _t7713;
          const _t7709 = _t7711;
          const _t7707 = _t7709;
          const _t7705 = _t7707;
          const _t7703 = _t7705;
          const _t7701 = _t7703;
          const _t7699 = _t7701;
          _t7688 = _t7699;
        }
        _t7687 = _t7688;
      }
      let _t7715;
      const _t7714 = _t7687;
      _t7716: {
        if (true) {
          const fn_te = _t7714[0];
          const scheme = _t7714[1];
          const sub_ctx$p$p_7717 = Typechecker$extend_var(sub_ctx, name, scheme);
          const sub_ctx$p$p_7719 = Typechecker$extend_var(sub_ctx$p$p_7717, qualified_name_7685, scheme);
          let _t7722;
          const _t7721 = item.vis;
          _t7723: {
            if (_t7721._tag === 0) {
              _t7722 = Ref$set(pub_vars, ({_hd: [name, scheme], _tl: Ref$get(pub_vars)}));
              break _t7723;
            }
            if (true) {
              _t7722 = undefined;
              break _t7723;
            }
            _match_fail("line 16190");
          }
          _t7722;
          const _t7720 = [sub_ctx$p$p_7719, ({_tag: 2, _name: "TDLetRec", _val: [qualified_name_7685, fn_te]})];
          const _t7718 = _t7720;
          _t7715 = _t7718;
          break _t7716;
        }
        _match_fail("line 16190");
      }
      const _t7686 = _t7715;
      _t7593 = _t7686;
      break _t7594;
    }
    if (_t7592._tag === 7) {
      const name = _t7592._val[0];
      const tyvars = _t7592._val[1];
      const fundeps = _t7592._val[2];
      const methods = _t7592._val[3];
      const qualified_7724 = (prefix + name);
      let _t7727;
      const _t7726 = Typechecker$process_class_def(sub_ctx, qualified_7724, tyvars, fundeps, methods);
      _t7728: {
        if (true) {
          const sub_ctx$p = _t7726[0];
          const tdecl = _t7726[1];
          const __rec_upd_7729 = sub_ctx$p;
          const __rec_upd_7731 = sub_ctx$p.type_env;
          const _t7732 = ({classes: __rec_upd_7731.classes, constructors: __rec_upd_7731.constructors, effects: __rec_upd_7731.effects, instances: __rec_upd_7731.instances, modules: __rec_upd_7731.modules, mutable_fields: __rec_upd_7731.mutable_fields, records: __rec_upd_7731.records, type_aliases: ({_hd: [name, qualified_7724], _tl: sub_ctx$p.type_env.type_aliases}), type_synonyms: __rec_upd_7731.type_synonyms, variants: __rec_upd_7731.variants});
          const _t7730 = ({constraint_tvars: __rec_upd_7729.constraint_tvars, current_eff: __rec_upd_7729.current_eff, current_module: __rec_upd_7729.current_module, inside_handler: __rec_upd_7729.inside_handler, loop_info: __rec_upd_7729.loop_info, mutable_vars: __rec_upd_7729.mutable_vars, return_type: __rec_upd_7729.return_type, return_used: __rec_upd_7729.return_used, type_env: _t7732, vars: __rec_upd_7729.vars});
          const sub_ctx$p_7733 = _t7730;
          let _t7736;
          const _t7735 = item.vis;
          _t7737: {
            if (_t7735._tag === 0) {
              Ref$set(pub_classes, ({_hd: qualified_7724, _tl: Ref$get(pub_classes)}));
              function _t7738(__p224) {
                let _t7740;
                const _t7739 = __p224;
                _t7741: {
                  if (true) {
                    const mname = _t7739[0];
                    let _t7743;
                    const _t7742 = List$assoc_opt(mname, sub_ctx$p_7733.vars);
                    _t7744: {
                      if (_t7742._tag === 1) {
                        const scheme = _t7742._val;
                        _t7743 = Ref$set(pub_vars, ({_hd: [mname, scheme], _tl: Ref$get(pub_vars)}));
                        break _t7744;
                      }
                      if (_t7742._tag === 0) {
                        _t7743 = undefined;
                        break _t7744;
                      }
                      _match_fail("line 16190");
                    }
                    _t7740 = _t7743;
                    break _t7741;
                  }
                  _match_fail("line 16190");
                }
                return _t7740;
              }
              _t7736 = List$iter(_t7738, methods);
              break _t7737;
            }
            if (true) {
              _t7736 = undefined;
              break _t7737;
            }
            _match_fail("line 16190");
          }
          _t7736;
          const _t7734 = [sub_ctx$p_7733, tdecl];
          _t7727 = _t7734;
          break _t7728;
        }
        _match_fail("line 16190");
      }
      const _t7725 = _t7727;
      _t7593 = _t7725;
      break _t7594;
    }
    if (_t7592._tag === 8) {
      const class_name = _t7592._val[0];
      const inst_ty_annots = _t7592._val[1];
      const constraints = _t7592._val[2];
      const methods = _t7592._val[3];
      let _t7746;
      const _t7745 = Typechecker$process_instance_def(sub_ctx, level, class_name, inst_ty_annots, constraints, methods);
      _t7747: {
        if (true) {
          const sub_ctx$p = _t7745[0];
          const tdecl = _t7745[1];
          function _t7748(inst) {
            function _t7749(prev) {
              return (prev.inst_dict_name === inst.inst_dict_name);
            }
            return (!List$exists(_t7749, sub_ctx.type_env.instances));
          }
          const new_insts_7750 = List$filter(_t7748, sub_ctx$p.type_env.instances);
          Ref$set(all_instances, List$concat(new_insts_7750, Ref$get(all_instances)));
          const _t7751 = [sub_ctx$p, tdecl];
          _t7746 = _t7751;
          break _t7747;
        }
        _match_fail("line 16190");
      }
      _t7593 = _t7746;
      break _t7594;
    }
    if (_t7592._tag === 9) {
      const name = _t7592._val[0];
      const type_params = _t7592._val[1];
      const ops = _t7592._val[2];
      const tvars_7752 = Hashtbl$create(4);
      function _t7754(i, p) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_7752, p, ({_tag: 17, _name: "TGen", _val: i})]);
      }
      List$iteri(_t7754, type_params);
      function _t7755(__p225) {
        let _t7757;
        const _t7756 = __p225;
        _t7758: {
          if (true) {
            const op_name = _t7756[0];
            const annot = _t7756[1];
            const ty_7759 = Typechecker$resolve_ty_annot_shared(sub_ctx, 0, tvars_7752, annot);
            const _t7760 = [op_name, ty_7759];
            _t7757 = _t7760;
            break _t7758;
          }
          _match_fail("line 16190");
        }
        return _t7757;
      }
      const resolved_ops_7761 = List$map(_t7755, ops);
      const effect_def_7763 = ({effect_name: name, effect_ops: resolved_ops_7761, effect_params: type_params});
      const __rec_upd_7765 = sub_ctx.type_env;
      const _t7766 = ({classes: __rec_upd_7765.classes, constructors: __rec_upd_7765.constructors, effects: ({_hd: effect_def_7763, _tl: sub_ctx.type_env.effects}), instances: __rec_upd_7765.instances, modules: __rec_upd_7765.modules, mutable_fields: __rec_upd_7765.mutable_fields, records: __rec_upd_7765.records, type_aliases: __rec_upd_7765.type_aliases, type_synonyms: __rec_upd_7765.type_synonyms, variants: __rec_upd_7765.variants});
      const type_env_7767 = _t7766;
      const __rec_upd_7769 = sub_ctx;
      const _t7770 = ({constraint_tvars: __rec_upd_7769.constraint_tvars, current_eff: __rec_upd_7769.current_eff, current_module: __rec_upd_7769.current_module, inside_handler: __rec_upd_7769.inside_handler, loop_info: __rec_upd_7769.loop_info, mutable_vars: __rec_upd_7769.mutable_vars, return_type: __rec_upd_7769.return_type, return_used: __rec_upd_7769.return_used, type_env: type_env_7767, vars: __rec_upd_7769.vars});
      const sub_ctx$p_7771 = _t7770;
      const _t7772 = [sub_ctx$p_7771, ({_tag: 7, _name: "TDEffect", _val: name})];
      const _t7768 = _t7772;
      const _t7764 = _t7768;
      const _t7762 = _t7764;
      const _t7753 = _t7762;
      _t7593 = _t7753;
      break _t7594;
    }
    if (_t7592._tag === 10) {
      const name = _t7592._val[0];
      const ty_annot = _t7592._val[1];
      const qualified_name_7773 = (prefix + name);
      const tvars_7775 = Hashtbl$create(4);
      const ty_7777 = Typechecker$resolve_ty_annot_shared(sub_ctx, 1, tvars_7775, ty_annot);
      const scheme_7779 = Types$generalize(0, ty_7777);
      const sub_ctx$p_7781 = Typechecker$extend_var(sub_ctx, name, scheme_7779);
      const sub_ctx$p_7783 = Typechecker$extend_var(sub_ctx$p_7781, qualified_name_7773, scheme_7779);
      let _t7786;
      const _t7785 = item.vis;
      _t7787: {
        if (_t7785._tag === 0) {
          _t7786 = Ref$set(pub_vars, ({_hd: [name, scheme_7779], _tl: Ref$get(pub_vars)}));
          break _t7787;
        }
        if (true) {
          _t7786 = undefined;
          break _t7787;
        }
        _match_fail("line 16190");
      }
      _t7786;
      const _t7784 = [sub_ctx$p_7783, ({_tag: 8, _name: "TDExtern", _val: [qualified_name_7773, scheme_7779]})];
      const _t7782 = _t7784;
      const _t7780 = _t7782;
      const _t7778 = _t7780;
      const _t7776 = _t7778;
      const _t7774 = _t7776;
      _t7593 = _t7774;
      break _t7594;
    }
    if (_t7592._tag === 6) {
      const expr = _t7592._val;
      const te_7788 = Typechecker$synth(sub_ctx, level, expr);
      const _t7789 = [sub_ctx, ({_tag: 5, _name: "TDExpr", _val: te_7788})];
      _t7593 = _t7789;
      break _t7594;
    }
    if (_t7592._tag === 12) {
      const mod_name = _t7592._val[0];
      const names_opt = _t7592._val[1];
      const sub_ctx$p_7790 = Typechecker$open_module_into_ctx(sub_ctx, mod_name, names_opt);
      let _t7793;
      const _t7792 = Typechecker$find_module_in_env(sub_ctx.type_env, mod_name);
      _t7794: {
        if (_t7792._tag === 1) {
          const m = _t7792._val;
          _t7793 = m;
          break _t7794;
        }
        if (_t7792._tag === 0) {
          _t7793 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
          break _t7794;
        }
        _match_fail("line 16190");
      }
      const minfo_7795 = _t7793;
      function _t7797(qname) {
        function _t7798(c) {
          return (c.class_name === qname);
        }
        let _t7800;
        const _t7799 = List$find(_t7798, sub_ctx.type_env.classes);
        _t7801: {
          if (_t7799._tag === 1) {
            const cls = _t7799._val;
            _t7800 = List$map(fst, cls.class_methods);
            break _t7801;
          }
          if (_t7799._tag === 0) {
            _t7800 = null;
            break _t7801;
          }
          _match_fail("line 16190");
        }
        return _t7800;
      }
      const class_method_names_7802 = List$concat_map(_t7797, minfo_7795.mod_pub_classes);
      function _t7804(name) {
        let _t7806;
        const _t7805 = names_opt;
        _t7807: {
          if (_t7805._tag === 0) {
            _t7806 = true;
            break _t7807;
          }
          if (_t7805._tag === 1) {
            const names = _t7805._val;
            _t7806 = List$mem(name, names);
            break _t7807;
          }
          _match_fail("line 16190");
        }
        return _t7806;
      }
      const filter_7808 = _t7804;
      function _t7810(__p226) {
        let _t7812;
        const _t7811 = __p226;
        _t7813: {
          if (true) {
            const _mml$short = _t7811[0];
            const scheme = _t7811[1];
            let _t7814;
            if ((filter_7808(_mml$short) && (!List$mem(_mml$short, class_method_names_7802)))) {
              const qualified_dst_7815 = (prefix + _mml$short);
              const qualified_src_7817 = (mod_name + ("." + _mml$short));
              scheme;
              undefined;
              const _t7818 = ({_tag: 1, _name: "Some", _val: [qualified_dst_7815, qualified_src_7817]});
              const _t7816 = _t7818;
              _t7814 = _t7816;
            } else {
              _t7814 = ({_tag: 0, _name: "None"});
            }
            _t7812 = _t7814;
            break _t7813;
          }
          _match_fail("line 16190");
        }
        return _t7812;
      }
      const alias_pairs_7819 = List$filter_map(_t7810, minfo_7795.mod_pub_vars);
      function _t7821(ctx, __p227) {
        let _t7823;
        const _t7822 = __p227;
        _t7824: {
          if (true) {
            const _mml$short = _t7822[0];
            const scheme = _t7822[1];
            let _t7825;
            if ((filter_7808(_mml$short) && (!List$mem(_mml$short, class_method_names_7802)))) {
              _t7825 = Typechecker$extend_var(ctx, (prefix + _mml$short), scheme);
            } else {
              _t7825 = ctx;
            }
            _t7823 = _t7825;
            break _t7824;
          }
          _match_fail("line 16190");
        }
        return _t7823;
      }
      const sub_ctx$p_7826 = List$fold(_t7821, sub_ctx$p_7790, minfo_7795.mod_pub_vars);
      const _t7827 = [sub_ctx$p_7826, ({_tag: 10, _name: "TDOpen", _val: alias_pairs_7819})];
      const _t7820 = _t7827;
      const _t7809 = _t7820;
      const _t7803 = _t7809;
      const _t7796 = _t7803;
      const _t7791 = _t7796;
      _t7593 = _t7791;
      break _t7594;
    }
    if (_t7592._tag === 3) {
      const bindings = _t7592._val;
      function _t7828(__p228) {
        let _t7830;
        const _t7829 = __p228;
        _t7831: {
          if (true) {
            const tp = _t7829[1];
            _t7830 = !_eq(tp, null);
            break _t7831;
          }
          _match_fail("line 16190");
        }
        return _t7830;
      }
      const has_poly_7832 = List$exists(_t7828, bindings);
      let _t7834;
      if (has_poly_7832) {
        function _t7835(__p229) {
          let _t7837;
          const _t7836 = __p229;
          _t7838: {
            if (true) {
              const type_params = _t7836[1];
              const params = _t7836[2];
              const ret_annot = _t7836[3];
              const shared_tvars_7839 = Hashtbl$create(4);
              function _t7841(tp) {
                return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_7839, tp, Types$new_tvar((level + 1))]);
              }
              List$iter(_t7841, type_params);
              function _t7842(p) {
                let _t7844;
                const _t7843 = p.annot;
                _t7845: {
                  if (_t7843._tag === 1) {
                    const annot = _t7843._val;
                    _t7844 = Typechecker$resolve_ty_annot_shared(sub_ctx, (level + 1), shared_tvars_7839, annot);
                    break _t7845;
                  }
                  if (_t7843._tag === 0) {
                    _t7844 = Types$new_tvar((level + 1));
                    break _t7845;
                  }
                  _match_fail("line 16190");
                }
                return _t7844;
              }
              const param_tys_7846 = List$map(_t7842, params);
              let _t7849;
              const _t7848 = ret_annot;
              _t7850: {
                if (_t7848._tag === 1 && _t7848._val._tag === 11) {
                  const ty = _t7848._val._val[0];
                  const eff_annot = _t7848._val._val[1];
                  const ty$p_7851 = Typechecker$resolve_ty_annot_shared(sub_ctx, (level + 1), shared_tvars_7839, ty);
                  let _t7854;
                  const _t7853 = eff_annot;
                  _t7855: {
                    if (_t7853._tag === 0) {
                      _t7854 = ({_tag: 1, _name: "EffEmpty"});
                      break _t7855;
                    }
                    if (_t7853._tag === 1) {
                      const items = _t7853._val;
                      _t7854 = Typechecker$resolve_eff_items(sub_ctx, (level + 1), shared_tvars_7839, items);
                      break _t7855;
                    }
                    _match_fail("line 16190");
                  }
                  const eff_7856 = _t7854;
                  const _t7857 = [ty$p_7851, eff_7856];
                  const _t7852 = _t7857;
                  _t7849 = _t7852;
                  break _t7850;
                }
                if (_t7848._tag === 1) {
                  const annot = _t7848._val;
                  _t7849 = [Typechecker$resolve_ty_annot_shared(sub_ctx, (level + 1), shared_tvars_7839, annot), Types$new_effvar((level + 1))];
                  break _t7850;
                }
                if (_t7848._tag === 0) {
                  _t7849 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
                  break _t7850;
                }
                _match_fail("line 16190");
              }
              let _t7859;
              const _t7858 = _t7849;
              _t7860: {
                if (true) {
                  const ret_ty = _t7858[0];
                  const body_eff = _t7858[1];
                  let _t7862;
                  const _t7861 = List$rev(param_tys_7846);
                  _t7863: {
                    if (_t7861 === null) {
                      _t7862 = ret_ty;
                      break _t7863;
                    }
                    if (_t7861 !== null) {
                      const last = _t7861._hd;
                      const rest = _t7861._tl;
                      const inner_7864 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
                      function _t7866(acc, pty) {
                        return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
                      }
                      const _t7865 = List$fold(_t7866, inner_7864, rest);
                      _t7862 = _t7865;
                      break _t7863;
                    }
                    _match_fail("line 16190");
                  }
                  const fn_ty_7867 = _t7862;
                  const _t7868 = [shared_tvars_7839, param_tys_7846, ret_ty, body_eff, fn_ty_7867];
                  _t7859 = _t7868;
                  break _t7860;
                }
                _match_fail("line 16190");
              }
              const _t7847 = _t7859;
              const _t7840 = _t7847;
              _t7837 = _t7840;
              break _t7838;
            }
            _match_fail("line 16190");
          }
          return _t7837;
        }
        const shared_tvars_list_7869 = List$map(_t7835, bindings);
        function _t7871(__p230) {
          let _t7873;
          const _t7872 = __p230;
          _t7874: {
            if (true) {
              const fn_ty = _t7872[4];
              _t7873 = Types$generalize(level, fn_ty);
              break _t7874;
            }
            _match_fail("line 16190");
          }
          return _t7873;
        }
        const schemes_7875 = List$map(_t7871, shared_tvars_list_7869);
        function _t7877(ctx, __p231, scheme) {
          let _t7879;
          const _t7878 = __p231;
          _t7880: {
            if (true) {
              const name = _t7878[0];
              const qualified_name_7881 = (prefix + name);
              const ctx_7883 = Typechecker$extend_var(ctx, name, scheme);
              const _t7884 = Typechecker$extend_var(ctx_7883, qualified_name_7881, scheme);
              const _t7882 = _t7884;
              _t7879 = _t7882;
              break _t7880;
            }
            _match_fail("line 16190");
          }
          return _t7879;
        }
        const sub_ctx$p_7885 = List$fold2(_t7877, sub_ctx, bindings, schemes_7875);
        function _t7887(__p232, __p233) {
          let _t7889;
          const _t7888 = __p232;
          _t7890: {
            if (true) {
              const params = _t7888[2];
              const body = _t7888[5];
              let _t7892;
              const _t7891 = __p233;
              _t7893: {
                if (true) {
                  const param_tys = _t7891[1];
                  const ret_ty = _t7891[2];
                  const body_eff = _t7891[3];
                  function _t7894(c, p, ty) {
                    return Typechecker$extend_var_mono(c, p.name, ty);
                  }
                  const __rec_upd_7895 = sub_ctx$p_7885;
                  const _t7896 = ({constraint_tvars: __rec_upd_7895.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_7895.current_module, inside_handler: __rec_upd_7895.inside_handler, loop_info: __rec_upd_7895.loop_info, mutable_vars: __rec_upd_7895.mutable_vars, return_type: __rec_upd_7895.return_type, return_used: __rec_upd_7895.return_used, type_env: __rec_upd_7895.type_env, vars: __rec_upd_7895.vars});
                  const inner_ctx_7897 = List$fold2(_t7894, _t7896, params, param_tys);
                  const body_te_7899 = Typechecker$check(inner_ctx_7897, (level + 1), body, ret_ty);
                  let _t7902;
                  const _t7901 = [List$rev(params), List$rev(param_tys)];
                  _t7903: {
                    if (_t7901[0] === null && _t7901[1] === null) {
                      _t7902 = body_te_7899;
                      break _t7903;
                    }
                    if (_t7901[0] !== null && _t7901[1] !== null) {
                      const last_p = _t7901[0]._hd;
                      const rest_ps = _t7901[0]._tl;
                      const last_pty = _t7901[1]._hd;
                      const rest_ptys = _t7901[1]._tl;
                      const inner_7904 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_7899, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_7899.ty]}));
                      function _t7906(acc, p, pty) {
                        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
                      }
                      const _t7905 = List$fold2(_t7906, inner_7904, rest_ps, rest_ptys);
                      _t7902 = _t7905;
                      break _t7903;
                    }
                    if (true) {
                      _t7902 = failwith("assert false");
                      break _t7903;
                    }
                    _match_fail("line 16190");
                  }
                  const _t7900 = _t7902;
                  const _t7898 = _t7900;
                  _t7892 = _t7898;
                  break _t7893;
                }
                _match_fail("line 16190");
              }
              _t7889 = _t7892;
              break _t7890;
            }
            _match_fail("line 16190");
          }
          return _t7889;
        }
        const body_tes_7907 = List$map2(_t7887, bindings, shared_tvars_list_7869);
        function _t7909(ctx, __p234, scheme) {
          let _t7911;
          const _t7910 = __p234;
          _t7912: {
            if (true) {
              const name = _t7910[0];
              const qualified_name_7913 = (prefix + name);
              const ctx_7915 = Typechecker$extend_var(ctx, name, scheme);
              const _t7916 = Typechecker$extend_var(ctx_7915, qualified_name_7913, scheme);
              const _t7914 = _t7916;
              _t7911 = _t7914;
              break _t7912;
            }
            _match_fail("line 16190");
          }
          return _t7911;
        }
        const sub_ctx$p$p_7917 = List$fold2(_t7909, sub_ctx, bindings, schemes_7875);
        function _t7919(__p235, te) {
          let _t7921;
          const _t7920 = __p235;
          _t7922: {
            if (true) {
              const name = _t7920[0];
              const qualified_name_7923 = (prefix + name);
              const _t7924 = [qualified_name_7923, te];
              _t7921 = _t7924;
              break _t7922;
            }
            _match_fail("line 16190");
          }
          return _t7921;
        }
        const typed_bindings_7925 = List$map2(_t7919, bindings, body_tes_7907);
        function _t7927(__p236) {
          let _t7929;
          const _t7928 = __p236;
          _t7930: {
            if (true) {
              const name = _t7928[0];
              function _t7931(__p237, s) {
                let _t7933;
                const _t7932 = __p237;
                _t7934: {
                  if (true) {
                    const n = _t7932[0];
                    _t7933 = [n, s];
                    break _t7934;
                  }
                  _match_fail("line 16190");
                }
                return _t7933;
              }
              const scheme_7935 = List$assoc(name, List$map2(_t7931, bindings, schemes_7875));
              let _t7938;
              const _t7937 = item.vis;
              _t7939: {
                if (_t7937._tag === 0) {
                  _t7938 = Ref$set(pub_vars, ({_hd: [name, scheme_7935], _tl: Ref$get(pub_vars)}));
                  break _t7939;
                }
                if (true) {
                  _t7938 = undefined;
                  break _t7939;
                }
                _match_fail("line 16190");
              }
              const _t7936 = _t7938;
              _t7929 = _t7936;
              break _t7930;
            }
            _match_fail("line 16190");
          }
          return _t7929;
        }
        List$iter(_t7927, bindings);
        const _t7926 = [sub_ctx$p$p_7917, ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_7925})];
        const _t7918 = _t7926;
        const _t7908 = _t7918;
        const _t7886 = _t7908;
        const _t7876 = _t7886;
        const _t7870 = _t7876;
        _t7834 = _t7870;
      } else {
        function _t7940(__p238) {
          let _t7942;
          const _t7941 = __p238;
          _t7943: {
            if (true) {
              const name = _t7941[0];
              _t7942 = [name, Types$new_tvar((level + 1))];
              break _t7943;
            }
            _match_fail("line 16190");
          }
          return _t7942;
        }
        const fn_vars_7944 = List$map(_t7940, bindings);
        function _t7946(ctx, __p239) {
          let _t7948;
          const _t7947 = __p239;
          _t7949: {
            if (true) {
              const name = _t7947[0];
              const tv = _t7947[1];
              const qualified_name_7950 = (prefix + name);
              const ctx_7952 = Typechecker$extend_var_mono(ctx, name, tv);
              const _t7953 = Typechecker$extend_var_mono(ctx_7952, qualified_name_7950, tv);
              const _t7951 = _t7953;
              _t7948 = _t7951;
              break _t7949;
            }
            _match_fail("line 16190");
          }
          return _t7948;
        }
        const sub_ctx$p_7954 = List$fold(_t7946, sub_ctx, fn_vars_7944);
        function _t7956(__p240, __p241) {
          let _t7958;
          const _t7957 = __p240;
          _t7959: {
            if (true) {
              const name = _t7957[0];
              const params = _t7957[2];
              const ret_annot = _t7957[3];
              const constraints = _t7957[4];
              const body = _t7957[5];
              let _t7961;
              const _t7960 = __p241;
              _t7962: {
                if (true) {
                  const tv = _t7960[1];
                  name;
                  undefined;
                  let _t7963;
                  if (!_eq(constraints, null)) {
                    let _t7965;
                    const _t7964 = Typechecker$synth_constrained_fn(sub_ctx$p_7954, level, constraints, params, ret_annot, body);
                    _t7966: {
                      if (true) {
                        const te = _t7964[0];
                        const _scheme = _t7964[1];
                        Typechecker$try_unify(tv, te.ty);
                        _t7965 = te;
                        break _t7966;
                      }
                      _match_fail("line 16190");
                    }
                    _t7963 = _t7965;
                  } else {
                    const full_body_7967 = Typechecker$wrap_params_decl(params, ret_annot, body);
                    const te_7969 = Typechecker$synth(sub_ctx$p_7954, (level + 1), full_body_7967);
                    Typechecker$try_unify(tv, te_7969.ty);
                    const _t7970 = te_7969;
                    const _t7968 = _t7970;
                    _t7963 = _t7968;
                  }
                  _t7961 = _t7963;
                  break _t7962;
                }
                _match_fail("line 16190");
              }
              _t7958 = _t7961;
              break _t7959;
            }
            _match_fail("line 16190");
          }
          return _t7958;
        }
        const body_tes_7971 = List$map2(_t7956, bindings, fn_vars_7944);
        function _t7973(ctx, __p242, __p243) {
          let _t7975;
          const _t7974 = __p242;
          _t7976: {
            if (true) {
              const name = _t7974[0];
              let _t7978;
              const _t7977 = __p243;
              _t7979: {
                if (true) {
                  const tv = _t7977[1];
                  const qualified_name_7980 = (prefix + name);
                  const scheme_7982 = Types$generalize(level, tv);
                  const ctx_7984 = Typechecker$extend_var(ctx, name, scheme_7982);
                  const _t7985 = Typechecker$extend_var(ctx_7984, qualified_name_7980, scheme_7982);
                  const _t7983 = _t7985;
                  const _t7981 = _t7983;
                  _t7978 = _t7981;
                  break _t7979;
                }
                _match_fail("line 16190");
              }
              _t7975 = _t7978;
              break _t7976;
            }
            _match_fail("line 16190");
          }
          return _t7975;
        }
        const sub_ctx$p$p_7986 = List$fold2(_t7973, sub_ctx, bindings, fn_vars_7944);
        function _t7988(__p244, te) {
          let _t7990;
          const _t7989 = __p244;
          _t7991: {
            if (true) {
              const name = _t7989[0];
              const qualified_name_7992 = (prefix + name);
              const _t7993 = [qualified_name_7992, te];
              _t7990 = _t7993;
              break _t7991;
            }
            _match_fail("line 16190");
          }
          return _t7990;
        }
        const typed_bindings_7994 = List$map2(_t7988, bindings, body_tes_7971);
        function _t7996(__p245, __p246) {
          let _t7998;
          const _t7997 = __p245;
          _t7999: {
            if (true) {
              const name = _t7997[0];
              let _t8001;
              const _t8000 = __p246;
              _t8002: {
                if (true) {
                  const tv = _t8000[1];
                  const scheme_8003 = Types$generalize(level, tv);
                  let _t8006;
                  const _t8005 = item.vis;
                  _t8007: {
                    if (_t8005._tag === 0) {
                      _t8006 = Ref$set(pub_vars, ({_hd: [name, scheme_8003], _tl: Ref$get(pub_vars)}));
                      break _t8007;
                    }
                    if (true) {
                      _t8006 = undefined;
                      break _t8007;
                    }
                    _match_fail("line 16190");
                  }
                  const _t8004 = _t8006;
                  _t8001 = _t8004;
                  break _t8002;
                }
                _match_fail("line 16190");
              }
              _t7998 = _t8001;
              break _t7999;
            }
            _match_fail("line 16190");
          }
          return _t7998;
        }
        List$iter2(_t7996, bindings, fn_vars_7944);
        const _t7995 = [sub_ctx$p$p_7986, ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_7994})];
        const _t7987 = _t7995;
        const _t7972 = _t7987;
        const _t7955 = _t7972;
        const _t7945 = _t7955;
        _t7834 = _t7945;
      }
      const _t7833 = _t7834;
      _t7593 = _t7833;
      break _t7594;
    }
    if (_t7592._tag === 5) {
      const type_defs = _t7592._val;
      function _t8008(ctx, __p247) {
        let _t8010;
        const _t8009 = __p247;
        _t8011: {
          if (true) {
            const type_params = _t8009[0];
            const name = _t8009[1];
            const def = _t8009[2];
            const _deriving = _t8009[3];
            const qualified_name_8012 = (prefix + name);
            const num_params_8014 = List$length(type_params);
            const __rec_upd_8016 = ctx;
            const __rec_upd_8018 = ctx.type_env;
            const _t8019 = ({classes: __rec_upd_8018.classes, constructors: __rec_upd_8018.constructors, effects: __rec_upd_8018.effects, instances: __rec_upd_8018.instances, modules: __rec_upd_8018.modules, mutable_fields: __rec_upd_8018.mutable_fields, records: __rec_upd_8018.records, type_aliases: ({_hd: [name, qualified_name_8012], _tl: ctx.type_env.type_aliases}), type_synonyms: __rec_upd_8018.type_synonyms, variants: __rec_upd_8018.variants});
            const _t8017 = ({constraint_tvars: __rec_upd_8016.constraint_tvars, current_eff: __rec_upd_8016.current_eff, current_module: __rec_upd_8016.current_module, inside_handler: __rec_upd_8016.inside_handler, loop_info: __rec_upd_8016.loop_info, mutable_vars: __rec_upd_8016.mutable_vars, return_type: __rec_upd_8016.return_type, return_used: __rec_upd_8016.return_used, type_env: _t8019, vars: __rec_upd_8016.vars});
            const ctx_8020 = _t8017;
            let _t8023;
            const _t8022 = def;
            _t8024: {
              if (_t8022._tag === 0) {
                const __rec_upd_8025 = ctx_8020;
                const __rec_upd_8027 = ctx_8020.type_env;
                const _t8028 = ({classes: __rec_upd_8027.classes, constructors: __rec_upd_8027.constructors, effects: __rec_upd_8027.effects, instances: __rec_upd_8027.instances, modules: __rec_upd_8027.modules, mutable_fields: __rec_upd_8027.mutable_fields, records: __rec_upd_8027.records, type_aliases: __rec_upd_8027.type_aliases, type_synonyms: __rec_upd_8027.type_synonyms, variants: ({_hd: [qualified_name_8012, num_params_8014, null, false], _tl: ctx_8020.type_env.variants})});
                const _t8026 = ({constraint_tvars: __rec_upd_8025.constraint_tvars, current_eff: __rec_upd_8025.current_eff, current_module: __rec_upd_8025.current_module, inside_handler: __rec_upd_8025.inside_handler, loop_info: __rec_upd_8025.loop_info, mutable_vars: __rec_upd_8025.mutable_vars, return_type: __rec_upd_8025.return_type, return_used: __rec_upd_8025.return_used, type_env: _t8028, vars: __rec_upd_8025.vars});
                _t8023 = _t8026;
                break _t8024;
              }
              if (_t8022._tag === 1) {
                const __rec_upd_8029 = ctx_8020;
                const __rec_upd_8031 = ctx_8020.type_env;
                const _t8032 = ({classes: __rec_upd_8031.classes, constructors: __rec_upd_8031.constructors, effects: __rec_upd_8031.effects, instances: __rec_upd_8031.instances, modules: __rec_upd_8031.modules, mutable_fields: __rec_upd_8031.mutable_fields, records: ({_hd: [qualified_name_8012, null], _tl: ctx_8020.type_env.records}), type_aliases: __rec_upd_8031.type_aliases, type_synonyms: __rec_upd_8031.type_synonyms, variants: __rec_upd_8031.variants});
                const _t8030 = ({constraint_tvars: __rec_upd_8029.constraint_tvars, current_eff: __rec_upd_8029.current_eff, current_module: __rec_upd_8029.current_module, inside_handler: __rec_upd_8029.inside_handler, loop_info: __rec_upd_8029.loop_info, mutable_vars: __rec_upd_8029.mutable_vars, return_type: __rec_upd_8029.return_type, return_used: __rec_upd_8029.return_used, type_env: _t8032, vars: __rec_upd_8029.vars});
                _t8023 = _t8030;
                break _t8024;
              }
              if (_t8022._tag === 2) {
                _t8023 = ctx_8020;
                break _t8024;
              }
              _match_fail("line 16190");
            }
            const _t8021 = _t8023;
            const _t8015 = _t8021;
            const _t8013 = _t8015;
            _t8010 = _t8013;
            break _t8011;
          }
          _match_fail("line 16190");
        }
        return _t8010;
      }
      const sub_ctx$p_8033 = List$fold(_t8008, sub_ctx, type_defs);
      function _t8035(ctx, __p248) {
        let _t8037;
        const _t8036 = __p248;
        _t8038: {
          if (true) {
            const type_params = _t8036[0];
            const name = _t8036[1];
            const def = _t8036[2];
            const _deriving = _t8036[3];
            let _t8040;
            const _t8039 = def;
            _t8041: {
              if (_t8039._tag === 1) {
                const qualified_name_8042 = (prefix + name);
                const _t8043 = Typechecker$process_type_def(ctx, type_params, qualified_name_8042, def);
                _t8040 = _t8043;
                break _t8041;
              }
              if (true) {
                _t8040 = ctx;
                break _t8041;
              }
              _match_fail("line 16190");
            }
            _t8037 = _t8040;
            break _t8038;
          }
          _match_fail("line 16190");
        }
        return _t8037;
      }
      const sub_ctx$p_8044 = List$fold(_t8035, sub_ctx$p_8033, type_defs);
      function _t8046(ctx, __p249) {
        let _t8048;
        const _t8047 = __p249;
        _t8049: {
          if (true) {
            const type_params = _t8047[0];
            const name = _t8047[1];
            const def = _t8047[2];
            const _deriving = _t8047[3];
            let _t8051;
            const _t8050 = def;
            _t8052: {
              if (_t8050._tag === 1) {
                _t8051 = ctx;
                break _t8052;
              }
              if (true) {
                const qualified_name_8053 = (prefix + name);
                const _t8054 = Typechecker$process_type_def(ctx, type_params, qualified_name_8053, def);
                _t8051 = _t8054;
                break _t8052;
              }
              _match_fail("line 16190");
            }
            _t8048 = _t8051;
            break _t8049;
          }
          _match_fail("line 16190");
        }
        return _t8048;
      }
      const sub_ctx$p_8055 = List$fold(_t8046, sub_ctx$p_8044, type_defs);
      function _t8057(__p250) {
        let _t8059;
        const _t8058 = __p250;
        _t8060: {
          if (true) {
            const _type_params = _t8058[0];
            const name = _t8058[1];
            const def = _t8058[2];
            const _deriving = _t8058[3];
            const qualified_name_8061 = (prefix + name);
            let _t8064;
            const _t8063 = item.vis;
            _t8065: {
              if (_t8063._tag === 0) {
                Ref$set(pub_types, ({_hd: qualified_name_8061, _tl: Ref$get(pub_types)}));
                let _t8067;
                const _t8066 = def;
                _t8068: {
                  if (_t8066._tag === 0) {
                    const ctors = _t8066._val;
                    function _t8069(__p251) {
                      let _t8071;
                      const _t8070 = __p251;
                      _t8072: {
                        if (true) {
                          const ctor_name = _t8070[0];
                          let _t8074;
                          const _t8073 = List$assoc_opt(ctor_name, sub_ctx$p_8055.type_env.constructors);
                          _t8075: {
                            if (_t8073._tag === 1) {
                              const info = _t8073._val;
                              const __rec_upd_8076 = info;
                              const _t8077 = ({ctor_arg_ty: __rec_upd_8076.ctor_arg_ty, ctor_existentials: __rec_upd_8076.ctor_existentials, ctor_num_params: __rec_upd_8076.ctor_num_params, ctor_return_ty_params: __rec_upd_8076.ctor_return_ty_params, ctor_type_name: qualified_name_8061});
                              const qual_info_8078 = _t8077;
                              const _t8079 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_8078], _tl: Ref$get(pub_constructors)}));
                              _t8074 = _t8079;
                              break _t8075;
                            }
                            if (_t8073._tag === 0) {
                              _t8074 = undefined;
                              break _t8075;
                            }
                            _match_fail("line 16190");
                          }
                          _t8071 = _t8074;
                          break _t8072;
                        }
                        _match_fail("line 16190");
                      }
                      return _t8071;
                    }
                    _t8067 = List$iter(_t8069, ctors);
                    break _t8068;
                  }
                  if ((_t8066._tag === 1 || _t8066._tag === 2)) {
                    _t8067 = undefined;
                    break _t8068;
                  }
                  _match_fail("line 16190");
                }
                _t8064 = _t8067;
                break _t8065;
              }
              if (_t8063._tag === 2) {
                Ref$set(pub_types, ({_hd: qualified_name_8061, _tl: Ref$get(pub_types)}));
                _t8064 = Ref$set(opaque_types, ({_hd: qualified_name_8061, _tl: Ref$get(opaque_types)}));
                break _t8065;
              }
              if (_t8063._tag === 1) {
                _t8064 = undefined;
                break _t8065;
              }
              _match_fail("line 16190");
            }
            const _t8062 = _t8064;
            _t8059 = _t8062;
            break _t8060;
          }
          _match_fail("line 16190");
        }
        return _t8059;
      }
      List$iter(_t8057, type_defs);
      function _t8080(ctx, __p252) {
        let _t8082;
        const _t8081 = __p252;
        _t8083: {
          if (true) {
            const type_params = _t8081[0];
            const name = _t8081[1];
            const def = _t8081[2];
            const deriving_ = _t8081[3];
            function _t8084(ctx, cls) {
              let _t8086;
              const _t8085 = Typechecker$generate_derived_instance(type_params, name, def, cls);
              _t8087: {
                if (_t8085._tag === 1) {
                  const class_name = _t8085._val[0];
                  const inst_tys = _t8085._val[1];
                  const constraints = _t8085._val[2];
                  const methods = _t8085._val[3];
                  let _t8089;
                  const _t8088 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
                  _t8090: {
                    if (true) {
                      const ctx$p = _t8088[0];
                      const tdecl = _t8088[1];
                      Ref$set(typed_decls, ({_hd: tdecl, _tl: Ref$get(typed_decls)}));
                      Ref$set(all_instances, ctx$p.type_env.instances);
                      _t8089 = ctx$p;
                      break _t8090;
                    }
                    _match_fail("line 16190");
                  }
                  _t8086 = _t8089;
                  break _t8087;
                }
                if (_t8085._tag === 0) {
                  _t8086 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
                  break _t8087;
                }
                _match_fail("line 16190");
              }
              return _t8086;
            }
            _t8082 = List$fold(_t8084, ctx, deriving_);
            break _t8083;
          }
          _match_fail("line 16190");
        }
        return _t8082;
      }
      const sub_ctx$p_8091 = List$fold(_t8080, sub_ctx$p_8055, type_defs);
      function _t8093(__p253) {
        let _t8095;
        const _t8094 = __p253;
        _t8096: {
          if (true) {
            const _tp = _t8094[0];
            const name = _t8094[1];
            const def = _t8094[2];
            const _d = _t8094[3];
            _t8095 = ({_tag: 4, _name: "TDType", _val: [(prefix + name), def]});
            break _t8096;
          }
          _match_fail("line 16190");
        }
        return _t8095;
      }
      const type_decls_8097 = List$map(_t8093, type_defs);
      function push_all_but_last(__x) {
        while (true) {
          let _t8100;
          const _t8099 = __x;
          _t8101: {
            if (_t8099 === null) {
              _t8100 = failwith("empty DTypeAnd");
              break _t8101;
            }
            if (_t8099 !== null && _t8099._tl === null) {
              const last = _t8099._hd;
              _t8100 = last;
              break _t8101;
            }
            if (_t8099 !== null) {
              const hd = _t8099._hd;
              const tl = _t8099._tl;
              Ref$set(typed_decls, ({_hd: hd, _tl: Ref$get(typed_decls)}));
              const _t8102 = tl;
              __x = _t8102;
              continue;
              _t8100 = undefined;
              break _t8101;
            }
            _match_fail("line 16190");
          }
          return _t8100;
        }
      }
      const last_tdecl_8104 = push_all_but_last(type_decls_8097);
      const _t8105 = [sub_ctx$p_8091, last_tdecl_8104];
      const _t8103 = _t8105;
      const _t8098 = _t8103;
      const _t8092 = _t8098;
      const _t8056 = _t8092;
      const _t8045 = _t8056;
      const _t8034 = _t8045;
      _t7593 = _t8034;
      break _t7594;
    }
    _match_fail("line 16190");
  }
  const _t7591 = _t7593;
  return _t7591;
}
function Typechecker$process_open(ctx, mod_name, names_opt) {
  let _t8107;
  const _t8106 = Typechecker$find_module_in_env(ctx.type_env, mod_name);
  _t8108: {
    if (_t8106._tag === 1) {
      const m = _t8106._val;
      _t8107 = m;
      break _t8108;
    }
    if (_t8106._tag === 0) {
      _t8107 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
      break _t8108;
    }
    _match_fail("line 16190");
  }
  const minfo_8109 = _t8107;
  function _t8111(qname) {
    function _t8112(c) {
      return (c.class_name === qname);
    }
    let _t8114;
    const _t8113 = List$find(_t8112, ctx.type_env.classes);
    _t8115: {
      if (_t8113._tag === 1) {
        const cls = _t8113._val;
        _t8114 = List$map(fst, cls.class_methods);
        break _t8115;
      }
      if (_t8113._tag === 0) {
        _t8114 = null;
        break _t8115;
      }
      _match_fail("line 16190");
    }
    return _t8114;
  }
  const class_method_names_8116 = List$concat_map(_t8111, minfo_8109.mod_pub_classes);
  const alias_pairs_8118 = Ref$create(null);
  function _t8120(name) {
    let _t8122;
    const _t8121 = names_opt;
    _t8123: {
      if (_t8121._tag === 0) {
        _t8122 = true;
        break _t8123;
      }
      if (_t8121._tag === 1) {
        const names = _t8121._val;
        _t8122 = List$mem(name, names);
        break _t8123;
      }
      _match_fail("line 16190");
    }
    return _t8122;
  }
  const filter_8124 = _t8120;
  function _t8126(__p254) {
    let _t8128;
    const _t8127 = __p254;
    _t8129: {
      if (true) {
        const _mml$short = _t8127[0];
        const _scheme = _t8127[1];
        let _t8130;
        if ((filter_8124(_mml$short) && (!List$mem(_mml$short, class_method_names_8116)))) {
          const qualified_8131 = (mod_name + ("." + _mml$short));
          const _t8132 = Ref$set(alias_pairs_8118, ({_hd: [_mml$short, qualified_8131], _tl: Ref$get(alias_pairs_8118)}));
          _t8130 = _t8132;
        } else {
          _t8130 = undefined;
        }
        _t8128 = _t8130;
        break _t8129;
      }
      _match_fail("line 16190");
    }
    return _t8128;
  }
  List$iter(_t8126, minfo_8109.mod_pub_vars);
  const ctx$p_8133 = Typechecker$open_module_into_ctx(ctx, mod_name, names_opt);
  const _t8134 = [ctx$p_8133, ({_tag: 10, _name: "TDOpen", _val: Ref$get(alias_pairs_8118)})];
  const _t8125 = _t8134;
  const _t8119 = _t8125;
  const _t8117 = _t8119;
  const _t8110 = _t8117;
  return _t8110;
}
function Typechecker$check_decl(ctx, level, decl) {
  let _t8136;
  const _t8135 = decl;
  _t8137: {
    if (_t8135._tag === 4) {
      const type_params = _t8135._val[0];
      const name = _t8135._val[1];
      const def = _t8135._val[2];
      const deriving_ = _t8135._val[3];
      const ctx$p_8138 = Typechecker$process_type_def(ctx, type_params, name, def);
      function _t8140(__p255, cls) {
        let _t8142;
        const _t8141 = __p255;
        _t8143: {
          if (true) {
            const ctx = _t8141[0];
            const acc = _t8141[1];
            let _t8145;
            const _t8144 = Typechecker$generate_derived_instance(type_params, name, def, cls);
            _t8146: {
              if (_t8144._tag === 1) {
                const class_name = _t8144._val[0];
                const inst_tys = _t8144._val[1];
                const constraints = _t8144._val[2];
                const methods = _t8144._val[3];
                let _t8148;
                const _t8147 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
                _t8149: {
                  if (true) {
                    const ctx$p = _t8147[0];
                    const tdecl = _t8147[1];
                    _t8148 = [ctx$p, ({_hd: tdecl, _tl: acc})];
                    break _t8149;
                  }
                  _match_fail("line 16190");
                }
                _t8145 = _t8148;
                break _t8146;
              }
              if (_t8144._tag === 0) {
                _t8145 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
                break _t8146;
              }
              _match_fail("line 16190");
            }
            _t8142 = _t8145;
            break _t8143;
          }
          _match_fail("line 16190");
        }
        return _t8142;
      }
      let _t8151;
      const _t8150 = List$fold(_t8140, [ctx$p_8138, null], deriving_);
      _t8152: {
        if (true) {
          const ctx$p = _t8150[0];
          const derived_tdecls = _t8150[1];
          _t8151 = [ctx$p, ({_hd: ({_tag: 4, _name: "TDType", _val: [name, def]}), _tl: List$rev(derived_tdecls)})];
          break _t8152;
        }
        _match_fail("line 16190");
      }
      const _t8139 = _t8151;
      _t8136 = _t8139;
      break _t8137;
    }
    if (_t8135._tag === 0) {
      const name = _t8135._val[0];
      const params = _t8135._val[1];
      const ret_annot = _t8135._val[2];
      const constraints = _t8135._val[3];
      const body = _t8135._val[4];
      let _t8153;
      if (!_eq(constraints, null)) {
        let _t8155;
        const _t8154 = Typechecker$synth_constrained_fn(ctx, level, constraints, params, ret_annot, body);
        _t8156: {
          if (true) {
            const te = _t8154[0];
            const scheme = _t8154[1];
            const ctx$p_8157 = Typechecker$extend_var(ctx, name, scheme);
            const _t8158 = [ctx$p_8157, ({_hd: ({_tag: 0, _name: "TDLet", _val: [name, te]}), _tl: null})];
            _t8155 = _t8158;
            break _t8156;
          }
          _match_fail("line 16190");
        }
        _t8153 = _t8155;
      } else {
        const eff_8159 = Types$new_effvar(level);
        const __rec_upd_8161 = ctx;
        const _t8162 = ({constraint_tvars: __rec_upd_8161.constraint_tvars, current_eff: eff_8159, current_module: __rec_upd_8161.current_module, inside_handler: __rec_upd_8161.inside_handler, loop_info: __rec_upd_8161.loop_info, mutable_vars: __rec_upd_8161.mutable_vars, return_type: __rec_upd_8161.return_type, return_used: __rec_upd_8161.return_used, type_env: __rec_upd_8161.type_env, vars: __rec_upd_8161.vars});
        const eff_ctx_8163 = _t8162;
        const full_body_8165 = Typechecker$wrap_params_decl(params, ret_annot, body);
        const te_8167 = Typechecker$synth(eff_ctx_8163, (level + 1), full_body_8165);
        Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, te_8167);
        let _t8169;
        if ((_eq(params, null) && (!Typechecker$is_syntactic_value(body)))) {
          _t8169 = Typechecker$mono_scheme(te_8167.ty);
        } else {
          _t8169 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, te_8167.ty, Hashtbl$create(0));
        }
        const scheme_8170 = _t8169;
        const scheme_8172 = Typechecker$infer_implicit_constraints("", ctx.type_env, ctx.vars, te_8167, scheme_8170);
        const scheme_8174 = Typechecker$infer_record_evidence(ctx.vars, te_8167, scheme_8172);
        const ctx$p_8176 = Typechecker$extend_var(ctx, name, scheme_8174);
        const _t8177 = [ctx$p_8176, ({_hd: ({_tag: 0, _name: "TDLet", _val: [name, te_8167]}), _tl: null})];
        const _t8175 = _t8177;
        const _t8173 = _t8175;
        const _t8171 = _t8173;
        const _t8168 = _t8171;
        const _t8166 = _t8168;
        const _t8164 = _t8166;
        const _t8160 = _t8164;
        _t8153 = _t8160;
      }
      _t8136 = _t8153;
      break _t8137;
    }
    if (_t8135._tag === 1) {
      const name = _t8135._val[0];
      const body = _t8135._val[1];
      const eff_8178 = Types$new_effvar(level);
      const __rec_upd_8180 = ctx;
      const _t8181 = ({constraint_tvars: __rec_upd_8180.constraint_tvars, current_eff: eff_8178, current_module: __rec_upd_8180.current_module, inside_handler: __rec_upd_8180.inside_handler, loop_info: __rec_upd_8180.loop_info, mutable_vars: __rec_upd_8180.mutable_vars, return_type: __rec_upd_8180.return_type, return_used: __rec_upd_8180.return_used, type_env: __rec_upd_8180.type_env, vars: __rec_upd_8180.vars});
      const eff_ctx_8182 = _t8181;
      const te_8184 = Typechecker$synth(eff_ctx_8182, (level + 1), body);
      const scheme_8186 = Typechecker$mono_scheme(te_8184.ty);
      const ctx$p_8188 = Typechecker$extend_var_mutable(ctx, name, scheme_8186);
      const _t8189 = [ctx$p_8188, ({_hd: ({_tag: 1, _name: "TDLetMut", _val: [name, te_8184]}), _tl: null})];
      const _t8187 = _t8189;
      const _t8185 = _t8187;
      const _t8183 = _t8185;
      const _t8179 = _t8183;
      _t8136 = _t8179;
      break _t8137;
    }
    if (_t8135._tag === 2) {
      const name = _t8135._val[0];
      const type_params = _t8135._val[1];
      const params = _t8135._val[2];
      const ret_annot = _t8135._val[3];
      const constraints = _t8135._val[4];
      const body = _t8135._val[5];
      let _t8190;
      if (!_eq(type_params, null)) {
        let _t8192;
        const _t8191 = Typechecker$synth_poly_rec_fn(ctx, level, name, "", type_params, params, ret_annot, body);
        _t8193: {
          if (true) {
            const te = _t8191[0];
            const scheme = _t8191[1];
            const ctx$p_8194 = Typechecker$extend_var(ctx, name, scheme);
            const _t8195 = [ctx$p_8194, ({_hd: ({_tag: 2, _name: "TDLetRec", _val: [name, te]}), _tl: null})];
            _t8192 = _t8195;
            break _t8193;
          }
          _match_fail("line 16190");
        }
        _t8190 = _t8192;
      } else {
        let _t8196;
        if (!_eq(constraints, null)) {
          const fn_var_8197 = Types$new_tvar((level + 1));
          const ctx_with_self_8199 = Typechecker$extend_var_mono(ctx, name, fn_var_8197);
          let _t8202;
          const _t8201 = Typechecker$synth_constrained_fn(ctx_with_self_8199, level, constraints, params, ret_annot, body);
          _t8203: {
            if (true) {
              const te = _t8201[0];
              const scheme = _t8201[1];
              Typechecker$try_unify(fn_var_8197, te.ty);
              const ctx$p_8204 = Typechecker$extend_var(ctx, name, scheme);
              const _t8205 = [ctx$p_8204, ({_hd: ({_tag: 2, _name: "TDLetRec", _val: [name, te]}), _tl: null})];
              _t8202 = _t8205;
              break _t8203;
            }
            _match_fail("line 16190");
          }
          const _t8200 = _t8202;
          const _t8198 = _t8200;
          _t8196 = _t8198;
        } else {
          const eff_8206 = Types$new_effvar(level);
          const __rec_upd_8208 = ctx;
          const _t8209 = ({constraint_tvars: __rec_upd_8208.constraint_tvars, current_eff: eff_8206, current_module: __rec_upd_8208.current_module, inside_handler: __rec_upd_8208.inside_handler, loop_info: __rec_upd_8208.loop_info, mutable_vars: __rec_upd_8208.mutable_vars, return_type: __rec_upd_8208.return_type, return_used: __rec_upd_8208.return_used, type_env: __rec_upd_8208.type_env, vars: __rec_upd_8208.vars});
          const eff_ctx_8210 = _t8209;
          const full_body_8212 = Typechecker$wrap_params_decl(params, ret_annot, body);
          const fn_var_8214 = Types$new_tvar((level + 1));
          const ctx$p_8216 = Typechecker$extend_var_mono(eff_ctx_8210, name, fn_var_8214);
          const fn_te_8218 = Typechecker$synth(ctx$p_8216, (level + 1), full_body_8212);
          Typechecker$try_unify(fn_var_8214, fn_te_8218.ty);
          Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, fn_te_8218);
          const scheme_8220 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, fn_te_8218.ty, Hashtbl$create(0));
          const scheme_8222 = Typechecker$infer_implicit_constraints(name, ctx.type_env, ctx.vars, fn_te_8218, scheme_8220);
          const scheme_8224 = Typechecker$infer_record_evidence(ctx.vars, fn_te_8218, scheme_8222);
          const ctx$p$p_8226 = Typechecker$extend_var(ctx, name, scheme_8224);
          const _t8227 = [ctx$p$p_8226, ({_hd: ({_tag: 2, _name: "TDLetRec", _val: [name, fn_te_8218]}), _tl: null})];
          const _t8225 = _t8227;
          const _t8223 = _t8225;
          const _t8221 = _t8223;
          const _t8219 = _t8221;
          const _t8217 = _t8219;
          const _t8215 = _t8217;
          const _t8213 = _t8215;
          const _t8211 = _t8213;
          const _t8207 = _t8211;
          _t8196 = _t8207;
        }
        _t8190 = _t8196;
      }
      _t8136 = _t8190;
      break _t8137;
    }
    if (_t8135._tag === 6) {
      const expr = _t8135._val;
      const eff_8228 = Types$new_effvar(level);
      const __rec_upd_8230 = ctx;
      const _t8231 = ({constraint_tvars: __rec_upd_8230.constraint_tvars, current_eff: eff_8228, current_module: __rec_upd_8230.current_module, inside_handler: __rec_upd_8230.inside_handler, loop_info: __rec_upd_8230.loop_info, mutable_vars: __rec_upd_8230.mutable_vars, return_type: __rec_upd_8230.return_type, return_used: __rec_upd_8230.return_used, type_env: __rec_upd_8230.type_env, vars: __rec_upd_8230.vars});
      const ctx$p_8232 = _t8231;
      const te_8234 = Typechecker$synth(ctx$p_8232, level, expr);
      const _t8236 = (function() {
        const _t8237 = _h;
        _h = Object.assign({}, _t8237, {
          "unify_error": function(_, __k_try) { throw {_e: "unify_error", _v: _}; },
        });
        try {
          const __x_8238 = Types$unify_eff(Types$eff_repr(eff_8228), ({_tag: 1, _name: "EffEmpty"}));
          return __x_8238;
        } catch (_exc) {
          if (_exc && _exc._e === "unify_error") {
            const _ = _exc._v;
            return Typechecker$error(("expression has unhandled effects: " + __dict_Show_string.show(Types$pp_eff(eff_8228))));
          } else { throw _exc; }
        } finally { _h = _t8237; }
      })();
      _t8236;
      const _t8235 = [ctx, ({_hd: ({_tag: 5, _name: "TDExpr", _val: te_8234}), _tl: null})];
      const _t8233 = _t8235;
      const _t8229 = _t8233;
      _t8136 = _t8229;
      break _t8137;
    }
    if (_t8135._tag === 7) {
      const name = _t8135._val[0];
      const tyvars = _t8135._val[1];
      const fundeps = _t8135._val[2];
      const methods = _t8135._val[3];
      let _t8240;
      const _t8239 = Typechecker$process_class_def(ctx, name, tyvars, fundeps, methods);
      _t8241: {
        if (true) {
          const ctx$p = _t8239[0];
          const td = _t8239[1];
          _t8240 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8241;
        }
        _match_fail("line 16190");
      }
      _t8136 = _t8240;
      break _t8137;
    }
    if (_t8135._tag === 8) {
      const class_name = _t8135._val[0];
      const inst_ty_annots = _t8135._val[1];
      const constraints = _t8135._val[2];
      const methods = _t8135._val[3];
      let _t8243;
      const _t8242 = Typechecker$process_instance_def(ctx, level, class_name, inst_ty_annots, constraints, methods);
      _t8244: {
        if (true) {
          const ctx$p = _t8242[0];
          const td = _t8242[1];
          _t8243 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8244;
        }
        _match_fail("line 16190");
      }
      _t8136 = _t8243;
      break _t8137;
    }
    if (_t8135._tag === 9) {
      const name = _t8135._val[0];
      const type_params = _t8135._val[1];
      const ops = _t8135._val[2];
      const tvars_8245 = Hashtbl$create(4);
      function _t8247(i, p) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_8245, p, ({_tag: 17, _name: "TGen", _val: i})]);
      }
      List$iteri(_t8247, type_params);
      function _t8248(__p256) {
        let _t8250;
        const _t8249 = __p256;
        _t8251: {
          if (true) {
            const op_name = _t8249[0];
            const annot = _t8249[1];
            const ty_8252 = Typechecker$resolve_ty_annot_shared(ctx, 0, tvars_8245, annot);
            const _t8253 = [op_name, ty_8252];
            _t8250 = _t8253;
            break _t8251;
          }
          _match_fail("line 16190");
        }
        return _t8250;
      }
      const resolved_ops_8254 = List$map(_t8248, ops);
      const effect_def_8256 = ({effect_name: name, effect_ops: resolved_ops_8254, effect_params: type_params});
      const __rec_upd_8258 = ctx.type_env;
      const _t8259 = ({classes: __rec_upd_8258.classes, constructors: __rec_upd_8258.constructors, effects: ({_hd: effect_def_8256, _tl: ctx.type_env.effects}), instances: __rec_upd_8258.instances, modules: __rec_upd_8258.modules, mutable_fields: __rec_upd_8258.mutable_fields, records: __rec_upd_8258.records, type_aliases: __rec_upd_8258.type_aliases, type_synonyms: __rec_upd_8258.type_synonyms, variants: __rec_upd_8258.variants});
      const type_env_8260 = _t8259;
      const __rec_upd_8262 = ctx;
      const _t8263 = ({constraint_tvars: __rec_upd_8262.constraint_tvars, current_eff: __rec_upd_8262.current_eff, current_module: __rec_upd_8262.current_module, inside_handler: __rec_upd_8262.inside_handler, loop_info: __rec_upd_8262.loop_info, mutable_vars: __rec_upd_8262.mutable_vars, return_type: __rec_upd_8262.return_type, return_used: __rec_upd_8262.return_used, type_env: type_env_8260, vars: __rec_upd_8262.vars});
      const ctx_8264 = _t8263;
      const _t8265 = [ctx_8264, ({_hd: ({_tag: 7, _name: "TDEffect", _val: name}), _tl: null})];
      const _t8261 = _t8265;
      const _t8257 = _t8261;
      const _t8255 = _t8257;
      const _t8246 = _t8255;
      _t8136 = _t8246;
      break _t8137;
    }
    if (_t8135._tag === 10) {
      const name = _t8135._val[0];
      const ty_annot = _t8135._val[1];
      const tvars_8266 = Hashtbl$create(4);
      const ty_8268 = Typechecker$resolve_ty_annot_shared(ctx, 1, tvars_8266, ty_annot);
      const scheme_8270 = Types$generalize(0, ty_8268);
      const ctx_8272 = Typechecker$extend_var(ctx, name, scheme_8270);
      const _t8273 = [ctx_8272, ({_hd: ({_tag: 8, _name: "TDExtern", _val: [name, scheme_8270]}), _tl: null})];
      const _t8271 = _t8273;
      const _t8269 = _t8271;
      const _t8267 = _t8269;
      _t8136 = _t8267;
      break _t8137;
    }
    if (_t8135._tag === 11) {
      const name = _t8135._val[0];
      const items = _t8135._val[1];
      let _t8275;
      const _t8274 = Typechecker$process_module_def(ctx, level, name, items);
      _t8276: {
        if (true) {
          const ctx$p = _t8274[0];
          const td = _t8274[1];
          _t8275 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8276;
        }
        _match_fail("line 16190");
      }
      _t8136 = _t8275;
      break _t8137;
    }
    if (_t8135._tag === 12) {
      const mod_name = _t8135._val[0];
      const names_opt = _t8135._val[1];
      let _t8278;
      const _t8277 = Typechecker$process_open(ctx, mod_name, names_opt);
      _t8279: {
        if (true) {
          const ctx$p = _t8277[0];
          const td = _t8277[1];
          _t8278 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8279;
        }
        _match_fail("line 16190");
      }
      _t8136 = _t8278;
      break _t8137;
    }
    if (_t8135._tag === 3) {
      const bindings = _t8135._val;
      function _t8280(__p257) {
        let _t8282;
        const _t8281 = __p257;
        _t8283: {
          if (true) {
            const tp = _t8281[1];
            _t8282 = !_eq(tp, null);
            break _t8283;
          }
          _match_fail("line 16190");
        }
        return _t8282;
      }
      const has_poly_8284 = List$exists(_t8280, bindings);
      let _t8286;
      if (has_poly_8284) {
        function _t8287(__p258) {
          let _t8289;
          const _t8288 = __p258;
          _t8290: {
            if (true) {
              const type_params = _t8288[1];
              const params = _t8288[2];
              const ret_annot = _t8288[3];
              const shared_tvars_8291 = Hashtbl$create(4);
              function _t8293(tp) {
                return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_8291, tp, Types$new_tvar((level + 1))]);
              }
              List$iter(_t8293, type_params);
              function _t8294(p) {
                let _t8296;
                const _t8295 = p.annot;
                _t8297: {
                  if (_t8295._tag === 1) {
                    const annot = _t8295._val;
                    _t8296 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_8291, annot);
                    break _t8297;
                  }
                  if (_t8295._tag === 0) {
                    _t8296 = Types$new_tvar((level + 1));
                    break _t8297;
                  }
                  _match_fail("line 16190");
                }
                return _t8296;
              }
              const param_tys_8298 = List$map(_t8294, params);
              let _t8301;
              const _t8300 = ret_annot;
              _t8302: {
                if (_t8300._tag === 1 && _t8300._val._tag === 11) {
                  const ty = _t8300._val._val[0];
                  const eff_annot = _t8300._val._val[1];
                  const ty$p_8303 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_8291, ty);
                  let _t8306;
                  const _t8305 = eff_annot;
                  _t8307: {
                    if (_t8305._tag === 0) {
                      _t8306 = ({_tag: 1, _name: "EffEmpty"});
                      break _t8307;
                    }
                    if (_t8305._tag === 1) {
                      const items = _t8305._val;
                      _t8306 = Typechecker$resolve_eff_items(ctx, (level + 1), shared_tvars_8291, items);
                      break _t8307;
                    }
                    _match_fail("line 16190");
                  }
                  const eff_8308 = _t8306;
                  const _t8309 = [ty$p_8303, eff_8308];
                  const _t8304 = _t8309;
                  _t8301 = _t8304;
                  break _t8302;
                }
                if (_t8300._tag === 1) {
                  const annot = _t8300._val;
                  _t8301 = [Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_8291, annot), Types$new_effvar((level + 1))];
                  break _t8302;
                }
                if (_t8300._tag === 0) {
                  _t8301 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
                  break _t8302;
                }
                _match_fail("line 16190");
              }
              let _t8311;
              const _t8310 = _t8301;
              _t8312: {
                if (true) {
                  const ret_ty = _t8310[0];
                  const body_eff = _t8310[1];
                  let _t8314;
                  const _t8313 = List$rev(param_tys_8298);
                  _t8315: {
                    if (_t8313 === null) {
                      _t8314 = ret_ty;
                      break _t8315;
                    }
                    if (_t8313 !== null) {
                      const last = _t8313._hd;
                      const rest = _t8313._tl;
                      const inner_8316 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
                      function _t8318(acc, pty) {
                        return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
                      }
                      const _t8317 = List$fold(_t8318, inner_8316, rest);
                      _t8314 = _t8317;
                      break _t8315;
                    }
                    _match_fail("line 16190");
                  }
                  const fn_ty_8319 = _t8314;
                  const _t8320 = [shared_tvars_8291, param_tys_8298, ret_ty, body_eff, fn_ty_8319];
                  _t8311 = _t8320;
                  break _t8312;
                }
                _match_fail("line 16190");
              }
              const _t8299 = _t8311;
              const _t8292 = _t8299;
              _t8289 = _t8292;
              break _t8290;
            }
            _match_fail("line 16190");
          }
          return _t8289;
        }
        const shared_tvars_list_8321 = List$map(_t8287, bindings);
        function _t8323(__p259) {
          let _t8325;
          const _t8324 = __p259;
          _t8326: {
            if (true) {
              const fn_ty = _t8324[4];
              _t8325 = Types$generalize(level, fn_ty);
              break _t8326;
            }
            _match_fail("line 16190");
          }
          return _t8325;
        }
        const schemes_8327 = List$map(_t8323, shared_tvars_list_8321);
        function _t8329(ctx, __p260, scheme) {
          let _t8331;
          const _t8330 = __p260;
          _t8332: {
            if (true) {
              const name = _t8330[0];
              _t8331 = Typechecker$extend_var(ctx, name, scheme);
              break _t8332;
            }
            _match_fail("line 16190");
          }
          return _t8331;
        }
        const ctx$p_8333 = List$fold2(_t8329, ctx, bindings, schemes_8327);
        function _t8335(__p261, __p262) {
          let _t8337;
          const _t8336 = __p261;
          _t8338: {
            if (true) {
              const params = _t8336[2];
              const body = _t8336[5];
              let _t8340;
              const _t8339 = __p262;
              _t8341: {
                if (true) {
                  const param_tys = _t8339[1];
                  const ret_ty = _t8339[2];
                  const body_eff = _t8339[3];
                  function _t8342(c, p, ty) {
                    return Typechecker$extend_var_mono(c, p.name, ty);
                  }
                  const __rec_upd_8343 = ctx$p_8333;
                  const _t8344 = ({constraint_tvars: __rec_upd_8343.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_8343.current_module, inside_handler: __rec_upd_8343.inside_handler, loop_info: __rec_upd_8343.loop_info, mutable_vars: __rec_upd_8343.mutable_vars, return_type: __rec_upd_8343.return_type, return_used: __rec_upd_8343.return_used, type_env: __rec_upd_8343.type_env, vars: __rec_upd_8343.vars});
                  const inner_ctx_8345 = List$fold2(_t8342, _t8344, params, param_tys);
                  const body_te_8347 = Typechecker$check(inner_ctx_8345, (level + 1), body, ret_ty);
                  let _t8350;
                  const _t8349 = [List$rev(params), List$rev(param_tys)];
                  _t8351: {
                    if (_t8349[0] === null && _t8349[1] === null) {
                      _t8350 = body_te_8347;
                      break _t8351;
                    }
                    if (_t8349[0] !== null && _t8349[1] !== null) {
                      const last_p = _t8349[0]._hd;
                      const rest_ps = _t8349[0]._tl;
                      const last_pty = _t8349[1]._hd;
                      const rest_ptys = _t8349[1]._tl;
                      const inner_8352 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_8347, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_8347.ty]}));
                      function _t8354(acc, p, pty) {
                        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
                      }
                      const _t8353 = List$fold2(_t8354, inner_8352, rest_ps, rest_ptys);
                      _t8350 = _t8353;
                      break _t8351;
                    }
                    if (true) {
                      _t8350 = failwith("assert false");
                      break _t8351;
                    }
                    _match_fail("line 16190");
                  }
                  const _t8348 = _t8350;
                  const _t8346 = _t8348;
                  _t8340 = _t8346;
                  break _t8341;
                }
                _match_fail("line 16190");
              }
              _t8337 = _t8340;
              break _t8338;
            }
            _match_fail("line 16190");
          }
          return _t8337;
        }
        const body_tes_8355 = List$map2(_t8335, bindings, shared_tvars_list_8321);
        function _t8357(ctx, __p263, scheme) {
          let _t8359;
          const _t8358 = __p263;
          _t8360: {
            if (true) {
              const name = _t8358[0];
              _t8359 = Typechecker$extend_var(ctx, name, scheme);
              break _t8360;
            }
            _match_fail("line 16190");
          }
          return _t8359;
        }
        const ctx$p$p_8361 = List$fold2(_t8357, ctx, bindings, schemes_8327);
        function _t8363(__p264, te) {
          let _t8365;
          const _t8364 = __p264;
          _t8366: {
            if (true) {
              const name = _t8364[0];
              _t8365 = [name, te];
              break _t8366;
            }
            _match_fail("line 16190");
          }
          return _t8365;
        }
        const typed_bindings_8367 = List$map2(_t8363, bindings, body_tes_8355);
        const _t8368 = [ctx$p$p_8361, ({_hd: ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_8367}), _tl: null})];
        const _t8362 = _t8368;
        const _t8356 = _t8362;
        const _t8334 = _t8356;
        const _t8328 = _t8334;
        const _t8322 = _t8328;
        _t8286 = _t8322;
      } else {
        function _t8369(__p265) {
          let _t8371;
          const _t8370 = __p265;
          _t8372: {
            if (true) {
              const name = _t8370[0];
              _t8371 = [name, Types$new_tvar((level + 1))];
              break _t8372;
            }
            _match_fail("line 16190");
          }
          return _t8371;
        }
        const fn_vars_8373 = List$map(_t8369, bindings);
        function _t8375(ctx, __p266) {
          let _t8377;
          const _t8376 = __p266;
          _t8378: {
            if (true) {
              const name = _t8376[0];
              const tv = _t8376[1];
              _t8377 = Typechecker$extend_var_mono(ctx, name, tv);
              break _t8378;
            }
            _match_fail("line 16190");
          }
          return _t8377;
        }
        const ctx$p_8379 = List$fold(_t8375, ctx, fn_vars_8373);
        function _t8381(__p267, __p268) {
          let _t8383;
          const _t8382 = __p267;
          _t8384: {
            if (true) {
              const name = _t8382[0];
              const params = _t8382[2];
              const ret_annot = _t8382[3];
              const constraints = _t8382[4];
              const body = _t8382[5];
              let _t8386;
              const _t8385 = __p268;
              _t8387: {
                if (true) {
                  const tv = _t8385[1];
                  name;
                  undefined;
                  let _t8388;
                  if (!_eq(constraints, null)) {
                    let _t8390;
                    const _t8389 = Typechecker$synth_constrained_fn(ctx$p_8379, level, constraints, params, ret_annot, body);
                    _t8391: {
                      if (true) {
                        const te = _t8389[0];
                        const _scheme = _t8389[1];
                        Typechecker$try_unify(tv, te.ty);
                        _t8390 = te;
                        break _t8391;
                      }
                      _match_fail("line 16190");
                    }
                    _t8388 = _t8390;
                  } else {
                    const full_body_8392 = Typechecker$wrap_params_decl(params, ret_annot, body);
                    const te_8394 = Typechecker$synth(ctx$p_8379, (level + 1), full_body_8392);
                    Typechecker$try_unify(tv, te_8394.ty);
                    const _t8395 = te_8394;
                    const _t8393 = _t8395;
                    _t8388 = _t8393;
                  }
                  _t8386 = _t8388;
                  break _t8387;
                }
                _match_fail("line 16190");
              }
              _t8383 = _t8386;
              break _t8384;
            }
            _match_fail("line 16190");
          }
          return _t8383;
        }
        const body_tes_8396 = List$map2(_t8381, bindings, fn_vars_8373);
        function _t8398(ctx, __p269, __p270) {
          let _t8400;
          const _t8399 = __p269;
          _t8401: {
            if (true) {
              const name = _t8399[0];
              let _t8403;
              const _t8402 = __p270;
              _t8404: {
                if (true) {
                  const tv = _t8402[1];
                  const scheme_8405 = Types$generalize(level, tv);
                  const _t8406 = Typechecker$extend_var(ctx, name, scheme_8405);
                  _t8403 = _t8406;
                  break _t8404;
                }
                _match_fail("line 16190");
              }
              _t8400 = _t8403;
              break _t8401;
            }
            _match_fail("line 16190");
          }
          return _t8400;
        }
        const ctx$p$p_8407 = List$fold2(_t8398, ctx, bindings, fn_vars_8373);
        function _t8409(__p271, te) {
          let _t8411;
          const _t8410 = __p271;
          _t8412: {
            if (true) {
              const name = _t8410[0];
              _t8411 = [name, te];
              break _t8412;
            }
            _match_fail("line 16190");
          }
          return _t8411;
        }
        const typed_bindings_8413 = List$map2(_t8409, bindings, body_tes_8396);
        const _t8414 = [ctx$p$p_8407, ({_hd: ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_8413}), _tl: null})];
        const _t8408 = _t8414;
        const _t8397 = _t8408;
        const _t8380 = _t8397;
        const _t8374 = _t8380;
        _t8286 = _t8374;
      }
      const _t8285 = _t8286;
      _t8136 = _t8285;
      break _t8137;
    }
    if (_t8135._tag === 5) {
      const type_defs = _t8135._val;
      function _t8415(ctx, __p272) {
        let _t8417;
        const _t8416 = __p272;
        _t8418: {
          if (true) {
            const type_params = _t8416[0];
            const name = _t8416[1];
            const def = _t8416[2];
            const _deriving = _t8416[3];
            const num_params_8419 = List$length(type_params);
            let _t8422;
            const _t8421 = def;
            _t8423: {
              if (_t8421._tag === 0) {
                const __rec_upd_8424 = ctx.type_env;
                const _t8425 = ({classes: __rec_upd_8424.classes, constructors: __rec_upd_8424.constructors, effects: __rec_upd_8424.effects, instances: __rec_upd_8424.instances, modules: __rec_upd_8424.modules, mutable_fields: __rec_upd_8424.mutable_fields, records: __rec_upd_8424.records, type_aliases: __rec_upd_8424.type_aliases, type_synonyms: __rec_upd_8424.type_synonyms, variants: ({_hd: [name, num_params_8419, null, false], _tl: ctx.type_env.variants})});
                const type_env_8426 = _t8425;
                const __rec_upd_8428 = ctx;
                const _t8429 = ({constraint_tvars: __rec_upd_8428.constraint_tvars, current_eff: __rec_upd_8428.current_eff, current_module: __rec_upd_8428.current_module, inside_handler: __rec_upd_8428.inside_handler, loop_info: __rec_upd_8428.loop_info, mutable_vars: __rec_upd_8428.mutable_vars, return_type: __rec_upd_8428.return_type, return_used: __rec_upd_8428.return_used, type_env: type_env_8426, vars: __rec_upd_8428.vars});
                const _t8427 = _t8429;
                _t8422 = _t8427;
                break _t8423;
              }
              if (_t8421._tag === 1) {
                const __rec_upd_8430 = ctx.type_env;
                const _t8431 = ({classes: __rec_upd_8430.classes, constructors: __rec_upd_8430.constructors, effects: __rec_upd_8430.effects, instances: __rec_upd_8430.instances, modules: __rec_upd_8430.modules, mutable_fields: __rec_upd_8430.mutable_fields, records: ({_hd: [name, null], _tl: ctx.type_env.records}), type_aliases: __rec_upd_8430.type_aliases, type_synonyms: __rec_upd_8430.type_synonyms, variants: __rec_upd_8430.variants});
                const type_env_8432 = _t8431;
                const __rec_upd_8434 = ctx;
                const _t8435 = ({constraint_tvars: __rec_upd_8434.constraint_tvars, current_eff: __rec_upd_8434.current_eff, current_module: __rec_upd_8434.current_module, inside_handler: __rec_upd_8434.inside_handler, loop_info: __rec_upd_8434.loop_info, mutable_vars: __rec_upd_8434.mutable_vars, return_type: __rec_upd_8434.return_type, return_used: __rec_upd_8434.return_used, type_env: type_env_8432, vars: __rec_upd_8434.vars});
                const _t8433 = _t8435;
                _t8422 = _t8433;
                break _t8423;
              }
              if (_t8421._tag === 2) {
                _t8422 = ctx;
                break _t8423;
              }
              _match_fail("line 16190");
            }
            const _t8420 = _t8422;
            _t8417 = _t8420;
            break _t8418;
          }
          _match_fail("line 16190");
        }
        return _t8417;
      }
      const ctx$p_8436 = List$fold(_t8415, ctx, type_defs);
      function _t8438(ctx, __p273) {
        let _t8440;
        const _t8439 = __p273;
        _t8441: {
          if (true) {
            const type_params = _t8439[0];
            const name = _t8439[1];
            const def = _t8439[2];
            const _deriving = _t8439[3];
            let _t8443;
            const _t8442 = def;
            _t8444: {
              if (_t8442._tag === 1) {
                _t8443 = Typechecker$process_type_def(ctx, type_params, name, def);
                break _t8444;
              }
              if (true) {
                _t8443 = ctx;
                break _t8444;
              }
              _match_fail("line 16190");
            }
            _t8440 = _t8443;
            break _t8441;
          }
          _match_fail("line 16190");
        }
        return _t8440;
      }
      const ctx$p_8445 = List$fold(_t8438, ctx$p_8436, type_defs);
      function _t8447(ctx, __p274) {
        let _t8449;
        const _t8448 = __p274;
        _t8450: {
          if (true) {
            const type_params = _t8448[0];
            const name = _t8448[1];
            const def = _t8448[2];
            const _deriving = _t8448[3];
            let _t8452;
            const _t8451 = def;
            _t8453: {
              if (_t8451._tag === 1) {
                _t8452 = ctx;
                break _t8453;
              }
              if (true) {
                _t8452 = Typechecker$process_type_def(ctx, type_params, name, def);
                break _t8453;
              }
              _match_fail("line 16190");
            }
            _t8449 = _t8452;
            break _t8450;
          }
          _match_fail("line 16190");
        }
        return _t8449;
      }
      const ctx$p$p_8454 = List$fold(_t8447, ctx$p_8445, type_defs);
      function _t8456(__p275, __p276) {
        let _t8458;
        const _t8457 = __p275;
        _t8459: {
          if (true) {
            const ctx = _t8457[0];
            const acc = _t8457[1];
            let _t8461;
            const _t8460 = __p276;
            _t8462: {
              if (true) {
                const type_params = _t8460[0];
                const name = _t8460[1];
                const def = _t8460[2];
                const deriving_ = _t8460[3];
                function _t8463(__p277, cls) {
                  let _t8465;
                  const _t8464 = __p277;
                  _t8466: {
                    if (true) {
                      const ctx = _t8464[0];
                      const acc = _t8464[1];
                      let _t8468;
                      const _t8467 = Typechecker$generate_derived_instance(type_params, name, def, cls);
                      _t8469: {
                        if (_t8467._tag === 1) {
                          const class_name = _t8467._val[0];
                          const inst_tys = _t8467._val[1];
                          const constraints = _t8467._val[2];
                          const methods = _t8467._val[3];
                          let _t8471;
                          const _t8470 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
                          _t8472: {
                            if (true) {
                              const ctx$p = _t8470[0];
                              const tdecl = _t8470[1];
                              _t8471 = [ctx$p, ({_hd: tdecl, _tl: acc})];
                              break _t8472;
                            }
                            _match_fail("line 16190");
                          }
                          _t8468 = _t8471;
                          break _t8469;
                        }
                        if (_t8467._tag === 0) {
                          _t8468 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
                          break _t8469;
                        }
                        _match_fail("line 16190");
                      }
                      _t8465 = _t8468;
                      break _t8466;
                    }
                    _match_fail("line 16190");
                  }
                  return _t8465;
                }
                let _t8474;
                const _t8473 = List$fold(_t8463, [ctx, null], deriving_);
                _t8475: {
                  if (true) {
                    const ctx$p = _t8473[0];
                    const new_decls = _t8473[1];
                    _t8474 = [ctx$p, List$concat(List$rev(new_decls), acc)];
                    break _t8475;
                  }
                  _match_fail("line 16190");
                }
                _t8461 = _t8474;
                break _t8462;
              }
              _match_fail("line 16190");
            }
            _t8458 = _t8461;
            break _t8459;
          }
          _match_fail("line 16190");
        }
        return _t8458;
      }
      let _t8477;
      const _t8476 = List$fold(_t8456, [ctx$p$p_8454, null], type_defs);
      _t8478: {
        if (true) {
          const ctx_final = _t8476[0];
          const derived_tdecls = _t8476[1];
          function _t8479(__p278) {
            let _t8481;
            const _t8480 = __p278;
            _t8482: {
              if (true) {
                const _tp = _t8480[0];
                const name = _t8480[1];
                const def = _t8480[2];
                const _d = _t8480[3];
                _t8481 = ({_tag: 4, _name: "TDType", _val: [name, def]});
                break _t8482;
              }
              _match_fail("line 16190");
            }
            return _t8481;
          }
          const type_decls_8483 = List$map(_t8479, type_defs);
          const _t8484 = [ctx_final, List$concat(type_decls_8483, List$rev(derived_tdecls))];
          _t8477 = _t8484;
          break _t8478;
        }
        _match_fail("line 16190");
      }
      const _t8455 = _t8477;
      const _t8446 = _t8455;
      const _t8437 = _t8446;
      _t8136 = _t8437;
      break _t8137;
    }
    _match_fail("line 16190");
  }
  return _t8136;
}
const Typechecker$empty_ctx = ({constraint_tvars: null, current_eff: ({_tag: 1, _name: "EffEmpty"}), current_module: ({_tag: 0, _name: "None"}), inside_handler: false, loop_info: ({_tag: 0, _name: "None"}), mutable_vars: null, return_type: ({_tag: 0, _name: "None"}), return_used: Ref$create(false), type_env: Types$empty_type_env, vars: null});
function Typechecker$build_tgen_map(schema_ty, actual_ty) {
  const map_8485 = Hashtbl$create(4);
  function walk(s, a) {
    while (true) {
      const a_8487 = Types$repr(a);
      let _t8490;
      const _t8489 = s;
      _t8491: {
        if (_t8489._tag === 17) {
          const i = _t8489._val;
          let _t8492;
          if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, map_8485, i]))) {
            _t8492 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, map_8485, i, a_8487]);
          } else {
            _t8492 = undefined;
          }
          _t8490 = _t8492;
          break _t8491;
        }
        if (_t8489._tag === 7) {
          const s1 = _t8489._val[0];
          const s2 = _t8489._val[2];
          let _t8494;
          const _t8493 = a_8487;
          _t8495: {
            if (_t8493._tag === 7) {
              const a1 = _t8493._val[0];
              const a2 = _t8493._val[2];
              walk(s1, a1);
              const _t8496 = s2;
              const _t8497 = a2;
              s = _t8496;
              a = _t8497;
              continue;
              _t8494 = undefined;
              break _t8495;
            }
            if (true) {
              _t8494 = undefined;
              break _t8495;
            }
            _match_fail("line 16190");
          }
          _t8490 = _t8494;
          break _t8491;
        }
        if (_t8489._tag === 8) {
          const s1 = _t8489._val[0];
          const s2 = _t8489._val[2];
          let _t8499;
          const _t8498 = a_8487;
          _t8500: {
            if (_t8498._tag === 8) {
              const a1 = _t8498._val[0];
              const a2 = _t8498._val[2];
              walk(s1, a1);
              const _t8501 = s2;
              const _t8502 = a2;
              s = _t8501;
              a = _t8502;
              continue;
              _t8499 = undefined;
              break _t8500;
            }
            if (true) {
              _t8499 = undefined;
              break _t8500;
            }
            _match_fail("line 16190");
          }
          _t8490 = _t8499;
          break _t8491;
        }
        if (_t8489._tag === 9) {
          const ss = _t8489._val;
          let _t8504;
          const _t8503 = a_8487;
          _t8505: {
            if (_t8503._tag === 9) {
              const aa = _t8503._val;
              if ((List$length(ss) === List$length(aa))) {
                _t8504 = List$iter2(walk, ss, aa);
                break _t8505;
              }
            }
            if (true) {
              _t8504 = undefined;
              break _t8505;
            }
            _match_fail("line 16190");
          }
          _t8490 = _t8504;
          break _t8491;
        }
        if (_t8489._tag === 10) {
          const s1 = _t8489._val;
          let _t8507;
          const _t8506 = a_8487;
          _t8508: {
            if (_t8506._tag === 10) {
              const a1 = _t8506._val;
              const _t8509 = s1;
              const _t8510 = a1;
              s = _t8509;
              a = _t8510;
              continue;
              _t8507 = undefined;
              break _t8508;
            }
            if (true) {
              _t8507 = undefined;
              break _t8508;
            }
            _match_fail("line 16190");
          }
          _t8490 = _t8507;
          break _t8491;
        }
        if (_t8489._tag === 14) {
          const s1 = _t8489._val;
          let _t8512;
          const _t8511 = a_8487;
          _t8513: {
            if (_t8511._tag === 14) {
              const a1 = _t8511._val;
              const _t8514 = s1;
              const _t8515 = a1;
              s = _t8514;
              a = _t8515;
              continue;
              _t8512 = undefined;
              break _t8513;
            }
            if (true) {
              _t8512 = undefined;
              break _t8513;
            }
            _match_fail("line 16190");
          }
          _t8490 = _t8512;
          break _t8491;
        }
        if (_t8489._tag === 13) {
          const sk = _t8489._val[0];
          const sv = _t8489._val[1];
          let _t8517;
          const _t8516 = a_8487;
          _t8518: {
            if (_t8516._tag === 13) {
              const ak = _t8516._val[0];
              const av = _t8516._val[1];
              walk(sk, ak);
              const _t8519 = sv;
              const _t8520 = av;
              s = _t8519;
              a = _t8520;
              continue;
              _t8517 = undefined;
              break _t8518;
            }
            if (true) {
              _t8517 = undefined;
              break _t8518;
            }
            _match_fail("line 16190");
          }
          _t8490 = _t8517;
          break _t8491;
        }
        if (_t8489._tag === 12) {
          const ss = _t8489._val[1];
          let _t8522;
          const _t8521 = a_8487;
          _t8523: {
            if (_t8521._tag === 12) {
              const aa = _t8521._val[1];
              if ((List$length(ss) === List$length(aa))) {
                _t8522 = List$iter2(walk, ss, aa);
                break _t8523;
              }
            }
            if (true) {
              _t8522 = undefined;
              break _t8523;
            }
            _match_fail("line 16190");
          }
          _t8490 = _t8522;
          break _t8491;
        }
        if (_t8489._tag === 11) {
          const srow = _t8489._val;
          let _t8525;
          const _t8524 = a_8487;
          _t8526: {
            if (_t8524._tag === 11) {
              const arow = _t8524._val;
              const sf_8527 = Types$record_row_to_fields(srow);
              const af_8529 = Types$record_row_to_fields(arow);
              function _t8531(__p279) {
                let _t8533;
                const _t8532 = __p279;
                _t8534: {
                  if (true) {
                    const sname = _t8532[0];
                    const sty = _t8532[1];
                    let _t8536;
                    const _t8535 = List$assoc_opt(sname, af_8529);
                    _t8537: {
                      if (_t8535._tag === 1) {
                        const aty = _t8535._val;
                        _t8536 = walk(sty, aty);
                        break _t8537;
                      }
                      if (_t8535._tag === 0) {
                        _t8536 = undefined;
                        break _t8537;
                      }
                      _match_fail("line 16190");
                    }
                    _t8533 = _t8536;
                    break _t8534;
                  }
                  _match_fail("line 16190");
                }
                return _t8533;
              }
              const _t8530 = List$iter(_t8531, sf_8527);
              const _t8528 = _t8530;
              _t8525 = _t8528;
              break _t8526;
            }
            if (true) {
              _t8525 = undefined;
              break _t8526;
            }
            _match_fail("line 16190");
          }
          _t8490 = _t8525;
          break _t8491;
        }
        if (_t8489._tag === 15) {
          const srow = _t8489._val;
          let _t8539;
          const _t8538 = a_8487;
          _t8540: {
            if (_t8538._tag === 15) {
              const arow = _t8538._val;
              _t8539 = walk_pvrows(srow, arow);
              break _t8540;
            }
            if (true) {
              _t8539 = undefined;
              break _t8540;
            }
            _match_fail("line 16190");
          }
          _t8490 = _t8539;
          break _t8491;
        }
        if (true) {
          _t8490 = undefined;
          break _t8491;
        }
        _match_fail("line 16190");
      }
      const _t8488 = _t8490;
      return _t8488;
    }
  }
  function walk_pvrows(srow, arow) {
    function collect_tags(row) {
      while (true) {
        let _t8542;
        const _t8541 = row;
        _t8543: {
          if (_t8541._tag === 0) {
            const tag = _t8541._val[0];
            const ty_opt = _t8541._val[1];
            const tail = _t8541._val[2];
            _t8542 = ({_hd: [tag, ty_opt], _tl: collect_tags(tail)});
            break _t8543;
          }
          if (_t8541._tag === 1 && _t8541._val.contents._tag === 1) {
            const r = _t8541._val.contents._val;
            const _t8544 = r;
            row = _t8544;
            continue;
            _t8542 = undefined;
            break _t8543;
          }
          if (true) {
            _t8542 = null;
            break _t8543;
          }
          _match_fail("line 16190");
        }
        return _t8542;
      }
    }
    const atags_8546 = collect_tags(arow);
    function go(row) {
      while (true) {
        let _t8549;
        const _t8548 = row;
        _t8550: {
          if (_t8548._tag === 0) {
            const stag = _t8548._val[0];
            const sty_opt = _t8548._val[1];
            const stail = _t8548._val[2];
            let _t8552;
            const _t8551 = List$assoc_opt(stag, atags_8546);
            _t8553: {
              if (_t8551._tag === 1) {
                const aty_opt = _t8551._val;
                let _t8555;
                const _t8554 = [sty_opt, aty_opt];
                _t8556: {
                  if (_t8554[0]._tag === 1 && _t8554[1]._tag === 1) {
                    const sty = _t8554[0]._val;
                    const aty = _t8554[1]._val;
                    _t8555 = walk(sty, aty);
                    break _t8556;
                  }
                  if (true) {
                    _t8555 = undefined;
                    break _t8556;
                  }
                  _match_fail("line 16190");
                }
                _t8552 = _t8555;
                break _t8553;
              }
              if (_t8551._tag === 0) {
                _t8552 = undefined;
                break _t8553;
              }
              _match_fail("line 16190");
            }
            _t8552;
            const _t8557 = stail;
            row = _t8557;
            continue;
            _t8549 = undefined;
            break _t8550;
          }
          if (_t8548._tag === 1 && _t8548._val.contents._tag === 1) {
            const r = _t8548._val.contents._val;
            const _t8558 = r;
            row = _t8558;
            continue;
            _t8549 = undefined;
            break _t8550;
          }
          if (true) {
            _t8549 = undefined;
            break _t8550;
          }
          _match_fail("line 16190");
        }
        return _t8549;
      }
    }
    const _t8559 = go(srow);
    const _t8547 = _t8559;
    const _t8545 = _t8547;
    return _t8545;
  }
  walk(schema_ty, actual_ty);
  const _t8560 = map_8485;
  const _t8486 = _t8560;
  return _t8486;
}
function Typechecker$find_constrained_dict(xctx, tvar_id, class_name) {
  function _t8561(__p280) {
    let _t8563;
    const _t8562 = __p280;
    _t8564: {
      if (true) {
        const tid = _t8562[0];
        const dparam = _t8562[1];
        const cls = _t8562[2];
        let _t8565;
        if (((tid === tvar_id) && (cls === class_name))) {
          _t8565 = ({_tag: 1, _name: "Some", _val: dparam});
        } else {
          _t8565 = ({_tag: 0, _name: "None"});
        }
        _t8563 = _t8565;
        break _t8564;
      }
      _match_fail("line 16190");
    }
    return _t8563;
  }
  return List$find_map(_t8561, xctx.xf_constrained);
}
function Typechecker$resolve_dict_arg(xctx, cc, tgen_map) {
  function _t8566(ca) {
    let _t8568;
    const _t8567 = ca;
    _t8569: {
      if (_t8567._tag === 0) {
        const idx = _t8567._val;
        let _t8571;
        const _t8570 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_map, idx]);
        _t8572: {
          if (_t8570._tag === 1) {
            const ty = _t8570._val;
            _t8571 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t8572;
          }
          if (_t8570._tag === 0) {
            _t8571 = ({_tag: 0, _name: "None"});
            break _t8572;
          }
          _match_fail("line 16190");
        }
        _t8568 = _t8571;
        break _t8569;
      }
      if (_t8567._tag === 1) {
        const ty = _t8567._val;
        _t8568 = ({_tag: 1, _name: "Some", _val: Types$freshen_unbound(ty)});
        break _t8569;
      }
      if (_t8567._tag === 2) {
        _t8568 = ({_tag: 1, _name: "Some", _val: Types$new_tvar(1)});
        break _t8569;
      }
      if (_t8567._tag === 3) {
        const idx = _t8567._val[0];
        let _t8574;
        const _t8573 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_map, idx]);
        _t8575: {
          if (_t8573._tag === 1) {
            const ty = _t8573._val;
            _t8574 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t8575;
          }
          if (_t8573._tag === 0) {
            const tv_8576 = Types$new_tvar(1);
            _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tgen_map, idx, tv_8576]);
            const _t8577 = ({_tag: 1, _name: "Some", _val: tv_8576});
            _t8574 = _t8577;
            break _t8575;
          }
          _match_fail("line 16190");
        }
        _t8568 = _t8574;
        break _t8569;
      }
      _match_fail("line 16190");
    }
    return _t8568;
  }
  const arg_types_8578 = List$map(_t8566, cc.cc_args);
  function _t8580(opt) {
    return _eq(opt, ({_tag: 0, _name: "None"}));
  }
  const has_unresolved_8581 = List$exists(_t8580, arg_types_8578);
  let _t8583;
  if (has_unresolved_8581) {
    let _t8584;
    if ((cc.cc_class === "Show")) {
      _t8584 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: ({_hd: ["show", Typechecker$mk(({_tag: 7, _name: "TEVar", _val: "__show_value"}), ({_tag: 6, _name: "TUnit"}))], _tl: null})}), ({_tag: 6, _name: "TUnit"}));
    } else {
      _t8584 = Typechecker$error(("could not resolve constraint type argument for " + __dict_Show_string.show(cc.cc_class)));
    }
    _t8583 = _t8584;
  } else {
    function _t8585(x) {
      return x;
    }
    const arg_types_8586 = List$filter_map(_t8585, arg_types_8578);
    function _t8588(ty) {
      let _t8590;
      const _t8589 = ty;
      _t8591: {
        if (_t8589._tag === 16 && _t8589._val.contents._tag === 0) {
          _t8590 = true;
          break _t8591;
        }
        if (true) {
          _t8590 = false;
          break _t8591;
        }
        _match_fail("line 16190");
      }
      return _t8590;
    }
    const has_unbound_8592 = List$exists(_t8588, arg_types_8586);
    let _t8594;
    if (has_unbound_8592) {
      function _t8595(cls) {
        return ((cls.class_name === cc.cc_class) && !_eq(cls.class_fundeps, null));
      }
      const class_opt_8596 = List$find(_t8595, xctx.xf_type_env.classes);
      let _t8599;
      const _t8598 = class_opt_8596;
      _t8600: {
        if (_t8598._tag === 1) {
          const class_def = _t8598._val;
          function _t8601(ty) {
            let _t8603;
            const _t8602 = Types$repr(ty);
            _t8604: {
              if (_t8602._tag === 16 && _t8602._val.contents._tag === 0) {
                _t8603 = ({_tag: 0, _name: "None"});
                break _t8604;
              }
              if (true) {
                const t = _t8602;
                _t8603 = ({_tag: 1, _name: "Some", _val: t});
                break _t8604;
              }
              _match_fail("line 16190");
            }
            return _t8603;
          }
          const partial_8605 = List$map(_t8601, arg_types_8586);
          const improved_8607 = Types$improve_with_fundeps(xctx.xf_type_env.instances, class_def, partial_8605);
          function _t8609(orig_ty, imp) {
            let _t8611;
            const _t8610 = [imp, Types$repr(orig_ty)];
            _t8612: {
              if (_t8610[0]._tag === 1 && _t8610[1]._tag === 16 && _t8610[1]._val.contents._tag === 0) {
                const resolved = _t8610[0]._val;
                const r = _t8610[1]._val;
                _t8611 = Types$unify(({_tag: 16, _name: "TVar", _val: r}), resolved);
                break _t8612;
              }
              if (true) {
                _t8611 = undefined;
                break _t8612;
              }
              _match_fail("line 16190");
            }
            return _t8611;
          }
          List$iter2(_t8609, arg_types_8586, improved_8607);
          const _t8608 = List$map(Types$repr, arg_types_8586);
          const _t8606 = _t8608;
          _t8599 = _t8606;
          break _t8600;
        }
        if (_t8598._tag === 0) {
          _t8599 = arg_types_8586;
          break _t8600;
        }
        _match_fail("line 16190");
      }
      const _t8597 = _t8599;
      _t8594 = _t8597;
    } else {
      _t8594 = arg_types_8586;
    }
    const _t8593 = _t8594;
    const arg_types_8613 = _t8593;
    function _t8615(ty) {
      let _t8617;
      const _t8616 = ty;
      _t8618: {
        if (_t8616._tag === 16 && _t8616._val.contents._tag === 0) {
          const id = _t8616._val.contents._val[0];
          _t8617 = Typechecker$find_constrained_dict(xctx, id, cc.cc_class);
          break _t8618;
        }
        if (true) {
          _t8617 = ({_tag: 0, _name: "None"});
          break _t8618;
        }
        _match_fail("line 16190");
      }
      return _t8617;
    }
    const constrained_match_8619 = List$find_map(_t8615, arg_types_8613);
    let _t8622;
    const _t8621 = constrained_match_8619;
    _t8623: {
      if (_t8621._tag === 1) {
        const dparam = _t8621._val;
        _t8622 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dparam}), ({_tag: 6, _name: "TUnit"}));
        break _t8623;
      }
      if (_t8621._tag === 0) {
        function _t8624(ty) {
          let _t8626;
          const _t8625 = ty;
          _t8627: {
            if (_t8625._tag === 16 && _t8625._val.contents._tag === 0) {
              _t8626 = true;
              break _t8627;
            }
            if (true) {
              _t8626 = false;
              break _t8627;
            }
            _match_fail("line 16190");
          }
          return _t8626;
        }
        const has_unbound_tvar_8628 = List$exists(_t8624, arg_types_8613);
        let _t8630;
        if (has_unbound_tvar_8628) {
          let _t8631;
          if ((cc.cc_class === "Show")) {
            _t8631 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: ({_hd: ["show", Typechecker$mk(({_tag: 7, _name: "TEVar", _val: "__show_value"}), ({_tag: 6, _name: "TUnit"}))], _tl: null})}), ({_tag: 6, _name: "TUnit"}));
          } else {
            _t8631 = Typechecker$error(((("no instance of " + __dict_Show_string.show(cc.cc_class)) + " for types ") + __dict_Show_string.show(String$concat(", ", List$map(Types$pp_ty, arg_types_8613)))));
          }
          _t8630 = _t8631;
        } else {
          function _t8632(ty) {
            return ({_tag: 1, _name: "Some", _val: ty});
          }
          const partial_8633 = List$map(_t8632, arg_types_8613);
          function _t8635(inst) {
            return ((inst.inst_class === cc.cc_class) && ((List$length(inst.inst_tys) === List$length(arg_types_8613)) && Types$match_partial_inst(inst.inst_tys, partial_8633)));
          }
          const matching_8636 = List$filter(_t8635, xctx.xf_type_env.instances);
          let _t8639;
          const _t8638 = matching_8636;
          _t8640: {
            if (_t8638 !== null && _t8638._tl === null) {
              const inst = _t8638._hd;
              let _t8641;
              if (!_eq(inst.inst_constraints, null)) {
                _t8641 = Typechecker$resolve_factory_dict(xctx, inst, arg_types_8613);
              } else {
                _t8641 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"}));
              }
              _t8639 = _t8641;
              break _t8640;
            }
            if (_t8638 === null) {
              function _t8642(ty) {
                let _t8644;
                const _t8643 = Types$repr(ty);
                _t8645: {
                  if ((_t8643._tag === 15 || _t8643._tag === 11)) {
                    _t8644 = true;
                    break _t8645;
                  }
                  if (true) {
                    _t8644 = false;
                    break _t8645;
                  }
                  _match_fail("line 16190");
                }
                return _t8644;
              }
              const is_structural_8646 = List$exists(_t8642, arg_types_8613);
              let _t8648;
              if ((is_structural_8646 && (cc.cc_class === "Show"))) {
                _t8648 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: ({_hd: ["show", Typechecker$mk(({_tag: 7, _name: "TEVar", _val: "__show_value"}), ({_tag: 6, _name: "TUnit"}))], _tl: null})}), ({_tag: 6, _name: "TUnit"}));
              } else {
                _t8648 = Typechecker$error(((("no instance of " + __dict_Show_string.show(cc.cc_class)) + " for types ") + __dict_Show_string.show(String$concat(", ", List$map(Types$pp_ty, arg_types_8613)))));
              }
              const _t8647 = _t8648;
              _t8639 = _t8647;
              break _t8640;
            }
            if (true) {
              let _t8650;
              const _t8649 = Types$most_specific_inst(matching_8636);
              _t8651: {
                if (_t8649._tag === 1) {
                  const inst = _t8649._val;
                  let _t8652;
                  if (!_eq(inst.inst_constraints, null)) {
                    _t8652 = Typechecker$resolve_factory_dict(xctx, inst, arg_types_8613);
                  } else {
                    _t8652 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"}));
                  }
                  _t8650 = _t8652;
                  break _t8651;
                }
                if (_t8649._tag === 0) {
                  _t8650 = Typechecker$error(("ambiguous instance for " + __dict_Show_string.show(cc.cc_class)));
                  break _t8651;
                }
                _match_fail("line 16190");
              }
              _t8639 = _t8650;
              break _t8640;
            }
            _match_fail("line 16190");
          }
          const _t8637 = _t8639;
          const _t8634 = _t8637;
          _t8630 = _t8634;
        }
        const _t8629 = _t8630;
        _t8622 = _t8629;
        break _t8623;
      }
      _match_fail("line 16190");
    }
    const _t8620 = _t8622;
    const _t8614 = _t8620;
    const _t8587 = _t8614;
    _t8583 = _t8587;
  }
  const _t8582 = _t8583;
  const _t8579 = _t8582;
  return _t8579;
}
function Typechecker$resolve_factory_dict(xctx, inst, arg_types) {
  const sub_map_8653 = Hashtbl$create(4);
  function _t8655(inst_ty, actual_ty) {
    function walk(s, a) {
      while (true) {
        const a_8656 = Types$repr(a);
        let _t8659;
        const _t8658 = s;
        _t8660: {
          if (_t8658._tag === 17) {
            const i = _t8658._val;
            let _t8661;
            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, sub_map_8653, i]))) {
              _t8661 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, sub_map_8653, i, a_8656]);
            } else {
              _t8661 = undefined;
            }
            _t8659 = _t8661;
            break _t8660;
          }
          if (_t8658._tag === 7) {
            const s1 = _t8658._val[0];
            const s2 = _t8658._val[2];
            let _t8663;
            const _t8662 = a_8656;
            _t8664: {
              if (_t8662._tag === 7) {
                const a1 = _t8662._val[0];
                const a2 = _t8662._val[2];
                walk(s1, a1);
                const _t8665 = s2;
                const _t8666 = a2;
                s = _t8665;
                a = _t8666;
                continue;
                _t8663 = undefined;
                break _t8664;
              }
              if (true) {
                _t8663 = undefined;
                break _t8664;
              }
              _match_fail("line 16190");
            }
            _t8659 = _t8663;
            break _t8660;
          }
          if (_t8658._tag === 8) {
            const s1 = _t8658._val[0];
            const s2 = _t8658._val[2];
            let _t8668;
            const _t8667 = a_8656;
            _t8669: {
              if (_t8667._tag === 8) {
                const a1 = _t8667._val[0];
                const a2 = _t8667._val[2];
                walk(s1, a1);
                const _t8670 = s2;
                const _t8671 = a2;
                s = _t8670;
                a = _t8671;
                continue;
                _t8668 = undefined;
                break _t8669;
              }
              if (true) {
                _t8668 = undefined;
                break _t8669;
              }
              _match_fail("line 16190");
            }
            _t8659 = _t8668;
            break _t8660;
          }
          if (_t8658._tag === 9) {
            const ss = _t8658._val;
            let _t8673;
            const _t8672 = a_8656;
            _t8674: {
              if (_t8672._tag === 9) {
                const aa = _t8672._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t8673 = List$iter2(walk, ss, aa);
                  break _t8674;
                }
              }
              if (true) {
                _t8673 = undefined;
                break _t8674;
              }
              _match_fail("line 16190");
            }
            _t8659 = _t8673;
            break _t8660;
          }
          if (_t8658._tag === 10) {
            const s1 = _t8658._val;
            let _t8676;
            const _t8675 = a_8656;
            _t8677: {
              if (_t8675._tag === 10) {
                const a1 = _t8675._val;
                const _t8678 = s1;
                const _t8679 = a1;
                s = _t8678;
                a = _t8679;
                continue;
                _t8676 = undefined;
                break _t8677;
              }
              if (true) {
                _t8676 = undefined;
                break _t8677;
              }
              _match_fail("line 16190");
            }
            _t8659 = _t8676;
            break _t8660;
          }
          if (_t8658._tag === 14) {
            const s1 = _t8658._val;
            let _t8681;
            const _t8680 = a_8656;
            _t8682: {
              if (_t8680._tag === 14) {
                const a1 = _t8680._val;
                const _t8683 = s1;
                const _t8684 = a1;
                s = _t8683;
                a = _t8684;
                continue;
                _t8681 = undefined;
                break _t8682;
              }
              if (true) {
                _t8681 = undefined;
                break _t8682;
              }
              _match_fail("line 16190");
            }
            _t8659 = _t8681;
            break _t8660;
          }
          if (_t8658._tag === 13) {
            const sk = _t8658._val[0];
            const sv = _t8658._val[1];
            let _t8686;
            const _t8685 = a_8656;
            _t8687: {
              if (_t8685._tag === 13) {
                const ak = _t8685._val[0];
                const av = _t8685._val[1];
                walk(sk, ak);
                const _t8688 = sv;
                const _t8689 = av;
                s = _t8688;
                a = _t8689;
                continue;
                _t8686 = undefined;
                break _t8687;
              }
              if (true) {
                _t8686 = undefined;
                break _t8687;
              }
              _match_fail("line 16190");
            }
            _t8659 = _t8686;
            break _t8660;
          }
          if (_t8658._tag === 12) {
            const ss = _t8658._val[1];
            let _t8691;
            const _t8690 = a_8656;
            _t8692: {
              if (_t8690._tag === 12) {
                const aa = _t8690._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t8691 = List$iter2(walk, ss, aa);
                  break _t8692;
                }
              }
              if (true) {
                _t8691 = undefined;
                break _t8692;
              }
              _match_fail("line 16190");
            }
            _t8659 = _t8691;
            break _t8660;
          }
          if (true) {
            _t8659 = undefined;
            break _t8660;
          }
          _match_fail("line 16190");
        }
        const _t8657 = _t8659;
        return _t8657;
      }
    }
    const _t8693 = walk(inst_ty, actual_ty);
    return _t8693;
  }
  List$iter2(_t8655, inst.inst_tys, arg_types);
  const base_8694 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"}));
  function _t8696(fn_, sub_cc) {
    const sub_dict_8697 = Typechecker$resolve_dict_arg(xctx, sub_cc, sub_map_8653);
    const _t8698 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_, sub_dict_8697]}), ({_tag: 6, _name: "TUnit"}));
    return _t8698;
  }
  const _t8695 = List$fold(_t8696, base_8694, inst.inst_constraints);
  const _t8654 = _t8695;
  return _t8654;
}
function Typechecker$pat_bound_names(__x) {
  while (true) {
    let _t8700;
    const _t8699 = __x;
    _t8701: {
      if (_t8699._tag === 1) {
        const name = _t8699._val;
        _t8700 = ({_hd: name, _tl: null});
        break _t8701;
      }
      if ((_t8699._tag === 7 || _t8699._tag === 14)) {
        const pats = _t8699._val;
        _t8700 = List$concat_map(Typechecker$pat_bound_names, pats);
        break _t8701;
      }
      if (_t8699._tag === 8) {
        const p1 = _t8699._val[0];
        const p2 = _t8699._val[1];
        _t8700 = List$concat(Typechecker$pat_bound_names(p1), Typechecker$pat_bound_names(p2));
        break _t8701;
      }
      if ((_t8699._tag === 10 && _t8699._val[1]._tag === 1 || _t8699._tag === 16 && _t8699._val[1]._tag === 1)) {
        const p = _t8699._val[1]._val;
        const _t8702 = p;
        __x = _t8702;
        continue;
        _t8700 = undefined;
        break _t8701;
      }
      if (_t8699._tag === 11) {
        const fields = _t8699._val;
        function _t8703(__p281) {
          let _t8705;
          const _t8704 = __p281;
          _t8706: {
            if (true) {
              const p = _t8704[1];
              _t8705 = Typechecker$pat_bound_names(p);
              break _t8706;
            }
            _match_fail("line 16190");
          }
          return _t8705;
        }
        _t8700 = List$concat_map(_t8703, fields);
        break _t8701;
      }
      if (_t8699._tag === 12) {
        const p = _t8699._val[0];
        const name = _t8699._val[1];
        _t8700 = ({_hd: name, _tl: Typechecker$pat_bound_names(p)});
        break _t8701;
      }
      if (_t8699._tag === 13) {
        const p1 = _t8699._val[0];
        const _t8707 = p1;
        __x = _t8707;
        continue;
        _t8700 = undefined;
        break _t8701;
      }
      if (_t8699._tag === 15) {
        const pairs = _t8699._val;
        function _t8708(__p282) {
          let _t8710;
          const _t8709 = __p282;
          _t8711: {
            if (true) {
              const v = _t8709[1];
              _t8710 = Typechecker$pat_bound_names(v);
              break _t8711;
            }
            _match_fail("line 16190");
          }
          return _t8710;
        }
        _t8700 = List$concat_map(_t8708, pairs);
        break _t8701;
      }
      if (_t8699._tag === 18) {
        const p = _t8699._val[0];
        const _t8712 = p;
        __x = _t8712;
        continue;
        _t8700 = undefined;
        break _t8701;
      }
      if ((((((((((_t8699._tag === 0 || _t8699._tag === 2) || _t8699._tag === 3) || _t8699._tag === 4) || _t8699._tag === 5) || _t8699._tag === 6) || _t8699._tag === 9) || _t8699._tag === 17) || _t8699._tag === 10 && _t8699._val[1]._tag === 0) || _t8699._tag === 16 && _t8699._val[1]._tag === 0)) {
        _t8700 = null;
        break _t8701;
      }
      _match_fail("line 16190");
    }
    return _t8700;
  }
}
function Typechecker$xform_expr(xctx, te) {
  let _t8714;
  const _t8713 = te.expr;
  _t8715: {
    if (_t8713._tag === 7) {
      const name = _t8713._val;
      const te_8716 = Typechecker$xform_class_method(xctx, name, te);
      const _t8717 = Typechecker$xform_constrained_ref(xctx, name, te_8716);
      _t8714 = _t8717;
      break _t8715;
    }
    if (_t8713._tag === 13) {
      const op = _t8713._val[0];
      const e1 = _t8713._val[1];
      const e2 = _t8713._val[2];
      const e1$p_8718 = Typechecker$xform_expr(xctx, e1);
      const e2$p_8720 = Typechecker$xform_expr(xctx, e2);
      const _t8721 = Typechecker$xform_binop(xctx, op, e1$p_8718, e2$p_8720, te.ty);
      const _t8719 = _t8721;
      _t8714 = _t8719;
      break _t8715;
    }
    if (_t8713._tag === 14) {
      const op = _t8713._val[0];
      const e = _t8713._val[1];
      const e$p_8722 = Typechecker$xform_expr(xctx, e);
      const _t8723 = Typechecker$xform_unop(xctx, op, e$p_8722, te.ty);
      _t8714 = _t8723;
      break _t8715;
    }
    if (_t8713._tag === 11) {
      const fn_ = _t8713._val[0];
      const arg = _t8713._val[1];
      const fn$p_8724 = Typechecker$xform_expr(xctx, fn_);
      const arg$p_8726 = Typechecker$xform_expr(xctx, arg);
      const _t8727 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn$p_8724, arg$p_8726]}), te.ty);
      const _t8725 = _t8727;
      _t8714 = _t8725;
      break _t8715;
    }
    if (_t8713._tag === 10) {
      const param = _t8713._val[0];
      const body = _t8713._val[1];
      const hr = _t8713._val[2];
      const __rec_upd_8728 = xctx;
      const _t8729 = ({xf_constrained: __rec_upd_8728.xf_constrained, xf_locals: ({_hd: param, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_8728.xf_record_evidence, xf_schemes: __rec_upd_8728.xf_schemes, xf_type_env: __rec_upd_8728.xf_type_env});
      const xctx$p_8730 = _t8729;
      const _t8731 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param, Typechecker$xform_expr(xctx$p_8730, body), hr]}), te.ty);
      _t8714 = _t8731;
      break _t8715;
    }
    if (_t8713._tag === 8 && _t8713._val[1]._tag === 1) {
      const name = _t8713._val[0];
      const scheme = _t8713._val[1]._val;
      const e1 = _t8713._val[2];
      const e2 = _t8713._val[3];
      const e1$p_8732 = Typechecker$xform_constrained_def(xctx, scheme, e1);
      const __rec_upd_8734 = xctx;
      const _t8735 = ({xf_constrained: __rec_upd_8734.xf_constrained, xf_locals: __rec_upd_8734.xf_locals, xf_record_evidence: __rec_upd_8734.xf_record_evidence, xf_schemes: ({_hd: [name, scheme], _tl: xctx.xf_schemes}), xf_type_env: __rec_upd_8734.xf_type_env});
      const xctx$p_8736 = _t8735;
      const _t8737 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [name, ({_tag: 1, _name: "Some", _val: scheme}), e1$p_8732, Typechecker$xform_expr(xctx$p_8736, e2)]}), te.ty);
      const _t8733 = _t8737;
      _t8714 = _t8733;
      break _t8715;
    }
    if (_t8713._tag === 8 && _t8713._val[1]._tag === 0) {
      const name = _t8713._val[0];
      const e1 = _t8713._val[2];
      const e2 = _t8713._val[3];
      const __rec_upd_8738 = xctx;
      const _t8739 = ({xf_constrained: __rec_upd_8738.xf_constrained, xf_locals: ({_hd: name, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_8738.xf_record_evidence, xf_schemes: __rec_upd_8738.xf_schemes, xf_type_env: __rec_upd_8738.xf_type_env});
      const xctx$p_8740 = _t8739;
      const _t8741 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [name, ({_tag: 0, _name: "None"}), Typechecker$xform_expr(xctx, e1), Typechecker$xform_expr(xctx$p_8740, e2)]}), te.ty);
      _t8714 = _t8741;
      break _t8715;
    }
    if (_t8713._tag === 9 && _t8713._val[1]._tag === 1) {
      const name = _t8713._val[0];
      const scheme = _t8713._val[1]._val;
      const e1 = _t8713._val[2];
      const e2 = _t8713._val[3];
      const __rec_upd_8742 = xctx;
      const _t8743 = ({xf_constrained: __rec_upd_8742.xf_constrained, xf_locals: __rec_upd_8742.xf_locals, xf_record_evidence: __rec_upd_8742.xf_record_evidence, xf_schemes: ({_hd: [name, scheme], _tl: xctx.xf_schemes}), xf_type_env: __rec_upd_8742.xf_type_env});
      const xctx$p_8744 = _t8743;
      const e1$p_8746 = Typechecker$xform_constrained_def(xctx$p_8744, scheme, e1);
      const _t8747 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 1, _name: "Some", _val: scheme}), e1$p_8746, Typechecker$xform_expr(xctx$p_8744, e2)]}), te.ty);
      const _t8745 = _t8747;
      _t8714 = _t8745;
      break _t8715;
    }
    if (_t8713._tag === 9 && _t8713._val[1]._tag === 0) {
      const name = _t8713._val[0];
      const e1 = _t8713._val[2];
      const e2 = _t8713._val[3];
      const __rec_upd_8748 = xctx;
      const _t8749 = ({xf_constrained: __rec_upd_8748.xf_constrained, xf_locals: ({_hd: name, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_8748.xf_record_evidence, xf_schemes: __rec_upd_8748.xf_schemes, xf_type_env: __rec_upd_8748.xf_type_env});
      const xctx$p_8750 = _t8749;
      const _t8751 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 0, _name: "None"}), Typechecker$xform_expr(xctx$p_8750, e1), Typechecker$xform_expr(xctx$p_8750, e2)]}), te.ty);
      _t8714 = _t8751;
      break _t8715;
    }
    if (_t8713._tag === 25) {
      const name = _t8713._val[0];
      const e1 = _t8713._val[1];
      const e2 = _t8713._val[2];
      const __rec_upd_8752 = xctx;
      const _t8753 = ({xf_constrained: __rec_upd_8752.xf_constrained, xf_locals: ({_hd: name, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_8752.xf_record_evidence, xf_schemes: __rec_upd_8752.xf_schemes, xf_type_env: __rec_upd_8752.xf_type_env});
      const xctx$p_8754 = _t8753;
      const _t8755 = Typechecker$mk(({_tag: 25, _name: "TELetMut", _val: [name, Typechecker$xform_expr(xctx, e1), Typechecker$xform_expr(xctx$p_8754, e2)]}), te.ty);
      _t8714 = _t8755;
      break _t8715;
    }
    if (_t8713._tag === 32) {
      const cond = _t8713._val[0];
      const body = _t8713._val[1];
      _t8714 = Typechecker$mk(({_tag: 32, _name: "TEWhile", _val: [Typechecker$xform_expr(xctx, cond), Typechecker$xform_expr(xctx, body)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 37) {
      const bindings = _t8713._val[0];
      const body = _t8713._val[1];
      const names_8756 = List$map(fst, bindings);
      const __rec_upd_8758 = xctx;
      const _t8759 = ({xf_constrained: __rec_upd_8758.xf_constrained, xf_locals: List$concat(names_8756, xctx.xf_locals), xf_record_evidence: __rec_upd_8758.xf_record_evidence, xf_schemes: __rec_upd_8758.xf_schemes, xf_type_env: __rec_upd_8758.xf_type_env});
      const xctx$p_8760 = _t8759;
      function _t8762(__p283) {
        let _t8764;
        const _t8763 = __p283;
        _t8765: {
          if (true) {
            const n = _t8763[0];
            const e = _t8763[1];
            _t8764 = [n, Typechecker$xform_expr(xctx$p_8760, e)];
            break _t8765;
          }
          _match_fail("line 16190");
        }
        return _t8764;
      }
      const bindings$p_8766 = List$map(_t8762, bindings);
      const _t8767 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [bindings$p_8766, Typechecker$xform_expr(xctx$p_8760, body)]}), te.ty);
      const _t8761 = _t8767;
      const _t8757 = _t8761;
      _t8714 = _t8757;
      break _t8715;
    }
    if (_t8713._tag === 12) {
      const c = _t8713._val[0];
      const t = _t8713._val[1];
      const e = _t8713._val[2];
      _t8714 = Typechecker$mk(({_tag: 12, _name: "TEIf", _val: [Typechecker$xform_expr(xctx, c), Typechecker$xform_expr(xctx, t), Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 15) {
      const es = _t8713._val;
      _t8714 = Typechecker$mk(({_tag: 15, _name: "TETuple", _val: List$map(_call(Typechecker$xform_expr, [xctx]), es)}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 16) {
      const fields = _t8713._val;
      function _t8768(__p284) {
        let _t8770;
        const _t8769 = __p284;
        _t8771: {
          if (true) {
            const n = _t8769[0];
            const e = _t8769[1];
            _t8770 = [n, Typechecker$xform_expr(xctx, e)];
            break _t8771;
          }
          _match_fail("line 16190");
        }
        return _t8770;
      }
      _t8714 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: List$map(_t8768, fields)}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 17) {
      const base = _t8713._val[0];
      const overrides = _t8713._val[1];
      const base$p_8772 = Typechecker$xform_expr(xctx, base);
      function _t8774(__p285) {
        let _t8776;
        const _t8775 = __p285;
        _t8777: {
          if (true) {
            const n = _t8775[0];
            const e = _t8775[1];
            _t8776 = [n, Typechecker$xform_expr(xctx, e)];
            break _t8777;
          }
          _match_fail("line 16190");
        }
        return _t8776;
      }
      const overrides$p_8778 = List$map(_t8774, overrides);
      function get_row_tail(row) {
        while (true) {
          let _t8781;
          const _t8780 = Types$rrow_repr(row);
          _t8782: {
            if (_t8780._tag === 0) {
              const tail = _t8780._val[2];
              const _t8783 = tail;
              row = _t8783;
              continue;
              _t8781 = undefined;
              break _t8782;
            }
            if (true) {
              const tail = _t8780;
              _t8781 = tail;
              break _t8782;
            }
            _match_fail("line 16190");
          }
          return _t8781;
        }
      }
      let _t8786;
      const _t8785 = Types$repr(base$p_8772.ty);
      _t8787: {
        if (_t8785._tag === 11) {
          const row = _t8785._val;
          let _t8789;
          const _t8788 = get_row_tail(row);
          _t8790: {
            if (_t8788._tag === 1 && _t8788._val.contents._tag === 0) {
              const id = _t8788._val.contents._val[0];
              function _t8791(__p286) {
                let _t8793;
                const _t8792 = __p286;
                _t8794: {
                  if (true) {
                    const rid = _t8792[0];
                    _t8793 = (rid === id);
                    break _t8794;
                  }
                  _match_fail("line 16190");
                }
                return _t8793;
              }
              _t8789 = List$exists(_t8791, xctx.xf_record_evidence);
              break _t8790;
            }
            if (true) {
              _t8789 = false;
              break _t8790;
            }
            _match_fail("line 16190");
          }
          _t8786 = _t8789;
          break _t8787;
        }
        if (true) {
          _t8786 = false;
          break _t8787;
        }
        _match_fail("line 16190");
      }
      const has_evidence_8795 = _t8786;
      let _t8797;
      if (has_evidence_8795) {
        let _t8799;
        const _t8798 = Types$repr(base$p_8772.ty);
        _t8800: {
          if (_t8798._tag === 11) {
            const r = _t8798._val;
            _t8799 = r;
            break _t8800;
          }
          if (true) {
            _t8799 = failwith("assert false");
            break _t8800;
          }
          _match_fail("line 16190");
        }
        const row_8801 = _t8799;
        let _t8804;
        const _t8803 = get_row_tail(row_8801);
        _t8805: {
          if (_t8803._tag === 1 && _t8803._val.contents._tag === 0) {
            const id = _t8803._val.contents._val[0];
            _t8804 = id;
            break _t8805;
          }
          if (true) {
            _t8804 = failwith("assert false");
            break _t8805;
          }
          _match_fail("line 16190");
        }
        const rvar_id_8806 = _t8804;
        function _t8808(__p287) {
          let _t8810;
          const _t8809 = __p287;
          _t8811: {
            if (true) {
              const name = _t8809[0];
              const e = _t8809[1];
              function _t8812(__p288) {
                let _t8814;
                const _t8813 = __p288;
                _t8815: {
                  if (true) {
                    const rid = _t8813[0];
                    const fname = _t8813[1];
                    const pname = _t8813[2];
                    let _t8816;
                    if (((rid === rvar_id_8806) && (fname === name))) {
                      _t8816 = ({_tag: 1, _name: "Some", _val: pname});
                    } else {
                      _t8816 = ({_tag: 0, _name: "None"});
                    }
                    _t8814 = _t8816;
                    break _t8815;
                  }
                  _match_fail("line 16190");
                }
                return _t8814;
              }
              const ev_param_8817 = List$find_map(_t8812, xctx.xf_record_evidence);
              let _t8820;
              const _t8819 = ev_param_8817;
              _t8821: {
                if (_t8819._tag === 1) {
                  const pname = _t8819._val;
                  _t8820 = [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: pname}), ({_tag: 0, _name: "TInt"})), e];
                  break _t8821;
                }
                if (_t8819._tag === 0) {
                  _t8820 = Typechecker$error(("missing record evidence for field " + __dict_Show_string.show(name)));
                  break _t8821;
                }
                _match_fail("line 16190");
              }
              const _t8818 = _t8820;
              _t8810 = _t8818;
              break _t8811;
            }
            _match_fail("line 16190");
          }
          return _t8810;
        }
        const idx_val_pairs_8822 = List$map(_t8808, overrides$p_8778);
        const _t8823 = Typechecker$mk(({_tag: 18, _name: "TERecordUpdateIdx", _val: [base$p_8772, idx_val_pairs_8822]}), te.ty);
        const _t8807 = _t8823;
        const _t8802 = _t8807;
        _t8797 = _t8802;
      } else {
        _t8797 = Typechecker$mk(({_tag: 17, _name: "TERecordUpdate", _val: [base$p_8772, overrides$p_8778]}), te.ty);
      }
      const _t8796 = _t8797;
      const _t8784 = _t8796;
      const _t8779 = _t8784;
      const _t8773 = _t8779;
      _t8714 = _t8773;
      break _t8715;
    }
    if (_t8713._tag === 18) {
      const base = _t8713._val[0];
      const pairs = _t8713._val[1];
      function _t8824(__p289) {
        let _t8826;
        const _t8825 = __p289;
        _t8827: {
          if (true) {
            const i = _t8825[0];
            const v = _t8825[1];
            _t8826 = [Typechecker$xform_expr(xctx, i), Typechecker$xform_expr(xctx, v)];
            break _t8827;
          }
          _match_fail("line 16190");
        }
        return _t8826;
      }
      _t8714 = Typechecker$mk(({_tag: 18, _name: "TERecordUpdateIdx", _val: [Typechecker$xform_expr(xctx, base), List$map(_t8824, pairs)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 19) {
      const e = _t8713._val[0];
      const name = _t8713._val[1];
      _t8714 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$xform_expr(xctx, e), name]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 21) {
      const hd = _t8713._val[0];
      const tl = _t8713._val[1];
      _t8714 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [Typechecker$xform_expr(xctx, hd), Typechecker$xform_expr(xctx, tl)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 23) {
      const name = _t8713._val[0];
      const arg = _t8713._val[1];
      _t8714 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [name, Option$map(_call(Typechecker$xform_expr, [xctx]), arg)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 24) {
      const scrutinee = _t8713._val[0];
      const arms = _t8713._val[1];
      const partial = _t8713._val[2];
      function _t8828(__p290) {
        let _t8830;
        const _t8829 = __p290;
        _t8831: {
          if (true) {
            const pat = _t8829[0];
            const guard = _t8829[1];
            const body = _t8829[2];
            const pvars_8832 = Typechecker$pat_bound_names(pat);
            const __rec_upd_8834 = xctx;
            const _t8835 = ({xf_constrained: __rec_upd_8834.xf_constrained, xf_locals: List$concat(pvars_8832, xctx.xf_locals), xf_record_evidence: __rec_upd_8834.xf_record_evidence, xf_schemes: __rec_upd_8834.xf_schemes, xf_type_env: __rec_upd_8834.xf_type_env});
            const xctx$p_8836 = _t8835;
            const _t8837 = [pat, Option$map(_call(Typechecker$xform_expr, [xctx$p_8836]), guard), Typechecker$xform_expr(xctx$p_8836, body)];
            const _t8833 = _t8837;
            _t8830 = _t8833;
            break _t8831;
          }
          _match_fail("line 16190");
        }
        return _t8830;
      }
      const arms$p_8838 = List$map(_t8828, arms);
      const _t8839 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [Typechecker$xform_expr(xctx, scrutinee), arms$p_8838, partial]}), te.ty);
      _t8714 = _t8839;
      break _t8715;
    }
    if (_t8713._tag === 26) {
      const name = _t8713._val[0];
      const e = _t8713._val[1];
      _t8714 = Typechecker$mk(({_tag: 26, _name: "TEAssign", _val: [name, Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 27) {
      const r = _t8713._val[0];
      const f = _t8713._val[1];
      const e = _t8713._val[2];
      _t8714 = Typechecker$mk(({_tag: 27, _name: "TEFieldAssign", _val: [Typechecker$xform_expr(xctx, r), f, Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 28) {
      const e1 = _t8713._val[0];
      const e2 = _t8713._val[1];
      _t8714 = Typechecker$mk(({_tag: 28, _name: "TESeq", _val: [Typechecker$xform_expr(xctx, e1), Typechecker$xform_expr(xctx, e2)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 29) {
      const name = _t8713._val[0];
      const e = _t8713._val[1];
      _t8714 = Typechecker$mk(({_tag: 29, _name: "TEPerform", _val: [name, Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 30) {
      const body = _t8713._val[0];
      const arms = _t8713._val[1];
      function _t8840(arm) {
        let _t8842;
        const _t8841 = arm;
        _t8843: {
          if (_t8841._tag === 0) {
            const n = _t8841._val[0];
            const e = _t8841._val[1];
            const __rec_upd_8844 = xctx;
            const _t8845 = ({xf_constrained: __rec_upd_8844.xf_constrained, xf_locals: ({_hd: n, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_8844.xf_record_evidence, xf_schemes: __rec_upd_8844.xf_schemes, xf_type_env: __rec_upd_8844.xf_type_env});
            const xctx$p_8846 = _t8845;
            const _t8847 = ({_tag: 0, _name: "THReturn", _val: [n, Typechecker$xform_expr(xctx$p_8846, e)]});
            _t8842 = _t8847;
            break _t8843;
          }
          if (_t8841._tag === 1) {
            const op = _t8841._val[0];
            const p = _t8841._val[1];
            const k = _t8841._val[2];
            const e = _t8841._val[3];
            const __rec_upd_8848 = xctx;
            const _t8849 = ({xf_constrained: __rec_upd_8848.xf_constrained, xf_locals: ({_hd: k, _tl: ({_hd: p, _tl: xctx.xf_locals})}), xf_record_evidence: __rec_upd_8848.xf_record_evidence, xf_schemes: __rec_upd_8848.xf_schemes, xf_type_env: __rec_upd_8848.xf_type_env});
            const xctx$p_8850 = _t8849;
            const _t8851 = ({_tag: 1, _name: "THOp", _val: [op, p, k, Typechecker$xform_expr(xctx$p_8850, e)]});
            _t8842 = _t8851;
            break _t8843;
          }
          if (_t8841._tag === 2) {
            const op = _t8841._val[0];
            const p = _t8841._val[1];
            const e = _t8841._val[2];
            const __rec_upd_8852 = xctx;
            const _t8853 = ({xf_constrained: __rec_upd_8852.xf_constrained, xf_locals: ({_hd: p, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_8852.xf_record_evidence, xf_schemes: __rec_upd_8852.xf_schemes, xf_type_env: __rec_upd_8852.xf_type_env});
            const xctx$p_8854 = _t8853;
            const _t8855 = ({_tag: 2, _name: "THOpProvide", _val: [op, p, Typechecker$xform_expr(xctx$p_8854, e)]});
            _t8842 = _t8855;
            break _t8843;
          }
          if (_t8841._tag === 3) {
            const op = _t8841._val[0];
            const p = _t8841._val[1];
            const e = _t8841._val[2];
            const __rec_upd_8856 = xctx;
            const _t8857 = ({xf_constrained: __rec_upd_8856.xf_constrained, xf_locals: ({_hd: p, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_8856.xf_record_evidence, xf_schemes: __rec_upd_8856.xf_schemes, xf_type_env: __rec_upd_8856.xf_type_env});
            const xctx$p_8858 = _t8857;
            const _t8859 = ({_tag: 3, _name: "THOpTry", _val: [op, p, Typechecker$xform_expr(xctx$p_8858, e)]});
            _t8842 = _t8859;
            break _t8843;
          }
          _match_fail("line 16190");
        }
        return _t8842;
      }
      const arms$p_8860 = List$map(_t8840, arms);
      const _t8861 = Typechecker$mk(({_tag: 30, _name: "TEHandle", _val: [Typechecker$xform_expr(xctx, body), arms$p_8860]}), te.ty);
      _t8714 = _t8861;
      break _t8715;
    }
    if (_t8713._tag === 31) {
      const k = _t8713._val[0];
      const e = _t8713._val[1];
      _t8714 = Typechecker$mk(({_tag: 31, _name: "TEResume", _val: [Typechecker$xform_expr(xctx, k), Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 38) {
      const pairs = _t8713._val;
      function _t8862(__p291) {
        let _t8864;
        const _t8863 = __p291;
        _t8865: {
          if (true) {
            const k = _t8863[0];
            const v = _t8863[1];
            _t8864 = [Typechecker$xform_expr(xctx, k), Typechecker$xform_expr(xctx, v)];
            break _t8865;
          }
          _match_fail("line 16190");
        }
        return _t8864;
      }
      _t8714 = Typechecker$mk(({_tag: 38, _name: "TEMap", _val: List$map(_t8862, pairs)}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 39) {
      const es = _t8713._val;
      _t8714 = Typechecker$mk(({_tag: 39, _name: "TEArray", _val: List$map(_call(Typechecker$xform_expr, [xctx]), es)}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 20) {
      const base = _t8713._val[0];
      const idx = _t8713._val[1];
      _t8714 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [Typechecker$xform_expr(xctx, base), Typechecker$xform_expr(xctx, idx)]}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 33) {
      const e = _t8713._val;
      _t8714 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 34) {
      _t8714 = te;
      break _t8715;
    }
    if (_t8713._tag === 35) {
      const e = _t8713._val;
      _t8714 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 36) {
      const e = _t8713._val;
      _t8714 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t8715;
    }
    if (_t8713._tag === 40) {
      const e = _t8713._val;
      _t8714 = Typechecker$mk(({_tag: 40, _name: "TEReturn", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t8715;
    }
    if ((((((((_t8713._tag === 0 || _t8713._tag === 1) || _t8713._tag === 2) || _t8713._tag === 3) || _t8713._tag === 4) || _t8713._tag === 5) || _t8713._tag === 6) || _t8713._tag === 22)) {
      _t8714 = te;
      break _t8715;
    }
    _match_fail("line 16190");
  }
  return _t8714;
}
function Typechecker$xform_class_method(xctx, name, te) {
  let _t8866;
  if (List$mem(name, xctx.xf_locals)) {
    _t8866 = te;
  } else {
    let _t8868;
    const _t8867 = Types$find_method_class(xctx.xf_type_env.classes, name);
    _t8869: {
      if (_t8867._tag === 1) {
        const result = _t8867;
        _t8868 = [result, name];
        break _t8869;
      }
      if (_t8867._tag === 0) {
        let _t8871;
        const _t8870 = String$rindex_opt(name, 46);
        _t8872: {
          if (_t8870._tag === 0) {
            _t8871 = [({_tag: 0, _name: "None"}), name];
            break _t8872;
          }
          if (_t8870._tag === 1) {
            const i = _t8870._val;
            const mod_prefix_8873 = String$sub(name, 0, (i + 1));
            const _mml$short_8875 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
            const class_prefix_8877 = String$sub(name, 0, i);
            let _t8880;
            const _t8879 = Types$find_method_class(xctx.xf_type_env.classes, _mml$short_8875);
            _t8881: {
              if (_t8879._tag === 1) {
                const class_def = _t8879._val;
                if ((class_def.class_name === class_prefix_8877)) {
                  _t8880 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_8875];
                  break _t8881;
                }
              }
              if (_t8879._tag === 1) {
                const class_def = _t8879._val;
                if (((String$length(class_def.class_name) > String$length(mod_prefix_8873)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_8873)) === mod_prefix_8873))) {
                  _t8880 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_8875];
                  break _t8881;
                }
              }
              if (true) {
                _t8880 = [({_tag: 0, _name: "None"}), name];
                break _t8881;
              }
              _match_fail("line 16190");
            }
            const _t8878 = _t8880;
            const _t8876 = _t8878;
            const _t8874 = _t8876;
            _t8871 = _t8874;
            break _t8872;
          }
          _match_fail("line 16190");
        }
        _t8868 = _t8871;
        break _t8869;
      }
      _match_fail("line 16190");
    }
    let _t8883;
    const _t8882 = _t8868;
    _t8884: {
      if (true) {
        const class_opt = _t8882[0];
        const method_name = _t8882[1];
        let _t8886;
        const _t8885 = class_opt;
        _t8887: {
          if (_t8885._tag === 1) {
            const class_def = _t8885._val;
            const method_schema_ty_8888 = List$assoc(method_name, class_def.class_methods);
            let _t8891;
            const _t8890 = List$assoc_opt(name, xctx.xf_schemes);
            _t8892: {
              if (_t8890._tag === 1) {
                const s = _t8890._val;
                _t8891 = !_eq(s.body, method_schema_ty_8888);
                break _t8892;
              }
              if (_t8890._tag === 0) {
                _t8891 = false;
                break _t8892;
              }
              _match_fail("line 16190");
            }
            const is_overridden_8893 = _t8891;
            let _t8895;
            if (is_overridden_8893) {
              _t8895 = te;
            } else {
              const num_params_8896 = List$length(class_def.class_params);
              const found_8898 = Hashtbl$create(num_params_8896);
              function go(s, r) {
                while (true) {
                  const r_8900 = Types$repr(r);
                  let _t8903;
                  const _t8902 = [s, r_8900];
                  _t8904: {
                    if (_t8902[0]._tag === 17) {
                      const i = _t8902[0]._val;
                      if ((i < num_params_8896)) {
                        let _t8905;
                        if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, found_8898, i]))) {
                          _t8905 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_8898, i, r_8900]);
                        } else {
                          _t8905 = undefined;
                        }
                        _t8903 = _t8905;
                        break _t8904;
                      }
                    }
                    if ((_t8902[0]._tag === 7 && _t8902[1]._tag === 7 || _t8902[0]._tag === 8 && _t8902[1]._tag === 8)) {
                      const s1 = _t8902[0]._val[0];
                      const s2 = _t8902[0]._val[2];
                      const r1 = _t8902[1]._val[0];
                      const r2 = _t8902[1]._val[2];
                      go(s1, r1);
                      const _t8906 = s2;
                      const _t8907 = r2;
                      s = _t8906;
                      r = _t8907;
                      continue;
                      _t8903 = undefined;
                      break _t8904;
                    }
                    if (_t8902[0]._tag === 9 && _t8902[1]._tag === 9) {
                      const ss = _t8902[0]._val;
                      const rs = _t8902[1]._val;
                      if ((List$length(ss) === List$length(rs))) {
                        _t8903 = List$iter2(go, ss, rs);
                        break _t8904;
                      }
                    }
                    if (_t8902[0]._tag === 10 && _t8902[1]._tag === 10) {
                      const s1 = _t8902[0]._val;
                      const r1 = _t8902[1]._val;
                      const _t8908 = s1;
                      const _t8909 = r1;
                      s = _t8908;
                      r = _t8909;
                      continue;
                      _t8903 = undefined;
                      break _t8904;
                    }
                    if (_t8902[0]._tag === 14 && _t8902[1]._tag === 14) {
                      const s1 = _t8902[0]._val;
                      const r1 = _t8902[1]._val;
                      const _t8910 = s1;
                      const _t8911 = r1;
                      s = _t8910;
                      r = _t8911;
                      continue;
                      _t8903 = undefined;
                      break _t8904;
                    }
                    if (_t8902[0]._tag === 13 && _t8902[1]._tag === 13) {
                      const sk = _t8902[0]._val[0];
                      const sv = _t8902[0]._val[1];
                      const rk = _t8902[1]._val[0];
                      const rv = _t8902[1]._val[1];
                      go(sk, rk);
                      const _t8912 = sv;
                      const _t8913 = rv;
                      s = _t8912;
                      r = _t8913;
                      continue;
                      _t8903 = undefined;
                      break _t8904;
                    }
                    if (_t8902[0]._tag === 12 && _t8902[1]._tag === 12) {
                      const ss = _t8902[0]._val[1];
                      const rs = _t8902[1]._val[1];
                      if ((List$length(ss) === List$length(rs))) {
                        _t8903 = List$iter2(go, ss, rs);
                        break _t8904;
                      }
                    }
                    if (true) {
                      _t8903 = undefined;
                      break _t8904;
                    }
                    _match_fail("line 16190");
                  }
                  const _t8901 = _t8903;
                  return _t8901;
                }
              }
              go(method_schema_ty_8888, te.ty);
              let _t8915;
              if (!_eq(xctx.xf_constrained, null)) {
                function _t8916(i) {
                  let _t8918;
                  const _t8917 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_8898, i]);
                  _t8919: {
                    if (_t8917._tag === 1 && _t8917._val._tag === 16 && _t8917._val._val.contents._tag === 0) {
                      const id = _t8917._val._val.contents._val[0];
                      _t8918 = Typechecker$find_constrained_dict(xctx, id, class_def.class_name);
                      break _t8919;
                    }
                    if (true) {
                      _t8918 = ({_tag: 0, _name: "None"});
                      break _t8919;
                    }
                    _match_fail("line 16190");
                  }
                  return _t8918;
                }
                function _t8920(x) {
                  return x;
                }
                const exact_match_8921 = List$find_map(_t8916, List$init(num_params_8896, _t8920));
                let _t8924;
                const _t8923 = exact_match_8921;
                _t8925: {
                  if (_t8923._tag === 1) {
                    _t8924 = exact_match_8921;
                    break _t8925;
                  }
                  if (_t8923._tag === 0) {
                    function _t8926(i) {
                      let _t8928;
                      const _t8927 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_8898, i]);
                      _t8929: {
                        if (_t8927._tag === 1 && _t8927._val._tag === 16 && _t8927._val._val.contents._tag === 0) {
                          _t8928 = true;
                          break _t8929;
                        }
                        if (true) {
                          _t8928 = false;
                          break _t8929;
                        }
                        _match_fail("line 16190");
                      }
                      return _t8928;
                    }
                    function _t8930(x) {
                      return x;
                    }
                    const has_unbound_arg_8931 = List$exists(_t8926, List$init(num_params_8896, _t8930));
                    let _t8933;
                    if (has_unbound_arg_8931) {
                      function _t8934(__p292) {
                        let _t8936;
                        const _t8935 = __p292;
                        _t8937: {
                          if (true) {
                            const _tid = _t8935[0];
                            const _dp = _t8935[1];
                            const cls = _t8935[2];
                            _t8936 = (cls === class_def.class_name);
                            break _t8937;
                          }
                          _match_fail("line 16190");
                        }
                        return _t8936;
                      }
                      const matching_constraints_8938 = List$filter(_t8934, xctx.xf_constrained);
                      let _t8941;
                      const _t8940 = matching_constraints_8938;
                      _t8942: {
                        if (_t8940 !== null && _t8940._tl === null) {
                          const _tid = _t8940._hd[0];
                          const dp = _t8940._hd[1];
                          const _cls = _t8940._hd[2];
                          _t8941 = ({_tag: 1, _name: "Some", _val: dp});
                          break _t8942;
                        }
                        if (true) {
                          _t8941 = ({_tag: 0, _name: "None"});
                          break _t8942;
                        }
                        _match_fail("line 16190");
                      }
                      const _t8939 = _t8941;
                      _t8933 = _t8939;
                    } else {
                      _t8933 = ({_tag: 0, _name: "None"});
                    }
                    const _t8932 = _t8933;
                    _t8924 = _t8932;
                    break _t8925;
                  }
                  _match_fail("line 16190");
                }
                const _t8922 = _t8924;
                _t8915 = _t8922;
              } else {
                _t8915 = ({_tag: 0, _name: "None"});
              }
              const constrained_match_8943 = _t8915;
              let _t8946;
              const _t8945 = constrained_match_8943;
              _t8947: {
                if (_t8945._tag === 1) {
                  const dp = _t8945._val;
                  _t8946 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dp}), ({_tag: 6, _name: "TUnit"})), method_name]}), te.ty);
                  break _t8947;
                }
                if (_t8945._tag === 0) {
                  function _t8948(i) {
                    return _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_8898, i]);
                  }
                  const type_args_8949 = List$init(num_params_8896, _t8948);
                  function _t8951(opt) {
                    let _t8953;
                    const _t8952 = opt;
                    _t8954: {
                      if (_t8952._tag === 1) {
                        const ty = _t8952._val;
                        let _t8956;
                        const _t8955 = Types$repr(ty);
                        _t8957: {
                          if (_t8955._tag === 16 && _t8955._val.contents._tag === 0) {
                            _t8956 = ({_tag: 0, _name: "None"});
                            break _t8957;
                          }
                          if (true) {
                            _t8956 = ({_tag: 1, _name: "Some", _val: ty});
                            break _t8957;
                          }
                          _match_fail("line 16190");
                        }
                        _t8953 = _t8956;
                        break _t8954;
                      }
                      if (_t8952._tag === 0) {
                        _t8953 = ({_tag: 0, _name: "None"});
                        break _t8954;
                      }
                      _match_fail("line 16190");
                    }
                    return _t8953;
                  }
                  const partial_args_8958 = List$map(_t8951, type_args_8949);
                  function _t8960(opt) {
                    return !_eq(opt, ({_tag: 0, _name: "None"}));
                  }
                  const has_info_8961 = List$exists(_t8960, partial_args_8958);
                  let _t8963;
                  if (has_info_8961) {
                    function _t8964(inst) {
                      return ((inst.inst_class === class_def.class_name) && ((List$length(inst.inst_tys) === List$length(partial_args_8958)) && Types$match_partial_inst(inst.inst_tys, partial_args_8958)));
                    }
                    const matching_8965 = List$filter(_t8964, xctx.xf_type_env.instances);
                    function _t8967(opt) {
                      return !_eq(opt, ({_tag: 0, _name: "None"}));
                    }
                    const all_concrete_8968 = List$forall(_t8967, partial_args_8958);
                    let _t8971;
                    const _t8970 = matching_8965;
                    _t8972: {
                      if (_t8970 !== null && _t8970._tl === null) {
                        const inst = _t8970._hd;
                        _t8971 = ({_tag: 1, _name: "Some", _val: inst});
                        break _t8972;
                      }
                      if (_t8970 !== null) {
                        _t8971 = Types$most_specific_inst(matching_8965);
                        break _t8972;
                      }
                      if (_t8970 === null) {
                        _t8971 = ({_tag: 0, _name: "None"});
                        break _t8972;
                      }
                      _match_fail("line 16190");
                    }
                    const resolved_8973 = _t8971;
                    function _t8975(inst) {
                      function _t8976(__p293) {
                        let _t8978;
                        const _t8977 = __p293;
                        _t8979: {
                          if (true) {
                            const n = _t8977[0];
                            _t8978 = (n === method_name);
                            break _t8979;
                          }
                          _match_fail("line 16190");
                        }
                        return _t8978;
                      }
                      let _t8981;
                      const _t8980 = List$find(_t8976, class_def.class_methods);
                      _t8982: {
                        if (_t8980._tag === 1) {
                          const method_ty = _t8980._val[1];
                          function _t8983(ty, __p294) {
                            let _t8985;
                            const _t8984 = __p294;
                            _t8986: {
                              if (true) {
                                const i = _t8984[0];
                                const inst_ty = _t8984[1];
                                function subst(t) {
                                  let _t8988;
                                  const _t8987 = t;
                                  _t8989: {
                                    if (_t8987._tag === 17) {
                                      const j = _t8987._val;
                                      if ((j === i)) {
                                        _t8988 = inst_ty;
                                        break _t8989;
                                      }
                                    }
                                    if (_t8987._tag === 7) {
                                      const a = _t8987._val[0];
                                      const e = _t8987._val[1];
                                      const r = _t8987._val[2];
                                      _t8988 = ({_tag: 7, _name: "TArrow", _val: [subst(a), e, subst(r)]});
                                      break _t8989;
                                    }
                                    if (_t8987._tag === 9) {
                                      const ts = _t8987._val;
                                      _t8988 = ({_tag: 9, _name: "TTuple", _val: List$map(subst, ts)});
                                      break _t8989;
                                    }
                                    if (_t8987._tag === 10) {
                                      const t = _t8987._val;
                                      _t8988 = ({_tag: 10, _name: "TList", _val: subst(t)});
                                      break _t8989;
                                    }
                                    if (_t8987._tag === 14) {
                                      const t = _t8987._val;
                                      _t8988 = ({_tag: 14, _name: "TArray", _val: subst(t)});
                                      break _t8989;
                                    }
                                    if (_t8987._tag === 13) {
                                      const k = _t8987._val[0];
                                      const v = _t8987._val[1];
                                      _t8988 = ({_tag: 13, _name: "TMap", _val: [subst(k), subst(v)]});
                                      break _t8989;
                                    }
                                    if (true) {
                                      _t8988 = t;
                                      break _t8989;
                                    }
                                    _match_fail("line 16190");
                                  }
                                  return _t8988;
                                }
                                const _t8990 = subst(ty);
                                _t8985 = _t8990;
                                break _t8986;
                              }
                              _match_fail("line 16190");
                            }
                            return _t8985;
                          }
                          function _t8991(i, t) {
                            return [i, t];
                          }
                          const concrete_ty_8992 = List$fold(_t8983, method_ty, List$mapi(_t8991, inst.inst_tys));
                          const _t8993 = concrete_ty_8992;
                          _t8981 = _t8993;
                          break _t8982;
                        }
                        if (_t8980._tag === 0) {
                          _t8981 = te.ty;
                          break _t8982;
                        }
                        _match_fail("line 16190");
                      }
                      return _t8981;
                    }
                    const resolve_method_type_8994 = _t8975;
                    let _t8997;
                    const _t8996 = resolved_8973;
                    _t8998: {
                      if (_t8996._tag === 1) {
                        const inst = _t8996._val;
                        if ((!_eq(inst.inst_constraints, null) && all_concrete_8968)) {
                          function _t8999(x) {
                            return x;
                          }
                          const arg_types_9000 = List$filter_map(_t8999, type_args_8949);
                          const factory_9002 = Typechecker$resolve_factory_dict(xctx, inst, arg_types_9000);
                          const resolved_ty_9004 = resolve_method_type_8994(inst);
                          const _t9005 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [factory_9002, method_name]}), resolved_ty_9004);
                          const _t9003 = _t9005;
                          const _t9001 = _t9003;
                          _t8997 = _t9001;
                          break _t8998;
                        }
                      }
                      if (_t8996._tag === 1) {
                        const inst = _t8996._val;
                        if (_eq(inst.inst_constraints, null)) {
                          const resolved_ty_9006 = resolve_method_type_8994(inst);
                          const _t9007 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"})), method_name]}), resolved_ty_9006);
                          _t8997 = _t9007;
                          break _t8998;
                        }
                      }
                      if (true) {
                        _t8997 = te;
                        break _t8998;
                      }
                      _match_fail("line 16190");
                    }
                    const _t8995 = _t8997;
                    const _t8974 = _t8995;
                    const _t8969 = _t8974;
                    const _t8966 = _t8969;
                    _t8963 = _t8966;
                  } else {
                    _t8963 = te;
                  }
                  const _t8962 = _t8963;
                  const _t8959 = _t8962;
                  const _t8950 = _t8959;
                  _t8946 = _t8950;
                  break _t8947;
                }
                _match_fail("line 16190");
              }
              const _t8944 = _t8946;
              const _t8914 = _t8944;
              const _t8899 = _t8914;
              const _t8897 = _t8899;
              _t8895 = _t8897;
            }
            const _t8894 = _t8895;
            const _t8889 = _t8894;
            _t8886 = _t8889;
            break _t8887;
          }
          if (_t8885._tag === 0) {
            _t8886 = te;
            break _t8887;
          }
          _match_fail("line 16190");
        }
        _t8883 = _t8886;
        break _t8884;
      }
      _match_fail("line 16190");
    }
    _t8866 = _t8883;
  }
  return _t8866;
}
function Typechecker$xform_constrained_ref(xctx, name, te) {
  let _t9009;
  const _t9008 = List$assoc_opt(name, xctx.xf_schemes);
  _t9010: {
    if (_t9008._tag === 1) {
      const scheme = _t9008._val;
      if (Typechecker$scheme_needs_xform(scheme)) {
        const result_9011 = Ref$create(te);
        let _t9013;
        if (!_eq(scheme.constraints, null)) {
          const tgen_map_9014 = Typechecker$build_tgen_map(scheme.body, te.ty);
          function _t9016(cc) {
            return Typechecker$resolve_dict_arg(xctx, cc, tgen_map_9014);
          }
          const dict_args_9017 = List$map(_t9016, scheme.constraints);
          function _t9019(fn_, dict_arg) {
            return Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_, dict_arg]}), ({_tag: 6, _name: "TUnit"}));
          }
          const _t9018 = Ref$set(result_9011, List$fold(_t9019, Ref$get(result_9011), dict_args_9017));
          const _t9015 = _t9018;
          _t9013 = _t9015;
        } else {
          _t9013 = undefined;
        }
        _t9013;
        let _t9020;
        if (!_eq(scheme.record_evidences, null)) {
          const rgen_map_9021 = Typechecker$build_rgen_map(scheme.body, te.ty);
          function _t9023(re) {
            return Typechecker$resolve_record_evidence_args(xctx, rgen_map_9021, re);
          }
          const ev_args_9024 = List$concat_map(_t9023, scheme.record_evidences);
          function _t9026(fn_, ev_arg) {
            return Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_, ev_arg]}), ({_tag: 6, _name: "TUnit"}));
          }
          const _t9025 = Ref$set(result_9011, List$fold(_t9026, Ref$get(result_9011), ev_args_9024));
          const _t9022 = _t9025;
          _t9020 = _t9022;
        } else {
          _t9020 = undefined;
        }
        _t9020;
        const _t9012 = Ref$get(result_9011);
        _t9009 = _t9012;
        break _t9010;
      }
    }
    if (true) {
      _t9009 = te;
      break _t9010;
    }
    _match_fail("line 16190");
  }
  return _t9009;
}
function Typechecker$resolve_record_evidence_args(xctx, rgen_map, re) {
  let _t9028;
  const _t9027 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rgen_map, re.re_rgen]);
  _t9029: {
    if (_t9027._tag === 1) {
      const arow = _t9027._val;
      const fields_9030 = Types$record_row_to_fields(arow);
      function _t9032(__p295, __p296) {
        let _t9034;
        const _t9033 = __p295;
        _t9035: {
          if (true) {
            const a = _t9033[0];
            let _t9037;
            const _t9036 = __p296;
            _t9038: {
              if (true) {
                const b = _t9036[0];
                _t9037 = String$compare(a, b);
                break _t9038;
              }
              _match_fail("line 16190");
            }
            _t9034 = _t9037;
            break _t9035;
          }
          _match_fail("line 16190");
        }
        return _t9034;
      }
      const sorted_names_9039 = List$map(fst, List$sort(_t9032, fields_9030));
      function is_closed(r) {
        while (true) {
          let _t9042;
          const _t9041 = Types$rrow_repr(r);
          _t9043: {
            if (_t9041._tag === 0) {
              const tail = _t9041._val[2];
              const _t9044 = tail;
              r = _t9044;
              continue;
              _t9042 = undefined;
              break _t9043;
            }
            if (_t9041._tag === 2) {
              _t9042 = true;
              break _t9043;
            }
            if (true) {
              _t9042 = false;
              break _t9043;
            }
            _match_fail("line 16190");
          }
          return _t9042;
        }
      }
      let _t9046;
      if (is_closed(arow)) {
        function _t9047(field_name) {
          const idx_9048 = Ref$create((-1));
          function _t9050(i, n) {
            let _t9051;
            if ((n === field_name)) {
              _t9051 = Ref$set(idx_9048, i);
            } else {
              _t9051 = undefined;
            }
            return _t9051;
          }
          List$iteri(_t9050, sorted_names_9039);
          let _t9052;
          if ((Ref$get(idx_9048) >= 0)) {
            _t9052 = Typechecker$mk(({_tag: 0, _name: "TEInt", _val: Ref$get(idx_9048)}), ({_tag: 0, _name: "TInt"}));
          } else {
            _t9052 = Typechecker$error((("field " + __dict_Show_string.show(field_name)) + " not found in concrete record for evidence"));
          }
          const _t9049 = _t9052;
          return _t9049;
        }
        _t9046 = List$map(_t9047, re.re_fields);
      } else {
        function get_tail(r) {
          while (true) {
            let _t9054;
            const _t9053 = Types$rrow_repr(r);
            _t9055: {
              if (_t9053._tag === 0) {
                const tail = _t9053._val[2];
                const _t9056 = tail;
                r = _t9056;
                continue;
                _t9054 = undefined;
                break _t9055;
              }
              if (true) {
                const tail = _t9053;
                _t9054 = tail;
                break _t9055;
              }
              _match_fail("line 16190");
            }
            return _t9054;
          }
        }
        let _t9059;
        const _t9058 = get_tail(arow);
        _t9060: {
          if (_t9058._tag === 1 && _t9058._val.contents._tag === 0) {
            const id = _t9058._val.contents._val[0];
            function _t9061(field_name) {
              function _t9062(__p297) {
                let _t9064;
                const _t9063 = __p297;
                _t9065: {
                  if (true) {
                    const rid = _t9063[0];
                    const fname = _t9063[1];
                    const pname = _t9063[2];
                    let _t9066;
                    if (((rid === id) && (fname === field_name))) {
                      _t9066 = ({_tag: 1, _name: "Some", _val: pname});
                    } else {
                      _t9066 = ({_tag: 0, _name: "None"});
                    }
                    _t9064 = _t9066;
                    break _t9065;
                  }
                  _match_fail("line 16190");
                }
                return _t9064;
              }
              let _t9068;
              const _t9067 = List$find_map(_t9062, xctx.xf_record_evidence);
              _t9069: {
                if (_t9067._tag === 1) {
                  const pname = _t9067._val;
                  _t9068 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: pname}), ({_tag: 0, _name: "TInt"}));
                  break _t9069;
                }
                if (_t9067._tag === 0) {
                  _t9068 = Typechecker$error((("no evidence for field " + __dict_Show_string.show(field_name)) + " in polymorphic context"));
                  break _t9069;
                }
                _match_fail("line 16190");
              }
              return _t9068;
            }
            _t9059 = List$map(_t9061, re.re_fields);
            break _t9060;
          }
          if (true) {
            _t9059 = Typechecker$error("expected open row for evidence forwarding");
            break _t9060;
          }
          _match_fail("line 16190");
        }
        const _t9057 = _t9059;
        _t9046 = _t9057;
      }
      const _t9045 = _t9046;
      const _t9040 = _t9045;
      const _t9031 = _t9040;
      _t9028 = _t9031;
      break _t9029;
    }
    if (_t9027._tag === 0) {
      _t9028 = Typechecker$error((("internal error: no record evidence for fields [" + __dict_Show_string.show(String$concat(", ", re.re_fields))) + "]"));
      break _t9029;
    }
    _match_fail("line 16190");
  }
  return _t9028;
}
function Typechecker$xform_binop(xctx, op, e1, e2, result_ty) {
  let _t9071;
  const _t9070 = op;
  _t9072: {
    if (_t9070._tag === 0) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Num", "+"]});
      break _t9072;
    }
    if (_t9070._tag === 1) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Num", "-"]});
      break _t9072;
    }
    if (_t9070._tag === 2) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Num", "*"]});
      break _t9072;
    }
    if (_t9070._tag === 3) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Num", "/"]});
      break _t9072;
    }
    if (_t9070._tag === 5) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Eq", "="]});
      break _t9072;
    }
    if (_t9070._tag === 6) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Eq", "<>"]});
      break _t9072;
    }
    if (_t9070._tag === 7) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Ord", "<"]});
      break _t9072;
    }
    if (_t9070._tag === 8) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Ord", ">"]});
      break _t9072;
    }
    if (_t9070._tag === 9) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Ord", "<="]});
      break _t9072;
    }
    if (_t9070._tag === 10) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Ord", ">="]});
      break _t9072;
    }
    if (_t9070._tag === 14) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "land"]});
      break _t9072;
    }
    if (_t9070._tag === 15) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lor"]});
      break _t9072;
    }
    if (_t9070._tag === 16) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lxor"]});
      break _t9072;
    }
    if (_t9070._tag === 17) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lsl"]});
      break _t9072;
    }
    if (_t9070._tag === 18) {
      _t9071 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lsr"]});
      break _t9072;
    }
    if (true) {
      _t9071 = ({_tag: 0, _name: "None"});
      break _t9072;
    }
    _match_fail("line 16190");
  }
  const class_info_9073 = _t9071;
  let _t9076;
  const _t9075 = class_info_9073;
  _t9077: {
    if (_t9075._tag === 1) {
      const class_name = _t9075._val[0];
      const method_name = _t9075._val[1];
      if (!_eq(xctx.xf_constrained, null)) {
        let _t9079;
        const _t9078 = Types$repr(e1.ty);
        _t9080: {
          if (_t9078._tag === 16 && _t9078._val.contents._tag === 0) {
            const id = _t9078._val.contents._val[0];
            let _t9082;
            const _t9081 = Typechecker$find_constrained_dict(xctx, id, class_name);
            _t9083: {
              if (_t9081._tag === 1) {
                const dparam = _t9081._val;
                const dict_ref_9084 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dparam}), ({_tag: 6, _name: "TUnit"}));
                const method_ref_9086 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [dict_ref_9084, method_name]}), ({_tag: 6, _name: "TUnit"}));
                const app1_9088 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [method_ref_9086, e1]}), ({_tag: 6, _name: "TUnit"}));
                const _t9089 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [app1_9088, e2]}), result_ty);
                const _t9087 = _t9089;
                const _t9085 = _t9087;
                _t9082 = _t9085;
                break _t9083;
              }
              if (_t9081._tag === 0) {
                _t9082 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, e1, e2]}), result_ty);
                break _t9083;
              }
              _match_fail("line 16190");
            }
            _t9079 = _t9082;
            break _t9080;
          }
          if (true) {
            _t9079 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, e1, e2]}), result_ty);
            break _t9080;
          }
          _match_fail("line 16190");
        }
        _t9076 = _t9079;
        break _t9077;
      }
    }
    if (true) {
      _t9076 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, e1, e2]}), result_ty);
      break _t9077;
    }
    _match_fail("line 16190");
  }
  const _t9074 = _t9076;
  return _t9074;
}
function Typechecker$xform_unop(xctx, op, e, result_ty) {
  let _t9091;
  const _t9090 = op;
  _t9092: {
    if (_t9090._tag === 0) {
      _t9091 = ({_tag: 1, _name: "Some", _val: ["Num", "negate"]});
      break _t9092;
    }
    if (true) {
      _t9091 = ({_tag: 0, _name: "None"});
      break _t9092;
    }
    _match_fail("line 16190");
  }
  const class_info_9093 = _t9091;
  let _t9096;
  const _t9095 = class_info_9093;
  _t9097: {
    if (_t9095._tag === 1) {
      const class_name = _t9095._val[0];
      const method_name = _t9095._val[1];
      if (!_eq(xctx.xf_constrained, null)) {
        let _t9099;
        const _t9098 = Types$repr(e.ty);
        _t9100: {
          if (_t9098._tag === 16 && _t9098._val.contents._tag === 0) {
            const id = _t9098._val.contents._val[0];
            let _t9102;
            const _t9101 = Typechecker$find_constrained_dict(xctx, id, class_name);
            _t9103: {
              if (_t9101._tag === 1) {
                const dparam = _t9101._val;
                const dict_ref_9104 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dparam}), ({_tag: 6, _name: "TUnit"}));
                const method_ref_9106 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [dict_ref_9104, method_name]}), ({_tag: 6, _name: "TUnit"}));
                const _t9107 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [method_ref_9106, e]}), result_ty);
                const _t9105 = _t9107;
                _t9102 = _t9105;
                break _t9103;
              }
              if (_t9101._tag === 0) {
                _t9102 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, e]}), result_ty);
                break _t9103;
              }
              _match_fail("line 16190");
            }
            _t9099 = _t9102;
            break _t9100;
          }
          if (true) {
            _t9099 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, e]}), result_ty);
            break _t9100;
          }
          _match_fail("line 16190");
        }
        _t9096 = _t9099;
        break _t9097;
      }
    }
    if (true) {
      _t9096 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, e]}), result_ty);
      break _t9097;
    }
    _match_fail("line 16190");
  }
  const _t9094 = _t9096;
  return _t9094;
}
function Typechecker$xform_constrained_def(xctx, scheme, te) {
  const tgen_map_9108 = Typechecker$build_tgen_map(scheme.body, te.ty);
  function _t9110(__p298, cc) {
    let _t9112;
    const _t9111 = __p298;
    _t9113: {
      if (true) {
        const entries = _t9111[0];
        const params = _t9111[1];
        function _t9114(ca) {
          let _t9116;
          const _t9115 = ca;
          _t9117: {
            if (_t9115._tag === 0) {
              const tgen_idx = _t9115._val;
              let _t9119;
              const _t9118 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_map_9108, tgen_idx]);
              _t9120: {
                if (_t9118._tag === 1 && _t9118._val._tag === 16 && _t9118._val._val.contents._tag === 0) {
                  const id = _t9118._val._val.contents._val[0];
                  _t9119 = ({_tag: 1, _name: "Some", _val: [id, tgen_idx]});
                  break _t9120;
                }
                if (true) {
                  _t9119 = ({_tag: 0, _name: "None"});
                  break _t9120;
                }
                _match_fail("line 16190");
              }
              _t9116 = _t9119;
              break _t9117;
            }
            if (_t9115._tag === 1) {
              const ty = _t9115._val;
              let _t9122;
              const _t9121 = Types$repr(ty);
              _t9123: {
                if (_t9121._tag === 16 && _t9121._val.contents._tag === 0) {
                  const id = _t9121._val.contents._val[0];
                  _t9122 = ({_tag: 1, _name: "Some", _val: [id, (1000 + id)]});
                  break _t9123;
                }
                if (true) {
                  _t9122 = ({_tag: 0, _name: "None"});
                  break _t9123;
                }
                _match_fail("line 16190");
              }
              _t9116 = _t9122;
              break _t9117;
            }
            if (_t9115._tag === 2) {
              _t9116 = ({_tag: 0, _name: "None"});
              break _t9117;
            }
            if (_t9115._tag === 3) {
              const tv = _t9115._val[1];
              let _t9125;
              const _t9124 = Types$repr(tv);
              _t9126: {
                if (_t9124._tag === 16 && _t9124._val.contents._tag === 0) {
                  const id = _t9124._val.contents._val[0];
                  _t9125 = ({_tag: 1, _name: "Some", _val: [id, (1000 + id)]});
                  break _t9126;
                }
                if (true) {
                  _t9125 = ({_tag: 0, _name: "None"});
                  break _t9126;
                }
                _match_fail("line 16190");
              }
              _t9116 = _t9125;
              break _t9117;
            }
            _match_fail("line 16190");
          }
          return _t9116;
        }
        const tvar_entries_9127 = List$filter_map(_t9114, cc.cc_args);
        let _t9130;
        const _t9129 = tvar_entries_9127;
        _t9131: {
          if (_t9129 === null) {
            const dparam_9132 = ((("__dict_" + __dict_Show_string.show(cc.cc_class)) + "_resolved_") + __dict_Show_int.show(List$length(params)));
            const _t9133 = [entries, ({_hd: dparam_9132, _tl: params})];
            _t9130 = _t9133;
            break _t9131;
          }
          if (true) {
            function _t9134(__p299) {
              let _t9136;
              const _t9135 = __p299;
              _t9137: {
                if (true) {
                  const idx = _t9135[1];
                  _t9136 = string_of_int(idx);
                  break _t9137;
                }
                _match_fail("line 16190");
              }
              return _t9136;
            }
            const dparam_9138 = ((("__dict_" + __dict_Show_string.show(cc.cc_class)) + "_") + __dict_Show_string.show(String$concat("_", List$map(_t9134, tvar_entries_9127))));
            function _t9140(__p300) {
              let _t9142;
              const _t9141 = __p300;
              _t9143: {
                if (true) {
                  const id = _t9141[0];
                  _t9142 = [id, dparam_9138, cc.cc_class];
                  break _t9143;
                }
                _match_fail("line 16190");
              }
              return _t9142;
            }
            const new_entries_9144 = List$map(_t9140, tvar_entries_9127);
            const _t9145 = [List$concat(new_entries_9144, entries), ({_hd: dparam_9138, _tl: params})];
            const _t9139 = _t9145;
            _t9130 = _t9139;
            break _t9131;
          }
          _match_fail("line 16190");
        }
        const _t9128 = _t9130;
        _t9112 = _t9128;
        break _t9113;
      }
      _match_fail("line 16190");
    }
    return _t9112;
  }
  let _t9147;
  const _t9146 = List$fold(_t9110, [null, null], scheme.constraints);
  _t9148: {
    if (true) {
      const all_constrained = _t9146[0];
      const dict_param_names = _t9146[1];
      const dict_param_names_9149 = List$rev(dict_param_names);
      const rgen_map_9151 = Typechecker$build_rgen_map(scheme.body, te.ty);
      function _t9153(__p301, re) {
        let _t9155;
        const _t9154 = __p301;
        _t9156: {
          if (true) {
            const entries = _t9154[0];
            const params = _t9154[1];
            function _t9157(__p302, field_name) {
              let _t9159;
              const _t9158 = __p302;
              _t9160: {
                if (true) {
                  const entries = _t9158[0];
                  const params = _t9158[1];
                  const pname_9161 = ((("__ev_" + __dict_Show_string.show(field_name)) + "_r") + __dict_Show_int.show(re.re_rgen));
                  let _t9164;
                  const _t9163 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rgen_map_9151, re.re_rgen]);
                  _t9165: {
                    if (_t9163._tag === 1) {
                      const arow = _t9163._val;
                      function get_tail(r) {
                        while (true) {
                          let _t9167;
                          const _t9166 = Types$rrow_repr(r);
                          _t9168: {
                            if (_t9166._tag === 0) {
                              const tail = _t9166._val[2];
                              const _t9169 = tail;
                              r = _t9169;
                              continue;
                              _t9167 = undefined;
                              break _t9168;
                            }
                            if (true) {
                              const tail = _t9166;
                              _t9167 = tail;
                              break _t9168;
                            }
                            _match_fail("line 16190");
                          }
                          return _t9167;
                        }
                      }
                      let _t9172;
                      const _t9171 = get_tail(arow);
                      _t9173: {
                        if (_t9171._tag === 1 && _t9171._val.contents._tag === 0) {
                          const id = _t9171._val.contents._val[0];
                          _t9172 = ({_hd: [id, field_name, pname_9161], _tl: null});
                          break _t9173;
                        }
                        if (true) {
                          _t9172 = null;
                          break _t9173;
                        }
                        _match_fail("line 16190");
                      }
                      const _t9170 = _t9172;
                      _t9164 = _t9170;
                      break _t9165;
                    }
                    if (_t9163._tag === 0) {
                      _t9164 = null;
                      break _t9165;
                    }
                    _match_fail("line 16190");
                  }
                  const rvar_entries_9174 = _t9164;
                  const _t9175 = [List$concat(rvar_entries_9174, entries), ({_hd: pname_9161, _tl: params})];
                  const _t9162 = _t9175;
                  _t9159 = _t9162;
                  break _t9160;
                }
                _match_fail("line 16190");
              }
              return _t9159;
            }
            _t9155 = List$fold(_t9157, [entries, params], re.re_fields);
            break _t9156;
          }
          _match_fail("line 16190");
        }
        return _t9155;
      }
      let _t9177;
      const _t9176 = List$fold(_t9153, [null, null], scheme.record_evidences);
      _t9178: {
        if (true) {
          const all_record_ev = _t9176[0];
          const ev_param_names = _t9176[1];
          const ev_param_names_9179 = List$rev(ev_param_names);
          const __rec_upd_9181 = xctx;
          const _t9182 = ({xf_constrained: List$concat(all_constrained, xctx.xf_constrained), xf_locals: __rec_upd_9181.xf_locals, xf_record_evidence: List$concat(all_record_ev, xctx.xf_record_evidence), xf_schemes: __rec_upd_9181.xf_schemes, xf_type_env: __rec_upd_9181.xf_type_env});
          const xctx_9183 = _t9182;
          const rewritten_9185 = Typechecker$xform_expr(xctx_9183, te);
          const all_params_9187 = List$concat(dict_param_names_9149, ev_param_names_9179);
          function _t9189(dparam, body) {
            return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [dparam, body, false]}), ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), body.ty]}));
          }
          const _t9188 = List$fold_right(_t9189, all_params_9187, rewritten_9185);
          const _t9186 = _t9188;
          const _t9184 = _t9186;
          const _t9180 = _t9184;
          _t9177 = _t9180;
          break _t9178;
        }
        _match_fail("line 16190");
      }
      const _t9152 = _t9177;
      const _t9150 = _t9152;
      _t9147 = _t9150;
      break _t9148;
    }
    _match_fail("line 16190");
  }
  const _t9109 = _t9147;
  return _t9109;
}
function Typechecker$xform_constrained_inst(xctx, inst_def, dict_expr) {
  let _t9191;
  const _t9190 = dict_expr.expr;
  _t9192: {
    if (_t9190._tag === 16) {
      const fs = _t9190._val;
      _t9191 = fs;
      break _t9192;
    }
    if (true) {
      _t9191 = failwith("assert false");
      break _t9192;
    }
    _match_fail("line 16190");
  }
  let _t9194;
  const _t9193 = Types$find_method_class(xctx.xf_type_env.classes, fst(List$hd(_t9191)));
  _t9195: {
    if (_t9193._tag === 1) {
      const cd = _t9193._val;
      if ((cd.class_name === inst_def.inst_class)) {
        _t9194 = cd;
        break _t9195;
      }
    }
    if (true) {
      function _t9196(c) {
        return (c.class_name === inst_def.inst_class);
      }
      let _t9198;
      const _t9197 = List$find(_t9196, xctx.xf_type_env.classes);
      _t9199: {
        if (_t9197._tag === 1) {
          const cd = _t9197._val;
          _t9198 = cd;
          break _t9199;
        }
        if (_t9197._tag === 0) {
          _t9198 = Typechecker$error((("class " + __dict_Show_string.show(inst_def.inst_class)) + " not found"));
          break _t9199;
        }
        _match_fail("line 16190");
      }
      _t9194 = _t9198;
      break _t9195;
    }
    _match_fail("line 16190");
  }
  const class_def_9200 = _t9194;
  const class_param_map_9202 = Hashtbl$create(4);
  const inst_tvar_map_9204 = Hashtbl$create(4);
  let _t9207;
  const _t9206 = dict_expr.expr;
  _t9208: {
    if (_t9206._tag === 16) {
      const fields = _t9206._val;
      function _t9209(__p303) {
        let _t9211;
        const _t9210 = __p303;
        _t9212: {
          if (true) {
            const mname = _t9210[0];
            const mte = _t9210[1];
            let _t9214;
            const _t9213 = List$assoc_opt(mname, class_def_9200.class_methods);
            _t9215: {
              if (_t9213._tag === 1) {
                const class_method_ty = _t9213._val;
                function walk_class(s, a) {
                  while (true) {
                    const a_9216 = Types$repr(a);
                    let _t9219;
                    const _t9218 = s;
                    _t9220: {
                      if (_t9218._tag === 17) {
                        const i = _t9218._val;
                        let _t9221;
                        if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, class_param_map_9202, i]))) {
                          _t9221 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, class_param_map_9202, i, a_9216]);
                        } else {
                          _t9221 = undefined;
                        }
                        _t9219 = _t9221;
                        break _t9220;
                      }
                      if (_t9218._tag === 7) {
                        const s1 = _t9218._val[0];
                        const s2 = _t9218._val[2];
                        let _t9223;
                        const _t9222 = a_9216;
                        _t9224: {
                          if (_t9222._tag === 7) {
                            const a1 = _t9222._val[0];
                            const a2 = _t9222._val[2];
                            walk_class(s1, a1);
                            const _t9225 = s2;
                            const _t9226 = a2;
                            s = _t9225;
                            a = _t9226;
                            continue;
                            _t9223 = undefined;
                            break _t9224;
                          }
                          if (true) {
                            _t9223 = undefined;
                            break _t9224;
                          }
                          _match_fail("line 16190");
                        }
                        _t9219 = _t9223;
                        break _t9220;
                      }
                      if (_t9218._tag === 8) {
                        const s1 = _t9218._val[0];
                        const s2 = _t9218._val[2];
                        let _t9228;
                        const _t9227 = a_9216;
                        _t9229: {
                          if (_t9227._tag === 8) {
                            const a1 = _t9227._val[0];
                            const a2 = _t9227._val[2];
                            walk_class(s1, a1);
                            const _t9230 = s2;
                            const _t9231 = a2;
                            s = _t9230;
                            a = _t9231;
                            continue;
                            _t9228 = undefined;
                            break _t9229;
                          }
                          if (true) {
                            _t9228 = undefined;
                            break _t9229;
                          }
                          _match_fail("line 16190");
                        }
                        _t9219 = _t9228;
                        break _t9220;
                      }
                      if (_t9218._tag === 9) {
                        const ss = _t9218._val;
                        let _t9233;
                        const _t9232 = a_9216;
                        _t9234: {
                          if (_t9232._tag === 9) {
                            const aa = _t9232._val;
                            if ((List$length(ss) === List$length(aa))) {
                              _t9233 = List$iter2(walk_class, ss, aa);
                              break _t9234;
                            }
                          }
                          if (true) {
                            _t9233 = undefined;
                            break _t9234;
                          }
                          _match_fail("line 16190");
                        }
                        _t9219 = _t9233;
                        break _t9220;
                      }
                      if (_t9218._tag === 10) {
                        const s1 = _t9218._val;
                        let _t9236;
                        const _t9235 = a_9216;
                        _t9237: {
                          if (_t9235._tag === 10) {
                            const a1 = _t9235._val;
                            const _t9238 = s1;
                            const _t9239 = a1;
                            s = _t9238;
                            a = _t9239;
                            continue;
                            _t9236 = undefined;
                            break _t9237;
                          }
                          if (true) {
                            _t9236 = undefined;
                            break _t9237;
                          }
                          _match_fail("line 16190");
                        }
                        _t9219 = _t9236;
                        break _t9220;
                      }
                      if (_t9218._tag === 14) {
                        const s1 = _t9218._val;
                        let _t9241;
                        const _t9240 = a_9216;
                        _t9242: {
                          if (_t9240._tag === 14) {
                            const a1 = _t9240._val;
                            const _t9243 = s1;
                            const _t9244 = a1;
                            s = _t9243;
                            a = _t9244;
                            continue;
                            _t9241 = undefined;
                            break _t9242;
                          }
                          if (true) {
                            _t9241 = undefined;
                            break _t9242;
                          }
                          _match_fail("line 16190");
                        }
                        _t9219 = _t9241;
                        break _t9220;
                      }
                      if (_t9218._tag === 13) {
                        const sk = _t9218._val[0];
                        const sv = _t9218._val[1];
                        let _t9246;
                        const _t9245 = a_9216;
                        _t9247: {
                          if (_t9245._tag === 13) {
                            const ak = _t9245._val[0];
                            const av = _t9245._val[1];
                            walk_class(sk, ak);
                            const _t9248 = sv;
                            const _t9249 = av;
                            s = _t9248;
                            a = _t9249;
                            continue;
                            _t9246 = undefined;
                            break _t9247;
                          }
                          if (true) {
                            _t9246 = undefined;
                            break _t9247;
                          }
                          _match_fail("line 16190");
                        }
                        _t9219 = _t9246;
                        break _t9220;
                      }
                      if (_t9218._tag === 12) {
                        const ss = _t9218._val[1];
                        let _t9251;
                        const _t9250 = a_9216;
                        _t9252: {
                          if (_t9250._tag === 12) {
                            const aa = _t9250._val[1];
                            if ((List$length(ss) === List$length(aa))) {
                              _t9251 = List$iter2(walk_class, ss, aa);
                              break _t9252;
                            }
                          }
                          if (true) {
                            _t9251 = undefined;
                            break _t9252;
                          }
                          _match_fail("line 16190");
                        }
                        _t9219 = _t9251;
                        break _t9220;
                      }
                      if (true) {
                        _t9219 = undefined;
                        break _t9220;
                      }
                      _match_fail("line 16190");
                    }
                    const _t9217 = _t9219;
                    return _t9217;
                  }
                }
                const _t9253 = walk_class(class_method_ty, mte.ty);
                _t9214 = _t9253;
                break _t9215;
              }
              if (_t9213._tag === 0) {
                _t9214 = undefined;
                break _t9215;
              }
              _match_fail("line 16190");
            }
            _t9211 = _t9214;
            break _t9212;
          }
          _match_fail("line 16190");
        }
        return _t9211;
      }
      List$iter(_t9209, fields);
      function _t9254(class_idx, stored_ty) {
        let _t9256;
        const _t9255 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, class_param_map_9202, class_idx]);
        _t9257: {
          if (_t9255._tag === 1) {
            const actual_ty = _t9255._val;
            function walk_inst(s, a) {
              while (true) {
                const a_9258 = Types$repr(a);
                let _t9261;
                const _t9260 = s;
                _t9262: {
                  if (_t9260._tag === 17) {
                    const i = _t9260._val;
                    let _t9263;
                    if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, inst_tvar_map_9204, i]))) {
                      let _t9265;
                      const _t9264 = a_9258;
                      _t9266: {
                        if (_t9264._tag === 16 && _t9264._val.contents._tag === 0) {
                          const id = _t9264._val.contents._val[0];
                          _t9265 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, inst_tvar_map_9204, i, id]);
                          break _t9266;
                        }
                        if (true) {
                          _t9265 = undefined;
                          break _t9266;
                        }
                        _match_fail("line 16190");
                      }
                      _t9263 = _t9265;
                    } else {
                      _t9263 = undefined;
                    }
                    _t9261 = _t9263;
                    break _t9262;
                  }
                  if (_t9260._tag === 7) {
                    const s1 = _t9260._val[0];
                    const s2 = _t9260._val[2];
                    let _t9268;
                    const _t9267 = a_9258;
                    _t9269: {
                      if (_t9267._tag === 7) {
                        const a1 = _t9267._val[0];
                        const a2 = _t9267._val[2];
                        walk_inst(s1, a1);
                        const _t9270 = s2;
                        const _t9271 = a2;
                        s = _t9270;
                        a = _t9271;
                        continue;
                        _t9268 = undefined;
                        break _t9269;
                      }
                      if (true) {
                        _t9268 = undefined;
                        break _t9269;
                      }
                      _match_fail("line 16190");
                    }
                    _t9261 = _t9268;
                    break _t9262;
                  }
                  if (_t9260._tag === 8) {
                    const s1 = _t9260._val[0];
                    const s2 = _t9260._val[2];
                    let _t9273;
                    const _t9272 = a_9258;
                    _t9274: {
                      if (_t9272._tag === 8) {
                        const a1 = _t9272._val[0];
                        const a2 = _t9272._val[2];
                        walk_inst(s1, a1);
                        const _t9275 = s2;
                        const _t9276 = a2;
                        s = _t9275;
                        a = _t9276;
                        continue;
                        _t9273 = undefined;
                        break _t9274;
                      }
                      if (true) {
                        _t9273 = undefined;
                        break _t9274;
                      }
                      _match_fail("line 16190");
                    }
                    _t9261 = _t9273;
                    break _t9262;
                  }
                  if (_t9260._tag === 9) {
                    const ss = _t9260._val;
                    let _t9278;
                    const _t9277 = a_9258;
                    _t9279: {
                      if (_t9277._tag === 9) {
                        const aa = _t9277._val;
                        if ((List$length(ss) === List$length(aa))) {
                          _t9278 = List$iter2(walk_inst, ss, aa);
                          break _t9279;
                        }
                      }
                      if (true) {
                        _t9278 = undefined;
                        break _t9279;
                      }
                      _match_fail("line 16190");
                    }
                    _t9261 = _t9278;
                    break _t9262;
                  }
                  if (_t9260._tag === 10) {
                    const s1 = _t9260._val;
                    let _t9281;
                    const _t9280 = a_9258;
                    _t9282: {
                      if (_t9280._tag === 10) {
                        const a1 = _t9280._val;
                        const _t9283 = s1;
                        const _t9284 = a1;
                        s = _t9283;
                        a = _t9284;
                        continue;
                        _t9281 = undefined;
                        break _t9282;
                      }
                      if (true) {
                        _t9281 = undefined;
                        break _t9282;
                      }
                      _match_fail("line 16190");
                    }
                    _t9261 = _t9281;
                    break _t9262;
                  }
                  if (_t9260._tag === 14) {
                    const s1 = _t9260._val;
                    let _t9286;
                    const _t9285 = a_9258;
                    _t9287: {
                      if (_t9285._tag === 14) {
                        const a1 = _t9285._val;
                        const _t9288 = s1;
                        const _t9289 = a1;
                        s = _t9288;
                        a = _t9289;
                        continue;
                        _t9286 = undefined;
                        break _t9287;
                      }
                      if (true) {
                        _t9286 = undefined;
                        break _t9287;
                      }
                      _match_fail("line 16190");
                    }
                    _t9261 = _t9286;
                    break _t9262;
                  }
                  if (_t9260._tag === 13) {
                    const sk = _t9260._val[0];
                    const sv = _t9260._val[1];
                    let _t9291;
                    const _t9290 = a_9258;
                    _t9292: {
                      if (_t9290._tag === 13) {
                        const ak = _t9290._val[0];
                        const av = _t9290._val[1];
                        walk_inst(sk, ak);
                        const _t9293 = sv;
                        const _t9294 = av;
                        s = _t9293;
                        a = _t9294;
                        continue;
                        _t9291 = undefined;
                        break _t9292;
                      }
                      if (true) {
                        _t9291 = undefined;
                        break _t9292;
                      }
                      _match_fail("line 16190");
                    }
                    _t9261 = _t9291;
                    break _t9262;
                  }
                  if (_t9260._tag === 12) {
                    const ss = _t9260._val[1];
                    let _t9296;
                    const _t9295 = a_9258;
                    _t9297: {
                      if (_t9295._tag === 12) {
                        const aa = _t9295._val[1];
                        if ((List$length(ss) === List$length(aa))) {
                          _t9296 = List$iter2(walk_inst, ss, aa);
                          break _t9297;
                        }
                      }
                      if (true) {
                        _t9296 = undefined;
                        break _t9297;
                      }
                      _match_fail("line 16190");
                    }
                    _t9261 = _t9296;
                    break _t9262;
                  }
                  if (true) {
                    _t9261 = undefined;
                    break _t9262;
                  }
                  _match_fail("line 16190");
                }
                const _t9259 = _t9261;
                return _t9259;
              }
            }
            const _t9298 = walk_inst(stored_ty, actual_ty);
            _t9256 = _t9298;
            break _t9257;
          }
          if (_t9255._tag === 0) {
            _t9256 = undefined;
            break _t9257;
          }
          _match_fail("line 16190");
        }
        return _t9256;
      }
      _t9207 = List$iteri(_t9254, inst_def.inst_tys);
      break _t9208;
    }
    if (true) {
      _t9207 = undefined;
      break _t9208;
    }
    _match_fail("line 16190");
  }
  _t9207;
  function _t9299(__p304, cc) {
    let _t9301;
    const _t9300 = __p304;
    _t9302: {
      if (true) {
        const entries = _t9300[0];
        const params = _t9300[1];
        function _t9303(ca) {
          let _t9305;
          const _t9304 = ca;
          _t9306: {
            if (_t9304._tag === 0) {
              const tgen_idx = _t9304._val;
              let _t9308;
              const _t9307 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, inst_tvar_map_9204, tgen_idx]);
              _t9309: {
                if (_t9307._tag === 1) {
                  const tvar_id = _t9307._val;
                  _t9308 = ({_tag: 1, _name: "Some", _val: [tvar_id, tgen_idx]});
                  break _t9309;
                }
                if (_t9307._tag === 0) {
                  _t9308 = ({_tag: 0, _name: "None"});
                  break _t9309;
                }
                _match_fail("line 16190");
              }
              _t9305 = _t9308;
              break _t9306;
            }
            if (_t9304._tag === 1) {
              _t9305 = ({_tag: 0, _name: "None"});
              break _t9306;
            }
            if (_t9304._tag === 2) {
              _t9305 = ({_tag: 0, _name: "None"});
              break _t9306;
            }
            if (_t9304._tag === 3) {
              _t9305 = ({_tag: 0, _name: "None"});
              break _t9306;
            }
            _match_fail("line 16190");
          }
          return _t9305;
        }
        const tvar_entries_9310 = List$filter_map(_t9303, cc.cc_args);
        let _t9313;
        const _t9312 = tvar_entries_9310;
        _t9314: {
          if (_t9312 === null) {
            _t9313 = [entries, params];
            break _t9314;
          }
          if (true) {
            function _t9315(__p305) {
              let _t9317;
              const _t9316 = __p305;
              _t9318: {
                if (true) {
                  const idx = _t9316[1];
                  _t9317 = string_of_int(idx);
                  break _t9318;
                }
                _match_fail("line 16190");
              }
              return _t9317;
            }
            const dparam_9319 = ((("__dict_" + __dict_Show_string.show(cc.cc_class)) + "_") + __dict_Show_string.show(String$concat("_", List$map(_t9315, tvar_entries_9310))));
            function _t9321(__p306) {
              let _t9323;
              const _t9322 = __p306;
              _t9324: {
                if (true) {
                  const id = _t9322[0];
                  _t9323 = [id, dparam_9319, cc.cc_class];
                  break _t9324;
                }
                _match_fail("line 16190");
              }
              return _t9323;
            }
            const new_entries_9325 = List$map(_t9321, tvar_entries_9310);
            const _t9326 = [List$concat(new_entries_9325, entries), ({_hd: dparam_9319, _tl: params})];
            const _t9320 = _t9326;
            _t9313 = _t9320;
            break _t9314;
          }
          _match_fail("line 16190");
        }
        const _t9311 = _t9313;
        _t9301 = _t9311;
        break _t9302;
      }
      _match_fail("line 16190");
    }
    return _t9301;
  }
  let _t9328;
  const _t9327 = List$fold(_t9299, [null, null], inst_def.inst_constraints);
  _t9329: {
    if (true) {
      const all_constrained = _t9327[0];
      const dict_param_names = _t9327[1];
      const dict_param_names_9330 = List$rev(dict_param_names);
      const __rec_upd_9332 = xctx;
      const _t9333 = ({xf_constrained: List$concat(all_constrained, xctx.xf_constrained), xf_locals: __rec_upd_9332.xf_locals, xf_record_evidence: __rec_upd_9332.xf_record_evidence, xf_schemes: __rec_upd_9332.xf_schemes, xf_type_env: __rec_upd_9332.xf_type_env});
      const xctx_9334 = _t9333;
      const rewritten_9336 = Typechecker$xform_expr(xctx_9334, dict_expr);
      function _t9338(dparam, body) {
        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [dparam, body, false]}), ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), body.ty]}));
      }
      const _t9337 = List$fold_right(_t9338, dict_param_names_9330, rewritten_9336);
      const _t9335 = _t9337;
      const _t9331 = _t9335;
      _t9328 = _t9331;
      break _t9329;
    }
    _match_fail("line 16190");
  }
  const _t9205 = _t9328;
  const _t9203 = _t9205;
  const _t9201 = _t9203;
  return _t9201;
}
function Typechecker$apply_fundep_improvement(type_env, vars, tprog) {
  function _t9339(tdecl) {
    let _t9341;
    const _t9340 = tdecl;
    _t9342: {
      if ((((_t9340._tag === 0 || _t9340._tag === 2) || _t9340._tag === 5) || _t9340._tag === 1)) {
        const te = (((_t9340._tag === 0 || _t9340._tag === 2) || _t9340._tag === 5) ? ((_t9340._tag === 0 || _t9340._tag === 2) ? _t9340._val[1] : _t9340._val) : _t9340._val[1]);
        _t9341 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
        break _t9342;
      }
      if (_t9340._tag === 3) {
        const bindings = _t9340._val;
        function _t9343(__p307) {
          let _t9345;
          const _t9344 = __p307;
          _t9346: {
            if (true) {
              const te = _t9344[1];
              _t9345 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
              break _t9346;
            }
            _match_fail("line 16190");
          }
          return _t9345;
        }
        _t9341 = List$iter(_t9343, bindings);
        break _t9342;
      }
      if (_t9340._tag === 9) {
        const decls = _t9340._val[1];
        function _t9347(d) {
          let _t9349;
          const _t9348 = d;
          _t9350: {
            if ((((_t9348._tag === 0 || _t9348._tag === 2) || _t9348._tag === 5) || _t9348._tag === 1)) {
              const te = (((_t9348._tag === 0 || _t9348._tag === 2) || _t9348._tag === 5) ? ((_t9348._tag === 0 || _t9348._tag === 2) ? _t9348._val[1] : _t9348._val) : _t9348._val[1]);
              _t9349 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
              break _t9350;
            }
            if (_t9348._tag === 3) {
              const bindings = _t9348._val;
              function _t9351(__p308) {
                let _t9353;
                const _t9352 = __p308;
                _t9354: {
                  if (true) {
                    const te = _t9352[1];
                    _t9353 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
                    break _t9354;
                  }
                  _match_fail("line 16190");
                }
                return _t9353;
              }
              _t9349 = List$iter(_t9351, bindings);
              break _t9350;
            }
            if (true) {
              _t9349 = undefined;
              break _t9350;
            }
            _match_fail("line 16190");
          }
          return _t9349;
        }
        _t9341 = List$iter(_t9347, decls);
        break _t9342;
      }
      if (true) {
        _t9341 = undefined;
        break _t9342;
      }
      _match_fail("line 16190");
    }
    return _t9341;
  }
  return List$iter(_t9339, tprog);
}
function Typechecker$transform_constraints(ctx, tprog) {
  Typechecker$apply_fundep_improvement(ctx.type_env, ctx.vars, tprog);
  const xctx_9355 = ({xf_constrained: null, xf_locals: null, xf_record_evidence: null, xf_schemes: ctx.vars, xf_type_env: ctx.type_env});
  function _t9357(xctx, tdecl) {
    let _t9359;
    const _t9358 = tdecl;
    _t9360: {
      if (_t9358._tag === 0) {
        const name = _t9358._val[0];
        const te = _t9358._val[1];
        let _t9362;
        const _t9361 = List$assoc_opt(name, xctx.xf_schemes);
        _t9363: {
          if (_t9361._tag === 1) {
            const scheme = _t9361._val;
            if (Typechecker$scheme_needs_xform(scheme)) {
              _t9362 = ({_tag: 0, _name: "TDLet", _val: [name, Typechecker$xform_constrained_def(xctx, scheme, te)]});
              break _t9363;
            }
          }
          if (true) {
            function _t9364(i) {
              return ((i.inst_dict_name === name) && !_eq(i.inst_constraints, null));
            }
            const inst_9365 = List$find(_t9364, xctx.xf_type_env.instances);
            let _t9368;
            const _t9367 = inst_9365;
            _t9369: {
              if (_t9367._tag === 1) {
                const inst_def = _t9367._val;
                _t9368 = ({_tag: 0, _name: "TDLet", _val: [name, Typechecker$xform_constrained_inst(xctx, inst_def, te)]});
                break _t9369;
              }
              if (_t9367._tag === 0) {
                _t9368 = ({_tag: 0, _name: "TDLet", _val: [name, Typechecker$xform_expr(xctx, te)]});
                break _t9369;
              }
              _match_fail("line 16190");
            }
            const _t9366 = _t9368;
            _t9362 = _t9366;
            break _t9363;
          }
          _match_fail("line 16190");
        }
        _t9359 = _t9362;
        break _t9360;
      }
      if (_t9358._tag === 2) {
        const name = _t9358._val[0];
        const te = _t9358._val[1];
        let _t9371;
        const _t9370 = List$assoc_opt(name, xctx.xf_schemes);
        _t9372: {
          if (_t9370._tag === 1) {
            const scheme = _t9370._val;
            if (Typechecker$scheme_needs_xform(scheme)) {
              _t9371 = ({_tag: 2, _name: "TDLetRec", _val: [name, Typechecker$xform_constrained_def(xctx, scheme, te)]});
              break _t9372;
            }
          }
          if (true) {
            _t9371 = ({_tag: 2, _name: "TDLetRec", _val: [name, Typechecker$xform_expr(xctx, te)]});
            break _t9372;
          }
          _match_fail("line 16190");
        }
        _t9359 = _t9371;
        break _t9360;
      }
      if (_t9358._tag === 3) {
        const bindings = _t9358._val;
        function _t9373(__p309) {
          let _t9375;
          const _t9374 = __p309;
          _t9376: {
            if (true) {
              const n = _t9374[0];
              const te = _t9374[1];
              let _t9378;
              const _t9377 = List$assoc_opt(n, xctx.xf_schemes);
              _t9379: {
                if (_t9377._tag === 1) {
                  const scheme = _t9377._val;
                  if (Typechecker$scheme_needs_xform(scheme)) {
                    _t9378 = [n, Typechecker$xform_constrained_def(xctx, scheme, te)];
                    break _t9379;
                  }
                }
                if (true) {
                  _t9378 = [n, Typechecker$xform_expr(xctx, te)];
                  break _t9379;
                }
                _match_fail("line 16190");
              }
              _t9375 = _t9378;
              break _t9376;
            }
            _match_fail("line 16190");
          }
          return _t9375;
        }
        _t9359 = ({_tag: 3, _name: "TDLetRecAnd", _val: List$map(_t9373, bindings)});
        break _t9360;
      }
      if (_t9358._tag === 5) {
        const te = _t9358._val;
        _t9359 = ({_tag: 5, _name: "TDExpr", _val: Typechecker$xform_expr(xctx, te)});
        break _t9360;
      }
      if (_t9358._tag === 1) {
        const name = _t9358._val[0];
        const te = _t9358._val[1];
        _t9359 = ({_tag: 1, _name: "TDLetMut", _val: [name, Typechecker$xform_expr(xctx, te)]});
        break _t9360;
      }
      if (true) {
        const other = _t9358;
        _t9359 = other;
        break _t9360;
      }
      _match_fail("line 16190");
    }
    return _t9359;
  }
  const xform_decl_9380 = _t9357;
  function _t9382(tdecl) {
    let _t9384;
    const _t9383 = tdecl;
    _t9385: {
      if (((_t9383._tag === 0 || _t9383._tag === 2) || _t9383._tag === 1)) {
        const name = _t9383._val[0];
        _t9384 = ({_hd: name, _tl: null});
        break _t9385;
      }
      if (_t9383._tag === 3) {
        const bindings = _t9383._val;
        _t9384 = List$map(fst, bindings);
        break _t9385;
      }
      if (true) {
        _t9384 = null;
        break _t9385;
      }
      _match_fail("line 16190");
    }
    return _t9384;
  }
  const decl_names_9386 = _t9382;
  function _t9388(xctx, tdecl) {
    let _t9390;
    const _t9389 = tdecl;
    _t9391: {
      if (_t9389._tag === 10) {
        const alias_pairs = _t9389._val;
        function _t9392(schemes, __p310) {
          let _t9394;
          const _t9393 = __p310;
          _t9395: {
            if (true) {
              const dst = _t9393[0];
              const src = _t9393[1];
              let _t9397;
              const _t9396 = List$assoc_opt(src, schemes);
              _t9398: {
                if (_t9396._tag === 1) {
                  const scheme = _t9396._val;
                  _t9397 = ({_hd: [dst, scheme], _tl: schemes});
                  break _t9398;
                }
                if (_t9396._tag === 0) {
                  _t9397 = schemes;
                  break _t9398;
                }
                _match_fail("line 16190");
              }
              _t9394 = _t9397;
              break _t9395;
            }
            _match_fail("line 16190");
          }
          return _t9394;
        }
        _t9390 = List$fold(_t9392, xctx.xf_schemes, alias_pairs);
        break _t9391;
      }
      if (true) {
        _t9390 = xctx.xf_schemes;
        break _t9391;
      }
      _match_fail("line 16190");
    }
    return _t9390;
  }
  const open_schemes_9399 = _t9388;
  function xform_decls(xctx, __x) {
    let _t9402;
    const _t9401 = __x;
    _t9403: {
      if (_t9401 === null) {
        _t9402 = null;
        break _t9403;
      }
      if (_t9401 !== null) {
        const tdecl = _t9401._hd;
        const rest = _t9401._tl;
        let _t9405;
        const _t9404 = tdecl;
        _t9406: {
          if (_t9404._tag === 9) {
            const name = _t9404._val[0];
            const decls = _t9404._val[1];
            _t9405 = ({_tag: 9, _name: "TDModule", _val: [name, xform_decls(xctx, decls)]});
            break _t9406;
          }
          if (true) {
            _t9405 = xform_decl_9380(xctx, tdecl);
            break _t9406;
          }
          _match_fail("line 16190");
        }
        const tdecl$p_9407 = _t9405;
        const names_9409 = decl_names_9386(tdecl);
        const __rec_upd_9411 = xctx;
        const _t9412 = ({xf_constrained: __rec_upd_9411.xf_constrained, xf_locals: List$concat(names_9409, xctx.xf_locals), xf_record_evidence: __rec_upd_9411.xf_record_evidence, xf_schemes: open_schemes_9399(xctx, tdecl$p_9407), xf_type_env: __rec_upd_9411.xf_type_env});
        const xctx$p_9413 = _t9412;
        const _t9414 = ({_hd: tdecl$p_9407, _tl: xform_decls(xctx$p_9413, rest)});
        const _t9410 = _t9414;
        const _t9408 = _t9410;
        _t9402 = _t9408;
        break _t9403;
      }
      _match_fail("line 16190");
    }
    return _t9402;
  }
  const _t9415 = xform_decls(xctx_9355, tprog);
  const _t9400 = _t9415;
  const _t9387 = _t9400;
  const _t9381 = _t9387;
  const _t9356 = _t9381;
  return _t9356;
}
function Typechecker$check_program(program) {
  function _t9416(__p311, decl) {
    let _t9418;
    const _t9417 = __p311;
    _t9419: {
      if (true) {
        const ctx = _t9417[0];
        const decls = _t9417[1];
        let _t9421;
        const _t9420 = Typechecker$check_decl(ctx, 0, decl);
        _t9422: {
          if (true) {
            const ctx$p = _t9420[0];
            const tdecls = _t9420[1];
            _t9421 = [ctx$p, List$rev_append(tdecls, decls)];
            break _t9422;
          }
          _match_fail("line 16190");
        }
        _t9418 = _t9421;
        break _t9419;
      }
      _match_fail("line 16190");
    }
    return _t9418;
  }
  let _t9424;
  const _t9423 = List$fold(_t9416, [Typechecker$empty_ctx, null], program);
  _t9425: {
    if (true) {
      const ctx = _t9423[0];
      const decls = _t9423[1];
      _t9424 = [List$rev(decls), ctx.type_env];
      break _t9425;
    }
    _match_fail("line 16190");
  }
  return _t9424;
}
function Typechecker$check_program_in_ctx(ctx, program) {
  function _t9426(__p312, decl) {
    let _t9428;
    const _t9427 = __p312;
    _t9429: {
      if (true) {
        const ctx = _t9427[0];
        const decls = _t9427[1];
        let _t9431;
        const _t9430 = Typechecker$check_decl(ctx, 0, decl);
        _t9432: {
          if (true) {
            const ctx$p = _t9430[0];
            const tdecls = _t9430[1];
            _t9431 = [ctx$p, List$rev_append(tdecls, decls)];
            break _t9432;
          }
          _match_fail("line 16190");
        }
        _t9428 = _t9431;
        break _t9429;
      }
      _match_fail("line 16190");
    }
    return _t9428;
  }
  let _t9434;
  const _t9433 = List$fold(_t9426, [ctx, null], program);
  _t9435: {
    if (true) {
      const ctx = _t9433[0];
      const decls = _t9433[1];
      _t9434 = [ctx, List$rev(decls)];
      break _t9435;
    }
    _match_fail("line 16190");
  }
  return _t9434;
}
function Typechecker$handler_body_has_resume(te) {
  while (true) {
    let _t9437;
    const _t9436 = te.expr;
    _t9438: {
      if (_t9436._tag === 31) {
        _t9437 = true;
        break _t9438;
      }
      if (((_t9436._tag === 8 || _t9436._tag === 28) || _t9436._tag === 25)) {
        const e1 = ((_t9436._tag === 8 || _t9436._tag === 28) ? (_t9436._tag === 8 ? _t9436._val[2] : _t9436._val[0]) : _t9436._val[1]);
        const e2 = ((_t9436._tag === 8 || _t9436._tag === 28) ? (_t9436._tag === 8 ? _t9436._val[3] : _t9436._val[1]) : _t9436._val[2]);
        _t9437 = (Typechecker$handler_body_has_resume(e1) || Typechecker$handler_body_has_resume(e2));
        break _t9438;
      }
      if (_t9436._tag === 12) {
        const e1 = _t9436._val[1];
        const e2 = _t9436._val[2];
        _t9437 = (Typechecker$handler_body_has_resume(e1) || Typechecker$handler_body_has_resume(e2));
        break _t9438;
      }
      if (_t9436._tag === 24) {
        const arms = _t9436._val[1];
        function _t9439(__p313) {
          let _t9441;
          const _t9440 = __p313;
          _t9442: {
            if (true) {
              const body = _t9440[2];
              _t9441 = Typechecker$handler_body_has_resume(body);
              break _t9442;
            }
            _match_fail("line 16190");
          }
          return _t9441;
        }
        _t9437 = List$exists(_t9439, arms);
        break _t9438;
      }
      if (_t9436._tag === 9) {
        const e2 = _t9436._val[3];
        const _t9443 = e2;
        te = _t9443;
        continue;
        _t9437 = undefined;
        break _t9438;
      }
      if (_t9436._tag === 37) {
        const e2 = _t9436._val[1];
        const _t9444 = e2;
        te = _t9444;
        continue;
        _t9437 = undefined;
        break _t9438;
      }
      if (true) {
        _t9437 = false;
        break _t9438;
      }
      _match_fail("line 16190");
    }
    return _t9437;
  }
}
function Typechecker$handler_body_has_perform(te) {
  while (true) {
    let _t9446;
    const _t9445 = te.expr;
    _t9447: {
      if (_t9445._tag === 29) {
        _t9446 = true;
        break _t9447;
      }
      if (_t9445._tag === 31) {
        _t9446 = true;
        break _t9447;
      }
      if (((_t9445._tag === 8 || _t9445._tag === 28) || _t9445._tag === 25)) {
        const e1 = ((_t9445._tag === 8 || _t9445._tag === 28) ? (_t9445._tag === 8 ? _t9445._val[2] : _t9445._val[0]) : _t9445._val[1]);
        const e2 = ((_t9445._tag === 8 || _t9445._tag === 28) ? (_t9445._tag === 8 ? _t9445._val[3] : _t9445._val[1]) : _t9445._val[2]);
        _t9446 = (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2));
        break _t9447;
      }
      if (_t9445._tag === 12) {
        const cond = _t9445._val[0];
        const e1 = _t9445._val[1];
        const e2 = _t9445._val[2];
        _t9446 = (Typechecker$handler_body_has_perform(cond) || (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2)));
        break _t9447;
      }
      if (_t9445._tag === 24) {
        const scrut = _t9445._val[0];
        const arms = _t9445._val[1];
        let _t9456;
        if (Typechecker$handler_body_has_perform(scrut)) {
          _t9456 = true;
        } else {
        function _t9448(__p314) {
          let _t9450;
          const _t9449 = __p314;
          _t9451: {
            if (true) {
              const g = _t9449[1];
              const body = _t9449[2];
              let _t9455;
              if (Typechecker$handler_body_has_perform(body)) {
                _t9455 = true;
              } else {
              let _t9453;
              const _t9452 = g;
              _t9454: {
                if (_t9452._tag === 1) {
                  const g = _t9452._val;
                  _t9453 = Typechecker$handler_body_has_perform(g);
                  break _t9454;
                }
                if (_t9452._tag === 0) {
                  _t9453 = false;
                  break _t9454;
                }
                _match_fail("line 16190");
              }
                _t9455 = _t9453;
              }
              _t9450 = _t9455;
              break _t9451;
            }
            _match_fail("line 16190");
          }
          return _t9450;
        }
          _t9456 = List$exists(_t9448, arms);
        }
        _t9446 = _t9456;
        break _t9447;
      }
      if (_t9445._tag === 9) {
        const e2 = _t9445._val[3];
        const _t9457 = e2;
        te = _t9457;
        continue;
        _t9446 = undefined;
        break _t9447;
      }
      if (_t9445._tag === 37) {
        const e2 = _t9445._val[1];
        const _t9458 = e2;
        te = _t9458;
        continue;
        _t9446 = undefined;
        break _t9447;
      }
      if (_t9445._tag === 11) {
        const fn_ = _t9445._val[0];
        const arg = _t9445._val[1];
        _t9446 = (Typechecker$handler_body_has_perform(fn_) || Typechecker$handler_body_has_perform(arg));
        break _t9447;
      }
      if (_t9445._tag === 13) {
        const e1 = _t9445._val[1];
        const e2 = _t9445._val[2];
        _t9446 = (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2));
        break _t9447;
      }
      if (_t9445._tag === 14) {
        const e = _t9445._val[1];
        const _t9459 = e;
        te = _t9459;
        continue;
        _t9446 = undefined;
        break _t9447;
      }
      if (_t9445._tag === 21) {
        const e1 = _t9445._val[0];
        const e2 = _t9445._val[1];
        _t9446 = (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2));
        break _t9447;
      }
      if (_t9445._tag === 15) {
        const es = _t9445._val;
        _t9446 = List$exists(Typechecker$handler_body_has_perform, es);
        break _t9447;
      }
      if (_t9445._tag === 16) {
        const fields = _t9445._val;
        function _t9460(__p315) {
          let _t9462;
          const _t9461 = __p315;
          _t9463: {
            if (true) {
              const e = _t9461[1];
              _t9462 = Typechecker$handler_body_has_perform(e);
              break _t9463;
            }
            _match_fail("line 16190");
          }
          return _t9462;
        }
        _t9446 = List$exists(_t9460, fields);
        break _t9447;
      }
      if (true) {
        _t9446 = false;
        break _t9447;
      }
      _match_fail("line 16190");
    }
    return _t9446;
  }
}
function Typechecker$classify_all_branches_resume(te) {
  while (true) {
    let _t9465;
    const _t9464 = te.expr;
    _t9466: {
      if (_t9464._tag === 31) {
        _t9465 = true;
        break _t9466;
      }
      if (((((_t9464._tag === 8 || _t9464._tag === 9) || _t9464._tag === 37) || _t9464._tag === 25) || _t9464._tag === 28)) {
        const e2 = ((((_t9464._tag === 8 || _t9464._tag === 9) || _t9464._tag === 37) || _t9464._tag === 25) ? (((_t9464._tag === 8 || _t9464._tag === 9) || _t9464._tag === 37) ? ((_t9464._tag === 8 || _t9464._tag === 9) ? _t9464._val[3] : _t9464._val[1]) : _t9464._val[2]) : _t9464._val[1]);
        const _t9467 = e2;
        te = _t9467;
        continue;
        _t9465 = undefined;
        break _t9466;
      }
      if (_t9464._tag === 12) {
        const then_e = _t9464._val[1];
        const else_e = _t9464._val[2];
        _t9465 = (Typechecker$classify_all_branches_resume(then_e) && Typechecker$classify_all_branches_resume(else_e));
        break _t9466;
      }
      if (_t9464._tag === 24) {
        const arms = _t9464._val[1];
        function _t9468(__p316) {
          let _t9470;
          const _t9469 = __p316;
          _t9471: {
            if (true) {
              const body = _t9469[2];
              _t9470 = Typechecker$classify_all_branches_resume(body);
              break _t9471;
            }
            _match_fail("line 16190");
          }
          return _t9470;
        }
        _t9465 = List$forall(_t9468, arms);
        break _t9466;
      }
      if (true) {
        _t9465 = false;
        break _t9466;
      }
      _match_fail("line 16190");
    }
    return _t9465;
  }
}
function Typechecker$classify_all_resumes_tail(te) {
  while (true) {
    let _t9473;
    const _t9472 = te.expr;
    _t9474: {
      if (_t9472._tag === 31) {
        _t9473 = true;
        break _t9474;
      }
      if (_t9472._tag === 28) {
        const e2 = _t9472._val[1];
        const _t9475 = e2;
        te = _t9475;
        continue;
        _t9473 = undefined;
        break _t9474;
      }
      if (_t9472._tag === 8) {
        const e1 = _t9472._val[2];
        const e2 = _t9472._val[3];
        _t9473 = ((!Typechecker$handler_body_has_perform(e1)) && Typechecker$classify_all_resumes_tail(e2));
        break _t9474;
      }
      if (_t9472._tag === 9) {
        const e2 = _t9472._val[3];
        const _t9476 = e2;
        te = _t9476;
        continue;
        _t9473 = undefined;
        break _t9474;
      }
      if (_t9472._tag === 25) {
        const e1 = _t9472._val[1];
        const e2 = _t9472._val[2];
        _t9473 = ((!Typechecker$handler_body_has_perform(e1)) && Typechecker$classify_all_resumes_tail(e2));
        break _t9474;
      }
      if (_t9472._tag === 12) {
        const then_e = _t9472._val[1];
        const else_e = _t9472._val[2];
        _t9473 = (Typechecker$classify_all_resumes_tail(then_e) && Typechecker$classify_all_resumes_tail(else_e));
        break _t9474;
      }
      if (_t9472._tag === 24) {
        const arms = _t9472._val[1];
        function _t9477(__p317) {
          let _t9479;
          const _t9478 = __p317;
          _t9480: {
            if (true) {
              const body = _t9478[2];
              _t9479 = Typechecker$classify_all_resumes_tail(body);
              break _t9480;
            }
            _match_fail("line 16190");
          }
          return _t9479;
        }
        _t9473 = List$forall(_t9477, arms);
        break _t9474;
      }
      if (true) {
        _t9473 = true;
        break _t9474;
      }
      _match_fail("line 16190");
    }
    return _t9473;
  }
}
function Typechecker$strip_tail_resume(te) {
  let _t9482;
  const _t9481 = te.expr;
  _t9483: {
    if (_t9481._tag === 31) {
      const value = _t9481._val[1];
      _t9482 = value;
      break _t9483;
    }
    if (_t9481._tag === 8) {
      const r = _t9481._val[0];
      const n = _t9481._val[1];
      const e1 = _t9481._val[2];
      const e2 = _t9481._val[3];
      const __rec_upd_9484 = te;
      const _t9485 = ({expr: ({_tag: 8, _name: "TELet", _val: [r, n, e1, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9484.loc, ty: __rec_upd_9484.ty});
      _t9482 = _t9485;
      break _t9483;
    }
    if (_t9481._tag === 9) {
      const r = _t9481._val[0];
      const n = _t9481._val[1];
      const fn_e = _t9481._val[2];
      const e2 = _t9481._val[3];
      const __rec_upd_9486 = te;
      const _t9487 = ({expr: ({_tag: 9, _name: "TELetRec", _val: [r, n, fn_e, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9486.loc, ty: __rec_upd_9486.ty});
      _t9482 = _t9487;
      break _t9483;
    }
    if (_t9481._tag === 37) {
      const binds = _t9481._val[0];
      const e2 = _t9481._val[1];
      const __rec_upd_9488 = te;
      const _t9489 = ({expr: ({_tag: 37, _name: "TELetRecAnd", _val: [binds, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9488.loc, ty: __rec_upd_9488.ty});
      _t9482 = _t9489;
      break _t9483;
    }
    if (_t9481._tag === 25) {
      const n = _t9481._val[0];
      const e1 = _t9481._val[1];
      const e2 = _t9481._val[2];
      const __rec_upd_9490 = te;
      const _t9491 = ({expr: ({_tag: 25, _name: "TELetMut", _val: [n, e1, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9490.loc, ty: __rec_upd_9490.ty});
      _t9482 = _t9491;
      break _t9483;
    }
    if (_t9481._tag === 28) {
      const e1 = _t9481._val[0];
      const e2 = _t9481._val[1];
      const __rec_upd_9492 = te;
      const _t9493 = ({expr: ({_tag: 28, _name: "TESeq", _val: [e1, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9492.loc, ty: __rec_upd_9492.ty});
      _t9482 = _t9493;
      break _t9483;
    }
    if (_t9481._tag === 12) {
      const c = _t9481._val[0];
      const t = _t9481._val[1];
      const f = _t9481._val[2];
      const __rec_upd_9494 = te;
      const _t9495 = ({expr: ({_tag: 12, _name: "TEIf", _val: [c, Typechecker$strip_tail_resume(t), Typechecker$strip_tail_resume(f)]}), loc: __rec_upd_9494.loc, ty: __rec_upd_9494.ty});
      _t9482 = _t9495;
      break _t9483;
    }
    if (_t9481._tag === 24) {
      const s = _t9481._val[0];
      const arms = _t9481._val[1];
      const p = _t9481._val[2];
      function _t9496(__p318) {
        let _t9498;
        const _t9497 = __p318;
        _t9499: {
          if (true) {
            const pat = _t9497[0];
            const g = _t9497[1];
            const body = _t9497[2];
            _t9498 = [pat, g, Typechecker$strip_tail_resume(body)];
            break _t9499;
          }
          _match_fail("line 16190");
        }
        return _t9498;
      }
      const arms$p_9500 = List$map(_t9496, arms);
      const __rec_upd_9502 = te;
      const _t9503 = ({expr: ({_tag: 24, _name: "TEMatch", _val: [s, arms$p_9500, p]}), loc: __rec_upd_9502.loc, ty: __rec_upd_9502.ty});
      const _t9501 = _t9503;
      _t9482 = _t9501;
      break _t9483;
    }
    if (true) {
      _t9482 = te;
      break _t9483;
    }
    _match_fail("line 16190");
  }
  return _t9482;
}
function Typechecker$classify_arm(arm) {
  let _t9505;
  const _t9504 = arm;
  _t9506: {
    if (_t9504._tag === 1) {
      const op = _t9504._val[0];
      const arg = _t9504._val[1];
      const _k = _t9504._val[2];
      const body = _t9504._val[3];
      let _t9507;
      if (((!Typechecker$handler_body_has_resume(body)) && (!Typechecker$handler_body_has_perform(body)))) {
        _t9507 = ({_tag: 3, _name: "THOpTry", _val: [op, arg, body]});
      } else {
        let _t9508;
        if ((Typechecker$handler_body_has_resume(body) && (Typechecker$classify_all_branches_resume(body) && Typechecker$classify_all_resumes_tail(body)))) {
          _t9508 = ({_tag: 2, _name: "THOpProvide", _val: [op, arg, Typechecker$strip_tail_resume(body)]});
        } else {
          _t9508 = arm;
        }
        _t9507 = _t9508;
      }
      _t9505 = _t9507;
      break _t9506;
    }
    if (true) {
      _t9505 = arm;
      break _t9506;
    }
    _match_fail("line 16190");
  }
  return _t9505;
}
function Typechecker$classify_texpr(te) {
  function _t9509(e) {
    const __rec_upd_9510 = te;
    const _t9511 = ({expr: e, loc: __rec_upd_9510.loc, ty: __rec_upd_9510.ty});
    return _t9511;
  }
  const mk_9512 = _t9509;
  let _t9515;
  const _t9514 = te.expr;
  _t9516: {
    if (_t9514._tag === 30) {
      const body = _t9514._val[0];
      const arms = _t9514._val[1];
      const body$p_9517 = Typechecker$classify_texpr(body);
      function _t9519(arm) {
        let _t9521;
        const _t9520 = arm;
        _t9522: {
          if (_t9520._tag === 0) {
            const n = _t9520._val[0];
            const e = _t9520._val[1];
            _t9521 = ({_tag: 0, _name: "THReturn", _val: [n, Typechecker$classify_texpr(e)]});
            break _t9522;
          }
          if (_t9520._tag === 1) {
            const op = _t9520._val[0];
            const arg = _t9520._val[1];
            const k = _t9520._val[2];
            const e = _t9520._val[3];
            _t9521 = Typechecker$classify_arm(({_tag: 1, _name: "THOp", _val: [op, arg, k, Typechecker$classify_texpr(e)]}));
            break _t9522;
          }
          if (_t9520._tag === 2) {
            const op = _t9520._val[0];
            const arg = _t9520._val[1];
            const e = _t9520._val[2];
            _t9521 = ({_tag: 2, _name: "THOpProvide", _val: [op, arg, Typechecker$classify_texpr(e)]});
            break _t9522;
          }
          if (_t9520._tag === 3) {
            const op = _t9520._val[0];
            const arg = _t9520._val[1];
            const e = _t9520._val[2];
            _t9521 = ({_tag: 3, _name: "THOpTry", _val: [op, arg, Typechecker$classify_texpr(e)]});
            break _t9522;
          }
          _match_fail("line 16190");
        }
        return _t9521;
      }
      const arms$p_9523 = List$map(_t9519, arms);
      const _t9524 = Typechecker$mk(({_tag: 30, _name: "TEHandle", _val: [body$p_9517, arms$p_9523]}));
      const _t9518 = _t9524;
      _t9515 = _t9518;
      break _t9516;
    }
    if (_t9514._tag === 8) {
      const r = _t9514._val[0];
      const n = _t9514._val[1];
      const e1 = _t9514._val[2];
      const e2 = _t9514._val[3];
      _t9515 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [r, n, Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9516;
    }
    if (_t9514._tag === 9) {
      const r = _t9514._val[0];
      const n = _t9514._val[1];
      const fn_e = _t9514._val[2];
      const body = _t9514._val[3];
      _t9515 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [r, n, Typechecker$classify_texpr(fn_e), Typechecker$classify_texpr(body)]}));
      break _t9516;
    }
    if (_t9514._tag === 37) {
      const binds = _t9514._val[0];
      const body = _t9514._val[1];
      function _t9525(__p319) {
        let _t9527;
        const _t9526 = __p319;
        _t9528: {
          if (true) {
            const n = _t9526[0];
            const e = _t9526[1];
            _t9527 = [n, Typechecker$classify_texpr(e)];
            break _t9528;
          }
          _match_fail("line 16190");
        }
        return _t9527;
      }
      _t9515 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [List$map(_t9525, binds), Typechecker$classify_texpr(body)]}));
      break _t9516;
    }
    if (_t9514._tag === 10) {
      const p = _t9514._val[0];
      const body = _t9514._val[1];
      const f = _t9514._val[2];
      _t9515 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p, Typechecker$classify_texpr(body), f]}));
      break _t9516;
    }
    if (_t9514._tag === 11) {
      const fn_ = _t9514._val[0];
      const arg = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [Typechecker$classify_texpr(fn_), Typechecker$classify_texpr(arg)]}));
      break _t9516;
    }
    if (_t9514._tag === 12) {
      const c = _t9514._val[0];
      const t = _t9514._val[1];
      const f = _t9514._val[2];
      _t9515 = Typechecker$mk(({_tag: 12, _name: "TEIf", _val: [Typechecker$classify_texpr(c), Typechecker$classify_texpr(t), Typechecker$classify_texpr(f)]}));
      break _t9516;
    }
    if (_t9514._tag === 28) {
      const e1 = _t9514._val[0];
      const e2 = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 28, _name: "TESeq", _val: [Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9516;
    }
    if (_t9514._tag === 25) {
      const n = _t9514._val[0];
      const e1 = _t9514._val[1];
      const e2 = _t9514._val[2];
      _t9515 = Typechecker$mk(({_tag: 25, _name: "TELetMut", _val: [n, Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9516;
    }
    if (_t9514._tag === 24) {
      const scrut = _t9514._val[0];
      const arms = _t9514._val[1];
      const p = _t9514._val[2];
      function _t9529(__p320) {
        let _t9531;
        const _t9530 = __p320;
        _t9532: {
          if (true) {
            const pat = _t9530[0];
            const g = _t9530[1];
            const body = _t9530[2];
            _t9531 = [pat, Option$map(Typechecker$classify_texpr, g), Typechecker$classify_texpr(body)];
            break _t9532;
          }
          _match_fail("line 16190");
        }
        return _t9531;
      }
      _t9515 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [Typechecker$classify_texpr(scrut), List$map(_t9529, arms), p]}));
      break _t9516;
    }
    if (_t9514._tag === 13) {
      const op = _t9514._val[0];
      const e1 = _t9514._val[1];
      const e2 = _t9514._val[2];
      _t9515 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9516;
    }
    if (_t9514._tag === 14) {
      const op = _t9514._val[0];
      const e = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, Typechecker$classify_texpr(e)]}));
      break _t9516;
    }
    if (_t9514._tag === 15) {
      const es = _t9514._val;
      _t9515 = Typechecker$mk(({_tag: 15, _name: "TETuple", _val: List$map(Typechecker$classify_texpr, es)}));
      break _t9516;
    }
    if (_t9514._tag === 16) {
      const fields = _t9514._val;
      function _t9533(__p321) {
        let _t9535;
        const _t9534 = __p321;
        _t9536: {
          if (true) {
            const n = _t9534[0];
            const e = _t9534[1];
            _t9535 = [n, Typechecker$classify_texpr(e)];
            break _t9536;
          }
          _match_fail("line 16190");
        }
        return _t9535;
      }
      _t9515 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: List$map(_t9533, fields)}));
      break _t9516;
    }
    if (_t9514._tag === 17) {
      const base = _t9514._val[0];
      const fields = _t9514._val[1];
      function _t9537(__p322) {
        let _t9539;
        const _t9538 = __p322;
        _t9540: {
          if (true) {
            const n = _t9538[0];
            const e = _t9538[1];
            _t9539 = [n, Typechecker$classify_texpr(e)];
            break _t9540;
          }
          _match_fail("line 16190");
        }
        return _t9539;
      }
      _t9515 = Typechecker$mk(({_tag: 17, _name: "TERecordUpdate", _val: [Typechecker$classify_texpr(base), List$map(_t9537, fields)]}));
      break _t9516;
    }
    if (_t9514._tag === 18) {
      const base = _t9514._val[0];
      const pairs = _t9514._val[1];
      function _t9541(__p323) {
        let _t9543;
        const _t9542 = __p323;
        _t9544: {
          if (true) {
            const i = _t9542[0];
            const v = _t9542[1];
            _t9543 = [Typechecker$classify_texpr(i), Typechecker$classify_texpr(v)];
            break _t9544;
          }
          _match_fail("line 16190");
        }
        return _t9543;
      }
      _t9515 = Typechecker$mk(({_tag: 18, _name: "TERecordUpdateIdx", _val: [Typechecker$classify_texpr(base), List$map(_t9541, pairs)]}));
      break _t9516;
    }
    if (_t9514._tag === 19) {
      const e = _t9514._val[0];
      const f = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$classify_texpr(e), f]}));
      break _t9516;
    }
    if (_t9514._tag === 20) {
      const e1 = _t9514._val[0];
      const e2 = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9516;
    }
    if (_t9514._tag === 21) {
      const e1 = _t9514._val[0];
      const e2 = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9516;
    }
    if (_t9514._tag === 23) {
      const name = _t9514._val[0];
      const arg = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [name, Option$map(Typechecker$classify_texpr, arg)]}));
      break _t9516;
    }
    if (_t9514._tag === 26) {
      const n = _t9514._val[0];
      const e = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 26, _name: "TEAssign", _val: [n, Typechecker$classify_texpr(e)]}));
      break _t9516;
    }
    if (_t9514._tag === 27) {
      const e1 = _t9514._val[0];
      const f = _t9514._val[1];
      const e2 = _t9514._val[2];
      _t9515 = Typechecker$mk(({_tag: 27, _name: "TEFieldAssign", _val: [Typechecker$classify_texpr(e1), f, Typechecker$classify_texpr(e2)]}));
      break _t9516;
    }
    if (_t9514._tag === 29) {
      const name = _t9514._val[0];
      const e = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 29, _name: "TEPerform", _val: [name, Typechecker$classify_texpr(e)]}));
      break _t9516;
    }
    if (_t9514._tag === 31) {
      const k = _t9514._val[0];
      const v = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 31, _name: "TEResume", _val: [Typechecker$classify_texpr(k), Typechecker$classify_texpr(v)]}));
      break _t9516;
    }
    if (_t9514._tag === 32) {
      const c = _t9514._val[0];
      const b = _t9514._val[1];
      _t9515 = Typechecker$mk(({_tag: 32, _name: "TEWhile", _val: [Typechecker$classify_texpr(c), Typechecker$classify_texpr(b)]}));
      break _t9516;
    }
    if (_t9514._tag === 33) {
      const e = _t9514._val;
      _t9515 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$classify_texpr(e)}));
      break _t9516;
    }
    if (_t9514._tag === 35) {
      const e = _t9514._val;
      _t9515 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$classify_texpr(e)}));
      break _t9516;
    }
    if (_t9514._tag === 36) {
      const e = _t9514._val;
      _t9515 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: Typechecker$classify_texpr(e)}));
      break _t9516;
    }
    if (_t9514._tag === 38) {
      const kvs = _t9514._val;
      function _t9545(__p324) {
        let _t9547;
        const _t9546 = __p324;
        _t9548: {
          if (true) {
            const k = _t9546[0];
            const v = _t9546[1];
            _t9547 = [Typechecker$classify_texpr(k), Typechecker$classify_texpr(v)];
            break _t9548;
          }
          _match_fail("line 16190");
        }
        return _t9547;
      }
      _t9515 = Typechecker$mk(({_tag: 38, _name: "TEMap", _val: List$map(_t9545, kvs)}));
      break _t9516;
    }
    if (_t9514._tag === 39) {
      const es = _t9514._val;
      _t9515 = Typechecker$mk(({_tag: 39, _name: "TEArray", _val: List$map(Typechecker$classify_texpr, es)}));
      break _t9516;
    }
    if (_t9514._tag === 40) {
      const e = _t9514._val;
      _t9515 = Typechecker$mk(({_tag: 40, _name: "TEReturn", _val: Typechecker$classify_texpr(e)}));
      break _t9516;
    }
    if ((((((((((_t9514._tag === 0 || _t9514._tag === 1) || _t9514._tag === 2) || _t9514._tag === 3) || _t9514._tag === 4) || _t9514._tag === 5) || _t9514._tag === 6) || _t9514._tag === 7) || _t9514._tag === 22) || _t9514._tag === 34)) {
      _t9515 = te;
      break _t9516;
    }
    _match_fail("line 16190");
  }
  const _t9513 = _t9515;
  return _t9513;
}
function Typechecker$classify_handlers(program) {
  function _t9549(decl) {
    let _t9551;
    const _t9550 = decl;
    _t9552: {
      if (_t9550._tag === 0) {
        const n = _t9550._val[0];
        const e = _t9550._val[1];
        _t9551 = ({_tag: 0, _name: "TDLet", _val: [n, Typechecker$classify_texpr(e)]});
        break _t9552;
      }
      if (_t9550._tag === 1) {
        const n = _t9550._val[0];
        const e = _t9550._val[1];
        _t9551 = ({_tag: 1, _name: "TDLetMut", _val: [n, Typechecker$classify_texpr(e)]});
        break _t9552;
      }
      if (_t9550._tag === 2) {
        const n = _t9550._val[0];
        const e = _t9550._val[1];
        _t9551 = ({_tag: 2, _name: "TDLetRec", _val: [n, Typechecker$classify_texpr(e)]});
        break _t9552;
      }
      if (_t9550._tag === 5) {
        const e = _t9550._val;
        _t9551 = ({_tag: 5, _name: "TDExpr", _val: Typechecker$classify_texpr(e)});
        break _t9552;
      }
      if (_t9550._tag === 3) {
        const binds = _t9550._val;
        function _t9553(__p325) {
          let _t9555;
          const _t9554 = __p325;
          _t9556: {
            if (true) {
              const n = _t9554[0];
              const e = _t9554[1];
              _t9555 = [n, Typechecker$classify_texpr(e)];
              break _t9556;
            }
            _match_fail("line 16190");
          }
          return _t9555;
        }
        _t9551 = ({_tag: 3, _name: "TDLetRecAnd", _val: List$map(_t9553, binds)});
        break _t9552;
      }
      if (_t9550._tag === 9) {
        const name = _t9550._val[0];
        const decls = _t9550._val[1];
        _t9551 = ({_tag: 9, _name: "TDModule", _val: [name, Typechecker$classify_handlers(decls)]});
        break _t9552;
      }
      if (((((_t9550._tag === 7 || _t9550._tag === 4) || _t9550._tag === 6) || _t9550._tag === 8) || _t9550._tag === 10)) {
        _t9551 = decl;
        break _t9552;
      }
      _match_fail("line 16190");
    }
    return _t9551;
  }
  return List$map(_t9549, program);
}
function Optimize$collect_jump_targets(code) {
  const targets_9557 = Hashtbl$create(64);
  function _t9559(op) {
    let _t9561;
    const _t9560 = op;
    _t9562: {
      if (((((_t9560._tag === 37 || _t9560._tag === 38) || _t9560._tag === 39) || _t9560._tag === 68) || _t9560._tag === 71)) {
        const t = _t9560._val;
        _t9561 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, targets_9557, t, undefined]);
        break _t9562;
      }
      if (true) {
        _t9561 = undefined;
        break _t9562;
      }
      _match_fail("line 16190");
    }
    return _t9561;
  }
  Array$iter(_t9559, code);
  const _t9558 = targets_9557;
  return _t9558;
}
function Optimize$is_jump_target(__dict_Hash_0, __dict_Eq_0, targets, offset) {
  return _call(Hashtbl$has, [__dict_Hash_0, __dict_Eq_0, targets, offset]);
}
function Optimize$mark_dead_after_tail_call(code, targets, actions) {
  const len_9563 = Array$length(code);
  const i_9565 = Ref$create(0);
  let _t9567 = undefined;
  let _t9568 = false, _t9569;
  while (true) {
    if (!((Ref$get(i_9565) < len_9563))) break;
    let _t9571;
    const _t9570 = Array$get(code, Ref$get(i_9565));
    _t9572: {
      if ((_t9570._tag === 43 || _t9570._tag === 84)) {
        const j_9573 = Ref$create((Ref$get(i_9565) + 1));
        let _t9575 = undefined;
        let _t9576 = false, _t9577;
        while (true) {
          if (!(((Ref$get(j_9573) < len_9563) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, Ref$get(j_9573)]))))) break;
          Array$set(actions, Ref$get(j_9573), ({_tag: 1, _name: "Remove"}));
          Ref$set(j_9573, (Ref$get(j_9573) + 1));
          if (_t9576) break;
        }
        _t9575 = _t9576 ? _t9577 : undefined;
        _t9575;
        const _t9574 = Ref$set(i_9565, Ref$get(j_9573));
        _t9571 = _t9574;
        break _t9572;
      }
      if (true) {
        _t9571 = Ref$set(i_9565, (Ref$get(i_9565) + 1));
        break _t9572;
      }
      _match_fail("line 16190");
    }
    _t9571;
    if (_t9568) break;
  }
  _t9567 = _t9568 ? _t9569 : undefined;
  const _t9566 = _t9567;
  const _t9564 = _t9566;
  return _t9564;
}
function Optimize$mark_jump_to_next(code, actions) {
  const len_9578 = Array$length(code);
  let i_9580 = 0;
  let _t9582 = undefined;
  let _t9583 = false, _t9584;
  while (true) {
    if (!((i_9580 <= (len_9578 - 1)))) break;
    let _t9586;
    const _t9585 = Array$get(code, i_9580);
    _t9587: {
      if (_t9585._tag === 37) {
        const target = _t9585._val;
        if ((target === (i_9580 + 1))) {
          _t9586 = Array$set(actions, i_9580, ({_tag: 1, _name: "Remove"}));
          break _t9587;
        }
      }
      if (true) {
        _t9586 = undefined;
        break _t9587;
      }
      _match_fail("line 16190");
    }
    _t9586;
    (i_9580 = (i_9580 + 1), undefined);
    if (_t9583) break;
  }
  _t9582 = _t9583 ? _t9584 : undefined;
  const _t9581 = _t9582;
  const _t9579 = _t9581;
  return _t9579;
}
function Optimize$reads_slot(op, n) {
  let _t9589;
  const _t9588 = op;
  _t9590: {
    if ((((_t9588._tag === 3 || _t9588._tag === 77) || _t9588._tag === 78) || _t9588._tag === 79)) {
      const s = (((_t9588._tag === 3 || _t9588._tag === 77) || _t9588._tag === 78) ? ((_t9588._tag === 3 || _t9588._tag === 77) ? (_t9588._tag === 3 ? _t9588._val : _t9588._val[0]) : _t9588._val[0]) : _t9588._val[0]);
      _t9589 = (s === n);
      break _t9590;
    }
    if ((_t9588._tag === 40 || _t9588._tag === 41)) {
      const caps = _t9588._val[1];
      function _t9591(c) {
        return _eq(c, ({_tag: 0, _name: "CaptureLocal", _val: n}));
      }
      _t9589 = List$exists(_t9591, caps);
      break _t9590;
    }
    if (true) {
      _t9589 = false;
      break _t9590;
    }
    _match_fail("line 16190");
  }
  return _t9589;
}
function Optimize$writes_slot(op, n) {
  let _t9593;
  const _t9592 = op;
  _t9594: {
    if (_t9592._tag === 4) {
      const s = _t9592._val;
      _t9593 = (s === n);
      break _t9594;
    }
    if (true) {
      _t9593 = false;
      break _t9594;
    }
    _match_fail("line 16190");
  }
  return _t9593;
}
function Optimize$is_slot_dead(code, actions, targets, n, start) {
  const len_9595 = Array$length(code);
  const i_9597 = Ref$create(start);
  const result_9599 = Ref$create(true);
  const done__9601 = Ref$create(false);
  let _t9603 = undefined;
  let _t9604 = false, _t9605;
  while (true) {
    if (!(((Ref$get(i_9597) < len_9595) && (!Ref$get(done__9601))))) break;
    let _t9606;
    if (_eq(Array$get(actions, Ref$get(i_9597)), ({_tag: 1, _name: "Remove"}))) {
      _t9606 = Ref$set(i_9597, (Ref$get(i_9597) + 1));
    } else {
      let _t9607;
      if (_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, Ref$get(i_9597)])) {
        Ref$set(result_9599, false);
        _t9607 = Ref$set(done__9601, true);
      } else {
        const op_9608 = Array$get(code, Ref$get(i_9597));
        let _t9610;
        if (Optimize$reads_slot(op_9608, n)) {
          Ref$set(result_9599, false);
          _t9610 = Ref$set(done__9601, true);
        } else {
          let _t9611;
          if (Optimize$writes_slot(op_9608, n)) {
            _t9611 = Ref$set(done__9601, true);
          } else {
            let _t9613;
            const _t9612 = op_9608;
            _t9614: {
              if ((((((_t9612._tag === 44 || _t9612._tag === 45) || _t9612._tag === 43) || _t9612._tag === 84) || _t9612._tag === 64) || _t9612._tag === 76)) {
                _t9613 = Ref$set(done__9601, true);
                break _t9614;
              }
              if ((((((((_t9612._tag === 37 || _t9612._tag === 38) || _t9612._tag === 39) || _t9612._tag === 70) || _t9612._tag === 71) || _t9612._tag === 72) || _t9612._tag === 68) || _t9612._tag === 82)) {
                Ref$set(result_9599, false);
                _t9613 = Ref$set(done__9601, true);
                break _t9614;
              }
              if (true) {
                _t9613 = Ref$set(i_9597, (Ref$get(i_9597) + 1));
                break _t9614;
              }
              _match_fail("line 16190");
            }
            _t9611 = _t9613;
          }
          _t9610 = _t9611;
        }
        const _t9609 = _t9610;
        _t9607 = _t9609;
      }
      _t9606 = _t9607;
    }
    _t9606;
    if (_t9604) break;
  }
  _t9603 = _t9604 ? _t9605 : undefined;
  _t9603;
  const _t9602 = Ref$get(result_9599);
  const _t9600 = _t9602;
  const _t9598 = _t9600;
  const _t9596 = _t9598;
  return _t9596;
}
function Optimize$mark_set_get_pairs(code, targets, actions) {
  const len_9615 = Array$length(code);
  const i_9617 = Ref$create(0);
  let _t9619 = undefined;
  let _t9620 = false, _t9621;
  while (true) {
    if (!((Ref$get(i_9617) < (len_9615 - 1)))) break;
    let _t9622;
    if ((_eq(Array$get(actions, Ref$get(i_9617)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_9617) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_9617) + 1)]))))) {
      let _t9624;
      const _t9623 = [Array$get(code, Ref$get(i_9617)), Array$get(code, (Ref$get(i_9617) + 1))];
      _t9625: {
        if (_t9623[0]._tag === 4 && _t9623[1]._tag === 3) {
          const n = _t9623[0]._val;
          const m = _t9623[1]._val;
          if ((n === m)) {
            let _t9626;
            if (Optimize$is_slot_dead(code, actions, targets, n, (Ref$get(i_9617) + 2))) {
              Array$set(actions, Ref$get(i_9617), ({_tag: 1, _name: "Remove"}));
              Array$set(actions, (Ref$get(i_9617) + 1), ({_tag: 1, _name: "Remove"}));
              _t9626 = Ref$set(i_9617, (Ref$get(i_9617) + 2));
            } else {
              Array$set(actions, Ref$get(i_9617), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 2, _name: "DUP"}), _tl: ({_hd: ({_tag: 4, _name: "SET_LOCAL", _val: n}), _tl: null})})}));
              Array$set(actions, (Ref$get(i_9617) + 1), ({_tag: 1, _name: "Remove"}));
              _t9626 = Ref$set(i_9617, (Ref$get(i_9617) + 2));
            }
            _t9624 = _t9626;
            break _t9625;
          }
        }
        if (true) {
          _t9624 = Ref$set(i_9617, (Ref$get(i_9617) + 1));
          break _t9625;
        }
        _match_fail("line 16190");
      }
      _t9622 = _t9624;
    } else {
      _t9622 = Ref$set(i_9617, (Ref$get(i_9617) + 1));
    }
    _t9622;
    if (_t9620) break;
  }
  _t9619 = _t9620 ? _t9621 : undefined;
  const _t9618 = _t9619;
  const _t9616 = _t9618;
  return _t9616;
}
function Optimize$mark_dead_stores(code, targets, actions) {
  const len_9627 = Array$length(code);
  const i_9629 = Ref$create(0);
  let _t9631 = undefined;
  let _t9632 = false, _t9633;
  while (true) {
    if (!((Ref$get(i_9629) < len_9627))) break;
    const handled_9634 = Ref$create(false);
    let _t9636;
    if ((((Ref$get(i_9629) + 1) < len_9627) && (_eq(Array$get(actions, Ref$get(i_9629)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_9629) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_9629) + 1)])))))) {
      let _t9638;
      const _t9637 = [Array$get(code, Ref$get(i_9629)), Array$get(code, (Ref$get(i_9629) + 1))];
      _t9639: {
        if (_t9637[0]._tag === 2 && _t9637[1]._tag === 4) {
          const n = _t9637[1]._val;
          if (Optimize$is_slot_dead(code, actions, targets, n, (Ref$get(i_9629) + 2))) {
            Array$set(actions, Ref$get(i_9629), ({_tag: 1, _name: "Remove"}));
            Array$set(actions, (Ref$get(i_9629) + 1), ({_tag: 1, _name: "Remove"}));
            Ref$set(i_9629, (Ref$get(i_9629) + 2));
            _t9638 = Ref$set(handled_9634, true);
            break _t9639;
          }
        }
        if (true) {
          _t9638 = undefined;
          break _t9639;
        }
        _match_fail("line 16190");
      }
      _t9636 = _t9638;
    } else {
      _t9636 = undefined;
    }
    _t9636;
    let _t9640;
    if ((!Ref$get(handled_9634))) {
      let _t9642;
      const _t9641 = Array$get(code, Ref$get(i_9629));
      _t9643: {
        if (_t9641._tag === 4) {
          const n = _t9641._val;
          if ((_eq(Array$get(actions, Ref$get(i_9629)), ({_tag: 0, _name: "Keep"})) && Optimize$is_slot_dead(code, actions, targets, n, (Ref$get(i_9629) + 1)))) {
            Array$set(actions, Ref$get(i_9629), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 1, _name: "POP"}), _tl: null})}));
            _t9642 = Ref$set(i_9629, (Ref$get(i_9629) + 1));
            break _t9643;
          }
        }
        if (true) {
          _t9642 = Ref$set(i_9629, (Ref$get(i_9629) + 1));
          break _t9643;
        }
        _match_fail("line 16190");
      }
      _t9640 = _t9642;
    } else {
      _t9640 = undefined;
    }
    const _t9635 = _t9640;
    _t9635;
    if (_t9632) break;
  }
  _t9631 = _t9632 ? _t9633 : undefined;
  const _t9630 = _t9631;
  const _t9628 = _t9630;
  return _t9628;
}
function Optimize$mark_superinstructions(code, targets, actions) {
  const len_9644 = Array$length(code);
  const i_9646 = Ref$create(0);
  let _t9648 = undefined;
  let _t9649 = false, _t9650;
  while (true) {
    if (!((Ref$get(i_9646) < len_9644))) break;
    let _t9651;
    if ((((Ref$get(i_9646) + 1) < len_9644) && (_eq(Array$get(actions, Ref$get(i_9646)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_9646) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_9646) + 1)])))))) {
      let _t9653;
      const _t9652 = [Array$get(code, Ref$get(i_9646)), Array$get(code, (Ref$get(i_9646) + 1))];
      _t9654: {
        if (_t9652[0]._tag === 3 && _t9652[1]._tag === 42) {
          const slot = _t9652[0]._val;
          const arity = _t9652[1]._val;
          Array$set(actions, Ref$get(i_9646), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 77, _name: "GET_LOCAL_CALL", _val: [slot, arity]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_9646) + 1), ({_tag: 1, _name: "Remove"}));
          _t9653 = Ref$set(i_9646, (Ref$get(i_9646) + 2));
          break _t9654;
        }
        if (_t9652[0]._tag === 3 && _t9652[1]._tag === 49) {
          const slot = _t9652[0]._val;
          const idx = _t9652[1]._val;
          Array$set(actions, Ref$get(i_9646), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 78, _name: "GET_LOCAL_TUPLE_GET", _val: [slot, idx]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_9646) + 1), ({_tag: 1, _name: "Remove"}));
          _t9653 = Ref$set(i_9646, (Ref$get(i_9646) + 2));
          break _t9654;
        }
        if (_t9652[0]._tag === 3 && _t9652[1]._tag === 51) {
          const slot = _t9652[0]._val;
          const name = _t9652[1]._val;
          Array$set(actions, Ref$get(i_9646), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 79, _name: "GET_LOCAL_FIELD", _val: [slot, name]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_9646) + 1), ({_tag: 1, _name: "Remove"}));
          _t9653 = Ref$set(i_9646, (Ref$get(i_9646) + 2));
          break _t9654;
        }
        if (_t9652[0]._tag === 10 && _t9652[1]._tag === 42) {
          const idx = _t9652[0]._val;
          const arity = _t9652[1]._val;
          Array$set(actions, Ref$get(i_9646), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 80, _name: "GET_GLOBAL_CALL", _val: [idx, arity]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_9646) + 1), ({_tag: 1, _name: "Remove"}));
          _t9653 = Ref$set(i_9646, (Ref$get(i_9646) + 2));
          break _t9654;
        }
        if (_t9652[0]._tag === 10 && _t9652[1]._tag === 51) {
          const idx = _t9652[0]._val;
          const name = _t9652[1]._val;
          Array$set(actions, Ref$get(i_9646), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 81, _name: "GET_GLOBAL_FIELD", _val: [idx, name]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_9646) + 1), ({_tag: 1, _name: "Remove"}));
          _t9653 = Ref$set(i_9646, (Ref$get(i_9646) + 2));
          break _t9654;
        }
        if (true) {
          _t9653 = Ref$set(i_9646, (Ref$get(i_9646) + 1));
          break _t9654;
        }
        _match_fail("line 16190");
      }
      _t9651 = _t9653;
    } else {
      _t9651 = Ref$set(i_9646, (Ref$get(i_9646) + 1));
    }
    _t9651;
    if (_t9649) break;
  }
  _t9648 = _t9649 ? _t9650 : undefined;
  const _t9647 = _t9648;
  const _t9645 = _t9647;
  return _t9645;
}
function Optimize$detect_tag_chain(code, _targets, start_pos, scrut_slot) {
  const len_9655 = Array$length(code);
  const arms_9657 = Ref$create(null);
  const pos_9659 = Ref$create(start_pos);
  const continue__9661 = Ref$create(true);
  const default_target_9663 = Ref$create(0);
  const chain_positions_9665 = Hashtbl$create(16);
  let _t9667 = undefined;
  let _t9668 = false, _t9669;
  while (true) {
    if (!(Ref$get(continue__9661))) break;
    let _t9681;
    if (((Ref$get(pos_9659) + 2) < len_9655)) {
    let _t9671;
    const _t9670 = Array$get(code, Ref$get(pos_9659));
    _t9672: {
      if (_t9670._tag === 3) {
        const s = _t9670._val;
        if ((s === scrut_slot)) {
          _t9671 = true;
          break _t9672;
        }
      }
      if (true) {
        _t9671 = false;
        break _t9672;
      }
      _match_fail("line 16190");
    }
    let _t9680;
    if (_t9671) {
    let _t9674;
    const _t9673 = Array$get(code, (Ref$get(pos_9659) + 1));
    _t9675: {
      if (_t9673._tag === 58) {
        _t9674 = true;
        break _t9675;
      }
      if (true) {
        _t9674 = false;
        break _t9675;
      }
      _match_fail("line 16190");
    }
    let _t9679;
    if (_t9674) {
    let _t9677;
    const _t9676 = Array$get(code, (Ref$get(pos_9659) + 2));
    _t9678: {
      if (_t9676._tag === 38) {
        const t = _t9676._val;
        _t9677 = (t > Ref$get(pos_9659));
        break _t9678;
      }
      if (true) {
        _t9677 = false;
        break _t9678;
      }
      _match_fail("line 16190");
    }
      _t9679 = _t9677;
    } else {
      _t9679 = false;
    }
      _t9680 = _t9679;
    } else {
      _t9680 = false;
    }
      _t9681 = _t9680;
    } else {
      _t9681 = false;
    }
    let _t9682;
    if (_t9681) {
      let _t9684;
      const _t9683 = Array$get(code, (Ref$get(pos_9659) + 1));
      _t9685: {
        if (_t9683._tag === 58) {
          const t = _t9683._val;
          _t9684 = t;
          break _t9685;
        }
        if (true) {
          _t9684 = failwith("assert false");
          break _t9685;
        }
        _match_fail("line 16190");
      }
      const tag_9686 = _t9684;
      let _t9689;
      const _t9688 = Array$get(code, (Ref$get(pos_9659) + 2));
      _t9690: {
        if (_t9688._tag === 38) {
          const t = _t9688._val;
          _t9689 = t;
          break _t9690;
        }
        if (true) {
          _t9689 = failwith("assert false");
          break _t9690;
        }
        _match_fail("line 16190");
      }
      const next_9691 = _t9689;
      const arm_body_9693 = (Ref$get(pos_9659) + 3);
      Ref$set(arms_9657, ({_hd: [tag_9686, arm_body_9693], _tl: Ref$get(arms_9657)}));
      _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, chain_positions_9665, Ref$get(pos_9659), undefined]);
      _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, chain_positions_9665, (Ref$get(pos_9659) + 1), undefined]);
      _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, chain_positions_9665, (Ref$get(pos_9659) + 2), undefined]);
      const _t9694 = Ref$set(pos_9659, next_9691);
      const _t9692 = _t9694;
      const _t9687 = _t9692;
      _t9682 = _t9687;
    } else {
      Ref$set(default_target_9663, Ref$get(pos_9659));
      _t9682 = Ref$set(continue__9661, false);
    }
    _t9682;
    if (_t9668) break;
  }
  _t9667 = _t9668 ? _t9669 : undefined;
  _t9667;
  const arms_9695 = List$rev(Ref$get(arms_9657));
  const valid_9697 = (List$length(arms_9695) >= 2);
  let _t9710;
  if (valid_9697) {
  const ok_9699 = Ref$create(true);
  function _t9701(i, op) {
    let _t9702;
    if ((Ref$get(ok_9699) && (!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, chain_positions_9665, i])))) {
      function _t9703(t) {
        let _t9704;
        if (_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, chain_positions_9665, t])) {
          _t9704 = Ref$set(ok_9699, false);
        } else {
          _t9704 = undefined;
        }
        return _t9704;
      }
      const check_target_9705 = _t9703;
      let _t9708;
      const _t9707 = op;
      _t9709: {
        if (((((_t9707._tag === 37 || _t9707._tag === 38) || _t9707._tag === 39) || _t9707._tag === 68) || _t9707._tag === 71)) {
          const t = _t9707._val;
          _t9708 = check_target_9705(t);
          break _t9709;
        }
        if (true) {
          _t9708 = undefined;
          break _t9709;
        }
        _match_fail("line 16190");
      }
      const _t9706 = _t9708;
      _t9702 = _t9706;
    } else {
      _t9702 = undefined;
    }
    return _t9702;
  }
  Array$iteri(_t9701, code);
  const _t9700 = Ref$get(ok_9699);
    _t9710 = _t9700;
  } else {
    _t9710 = false;
  }
  const valid_9711 = _t9710;
  let _t9713;
  if ((valid_9711 && !_eq(arms_9695, null))) {
    const tags_9714 = List$map(fst, arms_9695);
    const unique_tags_9716 = List$sort_uniq(compare, tags_9714);
    let _t9718;
    if ((List$length(unique_tags_9716) !== List$length(tags_9714))) {
      _t9718 = ({_tag: 0, _name: "None"});
    } else {
      const min_tag_9719 = List$fold(min, List$hd(tags_9714), tags_9714);
      const max_tag_9721 = List$fold(max, List$hd(tags_9714), tags_9714);
      const range_9723 = ((max_tag_9721 - min_tag_9719) + 1);
      let _t9725;
      if ((range_9723 <= (2 * List$length(arms_9695)))) {
        _t9725 = ({_tag: 1, _name: "Some", _val: [arms_9695, min_tag_9719, max_tag_9721, Ref$get(default_target_9663)]});
      } else {
        _t9725 = ({_tag: 0, _name: "None"});
      }
      const _t9724 = _t9725;
      const _t9722 = _t9724;
      const _t9720 = _t9722;
      _t9718 = _t9720;
    }
    const _t9717 = _t9718;
    const _t9715 = _t9717;
    _t9713 = _t9715;
  } else {
    _t9713 = ({_tag: 0, _name: "None"});
  }
  const _t9712 = _t9713;
  const _t9698 = _t9712;
  const _t9696 = _t9698;
  const _t9666 = _t9696;
  const _t9664 = _t9666;
  const _t9662 = _t9664;
  const _t9660 = _t9662;
  const _t9658 = _t9660;
  const _t9656 = _t9658;
  return _t9656;
}
function Optimize$mark_jump_tables(code, targets, actions) {
  const len_9726 = Array$length(code);
  const i_9728 = Ref$create(0);
  let _t9730 = undefined;
  let _t9731 = false, _t9732;
  while (true) {
    if (!((Ref$get(i_9728) < len_9726))) break;
    let _t9733;
    if ((((Ref$get(i_9728) + 2) < len_9726) && _eq(Array$get(actions, Ref$get(i_9728)), ({_tag: 0, _name: "Keep"})))) {
      let _t9735;
      const _t9734 = [Array$get(code, Ref$get(i_9728)), Array$get(code, (Ref$get(i_9728) + 1)), Array$get(code, (Ref$get(i_9728) + 2))];
      _t9736: {
        if (_t9734[0]._tag === 3 && _t9734[1]._tag === 58 && _t9734[2]._tag === 38) {
          const scrut_slot = _t9734[0]._val;
          let _t9738;
          const _t9737 = Optimize$detect_tag_chain(code, targets, Ref$get(i_9728), scrut_slot);
          _t9739: {
            if (_t9737._tag === 1) {
              const arms = _t9737._val[0];
              const min_tag = _t9737._val[1];
              const max_tag = _t9737._val[2];
              const default_target = _t9737._val[3];
              const range_9740 = ((max_tag - min_tag) + 1);
              const table_9742 = Array$make(range_9740, default_target);
              function _t9744(__p326) {
                let _t9746;
                const _t9745 = __p326;
                _t9747: {
                  if (true) {
                    const tag = _t9745[0];
                    const arm_body = _t9745[1];
                    _t9746 = Array$set(table_9742, (tag - min_tag), arm_body);
                    break _t9747;
                  }
                  _match_fail("line 16190");
                }
                return _t9746;
              }
              List$iter(_t9744, arms);
              Array$set(actions, (Ref$get(i_9728) + 1), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 82, _name: "JUMP_TABLE", _val: [min_tag, table_9742, default_target]}), _tl: null})}));
              Array$set(actions, (Ref$get(i_9728) + 2), ({_tag: 1, _name: "Remove"}));
              const remaining_9748 = List$tl(arms);
              function _t9750(__p327) {
                let _t9752;
                const _t9751 = __p327;
                _t9753: {
                  if (true) {
                    const arm_body = _t9751[1];
                    const chain_start_9754 = (arm_body - 3);
                    let _t9756;
                    if (((chain_start_9754 >= 0) && (chain_start_9754 < len_9726))) {
                      let _t9757;
                      if (_eq(Array$get(actions, chain_start_9754), ({_tag: 0, _name: "Keep"}))) {
                        _t9757 = Array$set(actions, chain_start_9754, ({_tag: 1, _name: "Remove"}));
                      } else {
                        _t9757 = undefined;
                      }
                      _t9757;
                      let _t9758;
                      if ((((chain_start_9754 + 1) < len_9726) && _eq(Array$get(actions, (chain_start_9754 + 1)), ({_tag: 0, _name: "Keep"})))) {
                        _t9758 = Array$set(actions, (chain_start_9754 + 1), ({_tag: 1, _name: "Remove"}));
                      } else {
                        _t9758 = undefined;
                      }
                      _t9758;
                      let _t9759;
                      if ((((chain_start_9754 + 2) < len_9726) && _eq(Array$get(actions, (chain_start_9754 + 2)), ({_tag: 0, _name: "Keep"})))) {
                        _t9759 = Array$set(actions, (chain_start_9754 + 2), ({_tag: 1, _name: "Remove"}));
                      } else {
                        _t9759 = undefined;
                      }
                      _t9756 = _t9759;
                    } else {
                      _t9756 = undefined;
                    }
                    const _t9755 = _t9756;
                    _t9752 = _t9755;
                    break _t9753;
                  }
                  _match_fail("line 16190");
                }
                return _t9752;
              }
              List$iter(_t9750, remaining_9748);
              const last_arm_9760 = List$nth(arms, (List$length(arms) - 1));
              const _t9761 = Ref$set(i_9728, snd(last_arm_9760));
              const _t9749 = _t9761;
              const _t9743 = _t9749;
              const _t9741 = _t9743;
              _t9738 = _t9741;
              break _t9739;
            }
            if (_t9737._tag === 0) {
              _t9738 = Ref$set(i_9728, (Ref$get(i_9728) + 1));
              break _t9739;
            }
            _match_fail("line 16190");
          }
          _t9735 = _t9738;
          break _t9736;
        }
        if (true) {
          _t9735 = Ref$set(i_9728, (Ref$get(i_9728) + 1));
          break _t9736;
        }
        _match_fail("line 16190");
      }
      _t9733 = _t9735;
    } else {
      _t9733 = Ref$set(i_9728, (Ref$get(i_9728) + 1));
    }
    _t9733;
    if (_t9731) break;
  }
  _t9730 = _t9731 ? _t9732 : undefined;
  const _t9729 = _t9730;
  const _t9727 = _t9729;
  return _t9727;
}
function Optimize$mark_push_pop(code, targets, actions) {
  const len_9762 = Array$length(code);
  const i_9764 = Ref$create(0);
  let _t9766 = undefined;
  let _t9767 = false, _t9768;
  while (true) {
    if (!((Ref$get(i_9764) < (len_9762 - 1)))) break;
    let _t9769;
    if ((_eq(Array$get(actions, Ref$get(i_9764)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_9764) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_9764) + 1)]))))) {
      let _t9771;
      const _t9770 = Array$get(code, Ref$get(i_9764));
      _t9772: {
        if ((((((_t9770._tag === 0 || _t9770._tag === 3) || _t9770._tag === 10) || _t9770._tag === 5) || _t9770._tag === 57) || _t9770._tag === 2)) {
          _t9771 = true;
          break _t9772;
        }
        if (true) {
          _t9771 = false;
          break _t9772;
        }
        _match_fail("line 16190");
      }
      const is_pure_push_9773 = _t9771;
      let _t9776;
      const _t9775 = Array$get(code, (Ref$get(i_9764) + 1));
      _t9777: {
        if (_t9775._tag === 1) {
          if (is_pure_push_9773) {
            Array$set(actions, Ref$get(i_9764), ({_tag: 1, _name: "Remove"}));
            Array$set(actions, (Ref$get(i_9764) + 1), ({_tag: 1, _name: "Remove"}));
            _t9776 = Ref$set(i_9764, (Ref$get(i_9764) + 2));
            break _t9777;
          }
        }
        if (true) {
          _t9776 = Ref$set(i_9764, (Ref$get(i_9764) + 1));
          break _t9777;
        }
        _match_fail("line 16190");
      }
      const _t9774 = _t9776;
      _t9769 = _t9774;
    } else {
      _t9769 = Ref$set(i_9764, (Ref$get(i_9764) + 1));
    }
    _t9769;
    if (_t9767) break;
  }
  _t9766 = _t9767 ? _t9768 : undefined;
  const _t9765 = _t9766;
  const _t9763 = _t9765;
  return _t9763;
}
function Optimize$rewrite(code, line_table, actions) {
  const len_9778 = Array$length(code);
  const new_code_9780 = Ref$create(null);
  const new_lines_9782 = Ref$create(null);
  const offset_map_9784 = Array$make((len_9778 + 1), 0);
  const new_offset_9786 = Ref$create(0);
  let i_9788 = 0;
  let _t9790 = undefined;
  let _t9791 = false, _t9792;
  while (true) {
    if (!((i_9788 <= (len_9778 - 1)))) break;
    Array$set(offset_map_9784, i_9788, Ref$get(new_offset_9786));
    let _t9793;
    if ((i_9788 < Array$length(line_table))) {
      _t9793 = Array$get(line_table, i_9788);
    } else {
      _t9793 = 0;
    }
    const line_9794 = _t9793;
    let _t9797;
    const _t9796 = Array$get(actions, i_9788);
    _t9798: {
      if (_t9796._tag === 0) {
        Ref$set(new_code_9780, ({_hd: Array$get(code, i_9788), _tl: Ref$get(new_code_9780)}));
        Ref$set(new_lines_9782, ({_hd: line_9794, _tl: Ref$get(new_lines_9782)}));
        _t9797 = Ref$set(new_offset_9786, (Ref$get(new_offset_9786) + 1));
        break _t9798;
      }
      if (_t9796._tag === 1) {
        _t9797 = undefined;
        break _t9798;
      }
      if (_t9796._tag === 2) {
        const ops = _t9796._val;
        function _t9799(op) {
          Ref$set(new_code_9780, ({_hd: op, _tl: Ref$get(new_code_9780)}));
          Ref$set(new_lines_9782, ({_hd: line_9794, _tl: Ref$get(new_lines_9782)}));
          return Ref$set(new_offset_9786, (Ref$get(new_offset_9786) + 1));
        }
        _t9797 = List$iter(_t9799, ops);
        break _t9798;
      }
      _match_fail("line 16190");
    }
    const _t9795 = _t9797;
    _t9795;
    (i_9788 = (i_9788 + 1), undefined);
    if (_t9791) break;
  }
  _t9790 = _t9791 ? _t9792 : undefined;
  _t9790;
  Array$set(offset_map_9784, len_9778, Ref$get(new_offset_9786));
  const new_code_9800 = Array$of_list(List$rev(Ref$get(new_code_9780)));
  const new_lines_9802 = Array$of_list(List$rev(Ref$get(new_lines_9782)));
  const _t9803 = [new_code_9800, new_lines_9802, offset_map_9784];
  const _t9801 = _t9803;
  const _t9789 = _t9801;
  const _t9787 = _t9789;
  const _t9785 = _t9787;
  const _t9783 = _t9785;
  const _t9781 = _t9783;
  const _t9779 = _t9781;
  return _t9779;
}
function Optimize$fixup_jumps(code, offset_map) {
  const map_len_9804 = Array$length(offset_map);
  function _t9806(t) {
    let _t9807;
    if (((t >= 0) && (t < map_len_9804))) {
      _t9807 = Array$get(offset_map, t);
    } else {
      _t9807 = t;
    }
    return _t9807;
  }
  const remap_9808 = _t9806;
  function _t9810(i, op) {
    let _t9812;
    const _t9811 = op;
    _t9813: {
      if (_t9811._tag === 37) {
        const t = _t9811._val;
        _t9812 = ({_tag: 37, _name: "JUMP", _val: remap_9808(t)});
        break _t9813;
      }
      if (_t9811._tag === 38) {
        const t = _t9811._val;
        _t9812 = ({_tag: 38, _name: "JUMP_IF_FALSE", _val: remap_9808(t)});
        break _t9813;
      }
      if (_t9811._tag === 39) {
        const t = _t9811._val;
        _t9812 = ({_tag: 39, _name: "JUMP_IF_TRUE", _val: remap_9808(t)});
        break _t9813;
      }
      if (_t9811._tag === 68) {
        const t = _t9811._val;
        _t9812 = ({_tag: 68, _name: "ENTER_LOOP", _val: remap_9808(t)});
        break _t9813;
      }
      if (_t9811._tag === 71) {
        const t = _t9811._val;
        _t9812 = ({_tag: 71, _name: "LOOP_CONTINUE", _val: remap_9808(t)});
        break _t9813;
      }
      if (_t9811._tag === 82) {
        const min_tag = _t9811._val[0];
        const targets = _t9811._val[1];
        const _mml$default = _t9811._val[2];
        function _t9814(t) {
          return remap_9808(t);
        }
        const new_targets_9815 = Array$map(_t9814, targets);
        const new_default_9817 = remap_9808(_mml$default);
        const _t9818 = ({_tag: 82, _name: "JUMP_TABLE", _val: [min_tag, new_targets_9815, new_default_9817]});
        const _t9816 = _t9818;
        _t9812 = _t9816;
        break _t9813;
      }
      if (true) {
        const other = _t9811;
        _t9812 = other;
        break _t9813;
      }
      _match_fail("line 16190");
    }
    const remapped_9819 = _t9812;
    const _t9820 = Array$set(code, i, remapped_9819);
    return _t9820;
  }
  const _t9809 = Array$iteri(_t9810, code);
  const _t9805 = _t9809;
  return _t9805;
}
function Optimize$thread_jumps(code) {
  const len_9821 = Array$length(code);
  let _t9823;
  if ((len_9821 === 0)) {
    _t9823 = undefined;
  } else {
    function _t9824(target) {
      const visited_9825 = Hashtbl$create(8);
      const t_9827 = Ref$create(target);
      const continue__9829 = Ref$create(true);
      let _t9831 = undefined;
      let _t9832 = false, _t9833;
      while (true) {
        if (!(Ref$get(continue__9829))) break;
        let _t9834;
        if (((Ref$get(t_9827) < 0) || ((Ref$get(t_9827) >= len_9821) || _call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, visited_9825, Ref$get(t_9827)])))) {
          _t9834 = Ref$set(continue__9829, false);
        } else {
          let _t9836;
          const _t9835 = Array$get(code, Ref$get(t_9827));
          _t9837: {
            if (_t9835._tag === 37) {
              const next = _t9835._val;
              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, visited_9825, Ref$get(t_9827), undefined]);
              _t9836 = Ref$set(t_9827, next);
              break _t9837;
            }
            if (true) {
              _t9836 = Ref$set(continue__9829, false);
              break _t9837;
            }
            _match_fail("line 16190");
          }
          _t9834 = _t9836;
        }
        _t9834;
        if (_t9832) break;
      }
      _t9831 = _t9832 ? _t9833 : undefined;
      _t9831;
      const _t9830 = Ref$get(t_9827);
      const _t9828 = _t9830;
      const _t9826 = _t9828;
      return _t9826;
    }
    const resolve_target_9838 = _t9824;
    const control_depth_9840 = Array$make(len_9821, 0);
    const depth_9842 = Ref$create(0);
    let i_9844 = 0;
    let _t9846 = undefined;
    let _t9847 = false, _t9848;
    while (true) {
      if (!((i_9844 <= (len_9821 - 1)))) break;
      Array$set(control_depth_9840, i_9844, Ref$get(depth_9842));
      let _t9850;
      const _t9849 = Array$get(code, i_9844);
      _t9851: {
        if (_t9849._tag === 68) {
          _t9850 = Ref$set(depth_9842, (Ref$get(depth_9842) + 1));
          break _t9851;
        }
        if (_t9849._tag === 69) {
          let _t9852;
          if ((Ref$get(depth_9842) > 0)) {
            _t9852 = Ref$set(depth_9842, (Ref$get(depth_9842) - 1));
          } else {
            _t9852 = undefined;
          }
          _t9850 = _t9852;
          break _t9851;
        }
        if (true) {
          _t9850 = undefined;
          break _t9851;
        }
        _match_fail("line 16190");
      }
      _t9850;
      (i_9844 = (i_9844 + 1), undefined);
      if (_t9847) break;
    }
    _t9846 = _t9847 ? _t9848 : undefined;
    _t9846;
    let i_9853 = 0;
    let _t9855 = undefined;
    let _t9856 = false, _t9857;
    while (true) {
      if (!((i_9853 <= (len_9821 - 1)))) break;
      let _t9859;
      const _t9858 = Array$get(code, i_9853);
      _t9860: {
        if (_t9858._tag === 37) {
          const target = _t9858._val;
          const final_target_9861 = resolve_target_9838(target);
          let _t9863;
          if (((final_target_9861 >= 0) && ((final_target_9861 < len_9821) && (Array$get(control_depth_9840, i_9853) === 0)))) {
            let _t9865;
            const _t9864 = Array$get(code, final_target_9861);
            _t9866: {
              if (_t9864._tag === 44) {
                _t9865 = Array$set(code, i_9853, ({_tag: 44, _name: "RETURN"}));
                break _t9866;
              }
              if (true) {
                let _t9867;
                if ((final_target_9861 !== target)) {
                  _t9867 = Array$set(code, i_9853, ({_tag: 37, _name: "JUMP", _val: final_target_9861}));
                } else {
                  _t9867 = undefined;
                }
                _t9865 = _t9867;
                break _t9866;
              }
              _match_fail("line 16190");
            }
            _t9863 = _t9865;
          } else {
            let _t9868;
            if ((final_target_9861 !== target)) {
              _t9868 = Array$set(code, i_9853, ({_tag: 37, _name: "JUMP", _val: final_target_9861}));
            } else {
              _t9868 = undefined;
            }
            _t9863 = _t9868;
          }
          const _t9862 = _t9863;
          _t9859 = _t9862;
          break _t9860;
        }
        if (_t9858._tag === 38) {
          const target = _t9858._val;
          const final_target_9869 = resolve_target_9838(target);
          let _t9871;
          if ((final_target_9869 !== target)) {
            _t9871 = Array$set(code, i_9853, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: final_target_9869}));
          } else {
            _t9871 = undefined;
          }
          const _t9870 = _t9871;
          _t9859 = _t9870;
          break _t9860;
        }
        if (_t9858._tag === 39) {
          const target = _t9858._val;
          const final_target_9872 = resolve_target_9838(target);
          let _t9874;
          if ((final_target_9872 !== target)) {
            _t9874 = Array$set(code, i_9853, ({_tag: 39, _name: "JUMP_IF_TRUE", _val: final_target_9872}));
          } else {
            _t9874 = undefined;
          }
          const _t9873 = _t9874;
          _t9859 = _t9873;
          break _t9860;
        }
        if (_t9858._tag === 82) {
          const min_tag = _t9858._val[0];
          const targets = _t9858._val[1];
          const default_target = _t9858._val[2];
          const changed_9875 = Ref$create(false);
          function _t9877(t) {
            const final_t_9878 = resolve_target_9838(t);
            let _t9880;
            if ((final_t_9878 !== t)) {
              _t9880 = Ref$set(changed_9875, true);
            } else {
              _t9880 = undefined;
            }
            _t9880;
            const _t9879 = final_t_9878;
            return _t9879;
          }
          const new_targets_9881 = Array$map(_t9877, targets);
          const new_default_9883 = resolve_target_9838(default_target);
          let _t9885;
          if ((new_default_9883 !== default_target)) {
            _t9885 = Ref$set(changed_9875, true);
          } else {
            _t9885 = undefined;
          }
          _t9885;
          let _t9886;
          if (Ref$get(changed_9875)) {
            _t9886 = Array$set(code, i_9853, ({_tag: 82, _name: "JUMP_TABLE", _val: [min_tag, new_targets_9881, new_default_9883]}));
          } else {
            _t9886 = undefined;
          }
          const _t9884 = _t9886;
          const _t9882 = _t9884;
          const _t9876 = _t9882;
          _t9859 = _t9876;
          break _t9860;
        }
        if (true) {
          _t9859 = undefined;
          break _t9860;
        }
        _match_fail("line 16190");
      }
      _t9859;
      (i_9853 = (i_9853 + 1), undefined);
      if (_t9856) break;
    }
    _t9855 = _t9856 ? _t9857 : undefined;
    const _t9854 = _t9855;
    const _t9845 = _t9854;
    const _t9843 = _t9845;
    const _t9841 = _t9843;
    const _t9839 = _t9841;
    _t9823 = _t9839;
  }
  const _t9822 = _t9823;
  return _t9822;
}
function Optimize$optimize_code(_constants, code, line_table) {
  const len_9887 = Array$length(code);
  let _t9889;
  if ((len_9887 === 0)) {
    _t9889 = [code, line_table];
  } else {
    const targets_9890 = Optimize$collect_jump_targets(code);
    const actions_9892 = Array$make(len_9887, ({_tag: 0, _name: "Keep"}));
    Optimize$mark_dead_after_tail_call(code, targets_9890, actions_9892);
    Optimize$mark_jump_to_next(code, actions_9892);
    Optimize$mark_dead_stores(code, targets_9890, actions_9892);
    Optimize$mark_set_get_pairs(code, targets_9890, actions_9892);
    Optimize$mark_jump_tables(code, targets_9890, actions_9892);
    Optimize$mark_push_pop(code, targets_9890, actions_9892);
    Optimize$mark_superinstructions(code, targets_9890, actions_9892);
    const any_changes_9894 = Ref$create(false);
    function _t9896(a) {
      let _t9897;
      if (!_eq(a, ({_tag: 0, _name: "Keep"}))) {
        _t9897 = Ref$set(any_changes_9894, true);
      } else {
        _t9897 = undefined;
      }
      return _t9897;
    }
    Array$iter(_t9896, actions_9892);
    let _t9898;
    if ((!Ref$get(any_changes_9894))) {
      _t9898 = [code, line_table];
    } else {
      let _t9900;
      const _t9899 = Optimize$rewrite(code, line_table, actions_9892);
      _t9901: {
        if (true) {
          const new_code = _t9899[0];
          const new_lines = _t9899[1];
          const offset_map = _t9899[2];
          Optimize$fixup_jumps(new_code, offset_map);
          _t9900 = [new_code, new_lines];
          break _t9901;
        }
        _match_fail("line 16190");
      }
      _t9898 = _t9900;
    }
    let _t9903;
    const _t9902 = _t9898;
    _t9904: {
      if (true) {
        const final_code = _t9902[0];
        const final_lines = _t9902[1];
        Optimize$thread_jumps(final_code);
        _t9903 = [final_code, final_lines];
        break _t9904;
      }
      _match_fail("line 16190");
    }
    const _t9895 = _t9903;
    const _t9893 = _t9895;
    const _t9891 = _t9893;
    _t9889 = _t9891;
  }
  const _t9888 = _t9889;
  return _t9888;
}
function Optimize$optimize_proto(proto) {
  function _t9905(v) {
    let _t9907;
    const _t9906 = v;
    _t9908: {
      if (_t9906._tag === 13) {
        const p = _t9906._val;
        _t9907 = ({_tag: 13, _name: "VProto", _val: Optimize$optimize_proto(p)});
        break _t9908;
      }
      if (true) {
        const other = _t9906;
        _t9907 = other;
        break _t9908;
      }
      _match_fail("line 16190");
    }
    return _t9907;
  }
  const new_constants_9909 = Array$map(_t9905, proto.constants);
  let _t9912;
  const _t9911 = Optimize$optimize_code(new_constants_9909, proto.code, proto.line_table);
  _t9913: {
    if (true) {
      const new_code = _t9911[0];
      const new_lines = _t9911[1];
      const __rec_upd_9914 = proto;
      const _t9915 = ({arity: __rec_upd_9914.arity, code: new_code, constants: new_constants_9909, line_table: new_lines, name: __rec_upd_9914.name, num_locals: __rec_upd_9914.num_locals});
      _t9912 = _t9915;
      break _t9913;
    }
    _match_fail("line 16190");
  }
  const _t9910 = _t9912;
  return _t9910;
}
const Compiler$optimize_enabled = Ref$create(true);
function Compiler$error(msg) {
  return _trampoline(function() {
    return _h["compile_error"](msg, function(_t9916) {
      return _bounce(function() {
        return _t9916;
      });
    });
  }, Compiler$error);
}
function Compiler$create_state(enclosing, arity, global_names, mutable_globals, type_env, name) {
  return ({arity: arity, code: Dynarray$empty(undefined), constants: Dynarray$empty(undefined), current_line: 0, enclosing: enclosing, global_names: global_names, lines: Dynarray$empty(undefined), locals: null, loop_start: ({_tag: 0, _name: "None"}), max_locals: 0, mutable_globals: mutable_globals, mutable_locals: null, num_locals: 0, operand_depth: 0, proto_name: name, scope_depth: 0, type_env: type_env, upvalues: null});
}
function Compiler$emit(__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, op) {
  Dynarray$push(s.code, op);
  return Dynarray$push(s.lines, s.current_line);
}
function Compiler$emit_idx(__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, op) {
  const idx_9917 = Dynarray$length(s.code);
  Dynarray$push(s.code, op);
  Dynarray$push(s.lines, s.current_line);
  const _t9918 = idx_9917;
  return _t9918;
}
function Compiler$patch(__ev_code_r0, s, idx, op) {
  return Dynarray$set(s.code, idx, op);
}
function Compiler$current_offset(__ev_code_r0, s) {
  return Dynarray$length(s.code);
}
function Compiler$add_constant(__ev_constants_r0, s, v) {
  const len_9919 = Dynarray$length(s.constants);
  function find(i) {
    while (true) {
      let _t9921;
      if ((i >= len_9919)) {
        Dynarray$push(s.constants, v);
        _t9921 = len_9919;
      } else {
        let _t9922;
        if (_eq(Dynarray$get(s.constants, i), v)) {
          _t9922 = i;
        } else {
          const _t9923 = (i + 1);
          i = _t9923;
          continue;
          _t9922 = undefined;
        }
        _t9921 = _t9922;
      }
      return _t9921;
    }
  }
  const _t9924 = find(0);
  const _t9920 = _t9924;
  return _t9920;
}
function Compiler$emit_constant(__ev_code_r0, __ev_constants_r0, __ev_current_line_r0, __ev_lines_r0, s, v) {
  const idx_9925 = _call(Compiler$add_constant, [__ev_constants_r0, s, v]);
  const _t9926 = _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 0, _name: "CONST", _val: idx_9925})]);
  return _t9926;
}
function Compiler$allocate_local(__ev_locals_r0, __ev_max_locals_r0, __ev_num_locals_r0, __ev_scope_depth_r0, s, name) {
  const slot_9927 = s.num_locals;
  (s.locals = ({_hd: ({depth: s.scope_depth, name: name, slot: slot_9927}), _tl: s.locals}), undefined);
  (s.num_locals = (s.num_locals + 1), undefined);
  let _t9929;
  if ((s.num_locals > s.max_locals)) {
    _t9929 = (s.max_locals = s.num_locals, undefined);
  } else {
    _t9929 = undefined;
  }
  _t9929;
  const _t9928 = slot_9927;
  return _t9928;
}
function Compiler$free_local(s) {
  let _t9931;
  const _t9930 = s.locals;
  _t9932: {
    if (_t9930 === null) {
      _t9931 = Compiler$error("no locals to free");
      break _t9932;
    }
    if (_t9930 !== null) {
      const rest = _t9930._tl;
      (s.locals = rest, undefined);
      _t9931 = (s.num_locals = (s.num_locals - 1), undefined);
      break _t9932;
    }
    _match_fail("line 16190");
  }
  return _t9931;
}
function Compiler$find_local(s, name) {
  function search(__ev_name_r0, __ev_slot_r0, __x) {
    while (true) {
      let _t9934;
      const _t9933 = __x;
      _t9935: {
        if (_t9933 === null) {
          _t9934 = ({_tag: 0, _name: "None"});
          break _t9935;
        }
        if (_t9933 !== null) {
          const local = _t9933._hd;
          if ((local.name === name)) {
            _t9934 = ({_tag: 1, _name: "Some", _val: local.slot});
            break _t9935;
          }
        }
        if (_t9933 !== null) {
          const rest = _t9933._tl;
          const _t9936 = __ev_name_r0;
          const _t9937 = __ev_slot_r0;
          const _t9938 = rest;
          __ev_name_r0 = _t9936;
          __ev_slot_r0 = _t9937;
          __x = _t9938;
          continue;
          _t9934 = undefined;
          break _t9935;
        }
        _match_fail("line 16190");
      }
      return _t9934;
    }
  }
  const _t9939 = _call(search, [1, 2, s.locals]);
  return _t9939;
}
function Compiler$remove_first_occurrence(name, __x) {
  let _t9941;
  const _t9940 = __x;
  _t9942: {
    if (_t9940 === null) {
      _t9941 = null;
      break _t9942;
    }
    if (_t9940 !== null) {
      const x = _t9940._hd;
      const rest = _t9940._tl;
      if (_eq(x, name)) {
        _t9941 = rest;
        break _t9942;
      }
    }
    if (_t9940 !== null) {
      const x = _t9940._hd;
      const rest = _t9940._tl;
      _t9941 = ({_hd: x, _tl: Compiler$remove_first_occurrence(name, rest)});
      break _t9942;
    }
    _match_fail("line 16190");
  }
  return _t9941;
}
function Compiler$is_mutable_local(s, name) {
  while (true) {
    let _t9943;
    if (List$mem(name, s.mutable_locals)) {
      _t9943 = true;
    } else {
      let _t9945;
      const _t9944 = s.enclosing;
      _t9946: {
        if (_t9944._tag === 1) {
          const enc = _t9944._val;
          const _t9947 = enc;
          const _t9948 = name;
          s = _t9947;
          name = _t9948;
          continue;
          _t9945 = undefined;
          break _t9946;
        }
        if (_t9944._tag === 0) {
          _t9945 = false;
          break _t9946;
        }
        _match_fail("line 16190");
      }
      _t9943 = _t9945;
    }
    return _t9943;
  }
}
function Compiler$is_mutable_global(s, name) {
  return _call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
}
function Compiler$add_upvalue(__ev_upvalues_r0, s, capture, name) {
  function find(i, __x) {
    while (true) {
      let _t9950;
      const _t9949 = __x;
      _t9951: {
        if (_t9949 === null) {
          (s.upvalues = List$concat(s.upvalues, ({_hd: ({capture: capture, uv_name: name}), _tl: null})), undefined);
          _t9950 = (List$length(s.upvalues) - 1);
          break _t9951;
        }
        if (_t9949 !== null) {
          const uv = _t9949._hd;
          if (((uv.uv_name === name) && _eq(uv.capture, capture))) {
            _t9950 = i;
            break _t9951;
          }
        }
        if (_t9949 !== null) {
          const rest = _t9949._tl;
          const _t9952 = (i + 1);
          const _t9953 = rest;
          i = _t9952;
          __x = _t9953;
          continue;
          _t9950 = undefined;
          break _t9951;
        }
        _match_fail("line 16190");
      }
      return _t9950;
    }
  }
  const _t9954 = find(0, s.upvalues);
  return _t9954;
}
function Compiler$resolve_upvalue(s, name) {
  let _t9956;
  const _t9955 = s.enclosing;
  _t9957: {
    if (_t9955._tag === 0) {
      _t9956 = ({_tag: 0, _name: "None"});
      break _t9957;
    }
    if (_t9955._tag === 1) {
      const enc = _t9955._val;
      let _t9959;
      const _t9958 = Compiler$find_local(enc, name);
      _t9960: {
        if (_t9958._tag === 1) {
          const slot = _t9958._val;
          const idx_9961 = _call(Compiler$add_upvalue, [17, s, ({_tag: 0, _name: "CaptureLocal", _val: slot}), name]);
          const _t9962 = ({_tag: 1, _name: "Some", _val: idx_9961});
          _t9959 = _t9962;
          break _t9960;
        }
        if (_t9958._tag === 0) {
          let _t9964;
          const _t9963 = Compiler$resolve_upvalue(enc, name);
          _t9965: {
            if (_t9963._tag === 1) {
              const enc_uv_idx = _t9963._val;
              const idx_9966 = _call(Compiler$add_upvalue, [17, s, ({_tag: 1, _name: "CaptureUpvalue", _val: enc_uv_idx}), name]);
              const _t9967 = ({_tag: 1, _name: "Some", _val: idx_9966});
              _t9964 = _t9967;
              break _t9965;
            }
            if (_t9963._tag === 0) {
              _t9964 = ({_tag: 0, _name: "None"});
              break _t9965;
            }
            _match_fail("line 16190");
          }
          _t9959 = _t9964;
          break _t9960;
        }
        _match_fail("line 16190");
      }
      _t9956 = _t9959;
      break _t9957;
    }
    _match_fail("line 16190");
  }
  return _t9956;
}
function Compiler$find_global(__ev_global_names_r0, s, name) {
  const len_9968 = Dynarray$length(s.global_names);
  function find(i) {
    while (true) {
      let _t9970;
      if ((i >= len_9968)) {
        _t9970 = ({_tag: 0, _name: "None"});
      } else {
        let _t9971;
        if (_eq(Dynarray$get(s.global_names, i), name)) {
          _t9971 = ({_tag: 1, _name: "Some", _val: i});
        } else {
          const _t9972 = (i + 1);
          i = _t9972;
          continue;
          _t9971 = undefined;
        }
        _t9970 = _t9971;
      }
      return _t9970;
    }
  }
  const _t9973 = find(0);
  const _t9969 = _t9973;
  return _t9969;
}
function Compiler$find_or_add_global(__ev_global_names_r0, s, name) {
  let _t9975;
  const _t9974 = _call(Compiler$find_global, [__ev_global_names_r0, s, name]);
  _t9976: {
    if (_t9974._tag === 1) {
      const i = _t9974._val;
      _t9975 = i;
      break _t9976;
    }
    if (_t9974._tag === 0) {
      const len_9977 = Dynarray$length(s.global_names);
      Dynarray$push(s.global_names, name);
      const _t9978 = len_9977;
      _t9975 = _t9978;
      break _t9976;
    }
    _match_fail("line 16190");
  }
  return _t9975;
}
function Compiler$tag_for_constructor(type_env, name) {
  let _t9980;
  const _t9979 = List$assoc_opt(name, type_env.constructors);
  _t9981: {
    if (_t9979._tag === 0) {
      _t9980 = Compiler$error(("unknown constructor: " + __dict_Show_string.show(name)));
      break _t9981;
    }
    if (_t9979._tag === 1) {
      const info = _t9979._val;
      function _t9982(__p328) {
        let _t9984;
        const _t9983 = __p328;
        _t9985: {
          if (true) {
            const n = _t9983[0];
            _t9984 = (n === info.ctor_type_name);
            break _t9985;
          }
          _match_fail("line 16190");
        }
        return _t9984;
      }
      let _t9987;
      const _t9986 = list_find(_t9982, type_env.variants);
      _t9988: {
        if (true) {
          const variant_def = _t9986[2];
          let _t9990;
          const _t9989 = String$rindex_opt(name, 46);
          _t9991: {
            if (_t9989._tag === 1) {
              const i = _t9989._val;
              _t9990 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
              break _t9991;
            }
            if (_t9989._tag === 0) {
              _t9990 = name;
              break _t9991;
            }
            _match_fail("line 16190");
          }
          const short_name_9992 = _t9990;
          function find_tag(i, __x) {
            while (true) {
              let _t9995;
              const _t9994 = __x;
              _t9996: {
                if (_t9994 === null) {
                  _t9995 = Compiler$error((("constructor " + __dict_Show_string.show(name)) + " not found in type"));
                  break _t9996;
                }
                if (_t9994 !== null) {
                  const cname = _t9994._hd[0];
                  if ((cname === short_name_9992)) {
                    _t9995 = i;
                    break _t9996;
                  }
                }
                if (_t9994 !== null) {
                  const rest = _t9994._tl;
                  const _t9997 = (i + 1);
                  const _t9998 = rest;
                  i = _t9997;
                  __x = _t9998;
                  continue;
                  _t9995 = undefined;
                  break _t9996;
                }
                _match_fail("line 16190");
              }
              return _t9995;
            }
          }
          const _t9999 = find_tag(0, variant_def);
          const _t9993 = _t9999;
          _t9987 = _t9993;
          break _t9988;
        }
        _match_fail("line 16190");
      }
      _t9980 = _t9987;
      break _t9981;
    }
    _match_fail("line 16190");
  }
  return _t9980;
}
function Compiler$extract_class_ty_args(num_params, schema_ty, resolved_ty) {
  const found_10000 = Hashtbl$create(num_params);
  function go(schema_ty, resolved_ty) {
    while (true) {
      const resolved_ty_10002 = Types$repr(resolved_ty);
      let _t10005;
      const _t10004 = [schema_ty, resolved_ty_10002];
      _t10006: {
        if (_t10004[0]._tag === 17) {
          const i = _t10004[0]._val;
          const ty = _t10004[1];
          if ((i < num_params)) {
            let _t10007;
            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, found_10000, i]))) {
              _t10007 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_10000, i, ty]);
            } else {
              _t10007 = undefined;
            }
            _t10005 = _t10007;
            break _t10006;
          }
        }
        if ((_t10004[0]._tag === 7 && _t10004[1]._tag === 7 || _t10004[0]._tag === 8 && _t10004[1]._tag === 8)) {
          const s_a = _t10004[0]._val[0];
          const s_r = _t10004[0]._val[2];
          const r_a = _t10004[1]._val[0];
          const r_r = _t10004[1]._val[2];
          go(s_a, r_a);
          const _t10008 = s_r;
          const _t10009 = r_r;
          schema_ty = _t10008;
          resolved_ty = _t10009;
          continue;
          _t10005 = undefined;
          break _t10006;
        }
        if (_t10004[0]._tag === 9 && _t10004[1]._tag === 9) {
          const ss = _t10004[0]._val;
          const rs = _t10004[1]._val;
          if ((List$length(ss) === List$length(rs))) {
            _t10005 = List$iter2(go, ss, rs);
            break _t10006;
          }
        }
        if (_t10004[0]._tag === 10 && _t10004[1]._tag === 10) {
          const s = _t10004[0]._val;
          const r = _t10004[1]._val;
          const _t10010 = s;
          const _t10011 = r;
          schema_ty = _t10010;
          resolved_ty = _t10011;
          continue;
          _t10005 = undefined;
          break _t10006;
        }
        if (true) {
          _t10005 = undefined;
          break _t10006;
        }
        _match_fail("line 16190");
      }
      const _t10003 = _t10005;
      return _t10003;
    }
  }
  go(schema_ty, resolved_ty);
  function _t10013(i) {
    return _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_10000, i]);
  }
  const _t10012 = List$init(num_params, _t10013);
  const _t10001 = _t10012;
  return _t10001;
}
function Compiler$emit_builtin_call1(__ev_code_r0, __ev_current_line_r0, __ev_global_names_r0, __ev_lines_r0, s, name) {
  const gidx_10014 = _call(Compiler$find_or_add_global, [__ev_global_names_r0, s, name]);
  _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10014})]);
  const _t10015 = _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 42, _name: "CALL", _val: 1})]);
  return _t10015;
}
function Compiler$emit_builtin_call2(__ev_code_r0, __ev_current_line_r0, __ev_global_names_r0, __ev_lines_r0, s, name) {
  const gidx_10016 = _call(Compiler$find_or_add_global, [__ev_global_names_r0, s, name]);
  const _t10017 = _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10016})]);
  return _t10017;
}
function Compiler$compile_expr(tail, s, te) {
  let _t10018;
  if ((te.loc.line > 0)) {
    _t10018 = (s.current_line = te.loc.line, undefined);
  } else {
    _t10018 = undefined;
  }
  _t10018;
  let _t10020;
  const _t10019 = te.expr;
  _t10021: {
    if (_t10019._tag === 0) {
      const n = _t10019._val;
      _t10020 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: n})]);
      break _t10021;
    }
    if (_t10019._tag === 1) {
      const f = _t10019._val;
      _t10020 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 1, _name: "VFloat", _val: f})]);
      break _t10021;
    }
    if (_t10019._tag === 2) {
      const b = _t10019._val;
      _t10020 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 2, _name: "VBool", _val: b})]);
      break _t10021;
    }
    if (_t10019._tag === 3) {
      const str = _t10019._val;
      _t10020 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: str})]);
      break _t10021;
    }
    if (_t10019._tag === 4) {
      const n = _t10019._val;
      _t10020 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 4, _name: "VByte", _val: n})]);
      break _t10021;
    }
    if (_t10019._tag === 5) {
      const n = _t10019._val;
      _t10020 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 5, _name: "VRune", _val: n})]);
      break _t10021;
    }
    if (_t10019._tag === 6) {
      _t10020 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
      break _t10021;
    }
    if (_t10019._tag === 22) {
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 57, _name: "NIL"})]);
      break _t10021;
    }
    if (_t10019._tag === 7) {
      const name = _t10019._val;
      let _t10022;
      if ((_eq(Compiler$find_local(s, name), ({_tag: 0, _name: "None"})) && (_eq(Compiler$resolve_upvalue(s, name), ({_tag: 0, _name: "None"})) && _eq(_call(Compiler$find_global, [5, s, name]), ({_tag: 0, _name: "None"}))))) {
        let _t10024;
        const _t10023 = Types$find_method_class(s.type_env.classes, name);
        _t10025: {
          if (_t10023._tag === 1) {
            const result = _t10023;
            _t10024 = [result, name];
            break _t10025;
          }
          if (_t10023._tag === 0) {
            let _t10027;
            const _t10026 = String$rindex_opt(name, 46);
            _t10028: {
              if (_t10026._tag === 0) {
                _t10027 = [({_tag: 0, _name: "None"}), name];
                break _t10028;
              }
              if (_t10026._tag === 1) {
                const i = _t10026._val;
                const mod_prefix_10029 = String$sub(name, 0, (i + 1));
                const _mml$short_10031 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                const class_prefix_10033 = String$sub(name, 0, i);
                let _t10036;
                const _t10035 = Types$find_method_class(s.type_env.classes, _mml$short_10031);
                _t10037: {
                  if (_t10035._tag === 1) {
                    const class_def = _t10035._val;
                    if ((class_def.class_name === class_prefix_10033)) {
                      _t10036 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_10031];
                      break _t10037;
                    }
                  }
                  if (_t10035._tag === 1) {
                    const class_def = _t10035._val;
                    if (((String$length(class_def.class_name) > String$length(mod_prefix_10029)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_10029)) === mod_prefix_10029))) {
                      _t10036 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_10031];
                      break _t10037;
                    }
                  }
                  if (true) {
                    _t10036 = [({_tag: 0, _name: "None"}), name];
                    break _t10037;
                  }
                  _match_fail("line 16190");
                }
                const _t10034 = _t10036;
                const _t10032 = _t10034;
                const _t10030 = _t10032;
                _t10027 = _t10030;
                break _t10028;
              }
              _match_fail("line 16190");
            }
            _t10024 = _t10027;
            break _t10025;
          }
          _match_fail("line 16190");
        }
        let _t10039;
        const _t10038 = _t10024;
        _t10040: {
          if (true) {
            const class_opt = _t10038[0];
            const method_name = _t10038[1];
            let _t10042;
            const _t10041 = class_opt;
            _t10043: {
              if (_t10041._tag === 1) {
                const class_def = _t10041._val;
                const method_schema_ty_10044 = List$assoc(method_name, class_def.class_methods);
                const num_params_10046 = List$length(class_def.class_params);
                const partial_10048 = Compiler$extract_class_ty_args(num_params_10046, method_schema_ty_10044, te.ty);
                function _t10050(opt) {
                  let _t10052;
                  const _t10051 = opt;
                  _t10053: {
                    if (_t10051._tag === 1) {
                      const ty = _t10051._val;
                      let _t10055;
                      const _t10054 = Types$repr(ty);
                      _t10056: {
                        if (_t10054._tag === 16 && _t10054._val.contents._tag === 0) {
                          _t10055 = ({_tag: 0, _name: "None"});
                          break _t10056;
                        }
                        if (true) {
                          _t10055 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
                          break _t10056;
                        }
                        _match_fail("line 16190");
                      }
                      _t10052 = _t10055;
                      break _t10053;
                    }
                    if (_t10051._tag === 0) {
                      _t10052 = ({_tag: 0, _name: "None"});
                      break _t10053;
                    }
                    _match_fail("line 16190");
                  }
                  return _t10052;
                }
                const concrete_partial_10057 = List$map(_t10050, partial_10048);
                let _t10059;
                if (!_eq(class_def.class_fundeps, null)) {
                  _t10059 = Types$improve_with_fundeps(s.type_env.instances, class_def, concrete_partial_10057);
                } else {
                  _t10059 = concrete_partial_10057;
                }
                const concrete_partial_10060 = _t10059;
                function _t10062(inst) {
                  return ((inst.inst_class === class_def.class_name) && ((List$length(inst.inst_tys) === num_params_10046) && Types$match_partial_inst(inst.inst_tys, concrete_partial_10060)));
                }
                const matching_10063 = List$filter(_t10062, s.type_env.instances);
                let _t10066;
                const _t10065 = matching_10063;
                _t10067: {
                  if (_t10065 !== null && _t10065._tl === null) {
                    const inst = _t10065._hd;
                    let _t10068;
                    if (_eq(inst.inst_constraints, null)) {
                      const method_gidx_10069 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
                      const _t10070 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10069})]);
                      _t10068 = _t10070;
                    } else {
                      const dict_gidx_10071 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
                      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10071})]);
                      const _t10072 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
                      _t10068 = _t10072;
                    }
                    _t10066 = _t10068;
                    break _t10067;
                  }
                  if (_t10065 === null) {
                    function _t10073(__x) {
                      let _t10075;
                      const _t10074 = __x;
                      _t10076: {
                        if (_t10074._tag === 1) {
                          const ty = _t10074._val;
                          let _t10078;
                          const _t10077 = Types$repr(ty);
                          _t10079: {
                            if ((_t10077._tag === 15 || _t10077._tag === 11)) {
                              _t10078 = true;
                              break _t10079;
                            }
                            if (true) {
                              _t10078 = false;
                              break _t10079;
                            }
                            _match_fail("line 16190");
                          }
                          _t10075 = _t10078;
                          break _t10076;
                        }
                        if (_t10074._tag === 0) {
                          _t10075 = false;
                          break _t10076;
                        }
                        _match_fail("line 16190");
                      }
                      return _t10075;
                    }
                    const is_structural_10080 = List$exists(_t10073, partial_10048);
                    let _t10082;
                    if ((is_structural_10080 && ((class_def.class_name === "Show") && (method_name === "show")))) {
                      const gidx_10083 = _call(Compiler$find_or_add_global, [5, s, "__show_value"]);
                      const _t10084 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10083})]);
                      _t10082 = _t10084;
                    } else {
                      function _t10085(__x) {
                        let _t10087;
                        const _t10086 = __x;
                        _t10088: {
                          if (_t10086._tag === 1) {
                            const ty = _t10086._val;
                            _t10087 = Types$pp_ty(ty);
                            break _t10088;
                          }
                          if (_t10086._tag === 0) {
                            _t10087 = "_";
                            break _t10088;
                          }
                          _match_fail("line 16190");
                        }
                        return _t10087;
                      }
                      const ty_strs_10089 = List$map(_t10085, partial_10048);
                      const _t10090 = Compiler$error(((("no instance of " + __dict_Show_string.show(class_def.class_name)) + " for types ") + __dict_Show_string.show(String$concat(", ", ty_strs_10089))));
                      _t10082 = _t10090;
                    }
                    const _t10081 = _t10082;
                    _t10066 = _t10081;
                    break _t10067;
                  }
                  if (true) {
                    let _t10092;
                    const _t10091 = Types$most_specific_inst(matching_10063);
                    _t10093: {
                      if (_t10091._tag === 1) {
                        const inst = _t10091._val;
                        let _t10094;
                        if (_eq(inst.inst_constraints, null)) {
                          const method_gidx_10095 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
                          const _t10096 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10095})]);
                          _t10094 = _t10096;
                        } else {
                          const dict_gidx_10097 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
                          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10097})]);
                          const _t10098 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
                          _t10094 = _t10098;
                        }
                        _t10092 = _t10094;
                        break _t10093;
                      }
                      if (_t10091._tag === 0) {
                        _t10092 = Compiler$error(((("ambiguous instance for " + __dict_Show_string.show(class_def.class_name)) + " method ") + __dict_Show_string.show(method_name)));
                        break _t10093;
                      }
                      _match_fail("line 16190");
                    }
                    _t10066 = _t10092;
                    break _t10067;
                  }
                  _match_fail("line 16190");
                }
                const _t10064 = _t10066;
                const _t10061 = _t10064;
                const _t10058 = _t10061;
                const _t10049 = _t10058;
                const _t10047 = _t10049;
                const _t10045 = _t10047;
                _t10042 = _t10045;
                break _t10043;
              }
              if (_t10041._tag === 0) {
                _t10042 = Compiler$compile_var_access(s, name);
                break _t10043;
              }
              _match_fail("line 16190");
            }
            _t10039 = _t10042;
            break _t10040;
          }
          _match_fail("line 16190");
        }
        _t10022 = _t10039;
      } else {
        _t10022 = Compiler$compile_var_access(s, name);
      }
      _t10020 = _t10022;
      break _t10021;
    }
    if (_t10019._tag === 13) {
      const op = _t10019._val[0];
      const e1 = _t10019._val[1];
      const e2 = _t10019._val[2];
      _t10020 = Compiler$compile_binop(s, op, e1, e2);
      break _t10021;
    }
    if (_t10019._tag === 14) {
      const op = _t10019._val[0];
      const e = _t10019._val[1];
      _t10020 = Compiler$compile_unop(s, op, e);
      break _t10021;
    }
    if (_t10019._tag === 11) {
      const fn_ = _t10019._val[0];
      const arg = _t10019._val[1];
      function collect_args(expr, acc) {
        while (true) {
          let _t10100;
          const _t10099 = expr.expr;
          _t10101: {
            if (_t10099._tag === 11) {
              const inner_fn = _t10099._val[0];
              const inner_arg = _t10099._val[1];
              const _t10102 = inner_fn;
              const _t10103 = ({_hd: inner_arg, _tl: acc});
              expr = _t10102;
              acc = _t10103;
              continue;
              _t10100 = undefined;
              break _t10101;
            }
            if (true) {
              _t10100 = [expr, acc];
              break _t10101;
            }
            _match_fail("line 16190");
          }
          return _t10100;
        }
      }
      let _t10106;
      const _t10105 = collect_args(fn_, ({_hd: arg, _tl: null}));
      _t10107: {
        if (true) {
          const base_fn = _t10105[0];
          const all_args = _t10105[1];
          const n_10108 = List$length(all_args);
          Compiler$compile_expr(false, s, base_fn);
          function _t10110(a) {
            return Compiler$compile_expr(false, s, a);
          }
          List$iter(_t10110, all_args);
          let _t10111;
          if ((n_10108 > 1)) {
            let _t10112;
            if (tail) {
              _t10112 = ({_tag: 84, _name: "TAIL_CALL_N", _val: n_10108});
            } else {
              _t10112 = ({_tag: 83, _name: "CALL_N", _val: n_10108});
            }
            _t10111 = _call(Compiler$emit, [1, 3, 6, s, _t10112]);
          } else {
            let _t10113;
            if (tail) {
              _t10113 = ({_tag: 43, _name: "TAIL_CALL", _val: 1});
            } else {
              _t10113 = ({_tag: 42, _name: "CALL", _val: 1});
            }
            _t10111 = _call(Compiler$emit, [1, 3, 6, s, _t10113]);
          }
          const _t10109 = _t10111;
          _t10106 = _t10109;
          break _t10107;
        }
        _match_fail("line 16190");
      }
      const _t10104 = _t10106;
      _t10020 = _t10104;
      break _t10021;
    }
    if (_t10019._tag === 10) {
      const param = _t10019._val[0];
      const body = _t10019._val[1];
      const has_return = _t10019._val[2];
      _t10020 = Compiler$compile_function(has_return, s, param, body, te.ty);
      break _t10021;
    }
    if (_t10019._tag === 8) {
      const name = _t10019._val[0];
      const _scheme = _t10019._val[1];
      const e1 = _t10019._val[2];
      const e2 = _t10019._val[3];
      Compiler$compile_expr(false, s, e1);
      const was_mutable_10114 = List$mem(name, s.mutable_locals);
      let _t10116;
      if (was_mutable_10114) {
        function _t10117(n) {
          return (n !== name);
        }
        _t10116 = (s.mutable_locals = List$filter(_t10117, s.mutable_locals), undefined);
      } else {
        _t10116 = undefined;
      }
      _t10116;
      const slot_10118 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10118})]);
      Compiler$compile_expr(tail, s, e2);
      let _t10120;
      if (was_mutable_10114) {
        _t10120 = (s.mutable_locals = ({_hd: name, _tl: s.mutable_locals}), undefined);
      } else {
        _t10120 = undefined;
      }
      _t10120;
      const _t10119 = Compiler$free_local(s);
      const _t10115 = _t10119;
      _t10020 = _t10115;
      break _t10021;
    }
    if (_t10019._tag === 25) {
      const name = _t10019._val[0];
      const e1 = _t10019._val[1];
      const e2 = _t10019._val[2];
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 7, _name: "MAKE_REF"})]);
      const slot_10121 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
      (s.mutable_locals = ({_hd: name, _tl: s.mutable_locals}), undefined);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10121})]);
      Compiler$compile_expr(tail, s, e2);
      (s.mutable_locals = Compiler$remove_first_occurrence(name, s.mutable_locals), undefined);
      const _t10122 = Compiler$free_local(s);
      _t10020 = _t10122;
      break _t10021;
    }
    if (_t10019._tag === 32) {
      const cond = _t10019._val[0];
      const body = _t10019._val[1];
      const enter_idx_10123 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 68, _name: "ENTER_LOOP", _val: 0})]);
      const prev_loop_start_10125 = s.loop_start;
      const loop_start_10127 = _call(Compiler$current_offset, [1, s]);
      (s.loop_start = ({_tag: 1, _name: "Some", _val: loop_start_10127}), undefined);
      Compiler$compile_expr(false, s, cond);
      const exit_jump_10129 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]);
      Compiler$compile_expr(false, s, body);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: loop_start_10127})]);
      const exit_normal_10131 = _call(Compiler$current_offset, [1, s]);
      _call(Compiler$patch, [1, s, exit_jump_10129, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: exit_normal_10131})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 69, _name: "EXIT_LOOP"})]);
      const unit_idx_10133 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10133})]);
      const end_jump_10135 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
      const break_target_10137 = _call(Compiler$current_offset, [1, s]);
      const end_target_10139 = _call(Compiler$current_offset, [1, s]);
      _call(Compiler$patch, [1, s, enter_idx_10123, ({_tag: 68, _name: "ENTER_LOOP", _val: break_target_10137})]);
      _call(Compiler$patch, [1, s, end_jump_10135, ({_tag: 37, _name: "JUMP", _val: end_target_10139})]);
      const _t10140 = (s.loop_start = prev_loop_start_10125, undefined);
      const _t10138 = _t10140;
      const _t10136 = _t10138;
      const _t10134 = _t10136;
      const _t10132 = _t10134;
      const _t10130 = _t10132;
      const _t10128 = _t10130;
      const _t10126 = _t10128;
      const _t10124 = _t10126;
      _t10020 = _t10124;
      break _t10021;
    }
    if (_t10019._tag === 26) {
      const name = _t10019._val[0];
      const e = _t10019._val[1];
      let _t10142;
      const _t10141 = Compiler$find_local(s, name);
      _t10143: {
        if (_t10141._tag === 1) {
          const slot = _t10141._val;
          Compiler$compile_expr(false, s, e);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
          _t10142 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
          break _t10143;
        }
        if (_t10141._tag === 0) {
          let _t10145;
          const _t10144 = Compiler$resolve_upvalue(s, name);
          _t10146: {
            if (_t10144._tag === 1) {
              const idx = _t10144._val;
              Compiler$compile_expr(false, s, e);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 5, _name: "GET_UPVALUE", _val: idx})]);
              _t10145 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
              break _t10146;
            }
            if (_t10144._tag === 0) {
              Compiler$compile_expr(false, s, e);
              const gidx_10147 = _call(Compiler$find_or_add_global, [5, s, name]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10147})]);
              const _t10148 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
              _t10145 = _t10148;
              break _t10146;
            }
            _match_fail("line 16190");
          }
          _t10142 = _t10145;
          break _t10143;
        }
        _match_fail("line 16190");
      }
      _t10142;
      _t10020 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
      break _t10021;
    }
    if (_t10019._tag === 27) {
      const record_e = _t10019._val[0];
      const field = _t10019._val[1];
      const value_e = _t10019._val[2];
      Compiler$compile_expr(false, s, record_e);
      Compiler$compile_expr(false, s, value_e);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 52, _name: "SET_FIELD", _val: field})]);
      _t10020 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
      break _t10021;
    }
    if (_t10019._tag === 9) {
      const name = _t10019._val[0];
      const _scheme = _t10019._val[1];
      const e1 = _t10019._val[2];
      const e2 = _t10019._val[3];
      Compiler$compile_let_rec(s, name, e1);
      Compiler$compile_expr(tail, s, e2);
      _t10020 = Compiler$free_local(s);
      break _t10021;
    }
    if (_t10019._tag === 12) {
      const cond = _t10019._val[0];
      const then_e = _t10019._val[1];
      const else_e = _t10019._val[2];
      _t10020 = Compiler$compile_if(tail, s, cond, then_e, else_e);
      break _t10021;
    }
    if (_t10019._tag === 15) {
      const exprs = _t10019._val;
      List$iter(_call(Compiler$compile_expr, [false, s]), exprs);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 48, _name: "MAKE_TUPLE", _val: List$length(exprs)})]);
      break _t10021;
    }
    if (_t10019._tag === 16) {
      const fields = _t10019._val;
      function _t10149(__p329, __p330) {
        let _t10151;
        const _t10150 = __p329;
        _t10152: {
          if (true) {
            const a = _t10150[0];
            let _t10154;
            const _t10153 = __p330;
            _t10155: {
              if (true) {
                const b = _t10153[0];
                _t10154 = String$compare(a, b);
                break _t10155;
              }
              _match_fail("line 16190");
            }
            _t10151 = _t10154;
            break _t10152;
          }
          _match_fail("line 16190");
        }
        return _t10151;
      }
      const sorted_10156 = List$sort(_t10149, fields);
      const names_10158 = List$map(fst, sorted_10156);
      function _t10160(__p331) {
        let _t10162;
        const _t10161 = __p331;
        _t10163: {
          if (true) {
            const e = _t10161[1];
            _t10162 = Compiler$compile_expr(false, s, e);
            break _t10163;
          }
          _match_fail("line 16190");
        }
        return _t10162;
      }
      List$iter(_t10160, sorted_10156);
      const _t10159 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 50, _name: "MAKE_RECORD", _val: names_10158})]);
      const _t10157 = _t10159;
      _t10020 = _t10157;
      break _t10021;
    }
    if (_t10019._tag === 17) {
      const base = _t10019._val[0];
      const overrides = _t10019._val[1];
      Compiler$compile_expr(false, s, base);
      function _t10164(__p332) {
        let _t10166;
        const _t10165 = __p332;
        _t10167: {
          if (true) {
            const e = _t10165[1];
            _t10166 = Compiler$compile_expr(false, s, e);
            break _t10167;
          }
          _match_fail("line 16190");
        }
        return _t10166;
      }
      List$iter(_t10164, overrides);
      const field_names_10168 = List$map(fst, overrides);
      const _t10169 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 53, _name: "RECORD_UPDATE", _val: field_names_10168})]);
      _t10020 = _t10169;
      break _t10021;
    }
    if (_t10019._tag === 18) {
      const base = _t10019._val[0];
      const pairs = _t10019._val[1];
      Compiler$compile_expr(false, s, base);
      function _t10170(__p333) {
        let _t10172;
        const _t10171 = __p333;
        _t10173: {
          if (true) {
            const idx_e = _t10171[0];
            const val_e = _t10171[1];
            Compiler$compile_expr(false, s, idx_e);
            _t10172 = Compiler$compile_expr(false, s, val_e);
            break _t10173;
          }
          _match_fail("line 16190");
        }
        return _t10172;
      }
      List$iter(_t10170, pairs);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 54, _name: "RECORD_UPDATE_DYN", _val: List$length(pairs)})]);
      break _t10021;
    }
    if (_t10019._tag === 19) {
      const e = _t10019._val[0];
      const field = _t10019._val[1];
      Compiler$compile_expr(false, s, e);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: field})]);
      break _t10021;
    }
    if (_t10019._tag === 20) {
      const base = _t10019._val[0];
      const idx = _t10019._val[1];
      Compiler$compile_expr(false, s, base);
      Compiler$compile_expr(false, s, idx);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 75, _name: "INDEX"})]);
      break _t10021;
    }
    if (_t10019._tag === 21) {
      const hd = _t10019._val[0];
      const tl = _t10019._val[1];
      Compiler$compile_expr(false, s, hd);
      Compiler$compile_expr(false, s, tl);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 56, _name: "CONS"})]);
      break _t10021;
    }
    if (_t10019._tag === 23) {
      const name = _t10019._val[0];
      const arg = _t10019._val[1];
      let _t10174;
      if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
        _t10174 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
      } else {
        _t10174 = Compiler$tag_for_constructor(s.type_env, name);
      }
      const tag_10175 = _t10174;
      let _t10178;
      const _t10177 = String$rindex_opt(name, 46);
      _t10179: {
        if (_t10177._tag === 1) {
          const i = _t10177._val;
          _t10178 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
          break _t10179;
        }
        if (_t10177._tag === 0) {
          _t10178 = name;
          break _t10179;
        }
        _match_fail("line 16190");
      }
      const short_name_10180 = _t10178;
      let _t10183;
      const _t10182 = arg;
      _t10184: {
        if (_t10182._tag === 1) {
          const e = _t10182._val;
          Compiler$compile_expr(false, s, e);
          _t10183 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_10175, short_name_10180, true]})]);
          break _t10184;
        }
        if (_t10182._tag === 0) {
          _t10183 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_10175, short_name_10180, false]})]);
          break _t10184;
        }
        _match_fail("line 16190");
      }
      const _t10181 = _t10183;
      const _t10176 = _t10181;
      _t10020 = _t10176;
      break _t10021;
    }
    if (_t10019._tag === 24) {
      const scrut = _t10019._val[0];
      const arms = _t10019._val[1];
      const _partial = _t10019._val[2];
      _t10020 = Compiler$compile_match(tail, s, scrut, arms);
      break _t10021;
    }
    if (_t10019._tag === 28) {
      const e1 = _t10019._val[0];
      const e2 = _t10019._val[1];
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      _t10020 = Compiler$compile_expr(tail, s, e2);
      break _t10021;
    }
    if (_t10019._tag === 29) {
      const op_name = _t10019._val[0];
      const arg_te = _t10019._val[1];
      Compiler$compile_expr(false, s, arg_te);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 65, _name: "PERFORM", _val: op_name})]);
      break _t10021;
    }
    if (_t10019._tag === 30) {
      const body_te = _t10019._val[0];
      const arms = _t10019._val[1];
      _t10020 = Compiler$compile_handle(s, body_te, arms);
      break _t10021;
    }
    if (_t10019._tag === 31) {
      const k_te = _t10019._val[0];
      const v_te = _t10019._val[1];
      Compiler$compile_expr(false, s, k_te);
      Compiler$compile_expr(false, s, v_te);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 67, _name: "RESUME"})]);
      break _t10021;
    }
    if (_t10019._tag === 33) {
      const value_te = _t10019._val;
      Compiler$compile_expr(false, s, value_te);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 70, _name: "LOOP_BREAK"})]);
      break _t10021;
    }
    if (_t10019._tag === 34) {
      let _t10186;
      const _t10185 = s.loop_start;
      _t10187: {
        if (_t10185._tag === 1) {
          const target = _t10185._val;
          _t10186 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 71, _name: "LOOP_CONTINUE", _val: target})]);
          break _t10187;
        }
        if (_t10185._tag === 0) {
          _t10186 = Compiler$error("continue outside of loop");
          break _t10187;
        }
        _match_fail("line 16190");
      }
      _t10020 = _t10186;
      break _t10021;
    }
    if (_t10019._tag === 35) {
      const value_te = _t10019._val;
      const depth_before_10188 = s.operand_depth;
      Compiler$compile_expr(false, s, value_te);
      const n_pops_10190 = depth_before_10188;
      const _t10191 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 72, _name: "FOLD_CONTINUE", _val: n_pops_10190})]);
      const _t10189 = _t10191;
      _t10020 = _t10189;
      break _t10021;
    }
    if (_t10019._tag === 36) {
      const fold_te = _t10019._val;
      const enter_idx_10192 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 68, _name: "ENTER_LOOP", _val: 0})]);
      const prev_loop_start_10194 = s.loop_start;
      (s.loop_start = ({_tag: 0, _name: "None"}), undefined);
      Compiler$compile_expr(false, s, fold_te);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 69, _name: "EXIT_LOOP"})]);
      const end_jump_10196 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
      const break_target_10198 = _call(Compiler$current_offset, [1, s]);
      const end_target_10200 = _call(Compiler$current_offset, [1, s]);
      _call(Compiler$patch, [1, s, enter_idx_10192, ({_tag: 68, _name: "ENTER_LOOP", _val: break_target_10198})]);
      _call(Compiler$patch, [1, s, end_jump_10196, ({_tag: 37, _name: "JUMP", _val: end_target_10200})]);
      const _t10201 = (s.loop_start = prev_loop_start_10194, undefined);
      const _t10199 = _t10201;
      const _t10197 = _t10199;
      const _t10195 = _t10197;
      const _t10193 = _t10195;
      _t10020 = _t10193;
      break _t10021;
    }
    if (_t10019._tag === 38) {
      const pairs = _t10019._val;
      function _t10202(__p334) {
        let _t10204;
        const _t10203 = __p334;
        _t10205: {
          if (true) {
            const k = _t10203[0];
            const v = _t10203[1];
            Compiler$compile_expr(false, s, k);
            _t10204 = Compiler$compile_expr(false, s, v);
            break _t10205;
          }
          _match_fail("line 16190");
        }
        return _t10204;
      }
      List$iter(_t10202, pairs);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 73, _name: "MAKE_MAP", _val: List$length(pairs)})]);
      break _t10021;
    }
    if (_t10019._tag === 39) {
      const elems = _t10019._val;
      List$iter(_call(Compiler$compile_expr, [false, s]), elems);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 74, _name: "MAKE_ARRAY", _val: List$length(elems)})]);
      break _t10021;
    }
    if (_t10019._tag === 40) {
      const value_te = _t10019._val;
      Compiler$compile_expr(false, s, value_te);
      _t10020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 45, _name: "FUNC_RETURN"})]);
      break _t10021;
    }
    if (_t10019._tag === 37) {
      const bindings = _t10019._val[0];
      const body = _t10019._val[1];
      function _t10206(__p335) {
        let _t10208;
        const _t10207 = __p335;
        _t10209: {
          if (true) {
            const name = _t10207[0];
            const unit_idx_10210 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10210})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 7, _name: "MAKE_REF"})]);
            const slot_10212 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
            (s.mutable_locals = ({_hd: name, _tl: s.mutable_locals}), undefined);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10212})]);
            const _t10213 = slot_10212;
            const _t10211 = _t10213;
            _t10208 = _t10211;
            break _t10209;
          }
          _match_fail("line 16190");
        }
        return _t10208;
      }
      const slots_10214 = List$map(_t10206, bindings);
      function _t10216(__p336, slot) {
        let _t10218;
        const _t10217 = __p336;
        _t10219: {
          if (true) {
            const _name = _t10217[0];
            const fn_te = _t10217[1];
            Compiler$compile_expr(false, s, fn_te);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
            _t10218 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
            break _t10219;
          }
          _match_fail("line 16190");
        }
        return _t10218;
      }
      List$iter2(_t10216, bindings, slots_10214);
      Compiler$compile_expr(tail, s, body);
      function _t10220(__p337) {
        let _t10222;
        const _t10221 = __p337;
        _t10223: {
          if (true) {
            const name = _t10221[0];
            function _t10224(n) {
              return (n !== name);
            }
            _t10222 = (s.mutable_locals = List$filter(_t10224, s.mutable_locals), undefined);
            break _t10223;
          }
          _match_fail("line 16190");
        }
        return _t10222;
      }
      List$iter(_t10220, bindings);
      function _t10225(_) {
        return Compiler$free_local(s);
      }
      const _t10215 = List$iter(_t10225, bindings);
      _t10020 = _t10215;
      break _t10021;
    }
    _match_fail("line 16190");
  }
  return _t10020;
}
function Compiler$compile_var_access(s, name) {
  let _t10227;
  const _t10226 = Compiler$find_local(s, name);
  _t10228: {
    if (_t10226._tag === 1) {
      const slot = _t10226._val;
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
      let _t10229;
      if (Compiler$is_mutable_local(s, name)) {
        _t10229 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 8, _name: "DEREF"})]);
      } else {
        _t10229 = undefined;
      }
      _t10227 = _t10229;
      break _t10228;
    }
    if (_t10226._tag === 0) {
      let _t10231;
      const _t10230 = Compiler$resolve_upvalue(s, name);
      _t10232: {
        if (_t10230._tag === 1) {
          const idx = _t10230._val;
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 5, _name: "GET_UPVALUE", _val: idx})]);
          let _t10233;
          if (Compiler$is_mutable_local(s, name)) {
            _t10233 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 8, _name: "DEREF"})]);
          } else {
            _t10233 = undefined;
          }
          _t10231 = _t10233;
          break _t10232;
        }
        if (_t10230._tag === 0) {
          const gidx_10234 = _call(Compiler$find_or_add_global, [5, s, name]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10234})]);
          let _t10236;
          if (Compiler$is_mutable_global(s, name)) {
            _t10236 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 8, _name: "DEREF"})]);
          } else {
            _t10236 = undefined;
          }
          const _t10235 = _t10236;
          _t10231 = _t10235;
          break _t10232;
        }
        _match_fail("line 16190");
      }
      _t10227 = _t10231;
      break _t10228;
    }
    _match_fail("line 16190");
  }
  return _t10227;
}
function Compiler$compile_binop(s, op, e1, e2) {
  let _t10238;
  const _t10237 = op;
  _t10239: {
    if (_t10237._tag === 11) {
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 2, _name: "DUP"})]);
      const jump_idx_10240 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      Compiler$compile_expr(false, s, e2);
      const target_10242 = _call(Compiler$current_offset, [1, s]);
      const _t10243 = _call(Compiler$patch, [1, s, jump_idx_10240, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: target_10242})]);
      const _t10241 = _t10243;
      _t10238 = _t10241;
      break _t10239;
    }
    if (_t10237._tag === 12) {
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 2, _name: "DUP"})]);
      const jump_idx_10244 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 39, _name: "JUMP_IF_TRUE", _val: 0})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      Compiler$compile_expr(false, s, e2);
      const target_10246 = _call(Compiler$current_offset, [1, s]);
      const _t10247 = _call(Compiler$patch, [1, s, jump_idx_10244, ({_tag: 39, _name: "JUMP_IF_TRUE", _val: target_10246})]);
      const _t10245 = _t10247;
      _t10238 = _t10245;
      break _t10239;
    }
    if ((((_t10237._tag === 0 || _t10237._tag === 1) || _t10237._tag === 2) || _t10237._tag === 3)) {
      const resolved_10248 = Types$repr(e1.ty);
      let _t10251;
      const _t10250 = resolved_10248;
      _t10252: {
        if (_t10250._tag === 0) {
          Compiler$compile_expr(false, s, e1);
          Compiler$compile_expr(false, s, e2);
          let _t10254;
          const _t10253 = op;
          _t10255: {
            if (_t10253._tag === 0) {
              _t10254 = ({_tag: 13, _name: "ADD"});
              break _t10255;
            }
            if (_t10253._tag === 1) {
              _t10254 = ({_tag: 14, _name: "SUB"});
              break _t10255;
            }
            if (_t10253._tag === 2) {
              _t10254 = ({_tag: 15, _name: "MUL"});
              break _t10255;
            }
            if (_t10253._tag === 3) {
              _t10254 = ({_tag: 16, _name: "DIV"});
              break _t10255;
            }
            if (true) {
              _t10254 = failwith("assert false");
              break _t10255;
            }
            _match_fail("line 16190");
          }
          _t10251 = _call(Compiler$emit, [1, 3, 6, s, _t10254]);
          break _t10252;
        }
        if (_t10250._tag === 1) {
          Compiler$compile_expr(false, s, e1);
          Compiler$compile_expr(false, s, e2);
          let _t10257;
          const _t10256 = op;
          _t10258: {
            if (_t10256._tag === 0) {
              _t10257 = ({_tag: 19, _name: "FADD"});
              break _t10258;
            }
            if (_t10256._tag === 1) {
              _t10257 = ({_tag: 20, _name: "FSUB"});
              break _t10258;
            }
            if (_t10256._tag === 2) {
              _t10257 = ({_tag: 21, _name: "FMUL"});
              break _t10258;
            }
            if (_t10256._tag === 3) {
              _t10257 = ({_tag: 22, _name: "FDIV"});
              break _t10258;
            }
            if (true) {
              _t10257 = failwith("assert false");
              break _t10258;
            }
            _match_fail("line 16190");
          }
          _t10251 = _call(Compiler$emit, [1, 3, 6, s, _t10257]);
          break _t10252;
        }
        if (true) {
          let _t10260;
          const _t10259 = op;
          _t10261: {
            if (_t10259._tag === 0) {
              _t10260 = "+";
              break _t10261;
            }
            if (_t10259._tag === 1) {
              _t10260 = "-";
              break _t10261;
            }
            if (_t10259._tag === 2) {
              _t10260 = "*";
              break _t10261;
            }
            if (_t10259._tag === 3) {
              _t10260 = "/";
              break _t10261;
            }
            if (true) {
              _t10260 = failwith("assert false");
              break _t10261;
            }
            _match_fail("line 16190");
          }
          const method_name_10262 = _t10260;
          const _t10263 = Compiler$compile_class_binop(s, "Num", method_name_10262, e1.ty, e1, e2);
          _t10251 = _t10263;
          break _t10252;
        }
        _match_fail("line 16190");
      }
      const _t10249 = _t10251;
      _t10238 = _t10249;
      break _t10239;
    }
    if (_t10237._tag === 4) {
      Compiler$compile_expr(false, s, e1);
      Compiler$compile_expr(false, s, e2);
      _t10238 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 17, _name: "MOD"})]);
      break _t10239;
    }
    if ((_t10237._tag === 5 || _t10237._tag === 6)) {
      const resolved_10264 = Types$repr(e1.ty);
      function _t10266(class_name, ty) {
        function _t10267(inst) {
          return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === 1) && Types$match_partial_inst(inst.inst_tys, ({_hd: ({_tag: 1, _name: "Some", _val: ty}), _tl: null}))));
        }
        return List$exists(_t10267, s.type_env.instances);
      }
      const has_custom_instance_10268 = _t10266;
      let _t10271;
      const _t10270 = resolved_10264;
      _t10272: {
        if ((((((((((((((_t10270._tag === 0 || _t10270._tag === 1) || _t10270._tag === 2) || _t10270._tag === 3) || _t10270._tag === 4) || _t10270._tag === 5) || _t10270._tag === 6) || _t10270._tag === 10) || _t10270._tag === 9) || _t10270._tag === 12) || _t10270._tag === 15) || _t10270._tag === 13) || _t10270._tag === 14) || _t10270._tag === 16 && _t10270._val.contents._tag === 0)) {
          _t10271 = true;
          break _t10272;
        }
        if (_t10270._tag === 11) {
          _t10271 = (!has_custom_instance_10268("Eq", resolved_10264));
          break _t10272;
        }
        if (true) {
          _t10271 = false;
          break _t10272;
        }
        _match_fail("line 16190");
      }
      const use_structural_10273 = _t10271;
      let _t10275;
      if (use_structural_10273) {
        Compiler$compile_expr(false, s, e1);
        Compiler$compile_expr(false, s, e2);
        let _t10276;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t10276 = ({_tag: 24, _name: "EQ"});
        } else {
          _t10276 = ({_tag: 25, _name: "NEQ"});
        }
        _t10275 = _call(Compiler$emit, [1, 3, 6, s, _t10276]);
      } else {
        let _t10277;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t10277 = "=";
        } else {
          _t10277 = "<>";
        }
        const method_name_10278 = _t10277;
        const _t10279 = Compiler$compile_class_binop(s, "Eq", method_name_10278, e1.ty, e1, e2);
        _t10275 = _t10279;
      }
      const _t10274 = _t10275;
      const _t10269 = _t10274;
      const _t10265 = _t10269;
      _t10238 = _t10265;
      break _t10239;
    }
    if ((((_t10237._tag === 7 || _t10237._tag === 8) || _t10237._tag === 9) || _t10237._tag === 10)) {
      const resolved_10280 = Types$repr(e1.ty);
      let _t10283;
      const _t10282 = resolved_10280;
      _t10284: {
        if ((((((_t10282._tag === 0 || _t10282._tag === 1) || _t10282._tag === 3) || _t10282._tag === 4) || _t10282._tag === 5) || _t10282._tag === 16 && _t10282._val.contents._tag === 0)) {
          _t10283 = true;
          break _t10284;
        }
        if (true) {
          _t10283 = false;
          break _t10284;
        }
        _match_fail("line 16190");
      }
      const is_builtin_10285 = _t10283;
      let _t10287;
      if (is_builtin_10285) {
        Compiler$compile_expr(false, s, e1);
        Compiler$compile_expr(false, s, e2);
        let _t10289;
        const _t10288 = op;
        _t10290: {
          if (_t10288._tag === 7) {
            _t10289 = ({_tag: 26, _name: "LT"});
            break _t10290;
          }
          if (_t10288._tag === 8) {
            _t10289 = ({_tag: 27, _name: "GT"});
            break _t10290;
          }
          if (_t10288._tag === 9) {
            _t10289 = ({_tag: 28, _name: "LE"});
            break _t10290;
          }
          if (_t10288._tag === 10) {
            _t10289 = ({_tag: 29, _name: "GE"});
            break _t10290;
          }
          if (true) {
            _t10289 = failwith("assert false");
            break _t10290;
          }
          _match_fail("line 16190");
        }
        _t10287 = _call(Compiler$emit, [1, 3, 6, s, _t10289]);
      } else {
        let _t10292;
        const _t10291 = op;
        _t10293: {
          if (_t10291._tag === 7) {
            _t10292 = "<";
            break _t10293;
          }
          if (_t10291._tag === 8) {
            _t10292 = ">";
            break _t10293;
          }
          if (_t10291._tag === 9) {
            _t10292 = "<=";
            break _t10293;
          }
          if (_t10291._tag === 10) {
            _t10292 = ">=";
            break _t10293;
          }
          if (true) {
            _t10292 = failwith("assert false");
            break _t10293;
          }
          _match_fail("line 16190");
        }
        const method_name_10294 = _t10292;
        const _t10295 = Compiler$compile_class_binop(s, "Ord", method_name_10294, e1.ty, e1, e2);
        _t10287 = _t10295;
      }
      const _t10286 = _t10287;
      const _t10281 = _t10286;
      _t10238 = _t10281;
      break _t10239;
    }
    if (_t10237._tag === 13) {
      const gidx_10296 = _call(Compiler$find_or_add_global, [5, s, "^"]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10296})]);
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      Compiler$compile_expr(false, s, e2);
      const _t10297 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      _t10238 = _t10297;
      break _t10239;
    }
    if (((((_t10237._tag === 14 || _t10237._tag === 15) || _t10237._tag === 16) || _t10237._tag === 17) || _t10237._tag === 18)) {
      const resolved_10298 = Types$repr(e1.ty);
      let _t10301;
      const _t10300 = resolved_10298;
      _t10302: {
        if (_t10300._tag === 0) {
          Compiler$compile_expr(false, s, e1);
          Compiler$compile_expr(false, s, e2);
          let _t10304;
          const _t10303 = op;
          _t10305: {
            if (_t10303._tag === 14) {
              _t10304 = ({_tag: 31, _name: "BAND"});
              break _t10305;
            }
            if (_t10303._tag === 15) {
              _t10304 = ({_tag: 32, _name: "BOR"});
              break _t10305;
            }
            if (_t10303._tag === 16) {
              _t10304 = ({_tag: 33, _name: "BXOR"});
              break _t10305;
            }
            if (_t10303._tag === 17) {
              _t10304 = ({_tag: 35, _name: "BSHL"});
              break _t10305;
            }
            if (_t10303._tag === 18) {
              _t10304 = ({_tag: 36, _name: "BSHR"});
              break _t10305;
            }
            if (true) {
              _t10304 = failwith("assert false");
              break _t10305;
            }
            _match_fail("line 16190");
          }
          _t10301 = _call(Compiler$emit, [1, 3, 6, s, _t10304]);
          break _t10302;
        }
        if (true) {
          let _t10307;
          const _t10306 = op;
          _t10308: {
            if (_t10306._tag === 14) {
              _t10307 = "land";
              break _t10308;
            }
            if (_t10306._tag === 15) {
              _t10307 = "lor";
              break _t10308;
            }
            if (_t10306._tag === 16) {
              _t10307 = "lxor";
              break _t10308;
            }
            if (_t10306._tag === 17) {
              _t10307 = "lsl";
              break _t10308;
            }
            if (_t10306._tag === 18) {
              _t10307 = "lsr";
              break _t10308;
            }
            if (true) {
              _t10307 = failwith("assert false");
              break _t10308;
            }
            _match_fail("line 16190");
          }
          const method_name_10309 = _t10307;
          const _t10310 = Compiler$compile_class_binop(s, "Bitwise", method_name_10309, e1.ty, e1, e2);
          _t10301 = _t10310;
          break _t10302;
        }
        _match_fail("line 16190");
      }
      const _t10299 = _t10301;
      _t10238 = _t10299;
      break _t10239;
    }
    if (_t10237._tag === 19) {
      Compiler$compile_expr(false, s, e2);
      Compiler$compile_expr(false, s, e1);
      _t10238 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      break _t10239;
    }
    _match_fail("line 16190");
  }
  return _t10238;
}
function Compiler$compile_class_binop(s, class_name, method_name, operand_ty, e1, e2) {
  const conc_ty_10311 = Types$repr(operand_ty);
  function _t10313(c) {
    return (c.class_name === class_name);
  }
  let _t10315;
  const _t10314 = List$find(_t10313, s.type_env.classes);
  _t10316: {
    if (_t10314._tag === 1) {
      const cd = _t10314._val;
      _t10315 = cd;
      break _t10316;
    }
    if (_t10314._tag === 0) {
      _t10315 = Compiler$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t10316;
    }
    _match_fail("line 16190");
  }
  const class_def_10317 = _t10315;
  const num_params_10319 = List$length(class_def_10317.class_params);
  function _t10321(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_10311});
  }
  const partial_10322 = List$init(num_params_10319, _t10321);
  function _t10324(opt) {
    let _t10326;
    const _t10325 = opt;
    _t10327: {
      if (_t10325._tag === 1) {
        const ty = _t10325._val;
        let _t10329;
        const _t10328 = Types$repr(ty);
        _t10330: {
          if (_t10328._tag === 16 && _t10328._val.contents._tag === 0) {
            _t10329 = ({_tag: 0, _name: "None"});
            break _t10330;
          }
          if (true) {
            _t10329 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t10330;
          }
          _match_fail("line 16190");
        }
        _t10326 = _t10329;
        break _t10327;
      }
      if (_t10325._tag === 0) {
        _t10326 = ({_tag: 0, _name: "None"});
        break _t10327;
      }
      _match_fail("line 16190");
    }
    return _t10326;
  }
  const concrete_partial_10331 = List$map(_t10324, partial_10322);
  function _t10333(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_10319) && Types$match_partial_inst(inst.inst_tys, concrete_partial_10331)));
  }
  const matching_10334 = List$filter(_t10333, s.type_env.instances);
  let _t10337;
  const _t10336 = matching_10334;
  _t10338: {
    if (_t10336 !== null && _t10336._tl === null) {
      const inst = _t10336._hd;
      let _t10339;
      if (_eq(inst.inst_constraints, null)) {
        const method_gidx_10340 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
        const _t10341 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10340})]);
        _t10339 = _t10341;
      } else {
        const dict_gidx_10342 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10342})]);
        const _t10343 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
        _t10339 = _t10343;
      }
      _t10339;
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      Compiler$compile_expr(false, s, e2);
      _t10337 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      break _t10338;
    }
    if (_t10336 === null) {
      _t10337 = Compiler$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_10311))));
      break _t10338;
    }
    if (true) {
      _t10337 = Compiler$error(((("ambiguous instance for " + __dict_Show_string.show(class_name)) + " method ") + __dict_Show_string.show(method_name)));
      break _t10338;
    }
    _match_fail("line 16190");
  }
  const _t10335 = _t10337;
  const _t10332 = _t10335;
  const _t10323 = _t10332;
  const _t10320 = _t10323;
  const _t10318 = _t10320;
  const _t10312 = _t10318;
  return _t10312;
}
function Compiler$compile_class_unop(s, class_name, method_name, operand_ty, e) {
  const conc_ty_10344 = Types$repr(operand_ty);
  function _t10346(c) {
    return (c.class_name === class_name);
  }
  let _t10348;
  const _t10347 = List$find(_t10346, s.type_env.classes);
  _t10349: {
    if (_t10347._tag === 1) {
      const cd = _t10347._val;
      _t10348 = cd;
      break _t10349;
    }
    if (_t10347._tag === 0) {
      _t10348 = Compiler$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t10349;
    }
    _match_fail("line 16190");
  }
  const class_def_10350 = _t10348;
  const num_params_10352 = List$length(class_def_10350.class_params);
  function _t10354(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_10344});
  }
  const partial_10355 = List$init(num_params_10352, _t10354);
  function _t10357(opt) {
    let _t10359;
    const _t10358 = opt;
    _t10360: {
      if (_t10358._tag === 1) {
        const ty = _t10358._val;
        let _t10362;
        const _t10361 = Types$repr(ty);
        _t10363: {
          if (_t10361._tag === 16 && _t10361._val.contents._tag === 0) {
            _t10362 = ({_tag: 0, _name: "None"});
            break _t10363;
          }
          if (true) {
            _t10362 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t10363;
          }
          _match_fail("line 16190");
        }
        _t10359 = _t10362;
        break _t10360;
      }
      if (_t10358._tag === 0) {
        _t10359 = ({_tag: 0, _name: "None"});
        break _t10360;
      }
      _match_fail("line 16190");
    }
    return _t10359;
  }
  const concrete_partial_10364 = List$map(_t10357, partial_10355);
  function _t10366(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_10352) && Types$match_partial_inst(inst.inst_tys, concrete_partial_10364)));
  }
  const matching_10367 = List$filter(_t10366, s.type_env.instances);
  let _t10370;
  const _t10369 = matching_10367;
  _t10371: {
    if (_t10369 !== null && _t10369._tl === null) {
      const inst = _t10369._hd;
      let _t10372;
      if (_eq(inst.inst_constraints, null)) {
        const method_gidx_10373 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
        const _t10374 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10373})]);
        _t10372 = _t10374;
      } else {
        const dict_gidx_10375 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10375})]);
        const _t10376 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
        _t10372 = _t10376;
      }
      _t10372;
      Compiler$compile_expr(false, s, e);
      _t10370 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      break _t10371;
    }
    if (_t10369 === null) {
      _t10370 = Compiler$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_10344))));
      break _t10371;
    }
    if (true) {
      _t10370 = Compiler$error(((("ambiguous instance for " + __dict_Show_string.show(class_name)) + " method ") + __dict_Show_string.show(method_name)));
      break _t10371;
    }
    _match_fail("line 16190");
  }
  const _t10368 = _t10370;
  const _t10365 = _t10368;
  const _t10356 = _t10365;
  const _t10353 = _t10356;
  const _t10351 = _t10353;
  const _t10345 = _t10351;
  return _t10345;
}
function Compiler$compile_unop(s, op, e) {
  let _t10378;
  const _t10377 = op;
  _t10379: {
    if (_t10377._tag === 0) {
      const resolved_10380 = Types$repr(e.ty);
      let _t10383;
      const _t10382 = resolved_10380;
      _t10384: {
        if (_t10382._tag === 0) {
          Compiler$compile_expr(false, s, e);
          _t10383 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 18, _name: "NEG"})]);
          break _t10384;
        }
        if (_t10382._tag === 1) {
          Compiler$compile_expr(false, s, e);
          _t10383 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 23, _name: "FNEG"})]);
          break _t10384;
        }
        if (true) {
          _t10383 = Compiler$compile_class_unop(s, "Num", "neg", e.ty, e);
          break _t10384;
        }
        _match_fail("line 16190");
      }
      const _t10381 = _t10383;
      _t10378 = _t10381;
      break _t10379;
    }
    if (_t10377._tag === 1) {
      Compiler$compile_expr(false, s, e);
      _t10378 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 30, _name: "NOT"})]);
      break _t10379;
    }
    if (_t10377._tag === 2) {
      const resolved_10385 = Types$repr(e.ty);
      let _t10388;
      const _t10387 = resolved_10385;
      _t10389: {
        if (_t10387._tag === 0) {
          Compiler$compile_expr(false, s, e);
          _t10388 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 34, _name: "BNOT"})]);
          break _t10389;
        }
        if (true) {
          _t10388 = Compiler$compile_class_unop(s, "Bitwise", "lnot", e.ty, e);
          break _t10389;
        }
        _match_fail("line 16190");
      }
      const _t10386 = _t10388;
      _t10378 = _t10386;
      break _t10379;
    }
    _match_fail("line 16190");
  }
  return _t10378;
}
function Compiler$compile_if(tail, s, cond, then_e, else_e) {
  Compiler$compile_expr(false, s, cond);
  const else_jump_10390 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]);
  Compiler$compile_expr(tail, s, then_e);
  const end_jump_10392 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
  const else_target_10394 = _call(Compiler$current_offset, [1, s]);
  _call(Compiler$patch, [1, s, else_jump_10390, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: else_target_10394})]);
  Compiler$compile_expr(tail, s, else_e);
  const end_target_10396 = _call(Compiler$current_offset, [1, s]);
  const _t10397 = _call(Compiler$patch, [1, s, end_jump_10392, ({_tag: 37, _name: "JUMP", _val: end_target_10396})]);
  const _t10395 = _t10397;
  const _t10393 = _t10395;
  const _t10391 = _t10393;
  return _t10391;
}
function Compiler$compile_function(has_return, s, param_name, body, _fn_ty) {
  function collect_params(params, body_expr, hr) {
    while (true) {
      let _t10399;
      const _t10398 = body_expr.expr;
      _t10400: {
        if (_t10398._tag === 10) {
          const p = _t10398._val[0];
          const inner = _t10398._val[1];
          const inner_hr = _t10398._val[2];
          const _t10401 = ({_hd: p, _tl: params});
          const _t10402 = inner;
          const _t10403 = (hr || inner_hr);
          params = _t10401;
          body_expr = _t10402;
          hr = _t10403;
          continue;
          _t10399 = undefined;
          break _t10400;
        }
        if (true) {
          _t10399 = [List$rev(params), body_expr, hr];
          break _t10400;
        }
        _match_fail("line 16190");
      }
      return _t10399;
    }
  }
  let _t10406;
  const _t10405 = collect_params(null, body, has_return);
  _t10407: {
    if (true) {
      const extra_params = _t10405[0];
      const final_body = _t10405[1];
      const combined_hr = _t10405[2];
      const all_params_10408 = ({_hd: param_name, _tl: extra_params});
      const arity_10410 = List$length(all_params_10408);
      const sub_10412 = Compiler$create_state(({_tag: 1, _name: "Some", _val: s}), arity_10410, s.global_names, s.mutable_globals, s.type_env, param_name);
      function _t10414(p) {
        _call(Compiler$allocate_local, [7, 9, 12, 15, sub_10412, p]);
        return undefined;
      }
      List$iter(_t10414, all_params_10408);
      let _t10415;
      if (combined_hr) {
        _t10415 = _call(Compiler$emit, [1, 3, 6, sub_10412, ({_tag: 46, _name: "ENTER_FUNC"})]);
      } else {
        _t10415 = undefined;
      }
      _t10415;
      Compiler$compile_expr((!combined_hr), sub_10412, final_body);
      let _t10416;
      if (combined_hr) {
        _t10416 = _call(Compiler$emit, [1, 3, 6, sub_10412, ({_tag: 47, _name: "EXIT_FUNC"})]);
      } else {
        _t10416 = undefined;
      }
      _t10416;
      _call(Compiler$emit, [1, 3, 6, sub_10412, ({_tag: 44, _name: "RETURN"})]);
      const proto_10417 = Compiler$finalize_proto(sub_10412);
      const proto_idx_10419 = _call(Compiler$add_constant, [2, s, ({_tag: 13, _name: "VProto", _val: proto_10417})]);
      function _t10421(uv) {
        return uv.capture;
      }
      const captures_10422 = List$map(_t10421, sub_10412.upvalues);
      const _t10423 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 40, _name: "CLOSURE", _val: [proto_idx_10419, captures_10422]})]);
      const _t10420 = _t10423;
      const _t10418 = _t10420;
      const _t10413 = _t10418;
      const _t10411 = _t10413;
      const _t10409 = _t10411;
      _t10406 = _t10409;
      break _t10407;
    }
    _match_fail("line 16190");
  }
  const _t10404 = _t10406;
  return _t10404;
}
function Compiler$count_arrows(ty) {
  let _t10425;
  const _t10424 = Types$repr(ty);
  _t10426: {
    if ((_t10424._tag === 7 || _t10424._tag === 8)) {
      const r = _t10424._val[2];
      _t10425 = (1 + Compiler$count_arrows(r));
      break _t10426;
    }
    if (true) {
      _t10425 = 0;
      break _t10426;
    }
    _match_fail("line 16190");
  }
  return _t10425;
}
function Compiler$finalize_proto(s) {
  return ({arity: s.arity, code: Dynarray$to_array(s.code), constants: Dynarray$to_array(s.constants), line_table: Dynarray$to_array(s.lines), name: s.proto_name, num_locals: s.max_locals});
}
function Compiler$compile_let_rec(s, name, fn_expr) {
  const slot_10427 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
  let _t10430;
  const _t10429 = fn_expr.expr;
  _t10431: {
    if (_t10429._tag === 10) {
      const param = _t10429._val[0];
      const body = _t10429._val[1];
      const has_return = _t10429._val[2];
      function collect_params(params, body_expr, hr) {
        while (true) {
          let _t10433;
          const _t10432 = body_expr.expr;
          _t10434: {
            if (_t10432._tag === 10) {
              const p = _t10432._val[0];
              const inner = _t10432._val[1];
              const inner_hr = _t10432._val[2];
              const _t10435 = ({_hd: p, _tl: params});
              const _t10436 = inner;
              const _t10437 = (hr || inner_hr);
              params = _t10435;
              body_expr = _t10436;
              hr = _t10437;
              continue;
              _t10433 = undefined;
              break _t10434;
            }
            if (true) {
              _t10433 = [List$rev(params), body_expr, hr];
              break _t10434;
            }
            _match_fail("line 16190");
          }
          return _t10433;
        }
      }
      let _t10440;
      const _t10439 = collect_params(null, body, has_return);
      _t10441: {
        if (true) {
          const extra_params = _t10439[0];
          const final_body = _t10439[1];
          const combined_hr = _t10439[2];
          const all_params_10442 = ({_hd: param, _tl: extra_params});
          const arity_10444 = List$length(all_params_10442);
          const sub_10446 = Compiler$create_state(({_tag: 1, _name: "Some", _val: s}), arity_10444, s.global_names, s.mutable_globals, s.type_env, name);
          function _t10448(p) {
            _call(Compiler$allocate_local, [7, 9, 12, 15, sub_10446, p]);
            return undefined;
          }
          List$iter(_t10448, all_params_10442);
          let _t10449;
          if (combined_hr) {
            _t10449 = _call(Compiler$emit, [1, 3, 6, sub_10446, ({_tag: 46, _name: "ENTER_FUNC"})]);
          } else {
            _t10449 = undefined;
          }
          _t10449;
          Compiler$compile_expr((!combined_hr), sub_10446, final_body);
          let _t10450;
          if (combined_hr) {
            _t10450 = _call(Compiler$emit, [1, 3, 6, sub_10446, ({_tag: 47, _name: "EXIT_FUNC"})]);
          } else {
            _t10450 = undefined;
          }
          _t10450;
          _call(Compiler$emit, [1, 3, 6, sub_10446, ({_tag: 44, _name: "RETURN"})]);
          const proto_10451 = Compiler$finalize_proto(sub_10446);
          const proto_idx_10453 = _call(Compiler$add_constant, [2, s, ({_tag: 13, _name: "VProto", _val: proto_10451})]);
          function _t10455(uv) {
            return uv.capture;
          }
          const captures_10456 = List$map(_t10455, sub_10446.upvalues);
          function _t10458(__p338) {
            let _t10460;
            const _t10459 = __p338;
            _t10461: {
              if (true) {
                const i = _t10459[0];
                const uv = _t10459[1];
                let _t10462;
                if ((uv.uv_name === name)) {
                  _t10462 = ({_tag: 1, _name: "Some", _val: i});
                } else {
                  _t10462 = ({_tag: 0, _name: "None"});
                }
                _t10460 = _t10462;
                break _t10461;
              }
              _match_fail("line 16190");
            }
            return _t10460;
          }
          function _t10463(i, uv) {
            return [i, uv];
          }
          const self_idx_10464 = List$find_map(_t10458, List$mapi(_t10463, sub_10446.upvalues));
          let _t10467;
          const _t10466 = self_idx_10464;
          _t10468: {
            if (_t10466._tag === 1) {
              const si = _t10466._val;
              _t10467 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 41, _name: "CLOSURE_REC", _val: [proto_idx_10453, captures_10456, si]})]);
              break _t10468;
            }
            if (_t10466._tag === 0) {
              _t10467 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 40, _name: "CLOSURE", _val: [proto_idx_10453, captures_10456]})]);
              break _t10468;
            }
            _match_fail("line 16190");
          }
          _t10467;
          const _t10465 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10427})]);
          const _t10457 = _t10465;
          const _t10454 = _t10457;
          const _t10452 = _t10454;
          const _t10447 = _t10452;
          const _t10445 = _t10447;
          const _t10443 = _t10445;
          _t10440 = _t10443;
          break _t10441;
        }
        _match_fail("line 16190");
      }
      const _t10438 = _t10440;
      _t10430 = _t10438;
      break _t10431;
    }
    if (true) {
      _t10430 = Compiler$error("let rec must bind a function");
      break _t10431;
    }
    _match_fail("line 16190");
  }
  const _t10428 = _t10430;
  return _t10428;
}
function Compiler$compile_match(tail, s, scrut, arms) {
  Compiler$compile_expr(false, s, scrut);
  const scrut_slot_10469 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_match_scrut"]);
  _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: scrut_slot_10469})]);
  const end_jumps_10471 = Ref$create(null);
  function _t10473(__p339) {
    let _t10475;
    const _t10474 = __p339;
    _t10476: {
      if (true) {
        const pat = _t10474[0];
        const guard = _t10474[1];
        const body = _t10474[2];
        const saved_num_locals_10477 = s.num_locals;
        const saved_locals_10479 = s.locals;
        const fail_jumps_10481 = Ref$create(null);
        Compiler$compile_pattern(s, scrut_slot_10469, pat, fail_jumps_10481);
        let _t10484;
        const _t10483 = guard;
        _t10485: {
          if (_t10483._tag === 1) {
            const guard_te = _t10483._val;
            Compiler$compile_expr(false, s, guard_te);
            _t10484 = Ref$set(fail_jumps_10481, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps_10481)}));
            break _t10485;
          }
          if (_t10483._tag === 0) {
            _t10484 = undefined;
            break _t10485;
          }
          _match_fail("line 16190");
        }
        _t10484;
        Compiler$compile_expr(tail, s, body);
        (s.num_locals = saved_num_locals_10477, undefined);
        (s.locals = saved_locals_10479, undefined);
        Ref$set(end_jumps_10471, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]), _tl: Ref$get(end_jumps_10471)}));
        const target_10486 = _call(Compiler$current_offset, [1, s]);
        function _t10488(idx) {
          return _call(Compiler$patch, [1, s, idx, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: target_10486})]);
        }
        const _t10487 = List$iter(_t10488, Ref$get(fail_jumps_10481));
        const _t10482 = _t10487;
        const _t10480 = _t10482;
        const _t10478 = _t10480;
        _t10475 = _t10478;
        break _t10476;
      }
      _match_fail("line 16190");
    }
    return _t10475;
  }
  List$iter(_t10473, arms);
  const loc_str_10489 = ("line " + __dict_Show_int.show(scrut.loc.line));
  _call(Compiler$emit, [1, 3, 6, s, ({_tag: 64, _name: "MATCH_FAIL", _val: loc_str_10489})]);
  const end_target_10491 = _call(Compiler$current_offset, [1, s]);
  function _t10493(idx) {
    return _call(Compiler$patch, [1, s, idx, ({_tag: 37, _name: "JUMP", _val: end_target_10491})]);
  }
  List$iter(_t10493, Ref$get(end_jumps_10471));
  const _t10492 = Compiler$free_local(s);
  const _t10490 = _t10492;
  const _t10472 = _t10490;
  const _t10470 = _t10472;
  return _t10470;
}
function Compiler$compile_pattern(s, slot, pat, fail_jumps) {
  while (true) {
    let _t10495;
    const _t10494 = pat;
    _t10496: {
      if (_t10494._tag === 0) {
        _t10495 = undefined;
        break _t10496;
      }
      if (_t10494._tag === 1) {
        const name = _t10494._val;
        const var_slot_10497 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        const _t10498 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: var_slot_10497})]);
        _t10495 = _t10498;
        break _t10496;
      }
      if (_t10494._tag === 2) {
        const n = _t10494._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: n})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10495 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10496;
      }
      if (_t10494._tag === 3) {
        const f = _t10494._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 1, _name: "VFloat", _val: f})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10495 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10496;
      }
      if (_t10494._tag === 4) {
        const b = _t10494._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 2, _name: "VBool", _val: b})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10495 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10496;
      }
      if (_t10494._tag === 5) {
        const str = _t10494._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: str})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10495 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10496;
      }
      if (_t10494._tag === 6) {
        _t10495 = undefined;
        break _t10496;
      }
      if (_t10494._tag === 9) {
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 59, _name: "IS_NIL"})]);
        _t10495 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10496;
      }
      if (_t10494._tag === 8) {
        const hd_pat = _t10494._val[0];
        const tl_pat = _t10494._val[1];
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 60, _name: "IS_CONS"})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        const hd_slot_10499 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_hd"]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 61, _name: "HEAD"})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: hd_slot_10499})]);
        const tl_slot_10501 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_tl"]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 62, _name: "TAIL"})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: tl_slot_10501})]);
        Compiler$compile_pattern(s, hd_slot_10499, hd_pat, fail_jumps);
        const _t10503 = s;
        const _t10504 = tl_slot_10501;
        const _t10505 = tl_pat;
        const _t10506 = fail_jumps;
        s = _t10503;
        slot = _t10504;
        pat = _t10505;
        fail_jumps = _t10506;
        continue;
        const _t10502 = undefined;
        const _t10500 = _t10502;
        _t10495 = _t10500;
        break _t10496;
      }
      if (_t10494._tag === 10) {
        const name = _t10494._val[0];
        const arg_pat = _t10494._val[1];
        const tag_10507 = Compiler$tag_for_constructor(s.type_env, name);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 58, _name: "TAG_EQ", _val: tag_10507})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        let _t10510;
        const _t10509 = arg_pat;
        _t10511: {
          if (_t10509._tag === 1) {
            const sub_pat = _t10509._val;
            const payload_slot_10512 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_payload"]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 63, _name: "VARIANT_PAYLOAD"})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: payload_slot_10512})]);
            const _t10514 = s;
            const _t10515 = payload_slot_10512;
            const _t10516 = sub_pat;
            const _t10517 = fail_jumps;
            s = _t10514;
            slot = _t10515;
            pat = _t10516;
            fail_jumps = _t10517;
            continue;
            const _t10513 = undefined;
            _t10510 = _t10513;
            break _t10511;
          }
          if (_t10509._tag === 0) {
            _t10510 = undefined;
            break _t10511;
          }
          _match_fail("line 16190");
        }
        const _t10508 = _t10510;
        _t10495 = _t10508;
        break _t10496;
      }
      if (_t10494._tag === 7) {
        const pats = _t10494._val;
        function _t10518(i, sub_pat) {
          const elem_slot_10519 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_tup"]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 49, _name: "TUPLE_GET", _val: i})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: elem_slot_10519})]);
          const _t10520 = Compiler$compile_pattern(s, elem_slot_10519, sub_pat, fail_jumps);
          return _t10520;
        }
        _t10495 = List$iteri(_t10518, pats);
        break _t10496;
      }
      if (_t10494._tag === 11) {
        const field_pats = _t10494._val;
        function _t10521(__p340) {
          let _t10523;
          const _t10522 = __p340;
          _t10524: {
            if (true) {
              const fname = _t10522[0];
              const sub_pat = _t10522[1];
              const field_slot_10525 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_fld"]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: fname})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: field_slot_10525})]);
              const _t10526 = Compiler$compile_pattern(s, field_slot_10525, sub_pat, fail_jumps);
              _t10523 = _t10526;
              break _t10524;
            }
            _match_fail("line 16190");
          }
          return _t10523;
        }
        _t10495 = List$iter(_t10521, field_pats);
        break _t10496;
      }
      if (_t10494._tag === 12) {
        const inner_pat = _t10494._val[0];
        const name = _t10494._val[1];
        Compiler$compile_pattern(s, slot, inner_pat, fail_jumps);
        const var_slot_10527 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        const _t10528 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: var_slot_10527})]);
        _t10495 = _t10528;
        break _t10496;
      }
      if (_t10494._tag === 13) {
        const p1 = _t10494._val[0];
        const p2 = _t10494._val[1];
        const saved_locals_10529 = s.locals;
        const saved_num_locals_10531 = s.num_locals;
        const or_fail_jumps_10533 = Ref$create(null);
        Compiler$compile_pattern(s, slot, p1, or_fail_jumps_10533);
        function _t10535(l) {
          let _t10536;
          if (((l.slot >= saved_num_locals_10531) && ((l.name !== "") && (String$get(l.name, 0) !== 95)))) {
            _t10536 = ({_tag: 1, _name: "Some", _val: [l.name, l.slot]});
          } else {
            _t10536 = ({_tag: 0, _name: "None"});
          }
          return _t10536;
        }
        const p1_bindings_10537 = List$filter_map(_t10535, s.locals);
        const success_jump_10539 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
        const p2_target_10541 = _call(Compiler$current_offset, [1, s]);
        function _t10543(idx) {
          return _call(Compiler$patch, [1, s, idx, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: p2_target_10541})]);
        }
        List$iter(_t10543, Ref$get(or_fail_jumps_10533));
        (s.locals = saved_locals_10529, undefined);
        (s.num_locals = saved_num_locals_10531, undefined);
        Compiler$compile_pattern(s, slot, p2, fail_jumps);
        function _t10544(__p341) {
          let _t10546;
          const _t10545 = __p341;
          _t10547: {
            if (true) {
              const name = _t10545[0];
              const p1_slot = _t10545[1];
              function _t10548(l) {
                return ((l.name === name) && (l.slot >= saved_num_locals_10531));
              }
              let _t10550;
              const _t10549 = List$find(_t10548, s.locals);
              _t10551: {
                if (_t10549._tag === 1) {
                  const l = _t10549._val;
                  if ((l.slot !== p1_slot)) {
                    _t10550 = ({_tag: 1, _name: "Some", _val: [l.slot, p1_slot]});
                    break _t10551;
                  }
                }
                if (true) {
                  _t10550 = ({_tag: 0, _name: "None"});
                  break _t10551;
                }
                _match_fail("line 16190");
              }
              _t10546 = _t10550;
              break _t10547;
            }
            _match_fail("line 16190");
          }
          return _t10546;
        }
        const remaps_10552 = List$filter_map(_t10544, p1_bindings_10537);
        let _t10554;
        if (!_eq(remaps_10552, null)) {
          function _t10555(__p342) {
            let _t10557;
            const _t10556 = __p342;
            _t10558: {
              if (true) {
                const src = _t10556[0];
                const _dst = _t10556[1];
                const tmp_10559 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_or_tmp"]);
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: src})]);
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: tmp_10559})]);
                const _t10560 = tmp_10559;
                _t10557 = _t10560;
                break _t10558;
              }
              _match_fail("line 16190");
            }
            return _t10557;
          }
          const temps_10561 = List$map(_t10555, remaps_10552);
          function _t10563(tmp, __p343) {
            let _t10565;
            const _t10564 = __p343;
            _t10566: {
              if (true) {
                const _src = _t10564[0];
                const dst = _t10564[1];
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: tmp})]);
                _t10565 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: dst})]);
                break _t10566;
              }
              _match_fail("line 16190");
            }
            return _t10565;
          }
          const _t10562 = List$iter2(_t10563, temps_10561, remaps_10552);
          _t10554 = _t10562;
        } else {
          _t10554 = undefined;
        }
        _t10554;
        const success_target_10567 = _call(Compiler$current_offset, [1, s]);
        _call(Compiler$patch, [1, s, success_jump_10539, ({_tag: 37, _name: "JUMP", _val: success_target_10567})]);
        function _t10569(l) {
          let _t10574;
          if ((l.slot < saved_num_locals_10531)) {
            _t10574 = true;
          } else {
          function _t10570(__p344) {
            let _t10572;
            const _t10571 = __p344;
            _t10573: {
              if (true) {
                const n = _t10571[0];
                _t10572 = (n === l.name);
                break _t10573;
              }
              _match_fail("line 16190");
            }
            return _t10572;
          }
            _t10574 = List$exists(_t10570, p1_bindings_10537);
          }
          return _t10574;
        }
        const p2_only_locals_10575 = List$filter(_t10569, s.locals);
        function _t10577(l) {
          let _t10579;
          const _t10578 = List$assoc_opt(l.name, p1_bindings_10537);
          _t10580: {
            if (_t10578._tag === 1) {
              const p1_slot = _t10578._val;
              if ((l.slot >= saved_num_locals_10531)) {
                const __rec_upd_10581 = l;
                const _t10582 = ({depth: __rec_upd_10581.depth, name: __rec_upd_10581.name, slot: p1_slot});
                _t10579 = _t10582;
                break _t10580;
              }
            }
            if (true) {
              _t10579 = l;
              break _t10580;
            }
            _match_fail("line 16190");
          }
          return _t10579;
        }
        const remapped_10583 = List$map(_t10577, p2_only_locals_10575);
        const _t10584 = (s.locals = remapped_10583, undefined);
        const _t10576 = _t10584;
        const _t10568 = _t10576;
        const _t10553 = _t10568;
        const _t10542 = _t10553;
        const _t10540 = _t10542;
        const _t10538 = _t10540;
        const _t10534 = _t10538;
        const _t10532 = _t10534;
        const _t10530 = _t10532;
        _t10495 = _t10530;
        break _t10496;
      }
      if (_t10494._tag === 14) {
        const pats = _t10494._val;
        const al_gidx_10585 = _call(Compiler$find_or_add_global, [5, s, "array_length"]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: al_gidx_10585})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: List$length(pats)})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        function _t10587(i, sub_pat) {
          const elem_slot_10588 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_arr_elem"]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
          _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: i})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 75, _name: "INDEX"})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: elem_slot_10588})]);
          const _t10589 = Compiler$compile_pattern(s, elem_slot_10588, sub_pat, fail_jumps);
          return _t10589;
        }
        const _t10586 = List$iteri(_t10587, pats);
        _t10495 = _t10586;
        break _t10496;
      }
      if (_t10494._tag === 15) {
        const entries = _t10494._val;
        const has_gidx_10590 = _call(Compiler$find_or_add_global, [5, s, "__map_has"]);
        const get_gidx_10592 = _call(Compiler$find_or_add_global, [5, s, "__map_get"]);
        function _t10594(__p345) {
          let _t10596;
          const _t10595 = __p345;
          _t10597: {
            if (true) {
              const key_pat = _t10595[0];
              const val_pat = _t10595[1];
              let _t10599;
              const _t10598 = key_pat;
              _t10600: {
                if (_t10598._tag === 2) {
                  const n = _t10598._val;
                  _t10599 = ({_tag: 0, _name: "VInt", _val: n});
                  break _t10600;
                }
                if (_t10598._tag === 5) {
                  const s = _t10598._val;
                  _t10599 = ({_tag: 3, _name: "VString", _val: s});
                  break _t10600;
                }
                if (_t10598._tag === 4) {
                  const b = _t10598._val;
                  _t10599 = ({_tag: 2, _name: "VBool", _val: b});
                  break _t10600;
                }
                if (_t10598._tag === 3) {
                  const f = _t10598._val;
                  _t10599 = ({_tag: 1, _name: "VFloat", _val: f});
                  break _t10600;
                }
                if (true) {
                  _t10599 = Compiler$error("map pattern keys must be literals");
                  break _t10600;
                }
                _match_fail("line 16190");
              }
              const key_val_10601 = _t10599;
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: has_gidx_10590})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              _call(Compiler$emit_constant, [1, 2, 3, 6, s, key_val_10601]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
              const val_slot_10603 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_map_val"]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: get_gidx_10592})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              _call(Compiler$emit_constant, [1, 2, 3, 6, s, key_val_10601]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: val_slot_10603})]);
              const _t10604 = Compiler$compile_pattern(s, val_slot_10603, val_pat, fail_jumps);
              const _t10602 = _t10604;
              _t10596 = _t10602;
              break _t10597;
            }
            _match_fail("line 16190");
          }
          return _t10596;
        }
        const _t10593 = List$iter(_t10594, entries);
        const _t10591 = _t10593;
        _t10495 = _t10591;
        break _t10496;
      }
      if (_t10494._tag === 16) {
        const tag = _t10494._val[0];
        const arg_pat = _t10494._val[1];
        const num_tag_10605 = (__dict_Hash_string.hash(tag) & 1073741823);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 58, _name: "TAG_EQ", _val: num_tag_10605})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        let _t10608;
        const _t10607 = arg_pat;
        _t10609: {
          if (_t10607._tag === 1) {
            const sub_pat = _t10607._val;
            const payload_slot_10610 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_payload"]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 63, _name: "VARIANT_PAYLOAD"})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: payload_slot_10610})]);
            const _t10612 = s;
            const _t10613 = payload_slot_10610;
            const _t10614 = sub_pat;
            const _t10615 = fail_jumps;
            s = _t10612;
            slot = _t10613;
            pat = _t10614;
            fail_jumps = _t10615;
            continue;
            const _t10611 = undefined;
            _t10608 = _t10611;
            break _t10609;
          }
          if (_t10607._tag === 0) {
            _t10608 = undefined;
            break _t10609;
          }
          _match_fail("line 16190");
        }
        const _t10606 = _t10608;
        _t10495 = _t10606;
        break _t10496;
      }
      if (_t10494._tag === 17) {
        const name = _t10494._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        Compiler$compile_var_access(s, name);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10495 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10496;
      }
      if (_t10494._tag === 18) {
        const inner_pat = _t10494._val[0];
        const _t10616 = s;
        const _t10617 = slot;
        const _t10618 = inner_pat;
        const _t10619 = fail_jumps;
        s = _t10616;
        slot = _t10617;
        pat = _t10618;
        fail_jumps = _t10619;
        continue;
        _t10495 = undefined;
        break _t10496;
      }
      _match_fail("line 16190");
    }
    return _t10495;
  }
}
function Compiler$compile_handle(s, body_te, arms) {
  const return_arm_10620 = Ref$create(({_tag: 0, _name: "None"}));
  const op_arms_10622 = Ref$create(null);
  function _t10624(__x) {
    let _t10626;
    const _t10625 = __x;
    _t10627: {
      if (_t10625._tag === 0) {
        const name = _t10625._val[0];
        const handler_body = _t10625._val[1];
        _t10626 = Ref$set(return_arm_10620, ({_tag: 1, _name: "Some", _val: [name, handler_body]}));
        break _t10627;
      }
      if (_t10625._tag === 1) {
        const op_name = _t10625._val[0];
        const arg_name = _t10625._val[1];
        const k_name = _t10625._val[2];
        const handler_body = _t10625._val[3];
        _t10626 = Ref$set(op_arms_10622, ({_hd: [op_name, arg_name, k_name, handler_body], _tl: Ref$get(op_arms_10622)}));
        break _t10627;
      }
      if (_t10625._tag === 2) {
        const op_name = _t10625._val[0];
        const arg_name = _t10625._val[1];
        const value_expr = _t10625._val[2];
        const k_name_10628 = "__k_provide";
        const __rec_upd_10630 = value_expr;
        const _t10631 = ({expr: ({_tag: 7, _name: "TEVar", _val: k_name_10628}), loc: __rec_upd_10630.loc, ty: ({_tag: 6, _name: "TUnit"})});
        const k_var_10632 = _t10631;
        const __rec_upd_10634 = value_expr;
        const _t10635 = ({expr: ({_tag: 31, _name: "TEResume", _val: [k_var_10632, value_expr]}), loc: __rec_upd_10634.loc, ty: __rec_upd_10634.ty});
        const resume_expr_10636 = _t10635;
        const _t10637 = Ref$set(op_arms_10622, ({_hd: [op_name, arg_name, k_name_10628, resume_expr_10636], _tl: Ref$get(op_arms_10622)}));
        const _t10633 = _t10637;
        const _t10629 = _t10633;
        _t10626 = _t10629;
        break _t10627;
      }
      if (_t10625._tag === 3) {
        const op_name = _t10625._val[0];
        const arg_name = _t10625._val[1];
        const fallback_expr = _t10625._val[2];
        _t10626 = Ref$set(op_arms_10622, ({_hd: [op_name, arg_name, "__k_try", fallback_expr], _tl: Ref$get(op_arms_10622)}));
        break _t10627;
      }
      _match_fail("line 16190");
    }
    return _t10626;
  }
  List$iter(_t10624, arms);
  const op_arms_10638 = List$rev(Ref$get(op_arms_10622));
  let _t10641;
  const _t10640 = Ref$get(return_arm_10620);
  _t10642: {
    if (_t10640._tag === 1) {
      const arm = _t10640._val;
      _t10641 = arm;
      break _t10642;
    }
    if (_t10640._tag === 0) {
      _t10641 = Compiler$error("handle expression missing return arm");
      break _t10642;
    }
    _match_fail("line 16190");
  }
  let _t10644;
  const _t10643 = _t10641;
  _t10645: {
    if (true) {
      const ret_name = _t10643[0];
      const ret_body = _t10643[1];
      Compiler$compile_function(false, s, "_", body_te, ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), ({_tag: 6, _name: "TUnit"})]}));
      Compiler$compile_function(false, s, ret_name, ret_body, ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), ({_tag: 6, _name: "TUnit"})]}));
      function _t10646(__p346) {
        let _t10648;
        const _t10647 = __p346;
        _t10649: {
          if (true) {
            const op_name = _t10647[0];
            const arg_name = _t10647[1];
            const k_name = _t10647[2];
            const handler_body = _t10647[3];
            _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: op_name})]);
            _t10648 = Compiler$compile_op_handler(s, arg_name, k_name, handler_body);
            break _t10649;
          }
          _match_fail("line 16190");
        }
        return _t10648;
      }
      List$iter(_t10646, op_arms_10638);
      _t10644 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 66, _name: "HANDLE", _val: List$length(op_arms_10638)})]);
      break _t10645;
    }
    _match_fail("line 16190");
  }
  const _t10639 = _t10644;
  const _t10623 = _t10639;
  const _t10621 = _t10623;
  return _t10621;
}
function Compiler$compile_op_handler(s, arg_name, k_name, handler_body) {
  const sub_10650 = Compiler$create_state(({_tag: 1, _name: "Some", _val: s}), 1, s.global_names, s.mutable_globals, s.type_env, "__handler");
  const pair_slot_10652 = _call(Compiler$allocate_local, [7, 9, 12, 15, sub_10650, "__pair"]);
  const arg_slot_10654 = _call(Compiler$allocate_local, [7, 9, 12, 15, sub_10650, arg_name]);
  _call(Compiler$emit, [1, 3, 6, sub_10650, ({_tag: 3, _name: "GET_LOCAL", _val: pair_slot_10652})]);
  _call(Compiler$emit, [1, 3, 6, sub_10650, ({_tag: 49, _name: "TUPLE_GET", _val: 0})]);
  _call(Compiler$emit, [1, 3, 6, sub_10650, ({_tag: 4, _name: "SET_LOCAL", _val: arg_slot_10654})]);
  const k_slot_10656 = _call(Compiler$allocate_local, [7, 9, 12, 15, sub_10650, k_name]);
  _call(Compiler$emit, [1, 3, 6, sub_10650, ({_tag: 3, _name: "GET_LOCAL", _val: pair_slot_10652})]);
  _call(Compiler$emit, [1, 3, 6, sub_10650, ({_tag: 49, _name: "TUPLE_GET", _val: 1})]);
  _call(Compiler$emit, [1, 3, 6, sub_10650, ({_tag: 4, _name: "SET_LOCAL", _val: k_slot_10656})]);
  [arg_slot_10654, k_slot_10656];
  undefined;
  Compiler$compile_expr(true, sub_10650, handler_body);
  _call(Compiler$emit, [1, 3, 6, sub_10650, ({_tag: 44, _name: "RETURN"})]);
  const proto_10658 = Compiler$finalize_proto(sub_10650);
  const proto_idx_10660 = _call(Compiler$add_constant, [2, s, ({_tag: 13, _name: "VProto", _val: proto_10658})]);
  function _t10662(uv) {
    return uv.capture;
  }
  const captures_10663 = List$map(_t10662, sub_10650.upvalues);
  const _t10664 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 40, _name: "CLOSURE", _val: [proto_idx_10660, captures_10663]})]);
  const _t10661 = _t10664;
  const _t10659 = _t10661;
  const _t10657 = _t10659;
  const _t10655 = _t10657;
  const _t10653 = _t10655;
  const _t10651 = _t10653;
  return _t10651;
}
function Compiler$compile_decl(s, decl) {
  let _t10666;
  const _t10665 = decl;
  _t10667: {
    if (((_t10665._tag === 4 || _t10665._tag === 6) || _t10665._tag === 7)) {
      _t10666 = undefined;
      break _t10667;
    }
    if (_t10665._tag === 8) {
      const name = _t10665._val[0];
      _call(Compiler$find_or_add_global, [5, s, name]);
      _t10666 = undefined;
      break _t10667;
    }
    if (_t10665._tag === 0) {
      const name = _t10665._val[0];
      const te = _t10665._val[1];
      Compiler$compile_expr(false, s, te);
      _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
      const gidx_10668 = _call(Compiler$find_or_add_global, [5, s, name]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_10668})]);
      let _t10670;
      if (((String$length(name) > 6) && (String$sub(name, 0, 6) === "__dict"))) {
        function _t10671(inst) {
          return (inst.inst_dict_name === name);
        }
        const inst_opt_10672 = List$find(_t10671, s.type_env.instances);
        let _t10675;
        const _t10674 = inst_opt_10672;
        _t10676: {
          if (_t10674._tag === 1) {
            const inst = _t10674._val;
            if (_eq(inst.inst_constraints, null)) {
              function _t10677(c) {
                return (c.class_name === inst.inst_class);
              }
              const class_opt_10678 = List$find(_t10677, s.type_env.classes);
              let _t10681;
              const _t10680 = class_opt_10678;
              _t10682: {
                if (_t10680._tag === 1) {
                  const class_def = _t10680._val;
                  function _t10683(__p347) {
                    let _t10685;
                    const _t10684 = __p347;
                    _t10686: {
                      if (true) {
                        const method_name = _t10684[0];
                        const mgidx_10687 = _call(Compiler$find_or_add_global, [5, s, (name + ("$" + method_name))]);
                        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10668})]);
                        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
                        const _t10688 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: mgidx_10687})]);
                        _t10685 = _t10688;
                        break _t10686;
                      }
                      _match_fail("line 16190");
                    }
                    return _t10685;
                  }
                  _t10681 = List$iter(_t10683, class_def.class_methods);
                  break _t10682;
                }
                if (_t10680._tag === 0) {
                  _t10681 = undefined;
                  break _t10682;
                }
                _match_fail("line 16190");
              }
              const _t10679 = _t10681;
              _t10675 = _t10679;
              break _t10676;
            }
          }
          if (true) {
            _t10675 = undefined;
            break _t10676;
          }
          _match_fail("line 16190");
        }
        const _t10673 = _t10675;
        _t10670 = _t10673;
      } else {
        _t10670 = undefined;
      }
      const _t10669 = _t10670;
      _t10666 = _t10669;
      break _t10667;
    }
    if (_t10665._tag === 1) {
      const name = _t10665._val[0];
      const te = _t10665._val[1];
      Compiler$compile_expr(false, s, te);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 7, _name: "MAKE_REF"})]);
      _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name, undefined]);
      const gidx_10689 = _call(Compiler$find_or_add_global, [5, s, name]);
      const _t10690 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_10689})]);
      _t10666 = _t10690;
      break _t10667;
    }
    if (_t10665._tag === 2) {
      const name = _t10665._val[0];
      const te = _t10665._val[1];
      _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
      const gidx_10691 = _call(Compiler$find_or_add_global, [5, s, name]);
      Compiler$compile_expr(false, s, te);
      const _t10692 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_10691})]);
      _t10666 = _t10692;
      break _t10667;
    }
    if (_t10665._tag === 3) {
      const bindings = _t10665._val;
      function _t10693(__p348) {
        let _t10695;
        const _t10694 = __p348;
        _t10696: {
          if (true) {
            const name = _t10694[0];
            _t10695 = _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
            break _t10696;
          }
          _match_fail("line 16190");
        }
        return _t10695;
      }
      List$iter(_t10693, bindings);
      function _t10697(__p349) {
        let _t10699;
        const _t10698 = __p349;
        _t10700: {
          if (true) {
            const name = _t10698[0];
            _t10699 = _call(Compiler$find_or_add_global, [5, s, name]);
            break _t10700;
          }
          _match_fail("line 16190");
        }
        return _t10699;
      }
      const gidxs_10701 = List$map(_t10697, bindings);
      function _t10703(__p350, gidx) {
        let _t10705;
        const _t10704 = __p350;
        _t10706: {
          if (true) {
            const _name = _t10704[0];
            const te = _t10704[1];
            Compiler$compile_expr(false, s, te);
            _t10705 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx})]);
            break _t10706;
          }
          _match_fail("line 16190");
        }
        return _t10705;
      }
      const _t10702 = List$iter2(_t10703, bindings, gidxs_10701);
      _t10666 = _t10702;
      break _t10667;
    }
    if (_t10665._tag === 5) {
      const te = _t10665._val;
      Compiler$compile_expr(false, s, te);
      _t10666 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      break _t10667;
    }
    if (_t10665._tag === 9) {
      const _name = _t10665._val[0];
      const inner_decls = _t10665._val[1];
      function _t10707(d) {
        return Compiler$compile_decl(s, d);
      }
      _t10666 = List$iter(_t10707, inner_decls);
      break _t10667;
    }
    if (_t10665._tag === 10) {
      const alias_pairs = _t10665._val;
      function _t10708(__p351) {
        let _t10710;
        const _t10709 = __p351;
        _t10711: {
          if (true) {
            const short_name = _t10709[0];
            const qualified_name = _t10709[1];
            const src_idx_10712 = _call(Compiler$find_or_add_global, [5, s, qualified_name]);
            const dst_idx_10714 = _call(Compiler$find_or_add_global, [5, s, short_name]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: src_idx_10712})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: dst_idx_10714})]);
            let _t10716;
            if (Compiler$is_mutable_global(s, qualified_name)) {
              _t10716 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, short_name, undefined]);
            } else {
              _t10716 = _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, short_name]);
            }
            const _t10715 = _t10716;
            const _t10713 = _t10715;
            _t10710 = _t10713;
            break _t10711;
          }
          _match_fail("line 16190");
        }
        return _t10710;
      }
      _t10666 = List$iter(_t10708, alias_pairs);
      break _t10667;
    }
    _match_fail("line 16190");
  }
  return _t10666;
}
function Compiler$compile_decl_last(s, decl) {
  let _t10718;
  const _t10717 = decl;
  _t10719: {
    if (_t10717._tag === 5) {
      const te = _t10717._val;
      _t10718 = Compiler$compile_expr(false, s, te);
      break _t10719;
    }
    if (true) {
      _t10718 = Compiler$compile_decl(s, decl);
      break _t10719;
    }
    _match_fail("line 16190");
  }
  return _t10718;
}
function Compiler$compile_program_with_globals(type_env, global_names, mutable_globals, program) {
  const s_10720 = Compiler$create_state(({_tag: 0, _name: "None"}), 0, global_names, mutable_globals, type_env, "<main>");
  function compile_all(__x) {
    while (true) {
      let _t10723;
      const _t10722 = __x;
      _t10724: {
        if (_t10722 === null) {
          _t10723 = undefined;
          break _t10724;
        }
        if (_t10722 !== null && _t10722._tl === null) {
          const last = _t10722._hd;
          _t10723 = Compiler$compile_decl_last(s_10720, last);
          break _t10724;
        }
        if (_t10722 !== null) {
          const decl = _t10722._hd;
          const rest = _t10722._tl;
          Compiler$compile_decl(s_10720, decl);
          const _t10725 = rest;
          __x = _t10725;
          continue;
          _t10723 = undefined;
          break _t10724;
        }
        _match_fail("line 16190");
      }
      return _t10723;
    }
  }
  compile_all(program);
  _call(Compiler$emit, [1, 3, 6, s_10720, ({_tag: 76, _name: "HALT"})]);
  const main_10727 = Compiler$finalize_proto(s_10720);
  let _t10729;
  if (Ref$get(Compiler$optimize_enabled)) {
    _t10729 = Optimize$optimize_proto(main_10727);
  } else {
    _t10729 = main_10727;
  }
  const main_10730 = _t10729;
  const gn_10732 = Dynarray$to_array(global_names);
  const _t10733 = ({global_names: gn_10732, main: main_10730});
  const _t10731 = _t10733;
  const _t10728 = _t10731;
  const _t10726 = _t10728;
  const _t10721 = _t10726;
  return _t10721;
}
function Compiler$compile_program(type_env, program) {
  return Compiler$compile_program_with_globals(type_env, Dynarray$empty(undefined), Hashtbl$create(8), program);
}
function Serialize$json_escape_string(s) {
  const buf_10734 = Buffer$create((String$length(s) + 8));
  Buffer$add_byte(buf_10734, 34);
  function _t10736(c) {
    let _t10738;
    const _t10737 = c;
    _t10739: {
      if (true) {
        const _c = _t10737;
        if ((_c === 34)) {
          _t10738 = Buffer$add_string(buf_10734, "\\\"");
          break _t10739;
        }
      }
      if (true) {
        const _c = _t10737;
        if ((_c === 92)) {
          _t10738 = Buffer$add_string(buf_10734, "\\\\");
          break _t10739;
        }
      }
      if (true) {
        const _c = _t10737;
        if ((_c === 10)) {
          _t10738 = Buffer$add_string(buf_10734, "\\n");
          break _t10739;
        }
      }
      if (true) {
        const _c = _t10737;
        if ((_c === 13)) {
          _t10738 = Buffer$add_string(buf_10734, "\\r");
          break _t10739;
        }
      }
      if (true) {
        const _c = _t10737;
        if ((_c === 9)) {
          _t10738 = Buffer$add_string(buf_10734, "\\t");
          break _t10739;
        }
      }
      if (true) {
        const c = _t10737;
        if ((Byte$to_int(c) < 32)) {
          _t10738 = Buffer$add_string(buf_10734, ("\\u" + __fmt_zero_pad(4, __fmt_hex(Byte$to_int(c)))));
          break _t10739;
        }
      }
      if (true) {
        const c = _t10737;
        _t10738 = Buffer$add_byte(buf_10734, c);
        break _t10739;
      }
      _match_fail("line 16190");
    }
    return _t10738;
  }
  String$iter(_t10736, s);
  Buffer$add_byte(buf_10734, 34);
  const _t10735 = Buffer$contents(buf_10734);
  return _t10735;
}
function Serialize$serialize_capture(__x) {
  let _t10741;
  const _t10740 = __x;
  _t10742: {
    if (_t10740._tag === 0) {
      const i = _t10740._val;
      _t10741 = (("[\"local\"," + __dict_Show_int.show(i)) + "]");
      break _t10742;
    }
    if (_t10740._tag === 1) {
      const i = _t10740._val;
      _t10741 = (("[\"upvalue\"," + __dict_Show_int.show(i)) + "]");
      break _t10742;
    }
    _match_fail("line 16190");
  }
  return _t10741;
}
function Serialize$serialize_captures(caps) {
  return ("[" + (String$concat(",", List$map(Serialize$serialize_capture, caps)) + "]"));
}
function Serialize$serialize_opcode(__x) {
  let _t10744;
  const _t10743 = __x;
  _t10745: {
    if (_t10743._tag === 0) {
      const i = _t10743._val;
      _t10744 = (("[\"CONST\"," + __dict_Show_int.show(i)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 1) {
      _t10744 = "[\"POP\"]";
      break _t10745;
    }
    if (_t10743._tag === 2) {
      _t10744 = "[\"DUP\"]";
      break _t10745;
    }
    if (_t10743._tag === 3) {
      const i = _t10743._val;
      _t10744 = (("[\"GET_LOCAL\"," + __dict_Show_int.show(i)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 4) {
      const i = _t10743._val;
      _t10744 = (("[\"SET_LOCAL\"," + __dict_Show_int.show(i)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 5) {
      const i = _t10743._val;
      _t10744 = (("[\"GET_UPVALUE\"," + __dict_Show_int.show(i)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 6) {
      const i = _t10743._val;
      _t10744 = (("[\"SET_UPVALUE\"," + __dict_Show_int.show(i)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 7) {
      _t10744 = "[\"MAKE_REF\"]";
      break _t10745;
    }
    if (_t10743._tag === 8) {
      _t10744 = "[\"DEREF\"]";
      break _t10745;
    }
    if (_t10743._tag === 9) {
      _t10744 = "[\"SET_REF\"]";
      break _t10745;
    }
    if (_t10743._tag === 10) {
      const i = _t10743._val;
      _t10744 = (("[\"GET_GLOBAL\"," + __dict_Show_int.show(i)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 11) {
      const i = _t10743._val;
      _t10744 = (("[\"SET_GLOBAL\"," + __dict_Show_int.show(i)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 12) {
      const i = _t10743._val;
      _t10744 = (("[\"DEF_GLOBAL\"," + __dict_Show_int.show(i)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 13) {
      _t10744 = "[\"ADD\"]";
      break _t10745;
    }
    if (_t10743._tag === 14) {
      _t10744 = "[\"SUB\"]";
      break _t10745;
    }
    if (_t10743._tag === 15) {
      _t10744 = "[\"MUL\"]";
      break _t10745;
    }
    if (_t10743._tag === 16) {
      _t10744 = "[\"DIV\"]";
      break _t10745;
    }
    if (_t10743._tag === 17) {
      _t10744 = "[\"MOD\"]";
      break _t10745;
    }
    if (_t10743._tag === 18) {
      _t10744 = "[\"NEG\"]";
      break _t10745;
    }
    if (_t10743._tag === 19) {
      _t10744 = "[\"FADD\"]";
      break _t10745;
    }
    if (_t10743._tag === 20) {
      _t10744 = "[\"FSUB\"]";
      break _t10745;
    }
    if (_t10743._tag === 21) {
      _t10744 = "[\"FMUL\"]";
      break _t10745;
    }
    if (_t10743._tag === 22) {
      _t10744 = "[\"FDIV\"]";
      break _t10745;
    }
    if (_t10743._tag === 23) {
      _t10744 = "[\"FNEG\"]";
      break _t10745;
    }
    if (_t10743._tag === 24) {
      _t10744 = "[\"EQ\"]";
      break _t10745;
    }
    if (_t10743._tag === 25) {
      _t10744 = "[\"NEQ\"]";
      break _t10745;
    }
    if (_t10743._tag === 26) {
      _t10744 = "[\"LT\"]";
      break _t10745;
    }
    if (_t10743._tag === 27) {
      _t10744 = "[\"GT\"]";
      break _t10745;
    }
    if (_t10743._tag === 28) {
      _t10744 = "[\"LE\"]";
      break _t10745;
    }
    if (_t10743._tag === 29) {
      _t10744 = "[\"GE\"]";
      break _t10745;
    }
    if (_t10743._tag === 30) {
      _t10744 = "[\"NOT\"]";
      break _t10745;
    }
    if (_t10743._tag === 31) {
      _t10744 = "[\"BAND\"]";
      break _t10745;
    }
    if (_t10743._tag === 32) {
      _t10744 = "[\"BOR\"]";
      break _t10745;
    }
    if (_t10743._tag === 33) {
      _t10744 = "[\"BXOR\"]";
      break _t10745;
    }
    if (_t10743._tag === 34) {
      _t10744 = "[\"BNOT\"]";
      break _t10745;
    }
    if (_t10743._tag === 35) {
      _t10744 = "[\"BSHL\"]";
      break _t10745;
    }
    if (_t10743._tag === 36) {
      _t10744 = "[\"BSHR\"]";
      break _t10745;
    }
    if (_t10743._tag === 37) {
      const off = _t10743._val;
      _t10744 = (("[\"JUMP\"," + __dict_Show_int.show(off)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 38) {
      const off = _t10743._val;
      _t10744 = (("[\"JUMP_IF_FALSE\"," + __dict_Show_int.show(off)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 39) {
      const off = _t10743._val;
      _t10744 = (("[\"JUMP_IF_TRUE\"," + __dict_Show_int.show(off)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 40) {
      const i = _t10743._val[0];
      const caps = _t10743._val[1];
      _t10744 = (((("[\"CLOSURE\"," + __dict_Show_int.show(i)) + ",") + __dict_Show_string.show(Serialize$serialize_captures(caps))) + "]");
      break _t10745;
    }
    if (_t10743._tag === 41) {
      const i = _t10743._val[0];
      const caps = _t10743._val[1];
      const self = _t10743._val[2];
      _t10744 = (((((("[\"CLOSURE_REC\"," + __dict_Show_int.show(i)) + ",") + __dict_Show_string.show(Serialize$serialize_captures(caps))) + ",") + __dict_Show_int.show(self)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 42) {
      const n = _t10743._val;
      _t10744 = (("[\"CALL\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 43) {
      const n = _t10743._val;
      _t10744 = (("[\"TAIL_CALL\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 44) {
      _t10744 = "[\"RETURN\"]";
      break _t10745;
    }
    if (_t10743._tag === 45) {
      _t10744 = "[\"FUNC_RETURN\"]";
      break _t10745;
    }
    if (_t10743._tag === 46) {
      _t10744 = "[\"ENTER_FUNC\"]";
      break _t10745;
    }
    if (_t10743._tag === 47) {
      _t10744 = "[\"EXIT_FUNC\"]";
      break _t10745;
    }
    if (_t10743._tag === 48) {
      const n = _t10743._val;
      _t10744 = (("[\"MAKE_TUPLE\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 49) {
      const i = _t10743._val;
      _t10744 = (("[\"TUPLE_GET\"," + __dict_Show_int.show(i)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 50) {
      const fields = _t10743._val;
      _t10744 = (("[\"MAKE_RECORD\",[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$json_escape_string, fields)))) + "]]");
      break _t10745;
    }
    if (_t10743._tag === 51) {
      const name = _t10743._val;
      _t10744 = (("[\"FIELD\"," + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t10745;
    }
    if (_t10743._tag === 52) {
      const name = _t10743._val;
      _t10744 = (("[\"SET_FIELD\"," + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t10745;
    }
    if (_t10743._tag === 53) {
      const fields = _t10743._val;
      _t10744 = (("[\"RECORD_UPDATE\",[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$json_escape_string, fields)))) + "]]");
      break _t10745;
    }
    if (_t10743._tag === 54) {
      const n = _t10743._val;
      _t10744 = (("[\"RECORD_UPDATE_DYN\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 55) {
      const tag = _t10743._val[0];
      const name = _t10743._val[1];
      const has_payload = _t10743._val[2];
      _t10744 = (((((("[\"MAKE_VARIANT\"," + __dict_Show_int.show(tag)) + ",") + __dict_Show_string.show(Serialize$json_escape_string(name))) + ",") + __dict_Show_bool.show(has_payload)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 56) {
      _t10744 = "[\"CONS\"]";
      break _t10745;
    }
    if (_t10743._tag === 57) {
      _t10744 = "[\"NIL\"]";
      break _t10745;
    }
    if (_t10743._tag === 58) {
      const tag = _t10743._val;
      _t10744 = (("[\"TAG_EQ\"," + __dict_Show_int.show(tag)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 59) {
      _t10744 = "[\"IS_NIL\"]";
      break _t10745;
    }
    if (_t10743._tag === 60) {
      _t10744 = "[\"IS_CONS\"]";
      break _t10745;
    }
    if (_t10743._tag === 61) {
      _t10744 = "[\"HEAD\"]";
      break _t10745;
    }
    if (_t10743._tag === 62) {
      _t10744 = "[\"TAIL\"]";
      break _t10745;
    }
    if (_t10743._tag === 63) {
      _t10744 = "[\"VARIANT_PAYLOAD\"]";
      break _t10745;
    }
    if (_t10743._tag === 64) {
      const loc = _t10743._val;
      _t10744 = (("[\"MATCH_FAIL\"," + __dict_Show_string.show(Serialize$json_escape_string(loc))) + "]");
      break _t10745;
    }
    if (_t10743._tag === 65) {
      const op = _t10743._val;
      _t10744 = (("[\"PERFORM\"," + __dict_Show_string.show(Serialize$json_escape_string(op))) + "]");
      break _t10745;
    }
    if (_t10743._tag === 66) {
      const n = _t10743._val;
      _t10744 = (("[\"HANDLE\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 67) {
      _t10744 = "[\"RESUME\"]";
      break _t10745;
    }
    if (_t10743._tag === 68) {
      const n = _t10743._val;
      _t10744 = (("[\"ENTER_LOOP\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 69) {
      _t10744 = "[\"EXIT_LOOP\"]";
      break _t10745;
    }
    if (_t10743._tag === 70) {
      _t10744 = "[\"LOOP_BREAK\"]";
      break _t10745;
    }
    if (_t10743._tag === 71) {
      const n = _t10743._val;
      _t10744 = (("[\"LOOP_CONTINUE\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 72) {
      const n = _t10743._val;
      _t10744 = (("[\"FOLD_CONTINUE\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 73) {
      const n = _t10743._val;
      _t10744 = (("[\"MAKE_MAP\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 74) {
      const n = _t10743._val;
      _t10744 = (("[\"MAKE_ARRAY\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 75) {
      _t10744 = "[\"INDEX\"]";
      break _t10745;
    }
    if (_t10743._tag === 76) {
      _t10744 = "[\"HALT\"]";
      break _t10745;
    }
    if (_t10743._tag === 77) {
      const slot = _t10743._val[0];
      const arity = _t10743._val[1];
      _t10744 = (((("[\"GET_LOCAL_CALL\"," + __dict_Show_int.show(slot)) + ",") + __dict_Show_int.show(arity)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 78) {
      const slot = _t10743._val[0];
      const idx = _t10743._val[1];
      _t10744 = (((("[\"GET_LOCAL_TUPLE_GET\"," + __dict_Show_int.show(slot)) + ",") + __dict_Show_int.show(idx)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 79) {
      const slot = _t10743._val[0];
      const name = _t10743._val[1];
      _t10744 = (((("[\"GET_LOCAL_FIELD\"," + __dict_Show_int.show(slot)) + ",") + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t10745;
    }
    if (_t10743._tag === 80) {
      const idx = _t10743._val[0];
      const arity = _t10743._val[1];
      _t10744 = (((("[\"GET_GLOBAL_CALL\"," + __dict_Show_int.show(idx)) + ",") + __dict_Show_int.show(arity)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 81) {
      const idx = _t10743._val[0];
      const name = _t10743._val[1];
      _t10744 = (((("[\"GET_GLOBAL_FIELD\"," + __dict_Show_int.show(idx)) + ",") + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t10745;
    }
    if (_t10743._tag === 82) {
      const min_tag = _t10743._val[0];
      const targets = _t10743._val[1];
      const _mml$default = _t10743._val[2];
      _t10744 = (((((("[\"JUMP_TABLE\"," + __dict_Show_int.show(min_tag)) + ",[") + __dict_Show_string.show(String$concat(",", Array$to_list(Array$map(string_of_int, targets))))) + "],") + __dict_Show_int.show(_mml$default)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 83) {
      const n = _t10743._val;
      _t10744 = (("[\"CALL_N\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    if (_t10743._tag === 84) {
      const n = _t10743._val;
      _t10744 = (("[\"TAIL_CALL_N\"," + __dict_Show_int.show(n)) + "]");
      break _t10745;
    }
    _match_fail("line 16190");
  }
  return _t10744;
}
function Serialize$serialize_value(__x) {
  let _t10747;
  const _t10746 = __x;
  _t10748: {
    if (_t10746._tag === 0) {
      const n = _t10746._val;
      _t10747 = (("{\"t\":\"i\",\"v\":" + __dict_Show_int.show(n)) + "}");
      break _t10748;
    }
    if (_t10746._tag === 1) {
      const f = _t10746._val;
      const s_10749 = __dict_Show_float.show(f);
      const len_10751 = String$length(s_10749);
      let _t10753;
      if (((len_10751 > 0) && (String$get(s_10749, (len_10751 - 1)) === 46))) {
        _t10753 = String$sub(s_10749, 0, (len_10751 - 1));
      } else {
        _t10753 = s_10749;
      }
      const s_10754 = _t10753;
      const _t10755 = (("{\"t\":\"f\",\"v\":" + __dict_Show_string.show(s_10754)) + "}");
      const _t10752 = _t10755;
      const _t10750 = _t10752;
      _t10747 = _t10750;
      break _t10748;
    }
    if (_t10746._tag === 2) {
      const b = _t10746._val;
      _t10747 = (("{\"t\":\"b\",\"v\":" + __dict_Show_bool.show(b)) + "}");
      break _t10748;
    }
    if (_t10746._tag === 3) {
      const s = _t10746._val;
      _t10747 = (("{\"t\":\"s\",\"v\":" + __dict_Show_string.show(Serialize$json_escape_string(s))) + "}");
      break _t10748;
    }
    if (_t10746._tag === 4) {
      const n = _t10746._val;
      _t10747 = (("{\"t\":\"y\",\"v\":" + __dict_Show_int.show(n)) + "}");
      break _t10748;
    }
    if (_t10746._tag === 5) {
      const n = _t10746._val;
      _t10747 = (("{\"t\":\"r\",\"v\":" + __dict_Show_int.show(n)) + "}");
      break _t10748;
    }
    if (_t10746._tag === 6) {
      _t10747 = "{\"t\":\"u\"}";
      break _t10748;
    }
    if (_t10746._tag === 13) {
      const p = _t10746._val;
      _t10747 = (("{\"t\":\"p\",\"v\":" + __dict_Show_string.show(Serialize$serialize_prototype(p))) + "}");
      break _t10748;
    }
    if (_t10746._tag === 7) {
      const vs = _t10746._val;
      _t10747 = (("{\"t\":\"T\",\"v\":[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$serialize_value, Array$to_list(vs))))) + "]}");
      break _t10748;
    }
    if (_t10746._tag === 8) {
      const vs = _t10746._val;
      _t10747 = (("{\"t\":\"L\",\"v\":[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$serialize_value, vs)))) + "]}");
      break _t10748;
    }
    if (_t10746._tag === 10) {
      const tag = _t10746._val[0];
      const name = _t10746._val[1];
      const payload = _t10746._val[2];
      let _t10757;
      const _t10756 = payload;
      _t10758: {
        if (_t10756._tag === 0) {
          _t10757 = "null";
          break _t10758;
        }
        if (_t10756._tag === 1) {
          const v = _t10756._val;
          _t10757 = Serialize$serialize_value(v);
          break _t10758;
        }
        _match_fail("line 16190");
      }
      const payload_str_10759 = _t10757;
      const _t10760 = (((((("{\"t\":\"V\",\"tag\":" + __dict_Show_int.show(tag)) + ",\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(name))) + ",\"payload\":") + __dict_Show_string.show(payload_str_10759)) + "}");
      _t10747 = _t10760;
      break _t10748;
    }
    if (true) {
      _t10747 = failwith("serialize_value: unsupported value type in constants");
      break _t10748;
    }
    _match_fail("line 16190");
  }
  return _t10747;
}
function Serialize$serialize_prototype(proto) {
  const code_strs_10761 = Array$to_list(Array$map(Serialize$serialize_opcode, proto.code));
  const const_strs_10763 = Array$to_list(Array$map(Serialize$serialize_value, proto.constants));
  const line_strs_10765 = Array$to_list(Array$map(string_of_int, proto.line_table));
  const _t10766 = (((((((((((("{\"name\":" + __dict_Show_string.show(Serialize$json_escape_string(proto.name))) + ",\"arity\":") + __dict_Show_int.show(proto.arity)) + ",\"num_locals\":") + __dict_Show_int.show(proto.num_locals)) + ",\"code\":[") + __dict_Show_string.show(String$concat(",", code_strs_10761))) + "],\"constants\":[") + __dict_Show_string.show(String$concat(",", const_strs_10763))) + "],\"line_table\":[") + __dict_Show_string.show(String$concat(",", line_strs_10765))) + "]}");
  const _t10764 = _t10766;
  const _t10762 = _t10764;
  return _t10762;
}
function Serialize$serialize_native_global(idx, value) {
  let _t10768;
  const _t10767 = value;
  _t10769: {
    if (_t10767._tag === 14) {
      const ext = _t10767._val;
      _t10768 = ({_tag: 1, _name: "Some", _val: (((((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"external\",\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(ext.ext_name))) + ",\"arity\":") + __dict_Show_int.show(ext.ext_arity)) + "}")});
      break _t10769;
    }
    if (_t10767._tag === 9) {
      const shape = _t10767._val[0];
      const values = _t10767._val[1];
      function _t10770(v) {
        let _t10772;
        const _t10771 = v;
        _t10773: {
          if (_t10771._tag === 14) {
            _t10772 = true;
            break _t10773;
          }
          if (true) {
            _t10772 = false;
            break _t10773;
          }
          _match_fail("line 16190");
        }
        return _t10772;
      }
      const all_external_10774 = Array$forall(_t10770, values);
      let _t10776;
      if ((all_external_10774 && (Array$length(values) > 0))) {
        function _t10777(i) {
          const name_10778 = Array$get(shape.rs_fields, i);
          let _t10781;
          const _t10780 = Array$get(values, i);
          _t10782: {
            if (_t10780._tag === 14) {
              const ext = _t10780._val;
              _t10781 = (((((__dict_Show_string.show(Serialize$json_escape_string(name_10778)) + ":{\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(ext.ext_name))) + ",\"arity\":") + __dict_Show_int.show(ext.ext_arity)) + "}");
              break _t10782;
            }
            if (true) {
              _t10781 = failwith("assert false");
              break _t10782;
            }
            _match_fail("line 16190");
          }
          const _t10779 = _t10781;
          return _t10779;
        }
        const field_strs_10783 = List$init(Array$length(shape.rs_fields), _t10777);
        const _t10784 = ({_tag: 1, _name: "Some", _val: (((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"dict\",\"fields\":{") + __dict_Show_string.show(String$concat(",", field_strs_10783))) + "}}")});
        _t10776 = _t10784;
      } else {
        _t10776 = ({_tag: 0, _name: "None"});
      }
      const _t10775 = _t10776;
      _t10768 = _t10775;
      break _t10769;
    }
    if (true) {
      _t10768 = ({_tag: 0, _name: "None"});
      break _t10769;
    }
    _match_fail("line 16190");
  }
  return _t10768;
}
function Serialize$serialize_native_ext(__dict_Show_0, idx, name, arity) {
  return (((((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"external\",\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(name))) + ",\"arity\":") + __dict_Show_0.show(arity)) + "}");
}
function Serialize$serialize_native_dict(__dict_Show_0, idx, fields) {
  function _t10785(__p352) {
    let _t10787;
    const _t10786 = __p352;
    _t10788: {
      if (true) {
        const name = _t10786[0];
        const ext_name = _t10786[1];
        const arity = _t10786[2];
        _t10787 = (((((__dict_Show_string.show(Serialize$json_escape_string(name)) + ":{\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(ext_name))) + ",\"arity\":") + __dict_Show_0.show(arity)) + "}");
        break _t10788;
      }
      _match_fail("line 16190");
    }
    return _t10787;
  }
  const field_strs_10789 = List$map(_t10785, fields);
  const _t10790 = (((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"dict\",\"fields\":{") + __dict_Show_string.show(String$concat(",", field_strs_10789))) + "}}");
  return _t10790;
}
function Serialize$build_native_globals_json(globals) {
  const parts_10791 = Ref$create(null);
  function _t10793(idx, value) {
    let _t10795;
    const _t10794 = Serialize$serialize_native_global(idx, value);
    _t10796: {
      if (_t10794._tag === 1) {
        const s = _t10794._val;
        _t10795 = Ref$set(parts_10791, ({_hd: s, _tl: Ref$get(parts_10791)}));
        break _t10796;
      }
      if (_t10794._tag === 0) {
        _t10795 = undefined;
        break _t10796;
      }
      _match_fail("line 16190");
    }
    return _t10795;
  }
  Hashtbl$iter(_t10793, globals);
  const _t10792 = String$concat(",", Ref$get(parts_10791));
  return _t10792;
}
function Serialize$serialize_bundle(global_names, native_globals_json, setup_protos, main_proto) {
  const buf_10797 = Buffer$create(4096);
  Buffer$add_string(buf_10797, "{\"version\":1");
  const names_10799 = Dynarray$to_array(global_names);
  Buffer$add_string(buf_10797, ",\"global_names\":[");
  function _t10801(i, name) {
    let _t10802;
    if ((i > 0)) {
      _t10802 = Buffer$add_byte(buf_10797, 44);
    } else {
      _t10802 = undefined;
    }
    _t10802;
    return Buffer$add_string(buf_10797, Serialize$json_escape_string(name));
  }
  Array$iteri(_t10801, names_10799);
  Buffer$add_string(buf_10797, "]");
  Buffer$add_string(buf_10797, ",\"native_globals\":{");
  Buffer$add_string(buf_10797, native_globals_json);
  Buffer$add_string(buf_10797, "}");
  Buffer$add_string(buf_10797, ",\"setup\":[");
  function _t10803(i, proto) {
    let _t10804;
    if ((i > 0)) {
      _t10804 = Buffer$add_byte(buf_10797, 44);
    } else {
      _t10804 = undefined;
    }
    _t10804;
    return Buffer$add_string(buf_10797, Serialize$serialize_prototype(proto));
  }
  List$iteri(_t10803, setup_protos);
  Buffer$add_string(buf_10797, "]");
  Buffer$add_string(buf_10797, ",\"main\":");
  Buffer$add_string(buf_10797, Serialize$serialize_prototype(main_proto));
  Buffer$add_string(buf_10797, "}");
  const _t10800 = Buffer$contents(buf_10797);
  const _t10798 = _t10800;
  return _t10798;
}
function Js_codegen$error(msg) {
  return _trampoline(function() {
    return _h["codegen_error"](msg, function(_t10805) {
      return _bounce(function() {
        return _t10805;
      });
    });
  }, Js_codegen$error);
}
const Js_codegen$js_runtime = "\"use strict\";\nfunction _call(f, args) {\n  while (args.length > 0) {\n    const a = f._arity !== undefined ? f._arity : f.length;\n    if (a === 0) { f = f(); continue; }\n    if (args.length < a) return _partial(f, a, args);\n    const taken = args.splice(0, a);\n    f = f.apply(null, taken);\n  }\n  return f;\n}\nfunction _partial(fn, arity, args) {\n  const p = function() {\n    return _call(fn, args.concat(Array.from(arguments)));\n  };\n  p._arity = arity - args.length;\n  return p;\n}\nfunction _eq(a, b) {\n  if (a === b) return true;\n  if (a == null || b == null) return a === b;\n  if (typeof a !== \"object\") return false;\n  if (Array.isArray(a)) {\n    if (!Array.isArray(b) || a.length !== b.length) return false;\n    for (let i = 0; i < a.length; i++) if (!_eq(a[i], b[i])) return false;\n    return true;\n  }\n  if (\"_arr\" in a && \"_arr\" in b) {\n    if (a._arr.length !== b._arr.length) return false;\n    for (let i = 0; i < a._arr.length; i++) if (!_eq(a._arr[i], b._arr[i])) return false;\n    return true;\n  }\n  if (\"_hd\" in a && \"_hd\" in b) {\n    let ca = a, cb = b;\n    while (ca !== null && cb !== null) {\n      if (!(\"_hd\" in ca) || !(\"_hd\" in cb)) return ca === cb;\n      if (!_eq(ca._hd, cb._hd)) return false;\n      ca = ca._tl; cb = cb._tl;\n    }\n    return ca === cb;\n  }\n  if (\"_tag\" in a) return a._tag === b._tag && _eq(a._val, b._val);\n  if (\"_ref\" in a) return _eq(a._ref, b._ref);\n  const ka = Object.keys(a), kb = Object.keys(b);\n  if (ka.length !== kb.length) return false;\n  for (const k of ka) if (!_eq(a[k], b[k])) return false;\n  return true;\n}\nfunction _compare(a, b) {\n  if (a < b) return -1;\n  if (a > b) return 1;\n  return 0;\n}\nfunction _match_fail(loc) { throw new Error(\"Match failure at \" + loc); }\nfunction _pp(v) {\n  if (v === undefined) return \"()\";\n  if (v === null) return \"[]\";\n  if (typeof v === \"number\") {\n    if (!Number.isInteger(v)) {\n      const s = String(v);\n      return s.includes(\".\") || s.includes(\"e\") ? s : s + \".\";\n    }\n    return String(v);\n  }\n  if (typeof v === \"boolean\") return String(v);\n  if (typeof v === \"string\") return v;\n  if (Array.isArray(v)) return \"(\" + v.map(_pp).join(\", \") + \")\";\n  if (v !== null && typeof v === \"object\") {\n    if (\"_arr\" in v) return \"#[\" + v._arr.map(_pp).join(\"; \") + \"]\";\n    if (\"_hd\" in v) {\n      const r = [];\n      let c = v;\n      while (c !== null && typeof c === \"object\" && \"_hd\" in c) { r.push(_pp(c._hd)); c = c._tl; }\n      return \"[\" + r.join(\"; \") + \"]\";\n    }\n    if (\"_tag\" in v) {\n      if (v._val !== undefined) {\n        const pv = _pp(v._val);\n        if (Array.isArray(v._val) || (typeof v._val === \"object\" && v._val !== null && \"_tag\" in v._val && v._val._val !== undefined))\n          return v._name + \" (\" + pv + \")\";\n        return v._name + \" \" + pv;\n      }\n      return v._name;\n    }\n    if (\"_ref\" in v) return \"ref(\" + _pp(v._ref) + \")\";\n    if (v instanceof Map) {\n      const entries = Array.from(v.entries());\n      const isSet = entries.every(([_,val]) => val === undefined);\n      if (isSet) return \"#{\" + entries.map(([k]) => _pp(k)).join(\"; \") + \"}\";\n      return \"#{\" + entries.map(([k,val]) => _pp(k) + \": \" + _pp(val)).join(\"; \") + \"}\";\n    }\n    return \"{ \" + Object.entries(v).map(([k,val]) => k + \" = \" + _pp(val)).join(\"; \") + \" }\";\n  }\n  return String(v);\n}\nlet _h = {};\nfunction _bounce(fn) { fn._tramp = true; return fn; }\nconst _trampolining = new Set();\nfunction _trampoline(fn, tag) {\n  if (tag !== undefined && _trampolining.has(tag)) return fn();\n  if (tag !== undefined) _trampolining.add(tag);\n  try {\n    let result = fn();\n    while (typeof result === 'function' && result._tramp) {\n      result = result();\n    }\n    return result;\n  } finally { if (tag !== undefined) _trampolining.delete(tag); }\n}\nfunction _resolve(v) { while (typeof v === 'function' && v._tramp) v = v(); return v; }\n";
const Js_codegen$js_reserved = ({_hd: "abstract", _tl: ({_hd: "arguments", _tl: ({_hd: "await", _tl: ({_hd: "boolean", _tl: ({_hd: "break", _tl: ({_hd: "byte", _tl: ({_hd: "case", _tl: ({_hd: "catch", _tl: ({_hd: "char", _tl: ({_hd: "class", _tl: ({_hd: "const", _tl: ({_hd: "continue", _tl: ({_hd: "debugger", _tl: ({_hd: "default", _tl: ({_hd: "delete", _tl: ({_hd: "do", _tl: ({_hd: "double", _tl: ({_hd: "else", _tl: ({_hd: "enum", _tl: ({_hd: "eval", _tl: ({_hd: "export", _tl: ({_hd: "extends", _tl: ({_hd: "false", _tl: ({_hd: "final", _tl: ({_hd: "finally", _tl: ({_hd: "float", _tl: ({_hd: "for", _tl: ({_hd: "function", _tl: ({_hd: "goto", _tl: ({_hd: "if", _tl: ({_hd: "implements", _tl: ({_hd: "import", _tl: ({_hd: "in", _tl: ({_hd: "instanceof", _tl: ({_hd: "int", _tl: ({_hd: "interface", _tl: ({_hd: "let", _tl: ({_hd: "long", _tl: ({_hd: "native", _tl: ({_hd: "new", _tl: ({_hd: "null", _tl: ({_hd: "package", _tl: ({_hd: "private", _tl: ({_hd: "protected", _tl: ({_hd: "public", _tl: ({_hd: "return", _tl: ({_hd: "short", _tl: ({_hd: "static", _tl: ({_hd: "super", _tl: ({_hd: "switch", _tl: ({_hd: "synchronized", _tl: ({_hd: "this", _tl: ({_hd: "throw", _tl: ({_hd: "throws", _tl: ({_hd: "transient", _tl: ({_hd: "true", _tl: ({_hd: "try", _tl: ({_hd: "typeof", _tl: ({_hd: "undefined", _tl: ({_hd: "var", _tl: ({_hd: "void", _tl: ({_hd: "volatile", _tl: ({_hd: "while", _tl: ({_hd: "with", _tl: ({_hd: "yield", _tl: ({_hd: "of", _tl: null})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})});
function Js_codegen$is_js_reserved(name) {
  return List$mem(name, Js_codegen$js_reserved);
}
function Js_codegen$mangle_name(name) {
  const buf_10806 = Buffer$create(String$length(name));
  function _t10808(c) {
    let _t10810;
    const _t10809 = c;
    _t10811: {
      if (true) {
        const _c = _t10809;
        if ((_c === 46)) {
          _t10810 = Buffer$add_byte(buf_10806, 36);
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 39)) {
          _t10810 = Buffer$add_string(buf_10806, "$p");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 43)) {
          _t10810 = Buffer$add_string(buf_10806, "$plus");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 45)) {
          _t10810 = Buffer$add_string(buf_10806, "$minus");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 42)) {
          _t10810 = Buffer$add_string(buf_10806, "$star");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 47)) {
          _t10810 = Buffer$add_string(buf_10806, "$slash");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 94)) {
          _t10810 = Buffer$add_string(buf_10806, "$caret");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 61)) {
          _t10810 = Buffer$add_string(buf_10806, "$eq");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 60)) {
          _t10810 = Buffer$add_string(buf_10806, "$lt");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 62)) {
          _t10810 = Buffer$add_string(buf_10806, "$gt");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 33)) {
          _t10810 = Buffer$add_string(buf_10806, "$bang");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 58)) {
          _t10810 = Buffer$add_string(buf_10806, "$colon");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 126)) {
          _t10810 = Buffer$add_string(buf_10806, "$tilde");
          break _t10811;
        }
      }
      if (true) {
        const _c = _t10809;
        if ((_c === 35)) {
          _t10810 = Buffer$add_string(buf_10806, "$hash");
          break _t10811;
        }
      }
      if (true) {
        const c = _t10809;
        _t10810 = Buffer$add_byte(buf_10806, c);
        break _t10811;
      }
      _match_fail("line 16190");
    }
    return _t10810;
  }
  String$iter(_t10808, name);
  const result_10812 = Buffer$contents(buf_10806);
  let _t10814;
  if (Js_codegen$is_js_reserved(result_10812)) {
    _t10814 = ("_mml$" + result_10812);
  } else {
    _t10814 = result_10812;
  }
  const _t10813 = _t10814;
  const _t10807 = _t10813;
  return _t10807;
}
function Js_codegen$create_ctx(type_env) {
  const tbl_10815 = Hashtbl$create(16);
  const _t10816 = ({break_flag_name: "_break_flag", break_val_name: "_break_val", buf: Buffer$create(4096), current_fn_name: ({_tag: 0, _name: "None"}), current_fn_params: null, current_module: ({_tag: 0, _name: "None"}), direct_dispatch_ops: null, handler_tail_resume: false, in_cps: false, in_tail_position: false, indent: 0, scopes: ({_hd: tbl_10815, _tl: null}), tco_used: false, tmp_counter: 0, top_level_exports: null, trywith_ops: null, type_env: type_env});
  return _t10816;
}
function Js_codegen$push_scope(ctx) {
  return (ctx.scopes = ({_hd: Hashtbl$create(8), _tl: ctx.scopes}), undefined);
}
function Js_codegen$pop_scope(ctx) {
  let _t10818;
  const _t10817 = ctx.scopes;
  _t10819: {
    if (_t10817 !== null) {
      const rest = _t10817._tl;
      _t10818 = (ctx.scopes = rest, undefined);
      break _t10819;
    }
    if (_t10817 === null) {
      _t10818 = failwith("pop_scope: empty");
      break _t10819;
    }
    _match_fail("line 16190");
  }
  return _t10818;
}
function Js_codegen$bind_var(ctx, mml_name, js_name) {
  let _t10821;
  const _t10820 = ctx.scopes;
  _t10822: {
    if (_t10820 !== null) {
      const tbl = _t10820._hd;
      _t10821 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tbl, mml_name, js_name]);
      break _t10822;
    }
    if (_t10820 === null) {
      _t10821 = failwith("bind_var: empty scope");
      break _t10822;
    }
    _match_fail("line 16190");
  }
  return _t10821;
}
function Js_codegen$lookup_var(ctx, name) {
  function search(__x) {
    while (true) {
      let _t10824;
      const _t10823 = __x;
      _t10825: {
        if (_t10823 === null) {
          _t10824 = Js_codegen$mangle_name(name);
          break _t10825;
        }
        if (_t10823 !== null) {
          const tbl = _t10823._hd;
          const rest = _t10823._tl;
          let _t10827;
          const _t10826 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tbl, name]);
          _t10828: {
            if (_t10826._tag === 1) {
              const js = _t10826._val;
              _t10827 = js;
              break _t10828;
            }
            if (_t10826._tag === 0) {
              const _t10829 = rest;
              __x = _t10829;
              continue;
              _t10827 = undefined;
              break _t10828;
            }
            _match_fail("line 16190");
          }
          _t10824 = _t10827;
          break _t10825;
        }
        _match_fail("line 16190");
      }
      return _t10824;
    }
  }
  const _t10830 = search(ctx.scopes);
  return _t10830;
}
function Js_codegen$fresh_tmp(ctx) {
  const n_10831 = ctx.tmp_counter;
  (ctx.tmp_counter = (n_10831 + 1), undefined);
  const _t10832 = ("_t" + __dict_Show_int.show(n_10831));
  return _t10832;
}
function Js_codegen$dedup_js_params(params) {
  const seen_10833 = Hashtbl$create(8);
  function _t10835(p) {
    let _t10837;
    const _t10836 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, seen_10833, p]);
    _t10838: {
      if (_t10836._tag === 1) {
        const n = _t10836._val;
        _t10837 = n;
        break _t10838;
      }
      if (_t10836._tag === 0) {
        _t10837 = 0;
        break _t10838;
      }
      _match_fail("line 16190");
    }
    const count_10839 = _t10837;
    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, seen_10833, p, (count_10839 + 1)]);
    let _t10841;
    if ((count_10839 === 0)) {
      _t10841 = p;
    } else {
      _t10841 = (p + ("_" + string_of_int((count_10839 + 1))));
    }
    const _t10840 = _t10841;
    return _t10840;
  }
  const _t10834 = List$map(_t10835, params);
  return _t10834;
}
function Js_codegen$emit(ctx, s) {
  return Buffer$add_string(ctx.buf, s);
}
function Js_codegen$emit_indent(ctx) {
  let _loop_var_10842 = 1;
  let _t10844 = undefined;
  let _t10845 = false, _t10846;
  while (true) {
    if (!((_loop_var_10842 <= ctx.indent))) break;
    Buffer$add_string(ctx.buf, "  ");
    (_loop_var_10842 = (_loop_var_10842 + 1), undefined);
    if (_t10845) break;
  }
  _t10844 = _t10845 ? _t10846 : undefined;
  const _t10843 = _t10844;
  return _t10843;
}
function Js_codegen$emit_line(ctx, s) {
  Js_codegen$emit_indent(ctx);
  Js_codegen$emit(ctx, s);
  return Js_codegen$emit(ctx, "\n");
}
function Js_codegen$escape_js_string(s) {
  const buf_10847 = Buffer$create((String$length(s) + 2));
  Buffer$add_byte(buf_10847, 34);
  function _t10849(c) {
    let _t10851;
    const _t10850 = c;
    _t10852: {
      if (true) {
        const _c = _t10850;
        if ((_c === 34)) {
          _t10851 = Buffer$add_string(buf_10847, "\\\"");
          break _t10852;
        }
      }
      if (true) {
        const _c = _t10850;
        if ((_c === 92)) {
          _t10851 = Buffer$add_string(buf_10847, "\\\\");
          break _t10852;
        }
      }
      if (true) {
        const _c = _t10850;
        if ((_c === 10)) {
          _t10851 = Buffer$add_string(buf_10847, "\\n");
          break _t10852;
        }
      }
      if (true) {
        const _c = _t10850;
        if ((_c === 13)) {
          _t10851 = Buffer$add_string(buf_10847, "\\r");
          break _t10852;
        }
      }
      if (true) {
        const _c = _t10850;
        if ((_c === 9)) {
          _t10851 = Buffer$add_string(buf_10847, "\\t");
          break _t10852;
        }
      }
      if (true) {
        const c = _t10850;
        if ((Byte$to_int(c) < 32)) {
          _t10851 = Buffer$add_string(buf_10847, ("\\x" + __fmt_zero_pad(2, __fmt_hex(Byte$to_int(c)))));
          break _t10852;
        }
      }
      if (true) {
        const c = _t10850;
        _t10851 = Buffer$add_byte(buf_10847, c);
        break _t10852;
      }
      _match_fail("line 16190");
    }
    return _t10851;
  }
  String$iter(_t10849, s);
  Buffer$add_byte(buf_10847, 34);
  const _t10848 = Buffer$contents(buf_10847);
  return _t10848;
}
function Js_codegen$tag_for_constructor(type_env, name) {
  let _t10854;
  const _t10853 = List$assoc_opt(name, type_env.constructors);
  _t10855: {
    if (_t10853._tag === 0) {
      _t10854 = Js_codegen$error(("unknown constructor: " + __dict_Show_string.show(name)));
      break _t10855;
    }
    if (_t10853._tag === 1) {
      const info = _t10853._val;
      function _t10856(__p353) {
        let _t10858;
        const _t10857 = __p353;
        _t10859: {
          if (true) {
            const n = _t10857[0];
            _t10858 = (n === info.ctor_type_name);
            break _t10859;
          }
          _match_fail("line 16190");
        }
        return _t10858;
      }
      let _t10861;
      const _t10860 = list_find(_t10856, type_env.variants);
      _t10862: {
        if (true) {
          const variant_def = _t10860[2];
          let _t10864;
          const _t10863 = String$rindex_opt(name, 46);
          _t10865: {
            if (_t10863._tag === 1) {
              const i = _t10863._val;
              _t10864 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
              break _t10865;
            }
            if (_t10863._tag === 0) {
              _t10864 = name;
              break _t10865;
            }
            _match_fail("line 16190");
          }
          const short_name_10866 = _t10864;
          function find_tag(idx, __x) {
            while (true) {
              let _t10869;
              const _t10868 = __x;
              _t10870: {
                if (_t10868 === null) {
                  _t10869 = Js_codegen$error((("constructor " + __dict_Show_string.show(name)) + " not found in variant"));
                  break _t10870;
                }
                if (_t10868 !== null) {
                  const cname = _t10868._hd[0];
                  if ((cname === short_name_10866)) {
                    _t10869 = idx;
                    break _t10870;
                  }
                }
                if (_t10868 !== null) {
                  const rest = _t10868._tl;
                  const _t10871 = (idx + 1);
                  const _t10872 = rest;
                  idx = _t10871;
                  __x = _t10872;
                  continue;
                  _t10869 = undefined;
                  break _t10870;
                }
                _match_fail("line 16190");
              }
              return _t10869;
            }
          }
          const _t10873 = find_tag(0, variant_def);
          const _t10867 = _t10873;
          _t10861 = _t10867;
          break _t10862;
        }
        _match_fail("line 16190");
      }
      _t10854 = _t10861;
      break _t10855;
    }
    _match_fail("line 16190");
  }
  return _t10854;
}
function Js_codegen$short_constructor_name(name) {
  let _t10875;
  const _t10874 = String$rindex_opt(name, 46);
  _t10876: {
    if (_t10874._tag === 1) {
      const i = _t10874._val;
      _t10875 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
      break _t10876;
    }
    if (_t10874._tag === 0) {
      _t10875 = name;
      break _t10876;
    }
    _match_fail("line 16190");
  }
  return _t10875;
}
function Js_codegen$expr_has_perform(te) {
  while (true) {
    let _t10878;
    const _t10877 = te.expr;
    _t10879: {
      if (_t10877._tag === 29) {
        _t10878 = true;
        break _t10879;
      }
      if (_t10877._tag === 31) {
        _t10878 = true;
        break _t10879;
      }
      if ((_t10877._tag === 8 || _t10877._tag === 28)) {
        const e1 = (_t10877._tag === 8 ? _t10877._val[2] : _t10877._val[0]);
        const e2 = (_t10877._tag === 8 ? _t10877._val[3] : _t10877._val[1]);
        _t10878 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t10879;
      }
      if (_t10877._tag === 12) {
        const cond = _t10877._val[0];
        const e1 = _t10877._val[1];
        const e2 = _t10877._val[2];
        _t10878 = (Js_codegen$expr_has_perform(cond) || (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2)));
        break _t10879;
      }
      if (_t10877._tag === 24) {
        const scrut = _t10877._val[0];
        const arms = _t10877._val[1];
        let _t10888;
        if (Js_codegen$expr_has_perform(scrut)) {
          _t10888 = true;
        } else {
        function _t10880(__p354) {
          let _t10882;
          const _t10881 = __p354;
          _t10883: {
            if (true) {
              const g = _t10881[1];
              const body = _t10881[2];
              let _t10887;
              if (Js_codegen$expr_has_perform(body)) {
                _t10887 = true;
              } else {
              let _t10885;
              const _t10884 = g;
              _t10886: {
                if (_t10884._tag === 1) {
                  const g = _t10884._val;
                  _t10885 = Js_codegen$expr_has_perform(g);
                  break _t10886;
                }
                if (_t10884._tag === 0) {
                  _t10885 = false;
                  break _t10886;
                }
                _match_fail("line 16190");
              }
                _t10887 = _t10885;
              }
              _t10882 = _t10887;
              break _t10883;
            }
            _match_fail("line 16190");
          }
          return _t10882;
        }
          _t10888 = List$exists(_t10880, arms);
        }
        _t10878 = _t10888;
        break _t10879;
      }
      if (_t10877._tag === 9) {
        const fn_e = _t10877._val[2];
        const body = _t10877._val[3];
        _t10878 = (Js_codegen$expr_has_perform(fn_e) || Js_codegen$expr_has_perform(body));
        break _t10879;
      }
      if (_t10877._tag === 37) {
        const bindings = _t10877._val[0];
        const body = _t10877._val[1];
        function _t10889(__p355) {
          let _t10891;
          const _t10890 = __p355;
          _t10892: {
            if (true) {
              const e = _t10890[1];
              _t10891 = Js_codegen$expr_has_perform(e);
              break _t10892;
            }
            _match_fail("line 16190");
          }
          return _t10891;
        }
        _t10878 = (List$exists(_t10889, bindings) || Js_codegen$expr_has_perform(body));
        break _t10879;
      }
      if (_t10877._tag === 10) {
        const body = _t10877._val[1];
        const _t10893 = body;
        te = _t10893;
        continue;
        _t10878 = undefined;
        break _t10879;
      }
      if (_t10877._tag === 11) {
        const fn_ = _t10877._val[0];
        const arg = _t10877._val[1];
        _t10878 = (Js_codegen$expr_has_perform(fn_) || Js_codegen$expr_has_perform(arg));
        break _t10879;
      }
      if (_t10877._tag === 30) {
        const body = _t10877._val[0];
        const arms = _t10877._val[1];
        let _t10898;
        if (Js_codegen$expr_has_perform(body)) {
          _t10898 = true;
        } else {
        function _t10894(arm) {
          let _t10896;
          const _t10895 = arm;
          _t10897: {
            if ((((_t10895._tag === 0 || _t10895._tag === 1) || _t10895._tag === 2) || _t10895._tag === 3)) {
              const e = (((_t10895._tag === 0 || _t10895._tag === 1) || _t10895._tag === 2) ? ((_t10895._tag === 0 || _t10895._tag === 1) ? (_t10895._tag === 0 ? _t10895._val[1] : _t10895._val[3]) : _t10895._val[2]) : _t10895._val[2]);
              _t10896 = Js_codegen$expr_has_perform(e);
              break _t10897;
            }
            _match_fail("line 16190");
          }
          return _t10896;
        }
          _t10898 = List$exists(_t10894, arms);
        }
        _t10878 = _t10898;
        break _t10879;
      }
      if (_t10877._tag === 25) {
        const e1 = _t10877._val[1];
        const e2 = _t10877._val[2];
        _t10878 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t10879;
      }
      if (_t10877._tag === 32) {
        const c = _t10877._val[0];
        const b = _t10877._val[1];
        _t10878 = (Js_codegen$expr_has_perform(c) || Js_codegen$expr_has_perform(b));
        break _t10879;
      }
      if (_t10877._tag === 21) {
        const e1 = _t10877._val[0];
        const e2 = _t10877._val[1];
        _t10878 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t10879;
      }
      if (_t10877._tag === 15) {
        const es = _t10877._val;
        _t10878 = List$exists(Js_codegen$expr_has_perform, es);
        break _t10879;
      }
      if (_t10877._tag === 16) {
        const fields = _t10877._val;
        function _t10899(__p356) {
          let _t10901;
          const _t10900 = __p356;
          _t10902: {
            if (true) {
              const e = _t10900[1];
              _t10901 = Js_codegen$expr_has_perform(e);
              break _t10902;
            }
            _match_fail("line 16190");
          }
          return _t10901;
        }
        _t10878 = List$exists(_t10899, fields);
        break _t10879;
      }
      if (_t10877._tag === 13) {
        const e1 = _t10877._val[1];
        const e2 = _t10877._val[2];
        _t10878 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t10879;
      }
      if (_t10877._tag === 14) {
        const e = _t10877._val[1];
        const _t10903 = e;
        te = _t10903;
        continue;
        _t10878 = undefined;
        break _t10879;
      }
      if (true) {
        _t10878 = false;
        break _t10879;
      }
      _match_fail("line 16190");
    }
    return _t10878;
  }
}
function Js_codegen$all_resumes_are_tail(te) {
  while (true) {
    let _t10905;
    const _t10904 = te.expr;
    _t10906: {
      if (_t10904._tag === 31) {
        _t10905 = true;
        break _t10906;
      }
      if (_t10904._tag === 28) {
        const e2 = _t10904._val[1];
        const _t10907 = e2;
        te = _t10907;
        continue;
        _t10905 = undefined;
        break _t10906;
      }
      if (_t10904._tag === 8) {
        const e1 = _t10904._val[2];
        const e2 = _t10904._val[3];
        _t10905 = ((!Js_codegen$expr_has_perform(e1)) && Js_codegen$all_resumes_are_tail(e2));
        break _t10906;
      }
      if (_t10904._tag === 9) {
        const e2 = _t10904._val[3];
        const _t10908 = e2;
        te = _t10908;
        continue;
        _t10905 = undefined;
        break _t10906;
      }
      if (_t10904._tag === 25) {
        const e1 = _t10904._val[1];
        const e2 = _t10904._val[2];
        _t10905 = ((!Js_codegen$expr_has_perform(e1)) && Js_codegen$all_resumes_are_tail(e2));
        break _t10906;
      }
      if (_t10904._tag === 12) {
        const then_e = _t10904._val[1];
        const else_e = _t10904._val[2];
        _t10905 = (Js_codegen$all_resumes_are_tail(then_e) && Js_codegen$all_resumes_are_tail(else_e));
        break _t10906;
      }
      if (_t10904._tag === 24) {
        const arms = _t10904._val[1];
        function _t10909(__p357) {
          let _t10911;
          const _t10910 = __p357;
          _t10912: {
            if (true) {
              const body = _t10910[2];
              _t10911 = Js_codegen$all_resumes_are_tail(body);
              break _t10912;
            }
            _match_fail("line 16190");
          }
          return _t10911;
        }
        _t10905 = List$forall(_t10909, arms);
        break _t10906;
      }
      if (true) {
        _t10905 = true;
        break _t10906;
      }
      _match_fail("line 16190");
    }
    return _t10905;
  }
}
function Js_codegen$expr_has_unhandled_perform(handled_ops, te) {
  while (true) {
    let _t10914;
    const _t10913 = te.expr;
    _t10915: {
      if (_t10913._tag === 29) {
        const op_name = _t10913._val[0];
        _t10914 = (!List$mem(op_name, handled_ops));
        break _t10915;
      }
      if (_t10913._tag === 31) {
        _t10914 = true;
        break _t10915;
      }
      if ((_t10913._tag === 8 || _t10913._tag === 28)) {
        const e1 = (_t10913._tag === 8 ? _t10913._val[2] : _t10913._val[0]);
        const e2 = (_t10913._tag === 8 ? _t10913._val[3] : _t10913._val[1]);
        _t10914 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t10915;
      }
      if (_t10913._tag === 12) {
        const cond = _t10913._val[0];
        const e1 = _t10913._val[1];
        const e2 = _t10913._val[2];
        _t10914 = (Js_codegen$expr_has_unhandled_perform(handled_ops, cond) || (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2)));
        break _t10915;
      }
      if (_t10913._tag === 24) {
        const scrut = _t10913._val[0];
        const arms = _t10913._val[1];
        let _t10924;
        if (Js_codegen$expr_has_unhandled_perform(handled_ops, scrut)) {
          _t10924 = true;
        } else {
        function _t10916(__p358) {
          let _t10918;
          const _t10917 = __p358;
          _t10919: {
            if (true) {
              const g = _t10917[1];
              const body = _t10917[2];
              let _t10923;
              if (Js_codegen$expr_has_unhandled_perform(handled_ops, body)) {
                _t10923 = true;
              } else {
              let _t10921;
              const _t10920 = g;
              _t10922: {
                if (_t10920._tag === 1) {
                  const g = _t10920._val;
                  _t10921 = Js_codegen$expr_has_unhandled_perform(handled_ops, g);
                  break _t10922;
                }
                if (_t10920._tag === 0) {
                  _t10921 = false;
                  break _t10922;
                }
                _match_fail("line 16190");
              }
                _t10923 = _t10921;
              }
              _t10918 = _t10923;
              break _t10919;
            }
            _match_fail("line 16190");
          }
          return _t10918;
        }
          _t10924 = List$exists(_t10916, arms);
        }
        _t10914 = _t10924;
        break _t10915;
      }
      if (_t10913._tag === 9) {
        const fn_e = _t10913._val[2];
        const body = _t10913._val[3];
        _t10914 = (Js_codegen$expr_has_unhandled_perform(handled_ops, fn_e) || Js_codegen$expr_has_unhandled_perform(handled_ops, body));
        break _t10915;
      }
      if (_t10913._tag === 37) {
        const bindings = _t10913._val[0];
        const body = _t10913._val[1];
        function _t10925(__p359) {
          let _t10927;
          const _t10926 = __p359;
          _t10928: {
            if (true) {
              const e = _t10926[1];
              _t10927 = Js_codegen$expr_has_unhandled_perform(handled_ops, e);
              break _t10928;
            }
            _match_fail("line 16190");
          }
          return _t10927;
        }
        _t10914 = (List$exists(_t10925, bindings) || Js_codegen$expr_has_unhandled_perform(handled_ops, body));
        break _t10915;
      }
      if (_t10913._tag === 10) {
        const body = _t10913._val[1];
        const _t10929 = handled_ops;
        const _t10930 = body;
        handled_ops = _t10929;
        te = _t10930;
        continue;
        _t10914 = undefined;
        break _t10915;
      }
      if (_t10913._tag === 11) {
        const fn_ = _t10913._val[0];
        const arg = _t10913._val[1];
        _t10914 = (Js_codegen$expr_has_unhandled_perform(handled_ops, fn_) || Js_codegen$expr_has_unhandled_perform(handled_ops, arg));
        break _t10915;
      }
      if (_t10913._tag === 30) {
        const body = _t10913._val[0];
        const arms = _t10913._val[1];
        let _t10935;
        if (Js_codegen$expr_has_unhandled_perform(handled_ops, body)) {
          _t10935 = true;
        } else {
        function _t10931(arm) {
          let _t10933;
          const _t10932 = arm;
          _t10934: {
            if ((((_t10932._tag === 0 || _t10932._tag === 1) || _t10932._tag === 2) || _t10932._tag === 3)) {
              const e = (((_t10932._tag === 0 || _t10932._tag === 1) || _t10932._tag === 2) ? ((_t10932._tag === 0 || _t10932._tag === 1) ? (_t10932._tag === 0 ? _t10932._val[1] : _t10932._val[3]) : _t10932._val[2]) : _t10932._val[2]);
              _t10933 = Js_codegen$expr_has_unhandled_perform(handled_ops, e);
              break _t10934;
            }
            _match_fail("line 16190");
          }
          return _t10933;
        }
          _t10935 = List$exists(_t10931, arms);
        }
        _t10914 = _t10935;
        break _t10915;
      }
      if (_t10913._tag === 25) {
        const e1 = _t10913._val[1];
        const e2 = _t10913._val[2];
        _t10914 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t10915;
      }
      if (_t10913._tag === 32) {
        const c = _t10913._val[0];
        const b = _t10913._val[1];
        _t10914 = (Js_codegen$expr_has_unhandled_perform(handled_ops, c) || Js_codegen$expr_has_unhandled_perform(handled_ops, b));
        break _t10915;
      }
      if (_t10913._tag === 21) {
        const e1 = _t10913._val[0];
        const e2 = _t10913._val[1];
        _t10914 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t10915;
      }
      if (_t10913._tag === 15) {
        const es = _t10913._val;
        _t10914 = List$exists(_call(Js_codegen$expr_has_unhandled_perform, [handled_ops]), es);
        break _t10915;
      }
      if (_t10913._tag === 16) {
        const fields = _t10913._val;
        function _t10936(__p360) {
          let _t10938;
          const _t10937 = __p360;
          _t10939: {
            if (true) {
              const e = _t10937[1];
              _t10938 = Js_codegen$expr_has_unhandled_perform(handled_ops, e);
              break _t10939;
            }
            _match_fail("line 16190");
          }
          return _t10938;
        }
        _t10914 = List$exists(_t10936, fields);
        break _t10915;
      }
      if (_t10913._tag === 13) {
        const e1 = _t10913._val[1];
        const e2 = _t10913._val[2];
        _t10914 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t10915;
      }
      if (_t10913._tag === 14) {
        const e = _t10913._val[1];
        const _t10940 = handled_ops;
        const _t10941 = e;
        handled_ops = _t10940;
        te = _t10941;
        continue;
        _t10914 = undefined;
        break _t10915;
      }
      if (true) {
        _t10914 = false;
        break _t10915;
      }
      _match_fail("line 16190");
    }
    return _t10914;
  }
}
function Js_codegen$is_exportable_name(name) {
  return (!((String$length(name) >= 2) && ((String$get(name, 0) === 95) && (String$get(name, 1) === 95))));
}
function Js_codegen$compile_non_tail(ctx, te) {
  const saved_10942 = ctx.in_tail_position;
  (ctx.in_tail_position = false, undefined);
  const r_10944 = Js_codegen$compile_expr(ctx, te);
  (ctx.in_tail_position = saved_10942, undefined);
  const _t10945 = r_10944;
  const _t10943 = _t10945;
  return _t10943;
}
function Js_codegen$compile_expr(ctx, te) {
  while (true) {
    let _t10947;
    const _t10946 = te.expr;
    _t10948: {
      if (_t10946._tag === 0) {
        const n = _t10946._val;
        let _t10949;
        if ((n < 0)) {
          _t10949 = (("(" + __dict_Show_int.show(n)) + ")");
        } else {
          _t10949 = string_of_int(n);
        }
        _t10947 = _t10949;
        break _t10948;
      }
      if (_t10946._tag === 1) {
        const f = _t10946._val;
        const s_10950 = __dict_Show_float.show(f);
        let _t10952;
        if ((String$contains(".", s_10950) || (String$contains("e", s_10950) || String$contains("i", s_10950)))) {
          _t10952 = s_10950;
        } else {
          _t10952 = (s_10950 + ".0");
        }
        const _t10951 = _t10952;
        _t10947 = _t10951;
        break _t10948;
      }
      if (_t10946._tag === 2 && _t10946._val) {
        _t10947 = "true";
        break _t10948;
      }
      if (_t10946._tag === 2 && !_t10946._val) {
        _t10947 = "false";
        break _t10948;
      }
      if (_t10946._tag === 3) {
        const s = _t10946._val;
        _t10947 = Js_codegen$escape_js_string(s);
        break _t10948;
      }
      if (_t10946._tag === 4) {
        const n = _t10946._val;
        _t10947 = string_of_int(n);
        break _t10948;
      }
      if (_t10946._tag === 5) {
        const n = _t10946._val;
        _t10947 = string_of_int(n);
        break _t10948;
      }
      if (_t10946._tag === 6) {
        _t10947 = "undefined";
        break _t10948;
      }
      if (_t10946._tag === 22) {
        _t10947 = "null";
        break _t10948;
      }
      if (_t10946._tag === 7) {
        const name = _t10946._val;
        _t10947 = Js_codegen$lookup_var(ctx, name);
        break _t10948;
      }
      if (_t10946._tag === 8) {
        const name = _t10946._val[0];
        const _scheme = _t10946._val[1];
        const e1 = _t10946._val[2];
        const e2 = _t10946._val[3];
        _t10947 = Js_codegen$compile_let(ctx, name, e1, e2);
        break _t10948;
      }
      if (_t10946._tag === 9) {
        const name = _t10946._val[0];
        const _scheme = _t10946._val[1];
        const fn_expr = _t10946._val[2];
        const body = _t10946._val[3];
        _t10947 = Js_codegen$compile_letrec(ctx, name, fn_expr, body);
        break _t10948;
      }
      if (_t10946._tag === 37) {
        const bindings = _t10946._val[0];
        const body = _t10946._val[1];
        _t10947 = Js_codegen$compile_letrec_and(ctx, bindings, body);
        break _t10948;
      }
      if (_t10946._tag === 10) {
        const param = _t10946._val[0];
        const body = _t10946._val[1];
        const _has_return = _t10946._val[2];
        _t10947 = Js_codegen$compile_fun(ctx, param, body);
        break _t10948;
      }
      if (_t10946._tag === 11) {
        const fn_ = _t10946._val[0];
        const arg = _t10946._val[1];
        _t10947 = Js_codegen$compile_app(ctx, te, fn_, arg);
        break _t10948;
      }
      if (_t10946._tag === 13) {
        const op = _t10946._val[0];
        const e1 = _t10946._val[1];
        const e2 = _t10946._val[2];
        _t10947 = Js_codegen$compile_binop(ctx, op, e1, e2);
        break _t10948;
      }
      if (_t10946._tag === 14) {
        const op = _t10946._val[0];
        const e = _t10946._val[1];
        _t10947 = Js_codegen$compile_unop(ctx, op, e);
        break _t10948;
      }
      if (_t10946._tag === 12) {
        const cond = _t10946._val[0];
        const then_e = _t10946._val[1];
        const else_e = _t10946._val[2];
        _t10947 = Js_codegen$compile_if(ctx, cond, then_e, else_e);
        break _t10948;
      }
      if (_t10946._tag === 15) {
        const exprs = _t10946._val;
        const elts_10953 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), exprs);
        const _t10954 = ("[" + (String$concat(", ", elts_10953) + "]"));
        _t10947 = _t10954;
        break _t10948;
      }
      if (_t10946._tag === 16) {
        const fields = _t10946._val;
        function _t10955(__p361, __p362) {
          let _t10957;
          const _t10956 = __p361;
          _t10958: {
            if (true) {
              const a = _t10956[0];
              let _t10960;
              const _t10959 = __p362;
              _t10961: {
                if (true) {
                  const b = _t10959[0];
                  _t10960 = String$compare(a, b);
                  break _t10961;
                }
                _match_fail("line 16190");
              }
              _t10957 = _t10960;
              break _t10958;
            }
            _match_fail("line 16190");
          }
          return _t10957;
        }
        const sorted_10962 = List$sort(_t10955, fields);
        function _t10964(__p363) {
          let _t10966;
          const _t10965 = __p363;
          _t10967: {
            if (true) {
              const name = _t10965[0];
              const e = _t10965[1];
              const js_name_10968 = Js_codegen$mangle_name(name);
              const v_10970 = Js_codegen$compile_non_tail(ctx, e);
              let _t10972;
              if ((js_name_10968 === name)) {
                _t10972 = (name + (": " + v_10970));
              } else {
                _t10972 = ((__dict_Show_string.show(js_name_10968) + ": ") + __dict_Show_string.show(v_10970));
              }
              const _t10971 = _t10972;
              const _t10969 = _t10971;
              _t10966 = _t10969;
              break _t10967;
            }
            _match_fail("line 16190");
          }
          return _t10966;
        }
        const field_strs_10973 = List$map(_t10964, sorted_10962);
        const _t10974 = ("({" + (String$concat(", ", field_strs_10973) + "})"));
        const _t10963 = _t10974;
        _t10947 = _t10963;
        break _t10948;
      }
      if (_t10946._tag === 17) {
        const base = _t10946._val[0];
        const overrides = _t10946._val[1];
        const base_js_10975 = Js_codegen$compile_non_tail(ctx, base);
        function _t10977(__p364) {
          let _t10979;
          const _t10978 = __p364;
          _t10980: {
            if (true) {
              const name = _t10978[0];
              const e = _t10978[1];
              const js_name_10981 = Js_codegen$mangle_name(name);
              const _t10982 = (js_name_10981 + (": " + Js_codegen$compile_non_tail(ctx, e)));
              _t10979 = _t10982;
              break _t10980;
            }
            _match_fail("line 16190");
          }
          return _t10979;
        }
        const field_strs_10983 = List$map(_t10977, overrides);
        const _t10984 = ("({..." + (base_js_10975 + (", " + (String$concat(", ", field_strs_10983) + "})"))));
        const _t10976 = _t10984;
        _t10947 = _t10976;
        break _t10948;
      }
      if (_t10946._tag === 18) {
        const base = _t10946._val[0];
        const pairs = _t10946._val[1];
        const tmp_10985 = Js_codegen$fresh_tmp(ctx);
        const base_js_10987 = Js_codegen$compile_non_tail(ctx, base);
        function _t10989(__p365) {
          let _t10991;
          const _t10990 = __p365;
          _t10992: {
            if (true) {
              const idx_e = _t10990[0];
              const val_e = _t10990[1];
              const idx_js_10993 = Js_codegen$compile_non_tail(ctx, idx_e);
              const val_js_10995 = Js_codegen$compile_non_tail(ctx, val_e);
              const _t10996 = ((("[" + __dict_Show_string.show(idx_js_10993)) + "]: ") + __dict_Show_string.show(val_js_10995));
              const _t10994 = _t10996;
              _t10991 = _t10994;
              break _t10992;
            }
            _match_fail("line 16190");
          }
          return _t10991;
        }
        const pair_strs_10997 = List$map(_t10989, pairs);
        const _t10998 = (((((((("(" + __dict_Show_string.show(tmp_10985)) + " = {...") + __dict_Show_string.show(base_js_10987)) + ", ") + __dict_Show_string.show(String$concat(", ", pair_strs_10997))) + "}, ") + __dict_Show_string.show(tmp_10985)) + ")");
        const _t10988 = _t10998;
        const _t10986 = _t10988;
        _t10947 = _t10986;
        break _t10948;
      }
      if (_t10946._tag === 19) {
        const e = _t10946._val[0];
        const field = _t10946._val[1];
        const base_10999 = Js_codegen$compile_non_tail(ctx, e);
        const _t11000 = (base_10999 + ("." + Js_codegen$mangle_name(field)));
        _t10947 = _t11000;
        break _t10948;
      }
      if (_t10946._tag === 20) {
        const base_e = _t10946._val[0];
        const idx_e = _t10946._val[1];
        const base_11001 = Js_codegen$compile_non_tail(ctx, base_e);
        const idx_11003 = Js_codegen$compile_non_tail(ctx, idx_e);
        const resolved_11005 = Types$repr(base_e.ty);
        let _t11008;
        const _t11007 = resolved_11005;
        _t11009: {
          if (_t11007._tag === 13) {
            _t11008 = (base_11001 + (".get(" + (idx_11003 + ")")));
            break _t11009;
          }
          if (_t11007._tag === 3) {
            _t11008 = (base_11001 + (".charCodeAt(" + (idx_11003 + ")")));
            break _t11009;
          }
          if (_t11007._tag === 14) {
            _t11008 = (base_11001 + ("._arr[" + (idx_11003 + "]")));
            break _t11009;
          }
          if (true) {
            _t11008 = (base_11001 + ("[" + (idx_11003 + "]")));
            break _t11009;
          }
          _match_fail("line 16190");
        }
        const _t11006 = _t11008;
        const _t11004 = _t11006;
        const _t11002 = _t11004;
        _t10947 = _t11002;
        break _t10948;
      }
      if (_t10946._tag === 21) {
        const hd = _t10946._val[0];
        const tl = _t10946._val[1];
        const hd_js_11010 = Js_codegen$compile_non_tail(ctx, hd);
        const tl_js_11012 = Js_codegen$compile_non_tail(ctx, tl);
        const _t11013 = ("({_hd: " + (hd_js_11010 + (", _tl: " + (tl_js_11012 + "})"))));
        const _t11011 = _t11013;
        _t10947 = _t11011;
        break _t10948;
      }
      if (_t10946._tag === 23) {
        const name = _t10946._val[0];
        const arg = _t10946._val[1];
        let _t11014;
        if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
          _t11014 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
        } else {
          _t11014 = Js_codegen$tag_for_constructor(ctx.type_env, name);
        }
        const tag_11015 = _t11014;
        const sname_11017 = Js_codegen$short_constructor_name(name);
        let _t11020;
        const _t11019 = arg;
        _t11021: {
          if (_t11019._tag === 1) {
            const e = _t11019._val;
            const v_11022 = Js_codegen$compile_non_tail(ctx, e);
            const _t11023 = (((((("({_tag: " + __dict_Show_int.show(tag_11015)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11017))) + ", _val: ") + __dict_Show_string.show(v_11022)) + "})");
            _t11020 = _t11023;
            break _t11021;
          }
          if (_t11019._tag === 0) {
            _t11020 = (((("({_tag: " + __dict_Show_int.show(tag_11015)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11017))) + "})");
            break _t11021;
          }
          _match_fail("line 16190");
        }
        const _t11018 = _t11020;
        const _t11016 = _t11018;
        _t10947 = _t11016;
        break _t10948;
      }
      if (_t10946._tag === 24) {
        const scrut = _t10946._val[0];
        const arms = _t10946._val[1];
        const _partial = _t10946._val[2];
        _t10947 = Js_codegen$compile_match(ctx, scrut, arms, te.loc);
        break _t10948;
      }
      if (_t10946._tag === 28) {
        const e1 = _t10946._val[0];
        const e2 = _t10946._val[1];
        _t10947 = Js_codegen$compile_seq(ctx, e1, e2);
        break _t10948;
      }
      if (_t10946._tag === 25) {
        const name = _t10946._val[0];
        const init = _t10946._val[1];
        const body = _t10946._val[2];
        _t10947 = Js_codegen$compile_let_mut(ctx, name, init, body);
        break _t10948;
      }
      if (_t10946._tag === 26) {
        const name = _t10946._val[0];
        const e = _t10946._val[1];
        const js_name_11024 = Js_codegen$lookup_var(ctx, name);
        const v_11026 = Js_codegen$compile_non_tail(ctx, e);
        const _t11027 = ("(" + (js_name_11024 + (" = " + (v_11026 + ", undefined)"))));
        const _t11025 = _t11027;
        _t10947 = _t11025;
        break _t10948;
      }
      if (_t10946._tag === 27) {
        const record_e = _t10946._val[0];
        const field = _t10946._val[1];
        const value_e = _t10946._val[2];
        const base_11028 = Js_codegen$compile_non_tail(ctx, record_e);
        const v_11030 = Js_codegen$compile_non_tail(ctx, value_e);
        const _t11031 = ("(" + (base_11028 + ("." + (Js_codegen$mangle_name(field) + (" = " + (v_11030 + ", undefined)"))))));
        const _t11029 = _t11031;
        _t10947 = _t11029;
        break _t10948;
      }
      if (_t10946._tag === 32) {
        const cond = _t10946._val[0];
        const body = _t10946._val[1];
        _t10947 = Js_codegen$compile_while(ctx, cond, body);
        break _t10948;
      }
      if (_t10946._tag === 33) {
        const value_te = _t10946._val;
        const v_11032 = Js_codegen$compile_non_tail(ctx, value_te);
        const _t11033 = ("(" + (ctx.break_val_name + (" = " + (v_11032 + (", " + (ctx.break_flag_name + " = true, undefined)"))))));
        _t10947 = _t11033;
        break _t10948;
      }
      if (_t10946._tag === 34) {
        _t10947 = "(_cont_flag = true, undefined)";
        break _t10948;
      }
      if (_t10946._tag === 35) {
        const value_te = _t10946._val;
        const v_11034 = Js_codegen$compile_non_tail(ctx, value_te);
        const _t11035 = ("(_fold_cont_val = " + (v_11034 + ", _fold_cont_flag = true, undefined)"));
        _t10947 = _t11035;
        break _t10948;
      }
      if (_t10946._tag === 36) {
        const fold_te = _t10946._val;
        const _t11036 = ctx;
        const _t11037 = fold_te;
        ctx = _t11036;
        te = _t11037;
        continue;
        _t10947 = undefined;
        break _t10948;
      }
      if (_t10946._tag === 38) {
        const pairs = _t10946._val;
        function _t11038(__p366) {
          let _t11040;
          const _t11039 = __p366;
          _t11041: {
            if (true) {
              const k = _t11039[0];
              const v = _t11039[1];
              _t11040 = ("[" + (Js_codegen$compile_non_tail(ctx, k) + (", " + (Js_codegen$compile_non_tail(ctx, v) + "]"))));
              break _t11041;
            }
            _match_fail("line 16190");
          }
          return _t11040;
        }
        const pair_strs_11042 = List$map(_t11038, pairs);
        const _t11043 = ("new Map([" + (String$concat(", ", pair_strs_11042) + "])"));
        _t10947 = _t11043;
        break _t10948;
      }
      if (_t10946._tag === 39) {
        const elts = _t10946._val;
        const elt_strs_11044 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), elts);
        const _t11045 = ("{_arr: [" + (String$concat(", ", elt_strs_11044) + "]}"));
        _t10947 = _t11045;
        break _t10948;
      }
      if (_t10946._tag === 40) {
        const value_te = _t10946._val;
        const v_11046 = Js_codegen$compile_non_tail(ctx, value_te);
        const _t11047 = ("(_ret_val = " + (v_11046 + ", _ret_flag = true, undefined)"));
        _t10947 = _t11047;
        break _t10948;
      }
      if (_t10946._tag === 29) {
        const op_name = _t10946._val[0];
        const arg = _t10946._val[1];
        let _t11049;
        const _t11048 = List$assoc_opt(op_name, ctx.direct_dispatch_ops);
        _t11050: {
          if (_t11048._tag === 1) {
            const direct_fn = _t11048._val;
            const arg_js_11051 = Js_codegen$compile_non_tail(ctx, arg);
            const _t11052 = (direct_fn + ("(" + (arg_js_11051 + ")")));
            _t11049 = _t11052;
            break _t11050;
          }
          if (_t11048._tag === 0) {
            if (List$mem(op_name, ctx.trywith_ops)) {
              const arg_js_11053 = Js_codegen$compile_non_tail(ctx, arg);
              const result_11055 = Js_codegen$fresh_tmp(ctx);
              Js_codegen$emit_line(ctx, (((("throw {_e: \"" + __dict_Show_string.show(op_name)) + "\", _v: ") + __dict_Show_string.show(arg_js_11053)) + "};"));
              Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(result_11055)) + " = undefined;"));
              const _t11056 = result_11055;
              const _t11054 = _t11056;
              _t11049 = _t11054;
              break _t11050;
            }
          }
          if (_t11048._tag === 0) {
            const arg_js_11057 = Js_codegen$compile_non_tail(ctx, arg);
            const result_11059 = Js_codegen$fresh_tmp(ctx);
            Js_codegen$emit_line(ctx, (((((("const " + __dict_Show_string.show(result_11059)) + " = _trampoline(function() { return _h[\"") + __dict_Show_string.show(op_name)) + "\"](") + __dict_Show_string.show(arg_js_11057)) + ", function(_r) { return _r; }); });"));
            const _t11060 = result_11059;
            const _t11058 = _t11060;
            _t11049 = _t11058;
            break _t11050;
          }
          _match_fail("line 16190");
        }
        _t10947 = _t11049;
        break _t10948;
      }
      if (_t10946._tag === 30) {
        const body = _t10946._val[0];
        const arms = _t10946._val[1];
        _t10947 = Js_codegen$compile_handle(ctx, body, arms);
        break _t10948;
      }
      if (_t10946._tag === 31) {
        const k_expr = _t10946._val[0];
        const val_expr = _t10946._val[1];
        const k_js_11061 = Js_codegen$compile_non_tail(ctx, k_expr);
        const v_js_11063 = Js_codegen$compile_non_tail(ctx, val_expr);
        let _t11065;
        if (ctx.handler_tail_resume) {
          _t11065 = (k_js_11061 + ("(" + (v_js_11063 + ")")));
        } else {
          _t11065 = ("_trampoline(function() { return " + (k_js_11061 + ("(" + (v_js_11063 + "); })"))));
        }
        const _t11064 = _t11065;
        const _t11062 = _t11064;
        _t10947 = _t11062;
        break _t10948;
      }
      _match_fail("line 16190");
    }
    return _t10947;
  }
}
function Js_codegen$compile_let(ctx, name, e1, e2) {
  const v1_11066 = Js_codegen$compile_non_tail(ctx, e1);
  const js_name_11068 = Js_codegen$mangle_name(name);
  let _t11070;
  if ((js_name_11068 === "_")) {
    _t11070 = Js_codegen$fresh_tmp(ctx);
  } else {
    function _t11071(n) {
      (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
      return n;
    }
    _t11070 = _call(_t11071, [(js_name_11068 + ("_" + (string_of_int(ctx.tmp_counter) + "")))]);
  }
  const actual_name_11072 = _t11070;
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, actual_name_11072);
  const result_11074 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_name_11072)) + " = ") + __dict_Show_string.show(v1_11066)) + ";"));
  const v2_11076 = Js_codegen$compile_expr(ctx, e2);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11074)) + " = ") + __dict_Show_string.show(v2_11076)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11077 = result_11074;
  const _t11075 = _t11077;
  const _t11073 = _t11075;
  const _t11069 = _t11073;
  const _t11067 = _t11069;
  return _t11067;
}
function Js_codegen$compile_letrec(ctx, name, fn_expr, body) {
  const js_name_11078 = Js_codegen$mangle_name(name);
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, js_name_11078);
  Js_codegen$compile_named_function(ctx, js_name_11078, fn_expr);
  const result_11080 = Js_codegen$fresh_tmp(ctx);
  const v_11082 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11080)) + " = ") + __dict_Show_string.show(v_11082)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11083 = result_11080;
  const _t11081 = _t11083;
  const _t11079 = _t11081;
  return _t11079;
}
function Js_codegen$compile_letrec_and(ctx, bindings, body) {
  Js_codegen$push_scope(ctx);
  function _t11084(__p367) {
    let _t11086;
    const _t11085 = __p367;
    _t11087: {
      if (true) {
        const name = _t11085[0];
        const js_name_11088 = Js_codegen$mangle_name(name);
        const _t11089 = Js_codegen$bind_var(ctx, name, js_name_11088);
        _t11086 = _t11089;
        break _t11087;
      }
      _match_fail("line 16190");
    }
    return _t11086;
  }
  List$iter(_t11084, bindings);
  function _t11090(__p368) {
    let _t11092;
    const _t11091 = __p368;
    _t11093: {
      if (true) {
        const name = _t11091[0];
        const fn_expr = _t11091[1];
        const js_name_11094 = Js_codegen$mangle_name(name);
        const _t11095 = Js_codegen$compile_named_function(ctx, js_name_11094, fn_expr);
        _t11092 = _t11095;
        break _t11093;
      }
      _match_fail("line 16190");
    }
    return _t11092;
  }
  List$iter(_t11090, bindings);
  const result_11096 = Js_codegen$fresh_tmp(ctx);
  const v_11098 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11096)) + " = ") + __dict_Show_string.show(v_11098)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11099 = result_11096;
  const _t11097 = _t11099;
  return _t11097;
}
function Js_codegen$compile_fun(ctx, param, body) {
  function collect_params(params, body_expr) {
    while (true) {
      let _t11101;
      const _t11100 = body_expr.expr;
      _t11102: {
        if (_t11100._tag === 10) {
          const p = _t11100._val[0];
          const inner = _t11100._val[1];
          const _t11103 = ({_hd: p, _tl: params});
          const _t11104 = inner;
          params = _t11103;
          body_expr = _t11104;
          continue;
          _t11101 = undefined;
          break _t11102;
        }
        if (true) {
          _t11101 = [List$rev(params), body_expr];
          break _t11102;
        }
        _match_fail("line 16190");
      }
      return _t11101;
    }
  }
  let _t11107;
  const _t11106 = collect_params(({_hd: param, _tl: null}), body);
  _t11108: {
    if (true) {
      const all_params = _t11106[0];
      const final_body = _t11106[1];
      const js_params_11109 = Js_codegen$dedup_js_params(List$map(Js_codegen$mangle_name, all_params));
      const fn_name_11111 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_indent(ctx);
      Js_codegen$emit(ctx, (((("function " + __dict_Show_string.show(fn_name_11111)) + "(") + __dict_Show_string.show(String$concat(", ", js_params_11109))) + ") "));
      Js_codegen$emit(ctx, "{\n");
      (ctx.indent = (ctx.indent + 1), undefined);
      Js_codegen$push_scope(ctx);
      function _t11113(mml_name, js_name) {
        return Js_codegen$bind_var(ctx, mml_name, js_name);
      }
      List$iter2(_t11113, all_params, js_params_11109);
      const saved_fn_11114 = ctx.current_fn_name;
      const saved_params_11116 = ctx.current_fn_params;
      const saved_tco_11118 = ctx.tco_used;
      (ctx.current_fn_name = ({_tag: 0, _name: "None"}), undefined);
      (ctx.current_fn_params = null, undefined);
      (ctx.tco_used = false, undefined);
      const saved_ddo_11120 = ctx.direct_dispatch_ops;
      const saved_two_11122 = ctx.trywith_ops;
      (ctx.direct_dispatch_ops = null, undefined);
      (ctx.trywith_ops = null, undefined);
      let _t11124;
      if (Js_codegen$expr_has_perform(final_body)) {
        Js_codegen$emit_line(ctx, "return _trampoline(function() {");
        (ctx.indent = (ctx.indent + 1), undefined);
        function _t11125(v) {
          return Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v)) + ";"));
        }
        Js_codegen$compile_cps(ctx, final_body, _t11125);
        (ctx.indent = (ctx.indent - 1), undefined);
        _t11124 = Js_codegen$emit_line(ctx, "});");
      } else {
        const v_11126 = Js_codegen$compile_expr(ctx, final_body);
        const _t11127 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11126)) + ";"));
        _t11124 = _t11127;
      }
      _t11124;
      (ctx.direct_dispatch_ops = saved_ddo_11120, undefined);
      (ctx.trywith_ops = saved_two_11122, undefined);
      (ctx.current_fn_name = saved_fn_11114, undefined);
      (ctx.current_fn_params = saved_params_11116, undefined);
      (ctx.tco_used = saved_tco_11118, undefined);
      Js_codegen$pop_scope(ctx);
      (ctx.indent = (ctx.indent - 1), undefined);
      Js_codegen$emit_line(ctx, "}");
      const _t11123 = fn_name_11111;
      const _t11121 = _t11123;
      const _t11119 = _t11121;
      const _t11117 = _t11119;
      const _t11115 = _t11117;
      const _t11112 = _t11115;
      const _t11110 = _t11112;
      _t11107 = _t11110;
      break _t11108;
    }
    _match_fail("line 16190");
  }
  const _t11105 = _t11107;
  return _t11105;
}
function Js_codegen$compile_named_function(ctx, js_name, fn_expr) {
  function collect_params(params, body_expr) {
    while (true) {
      let _t11129;
      const _t11128 = body_expr.expr;
      _t11130: {
        if (_t11128._tag === 10) {
          const p = _t11128._val[0];
          const inner = _t11128._val[1];
          const _t11131 = ({_hd: p, _tl: params});
          const _t11132 = inner;
          params = _t11131;
          body_expr = _t11132;
          continue;
          _t11129 = undefined;
          break _t11130;
        }
        if (true) {
          _t11129 = [List$rev(params), body_expr];
          break _t11130;
        }
        _match_fail("line 16190");
      }
      return _t11129;
    }
  }
  let _t11135;
  const _t11134 = fn_expr.expr;
  _t11136: {
    if (_t11134._tag === 10) {
      const param = _t11134._val[0];
      const body = _t11134._val[1];
      const has_return = _t11134._val[2];
      let _t11138;
      const _t11137 = collect_params(({_hd: param, _tl: null}), body);
      _t11139: {
        if (true) {
          const all_params = _t11137[0];
          const final_body = _t11137[1];
          const js_params_11140 = Js_codegen$dedup_js_params(List$map(Js_codegen$mangle_name, all_params));
          Js_codegen$emit_indent(ctx);
          Js_codegen$emit(ctx, (((("function " + __dict_Show_string.show(js_name)) + "(") + __dict_Show_string.show(String$concat(", ", js_params_11140))) + ") "));
          Js_codegen$emit(ctx, "{\n");
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          function _t11142(mml_name, js_nm) {
            return Js_codegen$bind_var(ctx, mml_name, js_nm);
          }
          List$iter2(_t11142, all_params, js_params_11140);
          const saved_fn_11143 = ctx.current_fn_name;
          const saved_params_11145 = ctx.current_fn_params;
          const saved_tco_11147 = ctx.tco_used;
          (ctx.current_fn_name = ({_tag: 1, _name: "Some", _val: js_name}), undefined);
          (ctx.current_fn_params = js_params_11140, undefined);
          (ctx.tco_used = false, undefined);
          (ctx.in_tail_position = true, undefined);
          const saved_ddo_11149 = ctx.direct_dispatch_ops;
          const saved_two_11151 = ctx.trywith_ops;
          (ctx.direct_dispatch_ops = null, undefined);
          (ctx.trywith_ops = null, undefined);
          const body_code_start_11153 = Buffer$length(ctx.buf);
          let _t11155;
          if (Js_codegen$expr_has_perform(final_body)) {
            Js_codegen$emit_line(ctx, "return _trampoline(function() {");
            (ctx.indent = (ctx.indent + 1), undefined);
            function _t11156(v) {
              return Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v)) + ";"));
            }
            Js_codegen$compile_cps(ctx, final_body, _t11156);
            (ctx.indent = (ctx.indent - 1), undefined);
            _t11155 = Js_codegen$emit_line(ctx, (("}, " + __dict_Show_string.show(js_name)) + ");"));
          } else {
            let _t11157;
            if (has_return) {
              Js_codegen$emit_line(ctx, "let _ret_flag = false, _ret_val;");
              const v_11158 = Js_codegen$compile_expr(ctx, final_body);
              const _t11159 = Js_codegen$emit_line(ctx, (("return _ret_flag ? _ret_val : " + __dict_Show_string.show(v_11158)) + ";"));
              _t11157 = _t11159;
            } else {
              const v_11160 = Js_codegen$compile_expr(ctx, final_body);
              const _t11161 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11160)) + ";"));
              _t11157 = _t11161;
            }
            _t11155 = _t11157;
          }
          _t11155;
          const tco_was_used_11162 = ctx.tco_used;
          (ctx.direct_dispatch_ops = saved_ddo_11149, undefined);
          (ctx.trywith_ops = saved_two_11151, undefined);
          (ctx.current_fn_name = saved_fn_11143, undefined);
          (ctx.current_fn_params = saved_params_11145, undefined);
          (ctx.tco_used = saved_tco_11147, undefined);
          (ctx.in_tail_position = false, undefined);
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          let _t11164;
          if (tco_was_used_11162) {
            const full_code_11165 = Buffer$contents(ctx.buf);
            const body_code_11167 = String$sub(full_code_11165, body_code_start_11153, (String$length(full_code_11165) - body_code_start_11153));
            const before_body_11169 = String$sub(full_code_11165, 0, body_code_start_11153);
            Buffer$clear(ctx.buf);
            Buffer$add_string(ctx.buf, before_body_11169);
            const indent_str_11171 = String$make(((ctx.indent + 1) * 2), 32);
            Buffer$add_string(ctx.buf, (indent_str_11171 + "while (true) {\n"));
            const body_lines_11173 = String$split("\n", body_code_11167);
            function _t11175(line) {
              let _t11176;
              if ((String$length(line) > 0)) {
                _t11176 = Buffer$add_string(ctx.buf, ("  " + (line + "\n")));
              } else {
                _t11176 = undefined;
              }
              return _t11176;
            }
            List$iter(_t11175, body_lines_11173);
            const _t11174 = Buffer$add_string(ctx.buf, (indent_str_11171 + "}\n"));
            const _t11172 = _t11174;
            const _t11170 = _t11172;
            const _t11168 = _t11170;
            const _t11166 = _t11168;
            _t11164 = _t11166;
          } else {
            _t11164 = undefined;
          }
          _t11164;
          const _t11163 = Js_codegen$emit_line(ctx, "}");
          const _t11154 = _t11163;
          const _t11152 = _t11154;
          const _t11150 = _t11152;
          const _t11148 = _t11150;
          const _t11146 = _t11148;
          const _t11144 = _t11146;
          const _t11141 = _t11144;
          _t11138 = _t11141;
          break _t11139;
        }
        _match_fail("line 16190");
      }
      _t11135 = _t11138;
      break _t11136;
    }
    if (true) {
      const v_11177 = Js_codegen$compile_expr(ctx, fn_expr);
      const _t11178 = Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_name)) + " = ") + __dict_Show_string.show(v_11177)) + ";"));
      _t11135 = _t11178;
      break _t11136;
    }
    _match_fail("line 16190");
  }
  const _t11133 = _t11135;
  return _t11133;
}
function Js_codegen$compile_app(ctx, _te, fn_, arg) {
  function collect_args(expr, acc) {
    while (true) {
      let _t11180;
      const _t11179 = expr.expr;
      _t11181: {
        if (_t11179._tag === 11) {
          const inner_fn = _t11179._val[0];
          const inner_arg = _t11179._val[1];
          const _t11182 = inner_fn;
          const _t11183 = ({_hd: inner_arg, _tl: acc});
          expr = _t11182;
          acc = _t11183;
          continue;
          _t11180 = undefined;
          break _t11181;
        }
        if (true) {
          _t11180 = [expr, acc];
          break _t11181;
        }
        _match_fail("line 16190");
      }
      return _t11180;
    }
  }
  let _t11186;
  const _t11185 = collect_args(fn_, ({_hd: arg, _tl: null}));
  _t11187: {
    if (true) {
      const base_fn = _t11185[0];
      const all_args = _t11185[1];
      const n_11188 = List$length(all_args);
      let _t11191;
      const _t11190 = [ctx.current_fn_name, base_fn.expr];
      _t11192: {
        if (_t11190[0]._tag === 1 && _t11190[1]._tag === 7) {
          const fn_name = _t11190[0]._val;
          const var_name = _t11190[1]._val;
          _t11191 = ((Js_codegen$mangle_name(var_name) === fn_name) && (n_11188 === List$length(ctx.current_fn_params)));
          break _t11192;
        }
        if (true) {
          _t11191 = false;
          break _t11192;
        }
        _match_fail("line 16190");
      }
      const is_self_call_11193 = _t11191;
      let _t11195;
      if ((is_self_call_11193 && ctx.in_tail_position)) {
        (ctx.tco_used = true, undefined);
        function _t11196(a) {
          const tmp_11197 = Js_codegen$fresh_tmp(ctx);
          const v_11199 = Js_codegen$compile_non_tail(ctx, a);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(tmp_11197)) + " = ") + __dict_Show_string.show(v_11199)) + ";"));
          const _t11200 = tmp_11197;
          const _t11198 = _t11200;
          return _t11198;
        }
        const arg_tmps_11201 = List$map(_t11196, all_args);
        function _t11203(param, tmp) {
          return Js_codegen$emit_line(ctx, (((__dict_Show_string.show(param) + " = ") + __dict_Show_string.show(tmp)) + ";"));
        }
        List$iter2(_t11203, ctx.current_fn_params, arg_tmps_11201);
        Js_codegen$emit_line(ctx, "continue;");
        const _t11202 = "undefined";
        _t11195 = _t11202;
      } else {
        const fn_js_11204 = Js_codegen$compile_non_tail(ctx, base_fn);
        const args_js_11206 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), all_args);
        const known_arity_11208 = Js_codegen$count_arrows(base_fn.ty);
        function _t11210(a) {
          let _t11212;
          const _t11211 = a.expr;
          _t11213: {
            if (_t11211._tag === 7) {
              const name = _t11211._val;
              _t11212 = (((String$length(name) >= 7) && (String$sub(name, 0, 7) === "__dict_")) || ((String$length(name) >= 5) && (String$sub(name, 0, 5) === "__ev_")));
              break _t11213;
            }
            if (true) {
              _t11212 = false;
              break _t11213;
            }
            _match_fail("line 16190");
          }
          return _t11212;
        }
        const has_implicit_args_11214 = List$exists(_t11210, all_args);
        let _t11216;
        if ((_eq(known_arity_11208, ({_tag: 1, _name: "Some", _val: n_11188})) && (!has_implicit_args_11214))) {
          _t11216 = (fn_js_11204 + ("(" + (String$concat(", ", args_js_11206) + ")")));
        } else {
          _t11216 = ("_call(" + (fn_js_11204 + (", [" + (String$concat(", ", args_js_11206) + "])"))));
        }
        const _t11215 = _t11216;
        const _t11209 = _t11215;
        const _t11207 = _t11209;
        const _t11205 = _t11207;
        _t11195 = _t11205;
      }
      const _t11194 = _t11195;
      const _t11189 = _t11194;
      _t11186 = _t11189;
      break _t11187;
    }
    _match_fail("line 16190");
  }
  const _t11184 = _t11186;
  return _t11184;
}
function Js_codegen$count_arrows(ty) {
  function go(ty, n) {
    while (true) {
      let _t11218;
      const _t11217 = Types$repr(ty);
      _t11219: {
        if (_t11217._tag === 7) {
          const ret = _t11217._val[2];
          const _t11220 = ret;
          const _t11221 = (n + 1);
          ty = _t11220;
          n = _t11221;
          continue;
          _t11218 = undefined;
          break _t11219;
        }
        if (true) {
          _t11218 = n;
          break _t11219;
        }
        _match_fail("line 16190");
      }
      return _t11218;
    }
  }
  const n_11223 = go(ty, 0);
  let _t11225;
  if ((n_11223 > 0)) {
    _t11225 = ({_tag: 1, _name: "Some", _val: n_11223});
  } else {
    _t11225 = ({_tag: 0, _name: "None"});
  }
  const _t11224 = _t11225;
  const _t11222 = _t11224;
  return _t11222;
}
function Js_codegen$compile_binop(ctx, op, e1, e2) {
  let _t11227;
  const _t11226 = op;
  _t11228: {
    if (_t11226._tag === 11) {
      const a_11229 = Js_codegen$compile_non_tail(ctx, e1);
      const buf_before_11231 = Buffer$length(ctx.buf);
      const b_11233 = Js_codegen$compile_non_tail(ctx, e2);
      let _t11235;
      if ((Buffer$length(ctx.buf) === buf_before_11231)) {
        _t11235 = ("(" + (a_11229 + (" && " + (b_11233 + ")"))));
      } else {
        const stmts_11236 = Buffer$sub(ctx.buf, buf_before_11231, (Buffer$length(ctx.buf) - buf_before_11231));
        Buffer$truncate(ctx.buf, buf_before_11231);
        const result_11238 = Js_codegen$fresh_tmp(ctx);
        Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_11238)) + ";"));
        Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(a_11229)) + ") {"));
        (ctx.indent = (ctx.indent + 1), undefined);
        Buffer$add_string(ctx.buf, stmts_11236);
        Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11238) + " = ") + __dict_Show_string.show(b_11233)) + ";"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "} else {");
        (ctx.indent = (ctx.indent + 1), undefined);
        Js_codegen$emit_line(ctx, (__dict_Show_string.show(result_11238) + " = false;"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "}");
        const _t11239 = result_11238;
        const _t11237 = _t11239;
        _t11235 = _t11237;
      }
      const _t11234 = _t11235;
      const _t11232 = _t11234;
      const _t11230 = _t11232;
      _t11227 = _t11230;
      break _t11228;
    }
    if (_t11226._tag === 12) {
      const a_11240 = Js_codegen$compile_non_tail(ctx, e1);
      const buf_before_11242 = Buffer$length(ctx.buf);
      const b_11244 = Js_codegen$compile_non_tail(ctx, e2);
      let _t11246;
      if ((Buffer$length(ctx.buf) === buf_before_11242)) {
        _t11246 = ("(" + (a_11240 + (" || " + (b_11244 + ")"))));
      } else {
        const stmts_11247 = Buffer$sub(ctx.buf, buf_before_11242, (Buffer$length(ctx.buf) - buf_before_11242));
        Buffer$truncate(ctx.buf, buf_before_11242);
        const result_11249 = Js_codegen$fresh_tmp(ctx);
        Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_11249)) + ";"));
        Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(a_11240)) + ") {"));
        (ctx.indent = (ctx.indent + 1), undefined);
        Js_codegen$emit_line(ctx, (__dict_Show_string.show(result_11249) + " = true;"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "} else {");
        (ctx.indent = (ctx.indent + 1), undefined);
        Buffer$add_string(ctx.buf, stmts_11247);
        Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11249) + " = ") + __dict_Show_string.show(b_11244)) + ";"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "}");
        const _t11250 = result_11249;
        const _t11248 = _t11250;
        _t11246 = _t11248;
      }
      const _t11245 = _t11246;
      const _t11243 = _t11245;
      const _t11241 = _t11243;
      _t11227 = _t11241;
      break _t11228;
    }
    if ((((_t11226._tag === 0 || _t11226._tag === 1) || _t11226._tag === 2) || _t11226._tag === 3)) {
      const resolved_11251 = Types$repr(e1.ty);
      let _t11254;
      const _t11253 = resolved_11251;
      _t11255: {
        if ((_t11253._tag === 0 || _t11253._tag === 1)) {
          const a_11256 = Js_codegen$compile_non_tail(ctx, e1);
          const b_11258 = Js_codegen$compile_non_tail(ctx, e2);
          let _t11261;
          const _t11260 = op;
          _t11262: {
            if (_t11260._tag === 0) {
              _t11261 = "+";
              break _t11262;
            }
            if (_t11260._tag === 1) {
              _t11261 = "-";
              break _t11262;
            }
            if (_t11260._tag === 2) {
              _t11261 = "*";
              break _t11262;
            }
            if (_t11260._tag === 3) {
              _t11261 = "/";
              break _t11262;
            }
            if (true) {
              _t11261 = failwith("assert false");
              break _t11262;
            }
            _match_fail("line 16190");
          }
          const js_op_11263 = _t11261;
          let _t11265;
          if ((_eq(resolved_11251, ({_tag: 0, _name: "TInt"})) && _eq(op, ({_tag: 3, _name: "Div"})))) {
            _t11265 = ("((" + (a_11256 + (" " + (js_op_11263 + (" " + (b_11258 + ") | 0)"))))));
          } else {
            _t11265 = ("(" + (a_11256 + (" " + (js_op_11263 + (" " + (b_11258 + ")"))))));
          }
          const _t11264 = _t11265;
          const _t11259 = _t11264;
          const _t11257 = _t11259;
          _t11254 = _t11257;
          break _t11255;
        }
        if (true) {
          let _t11267;
          const _t11266 = op;
          _t11268: {
            if (_t11266._tag === 0) {
              _t11267 = "+";
              break _t11268;
            }
            if (_t11266._tag === 1) {
              _t11267 = "-";
              break _t11268;
            }
            if (_t11266._tag === 2) {
              _t11267 = "*";
              break _t11268;
            }
            if (_t11266._tag === 3) {
              _t11267 = "/";
              break _t11268;
            }
            if (true) {
              _t11267 = failwith("assert false");
              break _t11268;
            }
            _match_fail("line 16190");
          }
          const method_name_11269 = _t11267;
          const _t11270 = Js_codegen$compile_class_binop(ctx, "Num", method_name_11269, e1, e2);
          _t11254 = _t11270;
          break _t11255;
        }
        _match_fail("line 16190");
      }
      const _t11252 = _t11254;
      _t11227 = _t11252;
      break _t11228;
    }
    if (_t11226._tag === 4) {
      const a_11271 = Js_codegen$compile_non_tail(ctx, e1);
      const b_11273 = Js_codegen$compile_non_tail(ctx, e2);
      const _t11274 = ("(" + (a_11271 + (" % " + (b_11273 + ")"))));
      const _t11272 = _t11274;
      _t11227 = _t11272;
      break _t11228;
    }
    if ((_t11226._tag === 5 || _t11226._tag === 6)) {
      const resolved_11275 = Types$repr(e1.ty);
      let _t11278;
      const _t11277 = resolved_11275;
      _t11279: {
        if (((((((_t11277._tag === 0 || _t11277._tag === 1) || _t11277._tag === 2) || _t11277._tag === 3) || _t11277._tag === 4) || _t11277._tag === 5) || _t11277._tag === 6)) {
          _t11278 = true;
          break _t11279;
        }
        if (true) {
          _t11278 = false;
          break _t11279;
        }
        _match_fail("line 16190");
      }
      const is_primitive_11280 = _t11278;
      const a_11282 = Js_codegen$compile_non_tail(ctx, e1);
      const b_11284 = Js_codegen$compile_non_tail(ctx, e2);
      let _t11286;
      if (is_primitive_11280) {
        let _t11287;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t11287 = "===";
        } else {
          _t11287 = "!==";
        }
        const js_op_11288 = _t11287;
        const _t11289 = ("(" + (a_11282 + (" " + (js_op_11288 + (" " + (b_11284 + ")"))))));
        _t11286 = _t11289;
      } else {
        const eq_call_11290 = ("_eq(" + (a_11282 + (", " + (b_11284 + ")"))));
        let _t11292;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t11292 = eq_call_11290;
        } else {
          _t11292 = ("!" + eq_call_11290);
        }
        const _t11291 = _t11292;
        _t11286 = _t11291;
      }
      const _t11285 = _t11286;
      const _t11283 = _t11285;
      const _t11281 = _t11283;
      const _t11276 = _t11281;
      _t11227 = _t11276;
      break _t11228;
    }
    if ((((_t11226._tag === 7 || _t11226._tag === 8) || _t11226._tag === 9) || _t11226._tag === 10)) {
      const resolved_11293 = Types$repr(e1.ty);
      let _t11296;
      const _t11295 = resolved_11293;
      _t11297: {
        if ((((((_t11295._tag === 0 || _t11295._tag === 1) || _t11295._tag === 3) || _t11295._tag === 4) || _t11295._tag === 5) || _t11295._tag === 16 && _t11295._val.contents._tag === 0)) {
          _t11296 = true;
          break _t11297;
        }
        if (true) {
          _t11296 = false;
          break _t11297;
        }
        _match_fail("line 16190");
      }
      const is_builtin_11298 = _t11296;
      let _t11300;
      if (is_builtin_11298) {
        const a_11301 = Js_codegen$compile_non_tail(ctx, e1);
        const b_11303 = Js_codegen$compile_non_tail(ctx, e2);
        let _t11306;
        const _t11305 = op;
        _t11307: {
          if (_t11305._tag === 7) {
            _t11306 = "<";
            break _t11307;
          }
          if (_t11305._tag === 8) {
            _t11306 = ">";
            break _t11307;
          }
          if (_t11305._tag === 9) {
            _t11306 = "<=";
            break _t11307;
          }
          if (_t11305._tag === 10) {
            _t11306 = ">=";
            break _t11307;
          }
          if (true) {
            _t11306 = failwith("assert false");
            break _t11307;
          }
          _match_fail("line 16190");
        }
        const js_op_11308 = _t11306;
        const _t11309 = ("(" + (a_11301 + (" " + (js_op_11308 + (" " + (b_11303 + ")"))))));
        const _t11304 = _t11309;
        const _t11302 = _t11304;
        _t11300 = _t11302;
      } else {
        let _t11311;
        const _t11310 = op;
        _t11312: {
          if (_t11310._tag === 7) {
            _t11311 = "<";
            break _t11312;
          }
          if (_t11310._tag === 8) {
            _t11311 = ">";
            break _t11312;
          }
          if (_t11310._tag === 9) {
            _t11311 = "<=";
            break _t11312;
          }
          if (_t11310._tag === 10) {
            _t11311 = ">=";
            break _t11312;
          }
          if (true) {
            _t11311 = failwith("assert false");
            break _t11312;
          }
          _match_fail("line 16190");
        }
        const method_name_11313 = _t11311;
        const _t11314 = Js_codegen$compile_class_binop(ctx, "Ord", method_name_11313, e1, e2);
        _t11300 = _t11314;
      }
      const _t11299 = _t11300;
      const _t11294 = _t11299;
      _t11227 = _t11294;
      break _t11228;
    }
    if (_t11226._tag === 13) {
      const a_11315 = Js_codegen$compile_non_tail(ctx, e1);
      const b_11317 = Js_codegen$compile_non_tail(ctx, e2);
      const _t11318 = ("(" + (a_11315 + (" + " + (b_11317 + ")"))));
      const _t11316 = _t11318;
      _t11227 = _t11316;
      break _t11228;
    }
    if (((((_t11226._tag === 14 || _t11226._tag === 15) || _t11226._tag === 16) || _t11226._tag === 17) || _t11226._tag === 18)) {
      const resolved_11319 = Types$repr(e1.ty);
      let _t11322;
      const _t11321 = resolved_11319;
      _t11323: {
        if (_t11321._tag === 0) {
          const a_11324 = Js_codegen$compile_non_tail(ctx, e1);
          const b_11326 = Js_codegen$compile_non_tail(ctx, e2);
          let _t11329;
          const _t11328 = op;
          _t11330: {
            if (_t11328._tag === 14) {
              _t11329 = "&";
              break _t11330;
            }
            if (_t11328._tag === 15) {
              _t11329 = "|";
              break _t11330;
            }
            if (_t11328._tag === 16) {
              _t11329 = "^";
              break _t11330;
            }
            if (_t11328._tag === 17) {
              _t11329 = "<<";
              break _t11330;
            }
            if (_t11328._tag === 18) {
              _t11329 = ">>";
              break _t11330;
            }
            if (true) {
              _t11329 = failwith("assert false");
              break _t11330;
            }
            _match_fail("line 16190");
          }
          const js_op_11331 = _t11329;
          const _t11332 = ("(" + (a_11324 + (" " + (js_op_11331 + (" " + (b_11326 + ")"))))));
          const _t11327 = _t11332;
          const _t11325 = _t11327;
          _t11322 = _t11325;
          break _t11323;
        }
        if (true) {
          let _t11334;
          const _t11333 = op;
          _t11335: {
            if (_t11333._tag === 14) {
              _t11334 = "land";
              break _t11335;
            }
            if (_t11333._tag === 15) {
              _t11334 = "lor";
              break _t11335;
            }
            if (_t11333._tag === 16) {
              _t11334 = "lxor";
              break _t11335;
            }
            if (_t11333._tag === 17) {
              _t11334 = "lsl";
              break _t11335;
            }
            if (_t11333._tag === 18) {
              _t11334 = "lsr";
              break _t11335;
            }
            if (true) {
              _t11334 = failwith("assert false");
              break _t11335;
            }
            _match_fail("line 16190");
          }
          const method_name_11336 = _t11334;
          const _t11337 = Js_codegen$compile_class_binop(ctx, "Bitwise", method_name_11336, e1, e2);
          _t11322 = _t11337;
          break _t11323;
        }
        _match_fail("line 16190");
      }
      const _t11320 = _t11322;
      _t11227 = _t11320;
      break _t11228;
    }
    if (_t11226._tag === 19) {
      const fn_js_11338 = Js_codegen$compile_non_tail(ctx, e2);
      const arg_js_11340 = Js_codegen$compile_non_tail(ctx, e1);
      const _t11341 = ("_call(" + (fn_js_11338 + (", [" + (arg_js_11340 + "])"))));
      const _t11339 = _t11341;
      _t11227 = _t11339;
      break _t11228;
    }
    _match_fail("line 16190");
  }
  return _t11227;
}
function Js_codegen$compile_class_binop(ctx, class_name, method_name, e1, e2) {
  const conc_ty_11342 = Types$repr(e1.ty);
  function _t11344(c) {
    return (c.class_name === class_name);
  }
  let _t11346;
  const _t11345 = List$find(_t11344, ctx.type_env.classes);
  _t11347: {
    if (_t11345._tag === 1) {
      const cd = _t11345._val;
      _t11346 = cd;
      break _t11347;
    }
    if (_t11345._tag === 0) {
      _t11346 = Js_codegen$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t11347;
    }
    _match_fail("line 16190");
  }
  const class_def_11348 = _t11346;
  const num_params_11350 = List$length(class_def_11348.class_params);
  function _t11352(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_11342});
  }
  const partial_11353 = List$init(num_params_11350, _t11352);
  function _t11355(opt) {
    let _t11357;
    const _t11356 = opt;
    _t11358: {
      if (_t11356._tag === 1) {
        const ty = _t11356._val;
        let _t11360;
        const _t11359 = Types$repr(ty);
        _t11361: {
          if (_t11359._tag === 16 && _t11359._val.contents._tag === 0) {
            _t11360 = ({_tag: 0, _name: "None"});
            break _t11361;
          }
          if (true) {
            _t11360 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t11361;
          }
          _match_fail("line 16190");
        }
        _t11357 = _t11360;
        break _t11358;
      }
      if (_t11356._tag === 0) {
        _t11357 = ({_tag: 0, _name: "None"});
        break _t11358;
      }
      _match_fail("line 16190");
    }
    return _t11357;
  }
  const concrete_partial_11362 = List$map(_t11355, partial_11353);
  function _t11364(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_11350) && Types$match_partial_inst(inst.inst_tys, concrete_partial_11362)));
  }
  const matching_11365 = List$filter(_t11364, ctx.type_env.instances);
  let _t11368;
  const _t11367 = matching_11365;
  _t11369: {
    if (_t11367 !== null && _t11367._tl === null) {
      const inst = _t11367._hd;
      const dict_access_11370 = (Js_codegen$mangle_name(inst.inst_dict_name) + ("." + Js_codegen$mangle_name(method_name)));
      const a_11372 = Js_codegen$compile_non_tail(ctx, e1);
      const b_11374 = Js_codegen$compile_non_tail(ctx, e2);
      const _t11375 = ("_call(" + (dict_access_11370 + (", [" + (a_11372 + (", " + (b_11374 + "])"))))));
      const _t11373 = _t11375;
      const _t11371 = _t11373;
      _t11368 = _t11371;
      break _t11369;
    }
    if (_t11367 === null) {
      _t11368 = Js_codegen$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_11342))));
      break _t11369;
    }
    if (true) {
      let _t11377;
      const _t11376 = Types$most_specific_inst(matching_11365);
      _t11378: {
        if (_t11376._tag === 1) {
          const inst = _t11376._val;
          let _t11379;
          if (_eq(inst.inst_constraints, null)) {
            _t11379 = Js_codegen$mangle_name((inst.inst_dict_name + ("$" + method_name)));
          } else {
            _t11379 = (Js_codegen$mangle_name(inst.inst_dict_name) + ("." + Js_codegen$mangle_name(method_name)));
          }
          const dict_access_11380 = _t11379;
          const a_11382 = Js_codegen$compile_non_tail(ctx, e1);
          const b_11384 = Js_codegen$compile_non_tail(ctx, e2);
          const _t11385 = ("_call(" + (dict_access_11380 + (", [" + (a_11382 + (", " + (b_11384 + "])"))))));
          const _t11383 = _t11385;
          const _t11381 = _t11383;
          _t11377 = _t11381;
          break _t11378;
        }
        if (_t11376._tag === 0) {
          _t11377 = Js_codegen$error(((("ambiguous instance for " + __dict_Show_string.show(class_name)) + " method ") + __dict_Show_string.show(method_name)));
          break _t11378;
        }
        _match_fail("line 16190");
      }
      _t11368 = _t11377;
      break _t11369;
    }
    _match_fail("line 16190");
  }
  const _t11366 = _t11368;
  const _t11363 = _t11366;
  const _t11354 = _t11363;
  const _t11351 = _t11354;
  const _t11349 = _t11351;
  const _t11343 = _t11349;
  return _t11343;
}
function Js_codegen$compile_unop(ctx, op, e) {
  let _t11387;
  const _t11386 = op;
  _t11388: {
    if (_t11386._tag === 0) {
      const resolved_11389 = Types$repr(e.ty);
      let _t11392;
      const _t11391 = resolved_11389;
      _t11393: {
        if ((_t11391._tag === 0 || _t11391._tag === 1)) {
          const v_11394 = Js_codegen$compile_non_tail(ctx, e);
          const _t11395 = ("(-" + (v_11394 + ")"));
          _t11392 = _t11395;
          break _t11393;
        }
        if (true) {
          _t11392 = Js_codegen$compile_class_unop(ctx, "Num", "neg", e);
          break _t11393;
        }
        _match_fail("line 16190");
      }
      const _t11390 = _t11392;
      _t11387 = _t11390;
      break _t11388;
    }
    if (_t11386._tag === 1) {
      const v_11396 = Js_codegen$compile_non_tail(ctx, e);
      const _t11397 = ("(!" + (v_11396 + ")"));
      _t11387 = _t11397;
      break _t11388;
    }
    if (_t11386._tag === 2) {
      const resolved_11398 = Types$repr(e.ty);
      let _t11401;
      const _t11400 = resolved_11398;
      _t11402: {
        if (_t11400._tag === 0) {
          const v_11403 = Js_codegen$compile_non_tail(ctx, e);
          const _t11404 = ("(~" + (v_11403 + ")"));
          _t11401 = _t11404;
          break _t11402;
        }
        if (true) {
          _t11401 = Js_codegen$compile_class_unop(ctx, "Bitwise", "lnot", e);
          break _t11402;
        }
        _match_fail("line 16190");
      }
      const _t11399 = _t11401;
      _t11387 = _t11399;
      break _t11388;
    }
    _match_fail("line 16190");
  }
  return _t11387;
}
function Js_codegen$compile_class_unop(ctx, class_name, method_name, e) {
  const conc_ty_11405 = Types$repr(e.ty);
  function _t11407(c) {
    return (c.class_name === class_name);
  }
  let _t11409;
  const _t11408 = List$find(_t11407, ctx.type_env.classes);
  _t11410: {
    if (_t11408._tag === 1) {
      const cd = _t11408._val;
      _t11409 = cd;
      break _t11410;
    }
    if (_t11408._tag === 0) {
      _t11409 = Js_codegen$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t11410;
    }
    _match_fail("line 16190");
  }
  const class_def_11411 = _t11409;
  const num_params_11413 = List$length(class_def_11411.class_params);
  function _t11415(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_11405});
  }
  const partial_11416 = List$init(num_params_11413, _t11415);
  function _t11418(opt) {
    let _t11420;
    const _t11419 = opt;
    _t11421: {
      if (_t11419._tag === 1) {
        const ty = _t11419._val;
        let _t11423;
        const _t11422 = Types$repr(ty);
        _t11424: {
          if (_t11422._tag === 16 && _t11422._val.contents._tag === 0) {
            _t11423 = ({_tag: 0, _name: "None"});
            break _t11424;
          }
          if (true) {
            _t11423 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t11424;
          }
          _match_fail("line 16190");
        }
        _t11420 = _t11423;
        break _t11421;
      }
      if (_t11419._tag === 0) {
        _t11420 = ({_tag: 0, _name: "None"});
        break _t11421;
      }
      _match_fail("line 16190");
    }
    return _t11420;
  }
  const concrete_partial_11425 = List$map(_t11418, partial_11416);
  function _t11427(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_11413) && Types$match_partial_inst(inst.inst_tys, concrete_partial_11425)));
  }
  const matching_11428 = List$filter(_t11427, ctx.type_env.instances);
  let _t11431;
  const _t11430 = matching_11428;
  _t11432: {
    if (_t11430 !== null && _t11430._tl === null) {
      const inst = _t11430._hd;
      const dict_access_11433 = (Js_codegen$mangle_name(inst.inst_dict_name) + ("." + Js_codegen$mangle_name(method_name)));
      const v_11435 = Js_codegen$compile_non_tail(ctx, e);
      const _t11436 = ("_call(" + (dict_access_11433 + (", [" + (v_11435 + "])"))));
      const _t11434 = _t11436;
      _t11431 = _t11434;
      break _t11432;
    }
    if (_t11430 === null) {
      _t11431 = Js_codegen$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_11405))));
      break _t11432;
    }
    if (true) {
      _t11431 = Js_codegen$error(("ambiguous instance for " + __dict_Show_string.show(class_name)));
      break _t11432;
    }
    _match_fail("line 16190");
  }
  const _t11429 = _t11431;
  const _t11426 = _t11429;
  const _t11417 = _t11426;
  const _t11414 = _t11417;
  const _t11412 = _t11414;
  const _t11406 = _t11412;
  return _t11406;
}
function Js_codegen$compile_if(ctx, cond, then_e, else_e) {
  const c_11437 = Js_codegen$compile_expr(ctx, cond);
  const result_11439 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_11439)) + ";"));
  Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(c_11437)) + ") {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  const t_11441 = Js_codegen$compile_expr(ctx, then_e);
  Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11439) + " = ") + __dict_Show_string.show(t_11441)) + ";"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "} else {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const e_11443 = Js_codegen$compile_expr(ctx, else_e);
  Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11439) + " = ") + __dict_Show_string.show(e_11443)) + ";"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  const _t11444 = result_11439;
  const _t11442 = _t11444;
  const _t11440 = _t11442;
  const _t11438 = _t11440;
  return _t11438;
}
function Js_codegen$compile_seq(ctx, e1, e2) {
  const v1_11445 = Js_codegen$compile_non_tail(ctx, e1);
  Js_codegen$emit_line(ctx, (v1_11445 + ";"));
  const _t11446 = Js_codegen$compile_expr(ctx, e2);
  return _t11446;
}
function Js_codegen$compile_let_mut(ctx, name, init, body) {
  const v_11447 = Js_codegen$compile_expr(ctx, init);
  const js_name_11449 = Js_codegen$mangle_name(name);
  const actual_name_11451 = (js_name_11449 + ("_" + string_of_int(ctx.tmp_counter)));
  (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, actual_name_11451);
  Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(actual_name_11451)) + " = ") + __dict_Show_string.show(v_11447)) + ";"));
  const result_11453 = Js_codegen$fresh_tmp(ctx);
  const b_11455 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11453)) + " = ") + __dict_Show_string.show(b_11455)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11456 = result_11453;
  const _t11454 = _t11456;
  const _t11452 = _t11454;
  const _t11450 = _t11452;
  const _t11448 = _t11450;
  return _t11448;
}
function Js_codegen$compile_while(ctx, cond, body) {
  const result_11457 = Js_codegen$fresh_tmp(ctx);
  const break_flag_11459 = Js_codegen$fresh_tmp(ctx);
  const break_val_11461 = Js_codegen$fresh_tmp(ctx);
  const saved_break_flag_11463 = ctx.break_flag_name;
  const saved_break_val_11465 = ctx.break_val_name;
  (ctx.break_flag_name = break_flag_11459, undefined);
  (ctx.break_val_name = break_val_11461, undefined);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_11457)) + " = undefined;"));
  Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(break_flag_11459)) + " = false, ") + __dict_Show_string.show(break_val_11461)) + ";"));
  Js_codegen$emit_line(ctx, "while (true) {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const c_11467 = Js_codegen$compile_expr(ctx, cond);
  Js_codegen$emit_line(ctx, (("if (!(" + __dict_Show_string.show(c_11467)) + ")) break;"));
  const v_body_11469 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (v_body_11469 + ";"));
  Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(break_flag_11459)) + ") break;"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  Js_codegen$emit_line(ctx, (((((__dict_Show_string.show(result_11457) + " = ") + __dict_Show_string.show(break_flag_11459)) + " ? ") + __dict_Show_string.show(break_val_11461)) + " : undefined;"));
  (ctx.break_flag_name = saved_break_flag_11463, undefined);
  (ctx.break_val_name = saved_break_val_11465, undefined);
  const _t11470 = result_11457;
  const _t11468 = _t11470;
  const _t11466 = _t11468;
  const _t11464 = _t11466;
  const _t11462 = _t11464;
  const _t11460 = _t11462;
  const _t11458 = _t11460;
  return _t11458;
}
function Js_codegen$compile_match(ctx, scrut, arms, loc) {
  const scrut_js_11471 = Js_codegen$compile_non_tail(ctx, scrut);
  const scrut_tmp_11473 = Js_codegen$fresh_tmp(ctx);
  const result_11475 = Js_codegen$fresh_tmp(ctx);
  const label_11477 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_11475)) + ";"));
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(scrut_tmp_11473)) + " = ") + __dict_Show_string.show(scrut_js_11471)) + ";"));
  Js_codegen$emit_line(ctx, (__dict_Show_string.show(label_11477) + ": {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  function _t11479(__p369) {
    let _t11481;
    const _t11480 = __p369;
    _t11482: {
      if (true) {
        const pat = _t11480[0];
        const guard = _t11480[1];
        const body = _t11480[2];
        let _t11484;
        const _t11483 = Js_codegen$compile_pattern(ctx, scrut_tmp_11473, pat);
        _t11485: {
          if (true) {
            const conds = _t11483[0];
            const bindings = _t11483[1];
            let _t11487;
            const _t11486 = conds;
            _t11488: {
              if (_t11486 === null) {
                _t11487 = "true";
                break _t11488;
              }
              if (true) {
                _t11487 = String$concat(" && ", conds);
                break _t11488;
              }
              _match_fail("line 16190");
            }
            const cond_str_11489 = _t11487;
            Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(cond_str_11489)) + ") {"));
            (ctx.indent = (ctx.indent + 1), undefined);
            Js_codegen$push_scope(ctx);
            function _t11491(__p370) {
              let _t11493;
              const _t11492 = __p370;
              _t11494: {
                if (true) {
                  const mml_name = _t11492[0];
                  const js_expr = _t11492[1];
                  const js_name_11495 = Js_codegen$mangle_name(mml_name);
                  Js_codegen$bind_var(ctx, mml_name, js_name_11495);
                  const _t11496 = Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_name_11495)) + " = ") + __dict_Show_string.show(js_expr)) + ";"));
                  _t11493 = _t11496;
                  break _t11494;
                }
                _match_fail("line 16190");
              }
              return _t11493;
            }
            List$iter(_t11491, bindings);
            let _t11498;
            const _t11497 = guard;
            _t11499: {
              if (_t11497._tag === 1) {
                const g = _t11497._val;
                const guard_js_11500 = Js_codegen$compile_expr(ctx, g);
                Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(guard_js_11500)) + ") {"));
                (ctx.indent = (ctx.indent + 1), undefined);
                const b_11502 = Js_codegen$compile_expr(ctx, body);
                Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11475) + " = ") + __dict_Show_string.show(b_11502)) + ";"));
                Js_codegen$emit_line(ctx, (("break " + __dict_Show_string.show(label_11477)) + ";"));
                (ctx.indent = (ctx.indent - 1), undefined);
                const _t11503 = Js_codegen$emit_line(ctx, "}");
                const _t11501 = _t11503;
                _t11498 = _t11501;
                break _t11499;
              }
              if (_t11497._tag === 0) {
                const b_11504 = Js_codegen$compile_expr(ctx, body);
                Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11475) + " = ") + __dict_Show_string.show(b_11504)) + ";"));
                const _t11505 = Js_codegen$emit_line(ctx, (("break " + __dict_Show_string.show(label_11477)) + ";"));
                _t11498 = _t11505;
                break _t11499;
              }
              _match_fail("line 16190");
            }
            _t11498;
            Js_codegen$pop_scope(ctx);
            (ctx.indent = (ctx.indent - 1), undefined);
            const _t11490 = Js_codegen$emit_line(ctx, "}");
            _t11484 = _t11490;
            break _t11485;
          }
          _match_fail("line 16190");
        }
        _t11481 = _t11484;
        break _t11482;
      }
      _match_fail("line 16190");
    }
    return _t11481;
  }
  List$iter(_t11479, arms);
  Js_codegen$emit_line(ctx, (("_match_fail(\"line " + __dict_Show_int.show(loc.line)) + "\");"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  const _t11478 = result_11475;
  const _t11476 = _t11478;
  const _t11474 = _t11476;
  const _t11472 = _t11474;
  return _t11472;
}
function Js_codegen$compile_pattern(ctx, scrutinee, pat) {
  while (true) {
    let _t11507;
    const _t11506 = pat;
    _t11508: {
      if (_t11506._tag === 0) {
        _t11507 = [null, null];
        break _t11508;
      }
      if (_t11506._tag === 1) {
        const name = _t11506._val;
        _t11507 = [null, ({_hd: [name, scrutinee], _tl: null})];
        break _t11508;
      }
      if (_t11506._tag === 2) {
        const n = _t11506._val;
        _t11507 = [({_hd: ((__dict_Show_string.show(scrutinee) + " === ") + __dict_Show_int.show(n)), _tl: null}), null];
        break _t11508;
      }
      if (_t11506._tag === 3) {
        const f = _t11506._val;
        _t11507 = [({_hd: ((__dict_Show_string.show(scrutinee) + " === ") + __dict_Show_string.show(__dict_Show_float.show(f))), _tl: null}), null];
        break _t11508;
      }
      if (_t11506._tag === 4 && _t11506._val) {
        _t11507 = [({_hd: scrutinee, _tl: null}), null];
        break _t11508;
      }
      if (_t11506._tag === 4 && !_t11506._val) {
        _t11507 = [({_hd: ("!" + scrutinee), _tl: null}), null];
        break _t11508;
      }
      if (_t11506._tag === 5) {
        const s = _t11506._val;
        _t11507 = [({_hd: ((__dict_Show_string.show(scrutinee) + " === ") + __dict_Show_string.show(Js_codegen$escape_js_string(s))), _tl: null}), null];
        break _t11508;
      }
      if (_t11506._tag === 6) {
        _t11507 = [null, null];
        break _t11508;
      }
      if (_t11506._tag === 9) {
        _t11507 = [({_hd: (scrutinee + " === null"), _tl: null}), null];
        break _t11508;
      }
      if (_t11506._tag === 8) {
        const hd_pat = _t11506._val[0];
        const tl_pat = _t11506._val[1];
        const hd_expr_11509 = (scrutinee + "._hd");
        const tl_expr_11511 = (scrutinee + "._tl");
        let _t11514;
        const _t11513 = Js_codegen$compile_pattern(ctx, hd_expr_11509, hd_pat);
        _t11515: {
          if (true) {
            const hd_conds = _t11513[0];
            const hd_binds = _t11513[1];
            let _t11517;
            const _t11516 = Js_codegen$compile_pattern(ctx, tl_expr_11511, tl_pat);
            _t11518: {
              if (true) {
                const tl_conds = _t11516[0];
                const tl_binds = _t11516[1];
                const conds_11519 = List$concat(({_hd: (scrutinee + " !== null"), _tl: hd_conds}), tl_conds);
                const _t11520 = [conds_11519, List$concat(hd_binds, tl_binds)];
                _t11517 = _t11520;
                break _t11518;
              }
              _match_fail("line 16190");
            }
            _t11514 = _t11517;
            break _t11515;
          }
          _match_fail("line 16190");
        }
        const _t11512 = _t11514;
        const _t11510 = _t11512;
        _t11507 = _t11510;
        break _t11508;
      }
      if (_t11506._tag === 7) {
        const pats = _t11506._val;
        const all_conds_11521 = Ref$create(null);
        const all_binds_11523 = Ref$create(null);
        function _t11525(i, sub_pat) {
          const elem_expr_11526 = (((__dict_Show_string.show(scrutinee) + "[") + __dict_Show_int.show(i)) + "]");
          let _t11529;
          const _t11528 = Js_codegen$compile_pattern(ctx, elem_expr_11526, sub_pat);
          _t11530: {
            if (true) {
              const c = _t11528[0];
              const b = _t11528[1];
              Ref$set(all_conds_11521, List$concat(Ref$get(all_conds_11521), c));
              _t11529 = Ref$set(all_binds_11523, List$concat(Ref$get(all_binds_11523), b));
              break _t11530;
            }
            _match_fail("line 16190");
          }
          const _t11527 = _t11529;
          return _t11527;
        }
        List$iteri(_t11525, pats);
        const _t11524 = [Ref$get(all_conds_11521), Ref$get(all_binds_11523)];
        const _t11522 = _t11524;
        _t11507 = _t11522;
        break _t11508;
      }
      if (_t11506._tag === 10) {
        const name = _t11506._val[0];
        const arg_pat = _t11506._val[1];
        let _t11531;
        if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
          _t11531 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
        } else {
          _t11531 = Js_codegen$tag_for_constructor(ctx.type_env, name);
        }
        const tag_11532 = _t11531;
        const conds_11534 = ({_hd: ((__dict_Show_string.show(scrutinee) + "._tag === ") + __dict_Show_int.show(tag_11532)), _tl: null});
        let _t11537;
        const _t11536 = arg_pat;
        _t11538: {
          if (_t11536._tag === 0) {
            _t11537 = [conds_11534, null];
            break _t11538;
          }
          if (_t11536._tag === 1) {
            const sub_pat = _t11536._val;
            const payload_expr_11539 = (scrutinee + "._val");
            let _t11542;
            const _t11541 = Js_codegen$compile_pattern(ctx, payload_expr_11539, sub_pat);
            _t11543: {
              if (true) {
                const sub_conds = _t11541[0];
                const sub_binds = _t11541[1];
                _t11542 = [List$concat(conds_11534, sub_conds), sub_binds];
                break _t11543;
              }
              _match_fail("line 16190");
            }
            const _t11540 = _t11542;
            _t11537 = _t11540;
            break _t11538;
          }
          _match_fail("line 16190");
        }
        const _t11535 = _t11537;
        const _t11533 = _t11535;
        _t11507 = _t11533;
        break _t11508;
      }
      if (_t11506._tag === 11) {
        const field_pats = _t11506._val;
        const all_conds_11544 = Ref$create(null);
        const all_binds_11546 = Ref$create(null);
        function _t11548(__p371) {
          let _t11550;
          const _t11549 = __p371;
          _t11551: {
            if (true) {
              const fname = _t11549[0];
              const sub_pat = _t11549[1];
              const field_expr_11552 = (scrutinee + ("." + Js_codegen$mangle_name(fname)));
              let _t11555;
              const _t11554 = Js_codegen$compile_pattern(ctx, field_expr_11552, sub_pat);
              _t11556: {
                if (true) {
                  const c = _t11554[0];
                  const b = _t11554[1];
                  Ref$set(all_conds_11544, List$concat(Ref$get(all_conds_11544), c));
                  _t11555 = Ref$set(all_binds_11546, List$concat(Ref$get(all_binds_11546), b));
                  break _t11556;
                }
                _match_fail("line 16190");
              }
              const _t11553 = _t11555;
              _t11550 = _t11553;
              break _t11551;
            }
            _match_fail("line 16190");
          }
          return _t11550;
        }
        List$iter(_t11548, field_pats);
        const _t11547 = [Ref$get(all_conds_11544), Ref$get(all_binds_11546)];
        const _t11545 = _t11547;
        _t11507 = _t11545;
        break _t11508;
      }
      if (_t11506._tag === 12) {
        const inner_pat = _t11506._val[0];
        const name = _t11506._val[1];
        let _t11558;
        const _t11557 = Js_codegen$compile_pattern(ctx, scrutinee, inner_pat);
        _t11559: {
          if (true) {
            const conds = _t11557[0];
            const binds = _t11557[1];
            _t11558 = [conds, List$concat(binds, ({_hd: [name, scrutinee], _tl: null}))];
            break _t11559;
          }
          _match_fail("line 16190");
        }
        _t11507 = _t11558;
        break _t11508;
      }
      if (_t11506._tag === 13) {
        const p1 = _t11506._val[0];
        const p2 = _t11506._val[1];
        let _t11561;
        const _t11560 = Js_codegen$compile_pattern(ctx, scrutinee, p1);
        _t11562: {
          if (true) {
            const conds1 = _t11560[0];
            const binds1 = _t11560[1];
            let _t11564;
            const _t11563 = Js_codegen$compile_pattern(ctx, scrutinee, p2);
            _t11565: {
              if (true) {
                const conds2 = _t11563[0];
                const binds2 = _t11563[1];
                let _t11567;
                const _t11566 = conds1;
                _t11568: {
                  if (_t11566 === null) {
                    _t11567 = "true";
                    break _t11568;
                  }
                  if (true) {
                    const cs = _t11566;
                    _t11567 = String$concat(" && ", cs);
                    break _t11568;
                  }
                  _match_fail("line 16190");
                }
                const cond1_11569 = _t11567;
                let _t11572;
                const _t11571 = conds2;
                _t11573: {
                  if (_t11571 === null) {
                    _t11572 = "true";
                    break _t11573;
                  }
                  if (true) {
                    const cs = _t11571;
                    _t11572 = String$concat(" && ", cs);
                    break _t11573;
                  }
                  _match_fail("line 16190");
                }
                const cond2_11574 = _t11572;
                const or_cond_11576 = ("(" + (cond1_11569 + (" || " + (cond2_11574 + ")"))));
                let _t11578;
                if (_eq(binds1, binds2)) {
                  _t11578 = binds1;
                } else {
                  function _t11579(__p372) {
                    let _t11581;
                    const _t11580 = __p372;
                    _t11582: {
                      if (true) {
                        const name = _t11580[0];
                        const expr1 = _t11580[1];
                        const expr2_11583 = List$assoc(name, binds2);
                        let _t11585;
                        if ((expr1 === expr2_11583)) {
                          _t11585 = [name, expr1];
                        } else {
                          _t11585 = [name, (((((("(" + __dict_Show_string.show(cond1_11569)) + " ? ") + __dict_Show_string.show(expr1)) + " : ") + __dict_Show_string.show(expr2_11583)) + ")")];
                        }
                        const _t11584 = _t11585;
                        _t11581 = _t11584;
                        break _t11582;
                      }
                      _match_fail("line 16190");
                    }
                    return _t11581;
                  }
                  _t11578 = List$map(_t11579, binds1);
                }
                const binds_11586 = _t11578;
                const _t11587 = [({_hd: or_cond_11576, _tl: null}), binds_11586];
                const _t11577 = _t11587;
                const _t11575 = _t11577;
                const _t11570 = _t11575;
                _t11564 = _t11570;
                break _t11565;
              }
              _match_fail("line 16190");
            }
            _t11561 = _t11564;
            break _t11562;
          }
          _match_fail("line 16190");
        }
        _t11507 = _t11561;
        break _t11508;
      }
      if (_t11506._tag === 14) {
        const pats = _t11506._val;
        const len_cond_11588 = ((__dict_Show_string.show(scrutinee) + "._arr.length === ") + __dict_Show_int.show(List$length(pats)));
        const all_conds_11590 = Ref$create(({_hd: len_cond_11588, _tl: null}));
        const all_binds_11592 = Ref$create(null);
        function _t11594(i, sub_pat) {
          const elem_expr_11595 = (((__dict_Show_string.show(scrutinee) + "._arr[") + __dict_Show_int.show(i)) + "]");
          let _t11598;
          const _t11597 = Js_codegen$compile_pattern(ctx, elem_expr_11595, sub_pat);
          _t11599: {
            if (true) {
              const c = _t11597[0];
              const b = _t11597[1];
              Ref$set(all_conds_11590, List$concat(Ref$get(all_conds_11590), c));
              _t11598 = Ref$set(all_binds_11592, List$concat(Ref$get(all_binds_11592), b));
              break _t11599;
            }
            _match_fail("line 16190");
          }
          const _t11596 = _t11598;
          return _t11596;
        }
        List$iteri(_t11594, pats);
        const _t11593 = [Ref$get(all_conds_11590), Ref$get(all_binds_11592)];
        const _t11591 = _t11593;
        const _t11589 = _t11591;
        _t11507 = _t11589;
        break _t11508;
      }
      if (_t11506._tag === 15) {
        _t11507 = Js_codegen$error("map patterns not yet supported in JS backend");
        break _t11508;
      }
      if (_t11506._tag === 16) {
        const tag = _t11506._val[0];
        const arg_pat = _t11506._val[1];
        const num_tag_11600 = (__dict_Hash_string.hash(tag) & 1073741823);
        const conds_11602 = ({_hd: ((__dict_Show_string.show(scrutinee) + "._tag === ") + __dict_Show_int.show(num_tag_11600)), _tl: null});
        let _t11605;
        const _t11604 = arg_pat;
        _t11606: {
          if (_t11604._tag === 0) {
            _t11605 = [conds_11602, null];
            break _t11606;
          }
          if (_t11604._tag === 1) {
            const sub_pat = _t11604._val;
            const payload_expr_11607 = (scrutinee + "._val");
            let _t11610;
            const _t11609 = Js_codegen$compile_pattern(ctx, payload_expr_11607, sub_pat);
            _t11611: {
              if (true) {
                const sub_conds = _t11609[0];
                const sub_binds = _t11609[1];
                _t11610 = [List$concat(conds_11602, sub_conds), sub_binds];
                break _t11611;
              }
              _match_fail("line 16190");
            }
            const _t11608 = _t11610;
            _t11605 = _t11608;
            break _t11606;
          }
          _match_fail("line 16190");
        }
        const _t11603 = _t11605;
        const _t11601 = _t11603;
        _t11507 = _t11601;
        break _t11508;
      }
      if (_t11506._tag === 17) {
        const name = _t11506._val;
        const js_name_11612 = Js_codegen$lookup_var(ctx, name);
        const _t11613 = [({_hd: (((("_eq(" + __dict_Show_string.show(scrutinee)) + ", ") + __dict_Show_string.show(js_name_11612)) + ")"), _tl: null}), null];
        _t11507 = _t11613;
        break _t11508;
      }
      if (_t11506._tag === 18) {
        const inner_pat = _t11506._val[0];
        const _t11614 = ctx;
        const _t11615 = scrutinee;
        const _t11616 = inner_pat;
        ctx = _t11614;
        scrutinee = _t11615;
        pat = _t11616;
        continue;
        _t11507 = undefined;
        break _t11508;
      }
      _match_fail("line 16190");
    }
    return _t11507;
  }
}
function Js_codegen$compile_handle_trywith(ctx, body, op_arms, return_arm, result) {
  Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(result)) + " = (function() {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  const h_saved_11617 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(h_saved_11617)) + " = _h;"));
  Js_codegen$emit_line(ctx, (("_h = Object.assign({}, " + __dict_Show_string.show(h_saved_11617)) + ", {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  function _t11619(__p373) {
    let _t11621;
    const _t11620 = __p373;
    _t11622: {
      if (true) {
        const op_name = _t11620[0];
        const arg_name = _t11620[1];
        const k_name = _t11620[2];
        const arg_js_11623 = Js_codegen$mangle_name(arg_name);
        const k_js_11625 = Js_codegen$mangle_name(k_name);
        const _t11626 = Js_codegen$emit_line(ctx, (((((((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_11623)) + ", ") + __dict_Show_string.show(k_js_11625)) + ") { throw {_e: \"") + __dict_Show_string.show(op_name)) + "\", _v: ") + __dict_Show_string.show(arg_js_11623)) + "}; },"));
        const _t11624 = _t11626;
        _t11621 = _t11624;
        break _t11622;
      }
      _match_fail("line 16190");
    }
    return _t11621;
  }
  List$iter(_t11619, op_arms);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "});");
  Js_codegen$emit_line(ctx, "try {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const saved_two_11627 = ctx.trywith_ops;
  function _t11629(__p374) {
    let _t11631;
    const _t11630 = __p374;
    _t11632: {
      if (true) {
        const op = _t11630[0];
        _t11631 = op;
        break _t11632;
      }
      _match_fail("line 16190");
    }
    return _t11631;
  }
  const handled_op_names_11633 = List$map(_t11629, op_arms);
  (ctx.trywith_ops = List$concat(handled_op_names_11633, ctx.trywith_ops), undefined);
  const body_needs_cps_11635 = Js_codegen$expr_has_unhandled_perform(handled_op_names_11633, body);
  let _t11637;
  if (body_needs_cps_11635) {
    Js_codegen$emit_line(ctx, "return _trampoline(function() {");
    (ctx.indent = (ctx.indent + 1), undefined);
    function _t11638(body_result) {
      let _t11640;
      const _t11639 = return_arm;
      _t11641: {
        if (_t11639._tag === 1) {
          const ret_name = _t11639._val[0];
          const ret_body = _t11639._val[1];
          const ret_js_11642 = Js_codegen$mangle_name(ret_name);
          const actual_ret_11644 = (ret_js_11642 + ("_" + string_of_int(ctx.tmp_counter)));
          (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, ret_name, actual_ret_11644);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_11644)) + " = ") + __dict_Show_string.show(body_result)) + ";"));
          const v_11646 = Js_codegen$compile_non_tail(ctx, ret_body);
          Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11646)) + ";"));
          const _t11647 = Js_codegen$pop_scope(ctx);
          const _t11645 = _t11647;
          const _t11643 = _t11645;
          _t11640 = _t11643;
          break _t11641;
        }
        if (_t11639._tag === 0) {
          _t11640 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_result)) + ";"));
          break _t11641;
        }
        _match_fail("line 16190");
      }
      return _t11640;
    }
    Js_codegen$compile_cps(ctx, body, _t11638);
    (ctx.indent = (ctx.indent - 1), undefined);
    _t11637 = Js_codegen$emit_line(ctx, "});");
  } else {
    const body_v_11648 = Js_codegen$compile_non_tail(ctx, body);
    let _t11651;
    const _t11650 = return_arm;
    _t11652: {
      if (_t11650._tag === 1) {
        const ret_name = _t11650._val[0];
        const ret_body = _t11650._val[1];
        const ret_js_11653 = Js_codegen$mangle_name(ret_name);
        const actual_ret_11655 = (ret_js_11653 + ("_" + string_of_int(ctx.tmp_counter)));
        (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
        Js_codegen$push_scope(ctx);
        Js_codegen$bind_var(ctx, ret_name, actual_ret_11655);
        Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_11655)) + " = ") + __dict_Show_string.show(body_v_11648)) + ";"));
        const rv_11657 = Js_codegen$compile_non_tail(ctx, ret_body);
        Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(rv_11657)) + ";"));
        const _t11658 = Js_codegen$pop_scope(ctx);
        const _t11656 = _t11658;
        const _t11654 = _t11656;
        _t11651 = _t11654;
        break _t11652;
      }
      if (_t11650._tag === 0) {
        _t11651 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_v_11648)) + ";"));
        break _t11652;
      }
      _match_fail("line 16190");
    }
    const _t11649 = _t11651;
    _t11637 = _t11649;
  }
  _t11637;
  (ctx.trywith_ops = saved_two_11627, undefined);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "} catch (_exc) {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const first_11659 = Ref$create(true);
  function _t11661(__p375) {
    let _t11663;
    const _t11662 = __p375;
    _t11664: {
      if (true) {
        const op_name = _t11662[0];
        const arg_name = _t11662[1];
        const _k_name = _t11662[2];
        const handler_body = _t11662[3];
        let _t11665;
        if (Ref$get(first_11659)) {
          _t11665 = "if";
        } else {
          _t11665 = "} else if";
        }
        const prefix_11666 = _t11665;
        Ref$set(first_11659, false);
        Js_codegen$emit_line(ctx, (((__dict_Show_string.show(prefix_11666) + " (_exc && _exc._e === \"") + __dict_Show_string.show(op_name)) + "\") {"));
        (ctx.indent = (ctx.indent + 1), undefined);
        Js_codegen$push_scope(ctx);
        const arg_js_11668 = Js_codegen$mangle_name(arg_name);
        Js_codegen$bind_var(ctx, arg_name, arg_js_11668);
        Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(arg_js_11668)) + " = _exc._v;"));
        const v_11670 = Js_codegen$compile_non_tail(ctx, handler_body);
        Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11670)) + ";"));
        Js_codegen$pop_scope(ctx);
        const _t11671 = (ctx.indent = (ctx.indent - 1), undefined);
        const _t11669 = _t11671;
        const _t11667 = _t11669;
        _t11663 = _t11667;
        break _t11664;
      }
      _match_fail("line 16190");
    }
    return _t11663;
  }
  List$iter(_t11661, op_arms);
  Js_codegen$emit_line(ctx, "} else { throw _exc; }");
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, (("} finally { _h = " + __dict_Show_string.show(h_saved_11617)) + "; }"));
  (ctx.indent = (ctx.indent - 1), undefined);
  const _t11660 = Js_codegen$emit_line(ctx, "})();");
  const _t11636 = _t11660;
  const _t11634 = _t11636;
  const _t11628 = _t11634;
  const _t11618 = _t11628;
  return _t11618;
}
function Js_codegen$compile_handle(ctx, body, arms) {
  const result_11672 = Js_codegen$fresh_tmp(ctx);
  const return_arm_11674 = Ref$create(({_tag: 0, _name: "None"}));
  const provide_ops_11676 = Ref$create(null);
  const try_ops_11678 = Ref$create(null);
  const full_ops_11680 = Ref$create(null);
  function _t11682(arm) {
    let _t11684;
    const _t11683 = arm;
    _t11685: {
      if (_t11683._tag === 0) {
        const name = _t11683._val[0];
        const body = _t11683._val[1];
        _t11684 = Ref$set(return_arm_11674, ({_tag: 1, _name: "Some", _val: [name, body]}));
        break _t11685;
      }
      if (_t11683._tag === 1) {
        const op = _t11683._val[0];
        const arg = _t11683._val[1];
        const k = _t11683._val[2];
        const body = _t11683._val[3];
        _t11684 = Ref$set(full_ops_11680, ({_hd: [op, arg, k, body], _tl: Ref$get(full_ops_11680)}));
        break _t11685;
      }
      if (_t11683._tag === 2) {
        const op = _t11683._val[0];
        const arg = _t11683._val[1];
        const body = _t11683._val[2];
        _t11684 = Ref$set(provide_ops_11676, ({_hd: [op, arg, body], _tl: Ref$get(provide_ops_11676)}));
        break _t11685;
      }
      if (_t11683._tag === 3) {
        const op = _t11683._val[0];
        const arg = _t11683._val[1];
        const body = _t11683._val[2];
        _t11684 = Ref$set(try_ops_11678, ({_hd: [op, arg, body], _tl: Ref$get(try_ops_11678)}));
        break _t11685;
      }
      _match_fail("line 16190");
    }
    return _t11684;
  }
  List$iter(_t11682, arms);
  const provide_ops_11686 = List$rev(Ref$get(provide_ops_11676));
  const try_ops_11688 = List$rev(Ref$get(try_ops_11678));
  const full_ops_11690 = List$rev(Ref$get(full_ops_11680));
  let _t11693;
  const _t11692 = Ref$get(return_arm_11674);
  _t11694: {
    if (_t11692._tag === 1) {
      const rb = _t11692._val[1];
      _t11693 = (!Js_codegen$expr_has_perform(rb));
      break _t11694;
    }
    if (_t11692._tag === 0) {
      _t11693 = true;
      break _t11694;
    }
    _match_fail("line 16190");
  }
  const return_arm_pure_11695 = _t11693;
  let _t11697;
  if ((_eq(full_ops_11690, null) && (_eq(provide_ops_11686, null) && (!_eq(try_ops_11688, null) && return_arm_pure_11695)))) {
    function _t11698(__p376) {
      let _t11700;
      const _t11699 = __p376;
      _t11701: {
        if (true) {
          const op = _t11699[0];
          const arg = _t11699[1];
          const body = _t11699[2];
          _t11700 = [op, arg, "__k_try", body];
          break _t11701;
        }
        _match_fail("line 16190");
      }
      return _t11700;
    }
    const trywith_arms_11702 = List$map(_t11698, try_ops_11688);
    const _t11703 = Js_codegen$compile_handle_trywith(ctx, body, trywith_arms_11702, Ref$get(return_arm_11674), result_11672);
    _t11697 = _t11703;
  } else {
    function _t11704(__p377) {
      let _t11706;
      const _t11705 = __p377;
      _t11707: {
        if (true) {
          const op = _t11705[0];
          _t11706 = op;
          break _t11707;
        }
        _match_fail("line 16190");
      }
      return _t11706;
    }
    const simple_ops_11708 = List$map(_t11704, provide_ops_11686);
    Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(result_11672)) + " = (function() {"));
    (ctx.indent = (ctx.indent + 1), undefined);
    const h_saved_11710 = Js_codegen$fresh_tmp(ctx);
    Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(h_saved_11710)) + " = _h;"));
    const saved_direct_ops_11712 = ctx.direct_dispatch_ops;
    function _t11714(__p378) {
      let _t11716;
      const _t11715 = __p378;
      _t11717: {
        if (true) {
          const op_name = _t11715[0];
          const arg_name = _t11715[1];
          const value_body = _t11715[2];
          const direct_fn_11718 = Js_codegen$fresh_tmp(ctx);
          const arg_js_11720 = Js_codegen$mangle_name(arg_name);
          Js_codegen$emit_line(ctx, (((("function " + __dict_Show_string.show(direct_fn_11718)) + "(") + __dict_Show_string.show(arg_js_11720)) + ") {"));
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, arg_name, arg_js_11720);
          const v_11722 = Js_codegen$compile_non_tail(ctx, value_body);
          Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11722)) + ";"));
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          Js_codegen$emit_line(ctx, "}");
          const _t11723 = (ctx.direct_dispatch_ops = ({_hd: [op_name, direct_fn_11718], _tl: ctx.direct_dispatch_ops}), undefined);
          const _t11721 = _t11723;
          const _t11719 = _t11721;
          _t11716 = _t11719;
          break _t11717;
        }
        _match_fail("line 16190");
      }
      return _t11716;
    }
    List$iter(_t11714, provide_ops_11686);
    function _t11724(__p379) {
      let _t11726;
      const _t11725 = __p379;
      _t11727: {
        if (true) {
          const op = _t11725[0];
          _t11726 = op;
          break _t11727;
        }
        _match_fail("line 16190");
      }
      return _t11726;
    }
    function _t11728(__p380) {
      let _t11730;
      const _t11729 = __p380;
      _t11731: {
        if (true) {
          const op = _t11729[0];
          _t11730 = op;
          break _t11731;
        }
        _match_fail("line 16190");
      }
      return _t11730;
    }
    const shadowed_ops_11732 = List$concat(List$map(_t11724, full_ops_11690), List$map(_t11728, try_ops_11688));
    let _t11734;
    if (!_eq(shadowed_ops_11732, null)) {
      function _t11735(__p381) {
        let _t11737;
        const _t11736 = __p381;
        _t11738: {
          if (true) {
            const op = _t11736[0];
            _t11737 = (!List$mem(op, shadowed_ops_11732));
            break _t11738;
          }
          _match_fail("line 16190");
        }
        return _t11737;
      }
      _t11734 = (ctx.direct_dispatch_ops = List$filter(_t11735, ctx.direct_dispatch_ops), undefined);
    } else {
      _t11734 = undefined;
    }
    _t11734;
    Js_codegen$emit_line(ctx, (("_h = Object.assign({}, " + __dict_Show_string.show(h_saved_11710)) + ", {"));
    (ctx.indent = (ctx.indent + 1), undefined);
    function _t11739(__p382) {
      let _t11741;
      const _t11740 = __p382;
      _t11742: {
        if (true) {
          const op_name = _t11740[0];
          const arg_name = _t11740[1];
          const arg_js_11743 = Js_codegen$mangle_name(arg_name);
          const k_js_11745 = "_k";
          const direct_fn_11747 = List$assoc(op_name, ctx.direct_dispatch_ops);
          const _t11748 = Js_codegen$emit_line(ctx, (((((((((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_11743)) + ", ") + __dict_Show_string.show(k_js_11745)) + ") { return _bounce(function() { return ") + __dict_Show_string.show(k_js_11745)) + "(") + __dict_Show_string.show(direct_fn_11747)) + "(") + __dict_Show_string.show(arg_js_11743)) + ")); }); },"));
          const _t11746 = _t11748;
          const _t11744 = _t11746;
          _t11741 = _t11744;
          break _t11742;
        }
        _match_fail("line 16190");
      }
      return _t11741;
    }
    List$iter(_t11739, provide_ops_11686);
    function _t11749(__p383) {
      let _t11751;
      const _t11750 = __p383;
      _t11752: {
        if (true) {
          const op_name = _t11750[0];
          const arg_name = _t11750[1];
          const fallback_body = _t11750[2];
          const arg_js_11753 = Js_codegen$mangle_name(arg_name);
          const k_js_11755 = "_k";
          Js_codegen$emit_line(ctx, (((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_11753)) + ", ") + __dict_Show_string.show(k_js_11755)) + ") {"));
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, arg_name, arg_js_11753);
          const v_11757 = Js_codegen$compile_non_tail(ctx, fallback_body);
          Js_codegen$emit_line(ctx, (("return _bounce(function() { return " + __dict_Show_string.show(v_11757)) + "; });"));
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          const _t11758 = Js_codegen$emit_line(ctx, "},");
          const _t11756 = _t11758;
          const _t11754 = _t11756;
          _t11751 = _t11754;
          break _t11752;
        }
        _match_fail("line 16190");
      }
      return _t11751;
    }
    List$iter(_t11749, try_ops_11688);
    function _t11759(__p384) {
      let _t11761;
      const _t11760 = __p384;
      _t11762: {
        if (true) {
          const op_name = _t11760[0];
          const arg_name = _t11760[1];
          const k_name = _t11760[2];
          const handler_body = _t11760[3];
          const arg_js_11763 = Js_codegen$mangle_name(arg_name);
          const k_js_11765 = Js_codegen$mangle_name(k_name);
          Js_codegen$emit_line(ctx, (((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_11763)) + ", ") + __dict_Show_string.show(k_js_11765)) + ") {"));
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, arg_name, arg_js_11763);
          Js_codegen$bind_var(ctx, k_name, k_js_11765);
          const saved_htr_11767 = ctx.handler_tail_resume;
          (ctx.handler_tail_resume = Js_codegen$all_resumes_are_tail(handler_body), undefined);
          const v_11769 = Js_codegen$compile_non_tail(ctx, handler_body);
          (ctx.handler_tail_resume = saved_htr_11767, undefined);
          Js_codegen$emit_line(ctx, (("return _bounce(function() { return " + __dict_Show_string.show(v_11769)) + "; });"));
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          const _t11770 = Js_codegen$emit_line(ctx, "},");
          const _t11768 = _t11770;
          const _t11766 = _t11768;
          const _t11764 = _t11766;
          _t11761 = _t11764;
          break _t11762;
        }
        _match_fail("line 16190");
      }
      return _t11761;
    }
    List$iter(_t11759, full_ops_11690);
    (ctx.indent = (ctx.indent - 1), undefined);
    Js_codegen$emit_line(ctx, "});");
    let _t11771;
    if (_eq(simple_ops_11708, null)) {
      _t11771 = Js_codegen$expr_has_perform(body);
    } else {
      _t11771 = Js_codegen$expr_has_unhandled_perform(simple_ops_11708, body);
    }
    const body_needs_cps_11772 = _t11771;
    Js_codegen$emit_line(ctx, "try {");
    (ctx.indent = (ctx.indent + 1), undefined);
    let _t11774;
    if (body_needs_cps_11772) {
      Js_codegen$emit_line(ctx, "return _trampoline(function() {");
      (ctx.indent = (ctx.indent + 1), undefined);
      function _t11775(body_result) {
        let _t11777;
        const _t11776 = Ref$get(return_arm_11674);
        _t11778: {
          if (_t11776._tag === 1) {
            const ret_name = _t11776._val[0];
            const ret_body = _t11776._val[1];
            const ret_js_11779 = Js_codegen$mangle_name(ret_name);
            const actual_ret_11781 = (ret_js_11779 + ("_" + string_of_int(ctx.tmp_counter)));
            (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
            Js_codegen$push_scope(ctx);
            Js_codegen$bind_var(ctx, ret_name, actual_ret_11781);
            Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_11781)) + " = ") + __dict_Show_string.show(body_result)) + ";"));
            const v_11783 = Js_codegen$compile_non_tail(ctx, ret_body);
            Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11783)) + ";"));
            const _t11784 = Js_codegen$pop_scope(ctx);
            const _t11782 = _t11784;
            const _t11780 = _t11782;
            _t11777 = _t11780;
            break _t11778;
          }
          if (_t11776._tag === 0) {
            _t11777 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_result)) + ";"));
            break _t11778;
          }
          _match_fail("line 16190");
        }
        return _t11777;
      }
      Js_codegen$compile_cps(ctx, body, _t11775);
      (ctx.indent = (ctx.indent - 1), undefined);
      _t11774 = Js_codegen$emit_line(ctx, "});");
    } else {
      const body_v_11785 = Js_codegen$compile_non_tail(ctx, body);
      let _t11788;
      const _t11787 = Ref$get(return_arm_11674);
      _t11789: {
        if (_t11787._tag === 1) {
          const ret_name = _t11787._val[0];
          const ret_body = _t11787._val[1];
          const ret_js_11790 = Js_codegen$mangle_name(ret_name);
          const actual_ret_11792 = (ret_js_11790 + ("_" + string_of_int(ctx.tmp_counter)));
          (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, ret_name, actual_ret_11792);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_11792)) + " = ") + __dict_Show_string.show(body_v_11785)) + ";"));
          const rv_11794 = Js_codegen$compile_non_tail(ctx, ret_body);
          Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(rv_11794)) + ";"));
          const _t11795 = Js_codegen$pop_scope(ctx);
          const _t11793 = _t11795;
          const _t11791 = _t11793;
          _t11788 = _t11791;
          break _t11789;
        }
        if (_t11787._tag === 0) {
          _t11788 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_v_11785)) + ";"));
          break _t11789;
        }
        _match_fail("line 16190");
      }
      const _t11786 = _t11788;
      _t11774 = _t11786;
    }
    _t11774;
    (ctx.indent = (ctx.indent - 1), undefined);
    Js_codegen$emit_line(ctx, (("} finally { _h = " + __dict_Show_string.show(h_saved_11710)) + "; }"));
    (ctx.direct_dispatch_ops = saved_direct_ops_11712, undefined);
    (ctx.indent = (ctx.indent - 1), undefined);
    const _t11773 = Js_codegen$emit_line(ctx, "})();");
    const _t11733 = _t11773;
    const _t11713 = _t11733;
    const _t11711 = _t11713;
    const _t11709 = _t11711;
    _t11697 = _t11709;
  }
  _t11697;
  const _t11696 = result_11672;
  const _t11691 = _t11696;
  const _t11689 = _t11691;
  const _t11687 = _t11689;
  const _t11681 = _t11687;
  const _t11679 = _t11681;
  const _t11677 = _t11679;
  const _t11675 = _t11677;
  const _t11673 = _t11675;
  return _t11673;
}
function Js_codegen$compile_cps(ctx, te, cont) {
  while (true) {
    let _t11796;
    if ((!Js_codegen$expr_has_perform(te))) {
      const v_11797 = Js_codegen$compile_non_tail(ctx, te);
      const _t11798 = cont(v_11797);
      _t11796 = _t11798;
    } else {
      let _t11800;
      const _t11799 = te.expr;
      _t11801: {
        if (_t11799._tag === 29) {
          const op_name = _t11799._val[0];
          const arg = _t11799._val[1];
          _t11800 = Js_codegen$compile_perform_cps(ctx, op_name, arg, cont);
          break _t11801;
        }
        if (_t11799._tag === 30) {
          const v_11802 = Js_codegen$compile_non_tail(ctx, te);
          const _t11803 = cont(v_11802);
          _t11800 = _t11803;
          break _t11801;
        }
        if (_t11799._tag === 31) {
          const k_expr = _t11799._val[0];
          const val_expr = _t11799._val[1];
          const k_js_11804 = Js_codegen$compile_non_tail(ctx, k_expr);
          const v_js_11806 = Js_codegen$compile_non_tail(ctx, val_expr);
          const _t11807 = Js_codegen$emit_line(ctx, (((("return _bounce(function() { return " + __dict_Show_string.show(k_js_11804)) + "(") + __dict_Show_string.show(v_js_11806)) + "); });"));
          const _t11805 = _t11807;
          _t11800 = _t11805;
          break _t11801;
        }
        if (_t11799._tag === 8) {
          const name = _t11799._val[0];
          const e1 = _t11799._val[2];
          const e2 = _t11799._val[3];
          _t11800 = Js_codegen$compile_let_cps(ctx, name, e1, e2, cont);
          break _t11801;
        }
        if (_t11799._tag === 9) {
          const name = _t11799._val[0];
          const fn_expr = _t11799._val[2];
          const body = _t11799._val[3];
          _t11800 = Js_codegen$compile_letrec_cps(ctx, name, fn_expr, body, cont);
          break _t11801;
        }
        if (_t11799._tag === 28) {
          const e1 = _t11799._val[0];
          const e2 = _t11799._val[1];
          _t11800 = Js_codegen$compile_seq_cps(ctx, e1, e2, cont);
          break _t11801;
        }
        if (_t11799._tag === 12) {
          const cond = _t11799._val[0];
          const then_e = _t11799._val[1];
          const else_e = _t11799._val[2];
          _t11800 = Js_codegen$compile_if_cps(ctx, cond, then_e, else_e, cont);
          break _t11801;
        }
        if (_t11799._tag === 24) {
          const scrut = _t11799._val[0];
          const arms = _t11799._val[1];
          const _partial = _t11799._val[2];
          _t11800 = Js_codegen$compile_match_cps(ctx, scrut, arms, te.loc, cont);
          break _t11801;
        }
        if (_t11799._tag === 11) {
          const fn_ = _t11799._val[0];
          const arg = _t11799._val[1];
          _t11800 = Js_codegen$compile_app_cps(ctx, te, fn_, arg, cont);
          break _t11801;
        }
        if (_t11799._tag === 10) {
          const v_11808 = Js_codegen$compile_non_tail(ctx, te);
          const _t11809 = cont(v_11808);
          _t11800 = _t11809;
          break _t11801;
        }
        if (_t11799._tag === 25) {
          const name = _t11799._val[0];
          const init = _t11799._val[1];
          const body = _t11799._val[2];
          let _t11810;
          if (Js_codegen$expr_has_perform(init)) {
            const _t11811 = ctx;
            const _t11812 = init;
            function _t11814(init_v) {
              const js_name_11815 = Js_codegen$mangle_name(name);
              const actual_name_11817 = (js_name_11815 + ("_" + string_of_int(ctx.tmp_counter)));
              (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
              Js_codegen$push_scope(ctx);
              Js_codegen$bind_var(ctx, name, actual_name_11817);
              Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(actual_name_11817)) + " = _resolve(") + __dict_Show_string.show(init_v)) + ");"));
              Js_codegen$compile_cps(ctx, body, cont);
              const _t11818 = Js_codegen$pop_scope(ctx);
              const _t11816 = _t11818;
              return _t11816;
            }
            const _t11813 = _t11814;
            ctx = _t11811;
            te = _t11812;
            cont = _t11813;
            continue;
            _t11810 = undefined;
          } else {
            const v_11819 = Js_codegen$compile_non_tail(ctx, init);
            const js_name_11821 = Js_codegen$mangle_name(name);
            const actual_name_11823 = (js_name_11821 + ("_" + string_of_int(ctx.tmp_counter)));
            (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
            Js_codegen$push_scope(ctx);
            Js_codegen$bind_var(ctx, name, actual_name_11823);
            Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(actual_name_11823)) + " = _resolve(") + __dict_Show_string.show(v_11819)) + ");"));
            Js_codegen$compile_cps(ctx, body, cont);
            const _t11824 = Js_codegen$pop_scope(ctx);
            const _t11822 = _t11824;
            const _t11820 = _t11822;
            _t11810 = _t11820;
          }
          _t11800 = _t11810;
          break _t11801;
        }
        if (_t11799._tag === 32) {
          const cond = _t11799._val[0];
          const body = _t11799._val[1];
          _t11800 = Js_codegen$compile_while_cps(ctx, cond, body, cont);
          break _t11801;
        }
        if (true) {
          const v_11825 = Js_codegen$compile_non_tail(ctx, te);
          const _t11826 = cont(v_11825);
          _t11800 = _t11826;
          break _t11801;
        }
        _match_fail("line 16190");
      }
      _t11796 = _t11800;
    }
    return _t11796;
  }
}
function Js_codegen$compile_while_cps(ctx, cond, body, cont) {
  const loop_fn_11827 = Js_codegen$fresh_tmp(ctx);
  const break_flag_11829 = Js_codegen$fresh_tmp(ctx);
  const break_val_11831 = Js_codegen$fresh_tmp(ctx);
  const saved_break_flag_11833 = ctx.break_flag_name;
  const saved_break_val_11835 = ctx.break_val_name;
  (ctx.break_flag_name = break_flag_11829, undefined);
  (ctx.break_val_name = break_val_11831, undefined);
  Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(break_flag_11829)) + " = false, ") + __dict_Show_string.show(break_val_11831)) + ";"));
  Js_codegen$emit_line(ctx, (("function " + __dict_Show_string.show(loop_fn_11827)) + "() {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  const c_11837 = Js_codegen$compile_non_tail(ctx, cond);
  Js_codegen$emit_line(ctx, (("if (!(" + __dict_Show_string.show(c_11837)) + ")) {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  cont("undefined");
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  function _t11839(body_val) {
    Js_codegen$emit_line(ctx, (__dict_Show_string.show(body_val) + ";"));
    Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(break_flag_11829)) + ") {"));
    (ctx.indent = (ctx.indent + 1), undefined);
    cont(break_val_11831);
    (ctx.indent = (ctx.indent - 1), undefined);
    Js_codegen$emit_line(ctx, "}");
    return Js_codegen$emit_line(ctx, (("return _bounce(" + __dict_Show_string.show(loop_fn_11827)) + ");"));
  }
  Js_codegen$compile_cps(ctx, body, _t11839);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  Js_codegen$emit_line(ctx, (("return _bounce(" + __dict_Show_string.show(loop_fn_11827)) + ");"));
  (ctx.break_flag_name = saved_break_flag_11833, undefined);
  const _t11838 = (ctx.break_val_name = saved_break_val_11835, undefined);
  const _t11836 = _t11838;
  const _t11834 = _t11836;
  const _t11832 = _t11834;
  const _t11830 = _t11832;
  const _t11828 = _t11830;
  return _t11828;
}
function Js_codegen$compile_perform_cps(ctx, op_name, arg, cont) {
  let _t11841;
  const _t11840 = List$assoc_opt(op_name, ctx.direct_dispatch_ops);
  _t11842: {
    if (_t11840._tag === 1) {
      const direct_fn = _t11840._val;
      const arg_js_11843 = Js_codegen$compile_non_tail(ctx, arg);
      const result_var_11845 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_line(ctx, (((((("const " + __dict_Show_string.show(result_var_11845)) + " = ") + __dict_Show_string.show(direct_fn)) + "(") + __dict_Show_string.show(arg_js_11843)) + ");"));
      const _t11846 = cont(result_var_11845);
      const _t11844 = _t11846;
      _t11841 = _t11844;
      break _t11842;
    }
    if (_t11840._tag === 0) {
      if (List$mem(op_name, ctx.trywith_ops)) {
        const arg_js_11847 = Js_codegen$compile_non_tail(ctx, arg);
        const _t11848 = Js_codegen$emit_line(ctx, (((("throw {_e: \"" + __dict_Show_string.show(op_name)) + "\", _v: ") + __dict_Show_string.show(arg_js_11847)) + "};"));
        _t11841 = _t11848;
        break _t11842;
      }
    }
    if (_t11840._tag === 0) {
      const arg_js_11849 = Js_codegen$compile_non_tail(ctx, arg);
      const result_var_11851 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_line(ctx, (((((("return _h[\"" + __dict_Show_string.show(op_name)) + "\"](") + __dict_Show_string.show(arg_js_11849)) + ", function(") + __dict_Show_string.show(result_var_11851)) + ") {"));
      (ctx.indent = (ctx.indent + 1), undefined);
      Js_codegen$emit_line(ctx, "return _bounce(function() {");
      (ctx.indent = (ctx.indent + 1), undefined);
      cont(result_var_11851);
      (ctx.indent = (ctx.indent - 1), undefined);
      Js_codegen$emit_line(ctx, "});");
      (ctx.indent = (ctx.indent - 1), undefined);
      const _t11852 = Js_codegen$emit_line(ctx, "});");
      const _t11850 = _t11852;
      _t11841 = _t11850;
      break _t11842;
    }
    _match_fail("line 16190");
  }
  return _t11841;
}
function Js_codegen$compile_let_cps(ctx, name, e1, e2, cont) {
  let _t11853;
  if (Js_codegen$expr_has_perform(e1)) {
    function _t11854(v1) {
      const js_name_11855 = Js_codegen$mangle_name(name);
      let _t11857;
      if ((js_name_11855 === "_")) {
        _t11857 = Js_codegen$fresh_tmp(ctx);
      } else {
        function _t11858(n) {
          (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
          return n;
        }
        _t11857 = _call(_t11858, [(js_name_11855 + ("_" + string_of_int(ctx.tmp_counter)))]);
      }
      const actual_name_11859 = _t11857;
      Js_codegen$push_scope(ctx);
      Js_codegen$bind_var(ctx, name, actual_name_11859);
      Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_name_11859)) + " = _resolve(") + __dict_Show_string.show(v1)) + ");"));
      Js_codegen$compile_cps(ctx, e2, cont);
      const _t11860 = Js_codegen$pop_scope(ctx);
      const _t11856 = _t11860;
      return _t11856;
    }
    _t11853 = Js_codegen$compile_cps(ctx, e1, _t11854);
  } else {
    const v1_11861 = Js_codegen$compile_non_tail(ctx, e1);
    const js_name_11863 = Js_codegen$mangle_name(name);
    let _t11865;
    if ((js_name_11863 === "_")) {
      _t11865 = Js_codegen$fresh_tmp(ctx);
    } else {
      function _t11866(n) {
        (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
        return n;
      }
      _t11865 = _call(_t11866, [(js_name_11863 + ("_" + string_of_int(ctx.tmp_counter)))]);
    }
    const actual_name_11867 = _t11865;
    Js_codegen$push_scope(ctx);
    Js_codegen$bind_var(ctx, name, actual_name_11867);
    Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_name_11867)) + " = _resolve(") + __dict_Show_string.show(v1_11861)) + ");"));
    Js_codegen$compile_cps(ctx, e2, cont);
    const _t11868 = Js_codegen$pop_scope(ctx);
    const _t11864 = _t11868;
    const _t11862 = _t11864;
    _t11853 = _t11862;
  }
  return _t11853;
}
function Js_codegen$compile_letrec_cps(ctx, name, fn_expr, body, cont) {
  const js_name_11869 = Js_codegen$mangle_name(name);
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, js_name_11869);
  Js_codegen$compile_named_function(ctx, js_name_11869, fn_expr);
  Js_codegen$compile_cps(ctx, body, cont);
  const _t11870 = Js_codegen$pop_scope(ctx);
  return _t11870;
}
function Js_codegen$compile_seq_cps(ctx, e1, e2, cont) {
  let _t11871;
  if (Js_codegen$expr_has_perform(e1)) {
    function _t11872(v1) {
      Js_codegen$emit_line(ctx, (("_resolve(" + __dict_Show_string.show(v1)) + ");"));
      return Js_codegen$compile_cps(ctx, e2, cont);
    }
    _t11871 = Js_codegen$compile_cps(ctx, e1, _t11872);
  } else {
    const v1_11873 = Js_codegen$compile_non_tail(ctx, e1);
    Js_codegen$emit_line(ctx, (("_resolve(" + __dict_Show_string.show(v1_11873)) + ");"));
    const _t11874 = Js_codegen$compile_cps(ctx, e2, cont);
    _t11871 = _t11874;
  }
  return _t11871;
}
function Js_codegen$compile_if_cps(ctx, cond, then_e, else_e, cont) {
  const c_11875 = Js_codegen$compile_non_tail(ctx, cond);
  Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(c_11875)) + ") {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  Js_codegen$compile_cps(ctx, then_e, cont);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "} else {");
  (ctx.indent = (ctx.indent + 1), undefined);
  Js_codegen$compile_cps(ctx, else_e, cont);
  (ctx.indent = (ctx.indent - 1), undefined);
  const _t11876 = Js_codegen$emit_line(ctx, "}");
  return _t11876;
}
function Js_codegen$compile_match_cps(ctx, scrut, arms, loc, cont) {
  const scrut_js_11877 = Js_codegen$compile_non_tail(ctx, scrut);
  const scrut_tmp_11879 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(scrut_tmp_11879)) + " = ") + __dict_Show_string.show(scrut_js_11877)) + ";"));
  const matched_11881 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(matched_11881)) + " = false;"));
  function _t11883(__p385) {
    let _t11885;
    const _t11884 = __p385;
    _t11886: {
      if (true) {
        const pat = _t11884[0];
        const guard = _t11884[1];
        const body = _t11884[2];
        let _t11888;
        const _t11887 = Js_codegen$compile_pattern(ctx, scrut_tmp_11879, pat);
        _t11889: {
          if (true) {
            const conds = _t11887[0];
            const bindings = _t11887[1];
            let _t11891;
            const _t11890 = conds;
            _t11892: {
              if (_t11890 === null) {
                _t11891 = "true";
                break _t11892;
              }
              if (true) {
                _t11891 = String$concat(" && ", conds);
                break _t11892;
              }
              _match_fail("line 16190");
            }
            const cond_str_11893 = _t11891;
            Js_codegen$emit_line(ctx, (((("if (!" + __dict_Show_string.show(matched_11881)) + " && ") + __dict_Show_string.show(cond_str_11893)) + ") {"));
            (ctx.indent = (ctx.indent + 1), undefined);
            Js_codegen$push_scope(ctx);
            function _t11895(__p386) {
              let _t11897;
              const _t11896 = __p386;
              _t11898: {
                if (true) {
                  const mml_name = _t11896[0];
                  const js_expr = _t11896[1];
                  const js_nm_11899 = Js_codegen$mangle_name(mml_name);
                  Js_codegen$bind_var(ctx, mml_name, js_nm_11899);
                  const _t11900 = Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_nm_11899)) + " = ") + __dict_Show_string.show(js_expr)) + ";"));
                  _t11897 = _t11900;
                  break _t11898;
                }
                _match_fail("line 16190");
              }
              return _t11897;
            }
            List$iter(_t11895, bindings);
            let _t11902;
            const _t11901 = guard;
            _t11903: {
              if (_t11901._tag === 1) {
                const g = _t11901._val;
                const guard_js_11904 = Js_codegen$compile_non_tail(ctx, g);
                Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(guard_js_11904)) + ") {"));
                (ctx.indent = (ctx.indent + 1), undefined);
                Js_codegen$emit_line(ctx, (__dict_Show_string.show(matched_11881) + " = true;"));
                Js_codegen$compile_cps(ctx, body, cont);
                (ctx.indent = (ctx.indent - 1), undefined);
                const _t11905 = Js_codegen$emit_line(ctx, "}");
                _t11902 = _t11905;
                break _t11903;
              }
              if (_t11901._tag === 0) {
                Js_codegen$emit_line(ctx, (__dict_Show_string.show(matched_11881) + " = true;"));
                _t11902 = Js_codegen$compile_cps(ctx, body, cont);
                break _t11903;
              }
              _match_fail("line 16190");
            }
            _t11902;
            Js_codegen$pop_scope(ctx);
            (ctx.indent = (ctx.indent - 1), undefined);
            const _t11894 = Js_codegen$emit_line(ctx, "}");
            _t11888 = _t11894;
            break _t11889;
          }
          _match_fail("line 16190");
        }
        _t11885 = _t11888;
        break _t11886;
      }
      _match_fail("line 16190");
    }
    return _t11885;
  }
  List$iter(_t11883, arms);
  const _t11882 = Js_codegen$emit_line(ctx, (((("if (!" + __dict_Show_string.show(matched_11881)) + ") _match_fail(\"line ") + __dict_Show_int.show(loc.line)) + "\");"));
  const _t11880 = _t11882;
  const _t11878 = _t11880;
  return _t11878;
}
function Js_codegen$compile_app_cps(ctx, _te, fn_, arg, cont) {
  function collect_args(expr, acc) {
    while (true) {
      let _t11907;
      const _t11906 = expr.expr;
      _t11908: {
        if (_t11906._tag === 11) {
          const inner_fn = _t11906._val[0];
          const inner_arg = _t11906._val[1];
          const _t11909 = inner_fn;
          const _t11910 = ({_hd: inner_arg, _tl: acc});
          expr = _t11909;
          acc = _t11910;
          continue;
          _t11907 = undefined;
          break _t11908;
        }
        if (true) {
          _t11907 = [expr, acc];
          break _t11908;
        }
        _match_fail("line 16190");
      }
      return _t11907;
    }
  }
  let _t11913;
  const _t11912 = collect_args(fn_, ({_hd: arg, _tl: null}));
  _t11914: {
    if (true) {
      const base_fn = _t11912[0];
      const all_args = _t11912[1];
      const fn_js_11915 = Js_codegen$compile_non_tail(ctx, base_fn);
      const args_js_11917 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), all_args);
      const n_11919 = List$length(all_args);
      const known_arity_11921 = Js_codegen$count_arrows(base_fn.ty);
      let _t11923;
      if (_eq(known_arity_11921, ({_tag: 1, _name: "Some", _val: n_11919}))) {
        _t11923 = (fn_js_11915 + ("(" + (String$concat(", ", args_js_11917) + ")")));
      } else {
        _t11923 = ("_call(" + (fn_js_11915 + (", [" + (String$concat(", ", args_js_11917) + "])"))));
      }
      const call_expr_11924 = _t11923;
      const result_var_11926 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_var_11926)) + " = _resolve(") + __dict_Show_string.show(call_expr_11924)) + ");"));
      const _t11927 = cont(result_var_11926);
      const _t11925 = _t11927;
      const _t11922 = _t11925;
      const _t11920 = _t11922;
      const _t11918 = _t11920;
      const _t11916 = _t11918;
      _t11913 = _t11916;
      break _t11914;
    }
    _match_fail("line 16190");
  }
  const _t11911 = _t11913;
  return _t11911;
}
function Js_codegen$compile_decl(ctx, decl) {
  let _t11929;
  const _t11928 = decl;
  _t11930: {
    if (_t11928._tag === 0) {
      const name = _t11928._val[0];
      const te = _t11928._val[1];
      let _t11931;
      if ((name === "_")) {
        const v_11932 = Js_codegen$compile_expr(ctx, te);
        const _t11933 = Js_codegen$emit_line(ctx, (__dict_Show_string.show(v_11932) + ";"));
        _t11931 = _t11933;
      } else {
        const base_name_11934 = Js_codegen$mangle_name(name);
        let _t11937;
        const _t11936 = ctx.scopes;
        _t11938: {
          if (_t11936 !== null) {
            const tbl = _t11936._hd;
            if (_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, tbl, name])) {
              _t11937 = (Js_codegen$fresh_tmp(ctx) + ("_" + base_name_11934));
              break _t11938;
            }
          }
          if (true) {
            _t11937 = base_name_11934;
            break _t11938;
          }
          _match_fail("line 16190");
        }
        const js_name_11939 = _t11937;
        let _t11942;
        const _t11941 = te.expr;
        _t11943: {
          if (_t11941._tag === 10) {
            Js_codegen$compile_named_function(ctx, js_name_11939, te);
            _t11942 = Js_codegen$bind_var(ctx, name, js_name_11939);
            break _t11943;
          }
          if (true) {
            const v_11944 = Js_codegen$compile_expr(ctx, te);
            Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_name_11939)) + " = ") + __dict_Show_string.show(v_11944)) + ";"));
            const _t11945 = Js_codegen$bind_var(ctx, name, js_name_11939);
            _t11942 = _t11945;
            break _t11943;
          }
          _match_fail("line 16190");
        }
        _t11942;
        let _t11946;
        if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
          _t11946 = (ctx.top_level_exports = ({_hd: [name, js_name_11939], _tl: ctx.top_level_exports}), undefined);
        } else {
          _t11946 = undefined;
        }
        const _t11940 = _t11946;
        const _t11935 = _t11940;
        _t11931 = _t11935;
      }
      _t11929 = _t11931;
      break _t11930;
    }
    if (_t11928._tag === 1) {
      const name = _t11928._val[0];
      const te = _t11928._val[1];
      const js_name_11947 = Js_codegen$mangle_name(name);
      const v_11949 = Js_codegen$compile_expr(ctx, te);
      Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(js_name_11947)) + " = ") + __dict_Show_string.show(v_11949)) + ";"));
      Js_codegen$bind_var(ctx, name, js_name_11947);
      let _t11951;
      if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
        _t11951 = (ctx.top_level_exports = ({_hd: [name, js_name_11947], _tl: ctx.top_level_exports}), undefined);
      } else {
        _t11951 = undefined;
      }
      const _t11950 = _t11951;
      const _t11948 = _t11950;
      _t11929 = _t11948;
      break _t11930;
    }
    if (_t11928._tag === 2) {
      const name = _t11928._val[0];
      const te = _t11928._val[1];
      const js_name_11952 = Js_codegen$mangle_name(name);
      Js_codegen$bind_var(ctx, name, js_name_11952);
      Js_codegen$compile_named_function(ctx, js_name_11952, te);
      let _t11954;
      if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
        _t11954 = (ctx.top_level_exports = ({_hd: [name, js_name_11952], _tl: ctx.top_level_exports}), undefined);
      } else {
        _t11954 = undefined;
      }
      const _t11953 = _t11954;
      _t11929 = _t11953;
      break _t11930;
    }
    if (_t11928._tag === 3) {
      const bindings = _t11928._val;
      function _t11955(__p387) {
        let _t11957;
        const _t11956 = __p387;
        _t11958: {
          if (true) {
            const name = _t11956[0];
            const js_name_11959 = Js_codegen$mangle_name(name);
            Js_codegen$bind_var(ctx, name, js_name_11959);
            let _t11961;
            if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
              _t11961 = (ctx.top_level_exports = ({_hd: [name, js_name_11959], _tl: ctx.top_level_exports}), undefined);
            } else {
              _t11961 = undefined;
            }
            const _t11960 = _t11961;
            _t11957 = _t11960;
            break _t11958;
          }
          _match_fail("line 16190");
        }
        return _t11957;
      }
      List$iter(_t11955, bindings);
      function _t11962(__p388) {
        let _t11964;
        const _t11963 = __p388;
        _t11965: {
          if (true) {
            const name = _t11963[0];
            const fn_expr = _t11963[1];
            const js_name_11966 = Js_codegen$mangle_name(name);
            const _t11967 = Js_codegen$compile_named_function(ctx, js_name_11966, fn_expr);
            _t11964 = _t11967;
            break _t11965;
          }
          _match_fail("line 16190");
        }
        return _t11964;
      }
      _t11929 = List$iter(_t11962, bindings);
      break _t11930;
    }
    if (_t11928._tag === 4) {
      _t11929 = undefined;
      break _t11930;
    }
    if (_t11928._tag === 6) {
      _t11929 = undefined;
      break _t11930;
    }
    if (_t11928._tag === 7) {
      _t11929 = undefined;
      break _t11930;
    }
    if (_t11928._tag === 5) {
      const te = _t11928._val;
      const v_11968 = Js_codegen$compile_expr(ctx, te);
      const _t11969 = Js_codegen$emit_line(ctx, (("_last_val = " + __dict_Show_string.show(v_11968)) + ";"));
      _t11929 = _t11969;
      break _t11930;
    }
    if (_t11928._tag === 8) {
      const name = _t11928._val[0];
      const _scheme = _t11928._val[1];
      const js_name_11970 = Js_codegen$mangle_name(name);
      Js_codegen$emit_line(ctx, (((((((((("if (typeof " + __dict_Show_string.show(js_name_11970)) + " === \"undefined\") { if (globalThis._mmlExterns && globalThis._mmlExterns[") + __dict_Show_string.show(Js_codegen$escape_js_string(name))) + "]) var ") + __dict_Show_string.show(js_name_11970)) + " = globalThis._mmlExterns[") + __dict_Show_string.show(Js_codegen$escape_js_string(name))) + "]; else throw new Error(\"extern \" + ") + __dict_Show_string.show(Js_codegen$escape_js_string(name))) + " + \" not provided\"); }"));
      const _t11971 = Js_codegen$bind_var(ctx, name, js_name_11970);
      _t11929 = _t11971;
      break _t11930;
    }
    if (_t11928._tag === 9) {
      const mod_name = _t11928._val[0];
      const decls = _t11928._val[1];
      const saved_module_11972 = ctx.current_module;
      (ctx.current_module = ({_tag: 1, _name: "Some", _val: mod_name}), undefined);
      Js_codegen$push_scope(ctx);
      List$iter(_call(Js_codegen$compile_decl, [ctx]), decls);
      (ctx.current_module = saved_module_11972, undefined);
      let _t11975;
      const _t11974 = ctx.scopes;
      _t11976: {
        if (_t11974 !== null) {
          const current = _t11974._hd;
          function _t11977(mml_name, js_name) {
            const qualified_11978 = (mod_name + ("." + mml_name));
            let _t11981;
            const _t11980 = ctx.scopes;
            _t11982: {
              if (_t11980 !== null && _t11980._tl !== null) {
                const parent = _t11980._tl._hd;
                _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, parent, qualified_11978, js_name]);
                _t11981 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, parent, mml_name, js_name]);
                break _t11982;
              }
              if (true) {
                _t11981 = undefined;
                break _t11982;
              }
              _match_fail("line 16190");
            }
            const _t11979 = _t11981;
            return _t11979;
          }
          _t11975 = Hashtbl$iter(_t11977, current);
          break _t11976;
        }
        if (_t11974 === null) {
          _t11975 = undefined;
          break _t11976;
        }
        _match_fail("line 16190");
      }
      _t11975;
      const _t11973 = Js_codegen$pop_scope(ctx);
      _t11929 = _t11973;
      break _t11930;
    }
    if (_t11928._tag === 10) {
      const aliases = _t11928._val;
      function _t11983(__p389) {
        let _t11985;
        const _t11984 = __p389;
        _t11986: {
          if (true) {
            const short_name = _t11984[0];
            const qualified_name = _t11984[1];
            const js_name_11987 = Js_codegen$lookup_var(ctx, qualified_name);
            const _t11988 = Js_codegen$bind_var(ctx, short_name, js_name_11987);
            _t11985 = _t11988;
            break _t11986;
          }
          _match_fail("line 16190");
        }
        return _t11985;
      }
      _t11929 = List$iter(_t11983, aliases);
      break _t11930;
    }
    _match_fail("line 16190");
  }
  return _t11929;
}
const Js_codegen$js_builtins = "// --- Builtins ---\nfunction print(v) {\n  const s = (typeof v === \"string\") ? v : _pp(v);\n  if (typeof globalThis._jsOutput === \"function\") globalThis._jsOutput(s);\n  else if (typeof process !== \"undefined\") process.stdout.write(s);\n  return undefined;\n}\nfunction println(v) {\n  const s = (typeof v === \"string\") ? v : _pp(v);\n  if (typeof globalThis._jsOutput === \"function\") globalThis._jsOutput(s + \"\\n\");\n  else if (typeof process !== \"undefined\") process.stdout.write(s + \"\\n\");\n  return undefined;\n}\nfunction string_of_int(n) { return String(n); }\nfunction int_of_string(s) { const n = parseInt(s, 10); if (isNaN(n)) throw new Error(\"int_of_string: \" + s); return n; }\nfunction float_of_int(n) { return n; }\nfunction int_of_float(f) { return Math.trunc(f); }\nfunction float_of_string(s) { const f = parseFloat(s); if (isNaN(f)) throw new Error(\"float_of_string: \" + s); return f; }\nfunction string_of_float(f) {\n  const s = String(f);\n  return s.includes(\".\") || s.includes(\"e\") ? s : s + \".\";\n}\nfunction string_of_bool(b) { return String(b); }\nfunction failwith(msg) { throw new Error(msg); }\nconst not = (b) => !b;\nfunction $caret(a, b) { return a + b; }\nfunction $mod(a, b) { return a % b; }\nfunction __show_value(v) { return _pp(v); }\nfunction copy_continuation(k) { return k; }\nconst ignore = (_) => undefined;\nfunction fst(t) { return t[0]; }\nfunction snd(t) { return t[1]; }\nfunction string_length(s) { return s.length; }\nfunction string_sub(s, start, len) { return s.substring(start, start + len); }\nfunction string_get(s, i) { return s.charCodeAt(i); }\nfunction string_contains(s, sub) { return s.includes(sub); }\nfunction string_concat(sep, parts) {\n  const arr = [];\n  let c = parts;\n  while (c !== null) { arr.push(c._hd); c = c._tl; }\n  return arr.join(sep);\n}\nfunction array_length(a) { return a._arr.length; }\nfunction array_get(a, i) { return a._arr[i]; }\nfunction array_set(a, i, v) { a._arr[i] = v; return undefined; }\nfunction array_make(n, v) { return {_arr: new Array(n).fill(v)}; }\nfunction array_of_list(lst) {\n  const arr = [];\n  let c = lst;\n  while (c !== null) { arr.push(c._hd); c = c._tl; }\n  return {_arr: arr};\n}\nfunction array_to_list(arr) {\n  const a = arr._arr;\n  let result = null;\n  for (let i = a.length - 1; i >= 0; i--) result = {_hd: a[i], _tl: result};\n  return result;\n}\nfunction array_copy(a) { return {_arr: a._arr.slice()}; }\nfunction array_sub(a, start, len) { return {_arr: a._arr.slice(start, start + len)}; }\nfunction __math_pow(a, b) { return Math.pow(a, b); }\nfunction __math_sqrt(x) { return Math.sqrt(x); }\nfunction __math_floor(x) { return Math.floor(x); }\nfunction __math_ceil(x) { return Math.ceil(x); }\nfunction __math_round(x) { return Math.round(x); }\nfunction __math_abs(x) { return Math.abs(x); }\nfunction __math_sin(x) { return Math.sin(x); }\nfunction __math_cos(x) { return Math.cos(x); }\nfunction __math_abs_float(x) { return Math.abs(x); }\nfunction __byte_to_char(b) { return String.fromCharCode(b); }\nfunction __byte_to_int(b) { return b; }\nfunction __byte_of_int(n) { return n & 0xFF; }\nfunction __byte_to_string(b) { return String.fromCharCode(b); }\nfunction __char_to_byte(s) { return s.charCodeAt(0); }\nfunction __rune_to_string(cp) {\n  return String.fromCodePoint(cp);\n}\nfunction __string_to_runes(s) {\n  const cps = Array.from(s).map(c => c.codePointAt(0));\n  let result = null;\n  for (let i = cps.length - 1; i >= 0; i--) result = {_hd: cps[i], _tl: result};\n  return result;\n}\nfunction __map_has(m, k) { return m.has(k); }\nfunction __map_get(m, k) { return m.get(k); }\nfunction __rune_to_int(r) { return r; }\nfunction __rune_of_int(n) { return n; }\nfunction __int_to_hex(n) { return n.toString(16); }\nfunction __int_to_oct(n) { return n.toString(8); }\nfunction __int_to_bin(n) { return n.toString(2); }\nfunction __fmt_float(prec, f) { return f.toFixed(prec); }\nfunction __fmt_hex(n) { return n.toString(16); }\nfunction __fmt_hex_upper(n) { return n.toString(16).toUpperCase(); }\nfunction __fmt_oct(n) { return n.toString(8); }\nfunction __fmt_bin(n) { return n.toString(2); }\nfunction __fmt_zero_pad(width, s) { return s.padStart(width, \"0\"); }\nfunction __fmt_pad_left(width, s) { return s.padStart(width, \" \"); }\nfunction __fmt_pad_right(width, s) { return s.padEnd(width, \" \"); }\nfunction __sys_time() { return Date.now() / 1000.0; }\nfunction __sys_exit(code) { if (typeof process !== \"undefined\") process.exit(code); throw new Error(\"exit: \" + code); }\n// --- Module extern stubs ---\n// String module\nfunction String$length(s) { return s.length; }\nfunction String$sub(s, start, len) {\n  if (start < 0 || len < 0 || start + len > s.length)\n    throw new Error(\"String.sub: index out of bounds\");\n  return s.substring(start, start + len);\n}\nfunction String$split(delim, input) {\n  if (delim.length === 0) {\n    let r = null;\n    for (let i = input.length - 1; i >= 0; i--) r = {_hd: input[i], _tl: r};\n    return r;\n  }\n  const parts = input.split(delim);\n  let r = null;\n  for (let i = parts.length - 1; i >= 0; i--) r = {_hd: parts[i], _tl: r};\n  return r;\n}\nfunction String$trim(s) { return s.trim(); }\nfunction String$starts_with(prefix, s) { return s.startsWith(prefix); }\nfunction String$contains(sub, s) { return s.includes(sub); }\nfunction String$replace(old_s, new_s, input) {\n  if (old_s.length === 0) return input;\n  return input.split(old_s).join(new_s);\n}\nfunction String$to_int(s) { const n = parseInt(s,10); return isNaN(n) ? {_tag:0,_name:\"None\"} : {_tag:1,_name:\"Some\",_val:n}; }\nfunction String$to_float(s) { const f = parseFloat(s); return isNaN(f) ? {_tag:0,_name:\"None\"} : {_tag:1,_name:\"Some\",_val:f}; }\nfunction String$uppercase(s) { return s.toUpperCase(); }\nfunction String$lowercase(s) { return s.toLowerCase(); }\nfunction String$get(s, i) {\n  if (i < 0 || i >= s.length) throw new Error(\"String.get: index \" + i + \" out of bounds (length \" + s.length + \")\");\n  return s.charCodeAt(i);\n}\nfunction String$to_bytes(s) {\n  let r = null;\n  for (let i = s.length - 1; i >= 0; i--) r = {_hd: s.charCodeAt(i), _tl: r};\n  return r;\n}\nfunction String$of_bytes(lst) {\n  let r = \"\";\n  let c = lst;\n  while (c !== null) { r += String.fromCharCode(c._hd); c = c._tl; }\n  return r;\n}\nfunction String$to_byte_array(s) {\n  const a = new Array(s.length);\n  for (let i = 0; i < s.length; i++) a[i] = s.charCodeAt(i);\n  return {_arr: a};\n}\nfunction String$of_byte_array(a) {\n  let r = \"\";\n  for (let i = 0; i < a._arr.length; i++) r += String.fromCharCode(a._arr[i]);\n  return r;\n}\nfunction String$to_runes(s) { return __string_to_runes(s); }\nfunction String$of_runes(lst) {\n  let r = \"\";\n  let c = lst;\n  while (c !== null) { r += String.fromCodePoint(c._hd); c = c._tl; }\n  return r;\n}\nfunction String$get_rune(s, n) {\n  const cps = Array.from(s);\n  if (n < 0 || n >= cps.length) throw new Error(\"String.get_rune: index \" + n + \" out of bounds\");\n  return cps[n].codePointAt(0);\n}\nfunction String$of_byte(b) { return String.fromCharCode(b); }\nfunction String$rune_length(s) { return Array.from(s).length; }\nfunction String$make(n, b) {\n  if (n < 0) throw new Error(\"String.make: negative length\");\n  return String.fromCharCode(b).repeat(n);\n}\nfunction String$index_opt(s, b) { const i=s.indexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:\"None\"}:{_tag:1,_name:\"Some\",_val:i}; }\nfunction String$rindex_opt(s, b) { const i=s.lastIndexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:\"None\"}:{_tag:1,_name:\"Some\",_val:i}; }\nfunction String$concat(sep, lst) { return string_concat(sep, lst); }\nfunction String$compare(a, b) { return a < b ? -1 : a > b ? 1 : 0; }\n// Array module\nfunction Array$make(n, v) { return array_make(n, v); }\nfunction Array$get(a, i) { return array_get(a, i); }\nfunction Array$set(a, i, v) { return array_set(a, i, v); }\nfunction Array$length(a) { return array_length(a); }\nfunction Array$to_list(a) { return array_to_list(a); }\nfunction Array$of_list(l) { return array_of_list(l); }\nfunction Array$copy(a) { return array_copy(a); }\nfunction Array$sub(a, s, l) { return array_sub(a, s, l); }\n// IO module\nfunction IO$read_file(path) {\n  if (typeof globalThis._jsReadFile === \"function\") return globalThis._jsReadFile(path);\n  if (typeof require !== \"undefined\") return require(\"fs\").readFileSync(path,\"utf8\");\n  throw new Error(\"IO.read_file: not available in this environment\");\n}\nfunction IO$write_file(path, data) {\n  if (typeof require !== \"undefined\") { require(\"fs\").writeFileSync(path,data); return undefined; }\n  throw new Error(\"IO.write_file: not available in this environment\");\n}\nfunction IO$append_file(path, data) {\n  if (typeof require !== \"undefined\") { require(\"fs\").appendFileSync(path,data); return undefined; }\n  throw new Error(\"IO.append_file: not available in this environment\");\n}\nfunction IO$read_line(u) {\n  if (typeof require !== \"undefined\") {\n    const buf = Buffer.alloc(1);\n    let line = \"\";\n    const fd = require(\"fs\").openSync(\"/dev/stdin\", \"rs\");\n    while (true) {\n      const n = require(\"fs\").readSync(fd, buf, 0, 1);\n      if (n === 0 || buf[0] === 10) break;\n      line += String.fromCharCode(buf[0]);\n    }\n    return line;\n  }\n  return \"\";\n}\nfunction IO$file_exists(path) {\n  if (typeof require !== \"undefined\") return require(\"fs\").existsSync(path);\n  return false;\n}\n// Sys module\nfunction Sys$args(u) {\n  if (globalThis._jsSysArgs) {\n    const a = globalThis._jsSysArgs;\n    let r = null;\n    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};\n    return r;\n  }\n  if (typeof process !== \"undefined\") {\n    const a = process.argv.slice(1);\n    let r = null;\n    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};\n    return r;\n  }\n  return null;\n}\nfunction Sys$getenv(name) {\n  if (typeof process !== \"undefined\") {\n    const v = process.env[name];\n    return v === undefined ? {_tag:0,_name:\"None\"} : {_tag:1,_name:\"Some\",_val:v};\n  }\n  return {_tag:0,_name:\"None\"};\n}\nfunction Sys$exit(code) { __sys_exit(code); }\nfunction Sys$time(u) { return __sys_time(); }\n// Runtime module (stubs â€” eval not supported in compiled JS)\nfunction Runtime$eval(s) { throw new Error(\"Runtime.eval: not supported in compiled JS\"); }\nfunction Runtime$eval_file(s) { throw new Error(\"Runtime.eval_file: not supported in compiled JS\"); }\n// --- Typeclass Dictionaries ---\nconst __dict_Num_int = { $star: (a, b) => a * b, $plus: (a, b) => a + b, $minus: (a, b) => a - b, $slash: (a, b) => (a / b) | 0, neg: (a) => -a };\nconst __dict_Num_float = { $star: (a, b) => a * b, $plus: (a, b) => a + b, $minus: (a, b) => a - b, $slash: (a, b) => a / b, neg: (a) => -a };\nconst __dict_Eq_int = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };\nconst __dict_Eq_float = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };\nconst __dict_Eq_string = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };\nconst __dict_Eq_bool = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };\nconst __dict_Eq_byte = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };\nconst __dict_Eq_rune = { $lt$gt: (a, b) => a !== b, $eq: (a, b) => a === b };\nconst __dict_Ord_int = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };\nconst __dict_Ord_float = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };\nconst __dict_Ord_string = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };\nconst __dict_Ord_byte = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };\nconst __dict_Ord_rune = { $lt: (a, b) => a < b, $lt$eq: (a, b) => a <= b, $gt: (a, b) => a > b, $gt$eq: (a, b) => a >= b };\nconst __dict_Bitwise_int = { land: (a, b) => a & b, lnot: (a) => ~a, lor: (a, b) => a | b, lsl: (a, b) => a << b, lsr: (a, b) => a >> b, lxor: (a, b) => a ^ b };\nconst __dict_Show_int = { show: (a) => String(a) };\nconst __dict_Show_float = { show: string_of_float };\nconst __dict_Show_bool = { show: (a) => String(a) };\nconst __dict_Show_string = { show: (a) => a };\nconst __dict_Show_unit = { show: (_) => \"()\" };\nconst __dict_Show_byte = { show: (a) => \"#\" + a.toString(16).padStart(2, \"0\") };\nconst __dict_Show_rune = { show: (a) => String.fromCodePoint(a) };\nconst __dict_Map_g0_g1_map__g0__g1 = {\n  of_list: function(lst) {\n    const m = new Map();\n    let c = lst; while (c !== null) { m.set(c._hd[0], c._hd[1]); c = c._tl; }\n    return m;\n  },\n  get: function(k, m) {\n    return m.has(k) ? {_tag:1,_name:\"Some\",_val:m.get(k)} : {_tag:0,_name:\"None\"};\n  },\n  set: function(k, v, m) { const r = new Map(m); r.set(k, v); return r; },\n  has: function(k, m) { return m.has(k); },\n  remove: function(k, m) { const r = new Map(m); r.delete(k); return r; },\n  size: function(m) { return m.size; },\n  keys: function(m) {\n    const a = Array.from(m.keys()); let r = null;\n    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};\n    return r;\n  },\n  values: function(m) {\n    const a = Array.from(m.values()); let r = null;\n    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};\n    return r;\n  },\n  to_list: function(m) {\n    const a = Array.from(m.entries()); let r = null;\n    for (let i = a.length - 1; i >= 0; i--) r = {_hd: [a[i][0], a[i][1]], _tl: r};\n    return r;\n  }\n};\nconst __dict_Index_g0_g1_map__g0__g1__g0__g1 = {\n  at: function(k, m) {\n    if (!m.has(k)) throw new Error(\"key not found: \" + _pp(k));\n    return m.get(k);\n  }\n};\n// --- Canvas builtins (browser only) ---\nfunction Canvas$init(w, h) {\n  if (typeof globalThis._canvasInit === \"function\") globalThis._canvasInit(w, h);\n  return undefined;\n}\nfunction Canvas$clear(color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height); }\n  return undefined;\n}\nfunction Canvas$fill_rect(x, y, w, h, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.fillRect(x, y, w, h); }\n  return undefined;\n}\nfunction Canvas$stroke_rect(x, y, w, h, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.strokeStyle = color; ctx.lineWidth = 1; ctx.strokeRect(x, y, w, h); }\n  return undefined;\n}\nfunction Canvas$fill_circle(x, y, r, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x, y, r, 0, 2*Math.PI); ctx.fill(); }\n  return undefined;\n}\nfunction Canvas$draw_text(text, x, y, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.textBaseline = \"top\"; ctx.fillText(text, x, y); }\n  return undefined;\n}\nfunction Canvas$set_font(font) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.font = font; }\n  return undefined;\n}\nfunction Canvas$mouse_x(_) { return globalThis._canvasMouseX || 0; }\nfunction Canvas$mouse_y(_) { return globalThis._canvasMouseY || 0; }\nfunction Canvas$mouse_down(_) { return !!globalThis._canvasMouseDown; }\nfunction Canvas$mouse_clicked(_) { return !!globalThis._canvasMouseClicked; }\nfunction Canvas$key_down(key) { return !!(globalThis._canvasKeysDown && globalThis._canvasKeysDown[key]); }\nfunction Canvas$key_pressed(key) { return !!(globalThis._canvasKeysPressed && globalThis._canvasKeysPressed[key]); }\nfunction Canvas$start_app(init_fn, frame_fn) {\n  globalThis._canvasApp = { initFn: init_fn, frameFn: frame_fn, jsMode: true, call: _call };\n  return undefined;\n}\n";
function Js_codegen$emit_exports(ctx) {
  Js_codegen$emit(ctx, "var _mml_exports = {\"_result\": _last_val, \"_call\": _call, \"_pp\": _pp");
  function _t11989(__p390) {
    let _t11991;
    const _t11990 = __p390;
    _t11992: {
      if (true) {
        const mml_name = _t11990[0];
        const js_name = _t11990[1];
        _t11991 = Js_codegen$emit(ctx, (((", " + __dict_Show_string.show(Js_codegen$escape_js_string(mml_name))) + ": ") + __dict_Show_string.show(js_name)));
        break _t11992;
      }
      _match_fail("line 16190");
    }
    return _t11991;
  }
  List$iter(_t11989, List$rev(ctx.top_level_exports));
  Js_codegen$emit(ctx, "};\n");
  return Js_codegen$emit(ctx, "if (typeof globalThis !== \"undefined\") globalThis._mmlExports = _mml_exports;\n");
}
function Js_codegen$compile_program(type_env, program) {
  const ctx_11993 = Js_codegen$create_ctx(type_env);
  Js_codegen$emit(ctx_11993, Js_codegen$js_runtime);
  Js_codegen$emit(ctx_11993, Js_codegen$js_builtins);
  Js_codegen$emit(ctx_11993, "// --- Compiled MiniML ---\n");
  Js_codegen$emit(ctx_11993, "let _last_val;\n");
  List$iter(_call(Js_codegen$compile_decl, [ctx_11993]), program);
  Js_codegen$emit(ctx_11993, "if (_last_val !== undefined) println(_pp(_last_val));\n");
  Js_codegen$emit_exports(ctx_11993);
  const _t11994 = Buffer$contents(ctx_11993.buf);
  return _t11994;
}
function Js_codegen$compile_program_with_stdlib(type_env, stdlib_programs, user_program) {
  const ctx_11995 = Js_codegen$create_ctx(type_env);
  Js_codegen$emit(ctx_11995, Js_codegen$js_runtime);
  Js_codegen$emit(ctx_11995, Js_codegen$js_builtins);
  Js_codegen$emit(ctx_11995, "// --- Stdlib ---\n");
  function _t11997(__p391) {
    let _t11999;
    const _t11998 = __p391;
    _t12000: {
      if (true) {
        const _te = _t11998[0];
        const prog = _t11998[1];
        function _t12001(decl) {
          const saved_pos_12002 = Buffer$length(ctx_11995.buf);
          const saved_indent_12004 = ctx_11995.indent;
          const _t12006 = (function() {
            const _t12007 = _h;
            _h = Object.assign({}, _t12007, {
              "codegen_error": function(_, __k_try) { throw {_e: "codegen_error", _v: _}; },
            });
            try {
              const __x_12008 = Js_codegen$compile_decl(ctx_11995, decl);
              return __x_12008;
            } catch (_exc) {
              if (_exc && _exc._e === "codegen_error") {
                const _ = _exc._v;
                const full_12009 = Buffer$contents(ctx_11995.buf);
                Buffer$clear(ctx_11995.buf);
                Buffer$add_string(ctx_11995.buf, String$sub(full_12009, 0, saved_pos_12002));
                const _t12010 = (ctx_11995.indent = saved_indent_12004, undefined);
                return _t12010;
              } else { throw _exc; }
            } finally { _h = _t12007; }
          })();
          const _t12005 = _t12006;
          const _t12003 = _t12005;
          return _t12003;
        }
        _t11999 = List$iter(_t12001, prog);
        break _t12000;
      }
      _match_fail("line 16190");
    }
    return _t11999;
  }
  List$iter(_t11997, stdlib_programs);
  Js_codegen$emit(ctx_11995, "// --- Compiled MiniML ---\n");
  Js_codegen$emit(ctx_11995, "let _last_val;\n");
  const stdlib_exports_12011 = ctx_11995.top_level_exports;
  (ctx_11995.top_level_exports = null, undefined);
  List$iter(_call(Js_codegen$compile_decl, [ctx_11995]), user_program);
  Js_codegen$emit(ctx_11995, "if (_last_val !== undefined) println(_pp(_last_val));\n");
  const user_exports_12013 = ctx_11995.top_level_exports;
  (ctx_11995.top_level_exports = user_exports_12013, undefined);
  stdlib_exports_12011;
  undefined;
  Js_codegen$emit_exports(ctx_11995);
  const _t12014 = Buffer$contents(ctx_11995.buf);
  const _t12012 = _t12014;
  const _t11996 = _t12012;
  return _t11996;
}
function Main$list_iter(f, xs) {
  while (true) {
    let _t12016;
    const _t12015 = xs;
    _t12017: {
      if (_t12015 === null) {
        _t12016 = undefined;
        break _t12017;
      }
      if (_t12015 !== null) {
        const x = _t12015._hd;
        const rest = _t12015._tl;
        f(x);
        const _t12018 = f;
        const _t12019 = rest;
        f = _t12018;
        xs = _t12019;
        continue;
        _t12016 = undefined;
        break _t12017;
      }
      _match_fail("line 16190");
    }
    return _t12016;
  }
}
function Main$list_iteri_aux(f, i, xs) {
  while (true) {
    let _t12021;
    const _t12020 = xs;
    _t12022: {
      if (_t12020 === null) {
        _t12021 = undefined;
        break _t12022;
      }
      if (_t12020 !== null) {
        const x = _t12020._hd;
        const rest = _t12020._tl;
        f(i, x);
        const _t12023 = f;
        const _t12024 = (i + 1);
        const _t12025 = rest;
        f = _t12023;
        i = _t12024;
        xs = _t12025;
        continue;
        _t12021 = undefined;
        break _t12022;
      }
      _match_fail("line 16190");
    }
    return _t12021;
  }
}
function Main$list_iteri(f, xs) {
  return Main$list_iteri_aux(f, 0, xs);
}
let Main$native_global_entries = null;
function Main$register_native_ext(idx, name, arity) {
  return (Main$native_global_entries = ({_hd: _call(Serialize$serialize_native_ext, [({show: __show_value}), idx, name, arity]), _tl: Main$native_global_entries}), undefined);
}
function Main$register_native_dict(idx, fields) {
  return (Main$native_global_entries = ({_hd: _call(Serialize$serialize_native_dict, [({show: __show_value}), idx, fields]), _tl: Main$native_global_entries}), undefined);
}
function _t12026_Main$build_native_globals_json(_) {
  return String$concat(",", List$rev(Main$native_global_entries));
}
function Main$add_global(global_names, name) {
  const idx_12027 = Dynarray$length(global_names);
  Dynarray$push(global_names, name);
  const _t12028 = idx_12027;
  return _t12028;
}
function Main$register_builtin(ctx, global_names, name, ty, quant, arity) {
  const scheme_12029 = ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: quant, record_evidences: null, rquant: 0});
  const idx_12031 = Main$add_global(global_names, name);
  Main$register_native_ext(idx_12031, name, arity);
  const stdlib_name_12033 = ("Stdlib." + name);
  const sidx_12035 = Main$add_global(global_names, stdlib_name_12033);
  Main$register_native_ext(sidx_12035, name, arity);
  const vars_12037 = ({_hd: [stdlib_name_12033, scheme_12029], _tl: ({_hd: [name, scheme_12029], _tl: ctx.vars})});
  const __rec_upd_12039 = ctx;
  const _t12040 = ({constraint_tvars: __rec_upd_12039.constraint_tvars, current_eff: __rec_upd_12039.current_eff, current_module: __rec_upd_12039.current_module, inside_handler: __rec_upd_12039.inside_handler, loop_info: __rec_upd_12039.loop_info, mutable_vars: __rec_upd_12039.mutable_vars, return_type: __rec_upd_12039.return_type, return_used: __rec_upd_12039.return_used, type_env: __rec_upd_12039.type_env, vars: vars_12037});
  const _t12038 = [scheme_12029, _t12040];
  const _t12036 = _t12038;
  const _t12034 = _t12036;
  const _t12032 = _t12034;
  const _t12030 = _t12032;
  return _t12030;
}
function Main$register_module_fn(ctx, global_names, mod_name, fn_name, ty, arity) {
  const qualified_12041 = ((mod_name + ".") + fn_name);
  const idx_12043 = Main$add_global(global_names, qualified_12041);
  Main$register_native_ext(idx_12043, qualified_12041, arity);
  const max_gen_12045 = Typechecker$max_tgen_in_ty(ty);
  let _t12047;
  if ((max_gen_12045 >= 0)) {
    _t12047 = ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: (max_gen_12045 + 1), record_evidences: null, rquant: 0});
  } else {
    _t12047 = Types$mono(ty);
  }
  const scheme_12048 = _t12047;
  const vars_12050 = ({_hd: [qualified_12041, scheme_12048], _tl: ctx.vars});
  const __rec_upd_12052 = ctx;
  const _t12053 = ({constraint_tvars: __rec_upd_12052.constraint_tvars, current_eff: __rec_upd_12052.current_eff, current_module: __rec_upd_12052.current_module, inside_handler: __rec_upd_12052.inside_handler, loop_info: __rec_upd_12052.loop_info, mutable_vars: __rec_upd_12052.mutable_vars, return_type: __rec_upd_12052.return_type, return_used: __rec_upd_12052.return_used, type_env: __rec_upd_12052.type_env, vars: vars_12050});
  const _t12051 = [[fn_name, scheme_12048], _t12053];
  const _t12049 = _t12051;
  const _t12046 = _t12049;
  const _t12044 = _t12046;
  const _t12042 = _t12044;
  return _t12042;
}
function Main$register_class_in_ctx(ctx, name, tyvars, methods) {
  const num_params_12054 = List$length(tyvars);
  const class_def_12056 = ({class_fundeps: null, class_methods: methods, class_name: name, class_params: tyvars});
  function _t12058(vars, __p392) {
    let _t12060;
    const _t12059 = __p392;
    _t12061: {
      if (true) {
        const mname = _t12059[0];
        const mty = _t12059[1];
        const max_gen_12062 = Typechecker$max_tgen_in_ty(mty);
        let _t12064;
        if (((max_gen_12062 + 1) > num_params_12054)) {
          _t12064 = (max_gen_12062 + 1);
        } else {
          _t12064 = num_params_12054;
        }
        const quant_12065 = _t12064;
        const _t12066 = ({_hd: [mname, ({body: mty, constraints: null, equant: 0, pvquant: 0, quant: quant_12065, record_evidences: null, rquant: 0})], _tl: vars});
        const _t12063 = _t12066;
        _t12060 = _t12063;
        break _t12061;
      }
      _match_fail("line 16190");
    }
    return _t12060;
  }
  const new_vars_12067 = List$fold(_t12058, ctx.vars, methods);
  const __rec_upd_12069 = ctx.type_env;
  const _t12070 = ({classes: ({_hd: class_def_12056, _tl: ctx.type_env.classes}), constructors: __rec_upd_12069.constructors, effects: __rec_upd_12069.effects, instances: __rec_upd_12069.instances, modules: __rec_upd_12069.modules, mutable_fields: __rec_upd_12069.mutable_fields, records: __rec_upd_12069.records, type_aliases: __rec_upd_12069.type_aliases, type_synonyms: __rec_upd_12069.type_synonyms, variants: __rec_upd_12069.variants});
  const type_env_12071 = _t12070;
  const __rec_upd_12073 = ctx;
  const _t12074 = ({constraint_tvars: __rec_upd_12073.constraint_tvars, current_eff: __rec_upd_12073.current_eff, current_module: __rec_upd_12073.current_module, inside_handler: __rec_upd_12073.inside_handler, loop_info: __rec_upd_12073.loop_info, mutable_vars: __rec_upd_12073.mutable_vars, return_type: __rec_upd_12073.return_type, return_used: __rec_upd_12073.return_used, type_env: type_env_12071, vars: new_vars_12067});
  const _t12072 = _t12074;
  const _t12068 = _t12072;
  const _t12057 = _t12068;
  const _t12055 = _t12057;
  return _t12055;
}
function Main$register_native_instance(ctx, global_names, class_name, tys, methods) {
  const dname_12075 = _call(Types$dict_name, [__dict_Show_string, class_name, tys]);
  const idx_12077 = Main$add_global(global_names, dname_12075);
  function _t12079(__p393) {
    let _t12081;
    const _t12080 = __p393;
    _t12082: {
      if (true) {
        const mname = _t12080[0];
        const ext_name = _t12080[1];
        const arity = _t12080[2];
        _t12081 = [mname, ext_name, arity];
        break _t12082;
      }
      _match_fail("line 16190");
    }
    return _t12081;
  }
  const dict_fields_12083 = List$map(_t12079, methods);
  Main$register_native_dict(idx_12077, dict_fields_12083);
  function _t12085(__p394, __p395) {
    let _t12087;
    const _t12086 = __p394;
    _t12088: {
      if (true) {
        const a = _t12086[0];
        let _t12090;
        const _t12089 = __p395;
        _t12091: {
          if (true) {
            const b = _t12089[0];
            _t12090 = String$compare(a, b);
            break _t12091;
          }
          _match_fail("line 16190");
        }
        _t12087 = _t12090;
        break _t12088;
      }
      _match_fail("line 16190");
    }
    return _t12087;
  }
  const sorted_12092 = List$sort(_t12085, methods);
  function _t12094(__p396) {
    let _t12096;
    const _t12095 = __p396;
    _t12097: {
      if (true) {
        const mname = _t12095[0];
        const ext_name = _t12095[1];
        const arity = _t12095[2];
        const midx_12098 = Main$add_global(global_names, ((dname_12075 + "$") + mname));
        const _t12099 = Main$register_native_ext(midx_12098, ext_name, arity);
        _t12096 = _t12099;
        break _t12097;
      }
      _match_fail("line 16190");
    }
    return _t12096;
  }
  List$iter(_t12094, sorted_12092);
  const inst_12100 = ({inst_class: class_name, inst_constraints: null, inst_dict_name: dname_12075, inst_tys: tys});
  const __rec_upd_12102 = ctx.type_env;
  const _t12103 = ({classes: __rec_upd_12102.classes, constructors: __rec_upd_12102.constructors, effects: __rec_upd_12102.effects, instances: ({_hd: inst_12100, _tl: ctx.type_env.instances}), modules: __rec_upd_12102.modules, mutable_fields: __rec_upd_12102.mutable_fields, records: __rec_upd_12102.records, type_aliases: __rec_upd_12102.type_aliases, type_synonyms: __rec_upd_12102.type_synonyms, variants: __rec_upd_12102.variants});
  const type_env_12104 = _t12103;
  const __rec_upd_12106 = ctx;
  const _t12107 = ({constraint_tvars: __rec_upd_12106.constraint_tvars, current_eff: __rec_upd_12106.current_eff, current_module: __rec_upd_12106.current_module, inside_handler: __rec_upd_12106.inside_handler, loop_info: __rec_upd_12106.loop_info, mutable_vars: __rec_upd_12106.mutable_vars, return_type: __rec_upd_12106.return_type, return_used: __rec_upd_12106.return_used, type_env: type_env_12104, vars: __rec_upd_12106.vars});
  const _t12105 = _t12107;
  const _t12101 = _t12105;
  const _t12093 = _t12101;
  const _t12084 = _t12093;
  const _t12078 = _t12084;
  const _t12076 = _t12078;
  return _t12076;
}
let Main$js_capture_mode = false;
let Main$captured_typed_setups = null;
function Main$compile_setup(ctx, global_names, mutable_globals, source) {
  const tokens_12108 = Lexer$tokenize(source);
  const program_12110 = Parser$parse_program(tokens_12108);
  let _t12113;
  const _t12112 = Typechecker$check_program_in_ctx(ctx, program_12110);
  _t12114: {
    if (true) {
      const ctx2 = _t12112[0];
      const typed_program = _t12112[1];
      const typed_program2_12115 = Typechecker$transform_constraints(ctx2, typed_program);
      let _t12117;
      if (Main$js_capture_mode) {
        (Main$captured_typed_setups = List$concat(Main$captured_typed_setups, ({_hd: [ctx2.type_env, typed_program2_12115], _tl: null})), undefined);
        _t12117 = [ctx2, ({arity: 0, code: Array$of_list(null), constants: Array$of_list(null), line_table: Array$of_list(null), name: "", num_locals: 0})];
      } else {
        const compiled_12118 = Compiler$compile_program_with_globals(ctx2.type_env, global_names, mutable_globals, typed_program2_12115);
        const _t12119 = [ctx2, compiled_12118.main];
        _t12117 = _t12119;
      }
      const _t12116 = _t12117;
      _t12113 = _t12116;
      break _t12114;
    }
    _match_fail("line 16190");
  }
  const _t12111 = _t12113;
  const _t12109 = _t12111;
  return _t12109;
}
function Main$arr(a, b) {
  return ({_tag: 7, _name: "TArrow", _val: [a, ({_tag: 1, _name: "EffEmpty"}), b]});
}
function Main$arr2(a, b, c) {
  return Main$arr(a, Main$arr(b, c));
}
function Main$arr3(a, b, c, d) {
  return Main$arr(a, Main$arr(b, Main$arr(c, d)));
}
function Main$setup_builtins(_) {
  const global_names_12120 = Dynarray$create(256, "");
  const mutable_globals_12122 = Hashtbl$create(8);
  let stdlib_pub_vars_12124 = null;
  const int2_12126 = Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}));
  const bool2_12128 = Main$arr2(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}));
  let ctx_12130 = Typechecker$empty_ctx;
  let _t12133;
  const _t12132 = Main$register_builtin(ctx_12130, global_names_12120, "mod", int2_12126, 0, 2);
  _t12134: {
    if (true) {
      const sch = _t12132[0];
      const ctx2 = _t12132[1];
      (ctx_12130 = ctx2, undefined);
      (stdlib_pub_vars_12124 = ({_hd: ["mod", sch], _tl: stdlib_pub_vars_12124}), undefined);
      let _t12136;
      const _t12135 = Main$register_builtin(ctx_12130, global_names_12120, "print", Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 6, _name: "TUnit"})), 1, 1);
      _t12137: {
        if (true) {
          const sch = _t12135[0];
          const ctx2 = _t12135[1];
          (ctx_12130 = ctx2, undefined);
          (stdlib_pub_vars_12124 = ({_hd: ["print", sch], _tl: stdlib_pub_vars_12124}), undefined);
          let _t12139;
          const _t12138 = Main$register_builtin(ctx_12130, global_names_12120, "failwith", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 17, _name: "TGen", _val: 0})), 1, 1);
          _t12140: {
            if (true) {
              const sch = _t12138[0];
              const ctx2 = _t12138[1];
              (ctx_12130 = ctx2, undefined);
              (stdlib_pub_vars_12124 = ({_hd: ["failwith", sch], _tl: stdlib_pub_vars_12124}), undefined);
              let _t12142;
              const _t12141 = Main$register_builtin(ctx_12130, global_names_12120, "^", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
              _t12143: {
                if (true) {
                  const sch = _t12141[0];
                  const ctx2 = _t12141[1];
                  (ctx_12130 = ctx2, undefined);
                  (stdlib_pub_vars_12124 = ({_hd: ["^", sch], _tl: stdlib_pub_vars_12124}), undefined);
                  let _t12145;
                  const _t12144 = Main$register_builtin(ctx_12130, global_names_12120, "&&", bool2_12128, 0, 2);
                  _t12146: {
                    if (true) {
                      const sch = _t12144[0];
                      const ctx2 = _t12144[1];
                      (ctx_12130 = ctx2, undefined);
                      (stdlib_pub_vars_12124 = ({_hd: ["&&", sch], _tl: stdlib_pub_vars_12124}), undefined);
                      let _t12148;
                      const _t12147 = Main$register_builtin(ctx_12130, global_names_12120, "||", bool2_12128, 0, 2);
                      _t12149: {
                        if (true) {
                          const sch = _t12147[0];
                          const ctx2 = _t12147[1];
                          (ctx_12130 = ctx2, undefined);
                          (stdlib_pub_vars_12124 = ({_hd: ["||", sch], _tl: stdlib_pub_vars_12124}), undefined);
                          let _t12151;
                          const _t12150 = Main$register_builtin(ctx_12130, global_names_12120, "not", Main$arr(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"})), 0, 1);
                          _t12152: {
                            if (true) {
                              const sch = _t12150[0];
                              const ctx2 = _t12150[1];
                              (ctx_12130 = ctx2, undefined);
                              (stdlib_pub_vars_12124 = ({_hd: ["not", sch], _tl: stdlib_pub_vars_12124}), undefined);
                              let _t12154;
                              const _t12153 = Main$register_builtin(ctx_12130, global_names_12120, "phys_equal", Main$arr2(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 2, _name: "TBool"})), 1, 2);
                              _t12155: {
                                if (true) {
                                  const sch = _t12153[0];
                                  const ctx2 = _t12153[1];
                                  (ctx_12130 = ctx2, undefined);
                                  (stdlib_pub_vars_12124 = ({_hd: ["phys_equal", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                  let _t12157;
                                  const _t12156 = Main$register_builtin(ctx_12130, global_names_12120, "float_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 1, _name: "TFloat"})), 0, 1);
                                  _t12158: {
                                    if (true) {
                                      const sch = _t12156[0];
                                      const ctx2 = _t12156[1];
                                      (ctx_12130 = ctx2, undefined);
                                      (stdlib_pub_vars_12124 = ({_hd: ["float_of_int", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                      let _t12160;
                                      const _t12159 = Main$register_builtin(ctx_12130, global_names_12120, "int_of_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                      _t12161: {
                                        if (true) {
                                          const sch = _t12159[0];
                                          const ctx2 = _t12159[1];
                                          (ctx_12130 = ctx2, undefined);
                                          (stdlib_pub_vars_12124 = ({_hd: ["int_of_float", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                          let _t12163;
                                          const _t12162 = Main$register_builtin(ctx_12130, global_names_12120, "string_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                          _t12164: {
                                            if (true) {
                                              const sch = _t12162[0];
                                              const ctx2 = _t12162[1];
                                              (ctx_12130 = ctx2, undefined);
                                              (stdlib_pub_vars_12124 = ({_hd: ["string_of_int", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                              let _t12166;
                                              const _t12165 = Main$register_builtin(ctx_12130, global_names_12120, "string_of_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                              _t12167: {
                                                if (true) {
                                                  const sch = _t12165[0];
                                                  const ctx2 = _t12165[1];
                                                  (ctx_12130 = ctx2, undefined);
                                                  (stdlib_pub_vars_12124 = ({_hd: ["string_of_float", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                  let _t12169;
                                                  const _t12168 = Main$register_builtin(ctx_12130, global_names_12120, "string_of_bool", Main$arr(({_tag: 2, _name: "TBool"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                  _t12170: {
                                                    if (true) {
                                                      const sch = _t12168[0];
                                                      const ctx2 = _t12168[1];
                                                      (ctx_12130 = ctx2, undefined);
                                                      (stdlib_pub_vars_12124 = ({_hd: ["string_of_bool", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                      let _t12172;
                                                      const _t12171 = Main$register_builtin(ctx_12130, global_names_12120, "__map_has", Main$arr2(({_tag: 13, _name: "TMap", _val: [({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 1})]}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 2, _name: "TBool"})), 2, 2);
                                                      _t12173: {
                                                        if (true) {
                                                          const sch = _t12171[0];
                                                          const ctx2 = _t12171[1];
                                                          (ctx_12130 = ctx2, undefined);
                                                          (stdlib_pub_vars_12124 = ({_hd: ["__map_has", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                          let _t12175;
                                                          const _t12174 = Main$register_builtin(ctx_12130, global_names_12120, "__map_get", Main$arr2(({_tag: 13, _name: "TMap", _val: [({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 1})]}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 1})), 2, 2);
                                                          _t12176: {
                                                            if (true) {
                                                              const sch = _t12174[0];
                                                              const ctx2 = _t12174[1];
                                                              (ctx_12130 = ctx2, undefined);
                                                              (stdlib_pub_vars_12124 = ({_hd: ["__map_get", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                              let _t12178;
                                                              const _t12177 = Main$register_builtin(ctx_12130, global_names_12120, "array_get", Main$arr2(({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 17, _name: "TGen", _val: 0})), 1, 2);
                                                              _t12179: {
                                                                if (true) {
                                                                  const sch = _t12177[0];
                                                                  const ctx2 = _t12177[1];
                                                                  (ctx_12130 = ctx2, undefined);
                                                                  (stdlib_pub_vars_12124 = ({_hd: ["array_get", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                  let _t12181;
                                                                  const _t12180 = Main$register_builtin(ctx_12130, global_names_12120, "array_length", Main$arr(({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"})), 1, 1);
                                                                  _t12182: {
                                                                    if (true) {
                                                                      const sch = _t12180[0];
                                                                      const ctx2 = _t12180[1];
                                                                      (ctx_12130 = ctx2, undefined);
                                                                      (stdlib_pub_vars_12124 = ({_hd: ["array_length", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                      let _t12184;
                                                                      const _t12183 = Main$register_builtin(ctx_12130, global_names_12120, "__byte_to_int", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                      _t12185: {
                                                                        if (true) {
                                                                          const sch = _t12183[0];
                                                                          const ctx2 = _t12183[1];
                                                                          (ctx_12130 = ctx2, undefined);
                                                                          (stdlib_pub_vars_12124 = ({_hd: ["__byte_to_int", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                          let _t12187;
                                                                          const _t12186 = Main$register_builtin(ctx_12130, global_names_12120, "__byte_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 4, _name: "TByte"})), 0, 1);
                                                                          _t12188: {
                                                                            if (true) {
                                                                              const sch = _t12186[0];
                                                                              const ctx2 = _t12186[1];
                                                                              (ctx_12130 = ctx2, undefined);
                                                                              (stdlib_pub_vars_12124 = ({_hd: ["__byte_of_int", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                              let _t12190;
                                                                              const _t12189 = Main$register_builtin(ctx_12130, global_names_12120, "__byte_to_string", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                              _t12191: {
                                                                                if (true) {
                                                                                  const sch = _t12189[0];
                                                                                  const ctx2 = _t12189[1];
                                                                                  (ctx_12130 = ctx2, undefined);
                                                                                  (stdlib_pub_vars_12124 = ({_hd: ["__byte_to_string", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                  let _t12193;
                                                                                  const _t12192 = Main$register_builtin(ctx_12130, global_names_12120, "__rune_to_int", Main$arr(({_tag: 5, _name: "TRune"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                  _t12194: {
                                                                                    if (true) {
                                                                                      const sch = _t12192[0];
                                                                                      const ctx2 = _t12192[1];
                                                                                      (ctx_12130 = ctx2, undefined);
                                                                                      (stdlib_pub_vars_12124 = ({_hd: ["__rune_to_int", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                      let _t12196;
                                                                                      const _t12195 = Main$register_builtin(ctx_12130, global_names_12120, "__rune_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 5, _name: "TRune"})), 0, 1);
                                                                                      _t12197: {
                                                                                        if (true) {
                                                                                          const sch = _t12195[0];
                                                                                          const ctx2 = _t12195[1];
                                                                                          (ctx_12130 = ctx2, undefined);
                                                                                          (stdlib_pub_vars_12124 = ({_hd: ["__rune_of_int", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                          let _t12199;
                                                                                          const _t12198 = Main$register_builtin(ctx_12130, global_names_12120, "__rune_to_string", Main$arr(({_tag: 5, _name: "TRune"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                          _t12200: {
                                                                                            if (true) {
                                                                                              const sch = _t12198[0];
                                                                                              const ctx2 = _t12198[1];
                                                                                              (ctx_12130 = ctx2, undefined);
                                                                                              (stdlib_pub_vars_12124 = ({_hd: ["__rune_to_string", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                              let _t12202;
                                                                                              const _t12201 = Main$register_builtin(ctx_12130, global_names_12120, "__math_pow", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                              _t12203: {
                                                                                                if (true) {
                                                                                                  const sch = _t12201[0];
                                                                                                  const ctx2 = _t12201[1];
                                                                                                  (ctx_12130 = ctx2, undefined);
                                                                                                  (stdlib_pub_vars_12124 = ({_hd: ["__math_pow", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                  let _t12205;
                                                                                                  const _t12204 = Main$register_builtin(ctx_12130, global_names_12120, "__math_sqrt", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 1);
                                                                                                  _t12206: {
                                                                                                    if (true) {
                                                                                                      const sch = _t12204[0];
                                                                                                      const ctx2 = _t12204[1];
                                                                                                      (ctx_12130 = ctx2, undefined);
                                                                                                      (stdlib_pub_vars_12124 = ({_hd: ["__math_sqrt", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                      let _t12208;
                                                                                                      const _t12207 = Main$register_builtin(ctx_12130, global_names_12120, "__math_floor", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                      _t12209: {
                                                                                                        if (true) {
                                                                                                          const sch = _t12207[0];
                                                                                                          const ctx2 = _t12207[1];
                                                                                                          (ctx_12130 = ctx2, undefined);
                                                                                                          (stdlib_pub_vars_12124 = ({_hd: ["__math_floor", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                          let _t12211;
                                                                                                          const _t12210 = Main$register_builtin(ctx_12130, global_names_12120, "__math_ceil", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                          _t12212: {
                                                                                                            if (true) {
                                                                                                              const sch = _t12210[0];
                                                                                                              const ctx2 = _t12210[1];
                                                                                                              (ctx_12130 = ctx2, undefined);
                                                                                                              (stdlib_pub_vars_12124 = ({_hd: ["__math_ceil", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                              let _t12214;
                                                                                                              const _t12213 = Main$register_builtin(ctx_12130, global_names_12120, "__math_round", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                              _t12215: {
                                                                                                                if (true) {
                                                                                                                  const sch = _t12213[0];
                                                                                                                  const ctx2 = _t12213[1];
                                                                                                                  (ctx_12130 = ctx2, undefined);
                                                                                                                  (stdlib_pub_vars_12124 = ({_hd: ["__math_round", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                  let _t12217;
                                                                                                                  const _t12216 = Main$register_builtin(ctx_12130, global_names_12120, "__fmt_float", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                  _t12218: {
                                                                                                                    if (true) {
                                                                                                                      const sch = _t12216[0];
                                                                                                                      const ctx2 = _t12216[1];
                                                                                                                      (ctx_12130 = ctx2, undefined);
                                                                                                                      (stdlib_pub_vars_12124 = ({_hd: ["__fmt_float", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                      let _t12220;
                                                                                                                      const _t12219 = Main$register_builtin(ctx_12130, global_names_12120, "__fmt_hex", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                      _t12221: {
                                                                                                                        if (true) {
                                                                                                                          const sch = _t12219[0];
                                                                                                                          const ctx2 = _t12219[1];
                                                                                                                          (ctx_12130 = ctx2, undefined);
                                                                                                                          (stdlib_pub_vars_12124 = ({_hd: ["__fmt_hex", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                          let _t12223;
                                                                                                                          const _t12222 = Main$register_builtin(ctx_12130, global_names_12120, "__fmt_hex_upper", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                          _t12224: {
                                                                                                                            if (true) {
                                                                                                                              const sch = _t12222[0];
                                                                                                                              const ctx2 = _t12222[1];
                                                                                                                              (ctx_12130 = ctx2, undefined);
                                                                                                                              (stdlib_pub_vars_12124 = ({_hd: ["__fmt_hex_upper", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                              let _t12226;
                                                                                                                              const _t12225 = Main$register_builtin(ctx_12130, global_names_12120, "__fmt_oct", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                              _t12227: {
                                                                                                                                if (true) {
                                                                                                                                  const sch = _t12225[0];
                                                                                                                                  const ctx2 = _t12225[1];
                                                                                                                                  (ctx_12130 = ctx2, undefined);
                                                                                                                                  (stdlib_pub_vars_12124 = ({_hd: ["__fmt_oct", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                                  let _t12229;
                                                                                                                                  const _t12228 = Main$register_builtin(ctx_12130, global_names_12120, "__fmt_bin", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                  _t12230: {
                                                                                                                                    if (true) {
                                                                                                                                      const sch = _t12228[0];
                                                                                                                                      const ctx2 = _t12228[1];
                                                                                                                                      (ctx_12130 = ctx2, undefined);
                                                                                                                                      (stdlib_pub_vars_12124 = ({_hd: ["__fmt_bin", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                                      let _t12232;
                                                                                                                                      const _t12231 = Main$register_builtin(ctx_12130, global_names_12120, "__fmt_zero_pad", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                                      _t12233: {
                                                                                                                                        if (true) {
                                                                                                                                          const sch = _t12231[0];
                                                                                                                                          const ctx2 = _t12231[1];
                                                                                                                                          (ctx_12130 = ctx2, undefined);
                                                                                                                                          (stdlib_pub_vars_12124 = ({_hd: ["__fmt_zero_pad", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                                          let _t12235;
                                                                                                                                          const _t12234 = Main$register_builtin(ctx_12130, global_names_12120, "__fmt_pad_left", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                                          _t12236: {
                                                                                                                                            if (true) {
                                                                                                                                              const sch = _t12234[0];
                                                                                                                                              const ctx2 = _t12234[1];
                                                                                                                                              (ctx_12130 = ctx2, undefined);
                                                                                                                                              (stdlib_pub_vars_12124 = ({_hd: ["__fmt_pad_left", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                                              let _t12238;
                                                                                                                                              const _t12237 = Main$register_builtin(ctx_12130, global_names_12120, "__fmt_pad_right", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                                              _t12239: {
                                                                                                                                                if (true) {
                                                                                                                                                  const sch = _t12237[0];
                                                                                                                                                  const ctx2 = _t12237[1];
                                                                                                                                                  (ctx_12130 = ctx2, undefined);
                                                                                                                                                  (stdlib_pub_vars_12124 = ({_hd: ["__fmt_pad_right", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                                                  let _t12241;
                                                                                                                                                  const _t12240 = Main$register_builtin(ctx_12130, global_names_12120, "__show_value", Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 3, _name: "TString"})), 1, 1);
                                                                                                                                                  _t12242: {
                                                                                                                                                    if (true) {
                                                                                                                                                      const sch = _t12240[0];
                                                                                                                                                      const ctx2 = _t12240[1];
                                                                                                                                                      (ctx_12130 = ctx2, undefined);
                                                                                                                                                      (stdlib_pub_vars_12124 = ({_hd: ["__show_value", sch], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                                                      const copy_ty_12243 = Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 0}));
                                                                                                                                                      const copy_scheme_12245 = ({body: copy_ty_12243, constraints: null, equant: 0, pvquant: 0, quant: 1, record_evidences: null, rquant: 0});
                                                                                                                                                      const cidx_12247 = Main$add_global(global_names_12120, "copy_continuation");
                                                                                                                                                      Main$register_native_ext(cidx_12247, "copy_continuation", 1);
                                                                                                                                                      const csidx_12249 = Main$add_global(global_names_12120, "Stdlib.copy_continuation");
                                                                                                                                                      Main$register_native_ext(csidx_12249, "copy_continuation", 1);
                                                                                                                                                      (stdlib_pub_vars_12124 = ({_hd: ["copy_continuation", copy_scheme_12245], _tl: stdlib_pub_vars_12124}), undefined);
                                                                                                                                                      const __rec_upd_12251 = ctx_12130;
                                                                                                                                                      const _t12252 = ({constraint_tvars: __rec_upd_12251.constraint_tvars, current_eff: __rec_upd_12251.current_eff, current_module: __rec_upd_12251.current_module, inside_handler: __rec_upd_12251.inside_handler, loop_info: __rec_upd_12251.loop_info, mutable_vars: __rec_upd_12251.mutable_vars, return_type: __rec_upd_12251.return_type, return_used: __rec_upd_12251.return_used, type_env: __rec_upd_12251.type_env, vars: ({_hd: ["Stdlib.copy_continuation", copy_scheme_12245], _tl: ({_hd: ["copy_continuation", copy_scheme_12245], _tl: ctx_12130.vars})})});
                                                                                                                                                      (ctx_12130 = _t12252, undefined);
                                                                                                                                                      const _t12250 = [ctx_12130, global_names_12120, mutable_globals_12122, stdlib_pub_vars_12124];
                                                                                                                                                      const _t12248 = _t12250;
                                                                                                                                                      const _t12246 = _t12248;
                                                                                                                                                      const _t12244 = _t12246;
                                                                                                                                                      _t12241 = _t12244;
                                                                                                                                                      break _t12242;
                                                                                                                                                    }
                                                                                                                                                    _match_fail("line 16190");
                                                                                                                                                  }
                                                                                                                                                  _t12238 = _t12241;
                                                                                                                                                  break _t12239;
                                                                                                                                                }
                                                                                                                                                _match_fail("line 16190");
                                                                                                                                              }
                                                                                                                                              _t12235 = _t12238;
                                                                                                                                              break _t12236;
                                                                                                                                            }
                                                                                                                                            _match_fail("line 16190");
                                                                                                                                          }
                                                                                                                                          _t12232 = _t12235;
                                                                                                                                          break _t12233;
                                                                                                                                        }
                                                                                                                                        _match_fail("line 16190");
                                                                                                                                      }
                                                                                                                                      _t12229 = _t12232;
                                                                                                                                      break _t12230;
                                                                                                                                    }
                                                                                                                                    _match_fail("line 16190");
                                                                                                                                  }
                                                                                                                                  _t12226 = _t12229;
                                                                                                                                  break _t12227;
                                                                                                                                }
                                                                                                                                _match_fail("line 16190");
                                                                                                                              }
                                                                                                                              _t12223 = _t12226;
                                                                                                                              break _t12224;
                                                                                                                            }
                                                                                                                            _match_fail("line 16190");
                                                                                                                          }
                                                                                                                          _t12220 = _t12223;
                                                                                                                          break _t12221;
                                                                                                                        }
                                                                                                                        _match_fail("line 16190");
                                                                                                                      }
                                                                                                                      _t12217 = _t12220;
                                                                                                                      break _t12218;
                                                                                                                    }
                                                                                                                    _match_fail("line 16190");
                                                                                                                  }
                                                                                                                  _t12214 = _t12217;
                                                                                                                  break _t12215;
                                                                                                                }
                                                                                                                _match_fail("line 16190");
                                                                                                              }
                                                                                                              _t12211 = _t12214;
                                                                                                              break _t12212;
                                                                                                            }
                                                                                                            _match_fail("line 16190");
                                                                                                          }
                                                                                                          _t12208 = _t12211;
                                                                                                          break _t12209;
                                                                                                        }
                                                                                                        _match_fail("line 16190");
                                                                                                      }
                                                                                                      _t12205 = _t12208;
                                                                                                      break _t12206;
                                                                                                    }
                                                                                                    _match_fail("line 16190");
                                                                                                  }
                                                                                                  _t12202 = _t12205;
                                                                                                  break _t12203;
                                                                                                }
                                                                                                _match_fail("line 16190");
                                                                                              }
                                                                                              _t12199 = _t12202;
                                                                                              break _t12200;
                                                                                            }
                                                                                            _match_fail("line 16190");
                                                                                          }
                                                                                          _t12196 = _t12199;
                                                                                          break _t12197;
                                                                                        }
                                                                                        _match_fail("line 16190");
                                                                                      }
                                                                                      _t12193 = _t12196;
                                                                                      break _t12194;
                                                                                    }
                                                                                    _match_fail("line 16190");
                                                                                  }
                                                                                  _t12190 = _t12193;
                                                                                  break _t12191;
                                                                                }
                                                                                _match_fail("line 16190");
                                                                              }
                                                                              _t12187 = _t12190;
                                                                              break _t12188;
                                                                            }
                                                                            _match_fail("line 16190");
                                                                          }
                                                                          _t12184 = _t12187;
                                                                          break _t12185;
                                                                        }
                                                                        _match_fail("line 16190");
                                                                      }
                                                                      _t12181 = _t12184;
                                                                      break _t12182;
                                                                    }
                                                                    _match_fail("line 16190");
                                                                  }
                                                                  _t12178 = _t12181;
                                                                  break _t12179;
                                                                }
                                                                _match_fail("line 16190");
                                                              }
                                                              _t12175 = _t12178;
                                                              break _t12176;
                                                            }
                                                            _match_fail("line 16190");
                                                          }
                                                          _t12172 = _t12175;
                                                          break _t12173;
                                                        }
                                                        _match_fail("line 16190");
                                                      }
                                                      _t12169 = _t12172;
                                                      break _t12170;
                                                    }
                                                    _match_fail("line 16190");
                                                  }
                                                  _t12166 = _t12169;
                                                  break _t12167;
                                                }
                                                _match_fail("line 16190");
                                              }
                                              _t12163 = _t12166;
                                              break _t12164;
                                            }
                                            _match_fail("line 16190");
                                          }
                                          _t12160 = _t12163;
                                          break _t12161;
                                        }
                                        _match_fail("line 16190");
                                      }
                                      _t12157 = _t12160;
                                      break _t12158;
                                    }
                                    _match_fail("line 16190");
                                  }
                                  _t12154 = _t12157;
                                  break _t12155;
                                }
                                _match_fail("line 16190");
                              }
                              _t12151 = _t12154;
                              break _t12152;
                            }
                            _match_fail("line 16190");
                          }
                          _t12148 = _t12151;
                          break _t12149;
                        }
                        _match_fail("line 16190");
                      }
                      _t12145 = _t12148;
                      break _t12146;
                    }
                    _match_fail("line 16190");
                  }
                  _t12142 = _t12145;
                  break _t12143;
                }
                _match_fail("line 16190");
              }
              _t12139 = _t12142;
              break _t12140;
            }
            _match_fail("line 16190");
          }
          _t12136 = _t12139;
          break _t12137;
        }
        _match_fail("line 16190");
      }
      _t12133 = _t12136;
      break _t12134;
    }
    _match_fail("line 16190");
  }
  const _t12131 = _t12133;
  const _t12129 = _t12131;
  const _t12127 = _t12129;
  const _t12125 = _t12127;
  const _t12123 = _t12125;
  const _t12121 = _t12123;
  return _t12121;
}
function Main$setup_option_type(ctx) {
  const __rec_upd_12253 = ctx.type_env;
  const _t12254 = ({classes: __rec_upd_12253.classes, constructors: ({_hd: ["None", ({ctor_arg_ty: ({_tag: 0, _name: "None"}), ctor_existentials: 0, ctor_num_params: 1, ctor_return_ty_params: ({_tag: 0, _name: "None"}), ctor_type_name: "option"})], _tl: ({_hd: ["Some", ({ctor_arg_ty: ({_tag: 1, _name: "Some", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ctor_existentials: 0, ctor_num_params: 1, ctor_return_ty_params: ({_tag: 0, _name: "None"}), ctor_type_name: "option"})], _tl: ctx.type_env.constructors})}), effects: __rec_upd_12253.effects, instances: __rec_upd_12253.instances, modules: __rec_upd_12253.modules, mutable_fields: __rec_upd_12253.mutable_fields, records: __rec_upd_12253.records, type_aliases: __rec_upd_12253.type_aliases, type_synonyms: __rec_upd_12253.type_synonyms, variants: ({_hd: ["option", 1, ({_hd: ["None", ({_tag: 0, _name: "None"})], _tl: ({_hd: ["Some", ({_tag: 1, _name: "Some", _val: ({_tag: 17, _name: "TGen", _val: 0})})], _tl: null})}), false], _tl: ctx.type_env.variants})});
  const type_env_12255 = _t12254;
  const __rec_upd_12257 = ctx;
  const _t12258 = ({constraint_tvars: __rec_upd_12257.constraint_tvars, current_eff: __rec_upd_12257.current_eff, current_module: __rec_upd_12257.current_module, inside_handler: __rec_upd_12257.inside_handler, loop_info: __rec_upd_12257.loop_info, mutable_vars: __rec_upd_12257.mutable_vars, return_type: __rec_upd_12257.return_type, return_used: __rec_upd_12257.return_used, type_env: type_env_12255, vars: __rec_upd_12257.vars});
  const _t12256 = _t12258;
  return _t12256;
}
function Main$setup_classes(ctx, global_names, mutable_globals, stdlib_pub_vars) {
  const a2a_12259 = Main$arr2(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 0}));
  const a_a_12261 = Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 0}));
  const a2bool_12263 = Main$arr2(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 2, _name: "TBool"}));
  let ctx_12265 = ctx;
  let setup_protos_12267 = null;
  function _t12269(name) {
    let _t12271;
    const _t12270 = Main$compile_setup(ctx_12265, global_names, mutable_globals, IO$read_file((("stdlib/" + name) + ".mml")));
    _t12272: {
      if (true) {
        const ctx2 = _t12270[0];
        const proto = _t12270[1];
        (ctx_12265 = ctx2, undefined);
        _t12271 = (setup_protos_12267 = ({_hd: proto, _tl: setup_protos_12267}), undefined);
        break _t12272;
      }
      _match_fail("line 16190");
    }
    return _t12271;
  }
  const load_12273 = _t12269;
  function _t12275(class_name, fundeps) {
    const __rec_upd_12276 = ctx_12265;
    const __rec_upd_12278 = ctx_12265.type_env;
    function _t12280(cd) {
      let _t12281;
      if ((cd.class_name === class_name)) {
        const __rec_upd_12282 = cd;
        const _t12283 = ({class_fundeps: fundeps, class_methods: __rec_upd_12282.class_methods, class_name: __rec_upd_12282.class_name, class_params: __rec_upd_12282.class_params});
        _t12281 = _t12283;
      } else {
        _t12281 = cd;
      }
      return _t12281;
    }
    const _t12279 = ({classes: List$map(_t12280, ctx_12265.type_env.classes), constructors: __rec_upd_12278.constructors, effects: __rec_upd_12278.effects, instances: __rec_upd_12278.instances, modules: __rec_upd_12278.modules, mutable_fields: __rec_upd_12278.mutable_fields, records: __rec_upd_12278.records, type_aliases: __rec_upd_12278.type_aliases, type_synonyms: __rec_upd_12278.type_synonyms, variants: __rec_upd_12278.variants});
    const _t12277 = ({constraint_tvars: __rec_upd_12276.constraint_tvars, current_eff: __rec_upd_12276.current_eff, current_module: __rec_upd_12276.current_module, inside_handler: __rec_upd_12276.inside_handler, loop_info: __rec_upd_12276.loop_info, mutable_vars: __rec_upd_12276.mutable_vars, return_type: __rec_upd_12276.return_type, return_used: __rec_upd_12276.return_used, type_env: _t12279, vars: __rec_upd_12276.vars});
    return (ctx_12265 = _t12277, undefined);
  }
  const set_fundeps_12284 = _t12275;
  (ctx_12265 = Main$register_class_in_ctx(ctx_12265, "Num", ({_hd: "a", _tl: null}), ({_hd: ["+", a2a_12259], _tl: ({_hd: ["-", a2a_12259], _tl: ({_hd: ["*", a2a_12259], _tl: ({_hd: ["/", a2a_12259], _tl: ({_hd: ["neg", a_a_12261], _tl: null})})})})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Num", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null}), ({_hd: ["+", "num_add_int", 2], _tl: ({_hd: ["-", "num_sub_int", 2], _tl: ({_hd: ["*", "num_mul_int", 2], _tl: ({_hd: ["/", "num_div_int", 2], _tl: ({_hd: ["neg", "num_neg_int", 1], _tl: null})})})})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Num", ({_hd: ({_tag: 1, _name: "TFloat"}), _tl: null}), ({_hd: ["+", "num_add_float", 2], _tl: ({_hd: ["-", "num_sub_float", 2], _tl: ({_hd: ["*", "num_mul_float", 2], _tl: ({_hd: ["/", "num_div_float", 2], _tl: ({_hd: ["neg", "num_neg_float", 1], _tl: null})})})})})), undefined);
  (ctx_12265 = Main$register_class_in_ctx(ctx_12265, "Eq", ({_hd: "a", _tl: null}), ({_hd: ["=", a2bool_12263], _tl: ({_hd: ["<>", a2bool_12263], _tl: null})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Eq", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null}), ({_hd: ["=", "eq_int", 2], _tl: ({_hd: ["<>", "neq_int", 2], _tl: null})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Eq", ({_hd: ({_tag: 1, _name: "TFloat"}), _tl: null}), ({_hd: ["=", "eq_float", 2], _tl: ({_hd: ["<>", "neq_float", 2], _tl: null})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Eq", ({_hd: ({_tag: 3, _name: "TString"}), _tl: null}), ({_hd: ["=", "eq_string", 2], _tl: ({_hd: ["<>", "neq_string", 2], _tl: null})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Eq", ({_hd: ({_tag: 2, _name: "TBool"}), _tl: null}), ({_hd: ["=", "eq_bool", 2], _tl: ({_hd: ["<>", "neq_bool", 2], _tl: null})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Eq", ({_hd: ({_tag: 4, _name: "TByte"}), _tl: null}), ({_hd: ["=", "eq_byte", 2], _tl: ({_hd: ["<>", "neq_byte", 2], _tl: null})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Eq", ({_hd: ({_tag: 5, _name: "TRune"}), _tl: null}), ({_hd: ["=", "eq_rune", 2], _tl: ({_hd: ["<>", "neq_rune", 2], _tl: null})})), undefined);
  (ctx_12265 = Main$register_class_in_ctx(ctx_12265, "Ord", ({_hd: "a", _tl: null}), ({_hd: ["<", a2bool_12263], _tl: ({_hd: [">", a2bool_12263], _tl: ({_hd: ["<=", a2bool_12263], _tl: ({_hd: [">=", a2bool_12263], _tl: null})})})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Ord", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null}), ({_hd: ["<", "lt_int", 2], _tl: ({_hd: [">", "gt_int", 2], _tl: ({_hd: ["<=", "le_int", 2], _tl: ({_hd: [">=", "ge_int", 2], _tl: null})})})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Ord", ({_hd: ({_tag: 1, _name: "TFloat"}), _tl: null}), ({_hd: ["<", "lt_float", 2], _tl: ({_hd: [">", "gt_float", 2], _tl: ({_hd: ["<=", "le_float", 2], _tl: ({_hd: [">=", "ge_float", 2], _tl: null})})})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Ord", ({_hd: ({_tag: 3, _name: "TString"}), _tl: null}), ({_hd: ["<", "lt_string", 2], _tl: ({_hd: [">", "gt_string", 2], _tl: ({_hd: ["<=", "le_string", 2], _tl: ({_hd: [">=", "ge_string", 2], _tl: null})})})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Ord", ({_hd: ({_tag: 4, _name: "TByte"}), _tl: null}), ({_hd: ["<", "lt_byte", 2], _tl: ({_hd: [">", "gt_byte", 2], _tl: ({_hd: ["<=", "le_byte", 2], _tl: ({_hd: [">=", "ge_byte", 2], _tl: null})})})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Ord", ({_hd: ({_tag: 5, _name: "TRune"}), _tl: null}), ({_hd: ["<", "lt_rune", 2], _tl: ({_hd: [">", "gt_rune", 2], _tl: ({_hd: ["<=", "le_rune", 2], _tl: ({_hd: [">=", "ge_rune", 2], _tl: null})})})})), undefined);
  (ctx_12265 = Main$register_class_in_ctx(ctx_12265, "Bitwise", ({_hd: "a", _tl: null}), ({_hd: ["land", a2a_12259], _tl: ({_hd: ["lor", a2a_12259], _tl: ({_hd: ["lxor", a2a_12259], _tl: ({_hd: ["lsl", a2a_12259], _tl: ({_hd: ["lsr", a2a_12259], _tl: ({_hd: ["lnot", a_a_12261], _tl: null})})})})})})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Bitwise", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null}), ({_hd: ["land", "band_int", 2], _tl: ({_hd: ["lor", "bor_int", 2], _tl: ({_hd: ["lxor", "bxor_int", 2], _tl: ({_hd: ["lsl", "bshl_int", 2], _tl: ({_hd: ["lsr", "bshr_int", 2], _tl: ({_hd: ["lnot", "bnot_int", 1], _tl: null})})})})})})), undefined);
  (ctx_12265 = Main$register_class_in_ctx(ctx_12265, "Show", ({_hd: "a", _tl: null}), ({_hd: ["show", Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 3, _name: "TString"}))], _tl: null})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Show", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null}), ({_hd: ["show", "show_int", 1], _tl: null})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Show", ({_hd: ({_tag: 1, _name: "TFloat"}), _tl: null}), ({_hd: ["show", "show_float", 1], _tl: null})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Show", ({_hd: ({_tag: 2, _name: "TBool"}), _tl: null}), ({_hd: ["show", "show_bool", 1], _tl: null})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Show", ({_hd: ({_tag: 3, _name: "TString"}), _tl: null}), ({_hd: ["show", "show_string", 1], _tl: null})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Show", ({_hd: ({_tag: 6, _name: "TUnit"}), _tl: null}), ({_hd: ["show", "show_unit", 1], _tl: null})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Show", ({_hd: ({_tag: 4, _name: "TByte"}), _tl: null}), ({_hd: ["show", "show_byte", 1], _tl: null})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Show", ({_hd: ({_tag: 5, _name: "TRune"}), _tl: null}), ({_hd: ["show", "show_rune", 1], _tl: null})), undefined);
  const fold_ty_12286 = Main$arr(Main$arr2(({_tag: 17, _name: "TGen", _val: 2}), ({_tag: 17, _name: "TGen", _val: 1}), ({_tag: 17, _name: "TGen", _val: 2})), Main$arr2(({_tag: 17, _name: "TGen", _val: 2}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 2})));
  (ctx_12265 = Main$register_class_in_ctx(ctx_12265, "Iter", ({_hd: "a", _tl: ({_hd: "b", _tl: null})}), ({_hd: ["fold", fold_ty_12286], _tl: null})), undefined);
  set_fundeps_12284("Iter", ({_hd: ({fd_from: ({_hd: 0, _tl: null}), fd_to: ({_hd: 1, _tl: null})}), _tl: null}));
  const option_v_12288 = ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 17, _name: "TGen", _val: 2}), _tl: null})]});
  const kv_pair_12290 = ({_tag: 9, _name: "TTuple", _val: ({_hd: ({_tag: 17, _name: "TGen", _val: 1}), _tl: ({_hd: ({_tag: 17, _name: "TGen", _val: 2}), _tl: null})})});
  (ctx_12265 = Main$register_class_in_ctx(ctx_12265, "Map", ({_hd: "m", _tl: ({_hd: "k", _tl: ({_hd: "v", _tl: null})})}), ({_hd: ["of_list", Main$arr(({_tag: 10, _name: "TList", _val: kv_pair_12290}), ({_tag: 17, _name: "TGen", _val: 0}))], _tl: ({_hd: ["get", Main$arr2(({_tag: 17, _name: "TGen", _val: 1}), ({_tag: 17, _name: "TGen", _val: 0}), option_v_12288)], _tl: ({_hd: ["set", Main$arr3(({_tag: 17, _name: "TGen", _val: 1}), ({_tag: 17, _name: "TGen", _val: 2}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 0}))], _tl: ({_hd: ["has", Main$arr2(({_tag: 17, _name: "TGen", _val: 1}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 2, _name: "TBool"}))], _tl: ({_hd: ["remove", Main$arr2(({_tag: 17, _name: "TGen", _val: 1}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 0}))], _tl: ({_hd: ["size", Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 0, _name: "TInt"}))], _tl: ({_hd: ["keys", Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 10, _name: "TList", _val: ({_tag: 17, _name: "TGen", _val: 1})}))], _tl: ({_hd: ["values", Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 10, _name: "TList", _val: ({_tag: 17, _name: "TGen", _val: 2})}))], _tl: ({_hd: ["to_list", Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 10, _name: "TList", _val: kv_pair_12290}))], _tl: null})})})})})})})})})), undefined);
  set_fundeps_12284("Map", ({_hd: ({fd_from: ({_hd: 0, _tl: null}), fd_to: ({_hd: 1, _tl: ({_hd: 2, _tl: null})})}), _tl: null}));
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Map", ({_hd: ({_tag: 13, _name: "TMap", _val: [({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 1})]}), _tl: ({_hd: ({_tag: 17, _name: "TGen", _val: 0}), _tl: ({_hd: ({_tag: 17, _name: "TGen", _val: 1}), _tl: null})})}), ({_hd: ["of_list", "map_of_list", 1], _tl: ({_hd: ["get", "map_get", 2], _tl: ({_hd: ["set", "map_set", 3], _tl: ({_hd: ["has", "map_has", 2], _tl: ({_hd: ["remove", "map_remove", 2], _tl: ({_hd: ["size", "map_size", 1], _tl: ({_hd: ["keys", "map_keys", 1], _tl: ({_hd: ["values", "map_values", 1], _tl: ({_hd: ["to_list", "map_to_list", 1], _tl: null})})})})})})})})})), undefined);
  const at_ty_12292 = Main$arr(({_tag: 17, _name: "TGen", _val: 1}), Main$arr(({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 2})));
  (ctx_12265 = Main$register_class_in_ctx(ctx_12265, "Index", ({_hd: "c", _tl: ({_hd: "k", _tl: ({_hd: "v", _tl: null})})}), ({_hd: ["at", at_ty_12292], _tl: null})), undefined);
  set_fundeps_12284("Index", ({_hd: ({fd_from: ({_hd: 0, _tl: null}), fd_to: ({_hd: 1, _tl: ({_hd: 2, _tl: null})})}), _tl: null}));
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Index", ({_hd: ({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})}), _tl: ({_hd: ({_tag: 0, _name: "TInt"}), _tl: ({_hd: ({_tag: 17, _name: "TGen", _val: 0}), _tl: null})})}), ({_hd: ["at", "index_at_array", 2], _tl: null})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Index", ({_hd: ({_tag: 3, _name: "TString"}), _tl: ({_hd: ({_tag: 0, _name: "TInt"}), _tl: ({_hd: ({_tag: 4, _name: "TByte"}), _tl: null})})}), ({_hd: ["at", "index_at_string", 2], _tl: null})), undefined);
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Index", ({_hd: ({_tag: 13, _name: "TMap", _val: [({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 1})]}), _tl: ({_hd: ({_tag: 17, _name: "TGen", _val: 0}), _tl: ({_hd: ({_tag: 17, _name: "TGen", _val: 1}), _tl: null})})}), ({_hd: ["at", "index_at_map", 2], _tl: null})), undefined);
  load_12273("iter");
  load_12273("show");
  load_12273("iter_map");
  (ctx_12265 = Main$register_native_instance(ctx_12265, global_names, "Show", ({_hd: ({_tag: 13, _name: "TMap", _val: [({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 17, _name: "TGen", _val: 1})]}), _tl: null}), ({_hd: ["show", "show_map", 1], _tl: null})), undefined);
  function _t12294(__p397) {
    let _t12296;
    const _t12295 = __p397;
    _t12297: {
      if (true) {
        const name = _t12295[0];
        _t12296 = ((name === "None") || (name === "Some"));
        break _t12297;
      }
      _match_fail("line 16190");
    }
    return _t12296;
  }
  const stdlib_constructors_12298 = List$filter(_t12294, ctx_12265.type_env.constructors);
  const stdlib_info_12300 = ({mod_instances: null, mod_name: "Stdlib", mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: stdlib_constructors_12298, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: stdlib_pub_vars, mod_submodules: null});
  const __rec_upd_12302 = ctx_12265;
  const __rec_upd_12304 = ctx_12265.type_env;
  const _t12305 = ({classes: __rec_upd_12304.classes, constructors: __rec_upd_12304.constructors, effects: __rec_upd_12304.effects, instances: __rec_upd_12304.instances, modules: ({_hd: ["Stdlib", stdlib_info_12300], _tl: ctx_12265.type_env.modules}), mutable_fields: __rec_upd_12304.mutable_fields, records: __rec_upd_12304.records, type_aliases: __rec_upd_12304.type_aliases, type_synonyms: __rec_upd_12304.type_synonyms, variants: __rec_upd_12304.variants});
  const _t12303 = ({constraint_tvars: __rec_upd_12302.constraint_tvars, current_eff: __rec_upd_12302.current_eff, current_module: __rec_upd_12302.current_module, inside_handler: __rec_upd_12302.inside_handler, loop_info: __rec_upd_12302.loop_info, mutable_vars: __rec_upd_12302.mutable_vars, return_type: __rec_upd_12302.return_type, return_used: __rec_upd_12302.return_used, type_env: _t12305, vars: __rec_upd_12302.vars});
  (ctx_12265 = _t12303, undefined);
  const _t12301 = [ctx_12265, List$rev(setup_protos_12267)];
  const _t12299 = _t12301;
  const _t12293 = _t12299;
  const _t12291 = _t12293;
  const _t12289 = _t12291;
  const _t12287 = _t12289;
  const _t12285 = _t12287;
  const _t12274 = _t12285;
  const _t12268 = _t12274;
  const _t12266 = _t12268;
  const _t12264 = _t12266;
  const _t12262 = _t12264;
  const _t12260 = _t12262;
  return _t12260;
}
function Main$setup_modules(ctx, global_names, mutable_globals) {
  let pub_vars_12306 = null;
  let ctx_12308 = ctx;
  let setup_protos_12310 = null;
  function _t12312(__dict_Show_0, mod_name, fn_name, ty, arity) {
    let _t12314;
    const _t12313 = Main$register_module_fn(ctx_12308, global_names, mod_name, fn_name, ty, arity);
    _t12315: {
      if (true) {
        const pv = _t12313[0];
        const ctx2 = _t12313[1];
        (pub_vars_12306 = ({_hd: pv, _tl: pub_vars_12306}), undefined);
        _t12314 = (ctx_12308 = ctx2, undefined);
        break _t12315;
      }
      _match_fail("line 16190");
    }
    return _t12314;
  }
  const register_fn_12316 = _t12312;
  function _t12318(name) {
    let _t12320;
    const _t12319 = Main$compile_setup(ctx_12308, global_names, mutable_globals, IO$read_file((("stdlib/" + name) + ".mml")));
    _t12321: {
      if (true) {
        const ctx2 = _t12319[0];
        const proto = _t12319[1];
        (ctx_12308 = ctx2, undefined);
        _t12320 = (setup_protos_12310 = ({_hd: proto, _tl: setup_protos_12310}), undefined);
        break _t12321;
      }
      _match_fail("line 16190");
    }
    return _t12320;
  }
  const load_12322 = _t12318;
  function _t12324(source) {
    let _t12326;
    const _t12325 = Main$compile_setup(ctx_12308, global_names, mutable_globals, source);
    _t12327: {
      if (true) {
        const ctx2 = _t12325[0];
        const proto = _t12325[1];
        (ctx_12308 = ctx2, undefined);
        _t12326 = (setup_protos_12310 = ({_hd: proto, _tl: setup_protos_12310}), undefined);
        break _t12327;
      }
      _match_fail("line 16190");
    }
    return _t12326;
  }
  const load_source_12328 = _t12324;
  (pub_vars_12306 = null, undefined);
  _call(register_fn_12316, [__dict_Show_int, "String", "length", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "sub", Main$arr3(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 3]);
  _call(register_fn_12316, [__dict_Show_int, "String", "split", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 3, _name: "TString"})})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "String", "trim", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "starts_with", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "String", "contains", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "String", "replace", Main$arr3(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 3]);
  _call(register_fn_12316, [__dict_Show_int, "String", "to_int", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null})]})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "to_float", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 1, _name: "TFloat"}), _tl: null})]})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "uppercase", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "lowercase", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "get", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"}), ({_tag: 4, _name: "TByte"})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "String", "to_bytes", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 4, _name: "TByte"})})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "of_bytes", Main$arr(({_tag: 10, _name: "TList", _val: ({_tag: 4, _name: "TByte"})}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "to_byte_array", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 14, _name: "TArray", _val: ({_tag: 4, _name: "TByte"})})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "of_byte_array", Main$arr(({_tag: 14, _name: "TArray", _val: ({_tag: 4, _name: "TByte"})}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "to_runes", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 5, _name: "TRune"})})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "of_runes", Main$arr(({_tag: 10, _name: "TList", _val: ({_tag: 5, _name: "TRune"})}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "get_rune", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"}), ({_tag: 5, _name: "TRune"})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "String", "of_byte", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "rune_length", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "String", "make", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "String", "index_opt", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 4, _name: "TByte"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null})]})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "String", "rindex_opt", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 4, _name: "TByte"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null})]})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "String", "concat", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 3, _name: "TString"})}), ({_tag: 3, _name: "TString"})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "String", "compare", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"})), 2]);
  const string_info_12330 = ({mod_instances: null, mod_name: "String", mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_12306, mod_submodules: null});
  const __rec_upd_12332 = ctx_12308;
  const __rec_upd_12334 = ctx_12308.type_env;
  const _t12335 = ({classes: __rec_upd_12334.classes, constructors: __rec_upd_12334.constructors, effects: __rec_upd_12334.effects, instances: __rec_upd_12334.instances, modules: ({_hd: ["String", string_info_12330], _tl: ctx_12308.type_env.modules}), mutable_fields: __rec_upd_12334.mutable_fields, records: __rec_upd_12334.records, type_aliases: __rec_upd_12334.type_aliases, type_synonyms: __rec_upd_12334.type_synonyms, variants: __rec_upd_12334.variants});
  const _t12333 = ({constraint_tvars: __rec_upd_12332.constraint_tvars, current_eff: __rec_upd_12332.current_eff, current_module: __rec_upd_12332.current_module, inside_handler: __rec_upd_12332.inside_handler, loop_info: __rec_upd_12332.loop_info, mutable_vars: __rec_upd_12332.mutable_vars, return_type: __rec_upd_12332.return_type, return_used: __rec_upd_12332.return_used, type_env: _t12335, vars: __rec_upd_12332.vars});
  (ctx_12308 = _t12333, undefined);
  load_source_12328("module String = pub let iter f s = let n = String.length s in let rec go i = if i >= n do () else (f (String.get s i); go (i + 1)) in go 0 end");
  load_12322("list");
  (pub_vars_12306 = null, undefined);
  _call(register_fn_12316, [__dict_Show_int, "Array", "make", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "Array", "get", Main$arr2(({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 17, _name: "TGen", _val: 0})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "Array", "set", Main$arr3(({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 17, _name: "TGen", _val: 0}), ({_tag: 6, _name: "TUnit"})), 3]);
  _call(register_fn_12316, [__dict_Show_int, "Array", "length", Main$arr(({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "Array", "to_list", Main$arr(({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ({_tag: 10, _name: "TList", _val: ({_tag: 17, _name: "TGen", _val: 0})})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "Array", "of_list", Main$arr(({_tag: 10, _name: "TList", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "Array", "copy", Main$arr(({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "Array", "sub", Main$arr3(({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 14, _name: "TArray", _val: ({_tag: 17, _name: "TGen", _val: 0})})), 3]);
  const array_info_12336 = ({mod_instances: null, mod_name: "Array", mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_12306, mod_submodules: null});
  const __rec_upd_12338 = ctx_12308;
  const __rec_upd_12340 = ctx_12308.type_env;
  const _t12341 = ({classes: __rec_upd_12340.classes, constructors: __rec_upd_12340.constructors, effects: __rec_upd_12340.effects, instances: __rec_upd_12340.instances, modules: ({_hd: ["Array", array_info_12336], _tl: ctx_12308.type_env.modules}), mutable_fields: __rec_upd_12340.mutable_fields, records: __rec_upd_12340.records, type_aliases: __rec_upd_12340.type_aliases, type_synonyms: __rec_upd_12340.type_synonyms, variants: __rec_upd_12340.variants});
  const _t12339 = ({constraint_tvars: __rec_upd_12338.constraint_tvars, current_eff: __rec_upd_12338.current_eff, current_module: __rec_upd_12338.current_module, inside_handler: __rec_upd_12338.inside_handler, loop_info: __rec_upd_12338.loop_info, mutable_vars: __rec_upd_12338.mutable_vars, return_type: __rec_upd_12338.return_type, return_used: __rec_upd_12338.return_used, type_env: _t12341, vars: __rec_upd_12338.vars});
  (ctx_12308 = _t12339, undefined);
  load_12322("array_extra");
  (pub_vars_12306 = null, undefined);
  _call(register_fn_12316, [__dict_Show_int, "IO", "read_file", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "IO", "write_file", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "IO", "append_file", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 2]);
  _call(register_fn_12316, [__dict_Show_int, "IO", "read_line", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "IO", "file_exists", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 1]);
  const io_info_12342 = ({mod_instances: null, mod_name: "IO", mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_12306, mod_submodules: null});
  const __rec_upd_12344 = ctx_12308;
  const __rec_upd_12346 = ctx_12308.type_env;
  const _t12347 = ({classes: __rec_upd_12346.classes, constructors: __rec_upd_12346.constructors, effects: __rec_upd_12346.effects, instances: __rec_upd_12346.instances, modules: ({_hd: ["IO", io_info_12342], _tl: ctx_12308.type_env.modules}), mutable_fields: __rec_upd_12346.mutable_fields, records: __rec_upd_12346.records, type_aliases: __rec_upd_12346.type_aliases, type_synonyms: __rec_upd_12346.type_synonyms, variants: __rec_upd_12346.variants});
  const _t12345 = ({constraint_tvars: __rec_upd_12344.constraint_tvars, current_eff: __rec_upd_12344.current_eff, current_module: __rec_upd_12344.current_module, inside_handler: __rec_upd_12344.inside_handler, loop_info: __rec_upd_12344.loop_info, mutable_vars: __rec_upd_12344.mutable_vars, return_type: __rec_upd_12344.return_type, return_used: __rec_upd_12344.return_used, type_env: _t12347, vars: __rec_upd_12344.vars});
  (ctx_12308 = _t12345, undefined);
  (pub_vars_12306 = null, undefined);
  _call(register_fn_12316, [__dict_Show_int, "Sys", "args", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 10, _name: "TList", _val: ({_tag: 3, _name: "TString"})})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "Sys", "getenv", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 3, _name: "TString"}), _tl: null})]})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "Sys", "exit", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 6, _name: "TUnit"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "Sys", "time", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "TFloat"})), 1]);
  const sys_info_12348 = ({mod_instances: null, mod_name: "Sys", mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_12306, mod_submodules: null});
  const __rec_upd_12350 = ctx_12308;
  const __rec_upd_12352 = ctx_12308.type_env;
  const _t12353 = ({classes: __rec_upd_12352.classes, constructors: __rec_upd_12352.constructors, effects: __rec_upd_12352.effects, instances: __rec_upd_12352.instances, modules: ({_hd: ["Sys", sys_info_12348], _tl: ctx_12308.type_env.modules}), mutable_fields: __rec_upd_12352.mutable_fields, records: __rec_upd_12352.records, type_aliases: __rec_upd_12352.type_aliases, type_synonyms: __rec_upd_12352.type_synonyms, variants: __rec_upd_12352.variants});
  const _t12351 = ({constraint_tvars: __rec_upd_12350.constraint_tvars, current_eff: __rec_upd_12350.current_eff, current_module: __rec_upd_12350.current_module, inside_handler: __rec_upd_12350.inside_handler, loop_info: __rec_upd_12350.loop_info, mutable_vars: __rec_upd_12350.mutable_vars, return_type: __rec_upd_12350.return_type, return_used: __rec_upd_12350.return_used, type_env: _t12353, vars: __rec_upd_12350.vars});
  (ctx_12308 = _t12351, undefined);
  load_12322("math");
  load_12322("result");
  load_12322("byte");
  load_12322("rune");
  load_12322("set");
  load_12322("enum");
  load_12322("seq");
  load_12322("option");
  load_12322("buffer");
  load_12322("fmt");
  load_12322("hash");
  load_12322("hashtbl");
  load_12322("ref");
  load_12322("dynarray");
  load_12322("compat");
  (pub_vars_12306 = null, undefined);
  _call(register_fn_12316, [__dict_Show_int, "Runtime", "eval", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 1]);
  _call(register_fn_12316, [__dict_Show_int, "Runtime", "eval_file", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 1]);
  const runtime_info_12354 = ({mod_instances: null, mod_name: "Runtime", mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_12306, mod_submodules: null});
  const __rec_upd_12356 = ctx_12308;
  const __rec_upd_12358 = ctx_12308.type_env;
  const _t12359 = ({classes: __rec_upd_12358.classes, constructors: __rec_upd_12358.constructors, effects: __rec_upd_12358.effects, instances: __rec_upd_12358.instances, modules: ({_hd: ["Runtime", runtime_info_12354], _tl: ctx_12308.type_env.modules}), mutable_fields: __rec_upd_12358.mutable_fields, records: __rec_upd_12358.records, type_aliases: __rec_upd_12358.type_aliases, type_synonyms: __rec_upd_12358.type_synonyms, variants: __rec_upd_12358.variants});
  const _t12357 = ({constraint_tvars: __rec_upd_12356.constraint_tvars, current_eff: __rec_upd_12356.current_eff, current_module: __rec_upd_12356.current_module, inside_handler: __rec_upd_12356.inside_handler, loop_info: __rec_upd_12356.loop_info, mutable_vars: __rec_upd_12356.mutable_vars, return_type: __rec_upd_12356.return_type, return_used: __rec_upd_12356.return_used, type_env: _t12359, vars: __rec_upd_12356.vars});
  (ctx_12308 = _t12357, undefined);
  const _t12355 = [ctx_12308, List$rev(setup_protos_12310)];
  const _t12349 = _t12355;
  const _t12343 = _t12349;
  const _t12337 = _t12343;
  const _t12331 = _t12337;
  const _t12329 = _t12331;
  const _t12323 = _t12329;
  const _t12317 = _t12323;
  const _t12311 = _t12317;
  const _t12309 = _t12311;
  const _t12307 = _t12309;
  return _t12307;
}
function Main$run_batch(manifest_file) {
  const _t12360 = (function() {
    const _t12361 = _h;
    _h = Object.assign({}, _t12361, {
      "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
      "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
      "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
      "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const manifest_12362 = IO$read_file(manifest_file);
      function _t12364(s) {
        return (s !== "");
      }
      const files_12365 = List$filter(_t12364, String$split("\n", manifest_12362));
      let _t12368;
      const _t12367 = Main$setup_builtins(undefined);
      _t12369: {
        if (true) {
          const ctx = _t12367[0];
          const global_names = _t12367[1];
          const mutable_globals = _t12367[2];
          const stdlib_pub_vars = _t12367[3];
          const ctx_12370 = Main$setup_option_type(ctx);
          let _t12373;
          const _t12372 = Main$setup_classes(ctx_12370, global_names, mutable_globals, stdlib_pub_vars);
          _t12374: {
            if (true) {
              const ctx = _t12372[0];
              const class_protos = _t12372[1];
              let _t12376;
              const _t12375 = Main$setup_modules(ctx, global_names, mutable_globals);
              _t12377: {
                if (true) {
                  const ctx = _t12375[0];
                  const module_protos = _t12375[1];
                  const setup_protos_12378 = List$concat(class_protos, module_protos);
                  const base_gn_len_12380 = Dynarray$length(global_names);
                  const base_native_12382 = Main$native_global_entries;
                  const base_mutable_12384 = Hashtbl$to_list(mutable_globals);
                  function _t12386(filename) {
                    (global_names.count = base_gn_len_12380, undefined);
                    (Main$native_global_entries = base_native_12382, undefined);
                    Hashtbl$clear(mutable_globals);
                    function _t12387(__p398) {
                      let _t12389;
                      const _t12388 = __p398;
                      _t12390: {
                        if (true) {
                          const k = _t12388[0];
                          const v = _t12388[1];
                          _t12389 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, mutable_globals, k, v]);
                          break _t12390;
                        }
                        _match_fail("line 16190");
                      }
                      return _t12389;
                    }
                    Main$list_iter(_t12387, base_mutable_12384);
                    const _t12391 = (function() {
                      const _t12392 = _h;
                      _h = Object.assign({}, _t12392, {
                        "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
                        "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
                        "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
                        "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
                        "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
                      });
                      try {
                        const source_12393 = IO$read_file(filename);
                        const tokens_12395 = Lexer$tokenize(source_12393);
                        const program_12397 = Parser$parse_program(tokens_12395);
                        let _t12400;
                        const _t12399 = Typechecker$check_program_in_ctx(ctx, program_12397);
                        _t12401: {
                          if (true) {
                            const ctx2 = _t12399[0];
                            const typed_program = _t12399[1];
                            const typed_program2_12402 = Typechecker$transform_constraints(ctx2, typed_program);
                            const compiled_12404 = Compiler$compile_program_with_globals(ctx2.type_env, global_names, mutable_globals, typed_program2_12402);
                            const ng_json_12406 = _t12026_Main$build_native_globals_json(undefined);
                            const json_12408 = Serialize$serialize_bundle(global_names, ng_json_12406, setup_protos_12378, compiled_12404.main);
                            print(json_12408);
                            const _t12409 = print("===BATCH-SEP===");
                            const _t12407 = _t12409;
                            const _t12405 = _t12407;
                            const _t12403 = _t12405;
                            _t12400 = _t12403;
                            break _t12401;
                          }
                          _match_fail("line 16190");
                        }
                        const _t12398 = _t12400;
                        const _t12396 = _t12398;
                        const _t12394 = _t12396;
                        const x_12410 = _t12394;
                        return x_12410;
                      } catch (_exc) {
                        if (_exc && _exc._e === "lex_error") {
                          const arg = _exc._v;
                          let _t12412;
                          const _t12411 = arg;
                          _t12413: {
                            if (true) {
                              const msg = _t12411[0];
                              const _loc = _t12411[1];
                              print(("COMPILE-ERROR:" + msg));
                              _t12412 = print("===BATCH-SEP===");
                              break _t12413;
                            }
                            _match_fail("line 16190");
                          }
                          return _t12412;
                        } else if (_exc && _exc._e === "parse_error") {
                          const arg = _exc._v;
                          let _t12415;
                          const _t12414 = arg;
                          _t12416: {
                            if (true) {
                              const msg = _t12414[0];
                              const _loc = _t12414[1];
                              print(("COMPILE-ERROR:" + msg));
                              _t12415 = print("===BATCH-SEP===");
                              break _t12416;
                            }
                            _match_fail("line 16190");
                          }
                          return _t12415;
                        } else if (_exc && _exc._e === "type_error") {
                          const arg = _exc._v;
                          let _t12418;
                          const _t12417 = arg;
                          _t12419: {
                            if (true) {
                              const msg = _t12417[0];
                              const _loc = _t12417[1];
                              print(("COMPILE-ERROR:" + msg));
                              _t12418 = print("===BATCH-SEP===");
                              break _t12419;
                            }
                            _match_fail("line 16190");
                          }
                          return _t12418;
                        } else if (_exc && _exc._e === "compile_error") {
                          const msg = _exc._v;
                          print(("COMPILE-ERROR:" + msg));
                          return print("===BATCH-SEP===");
                        } else if (_exc && _exc._e === "unify_error") {
                          const msg = _exc._v;
                          print(("COMPILE-ERROR:" + msg));
                          return print("===BATCH-SEP===");
                        } else { throw _exc; }
                      } finally { _h = _t12392; }
                    })();
                    return _t12391;
                  }
                  const _t12385 = Main$list_iter(_t12386, files_12365);
                  const _t12383 = _t12385;
                  const _t12381 = _t12383;
                  const _t12379 = _t12381;
                  _t12376 = _t12379;
                  break _t12377;
                }
                _match_fail("line 16190");
              }
              _t12373 = _t12376;
              break _t12374;
            }
            _match_fail("line 16190");
          }
          const _t12371 = _t12373;
          _t12368 = _t12371;
          break _t12369;
        }
        _match_fail("line 16190");
      }
      const _t12366 = _t12368;
      const _t12363 = _t12366;
      const x_12420 = _t12363;
      return x_12420;
    } catch (_exc) {
      if (_exc && _exc._e === "lex_error") {
        const arg = _exc._v;
        let _t12422;
        const _t12421 = arg;
        _t12423: {
          if (true) {
            const msg = _t12421[0];
            const _loc = _t12421[1];
            _t12422 = failwith(msg);
            break _t12423;
          }
          _match_fail("line 16190");
        }
        return _t12422;
      } else if (_exc && _exc._e === "parse_error") {
        const arg = _exc._v;
        let _t12425;
        const _t12424 = arg;
        _t12426: {
          if (true) {
            const msg = _t12424[0];
            const _loc = _t12424[1];
            _t12425 = failwith(msg);
            break _t12426;
          }
          _match_fail("line 16190");
        }
        return _t12425;
      } else if (_exc && _exc._e === "type_error") {
        const arg = _exc._v;
        let _t12428;
        const _t12427 = arg;
        _t12429: {
          if (true) {
            const msg = _t12427[0];
            const _loc = _t12427[1];
            _t12428 = failwith(msg);
            break _t12429;
          }
          _match_fail("line 16190");
        }
        return _t12428;
      } else if (_exc && _exc._e === "compile_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else { throw _exc; }
    } finally { _h = _t12361; }
  })();
  return _t12360;
}
function Main$run_emit_js(args) {
  const _t12430 = (function() {
    const _t12431 = _h;
    _h = Object.assign({}, _t12431, {
      "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
      "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
      "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
      "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
      "codegen_error": function(msg, __k_try) { throw {_e: "codegen_error", _v: msg}; },
    });
    try {
      (Main$js_capture_mode = true, undefined);
      (Main$captured_typed_setups = null, undefined);
      let _t12433;
      const _t12432 = Main$setup_builtins(undefined);
      _t12434: {
        if (true) {
          const ctx = _t12432[0];
          const global_names = _t12432[1];
          const mutable_globals = _t12432[2];
          const stdlib_pub_vars = _t12432[3];
          const ctx_12435 = Main$setup_option_type(ctx);
          let _t12438;
          const _t12437 = Main$setup_classes(ctx_12435, global_names, mutable_globals, stdlib_pub_vars);
          _t12439: {
            if (true) {
              const ctx = _t12437[0];
              const _class_protos = _t12437[1];
              let _t12441;
              const _t12440 = Main$setup_modules(ctx, global_names, mutable_globals);
              _t12442: {
                if (true) {
                  const ctx = _t12440[0];
                  const _module_protos = _t12440[1];
                  let _t12444;
                  const _t12443 = args;
                  _t12445: {
                    if (_t12443 !== null && _t12443._tl !== null) {
                      const file = _t12443._tl._hd;
                      _t12444 = file;
                      break _t12445;
                    }
                    if (true) {
                      _t12444 = failwith("Usage: compiler --emit-js <source-file>");
                      break _t12445;
                    }
                    _match_fail("line 16190");
                  }
                  const filename_12446 = _t12444;
                  const source_12448 = IO$read_file(filename_12446);
                  const tokens_12450 = Lexer$tokenize(source_12448);
                  const program_12452 = Parser$parse_program(tokens_12450);
                  let _t12455;
                  const _t12454 = Typechecker$check_program_in_ctx(ctx, program_12452);
                  _t12456: {
                    if (true) {
                      const ctx2 = _t12454[0];
                      const typed_program = _t12454[1];
                      const typed_program2_12457 = Typechecker$transform_constraints(ctx2, typed_program);
                      const js_12459 = Js_codegen$compile_program_with_stdlib(ctx2.type_env, Main$captured_typed_setups, typed_program2_12457);
                      const _t12460 = print(js_12459);
                      const _t12458 = _t12460;
                      _t12455 = _t12458;
                      break _t12456;
                    }
                    _match_fail("line 16190");
                  }
                  const _t12453 = _t12455;
                  const _t12451 = _t12453;
                  const _t12449 = _t12451;
                  const _t12447 = _t12449;
                  _t12441 = _t12447;
                  break _t12442;
                }
                _match_fail("line 16190");
              }
              _t12438 = _t12441;
              break _t12439;
            }
            _match_fail("line 16190");
          }
          const _t12436 = _t12438;
          _t12433 = _t12436;
          break _t12434;
        }
        _match_fail("line 16190");
      }
      const x_12461 = _t12433;
      return x_12461;
    } catch (_exc) {
      if (_exc && _exc._e === "lex_error") {
        const arg = _exc._v;
        let _t12463;
        const _t12462 = arg;
        _t12464: {
          if (true) {
            const msg = _t12462[0];
            const _loc = _t12462[1];
            _t12463 = failwith(msg);
            break _t12464;
          }
          _match_fail("line 16190");
        }
        return _t12463;
      } else if (_exc && _exc._e === "parse_error") {
        const arg = _exc._v;
        let _t12466;
        const _t12465 = arg;
        _t12467: {
          if (true) {
            const msg = _t12465[0];
            const _loc = _t12465[1];
            _t12466 = failwith(msg);
            break _t12467;
          }
          _match_fail("line 16190");
        }
        return _t12466;
      } else if (_exc && _exc._e === "type_error") {
        const arg = _exc._v;
        let _t12469;
        const _t12468 = arg;
        _t12470: {
          if (true) {
            const msg = _t12468[0];
            const _loc = _t12468[1];
            _t12469 = failwith(msg);
            break _t12470;
          }
          _match_fail("line 16190");
        }
        return _t12469;
      } else if (_exc && _exc._e === "compile_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else if (_exc && _exc._e === "codegen_error") {
        const msg = _exc._v;
        return failwith(("JS codegen error: " + msg));
      } else { throw _exc; }
    } finally { _h = _t12431; }
  })();
  return _t12430;
}
const args_12472 = Sys$args(undefined);
let _t12475;
const _t12474 = args_12472;
_t12476: {
  if (_t12474 !== null && _t12474._tl !== null && _t12474._tl._hd === "--batch" && _t12474._tl._tl !== null) {
    const f = _t12474._tl._tl._hd;
    _t12475 = ({_tag: 1, _name: "Some", _val: f});
    break _t12476;
  }
  if (true) {
    _t12475 = ({_tag: 0, _name: "None"});
    break _t12476;
  }
  _match_fail("line 16190");
}
const batch_file_12477 = _t12475;
function _t12479(a) {
  return (a === "--emit-js");
}
const emit_js_12480 = List$exists(_t12479, args_12472);
function _t12482(a) {
  return (a === "--no-optimize");
}
const no_optimize_12483 = List$exists(_t12482, args_12472);
let _t12485;
if (no_optimize_12483) {
  _t12485 = Ref$set(Compiler$optimize_enabled, false);
} else {
  _t12485 = undefined;
}
_t12485;
function _t12486(a) {
  return ((a !== "--no-optimize") && (a !== "--emit-js"));
}
const args_12487 = List$filter(_t12486, args_12472);
let _t12490;
const _t12489 = batch_file_12477;
_t12491: {
  if (_t12489._tag === 1) {
    const f = _t12489._val;
    _t12490 = Main$run_batch(f);
    break _t12491;
  }
  if (_t12489._tag === 0) {
    let _t12492;
    if (emit_js_12480) {
      _t12492 = Main$run_emit_js(args_12487);
    } else {
      const _t12493 = (function() {
        const _t12494 = _h;
        _h = Object.assign({}, _t12494, {
          "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
          "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
          "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
          "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
          "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
        });
        try {
          let _t12496;
          const _t12495 = args_12487;
          _t12497: {
            if (_t12495 !== null && _t12495._tl !== null && _t12495._tl._hd === "--emit-json" && _t12495._tl._tl !== null) {
              const file = _t12495._tl._tl._hd;
              _t12496 = file;
              break _t12497;
            }
            if (_t12495 !== null && _t12495._tl !== null) {
              const file = _t12495._tl._hd;
              _t12496 = file;
              break _t12497;
            }
            if (true) {
              _t12496 = failwith("Usage: compiler [--emit-json | --emit-js | --batch <manifest>] <source-file>");
              break _t12497;
            }
            _match_fail("line 16190");
          }
          const filename_12498 = _t12496;
          const source_12500 = IO$read_file(filename_12498);
          let _t12503;
          const _t12502 = Main$setup_builtins(undefined);
          _t12504: {
            if (true) {
              const ctx = _t12502[0];
              const global_names = _t12502[1];
              const mutable_globals = _t12502[2];
              const stdlib_pub_vars = _t12502[3];
              const ctx_12505 = Main$setup_option_type(ctx);
              let _t12508;
              const _t12507 = Main$setup_classes(ctx_12505, global_names, mutable_globals, stdlib_pub_vars);
              _t12509: {
                if (true) {
                  const ctx = _t12507[0];
                  const class_protos = _t12507[1];
                  let _t12511;
                  const _t12510 = Main$setup_modules(ctx, global_names, mutable_globals);
                  _t12512: {
                    if (true) {
                      const ctx = _t12510[0];
                      const module_protos = _t12510[1];
                      const setup_protos_12513 = List$concat(class_protos, module_protos);
                      const tokens_12515 = Lexer$tokenize(source_12500);
                      const program_12517 = Parser$parse_program(tokens_12515);
                      let _t12520;
                      const _t12519 = Typechecker$check_program_in_ctx(ctx, program_12517);
                      _t12521: {
                        if (true) {
                          const ctx2 = _t12519[0];
                          const typed_program = _t12519[1];
                          const typed_program2_12522 = Typechecker$transform_constraints(ctx2, typed_program);
                          const compiled_12524 = Compiler$compile_program_with_globals(ctx2.type_env, global_names, mutable_globals, typed_program2_12522);
                          const ng_json_12526 = _t12026_Main$build_native_globals_json(undefined);
                          const json_12528 = Serialize$serialize_bundle(global_names, ng_json_12526, setup_protos_12513, compiled_12524.main);
                          const _t12529 = print(json_12528);
                          const _t12527 = _t12529;
                          const _t12525 = _t12527;
                          const _t12523 = _t12525;
                          _t12520 = _t12523;
                          break _t12521;
                        }
                        _match_fail("line 16190");
                      }
                      const _t12518 = _t12520;
                      const _t12516 = _t12518;
                      const _t12514 = _t12516;
                      _t12511 = _t12514;
                      break _t12512;
                    }
                    _match_fail("line 16190");
                  }
                  _t12508 = _t12511;
                  break _t12509;
                }
                _match_fail("line 16190");
              }
              const _t12506 = _t12508;
              _t12503 = _t12506;
              break _t12504;
            }
            _match_fail("line 16190");
          }
          const _t12501 = _t12503;
          const _t12499 = _t12501;
          const x_12530 = _t12499;
          return x_12530;
        } catch (_exc) {
          if (_exc && _exc._e === "lex_error") {
            const arg = _exc._v;
            let _t12532;
            const _t12531 = arg;
            _t12533: {
              if (true) {
                const msg = _t12531[0];
                const _loc = _t12531[1];
                _t12532 = failwith(msg);
                break _t12533;
              }
              _match_fail("line 16190");
            }
            return _t12532;
          } else if (_exc && _exc._e === "parse_error") {
            const arg = _exc._v;
            let _t12535;
            const _t12534 = arg;
            _t12536: {
              if (true) {
                const msg = _t12534[0];
                const _loc = _t12534[1];
                _t12535 = failwith(msg);
                break _t12536;
              }
              _match_fail("line 16190");
            }
            return _t12535;
          } else if (_exc && _exc._e === "type_error") {
            const arg = _exc._v;
            let _t12538;
            const _t12537 = arg;
            _t12539: {
              if (true) {
                const msg = _t12537[0];
                const _loc = _t12537[1];
                _t12538 = failwith(msg);
                break _t12539;
              }
              _match_fail("line 16190");
            }
            return _t12538;
          } else if (_exc && _exc._e === "compile_error") {
            const msg = _exc._v;
            return failwith(msg);
          } else if (_exc && _exc._e === "unify_error") {
            const msg = _exc._v;
            return failwith(msg);
          } else { throw _exc; }
        } finally { _h = _t12494; }
      })();
      _t12492 = _t12493;
    }
    _t12490 = _t12492;
    break _t12491;
  }
  _match_fail("line 16190");
}
const _t12488 = _t12490;
const _t12484 = _t12488;
const _t12481 = _t12484;
const _t12478 = _t12481;
const _t12473 = _t12478;
const _t12471_Main$__destruct = _t12473;
if (_last_val !== undefined) println(_pp(_last_val));
var _mml_exports = {"_result": _last_val, "_call": _call, "_pp": _pp};
if (typeof globalThis !== "undefined") globalThis._mmlExports = _mml_exports;
