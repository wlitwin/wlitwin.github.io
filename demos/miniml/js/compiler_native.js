"use strict";
function _call(f, args) {
  while (args.length > 0) {
    const a = f._arity !== undefined ? f._arity : f.length;
    if (a === 0) { f = f(); continue; }
    if (args.length < a) return _partial(f, a, args);
    const taken = args.splice(0, a);
    f = f.apply(null, taken);
  }
  return f;
}
function _partial(fn, arity, args) {
  const p = function() {
    return _call(fn, args.concat(Array.from(arguments)));
  };
  p._arity = arity - args.length;
  return p;
}
function _eq(a, b) {
  if (a === b) return true;
  if (a == null || b == null) return a === b;
  if (typeof a !== "object") return false;
  if (Array.isArray(a)) {
    if (!Array.isArray(b) || a.length !== b.length) return false;
    for (let i = 0; i < a.length; i++) if (!_eq(a[i], b[i])) return false;
    return true;
  }
  if ("_arr" in a && "_arr" in b) {
    if (a._arr.length !== b._arr.length) return false;
    for (let i = 0; i < a._arr.length; i++) if (!_eq(a._arr[i], b._arr[i])) return false;
    return true;
  }
  if ("_hd" in a && "_hd" in b) {
    let ca = a, cb = b;
    while (ca !== null && cb !== null) {
      if (!("_hd" in ca) || !("_hd" in cb)) return ca === cb;
      if (!_eq(ca._hd, cb._hd)) return false;
      ca = ca._tl; cb = cb._tl;
    }
    return ca === cb;
  }
  if ("_tag" in a) return a._tag === b._tag && _eq(a._val, b._val);
  if ("_ref" in a) return _eq(a._ref, b._ref);
  const ka = Object.keys(a), kb = Object.keys(b);
  if (ka.length !== kb.length) return false;
  for (const k of ka) if (!_eq(a[k], b[k])) return false;
  return true;
}
function _compare(a, b) {
  if (a < b) return -1;
  if (a > b) return 1;
  return 0;
}
function _match_fail(loc) { throw new Error("Match failure at " + loc); }
function _pp(v) {
  if (v === undefined) return "()";
  if (v === null) return "[]";
  if (typeof v === "number") {
    if (!Number.isInteger(v)) {
      const s = String(v);
      return s.includes(".") || s.includes("e") ? s : s + ".";
    }
    return String(v);
  }
  if (typeof v === "boolean") return String(v);
  if (typeof v === "string") return v;
  if (Array.isArray(v)) return "(" + v.map(_pp).join(", ") + ")";
  if (v !== null && typeof v === "object") {
    if ("_arr" in v) return "#[" + v._arr.map(_pp).join("; ") + "]";
    if ("_hd" in v) {
      const r = [];
      let c = v;
      while (c !== null && typeof c === "object" && "_hd" in c) { r.push(_pp(c._hd)); c = c._tl; }
      return "[" + r.join("; ") + "]";
    }
    if ("_tag" in v) {
      if (v._val !== undefined) {
        const pv = _pp(v._val);
        if (Array.isArray(v._val) || (typeof v._val === "object" && v._val !== null && "_tag" in v._val && v._val._val !== undefined))
          return v._name + " (" + pv + ")";
        return v._name + " " + pv;
      }
      return v._name;
    }
    if ("_ref" in v) return "ref(" + _pp(v._ref) + ")";
    return "{ " + Object.entries(v).map(([k,val]) => k + " = " + _pp(val)).join("; ") + " }";
  }
  return String(v);
}
let _h = {};
function _bounce(fn) { fn._tramp = true; return fn; }
const _trampolining = new Set();
function _trampoline(fn, tag) {
  if (tag !== undefined && _trampolining.has(tag)) return fn();
  if (tag !== undefined) _trampolining.add(tag);
  try {
    let result = fn();
    while (typeof result === 'function' && result._tramp) {
      result = result();
    }
    return result;
  } finally { if (tag !== undefined) _trampolining.delete(tag); }
}
function _resolve(v) { while (typeof v === 'function' && v._tramp) v = v(); return v; }
// --- Builtins ---
function print(v) {
  const s = (typeof v === "string") ? v : _pp(v);
  if (typeof globalThis._jsOutput === "function") globalThis._jsOutput(s);
  else if (typeof process !== "undefined") process.stdout.write(s);
  return undefined;
}
function println(v) {
  const s = (typeof v === "string") ? v : _pp(v);
  if (typeof globalThis._jsOutput === "function") globalThis._jsOutput(s + "\n");
  else if (typeof process !== "undefined") process.stdout.write(s + "\n");
  return undefined;
}
function string_of_int(n) { return String(n); }
function int_of_string(s) { const n = parseInt(s, 10); if (isNaN(n)) throw new Error("int_of_string: " + s); return n; }
function float_of_int(n) { return n; }
function int_of_float(f) { return Math.trunc(f); }
function float_of_string(s) { const f = parseFloat(s); if (isNaN(f)) throw new Error("float_of_string: " + s); return f; }
function string_of_float(f) {
  const s = String(f);
  return s.includes(".") || s.includes("e") ? s : s + ".";
}
function string_of_bool(b) { return String(b); }
function failwith(msg) { throw new Error(msg); }
const not = (b) => !b;
function $caret(a, b) { return a + b; }
function $mod(a, b) { return a % b; }
function __show_value(v) { return _pp(v); }
function copy_continuation(k) { return k; }
const ignore = (_) => undefined;
function fst(t) { return t[0]; }
function snd(t) { return t[1]; }
function string_length(s) { return s.length; }
function string_sub(s, start, len) { return s.substring(start, start + len); }
function string_get(s, i) { return s.charCodeAt(i); }
function string_contains(s, sub) { return s.includes(sub); }
function string_concat(sep, parts) {
  const arr = [];
  let c = parts;
  while (c !== null) { arr.push(c._hd); c = c._tl; }
  return arr.join(sep);
}
function array_length(a) { return a._arr.length; }
function array_get(a, i) { return a._arr[i]; }
function array_set(a, i, v) { a._arr[i] = v; return undefined; }
function array_make(n, v) { return {_arr: new Array(n).fill(v)}; }
function array_of_list(lst) {
  const arr = [];
  let c = lst;
  while (c !== null) { arr.push(c._hd); c = c._tl; }
  return {_arr: arr};
}
function array_to_list(arr) {
  const a = arr._arr;
  let result = null;
  for (let i = a.length - 1; i >= 0; i--) result = {_hd: a[i], _tl: result};
  return result;
}
function array_copy(a) { return {_arr: a._arr.slice()}; }
function array_sub(a, start, len) { return {_arr: a._arr.slice(start, start + len)}; }
function __math_pow(a, b) { return Math.pow(a, b); }
function __math_sqrt(x) { return Math.sqrt(x); }
function __math_floor(x) { return Math.floor(x); }
function __math_ceil(x) { return Math.ceil(x); }
function __math_round(x) { return Math.round(x); }
function __math_abs(x) { return Math.abs(x); }
function __math_sin(x) { return Math.sin(x); }
function __math_cos(x) { return Math.cos(x); }
function __math_abs_float(x) { return Math.abs(x); }
function __byte_to_char(b) { return String.fromCharCode(b); }
function __byte_to_int(b) { return b; }
function __byte_of_int(n) { return n & 0xFF; }
function __byte_to_string(b) { return String.fromCharCode(b); }
function __char_to_byte(s) { return s.charCodeAt(0); }
function __rune_to_string(cp) {
  return String.fromCodePoint(cp);
}
function __string_to_runes(s) {
  const cps = Array.from(s).map(c => c.codePointAt(0));
  let result = null;
  for (let i = cps.length - 1; i >= 0; i--) result = {_hd: cps[i], _tl: result};
  return result;
}
function __rune_to_int(r) { return r; }
function __rune_of_int(n) { return n; }
function __int_to_hex(n) { return n.toString(16); }
function __int_to_oct(n) { return n.toString(8); }
function __int_to_bin(n) { return n.toString(2); }
function __fmt_float(prec, f) { return f.toFixed(prec); }
function __fmt_hex(n) { return n.toString(16); }
function __fmt_hex_upper(n) { return n.toString(16).toUpperCase(); }
function __fmt_oct(n) { return n.toString(8); }
function __fmt_bin(n) { return n.toString(2); }
function __fmt_zero_pad(width, s) { return s.padStart(width, "0"); }
function __fmt_pad_left(width, s) { return s.padStart(width, " "); }
function __fmt_pad_right(width, s) { return s.padEnd(width, " "); }
function __sys_time() { return Date.now() / 1000.0; }
function __sys_exit(code) { if (typeof process !== "undefined") process.exit(code); throw new Error("exit: " + code); }
// --- Module extern stubs ---
// String module
function String$length(s) { return s.length; }
function String$sub(s, start, len) {
  if (start < 0 || len < 0 || start + len > s.length)
    throw new Error("String.sub: index out of bounds");
  return s.substring(start, start + len);
}
function String$split(delim, input) {
  if (delim.length === 0) {
    let r = null;
    for (let i = input.length - 1; i >= 0; i--) r = {_hd: input[i], _tl: r};
    return r;
  }
  const parts = input.split(delim);
  let r = null;
  for (let i = parts.length - 1; i >= 0; i--) r = {_hd: parts[i], _tl: r};
  return r;
}
function String$trim(s) { return s.trim(); }
function String$starts_with(prefix, s) { return s.startsWith(prefix); }
function String$contains(sub, s) { return s.includes(sub); }
function String$replace(old_s, new_s, input) {
  if (old_s.length === 0) return input;
  return input.split(old_s).join(new_s);
}
function String$to_int(s) { const n = parseInt(s,10); return isNaN(n) ? {_tag:0,_name:"None"} : {_tag:1,_name:"Some",_val:n}; }
function String$to_float(s) { const f = parseFloat(s); return isNaN(f) ? {_tag:0,_name:"None"} : {_tag:1,_name:"Some",_val:f}; }
function String$uppercase(s) { return s.toUpperCase(); }
function String$lowercase(s) { return s.toLowerCase(); }
function String$get(s, i) {
  if (i < 0 || i >= s.length) throw new Error("String.get: index " + i + " out of bounds (length " + s.length + ")");
  return s.charCodeAt(i);
}
function String$to_bytes(s) {
  let r = null;
  for (let i = s.length - 1; i >= 0; i--) r = {_hd: s.charCodeAt(i), _tl: r};
  return r;
}
function String$of_bytes(lst) {
  let r = "";
  let c = lst;
  while (c !== null) { r += String.fromCharCode(c._hd); c = c._tl; }
  return r;
}
function String$to_byte_array(s) {
  const a = new Array(s.length);
  for (let i = 0; i < s.length; i++) a[i] = s.charCodeAt(i);
  return {_arr: a};
}
function String$of_byte_array(a) {
  let r = "";
  for (let i = 0; i < a._arr.length; i++) r += String.fromCharCode(a._arr[i]);
  return r;
}
function String$to_runes(s) { return __string_to_runes(s); }
function String$of_runes(lst) {
  let r = "";
  let c = lst;
  while (c !== null) { r += String.fromCodePoint(c._hd); c = c._tl; }
  return r;
}
function String$get_rune(s, n) {
  const cps = Array.from(s);
  if (n < 0 || n >= cps.length) throw new Error("String.get_rune: index " + n + " out of bounds");
  return cps[n].codePointAt(0);
}
function String$of_byte(b) { return String.fromCharCode(b); }
function String$rune_length(s) { return Array.from(s).length; }
function String$make(n, b) {
  if (n < 0) throw new Error("String.make: negative length");
  return String.fromCharCode(b).repeat(n);
}
function String$index_opt(s, b) { const i=s.indexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:"None"}:{_tag:1,_name:"Some",_val:i}; }
function String$rindex_opt(s, b) { const i=s.lastIndexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:"None"}:{_tag:1,_name:"Some",_val:i}; }
function String$concat(sep, lst) { return string_concat(sep, lst); }
function String$compare(a, b) { return a < b ? -1 : a > b ? 1 : 0; }
// Array module
function Array$make(n, v) { return array_make(n, v); }
function Array$get(a, i) { return array_get(a, i); }
function Array$set(a, i, v) { return array_set(a, i, v); }
function Array$length(a) { return array_length(a); }
function Array$to_list(a) { return array_to_list(a); }
function Array$of_list(l) { return array_of_list(l); }
function Array$copy(a) { return array_copy(a); }
function Array$sub(a, s, l) { return array_sub(a, s, l); }
// IO module
function IO$read_file(path) {
  if (typeof globalThis._jsReadFile === "function") return globalThis._jsReadFile(path);
  if (typeof require !== "undefined") return require("fs").readFileSync(path,"utf8");
  throw new Error("IO.read_file: not available in this environment");
}
function IO$write_file(path, data) {
  if (typeof require !== "undefined") { require("fs").writeFileSync(path,data); return undefined; }
  throw new Error("IO.write_file: not available in this environment");
}
function IO$append_file(path, data) {
  if (typeof require !== "undefined") { require("fs").appendFileSync(path,data); return undefined; }
  throw new Error("IO.append_file: not available in this environment");
}
function IO$read_line(u) {
  if (typeof require !== "undefined") {
    const buf = Buffer.alloc(1);
    let line = "";
    const fd = require("fs").openSync("/dev/stdin", "rs");
    while (true) {
      const n = require("fs").readSync(fd, buf, 0, 1);
      if (n === 0 || buf[0] === 10) break;
      line += String.fromCharCode(buf[0]);
    }
    return line;
  }
  return "";
}
function IO$file_exists(path) {
  if (typeof require !== "undefined") return require("fs").existsSync(path);
  return false;
}
// Sys module
function Sys$args(u) {
  if (globalThis._jsSysArgs) {
    const a = globalThis._jsSysArgs;
    let r = null;
    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};
    return r;
  }
  if (typeof process !== "undefined") {
    const a = process.argv.slice(1);
    let r = null;
    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};
    return r;
  }
  return null;
}
function Sys$getenv(name) {
  if (typeof process !== "undefined") {
    const v = process.env[name];
    return v === undefined ? {_tag:0,_name:"None"} : {_tag:1,_name:"Some",_val:v};
  }
  return {_tag:0,_name:"None"};
}
function Sys$exit(code) { __sys_exit(code); }
function Sys$time(u) { return __sys_time(); }
// Runtime module (stubs â€” eval not supported in compiled JS)
function Runtime$eval(s) { throw new Error("Runtime.eval: not supported in compiled JS"); }
function Runtime$eval_file(s) { throw new Error("Runtime.eval_file: not supported in compiled JS"); }
// --- Typeclass primitive externs ---
function __num_add_int(a, b) { return a + b; }
function __num_sub_int(a, b) { return a - b; }
function __num_mul_int(a, b) { return a * b; }
function __num_div_int(a, b) { if (b === 0) throw new Error("division by zero"); return (a / b) | 0; }
function __num_neg_int(a) { return -a; }
function __num_add_float(a, b) { return a + b; }
function __num_sub_float(a, b) { return a - b; }
function __num_mul_float(a, b) { return a * b; }
function __num_div_float(a, b) { return a / b; }
function __num_neg_float(a) { return -a; }
function __eq_int(a, b) { return a === b; }
function __neq_int(a, b) { return a !== b; }
function __eq_float(a, b) { return a === b; }
function __neq_float(a, b) { return a !== b; }
function __eq_string(a, b) { return a === b; }
function __neq_string(a, b) { return a !== b; }
function __eq_bool(a, b) { return a === b; }
function __neq_bool(a, b) { return a !== b; }
function __eq_byte(a, b) { return a === b; }
function __neq_byte(a, b) { return a !== b; }
function __eq_rune(a, b) { return a === b; }
function __neq_rune(a, b) { return a !== b; }
function __lt_int(a, b) { return a < b; }
function __gt_int(a, b) { return a > b; }
function __le_int(a, b) { return a <= b; }
function __ge_int(a, b) { return a >= b; }
function __lt_float(a, b) { return a < b; }
function __gt_float(a, b) { return a > b; }
function __le_float(a, b) { return a <= b; }
function __ge_float(a, b) { return a >= b; }
function __lt_string(a, b) { return a < b; }
function __gt_string(a, b) { return a > b; }
function __le_string(a, b) { return a <= b; }
function __ge_string(a, b) { return a >= b; }
function __lt_byte(a, b) { return a < b; }
function __gt_byte(a, b) { return a > b; }
function __le_byte(a, b) { return a <= b; }
function __ge_byte(a, b) { return a >= b; }
function __lt_rune(a, b) { return a < b; }
function __gt_rune(a, b) { return a > b; }
function __le_rune(a, b) { return a <= b; }
function __ge_rune(a, b) { return a >= b; }
function __band_int(a, b) { return a & b; }
function __bor_int(a, b) { return a | b; }
function __bxor_int(a, b) { return a ^ b; }
function __bshl_int(a, b) { return a << b; }
function __bshr_int(a, b) { return a >> b; }
function __bnot_int(a) { return ~a; }
function __show_int(a) { return String(a); }
function __show_float(a) { return string_of_float(a); }
function __show_bool(a) { return String(a); }
function __show_string(a) { return a; }
function __show_unit(_) { return "()"; }
function __show_byte(a) { return "#" + a.toString(16).padStart(2, "0"); }
function __show_rune(a) { return String.fromCodePoint(a); }
function __index_at_array(i, arr) { if (i < 0 || i >= arr.length) throw new Error("array index out of bounds: " + i + " (length " + arr.length + ")"); return arr[i]; }
function __index_at_string(i, s) { if (i < 0 || i >= s.length) throw new Error("string index out of bounds: " + i + " (length " + s.length + ")"); return s.charCodeAt(i); }
// --- Canvas builtins (browser only) ---
function Canvas$init(w, h) {
  if (typeof globalThis._canvasInit === "function") globalThis._canvasInit(w, h);
  return undefined;
}
function Canvas$clear(color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height); }
  return undefined;
}
function Canvas$fill_rect(x, y, w, h, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.fillRect(x, y, w, h); }
  return undefined;
}
function Canvas$stroke_rect(x, y, w, h, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.strokeStyle = color; ctx.lineWidth = 1; ctx.strokeRect(x, y, w, h); }
  return undefined;
}
function Canvas$fill_circle(x, y, r, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x, y, r, 0, 2*Math.PI); ctx.fill(); }
  return undefined;
}
function Canvas$draw_text(text, x, y, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.textBaseline = "top"; ctx.fillText(text, x, y); }
  return undefined;
}
function Canvas$set_font(font) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.font = font; }
  return undefined;
}
function Canvas$mouse_x(_) { return globalThis._canvasMouseX || 0; }
function Canvas$mouse_y(_) { return globalThis._canvasMouseY || 0; }
function Canvas$mouse_down(_) { return !!globalThis._canvasMouseDown; }
function Canvas$mouse_clicked(_) { return !!globalThis._canvasMouseClicked; }
function Canvas$key_down(key) { return !!(globalThis._canvasKeysDown && globalThis._canvasKeysDown[key]); }
function Canvas$key_pressed(key) { return !!(globalThis._canvasKeysPressed && globalThis._canvasKeysPressed[key]); }
function Canvas$start_app(init_fn, frame_fn) {
  globalThis._canvasApp = { initFn: init_fn, frameFn: frame_fn, jsMode: true, call: _call };
  return undefined;
}
// --- Stdlib ---
if (typeof __num_add_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_add_int"]) var __num_add_int = globalThis._mmlExterns["__num_add_int"]; else throw new Error("extern " + "__num_add_int" + " not provided"); }
if (typeof __num_sub_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_sub_int"]) var __num_sub_int = globalThis._mmlExterns["__num_sub_int"]; else throw new Error("extern " + "__num_sub_int" + " not provided"); }
if (typeof __num_mul_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_mul_int"]) var __num_mul_int = globalThis._mmlExterns["__num_mul_int"]; else throw new Error("extern " + "__num_mul_int" + " not provided"); }
if (typeof __num_div_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_div_int"]) var __num_div_int = globalThis._mmlExterns["__num_div_int"]; else throw new Error("extern " + "__num_div_int" + " not provided"); }
if (typeof __num_neg_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_neg_int"]) var __num_neg_int = globalThis._mmlExterns["__num_neg_int"]; else throw new Error("extern " + "__num_neg_int" + " not provided"); }
if (typeof __num_add_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_add_float"]) var __num_add_float = globalThis._mmlExterns["__num_add_float"]; else throw new Error("extern " + "__num_add_float" + " not provided"); }
if (typeof __num_sub_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_sub_float"]) var __num_sub_float = globalThis._mmlExterns["__num_sub_float"]; else throw new Error("extern " + "__num_sub_float" + " not provided"); }
if (typeof __num_mul_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_mul_float"]) var __num_mul_float = globalThis._mmlExterns["__num_mul_float"]; else throw new Error("extern " + "__num_mul_float" + " not provided"); }
if (typeof __num_div_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_div_float"]) var __num_div_float = globalThis._mmlExterns["__num_div_float"]; else throw new Error("extern " + "__num_div_float" + " not provided"); }
if (typeof __num_neg_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_neg_float"]) var __num_neg_float = globalThis._mmlExterns["__num_neg_float"]; else throw new Error("extern " + "__num_neg_float" + " not provided"); }
if (typeof __eq_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_int"]) var __eq_int = globalThis._mmlExterns["__eq_int"]; else throw new Error("extern " + "__eq_int" + " not provided"); }
if (typeof __neq_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_int"]) var __neq_int = globalThis._mmlExterns["__neq_int"]; else throw new Error("extern " + "__neq_int" + " not provided"); }
if (typeof __eq_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_float"]) var __eq_float = globalThis._mmlExterns["__eq_float"]; else throw new Error("extern " + "__eq_float" + " not provided"); }
if (typeof __neq_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_float"]) var __neq_float = globalThis._mmlExterns["__neq_float"]; else throw new Error("extern " + "__neq_float" + " not provided"); }
if (typeof __eq_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_string"]) var __eq_string = globalThis._mmlExterns["__eq_string"]; else throw new Error("extern " + "__eq_string" + " not provided"); }
if (typeof __neq_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_string"]) var __neq_string = globalThis._mmlExterns["__neq_string"]; else throw new Error("extern " + "__neq_string" + " not provided"); }
if (typeof __eq_bool === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_bool"]) var __eq_bool = globalThis._mmlExterns["__eq_bool"]; else throw new Error("extern " + "__eq_bool" + " not provided"); }
if (typeof __neq_bool === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_bool"]) var __neq_bool = globalThis._mmlExterns["__neq_bool"]; else throw new Error("extern " + "__neq_bool" + " not provided"); }
if (typeof __eq_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_byte"]) var __eq_byte = globalThis._mmlExterns["__eq_byte"]; else throw new Error("extern " + "__eq_byte" + " not provided"); }
if (typeof __neq_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_byte"]) var __neq_byte = globalThis._mmlExterns["__neq_byte"]; else throw new Error("extern " + "__neq_byte" + " not provided"); }
if (typeof __eq_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_rune"]) var __eq_rune = globalThis._mmlExterns["__eq_rune"]; else throw new Error("extern " + "__eq_rune" + " not provided"); }
if (typeof __neq_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_rune"]) var __neq_rune = globalThis._mmlExterns["__neq_rune"]; else throw new Error("extern " + "__neq_rune" + " not provided"); }
if (typeof __lt_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_int"]) var __lt_int = globalThis._mmlExterns["__lt_int"]; else throw new Error("extern " + "__lt_int" + " not provided"); }
if (typeof __gt_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_int"]) var __gt_int = globalThis._mmlExterns["__gt_int"]; else throw new Error("extern " + "__gt_int" + " not provided"); }
if (typeof __le_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_int"]) var __le_int = globalThis._mmlExterns["__le_int"]; else throw new Error("extern " + "__le_int" + " not provided"); }
if (typeof __ge_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_int"]) var __ge_int = globalThis._mmlExterns["__ge_int"]; else throw new Error("extern " + "__ge_int" + " not provided"); }
if (typeof __lt_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_float"]) var __lt_float = globalThis._mmlExterns["__lt_float"]; else throw new Error("extern " + "__lt_float" + " not provided"); }
if (typeof __gt_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_float"]) var __gt_float = globalThis._mmlExterns["__gt_float"]; else throw new Error("extern " + "__gt_float" + " not provided"); }
if (typeof __le_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_float"]) var __le_float = globalThis._mmlExterns["__le_float"]; else throw new Error("extern " + "__le_float" + " not provided"); }
if (typeof __ge_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_float"]) var __ge_float = globalThis._mmlExterns["__ge_float"]; else throw new Error("extern " + "__ge_float" + " not provided"); }
if (typeof __lt_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_string"]) var __lt_string = globalThis._mmlExterns["__lt_string"]; else throw new Error("extern " + "__lt_string" + " not provided"); }
if (typeof __gt_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_string"]) var __gt_string = globalThis._mmlExterns["__gt_string"]; else throw new Error("extern " + "__gt_string" + " not provided"); }
if (typeof __le_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_string"]) var __le_string = globalThis._mmlExterns["__le_string"]; else throw new Error("extern " + "__le_string" + " not provided"); }
if (typeof __ge_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_string"]) var __ge_string = globalThis._mmlExterns["__ge_string"]; else throw new Error("extern " + "__ge_string" + " not provided"); }
if (typeof __lt_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_byte"]) var __lt_byte = globalThis._mmlExterns["__lt_byte"]; else throw new Error("extern " + "__lt_byte" + " not provided"); }
if (typeof __gt_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_byte"]) var __gt_byte = globalThis._mmlExterns["__gt_byte"]; else throw new Error("extern " + "__gt_byte" + " not provided"); }
if (typeof __le_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_byte"]) var __le_byte = globalThis._mmlExterns["__le_byte"]; else throw new Error("extern " + "__le_byte" + " not provided"); }
if (typeof __ge_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_byte"]) var __ge_byte = globalThis._mmlExterns["__ge_byte"]; else throw new Error("extern " + "__ge_byte" + " not provided"); }
if (typeof __lt_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_rune"]) var __lt_rune = globalThis._mmlExterns["__lt_rune"]; else throw new Error("extern " + "__lt_rune" + " not provided"); }
if (typeof __gt_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_rune"]) var __gt_rune = globalThis._mmlExterns["__gt_rune"]; else throw new Error("extern " + "__gt_rune" + " not provided"); }
if (typeof __le_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_rune"]) var __le_rune = globalThis._mmlExterns["__le_rune"]; else throw new Error("extern " + "__le_rune" + " not provided"); }
if (typeof __ge_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_rune"]) var __ge_rune = globalThis._mmlExterns["__ge_rune"]; else throw new Error("extern " + "__ge_rune" + " not provided"); }
if (typeof __band_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__band_int"]) var __band_int = globalThis._mmlExterns["__band_int"]; else throw new Error("extern " + "__band_int" + " not provided"); }
if (typeof __bor_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bor_int"]) var __bor_int = globalThis._mmlExterns["__bor_int"]; else throw new Error("extern " + "__bor_int" + " not provided"); }
if (typeof __bxor_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bxor_int"]) var __bxor_int = globalThis._mmlExterns["__bxor_int"]; else throw new Error("extern " + "__bxor_int" + " not provided"); }
if (typeof __bshl_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bshl_int"]) var __bshl_int = globalThis._mmlExterns["__bshl_int"]; else throw new Error("extern " + "__bshl_int" + " not provided"); }
if (typeof __bshr_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bshr_int"]) var __bshr_int = globalThis._mmlExterns["__bshr_int"]; else throw new Error("extern " + "__bshr_int" + " not provided"); }
if (typeof __bnot_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bnot_int"]) var __bnot_int = globalThis._mmlExterns["__bnot_int"]; else throw new Error("extern " + "__bnot_int" + " not provided"); }
if (typeof __show_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_int"]) var __show_int = globalThis._mmlExterns["__show_int"]; else throw new Error("extern " + "__show_int" + " not provided"); }
if (typeof __show_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_float"]) var __show_float = globalThis._mmlExterns["__show_float"]; else throw new Error("extern " + "__show_float" + " not provided"); }
if (typeof __show_bool === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_bool"]) var __show_bool = globalThis._mmlExterns["__show_bool"]; else throw new Error("extern " + "__show_bool" + " not provided"); }
if (typeof __show_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_string"]) var __show_string = globalThis._mmlExterns["__show_string"]; else throw new Error("extern " + "__show_string" + " not provided"); }
if (typeof __show_unit === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_unit"]) var __show_unit = globalThis._mmlExterns["__show_unit"]; else throw new Error("extern " + "__show_unit" + " not provided"); }
if (typeof __show_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_byte"]) var __show_byte = globalThis._mmlExterns["__show_byte"]; else throw new Error("extern " + "__show_byte" + " not provided"); }
if (typeof __show_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_rune"]) var __show_rune = globalThis._mmlExterns["__show_rune"]; else throw new Error("extern " + "__show_rune" + " not provided"); }
if (typeof __index_at_array === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__index_at_array"]) var __index_at_array = globalThis._mmlExterns["__index_at_array"]; else throw new Error("extern " + "__index_at_array" + " not provided"); }
if (typeof __index_at_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__index_at_string"]) var __index_at_string = globalThis._mmlExterns["__index_at_string"]; else throw new Error("extern " + "__index_at_string" + " not provided"); }
const __dict_Num_int = ({$star: __num_mul_int, $plus: __num_add_int, $minus: __num_sub_int, $slash: __num_div_int, neg: __num_neg_int});
const __dict_Num_float = ({$star: __num_mul_float, $plus: __num_add_float, $minus: __num_sub_float, $slash: __num_div_float, neg: __num_neg_float});
const __dict_Eq_int = ({$lt$gt: __neq_int, $eq: __eq_int});
const __dict_Eq_float = ({$lt$gt: __neq_float, $eq: __eq_float});
const __dict_Eq_string = ({$lt$gt: __neq_string, $eq: __eq_string});
const __dict_Eq_bool = ({$lt$gt: __neq_bool, $eq: __eq_bool});
const __dict_Eq_byte = ({$lt$gt: __neq_byte, $eq: __eq_byte});
const __dict_Eq_rune = ({$lt$gt: __neq_rune, $eq: __eq_rune});
const __dict_Ord_int = ({$lt: __lt_int, $lt$eq: __le_int, $gt: __gt_int, $gt$eq: __ge_int});
const __dict_Ord_float = ({$lt: __lt_float, $lt$eq: __le_float, $gt: __gt_float, $gt$eq: __ge_float});
const __dict_Ord_string = ({$lt: __lt_string, $lt$eq: __le_string, $gt: __gt_string, $gt$eq: __ge_string});
const __dict_Ord_byte = ({$lt: __lt_byte, $lt$eq: __le_byte, $gt: __gt_byte, $gt$eq: __ge_byte});
const __dict_Ord_rune = ({$lt: __lt_rune, $lt$eq: __le_rune, $gt: __gt_rune, $gt$eq: __ge_rune});
const __dict_Bitwise_int = ({land: __band_int, lnot: __bnot_int, lor: __bor_int, lsl: __bshl_int, lsr: __bshr_int, lxor: __bxor_int});
const __dict_Show_int = ({show: __show_int});
const __dict_Show_float = ({show: __show_float});
const __dict_Show_bool = ({show: __show_bool});
const __dict_Show_string = ({show: __show_string});
const __dict_Show_unit = ({show: __show_unit});
const __dict_Show_byte = ({show: __show_byte});
const __dict_Show_rune = ({show: __show_rune});
const __dict_Index_g0_array__int__g0 = ({at: __index_at_array});
const __dict_Index_string__int__byte = ({at: __index_at_string});
function _t0(f, acc, xs) {
  function go(a, l) {
    while (true) {
      let _t2;
      const _t1 = l;
      _t3: {
        if (_t1 === null) {
          _t2 = a;
          break _t3;
        }
        if (_t1 !== null) {
          const x = _t1._hd;
          const rest = _t1._tl;
          const _t4 = f(a, x);
          const _t5 = rest;
          a = _t4;
          l = _t5;
          continue;
          _t2 = undefined;
          break _t3;
        }
        _match_fail("line 14");
      }
      return _t2;
    }
  }
  const _t6 = go(acc, xs);
  return _t6;
}
const __dict_Iter_g0_list__g0 = ({fold: _t0});
function _t7(f, acc, arr) {
  function go(a, i) {
    while (true) {
      let _t8;
      if ((i === array_length(arr))) {
        _t8 = a;
      } else {
        const _t9 = f(a, array_get(arr, i));
        const _t10 = (i + 1);
        a = _t9;
        i = _t10;
        continue;
        _t8 = undefined;
      }
      return _t8;
    }
  }
  const _t11 = go(acc, 0);
  return _t11;
}
const __dict_Iter_g0_array__g0 = ({fold: _t7});
function __dict_Show_g0_list(__dict_Show_0) {
  function _t12(xs) {
    let _t14;
    const _t13 = xs;
    _t15: {
      if (_t13 === null) {
        _t14 = "[]";
        break _t15;
      }
      if (true) {
        function _t16(acc, x) {
          let _t17;
          if ((acc === "")) {
            _t17 = __dict_Show_0.show(x);
          } else {
            _t17 = ((acc + "; ") + __dict_Show_0.show(x));
          }
          return _t17;
        }
        _t14 = (("[" + __dict_Iter_g0_list__g0.fold(_t16, "", xs)) + "]");
        break _t15;
      }
      _match_fail("line 32");
    }
    return _t14;
  }
  return ({show: _t12});
}
function __dict_Show_g0_array(__dict_Show_0) {
  function _t18(arr) {
    let _t19;
    if ((array_length(arr) === 0)) {
      _t19 = "#[]";
    } else {
      function _t20(acc, x) {
        let _t21;
        if ((acc === "")) {
          _t21 = __dict_Show_0.show(x);
        } else {
          _t21 = ((acc + "; ") + __dict_Show_0.show(x));
        }
        return _t21;
      }
      _t19 = (("#[" + __dict_Iter_g0_array__g0.fold(_t20, "", arr)) + "]");
    }
    return _t19;
  }
  return ({show: _t18});
}
function __dict_Show_g0_option(__dict_Show_0) {
  function _t22(opt) {
    let _t24;
    const _t23 = opt;
    _t25: {
      if (_t23._tag === 0) {
        _t24 = "None";
        break _t25;
      }
      if (_t23._tag === 1) {
        const x = _t23._val;
        _t24 = ("Some " + __dict_Show_0.show(x));
        break _t25;
      }
      _match_fail("line 32");
    }
    return _t24;
  }
  return ({show: _t22});
}
function __dict_Show_g0_g1_tup(__dict_Show_0, __dict_Show_1) {
  function _t26(p) {
    let _t28;
    const _t27 = p;
    _t29: {
      if (true) {
        const a = _t27[0];
        const b = _t27[1];
        _t28 = (((("(" + __dict_Show_0.show(a)) + ", ") + __dict_Show_1.show(b)) + ")");
        break _t29;
      }
      _match_fail("line 32");
    }
    return _t28;
  }
  return ({show: _t26});
}
function __dict_Show_g0_g1_g2_tup(__dict_Show_0, __dict_Show_1, __dict_Show_2) {
  function _t30(p) {
    let _t32;
    const _t31 = p;
    _t33: {
      if (true) {
        const a = _t31[0];
        const b = _t31[1];
        const c = _t31[2];
        _t32 = (((((("(" + __dict_Show_0.show(a)) + ", ") + __dict_Show_1.show(b)) + ", ") + __dict_Show_2.show(c)) + ")");
        break _t33;
      }
      _match_fail("line 32");
    }
    return _t32;
  }
  return ({show: _t30});
}
if (typeof String$length === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.length"]) var String$length = globalThis._mmlExterns["String.length"]; else throw new Error("extern " + "String.length" + " not provided"); }
if (typeof String$sub === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.sub"]) var String$sub = globalThis._mmlExterns["String.sub"]; else throw new Error("extern " + "String.sub" + " not provided"); }
if (typeof String$split === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.split"]) var String$split = globalThis._mmlExterns["String.split"]; else throw new Error("extern " + "String.split" + " not provided"); }
if (typeof String$trim === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.trim"]) var String$trim = globalThis._mmlExterns["String.trim"]; else throw new Error("extern " + "String.trim" + " not provided"); }
if (typeof String$starts_with === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.starts_with"]) var String$starts_with = globalThis._mmlExterns["String.starts_with"]; else throw new Error("extern " + "String.starts_with" + " not provided"); }
if (typeof String$contains === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.contains"]) var String$contains = globalThis._mmlExterns["String.contains"]; else throw new Error("extern " + "String.contains" + " not provided"); }
if (typeof String$replace === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.replace"]) var String$replace = globalThis._mmlExterns["String.replace"]; else throw new Error("extern " + "String.replace" + " not provided"); }
if (typeof String$to_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_int"]) var String$to_int = globalThis._mmlExterns["String.to_int"]; else throw new Error("extern " + "String.to_int" + " not provided"); }
if (typeof String$to_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_float"]) var String$to_float = globalThis._mmlExterns["String.to_float"]; else throw new Error("extern " + "String.to_float" + " not provided"); }
if (typeof String$uppercase === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.uppercase"]) var String$uppercase = globalThis._mmlExterns["String.uppercase"]; else throw new Error("extern " + "String.uppercase" + " not provided"); }
if (typeof String$lowercase === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.lowercase"]) var String$lowercase = globalThis._mmlExterns["String.lowercase"]; else throw new Error("extern " + "String.lowercase" + " not provided"); }
if (typeof String$get === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.get"]) var String$get = globalThis._mmlExterns["String.get"]; else throw new Error("extern " + "String.get" + " not provided"); }
if (typeof String$to_bytes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_bytes"]) var String$to_bytes = globalThis._mmlExterns["String.to_bytes"]; else throw new Error("extern " + "String.to_bytes" + " not provided"); }
if (typeof String$of_bytes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_bytes"]) var String$of_bytes = globalThis._mmlExterns["String.of_bytes"]; else throw new Error("extern " + "String.of_bytes" + " not provided"); }
if (typeof String$to_byte_array === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_byte_array"]) var String$to_byte_array = globalThis._mmlExterns["String.to_byte_array"]; else throw new Error("extern " + "String.to_byte_array" + " not provided"); }
if (typeof String$of_byte_array === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_byte_array"]) var String$of_byte_array = globalThis._mmlExterns["String.of_byte_array"]; else throw new Error("extern " + "String.of_byte_array" + " not provided"); }
if (typeof String$to_runes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_runes"]) var String$to_runes = globalThis._mmlExterns["String.to_runes"]; else throw new Error("extern " + "String.to_runes" + " not provided"); }
if (typeof String$of_runes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_runes"]) var String$of_runes = globalThis._mmlExterns["String.of_runes"]; else throw new Error("extern " + "String.of_runes" + " not provided"); }
if (typeof String$get_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.get_rune"]) var String$get_rune = globalThis._mmlExterns["String.get_rune"]; else throw new Error("extern " + "String.get_rune" + " not provided"); }
if (typeof String$of_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_byte"]) var String$of_byte = globalThis._mmlExterns["String.of_byte"]; else throw new Error("extern " + "String.of_byte" + " not provided"); }
if (typeof String$rune_length === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.rune_length"]) var String$rune_length = globalThis._mmlExterns["String.rune_length"]; else throw new Error("extern " + "String.rune_length" + " not provided"); }
if (typeof String$make === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.make"]) var String$make = globalThis._mmlExterns["String.make"]; else throw new Error("extern " + "String.make" + " not provided"); }
if (typeof String$index_opt === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.index_opt"]) var String$index_opt = globalThis._mmlExterns["String.index_opt"]; else throw new Error("extern " + "String.index_opt" + " not provided"); }
if (typeof String$rindex_opt === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.rindex_opt"]) var String$rindex_opt = globalThis._mmlExterns["String.rindex_opt"]; else throw new Error("extern " + "String.rindex_opt" + " not provided"); }
if (typeof String$concat === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.concat"]) var String$concat = globalThis._mmlExterns["String.concat"]; else throw new Error("extern " + "String.concat" + " not provided"); }
if (typeof String$compare === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.compare"]) var String$compare = globalThis._mmlExterns["String.compare"]; else throw new Error("extern " + "String.compare" + " not provided"); }
function String$iter(f, s) {
  const n_34 = String$length(s);
  function go(i) {
    while (true) {
      let _t36;
      if ((i >= n_34)) {
        _t36 = undefined;
      } else {
        f(String$get(s, i));
        const _t37 = (i + 1);
        i = _t37;
        continue;
        _t36 = undefined;
      }
      return _t36;
    }
  }
  const _t38 = go(0);
  const _t35 = _t38;
  return _t35;
}
function List$fold(f, acc, xs) {
  function go(a, l) {
    while (true) {
      let _t40;
      const _t39 = l;
      _t41: {
        if (_t39 === null) {
          _t40 = a;
          break _t41;
        }
        if (_t39 !== null) {
          const x = _t39._hd;
          const rest = _t39._tl;
          const _t42 = f(a, x);
          const _t43 = rest;
          a = _t42;
          l = _t43;
          continue;
          _t40 = undefined;
          break _t41;
        }
        _match_fail("line 259");
      }
      return _t40;
    }
  }
  const _t44 = go(acc, xs);
  return _t44;
}
function List$length(xs) {
  function _t45(acc, _) {
    return (acc + 1);
  }
  return List$fold(_t45, 0, xs);
}
function List$rev(xs) {
  function _t46(acc, x) {
    return ({_hd: x, _tl: acc});
  }
  return List$fold(_t46, null, xs);
}
function List$hd(xs) {
  let _t48;
  const _t47 = xs;
  _t49: {
    if (_t47 !== null) {
      const x = _t47._hd;
      _t48 = x;
      break _t49;
    }
    _match_fail("line 259");
  }
  return _t48;
}
function List$tl(xs) {
  let _t51;
  const _t50 = xs;
  _t52: {
    if (_t50 !== null) {
      const rest = _t50._tl;
      _t51 = rest;
      break _t52;
    }
    _match_fail("line 259");
  }
  return _t51;
}
function List$nth(xs, n) {
  function go(l, i) {
    while (true) {
      let _t54;
      const _t53 = l;
      _t55: {
        if (_t53 !== null) {
          const x = _t53._hd;
          const rest = _t53._tl;
          let _t56;
          if ((i === 0)) {
            _t56 = x;
          } else {
            const _t57 = rest;
            const _t58 = (i - 1);
            l = _t57;
            i = _t58;
            continue;
            _t56 = undefined;
          }
          _t54 = _t56;
          break _t55;
        }
        _match_fail("line 259");
      }
      return _t54;
    }
  }
  const _t59 = go(xs, n);
  return _t59;
}
function List$concat(a, b) {
  function _t60(acc, x) {
    return ({_hd: x, _tl: acc});
  }
  return List$fold(_t60, b, List$rev(a));
}
function List$is_empty(xs) {
  let _t62;
  const _t61 = xs;
  _t63: {
    if (_t61 === null) {
      _t62 = true;
      break _t63;
    }
    if (true) {
      _t62 = false;
      break _t63;
    }
    _match_fail("line 259");
  }
  return _t62;
}
function List$flatten(xss) {
  function _t64(acc, xs) {
    return List$concat(acc, xs);
  }
  return List$fold(_t64, null, xss);
}
function List$map(f, xs) {
  function go(acc, l) {
    while (true) {
      let _t66;
      const _t65 = l;
      _t67: {
        if (_t65 === null) {
          _t66 = List$rev(acc);
          break _t67;
        }
        if (_t65 !== null) {
          const x = _t65._hd;
          const rest = _t65._tl;
          const _t68 = ({_hd: f(x), _tl: acc});
          const _t69 = rest;
          acc = _t68;
          l = _t69;
          continue;
          _t66 = undefined;
          break _t67;
        }
        _match_fail("line 259");
      }
      return _t66;
    }
  }
  const _t70 = go(null, xs);
  return _t70;
}
function List$filter(f, xs) {
  function go(acc, l) {
    while (true) {
      let _t72;
      const _t71 = l;
      _t73: {
        if (_t71 === null) {
          _t72 = List$rev(acc);
          break _t73;
        }
        if (_t71 !== null) {
          const x = _t71._hd;
          const rest = _t71._tl;
          let _t74;
          if (f(x)) {
            const _t75 = ({_hd: x, _tl: acc});
            const _t76 = rest;
            acc = _t75;
            l = _t76;
            continue;
            _t74 = undefined;
          } else {
            const _t77 = acc;
            const _t78 = rest;
            acc = _t77;
            l = _t78;
            continue;
            _t74 = undefined;
          }
          _t72 = _t74;
          break _t73;
        }
        _match_fail("line 259");
      }
      return _t72;
    }
  }
  const _t79 = go(null, xs);
  return _t79;
}
function List$find(f, xs) {
  function go(l) {
    while (true) {
      let _t81;
      const _t80 = l;
      _t82: {
        if (_t80 === null) {
          _t81 = ({_tag: 0, _name: "None"});
          break _t82;
        }
        if (_t80 !== null) {
          const x = _t80._hd;
          const rest = _t80._tl;
          let _t83;
          if (f(x)) {
            _t83 = ({_tag: 1, _name: "Some", _val: x});
          } else {
            const _t84 = rest;
            l = _t84;
            continue;
            _t83 = undefined;
          }
          _t81 = _t83;
          break _t82;
        }
        _match_fail("line 259");
      }
      return _t81;
    }
  }
  const _t85 = go(xs);
  return _t85;
}
function List$exists(f, xs) {
  function go(l) {
    while (true) {
      let _t87;
      const _t86 = l;
      _t88: {
        if (_t86 === null) {
          _t87 = false;
          break _t88;
        }
        if (_t86 !== null) {
          const x = _t86._hd;
          const rest = _t86._tl;
          let _t89;
          if (f(x)) {
            _t89 = true;
          } else {
            const _t90 = rest;
            l = _t90;
            continue;
            _t89 = undefined;
          }
          _t87 = _t89;
          break _t88;
        }
        _match_fail("line 259");
      }
      return _t87;
    }
  }
  const _t91 = go(xs);
  return _t91;
}
function List$forall(f, xs) {
  function go(l) {
    while (true) {
      let _t93;
      const _t92 = l;
      _t94: {
        if (_t92 === null) {
          _t93 = true;
          break _t94;
        }
        if (_t92 !== null) {
          const x = _t92._hd;
          const rest = _t92._tl;
          let _t95;
          if (f(x)) {
            const _t96 = rest;
            l = _t96;
            continue;
            _t95 = undefined;
          } else {
            _t95 = false;
          }
          _t93 = _t95;
          break _t94;
        }
        _match_fail("line 259");
      }
      return _t93;
    }
  }
  const _t97 = go(xs);
  return _t97;
}
function List$zip(xs, ys) {
  function go(acc, a, b) {
    while (true) {
      let _t99;
      const _t98 = a;
      _t100: {
        if (_t98 === null) {
          _t99 = List$rev(acc);
          break _t100;
        }
        if (_t98 !== null) {
          const x = _t98._hd;
          const ra = _t98._tl;
          let _t102;
          const _t101 = b;
          _t103: {
            if (_t101 !== null) {
              const y = _t101._hd;
              const rb = _t101._tl;
              const _t104 = ({_hd: [x, y], _tl: acc});
              const _t105 = ra;
              const _t106 = rb;
              acc = _t104;
              a = _t105;
              b = _t106;
              continue;
              _t102 = undefined;
              break _t103;
            }
            _match_fail("line 259");
          }
          _t99 = _t102;
          break _t100;
        }
        _match_fail("line 259");
      }
      return _t99;
    }
  }
  const _t107 = go(null, xs, ys);
  return _t107;
}
function List$mapi(f, xs) {
  function go(i, acc, l) {
    while (true) {
      let _t109;
      const _t108 = l;
      _t110: {
        if (_t108 === null) {
          _t109 = List$rev(acc);
          break _t110;
        }
        if (_t108 !== null) {
          const x = _t108._hd;
          const rest = _t108._tl;
          const _t111 = (i + 1);
          const _t112 = ({_hd: f(i, x), _tl: acc});
          const _t113 = rest;
          i = _t111;
          acc = _t112;
          l = _t113;
          continue;
          _t109 = undefined;
          break _t110;
        }
        _match_fail("line 259");
      }
      return _t109;
    }
  }
  const _t114 = go(0, null, xs);
  return _t114;
}
function List$sort(cmp, xs) {
  function insert(x, sorted) {
    let _t116;
    const _t115 = sorted;
    _t117: {
      if (_t115 === null) {
        _t116 = ({_hd: x, _tl: null});
        break _t117;
      }
      if (_t115 !== null) {
        const y = _t115._hd;
        const rest = _t115._tl;
        let _t118;
        if ((cmp(x, y) < 1)) {
          _t118 = ({_hd: x, _tl: sorted});
        } else {
          _t118 = ({_hd: y, _tl: insert(x, rest)});
        }
        _t116 = _t118;
        break _t117;
      }
      _match_fail("line 259");
    }
    return _t116;
  }
  function _t120(acc, x) {
    return insert(x, acc);
  }
  const _t119 = List$fold(_t120, null, xs);
  return _t119;
}
function List$fold_right(f, xs, acc) {
  function go(l) {
    let _t122;
    const _t121 = l;
    _t123: {
      if (_t121 === null) {
        _t122 = acc;
        break _t123;
      }
      if (_t121 !== null) {
        const x = _t121._hd;
        const rest = _t121._tl;
        _t122 = f(x, go(rest));
        break _t123;
      }
      _match_fail("line 259");
    }
    return _t122;
  }
  const _t124 = go(xs);
  return _t124;
}
function List$find_map(f, xs) {
  function go(l) {
    while (true) {
      let _t126;
      const _t125 = l;
      _t127: {
        if (_t125 === null) {
          _t126 = ({_tag: 0, _name: "None"});
          break _t127;
        }
        if (_t125 !== null) {
          const x = _t125._hd;
          const rest = _t125._tl;
          let _t129;
          const _t128 = f(x);
          _t130: {
            if (_t128._tag === 1) {
              const result = _t128;
              _t129 = result;
              break _t130;
            }
            if (_t128._tag === 0) {
              const _t131 = rest;
              l = _t131;
              continue;
              _t129 = undefined;
              break _t130;
            }
            _match_fail("line 259");
          }
          _t126 = _t129;
          break _t127;
        }
        _match_fail("line 259");
      }
      return _t126;
    }
  }
  const _t132 = go(xs);
  return _t132;
}
function List$assoc_opt(key, xs) {
  function go(l) {
    while (true) {
      let _t134;
      const _t133 = l;
      _t135: {
        if (_t133 === null) {
          _t134 = ({_tag: 0, _name: "None"});
          break _t135;
        }
        if (_t133 !== null) {
          const k = _t133._hd[0];
          const v = _t133._hd[1];
          const rest = _t133._tl;
          let _t136;
          if (_eq(k, key)) {
            _t136 = ({_tag: 1, _name: "Some", _val: v});
          } else {
            const _t137 = rest;
            l = _t137;
            continue;
            _t136 = undefined;
          }
          _t134 = _t136;
          break _t135;
        }
        _match_fail("line 259");
      }
      return _t134;
    }
  }
  const _t138 = go(xs);
  return _t138;
}
function List$init(n, f) {
  function go(i, acc) {
    while (true) {
      let _t139;
      if ((i < 0)) {
        _t139 = acc;
      } else {
        const _t140 = (i - 1);
        const _t141 = ({_hd: f(i), _tl: acc});
        i = _t140;
        acc = _t141;
        continue;
        _t139 = undefined;
      }
      return _t139;
    }
  }
  const _t142 = go((n - 1), null);
  return _t142;
}
function List$concat_map(f, xs) {
  return List$flatten(List$map(f, xs));
}
function List$iter2(f, xs, ys) {
  function go(a, b) {
    while (true) {
      let _t144;
      const _t143 = a;
      _t145: {
        if (_t143 === null) {
          _t144 = undefined;
          break _t145;
        }
        if (_t143 !== null) {
          const x = _t143._hd;
          const ra = _t143._tl;
          let _t147;
          const _t146 = b;
          _t148: {
            if (_t146 !== null) {
              const y = _t146._hd;
              const rb = _t146._tl;
              f(x, y);
              const _t149 = ra;
              const _t150 = rb;
              a = _t149;
              b = _t150;
              continue;
              _t147 = undefined;
              break _t148;
            }
            _match_fail("line 259");
          }
          _t144 = _t147;
          break _t145;
        }
        _match_fail("line 259");
      }
      return _t144;
    }
  }
  const _t151 = go(xs, ys);
  return _t151;
}
function List$map2(f, xs, ys) {
  function go(acc, a, b) {
    while (true) {
      let _t153;
      const _t152 = a;
      _t154: {
        if (_t152 === null) {
          _t153 = List$rev(acc);
          break _t154;
        }
        if (_t152 !== null) {
          const x = _t152._hd;
          const ra = _t152._tl;
          let _t156;
          const _t155 = b;
          _t157: {
            if (_t155 !== null) {
              const y = _t155._hd;
              const rb = _t155._tl;
              const _t158 = ({_hd: f(x, y), _tl: acc});
              const _t159 = ra;
              const _t160 = rb;
              acc = _t158;
              a = _t159;
              b = _t160;
              continue;
              _t156 = undefined;
              break _t157;
            }
            _match_fail("line 259");
          }
          _t153 = _t156;
          break _t154;
        }
        _match_fail("line 259");
      }
      return _t153;
    }
  }
  const _t161 = go(null, xs, ys);
  return _t161;
}
function List$fold2(f, acc, xs, ys) {
  function go(a, l1, l2) {
    while (true) {
      let _t163;
      const _t162 = l1;
      _t164: {
        if (_t162 === null) {
          _t163 = a;
          break _t164;
        }
        if (_t162 !== null) {
          const x = _t162._hd;
          const r1 = _t162._tl;
          let _t166;
          const _t165 = l2;
          _t167: {
            if (_t165 !== null) {
              const y = _t165._hd;
              const r2 = _t165._tl;
              const _t168 = f(a, x, y);
              const _t169 = r1;
              const _t170 = r2;
              a = _t168;
              l1 = _t169;
              l2 = _t170;
              continue;
              _t166 = undefined;
              break _t167;
            }
            _match_fail("line 259");
          }
          _t163 = _t166;
          break _t164;
        }
        _match_fail("line 259");
      }
      return _t163;
    }
  }
  const _t171 = go(acc, xs, ys);
  return _t171;
}
function List$forall2(f, xs, ys) {
  function go(a, b) {
    while (true) {
      let _t173;
      const _t172 = a;
      _t174: {
        if (_t172 === null) {
          _t173 = true;
          break _t174;
        }
        if (_t172 !== null) {
          const x = _t172._hd;
          const ra = _t172._tl;
          let _t176;
          const _t175 = b;
          _t177: {
            if (_t175 !== null) {
              const y = _t175._hd;
              const rb = _t175._tl;
              let _t178;
              if (f(x, y)) {
                const _t179 = ra;
                const _t180 = rb;
                a = _t179;
                b = _t180;
                continue;
                _t178 = undefined;
              } else {
                _t178 = false;
              }
              _t176 = _t178;
              break _t177;
            }
            _match_fail("line 259");
          }
          _t173 = _t176;
          break _t174;
        }
        _match_fail("line 259");
      }
      return _t173;
    }
  }
  const _t181 = go(xs, ys);
  return _t181;
}
function List$iteri(f, xs) {
  function go(i, l) {
    while (true) {
      let _t183;
      const _t182 = l;
      _t184: {
        if (_t182 === null) {
          _t183 = undefined;
          break _t184;
        }
        if (_t182 !== null) {
          const x = _t182._hd;
          const rest = _t182._tl;
          f(i, x);
          const _t185 = (i + 1);
          const _t186 = rest;
          i = _t185;
          l = _t186;
          continue;
          _t183 = undefined;
          break _t184;
        }
        _match_fail("line 259");
      }
      return _t183;
    }
  }
  const _t187 = go(0, xs);
  return _t187;
}
function List$mem_assoc(key, xs) {
  function go(l) {
    while (true) {
      let _t189;
      const _t188 = l;
      _t190: {
        if (_t188 === null) {
          _t189 = false;
          break _t190;
        }
        if (_t188 !== null) {
          const k = _t188._hd[0];
          const rest = _t188._tl;
          let _t191;
          if (_eq(k, key)) {
            _t191 = true;
          } else {
            const _t192 = rest;
            l = _t192;
            continue;
            _t191 = undefined;
          }
          _t189 = _t191;
          break _t190;
        }
        _match_fail("line 259");
      }
      return _t189;
    }
  }
  const _t193 = go(xs);
  return _t193;
}
function List$assoc(key, xs) {
  let _t195;
  const _t194 = List$assoc_opt(key, xs);
  _t196: {
    if (_t194._tag === 1) {
      const v = _t194._val;
      _t195 = v;
      break _t196;
    }
    if (_t194._tag === 0) {
      _t195 = failwith("List.assoc: not found");
      break _t196;
    }
    _match_fail("line 259");
  }
  return _t195;
}
function List$iter(f, xs) {
  function go(xs) {
    while (true) {
      let _t198;
      const _t197 = xs;
      _t199: {
        if (_t197 === null) {
          _t198 = undefined;
          break _t199;
        }
        if (_t197 !== null) {
          const x = _t197._hd;
          const rest = _t197._tl;
          f(x);
          const _t200 = rest;
          xs = _t200;
          continue;
          _t198 = undefined;
          break _t199;
        }
        _match_fail("line 259");
      }
      return _t198;
    }
  }
  const _t201 = go(xs);
  return _t201;
}
function List$mem(x, xs) {
  function go(xs) {
    while (true) {
      let _t203;
      const _t202 = xs;
      _t204: {
        if (_t202 === null) {
          _t203 = false;
          break _t204;
        }
        if (_t202 !== null) {
          const y = _t202._hd;
          const rest = _t202._tl;
          let _t205;
          if (_eq(x, y)) {
            _t205 = true;
          } else {
            const _t206 = rest;
            xs = _t206;
            continue;
            _t205 = undefined;
          }
          _t203 = _t205;
          break _t204;
        }
        _match_fail("line 259");
      }
      return _t203;
    }
  }
  const _t207 = go(xs);
  return _t207;
}
function List$rev_append(xs, ys) {
  function go(xs, acc) {
    while (true) {
      let _t209;
      const _t208 = xs;
      _t210: {
        if (_t208 === null) {
          _t209 = acc;
          break _t210;
        }
        if (_t208 !== null) {
          const x = _t208._hd;
          const rest = _t208._tl;
          const _t211 = rest;
          const _t212 = ({_hd: x, _tl: acc});
          xs = _t211;
          acc = _t212;
          continue;
          _t209 = undefined;
          break _t210;
        }
        _match_fail("line 259");
      }
      return _t209;
    }
  }
  const _t213 = go(xs, ys);
  return _t213;
}
function List$nth_opt(xs, n) {
  function go(xs, i) {
    while (true) {
      let _t215;
      const _t214 = xs;
      _t216: {
        if (_t214 === null) {
          _t215 = ({_tag: 0, _name: "None"});
          break _t216;
        }
        if (_t214 !== null) {
          const x = _t214._hd;
          const rest = _t214._tl;
          let _t217;
          if ((i === 0)) {
            _t217 = ({_tag: 1, _name: "Some", _val: x});
          } else {
            const _t218 = rest;
            const _t219 = (i - 1);
            xs = _t218;
            i = _t219;
            continue;
            _t217 = undefined;
          }
          _t215 = _t217;
          break _t216;
        }
        _match_fail("line 259");
      }
      return _t215;
    }
  }
  const _t220 = go(xs, n);
  return _t220;
}
function List$find_index(f, xs) {
  function go(xs, i) {
    while (true) {
      let _t222;
      const _t221 = xs;
      _t223: {
        if (_t221 === null) {
          _t222 = ({_tag: 0, _name: "None"});
          break _t223;
        }
        if (_t221 !== null) {
          const x = _t221._hd;
          const rest = _t221._tl;
          let _t224;
          if (f(x)) {
            _t224 = ({_tag: 1, _name: "Some", _val: i});
          } else {
            const _t225 = rest;
            const _t226 = (i + 1);
            xs = _t225;
            i = _t226;
            continue;
            _t224 = undefined;
          }
          _t222 = _t224;
          break _t223;
        }
        _match_fail("line 259");
      }
      return _t222;
    }
  }
  const _t227 = go(xs, 0);
  return _t227;
}
function List$filteri(f, xs) {
  function go(xs, i, acc) {
    while (true) {
      let _t229;
      const _t228 = xs;
      _t230: {
        if (_t228 === null) {
          _t229 = List$rev(acc);
          break _t230;
        }
        if (_t228 !== null) {
          const x = _t228._hd;
          const rest = _t228._tl;
          let _t231;
          if (f(i, x)) {
            const _t232 = rest;
            const _t233 = (i + 1);
            const _t234 = ({_hd: x, _tl: acc});
            xs = _t232;
            i = _t233;
            acc = _t234;
            continue;
            _t231 = undefined;
          } else {
            const _t235 = rest;
            const _t236 = (i + 1);
            const _t237 = acc;
            xs = _t235;
            i = _t236;
            acc = _t237;
            continue;
            _t231 = undefined;
          }
          _t229 = _t231;
          break _t230;
        }
        _match_fail("line 259");
      }
      return _t229;
    }
  }
  const _t238 = go(xs, 0, null);
  return _t238;
}
function List$filter_map(f, xs) {
  function go(xs, acc) {
    while (true) {
      let _t240;
      const _t239 = xs;
      _t241: {
        if (_t239 === null) {
          _t240 = List$rev(acc);
          break _t241;
        }
        if (_t239 !== null) {
          const x = _t239._hd;
          const rest = _t239._tl;
          let _t243;
          const _t242 = f(x);
          _t244: {
            if (_t242._tag === 1) {
              const y = _t242._val;
              const _t245 = rest;
              const _t246 = ({_hd: y, _tl: acc});
              xs = _t245;
              acc = _t246;
              continue;
              _t243 = undefined;
              break _t244;
            }
            if (_t242._tag === 0) {
              const _t247 = rest;
              const _t248 = acc;
              xs = _t247;
              acc = _t248;
              continue;
              _t243 = undefined;
              break _t244;
            }
            _match_fail("line 259");
          }
          _t240 = _t243;
          break _t241;
        }
        _match_fail("line 259");
      }
      return _t240;
    }
  }
  const _t249 = go(xs, null);
  return _t249;
}
function List$sort_uniq(cmp, xs) {
  const sorted_250 = List$sort(cmp, xs);
  function dedup(xs) {
    while (true) {
      let _t253;
      const _t252 = xs;
      _t254: {
        if (_t252 === null) {
          _t253 = null;
          break _t254;
        }
        if (_t252 !== null && _t252._tl === null) {
          const x = _t252._hd;
          _t253 = ({_hd: x, _tl: null});
          break _t254;
        }
        if (_t252 !== null && _t252._tl !== null) {
          const x = _t252._hd;
          const y = _t252._tl._hd;
          const rest = _t252._tl._tl;
          let _t255;
          if ((cmp(x, y) === 0)) {
            const _t256 = ({_hd: y, _tl: rest});
            xs = _t256;
            continue;
            _t255 = undefined;
          } else {
            _t255 = ({_hd: x, _tl: dedup(({_hd: y, _tl: rest}))});
          }
          _t253 = _t255;
          break _t254;
        }
        _match_fail("line 259");
      }
      return _t253;
    }
  }
  const _t257 = dedup(sorted_250);
  const _t251 = _t257;
  return _t251;
}
if (typeof Array$make === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.make"]) var Array$make = globalThis._mmlExterns["Array.make"]; else throw new Error("extern " + "Array.make" + " not provided"); }
if (typeof Array$get === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.get"]) var Array$get = globalThis._mmlExterns["Array.get"]; else throw new Error("extern " + "Array.get" + " not provided"); }
if (typeof Array$set === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.set"]) var Array$set = globalThis._mmlExterns["Array.set"]; else throw new Error("extern " + "Array.set" + " not provided"); }
if (typeof Array$length === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.length"]) var Array$length = globalThis._mmlExterns["Array.length"]; else throw new Error("extern " + "Array.length" + " not provided"); }
if (typeof Array$to_list === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.to_list"]) var Array$to_list = globalThis._mmlExterns["Array.to_list"]; else throw new Error("extern " + "Array.to_list" + " not provided"); }
if (typeof Array$of_list === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.of_list"]) var Array$of_list = globalThis._mmlExterns["Array.of_list"]; else throw new Error("extern " + "Array.of_list" + " not provided"); }
if (typeof Array$copy === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.copy"]) var Array$copy = globalThis._mmlExterns["Array.copy"]; else throw new Error("extern " + "Array.copy" + " not provided"); }
if (typeof Array$sub === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.sub"]) var Array$sub = globalThis._mmlExterns["Array.sub"]; else throw new Error("extern " + "Array.sub" + " not provided"); }
function Array$init(n, f) {
  let _t258;
  if ((n <= 0)) {
    _t258 = {_arr: []};
  } else {
    const arr_259 = Array$make(n, f(0));
    function go(i) {
      while (true) {
        let _t261;
        if ((i >= n)) {
          _t261 = arr_259;
        } else {
          Array$set(arr_259, i, f(i));
          const _t262 = (i + 1);
          i = _t262;
          continue;
          _t261 = undefined;
        }
        return _t261;
      }
    }
    const _t263 = go(1);
    const _t260 = _t263;
    _t258 = _t260;
  }
  return _t258;
}
function Array$map(f, arr) {
  const n_264 = Array$length(arr);
  let _t266;
  if ((n_264 === 0)) {
    _t266 = {_arr: []};
  } else {
    const result_267 = Array$make(n_264, f(Array$get(arr, 0)));
    function go(i) {
      while (true) {
        let _t269;
        if ((i >= n_264)) {
          _t269 = result_267;
        } else {
          Array$set(result_267, i, f(Array$get(arr, i)));
          const _t270 = (i + 1);
          i = _t270;
          continue;
          _t269 = undefined;
        }
        return _t269;
      }
    }
    const _t271 = go(1);
    const _t268 = _t271;
    _t266 = _t268;
  }
  const _t265 = _t266;
  return _t265;
}
function Array$iter(f, arr) {
  const n_272 = Array$length(arr);
  function go(i) {
    while (true) {
      let _t274;
      if ((i >= n_272)) {
        _t274 = undefined;
      } else {
        f(Array$get(arr, i));
        const _t275 = (i + 1);
        i = _t275;
        continue;
        _t274 = undefined;
      }
      return _t274;
    }
  }
  const _t276 = go(0);
  const _t273 = _t276;
  return _t273;
}
function Array$iteri(f, arr) {
  const n_277 = Array$length(arr);
  function go(i) {
    while (true) {
      let _t279;
      if ((i >= n_277)) {
        _t279 = undefined;
      } else {
        f(i, Array$get(arr, i));
        const _t280 = (i + 1);
        i = _t280;
        continue;
        _t279 = undefined;
      }
      return _t279;
    }
  }
  const _t281 = go(0);
  const _t278 = _t281;
  return _t278;
}
function Array$forall(f, arr) {
  const n_282 = Array$length(arr);
  function go(i) {
    while (true) {
      let _t284;
      if ((i >= n_282)) {
        _t284 = true;
      } else {
        let _t285;
        if (f(Array$get(arr, i))) {
          const _t286 = (i + 1);
          i = _t286;
          continue;
          _t285 = undefined;
        } else {
          _t285 = false;
        }
        _t284 = _t285;
      }
      return _t284;
    }
  }
  const _t287 = go(0);
  const _t283 = _t287;
  return _t283;
}
function Array$fold(f, acc, arr) {
  const n_288 = Array$length(arr);
  function go(i, a) {
    while (true) {
      let _t290;
      if ((i >= n_288)) {
        _t290 = a;
      } else {
        const _t291 = (i + 1);
        const _t292 = f(a, Array$get(arr, i));
        i = _t291;
        a = _t292;
        continue;
        _t290 = undefined;
      }
      return _t290;
    }
  }
  const _t293 = go(0, acc);
  const _t289 = _t293;
  return _t289;
}
if (typeof IO$read_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.read_file"]) var IO$read_file = globalThis._mmlExterns["IO.read_file"]; else throw new Error("extern " + "IO.read_file" + " not provided"); }
if (typeof IO$write_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.write_file"]) var IO$write_file = globalThis._mmlExterns["IO.write_file"]; else throw new Error("extern " + "IO.write_file" + " not provided"); }
if (typeof IO$append_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.append_file"]) var IO$append_file = globalThis._mmlExterns["IO.append_file"]; else throw new Error("extern " + "IO.append_file" + " not provided"); }
if (typeof IO$read_line === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.read_line"]) var IO$read_line = globalThis._mmlExterns["IO.read_line"]; else throw new Error("extern " + "IO.read_line" + " not provided"); }
if (typeof IO$file_exists === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.file_exists"]) var IO$file_exists = globalThis._mmlExterns["IO.file_exists"]; else throw new Error("extern " + "IO.file_exists" + " not provided"); }
if (typeof Sys$args === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.args"]) var Sys$args = globalThis._mmlExterns["Sys.args"]; else throw new Error("extern " + "Sys.args" + " not provided"); }
if (typeof Sys$getenv === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.getenv"]) var Sys$getenv = globalThis._mmlExterns["Sys.getenv"]; else throw new Error("extern " + "Sys.getenv" + " not provided"); }
if (typeof Sys$exit === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.exit"]) var Sys$exit = globalThis._mmlExterns["Sys.exit"]; else throw new Error("extern " + "Sys.exit" + " not provided"); }
if (typeof Sys$time === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.time"]) var Sys$time = globalThis._mmlExterns["Sys.time"]; else throw new Error("extern " + "Sys.time" + " not provided"); }
function Math$abs(x) {
  let _t294;
  if ((x < 0)) {
    _t294 = (0 - x);
  } else {
    _t294 = x;
  }
  return _t294;
}
function Math$min(a, b) {
  let _t295;
  if ((a < b)) {
    _t295 = a;
  } else {
    _t295 = b;
  }
  return _t295;
}
function Math$max(a, b) {
  let _t296;
  if ((a > b)) {
    _t296 = a;
  } else {
    _t296 = b;
  }
  return _t296;
}
function Math$pow(a, b) {
  return __math_pow(a, b);
}
function Math$sqrt(x) {
  return __math_sqrt(x);
}
function Math$floor(x) {
  return __math_floor(x);
}
function Math$ceil(x) {
  return __math_ceil(x);
}
function Math$round(x) {
  return __math_round(x);
}
function Result$map(f, r) {
  let _t298;
  const _t297 = r;
  _t299: {
    if (_t297._tag === 0) {
      const v = _t297._val;
      _t298 = ({_tag: 0, _name: "Ok", _val: f(v)});
      break _t299;
    }
    if (_t297._tag === 1) {
      const e = _t297._val;
      _t298 = ({_tag: 1, _name: "Err", _val: e});
      break _t299;
    }
    _match_fail("line 14");
  }
  return _t298;
}
function Result$bind(f, r) {
  let _t301;
  const _t300 = r;
  _t302: {
    if (_t300._tag === 0) {
      const v = _t300._val;
      _t301 = f(v);
      break _t302;
    }
    if (_t300._tag === 1) {
      const e = _t300._val;
      _t301 = ({_tag: 1, _name: "Err", _val: e});
      break _t302;
    }
    _match_fail("line 14");
  }
  return _t301;
}
function Result$unwrap(r) {
  let _t304;
  const _t303 = r;
  _t305: {
    if (_t303._tag === 0) {
      const v = _t303._val;
      _t304 = v;
      break _t305;
    }
    _match_fail("line 14");
  }
  return _t304;
}
function Byte$to_int(b) {
  return __byte_to_int(b);
}
function Byte$of_int(n) {
  return __byte_of_int(n);
}
function Byte$to_string(b) {
  return __byte_to_string(b);
}
function Byte$is_alpha(b) {
  const n_306 = Byte$to_int(b);
  const _t307 = (((n_306 >= 65) && (n_306 <= 90)) || ((n_306 >= 97) && (n_306 <= 122)));
  return _t307;
}
function Byte$is_digit(b) {
  const n_308 = Byte$to_int(b);
  const _t309 = ((n_308 >= 48) && (n_308 <= 57));
  return _t309;
}
function Byte$is_space(b) {
  const n_310 = Byte$to_int(b);
  const _t311 = ((((n_310 === 32) || (n_310 === 9)) || (n_310 === 10)) || (n_310 === 13));
  return _t311;
}
function Byte$is_upper(b) {
  const n_312 = Byte$to_int(b);
  const _t313 = ((n_312 >= 65) && (n_312 <= 90));
  return _t313;
}
function Byte$is_lower(b) {
  const n_314 = Byte$to_int(b);
  const _t315 = ((n_314 >= 97) && (n_314 <= 122));
  return _t315;
}
function Byte$to_upper(b) {
  const n_316 = Byte$to_int(b);
  let _t318;
  if (((n_316 >= 97) && (n_316 <= 122))) {
    _t318 = Byte$of_int((n_316 - 32));
  } else {
    _t318 = b;
  }
  const _t317 = _t318;
  return _t317;
}
function Byte$to_lower(b) {
  const n_319 = Byte$to_int(b);
  let _t321;
  if (((n_319 >= 65) && (n_319 <= 90))) {
    _t321 = Byte$of_int((n_319 + 32));
  } else {
    _t321 = b;
  }
  const _t320 = _t321;
  return _t320;
}
function Rune$to_int(r) {
  return __rune_to_int(r);
}
function Rune$of_int(n) {
  return __rune_of_int(n);
}
function Rune$to_string(r) {
  return __rune_to_string(r);
}
function Rune$is_alpha(r) {
  const n_322 = Rune$to_int(r);
  const _t323 = (((n_322 >= 65) && (n_322 <= 90)) || ((n_322 >= 97) && (n_322 <= 122)));
  return _t323;
}
function Rune$is_digit(r) {
  const n_324 = Rune$to_int(r);
  const _t325 = ((n_324 >= 48) && (n_324 <= 57));
  return _t325;
}
function Rune$is_space(r) {
  const n_326 = Rune$to_int(r);
  const _t327 = ((((n_326 === 32) || (n_326 === 9)) || (n_326 === 10)) || (n_326 === 13));
  return _t327;
}
function Rune$is_upper(r) {
  const n_328 = Rune$to_int(r);
  const _t329 = ((n_328 >= 65) && (n_328 <= 90));
  return _t329;
}
function Rune$is_lower(r) {
  const n_330 = Rune$to_int(r);
  const _t331 = ((n_330 >= 97) && (n_330 <= 122));
  return _t331;
}
function Map$empty(_) {
  return null;
}
function Map$has(k, __p1) {
  while (true) {
    let _t333;
    const _t332 = __p1;
    _t334: {
      if (true) {
        const m = _t332;
        let _t336;
        const _t335 = m;
        _t337: {
          if (_t335 === null) {
            _t336 = false;
            break _t337;
          }
          if (_t335 !== null) {
            const k2 = _t335._hd[0];
            const rest = _t335._tl;
            let _t338;
            if (_eq(k, k2)) {
              _t338 = true;
            } else {
              const _t339 = k;
              const _t340 = rest;
              k = _t339;
              __p1 = _t340;
              continue;
              _t338 = undefined;
            }
            _t336 = _t338;
            break _t337;
          }
          _match_fail("line 76");
        }
        _t333 = _t336;
        break _t334;
      }
      _match_fail("line 76");
    }
    return _t333;
  }
}
function Map$get(k, __p2) {
  while (true) {
    let _t342;
    const _t341 = __p2;
    _t343: {
      if (true) {
        const m = _t341;
        let _t345;
        const _t344 = m;
        _t346: {
          if (_t344 === null) {
            _t345 = ({_tag: 0, _name: "None"});
            break _t346;
          }
          if (_t344 !== null) {
            const k2 = _t344._hd[0];
            const v = _t344._hd[1];
            const rest = _t344._tl;
            let _t347;
            if (_eq(k, k2)) {
              _t347 = ({_tag: 1, _name: "Some", _val: v});
            } else {
              const _t348 = k;
              const _t349 = rest;
              k = _t348;
              __p2 = _t349;
              continue;
              _t347 = undefined;
            }
            _t345 = _t347;
            break _t346;
          }
          _match_fail("line 76");
        }
        _t342 = _t345;
        break _t343;
      }
      _match_fail("line 76");
    }
    return _t342;
  }
}
function Map$set(k, v, __p3) {
  let _t351;
  const _t350 = __p3;
  _t352: {
    if (true) {
      const m = _t350;
      function go(acc, lst) {
        while (true) {
          let _t354;
          const _t353 = lst;
          _t355: {
            if (_t353 === null) {
              _t354 = List$rev(({_hd: [k, v], _tl: acc}));
              break _t355;
            }
            if (_t353 !== null) {
              const k2 = _t353._hd[0];
              const rest = _t353._tl;
              if (_eq(k, k2)) {
                _t354 = List$rev_append(({_hd: [k, v], _tl: acc}), rest);
                break _t355;
              }
            }
            if (_t353 !== null) {
              const entry = _t353._hd;
              const rest = _t353._tl;
              const _t356 = ({_hd: entry, _tl: acc});
              const _t357 = rest;
              acc = _t356;
              lst = _t357;
              continue;
              _t354 = undefined;
              break _t355;
            }
            _match_fail("line 76");
          }
          return _t354;
        }
      }
      const _t358 = go(null, m);
      _t351 = _t358;
      break _t352;
    }
    _match_fail("line 76");
  }
  return _t351;
}
function Map$remove(k, __p4) {
  let _t360;
  const _t359 = __p4;
  _t361: {
    if (true) {
      const m = _t359;
      let _t363;
      const _t362 = m;
      _t364: {
        if (_t362 === null) {
          _t363 = null;
          break _t364;
        }
        if (_t362 !== null) {
          const k2 = _t362._hd[0];
          const rest = _t362._tl;
          if (_eq(k, k2)) {
            _t363 = rest;
            break _t364;
          }
        }
        if (_t362 !== null) {
          const entry = _t362._hd;
          const rest = _t362._tl;
          let _t366;
          const _t365 = Map$remove(k, rest);
          _t367: {
            if (true) {
              const r = _t365;
              _t366 = ({_hd: entry, _tl: r});
              break _t367;
            }
            _match_fail("line 76");
          }
          _t363 = _t366;
          break _t364;
        }
        _match_fail("line 76");
      }
      _t360 = _t363;
      break _t361;
    }
    _match_fail("line 76");
  }
  return _t360;
}
function Map$size(__p5) {
  let _t369;
  const _t368 = __p5;
  _t370: {
    if (true) {
      const m = _t368;
      _t369 = List$length(m);
      break _t370;
    }
    _match_fail("line 76");
  }
  return _t369;
}
function Map$keys(__p6) {
  let _t372;
  const _t371 = __p6;
  _t373: {
    if (true) {
      const m = _t371;
      let _t375;
      const _t374 = m;
      _t376: {
        if (_t374 === null) {
          _t375 = null;
          break _t376;
        }
        if (_t374 !== null) {
          const k = _t374._hd[0];
          const rest = _t374._tl;
          _t375 = ({_hd: k, _tl: Map$keys(rest)});
          break _t376;
        }
        _match_fail("line 76");
      }
      _t372 = _t375;
      break _t373;
    }
    _match_fail("line 76");
  }
  return _t372;
}
function Map$values(__p7) {
  let _t378;
  const _t377 = __p7;
  _t379: {
    if (true) {
      const m = _t377;
      let _t381;
      const _t380 = m;
      _t382: {
        if (_t380 === null) {
          _t381 = null;
          break _t382;
        }
        if (_t380 !== null) {
          const v = _t380._hd[1];
          const rest = _t380._tl;
          _t381 = ({_hd: v, _tl: Map$values(rest)});
          break _t382;
        }
        _match_fail("line 76");
      }
      _t378 = _t381;
      break _t379;
    }
    _match_fail("line 76");
  }
  return _t378;
}
function Map$to_list(__p8) {
  let _t384;
  const _t383 = __p8;
  _t385: {
    if (true) {
      const m = _t383;
      _t384 = m;
      break _t385;
    }
    _match_fail("line 76");
  }
  return _t384;
}
function Map$of_list(pairs) {
  function _t386(acc, p) {
    let _t388;
    const _t387 = p;
    _t389: {
      if (true) {
        const k = _t387[0];
        const v = _t387[1];
        _t388 = Map$set(k, v, acc);
        break _t389;
      }
      _match_fail("line 76");
    }
    return _t388;
  }
  return List$fold(_t386, null, pairs);
}
const __dict_Map_g0_g1_map__g0__g1 = ({get: Map$get, has: Map$has, keys: Map$keys, of_list: Map$of_list, remove: Map$remove, set: Map$set, size: Map$size, to_list: Map$to_list, values: Map$values});
function _t390(f, acc, __p9) {
  let _t392;
  const _t391 = __p9;
  _t393: {
    if (true) {
      const m = _t391;
      function go(a, l) {
        while (true) {
          let _t395;
          const _t394 = l;
          _t396: {
            if (_t394 === null) {
              _t395 = a;
              break _t396;
            }
            if (_t394 !== null) {
              const x = _t394._hd;
              const rest = _t394._tl;
              const _t397 = f(a, x);
              const _t398 = rest;
              a = _t397;
              l = _t398;
              continue;
              _t395 = undefined;
              break _t396;
            }
            _match_fail("line 76");
          }
          return _t395;
        }
      }
      const _t399 = go(acc, m);
      _t392 = _t399;
      break _t393;
    }
    _match_fail("line 76");
  }
  return _t392;
}
const __dict_Iter_g0_g1_map__g0_g1_tup = ({fold: _t390});
function __dict_Show_g0_g1_map(__dict_Show_0, __dict_Show_1) {
  function _t400(__p10) {
    let _t402;
    const _t401 = __p10;
    _t403: {
      if (true) {
        const m = _t401;
        let _t405;
        const _t404 = m;
        _t406: {
          if (_t404 === null) {
            _t405 = "#{}";
            break _t406;
          }
          if (true) {
            function _t407(acc, kv) {
              let _t409;
              const _t408 = kv;
              _t410: {
                if (true) {
                  const k = _t408[0];
                  const v = _t408[1];
                  const entry_411 = ((__dict_Show_0.show(k) + ": ") + __dict_Show_1.show(v));
                  let _t413;
                  if ((acc === "")) {
                    _t413 = entry_411;
                  } else {
                    _t413 = ((acc + "; ") + entry_411);
                  }
                  const _t412 = _t413;
                  _t409 = _t412;
                  break _t410;
                }
                _match_fail("line 76");
              }
              return _t409;
            }
            const inner_414 = List$fold(_t407, "", m);
            const _t415 = (("#{" + inner_414) + "}");
            _t405 = _t415;
            break _t406;
          }
          _match_fail("line 76");
        }
        _t402 = _t405;
        break _t403;
      }
      _match_fail("line 76");
    }
    return _t402;
  }
  return ({show: _t400});
}
function _t416(k, m) {
  let _t418;
  const _t417 = Map$get(k, m);
  _t419: {
    if (_t417._tag === 1) {
      const v = _t417._val;
      _t418 = v;
      break _t419;
    }
    if (_t417._tag === 0) {
      _t418 = failwith("key not found in map");
      break _t419;
    }
    _match_fail("line 76");
  }
  return _t418;
}
const __dict_Index_g0_g1_map__g0__g1 = ({at: _t416});
function Set$empty(_) {
  return Map$empty(undefined);
}
function Set$singleton(x) {
  return Map$set(x, undefined, Map$empty(undefined));
}
function Set$of_list(xs) {
  function _t420(acc, x) {
    return Map$set(x, undefined, acc);
  }
  return List$fold(_t420, Map$empty(undefined), xs);
}
function Set$add(elem, __p11) {
  let _t422;
  const _t421 = __p11;
  _t423: {
    if (true) {
      const s = _t421;
      _t422 = Map$set(elem, undefined, s);
      break _t423;
    }
    _match_fail("line 55");
  }
  return _t422;
}
function Set$remove(elem, __p12) {
  let _t425;
  const _t424 = __p12;
  _t426: {
    if (true) {
      const s = _t424;
      _t425 = Map$remove(elem, s);
      break _t426;
    }
    _match_fail("line 55");
  }
  return _t425;
}
function Set$mem(elem, __p13) {
  let _t428;
  const _t427 = __p13;
  _t429: {
    if (true) {
      const s = _t427;
      _t428 = Map$has(elem, s);
      break _t429;
    }
    _match_fail("line 55");
  }
  return _t428;
}
function Set$size(__p14) {
  let _t431;
  const _t430 = __p14;
  _t432: {
    if (true) {
      const s = _t430;
      _t431 = Map$size(s);
      break _t432;
    }
    _match_fail("line 55");
  }
  return _t431;
}
function Set$to_list(__p15) {
  let _t434;
  const _t433 = __p15;
  _t435: {
    if (true) {
      const s = _t433;
      _t434 = Map$keys(s);
      break _t435;
    }
    _match_fail("line 55");
  }
  return _t434;
}
function Set$union(__p16, __p17) {
  let _t437;
  const _t436 = __p17;
  _t438: {
    if (true) {
      const s2 = _t436;
      let _t440;
      const _t439 = __p16;
      _t441: {
        if (true) {
          const s1 = _t439;
          function _t442(acc, x) {
            return Map$set(x, undefined, acc);
          }
          _t440 = List$fold(_t442, s2, Map$keys(s1));
          break _t441;
        }
        _match_fail("line 55");
      }
      _t437 = _t440;
      break _t438;
    }
    _match_fail("line 55");
  }
  return _t437;
}
function Set$inter(__p18, __p19) {
  let _t444;
  const _t443 = __p19;
  _t445: {
    if (true) {
      const s2 = _t443;
      let _t447;
      const _t446 = __p18;
      _t448: {
        if (true) {
          const s1 = _t446;
          function _t449(acc, x) {
            let _t450;
            if (Map$has(x, s2)) {
              _t450 = Map$set(x, undefined, acc);
            } else {
              _t450 = acc;
            }
            return _t450;
          }
          _t447 = List$fold(_t449, Map$empty(undefined), Map$keys(s1));
          break _t448;
        }
        _match_fail("line 55");
      }
      _t444 = _t447;
      break _t445;
    }
    _match_fail("line 55");
  }
  return _t444;
}
function Set$diff(__p20, __p21) {
  let _t452;
  const _t451 = __p21;
  _t453: {
    if (true) {
      const s2 = _t451;
      let _t455;
      const _t454 = __p20;
      _t456: {
        if (true) {
          const s1 = _t454;
          function _t457(acc, x) {
            let _t458;
            if ((!Map$has(x, s2))) {
              _t458 = Map$set(x, undefined, acc);
            } else {
              _t458 = acc;
            }
            return _t458;
          }
          _t455 = List$fold(_t457, Map$empty(undefined), Map$keys(s1));
          break _t456;
        }
        _match_fail("line 55");
      }
      _t452 = _t455;
      break _t453;
    }
    _match_fail("line 55");
  }
  return _t452;
}
function Set$is_empty(__p22) {
  let _t460;
  const _t459 = __p22;
  _t461: {
    if (true) {
      const s = _t459;
      _t460 = (Map$size(s) === 0);
      break _t461;
    }
    _match_fail("line 55");
  }
  return _t460;
}
function Set$is_subset(__p23, __p24) {
  let _t463;
  const _t462 = __p24;
  _t464: {
    if (true) {
      const s2 = _t462;
      let _t466;
      const _t465 = __p23;
      _t467: {
        if (true) {
          const s1 = _t465;
          function _t468(x) {
            return Map$has(x, s2);
          }
          _t466 = List$forall(_t468, Map$keys(s1));
          break _t467;
        }
        _match_fail("line 55");
      }
      _t463 = _t466;
      break _t464;
    }
    _match_fail("line 55");
  }
  return _t463;
}
function _t469(f, acc, __p25) {
  let _t471;
  const _t470 = __p25;
  _t472: {
    if (true) {
      const s = _t470;
      function go(a, l) {
        while (true) {
          let _t474;
          const _t473 = l;
          _t475: {
            if (_t473 === null) {
              _t474 = a;
              break _t475;
            }
            if (_t473 !== null) {
              const x = _t473._hd;
              const rest = _t473._tl;
              const _t476 = f(a, x);
              const _t477 = rest;
              a = _t476;
              l = _t477;
              continue;
              _t474 = undefined;
              break _t475;
            }
            _match_fail("line 55");
          }
          return _t474;
        }
      }
      const _t478 = go(acc, Map$keys(s));
      _t471 = _t478;
      break _t472;
    }
    _match_fail("line 55");
  }
  return _t471;
}
const __dict_Iter_g0_set__g0 = ({fold: _t469});
function __dict_Show_g0_set(__dict_Show_0) {
  function _t479(__p26) {
    let _t481;
    const _t480 = __p26;
    _t482: {
      if (true) {
        const s = _t480;
        let _t484;
        const _t483 = Map$keys(s);
        _t485: {
          if (_t483 === null) {
            _t484 = "#{}";
            break _t485;
          }
          if (true) {
            const ks = _t483;
            function _t486(acc, x) {
              let _t487;
              if ((acc === "")) {
                _t487 = __dict_Show_0.show(x);
              } else {
                _t487 = ((acc + "; ") + __dict_Show_0.show(x));
              }
              return _t487;
            }
            const inner_488 = List$fold(_t486, "", ks);
            const _t489 = (("#{" + inner_488) + "}");
            _t484 = _t489;
            break _t485;
          }
          _match_fail("line 55");
        }
        _t481 = _t484;
        break _t482;
      }
      _match_fail("line 55");
    }
    return _t481;
  }
  return ({show: _t479});
}
function Enum$reduce(f, xs) {
  let _t491;
  const _t490 = xs;
  _t492: {
    if (_t490 !== null) {
      const x = _t490._hd;
      const rest = _t490._tl;
      _t491 = List$fold(f, x, rest);
      break _t492;
    }
    _match_fail("line 118");
  }
  return _t491;
}
function Enum$sum(xs) {
  function _t493(a, b) {
    return (a + b);
  }
  return List$fold(_t493, 0, xs);
}
function Enum$count(f, xs) {
  function _t494(acc, x) {
    let _t495;
    if (f(x)) {
      _t495 = (acc + 1);
    } else {
      _t495 = acc;
    }
    return _t495;
  }
  return List$fold(_t494, 0, xs);
}
function Enum$take(n, xs) {
  function go(i, acc, l) {
    while (true) {
      let _t496;
      if ((i >= n)) {
        _t496 = List$rev(acc);
      } else {
        let _t498;
        const _t497 = l;
        _t499: {
          if (_t497 === null) {
            _t498 = List$rev(acc);
            break _t499;
          }
          if (_t497 !== null) {
            const x = _t497._hd;
            const rest = _t497._tl;
            const _t500 = (i + 1);
            const _t501 = ({_hd: x, _tl: acc});
            const _t502 = rest;
            i = _t500;
            acc = _t501;
            l = _t502;
            continue;
            _t498 = undefined;
            break _t499;
          }
          _match_fail("line 118");
        }
        _t496 = _t498;
      }
      return _t496;
    }
  }
  const _t503 = go(0, null, xs);
  return _t503;
}
function Enum$drop(n, xs) {
  function go(i, l) {
    while (true) {
      let _t504;
      if ((i >= n)) {
        _t504 = l;
      } else {
        let _t506;
        const _t505 = l;
        _t507: {
          if (_t505 === null) {
            _t506 = null;
            break _t507;
          }
          if (_t505 !== null) {
            const rest = _t505._tl;
            const _t508 = (i + 1);
            const _t509 = rest;
            i = _t508;
            l = _t509;
            continue;
            _t506 = undefined;
            break _t507;
          }
          _match_fail("line 118");
        }
        _t504 = _t506;
      }
      return _t504;
    }
  }
  const _t510 = go(0, xs);
  return _t510;
}
function Enum$take_while(f, xs) {
  function go(acc, l) {
    while (true) {
      let _t512;
      const _t511 = l;
      _t513: {
        if (_t511 === null) {
          _t512 = List$rev(acc);
          break _t513;
        }
        if (_t511 !== null) {
          const x = _t511._hd;
          const rest = _t511._tl;
          let _t514;
          if (f(x)) {
            const _t515 = ({_hd: x, _tl: acc});
            const _t516 = rest;
            acc = _t515;
            l = _t516;
            continue;
            _t514 = undefined;
          } else {
            _t514 = List$rev(acc);
          }
          _t512 = _t514;
          break _t513;
        }
        _match_fail("line 118");
      }
      return _t512;
    }
  }
  const _t517 = go(null, xs);
  return _t517;
}
function Enum$drop_while(f, xs) {
  function go(l) {
    while (true) {
      let _t519;
      const _t518 = l;
      _t520: {
        if (_t518 === null) {
          _t519 = null;
          break _t520;
        }
        if (_t518 !== null) {
          const x = _t518._hd;
          const rest = _t518._tl;
          let _t521;
          if (f(x)) {
            const _t522 = rest;
            l = _t522;
            continue;
            _t521 = undefined;
          } else {
            _t521 = l;
          }
          _t519 = _t521;
          break _t520;
        }
        _match_fail("line 118");
      }
      return _t519;
    }
  }
  const _t523 = go(xs);
  return _t523;
}
function Enum$flat_map(f, xs) {
  return List$flatten(List$map(f, xs));
}
function Enum$each(f, xs) {
  function _t524(_, x) {
    return f(x);
  }
  return List$fold(_t524, undefined, xs);
}
function Enum$reject(f, xs) {
  function _t525(x) {
    return (!f(x));
  }
  return List$filter(_t525, xs);
}
function Enum$enumerate(xs) {
  function _t526(i, x) {
    return [i, x];
  }
  return List$mapi(_t526, xs);
}
function Enum$join(sep, xs) {
  let _t528;
  const _t527 = xs;
  _t529: {
    if (_t527 === null) {
      _t528 = "";
      break _t529;
    }
    if (_t527 !== null) {
      const first = _t527._hd;
      const rest = _t527._tl;
      function _t530(acc, x) {
        return ((acc + sep) + x);
      }
      _t528 = List$fold(_t530, first, rest);
      break _t529;
    }
    _match_fail("line 118");
  }
  return _t528;
}
function Enum$chunk(n, xs) {
  function go(acc, l) {
    while (true) {
      let _t532;
      const _t531 = l;
      _t533: {
        if (_t531 === null) {
          _t532 = List$rev(acc);
          break _t533;
        }
        if (true) {
          const _t534 = ({_hd: Enum$take(n, l), _tl: acc});
          const _t535 = Enum$drop(n, l);
          acc = _t534;
          l = _t535;
          continue;
          _t532 = undefined;
          break _t533;
        }
        _match_fail("line 118");
      }
      return _t532;
    }
  }
  const _t536 = go(null, xs);
  return _t536;
}
function Enum$dedup(xs) {
  function go(prev, acc, l) {
    while (true) {
      let _t538;
      const _t537 = l;
      _t539: {
        if (_t537 === null) {
          _t538 = List$rev(acc);
          break _t539;
        }
        if (_t537 !== null) {
          const x = _t537._hd;
          const rest = _t537._tl;
          let _t540;
          if (_eq(x, prev)) {
            const _t541 = prev;
            const _t542 = acc;
            const _t543 = rest;
            prev = _t541;
            acc = _t542;
            l = _t543;
            continue;
            _t540 = undefined;
          } else {
            const _t544 = x;
            const _t545 = ({_hd: x, _tl: acc});
            const _t546 = rest;
            prev = _t544;
            acc = _t545;
            l = _t546;
            continue;
            _t540 = undefined;
          }
          _t538 = _t540;
          break _t539;
        }
        _match_fail("line 118");
      }
      return _t538;
    }
  }
  let _t549;
  const _t548 = xs;
  _t550: {
    if (_t548 === null) {
      _t549 = null;
      break _t550;
    }
    if (_t548 !== null) {
      const x = _t548._hd;
      const rest = _t548._tl;
      _t549 = go(x, ({_hd: x, _tl: null}), rest);
      break _t550;
    }
    _match_fail("line 118");
  }
  const _t547 = _t549;
  return _t547;
}
function Enum$uniq(xs) {
  function _t551(acc, x) {
    function _t552(y) {
      return _eq(y, x);
    }
    let _t553;
    if (List$exists(_t552, acc)) {
      _t553 = acc;
    } else {
      _t553 = ({_hd: x, _tl: acc});
    }
    return _t553;
  }
  return List$rev(List$fold(_t551, null, xs));
}
function Enum$scan(f, init, xs) {
  function _t554(acc, x) {
    let _t556;
    const _t555 = acc;
    _t557: {
      if (_t555 === null) {
        _t556 = ({_hd: f(init, x), _tl: null});
        break _t557;
      }
      if (_t555 !== null) {
        const prev = _t555._hd;
        _t556 = ({_hd: f(prev, x), _tl: acc});
        break _t557;
      }
      _match_fail("line 118");
    }
    return _t556;
  }
  return List$rev(List$fold(_t554, ({_hd: init, _tl: null}), xs));
}
function Enum$intersperse(sep, xs) {
  let _t559;
  const _t558 = xs;
  _t560: {
    if (_t558 === null) {
      _t559 = null;
      break _t560;
    }
    if (_t558 !== null) {
      const first = _t558._hd;
      const rest = _t558._tl;
      function _t561(acc, x) {
        return List$concat(acc, ({_hd: sep, _tl: ({_hd: x, _tl: null})}));
      }
      _t559 = List$fold(_t561, ({_hd: first, _tl: null}), rest);
      break _t560;
    }
    _match_fail("line 118");
  }
  return _t559;
}
function Enum$zip_with(f, xs, ys) {
  function _t562(p) {
    let _t564;
    const _t563 = p;
    _t565: {
      if (true) {
        const a = _t563[0];
        const b = _t563[1];
        _t564 = f(a, b);
        break _t565;
      }
      _match_fail("line 118");
    }
    return _t564;
  }
  return List$map(_t562, List$zip(xs, ys));
}
function Enum$min_by(f, xs) {
  let _t567;
  const _t566 = xs;
  _t568: {
    if (_t566 !== null) {
      const x = _t566._hd;
      const rest = _t566._tl;
      function _t569(best, y) {
        let _t570;
        if ((f(y) < f(best))) {
          _t570 = y;
        } else {
          _t570 = best;
        }
        return _t570;
      }
      _t567 = List$fold(_t569, x, rest);
      break _t568;
    }
    _match_fail("line 118");
  }
  return _t567;
}
function Enum$max_by(f, xs) {
  let _t572;
  const _t571 = xs;
  _t573: {
    if (_t571 !== null) {
      const x = _t571._hd;
      const rest = _t571._tl;
      function _t574(best, y) {
        let _t575;
        if ((f(y) > f(best))) {
          _t575 = y;
        } else {
          _t575 = best;
        }
        return _t575;
      }
      _t572 = List$fold(_t574, x, rest);
      break _t573;
    }
    _match_fail("line 118");
  }
  return _t572;
}
function Enum$group_by(__dict_Map_0, __dict_Map_0_2, f, xs) {
  function _t576(m, x) {
    const k_577 = f(x);
    let _t580;
    const _t579 = __dict_Map_0_2.get(k_577, m);
    _t581: {
      if (_t579._tag === 0) {
        _t580 = __dict_Map_0_2.set(k_577, ({_hd: x, _tl: null}), m);
        break _t581;
      }
      if (_t579._tag === 1) {
        const vs = _t579._val;
        _t580 = __dict_Map_0_2.set(k_577, List$concat(vs, ({_hd: x, _tl: null})), m);
        break _t581;
      }
      _match_fail("line 118");
    }
    const _t578 = _t580;
    return _t578;
  }
  return List$fold(_t576, Map$of_list(null), xs);
}
function Seq$range(start, stop, _mml$yield) {
  function go(i) {
    while (true) {
      let _t582;
      if ((i >= stop)) {
        _t582 = undefined;
      } else {
        _mml$yield(i);
        const _t583 = (i + 1);
        i = _t583;
        continue;
        _t582 = undefined;
      }
      return _t582;
    }
  }
  const _t584 = go(start);
  return _t584;
}
function Seq$of_list(xs, _mml$yield) {
  function go(l) {
    while (true) {
      let _t586;
      const _t585 = l;
      _t587: {
        if (_t585 === null) {
          _t586 = undefined;
          break _t587;
        }
        if (_t585 !== null) {
          const x = _t585._hd;
          const rest = _t585._tl;
          _mml$yield(x);
          const _t588 = rest;
          l = _t588;
          continue;
          _t586 = undefined;
          break _t587;
        }
        _match_fail("line 134");
      }
      return _t586;
    }
  }
  const _t589 = go(xs);
  return _t589;
}
function Seq$repeat(x, _mml$yield) {
  function go(u) {
    while (true) {
      _mml$yield(x);
      const _t590 = u;
      u = _t590;
      continue;
      return undefined;
    }
  }
  const _t591 = go(0);
  return _t591;
}
function Seq$iterate(seed, step, _mml$yield) {
  function go(x) {
    while (true) {
      _mml$yield(x);
      const _t592 = step(x);
      x = _t592;
      continue;
      return undefined;
    }
  }
  const _t593 = go(seed);
  return _t593;
}
function Seq$map(f, s, _mml$yield) {
  function _t594(x) {
    return _mml$yield(f(x));
  }
  return s(_t594);
}
function Seq$filter(f, s, _mml$yield) {
  function _t595(x) {
    let _t596;
    if (f(x)) {
      _t596 = _mml$yield(x);
    } else {
      _t596 = undefined;
    }
    return _t596;
  }
  return s(_t595);
}
function Seq$take(n, s, _mml$yield) {
  return _trampoline(function() {
    let i_597 = _resolve(0);
    const _t598 = (function() {
      const _t599 = _h;
      _h = Object.assign({}, _t599, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t600(x) {
          return _trampoline(function() {
            if ((i_597 >= n)) {
              return _h["__seq_stop"](undefined, function(_t601) {
                return _bounce(function() {
                  return _t601;
                });
              });
            } else {
              _mml$yield(x);
              return (i_597 = (i_597 + 1), undefined);
            }
          });
        }
        const __x_602 = s(_t600);
        return __x_602;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t599; }
    })();
    return _t598;
  }, Seq$take);
}
function Seq$take_while(f, s, _mml$yield) {
  return _trampoline(function() {
    const _t603 = (function() {
      const _t604 = _h;
      _h = Object.assign({}, _t604, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t605(x) {
          return _trampoline(function() {
            if (f(x)) {
              return _mml$yield(x);
            } else {
              return _h["__seq_stop"](undefined, function(_t606) {
                return _bounce(function() {
                  return _t606;
                });
              });
            }
          });
        }
        const __x_607 = s(_t605);
        return __x_607;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t604; }
    })();
    return _t603;
  }, Seq$take_while);
}
function Seq$drop(n, s, _mml$yield) {
  let i_608 = 0;
  function _t610(x) {
    let _t611;
    if ((i_608 >= n)) {
      _t611 = _mml$yield(x);
    } else {
      _t611 = (i_608 = (i_608 + 1), undefined);
    }
    return _t611;
  }
  const _t609 = s(_t610);
  return _t609;
}
function Seq$drop_while(f, s, _mml$yield) {
  let dropping_612 = true;
  function _t614(x) {
    let _t615;
    if (dropping_612) {
      let _t616;
      if (f(x)) {
        _t616 = undefined;
      } else {
        (dropping_612 = false, undefined);
        _t616 = _mml$yield(x);
      }
      _t615 = _t616;
    } else {
      _t615 = _mml$yield(x);
    }
    return _t615;
  }
  const _t613 = s(_t614);
  return _t613;
}
function Seq$flat_map(f, s, _mml$yield) {
  function _t617(x) {
    return f(x, _mml$yield);
  }
  return s(_t617);
}
function Seq$enumerate(s, _mml$yield) {
  let i_618 = 0;
  function _t620(x) {
    _mml$yield([i_618, x]);
    return (i_618 = (i_618 + 1), undefined);
  }
  const _t619 = s(_t620);
  return _t619;
}
function Seq$chunk(n, s, _mml$yield) {
  let buf_621 = null;
  let count_623 = 0;
  function _t625(x) {
    (buf_621 = List$concat(buf_621, ({_hd: x, _tl: null})), undefined);
    (count_623 = (count_623 + 1), undefined);
    let _t626;
    if ((count_623 >= n)) {
      _mml$yield(buf_621);
      (buf_621 = null, undefined);
      _t626 = (count_623 = 0, undefined);
    } else {
      _t626 = undefined;
    }
    return _t626;
  }
  s(_t625);
  let _t627;
  if ((count_623 > 0)) {
    _t627 = _mml$yield(buf_621);
  } else {
    _t627 = undefined;
  }
  const _t624 = _t627;
  const _t622 = _t624;
  return _t622;
}
function Seq$to_list(s) {
  let acc_628 = null;
  function _t630(x) {
    return (acc_628 = ({_hd: x, _tl: acc_628}), undefined);
  }
  s(_t630);
  const _t629 = List$rev(acc_628);
  return _t629;
}
function Seq$fold(f, init, s) {
  let acc_631 = init;
  function _t633(x) {
    return (acc_631 = f(acc_631, x), undefined);
  }
  s(_t633);
  const _t632 = acc_631;
  return _t632;
}
function Seq$each(f, s) {
  return s(f);
}
function Seq$count(s) {
  let n_634 = 0;
  function _t636(_) {
    return (n_634 = (n_634 + 1), undefined);
  }
  s(_t636);
  const _t635 = n_634;
  return _t635;
}
function Seq$sum(s) {
  let total_637 = 0;
  function _t639(x) {
    return (total_637 = (total_637 + x), undefined);
  }
  s(_t639);
  const _t638 = total_637;
  return _t638;
}
function Seq$find(f, s) {
  return _trampoline(function() {
    let result_640 = _resolve(({_tag: 0, _name: "None"}));
    const _t641 = (function() {
      const _t642 = _h;
      _h = Object.assign({}, _t642, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t643(x) {
          return _trampoline(function() {
            if (f(x)) {
              _resolve((result_640 = ({_tag: 1, _name: "Some", _val: x}), undefined));
              return _h["__seq_stop"](undefined, function(_t644) {
                return _bounce(function() {
                  return _t644;
                });
              });
            } else {
              return undefined;
            }
          });
        }
        const __x_645 = s(_t643);
        return __x_645;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t642; }
    })();
    const _t646 = _resolve(_t641);
    return result_640;
  }, Seq$find);
}
function Seq$any(f, s) {
  return _trampoline(function() {
    let result_647 = _resolve(false);
    const _t648 = (function() {
      const _t649 = _h;
      _h = Object.assign({}, _t649, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t650(x) {
          return _trampoline(function() {
            if (f(x)) {
              _resolve((result_647 = true, undefined));
              return _h["__seq_stop"](undefined, function(_t651) {
                return _bounce(function() {
                  return _t651;
                });
              });
            } else {
              return undefined;
            }
          });
        }
        const __x_652 = s(_t650);
        return __x_652;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t649; }
    })();
    const _t653 = _resolve(_t648);
    return result_647;
  }, Seq$any);
}
function Seq$all(f, s) {
  return _trampoline(function() {
    let result_654 = _resolve(true);
    const _t655 = (function() {
      const _t656 = _h;
      _h = Object.assign({}, _t656, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t657(x) {
          return _trampoline(function() {
            if (f(x)) {
              return undefined;
            } else {
              _resolve((result_654 = false, undefined));
              return _h["__seq_stop"](undefined, function(_t658) {
                return _bounce(function() {
                  return _t658;
                });
              });
            }
          });
        }
        const __x_659 = s(_t657);
        return __x_659;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t656; }
    })();
    const _t660 = _resolve(_t655);
    return result_654;
  }, Seq$all);
}
function Option$map(f, opt) {
  let _t662;
  const _t661 = opt;
  _t663: {
    if (_t661._tag === 1) {
      const x = _t661._val;
      _t662 = ({_tag: 1, _name: "Some", _val: f(x)});
      break _t663;
    }
    if (_t661._tag === 0) {
      _t662 = ({_tag: 0, _name: "None"});
      break _t663;
    }
    _match_fail("line 37");
  }
  return _t662;
}
function Option$bind(f, opt) {
  let _t665;
  const _t664 = opt;
  _t666: {
    if (_t664._tag === 1) {
      const x = _t664._val;
      _t665 = f(x);
      break _t666;
    }
    if (_t664._tag === 0) {
      _t665 = ({_tag: 0, _name: "None"});
      break _t666;
    }
    _match_fail("line 37");
  }
  return _t665;
}
function Option$unwrap(opt) {
  let _t668;
  const _t667 = opt;
  _t669: {
    if (_t667._tag === 1) {
      const x = _t667._val;
      _t668 = x;
      break _t669;
    }
    _match_fail("line 37");
  }
  return _t668;
}
function Option$unwrap_or(_mml$default, opt) {
  let _t671;
  const _t670 = opt;
  _t672: {
    if (_t670._tag === 1) {
      const x = _t670._val;
      _t671 = x;
      break _t672;
    }
    if (_t670._tag === 0) {
      _t671 = _mml$default;
      break _t672;
    }
    _match_fail("line 37");
  }
  return _t671;
}
function Option$is_some(opt) {
  let _t674;
  const _t673 = opt;
  _t675: {
    if (_t673._tag === 1) {
      _t674 = true;
      break _t675;
    }
    if (_t673._tag === 0) {
      _t674 = false;
      break _t675;
    }
    _match_fail("line 37");
  }
  return _t674;
}
function Option$is_none(opt) {
  let _t677;
  const _t676 = opt;
  _t678: {
    if (_t676._tag === 1) {
      _t677 = false;
      break _t678;
    }
    if (_t676._tag === 0) {
      _t677 = true;
      break _t678;
    }
    _match_fail("line 37");
  }
  return _t677;
}
function Option$to_list(opt) {
  let _t680;
  const _t679 = opt;
  _t681: {
    if (_t679._tag === 1) {
      const x = _t679._val;
      _t680 = ({_hd: x, _tl: null});
      break _t681;
    }
    if (_t679._tag === 0) {
      _t680 = null;
      break _t681;
    }
    _match_fail("line 37");
  }
  return _t680;
}
function Option$iter(f, opt) {
  let _t683;
  const _t682 = opt;
  _t684: {
    if (_t682._tag === 1) {
      const x = _t682._val;
      _t683 = f(x);
      break _t684;
    }
    if (_t682._tag === 0) {
      _t683 = undefined;
      break _t684;
    }
    _match_fail("line 37");
  }
  return _t683;
}
function Option$flat_map(f, opt) {
  let _t686;
  const _t685 = opt;
  _t687: {
    if (_t685._tag === 1) {
      const x = _t685._val;
      _t686 = f(x);
      break _t687;
    }
    if (_t685._tag === 0) {
      _t686 = ({_tag: 0, _name: "None"});
      break _t687;
    }
    _match_fail("line 37");
  }
  return _t686;
}
function Buffer$create(n) {
  let _t688;
  if ((n < 16)) {
    _t688 = 16;
  } else {
    _t688 = n;
  }
  return ({data: Array$make(_t688, 0), len: 0});
}
function Buffer$length(buf) {
  return buf.len;
}
function Buffer$clear(buf) {
  return (buf.len = 0, undefined);
}
function Buffer$grow(buf, needed) {
  const cap_689 = Array$length(buf.data);
  let _t691;
  if (((buf.len + needed) > cap_689)) {
    const new_cap_692 = Math$max((cap_689 * 2), (buf.len + needed));
    const new_data_694 = Array$make(new_cap_692, 0);
    function copy(i) {
      while (true) {
        let _t696;
        if ((i < buf.len)) {
          Array$set(new_data_694, i, Array$get(buf.data, i));
          const _t697 = (i + 1);
          i = _t697;
          continue;
          _t696 = undefined;
        } else {
          _t696 = undefined;
        }
        return _t696;
      }
    }
    copy(0);
    const _t698 = (buf.data = new_data_694, undefined);
    const _t695 = _t698;
    const _t693 = _t695;
    _t691 = _t693;
  } else {
    _t691 = undefined;
  }
  const _t690 = _t691;
  return _t690;
}
function Buffer$add_byte(buf, b) {
  Buffer$grow(buf, 1);
  Array$set(buf.data, buf.len, b);
  return (buf.len = (buf.len + 1), undefined);
}
function Buffer$add_string(buf, s) {
  const bytes_699 = String$to_byte_array(s);
  const n_701 = Array$length(bytes_699);
  Buffer$grow(buf, n_701);
  function copy(i) {
    while (true) {
      let _t703;
      if ((i < n_701)) {
        Array$set(buf.data, (buf.len + i), Array$get(bytes_699, i));
        const _t704 = (i + 1);
        i = _t704;
        continue;
        _t703 = undefined;
      } else {
        _t703 = undefined;
      }
      return _t703;
    }
  }
  copy(0);
  const _t705 = (buf.len = (buf.len + n_701), undefined);
  const _t702 = _t705;
  const _t700 = _t702;
  return _t700;
}
function Buffer$sub(buf, pos, len) {
  return String$of_byte_array(Array$sub(buf.data, pos, len));
}
function Buffer$truncate(buf, n) {
  return (buf.len = n, undefined);
}
function Buffer$contents(buf) {
  return String$of_byte_array(Array$sub(buf.data, 0, buf.len));
}
function Buffer$add_buffer(dst, src) {
  const n_706 = src.len;
  Buffer$grow(dst, n_706);
  function copy(i) {
    while (true) {
      let _t708;
      if ((i < n_706)) {
        Array$set(dst.data, (dst.len + i), Array$get(src.data, i));
        const _t709 = (i + 1);
        i = _t709;
        continue;
        _t708 = undefined;
      } else {
        _t708 = undefined;
      }
      return _t708;
    }
  }
  copy(0);
  const _t710 = (dst.len = (dst.len + n_706), undefined);
  const _t707 = _t710;
  return _t707;
}
function Fmt$pad_left(n, c, s) {
  const len_711 = String$length(s);
  let _t713;
  if ((len_711 >= n)) {
    _t713 = s;
  } else {
    function pad(acc, remaining) {
      while (true) {
        let _t714;
        if ((remaining <= 0)) {
          _t714 = (acc + s);
        } else {
          const _t715 = (acc + c);
          const _t716 = (remaining - 1);
          acc = _t715;
          remaining = _t716;
          continue;
          _t714 = undefined;
        }
        return _t714;
      }
    }
    const _t717 = pad("", (n - len_711));
    _t713 = _t717;
  }
  const _t712 = _t713;
  return _t712;
}
function Fmt$pad_right(n, c, s) {
  const len_718 = String$length(s);
  let _t720;
  if ((len_718 >= n)) {
    _t720 = s;
  } else {
    function pad(acc, remaining) {
      while (true) {
        let _t721;
        if ((remaining <= 0)) {
          _t721 = (s + acc);
        } else {
          const _t722 = (acc + c);
          const _t723 = (remaining - 1);
          acc = _t722;
          remaining = _t723;
          continue;
          _t721 = undefined;
        }
        return _t721;
      }
    }
    const _t724 = pad("", (n - len_718));
    _t720 = _t724;
  }
  const _t719 = _t720;
  return _t719;
}
function Fmt$int_to_hex(n) {
  const digits_725 = "0123456789abcdef";
  let _t727;
  if ((n === 0)) {
    _t727 = "0";
  } else {
    function go(num, acc) {
      while (true) {
        let _t728;
        if ((num === 0)) {
          _t728 = acc;
        } else {
          const d_729 = (num % 16);
          let _t731;
          if ((d_729 < 0)) {
            _t731 = (d_729 + 16);
          } else {
            _t731 = d_729;
          }
          const d_732 = _t731;
          const ch_734 = String$sub(digits_725, d_732, 1);
          const _t736 = ((num / 16) | 0);
          const _t737 = (ch_734 + acc);
          num = _t736;
          acc = _t737;
          continue;
          const _t735 = undefined;
          const _t733 = _t735;
          const _t730 = _t733;
          _t728 = _t730;
        }
        return _t728;
      }
    }
    let _t739;
    if ((n < 0)) {
      _t739 = (0 - n);
    } else {
      _t739 = n;
    }
    const abs_n_740 = _t739;
    const hex_742 = go(abs_n_740, "");
    let _t744;
    if ((n < 0)) {
      _t744 = ("-" + hex_742);
    } else {
      _t744 = hex_742;
    }
    const _t743 = _t744;
    const _t741 = _t743;
    const _t738 = _t741;
    _t727 = _t738;
  }
  const _t726 = _t727;
  return _t726;
}
function Fmt$int_to_bin(n) {
  let _t745;
  if ((n === 0)) {
    _t745 = "0";
  } else {
    function go(num, acc) {
      while (true) {
        let _t746;
        if ((num === 0)) {
          _t746 = acc;
        } else {
          let _t747;
          if (((num % 2) === 0)) {
            _t747 = "0";
          } else {
            _t747 = "1";
          }
          const bit_748 = _t747;
          const _t750 = ((num / 2) | 0);
          const _t751 = (bit_748 + acc);
          num = _t750;
          acc = _t751;
          continue;
          const _t749 = undefined;
          _t746 = _t749;
        }
        return _t746;
      }
    }
    let _t753;
    if ((n < 0)) {
      _t753 = (0 - n);
    } else {
      _t753 = n;
    }
    const abs_n_754 = _t753;
    const bin_756 = go(abs_n_754, "");
    let _t758;
    if ((n < 0)) {
      _t758 = ("-" + bin_756);
    } else {
      _t758 = bin_756;
    }
    const _t757 = _t758;
    const _t755 = _t757;
    const _t752 = _t755;
    _t745 = _t752;
  }
  return _t745;
}
function Fmt$int_to_oct(n) {
  let _t759;
  if ((n === 0)) {
    _t759 = "0";
  } else {
    function go(num, acc) {
      while (true) {
        let _t760;
        if ((num === 0)) {
          _t760 = acc;
        } else {
          const d_761 = (num % 8);
          let _t763;
          if ((d_761 < 0)) {
            _t763 = (d_761 + 8);
          } else {
            _t763 = d_761;
          }
          const d_764 = _t763;
          const _t766 = ((num / 8) | 0);
          const _t767 = (__dict_Show_int.show(d_764) + acc);
          num = _t766;
          acc = _t767;
          continue;
          const _t765 = undefined;
          const _t762 = _t765;
          _t760 = _t762;
        }
        return _t760;
      }
    }
    let _t769;
    if ((n < 0)) {
      _t769 = (0 - n);
    } else {
      _t769 = n;
    }
    const abs_n_770 = _t769;
    const oct_772 = go(abs_n_770, "");
    let _t774;
    if ((n < 0)) {
      _t774 = ("-" + oct_772);
    } else {
      _t774 = oct_772;
    }
    const _t773 = _t774;
    const _t771 = _t773;
    const _t768 = _t771;
    _t759 = _t768;
  }
  return _t759;
}
function Fmt$zero_pad(width, s) {
  return Fmt$pad_left(width, "0", s);
}
function _t775(n) {
  return n;
}
const __dict_Hash_int = ({hash: _t775});
function _t776(s) {
  const bytes_777 = String$to_byte_array(s);
  function _t779(h, b) {
    return ((h * 31) + Byte$to_int(b));
  }
  const _t778 = __dict_Iter_g0_array__g0.fold(_t779, 5381, bytes_777);
  return _t778;
}
const __dict_Hash_string = ({hash: _t776});
function _t780(b) {
  let _t781;
  if (b) {
    _t781 = 1;
  } else {
    _t781 = 0;
  }
  return _t781;
}
const __dict_Hash_bool = ({hash: _t780});
function _t782(b) {
  return Byte$to_int(b);
}
const __dict_Hash_byte = ({hash: _t782});
function _t783(r) {
  return Rune$to_int(r);
}
const __dict_Hash_rune = ({hash: _t783});
function Hashtbl$create(n) {
  let _t784;
  if ((n < 16)) {
    _t784 = 16;
  } else {
    _t784 = n;
  }
  const cap_785 = _t784;
  const _t786 = ({buckets: Array$make(cap_785, null), size: 0});
  return _t786;
}
function Hashtbl$clear(tbl) {
  const cap_787 = Array$length(tbl.buckets);
  (tbl.buckets = Array$make(cap_787, null), undefined);
  const _t788 = (tbl.size = 0, undefined);
  return _t788;
}
function Hashtbl$length(tbl) {
  return tbl.size;
}
function Hashtbl$bucket_index(__dict_Hash_0, tbl, key) {
  const h_789 = __dict_Hash_0.hash(key);
  let _t791;
  if ((h_789 < 0)) {
    _t791 = (0 - h_789);
  } else {
    _t791 = h_789;
  }
  const h_792 = _t791;
  const _t793 = (h_792 % Array$length(tbl.buckets));
  const _t790 = _t793;
  return _t790;
}
function Hashtbl$to_list(tbl) {
  const cap_794 = Array$length(tbl.buckets);
  function collect(i, acc) {
    while (true) {
      let _t796;
      if ((i >= cap_794)) {
        _t796 = acc;
      } else {
        const bucket_797 = Array$get(tbl.buckets, i);
        const _t799 = (i + 1);
        const _t800 = List$concat(bucket_797, acc);
        i = _t799;
        acc = _t800;
        continue;
        const _t798 = undefined;
        _t796 = _t798;
      }
      return _t796;
    }
  }
  const _t801 = collect(0, null);
  const _t795 = _t801;
  return _t795;
}
function Hashtbl$rehash(tbl, hash_fn) {
  const entries_802 = Hashtbl$to_list(tbl);
  const new_cap_804 = (Array$length(tbl.buckets) * 2);
  (tbl.buckets = Array$make(new_cap_804, null), undefined);
  (tbl.size = 0, undefined);
  function _t806(_, __p27) {
    let _t808;
    const _t807 = __p27;
    _t809: {
      if (true) {
        const k = _t807[0];
        const v = _t807[1];
        const h_810 = hash_fn(k);
        let _t812;
        if ((h_810 < 0)) {
          _t812 = (0 - h_810);
        } else {
          _t812 = h_810;
        }
        const h_813 = _t812;
        const idx_815 = (h_813 % new_cap_804);
        const bucket_817 = Array$get(tbl.buckets, idx_815);
        Array$set(tbl.buckets, idx_815, ({_hd: [k, v], _tl: bucket_817}));
        const _t818 = (tbl.size = (tbl.size + 1), undefined);
        const _t816 = _t818;
        const _t814 = _t816;
        const _t811 = _t814;
        _t808 = _t811;
        break _t809;
      }
      _match_fail("line 106");
    }
    return _t808;
  }
  const _t805 = List$fold(_t806, undefined, entries_802);
  const _t803 = _t805;
  return _t803;
}
function Hashtbl$set(__dict_Hash_1, __dict_Eq_1, tbl, key, value) {
  const idx_819 = _call(Hashtbl$bucket_index, [__dict_Hash_1, tbl, key]);
  const bucket_821 = Array$get(tbl.buckets, idx_819);
  function replace(__x) {
    let _t824;
    const _t823 = __x;
    _t825: {
      if (_t823 === null) {
        _t824 = ({_hd: [key, value], _tl: null});
        break _t825;
      }
      if (_t823 !== null) {
        const k = _t823._hd[0];
        const v = _t823._hd[1];
        const rest = _t823._tl;
        let _t826;
        if (_call(__dict_Eq_1.$eq, [k, key])) {
          _t826 = ({_hd: [key, value], _tl: rest});
        } else {
          _t826 = ({_hd: [k, v], _tl: replace(rest)});
        }
        _t824 = _t826;
        break _t825;
      }
      _match_fail("line 106");
    }
    return _t824;
  }
  const new_bucket_828 = replace(bucket_821);
  const grew_830 = (List$length(new_bucket_828) > List$length(bucket_821));
  Array$set(tbl.buckets, idx_819, new_bucket_828);
  let _t832;
  if (grew_830) {
    (tbl.size = (tbl.size + 1), undefined);
    let _t833;
    if ((tbl.size > (Array$length(tbl.buckets) * 2))) {
      _t833 = Hashtbl$rehash(tbl, __dict_Hash_1.hash);
    } else {
      _t833 = undefined;
    }
    _t832 = _t833;
  } else {
    _t832 = undefined;
  }
  const _t831 = _t832;
  const _t829 = _t831;
  const _t827 = _t829;
  const _t822 = _t827;
  const _t820 = _t822;
  return _t820;
}
function Hashtbl$get(__dict_Hash_1, __dict_Eq_1, tbl, key) {
  const idx_834 = _call(Hashtbl$bucket_index, [__dict_Hash_1, tbl, key]);
  const bucket_836 = Array$get(tbl.buckets, idx_834);
  function find(__x) {
    while (true) {
      let _t839;
      const _t838 = __x;
      _t840: {
        if (_t838 === null) {
          _t839 = ({_tag: 0, _name: "None"});
          break _t840;
        }
        if (_t838 !== null) {
          const k = _t838._hd[0];
          const v = _t838._hd[1];
          const rest = _t838._tl;
          let _t841;
          if (_call(__dict_Eq_1.$eq, [k, key])) {
            _t841 = ({_tag: 1, _name: "Some", _val: v});
          } else {
            const _t842 = rest;
            __x = _t842;
            continue;
            _t841 = undefined;
          }
          _t839 = _t841;
          break _t840;
        }
        _match_fail("line 106");
      }
      return _t839;
    }
  }
  const _t843 = find(bucket_836);
  const _t837 = _t843;
  const _t835 = _t837;
  return _t835;
}
function Hashtbl$has(__dict_Hash_0, __dict_Eq_0, tbl, key) {
  let _t845;
  const _t844 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, tbl, key]);
  _t846: {
    if (_t844._tag === 1) {
      _t845 = true;
      break _t846;
    }
    if (_t844._tag === 0) {
      _t845 = false;
      break _t846;
    }
    _match_fail("line 106");
  }
  return _t845;
}
function Hashtbl$remove(__dict_Hash_0, __dict_Eq_0, tbl, key) {
  const idx_847 = _call(Hashtbl$bucket_index, [__dict_Hash_0, tbl, key]);
  const bucket_849 = Array$get(tbl.buckets, idx_847);
  function _t851(__p28) {
    let _t853;
    const _t852 = __p28;
    _t854: {
      if (true) {
        const k = _t852[0];
        _t853 = _call(__dict_Eq_0.$lt$gt, [k, key]);
        break _t854;
      }
      _match_fail("line 106");
    }
    return _t853;
  }
  const new_bucket_855 = List$filter(_t851, bucket_849);
  let _t857;
  if ((List$length(new_bucket_855) < List$length(bucket_849))) {
    _t857 = (tbl.size = (tbl.size - 1), undefined);
  } else {
    _t857 = undefined;
  }
  _t857;
  const _t856 = Array$set(tbl.buckets, idx_847, new_bucket_855);
  const _t850 = _t856;
  const _t848 = _t850;
  return _t848;
}
function Hashtbl$find(__dict_Hash_1, __dict_Eq_1, tbl, key) {
  let _t859;
  const _t858 = _call(Hashtbl$get, [__dict_Hash_1, __dict_Eq_1, tbl, key]);
  _t860: {
    if (_t858._tag === 1) {
      const v = _t858._val;
      _t859 = v;
      break _t860;
    }
    if (_t858._tag === 0) {
      _t859 = failwith("Hashtbl.find: key not found");
      break _t860;
    }
    _match_fail("line 106");
  }
  return _t859;
}
function Hashtbl$fold(f, tbl, acc) {
  const entries_861 = Hashtbl$to_list(tbl);
  function _t863(a, __p29) {
    let _t865;
    const _t864 = __p29;
    _t866: {
      if (true) {
        const k = _t864[0];
        const v = _t864[1];
        _t865 = f(k, v, a);
        break _t866;
      }
      _match_fail("line 106");
    }
    return _t865;
  }
  const _t862 = List$fold(_t863, acc, entries_861);
  return _t862;
}
function Hashtbl$iter(f, tbl) {
  const entries_867 = Hashtbl$to_list(tbl);
  function _t869(__p30) {
    let _t871;
    const _t870 = __p30;
    _t872: {
      if (true) {
        const k = _t870[0];
        const v = _t870[1];
        _t871 = f(k, v);
        break _t872;
      }
      _match_fail("line 106");
    }
    return _t871;
  }
  const _t868 = List$iter(_t869, entries_867);
  return _t868;
}
function Hashtbl$keys(tbl) {
  function _t873(__p31) {
    let _t875;
    const _t874 = __p31;
    _t876: {
      if (true) {
        const k = _t874[0];
        _t875 = k;
        break _t876;
      }
      _match_fail("line 106");
    }
    return _t875;
  }
  return List$map(_t873, Hashtbl$to_list(tbl));
}
function Hashtbl$values(tbl) {
  function _t877(__p32) {
    let _t879;
    const _t878 = __p32;
    _t880: {
      if (true) {
        const v = _t878[1];
        _t879 = v;
        break _t880;
      }
      _match_fail("line 106");
    }
    return _t879;
  }
  return List$map(_t877, Hashtbl$to_list(tbl));
}
function Ref$create(v) {
  return ({contents: v});
}
function Ref$get(r) {
  return r.contents;
}
function Ref$set(r, v) {
  return (r.contents = v, undefined);
}
function Dynarray$create(n, _mml$default) {
  let _t881;
  if ((n < 16)) {
    _t881 = 16;
  } else {
    _t881 = n;
  }
  return ({arr: Array$make(_t881, _mml$default), count: 0});
}
function Dynarray$length(d) {
  return d.count;
}
function Dynarray$get(d, i) {
  let _t882;
  if (((i < 0) || (i >= d.count))) {
    _t882 = failwith("Dynarray.get: index out of bounds");
  } else {
    _t882 = Array$get(d.arr, i);
  }
  return _t882;
}
function Dynarray$set(d, i, v) {
  let _t883;
  if (((i < 0) || (i >= d.count))) {
    _t883 = failwith("Dynarray.set: index out of bounds");
  } else {
    _t883 = Array$set(d.arr, i, v);
  }
  return _t883;
}
function Dynarray$grow(d, needed, _mml$default) {
  const cap_884 = Array$length(d.arr);
  let _t886;
  if (((d.count + needed) > cap_884)) {
    const new_cap_887 = Math$max((cap_884 * 2), (d.count + needed));
    const new_arr_889 = Array$make(new_cap_887, _mml$default);
    function copy(i) {
      while (true) {
        let _t891;
        if ((i < d.count)) {
          Array$set(new_arr_889, i, Array$get(d.arr, i));
          const _t892 = (i + 1);
          i = _t892;
          continue;
          _t891 = undefined;
        } else {
          _t891 = undefined;
        }
        return _t891;
      }
    }
    copy(0);
    const _t893 = (d.arr = new_arr_889, undefined);
    const _t890 = _t893;
    const _t888 = _t890;
    _t886 = _t888;
  } else {
    _t886 = undefined;
  }
  const _t885 = _t886;
  return _t885;
}
function Dynarray$empty(_) {
  return ({arr: {_arr: []}, count: 0});
}
function Dynarray$push(d, v) {
  Dynarray$grow(d, 1, v);
  Array$set(d.arr, d.count, v);
  return (d.count = (d.count + 1), undefined);
}
function Dynarray$pop(d) {
  let _t894;
  if ((d.count === 0)) {
    _t894 = failwith("Dynarray.pop: empty");
  } else {
    _t894 = (d.count = (d.count - 1), undefined);
  }
  _t894;
  return Array$get(d.arr, d.count);
}
function Dynarray$clear(d) {
  return (d.count = 0, undefined);
}
function Dynarray$to_list(d) {
  function collect(i, acc) {
    while (true) {
      let _t895;
      if ((i < 0)) {
        _t895 = acc;
      } else {
        const _t896 = (i - 1);
        const _t897 = ({_hd: Dynarray$get(d, i), _tl: acc});
        i = _t896;
        acc = _t897;
        continue;
        _t895 = undefined;
      }
      return _t895;
    }
  }
  const _t898 = collect((d.count - 1), null);
  return _t898;
}
function Dynarray$to_array(d) {
  return Array$sub(d.arr, 0, d.count);
}
function compare(a, b) {
  let _t899;
  if ((a < b)) {
    _t899 = (-1);
  } else {
    let _t900;
    if ((a > b)) {
      _t900 = 1;
    } else {
      _t900 = 0;
    }
    _t899 = _t900;
  }
  return _t899;
}
function int_of_string(s) {
  let _t902;
  const _t901 = String$to_int(s);
  _t903: {
    if (_t901._tag === 1) {
      const n = _t901._val;
      _t902 = n;
      break _t903;
    }
    if (_t901._tag === 0) {
      _t902 = failwith((("int_of_string: invalid argument \"" + __dict_Show_string.show(s)) + "\""));
      break _t903;
    }
    _match_fail("line 27");
  }
  return _t902;
}
function float_of_string(s) {
  let _t905;
  const _t904 = String$to_float(s);
  _t906: {
    if (_t904._tag === 1) {
      const f = _t904._val;
      _t905 = f;
      break _t906;
    }
    if (_t904._tag === 0) {
      _t905 = failwith((("float_of_string: invalid argument \"" + __dict_Show_string.show(s)) + "\""));
      break _t906;
    }
    _match_fail("line 27");
  }
  return _t905;
}
function max(a, b) {
  let _t907;
  if ((a > b)) {
    _t907 = a;
  } else {
    _t907 = b;
  }
  return _t907;
}
function min(a, b) {
  let _t908;
  if ((a < b)) {
    _t908 = a;
  } else {
    _t908 = b;
  }
  return _t908;
}
function fst(__p33) {
  let _t910;
  const _t909 = __p33;
  _t911: {
    if (true) {
      const a = _t909[0];
      _t910 = a;
      break _t911;
    }
    _match_fail("line 27");
  }
  return _t910;
}
function snd(__p34) {
  let _t913;
  const _t912 = __p34;
  _t914: {
    if (true) {
      const b = _t912[1];
      _t913 = b;
      break _t914;
    }
    _match_fail("line 27");
  }
  return _t913;
}
function list_find(f, xs) {
  let _t916;
  const _t915 = List$find(f, xs);
  _t917: {
    if (_t915._tag === 1) {
      const x = _t915._val;
      _t916 = x;
      break _t917;
    }
    if (_t915._tag === 0) {
      _t916 = failwith("list_find: not found");
      break _t917;
    }
    _match_fail("line 27");
  }
  return _t916;
}
if (typeof Runtime$eval === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Runtime.eval"]) var Runtime$eval = globalThis._mmlExterns["Runtime.eval"]; else throw new Error("extern " + "Runtime.eval" + " not provided"); }
if (typeof Runtime$eval_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Runtime.eval_file"]) var Runtime$eval_file = globalThis._mmlExterns["Runtime.eval_file"]; else throw new Error("extern " + "Runtime.eval_file" + " not provided"); }
// --- Compiled MiniML ---
let _last_val;
const Token$dummy_loc = ({col: 0, line: 0, offset: 0});
function Token$pp_token_kind(__x) {
  let _t919;
  const _t918 = __x;
  _t920: {
    if (_t918._tag === 0) {
      const n = _t918._val;
      _t919 = (("INT(" + __dict_Show_int.show(n)) + ")");
      break _t920;
    }
    if (_t918._tag === 1) {
      const f = _t918._val;
      _t919 = (("FLOAT(" + __dict_Show_float.show(f)) + ")");
      break _t920;
    }
    if (_t918._tag === 2) {
      const s = _t918._val;
      _t919 = (("STRING(" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 3) {
      _t919 = "INTERP_STRING";
      break _t920;
    }
    if (_t918._tag === 4) {
      const n = _t918._val;
      _t919 = (("BYTE(#" + __fmt_zero_pad(2, __fmt_hex(n))) + ")");
      break _t920;
    }
    if (_t918._tag === 5) {
      const n = _t918._val;
      _t919 = (("RUNE(" + __dict_Show_int.show(n)) + ")");
      break _t920;
    }
    if (_t918._tag === 6) {
      _t919 = "TRUE";
      break _t920;
    }
    if (_t918._tag === 7) {
      _t919 = "FALSE";
      break _t920;
    }
    if (_t918._tag === 8) {
      const s = _t918._val;
      _t919 = (("IDENT(" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 9) {
      const s = _t918._val;
      _t919 = (("UIDENT(" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 10) {
      const s = _t918._val;
      _t919 = (("TYVAR('" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 11) {
      _t919 = "LET";
      break _t920;
    }
    if (_t918._tag === 12) {
      _t919 = "REC";
      break _t920;
    }
    if (_t918._tag === 13) {
      _t919 = "IN";
      break _t920;
    }
    if (_t918._tag === 14) {
      _t919 = "IF";
      break _t920;
    }
    if (_t918._tag === 15) {
      _t919 = "ELSE";
      break _t920;
    }
    if (_t918._tag === 16) {
      _t919 = "FN";
      break _t920;
    }
    if (_t918._tag === 17) {
      _t919 = "MATCH";
      break _t920;
    }
    if (_t918._tag === 18) {
      _t919 = "WITH";
      break _t920;
    }
    if (_t918._tag === 19) {
      _t919 = "TYPE";
      break _t920;
    }
    if (_t918._tag === 20) {
      _t919 = "NEWTYPE";
      break _t920;
    }
    if (_t918._tag === 21) {
      _t919 = "OF";
      break _t920;
    }
    if (_t918._tag === 22) {
      _t919 = "CLASS";
      break _t920;
    }
    if (_t918._tag === 23) {
      _t919 = "INSTANCE";
      break _t920;
    }
    if (_t918._tag === 24) {
      _t919 = "EFFECT";
      break _t920;
    }
    if (_t918._tag === 25) {
      _t919 = "EXTERN";
      break _t920;
    }
    if (_t918._tag === 65) {
      _t919 = "PERFORM";
      break _t920;
    }
    if (_t918._tag === 66) {
      _t919 = "HANDLE";
      break _t920;
    }
    if (_t918._tag === 28) {
      _t919 = "TRY";
      break _t920;
    }
    if (_t918._tag === 29) {
      _t919 = "PROVIDE";
      break _t920;
    }
    if (_t918._tag === 30) {
      _t919 = "CONTINUE";
      break _t920;
    }
    if (_t918._tag === 67) {
      _t919 = "RESUME";
      break _t920;
    }
    if (_t918._tag === 44) {
      _t919 = "RETURN";
      break _t920;
    }
    if (_t918._tag === 33) {
      _t919 = "MUT";
      break _t920;
    }
    if (_t918._tag === 34) {
      _t919 = "FOR";
      break _t920;
    }
    if (_t918._tag === 35) {
      _t919 = "DO";
      break _t920;
    }
    if (_t918._tag === 36) {
      _t919 = "BREAK";
      break _t920;
    }
    if (_t918._tag === 37) {
      _t919 = "WHEN";
      break _t920;
    }
    if (_t918._tag === 38) {
      _t919 = "WHERE";
      break _t920;
    }
    if (_t918._tag === 39) {
      _t919 = "PARTIAL";
      break _t920;
    }
    if (_t918._tag === 30) {
      _t919 = "NOT";
      break _t920;
    }
    if (_t918._tag === 41) {
      _t919 = "HASH";
      break _t920;
    }
    if (_t918._tag === 42) {
      _t919 = "FATARROW";
      break _t920;
    }
    if (_t918._tag === 17) {
      _t919 = "MOD";
      break _t920;
    }
    if (_t918._tag === 44) {
      _t919 = "MODULE";
      break _t920;
    }
    if (_t918._tag === 45) {
      _t919 = "PUB";
      break _t920;
    }
    if (_t918._tag === 46) {
      _t919 = "OPEN";
      break _t920;
    }
    if (_t918._tag === 47) {
      _t919 = "END";
      break _t920;
    }
    if (_t918._tag === 48) {
      _t919 = "OPAQUE";
      break _t920;
    }
    if (_t918._tag === 49) {
      _t919 = "WHILE";
      break _t920;
    }
    if (_t918._tag === 50) {
      _t919 = "AND";
      break _t920;
    }
    if (_t918._tag === 51) {
      _t919 = "DERIVING";
      break _t920;
    }
    if (_t918._tag === 52) {
      _t919 = "LPAREN";
      break _t920;
    }
    if (_t918._tag === 53) {
      _t919 = "RPAREN";
      break _t920;
    }
    if (_t918._tag === 54) {
      _t919 = "LBRACE";
      break _t920;
    }
    if (_t918._tag === 55) {
      _t919 = "RBRACE";
      break _t920;
    }
    if (_t918._tag === 56) {
      _t919 = "LBRACKET";
      break _t920;
    }
    if (_t918._tag === 57) {
      _t919 = "RBRACKET";
      break _t920;
    }
    if (_t918._tag === 58) {
      _t919 = "ARROW";
      break _t920;
    }
    if (_t918._tag === 59) {
      _t919 = "COMMA";
      break _t920;
    }
    if (_t918._tag === 60) {
      _t919 = "SEMICOLON";
      break _t920;
    }
    if (_t918._tag === 61) {
      _t919 = "DOUBLE_SEMICOLON";
      break _t920;
    }
    if (_t918._tag === 62) {
      _t919 = "COLON";
      break _t920;
    }
    if (_t918._tag === 63) {
      _t919 = "DOT";
      break _t920;
    }
    if (_t918._tag === 64) {
      _t919 = "DOTDOT";
      break _t920;
    }
    if (_t918._tag === 65) {
      _t919 = "PIPE";
      break _t920;
    }
    if (_t918._tag === 66) {
      _t919 = "PIPEARROW";
      break _t920;
    }
    if (_t918._tag === 67) {
      _t919 = "UNDERSCORE";
      break _t920;
    }
    if (_t918._tag === 68) {
      _t919 = "PLUS";
      break _t920;
    }
    if (_t918._tag === 69) {
      _t919 = "MINUS";
      break _t920;
    }
    if (_t918._tag === 70) {
      _t919 = "STAR";
      break _t920;
    }
    if (_t918._tag === 71) {
      _t919 = "SLASH";
      break _t920;
    }
    if (_t918._tag === 72) {
      _t919 = "CARET";
      break _t920;
    }
    if (_t918._tag === 73) {
      _t919 = "COLONCOLON";
      break _t920;
    }
    if (_t918._tag === 74) {
      _t919 = "COLONEQUAL";
      break _t920;
    }
    if (_t918._tag === 24) {
      _t919 = "EQ";
      break _t920;
    }
    if (_t918._tag === 25) {
      _t919 = "NEQ";
      break _t920;
    }
    if (_t918._tag === 26) {
      _t919 = "LT";
      break _t920;
    }
    if (_t918._tag === 27) {
      _t919 = "GT";
      break _t920;
    }
    if (_t918._tag === 28) {
      _t919 = "LE";
      break _t920;
    }
    if (_t918._tag === 29) {
      _t919 = "GE";
      break _t920;
    }
    if (_t918._tag === 81) {
      _t919 = "AMPAMP";
      break _t920;
    }
    if (_t918._tag === 82) {
      _t919 = "PIPEPIPE";
      break _t920;
    }
    if (_t918._tag === 83) {
      _t919 = "LAND";
      break _t920;
    }
    if (_t918._tag === 84) {
      _t919 = "LOR";
      break _t920;
    }
    if (_t918._tag === 85) {
      _t919 = "LXOR";
      break _t920;
    }
    if (_t918._tag === 86) {
      _t919 = "LNOT";
      break _t920;
    }
    if (_t918._tag === 87) {
      _t919 = "LSL";
      break _t920;
    }
    if (_t918._tag === 88) {
      _t919 = "LSR";
      break _t920;
    }
    if (_t918._tag === 89) {
      const s = _t918._val;
      _t919 = (("POLYTAG(`" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 90) {
      _t919 = "COLONGT";
      break _t920;
    }
    if (_t918._tag === 91) {
      _t919 = "EOF";
      break _t920;
    }
    _match_fail("line 16629");
  }
  return _t919;
}
function Token$pp_token(t) {
  return ((((__dict_Show_string.show(Token$pp_token_kind(t.kind)) + "@") + __dict_Show_int.show(t.loc.line)) + ":") + __dict_Show_int.show(t.loc.col));
}
function Bytecode$make_record_shape(field_names) {
  const fields_921 = Array$of_list(field_names);
  const index_923 = Hashtbl$create(Array$length(fields_921));
  function _t925(i, name) {
    return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, index_923, name, i]);
  }
  Array$iteri(_t925, fields_921);
  const _t924 = ({rs_fields: fields_921, rs_index: index_923});
  const _t922 = _t924;
  return _t922;
}
function Bytecode$make_record(field_names, values) {
  const shape_926 = Bytecode$make_record_shape(field_names);
  const _t927 = ({_tag: 9, _name: "VRecord", _val: [shape_926, values]});
  return _t927;
}
function Bytecode$pp_value(__x) {
  let _t929;
  const _t928 = __x;
  _t930: {
    if (_t928._tag === 0) {
      const n = _t928._val;
      _t929 = string_of_int(n);
      break _t930;
    }
    if (_t928._tag === 1) {
      const f = _t928._val;
      const s_931 = __dict_Show_float.show(f);
      let _t933;
      if ((String$contains(".", s_931) || String$contains("e", s_931))) {
        _t933 = s_931;
      } else {
        _t933 = (s_931 + ".");
      }
      const _t932 = _t933;
      _t929 = _t932;
      break _t930;
    }
    if (_t928._tag === 2 && _t928._val) {
      _t929 = "true";
      break _t930;
    }
    if (_t928._tag === 2 && !_t928._val) {
      _t929 = "false";
      break _t930;
    }
    if (_t928._tag === 3) {
      const s = _t928._val;
      _t929 = s;
      break _t930;
    }
    if (_t928._tag === 4) {
      const n = _t928._val;
      _t929 = ("#" + __fmt_zero_pad(2, __fmt_hex(n)));
      break _t930;
    }
    if (_t928._tag === 5) {
      const cp = _t928._val;
      let _t934;
      if ((cp < 128)) {
        _t934 = (("'" + __dict_Show_byte.show(Byte$of_int(cp))) + "'");
      } else {
        const buf_935 = Buffer$create(6);
        Buffer$add_byte(buf_935, 39);
        let _t937;
        if ((cp < 2048)) {
          Buffer$add_byte(buf_935, Byte$of_int((192 | (cp >> 6))));
          _t937 = Buffer$add_byte(buf_935, Byte$of_int((128 | (cp & 63))));
        } else {
          let _t938;
          if ((cp < 65536)) {
            Buffer$add_byte(buf_935, Byte$of_int((224 | (cp >> 12))));
            Buffer$add_byte(buf_935, Byte$of_int((128 | ((cp >> 6) & 63))));
            _t938 = Buffer$add_byte(buf_935, Byte$of_int((128 | (cp & 63))));
          } else {
            Buffer$add_byte(buf_935, Byte$of_int((240 | (cp >> 18))));
            Buffer$add_byte(buf_935, Byte$of_int((128 | ((cp >> 12) & 63))));
            Buffer$add_byte(buf_935, Byte$of_int((128 | ((cp >> 6) & 63))));
            _t938 = Buffer$add_byte(buf_935, Byte$of_int((128 | (cp & 63))));
          }
          _t937 = _t938;
        }
        _t937;
        Buffer$add_byte(buf_935, 39);
        const _t936 = Buffer$contents(buf_935);
        _t934 = _t936;
      }
      _t929 = _t934;
      break _t930;
    }
    if (_t928._tag === 6) {
      _t929 = "()";
      break _t930;
    }
    if (_t928._tag === 7) {
      const vs = _t928._val;
      _t929 = ("(" + (String$concat(", ", Array$to_list(Array$map(Bytecode$pp_value, vs))) + ")"));
      break _t930;
    }
    if (_t928._tag === 8) {
      const vs = _t928._val;
      _t929 = ("[" + (String$concat("; ", List$map(Bytecode$pp_value, vs)) + "]"));
      break _t930;
    }
    if (_t928._tag === 9) {
      const shape = _t928._val[0];
      const values = _t928._val[1];
      function _t939(i) {
        return (Array$get(shape.rs_fields, i) + (" = " + Bytecode$pp_value(Array$get(values, i))));
      }
      _t929 = ("{ " + (String$concat("; ", List$init(Array$length(shape.rs_fields), _t939)) + " }"));
      break _t930;
    }
    if (_t928._tag === 10 && _t928._val[2]._tag === 0) {
      const name = _t928._val[1];
      _t929 = name;
      break _t930;
    }
    if (_t928._tag === 10 && _t928._val[2]._tag === 1) {
      const name = _t928._val[1];
      const v = _t928._val[2]._val;
      let _t941;
      const _t940 = v;
      _t942: {
        if ((_t940._tag === 7 || _t940._tag === 10 && _t940._val[2]._tag === 1)) {
          _t941 = ("(" + (Bytecode$pp_value(v) + ")"));
          break _t942;
        }
        if (true) {
          _t941 = Bytecode$pp_value(v);
          break _t942;
        }
        _match_fail("line 16629");
      }
      _t929 = (name + (" " + _t941));
      break _t930;
    }
    if (_t928._tag === 11) {
      _t929 = "<fun>";
      break _t930;
    }
    if (_t928._tag === 12) {
      _t929 = "<fun>";
      break _t930;
    }
    if (_t928._tag === 14) {
      const ext = _t928._val;
      let _t943;
      if (_eq(ext.ext_args, null)) {
        _t943 = (("<external:" + __dict_Show_string.show(ext.ext_name)) + ">");
      } else {
        _t943 = "<fun>";
      }
      _t929 = _t943;
      break _t930;
    }
    if (_t928._tag === 13) {
      const p = _t928._val;
      _t929 = (("<proto:" + __dict_Show_string.show(p.name)) + ">");
      break _t930;
    }
    if (_t928._tag === 15) {
      _t929 = "<continuation>";
      break _t930;
    }
    if (_t928._tag === 16) {
      const r = _t928._val;
      _t929 = (("ref(" + __dict_Show_string.show(Bytecode$pp_value(Ref$get(r)))) + ")");
      break _t930;
    }
    if (_t928._tag === 17) {
      const arr = _t928._val;
      _t929 = ("#[" + (String$concat("; ", Array$to_list(Array$map(Bytecode$pp_value, arr))) + "]"));
      break _t930;
    }
    _match_fail("line 16629");
  }
  return _t929;
}
function Bytecode$pp_capture(__x) {
  let _t945;
  const _t944 = __x;
  _t946: {
    if (_t944._tag === 0) {
      const i = _t944._val;
      _t945 = (("local(" + __dict_Show_int.show(i)) + ")");
      break _t946;
    }
    if (_t944._tag === 1) {
      const i = _t944._val;
      _t945 = (("upvalue(" + __dict_Show_int.show(i)) + ")");
      break _t946;
    }
    _match_fail("line 16629");
  }
  return _t945;
}
function Bytecode$pp_opcode(__x) {
  let _t948;
  const _t947 = __x;
  _t949: {
    if (_t947._tag === 0) {
      const i = _t947._val;
      _t948 = ("CONST " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 1) {
      _t948 = "POP";
      break _t949;
    }
    if (_t947._tag === 2) {
      _t948 = "DUP";
      break _t949;
    }
    if (_t947._tag === 3) {
      const i = _t947._val;
      _t948 = ("GET_LOCAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 4) {
      const i = _t947._val;
      _t948 = ("SET_LOCAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 5) {
      const i = _t947._val;
      _t948 = ("GET_UPVALUE " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 6) {
      const i = _t947._val;
      _t948 = ("SET_UPVALUE " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 7) {
      _t948 = "MAKE_REF";
      break _t949;
    }
    if (_t947._tag === 8) {
      _t948 = "DEREF";
      break _t949;
    }
    if (_t947._tag === 9) {
      _t948 = "SET_REF";
      break _t949;
    }
    if (_t947._tag === 10) {
      const i = _t947._val;
      _t948 = ("GET_GLOBAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 11) {
      const i = _t947._val;
      _t948 = ("SET_GLOBAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 12) {
      const i = _t947._val;
      _t948 = ("DEF_GLOBAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 13) {
      _t948 = "ADD";
      break _t949;
    }
    if (_t947._tag === 14) {
      _t948 = "SUB";
      break _t949;
    }
    if (_t947._tag === 15) {
      _t948 = "MUL";
      break _t949;
    }
    if (_t947._tag === 16) {
      _t948 = "DIV";
      break _t949;
    }
    if (_t947._tag === 17) {
      _t948 = "MOD";
      break _t949;
    }
    if (_t947._tag === 18) {
      _t948 = "NEG";
      break _t949;
    }
    if (_t947._tag === 19) {
      _t948 = "FADD";
      break _t949;
    }
    if (_t947._tag === 20) {
      _t948 = "FSUB";
      break _t949;
    }
    if (_t947._tag === 21) {
      _t948 = "FMUL";
      break _t949;
    }
    if (_t947._tag === 22) {
      _t948 = "FDIV";
      break _t949;
    }
    if (_t947._tag === 23) {
      _t948 = "FNEG";
      break _t949;
    }
    if (_t947._tag === 24) {
      _t948 = "EQ";
      break _t949;
    }
    if (_t947._tag === 25) {
      _t948 = "NEQ";
      break _t949;
    }
    if (_t947._tag === 26) {
      _t948 = "LT";
      break _t949;
    }
    if (_t947._tag === 27) {
      _t948 = "GT";
      break _t949;
    }
    if (_t947._tag === 28) {
      _t948 = "LE";
      break _t949;
    }
    if (_t947._tag === 29) {
      _t948 = "GE";
      break _t949;
    }
    if (_t947._tag === 30) {
      _t948 = "NOT";
      break _t949;
    }
    if (_t947._tag === 31) {
      _t948 = "BAND";
      break _t949;
    }
    if (_t947._tag === 32) {
      _t948 = "BOR";
      break _t949;
    }
    if (_t947._tag === 33) {
      _t948 = "BXOR";
      break _t949;
    }
    if (_t947._tag === 34) {
      _t948 = "BNOT";
      break _t949;
    }
    if (_t947._tag === 35) {
      _t948 = "BSHL";
      break _t949;
    }
    if (_t947._tag === 36) {
      _t948 = "BSHR";
      break _t949;
    }
    if (_t947._tag === 37) {
      const off = _t947._val;
      _t948 = ("JUMP " + __dict_Show_int.show(off));
      break _t949;
    }
    if (_t947._tag === 38) {
      const off = _t947._val;
      _t948 = ("JUMP_IF_FALSE " + __dict_Show_int.show(off));
      break _t949;
    }
    if (_t947._tag === 39) {
      const off = _t947._val;
      _t948 = ("JUMP_IF_TRUE " + __dict_Show_int.show(off));
      break _t949;
    }
    if (_t947._tag === 40) {
      const i = _t947._val[0];
      const caps = _t947._val[1];
      _t948 = (((("CLOSURE " + __dict_Show_int.show(i)) + " [") + __dict_Show_string.show(String$concat(", ", List$map(Bytecode$pp_capture, caps)))) + "]");
      break _t949;
    }
    if (_t947._tag === 41) {
      const i = _t947._val[0];
      const caps = _t947._val[1];
      const self = _t947._val[2];
      _t948 = ((((("CLOSURE_REC " + __dict_Show_int.show(i)) + " [") + __dict_Show_string.show(String$concat(", ", List$map(Bytecode$pp_capture, caps)))) + "] self=") + __dict_Show_int.show(self));
      break _t949;
    }
    if (_t947._tag === 42) {
      const n = _t947._val;
      _t948 = ("CALL " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 43) {
      const n = _t947._val;
      _t948 = ("TAIL_CALL " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 44) {
      _t948 = "RETURN";
      break _t949;
    }
    if (_t947._tag === 45) {
      _t948 = "FUNC_RETURN";
      break _t949;
    }
    if (_t947._tag === 46) {
      _t948 = "ENTER_FUNC";
      break _t949;
    }
    if (_t947._tag === 47) {
      _t948 = "EXIT_FUNC";
      break _t949;
    }
    if (_t947._tag === 48) {
      const n = _t947._val;
      _t948 = ("MAKE_TUPLE " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 49) {
      const i = _t947._val;
      _t948 = ("TUPLE_GET " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 50) {
      const fields = _t947._val;
      _t948 = (("MAKE_RECORD [" + __dict_Show_string.show(String$concat(", ", fields))) + "]");
      break _t949;
    }
    if (_t947._tag === 51) {
      const name = _t947._val;
      _t948 = ("FIELD " + __dict_Show_string.show(name));
      break _t949;
    }
    if (_t947._tag === 52) {
      const name = _t947._val;
      _t948 = ("SET_FIELD " + __dict_Show_string.show(name));
      break _t949;
    }
    if (_t947._tag === 53) {
      const fields = _t947._val;
      _t948 = (("RECORD_UPDATE [" + __dict_Show_string.show(String$concat(", ", fields))) + "]");
      break _t949;
    }
    if (_t947._tag === 54) {
      const n = _t947._val;
      _t948 = ("RECORD_UPDATE_DYN " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 55) {
      const tag = _t947._val[0];
      const name = _t947._val[1];
      const has_payload = _t947._val[2];
      _t948 = ((((("MAKE_VARIANT " + __dict_Show_int.show(tag)) + " ") + __dict_Show_string.show(name)) + " ") + __dict_Show_bool.show(has_payload));
      break _t949;
    }
    if (_t947._tag === 56) {
      _t948 = "CONS";
      break _t949;
    }
    if (_t947._tag === 57) {
      _t948 = "NIL";
      break _t949;
    }
    if (_t947._tag === 58) {
      const tag = _t947._val;
      _t948 = ("TAG_EQ " + __dict_Show_int.show(tag));
      break _t949;
    }
    if (_t947._tag === 59) {
      _t948 = "IS_NIL";
      break _t949;
    }
    if (_t947._tag === 60) {
      _t948 = "IS_CONS";
      break _t949;
    }
    if (_t947._tag === 61) {
      _t948 = "HEAD";
      break _t949;
    }
    if (_t947._tag === 62) {
      _t948 = "TAIL";
      break _t949;
    }
    if (_t947._tag === 63) {
      _t948 = "VARIANT_PAYLOAD";
      break _t949;
    }
    if (_t947._tag === 64) {
      const loc = _t947._val;
      _t948 = ("MATCH_FAIL " + __dict_Show_string.show(loc));
      break _t949;
    }
    if (_t947._tag === 65) {
      const op = _t947._val;
      _t948 = ("PERFORM " + __dict_Show_string.show(op));
      break _t949;
    }
    if (_t947._tag === 66) {
      const n = _t947._val;
      _t948 = ("HANDLE " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 67) {
      _t948 = "RESUME";
      break _t949;
    }
    if (_t947._tag === 68) {
      const n = _t947._val;
      _t948 = ("ENTER_LOOP " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 69) {
      _t948 = "EXIT_LOOP";
      break _t949;
    }
    if (_t947._tag === 70) {
      _t948 = "LOOP_BREAK";
      break _t949;
    }
    if (_t947._tag === 71) {
      const n = _t947._val;
      _t948 = ("LOOP_CONTINUE " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 72) {
      const n = _t947._val;
      _t948 = ("FOLD_CONTINUE " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 73) {
      const n = _t947._val;
      _t948 = ("MAKE_ARRAY " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 74) {
      _t948 = "INDEX";
      break _t949;
    }
    if (_t947._tag === 75) {
      _t948 = "HALT";
      break _t949;
    }
    if (_t947._tag === 76) {
      const slot = _t947._val[0];
      const arity = _t947._val[1];
      _t948 = ((("GET_LOCAL_CALL " + __dict_Show_int.show(slot)) + " ") + __dict_Show_int.show(arity));
      break _t949;
    }
    if (_t947._tag === 77) {
      const slot = _t947._val[0];
      const idx = _t947._val[1];
      _t948 = ((("GET_LOCAL_TUPLE_GET " + __dict_Show_int.show(slot)) + " ") + __dict_Show_int.show(idx));
      break _t949;
    }
    if (_t947._tag === 78) {
      const slot = _t947._val[0];
      const name = _t947._val[1];
      _t948 = ((("GET_LOCAL_FIELD " + __dict_Show_int.show(slot)) + " ") + __dict_Show_string.show(name));
      break _t949;
    }
    if (_t947._tag === 79) {
      const idx = _t947._val[0];
      const arity = _t947._val[1];
      _t948 = ((("GET_GLOBAL_CALL " + __dict_Show_int.show(idx)) + " ") + __dict_Show_int.show(arity));
      break _t949;
    }
    if (_t947._tag === 80) {
      const idx = _t947._val[0];
      const name = _t947._val[1];
      _t948 = ((("GET_GLOBAL_FIELD " + __dict_Show_int.show(idx)) + " ") + __dict_Show_string.show(name));
      break _t949;
    }
    if (_t947._tag === 81) {
      const min_tag = _t947._val[0];
      const targets = _t947._val[1];
      const _mml$default = _t947._val[2];
      _t948 = ((((("JUMP_TABLE min=" + __dict_Show_int.show(min_tag)) + " [") + __dict_Show_string.show(String$concat(",", Array$to_list(Array$map(string_of_int, targets))))) + "] default=") + __dict_Show_int.show(_mml$default));
      break _t949;
    }
    if (_t947._tag === 82) {
      const n = _t947._val;
      _t948 = ("CALL_N " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 83) {
      const n = _t947._val;
      _t948 = ("TAIL_CALL_N " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 84) {
      _t948 = "UPDATE_REC";
      break _t949;
    }
    _match_fail("line 16629");
  }
  return _t948;
}
function Bytecode$disassemble(__dict_Show_2, __dict_Show_1, __dict_Show_0, __ev_arity_r0, __ev_code_r0, __ev_line_table_r0, __ev_name_r0, __ev_num_locals_r0, proto) {
  const buf_950 = Buffer$create(256);
  Buffer$add_string(buf_950, (((((("=== " + __dict_Show_2.show(proto.name)) + " (arity=") + __dict_Show_1.show(proto.arity)) + ", locals=") + __dict_Show_0.show(proto.num_locals)) + ") ===\n"));
  const prev_line_952 = Ref$create(0);
  function _t954(i, op) {
    let _t955;
    if ((i < Array$length(proto.line_table))) {
      _t955 = Array$get(proto.line_table, i);
    } else {
      _t955 = 0;
    }
    const line_956 = _t955;
    let _t958;
    if (((line_956 > 0) && (line_956 !== Ref$get(prev_line_952)))) {
      Ref$set(prev_line_952, line_956);
      _t958 = __dict_Show_int.show(line_956);
    } else {
      _t958 = "   |";
    }
    const line_str_959 = _t958;
    const _t960 = Buffer$add_string(buf_950, (((((__dict_Show_string.show(line_str_959) + " ") + __fmt_zero_pad(4, __dict_Show_int.show(i))) + "  ") + __dict_Show_string.show(Bytecode$pp_opcode(op))) + "\n"));
    const _t957 = _t960;
    return _t957;
  }
  Array$iteri(_t954, proto.code);
  const _t953 = Buffer$contents(buf_950);
  const _t951 = _t953;
  return _t951;
}
function Types$mono(ty) {
  return ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: 0, record_evidences: null, rquant: 0});
}
const Types$next_id = Ref$create(0);
function Types$fresh_id(_) {
  const id_961 = Ref$get(Types$next_id);
  Ref$set(Types$next_id, (id_961 + 1));
  const _t962 = id_961;
  return _t962;
}
function Types$new_tvar(level) {
  return ({_tag: 15, _name: "TVar", _val: Ref$create(({_tag: 0, _name: "Unbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$new_effvar(level) {
  return ({_tag: 0, _name: "EffVar", _val: Ref$create(({_tag: 0, _name: "EffUnbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$new_pvvar(level) {
  return ({_tag: 1, _name: "PVVar", _val: Ref$create(({_tag: 0, _name: "PVUnbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$new_rvar(level) {
  return ({_tag: 1, _name: "RVar", _val: Ref$create(({_tag: 0, _name: "RUnbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$repr(__x) {
  let _t964;
  const _t963 = __x;
  _t965: {
    if (_t963._tag === 15 && _t963._val.contents._tag === 1) {
      const ty = _t963._val.contents._val;
      const r = _t963._val;
      const ty_966 = Types$repr(ty);
      Ref$set(r, ({_tag: 1, _name: "Link", _val: ty_966}));
      const _t967 = ty_966;
      _t964 = _t967;
      break _t965;
    }
    if (true) {
      const ty = _t963;
      _t964 = ty;
      break _t965;
    }
    _match_fail("line 16629");
  }
  return _t964;
}
function Types$is_concrete(ty) {
  while (true) {
    let _t969;
    const _t968 = Types$repr(ty);
    _t970: {
      if (_t968._tag === 15 && _t968._val.contents._tag === 0) {
        _t969 = false;
        break _t970;
      }
      if (_t968._tag === 15 && _t968._val.contents._tag === 1) {
        _t969 = failwith("assert false");
        break _t970;
      }
      if ((_t968._tag === 7 || _t968._tag === 8)) {
        const a = _t968._val[0];
        const eff = _t968._val[1];
        const r = _t968._val[2];
        _t969 = (Types$is_concrete(a) && (Types$is_concrete_eff(eff) && Types$is_concrete(r)));
        break _t970;
      }
      if (_t968._tag === 9) {
        const ts = _t968._val;
        _t969 = List$forall(Types$is_concrete, ts);
        break _t970;
      }
      if ((_t968._tag === 10 || _t968._tag === 13)) {
        const t = _t968._val;
        const _t971 = t;
        ty = _t971;
        continue;
        _t969 = undefined;
        break _t970;
      }
      if (_t968._tag === 12) {
        const args = _t968._val[1];
        _t969 = List$forall(Types$is_concrete, args);
        break _t970;
      }
      if ((((((((_t968._tag === 0 || _t968._tag === 1) || _t968._tag === 2) || _t968._tag === 3) || _t968._tag === 4) || _t968._tag === 5) || _t968._tag === 6) || _t968._tag === 16)) {
        _t969 = true;
        break _t970;
      }
      if (_t968._tag === 11) {
        const row = _t968._val;
        _t969 = Types$is_concrete_rrow(row);
        break _t970;
      }
      if (_t968._tag === 14) {
        const row = _t968._val;
        _t969 = Types$is_concrete_pv(row);
        break _t970;
      }
      _match_fail("line 16629");
    }
    return _t969;
  }
}
function Types$is_concrete_eff(__x) {
  while (true) {
    let _t973;
    const _t972 = __x;
    _t974: {
      if (_t972._tag === 0 && _t972._val.contents._tag === 1) {
        const eff = _t972._val.contents._val;
        const _t975 = eff;
        __x = _t975;
        continue;
        _t973 = undefined;
        break _t974;
      }
      if (_t972._tag === 0 && _t972._val.contents._tag === 0) {
        _t973 = false;
        break _t974;
      }
      if (_t972._tag === 2) {
        const tys = _t972._val[1];
        const tail = _t972._val[2];
        _t973 = (List$forall(Types$is_concrete, tys) && Types$is_concrete_eff(tail));
        break _t974;
      }
      if (_t972._tag === 1) {
        _t973 = true;
        break _t974;
      }
      if (_t972._tag === 3) {
        _t973 = true;
        break _t974;
      }
      _match_fail("line 16629");
    }
    return _t973;
  }
}
function Types$is_concrete_rrow(__x) {
  while (true) {
    let _t977;
    const _t976 = __x;
    _t978: {
      if (_t976._tag === 0) {
        const ty = _t976._val[1];
        const tail = _t976._val[2];
        _t977 = (Types$is_concrete(ty) && Types$is_concrete_rrow(tail));
        break _t978;
      }
      if (_t976._tag === 1 && _t976._val.contents._tag === 1) {
        const row = _t976._val.contents._val;
        const _t979 = row;
        __x = _t979;
        continue;
        _t977 = undefined;
        break _t978;
      }
      if (_t976._tag === 1 && _t976._val.contents._tag === 0) {
        _t977 = false;
        break _t978;
      }
      if (_t976._tag === 2) {
        _t977 = true;
        break _t978;
      }
      if ((_t976._tag === 3 || _t976._tag === 4)) {
        _t977 = true;
        break _t978;
      }
      _match_fail("line 16629");
    }
    return _t977;
  }
}
function Types$is_concrete_pv(__x) {
  while (true) {
    let _t981;
    const _t980 = __x;
    _t982: {
      if (_t980._tag === 0 && _t980._val[1]._tag === 1) {
        const ty = _t980._val[1]._val;
        const tail = _t980._val[2];
        _t981 = (Types$is_concrete(ty) && Types$is_concrete_pv(tail));
        break _t982;
      }
      if (_t980._tag === 0 && _t980._val[1]._tag === 0) {
        const tail = _t980._val[2];
        const _t983 = tail;
        __x = _t983;
        continue;
        _t981 = undefined;
        break _t982;
      }
      if (_t980._tag === 1 && _t980._val.contents._tag === 1) {
        const row = _t980._val.contents._val;
        const _t984 = row;
        __x = _t984;
        continue;
        _t981 = undefined;
        break _t982;
      }
      if (_t980._tag === 1 && _t980._val.contents._tag === 0) {
        _t981 = false;
        break _t982;
      }
      if (_t980._tag === 2) {
        _t981 = true;
        break _t982;
      }
      if (_t980._tag === 3) {
        _t981 = true;
        break _t982;
      }
      _match_fail("line 16629");
    }
    return _t981;
  }
}
function Types$eff_repr(__x) {
  let _t986;
  const _t985 = __x;
  _t987: {
    if (_t985._tag === 0 && _t985._val.contents._tag === 1) {
      const eff = _t985._val.contents._val;
      const r = _t985._val;
      const eff_988 = Types$eff_repr(eff);
      Ref$set(r, ({_tag: 1, _name: "EffLink", _val: eff_988}));
      const _t989 = eff_988;
      _t986 = _t989;
      break _t987;
    }
    if (true) {
      const eff = _t985;
      _t986 = eff;
      break _t987;
    }
    _match_fail("line 16629");
  }
  return _t986;
}
function Types$pv_repr(__x) {
  let _t991;
  const _t990 = __x;
  _t992: {
    if (_t990._tag === 1 && _t990._val.contents._tag === 1) {
      const row = _t990._val.contents._val;
      const r = _t990._val;
      const row_993 = Types$pv_repr(row);
      Ref$set(r, ({_tag: 1, _name: "PVLink", _val: row_993}));
      const _t994 = row_993;
      _t991 = _t994;
      break _t992;
    }
    if (true) {
      const row = _t990;
      _t991 = row;
      break _t992;
    }
    _match_fail("line 16629");
  }
  return _t991;
}
function Types$rrow_repr(__x) {
  let _t996;
  const _t995 = __x;
  _t997: {
    if (_t995._tag === 1 && _t995._val.contents._tag === 1) {
      const row = _t995._val.contents._val;
      const r = _t995._val;
      const row_998 = Types$rrow_repr(row);
      Ref$set(r, ({_tag: 1, _name: "RLink", _val: row_998}));
      const _t999 = row_998;
      _t996 = _t999;
      break _t997;
    }
    if (true) {
      const row = _t995;
      _t996 = row;
      break _t997;
    }
    _match_fail("line 16629");
  }
  return _t996;
}
function Types$fields_to_closed_row(fields) {
  function _t1000(__p35, acc) {
    let _t1002;
    const _t1001 = __p35;
    _t1003: {
      if (true) {
        const n = _t1001[0];
        const t = _t1001[1];
        _t1002 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
        break _t1003;
      }
      _match_fail("line 16629");
    }
    return _t1002;
  }
  return List$fold_right(_t1000, fields, ({_tag: 2, _name: "REmpty"}));
}
function Types$record_row_to_fields(row) {
  function collect(r) {
    let _t1005;
    const _t1004 = Types$rrow_repr(r);
    _t1006: {
      if (_t1004._tag === 0) {
        const n = _t1004._val[0];
        const t = _t1004._val[1];
        const tail = _t1004._val[2];
        _t1005 = ({_hd: [n, t], _tl: collect(tail)});
        break _t1006;
      }
      if (true) {
        _t1005 = null;
        break _t1006;
      }
      _match_fail("line 16629");
    }
    return _t1005;
  }
  const _t1007 = collect(row);
  return _t1007;
}
const Types$empty_type_env = ({classes: null, constructors: null, effects: null, hidden_ctor_types: null, hidden_types: null, instances: null, modules: null, mutable_fields: null, newtypes: null, records: null, type_aliases: null, type_synonyms: null, variants: null});
function Types$find_effect_op(type_env, op_name) {
  function _t1008(edef) {
    function _t1009(__p36) {
      let _t1011;
      const _t1010 = __p36;
      _t1012: {
        if (true) {
          const name = _t1010[0];
          const ty = _t1010[1];
          let _t1013;
          if ((name === op_name)) {
            _t1013 = ({_tag: 1, _name: "Some", _val: [edef.effect_name, ty]});
          } else {
            _t1013 = ({_tag: 0, _name: "None"});
          }
          _t1011 = _t1013;
          break _t1012;
        }
        _match_fail("line 16629");
      }
      return _t1011;
    }
    return List$find_map(_t1009, edef.effect_ops);
  }
  return List$find_map(_t1008, type_env.effects);
}
function Types$ty_to_str(__x) {
  let _t1015;
  const _t1014 = __x;
  _t1016: {
    if (_t1014._tag === 0) {
      _t1015 = "int";
      break _t1016;
    }
    if (_t1014._tag === 1) {
      _t1015 = "float";
      break _t1016;
    }
    if (_t1014._tag === 2) {
      _t1015 = "bool";
      break _t1016;
    }
    if (_t1014._tag === 3) {
      _t1015 = "string";
      break _t1016;
    }
    if (_t1014._tag === 4) {
      _t1015 = "byte";
      break _t1016;
    }
    if (_t1014._tag === 5) {
      _t1015 = "rune";
      break _t1016;
    }
    if (_t1014._tag === 6) {
      _t1015 = "unit";
      break _t1016;
    }
    if (_t1014._tag === 12 && _t1014._val[1] === null) {
      const name = _t1014._val[0];
      _t1015 = name;
      break _t1016;
    }
    if (_t1014._tag === 12) {
      const name = _t1014._val[0];
      const args = _t1014._val[1];
      _t1015 = (String$concat("_", List$map(Types$ty_to_str, args)) + ("_" + name));
      break _t1016;
    }
    if (_t1014._tag === 10) {
      const t = _t1014._val;
      _t1015 = (Types$ty_to_str(t) + "_list");
      break _t1016;
    }
    if (_t1014._tag === 13) {
      const t = _t1014._val;
      _t1015 = (Types$ty_to_str(t) + "_array");
      break _t1016;
    }
    if (_t1014._tag === 9) {
      const ts = _t1014._val;
      _t1015 = (String$concat("_", List$map(Types$ty_to_str, ts)) + "_tup");
      break _t1016;
    }
    if (_t1014._tag === 14) {
      _t1015 = "polyvar";
      break _t1016;
    }
    if (_t1014._tag === 16) {
      const i = _t1014._val;
      _t1015 = ("g" + __dict_Show_int.show(i));
      break _t1016;
    }
    if ((_t1014._tag === 7 || _t1014._tag === 8)) {
      _t1015 = "arrow";
      break _t1016;
    }
    if (_t1014._tag === 15) {
      _t1015 = "tvar";
      break _t1016;
    }
    if (true) {
      _t1015 = "ty_other";
      break _t1016;
    }
    _match_fail("line 16629");
  }
  return _t1015;
}
function Types$dict_name(__dict_Show_0, class_name, tys) {
  const ty_strs_1017 = List$map(Types$ty_to_str, tys);
  const _t1018 = ((("__dict_" + __dict_Show_0.show(class_name)) + "_") + __dict_Show_string.show(String$concat("__", ty_strs_1017)));
  return _t1018;
}
function Types$find_method_class(classes, method_name) {
  function _t1019(cls) {
    function _t1020(__p37) {
      let _t1022;
      const _t1021 = __p37;
      _t1023: {
        if (true) {
          const m = _t1021[0];
          _t1022 = (m === method_name);
          break _t1023;
        }
        _match_fail("line 16629");
      }
      return _t1022;
    }
    return List$exists(_t1020, cls.class_methods);
  }
  return List$find(_t1019, classes);
}
function Types$occurs_check(id, level, ty) {
  return _trampoline(function() {
    const _t1024 = Types$repr(ty);
    let _t1025 = false;
    if (!_t1025 && _t1024._tag === 15 && _t1024._val.contents._tag === 0) {
      const id2 = _t1024._val.contents._val[0];
      if ((id === id2)) {
        _t1025 = true;
        return _h["unify_error"]("occurs check: infinite type", function(_t1026) {
          return _bounce(function() {
            return _t1026;
          });
        });
      }
    }
    if (!_t1025 && _t1024._tag === 15 && _t1024._val.contents._tag === 0) {
      const id2 = _t1024._val.contents._val[0];
      const level2 = _t1024._val.contents._val[1];
      const r = _t1024._val;
      _t1025 = true;
      let _t1027;
      if ((level2 > level)) {
        _t1027 = Ref$set(r, ({_tag: 0, _name: "Unbound", _val: [id2, level]}));
      } else {
        _t1027 = undefined;
      }
      return _t1027;
    }
    if (!_t1025 && _t1024._tag === 15 && _t1024._val.contents._tag === 1) {
      _t1025 = true;
      return failwith("assert false");
    }
    if (!_t1025 && (_t1024._tag === 7 || _t1024._tag === 8)) {
      const a = _t1024._val[0];
      const eff = _t1024._val[1];
      const b = _t1024._val[2];
      _t1025 = true;
      Types$occurs_check(id, level, a);
      Types$occurs_check_eff_for_ty(id, level, eff);
      return Types$occurs_check(id, level, b);
    }
    if (!_t1025 && _t1024._tag === 9) {
      const ts = _t1024._val;
      _t1025 = true;
      return List$iter(_call(Types$occurs_check, [id, level]), ts);
    }
    if (!_t1025 && _t1024._tag === 10) {
      const t = _t1024._val;
      _t1025 = true;
      return Types$occurs_check(id, level, t);
    }
    if (!_t1025 && _t1024._tag === 13) {
      const t = _t1024._val;
      _t1025 = true;
      return Types$occurs_check(id, level, t);
    }
    if (!_t1025 && _t1024._tag === 11) {
      const row = _t1024._val;
      _t1025 = true;
      return Types$occurs_check_rrow_for_ty(id, level, row);
    }
    if (!_t1025 && _t1024._tag === 12) {
      const args = _t1024._val[1];
      _t1025 = true;
      return List$iter(_call(Types$occurs_check, [id, level]), args);
    }
    if (!_t1025 && _t1024._tag === 14) {
      const row = _t1024._val;
      _t1025 = true;
      return Types$occurs_check_pv_for_ty(id, level, row);
    }
    if (!_t1025 && (((((((_t1024._tag === 0 || _t1024._tag === 1) || _t1024._tag === 2) || _t1024._tag === 3) || _t1024._tag === 4) || _t1024._tag === 5) || _t1024._tag === 6) || _t1024._tag === 16)) {
      _t1025 = true;
      return undefined;
    }
    if (!_t1025) _match_fail("line 16629");
  }, Types$occurs_check);
}
function Types$occurs_check_pv_for_ty(id, level, row) {
  while (true) {
    let _t1029;
    const _t1028 = Types$pv_repr(row);
    _t1030: {
      if (_t1028._tag === 0) {
        const ty_opt = _t1028._val[1];
        const tail = _t1028._val[2];
        let _t1032;
        const _t1031 = ty_opt;
        _t1033: {
          if (_t1031._tag === 1) {
            const t = _t1031._val;
            _t1032 = Types$occurs_check(id, level, t);
            break _t1033;
          }
          if (_t1031._tag === 0) {
            _t1032 = undefined;
            break _t1033;
          }
          _match_fail("line 16629");
        }
        _t1032;
        const _t1034 = id;
        const _t1035 = level;
        const _t1036 = tail;
        id = _t1034;
        level = _t1035;
        row = _t1036;
        continue;
        _t1029 = undefined;
        break _t1030;
      }
      if (true) {
        _t1029 = undefined;
        break _t1030;
      }
      _match_fail("line 16629");
    }
    return _t1029;
  }
}
function Types$occurs_check_rrow_for_ty(id, level, row) {
  while (true) {
    let _t1038;
    const _t1037 = Types$rrow_repr(row);
    _t1039: {
      if (_t1037._tag === 0) {
        const ty = _t1037._val[1];
        const tail = _t1037._val[2];
        Types$occurs_check(id, level, ty);
        const _t1040 = id;
        const _t1041 = level;
        const _t1042 = tail;
        id = _t1040;
        level = _t1041;
        row = _t1042;
        continue;
        _t1038 = undefined;
        break _t1039;
      }
      if (true) {
        _t1038 = undefined;
        break _t1039;
      }
      _match_fail("line 16629");
    }
    return _t1038;
  }
}
function Types$occurs_check_eff_for_ty(id, level, eff) {
  while (true) {
    let _t1044;
    const _t1043 = Types$eff_repr(eff);
    _t1045: {
      if (_t1043._tag === 2) {
        const params = _t1043._val[1];
        const tail = _t1043._val[2];
        List$iter(_call(Types$occurs_check, [id, level]), params);
        const _t1046 = id;
        const _t1047 = level;
        const _t1048 = tail;
        id = _t1046;
        level = _t1047;
        eff = _t1048;
        continue;
        _t1044 = undefined;
        break _t1045;
      }
      if (true) {
        _t1044 = undefined;
        break _t1045;
      }
      _match_fail("line 16629");
    }
    return _t1044;
  }
}
function Types$occurs_check_eff(id, level, eff) {
  return _trampoline(function() {
    const _t1049 = Types$eff_repr(eff);
    let _t1050 = false;
    if (!_t1050 && _t1049._tag === 0 && _t1049._val.contents._tag === 0) {
      const id2 = _t1049._val.contents._val[0];
      if ((id === id2)) {
        _t1050 = true;
        return _h["unify_error"]("occurs check: infinite effect row", function(_t1051) {
          return _bounce(function() {
            return _t1051;
          });
        });
      }
    }
    if (!_t1050 && _t1049._tag === 0 && _t1049._val.contents._tag === 0) {
      const id2 = _t1049._val.contents._val[0];
      const level2 = _t1049._val.contents._val[1];
      const r = _t1049._val;
      _t1050 = true;
      let _t1052;
      if ((level2 > level)) {
        _t1052 = Ref$set(r, ({_tag: 0, _name: "EffUnbound", _val: [id2, level]}));
      } else {
        _t1052 = undefined;
      }
      return _t1052;
    }
    if (!_t1050 && _t1049._tag === 0 && _t1049._val.contents._tag === 1) {
      _t1050 = true;
      return failwith("assert false");
    }
    if (!_t1050 && _t1049._tag === 2) {
      const _params = _t1049._val[1];
      const tail = _t1049._val[2];
      _t1050 = true;
      return Types$occurs_check_eff(id, level, tail);
    }
    if (!_t1050 && (_t1049._tag === 1 || _t1049._tag === 3)) {
      _t1050 = true;
      return undefined;
    }
    if (!_t1050) _match_fail("line 16629");
  }, Types$occurs_check_eff);
}
function Types$occurs_check_pv(id, level, row) {
  return _trampoline(function() {
    const _t1053 = Types$pv_repr(row);
    let _t1054 = false;
    if (!_t1054 && _t1053._tag === 1 && _t1053._val.contents._tag === 0) {
      const id2 = _t1053._val.contents._val[0];
      if ((id === id2)) {
        _t1054 = true;
        return _h["unify_error"]("occurs check: infinite polymorphic variant row", function(_t1055) {
          return _bounce(function() {
            return _t1055;
          });
        });
      }
    }
    if (!_t1054 && _t1053._tag === 1 && _t1053._val.contents._tag === 0) {
      const id2 = _t1053._val.contents._val[0];
      const level2 = _t1053._val.contents._val[1];
      const r = _t1053._val;
      _t1054 = true;
      let _t1056;
      if ((level2 > level)) {
        _t1056 = Ref$set(r, ({_tag: 0, _name: "PVUnbound", _val: [id2, level]}));
      } else {
        _t1056 = undefined;
      }
      return _t1056;
    }
    if (!_t1054 && _t1053._tag === 1 && _t1053._val.contents._tag === 1) {
      _t1054 = true;
      return failwith("assert false");
    }
    if (!_t1054 && _t1053._tag === 0) {
      const ty_opt = _t1053._val[1];
      const tail = _t1053._val[2];
      _t1054 = true;
      let _t1058;
      const _t1057 = ty_opt;
      _t1059: {
        if (_t1057._tag === 1) {
          const t = _t1057._val;
          _t1058 = Types$occurs_check(id, level, t);
          break _t1059;
        }
        if (_t1057._tag === 0) {
          _t1058 = undefined;
          break _t1059;
        }
        _match_fail("line 16629");
      }
      _t1058;
      return Types$occurs_check_pv(id, level, tail);
    }
    if (!_t1054 && (_t1053._tag === 2 || _t1053._tag === 3)) {
      _t1054 = true;
      return undefined;
    }
    if (!_t1054) _match_fail("line 16629");
  }, Types$occurs_check_pv);
}
function Types$occurs_check_rrow(id, level, row) {
  return _trampoline(function() {
    const _t1060 = Types$rrow_repr(row);
    let _t1061 = false;
    if (!_t1061 && _t1060._tag === 1 && _t1060._val.contents._tag === 0) {
      const id2 = _t1060._val.contents._val[0];
      if ((id === id2)) {
        _t1061 = true;
        return _h["unify_error"]("occurs check: infinite record row", function(_t1062) {
          return _bounce(function() {
            return _t1062;
          });
        });
      }
    }
    if (!_t1061 && _t1060._tag === 1 && _t1060._val.contents._tag === 0) {
      const id2 = _t1060._val.contents._val[0];
      const level2 = _t1060._val.contents._val[1];
      const r = _t1060._val;
      _t1061 = true;
      let _t1063;
      if ((level2 > level)) {
        _t1063 = Ref$set(r, ({_tag: 0, _name: "RUnbound", _val: [id2, level]}));
      } else {
        _t1063 = undefined;
      }
      return _t1063;
    }
    if (!_t1061 && _t1060._tag === 1 && _t1060._val.contents._tag === 1) {
      _t1061 = true;
      return failwith("assert false");
    }
    if (!_t1061 && _t1060._tag === 0) {
      const ty = _t1060._val[1];
      const tail = _t1060._val[2];
      _t1061 = true;
      Types$occurs_check(id, level, ty);
      return Types$occurs_check_rrow(id, level, tail);
    }
    if (!_t1061 && ((_t1060._tag === 2 || _t1060._tag === 3) || _t1060._tag === 4)) {
      _t1061 = true;
      return undefined;
    }
    if (!_t1061) _match_fail("line 16629");
  }, Types$occurs_check_rrow);
}
const Types$pp_synonyms = Ref$create(null);
function _t1064(_) {
  return "?";
}
const Types$pp_ty_arg_ref = Ref$create(_t1064);
function Types$try_match_synonym(ty) {
  const synonyms_1065 = Ref$get(Types$pp_synonyms);
  let _t1067;
  if (_eq(synonyms_1065, null)) {
    _t1067 = ({_tag: 0, _name: "None"});
  } else {
    function _t1068(__p38) {
      let _t1070;
      const _t1069 = __p38;
      _t1071: {
        if (true) {
          const name = _t1069[0];
          const num_params = _t1069[1];
          const pattern = _t1069[2];
          const bindings_1072 = Array$make(num_params, ({_tag: 0, _name: "None"}));
          function go(pat, actual) {
            while (true) {
              const actual_1074 = Types$repr(actual);
              let _t1077;
              const _t1076 = [pat, actual_1074];
              _t1078: {
                if (_t1076[0]._tag === 16) {
                  const i = _t1076[0]._val;
                  if ((i < num_params)) {
                    let _t1080;
                    const _t1079 = Array$get(bindings_1072, i);
                    _t1081: {
                      if (_t1079._tag === 0) {
                        Array$set(bindings_1072, i, ({_tag: 1, _name: "Some", _val: actual_1074}));
                        _t1080 = true;
                        break _t1081;
                      }
                      if (_t1079._tag === 1) {
                        const prev = _t1079._val;
                        _t1080 = _eq(prev, actual_1074);
                        break _t1081;
                      }
                      _match_fail("line 16629");
                    }
                    _t1077 = _t1080;
                    break _t1078;
                  }
                }
                if (((((((_t1076[0]._tag === 0 && _t1076[1]._tag === 0 || _t1076[0]._tag === 1 && _t1076[1]._tag === 1) || _t1076[0]._tag === 2 && _t1076[1]._tag === 2) || _t1076[0]._tag === 3 && _t1076[1]._tag === 3) || _t1076[0]._tag === 6 && _t1076[1]._tag === 6) || _t1076[0]._tag === 4 && _t1076[1]._tag === 4) || _t1076[0]._tag === 5 && _t1076[1]._tag === 5)) {
                  _t1077 = true;
                  break _t1078;
                }
                if ((_t1076[0]._tag === 7 && _t1076[1]._tag === 7 || _t1076[0]._tag === 8 && _t1076[1]._tag === 8)) {
                  const p1 = _t1076[0]._val[0];
                  const _pe = _t1076[0]._val[1];
                  const p2 = _t1076[0]._val[2];
                  const a1 = _t1076[1]._val[0];
                  const _ae = _t1076[1]._val[1];
                  const a2 = _t1076[1]._val[2];
                  _t1077 = (go(p1, a1) && go(p2, a2));
                  break _t1078;
                }
                if (_t1076[0]._tag === 10 && _t1076[1]._tag === 10) {
                  const p1 = _t1076[0]._val;
                  const a1 = _t1076[1]._val;
                  const _t1082 = p1;
                  const _t1083 = a1;
                  pat = _t1082;
                  actual = _t1083;
                  continue;
                  _t1077 = undefined;
                  break _t1078;
                }
                if (_t1076[0]._tag === 13 && _t1076[1]._tag === 13) {
                  const p1 = _t1076[0]._val;
                  const a1 = _t1076[1]._val;
                  const _t1084 = p1;
                  const _t1085 = a1;
                  pat = _t1084;
                  actual = _t1085;
                  continue;
                  _t1077 = undefined;
                  break _t1078;
                }
                if (_t1076[0]._tag === 9 && _t1076[1]._tag === 9) {
                  const ps = _t1076[0]._val;
                  const acts = _t1076[1]._val;
                  if ((List$length(ps) === List$length(acts))) {
                    _t1077 = List$forall2(go, ps, acts);
                    break _t1078;
                  }
                }
                if (_t1076[0]._tag === 12 && _t1076[1]._tag === 12) {
                  const pn = _t1076[0]._val[0];
                  const ps = _t1076[0]._val[1];
                  const an = _t1076[1]._val[0];
                  const acts = _t1076[1]._val[1];
                  if (((pn === an) && (List$length(ps) === List$length(acts)))) {
                    _t1077 = List$forall2(go, ps, acts);
                    break _t1078;
                  }
                }
                if (_t1076[0]._tag === 15 && _t1076[1]._tag === 15) {
                  const r1 = _t1076[0]._val;
                  const r2 = _t1076[1]._val;
                  if (_eq(r1, r2)) {
                    _t1077 = true;
                    break _t1078;
                  }
                }
                if (_t1076[0]._tag === 16 && _t1076[1]._tag === 16) {
                  const i = _t1076[0]._val;
                  const j = _t1076[1]._val;
                  if ((i === j)) {
                    _t1077 = true;
                    break _t1078;
                  }
                }
                if (true) {
                  _t1077 = false;
                  break _t1078;
                }
                _match_fail("line 16629");
              }
              const _t1075 = _t1077;
              return _t1075;
            }
          }
          let _t1088;
          if (go(pattern, ty)) {
          function _t1087(x) {
            return !_eq(x, ({_tag: 0, _name: "None"}));
          }
            _t1088 = Array$forall(_t1087, bindings_1072);
          } else {
            _t1088 = false;
          }
          let _t1089;
          if (_t1088) {
            function _t1090(x) {
              return Option$unwrap(x);
            }
            _t1089 = ({_tag: 1, _name: "Some", _val: [name, Array$to_list(Array$map(_t1090, bindings_1072))]});
          } else {
            _t1089 = ({_tag: 0, _name: "None"});
          }
          const _t1086 = _t1089;
          const _t1073 = _t1086;
          _t1070 = _t1073;
          break _t1071;
        }
        _match_fail("line 16629");
      }
      return _t1070;
    }
    _t1067 = List$find_map(_t1068, synonyms_1065);
  }
  const _t1066 = _t1067;
  return _t1066;
}
function Types$pp_eff(eff) {
  let _t1092;
  const _t1091 = Types$eff_repr(eff);
  _t1093: {
    if (_t1091._tag === 1) {
      _t1092 = "";
      break _t1093;
    }
    if (_t1091._tag === 0 && _t1091._val.contents._tag === 0) {
      const id = _t1091._val.contents._val[0];
      _t1092 = ("'" + String$make(1, Byte$of_int((Byte$to_int(101) + (id % 22)))));
      break _t1093;
    }
    if (_t1091._tag === 2) {
      const label = _t1091._val[0];
      const params = _t1091._val[1];
      const tail = _t1091._val[2];
      let _t1095;
      const _t1094 = params;
      _t1096: {
        if (_t1094 === null) {
          _t1095 = "";
          break _t1096;
        }
        if (true) {
          const ps = _t1094;
          _t1095 = (" " + String$concat(" ", List$map(_call(Ref$get, [Types$pp_ty_arg_ref]), ps)));
          break _t1096;
        }
        _match_fail("line 16629");
      }
      const param_str_1097 = _t1095;
      let _t1100;
      const _t1099 = Types$eff_repr(tail);
      _t1101: {
        if (_t1099._tag === 1) {
          _t1100 = "";
          break _t1101;
        }
        if (_t1099._tag === 0 && _t1099._val.contents._tag === 0) {
          _t1100 = (", " + Types$pp_eff(tail));
          break _t1101;
        }
        if (_t1099._tag === 2) {
          _t1100 = (", " + Types$pp_eff(tail));
          break _t1101;
        }
        if (true) {
          _t1100 = "";
          break _t1101;
        }
        _match_fail("line 16629");
      }
      const tail_str_1102 = _t1100;
      const _t1103 = (label + (param_str_1097 + tail_str_1102));
      const _t1098 = _t1103;
      _t1092 = _t1098;
      break _t1093;
    }
    if (_t1091._tag === 3) {
      const id = _t1091._val;
      _t1092 = ("'" + String$make(1, Byte$of_int((Byte$to_int(101) + (id % 22)))));
      break _t1093;
    }
    if (_t1091._tag === 0 && _t1091._val.contents._tag === 1) {
      _t1092 = failwith("assert false");
      break _t1093;
    }
    _match_fail("line 16629");
  }
  return _t1092;
}
function Types$eff_is_trivial(eff) {
  let _t1105;
  const _t1104 = Types$eff_repr(eff);
  _t1106: {
    if (_t1104._tag === 1) {
      _t1105 = true;
      break _t1106;
    }
    if (_t1104._tag === 0 && _t1104._val.contents._tag === 0) {
      _t1105 = true;
      break _t1106;
    }
    if (_t1104._tag === 3) {
      _t1105 = true;
      break _t1106;
    }
    if (true) {
      _t1105 = false;
      break _t1106;
    }
    _match_fail("line 16629");
  }
  return _t1105;
}
function Types$pp_ty(ty) {
  const ty_1107 = Types$repr(ty);
  let _t1110;
  const _t1109 = Types$try_match_synonym(ty_1107);
  _t1111: {
    if (_t1109._tag === 1) {
      const name = _t1109._val[0];
      const args = _t1109._val[1];
      let _t1113;
      const _t1112 = ty_1107;
      _t1114: {
        if ((_t1112._tag === 7 || _t1112._tag === 8)) {
          const a = _t1112._val[0];
          if (!_eq(Types$try_match_synonym(Types$repr(a)), ({_tag: 0, _name: "None"}))) {
            _t1113 = Types$pp_ty_raw(ty_1107);
            break _t1114;
          }
        }
        if (true) {
          _t1113 = Types$pp_type_con(name, args);
          break _t1114;
        }
        _match_fail("line 16629");
      }
      _t1110 = _t1113;
      break _t1111;
    }
    if (_t1109._tag === 0) {
      _t1110 = Types$pp_ty_raw(ty_1107);
      break _t1111;
    }
    _match_fail("line 16629");
  }
  const _t1108 = _t1110;
  return _t1108;
}
function Types$pp_type_con(name, __x) {
  let _t1116;
  const _t1115 = __x;
  _t1117: {
    if (_t1115 === null) {
      _t1116 = name;
      break _t1117;
    }
    if (_t1115 !== null && _t1115._tl === null) {
      const arg = _t1115._hd;
      let _t1119;
      const _t1118 = Types$repr(arg);
      _t1120: {
        if (((_t1118._tag === 7 || _t1118._tag === 8) || _t1118._tag === 9)) {
          _t1119 = ("(" + (Types$pp_ty(arg) + ")"));
          break _t1120;
        }
        if (true) {
          _t1119 = Types$pp_ty(arg);
          break _t1120;
        }
        _match_fail("line 16629");
      }
      _t1116 = (_t1119 + (" " + name));
      break _t1117;
    }
    if (true) {
      const args = _t1115;
      _t1116 = ("(" + (String$concat(", ", List$map(Types$pp_ty, args)) + (") " + name)));
      break _t1117;
    }
    _match_fail("line 16629");
  }
  return _t1116;
}
function Types$needs_parens(ty) {
  const ty_1121 = Types$repr(ty);
  let _t1124;
  const _t1123 = Types$try_match_synonym(ty_1121);
  _t1125: {
    if (_t1123._tag === 1) {
      _t1124 = false;
      break _t1125;
    }
    if (_t1123._tag === 0) {
      let _t1127;
      const _t1126 = ty_1121;
      _t1128: {
        if (((_t1126._tag === 7 || _t1126._tag === 8) || _t1126._tag === 9)) {
          _t1127 = true;
          break _t1128;
        }
        if (true) {
          _t1127 = false;
          break _t1128;
        }
        _match_fail("line 16629");
      }
      _t1124 = _t1127;
      break _t1125;
    }
    _match_fail("line 16629");
  }
  const _t1122 = _t1124;
  return _t1122;
}
function Types$pp_ty_arg(ty) {
  let _t1129;
  if (Types$needs_parens(ty)) {
    _t1129 = ("(" + (Types$pp_ty(ty) + ")"));
  } else {
    _t1129 = Types$pp_ty(ty);
  }
  return _t1129;
}
function Types$pp_ty_raw(ty) {
  let _t1131;
  const _t1130 = ty;
  _t1132: {
    if (_t1130._tag === 0) {
      _t1131 = "int";
      break _t1132;
    }
    if (_t1130._tag === 1) {
      _t1131 = "float";
      break _t1132;
    }
    if (_t1130._tag === 2) {
      _t1131 = "bool";
      break _t1132;
    }
    if (_t1130._tag === 3) {
      _t1131 = "string";
      break _t1132;
    }
    if (_t1130._tag === 4) {
      _t1131 = "byte";
      break _t1132;
    }
    if (_t1130._tag === 5) {
      _t1131 = "rune";
      break _t1132;
    }
    if (_t1130._tag === 6) {
      _t1131 = "unit";
      break _t1132;
    }
    if (_t1130._tag === 7) {
      const a = _t1130._val[0];
      const eff = _t1130._val[1];
      const r = _t1130._val[2];
      let _t1134;
      const _t1133 = Types$repr(a);
      _t1135: {
        if (_t1133._tag === 7) {
          if (_eq(Types$try_match_synonym(Types$repr(a)), ({_tag: 0, _name: "None"}))) {
            _t1134 = ("(" + (Types$pp_ty(a) + ")"));
            break _t1135;
          }
        }
        if (true) {
          _t1134 = Types$pp_ty(a);
          break _t1135;
        }
        _match_fail("line 16629");
      }
      const a_str_1136 = _t1134;
      let _t1138;
      if (Types$eff_is_trivial(eff)) {
        _t1138 = (a_str_1136 + (" -> " + Types$pp_ty(r)));
      } else {
        _t1138 = (a_str_1136 + (" -> " + (Types$pp_ty(r) + (" / " + Types$pp_eff(eff)))));
      }
      const _t1137 = _t1138;
      _t1131 = _t1137;
      break _t1132;
    }
    if (_t1130._tag === 8) {
      const a = _t1130._val[0];
      const eff = _t1130._val[1];
      const r = _t1130._val[2];
      let _t1140;
      const _t1139 = Types$repr(a);
      _t1141: {
        if ((_t1139._tag === 7 || _t1139._tag === 8)) {
          if (_eq(Types$try_match_synonym(Types$repr(a)), ({_tag: 0, _name: "None"}))) {
            _t1140 = ("(" + (Types$pp_ty(a) + ")"));
            break _t1141;
          }
        }
        if (true) {
          _t1140 = Types$pp_ty(a);
          break _t1141;
        }
        _match_fail("line 16629");
      }
      const a_str_1142 = _t1140;
      let _t1144;
      if (Types$eff_is_trivial(eff)) {
        _t1144 = (a_str_1142 + (" -> " + Types$pp_ty(r)));
      } else {
        _t1144 = (a_str_1142 + (" -> " + (Types$pp_ty(r) + (" / " + Types$pp_eff(eff)))));
      }
      const _t1143 = _t1144;
      const inner_1145 = _t1143;
      const _t1146 = ("continuation(" + (inner_1145 + ")"));
      _t1131 = _t1146;
      break _t1132;
    }
    if (_t1130._tag === 9) {
      const ts = _t1130._val;
      function _t1147(t) {
        let _t1149;
        const _t1148 = Types$repr(t);
        _t1150: {
          if ((_t1148._tag === 7 || _t1148._tag === 8)) {
            if (_eq(Types$try_match_synonym(Types$repr(t)), ({_tag: 0, _name: "None"}))) {
              _t1149 = ("(" + (Types$pp_ty(t) + ")"));
              break _t1150;
            }
          }
          if (true) {
            _t1149 = Types$pp_ty(t);
            break _t1150;
          }
          _match_fail("line 16629");
        }
        return _t1149;
      }
      _t1131 = String$concat(" * ", List$map(_t1147, ts));
      break _t1132;
    }
    if (_t1130._tag === 10) {
      const t = _t1130._val;
      _t1131 = (Types$pp_ty_arg(t) + " list");
      break _t1132;
    }
    if (_t1130._tag === 13) {
      const t = _t1130._val;
      _t1131 = (Types$pp_ty_arg(t) + " array");
      break _t1132;
    }
    if (_t1130._tag === 11) {
      const row = _t1130._val;
      function collect(r) {
        let _t1152;
        const _t1151 = Types$rrow_repr(r);
        _t1153: {
          if (_t1151._tag === 0) {
            const name = _t1151._val[0];
            const ty = _t1151._val[1];
            const tail = _t1151._val[2];
            _t1152 = ({_hd: [name, ty], _tl: collect(tail)});
            break _t1153;
          }
          if (true) {
            _t1152 = null;
            break _t1153;
          }
          _match_fail("line 16629");
        }
        return _t1152;
      }
      function is_open(r) {
        while (true) {
          let _t1156;
          const _t1155 = Types$rrow_repr(r);
          _t1157: {
            if (_t1155._tag === 0) {
              const tail = _t1155._val[2];
              const _t1158 = tail;
              r = _t1158;
              continue;
              _t1156 = undefined;
              break _t1157;
            }
            if (((_t1155._tag === 1 && _t1155._val.contents._tag === 0 || _t1155._tag === 3) || _t1155._tag === 4)) {
              _t1156 = true;
              break _t1157;
            }
            if (true) {
              _t1156 = false;
              break _t1157;
            }
            _match_fail("line 16629");
          }
          return _t1156;
        }
      }
      function _t1160(__p39) {
        let _t1162;
        const _t1161 = __p39;
        _t1163: {
          if (true) {
            const n = _t1161[0];
            const t = _t1161[1];
            _t1162 = (n + (": " + Types$pp_ty(t)));
            break _t1163;
          }
          _match_fail("line 16629");
        }
        return _t1162;
      }
      const fields_str_1164 = String$concat("; ", List$map(_t1160, collect(row)));
      let _t1166;
      if (is_open(row)) {
        let _t1167;
        if ((fields_str_1164 === "")) {
          _t1167 = "..";
        } else {
          _t1167 = "; ..";
        }
        _t1166 = ("{ " + (fields_str_1164 + (_t1167 + " }")));
      } else {
        _t1166 = ("{ " + (fields_str_1164 + " }"));
      }
      const _t1165 = _t1166;
      const _t1159 = _t1165;
      const _t1154 = _t1159;
      _t1131 = _t1154;
      break _t1132;
    }
    if (_t1130._tag === 12 && _t1130._val[1] === null) {
      const name = _t1130._val[0];
      _t1131 = name;
      break _t1132;
    }
    if (_t1130._tag === 12 && _t1130._val[1] !== null && _t1130._val[1]._tl === null) {
      const name = _t1130._val[0];
      const arg = _t1130._val[1]._hd;
      _t1131 = (Types$pp_ty_arg(arg) + (" " + name));
      break _t1132;
    }
    if (_t1130._tag === 12) {
      const name = _t1130._val[0];
      const args = _t1130._val[1];
      _t1131 = ("(" + (String$concat(", ", List$map(Types$pp_ty, args)) + (") " + name)));
      break _t1132;
    }
    if (_t1130._tag === 14) {
      const row = _t1130._val;
      function collect_tags(r) {
        let _t1169;
        const _t1168 = Types$pv_repr(r);
        _t1170: {
          if (_t1168._tag === 0) {
            const tag = _t1168._val[0];
            const ty_opt = _t1168._val[1];
            const tail = _t1168._val[2];
            _t1169 = ({_hd: [tag, ty_opt], _tl: collect_tags(tail)});
            break _t1170;
          }
          if (true) {
            _t1169 = null;
            break _t1170;
          }
          _match_fail("line 16629");
        }
        return _t1169;
      }
      let _t1173;
      const _t1172 = Types$pv_repr(row);
      _t1174: {
        if (_t1172._tag === 1) {
          _t1173 = true;
          break _t1174;
        }
        if (_t1172._tag === 0) {
          function check(r) {
            while (true) {
              let _t1176;
              const _t1175 = Types$pv_repr(r);
              _t1177: {
                if (_t1175._tag === 0) {
                  const tail = _t1175._val[2];
                  const _t1178 = tail;
                  r = _t1178;
                  continue;
                  _t1176 = undefined;
                  break _t1177;
                }
                if (_t1175._tag === 1) {
                  _t1176 = true;
                  break _t1177;
                }
                if (true) {
                  _t1176 = false;
                  break _t1177;
                }
                _match_fail("line 16629");
              }
              return _t1176;
            }
          }
          const _t1179 = check(row);
          _t1173 = _t1179;
          break _t1174;
        }
        if (true) {
          _t1173 = false;
          break _t1174;
        }
        _match_fail("line 16629");
      }
      const is_open_1180 = _t1173;
      const tags_1182 = collect_tags(row);
      function _t1184(__p40) {
        let _t1186;
        const _t1185 = __p40;
        _t1187: {
          if (true) {
            const tag = _t1185[0];
            const ty_opt = _t1185[1];
            let _t1189;
            const _t1188 = ty_opt;
            _t1190: {
              if (_t1188._tag === 0) {
                _t1189 = ("`" + tag);
                break _t1190;
              }
              if (_t1188._tag === 1) {
                const t = _t1188._val;
                _t1189 = ("`" + (tag + (" of " + Types$pp_ty(t))));
                break _t1190;
              }
              _match_fail("line 16629");
            }
            _t1186 = _t1189;
            break _t1187;
          }
          _match_fail("line 16629");
        }
        return _t1186;
      }
      const tag_strs_1191 = List$map(_t1184, tags_1182);
      let _t1193;
      if (is_open_1180) {
        _t1193 = "> ";
      } else {
        _t1193 = "";
      }
      const marker_1194 = _t1193;
      const _t1195 = ("[" + (marker_1194 + (String$concat(" | ", tag_strs_1191) + "]")));
      const _t1192 = _t1195;
      const _t1183 = _t1192;
      const _t1181 = _t1183;
      const _t1171 = _t1181;
      _t1131 = _t1171;
      break _t1132;
    }
    if (_t1130._tag === 15 && _t1130._val.contents._tag === 0) {
      const id = _t1130._val.contents._val[0];
      _t1131 = ("'" + String$make(1, Byte$of_int((Byte$to_int(97) + (id % 26)))));
      break _t1132;
    }
    if (_t1130._tag === 15 && _t1130._val.contents._tag === 1) {
      _t1131 = failwith("assert false");
      break _t1132;
    }
    if (_t1130._tag === 16) {
      const id = _t1130._val;
      _t1131 = ("'" + String$make(1, Byte$of_int((Byte$to_int(97) + (id % 26)))));
      break _t1132;
    }
    _match_fail("line 16629");
  }
  return _t1131;
}
const Types$__destruct = Ref$set(Types$pp_ty_arg_ref, Types$pp_ty_arg);
function Types$unify_error(t1, t2) {
  return _trampoline(function() {
    return _h["unify_error"](((("cannot unify " + __dict_Show_string.show(Types$pp_ty(t1))) + " with ") + __dict_Show_string.show(Types$pp_ty(t2))), function(_t1196) {
      return _bounce(function() {
        return _t1196;
      });
    });
  }, Types$unify_error);
}
function Types$unify_eff(e1, e2) {
  return _trampoline(function() {
    const e1_1197 = _resolve(Types$eff_repr(e1));
    const e2_1198 = _resolve(Types$eff_repr(e2));
    if (_eq(e1_1197, e2_1198)) {
      return undefined;
    } else {
      const _t1199 = [e1_1197, e2_1198];
      let _t1200 = false;
      if (!_t1200 && (_t1199[0]._tag === 0 && _t1199[0]._val.contents._tag === 0 || _t1199[1]._tag === 0 && _t1199[1]._val.contents._tag === 0)) {
        const id = (_t1199[0]._tag === 0 && _t1199[0]._val.contents._tag === 0 ? _t1199[0]._val.contents._val[0] : _t1199[1]._val.contents._val[0]);
        const level = (_t1199[0]._tag === 0 && _t1199[0]._val.contents._tag === 0 ? _t1199[0]._val.contents._val[1] : _t1199[1]._val.contents._val[1]);
        const r = (_t1199[0]._tag === 0 && _t1199[0]._val.contents._tag === 0 ? _t1199[0]._val : _t1199[1]._val);
        const eff = (_t1199[0]._tag === 0 && _t1199[0]._val.contents._tag === 0 ? _t1199[1] : _t1199[0]);
        _t1200 = true;
        Types$occurs_check_eff(id, level, eff);
        return Ref$set(r, ({_tag: 1, _name: "EffLink", _val: eff}));
      }
      if (!_t1200 && _t1199[0]._tag === 1 && _t1199[1]._tag === 1) {
        _t1200 = true;
        return undefined;
      }
      if (!_t1200 && _t1199[0]._tag === 2 && _t1199[1]._tag === 2) {
        const label1 = _t1199[0]._val[0];
        const params1 = _t1199[0]._val[1];
        const tail1 = _t1199[0]._val[2];
        const label2 = _t1199[1]._val[0];
        const params2 = _t1199[1]._val[1];
        const tail2 = _t1199[1]._val[2];
        if (((label1 === label2) && (List$length(params1) === List$length(params2)))) {
          _t1200 = true;
          List$iter2(Types$unify, params1, params2);
          return Types$unify_eff(tail1, tail2);
        }
      }
      if (!_t1200 && _t1199[0]._tag === 2) {
        const label1 = _t1199[0]._val[0];
        const params1 = _t1199[0]._val[1];
        const tail1 = _t1199[0]._val[2];
        _t1200 = true;
        const tail2_1201 = Types$rewrite_row(label1, params1, e2_1198);
        const _t1202 = Types$unify_eff(tail1, tail2_1201);
        return _t1202;
      }
      if (!_t1200 && _t1199[1]._tag === 2) {
        _t1200 = true;
        return Types$unify_eff(e2_1198, e1_1197);
      }
      if (!_t1200 && _t1199[0]._tag === 3 && _t1199[1]._tag === 3) {
        const i = _t1199[0]._val;
        const j = _t1199[1]._val;
        if ((i === j)) {
          _t1200 = true;
          return undefined;
        }
      }
      if (!_t1200 && true) {
        _t1200 = true;
        return _h["unify_error"](((("cannot unify effects " + __dict_Show_string.show(Types$pp_eff(e1_1197))) + " and ") + __dict_Show_string.show(Types$pp_eff(e2_1198))), function(_t1203) {
          return _bounce(function() {
            return _t1203;
          });
        });
      }
      if (!_t1200) _match_fail("line 16629");
    }
  }, Types$unify_eff);
}
function Types$rewrite_row(label, params_to_unify, eff) {
  return _trampoline(function() {
    const _t1204 = Types$eff_repr(eff);
    let _t1205 = false;
    if (!_t1205 && _t1204._tag === 2) {
      const l = _t1204._val[0];
      const found_params = _t1204._val[1];
      const tail = _t1204._val[2];
      if ((l === label)) {
        _t1205 = true;
        let _t1206;
        if ((List$length(params_to_unify) === List$length(found_params))) {
          _t1206 = List$iter2(Types$unify, params_to_unify, found_params);
        } else {
          _t1206 = undefined;
        }
        _t1206;
        return tail;
      }
    }
    if (!_t1205 && _t1204._tag === 2) {
      const l = _t1204._val[0];
      const params = _t1204._val[1];
      const tail = _t1204._val[2];
      _t1205 = true;
      return ({_tag: 2, _name: "EffRow", _val: [l, params, Types$rewrite_row(label, params_to_unify, tail)]});
    }
    if (!_t1205 && _t1204._tag === 0 && _t1204._val.contents._tag === 0) {
      const id = _t1204._val.contents._val[0];
      const level = _t1204._val.contents._val[1];
      const r = _t1204._val;
      _t1205 = true;
      const new_tail_1207 = Types$new_effvar(level);
      const new_row_1209 = ({_tag: 2, _name: "EffRow", _val: [label, params_to_unify, new_tail_1207]});
      Types$occurs_check_eff(id, level, new_row_1209);
      Ref$set(r, ({_tag: 1, _name: "EffLink", _val: new_row_1209}));
      const _t1210 = new_tail_1207;
      const _t1208 = _t1210;
      return _t1208;
    }
    if (!_t1205 && _t1204._tag === 1) {
      _t1205 = true;
      return _h["unify_error"]((("effect " + __dict_Show_string.show(label)) + " not handled"), function(_t1211) {
        return _bounce(function() {
          return _t1211;
        });
      });
    }
    if (!_t1205 && true) {
      _t1205 = true;
      return _h["unify_error"](("cannot rewrite effect row for " + __dict_Show_string.show(label)), function(_t1212) {
        return _bounce(function() {
          return _t1212;
        });
      });
    }
    if (!_t1205) _match_fail("line 16629");
  }, Types$rewrite_row);
}
function Types$subeffect(source, target) {
  while (true) {
    const source_1213 = Types$eff_repr(source);
    const target_1215 = Types$eff_repr(target);
    let _t1217;
    if (_eq(source_1213, target_1215)) {
      _t1217 = undefined;
    } else {
      let _t1219;
      const _t1218 = source_1213;
      _t1220: {
        if (_t1218._tag === 1) {
          _t1219 = undefined;
          break _t1220;
        }
        if (_t1218._tag === 0 && _t1218._val.contents._tag === 0) {
          _t1219 = Types$unify_eff(source_1213, target_1215);
          break _t1220;
        }
        if (_t1218._tag === 2) {
          const label = _t1218._val[0];
          const params = _t1218._val[1];
          const tail = _t1218._val[2];
          const target_tail_1221 = Types$rewrite_row(label, params, target_1215);
          const _t1223 = Types$eff_repr(tail);
          const _t1224 = target_tail_1221;
          source = _t1223;
          target = _t1224;
          continue;
          const _t1222 = undefined;
          _t1219 = _t1222;
          break _t1220;
        }
        if (_t1218._tag === 3) {
          _t1219 = undefined;
          break _t1220;
        }
        if (true) {
          _t1219 = Types$unify_eff(source_1213, target_1215);
          break _t1220;
        }
        _match_fail("line 16629");
      }
      _t1217 = _t1219;
    }
    const _t1216 = _t1217;
    const _t1214 = _t1216;
    return _t1214;
  }
}
function Types$unify_pv_row(r1, r2) {
  return _trampoline(function() {
    const r1_1225 = _resolve(Types$pv_repr(r1));
    const r2_1226 = _resolve(Types$pv_repr(r2));
    if (_eq(r1_1225, r2_1226)) {
      return undefined;
    } else {
      const _t1227 = [r1_1225, r2_1226];
      let _t1228 = false;
      if (!_t1228 && (_t1227[0]._tag === 1 && _t1227[0]._val.contents._tag === 0 || _t1227[1]._tag === 1 && _t1227[1]._val.contents._tag === 0)) {
        const id = (_t1227[0]._tag === 1 && _t1227[0]._val.contents._tag === 0 ? _t1227[0]._val.contents._val[0] : _t1227[1]._val.contents._val[0]);
        const level = (_t1227[0]._tag === 1 && _t1227[0]._val.contents._tag === 0 ? _t1227[0]._val.contents._val[1] : _t1227[1]._val.contents._val[1]);
        const r = (_t1227[0]._tag === 1 && _t1227[0]._val.contents._tag === 0 ? _t1227[0]._val : _t1227[1]._val);
        const row = (_t1227[0]._tag === 1 && _t1227[0]._val.contents._tag === 0 ? _t1227[1] : _t1227[0]);
        _t1228 = true;
        Types$occurs_check_pv(id, level, row);
        return Ref$set(r, ({_tag: 1, _name: "PVLink", _val: row}));
      }
      if (!_t1228 && _t1227[0]._tag === 2 && _t1227[1]._tag === 2) {
        _t1228 = true;
        return undefined;
      }
      if (!_t1228 && _t1227[0]._tag === 0 && _t1227[1]._tag === 0) {
        const tag1 = _t1227[0]._val[0];
        const ty1 = _t1227[0]._val[1];
        const tail1 = _t1227[0]._val[2];
        const tag2 = _t1227[1]._val[0];
        const ty2 = _t1227[1]._val[1];
        const tail2 = _t1227[1]._val[2];
        if ((tag1 === tag2)) {
          _t1228 = true;
          Types$unify_pv_payload(ty1, ty2);
          return Types$unify_pv_row(tail1, tail2);
        }
      }
      if (!_t1228 && _t1227[0]._tag === 0) {
        const tag1 = _t1227[0]._val[0];
        const ty1 = _t1227[0]._val[1];
        const tail1 = _t1227[0]._val[2];
        _t1228 = true;
        let _t1230;
        const _t1229 = Types$rewrite_pv_row(tag1, ty1, r2_1226);
        _t1231: {
          if (true) {
            const ty2 = _t1229[0];
            const tail2 = _t1229[1];
            Types$unify_pv_payload(ty1, ty2);
            _t1230 = Types$unify_pv_row(tail1, tail2);
            break _t1231;
          }
          _match_fail("line 16629");
        }
        return _t1230;
      }
      if (!_t1228 && _t1227[1]._tag === 0) {
        _t1228 = true;
        return Types$unify_pv_row(r2_1226, r1_1225);
      }
      if (!_t1228 && _t1227[0]._tag === 3 && _t1227[1]._tag === 3) {
        const i = _t1227[0]._val;
        const j = _t1227[1]._val;
        if ((i === j)) {
          _t1228 = true;
          return undefined;
        }
      }
      if (!_t1228 && true) {
        _t1228 = true;
        return _h["unify_error"]("cannot unify polymorphic variant types", function(_t1232) {
          return _bounce(function() {
            return _t1232;
          });
        });
      }
      if (!_t1228) _match_fail("line 16629");
    }
  }, Types$unify_pv_row);
}
function Types$unify_pv_payload(ty1, ty2) {
  return _trampoline(function() {
    const _t1233 = [ty1, ty2];
    let _t1234 = false;
    if (!_t1234 && _t1233[0]._tag === 0 && _t1233[1]._tag === 0) {
      _t1234 = true;
      return undefined;
    }
    if (!_t1234 && _t1233[0]._tag === 1 && _t1233[1]._tag === 1) {
      const t1 = _t1233[0]._val;
      const t2 = _t1233[1]._val;
      _t1234 = true;
      return Types$unify(t1, t2);
    }
    if (!_t1234 && true) {
      _t1234 = true;
      return _h["unify_error"]("polymorphic variant payload mismatch", function(_t1235) {
        return _bounce(function() {
          return _t1235;
        });
      });
    }
    if (!_t1234) _match_fail("line 16629");
  }, Types$unify_pv_payload);
}
function Types$rewrite_pv_row(tag, default_payload, row) {
  return _trampoline(function() {
    const _t1236 = Types$pv_repr(row);
    let _t1237 = false;
    if (!_t1237 && _t1236._tag === 0) {
      const t = _t1236._val[0];
      const ty_opt = _t1236._val[1];
      const tail = _t1236._val[2];
      if ((t === tag)) {
        _t1237 = true;
        return [ty_opt, tail];
      }
    }
    if (!_t1237 && _t1236._tag === 0) {
      const t = _t1236._val[0];
      const ty_opt = _t1236._val[1];
      const tail = _t1236._val[2];
      _t1237 = true;
      let _t1239;
      const _t1238 = Types$rewrite_pv_row(tag, default_payload, tail);
      _t1240: {
        if (true) {
          const found = _t1238[0];
          const rest = _t1238[1];
          _t1239 = [found, ({_tag: 0, _name: "PVRow", _val: [t, ty_opt, rest]})];
          break _t1240;
        }
        _match_fail("line 16629");
      }
      return _t1239;
    }
    if (!_t1237 && _t1236._tag === 1 && _t1236._val.contents._tag === 0) {
      const id = _t1236._val.contents._val[0];
      const level = _t1236._val.contents._val[1];
      const r = _t1236._val;
      _t1237 = true;
      const new_tail_1241 = Types$new_pvvar(level);
      const new_row_1243 = ({_tag: 0, _name: "PVRow", _val: [tag, default_payload, new_tail_1241]});
      Types$occurs_check_pv(id, level, new_row_1243);
      Ref$set(r, ({_tag: 1, _name: "PVLink", _val: new_row_1243}));
      const _t1244 = [default_payload, new_tail_1241];
      const _t1242 = _t1244;
      return _t1242;
    }
    if (!_t1237 && _t1236._tag === 2) {
      _t1237 = true;
      return _h["unify_error"]((("tag `" + __dict_Show_string.show(tag)) + " not in closed polymorphic variant type"), function(_t1245) {
        return _bounce(function() {
          return _t1245;
        });
      });
    }
    if (!_t1237 && true) {
      _t1237 = true;
      return _h["unify_error"](("cannot rewrite polymorphic variant row for `" + __dict_Show_string.show(tag)), function(_t1246) {
        return _bounce(function() {
          return _t1246;
        });
      });
    }
    if (!_t1237) _match_fail("line 16629");
  }, Types$rewrite_pv_row);
}
function Types$unify_record_row(r1, r2) {
  return _trampoline(function() {
    const r1_1247 = _resolve(Types$rrow_repr(r1));
    const r2_1248 = _resolve(Types$rrow_repr(r2));
    if (_eq(r1_1247, r2_1248)) {
      return undefined;
    } else {
      const _t1249 = [r1_1247, r2_1248];
      let _t1250 = false;
      if (!_t1250 && (_t1249[0]._tag === 1 && _t1249[0]._val.contents._tag === 0 || _t1249[1]._tag === 1 && _t1249[1]._val.contents._tag === 0)) {
        const id = (_t1249[0]._tag === 1 && _t1249[0]._val.contents._tag === 0 ? _t1249[0]._val.contents._val[0] : _t1249[1]._val.contents._val[0]);
        const level = (_t1249[0]._tag === 1 && _t1249[0]._val.contents._tag === 0 ? _t1249[0]._val.contents._val[1] : _t1249[1]._val.contents._val[1]);
        const r = (_t1249[0]._tag === 1 && _t1249[0]._val.contents._tag === 0 ? _t1249[0]._val : _t1249[1]._val);
        const row = (_t1249[0]._tag === 1 && _t1249[0]._val.contents._tag === 0 ? _t1249[1] : _t1249[0]);
        _t1250 = true;
        Types$occurs_check_rrow(id, level, row);
        return Ref$set(r, ({_tag: 1, _name: "RLink", _val: row}));
      }
      if (!_t1250 && (_t1249[0]._tag === 4 || _t1249[1]._tag === 4)) {
        _t1250 = true;
        return undefined;
      }
      if (!_t1250 && _t1249[0]._tag === 2 && _t1249[1]._tag === 2) {
        _t1250 = true;
        return undefined;
      }
      if (!_t1250 && _t1249[0]._tag === 0 && _t1249[1]._tag === 0) {
        const f1 = _t1249[0]._val[0];
        const ty1 = _t1249[0]._val[1];
        const tail1 = _t1249[0]._val[2];
        const f2 = _t1249[1]._val[0];
        const ty2 = _t1249[1]._val[1];
        const tail2 = _t1249[1]._val[2];
        if ((f1 === f2)) {
          _t1250 = true;
          Types$unify(ty1, ty2);
          return Types$unify_record_row(tail1, tail2);
        }
      }
      if (!_t1250 && _t1249[0]._tag === 0) {
        const f1 = _t1249[0]._val[0];
        const ty1 = _t1249[0]._val[1];
        const tail1 = _t1249[0]._val[2];
        _t1250 = true;
        let _t1252;
        const _t1251 = Types$rewrite_record_row(f1, r2_1248);
        _t1253: {
          if (true) {
            const ty2 = _t1251[0];
            const tail2 = _t1251[1];
            Types$unify(ty1, ty2);
            _t1252 = Types$unify_record_row(tail1, tail2);
            break _t1253;
          }
          _match_fail("line 16629");
        }
        return _t1252;
      }
      if (!_t1250 && _t1249[1]._tag === 0) {
        _t1250 = true;
        return Types$unify_record_row(r2_1248, r1_1247);
      }
      if (!_t1250 && _t1249[0]._tag === 3 && _t1249[1]._tag === 3) {
        const i = _t1249[0]._val;
        const j = _t1249[1]._val;
        if ((i === j)) {
          _t1250 = true;
          return undefined;
        }
      }
      if (!_t1250 && true) {
        _t1250 = true;
        return _h["unify_error"]("cannot unify record types", function(_t1254) {
          return _bounce(function() {
            return _t1254;
          });
        });
      }
      if (!_t1250) _match_fail("line 16629");
    }
  }, Types$unify_record_row);
}
function Types$rewrite_record_row(field, row) {
  return _trampoline(function() {
    const _t1255 = Types$rrow_repr(row);
    let _t1256 = false;
    if (!_t1256 && _t1255._tag === 0) {
      const f = _t1255._val[0];
      const ty = _t1255._val[1];
      const tail = _t1255._val[2];
      if ((f === field)) {
        _t1256 = true;
        return [ty, tail];
      }
    }
    if (!_t1256 && _t1255._tag === 0) {
      const f = _t1255._val[0];
      const ty = _t1255._val[1];
      const tail = _t1255._val[2];
      _t1256 = true;
      let _t1258;
      const _t1257 = Types$rewrite_record_row(field, tail);
      _t1259: {
        if (true) {
          const found = _t1257[0];
          const rest = _t1257[1];
          _t1258 = [found, ({_tag: 0, _name: "RRow", _val: [f, ty, rest]})];
          break _t1259;
        }
        _match_fail("line 16629");
      }
      return _t1258;
    }
    if (!_t1256 && _t1255._tag === 1 && _t1255._val.contents._tag === 0) {
      const id = _t1255._val.contents._val[0];
      const level = _t1255._val.contents._val[1];
      const r = _t1255._val;
      _t1256 = true;
      const new_tail_1260 = Types$new_rvar(level);
      const field_ty_1262 = Types$new_tvar(level);
      const new_row_1264 = ({_tag: 0, _name: "RRow", _val: [field, field_ty_1262, new_tail_1260]});
      Types$occurs_check_rrow(id, level, new_row_1264);
      Ref$set(r, ({_tag: 1, _name: "RLink", _val: new_row_1264}));
      const _t1265 = [field_ty_1262, new_tail_1260];
      const _t1263 = _t1265;
      const _t1261 = _t1263;
      return _t1261;
    }
    if (!_t1256 && _t1255._tag === 4) {
      _t1256 = true;
      const field_ty_1266 = Types$new_tvar(0);
      const _t1267 = [field_ty_1266, ({_tag: 4, _name: "RWild"})];
      return _t1267;
    }
    if (!_t1256 && _t1255._tag === 2) {
      _t1256 = true;
      return _h["unify_error"](("record has no field " + __dict_Show_string.show(field)), function(_t1268) {
        return _bounce(function() {
          return _t1268;
        });
      });
    }
    if (!_t1256 && true) {
      _t1256 = true;
      return _h["unify_error"](("cannot rewrite record row for " + __dict_Show_string.show(field)), function(_t1269) {
        return _bounce(function() {
          return _t1269;
        });
      });
    }
    if (!_t1256) _match_fail("line 16629");
  }, Types$rewrite_record_row);
}
function Types$unify(t1, t2) {
  while (true) {
    const t1_1270 = Types$repr(t1);
    const t2_1272 = Types$repr(t2);
    let _t1274;
    if (_eq(t1_1270, t2_1272)) {
      _t1274 = undefined;
    } else {
      let _t1276;
      const _t1275 = [t1_1270, t2_1272];
      _t1277: {
        if ((_t1275[0]._tag === 15 && _t1275[0]._val.contents._tag === 0 || _t1275[1]._tag === 15 && _t1275[1]._val.contents._tag === 0)) {
          const id = (_t1275[0]._tag === 15 && _t1275[0]._val.contents._tag === 0 ? _t1275[0]._val.contents._val[0] : _t1275[1]._val.contents._val[0]);
          const level = (_t1275[0]._tag === 15 && _t1275[0]._val.contents._tag === 0 ? _t1275[0]._val.contents._val[1] : _t1275[1]._val.contents._val[1]);
          const r = (_t1275[0]._tag === 15 && _t1275[0]._val.contents._tag === 0 ? _t1275[0]._val : _t1275[1]._val);
          const ty = (_t1275[0]._tag === 15 && _t1275[0]._val.contents._tag === 0 ? _t1275[1] : _t1275[0]);
          Types$occurs_check(id, level, ty);
          _t1276 = Ref$set(r, ({_tag: 1, _name: "Link", _val: ty}));
          break _t1277;
        }
        if ((_t1275[0]._tag === 7 && _t1275[1]._tag === 7 || _t1275[0]._tag === 8 && _t1275[1]._tag === 8)) {
          const a1 = _t1275[0]._val[0];
          const e1 = _t1275[0]._val[1];
          const r1 = _t1275[0]._val[2];
          const a2 = _t1275[1]._val[0];
          const e2 = _t1275[1]._val[1];
          const r2 = _t1275[1]._val[2];
          Types$unify(a1, a2);
          Types$unify_eff(e1, e2);
          const _t1278 = r1;
          const _t1279 = r2;
          t1 = _t1278;
          t2 = _t1279;
          continue;
          _t1276 = undefined;
          break _t1277;
        }
        if (_t1275[0]._tag === 9 && _t1275[1]._tag === 9) {
          const ts1 = _t1275[0]._val;
          const ts2 = _t1275[1]._val;
          let _t1280;
          if ((List$length(ts1) !== List$length(ts2))) {
            _t1280 = Types$unify_error(t1_1270, t2_1272);
          } else {
            _t1280 = undefined;
          }
          _t1280;
          _t1276 = List$iter2(Types$unify, ts1, ts2);
          break _t1277;
        }
        if (_t1275[0]._tag === 10 && _t1275[1]._tag === 10) {
          const t1$p = _t1275[0]._val;
          const t2$p = _t1275[1]._val;
          const _t1281 = t1$p;
          const _t1282 = t2$p;
          t1 = _t1281;
          t2 = _t1282;
          continue;
          _t1276 = undefined;
          break _t1277;
        }
        if (_t1275[0]._tag === 13 && _t1275[1]._tag === 13) {
          const t1$p = _t1275[0]._val;
          const t2$p = _t1275[1]._val;
          const _t1283 = t1$p;
          const _t1284 = t2$p;
          t1 = _t1283;
          t2 = _t1284;
          continue;
          _t1276 = undefined;
          break _t1277;
        }
        if (_t1275[0]._tag === 11 && _t1275[1]._tag === 11) {
          const r1 = _t1275[0]._val;
          const r2 = _t1275[1]._val;
          _t1276 = Types$unify_record_row(r1, r2);
          break _t1277;
        }
        if (((((((_t1275[0]._tag === 0 && _t1275[1]._tag === 0 || _t1275[0]._tag === 1 && _t1275[1]._tag === 1) || _t1275[0]._tag === 2 && _t1275[1]._tag === 2) || _t1275[0]._tag === 3 && _t1275[1]._tag === 3) || _t1275[0]._tag === 4 && _t1275[1]._tag === 4) || _t1275[0]._tag === 5 && _t1275[1]._tag === 5) || _t1275[0]._tag === 6 && _t1275[1]._tag === 6)) {
          _t1276 = undefined;
          break _t1277;
        }
        if (_t1275[0]._tag === 12 && _t1275[1]._tag === 12) {
          const a = _t1275[0]._val[0];
          const args_a = _t1275[0]._val[1];
          const b = _t1275[1]._val[0];
          const args_b = _t1275[1]._val[1];
          if ((a === b)) {
            let _t1285;
            if ((List$length(args_a) !== List$length(args_b))) {
              _t1285 = Types$unify_error(t1_1270, t2_1272);
            } else {
              _t1285 = undefined;
            }
            _t1285;
            _t1276 = List$iter2(Types$unify, args_a, args_b);
            break _t1277;
          }
        }
        if (_t1275[0]._tag === 14 && _t1275[1]._tag === 14) {
          const r1 = _t1275[0]._val;
          const r2 = _t1275[1]._val;
          _t1276 = Types$unify_pv_row(r1, r2);
          break _t1277;
        }
        if (true) {
          _t1276 = Types$unify_error(t1_1270, t2_1272);
          break _t1277;
        }
        _match_fail("line 16629");
      }
      _t1274 = _t1276;
    }
    const _t1273 = _t1274;
    const _t1271 = _t1273;
    return _t1271;
  }
}
function Types$generalize(level, ty) {
  let _t1287;
  const _t1286 = Hashtbl$create(8);
  _t1288: {
    if (true) {
      const id_map = _t1286;
      const counter_1289 = Ref$create(0);
      let _t1292;
      const _t1291 = Hashtbl$create(4);
      _t1293: {
        if (true) {
          const eff_id_map = _t1291;
          const ecounter_1294 = Ref$create(0);
          let _t1297;
          const _t1296 = Hashtbl$create(4);
          _t1298: {
            if (true) {
              const pv_id_map = _t1296;
              const pvcounter_1299 = Ref$create(0);
              let _t1302;
              const _t1301 = Hashtbl$create(4);
              _t1303: {
                if (true) {
                  const r_id_map = _t1301;
                  const rcounter_1304 = Ref$create(0);
                  function go(ty) {
                    let _t1307;
                    const _t1306 = Types$repr(ty);
                    _t1308: {
                      if (_t1306._tag === 15 && _t1306._val.contents._tag === 0) {
                        const id = _t1306._val.contents._val[0];
                        const level$p = _t1306._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1310;
                          const _t1309 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, id]);
                          _t1311: {
                            if (_t1309._tag === 1) {
                              const gen_id = _t1309._val;
                              _t1310 = ({_tag: 16, _name: "TGen", _val: gen_id});
                              break _t1311;
                            }
                            if (_t1309._tag === 0) {
                              const gen_id_1312 = Ref$get(counter_1289);
                              Ref$set(counter_1289, (gen_id_1312 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, id_map, id, gen_id_1312]);
                              const _t1313 = ({_tag: 16, _name: "TGen", _val: gen_id_1312});
                              _t1310 = _t1313;
                              break _t1311;
                            }
                            _match_fail("line 16629");
                          }
                          _t1307 = _t1310;
                          break _t1308;
                        }
                      }
                      if (_t1306._tag === 15 && _t1306._val.contents._tag === 0) {
                        const t = _t1306;
                        _t1307 = t;
                        break _t1308;
                      }
                      if (_t1306._tag === 15 && _t1306._val.contents._tag === 1) {
                        _t1307 = failwith("assert false");
                        break _t1308;
                      }
                      if (_t1306._tag === 7) {
                        const a = _t1306._val[0];
                        const eff = _t1306._val[1];
                        const r = _t1306._val[2];
                        _t1307 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1308;
                      }
                      if (_t1306._tag === 8) {
                        const a = _t1306._val[0];
                        const eff = _t1306._val[1];
                        const r = _t1306._val[2];
                        _t1307 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1308;
                      }
                      if (_t1306._tag === 9) {
                        const ts = _t1306._val;
                        _t1307 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
                        break _t1308;
                      }
                      if (_t1306._tag === 10) {
                        const t = _t1306._val;
                        _t1307 = ({_tag: 10, _name: "TList", _val: go(t)});
                        break _t1308;
                      }
                      if (_t1306._tag === 13) {
                        const t = _t1306._val;
                        _t1307 = ({_tag: 13, _name: "TArray", _val: go(t)});
                        break _t1308;
                      }
                      if (_t1306._tag === 11) {
                        const row = _t1306._val;
                        _t1307 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
                        break _t1308;
                      }
                      if (_t1306._tag === 12) {
                        const name = _t1306._val[0];
                        const args = _t1306._val[1];
                        _t1307 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
                        break _t1308;
                      }
                      if (_t1306._tag === 14) {
                        const row = _t1306._val;
                        _t1307 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
                        break _t1308;
                      }
                      if (true) {
                        const t = _t1306;
                        _t1307 = t;
                        break _t1308;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1307;
                  }
                  function go_eff(eff) {
                    let _t1315;
                    const _t1314 = Types$eff_repr(eff);
                    _t1316: {
                      if (_t1314._tag === 0 && _t1314._val.contents._tag === 0) {
                        const id = _t1314._val.contents._val[0];
                        const level$p = _t1314._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1318;
                          const _t1317 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id]);
                          _t1319: {
                            if (_t1317._tag === 1) {
                              const gen_id = _t1317._val;
                              _t1318 = ({_tag: 3, _name: "EffGen", _val: gen_id});
                              break _t1319;
                            }
                            if (_t1317._tag === 0) {
                              const gen_id_1320 = Ref$get(ecounter_1294);
                              Ref$set(ecounter_1294, (gen_id_1320 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id, gen_id_1320]);
                              const _t1321 = ({_tag: 3, _name: "EffGen", _val: gen_id_1320});
                              _t1318 = _t1321;
                              break _t1319;
                            }
                            _match_fail("line 16629");
                          }
                          _t1315 = _t1318;
                          break _t1316;
                        }
                      }
                      if (_t1314._tag === 0 && _t1314._val.contents._tag === 0) {
                        const e = _t1314;
                        _t1315 = e;
                        break _t1316;
                      }
                      if (_t1314._tag === 0 && _t1314._val.contents._tag === 1) {
                        _t1315 = failwith("assert false");
                        break _t1316;
                      }
                      if (_t1314._tag === 2) {
                        const label = _t1314._val[0];
                        const params = _t1314._val[1];
                        const tail = _t1314._val[2];
                        _t1315 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
                        break _t1316;
                      }
                      if (_t1314._tag === 1) {
                        _t1315 = ({_tag: 1, _name: "EffEmpty"});
                        break _t1316;
                      }
                      if (_t1314._tag === 3) {
                        const e = _t1314;
                        _t1315 = e;
                        break _t1316;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1315;
                  }
                  function go_pv(row) {
                    let _t1323;
                    const _t1322 = Types$pv_repr(row);
                    _t1324: {
                      if (_t1322._tag === 1 && _t1322._val.contents._tag === 0) {
                        const id = _t1322._val.contents._val[0];
                        const level$p = _t1322._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1326;
                          const _t1325 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id]);
                          _t1327: {
                            if (_t1325._tag === 1) {
                              const gen_id = _t1325._val;
                              _t1326 = ({_tag: 3, _name: "PVGen", _val: gen_id});
                              break _t1327;
                            }
                            if (_t1325._tag === 0) {
                              const gen_id_1328 = Ref$get(pvcounter_1299);
                              Ref$set(pvcounter_1299, (gen_id_1328 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id, gen_id_1328]);
                              const _t1329 = ({_tag: 3, _name: "PVGen", _val: gen_id_1328});
                              _t1326 = _t1329;
                              break _t1327;
                            }
                            _match_fail("line 16629");
                          }
                          _t1323 = _t1326;
                          break _t1324;
                        }
                      }
                      if (_t1322._tag === 1 && _t1322._val.contents._tag === 0) {
                        const r = _t1322;
                        _t1323 = r;
                        break _t1324;
                      }
                      if (_t1322._tag === 1 && _t1322._val.contents._tag === 1) {
                        _t1323 = failwith("assert false");
                        break _t1324;
                      }
                      if (_t1322._tag === 0) {
                        const tag = _t1322._val[0];
                        const ty_opt = _t1322._val[1];
                        const tail = _t1322._val[2];
                        _t1323 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
                        break _t1324;
                      }
                      if (_t1322._tag === 2) {
                        _t1323 = ({_tag: 2, _name: "PVEmpty"});
                        break _t1324;
                      }
                      if (_t1322._tag === 3) {
                        const r = _t1322;
                        _t1323 = r;
                        break _t1324;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1323;
                  }
                  function go_rrow(row) {
                    let _t1331;
                    const _t1330 = Types$rrow_repr(row);
                    _t1332: {
                      if (_t1330._tag === 1 && _t1330._val.contents._tag === 0) {
                        const id = _t1330._val.contents._val[0];
                        const level$p = _t1330._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1334;
                          const _t1333 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, r_id_map, id]);
                          _t1335: {
                            if (_t1333._tag === 1) {
                              const gen_id = _t1333._val;
                              _t1334 = ({_tag: 3, _name: "RGen", _val: gen_id});
                              break _t1335;
                            }
                            if (_t1333._tag === 0) {
                              const gen_id_1336 = Ref$get(rcounter_1304);
                              Ref$set(rcounter_1304, (gen_id_1336 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, r_id_map, id, gen_id_1336]);
                              const _t1337 = ({_tag: 3, _name: "RGen", _val: gen_id_1336});
                              _t1334 = _t1337;
                              break _t1335;
                            }
                            _match_fail("line 16629");
                          }
                          _t1331 = _t1334;
                          break _t1332;
                        }
                      }
                      if (_t1330._tag === 1 && _t1330._val.contents._tag === 0) {
                        const r = _t1330;
                        _t1331 = r;
                        break _t1332;
                      }
                      if (_t1330._tag === 1 && _t1330._val.contents._tag === 1) {
                        _t1331 = failwith("assert false");
                        break _t1332;
                      }
                      if (_t1330._tag === 0) {
                        const name = _t1330._val[0];
                        const ty = _t1330._val[1];
                        const tail = _t1330._val[2];
                        _t1331 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
                        break _t1332;
                      }
                      if (_t1330._tag === 2) {
                        _t1331 = ({_tag: 2, _name: "REmpty"});
                        break _t1332;
                      }
                      if (_t1330._tag === 3) {
                        const r = _t1330;
                        _t1331 = r;
                        break _t1332;
                      }
                      if (_t1330._tag === 4) {
                        _t1331 = ({_tag: 4, _name: "RWild"});
                        break _t1332;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1331;
                  }
                  const body_1339 = go(ty);
                  const _t1340 = ({body: body_1339, constraints: null, equant: Ref$get(ecounter_1294), pvquant: Ref$get(pvcounter_1299), quant: Ref$get(counter_1289), record_evidences: null, rquant: Ref$get(rcounter_1304)});
                  const _t1338 = _t1340;
                  const _t1305 = _t1338;
                  _t1302 = _t1305;
                  break _t1303;
                }
                _match_fail("line 16629");
              }
              const _t1300 = _t1302;
              _t1297 = _t1300;
              break _t1298;
            }
            _match_fail("line 16629");
          }
          const _t1295 = _t1297;
          _t1292 = _t1295;
          break _t1293;
        }
        _match_fail("line 16629");
      }
      const _t1290 = _t1292;
      _t1287 = _t1290;
      break _t1288;
    }
    _match_fail("line 16629");
  }
  return _t1287;
}
function Types$generalize_with_map(level, ty) {
  const counter_1341 = Ref$create(0);
  let _t1344;
  const _t1343 = Hashtbl$create(8);
  _t1345: {
    if (true) {
      const id_map = _t1343;
      const ecounter_1346 = Ref$create(0);
      let _t1349;
      const _t1348 = Hashtbl$create(4);
      _t1350: {
        if (true) {
          const eff_id_map = _t1348;
          const pvcounter_1351 = Ref$create(0);
          let _t1354;
          const _t1353 = Hashtbl$create(4);
          _t1355: {
            if (true) {
              const pv_id_map = _t1353;
              const rcounter_1356 = Ref$create(0);
              let _t1359;
              const _t1358 = Hashtbl$create(4);
              _t1360: {
                if (true) {
                  const r_id_map = _t1358;
                  function go(ty) {
                    let _t1362;
                    const _t1361 = Types$repr(ty);
                    _t1363: {
                      if (_t1361._tag === 15 && _t1361._val.contents._tag === 0) {
                        const id = _t1361._val.contents._val[0];
                        const l = _t1361._val.contents._val[1];
                        if ((l > level)) {
                          let _t1365;
                          const _t1364 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, id]);
                          _t1366: {
                            if (_t1364._tag === 1) {
                              const gen = _t1364._val;
                              _t1365 = gen;
                              break _t1366;
                            }
                            if (_t1364._tag === 0) {
                              const gen_1367 = ({_tag: 16, _name: "TGen", _val: Ref$get(counter_1341)});
                              Ref$set(counter_1341, (Ref$get(counter_1341) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, id_map, id, gen_1367]);
                              const _t1368 = gen_1367;
                              _t1365 = _t1368;
                              break _t1366;
                            }
                            _match_fail("line 16629");
                          }
                          _t1362 = _t1365;
                          break _t1363;
                        }
                      }
                      if ((_t1361._tag === 15 && _t1361._val.contents._tag === 0 || _t1361._tag === 15 && _t1361._val.contents._tag === 1)) {
                        _t1362 = ty;
                        break _t1363;
                      }
                      if (_t1361._tag === 7) {
                        const a = _t1361._val[0];
                        const eff = _t1361._val[1];
                        const r = _t1361._val[2];
                        _t1362 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1363;
                      }
                      if (_t1361._tag === 8) {
                        const a = _t1361._val[0];
                        const eff = _t1361._val[1];
                        const r = _t1361._val[2];
                        _t1362 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1363;
                      }
                      if (_t1361._tag === 9) {
                        const ts = _t1361._val;
                        _t1362 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
                        break _t1363;
                      }
                      if (_t1361._tag === 10) {
                        const t = _t1361._val;
                        _t1362 = ({_tag: 10, _name: "TList", _val: go(t)});
                        break _t1363;
                      }
                      if (_t1361._tag === 13) {
                        const t = _t1361._val;
                        _t1362 = ({_tag: 13, _name: "TArray", _val: go(t)});
                        break _t1363;
                      }
                      if (_t1361._tag === 11) {
                        const row = _t1361._val;
                        _t1362 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
                        break _t1363;
                      }
                      if (_t1361._tag === 12) {
                        const name = _t1361._val[0];
                        const args = _t1361._val[1];
                        _t1362 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
                        break _t1363;
                      }
                      if (_t1361._tag === 14) {
                        const row = _t1361._val;
                        _t1362 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
                        break _t1363;
                      }
                      if (true) {
                        const t = _t1361;
                        _t1362 = t;
                        break _t1363;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1362;
                  }
                  function go_eff(eff) {
                    let _t1370;
                    const _t1369 = Types$eff_repr(eff);
                    _t1371: {
                      if (_t1369._tag === 0 && _t1369._val.contents._tag === 0) {
                        const id = _t1369._val.contents._val[0];
                        const l = _t1369._val.contents._val[1];
                        if ((l > level)) {
                          let _t1373;
                          const _t1372 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id]);
                          _t1374: {
                            if (_t1372._tag === 1) {
                              const gen = _t1372._val;
                              _t1373 = gen;
                              break _t1374;
                            }
                            if (_t1372._tag === 0) {
                              const gen_1375 = ({_tag: 3, _name: "EffGen", _val: Ref$get(ecounter_1346)});
                              Ref$set(ecounter_1346, (Ref$get(ecounter_1346) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id, gen_1375]);
                              const _t1376 = gen_1375;
                              _t1373 = _t1376;
                              break _t1374;
                            }
                            _match_fail("line 16629");
                          }
                          _t1370 = _t1373;
                          break _t1371;
                        }
                      }
                      if ((_t1369._tag === 0 && _t1369._val.contents._tag === 0 || _t1369._tag === 0 && _t1369._val.contents._tag === 1)) {
                        _t1370 = eff;
                        break _t1371;
                      }
                      if (_t1369._tag === 2) {
                        const label = _t1369._val[0];
                        const params = _t1369._val[1];
                        const tail = _t1369._val[2];
                        _t1370 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
                        break _t1371;
                      }
                      if (_t1369._tag === 1) {
                        _t1370 = ({_tag: 1, _name: "EffEmpty"});
                        break _t1371;
                      }
                      if (_t1369._tag === 3) {
                        const e = _t1369;
                        _t1370 = e;
                        break _t1371;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1370;
                  }
                  function go_pv(row) {
                    let _t1378;
                    const _t1377 = Types$pv_repr(row);
                    _t1379: {
                      if (_t1377._tag === 1 && _t1377._val.contents._tag === 0) {
                        const id = _t1377._val.contents._val[0];
                        const l = _t1377._val.contents._val[1];
                        if ((l > level)) {
                          let _t1381;
                          const _t1380 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id]);
                          _t1382: {
                            if (_t1380._tag === 1) {
                              const gen = _t1380._val;
                              _t1381 = gen;
                              break _t1382;
                            }
                            if (_t1380._tag === 0) {
                              const gen_1383 = ({_tag: 3, _name: "PVGen", _val: Ref$get(pvcounter_1351)});
                              Ref$set(pvcounter_1351, (Ref$get(pvcounter_1351) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id, gen_1383]);
                              const _t1384 = gen_1383;
                              _t1381 = _t1384;
                              break _t1382;
                            }
                            _match_fail("line 16629");
                          }
                          _t1378 = _t1381;
                          break _t1379;
                        }
                      }
                      if ((_t1377._tag === 1 && _t1377._val.contents._tag === 0 || _t1377._tag === 1 && _t1377._val.contents._tag === 1)) {
                        _t1378 = row;
                        break _t1379;
                      }
                      if (_t1377._tag === 0) {
                        const tag = _t1377._val[0];
                        const ty_opt = _t1377._val[1];
                        const tail = _t1377._val[2];
                        _t1378 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
                        break _t1379;
                      }
                      if (_t1377._tag === 2) {
                        _t1378 = ({_tag: 2, _name: "PVEmpty"});
                        break _t1379;
                      }
                      if (_t1377._tag === 3) {
                        const r = _t1377;
                        _t1378 = r;
                        break _t1379;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1378;
                  }
                  function go_rrow(row) {
                    let _t1386;
                    const _t1385 = Types$rrow_repr(row);
                    _t1387: {
                      if (_t1385._tag === 1 && _t1385._val.contents._tag === 0) {
                        const id = _t1385._val.contents._val[0];
                        const l = _t1385._val.contents._val[1];
                        if ((l > level)) {
                          let _t1389;
                          const _t1388 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, r_id_map, id]);
                          _t1390: {
                            if (_t1388._tag === 1) {
                              const gen = _t1388._val;
                              _t1389 = gen;
                              break _t1390;
                            }
                            if (_t1388._tag === 0) {
                              const gen_1391 = ({_tag: 3, _name: "RGen", _val: Ref$get(rcounter_1356)});
                              Ref$set(rcounter_1356, (Ref$get(rcounter_1356) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, r_id_map, id, gen_1391]);
                              const _t1392 = gen_1391;
                              _t1389 = _t1392;
                              break _t1390;
                            }
                            _match_fail("line 16629");
                          }
                          _t1386 = _t1389;
                          break _t1387;
                        }
                      }
                      if ((_t1385._tag === 1 && _t1385._val.contents._tag === 0 || _t1385._tag === 1 && _t1385._val.contents._tag === 1)) {
                        _t1386 = row;
                        break _t1387;
                      }
                      if (_t1385._tag === 0) {
                        const name = _t1385._val[0];
                        const ty = _t1385._val[1];
                        const tail = _t1385._val[2];
                        _t1386 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
                        break _t1387;
                      }
                      if (_t1385._tag === 2) {
                        _t1386 = ({_tag: 2, _name: "REmpty"});
                        break _t1387;
                      }
                      if (_t1385._tag === 3) {
                        const r = _t1385;
                        _t1386 = r;
                        break _t1387;
                      }
                      if (_t1385._tag === 4) {
                        _t1386 = ({_tag: 4, _name: "RWild"});
                        break _t1387;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1386;
                  }
                  const body_1394 = go(ty);
                  const _t1395 = [({body: body_1394, constraints: null, equant: Ref$get(ecounter_1346), pvquant: Ref$get(pvcounter_1351), quant: Ref$get(counter_1341), record_evidences: null, rquant: Ref$get(rcounter_1356)}), id_map];
                  const _t1393 = _t1395;
                  _t1359 = _t1393;
                  break _t1360;
                }
                _match_fail("line 16629");
              }
              const _t1357 = _t1359;
              _t1354 = _t1357;
              break _t1355;
            }
            _match_fail("line 16629");
          }
          const _t1352 = _t1354;
          _t1349 = _t1352;
          break _t1350;
        }
        _match_fail("line 16629");
      }
      const _t1347 = _t1349;
      _t1344 = _t1347;
      break _t1345;
    }
    _match_fail("line 16629");
  }
  const _t1342 = _t1344;
  return _t1342;
}
function Types$instantiate_with_mapping(level, s) {
  let _t1396;
  if (((s.quant === 0) && ((s.equant === 0) && ((s.pvquant === 0) && (s.rquant === 0))))) {
    _t1396 = [s.body, null];
  } else {
    function _t1397(_) {
      return Types$new_tvar(level);
    }
    const vars_1398 = Array$init(s.quant, _t1397);
    function _t1400(_) {
      return Types$new_effvar(level);
    }
    const evars_1401 = Array$init(s.equant, _t1400);
    function _t1403(_) {
      return Types$new_pvvar(level);
    }
    const pvvars_1404 = Array$init(s.pvquant, _t1403);
    function _t1406(_) {
      return Types$new_rvar(level);
    }
    const rvars_1407 = Array$init(s.rquant, _t1406);
    function _t1409(_) {
      return Types$new_effvar(level);
    }
    const shared_eff_1410 = _t1409;
    function _t1412(i) {
      return [i, Array$get(vars_1398, i)];
    }
    const mapping_1413 = List$init(s.quant, _t1412);
    function go(__x) {
      let _t1416;
      const _t1415 = __x;
      _t1417: {
        if (_t1415._tag === 16) {
          const id = _t1415._val;
          if ((id < s.quant)) {
            _t1416 = Array$get(vars_1398, id);
            break _t1417;
          }
        }
        if (_t1415._tag === 7) {
          const a = _t1415._val[0];
          const eff = _t1415._val[1];
          const r = _t1415._val[2];
          _t1416 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
          break _t1417;
        }
        if (_t1415._tag === 8) {
          const a = _t1415._val[0];
          const eff = _t1415._val[1];
          const r = _t1415._val[2];
          _t1416 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
          break _t1417;
        }
        if (_t1415._tag === 9) {
          const ts = _t1415._val;
          _t1416 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t1417;
        }
        if (_t1415._tag === 10) {
          const t = _t1415._val;
          _t1416 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t1417;
        }
        if (_t1415._tag === 13) {
          const t = _t1415._val;
          _t1416 = ({_tag: 13, _name: "TArray", _val: go(t)});
          break _t1417;
        }
        if (_t1415._tag === 11) {
          const row = _t1415._val;
          _t1416 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
          break _t1417;
        }
        if (_t1415._tag === 12) {
          const name = _t1415._val[0];
          const args = _t1415._val[1];
          _t1416 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
          break _t1417;
        }
        if (_t1415._tag === 14) {
          const row = _t1415._val;
          _t1416 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
          break _t1417;
        }
        if (true) {
          const t = _t1415;
          _t1416 = t;
          break _t1417;
        }
        _match_fail("line 16629");
      }
      return _t1416;
    }
    function go_eff(__x) {
      let _t1419;
      const _t1418 = __x;
      _t1420: {
        if (_t1418._tag === 3) {
          const id = _t1418._val;
          if ((id < s.equant)) {
            _t1419 = Array$get(evars_1401, id);
            break _t1420;
          }
        }
        if (_t1418._tag === 2) {
          const label = _t1418._val[0];
          const params = _t1418._val[1];
          const tail = _t1418._val[2];
          _t1419 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
          break _t1420;
        }
        if (_t1418._tag === 1) {
          _t1419 = shared_eff_1410(undefined);
          break _t1420;
        }
        if (true) {
          const e = _t1418;
          _t1419 = e;
          break _t1420;
        }
        _match_fail("line 16629");
      }
      return _t1419;
    }
    function go_pv(__x) {
      let _t1422;
      const _t1421 = __x;
      _t1423: {
        if (_t1421._tag === 3) {
          const id = _t1421._val;
          if ((id < s.pvquant)) {
            _t1422 = Array$get(pvvars_1404, id);
            break _t1423;
          }
        }
        if (_t1421._tag === 0) {
          const tag = _t1421._val[0];
          const ty_opt = _t1421._val[1];
          const tail = _t1421._val[2];
          _t1422 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
          break _t1423;
        }
        if (true) {
          const r = _t1421;
          _t1422 = r;
          break _t1423;
        }
        _match_fail("line 16629");
      }
      return _t1422;
    }
    function go_rrow(__x) {
      let _t1425;
      const _t1424 = __x;
      _t1426: {
        if (_t1424._tag === 3) {
          const id = _t1424._val;
          if ((id < s.rquant)) {
            _t1425 = Array$get(rvars_1407, id);
            break _t1426;
          }
        }
        if (_t1424._tag === 0) {
          const name = _t1424._val[0];
          const ty = _t1424._val[1];
          const tail = _t1424._val[2];
          _t1425 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
          break _t1426;
        }
        if (true) {
          const r = _t1424;
          _t1425 = r;
          break _t1426;
        }
        _match_fail("line 16629");
      }
      return _t1425;
    }
    const _t1427 = [go(s.body), mapping_1413];
    const _t1414 = _t1427;
    const _t1411 = _t1414;
    const _t1408 = _t1411;
    const _t1405 = _t1408;
    const _t1402 = _t1405;
    const _t1399 = _t1402;
    _t1396 = _t1399;
  }
  return _t1396;
}
function Types$instantiate(level, s) {
  let _t1428;
  if (((s.quant === 0) && ((s.equant === 0) && ((s.pvquant === 0) && (s.rquant === 0))))) {
    _t1428 = s.body;
  } else {
    function _t1429(_) {
      return Types$new_tvar(level);
    }
    const vars_1430 = Array$init(s.quant, _t1429);
    function _t1432(_) {
      return Types$new_effvar(level);
    }
    const evars_1433 = Array$init(s.equant, _t1432);
    function _t1435(_) {
      return Types$new_pvvar(level);
    }
    const pvvars_1436 = Array$init(s.pvquant, _t1435);
    function _t1438(_) {
      return Types$new_rvar(level);
    }
    const rvars_1439 = Array$init(s.rquant, _t1438);
    function _t1441(_) {
      return Types$new_effvar(level);
    }
    const shared_eff_1442 = _t1441;
    function go(__x) {
      while (true) {
        let _t1445;
        const _t1444 = __x;
        _t1446: {
          if (_t1444._tag === 16) {
            const id = _t1444._val;
            if ((id < s.quant)) {
              _t1445 = Array$get(vars_1430, id);
              break _t1446;
            }
          }
          if (_t1444._tag === 7) {
            const a = _t1444._val[0];
            const eff = _t1444._val[1];
            const r = _t1444._val[2];
            _t1445 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
            break _t1446;
          }
          if (_t1444._tag === 8) {
            const a = _t1444._val[0];
            const eff = _t1444._val[1];
            const r = _t1444._val[2];
            _t1445 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
            break _t1446;
          }
          if (_t1444._tag === 9) {
            const ts = _t1444._val;
            _t1445 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
            break _t1446;
          }
          if (_t1444._tag === 10) {
            const t = _t1444._val;
            _t1445 = ({_tag: 10, _name: "TList", _val: go(t)});
            break _t1446;
          }
          if (_t1444._tag === 13) {
            const t = _t1444._val;
            _t1445 = ({_tag: 13, _name: "TArray", _val: go(t)});
            break _t1446;
          }
          if (_t1444._tag === 11) {
            const row = _t1444._val;
            _t1445 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
            break _t1446;
          }
          if (_t1444._tag === 12) {
            const name = _t1444._val[0];
            const args = _t1444._val[1];
            _t1445 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
            break _t1446;
          }
          if (_t1444._tag === 14) {
            const row = _t1444._val;
            _t1445 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
            break _t1446;
          }
          if (_t1444._tag === 15 && _t1444._val.contents._tag === 1) {
            const ty = _t1444._val.contents._val;
            const _t1447 = ty;
            __x = _t1447;
            continue;
            _t1445 = undefined;
            break _t1446;
          }
          if (true) {
            const t = _t1444;
            _t1445 = t;
            break _t1446;
          }
          _match_fail("line 16629");
        }
        return _t1445;
      }
    }
    function go_eff(__x) {
      let _t1449;
      const _t1448 = __x;
      _t1450: {
        if (_t1448._tag === 3) {
          const id = _t1448._val;
          if ((id < s.equant)) {
            _t1449 = Array$get(evars_1433, id);
            break _t1450;
          }
        }
        if (_t1448._tag === 2) {
          const label = _t1448._val[0];
          const params = _t1448._val[1];
          const tail = _t1448._val[2];
          _t1449 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
          break _t1450;
        }
        if (_t1448._tag === 1) {
          _t1449 = shared_eff_1442(undefined);
          break _t1450;
        }
        if (true) {
          const e = _t1448;
          _t1449 = e;
          break _t1450;
        }
        _match_fail("line 16629");
      }
      return _t1449;
    }
    function go_pv(__x) {
      let _t1452;
      const _t1451 = __x;
      _t1453: {
        if (_t1451._tag === 3) {
          const id = _t1451._val;
          if ((id < s.pvquant)) {
            _t1452 = Array$get(pvvars_1436, id);
            break _t1453;
          }
        }
        if (_t1451._tag === 0) {
          const tag = _t1451._val[0];
          const ty_opt = _t1451._val[1];
          const tail = _t1451._val[2];
          _t1452 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
          break _t1453;
        }
        if (true) {
          const r = _t1451;
          _t1452 = r;
          break _t1453;
        }
        _match_fail("line 16629");
      }
      return _t1452;
    }
    function go_rrow(__x) {
      let _t1455;
      const _t1454 = __x;
      _t1456: {
        if (_t1454._tag === 3) {
          const id = _t1454._val;
          if ((id < s.rquant)) {
            _t1455 = Array$get(rvars_1439, id);
            break _t1456;
          }
        }
        if (_t1454._tag === 0) {
          const name = _t1454._val[0];
          const ty = _t1454._val[1];
          const tail = _t1454._val[2];
          _t1455 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
          break _t1456;
        }
        if (true) {
          const r = _t1454;
          _t1455 = r;
          break _t1456;
        }
        _match_fail("line 16629");
      }
      return _t1455;
    }
    const _t1457 = go(s.body);
    const _t1443 = _t1457;
    const _t1440 = _t1443;
    const _t1437 = _t1440;
    const _t1434 = _t1437;
    const _t1431 = _t1434;
    _t1428 = _t1431;
  }
  return _t1428;
}
function Types$deep_repr(ty) {
  let _t1459;
  const _t1458 = Types$repr(ty);
  _t1460: {
    if (_t1458._tag === 7) {
      const a = _t1458._val[0];
      const eff = _t1458._val[1];
      const b = _t1458._val[2];
      _t1459 = ({_tag: 7, _name: "TArrow", _val: [Types$deep_repr(a), Types$deep_repr_eff(eff), Types$deep_repr(b)]});
      break _t1460;
    }
    if (_t1458._tag === 8) {
      const a = _t1458._val[0];
      const eff = _t1458._val[1];
      const b = _t1458._val[2];
      _t1459 = ({_tag: 8, _name: "TCont", _val: [Types$deep_repr(a), Types$deep_repr_eff(eff), Types$deep_repr(b)]});
      break _t1460;
    }
    if (_t1458._tag === 9) {
      const ts = _t1458._val;
      _t1459 = ({_tag: 9, _name: "TTuple", _val: List$map(Types$deep_repr, ts)});
      break _t1460;
    }
    if (_t1458._tag === 10) {
      const t = _t1458._val;
      _t1459 = ({_tag: 10, _name: "TList", _val: Types$deep_repr(t)});
      break _t1460;
    }
    if (_t1458._tag === 13) {
      const t = _t1458._val;
      _t1459 = ({_tag: 13, _name: "TArray", _val: Types$deep_repr(t)});
      break _t1460;
    }
    if (_t1458._tag === 11) {
      const row = _t1458._val;
      _t1459 = ({_tag: 11, _name: "TRecord", _val: Types$deep_repr_rrow(row)});
      break _t1460;
    }
    if (_t1458._tag === 12) {
      const name = _t1458._val[0];
      const args = _t1458._val[1];
      _t1459 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(Types$deep_repr, args)]});
      break _t1460;
    }
    if (_t1458._tag === 14) {
      const row = _t1458._val;
      _t1459 = ({_tag: 14, _name: "TPolyVariant", _val: Types$deep_repr_pv(row)});
      break _t1460;
    }
    if (true) {
      const t = _t1458;
      _t1459 = t;
      break _t1460;
    }
    _match_fail("line 16629");
  }
  return _t1459;
}
function Types$deep_repr_eff(eff) {
  let _t1462;
  const _t1461 = Types$eff_repr(eff);
  _t1463: {
    if (_t1461._tag === 2) {
      const label = _t1461._val[0];
      const params = _t1461._val[1];
      const tail = _t1461._val[2];
      _t1462 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(Types$deep_repr, params), Types$deep_repr_eff(tail)]});
      break _t1463;
    }
    if (true) {
      const e = _t1461;
      _t1462 = e;
      break _t1463;
    }
    _match_fail("line 16629");
  }
  return _t1462;
}
function Types$deep_repr_pv(row) {
  let _t1465;
  const _t1464 = Types$pv_repr(row);
  _t1466: {
    if (_t1464._tag === 0) {
      const tag = _t1464._val[0];
      const ty_opt = _t1464._val[1];
      const tail = _t1464._val[2];
      _t1465 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(Types$deep_repr, ty_opt), Types$deep_repr_pv(tail)]});
      break _t1466;
    }
    if (true) {
      const r = _t1464;
      _t1465 = r;
      break _t1466;
    }
    _match_fail("line 16629");
  }
  return _t1465;
}
function Types$deep_repr_rrow(row) {
  let _t1468;
  const _t1467 = Types$rrow_repr(row);
  _t1469: {
    if (_t1467._tag === 0) {
      const name = _t1467._val[0];
      const ty = _t1467._val[1];
      const tail = _t1467._val[2];
      _t1468 = ({_tag: 0, _name: "RRow", _val: [name, Types$deep_repr(ty), Types$deep_repr_rrow(tail)]});
      break _t1469;
    }
    if (true) {
      const r = _t1467;
      _t1468 = r;
      break _t1469;
    }
    _match_fail("line 16629");
  }
  return _t1468;
}
function Types$types_compatible(t1, t2) {
  while (true) {
    const t1_1470 = Types$repr(t1);
    const t2_1472 = Types$repr(t2);
    let _t1475;
    const _t1474 = [t1_1470, t2_1472];
    _t1476: {
      if ((_t1474[0]._tag === 15 || _t1474[1]._tag === 15)) {
        _t1475 = true;
        break _t1476;
      }
      if (((((((_t1474[0]._tag === 0 && _t1474[1]._tag === 0 || _t1474[0]._tag === 1 && _t1474[1]._tag === 1) || _t1474[0]._tag === 2 && _t1474[1]._tag === 2) || _t1474[0]._tag === 3 && _t1474[1]._tag === 3) || _t1474[0]._tag === 4 && _t1474[1]._tag === 4) || _t1474[0]._tag === 5 && _t1474[1]._tag === 5) || _t1474[0]._tag === 6 && _t1474[1]._tag === 6)) {
        _t1475 = true;
        break _t1476;
      }
      if ((_t1474[0]._tag === 7 && _t1474[1]._tag === 7 || _t1474[0]._tag === 8 && _t1474[1]._tag === 8)) {
        const a1 = _t1474[0]._val[0];
        const r1 = _t1474[0]._val[2];
        const a2 = _t1474[1]._val[0];
        const r2 = _t1474[1]._val[2];
        _t1475 = (Types$types_compatible(a1, a2) && Types$types_compatible(r1, r2));
        break _t1476;
      }
      if (_t1474[0]._tag === 9 && _t1474[1]._tag === 9) {
        const ts1 = _t1474[0]._val;
        const ts2 = _t1474[1]._val;
        _t1475 = ((List$length(ts1) === List$length(ts2)) && List$forall2(Types$types_compatible, ts1, ts2));
        break _t1476;
      }
      if (_t1474[0]._tag === 10 && _t1474[1]._tag === 10) {
        const t1 = _t1474[0]._val;
        const t2 = _t1474[1]._val;
        const _t1477 = t1;
        const _t1478 = t2;
        t1 = _t1477;
        t2 = _t1478;
        continue;
        _t1475 = undefined;
        break _t1476;
      }
      if (_t1474[0]._tag === 13 && _t1474[1]._tag === 13) {
        const t1 = _t1474[0]._val;
        const t2 = _t1474[1]._val;
        const _t1479 = t1;
        const _t1480 = t2;
        t1 = _t1479;
        t2 = _t1480;
        continue;
        _t1475 = undefined;
        break _t1476;
      }
      if (_t1474[0]._tag === 11 && _t1474[1]._tag === 11) {
        const r1 = _t1474[0]._val;
        const r2 = _t1474[1]._val;
        const f1_1481 = Types$record_row_to_fields(r1);
        const f2_1483 = Types$record_row_to_fields(r2);
        let _t1492;
        if ((List$length(f1_1481) === List$length(f2_1483))) {
        function _t1485(__p41, __p42) {
          let _t1487;
          const _t1486 = __p41;
          _t1488: {
            if (true) {
              const n1 = _t1486[0];
              const t1 = _t1486[1];
              let _t1490;
              const _t1489 = __p42;
              _t1491: {
                if (true) {
                  const n2 = _t1489[0];
                  const t2 = _t1489[1];
                  _t1490 = ((n1 === n2) && Types$types_compatible(t1, t2));
                  break _t1491;
                }
                _match_fail("line 16629");
              }
              _t1487 = _t1490;
              break _t1488;
            }
            _match_fail("line 16629");
          }
          return _t1487;
        }
          _t1492 = List$forall2(_t1485, f1_1481, f2_1483);
        } else {
          _t1492 = false;
        }
        const _t1484 = _t1492;
        const _t1482 = _t1484;
        _t1475 = _t1482;
        break _t1476;
      }
      if (_t1474[0]._tag === 12 && _t1474[1]._tag === 12) {
        const a = _t1474[0]._val[0];
        const args_a = _t1474[0]._val[1];
        const b = _t1474[1]._val[0];
        const args_b = _t1474[1]._val[1];
        _t1475 = ((a === b) && ((List$length(args_a) === List$length(args_b)) && List$forall2(Types$types_compatible, args_a, args_b)));
        break _t1476;
      }
      if (_t1474[0]._tag === 14 && _t1474[1]._tag === 14) {
        const r1 = _t1474[0]._val;
        const r2 = _t1474[1]._val;
        _t1475 = Types$pvrows_compatible(r1, r2);
        break _t1476;
      }
      if (true) {
        _t1475 = false;
        break _t1476;
      }
      _match_fail("line 16629");
    }
    const _t1473 = _t1475;
    const _t1471 = _t1473;
    return _t1471;
  }
}
function Types$pvrows_compatible(r1, r2) {
  function collect(r) {
    let _t1494;
    const _t1493 = Types$pv_repr(r);
    _t1495: {
      if (_t1493._tag === 0) {
        const tag = _t1493._val[0];
        const ty_opt = _t1493._val[1];
        const tail = _t1493._val[2];
        _t1494 = ({_hd: [tag, ty_opt], _tl: collect(tail)});
        break _t1495;
      }
      if (true) {
        _t1494 = null;
        break _t1495;
      }
      _match_fail("line 16629");
    }
    return _t1494;
  }
  const tags1_1497 = collect(r1);
  const tags2_1499 = collect(r2);
  let _t1512;
  if ((List$length(tags1_1497) === List$length(tags2_1499))) {
  function _t1501(__p43, __p44) {
    let _t1503;
    const _t1502 = __p43;
    _t1504: {
      if (true) {
        const t1 = _t1502[0];
        const ty1 = _t1502[1];
        let _t1506;
        const _t1505 = __p44;
        _t1507: {
          if (true) {
            const t2 = _t1505[0];
            const ty2 = _t1505[1];
            let _t1511;
            if ((t1 === t2)) {
            let _t1509;
            const _t1508 = [ty1, ty2];
            _t1510: {
              if (_t1508[0]._tag === 0 && _t1508[1]._tag === 0) {
                _t1509 = true;
                break _t1510;
              }
              if (_t1508[0]._tag === 1 && _t1508[1]._tag === 1) {
                const a = _t1508[0]._val;
                const b = _t1508[1]._val;
                _t1509 = Types$types_compatible(a, b);
                break _t1510;
              }
              if (true) {
                _t1509 = false;
                break _t1510;
              }
              _match_fail("line 16629");
            }
              _t1511 = _t1509;
            } else {
              _t1511 = false;
            }
            _t1506 = _t1511;
            break _t1507;
          }
          _match_fail("line 16629");
        }
        _t1503 = _t1506;
        break _t1504;
      }
      _match_fail("line 16629");
    }
    return _t1503;
  }
    _t1512 = List$forall2(_t1501, tags1_1497, tags2_1499);
  } else {
    _t1512 = false;
  }
  const _t1500 = _t1512;
  const _t1498 = _t1500;
  const _t1496 = _t1498;
  return _t1496;
}
function Types$subtype(t1, t2) {
  while (true) {
    const t1_1513 = Types$repr(t1);
    const t2_1515 = Types$repr(t2);
    let _t1518;
    const _t1517 = [t1_1513, t2_1515];
    _t1519: {
      if (((((((_t1517[0]._tag === 0 && _t1517[1]._tag === 0 || _t1517[0]._tag === 1 && _t1517[1]._tag === 1) || _t1517[0]._tag === 2 && _t1517[1]._tag === 2) || _t1517[0]._tag === 3 && _t1517[1]._tag === 3) || _t1517[0]._tag === 4 && _t1517[1]._tag === 4) || _t1517[0]._tag === 5 && _t1517[1]._tag === 5) || _t1517[0]._tag === 6 && _t1517[1]._tag === 6)) {
        _t1518 = true;
        break _t1519;
      }
      if (_t1517[0]._tag === 12 && _t1517[1]._tag === 12) {
        const a = _t1517[0]._val[0];
        const args_a = _t1517[0]._val[1];
        const b = _t1517[1]._val[0];
        const args_b = _t1517[1]._val[1];
        _t1518 = ((a === b) && ((List$length(args_a) === List$length(args_b)) && List$forall2(Types$subtype, args_a, args_b)));
        break _t1519;
      }
      if ((_t1517[0]._tag === 7 && _t1517[1]._tag === 7 || _t1517[0]._tag === 8 && _t1517[1]._tag === 8)) {
        const a1 = _t1517[0]._val[0];
        const _e1 = _t1517[0]._val[1];
        const r1 = _t1517[0]._val[2];
        const a2 = _t1517[1]._val[0];
        const _e2 = _t1517[1]._val[1];
        const r2 = _t1517[1]._val[2];
        _t1518 = (Types$subtype(a2, a1) && Types$subtype(r1, r2));
        break _t1519;
      }
      if (_t1517[0]._tag === 11 && _t1517[1]._tag === 11) {
        const r1 = _t1517[0]._val;
        const r2 = _t1517[1]._val;
        const f1_1520 = Types$record_row_to_fields(r1);
        const f2_1522 = Types$record_row_to_fields(r2);
        function _t1524(__p45) {
          let _t1526;
          const _t1525 = __p45;
          _t1527: {
            if (true) {
              const f = _t1525[0];
              const t2$p = _t1525[1];
              let _t1529;
              const _t1528 = List$assoc_opt(f, f1_1520);
              _t1530: {
                if (_t1528._tag === 1) {
                  const t1$p = _t1528._val;
                  _t1529 = Types$subtype(t1$p, t2$p);
                  break _t1530;
                }
                if (_t1528._tag === 0) {
                  _t1529 = false;
                  break _t1530;
                }
                _match_fail("line 16629");
              }
              _t1526 = _t1529;
              break _t1527;
            }
            _match_fail("line 16629");
          }
          return _t1526;
        }
        const _t1523 = List$forall(_t1524, f2_1522);
        const _t1521 = _t1523;
        _t1518 = _t1521;
        break _t1519;
      }
      if (_t1517[0]._tag === 10 && _t1517[1]._tag === 10) {
        const t1$p = _t1517[0]._val;
        const t2$p = _t1517[1]._val;
        const _t1531 = t1$p;
        const _t1532 = t2$p;
        t1 = _t1531;
        t2 = _t1532;
        continue;
        _t1518 = undefined;
        break _t1519;
      }
      if (_t1517[0]._tag === 13 && _t1517[1]._tag === 13) {
        const t1$p = _t1517[0]._val;
        const t2$p = _t1517[1]._val;
        const _t1533 = t1$p;
        const _t1534 = t2$p;
        t1 = _t1533;
        t2 = _t1534;
        continue;
        _t1518 = undefined;
        break _t1519;
      }
      if (_t1517[0]._tag === 9 && _t1517[1]._tag === 9) {
        const ts1 = _t1517[0]._val;
        const ts2 = _t1517[1]._val;
        _t1518 = ((List$length(ts1) === List$length(ts2)) && List$forall2(Types$subtype, ts1, ts2));
        break _t1519;
      }
      if (_t1517[0]._tag === 15 && _t1517[1]._tag === 15) {
        const r1 = _t1517[0]._val;
        const r2 = _t1517[1]._val;
        if (_eq(r1, r2)) {
          _t1518 = true;
          break _t1519;
        }
      }
      if (true) {
        _t1518 = false;
        break _t1519;
      }
      _match_fail("line 16629");
    }
    const _t1516 = _t1518;
    const _t1514 = _t1516;
    return _t1514;
  }
}
function Types$equal_ty(t1, t2) {
  while (true) {
    const t1_1535 = Types$repr(t1);
    const t2_1537 = Types$repr(t2);
    let _t1540;
    const _t1539 = [t1_1535, t2_1537];
    _t1541: {
      if (((((((_t1539[0]._tag === 0 && _t1539[1]._tag === 0 || _t1539[0]._tag === 1 && _t1539[1]._tag === 1) || _t1539[0]._tag === 2 && _t1539[1]._tag === 2) || _t1539[0]._tag === 3 && _t1539[1]._tag === 3) || _t1539[0]._tag === 4 && _t1539[1]._tag === 4) || _t1539[0]._tag === 5 && _t1539[1]._tag === 5) || _t1539[0]._tag === 6 && _t1539[1]._tag === 6)) {
        _t1540 = true;
        break _t1541;
      }
      if (_t1539[0]._tag === 12 && _t1539[1]._tag === 12) {
        const a = _t1539[0]._val[0];
        const args_a = _t1539[0]._val[1];
        const b = _t1539[1]._val[0];
        const args_b = _t1539[1]._val[1];
        _t1540 = ((a === b) && ((List$length(args_a) === List$length(args_b)) && List$forall2(Types$equal_ty, args_a, args_b)));
        break _t1541;
      }
      if ((_t1539[0]._tag === 7 && _t1539[1]._tag === 7 || _t1539[0]._tag === 8 && _t1539[1]._tag === 8)) {
        const a1 = _t1539[0]._val[0];
        const _e1 = _t1539[0]._val[1];
        const r1 = _t1539[0]._val[2];
        const a2 = _t1539[1]._val[0];
        const _e2 = _t1539[1]._val[1];
        const r2 = _t1539[1]._val[2];
        _t1540 = (Types$equal_ty(a1, a2) && Types$equal_ty(r1, r2));
        break _t1541;
      }
      if (_t1539[0]._tag === 11 && _t1539[1]._tag === 11) {
        const r1 = _t1539[0]._val;
        const r2 = _t1539[1]._val;
        const f1_1542 = Types$record_row_to_fields(r1);
        const f2_1544 = Types$record_row_to_fields(r2);
        let _t1553;
        if ((List$length(f1_1542) === List$length(f2_1544))) {
        function _t1546(__p46, __p47) {
          let _t1548;
          const _t1547 = __p46;
          _t1549: {
            if (true) {
              const n1 = _t1547[0];
              const t1 = _t1547[1];
              let _t1551;
              const _t1550 = __p47;
              _t1552: {
                if (true) {
                  const n2 = _t1550[0];
                  const t2 = _t1550[1];
                  _t1551 = ((n1 === n2) && Types$equal_ty(t1, t2));
                  break _t1552;
                }
                _match_fail("line 16629");
              }
              _t1548 = _t1551;
              break _t1549;
            }
            _match_fail("line 16629");
          }
          return _t1548;
        }
          _t1553 = List$forall2(_t1546, f1_1542, f2_1544);
        } else {
          _t1553 = false;
        }
        const _t1545 = _t1553;
        const _t1543 = _t1545;
        _t1540 = _t1543;
        break _t1541;
      }
      if (_t1539[0]._tag === 10 && _t1539[1]._tag === 10) {
        const t1$p = _t1539[0]._val;
        const t2$p = _t1539[1]._val;
        const _t1554 = t1$p;
        const _t1555 = t2$p;
        t1 = _t1554;
        t2 = _t1555;
        continue;
        _t1540 = undefined;
        break _t1541;
      }
      if (_t1539[0]._tag === 13 && _t1539[1]._tag === 13) {
        const t1$p = _t1539[0]._val;
        const t2$p = _t1539[1]._val;
        const _t1556 = t1$p;
        const _t1557 = t2$p;
        t1 = _t1556;
        t2 = _t1557;
        continue;
        _t1540 = undefined;
        break _t1541;
      }
      if (_t1539[0]._tag === 9 && _t1539[1]._tag === 9) {
        const ts1 = _t1539[0]._val;
        const ts2 = _t1539[1]._val;
        _t1540 = ((List$length(ts1) === List$length(ts2)) && List$forall2(Types$equal_ty, ts1, ts2));
        break _t1541;
      }
      if (_t1539[0]._tag === 15 && _t1539[1]._tag === 15) {
        const r1 = _t1539[0]._val;
        const r2 = _t1539[1]._val;
        _t1540 = _eq(r1, r2);
        break _t1541;
      }
      if (true) {
        _t1540 = false;
        break _t1541;
      }
      _match_fail("line 16629");
    }
    const _t1538 = _t1540;
    const _t1536 = _t1538;
    return _t1536;
  }
}
function Types$freshen_unbound(ty) {
  const tbl_1558 = Hashtbl$create(4);
  function go(ty) {
    let _t1561;
    const _t1560 = Types$repr(ty);
    _t1562: {
      if (_t1560._tag === 15 && _t1560._val.contents._tag === 0) {
        const id = _t1560._val.contents._val[0];
        const level = _t1560._val.contents._val[1];
        let _t1564;
        const _t1563 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tbl_1558, id]);
        _t1565: {
          if (_t1563._tag === 1) {
            const tv = _t1563._val;
            _t1564 = tv;
            break _t1565;
          }
          if (_t1563._tag === 0) {
            const tv_1566 = Types$new_tvar(level);
            _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tbl_1558, id, tv_1566]);
            const _t1567 = tv_1566;
            _t1564 = _t1567;
            break _t1565;
          }
          _match_fail("line 16629");
        }
        _t1561 = _t1564;
        break _t1562;
      }
      if (_t1560._tag === 7) {
        const a = _t1560._val[0];
        const eff = _t1560._val[1];
        const r = _t1560._val[2];
        _t1561 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
        break _t1562;
      }
      if (_t1560._tag === 8) {
        const a = _t1560._val[0];
        const eff = _t1560._val[1];
        const r = _t1560._val[2];
        _t1561 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
        break _t1562;
      }
      if (_t1560._tag === 9) {
        const ts = _t1560._val;
        _t1561 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
        break _t1562;
      }
      if (_t1560._tag === 10) {
        const t = _t1560._val;
        _t1561 = ({_tag: 10, _name: "TList", _val: go(t)});
        break _t1562;
      }
      if (_t1560._tag === 13) {
        const t = _t1560._val;
        _t1561 = ({_tag: 13, _name: "TArray", _val: go(t)});
        break _t1562;
      }
      if (_t1560._tag === 11) {
        const row = _t1560._val;
        _t1561 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
        break _t1562;
      }
      if (_t1560._tag === 14) {
        const row = _t1560._val;
        _t1561 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
        break _t1562;
      }
      if (_t1560._tag === 12) {
        const name = _t1560._val[0];
        const args = _t1560._val[1];
        _t1561 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
        break _t1562;
      }
      if (true) {
        const t = _t1560;
        _t1561 = t;
        break _t1562;
      }
      _match_fail("line 16629");
    }
    return _t1561;
  }
  function go_eff(eff) {
    let _t1569;
    const _t1568 = Types$eff_repr(eff);
    _t1570: {
      if (_t1568._tag === 2) {
        const label = _t1568._val[0];
        const tys = _t1568._val[1];
        const tail = _t1568._val[2];
        _t1569 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, tys), go_eff(tail)]});
        break _t1570;
      }
      if (true) {
        const e = _t1568;
        _t1569 = e;
        break _t1570;
      }
      _match_fail("line 16629");
    }
    return _t1569;
  }
  function go_rrow(__x) {
    let _t1572;
    const _t1571 = __x;
    _t1573: {
      if (_t1571._tag === 0) {
        const name = _t1571._val[0];
        const ty = _t1571._val[1];
        const tail = _t1571._val[2];
        _t1572 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
        break _t1573;
      }
      if (true) {
        const r = _t1571;
        _t1572 = r;
        break _t1573;
      }
      _match_fail("line 16629");
    }
    return _t1572;
  }
  function go_pv(__x) {
    let _t1575;
    const _t1574 = __x;
    _t1576: {
      if (_t1574._tag === 0) {
        const tag = _t1574._val[0];
        const payload = _t1574._val[1];
        const tail = _t1574._val[2];
        _t1575 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload), go_pv(tail)]});
        break _t1576;
      }
      if (true) {
        const p = _t1574;
        _t1575 = p;
        break _t1576;
      }
      _match_fail("line 16629");
    }
    return _t1575;
  }
  const _t1577 = go(ty);
  const _t1559 = _t1577;
  return _t1559;
}
function Types$match_partial_inst(inst_tys, partial) {
  let _t1579;
  const _t1578 = Hashtbl$create(4);
  _t1580: {
    if (true) {
      const bindings = _t1578;
      function match_one(inst, conc) {
        while (true) {
          let _t1582;
          const _t1581 = inst;
          _t1583: {
            if (_t1581._tag === 16) {
              const i = _t1581._val;
              let _t1585;
              const _t1584 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, bindings, i]);
              _t1586: {
                if (_t1584._tag === 1) {
                  const prev = _t1584._val;
                  let _t1587;
                  if (Types$equal_ty(prev, conc)) {
                    _t1587 = true;
                  } else {
                    const _t1588 = (function() {
                      const _t1589 = _h;
                      _h = Object.assign({}, _t1589, {
                        "unify_error": function(_, __k_try) { throw {_e: "unify_error", _v: _}; },
                      });
                      try {
                        Types$unify(prev, conc);
                        const __x_1590 = true;
                        return __x_1590;
                      } catch (_exc) {
                        if (_exc && _exc._e === "unify_error") {
                          const _ = _exc._v;
                          return false;
                        } else { throw _exc; }
                      } finally { _h = _t1589; }
                    })();
                    _t1587 = _t1588;
                  }
                  _t1585 = _t1587;
                  break _t1586;
                }
                if (_t1584._tag === 0) {
                  _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, bindings, i, conc]);
                  _t1585 = true;
                  break _t1586;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1585;
              break _t1583;
            }
            if (_t1581._tag === 0) {
              let _t1592;
              const _t1591 = Types$repr(conc);
              _t1593: {
                if (_t1591._tag === 0) {
                  _t1592 = true;
                  break _t1593;
                }
                if (true) {
                  _t1592 = false;
                  break _t1593;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1592;
              break _t1583;
            }
            if (_t1581._tag === 1) {
              let _t1595;
              const _t1594 = Types$repr(conc);
              _t1596: {
                if (_t1594._tag === 1) {
                  _t1595 = true;
                  break _t1596;
                }
                if (true) {
                  _t1595 = false;
                  break _t1596;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1595;
              break _t1583;
            }
            if (_t1581._tag === 2) {
              let _t1598;
              const _t1597 = Types$repr(conc);
              _t1599: {
                if (_t1597._tag === 2) {
                  _t1598 = true;
                  break _t1599;
                }
                if (true) {
                  _t1598 = false;
                  break _t1599;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1598;
              break _t1583;
            }
            if (_t1581._tag === 3) {
              let _t1601;
              const _t1600 = Types$repr(conc);
              _t1602: {
                if (_t1600._tag === 3) {
                  _t1601 = true;
                  break _t1602;
                }
                if (true) {
                  _t1601 = false;
                  break _t1602;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1601;
              break _t1583;
            }
            if (_t1581._tag === 6) {
              let _t1604;
              const _t1603 = Types$repr(conc);
              _t1605: {
                if (_t1603._tag === 6) {
                  _t1604 = true;
                  break _t1605;
                }
                if (true) {
                  _t1604 = false;
                  break _t1605;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1604;
              break _t1583;
            }
            if (_t1581._tag === 10) {
              const a = _t1581._val;
              let _t1607;
              const _t1606 = Types$repr(conc);
              _t1608: {
                if (_t1606._tag === 10) {
                  const b = _t1606._val;
                  const _t1609 = a;
                  const _t1610 = b;
                  inst = _t1609;
                  conc = _t1610;
                  continue;
                  _t1607 = undefined;
                  break _t1608;
                }
                if (true) {
                  _t1607 = false;
                  break _t1608;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1607;
              break _t1583;
            }
            if (_t1581._tag === 13) {
              const a = _t1581._val;
              let _t1612;
              const _t1611 = Types$repr(conc);
              _t1613: {
                if (_t1611._tag === 13) {
                  const b = _t1611._val;
                  const _t1614 = a;
                  const _t1615 = b;
                  inst = _t1614;
                  conc = _t1615;
                  continue;
                  _t1612 = undefined;
                  break _t1613;
                }
                if (true) {
                  _t1612 = false;
                  break _t1613;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1612;
              break _t1583;
            }
            if (_t1581._tag === 9) {
              const ts1 = _t1581._val;
              let _t1617;
              const _t1616 = Types$repr(conc);
              _t1618: {
                if (_t1616._tag === 9) {
                  const ts2 = _t1616._val;
                  if ((List$length(ts1) === List$length(ts2))) {
                    _t1617 = List$forall2(match_one, ts1, ts2);
                    break _t1618;
                  }
                }
                if (true) {
                  _t1617 = false;
                  break _t1618;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1617;
              break _t1583;
            }
            if (_t1581._tag === 7) {
              const a1 = _t1581._val[0];
              const _e1 = _t1581._val[1];
              const a2 = _t1581._val[2];
              let _t1620;
              const _t1619 = Types$repr(conc);
              _t1621: {
                if (_t1619._tag === 7) {
                  const b1 = _t1619._val[0];
                  const _e2 = _t1619._val[1];
                  const b2 = _t1619._val[2];
                  _t1620 = (match_one(a1, b1) && match_one(a2, b2));
                  break _t1621;
                }
                if (true) {
                  _t1620 = false;
                  break _t1621;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1620;
              break _t1583;
            }
            if (_t1581._tag === 8) {
              const a1 = _t1581._val[0];
              const _e1 = _t1581._val[1];
              const a2 = _t1581._val[2];
              let _t1623;
              const _t1622 = Types$repr(conc);
              _t1624: {
                if (_t1622._tag === 8) {
                  const b1 = _t1622._val[0];
                  const _e2 = _t1622._val[1];
                  const b2 = _t1622._val[2];
                  _t1623 = (match_one(a1, b1) && match_one(a2, b2));
                  break _t1624;
                }
                if (true) {
                  _t1623 = false;
                  break _t1624;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1623;
              break _t1583;
            }
            if (_t1581._tag === 11) {
              const r1 = _t1581._val;
              let _t1626;
              const _t1625 = Types$repr(conc);
              _t1627: {
                if (_t1625._tag === 11) {
                  const r2 = _t1625._val;
                  const f1_1628 = Types$record_row_to_fields(r1);
                  const f2_1630 = Types$record_row_to_fields(r2);
                  let _t1639;
                  if ((List$length(f1_1628) === List$length(f2_1630))) {
                  function _t1632(__p48, __p49) {
                    let _t1634;
                    const _t1633 = __p48;
                    _t1635: {
                      if (true) {
                        const n1 = _t1633[0];
                        const t1 = _t1633[1];
                        let _t1637;
                        const _t1636 = __p49;
                        _t1638: {
                          if (true) {
                            const n2 = _t1636[0];
                            const t2 = _t1636[1];
                            _t1637 = ((n1 === n2) && match_one(t1, t2));
                            break _t1638;
                          }
                          _match_fail("line 16629");
                        }
                        _t1634 = _t1637;
                        break _t1635;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1634;
                  }
                    _t1639 = List$forall2(_t1632, f1_1628, f2_1630);
                  } else {
                    _t1639 = false;
                  }
                  const _t1631 = _t1639;
                  const _t1629 = _t1631;
                  _t1626 = _t1629;
                  break _t1627;
                }
                if (true) {
                  _t1626 = false;
                  break _t1627;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1626;
              break _t1583;
            }
            if (_t1581._tag === 12) {
              const a = _t1581._val[0];
              const args_inst = _t1581._val[1];
              let _t1641;
              const _t1640 = Types$repr(conc);
              _t1642: {
                if (_t1640._tag === 12) {
                  const b = _t1640._val[0];
                  const args_conc = _t1640._val[1];
                  if (((a === b) && (List$length(args_inst) === List$length(args_conc)))) {
                    _t1641 = List$forall2(match_one, args_inst, args_conc);
                    break _t1642;
                  }
                }
                if (true) {
                  _t1641 = false;
                  break _t1642;
                }
                _match_fail("line 16629");
              }
              _t1582 = _t1641;
              break _t1583;
            }
            if (true) {
              _t1582 = Types$equal_ty(inst, conc);
              break _t1583;
            }
            _match_fail("line 16629");
          }
          return _t1582;
        }
      }
      let _t1648;
      if ((List$length(inst_tys) === List$length(partial))) {
      function _t1644(inst_ty, found_opt) {
        let _t1646;
        const _t1645 = found_opt;
        _t1647: {
          if (_t1645._tag === 0) {
            _t1646 = true;
            break _t1647;
          }
          if (_t1645._tag === 1) {
            const conc_ty = _t1645._val;
            _t1646 = match_one(inst_ty, conc_ty);
            break _t1647;
          }
          _match_fail("line 16629");
        }
        return _t1646;
      }
        _t1648 = List$forall2(_t1644, inst_tys, partial);
      } else {
        _t1648 = false;
      }
      const _t1643 = _t1648;
      _t1579 = _t1643;
      break _t1580;
    }
    _match_fail("line 16629");
  }
  return _t1579;
}
function Types$inst_specificity(inst) {
  function count(__x) {
    while (true) {
      let _t1650;
      const _t1649 = __x;
      _t1651: {
        if (_t1649._tag === 16) {
          _t1650 = 0;
          break _t1651;
        }
        if (((((((_t1649._tag === 0 || _t1649._tag === 1) || _t1649._tag === 2) || _t1649._tag === 3) || _t1649._tag === 4) || _t1649._tag === 5) || _t1649._tag === 6)) {
          _t1650 = 1;
          break _t1651;
        }
        if ((_t1649._tag === 7 || _t1649._tag === 8)) {
          const a = _t1649._val[0];
          const b = _t1649._val[2];
          _t1650 = (count(a) + count(b));
          break _t1651;
        }
        if (_t1649._tag === 9) {
          const ts = _t1649._val;
          function _t1652(acc, t) {
            return (acc + count(t));
          }
          _t1650 = List$fold(_t1652, 0, ts);
          break _t1651;
        }
        if ((_t1649._tag === 10 || _t1649._tag === 13)) {
          const a = _t1649._val;
          const _t1653 = a;
          __x = _t1653;
          continue;
          _t1650 = undefined;
          break _t1651;
        }
        if (_t1649._tag === 11) {
          const row = _t1649._val;
          function _t1654(acc, __p50) {
            let _t1656;
            const _t1655 = __p50;
            _t1657: {
              if (true) {
                const t = _t1655[1];
                _t1656 = (acc + count(t));
                break _t1657;
              }
              _match_fail("line 16629");
            }
            return _t1656;
          }
          _t1650 = List$fold(_t1654, 0, Types$record_row_to_fields(row));
          break _t1651;
        }
        if (_t1649._tag === 12) {
          const ts = _t1649._val[1];
          function _t1658(acc, t) {
            return (acc + count(t));
          }
          _t1650 = List$fold(_t1658, 0, ts);
          break _t1651;
        }
        if (_t1649._tag === 14) {
          _t1650 = 0;
          break _t1651;
        }
        if (_t1649._tag === 15 && _t1649._val.contents._tag === 1) {
          const t = _t1649._val.contents._val;
          const _t1659 = t;
          __x = _t1659;
          continue;
          _t1650 = undefined;
          break _t1651;
        }
        if (_t1649._tag === 15 && _t1649._val.contents._tag === 0) {
          _t1650 = 0;
          break _t1651;
        }
        _match_fail("line 16629");
      }
      return _t1650;
    }
  }
  function _t1661(acc, ty) {
    return (acc + count(ty));
  }
  const _t1660 = List$fold(_t1661, 0, inst.inst_tys);
  return _t1660;
}
function Types$most_specific_inst(insts) {
  let _t1663;
  const _t1662 = insts;
  _t1664: {
    if (_t1662 === null) {
      _t1663 = ({_tag: 0, _name: "None"});
      break _t1664;
    }
    if (_t1662 !== null && _t1662._tl === null) {
      const x = _t1662._hd;
      _t1663 = ({_tag: 1, _name: "Some", _val: x});
      break _t1664;
    }
    if (true) {
      function _t1665(i) {
        return [Types$inst_specificity(i), i];
      }
      const scored_1666 = List$map(_t1665, insts);
      function _t1668(__p51, __p52) {
        let _t1670;
        const _t1669 = __p51;
        _t1671: {
          if (true) {
            const a = _t1669[0];
            let _t1673;
            const _t1672 = __p52;
            _t1674: {
              if (true) {
                const b = _t1672[0];
                _t1673 = compare(b, a);
                break _t1674;
              }
              _match_fail("line 16629");
            }
            _t1670 = _t1673;
            break _t1671;
          }
          _match_fail("line 16629");
        }
        return _t1670;
      }
      const sorted_1675 = List$sort(_t1668, scored_1666);
      let _t1678;
      const _t1677 = sorted_1675;
      _t1679: {
        if (_t1677 !== null && _t1677._tl !== null) {
          const s1 = _t1677._hd[0];
          const i1 = _t1677._hd[1];
          const s2 = _t1677._tl._hd[0];
          if ((s1 > s2)) {
            _t1678 = ({_tag: 1, _name: "Some", _val: i1});
            break _t1679;
          }
        }
        if (true) {
          _t1678 = ({_tag: 0, _name: "None"});
          break _t1679;
        }
        _match_fail("line 16629");
      }
      const _t1676 = _t1678;
      const _t1667 = _t1676;
      _t1663 = _t1667;
      break _t1664;
    }
    _match_fail("line 16629");
  }
  return _t1663;
}
function Types$find_instance(instances, class_name, tys) {
  function _t1680(inst) {
    let _t1682;
    if ((inst.inst_class === class_name)) {
    function _t1681(t) {
      return ({_tag: 1, _name: "Some", _val: t});
    }
      _t1682 = Types$match_partial_inst(inst.inst_tys, List$map(_t1681, tys));
    } else {
      _t1682 = false;
    }
    return _t1682;
  }
  return List$find(_t1680, instances);
}
function Types$check_fundep_consistency(class_def, new_inst, existing_instances) {
  return _trampoline(function() {
    function _t1683(fd) {
      return _trampoline(function() {
        function _t1684(existing) {
          return _trampoline(function() {
            if ((!(existing.inst_class === new_inst.inst_class))) {
              return undefined;
            } else {
              if ((List$length(existing.inst_tys) !== List$length(new_inst.inst_tys))) {
                return undefined;
              } else {
                function _t1685(i) {
                  const ex_ty_1686 = List$nth(existing.inst_tys, i);
                  const new_ty_1688 = List$nth(new_inst.inst_tys, i);
                  const _t1689 = Types$equal_ty(ex_ty_1686, new_ty_1688);
                  const _t1687 = _t1689;
                  return _t1687;
                }
                const from_match_1690 = _resolve(List$forall(_t1685, fd.fd_from));
                if (from_match_1690) {
                  function _t1691(i) {
                    const ex_ty_1692 = List$nth(existing.inst_tys, i);
                    const new_ty_1694 = List$nth(new_inst.inst_tys, i);
                    const _t1695 = Types$equal_ty(ex_ty_1692, new_ty_1694);
                    const _t1693 = _t1695;
                    return _t1693;
                  }
                  const to_match_1696 = _resolve(List$forall(_t1691, fd.fd_to));
                  if ((!to_match_1696)) {
                    function _t1697(i) {
                      return Types$pp_ty(List$nth(new_inst.inst_tys, i));
                    }
                    const from_strs_1698 = _resolve(List$map(_t1697, fd.fd_from));
                    function _t1699(i) {
                      return Types$pp_ty(List$nth(new_inst.inst_tys, i));
                    }
                    const to_strs_new_1700 = _resolve(List$map(_t1699, fd.fd_to));
                    function _t1701(i) {
                      return Types$pp_ty(List$nth(existing.inst_tys, i));
                    }
                    const to_strs_ex_1702 = _resolve(List$map(_t1701, fd.fd_to));
                    return _h["unify_error"](((((((("functional dependency violation in class " + __dict_Show_string.show(class_def.class_name)) + ": type(s) ") + __dict_Show_string.show(String$concat(", ", from_strs_1698))) + " determine ") + __dict_Show_string.show(String$concat(", ", to_strs_new_1700))) + ", but existing instance has ") + __dict_Show_string.show(String$concat(", ", to_strs_ex_1702))), function(_t1703) {
                      return _bounce(function() {
                        return _t1703;
                      });
                    });
                  } else {
                    return undefined;
                  }
                } else {
                  return undefined;
                }
              }
            }
          });
        }
        const _t1704 = _resolve(List$iter(_t1684, existing_instances));
        return _t1704;
      });
    }
    const _t1705 = _resolve(List$iter(_t1683, class_def.class_fundeps));
    return _t1705;
  }, Types$check_fundep_consistency);
}
function Types$improve_with_fundeps(instances, class_def, partial) {
  function _t1706(partial, fd) {
    function _t1707(i) {
      return ((i < List$length(partial)) && !_eq(List$nth(partial, i), ({_tag: 0, _name: "None"})));
    }
    const from_known_1708 = List$forall(_t1707, fd.fd_from);
    let _t1710;
    if ((!from_known_1708)) {
      _t1710 = partial;
    } else {
      function _t1711(i, opt) {
        let _t1712;
        if (List$mem(i, fd.fd_from)) {
          _t1712 = opt;
        } else {
          _t1712 = ({_tag: 0, _name: "None"});
        }
        return _t1712;
      }
      const from_partial_1713 = List$mapi(_t1711, partial);
      function _t1715(inst) {
        return ((inst.inst_class === class_def.class_name) && ((List$length(inst.inst_tys) === List$length(partial)) && Types$match_partial_inst(inst.inst_tys, from_partial_1713)));
      }
      const matching_1716 = List$filter(_t1715, instances);
      let _t1719;
      const _t1718 = matching_1716;
      _t1720: {
        if (_t1718 !== null && _t1718._tl === null) {
          const inst = _t1718._hd;
          let _t1722;
          const _t1721 = Hashtbl$create(4);
          _t1723: {
            if (true) {
              const subst = _t1721;
              function _t1724(i) {
                const inst_ty_1725 = List$nth(inst.inst_tys, i);
                const conc_ty_1727 = Option$unwrap(List$nth(partial, i));
                function extract_bindings(pat, conc) {
                  while (true) {
                    let _t1730;
                    const _t1729 = [pat, Types$repr(conc)];
                    _t1731: {
                      if (_t1729[0]._tag === 16) {
                        const g = _t1729[0]._val;
                        const ty = _t1729[1];
                        _t1730 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, subst, g, ty]);
                        break _t1731;
                      }
                      if (_t1729[0]._tag === 10 && _t1729[1]._tag === 10) {
                        const a = _t1729[0]._val;
                        const b = _t1729[1]._val;
                        const _t1732 = a;
                        const _t1733 = b;
                        pat = _t1732;
                        conc = _t1733;
                        continue;
                        _t1730 = undefined;
                        break _t1731;
                      }
                      if (_t1729[0]._tag === 13 && _t1729[1]._tag === 13) {
                        const a = _t1729[0]._val;
                        const b = _t1729[1]._val;
                        const _t1734 = a;
                        const _t1735 = b;
                        pat = _t1734;
                        conc = _t1735;
                        continue;
                        _t1730 = undefined;
                        break _t1731;
                      }
                      if (_t1729[0]._tag === 9 && _t1729[1]._tag === 9) {
                        const ts1 = _t1729[0]._val;
                        const ts2 = _t1729[1]._val;
                        if ((List$length(ts1) === List$length(ts2))) {
                          _t1730 = List$iter2(extract_bindings, ts1, ts2);
                          break _t1731;
                        }
                      }
                      if (_t1729[0]._tag === 12 && _t1729[1]._tag === 12) {
                        const args1 = _t1729[0]._val[1];
                        const args2 = _t1729[1]._val[1];
                        if ((List$length(args1) === List$length(args2))) {
                          _t1730 = List$iter2(extract_bindings, args1, args2);
                          break _t1731;
                        }
                      }
                      if ((_t1729[0]._tag === 7 && _t1729[1]._tag === 7 || _t1729[0]._tag === 8 && _t1729[1]._tag === 8)) {
                        const a1 = _t1729[0]._val[0];
                        const r1 = _t1729[0]._val[2];
                        const a2 = _t1729[1]._val[0];
                        const r2 = _t1729[1]._val[2];
                        extract_bindings(a1, a2);
                        const _t1736 = r1;
                        const _t1737 = r2;
                        pat = _t1736;
                        conc = _t1737;
                        continue;
                        _t1730 = undefined;
                        break _t1731;
                      }
                      if (true) {
                        _t1730 = undefined;
                        break _t1731;
                      }
                      _match_fail("line 16629");
                    }
                    return _t1730;
                  }
                }
                const _t1738 = extract_bindings(inst_ty_1725, conc_ty_1727);
                const _t1728 = _t1738;
                const _t1726 = _t1728;
                return _t1726;
              }
              List$iter(_t1724, fd.fd_from);
              function apply_subst(ty) {
                let _t1740;
                const _t1739 = ty;
                _t1741: {
                  if (_t1739._tag === 16) {
                    const g = _t1739._val;
                    let _t1743;
                    const _t1742 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, subst, g]);
                    _t1744: {
                      if (_t1742._tag === 1) {
                        const t = _t1742._val;
                        _t1743 = t;
                        break _t1744;
                      }
                      if (_t1742._tag === 0) {
                        _t1743 = ty;
                        break _t1744;
                      }
                      _match_fail("line 16629");
                    }
                    _t1740 = _t1743;
                    break _t1741;
                  }
                  if (_t1739._tag === 10) {
                    const a = _t1739._val;
                    _t1740 = ({_tag: 10, _name: "TList", _val: apply_subst(a)});
                    break _t1741;
                  }
                  if (_t1739._tag === 13) {
                    const a = _t1739._val;
                    _t1740 = ({_tag: 13, _name: "TArray", _val: apply_subst(a)});
                    break _t1741;
                  }
                  if (_t1739._tag === 9) {
                    const ts = _t1739._val;
                    _t1740 = ({_tag: 9, _name: "TTuple", _val: List$map(apply_subst, ts)});
                    break _t1741;
                  }
                  if (_t1739._tag === 12) {
                    const n = _t1739._val[0];
                    const args = _t1739._val[1];
                    _t1740 = ({_tag: 12, _name: "TVariant", _val: [n, List$map(apply_subst, args)]});
                    break _t1741;
                  }
                  if (_t1739._tag === 7) {
                    const a = _t1739._val[0];
                    const e = _t1739._val[1];
                    const r = _t1739._val[2];
                    _t1740 = ({_tag: 7, _name: "TArrow", _val: [apply_subst(a), e, apply_subst(r)]});
                    break _t1741;
                  }
                  if (_t1739._tag === 8) {
                    const a = _t1739._val[0];
                    const e = _t1739._val[1];
                    const r = _t1739._val[2];
                    _t1740 = ({_tag: 8, _name: "TCont", _val: [apply_subst(a), e, apply_subst(r)]});
                    break _t1741;
                  }
                  if (true) {
                    _t1740 = ty;
                    break _t1741;
                  }
                  _match_fail("line 16629");
                }
                return _t1740;
              }
              function _t1746(i, opt) {
                let _t1747;
                if (!_eq(opt, ({_tag: 0, _name: "None"}))) {
                  _t1747 = opt;
                } else {
                  let _t1748;
                  if (List$mem(i, fd.fd_to)) {
                    _t1748 = ({_tag: 1, _name: "Some", _val: apply_subst(List$nth(inst.inst_tys, i))});
                  } else {
                    _t1748 = opt;
                  }
                  _t1747 = _t1748;
                }
                return _t1747;
              }
              const _t1745 = List$mapi(_t1746, partial);
              _t1722 = _t1745;
              break _t1723;
            }
            _match_fail("line 16629");
          }
          _t1719 = _t1722;
          break _t1720;
        }
        if (true) {
          _t1719 = partial;
          break _t1720;
        }
        _match_fail("line 16629");
      }
      const _t1717 = _t1719;
      const _t1714 = _t1717;
      _t1710 = _t1714;
    }
    const _t1709 = _t1710;
    return _t1709;
  }
  return List$fold(_t1706, partial, class_def.class_fundeps);
}
function Lexer$create(source) {
  return ({col: 1, cursor: 0, len: String$length(source), line: 1, source: source});
}
function Lexer$current_loc(l) {
  return ({col: l.col, line: l.line, offset: l.cursor});
}
function Lexer$make_token(l, kind, loc) {
  return ({end_offset: l.cursor, kind: kind, loc: loc});
}
function Lexer$at_end(l) {
  return (l.cursor >= l.len);
}
function Lexer$peek(l) {
  let _t1749;
  if (Lexer$at_end(l)) {
    _t1749 = 0;
  } else {
    _t1749 = String$get(l.source, l.cursor);
  }
  return _t1749;
}
function Lexer$peek2(l) {
  let _t1750;
  if (((l.cursor + 1) >= l.len)) {
    _t1750 = 0;
  } else {
    _t1750 = String$get(l.source, (l.cursor + 1));
  }
  return _t1750;
}
function Lexer$peek3(l) {
  let _t1751;
  if (((l.cursor + 2) >= l.len)) {
    _t1751 = 0;
  } else {
    _t1751 = String$get(l.source, (l.cursor + 2));
  }
  return _t1751;
}
function Lexer$advance(l) {
  const c_1752 = String$get(l.source, l.cursor);
  (l.cursor = (l.cursor + 1), undefined);
  let _t1754;
  if ((c_1752 === 10)) {
    (l.line = (l.line + 1), undefined);
    _t1754 = (l.col = 1, undefined);
  } else {
    _t1754 = (l.col = (l.col + 1), undefined);
  }
  _t1754;
  const _t1753 = c_1752;
  return _t1753;
}
function Lexer$error(l, msg) {
  return _trampoline(function() {
    return _h["lex_error"]([msg, Lexer$current_loc(l)], function(_t1755) {
      return _bounce(function() {
        return _t1755;
      });
    });
  }, Lexer$error);
}
function Lexer$skip_whitespace(l) {
  let _t1756 = undefined;
  let _t1757 = false, _t1758;
  while (true) {
    if (!(((!Lexer$at_end(l)) && ((Lexer$peek(l) === 32) || ((Lexer$peek(l) === 9) || ((Lexer$peek(l) === 10) || (Lexer$peek(l) === 13))))))) break;
    Lexer$advance(l);
    undefined;
    if (_t1757) break;
  }
  _t1756 = _t1757 ? _t1758 : undefined;
  return _t1756;
}
function Lexer$skip_comment(l) {
  const depth_1759 = Ref$create(1);
  let _t1761 = undefined;
  let _t1762 = false, _t1763;
  while (true) {
    if (!((Ref$get(depth_1759) > 0))) break;
    let _t1764;
    if (Lexer$at_end(l)) {
      _t1764 = Lexer$error(l, "unterminated comment");
    } else {
      _t1764 = undefined;
    }
    _t1764;
    let _t1765;
    if (((Lexer$peek(l) === 40) && (Lexer$peek2(l) === 42))) {
      Lexer$advance(l);
      undefined;
      Lexer$advance(l);
      undefined;
      _t1765 = Ref$set(depth_1759, (Ref$get(depth_1759) + 1));
    } else {
      let _t1766;
      if (((Lexer$peek(l) === 42) && (Lexer$peek2(l) === 41))) {
        Lexer$advance(l);
        undefined;
        Lexer$advance(l);
        undefined;
        _t1766 = Ref$set(depth_1759, (Ref$get(depth_1759) - 1));
      } else {
        Lexer$advance(l);
        _t1766 = undefined;
      }
      _t1765 = _t1766;
    }
    _t1765;
    if (_t1762) break;
  }
  _t1761 = _t1762 ? _t1763 : undefined;
  const _t1760 = _t1761;
  return _t1760;
}
function Lexer$skip_whitespace_and_comments(l) {
  const changed_1767 = Ref$create(true);
  let _t1769 = undefined;
  let _t1770 = false, _t1771;
  while (true) {
    if (!(Ref$get(changed_1767))) break;
    Ref$set(changed_1767, false);
    const p_1772 = l.cursor;
    Lexer$skip_whitespace(l);
    let _t1774;
    if (((!Lexer$at_end(l)) && ((Lexer$peek(l) === 40) && ((Lexer$peek2(l) === 42) && (Lexer$peek3(l) !== 41))))) {
      Lexer$advance(l);
      undefined;
      Lexer$advance(l);
      undefined;
      Lexer$skip_comment(l);
      _t1774 = Ref$set(changed_1767, true);
    } else {
      _t1774 = undefined;
    }
    _t1774;
    let _t1775;
    if ((l.cursor !== p_1772)) {
      _t1775 = Ref$set(changed_1767, true);
    } else {
      _t1775 = undefined;
    }
    const _t1773 = _t1775;
    _t1773;
    if (_t1770) break;
  }
  _t1769 = _t1770 ? _t1771 : undefined;
  const _t1768 = _t1769;
  return _t1768;
}
function Lexer$is_digit(c) {
  return ((c >= 48) && (c <= 57));
}
function Lexer$is_hex_digit(c) {
  return (Lexer$is_digit(c) || (((c >= 97) && (c <= 102)) || ((c >= 65) && (c <= 70))));
}
function Lexer$hex_val(c) {
  let _t1776;
  if (((c >= 48) && (c <= 57))) {
    _t1776 = (Byte$to_int(c) - Byte$to_int(48));
  } else {
    let _t1777;
    if (((c >= 97) && (c <= 102))) {
      _t1777 = ((Byte$to_int(c) - Byte$to_int(97)) + 10);
    } else {
      _t1777 = ((Byte$to_int(c) - Byte$to_int(65)) + 10);
    }
    _t1776 = _t1777;
  }
  return _t1776;
}
function Lexer$is_alpha(c) {
  return (((c >= 97) && (c <= 122)) || ((c >= 65) && (c <= 90)));
}
function Lexer$is_ident_start(c) {
  return (Lexer$is_alpha(c) || (c === 95));
}
function Lexer$is_ident_char(c) {
  return (Lexer$is_alpha(c) || (Lexer$is_digit(c) || ((c === 95) || (c === 39))));
}
const Lexer$keywords = ({_hd: ["let", ({_tag: 11, _name: "LET"})], _tl: ({_hd: ["rec", ({_tag: 12, _name: "REC"})], _tl: ({_hd: ["in", ({_tag: 13, _name: "IN"})], _tl: ({_hd: ["if", ({_tag: 14, _name: "IF"})], _tl: ({_hd: ["else", ({_tag: 15, _name: "ELSE"})], _tl: ({_hd: ["fn", ({_tag: 16, _name: "FN"})], _tl: ({_hd: ["match", ({_tag: 17, _name: "MATCH"})], _tl: ({_hd: ["with", ({_tag: 18, _name: "WITH"})], _tl: ({_hd: ["type", ({_tag: 19, _name: "TYPE"})], _tl: ({_hd: ["newtype", ({_tag: 20, _name: "NEWTYPE"})], _tl: ({_hd: ["of", ({_tag: 21, _name: "OF"})], _tl: ({_hd: ["not", ({_tag: 40, _name: "NOT"})], _tl: ({_hd: ["mod", ({_tag: 43, _name: "MOD"})], _tl: ({_hd: ["true", ({_tag: 6, _name: "TRUE"})], _tl: ({_hd: ["false", ({_tag: 7, _name: "FALSE"})], _tl: ({_hd: ["class", ({_tag: 22, _name: "CLASS"})], _tl: ({_hd: ["instance", ({_tag: 23, _name: "INSTANCE"})], _tl: ({_hd: ["effect", ({_tag: 24, _name: "EFFECT"})], _tl: ({_hd: ["extern", ({_tag: 25, _name: "EXTERN"})], _tl: ({_hd: ["perform", ({_tag: 26, _name: "PERFORM"})], _tl: ({_hd: ["handle", ({_tag: 27, _name: "HANDLE"})], _tl: ({_hd: ["try", ({_tag: 28, _name: "TRY"})], _tl: ({_hd: ["provide", ({_tag: 29, _name: "PROVIDE"})], _tl: ({_hd: ["resume", ({_tag: 31, _name: "RESUME"})], _tl: ({_hd: ["return", ({_tag: 32, _name: "RETURN"})], _tl: ({_hd: ["continue", ({_tag: 30, _name: "CONTINUE"})], _tl: ({_hd: ["mut", ({_tag: 33, _name: "MUT"})], _tl: ({_hd: ["for", ({_tag: 34, _name: "FOR"})], _tl: ({_hd: ["do", ({_tag: 35, _name: "DO"})], _tl: ({_hd: ["break", ({_tag: 36, _name: "BREAK"})], _tl: ({_hd: ["when", ({_tag: 37, _name: "WHEN"})], _tl: ({_hd: ["where", ({_tag: 38, _name: "WHERE"})], _tl: ({_hd: ["module", ({_tag: 44, _name: "MODULE"})], _tl: ({_hd: ["pub", ({_tag: 45, _name: "PUB"})], _tl: ({_hd: ["open", ({_tag: 46, _name: "OPEN"})], _tl: ({_hd: ["end", ({_tag: 47, _name: "END"})], _tl: ({_hd: ["opaque", ({_tag: 48, _name: "OPAQUE"})], _tl: ({_hd: ["and", ({_tag: 50, _name: "AND"})], _tl: ({_hd: ["deriving", ({_tag: 51, _name: "DERIVING"})], _tl: ({_hd: ["land", ({_tag: 83, _name: "LAND"})], _tl: ({_hd: ["lor", ({_tag: 84, _name: "LOR"})], _tl: ({_hd: ["lxor", ({_tag: 85, _name: "LXOR"})], _tl: ({_hd: ["lnot", ({_tag: 86, _name: "LNOT"})], _tl: ({_hd: ["lsl", ({_tag: 87, _name: "LSL"})], _tl: ({_hd: ["lsr", ({_tag: 88, _name: "LSR"})], _tl: null})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})});
function Lexer$read_number(l) {
  const loc_1778 = Lexer$current_loc(l);
  const buf_1780 = Buffer$create(16);
  const c_1782 = Lexer$advance(l);
  Buffer$add_byte(buf_1780, c_1782);
  let _t1784;
  if (((c_1782 === 48) && ((!Lexer$at_end(l)) && ((Lexer$peek(l) === 120) || (Lexer$peek(l) === 88))))) {
    Buffer$add_byte(buf_1780, Lexer$advance(l));
    let _t1785 = undefined;
    let _t1786 = false, _t1787;
    while (true) {
      if (!(((!Lexer$at_end(l)) && Lexer$is_hex_digit(Lexer$peek(l))))) break;
      Buffer$add_byte(buf_1780, Lexer$advance(l));
      if (_t1786) break;
    }
    _t1785 = _t1786 ? _t1787 : undefined;
    _t1785;
    const n_1788 = int_of_string(Buffer$contents(buf_1780));
    const _t1789 = Lexer$make_token(l, ({_tag: 0, _name: "INT", _val: n_1788}), loc_1778);
    _t1784 = _t1789;
  } else {
    let _t1790;
    if (((c_1782 === 48) && ((!Lexer$at_end(l)) && ((Lexer$peek(l) === 98) || (Lexer$peek(l) === 66))))) {
      Buffer$add_byte(buf_1780, Lexer$advance(l));
      let _t1791 = undefined;
      let _t1792 = false, _t1793;
      while (true) {
        if (!(((!Lexer$at_end(l)) && ((Lexer$peek(l) === 48) || (Lexer$peek(l) === 49))))) break;
        Buffer$add_byte(buf_1780, Lexer$advance(l));
        if (_t1792) break;
      }
      _t1791 = _t1792 ? _t1793 : undefined;
      _t1791;
      const n_1794 = int_of_string(Buffer$contents(buf_1780));
      const _t1795 = Lexer$make_token(l, ({_tag: 0, _name: "INT", _val: n_1794}), loc_1778);
      _t1790 = _t1795;
    } else {
      let _t1796 = undefined;
      let _t1797 = false, _t1798;
      while (true) {
        if (!(((!Lexer$at_end(l)) && Lexer$is_digit(Lexer$peek(l))))) break;
        Buffer$add_byte(buf_1780, Lexer$advance(l));
        if (_t1797) break;
      }
      _t1796 = _t1797 ? _t1798 : undefined;
      _t1796;
      let _t1799;
      if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 46))) {
        Buffer$add_byte(buf_1780, Lexer$advance(l));
        let _t1800 = undefined;
        let _t1801 = false, _t1802;
        while (true) {
          if (!(((!Lexer$at_end(l)) && Lexer$is_digit(Lexer$peek(l))))) break;
          Buffer$add_byte(buf_1780, Lexer$advance(l));
          if (_t1801) break;
        }
        _t1800 = _t1801 ? _t1802 : undefined;
        _t1800;
        const f_1803 = float_of_string(Buffer$contents(buf_1780));
        const _t1804 = Lexer$make_token(l, ({_tag: 1, _name: "FLOAT", _val: f_1803}), loc_1778);
        _t1799 = _t1804;
      } else {
        const n_1805 = int_of_string(Buffer$contents(buf_1780));
        const _t1806 = Lexer$make_token(l, ({_tag: 0, _name: "INT", _val: n_1805}), loc_1778);
        _t1799 = _t1806;
      }
      _t1790 = _t1799;
    }
    _t1784 = _t1790;
  }
  const _t1783 = _t1784;
  const _t1781 = _t1783;
  const _t1779 = _t1781;
  return _t1779;
}
function Lexer$read_string(l) {
  const loc_1807 = Lexer$current_loc(l);
  Lexer$advance(l);
  undefined;
  const buf_1809 = Buffer$create(64);
  let _t1811 = undefined;
  let _t1812 = false, _t1813;
  while (true) {
    if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 34)))) break;
    let _t1814;
    if ((Lexer$peek(l) === 92)) {
      Lexer$advance(l);
      undefined;
      let _t1815;
      if (Lexer$at_end(l)) {
        _t1815 = Lexer$error(l, "unterminated string");
      } else {
        _t1815 = undefined;
      }
      _t1815;
      const c_1816 = Lexer$advance(l);
      let _t1819;
      const _t1818 = c_1816;
      _t1820: {
        if (true) {
          const _c = _t1818;
          if ((_c === 110)) {
            _t1819 = Buffer$add_byte(buf_1809, 10);
            break _t1820;
          }
        }
        if (true) {
          const _c = _t1818;
          if ((_c === 116)) {
            _t1819 = Buffer$add_byte(buf_1809, 9);
            break _t1820;
          }
        }
        if (true) {
          const _c = _t1818;
          if ((_c === 92)) {
            _t1819 = Buffer$add_byte(buf_1809, 92);
            break _t1820;
          }
        }
        if (true) {
          const _c = _t1818;
          if ((_c === 34)) {
            _t1819 = Buffer$add_byte(buf_1809, 34);
            break _t1820;
          }
        }
        if (true) {
          _t1819 = Lexer$error(l, ("unknown escape: \\" + __dict_Show_byte.show(c_1816)));
          break _t1820;
        }
        _match_fail("line 16629");
      }
      const _t1817 = _t1819;
      _t1814 = _t1817;
    } else {
      _t1814 = Buffer$add_byte(buf_1809, Lexer$advance(l));
    }
    _t1814;
    if (_t1812) break;
  }
  _t1811 = _t1812 ? _t1813 : undefined;
  _t1811;
  let _t1821;
  if (Lexer$at_end(l)) {
    _t1821 = Lexer$error(l, "unterminated string");
  } else {
    _t1821 = undefined;
  }
  _t1821;
  Lexer$advance(l);
  undefined;
  const _t1810 = Lexer$make_token(l, ({_tag: 2, _name: "STRING", _val: Buffer$contents(buf_1809)}), loc_1807);
  const _t1808 = _t1810;
  return _t1808;
}
function Lexer$dedent_raw(s) {
  const lines_1822 = String$split("\n", s);
  let _t1825;
  const _t1824 = lines_1822;
  _t1826: {
    if (_t1824 !== null) {
      const first = _t1824._hd;
      const rest = _t1824._tl;
      if ((String$trim(first) === "")) {
        _t1825 = rest;
        break _t1826;
      }
    }
    if (true) {
      _t1825 = lines_1822;
      break _t1826;
    }
    _match_fail("line 16629");
  }
  const lines_1827 = _t1825;
  let _t1830;
  const _t1829 = List$rev(lines_1827);
  _t1831: {
    if (_t1829 !== null) {
      const last = _t1829._hd;
      const rest = _t1829._tl;
      if ((String$trim(last) === "")) {
        _t1830 = List$rev(rest);
        break _t1831;
      }
    }
    if (true) {
      _t1830 = lines_1827;
      break _t1831;
    }
    _match_fail("line 16629");
  }
  const lines_1832 = _t1830;
  function _t1834(acc, line) {
    let _t1835;
    if ((String$trim(line) === "")) {
      _t1835 = acc;
    } else {
      const len_1836 = String$length(line);
      const i_1838 = Ref$create(0);
      let _t1840 = undefined;
      let _t1841 = false, _t1842;
      while (true) {
        if (!(((Ref$get(i_1838) < len_1836) && ((String$get(line, Ref$get(i_1838)) === 32) || (String$get(line, Ref$get(i_1838)) === 9))))) break;
        Ref$set(i_1838, (Ref$get(i_1838) + 1));
        if (_t1841) break;
      }
      _t1840 = _t1841 ? _t1842 : undefined;
      _t1840;
      let _t1844;
      const _t1843 = acc;
      _t1845: {
        if (_t1843._tag === 0) {
          _t1844 = ({_tag: 1, _name: "Some", _val: Ref$get(i_1838)});
          break _t1845;
        }
        if (_t1843._tag === 1) {
          const prev = _t1843._val;
          _t1844 = ({_tag: 1, _name: "Some", _val: min(prev, Ref$get(i_1838))});
          break _t1845;
        }
        _match_fail("line 16629");
      }
      const _t1839 = _t1844;
      const _t1837 = _t1839;
      _t1835 = _t1837;
    }
    return _t1835;
  }
  const indent_1846 = List$fold(_t1834, ({_tag: 0, _name: "None"}), lines_1832);
  let _t1849;
  const _t1848 = indent_1846;
  _t1850: {
    if (_t1848._tag === 1) {
      const n = _t1848._val;
      _t1849 = n;
      break _t1850;
    }
    if (_t1848._tag === 0) {
      _t1849 = 0;
      break _t1850;
    }
    _match_fail("line 16629");
  }
  const indent_1851 = _t1849;
  function _t1853(line) {
    const len_1854 = String$length(line);
    let _t1856;
    if ((len_1854 >= indent_1851)) {
      _t1856 = String$sub(line, indent_1851, (len_1854 - indent_1851));
    } else {
      _t1856 = line;
    }
    const _t1855 = _t1856;
    return _t1855;
  }
  const lines_1857 = List$map(_t1853, lines_1832);
  const _t1858 = String$concat("\n", lines_1857);
  const _t1852 = _t1858;
  const _t1847 = _t1852;
  const _t1833 = _t1847;
  const _t1828 = _t1833;
  const _t1823 = _t1828;
  return _t1823;
}
function Lexer$read_raw_string(l) {
  const loc_1859 = Lexer$current_loc(l);
  Lexer$advance(l);
  undefined;
  Lexer$advance(l);
  undefined;
  const buf_1861 = Buffer$create(256);
  let _t1863 = undefined;
  let _t1864 = false, _t1865;
  while (true) {
    if (!(((!Lexer$at_end(l)) && (!((Lexer$peek(l) === 124) && (Lexer$peek2(l) === 125)))))) break;
    Buffer$add_byte(buf_1861, Lexer$advance(l));
    if (_t1864) break;
  }
  _t1863 = _t1864 ? _t1865 : undefined;
  _t1863;
  let _t1866;
  if (Lexer$at_end(l)) {
    _t1866 = Lexer$error(l, "unterminated raw string");
  } else {
    _t1866 = undefined;
  }
  _t1866;
  Lexer$advance(l);
  undefined;
  Lexer$advance(l);
  undefined;
  const raw_1867 = Buffer$contents(buf_1861);
  const _t1868 = Lexer$make_token(l, ({_tag: 2, _name: "STRING", _val: Lexer$dedent_raw(raw_1867)}), loc_1859);
  const _t1862 = _t1868;
  const _t1860 = _t1862;
  return _t1860;
}
function Lexer$read_interp_string(l) {
  const loc_1869 = Lexer$current_loc(l);
  Lexer$advance(l);
  undefined;
  Lexer$advance(l);
  undefined;
  const parts_1871 = Ref$create(null);
  const buf_1873 = Buffer$create(64);
  function _t1875(_) {
    let _t1876;
    if ((Buffer$length(buf_1873) > 0)) {
      Ref$set(parts_1871, ({_hd: ({_tag: 0, _name: "IPLit", _val: Buffer$contents(buf_1873)}), _tl: Ref$get(parts_1871)}));
      _t1876 = Buffer$clear(buf_1873);
    } else {
      _t1876 = undefined;
    }
    return _t1876;
  }
  const flush_lit_1877 = _t1875;
  let _t1879 = undefined;
  let _t1880 = false, _t1881;
  while (true) {
    if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 34)))) break;
    let _t1882;
    if ((Lexer$peek(l) === 92)) {
      Lexer$advance(l);
      undefined;
      let _t1883;
      if (Lexer$at_end(l)) {
        _t1883 = Lexer$error(l, "unterminated interpolated string");
      } else {
        _t1883 = undefined;
      }
      _t1883;
      const c_1884 = Lexer$advance(l);
      let _t1887;
      const _t1886 = c_1884;
      _t1888: {
        if (true) {
          const _c = _t1886;
          if ((_c === 110)) {
            _t1887 = Buffer$add_byte(buf_1873, 10);
            break _t1888;
          }
        }
        if (true) {
          const _c = _t1886;
          if ((_c === 116)) {
            _t1887 = Buffer$add_byte(buf_1873, 9);
            break _t1888;
          }
        }
        if (true) {
          const _c = _t1886;
          if ((_c === 92)) {
            _t1887 = Buffer$add_byte(buf_1873, 92);
            break _t1888;
          }
        }
        if (true) {
          const _c = _t1886;
          if ((_c === 34)) {
            _t1887 = Buffer$add_byte(buf_1873, 34);
            break _t1888;
          }
        }
        if (true) {
          const _c = _t1886;
          if ((_c === 123)) {
            _t1887 = Buffer$add_byte(buf_1873, 123);
            break _t1888;
          }
        }
        if (true) {
          const _c = _t1886;
          if ((_c === 125)) {
            _t1887 = Buffer$add_byte(buf_1873, 125);
            break _t1888;
          }
        }
        if (true) {
          _t1887 = Lexer$error(l, ("unknown escape: \\" + __dict_Show_byte.show(c_1884)));
          break _t1888;
        }
        _match_fail("line 16629");
      }
      const _t1885 = _t1887;
      _t1882 = _t1885;
    } else {
      let _t1889;
      if ((Lexer$peek(l) === 123)) {
        flush_lit_1877(undefined);
        Lexer$advance(l);
        undefined;
        const expr_buf_1890 = Buffer$create(64);
        const fmt_buf_1892 = Buffer$create(16);
        const depth_1894 = Ref$create(1);
        const paren_depth_1896 = Ref$create(0);
        const in_fmt_1898 = Ref$create(false);
        let _t1900 = undefined;
        let _t1901 = false, _t1902;
        while (true) {
          if (!((Ref$get(depth_1894) > 0))) break;
          let _t1903;
          if (Lexer$at_end(l)) {
            _t1903 = Lexer$error(l, "unterminated interpolation expression");
          } else {
            _t1903 = undefined;
          }
          _t1903;
          const c_1904 = Lexer$peek(l);
          let _t1906;
          if ((c_1904 === 123)) {
            Ref$set(depth_1894, (Ref$get(depth_1894) + 1));
            let _t1907;
            if (Ref$get(in_fmt_1898)) {
              _t1907 = fmt_buf_1892;
            } else {
              _t1907 = expr_buf_1890;
            }
            _t1906 = Buffer$add_byte(_t1907, Lexer$advance(l));
          } else {
            let _t1908;
            if ((c_1904 === 125)) {
              Ref$set(depth_1894, (Ref$get(depth_1894) - 1));
              let _t1909;
              if ((Ref$get(depth_1894) > 0)) {
                let _t1910;
                if (Ref$get(in_fmt_1898)) {
                  _t1910 = fmt_buf_1892;
                } else {
                  _t1910 = expr_buf_1890;
                }
                _t1909 = Buffer$add_byte(_t1910, Lexer$advance(l));
              } else {
                Lexer$advance(l);
                _t1909 = undefined;
              }
              _t1908 = _t1909;
            } else {
              let _t1911;
              if ((c_1904 === 40)) {
                Ref$set(paren_depth_1896, (Ref$get(paren_depth_1896) + 1));
                let _t1912;
                if (Ref$get(in_fmt_1898)) {
                  _t1912 = fmt_buf_1892;
                } else {
                  _t1912 = expr_buf_1890;
                }
                _t1911 = Buffer$add_byte(_t1912, Lexer$advance(l));
              } else {
                let _t1913;
                if ((c_1904 === 41)) {
                  let _t1914;
                  if ((Ref$get(paren_depth_1896) > 0)) {
                    _t1914 = Ref$set(paren_depth_1896, (Ref$get(paren_depth_1896) - 1));
                  } else {
                    _t1914 = undefined;
                  }
                  _t1914;
                  let _t1915;
                  if (Ref$get(in_fmt_1898)) {
                    _t1915 = fmt_buf_1892;
                  } else {
                    _t1915 = expr_buf_1890;
                  }
                  _t1913 = Buffer$add_byte(_t1915, Lexer$advance(l));
                } else {
                  let _t1916;
                  if (((c_1904 === 58) && ((Ref$get(depth_1894) === 1) && ((Ref$get(paren_depth_1896) === 0) && (!Ref$get(in_fmt_1898)))))) {
                    Lexer$advance(l);
                    undefined;
                    _t1916 = Ref$set(in_fmt_1898, true);
                  } else {
                    let _t1917;
                    if ((c_1904 === 34)) {
                      let _t1918;
                      if (Ref$get(in_fmt_1898)) {
                        _t1918 = fmt_buf_1892;
                      } else {
                        _t1918 = expr_buf_1890;
                      }
                      const buf_1919 = _t1918;
                      Buffer$add_byte(buf_1919, Lexer$advance(l));
                      let _t1921 = undefined;
                      let _t1922 = false, _t1923;
                      while (true) {
                        if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 34)))) break;
                        let _t1924;
                        if ((Lexer$peek(l) === 92)) {
                          Buffer$add_byte(buf_1919, Lexer$advance(l));
                          let _t1925;
                          if ((!Lexer$at_end(l))) {
                            _t1925 = Buffer$add_byte(buf_1919, Lexer$advance(l));
                          } else {
                            _t1925 = undefined;
                          }
                          _t1924 = _t1925;
                        } else {
                          _t1924 = Buffer$add_byte(buf_1919, Lexer$advance(l));
                        }
                        _t1924;
                        if (_t1922) break;
                      }
                      _t1921 = _t1922 ? _t1923 : undefined;
                      _t1921;
                      let _t1926;
                      if ((!Lexer$at_end(l))) {
                        _t1926 = Buffer$add_byte(buf_1919, Lexer$advance(l));
                      } else {
                        _t1926 = undefined;
                      }
                      const _t1920 = _t1926;
                      _t1917 = _t1920;
                    } else {
                      let _t1927;
                      if (Ref$get(in_fmt_1898)) {
                        _t1927 = fmt_buf_1892;
                      } else {
                        _t1927 = expr_buf_1890;
                      }
                      _t1917 = Buffer$add_byte(_t1927, Lexer$advance(l));
                    }
                    _t1916 = _t1917;
                  }
                  _t1913 = _t1916;
                }
                _t1911 = _t1913;
              }
              _t1908 = _t1911;
            }
            _t1906 = _t1908;
          }
          const _t1905 = _t1906;
          _t1905;
          if (_t1901) break;
        }
        _t1900 = _t1901 ? _t1902 : undefined;
        _t1900;
        let _t1928;
        if (Ref$get(in_fmt_1898)) {
          _t1928 = ({_tag: 1, _name: "Some", _val: Buffer$contents(fmt_buf_1892)});
        } else {
          _t1928 = ({_tag: 0, _name: "None"});
        }
        const fmt_1929 = _t1928;
        const _t1930 = Ref$set(parts_1871, ({_hd: ({_tag: 1, _name: "IPExpr", _val: [Buffer$contents(expr_buf_1890), fmt_1929]}), _tl: Ref$get(parts_1871)}));
        const _t1899 = _t1930;
        const _t1897 = _t1899;
        const _t1895 = _t1897;
        const _t1893 = _t1895;
        const _t1891 = _t1893;
        _t1889 = _t1891;
      } else {
        _t1889 = Buffer$add_byte(buf_1873, Lexer$advance(l));
      }
      _t1882 = _t1889;
    }
    _t1882;
    if (_t1880) break;
  }
  _t1879 = _t1880 ? _t1881 : undefined;
  _t1879;
  let _t1931;
  if (Lexer$at_end(l)) {
    _t1931 = Lexer$error(l, "unterminated interpolated string");
  } else {
    _t1931 = undefined;
  }
  _t1931;
  Lexer$advance(l);
  undefined;
  flush_lit_1877(undefined);
  const _t1878 = Lexer$make_token(l, ({_tag: 3, _name: "INTERP_STRING", _val: List$rev(Ref$get(parts_1871))}), loc_1869);
  const _t1874 = _t1878;
  const _t1872 = _t1874;
  const _t1870 = _t1872;
  return _t1870;
}
function Lexer$read_ident_or_keyword(l) {
  const loc_1932 = Lexer$current_loc(l);
  const buf_1934 = Buffer$create(32);
  let _t1936 = undefined;
  let _t1937 = false, _t1938;
  while (true) {
    if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
    Buffer$add_byte(buf_1934, Lexer$advance(l));
    if (_t1937) break;
  }
  _t1936 = _t1937 ? _t1938 : undefined;
  _t1936;
  const s_1939 = Buffer$contents(buf_1934);
  let _t1942;
  const _t1941 = List$assoc_opt(s_1939, Lexer$keywords);
  _t1943: {
    if (_t1941._tag === 1) {
      const kw = _t1941._val;
      _t1942 = kw;
      break _t1943;
    }
    if (_t1941._tag === 0) {
      let _t1944;
      if ((s_1939 === "_")) {
        _t1944 = ({_tag: 67, _name: "UNDERSCORE"});
      } else {
        let _t1945;
        if (((Byte$to_upper(String$get(s_1939, 0)) === String$get(s_1939, 0)) && (String$get(s_1939, 0) !== 95))) {
          _t1945 = ({_tag: 9, _name: "UIDENT", _val: s_1939});
        } else {
          _t1945 = ({_tag: 8, _name: "IDENT", _val: s_1939});
        }
        _t1944 = _t1945;
      }
      _t1942 = _t1944;
      break _t1943;
    }
    _match_fail("line 16629");
  }
  const kind_1946 = _t1942;
  const _t1947 = Lexer$make_token(l, kind_1946, loc_1932);
  const _t1940 = _t1947;
  const _t1935 = _t1940;
  const _t1933 = _t1935;
  return _t1933;
}
function Lexer$next_token(l) {
  while (true) {
    Lexer$skip_whitespace_and_comments(l);
    let _t1948;
    if (Lexer$at_end(l)) {
      _t1948 = Lexer$make_token(l, ({_tag: 91, _name: "EOF"}), Lexer$current_loc(l));
    } else {
      const loc_1949 = Lexer$current_loc(l);
      const c_1951 = Lexer$peek(l);
      let _t1954;
      const _t1953 = c_1951;
      _t1955: {
        if (true) {
          const _c = _t1953;
          if (((_c >= 48) && (_c <= 57))) {
            _t1954 = Lexer$read_number(l);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((((_c === 36) && (!Lexer$at_end(l))) && (Lexer$peek2(l) === 34))) {
            _t1954 = Lexer$read_interp_string(l);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 34)) {
            _t1954 = Lexer$read_string(l);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((((_c === 39) && (Lexer$peek2(l) >= 97)) && ((Lexer$peek2(l) <= 122) && (Lexer$peek3(l) !== 39)))) {
            const loc_1956 = Lexer$current_loc(l);
            Lexer$advance(l);
            undefined;
            const buf_1958 = Buffer$create(8);
            let _t1960 = undefined;
            let _t1961 = false, _t1962;
            while (true) {
              if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
              Buffer$add_byte(buf_1958, Lexer$advance(l));
              if (_t1961) break;
            }
            _t1960 = _t1961 ? _t1962 : undefined;
            _t1960;
            const _t1959 = Lexer$make_token(l, ({_tag: 10, _name: "TYVAR", _val: Buffer$contents(buf_1958)}), loc_1956);
            const _t1957 = _t1959;
            _t1954 = _t1957;
            break _t1955;
          }
        }
        if (true) {
          if (Lexer$is_ident_start(c_1951)) {
            _t1954 = Lexer$read_ident_or_keyword(l);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 39)) {
            const loc_1963 = Lexer$current_loc(l);
            Lexer$advance(l);
            undefined;
            let _t1965;
            if (Lexer$at_end(l)) {
              _t1965 = Lexer$error(l, "unterminated rune literal");
            } else {
              _t1965 = undefined;
            }
            _t1965;
            let _t1966;
            if ((Lexer$peek(l) === 92)) {
              Lexer$advance(l);
              undefined;
              let _t1967;
              if (Lexer$at_end(l)) {
                _t1967 = Lexer$error(l, "unterminated rune escape");
              } else {
                _t1967 = undefined;
              }
              _t1967;
              const c_1968 = Lexer$advance(l);
              let _t1971;
              const _t1970 = c_1968;
              _t1972: {
                if (true) {
                  const _c = _t1970;
                  if ((_c === 110)) {
                    _t1971 = 10;
                    break _t1972;
                  }
                }
                if (true) {
                  const _c = _t1970;
                  if ((_c === 116)) {
                    _t1971 = 9;
                    break _t1972;
                  }
                }
                if (true) {
                  const _c = _t1970;
                  if ((_c === 92)) {
                    _t1971 = 92;
                    break _t1972;
                  }
                }
                if (true) {
                  const _c = _t1970;
                  if ((_c === 39)) {
                    _t1971 = 39;
                    break _t1972;
                  }
                }
                if (true) {
                  const _c = _t1970;
                  if ((_c === 48)) {
                    _t1971 = 0;
                    break _t1972;
                  }
                }
                if (true) {
                  _t1971 = Lexer$error(l, ("unknown rune escape: \\" + __dict_Show_byte.show(c_1968)));
                  break _t1972;
                }
                _match_fail("line 16629");
              }
              const _t1969 = _t1971;
              _t1966 = _t1969;
            } else {
              const b_1973 = Byte$to_int(Lexer$advance(l));
              let _t1975;
              if ((b_1973 < 128)) {
                _t1975 = b_1973;
              } else {
                let _t1976;
                if (((b_1973 & 224) === 192)) {
                  _t1976 = 2;
                } else {
                  let _t1977;
                  if (((b_1973 & 240) === 224)) {
                    _t1977 = 3;
                  } else {
                    let _t1978;
                    if (((b_1973 & 248) === 240)) {
                      _t1978 = 4;
                    } else {
                      _t1978 = Lexer$error(l, "invalid UTF-8 leading byte in rune literal");
                    }
                    _t1977 = _t1978;
                  }
                  _t1976 = _t1977;
                }
                const nbytes_1979 = _t1976;
                const cp_1981 = Ref$create((b_1973 & (255 >> (nbytes_1979 + 1))));
                let _loop_var_1983 = 2;
                let _t1985 = undefined;
                let _t1986 = false, _t1987;
                while (true) {
                  if (!((_loop_var_1983 <= nbytes_1979))) break;
                  let _t1988;
                  if (Lexer$at_end(l)) {
                    _t1988 = Lexer$error(l, "unterminated UTF-8 rune literal");
                  } else {
                    _t1988 = undefined;
                  }
                  _t1988;
                  const cont_1989 = Byte$to_int(Lexer$advance(l));
                  let _t1991;
                  if (((cont_1989 & 192) !== 128)) {
                    _t1991 = Lexer$error(l, "invalid UTF-8 continuation byte");
                  } else {
                    _t1991 = undefined;
                  }
                  _t1991;
                  Ref$set(cp_1981, ((Ref$get(cp_1981) << 6) | (cont_1989 & 63)));
                  const _t1990 = (_loop_var_1983 = (_loop_var_1983 + 1), undefined);
                  _t1990;
                  if (_t1986) break;
                }
                _t1985 = _t1986 ? _t1987 : undefined;
                _t1985;
                const _t1984 = Ref$get(cp_1981);
                const _t1982 = _t1984;
                const _t1980 = _t1982;
                _t1975 = _t1980;
              }
              const _t1974 = _t1975;
              _t1966 = _t1974;
            }
            const cp_1992 = _t1966;
            let _t1994;
            if ((Lexer$at_end(l) || (Lexer$peek(l) !== 39))) {
              _t1994 = Lexer$error(l, "unterminated rune literal");
            } else {
              _t1994 = undefined;
            }
            _t1994;
            Lexer$advance(l);
            undefined;
            const _t1993 = Lexer$make_token(l, ({_tag: 5, _name: "RUNE", _val: cp_1992}), loc_1963);
            const _t1964 = _t1993;
            _t1954 = _t1964;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 40)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 52, _name: "LPAREN"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 41)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 53, _name: "RPAREN"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 35)) {
            Lexer$advance(l);
            undefined;
            let _t1995;
            if (((!Lexer$at_end(l)) && (Lexer$is_hex_digit(Lexer$peek(l)) && (((l.cursor + 1) < l.len) && Lexer$is_hex_digit(Lexer$peek2(l)))))) {
              const c1_1996 = Lexer$peek(l);
              Lexer$advance(l);
              undefined;
              const c2_1998 = Lexer$advance(l);
              const v_2000 = ((Lexer$hex_val(c1_1996) * 16) + Lexer$hex_val(c2_1998));
              const _t2001 = Lexer$make_token(l, ({_tag: 4, _name: "BYTE", _val: v_2000}), loc_1949);
              const _t1999 = _t2001;
              const _t1997 = _t1999;
              _t1995 = _t1997;
            } else {
              _t1995 = Lexer$make_token(l, ({_tag: 41, _name: "HASH"}), loc_1949);
            }
            _t1954 = _t1995;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 123)) {
            let _t2002;
            if ((Lexer$peek2(l) === 124)) {
              _t2002 = Lexer$read_raw_string(l);
            } else {
              Lexer$advance(l);
              undefined;
              _t2002 = Lexer$make_token(l, ({_tag: 54, _name: "LBRACE"}), loc_1949);
            }
            _t1954 = _t2002;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 125)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 55, _name: "RBRACE"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 91)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 56, _name: "LBRACKET"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 93)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 57, _name: "RBRACKET"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 44)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 59, _name: "COMMA"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 46)) {
            Lexer$advance(l);
            undefined;
            let _t2003;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 46))) {
              Lexer$advance(l);
              undefined;
              _t2003 = Lexer$make_token(l, ({_tag: 64, _name: "DOTDOT"}), loc_1949);
            } else {
              _t2003 = Lexer$make_token(l, ({_tag: 63, _name: "DOT"}), loc_1949);
            }
            _t1954 = _t2003;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 94)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 72, _name: "CARET"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 64)) {
            Lexer$advance(l);
            undefined;
            const buf_2004 = Buffer$create(16);
            let _t2006 = undefined;
            let _t2007 = false, _t2008;
            while (true) {
              let _t2011;
              if ((!Lexer$at_end(l))) {
              const c_2009 = Lexer$peek(l);
              const _t2010 = (((c_2009 >= 97) && (c_2009 <= 122)) || (c_2009 === 95));
                _t2011 = _t2010;
              } else {
                _t2011 = false;
              }
              if (!(_t2011)) break;
              Buffer$add_byte(buf_2004, Lexer$advance(l));
              if (_t2007) break;
            }
            _t2006 = _t2007 ? _t2008 : undefined;
            _t2006;
            const name_2012 = Buffer$contents(buf_2004);
            let _t2014;
            if ((name_2012 === "partial")) {
              _t2014 = Lexer$make_token(l, ({_tag: 39, _name: "PARTIAL"}), loc_1949);
            } else {
              _t2014 = Lexer$error(l, ("unknown annotation @" + __dict_Show_string.show(name_2012)));
            }
            const _t2013 = _t2014;
            const _t2005 = _t2013;
            _t1954 = _t2005;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 43)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 68, _name: "PLUS"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 42)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 70, _name: "STAR"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 47)) {
            Lexer$advance(l);
            undefined;
            _t1954 = Lexer$make_token(l, ({_tag: 71, _name: "SLASH"}), loc_1949);
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 45)) {
            Lexer$advance(l);
            undefined;
            let _t2015;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 45))) {
              Lexer$advance(l);
              undefined;
              let _t2016 = undefined;
              let _t2017 = false, _t2018;
              while (true) {
                if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 10)))) break;
                Lexer$advance(l);
                undefined;
                if (_t2017) break;
              }
              _t2016 = _t2017 ? _t2018 : undefined;
              _t2016;
              const _t2019 = l;
              l = _t2019;
              continue;
              _t2015 = undefined;
            } else {
              let _t2020;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                Lexer$advance(l);
                undefined;
                _t2020 = Lexer$make_token(l, ({_tag: 58, _name: "ARROW"}), loc_1949);
              } else {
                _t2020 = Lexer$make_token(l, ({_tag: 69, _name: "MINUS"}), loc_1949);
              }
              _t2015 = _t2020;
            }
            _t1954 = _t2015;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 59)) {
            Lexer$advance(l);
            undefined;
            let _t2021;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 59))) {
              Lexer$advance(l);
              undefined;
              _t2021 = Lexer$make_token(l, ({_tag: 61, _name: "DOUBLE_SEMICOLON"}), loc_1949);
            } else {
              _t2021 = Lexer$make_token(l, ({_tag: 60, _name: "SEMICOLON"}), loc_1949);
            }
            _t1954 = _t2021;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 58)) {
            Lexer$advance(l);
            undefined;
            let _t2022;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 61))) {
              Lexer$advance(l);
              undefined;
              _t2022 = Lexer$make_token(l, ({_tag: 74, _name: "COLONEQUAL"}), loc_1949);
            } else {
              let _t2023;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 58))) {
                Lexer$advance(l);
                undefined;
                _t2023 = Lexer$make_token(l, ({_tag: 73, _name: "COLONCOLON"}), loc_1949);
              } else {
                let _t2024;
                if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                  Lexer$advance(l);
                  undefined;
                  _t2024 = Lexer$make_token(l, ({_tag: 90, _name: "COLONGT"}), loc_1949);
                } else {
                  _t2024 = Lexer$make_token(l, ({_tag: 62, _name: "COLON"}), loc_1949);
                }
                _t2023 = _t2024;
              }
              _t2022 = _t2023;
            }
            _t1954 = _t2022;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 61)) {
            Lexer$advance(l);
            undefined;
            let _t2025;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
              Lexer$advance(l);
              undefined;
              _t2025 = Lexer$make_token(l, ({_tag: 42, _name: "FATARROW"}), loc_1949);
            } else {
              _t2025 = Lexer$make_token(l, ({_tag: 75, _name: "EQ"}), loc_1949);
            }
            _t1954 = _t2025;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 60)) {
            Lexer$advance(l);
            undefined;
            let _t2026;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 61))) {
              Lexer$advance(l);
              undefined;
              _t2026 = Lexer$make_token(l, ({_tag: 79, _name: "LE"}), loc_1949);
            } else {
              let _t2027;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                Lexer$advance(l);
                undefined;
                _t2027 = Lexer$make_token(l, ({_tag: 76, _name: "NEQ"}), loc_1949);
              } else {
                _t2027 = Lexer$make_token(l, ({_tag: 77, _name: "LT"}), loc_1949);
              }
              _t2026 = _t2027;
            }
            _t1954 = _t2026;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 62)) {
            Lexer$advance(l);
            undefined;
            let _t2028;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 61))) {
              Lexer$advance(l);
              undefined;
              _t2028 = Lexer$make_token(l, ({_tag: 80, _name: "GE"}), loc_1949);
            } else {
              _t2028 = Lexer$make_token(l, ({_tag: 78, _name: "GT"}), loc_1949);
            }
            _t1954 = _t2028;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 38)) {
            Lexer$advance(l);
            undefined;
            let _t2029;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 38))) {
              Lexer$advance(l);
              undefined;
              _t2029 = Lexer$make_token(l, ({_tag: 81, _name: "AMPAMP"}), loc_1949);
            } else {
              _t2029 = Lexer$error(l, "unexpected '&', did you mean '&&'?");
            }
            _t1954 = _t2029;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 124)) {
            Lexer$advance(l);
            undefined;
            let _t2030;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 124))) {
              Lexer$advance(l);
              undefined;
              _t2030 = Lexer$make_token(l, ({_tag: 82, _name: "PIPEPIPE"}), loc_1949);
            } else {
              let _t2031;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                Lexer$advance(l);
                undefined;
                _t2031 = Lexer$make_token(l, ({_tag: 66, _name: "PIPEARROW"}), loc_1949);
              } else {
                _t2031 = Lexer$make_token(l, ({_tag: 65, _name: "PIPE"}), loc_1949);
              }
              _t2030 = _t2031;
            }
            _t1954 = _t2030;
            break _t1955;
          }
        }
        if (true) {
          const _c = _t1953;
          if ((_c === 96)) {
            Lexer$advance(l);
            undefined;
            let _t2032;
            if (((!Lexer$at_end(l)) && ((Lexer$peek(l) >= 65) && (Lexer$peek(l) <= 90)))) {
              const buf_2033 = Buffer$create(16);
              let _t2035 = undefined;
              let _t2036 = false, _t2037;
              while (true) {
                if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
                Buffer$add_byte(buf_2033, Lexer$advance(l));
                if (_t2036) break;
              }
              _t2035 = _t2036 ? _t2037 : undefined;
              _t2035;
              const _t2034 = Lexer$make_token(l, ({_tag: 89, _name: "POLYTAG", _val: Buffer$contents(buf_2033)}), loc_1949);
              _t2032 = _t2034;
            } else {
              _t2032 = Lexer$error(l, "expected uppercase identifier after backtick");
            }
            _t1954 = _t2032;
            break _t1955;
          }
        }
        if (true) {
          _t1954 = Lexer$error(l, ("unexpected character: " + __dict_Show_byte.show(c_1951)));
          break _t1955;
        }
        _match_fail("line 16629");
      }
      const _t1952 = _t1954;
      const _t1950 = _t1952;
      _t1948 = _t1950;
    }
    return _t1948;
  }
}
function Lexer$tokenize(source) {
  const l_2038 = Lexer$create(source);
  const tokens_2040 = Ref$create(null);
  const stop_2042 = Ref$create(false);
  let _t2044 = undefined;
  let _t2045 = false, _t2046;
  while (true) {
    if (!((!Ref$get(stop_2042)))) break;
    const tok_2047 = Lexer$next_token(l_2038);
    Ref$set(tokens_2040, ({_hd: tok_2047, _tl: Ref$get(tokens_2040)}));
    let _t2049;
    if (_eq(tok_2047.kind, ({_tag: 91, _name: "EOF"}))) {
      _t2049 = Ref$set(stop_2042, true);
    } else {
      _t2049 = undefined;
    }
    const _t2048 = _t2049;
    _t2048;
    if (_t2045) break;
  }
  _t2044 = _t2045 ? _t2046 : undefined;
  _t2044;
  const _t2043 = List$rev(Ref$get(tokens_2040));
  const _t2041 = _t2043;
  const _t2039 = _t2041;
  return _t2039;
}
function Parser$create(tokens) {
  return ({pos: 0, tokens: Array$of_list(tokens)});
}
function Parser$peek(p) {
  return Array$get(p.tokens, p.pos);
}
function Parser$peek_kind(p) {
  return Parser$peek(p).kind;
}
function Parser$peek_kind_at(p, offset) {
  const idx_2050 = (p.pos + offset);
  let _t2052;
  if ((idx_2050 < Array$length(p.tokens))) {
    _t2052 = Array$get(p.tokens, idx_2050).kind;
  } else {
    _t2052 = ({_tag: 91, _name: "EOF"});
  }
  const _t2051 = _t2052;
  return _t2051;
}
function Parser$advance(p) {
  const tok_2053 = Array$get(p.tokens, p.pos);
  let _t2055;
  if (!_eq(tok_2053.kind, ({_tag: 91, _name: "EOF"}))) {
    _t2055 = (p.pos = (p.pos + 1), undefined);
  } else {
    _t2055 = undefined;
  }
  _t2055;
  const _t2054 = tok_2053;
  return _t2054;
}
function Parser$error(p, msg) {
  return _trampoline(function() {
    const tok_2056 = _resolve(Parser$peek(p));
    return _h["parse_error"]([msg, tok_2056.loc], function(_t2057) {
      return _bounce(function() {
        return _t2057;
      });
    });
  }, Parser$error);
}
function Parser$expect(p, kind) {
  const tok_2058 = Parser$peek(p);
  let _t2060;
  if (_eq(tok_2058.kind, kind)) {
    Parser$advance(p);
    _t2060 = undefined;
  } else {
    _t2060 = Parser$error(p, ((("expected " + __dict_Show_string.show(Token$pp_token_kind(kind))) + ", got ") + __dict_Show_string.show(Token$pp_token_kind(tok_2058.kind))));
  }
  const _t2059 = _t2060;
  return _t2059;
}
function Parser$expect_ident(p) {
  let _t2062;
  const _t2061 = Parser$peek(p).kind;
  _t2063: {
    if (_t2061._tag === 8) {
      const s = _t2061._val;
      Parser$advance(p);
      undefined;
      _t2062 = s;
      break _t2063;
    }
    if (_t2061._tag === 67) {
      Parser$advance(p);
      undefined;
      _t2062 = "_";
      break _t2063;
    }
    if (true) {
      _t2062 = Parser$error(p, "expected identifier");
      break _t2063;
    }
    _match_fail("line 16629");
  }
  return _t2062;
}
function Parser$expect_uident(p) {
  let _t2065;
  const _t2064 = Parser$peek(p).kind;
  _t2066: {
    if (_t2064._tag === 9) {
      const s = _t2064._val;
      Parser$advance(p);
      undefined;
      _t2065 = s;
      break _t2066;
    }
    if (true) {
      _t2065 = Parser$error(p, "expected constructor name");
      break _t2066;
    }
    _match_fail("line 16629");
  }
  return _t2065;
}
function Parser$keyword_as_ident(__x) {
  let _t2068;
  const _t2067 = __x;
  _t2069: {
    if (_t2067._tag === 43) {
      _t2068 = ({_tag: 1, _name: "Some", _val: "mod"});
      break _t2069;
    }
    if (_t2067._tag === 40) {
      _t2068 = ({_tag: 1, _name: "Some", _val: "not"});
      break _t2069;
    }
    if (_t2067._tag === 83) {
      _t2068 = ({_tag: 1, _name: "Some", _val: "land"});
      break _t2069;
    }
    if (_t2067._tag === 84) {
      _t2068 = ({_tag: 1, _name: "Some", _val: "lor"});
      break _t2069;
    }
    if (_t2067._tag === 85) {
      _t2068 = ({_tag: 1, _name: "Some", _val: "lxor"});
      break _t2069;
    }
    if (_t2067._tag === 86) {
      _t2068 = ({_tag: 1, _name: "Some", _val: "lnot"});
      break _t2069;
    }
    if (_t2067._tag === 87) {
      _t2068 = ({_tag: 1, _name: "Some", _val: "lsl"});
      break _t2069;
    }
    if (_t2067._tag === 88) {
      _t2068 = ({_tag: 1, _name: "Some", _val: "lsr"});
      break _t2069;
    }
    if (true) {
      _t2068 = ({_tag: 0, _name: "None"});
      break _t2069;
    }
    _match_fail("line 16629");
  }
  return _t2068;
}
function Parser$token_to_op_name(__x) {
  let _t2071;
  const _t2070 = __x;
  _t2072: {
    if (_t2070._tag === 68) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "+"});
      break _t2072;
    }
    if (_t2070._tag === 69) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "-"});
      break _t2072;
    }
    if (_t2070._tag === 70) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "*"});
      break _t2072;
    }
    if (_t2070._tag === 71) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "/"});
      break _t2072;
    }
    if (_t2070._tag === 43) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "mod"});
      break _t2072;
    }
    if (_t2070._tag === 72) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "^"});
      break _t2072;
    }
    if (_t2070._tag === 81) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "&&"});
      break _t2072;
    }
    if (_t2070._tag === 82) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "||"});
      break _t2072;
    }
    if (_t2070._tag === 40) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "not"});
      break _t2072;
    }
    if (_t2070._tag === 77) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "<"});
      break _t2072;
    }
    if (_t2070._tag === 78) {
      _t2071 = ({_tag: 1, _name: "Some", _val: ">"});
      break _t2072;
    }
    if (_t2070._tag === 79) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "<="});
      break _t2072;
    }
    if (_t2070._tag === 80) {
      _t2071 = ({_tag: 1, _name: "Some", _val: ">="});
      break _t2072;
    }
    if (_t2070._tag === 75) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "="});
      break _t2072;
    }
    if (_t2070._tag === 76) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "<>"});
      break _t2072;
    }
    if (_t2070._tag === 83) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "land"});
      break _t2072;
    }
    if (_t2070._tag === 84) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "lor"});
      break _t2072;
    }
    if (_t2070._tag === 85) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "lxor"});
      break _t2072;
    }
    if (_t2070._tag === 86) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "lnot"});
      break _t2072;
    }
    if (_t2070._tag === 87) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "lsl"});
      break _t2072;
    }
    if (_t2070._tag === 88) {
      _t2071 = ({_tag: 1, _name: "Some", _val: "lsr"});
      break _t2072;
    }
    if (true) {
      _t2071 = ({_tag: 0, _name: "None"});
      break _t2072;
    }
    _match_fail("line 16629");
  }
  return _t2071;
}
function Parser$read_qualified_path(p, first_uident) {
  const path_2073 = Ref$create(({_hd: first_uident, _tl: null}));
  const result_2075 = Ref$create(({_tag: 0, _name: "None"}));
  const continue__2077 = Ref$create(true);
  let _t2079 = undefined;
  let _t2080 = false, _t2081;
  while (true) {
    if (!(Ref$get(continue__2077))) break;
    let _t2082;
    if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
      const next_2083 = Parser$peek_kind_at(p, 1);
      let _t2086;
      const _t2085 = next_2083;
      _t2087: {
        if (_t2085._tag === 8) {
          const s = _t2085._val;
          Parser$advance(p);
          undefined;
          Parser$advance(p);
          undefined;
          const qualified_2088 = (String$concat(".", List$rev(Ref$get(path_2073))) + ("." + s));
          Ref$set(result_2075, ({_tag: 1, _name: "Some", _val: ({_tag: 958595272, _name: "`Var", _val: qualified_2088})}));
          const _t2089 = Ref$set(continue__2077, false);
          _t2086 = _t2089;
          break _t2087;
        }
        if (_t2085._tag === 9) {
          const s = _t2085._val;
          Parser$advance(p);
          undefined;
          Parser$advance(p);
          undefined;
          _t2086 = Ref$set(path_2073, ({_hd: s, _tl: Ref$get(path_2073)}));
          break _t2087;
        }
        if (_t2085._tag === 52) {
          let _t2091;
          const _t2090 = Parser$token_to_op_name(Parser$peek_kind_at(p, 2));
          _t2092: {
            if (_t2090._tag === 1) {
              const op = _t2090._val;
              if (_eq(Parser$peek_kind_at(p, 3), ({_tag: 53, _name: "RPAREN"}))) {
                Parser$advance(p);
                undefined;
                Parser$advance(p);
                undefined;
                Parser$advance(p);
                undefined;
                Parser$advance(p);
                undefined;
                const qualified_2093 = (String$concat(".", List$rev(Ref$get(path_2073))) + ("." + op));
                Ref$set(result_2075, ({_tag: 1, _name: "Some", _val: ({_tag: 958595272, _name: "`Var", _val: qualified_2093})}));
                const _t2094 = Ref$set(continue__2077, false);
                _t2091 = _t2094;
                break _t2092;
              }
            }
            if (true) {
              Parser$advance(p);
              undefined;
              const mod_path_2095 = String$concat(".", List$rev(Ref$get(path_2073)));
              Ref$set(result_2075, ({_tag: 1, _name: "Some", _val: ({_tag: 982234060, _name: "`LocalOpen", _val: mod_path_2095})}));
              const _t2096 = Ref$set(continue__2077, false);
              _t2091 = _t2096;
              break _t2092;
            }
            _match_fail("line 16629");
          }
          _t2086 = _t2091;
          break _t2087;
        }
        if (true) {
          const kw = _t2085;
          let _t2098;
          const _t2097 = Parser$keyword_as_ident(kw);
          _t2099: {
            if (_t2097._tag === 1) {
              const s = _t2097._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              const qualified_2100 = (String$concat(".", List$rev(Ref$get(path_2073))) + ("." + s));
              Ref$set(result_2075, ({_tag: 1, _name: "Some", _val: ({_tag: 958595272, _name: "`Var", _val: qualified_2100})}));
              const _t2101 = Ref$set(continue__2077, false);
              _t2098 = _t2101;
              break _t2099;
            }
            if (_t2097._tag === 0) {
              _t2098 = Ref$set(continue__2077, false);
              break _t2099;
            }
            _match_fail("line 16629");
          }
          _t2086 = _t2098;
          break _t2087;
        }
        _match_fail("line 16629");
      }
      const _t2084 = _t2086;
      _t2082 = _t2084;
    } else {
      _t2082 = Ref$set(continue__2077, false);
    }
    _t2082;
    if (_t2080) break;
  }
  _t2079 = _t2080 ? _t2081 : undefined;
  _t2079;
  let _t2103;
  const _t2102 = Ref$get(result_2075);
  _t2104: {
    if (_t2102._tag === 1) {
      const r = _t2102._val;
      _t2103 = r;
      break _t2104;
    }
    if (_t2102._tag === 0) {
      let _t2106;
      const _t2105 = Ref$get(path_2073);
      _t2107: {
        if (_t2105 !== null && _t2105._tl === null) {
          const single = _t2105._hd;
          _t2106 = ({_tag: 1067578635, _name: "`Constructor", _val: single});
          break _t2107;
        }
        if (true) {
          const rev_2108 = List$rev(Ref$get(path_2073));
          const last_2110 = List$hd(List$rev(rev_2108));
          const prefix_2112 = List$rev(List$tl(List$rev(rev_2108)));
          const qualified_2114 = (String$concat(".", prefix_2112) + ("." + last_2110));
          const _t2115 = ({_tag: 1067578635, _name: "`Constructor", _val: qualified_2114});
          const _t2113 = _t2115;
          const _t2111 = _t2113;
          const _t2109 = _t2111;
          _t2106 = _t2109;
          break _t2107;
        }
        _match_fail("line 16629");
      }
      _t2103 = _t2106;
      break _t2104;
    }
    _match_fail("line 16629");
  }
  const _t2078 = _t2103;
  const _t2076 = _t2078;
  const _t2074 = _t2076;
  return _t2074;
}
function Parser$at_expr_start(p) {
  let _t2117;
  const _t2116 = Parser$peek_kind(p);
  _t2118: {
    if ((((((((((((((((((((((((((((((((_t2116._tag === 0 || _t2116._tag === 1) || _t2116._tag === 2) || _t2116._tag === 3) || _t2116._tag === 4) || _t2116._tag === 5) || _t2116._tag === 6) || _t2116._tag === 7) || _t2116._tag === 8) || _t2116._tag === 9) || _t2116._tag === 52) || _t2116._tag === 54) || _t2116._tag === 56) || _t2116._tag === 16) || _t2116._tag === 14) || _t2116._tag === 11) || _t2116._tag === 17) || _t2116._tag === 69) || _t2116._tag === 40) || _t2116._tag === 86) || _t2116._tag === 26) || _t2116._tag === 27) || _t2116._tag === 28) || _t2116._tag === 29) || _t2116._tag === 31) || _t2116._tag === 34) || _t2116._tag === 36) || _t2116._tag === 30) || _t2116._tag === 32) || _t2116._tag === 41) || _t2116._tag === 35) || _t2116._tag === 89)) {
      _t2117 = true;
      break _t2118;
    }
    if (true) {
      _t2117 = false;
      break _t2118;
    }
    _match_fail("line 16629");
  }
  return _t2117;
}
function Parser$parse_ty_atom(p) {
  let _t2120;
  const _t2119 = Parser$peek_kind(p);
  _t2121: {
    if (_t2119._tag === 8 && _t2119._val === "int") {
      Parser$advance(p);
      undefined;
      _t2120 = ({_tag: 0, _name: "TyName", _val: "int"});
      break _t2121;
    }
    if (_t2119._tag === 8 && _t2119._val === "bool") {
      Parser$advance(p);
      undefined;
      _t2120 = ({_tag: 0, _name: "TyName", _val: "bool"});
      break _t2121;
    }
    if (_t2119._tag === 8 && _t2119._val === "string") {
      Parser$advance(p);
      undefined;
      _t2120 = ({_tag: 0, _name: "TyName", _val: "string"});
      break _t2121;
    }
    if (_t2119._tag === 8 && _t2119._val === "unit") {
      Parser$advance(p);
      undefined;
      _t2120 = ({_tag: 0, _name: "TyName", _val: "unit"});
      break _t2121;
    }
    if (_t2119._tag === 8) {
      const s = _t2119._val;
      Parser$advance(p);
      undefined;
      _t2120 = ({_tag: 0, _name: "TyName", _val: s});
      break _t2121;
    }
    if (_t2119._tag === 9) {
      const s = _t2119._val;
      Parser$advance(p);
      undefined;
      const mod_parts_2122 = Ref$create(({_hd: s, _tl: null}));
      const final_name_2124 = Ref$create(({_tag: 0, _name: "None"}));
      const continue_reading_2126 = Ref$create(true);
      let _t2128 = undefined;
      let _t2129 = false, _t2130;
      while (true) {
        if (!(Ref$get(continue_reading_2126))) break;
        let _t2131;
        if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
          let _t2133;
          const _t2132 = Parser$peek_kind_at(p, 1);
          _t2134: {
            if (_t2132._tag === 9) {
              const s2 = _t2132._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2133 = Ref$set(mod_parts_2122, ({_hd: s2, _tl: Ref$get(mod_parts_2122)}));
              break _t2134;
            }
            if (_t2132._tag === 8) {
              const s2 = _t2132._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              Ref$set(final_name_2124, ({_tag: 1, _name: "Some", _val: s2}));
              _t2133 = Ref$set(continue_reading_2126, false);
              break _t2134;
            }
            if (true) {
              _t2133 = Ref$set(continue_reading_2126, false);
              break _t2134;
            }
            _match_fail("line 16629");
          }
          _t2131 = _t2133;
        } else {
          _t2131 = Ref$set(continue_reading_2126, false);
        }
        _t2131;
        if (_t2129) break;
      }
      _t2128 = _t2129 ? _t2130 : undefined;
      _t2128;
      let _t2136;
      const _t2135 = Ref$get(final_name_2124);
      _t2137: {
        if (_t2135._tag === 1) {
          const name = _t2135._val;
          _t2136 = ({_tag: 8, _name: "TyQualified", _val: [List$rev(Ref$get(mod_parts_2122)), name]});
          break _t2137;
        }
        if (_t2135._tag === 0) {
          _t2136 = ({_tag: 0, _name: "TyName", _val: s});
          break _t2137;
        }
        _match_fail("line 16629");
      }
      const _t2127 = _t2136;
      const _t2125 = _t2127;
      const _t2123 = _t2125;
      _t2120 = _t2123;
      break _t2121;
    }
    if (_t2119._tag === 10) {
      const s = _t2119._val;
      Parser$advance(p);
      undefined;
      _t2120 = ({_tag: 1, _name: "TyVar", _val: s});
      break _t2121;
    }
    if (_t2119._tag === 52) {
      Parser$advance(p);
      undefined;
      const ty_2138 = Parser$parse_ty(p);
      let _t2140;
      if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
        const parts_2141 = Ref$create(({_hd: ty_2138, _tl: null}));
        let _t2143 = undefined;
        let _t2144 = false, _t2145;
        while (true) {
          if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"})))) break;
          Parser$advance(p);
          undefined;
          Ref$set(parts_2141, ({_hd: Parser$parse_ty(p), _tl: Ref$get(parts_2141)}));
          if (_t2144) break;
        }
        _t2143 = _t2144 ? _t2145 : undefined;
        _t2143;
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        const _t2142 = ({_tag: 6, _name: "TyTuple", _val: List$rev(Ref$get(parts_2141))});
        _t2140 = _t2142;
      } else {
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        _t2140 = ty_2138;
      }
      const _t2139 = _t2140;
      _t2120 = _t2139;
      break _t2121;
    }
    if (_t2119._tag === 54) {
      Parser$advance(p);
      undefined;
      let _t2147;
      const _t2146 = Parser$parse_ty_record_fields(p);
      _t2148: {
        if (true) {
          const fields = _t2146[0];
          const is_open = _t2146[1];
          Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
          function _t2149(__p53) {
            let _t2151;
            const _t2150 = __p53;
            _t2152: {
              if (true) {
                const n = _t2150[1];
                const t = _t2150[2];
                _t2151 = [n, t];
                break _t2152;
              }
              _match_fail("line 16629");
            }
            return _t2151;
          }
          _t2147 = ({_tag: 3, _name: "TyRecord", _val: [List$map(_t2149, fields), is_open]});
          break _t2148;
        }
        _match_fail("line 16629");
      }
      _t2120 = _t2147;
      break _t2121;
    }
    if (_t2119._tag === 56) {
      Parser$advance(p);
      undefined;
      let _t2154;
      const _t2153 = Parser$peek_kind(p);
      _t2155: {
        if (_t2153._tag === 78) {
          Parser$advance(p);
          undefined;
          _t2154 = ({_tag: 1, _name: "PVLower"});
          break _t2155;
        }
        if (_t2153._tag === 77) {
          Parser$advance(p);
          undefined;
          _t2154 = ({_tag: 2, _name: "PVUpper"});
          break _t2155;
        }
        if (true) {
          _t2154 = ({_tag: 0, _name: "PVExact"});
          break _t2155;
        }
        _match_fail("line 16629");
      }
      const kind_2156 = _t2154;
      let _t2158;
      if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
        Parser$advance(p);
        _t2158 = undefined;
      } else {
        _t2158 = undefined;
      }
      _t2158;
      const tags_2159 = Ref$create(null);
      let _t2161 = undefined;
      let _t2162 = false, _t2163;
      while (true) {
        let _t2165;
        const _t2164 = Parser$peek_kind(p);
        _t2166: {
          if (_t2164._tag === 89) {
            _t2165 = true;
            break _t2166;
          }
          if (true) {
            _t2165 = false;
            break _t2166;
          }
          _match_fail("line 16629");
        }
        if (!(_t2165)) break;
        let _t2168;
        const _t2167 = Parser$advance(p).kind;
        _t2169: {
          if (_t2167._tag === 89) {
            const s = _t2167._val;
            _t2168 = s;
            break _t2169;
          }
          if (true) {
            _t2168 = failwith("assert false");
            break _t2169;
          }
          _match_fail("line 16629");
        }
        const tag_2170 = _t2168;
        let _t2172;
        if (_eq(Parser$peek_kind(p), ({_tag: 21, _name: "OF"}))) {
          Parser$advance(p);
          undefined;
          _t2172 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
        } else {
          _t2172 = ({_tag: 0, _name: "None"});
        }
        const payload_2173 = _t2172;
        Ref$set(tags_2159, ({_hd: [tag_2170, payload_2173], _tl: Ref$get(tags_2159)}));
        let _t2175;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t2175 = undefined;
        } else {
          _t2175 = undefined;
        }
        const _t2174 = _t2175;
        const _t2171 = _t2174;
        _t2171;
        if (_t2162) break;
      }
      _t2161 = _t2162 ? _t2163 : undefined;
      _t2161;
      Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
      const _t2160 = ({_tag: 9, _name: "TyPolyVariant", _val: [kind_2156, List$rev(Ref$get(tags_2159))]});
      const _t2157 = _t2160;
      _t2120 = _t2157;
      break _t2121;
    }
    if (true) {
      _t2120 = Parser$error(p, "expected type");
      break _t2121;
    }
    _match_fail("line 16629");
  }
  return _t2120;
}
function Parser$parse_ty_postfix(p) {
  const ty_2176 = Parser$parse_ty_atom(p);
  function loop(ty) {
    while (true) {
      let _t2179;
      const _t2178 = Parser$peek_kind(p);
      _t2180: {
        if (_t2178._tag === 8 && _t2178._val === "list") {
          Parser$advance(p);
          undefined;
          const _t2181 = ({_tag: 4, _name: "TyList", _val: ty});
          ty = _t2181;
          continue;
          _t2179 = undefined;
          break _t2180;
        }
        if (_t2178._tag === 8 && _t2178._val === "array") {
          Parser$advance(p);
          undefined;
          const _t2182 = ({_tag: 5, _name: "TyArray", _val: ty});
          ty = _t2182;
          continue;
          _t2179 = undefined;
          break _t2180;
        }
        if (_t2178._tag === 8) {
          const name = _t2178._val;
          if (!_eq(Parser$peek_kind_at(p, 1), ({_tag: 62, _name: "COLON"}))) {
            Parser$advance(p);
            undefined;
            let _t2184;
            const _t2183 = ty;
            _t2185: {
              if (_t2183._tag === 6) {
                const parts = _t2183._val;
                _t2184 = parts;
                break _t2185;
              }
              if (true) {
                _t2184 = ({_hd: ty, _tl: null});
                break _t2185;
              }
              _match_fail("line 16629");
            }
            const args_2186 = _t2184;
            const _t2188 = ({_tag: 7, _name: "TyApp", _val: [args_2186, name]});
            ty = _t2188;
            continue;
            const _t2187 = undefined;
            _t2179 = _t2187;
            break _t2180;
          }
        }
        if (_t2178._tag === 9) {
          if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 63, _name: "DOT"}))) {
            const mod_parts_2189 = Ref$create(null);
            let _t2192;
            const _t2191 = Parser$advance(p).kind;
            _t2193: {
              if (_t2191._tag === 9) {
                const s = _t2191._val;
                _t2192 = s;
                break _t2193;
              }
              if (true) {
                _t2192 = failwith("assert false");
                break _t2193;
              }
              _match_fail("line 16629");
            }
            const first_mod_2194 = _t2192;
            Ref$set(mod_parts_2189, ({_hd: first_mod_2194, _tl: null}));
            const final_name_2196 = Ref$create("");
            const continue_reading_2198 = Ref$create(true);
            let _t2200 = undefined;
            let _t2201 = false, _t2202;
            while (true) {
              if (!(Ref$get(continue_reading_2198))) break;
              let _t2203;
              if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
                let _t2205;
                const _t2204 = Parser$peek_kind_at(p, 1);
                _t2206: {
                  if (_t2204._tag === 9) {
                    const s2 = _t2204._val;
                    Parser$advance(p);
                    undefined;
                    Parser$advance(p);
                    undefined;
                    _t2205 = Ref$set(mod_parts_2189, ({_hd: s2, _tl: Ref$get(mod_parts_2189)}));
                    break _t2206;
                  }
                  if (_t2204._tag === 8) {
                    const s2 = _t2204._val;
                    Parser$advance(p);
                    undefined;
                    Parser$advance(p);
                    undefined;
                    Ref$set(final_name_2196, s2);
                    _t2205 = Ref$set(continue_reading_2198, false);
                    break _t2206;
                  }
                  if (true) {
                    _t2205 = Ref$set(continue_reading_2198, false);
                    break _t2206;
                  }
                  _match_fail("line 16629");
                }
                _t2203 = _t2205;
              } else {
                _t2203 = Ref$set(continue_reading_2198, false);
              }
              _t2203;
              if (_t2201) break;
            }
            _t2200 = _t2201 ? _t2202 : undefined;
            _t2200;
            let _t2207;
            if ((Ref$get(final_name_2196) === "")) {
              _t2207 = Parser$error(p, "expected Module.typename in type annotation");
            } else {
              const qualified_2208 = (String$concat(".", List$rev(Ref$get(mod_parts_2189))) + ("." + Ref$get(final_name_2196)));
              let _t2211;
              const _t2210 = ty;
              _t2212: {
                if (_t2210._tag === 6) {
                  const parts = _t2210._val;
                  _t2211 = parts;
                  break _t2212;
                }
                if (true) {
                  _t2211 = ({_hd: ty, _tl: null});
                  break _t2212;
                }
                _match_fail("line 16629");
              }
              const args_2213 = _t2211;
              const _t2215 = ({_tag: 7, _name: "TyApp", _val: [args_2213, qualified_2208]});
              ty = _t2215;
              continue;
              const _t2214 = undefined;
              const _t2209 = _t2214;
              _t2207 = _t2209;
            }
            const _t2199 = _t2207;
            const _t2197 = _t2199;
            const _t2195 = _t2197;
            const _t2190 = _t2195;
            _t2179 = _t2190;
            break _t2180;
          }
        }
        if (true) {
          _t2179 = ty;
          break _t2180;
        }
        _match_fail("line 16629");
      }
      return _t2179;
    }
  }
  const _t2216 = loop(ty_2176);
  const _t2177 = _t2216;
  return _t2177;
}
function Parser$parse_ty_tuple(p) {
  const first_2217 = Parser$parse_ty_postfix(p);
  let _t2220;
  const _t2219 = Parser$peek_kind(p);
  _t2221: {
    if (_t2219._tag === 70) {
      const parts_2222 = Ref$create(({_hd: first_2217, _tl: null}));
      let _t2224 = undefined;
      let _t2225 = false, _t2226;
      while (true) {
        if (!(_eq(Parser$peek_kind(p), ({_tag: 70, _name: "STAR"})))) break;
        Parser$advance(p);
        undefined;
        Ref$set(parts_2222, ({_hd: Parser$parse_ty_postfix(p), _tl: Ref$get(parts_2222)}));
        if (_t2225) break;
      }
      _t2224 = _t2225 ? _t2226 : undefined;
      _t2224;
      const _t2223 = ({_tag: 6, _name: "TyTuple", _val: List$rev(Ref$get(parts_2222))});
      _t2220 = _t2223;
      break _t2221;
    }
    if (true) {
      _t2220 = first_2217;
      break _t2221;
    }
    _match_fail("line 16629");
  }
  const _t2218 = _t2220;
  return _t2218;
}
function Parser$parse_ty(p) {
  const left_2227 = Parser$parse_ty_tuple(p);
  let _t2230;
  const _t2229 = Parser$peek_kind(p);
  _t2231: {
    if (_t2229._tag === 58) {
      Parser$advance(p);
      undefined;
      const right_2232 = Parser$parse_ty(p);
      let _t2234;
      if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
        Parser$advance(p);
        undefined;
        let _t2235;
        if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
          Parser$advance(p);
          undefined;
          _t2235 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "EffAnnotPure"})});
        } else {
          _t2235 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)})});
        }
        _t2234 = _t2235;
      } else {
        _t2234 = ({_tag: 0, _name: "None"});
      }
      const eff_2236 = _t2234;
      const _t2237 = ({_tag: 2, _name: "TyArrow", _val: [left_2227, right_2232, eff_2236]});
      const _t2233 = _t2237;
      _t2230 = _t2233;
      break _t2231;
    }
    if (true) {
      _t2230 = left_2227;
      break _t2231;
    }
    _match_fail("line 16629");
  }
  const _t2228 = _t2230;
  return _t2228;
}
function Parser$is_eff_param_start(__x) {
  let _t2239;
  const _t2238 = __x;
  _t2240: {
    if ((((_t2238._tag === 8 || _t2238._tag === 10) || _t2238._tag === 52) || _t2238._tag === 54)) {
      _t2239 = true;
      break _t2240;
    }
    if (true) {
      _t2239 = false;
      break _t2240;
    }
    _match_fail("line 16629");
  }
  return _t2239;
}
function Parser$parse_eff_type_params(p) {
  const params_2241 = Ref$create(null);
  let _t2243 = undefined;
  let _t2244 = false, _t2245;
  while (true) {
    if (!(Parser$is_eff_param_start(Parser$peek_kind(p)))) break;
    Ref$set(params_2241, ({_hd: Parser$parse_ty_atom(p), _tl: Ref$get(params_2241)}));
    if (_t2244) break;
  }
  _t2243 = _t2244 ? _t2245 : undefined;
  _t2243;
  const _t2242 = List$rev(Ref$get(params_2241));
  return _t2242;
}
function Parser$parse_eff_items(p) {
  const items_2246 = Ref$create(null);
  const continue_parsing_2248 = Ref$create(true);
  let _t2250 = undefined;
  let _t2251 = false, _t2252;
  while (true) {
    if (!(Ref$get(continue_parsing_2248))) break;
    let _t2254;
    const _t2253 = Parser$peek_kind(p);
    _t2255: {
      if (_t2253._tag === 9) {
        const name_2256 = Parser$expect_uident(p);
        const params_2258 = Parser$parse_eff_type_params(p);
        Ref$set(items_2246, ({_hd: ({_tag: 0, _name: "EffLabel", _val: [name_2256, params_2258]}), _tl: Ref$get(items_2246)}));
        let _t2260;
        if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
          Parser$advance(p);
          _t2260 = undefined;
        } else {
          _t2260 = Ref$set(continue_parsing_2248, false);
        }
        const _t2259 = _t2260;
        const _t2257 = _t2259;
        _t2254 = _t2257;
        break _t2255;
      }
      if (_t2253._tag === 10) {
        const s = _t2253._val;
        Parser$advance(p);
        undefined;
        Ref$set(items_2246, ({_hd: ({_tag: 1, _name: "EffVar", _val: s}), _tl: Ref$get(items_2246)}));
        let _t2261;
        if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
          Parser$advance(p);
          _t2261 = undefined;
        } else {
          _t2261 = Ref$set(continue_parsing_2248, false);
        }
        _t2254 = _t2261;
        break _t2255;
      }
      if (true) {
        _t2254 = Ref$set(continue_parsing_2248, false);
        break _t2255;
      }
      _match_fail("line 16629");
    }
    _t2254;
    if (_t2251) break;
  }
  _t2250 = _t2251 ? _t2252 : undefined;
  _t2250;
  const _t2249 = List$rev(Ref$get(items_2246));
  const _t2247 = _t2249;
  return _t2247;
}
function Parser$parse_ty_record_fields(p) {
  const fields_2262 = Ref$create(null);
  const is_open_2264 = Ref$create(false);
  const first_2266 = Ref$create(true);
  let _t2268 = undefined;
  let _t2269 = false, _t2270;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
    let _t2271;
    if ((!Ref$get(first_2266))) {
      _t2271 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
    } else {
      _t2271 = undefined;
    }
    _t2271;
    let _t2272;
    if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
      _t2272 = undefined;
    } else {
      let _t2273;
      if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "DOTDOT"}))) {
        Parser$advance(p);
        undefined;
        _t2273 = Ref$set(is_open_2264, true);
      } else {
        Ref$set(first_2266, false);
        const is_mut_2274 = _eq(Parser$peek_kind(p), ({_tag: 33, _name: "MUT"}));
        let _t2276;
        if (is_mut_2274) {
          Parser$advance(p);
          _t2276 = undefined;
        } else {
          _t2276 = undefined;
        }
        _t2276;
        const name_2277 = Parser$expect_ident(p);
        Parser$expect(p, ({_tag: 62, _name: "COLON"}));
        const ty_2279 = Parser$parse_ty(p);
        const _t2280 = Ref$set(fields_2262, ({_hd: [is_mut_2274, name_2277, ty_2279], _tl: Ref$get(fields_2262)}));
        const _t2278 = _t2280;
        const _t2275 = _t2278;
        _t2273 = _t2275;
      }
      _t2272 = _t2273;
    }
    _t2272;
    if (_t2269) break;
  }
  _t2268 = _t2269 ? _t2270 : undefined;
  _t2268;
  const _t2267 = [List$rev(Ref$get(fields_2262)), Ref$get(is_open_2264)];
  const _t2265 = _t2267;
  const _t2263 = _t2265;
  return _t2263;
}
function Parser$parse_pattern_atom(p) {
  let _t2282;
  const _t2281 = Parser$peek_kind(p);
  _t2283: {
    if (_t2281._tag === 67) {
      Parser$advance(p);
      undefined;
      _t2282 = ({_tag: 0, _name: "PatWild"});
      break _t2283;
    }
    if (_t2281._tag === 0) {
      const n = _t2281._val;
      Parser$advance(p);
      undefined;
      _t2282 = ({_tag: 2, _name: "PatInt", _val: n});
      break _t2283;
    }
    if (_t2281._tag === 1) {
      const f = _t2281._val;
      Parser$advance(p);
      undefined;
      _t2282 = ({_tag: 3, _name: "PatFloat", _val: f});
      break _t2283;
    }
    if (_t2281._tag === 6) {
      Parser$advance(p);
      undefined;
      _t2282 = ({_tag: 4, _name: "PatBool", _val: true});
      break _t2283;
    }
    if (_t2281._tag === 7) {
      Parser$advance(p);
      undefined;
      _t2282 = ({_tag: 4, _name: "PatBool", _val: false});
      break _t2283;
    }
    if (_t2281._tag === 2) {
      const s = _t2281._val;
      Parser$advance(p);
      undefined;
      _t2282 = ({_tag: 5, _name: "PatString", _val: s});
      break _t2283;
    }
    if (_t2281._tag === 8) {
      const s = _t2281._val;
      Parser$advance(p);
      undefined;
      _t2282 = ({_tag: 1, _name: "PatVar", _val: s});
      break _t2283;
    }
    if (_t2281._tag === 9) {
      const s = _t2281._val;
      Parser$advance(p);
      undefined;
      const path_2284 = Ref$create(({_hd: s, _tl: null}));
      const continue_reading_2286 = Ref$create(true);
      let _t2288 = undefined;
      let _t2289 = false, _t2290;
      while (true) {
        if (!(Ref$get(continue_reading_2286))) break;
        let _t2291;
        if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
          let _t2293;
          const _t2292 = Parser$peek_kind_at(p, 1);
          _t2294: {
            if (_t2292._tag === 9) {
              const s2 = _t2292._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2293 = Ref$set(path_2284, ({_hd: s2, _tl: Ref$get(path_2284)}));
              break _t2294;
            }
            if (true) {
              _t2293 = Ref$set(continue_reading_2286, false);
              break _t2294;
            }
            _match_fail("line 16629");
          }
          _t2291 = _t2293;
        } else {
          _t2291 = Ref$set(continue_reading_2286, false);
        }
        _t2291;
        if (_t2289) break;
      }
      _t2288 = _t2289 ? _t2290 : undefined;
      _t2288;
      let _t2296;
      const _t2295 = Ref$get(path_2284);
      _t2297: {
        if (_t2295 !== null && _t2295._tl === null) {
          const single = _t2295._hd;
          _t2296 = single;
          break _t2297;
        }
        if (true) {
          const rev_path = _t2295;
          const parts_2298 = List$rev(rev_path);
          const _t2299 = String$concat(".", parts_2298);
          _t2296 = _t2299;
          break _t2297;
        }
        _match_fail("line 16629");
      }
      const _t2287 = _t2296;
      const _t2285 = _t2287;
      const ctor_name_2300 = _t2285;
      let _t2302;
      if (Parser$at_pattern_arg_start(p)) {
        _t2302 = ({_tag: 1, _name: "Some", _val: Parser$parse_pattern_atom(p)});
      } else {
        _t2302 = ({_tag: 0, _name: "None"});
      }
      const arg_2303 = _t2302;
      const _t2304 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name_2300, arg_2303]});
      const _t2301 = _t2304;
      _t2282 = _t2301;
      break _t2283;
    }
    if (_t2281._tag === 56) {
      Parser$advance(p);
      undefined;
      let _t2305;
      if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
        Parser$advance(p);
        undefined;
        _t2305 = ({_tag: 9, _name: "PatNil"});
      } else {
        const pats_2306 = Parser$parse_pattern_list_elems(p);
        Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
        function _t2308(pat, acc) {
          return ({_tag: 8, _name: "PatCons", _val: [pat, acc]});
        }
        const _t2307 = List$fold_right(_t2308, pats_2306, ({_tag: 9, _name: "PatNil"}));
        _t2305 = _t2307;
      }
      _t2282 = _t2305;
      break _t2283;
    }
    if (_t2281._tag === 52) {
      Parser$advance(p);
      undefined;
      let _t2309;
      if (_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"}))) {
        Parser$advance(p);
        undefined;
        _t2309 = ({_tag: 6, _name: "PatUnit"});
      } else {
        const pat_2310 = Parser$parse_pattern(p);
        let _t2313;
        const _t2312 = Parser$peek_kind(p);
        _t2314: {
          if (_t2312._tag === 59) {
            const pats_2315 = Ref$create(({_hd: pat_2310, _tl: null}));
            let _t2317 = undefined;
            let _t2318 = false, _t2319;
            while (true) {
              if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"})))) break;
              Parser$advance(p);
              undefined;
              Ref$set(pats_2315, ({_hd: Parser$parse_pattern(p), _tl: Ref$get(pats_2315)}));
              if (_t2318) break;
            }
            _t2317 = _t2318 ? _t2319 : undefined;
            _t2317;
            Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
            const _t2316 = ({_tag: 7, _name: "PatTuple", _val: List$rev(Ref$get(pats_2315))});
            _t2313 = _t2316;
            break _t2314;
          }
          if (_t2312._tag === 62) {
            Parser$advance(p);
            undefined;
            const ty_2320 = Parser$parse_ty(p);
            Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
            const _t2321 = ({_tag: 18, _name: "PatAnnot", _val: [pat_2310, ty_2320]});
            _t2313 = _t2321;
            break _t2314;
          }
          if (true) {
            Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
            _t2313 = pat_2310;
            break _t2314;
          }
          _match_fail("line 16629");
        }
        const _t2311 = _t2313;
        _t2309 = _t2311;
      }
      _t2282 = _t2309;
      break _t2283;
    }
    if (_t2281._tag === 54) {
      Parser$advance(p);
      undefined;
      const fields_2322 = Parser$parse_pattern_record_fields(p);
      Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
      const _t2323 = ({_tag: 11, _name: "PatRecord", _val: fields_2322});
      _t2282 = _t2323;
      break _t2283;
    }
    if (_t2281._tag === 89) {
      const tag = _t2281._val;
      Parser$advance(p);
      undefined;
      let _t2324;
      if (Parser$at_pattern_arg_start(p)) {
        _t2324 = ({_tag: 16, _name: "PatPolyVariant", _val: [tag, ({_tag: 1, _name: "Some", _val: Parser$parse_pattern_atom(p)})]});
      } else {
        _t2324 = ({_tag: 16, _name: "PatPolyVariant", _val: [tag, ({_tag: 0, _name: "None"})]});
      }
      _t2282 = _t2324;
      break _t2283;
    }
    if (_t2281._tag === 72) {
      Parser$advance(p);
      undefined;
      const name_2325 = Parser$expect_ident(p);
      const _t2326 = ({_tag: 17, _name: "PatPin", _val: name_2325});
      _t2282 = _t2326;
      break _t2283;
    }
    if (_t2281._tag === 41) {
      Parser$advance(p);
      undefined;
      let _t2328;
      const _t2327 = Parser$peek_kind(p);
      _t2329: {
        if (_t2327._tag === 56) {
          Parser$advance(p);
          undefined;
          let _t2330;
          if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
            Parser$advance(p);
            undefined;
            _t2330 = ({_tag: 14, _name: "PatArray", _val: null});
          } else {
            const pats_2331 = Parser$parse_pattern_list_elems(p);
            Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
            const _t2332 = ({_tag: 14, _name: "PatArray", _val: pats_2331});
            _t2330 = _t2332;
          }
          _t2328 = _t2330;
          break _t2329;
        }
        if (_t2327._tag === 54) {
          Parser$advance(p);
          undefined;
          let _t2333;
          if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
            Parser$advance(p);
            undefined;
            _t2333 = ({_tag: 15, _name: "PatMap", _val: null});
          } else {
            const entries_2334 = Parser$parse_pattern_map_entries(p);
            Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
            const _t2335 = ({_tag: 15, _name: "PatMap", _val: entries_2334});
            _t2333 = _t2335;
          }
          _t2328 = _t2333;
          break _t2329;
        }
        if (true) {
          _t2328 = Parser$error(p, "expected '[' or '{' after '#' in pattern");
          break _t2329;
        }
        _match_fail("line 16629");
      }
      _t2282 = _t2328;
      break _t2283;
    }
    if (true) {
      _t2282 = Parser$error(p, "expected pattern");
      break _t2283;
    }
    _match_fail("line 16629");
  }
  return _t2282;
}
function Parser$parse_pattern_cons(p) {
  const pat_2336 = Parser$parse_pattern_atom(p);
  let _t2339;
  const _t2338 = Parser$peek_kind(p);
  _t2340: {
    if (_t2338._tag === 73) {
      Parser$advance(p);
      undefined;
      const rest_2341 = Parser$parse_pattern_cons(p);
      const _t2342 = ({_tag: 8, _name: "PatCons", _val: [pat_2336, rest_2341]});
      _t2339 = _t2342;
      break _t2340;
    }
    if (true) {
      _t2339 = pat_2336;
      break _t2340;
    }
    _match_fail("line 16629");
  }
  const _t2337 = _t2339;
  return _t2337;
}
function Parser$parse_pattern_as(p) {
  const pat_2343 = Parser$parse_pattern_cons(p);
  let _t2346;
  const _t2345 = Parser$peek_kind(p);
  _t2347: {
    if (_t2345._tag === 8 && _t2345._val === "as") {
      Parser$advance(p);
      undefined;
      const name_2348 = Parser$expect_ident(p);
      const _t2349 = ({_tag: 12, _name: "PatAs", _val: [pat_2343, name_2348]});
      _t2346 = _t2349;
      break _t2347;
    }
    if (true) {
      _t2346 = pat_2343;
      break _t2347;
    }
    _match_fail("line 16629");
  }
  const _t2344 = _t2346;
  return _t2344;
}
function Parser$parse_pattern(p) {
  const pat_2350 = Ref$create(Parser$parse_pattern_as(p));
  let _t2352 = undefined;
  let _t2353 = false, _t2354;
  while (true) {
    if (!(_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"})))) break;
    Parser$advance(p);
    undefined;
    const next_pat_2355 = Parser$parse_pattern_as(p);
    const _t2356 = Ref$set(pat_2350, ({_tag: 13, _name: "PatOr", _val: [Ref$get(pat_2350), next_pat_2355]}));
    _t2356;
    if (_t2353) break;
  }
  _t2352 = _t2353 ? _t2354 : undefined;
  _t2352;
  const _t2351 = Ref$get(pat_2350);
  return _t2351;
}
function Parser$at_pattern_arg_start(p) {
  let _t2358;
  const _t2357 = Parser$peek_kind(p);
  _t2359: {
    if (_t2357._tag === 8 && _t2357._val === "as") {
      _t2358 = false;
      break _t2359;
    }
    if (((((((((((((_t2357._tag === 0 || _t2357._tag === 6) || _t2357._tag === 7) || _t2357._tag === 2) || _t2357._tag === 8) || _t2357._tag === 9) || _t2357._tag === 52) || _t2357._tag === 56) || _t2357._tag === 54) || _t2357._tag === 67) || _t2357._tag === 41) || _t2357._tag === 89) || _t2357._tag === 72)) {
      _t2358 = true;
      break _t2359;
    }
    if (true) {
      _t2358 = false;
      break _t2359;
    }
    _match_fail("line 16629");
  }
  return _t2358;
}
function Parser$parse_pattern_list_elems(p) {
  const first_2360 = Parser$parse_pattern(p);
  const pats_2362 = Ref$create(({_hd: first_2360, _tl: null}));
  let _t2364 = undefined;
  let _t2365 = false, _t2366;
  while (true) {
    if (!(_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"})))) break;
    Parser$advance(p);
    undefined;
    let _t2367;
    if (!_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
      _t2367 = Ref$set(pats_2362, ({_hd: Parser$parse_pattern(p), _tl: Ref$get(pats_2362)}));
    } else {
      _t2367 = undefined;
    }
    _t2367;
    if (_t2365) break;
  }
  _t2364 = _t2365 ? _t2366 : undefined;
  _t2364;
  const _t2363 = List$rev(Ref$get(pats_2362));
  const _t2361 = _t2363;
  return _t2361;
}
function Parser$parse_pattern_record_fields(p) {
  const fields_2368 = Ref$create(null);
  const first_2370 = Ref$create(true);
  let _t2372 = undefined;
  let _t2373 = false, _t2374;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
    let _t2375;
    if ((!Ref$get(first_2370))) {
      _t2375 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
    } else {
      _t2375 = undefined;
    }
    _t2375;
    let _t2376;
    if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
      _t2376 = undefined;
    } else {
      Ref$set(first_2370, false);
      let _t2377;
      if (_eq(Parser$peek_kind(p), ({_tag: 67, _name: "UNDERSCORE"}))) {
        Parser$advance(p);
        _t2377 = undefined;
      } else {
        const name_2378 = Parser$expect_ident(p);
        let _t2380;
        if (_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"}))) {
          Parser$advance(p);
          undefined;
          _t2380 = Parser$parse_pattern(p);
        } else {
          _t2380 = ({_tag: 1, _name: "PatVar", _val: name_2378});
        }
        const pat_2381 = _t2380;
        const _t2382 = Ref$set(fields_2368, ({_hd: [name_2378, pat_2381], _tl: Ref$get(fields_2368)}));
        const _t2379 = _t2382;
        _t2377 = _t2379;
      }
      _t2376 = _t2377;
    }
    _t2376;
    if (_t2373) break;
  }
  _t2372 = _t2373 ? _t2374 : undefined;
  _t2372;
  const _t2371 = List$rev(Ref$get(fields_2368));
  const _t2369 = _t2371;
  return _t2369;
}
function Parser$parse_pattern_map_entries(p) {
  const entries_2383 = Ref$create(null);
  const first_2385 = Ref$create(true);
  let _t2387 = undefined;
  let _t2388 = false, _t2389;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
    let _t2390;
    if ((!Ref$get(first_2385))) {
      _t2390 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
    } else {
      _t2390 = undefined;
    }
    _t2390;
    let _t2391;
    if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
      _t2391 = undefined;
    } else {
      Ref$set(first_2385, false);
      const key_2392 = Parser$parse_pattern_atom(p);
      Parser$expect(p, ({_tag: 62, _name: "COLON"}));
      const value_2394 = Parser$parse_pattern(p);
      const _t2395 = Ref$set(entries_2383, ({_hd: [key_2392, value_2394], _tl: Ref$get(entries_2383)}));
      const _t2393 = _t2395;
      _t2391 = _t2393;
    }
    _t2391;
    if (_t2388) break;
  }
  _t2387 = _t2388 ? _t2389 : undefined;
  _t2387;
  const _t2386 = List$rev(Ref$get(entries_2383));
  const _t2384 = _t2386;
  return _t2384;
}
function Parser$bp_of_binop(__x) {
  let _t2397;
  const _t2396 = __x;
  _t2398: {
    if (_t2396._tag === 66) {
      _t2397 = [1, 2];
      break _t2398;
    }
    if (_t2396._tag === 82) {
      _t2397 = [2, 3];
      break _t2398;
    }
    if (_t2396._tag === 81) {
      _t2397 = [4, 5];
      break _t2398;
    }
    if ((((((_t2396._tag === 75 || _t2396._tag === 76) || _t2396._tag === 77) || _t2396._tag === 78) || _t2396._tag === 79) || _t2396._tag === 80)) {
      _t2397 = [6, 7];
      break _t2398;
    }
    if (_t2396._tag === 73) {
      _t2397 = [9, 8];
      break _t2398;
    }
    if ((_t2396._tag === 68 || _t2396._tag === 69)) {
      _t2397 = [10, 11];
      break _t2398;
    }
    if (_t2396._tag === 72) {
      _t2397 = [10, 11];
      break _t2398;
    }
    if (((_t2396._tag === 70 || _t2396._tag === 71) || _t2396._tag === 43)) {
      _t2397 = [12, 13];
      break _t2398;
    }
    if ((_t2396._tag === 84 || _t2396._tag === 85)) {
      _t2397 = [10, 11];
      break _t2398;
    }
    if (((_t2396._tag === 83 || _t2396._tag === 87) || _t2396._tag === 88)) {
      _t2397 = [12, 13];
      break _t2398;
    }
    if (true) {
      _t2397 = [(-1), (-1)];
      break _t2398;
    }
    _match_fail("line 16629");
  }
  return _t2397;
}
function Parser$is_binop(__x) {
  let _t2400;
  const _t2399 = __x;
  _t2401: {
    if (((((((((((((((((((((_t2399._tag === 68 || _t2399._tag === 69) || _t2399._tag === 70) || _t2399._tag === 71) || _t2399._tag === 43) || _t2399._tag === 75) || _t2399._tag === 76) || _t2399._tag === 77) || _t2399._tag === 78) || _t2399._tag === 79) || _t2399._tag === 80) || _t2399._tag === 81) || _t2399._tag === 82) || _t2399._tag === 72) || _t2399._tag === 73) || _t2399._tag === 83) || _t2399._tag === 84) || _t2399._tag === 85) || _t2399._tag === 87) || _t2399._tag === 88) || _t2399._tag === 66)) {
      _t2400 = true;
      break _t2401;
    }
    if (true) {
      _t2400 = false;
      break _t2401;
    }
    _match_fail("line 16629");
  }
  return _t2400;
}
function Parser$binop_of_token(__x) {
  let _t2403;
  const _t2402 = __x;
  _t2404: {
    if (_t2402._tag === 68) {
      _t2403 = ({_tag: 0, _name: "Add"});
      break _t2404;
    }
    if (_t2402._tag === 69) {
      _t2403 = ({_tag: 1, _name: "Sub"});
      break _t2404;
    }
    if (_t2402._tag === 70) {
      _t2403 = ({_tag: 2, _name: "Mul"});
      break _t2404;
    }
    if (_t2402._tag === 71) {
      _t2403 = ({_tag: 3, _name: "Div"});
      break _t2404;
    }
    if (_t2402._tag === 43) {
      _t2403 = ({_tag: 4, _name: "Mod"});
      break _t2404;
    }
    if (_t2402._tag === 75) {
      _t2403 = ({_tag: 5, _name: "Eq"});
      break _t2404;
    }
    if (_t2402._tag === 76) {
      _t2403 = ({_tag: 6, _name: "Neq"});
      break _t2404;
    }
    if (_t2402._tag === 77) {
      _t2403 = ({_tag: 7, _name: "Lt"});
      break _t2404;
    }
    if (_t2402._tag === 78) {
      _t2403 = ({_tag: 8, _name: "Gt"});
      break _t2404;
    }
    if (_t2402._tag === 79) {
      _t2403 = ({_tag: 9, _name: "Le"});
      break _t2404;
    }
    if (_t2402._tag === 80) {
      _t2403 = ({_tag: 10, _name: "Ge"});
      break _t2404;
    }
    if (_t2402._tag === 81) {
      _t2403 = ({_tag: 11, _name: "And"});
      break _t2404;
    }
    if (_t2402._tag === 82) {
      _t2403 = ({_tag: 12, _name: "Or"});
      break _t2404;
    }
    if (_t2402._tag === 72) {
      _t2403 = ({_tag: 13, _name: "Concat"});
      break _t2404;
    }
    if (_t2402._tag === 83) {
      _t2403 = ({_tag: 14, _name: "Land"});
      break _t2404;
    }
    if (_t2402._tag === 84) {
      _t2403 = ({_tag: 15, _name: "Lor"});
      break _t2404;
    }
    if (_t2402._tag === 85) {
      _t2403 = ({_tag: 16, _name: "Lxor"});
      break _t2404;
    }
    if (_t2402._tag === 87) {
      _t2403 = ({_tag: 17, _name: "Lsl"});
      break _t2404;
    }
    if (_t2402._tag === 88) {
      _t2403 = ({_tag: 18, _name: "Lsr"});
      break _t2404;
    }
    if (_t2402._tag === 66) {
      _t2403 = ({_tag: 19, _name: "Pipe"});
      break _t2404;
    }
    if (true) {
      _t2403 = failwith("assert false");
      break _t2404;
    }
    _match_fail("line 16629");
  }
  return _t2403;
}
function Parser$resolve_fun_params(fun_params, body) {
  function _t2405(body, fp) {
    let _t2407;
    const _t2406 = fp;
    _t2408: {
      if (_t2406._tag === 0) {
        _t2407 = body;
        break _t2408;
      }
      if (_t2406._tag === 1) {
        const name = _t2406._val[0];
        const pat = _t2406._val[1];
        _t2407 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
        break _t2408;
      }
      _match_fail("line 16629");
    }
    return _t2407;
  }
  const body_2409 = List$fold(_t2405, body, fun_params);
  function _t2411(fp) {
    let _t2413;
    const _t2412 = fp;
    _t2414: {
      if (_t2412._tag === 0) {
        const param = _t2412._val;
        _t2413 = param;
        break _t2414;
      }
      if (_t2412._tag === 1) {
        const name = _t2412._val[0];
        const annot = _t2412._val[2];
        _t2413 = ({annot: annot, is_generated: true, name: name});
        break _t2414;
      }
      _match_fail("line 16629");
    }
    return _t2413;
  }
  const params_2415 = List$map(_t2411, fun_params);
  const _t2416 = [params_2415, body_2409];
  const _t2410 = _t2416;
  return _t2410;
}
const Parser$fresh_param_counter = Ref$create(0);
function Parser$fresh_param_name(_) {
  Ref$set(Parser$fresh_param_counter, (Ref$get(Parser$fresh_param_counter) + 1));
  return ("__p" + __dict_Show_int.show(Ref$get(Parser$fresh_param_counter)));
}
function Parser$parse_format_spec(spec, expr) {
  const len_2417 = String$length(spec);
  const i_2419 = Ref$create(0);
  let _t2421;
  if (((Ref$get(i_2419) < len_2417) && ((String$get(spec, Ref$get(i_2419)) === 60) || (String$get(spec, Ref$get(i_2419)) === 62)))) {
    const a_2422 = String$get(spec, Ref$get(i_2419));
    Ref$set(i_2419, (Ref$get(i_2419) + 1));
    const _t2423 = ({_tag: 1, _name: "Some", _val: a_2422});
    _t2421 = _t2423;
  } else {
    _t2421 = ({_tag: 0, _name: "None"});
  }
  const align_2424 = _t2421;
  let _t2426;
  if (((Ref$get(i_2419) < len_2417) && ((String$get(spec, Ref$get(i_2419)) === 48) && (((Ref$get(i_2419) + 1) < len_2417) && ((String$get(spec, (Ref$get(i_2419) + 1)) >= 49) && (String$get(spec, (Ref$get(i_2419) + 1)) <= 57)))))) {
    Ref$set(i_2419, (Ref$get(i_2419) + 1));
    _t2426 = true;
  } else {
    _t2426 = false;
  }
  const zero_pad_2427 = _t2426;
  const width_start_2429 = Ref$get(i_2419);
  let _t2431 = undefined;
  let _t2432 = false, _t2433;
  while (true) {
    if (!(((Ref$get(i_2419) < len_2417) && ((String$get(spec, Ref$get(i_2419)) >= 48) && (String$get(spec, Ref$get(i_2419)) <= 57))))) break;
    Ref$set(i_2419, (Ref$get(i_2419) + 1));
    if (_t2432) break;
  }
  _t2431 = _t2432 ? _t2433 : undefined;
  _t2431;
  let _t2434;
  if ((Ref$get(i_2419) > width_start_2429)) {
    _t2434 = ({_tag: 1, _name: "Some", _val: int_of_string(String$sub(spec, width_start_2429, (Ref$get(i_2419) - width_start_2429)))});
  } else {
    _t2434 = ({_tag: 0, _name: "None"});
  }
  const width_2435 = _t2434;
  let _t2437;
  if (((Ref$get(i_2419) < len_2417) && (String$get(spec, Ref$get(i_2419)) === 46))) {
    Ref$set(i_2419, (Ref$get(i_2419) + 1));
    const ps_2438 = Ref$get(i_2419);
    let _t2440 = undefined;
    let _t2441 = false, _t2442;
    while (true) {
      if (!(((Ref$get(i_2419) < len_2417) && ((String$get(spec, Ref$get(i_2419)) >= 48) && (String$get(spec, Ref$get(i_2419)) <= 57))))) break;
      Ref$set(i_2419, (Ref$get(i_2419) + 1));
      if (_t2441) break;
    }
    _t2440 = _t2441 ? _t2442 : undefined;
    _t2440;
    let _t2443;
    if ((Ref$get(i_2419) > ps_2438)) {
      _t2443 = int_of_string(String$sub(spec, ps_2438, (Ref$get(i_2419) - ps_2438)));
    } else {
      _t2443 = 0;
    }
    const n_2444 = _t2443;
    let _t2446;
    if (((Ref$get(i_2419) < len_2417) && (String$get(spec, Ref$get(i_2419)) === 102))) {
      Ref$set(i_2419, (Ref$get(i_2419) + 1));
      _t2446 = ({_tag: 1, _name: "Some", _val: n_2444});
    } else {
      _t2446 = ({_tag: 0, _name: "None"});
    }
    const _t2445 = _t2446;
    const _t2439 = _t2445;
    _t2437 = _t2439;
  } else {
    _t2437 = ({_tag: 0, _name: "None"});
  }
  const float_prec_2447 = _t2437;
  let _t2449;
  if ((Ref$get(i_2419) < len_2417)) {
    let _t2451;
    const _t2450 = String$get(spec, Ref$get(i_2419));
    _t2452: {
      if (true) {
        const _c = _t2450;
        if ((_c === 120)) {
          Ref$set(i_2419, (Ref$get(i_2419) + 1));
          _t2451 = ({_tag: 1, _name: "Some", _val: 120});
          break _t2452;
        }
      }
      if (true) {
        const _c = _t2450;
        if ((_c === 88)) {
          Ref$set(i_2419, (Ref$get(i_2419) + 1));
          _t2451 = ({_tag: 1, _name: "Some", _val: 88});
          break _t2452;
        }
      }
      if (true) {
        const _c = _t2450;
        if ((_c === 111)) {
          Ref$set(i_2419, (Ref$get(i_2419) + 1));
          _t2451 = ({_tag: 1, _name: "Some", _val: 111});
          break _t2452;
        }
      }
      if (true) {
        const _c = _t2450;
        if ((_c === 98)) {
          Ref$set(i_2419, (Ref$get(i_2419) + 1));
          _t2451 = ({_tag: 1, _name: "Some", _val: 98});
          break _t2452;
        }
      }
      if (true) {
        _t2451 = ({_tag: 0, _name: "None"});
        break _t2452;
      }
      _match_fail("line 16629");
    }
    _t2449 = _t2451;
  } else {
    _t2449 = ({_tag: 0, _name: "None"});
  }
  const type_spec_2453 = _t2449;
  let _t2456;
  const _t2455 = float_prec_2447;
  _t2457: {
    if (_t2455._tag === 1) {
      const n = _t2455._val;
      _t2456 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_float"}), ({_tag: 0, _name: "EInt", _val: n})]}), expr]});
      break _t2457;
    }
    if (_t2455._tag === 0) {
      let _t2459;
      const _t2458 = type_spec_2453;
      _t2460: {
        if (_t2458._tag === 1) {
          const _c = _t2458._val;
          if ((_c === 120)) {
            _t2459 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_hex"}), expr]});
            break _t2460;
          }
        }
        if (_t2458._tag === 1) {
          const _c = _t2458._val;
          if ((_c === 88)) {
            _t2459 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_hex_upper"}), expr]});
            break _t2460;
          }
        }
        if (_t2458._tag === 1) {
          const _c = _t2458._val;
          if ((_c === 111)) {
            _t2459 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_oct"}), expr]});
            break _t2460;
          }
        }
        if (_t2458._tag === 1) {
          const _c = _t2458._val;
          if ((_c === 98)) {
            _t2459 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_bin"}), expr]});
            break _t2460;
          }
        }
        if (true) {
          _t2459 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), expr]});
          break _t2460;
        }
        _match_fail("line 16629");
      }
      _t2456 = _t2459;
      break _t2457;
    }
    _match_fail("line 16629");
  }
  const inner_2461 = _t2456;
  let _t2463;
  if (zero_pad_2427) {
    let _t2465;
    const _t2464 = width_2435;
    _t2466: {
      if (_t2464._tag === 1) {
        const w = _t2464._val;
        _t2465 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_zero_pad"}), ({_tag: 0, _name: "EInt", _val: w})]}), inner_2461]});
        break _t2466;
      }
      if (_t2464._tag === 0) {
        _t2465 = inner_2461;
        break _t2466;
      }
      _match_fail("line 16629");
    }
    _t2463 = _t2465;
  } else {
    _t2463 = inner_2461;
  }
  const inner_2467 = _t2463;
  let _t2469;
  if ((!zero_pad_2427)) {
    let _t2471;
    const _t2470 = [align_2424, width_2435];
    _t2472: {
      if (_t2470[0]._tag === 1 && _t2470[1]._tag === 1) {
        const _c = _t2470[0]._val;
        const w = _t2470[1]._val;
        if ((_c === 62)) {
          _t2471 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_pad_left"}), ({_tag: 0, _name: "EInt", _val: w})]}), inner_2467]});
          break _t2472;
        }
      }
      if (_t2470[0]._tag === 1 && _t2470[1]._tag === 1) {
        const _c = _t2470[0]._val;
        const w = _t2470[1]._val;
        if ((_c === 60)) {
          _t2471 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_pad_right"}), ({_tag: 0, _name: "EInt", _val: w})]}), inner_2467]});
          break _t2472;
        }
      }
      if (true) {
        _t2471 = inner_2467;
        break _t2472;
      }
      _match_fail("line 16629");
    }
    _t2469 = _t2471;
  } else {
    _t2469 = inner_2467;
  }
  const inner_2473 = _t2469;
  const _t2474 = inner_2473;
  const _t2468 = _t2474;
  const _t2462 = _t2468;
  const _t2454 = _t2462;
  const _t2448 = _t2454;
  const _t2436 = _t2448;
  const _t2430 = _t2436;
  const _t2428 = _t2430;
  const _t2425 = _t2428;
  const _t2420 = _t2425;
  const _t2418 = _t2420;
  return _t2418;
}
function Parser$parse_atom(p) {
  const loc_2475 = Parser$peek(p).loc;
  const expr_2477 = Parser$parse_atom_inner(p);
  const _t2478 = ({_tag: 49, _name: "ELoc", _val: [loc_2475, expr_2477]});
  const _t2476 = _t2478;
  return _t2476;
}
function Parser$parse_atom_inner(p) {
  let _t2480;
  const _t2479 = Parser$peek_kind(p);
  _t2481: {
    if (_t2479._tag === 0) {
      const n = _t2479._val;
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 0, _name: "EInt", _val: n});
      break _t2481;
    }
    if (_t2479._tag === 1) {
      const f = _t2479._val;
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 1, _name: "EFloat", _val: f});
      break _t2481;
    }
    if (_t2479._tag === 2) {
      const s = _t2479._val;
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 3, _name: "EString", _val: s});
      break _t2481;
    }
    if (_t2479._tag === 3) {
      const parts = _t2479._val;
      Parser$advance(p);
      undefined;
      function _t2482(part) {
        let _t2484;
        const _t2483 = part;
        _t2485: {
          if (_t2483._tag === 0) {
            const s = _t2483._val;
            _t2484 = ({_tag: 3, _name: "EString", _val: s});
            break _t2485;
          }
          if (_t2483._tag === 1) {
            const src = _t2483._val[0];
            const fmt = _t2483._val[1];
            const tokens_2486 = Lexer$tokenize(src);
            const inner_p_2488 = Parser$create(tokens_2486);
            const inner_expr_2490 = Parser$parse_expr(inner_p_2488);
            let _t2493;
            const _t2492 = fmt;
            _t2494: {
              if (_t2492._tag === 0) {
                _t2493 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), inner_expr_2490]});
                break _t2494;
              }
              if (_t2492._tag === 1) {
                const spec = _t2492._val;
                _t2493 = Parser$parse_format_spec(spec, inner_expr_2490);
                break _t2494;
              }
              _match_fail("line 16629");
            }
            const _t2491 = _t2493;
            const _t2489 = _t2491;
            const _t2487 = _t2489;
            _t2484 = _t2487;
            break _t2485;
          }
          _match_fail("line 16629");
        }
        return _t2484;
      }
      const exprs_2495 = List$map(_t2482, parts);
      let _t2498;
      const _t2497 = exprs_2495;
      _t2499: {
        if (_t2497 === null) {
          _t2498 = ({_tag: 3, _name: "EString", _val: ""});
          break _t2499;
        }
        if (_t2497 !== null && _t2497._tl === null) {
          const e = _t2497._hd;
          _t2498 = e;
          break _t2499;
        }
        if (_t2497 !== null) {
          const first = _t2497._hd;
          const rest = _t2497._tl;
          function _t2500(acc, e) {
            return ({_tag: 13, _name: "EBinop", _val: [({_tag: 13, _name: "Concat"}), acc, e]});
          }
          _t2498 = List$fold(_t2500, first, rest);
          break _t2499;
        }
        _match_fail("line 16629");
      }
      const _t2496 = _t2498;
      _t2480 = _t2496;
      break _t2481;
    }
    if (_t2479._tag === 6) {
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 2, _name: "EBool", _val: true});
      break _t2481;
    }
    if (_t2479._tag === 7) {
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 2, _name: "EBool", _val: false});
      break _t2481;
    }
    if (_t2479._tag === 4) {
      const n = _t2479._val;
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 4, _name: "EByte", _val: n});
      break _t2481;
    }
    if (_t2479._tag === 5) {
      const n = _t2479._val;
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 5, _name: "ERune", _val: n});
      break _t2481;
    }
    if (_t2479._tag === 8) {
      const s = _t2479._val;
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 7, _name: "EVar", _val: s});
      break _t2481;
    }
    if (_t2479._tag === 9) {
      const s = _t2479._val;
      Parser$advance(p);
      undefined;
      let _t2502;
      const _t2501 = Parser$read_qualified_path(p, s);
      _t2503: {
        if (_t2501._tag === 958595272) {
          const qualified = _t2501._val;
          _t2502 = ({_tag: 7, _name: "EVar", _val: qualified});
          break _t2503;
        }
        if (_t2501._tag === 1067578635) {
          const qualified = _t2501._val;
          _t2502 = ({_tag: 24, _name: "EConstruct", _val: [qualified, ({_tag: 0, _name: "None"})]});
          break _t2503;
        }
        if (_t2501._tag === 982234060) {
          const mod_path = _t2501._val;
          Parser$advance(p);
          undefined;
          const inner_2504 = Parser$parse_expr(p);
          Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
          const _t2505 = ({_tag: 48, _name: "ELocalOpen", _val: [mod_path, inner_2504]});
          _t2502 = _t2505;
          break _t2503;
        }
        _match_fail("line 16629");
      }
      _t2480 = _t2502;
      break _t2481;
    }
    if (_t2479._tag === 52) {
      Parser$advance(p);
      undefined;
      const op_name_2506 = Parser$token_to_op_name(Parser$peek_kind(p));
      let _t2509;
      const _t2508 = op_name_2506;
      _t2510: {
        if (_t2508._tag === 1) {
          const name = _t2508._val;
          if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 53, _name: "RPAREN"}))) {
            Parser$advance(p);
            undefined;
            Parser$advance(p);
            undefined;
            _t2509 = ({_tag: 7, _name: "EVar", _val: name});
            break _t2510;
          }
        }
        if (true) {
          let _t2511;
          if (_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"}))) {
            Parser$advance(p);
            undefined;
            _t2511 = ({_tag: 6, _name: "EUnit"});
          } else {
            const expr_2512 = Parser$parse_expr(p);
            let _t2515;
            const _t2514 = Parser$peek_kind(p);
            _t2516: {
              if (_t2514._tag === 59) {
                const exprs_2517 = Ref$create(({_hd: expr_2512, _tl: null}));
                let _t2519 = undefined;
                let _t2520 = false, _t2521;
                while (true) {
                  if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"})))) break;
                  Parser$advance(p);
                  undefined;
                  Ref$set(exprs_2517, ({_hd: Parser$parse_expr(p), _tl: Ref$get(exprs_2517)}));
                  if (_t2520) break;
                }
                _t2519 = _t2520 ? _t2521 : undefined;
                _t2519;
                Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
                const _t2518 = ({_tag: 15, _name: "ETuple", _val: List$rev(Ref$get(exprs_2517))});
                _t2515 = _t2518;
                break _t2516;
              }
              if (_t2514._tag === 62) {
                Parser$advance(p);
                undefined;
                const ty_2522 = Parser$parse_ty(p);
                Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
                const _t2523 = ({_tag: 30, _name: "EAnnot", _val: [expr_2512, ty_2522]});
                _t2515 = _t2523;
                break _t2516;
              }
              if (_t2514._tag === 90) {
                Parser$advance(p);
                undefined;
                const ty_2524 = Parser$parse_ty(p);
                Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
                const _t2525 = ({_tag: 47, _name: "ECoerce", _val: [expr_2512, ty_2524]});
                _t2515 = _t2525;
                break _t2516;
              }
              if (true) {
                Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
                _t2515 = expr_2512;
                break _t2516;
              }
              _match_fail("line 16629");
            }
            const _t2513 = _t2515;
            _t2511 = _t2513;
          }
          _t2509 = _t2511;
          break _t2510;
        }
        _match_fail("line 16629");
      }
      const _t2507 = _t2509;
      _t2480 = _t2507;
      break _t2481;
    }
    if (_t2479._tag === 54) {
      Parser$advance(p);
      undefined;
      let _t2526;
      if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
        Parser$advance(p);
        undefined;
        _t2526 = ({_tag: 16, _name: "ERecord", _val: null});
      } else {
        let _t2528;
        const _t2527 = Parser$peek_kind(p);
        _t2529: {
          if (_t2527._tag === 8) {
            const next_2530 = Parser$peek_kind_at(p, 1);
            const _t2531 = (_eq(next_2530, ({_tag: 75, _name: "EQ"})) || (_eq(next_2530, ({_tag: 60, _name: "SEMICOLON"})) || _eq(next_2530, ({_tag: 55, _name: "RBRACE"}))));
            _t2528 = _t2531;
            break _t2529;
          }
          if (true) {
            _t2528 = false;
            break _t2529;
          }
          _match_fail("line 16629");
        }
        let _t2532;
        if (_t2528) {
          const fields_2533 = Parser$parse_record_fields(p);
          Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
          const _t2534 = ({_tag: 16, _name: "ERecord", _val: fields_2533});
          _t2532 = _t2534;
        } else {
          const base_2535 = Parser$parse_expr(p);
          Parser$expect(p, ({_tag: 18, _name: "WITH"}));
          const fields_2537 = Parser$parse_record_fields(p);
          Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
          const _t2538 = ({_tag: 17, _name: "ERecordUpdate", _val: [base_2535, fields_2537]});
          const _t2536 = _t2538;
          _t2532 = _t2536;
        }
        _t2526 = _t2532;
      }
      _t2480 = _t2526;
      break _t2481;
    }
    if (_t2479._tag === 56) {
      Parser$advance(p);
      undefined;
      let _t2539;
      if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
        Parser$advance(p);
        undefined;
        _t2539 = ({_tag: 21, _name: "ENil"});
      } else {
        const elems_2540 = Parser$parse_list_elems(p);
        Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
        const _t2541 = ({_tag: 22, _name: "EList", _val: elems_2540});
        _t2539 = _t2541;
      }
      _t2480 = _t2539;
      break _t2481;
    }
    if (_t2479._tag === 41) {
      Parser$advance(p);
      undefined;
      let _t2543;
      const _t2542 = Parser$peek_kind(p);
      _t2544: {
        if (_t2542._tag === 54) {
          Parser$advance(p);
          undefined;
          let _t2546;
          const _t2545 = Parser$parse_set_or_map(p);
          _t2547: {
            if (_t2545._tag === 887353506) {
              const pairs = _t2545._val;
              Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
              _t2546 = ({_tag: 42, _name: "EMap", _val: pairs});
              break _t2547;
            }
            if (_t2545._tag === 98602162) {
              const elems = _t2545._val;
              Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
              _t2546 = ({_tag: 44, _name: "ESet", _val: elems});
              break _t2547;
            }
            if (_t2545._tag === 533146490) {
              const expr = _t2545._val;
              Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
              _t2546 = expr;
              break _t2547;
            }
            _match_fail("line 16629");
          }
          _t2543 = _t2546;
          break _t2544;
        }
        if (_t2542._tag === 56) {
          Parser$advance(p);
          undefined;
          let _t2548;
          if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
            Parser$advance(p);
            undefined;
            _t2548 = ({_tag: 23, _name: "EArray", _val: null});
          } else {
            const elems_2549 = Parser$parse_list_elems(p);
            Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
            const _t2550 = ({_tag: 23, _name: "EArray", _val: elems_2549});
            _t2548 = _t2550;
          }
          _t2543 = _t2548;
          break _t2544;
        }
        if ((_t2542._tag === 9 || _t2542._tag === 8)) {
          const name = _t2542._val;
          Parser$advance(p);
          undefined;
          let _t2552;
          const _t2551 = Parser$peek_kind(p);
          _t2553: {
            if (_t2551._tag === 54) {
              Parser$advance(p);
              undefined;
              let _t2555;
              const _t2554 = Parser$parse_set_or_map(p);
              _t2556: {
                if (_t2554._tag === 887353506) {
                  const pairs = _t2554._val;
                  Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
                  _t2555 = ({_tag: 43, _name: "EMapTyped", _val: [name, pairs]});
                  break _t2556;
                }
                if (_t2554._tag === 98602162) {
                  const elems = _t2554._val;
                  Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
                  _t2555 = ({_tag: 45, _name: "ECollTyped", _val: [name, elems]});
                  break _t2556;
                }
                if (_t2554._tag === 533146490) {
                  const expr = _t2554._val;
                  Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
                  _t2555 = expr;
                  break _t2556;
                }
                _match_fail("line 16629");
              }
              _t2552 = _t2555;
              break _t2553;
            }
            if (_t2551._tag === 56) {
              Parser$advance(p);
              undefined;
              let _t2557;
              if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
                Parser$advance(p);
                undefined;
                _t2557 = ({_tag: 45, _name: "ECollTyped", _val: [name, null]});
              } else {
                const elems_2558 = Parser$parse_list_elems(p);
                Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
                const _t2559 = ({_tag: 45, _name: "ECollTyped", _val: [name, elems_2558]});
                _t2557 = _t2559;
              }
              _t2552 = _t2557;
              break _t2553;
            }
            if (true) {
              _t2552 = Parser$error(p, "expected '{' or '[' after type name");
              break _t2553;
            }
            _match_fail("line 16629");
          }
          _t2543 = _t2552;
          break _t2544;
        }
        if (true) {
          _t2543 = Parser$error(p, "expected '{', '[', or type name after '#'");
          break _t2544;
        }
        _match_fail("line 16629");
      }
      _t2480 = _t2543;
      break _t2481;
    }
    if (_t2479._tag === 89) {
      const tag = _t2479._val;
      Parser$advance(p);
      undefined;
      let _t2560;
      if ((Parser$at_atom_start(p) && (!Parser$is_keyword_expr_start(p)))) {
        _t2560 = ({_tag: 46, _name: "EPolyVariant", _val: [tag, ({_tag: 1, _name: "Some", _val: Parser$parse_postfix(p)})]});
      } else {
        _t2560 = ({_tag: 46, _name: "EPolyVariant", _val: [tag, ({_tag: 0, _name: "None"})]});
      }
      _t2480 = _t2560;
      break _t2481;
    }
    if (_t2479._tag === 35) {
      Parser$advance(p);
      undefined;
      const e_2561 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t2562 = e_2561;
      _t2480 = _t2562;
      break _t2481;
    }
    if (_t2479._tag === 16) {
      _t2480 = Parser$parse_fun(p);
      break _t2481;
    }
    if (_t2479._tag === 14) {
      _t2480 = Parser$parse_if(p);
      break _t2481;
    }
    if (_t2479._tag === 11) {
      _t2480 = Parser$parse_let_expr(p);
      break _t2481;
    }
    if (_t2479._tag === 17) {
      _t2480 = Parser$parse_match(p, false);
      break _t2481;
    }
    if (_t2479._tag === 39) {
      Parser$advance(p);
      undefined;
      _t2480 = Parser$parse_match(p, true);
      break _t2481;
    }
    if (_t2479._tag === 69) {
      Parser$advance(p);
      undefined;
      const expr_2563 = Parser$parse_postfix(p);
      const _t2564 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 0, _name: "Neg"}), expr_2563]});
      _t2480 = _t2564;
      break _t2481;
    }
    if (_t2479._tag === 40) {
      Parser$advance(p);
      undefined;
      const expr_2565 = Parser$parse_postfix(p);
      const _t2566 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 1, _name: "Not"}), expr_2565]});
      _t2480 = _t2566;
      break _t2481;
    }
    if (_t2479._tag === 86) {
      Parser$advance(p);
      undefined;
      const expr_2567 = Parser$parse_postfix(p);
      const _t2568 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 2, _name: "Lnot"}), expr_2567]});
      _t2480 = _t2568;
      break _t2481;
    }
    if (_t2479._tag === 26) {
      Parser$advance(p);
      undefined;
      const op_name_2569 = Parser$expect_ident(p);
      let _t2571;
      if (Parser$at_atom_start(p)) {
        _t2571 = Parser$parse_postfix(p);
      } else {
        _t2571 = ({_tag: 6, _name: "EUnit"});
      }
      const arg_2572 = _t2571;
      const _t2573 = ({_tag: 39, _name: "EPerform", _val: [op_name_2569, arg_2572]});
      const _t2570 = _t2573;
      _t2480 = _t2570;
      break _t2481;
    }
    if (_t2479._tag === 27) {
      _t2480 = Parser$parse_handle_expr(p);
      break _t2481;
    }
    if (_t2479._tag === 28) {
      _t2480 = Parser$parse_try_expr(p);
      break _t2481;
    }
    if (_t2479._tag === 29) {
      _t2480 = Parser$parse_provide_expr(p);
      break _t2481;
    }
    if (_t2479._tag === 31) {
      Parser$advance(p);
      undefined;
      const k_2574 = Parser$parse_atom(p);
      const v_2576 = Parser$parse_atom(p);
      const _t2577 = ({_tag: 41, _name: "EResume", _val: [k_2574, v_2576]});
      const _t2575 = _t2577;
      _t2480 = _t2575;
      break _t2481;
    }
    if (_t2479._tag === 34) {
      _t2480 = Parser$parse_for_expr(p);
      break _t2481;
    }
    if (_t2479._tag === 36) {
      Parser$advance(p);
      undefined;
      let _t2578;
      if (Parser$at_atom_start(p)) {
        _t2578 = ({_tag: 35, _name: "EBreak", _val: ({_tag: 1, _name: "Some", _val: Parser$parse_atom(p)})});
      } else {
        _t2578 = ({_tag: 35, _name: "EBreak", _val: ({_tag: 0, _name: "None"})});
      }
      _t2480 = _t2578;
      break _t2481;
    }
    if (_t2479._tag === 30) {
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 36, _name: "EContinueLoop"});
      break _t2481;
    }
    if (_t2479._tag === 32) {
      Parser$advance(p);
      undefined;
      _t2480 = ({_tag: 37, _name: "EReturn", _val: Parser$parse_expr_bp(p, 0)});
      break _t2481;
    }
    if (_t2479._tag === 63) {
      Parser$advance(p);
      undefined;
      const field_2579 = Parser$expect_ident(p);
      const r_2581 = ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__r"});
      const _t2582 = ({_tag: 10, _name: "EFun", _val: [r_2581, ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__r"}), field_2579]})]});
      const _t2580 = _t2582;
      _t2480 = _t2580;
      break _t2481;
    }
    if (true) {
      _t2480 = Parser$error(p, "expected expression");
      break _t2481;
    }
    _match_fail("line 16629");
  }
  return _t2480;
}
function Parser$at_atom_start(p) {
  let _t2584;
  const _t2583 = Parser$peek_kind(p);
  _t2585: {
    if ((((((((((((((((_t2583._tag === 0 || _t2583._tag === 1) || _t2583._tag === 2) || _t2583._tag === 3) || _t2583._tag === 4) || _t2583._tag === 5) || _t2583._tag === 6) || _t2583._tag === 7) || _t2583._tag === 8) || _t2583._tag === 9) || _t2583._tag === 52) || _t2583._tag === 54) || _t2583._tag === 56) || _t2583._tag === 41) || _t2583._tag === 63) || _t2583._tag === 89)) {
      _t2584 = true;
      break _t2585;
    }
    if (true) {
      _t2584 = false;
      break _t2585;
    }
    _match_fail("line 16629");
  }
  return _t2584;
}
function Parser$is_adjacent(p) {
  let _t2590;
  if ((p.pos > 0)) {
  const prev_2586 = Array$get(p.tokens, (p.pos - 1));
  const cur_2588 = Parser$peek(p);
  const _t2589 = (prev_2586.end_offset === cur_2588.loc.offset);
  const _t2587 = _t2589;
    _t2590 = _t2587;
  } else {
    _t2590 = false;
  }
  return _t2590;
}
function Parser$parse_postfix(p) {
  const expr_2591 = Parser$parse_atom(p);
  function loop(expr) {
    while (true) {
      let _t2594;
      const _t2593 = Parser$peek_kind(p);
      _t2595: {
        if (_t2593._tag === 63) {
          if (Parser$is_adjacent(p)) {
            Parser$advance(p);
            undefined;
            let _t2596;
            if (_eq(Parser$peek_kind(p), ({_tag: 56, _name: "LBRACKET"}))) {
              Parser$advance(p);
              undefined;
              const idx_2597 = Parser$parse_expr(p);
              Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
              const _t2599 = ({_tag: 19, _name: "EIndex", _val: [expr, idx_2597]});
              expr = _t2599;
              continue;
              const _t2598 = undefined;
              _t2596 = _t2598;
            } else {
              const field_2600 = Parser$expect_ident(p);
              const _t2602 = ({_tag: 18, _name: "EField", _val: [expr, field_2600]});
              expr = _t2602;
              continue;
              const _t2601 = undefined;
              _t2596 = _t2601;
            }
            _t2594 = _t2596;
            break _t2595;
          }
        }
        if (true) {
          _t2594 = expr;
          break _t2595;
        }
        _match_fail("line 16629");
      }
      return _t2594;
    }
  }
  const _t2603 = loop(expr_2591);
  const _t2592 = _t2603;
  return _t2592;
}
function Parser$parse_app(p) {
  const fn__2604 = Parser$parse_postfix(p);
  function loop(expr) {
    while (true) {
      let _t2607;
      const _t2606 = Parser$peek_kind(p);
      _t2608: {
        if (true) {
          if ((Parser$at_atom_start(p) && (!Parser$is_keyword_expr_start(p)))) {
            const arg_2609 = Parser$parse_postfix(p);
            let _t2612;
            const _t2611 = expr;
            _t2613: {
              if ((_t2611._tag === 24 && _t2611._val[1]._tag === 0 || _t2611._tag === 49 && _t2611._val[1]._tag === 24 && _t2611._val[1]._val[1]._tag === 0)) {
                const name = (_t2611._tag === 24 && _t2611._val[1]._tag === 0 ? _t2611._val[0] : _t2611._val[1]._val[0]);
                const _t2614 = ({_tag: 24, _name: "EConstruct", _val: [name, ({_tag: 1, _name: "Some", _val: arg_2609})]});
                expr = _t2614;
                continue;
                _t2612 = undefined;
                break _t2613;
              }
              if (true) {
                const _t2615 = ({_tag: 11, _name: "EApp", _val: [expr, arg_2609]});
                expr = _t2615;
                continue;
                _t2612 = undefined;
                break _t2613;
              }
              _match_fail("line 16629");
            }
            const _t2610 = _t2612;
            _t2607 = _t2610;
            break _t2608;
          }
        }
        if (true) {
          _t2607 = expr;
          break _t2608;
        }
        _match_fail("line 16629");
      }
      return _t2607;
    }
  }
  const _t2616 = loop(fn__2604);
  const _t2605 = _t2616;
  return _t2605;
}
function Parser$is_keyword_expr_start(p) {
  let _t2618;
  const _t2617 = Parser$peek_kind(p);
  _t2619: {
    if (((((((((((((_t2617._tag === 16 || _t2617._tag === 14) || _t2617._tag === 11) || _t2617._tag === 17) || _t2617._tag === 26) || _t2617._tag === 27) || _t2617._tag === 28) || _t2617._tag === 29) || _t2617._tag === 31) || _t2617._tag === 34) || _t2617._tag === 36) || _t2617._tag === 30) || _t2617._tag === 32)) {
      _t2618 = true;
      break _t2619;
    }
    if (true) {
      _t2618 = false;
      break _t2619;
    }
    _match_fail("line 16629");
  }
  return _t2618;
}
function Parser$parse_expr_bp(p, min_bp) {
  const lhs_2620 = Parser$parse_app(p);
  function loop(lhs) {
    while (true) {
      const kind_2622 = Parser$peek_kind(p);
      let _t2624;
      if (Parser$is_binop(kind_2622)) {
        let _t2626;
        const _t2625 = Parser$bp_of_binop(kind_2622);
        _t2627: {
          if (true) {
            const l_bp = _t2625[0];
            const r_bp = _t2625[1];
            let _t2628;
            if ((l_bp < min_bp)) {
              _t2628 = lhs;
            } else {
              Parser$advance(p);
              undefined;
              let _t2629;
              if (_eq(kind_2622, ({_tag: 73, _name: "COLONCOLON"}))) {
                const rhs_2630 = Parser$parse_expr_bp(p, r_bp);
                const _t2632 = ({_tag: 20, _name: "ECons", _val: [lhs, rhs_2630]});
                lhs = _t2632;
                continue;
                const _t2631 = undefined;
                _t2629 = _t2631;
              } else {
                const rhs_2633 = Parser$parse_expr_bp(p, r_bp);
                const _t2635 = ({_tag: 13, _name: "EBinop", _val: [Parser$binop_of_token(kind_2622), lhs, rhs_2633]});
                lhs = _t2635;
                continue;
                const _t2634 = undefined;
                _t2629 = _t2634;
              }
              _t2628 = _t2629;
            }
            _t2626 = _t2628;
            break _t2627;
          }
          _match_fail("line 16629");
        }
        _t2624 = _t2626;
      } else {
        _t2624 = lhs;
      }
      const _t2623 = _t2624;
      return _t2623;
    }
  }
  const _t2636 = loop(lhs_2620);
  const _t2621 = _t2636;
  return _t2621;
}
function Parser$parse_expr_no_seq(p) {
  const e_2637 = Parser$parse_expr_bp(p, 0);
  let _t2640;
  const _t2639 = Parser$peek_kind(p);
  _t2641: {
    if (_t2639._tag === 74) {
      Parser$advance(p);
      undefined;
      const rhs_2642 = Parser$parse_expr_bp(p, 0);
      let _t2645;
      const _t2644 = e_2637;
      _t2646: {
        if (_t2644._tag === 49) {
          const inner = _t2644._val[1];
          _t2645 = inner;
          break _t2646;
        }
        if (true) {
          const e = _t2644;
          _t2645 = e;
          break _t2646;
        }
        _match_fail("line 16629");
      }
      const e_inner_2647 = _t2645;
      let _t2650;
      const _t2649 = e_inner_2647;
      _t2651: {
        if (_t2649._tag === 7) {
          const name = _t2649._val;
          _t2650 = ({_tag: 27, _name: "EAssign", _val: [name, rhs_2642]});
          break _t2651;
        }
        if (_t2649._tag === 18) {
          const obj = _t2649._val[0];
          const field = _t2649._val[1];
          _t2650 = ({_tag: 28, _name: "EFieldAssign", _val: [obj, field, rhs_2642]});
          break _t2651;
        }
        if (true) {
          _t2650 = Parser$error(p, "left side of := must be a variable or field access");
          break _t2651;
        }
        _match_fail("line 16629");
      }
      const _t2648 = _t2650;
      const _t2643 = _t2648;
      _t2640 = _t2643;
      break _t2641;
    }
    if (true) {
      _t2640 = e_2637;
      break _t2641;
    }
    _match_fail("line 16629");
  }
  const _t2638 = _t2640;
  return _t2638;
}
function Parser$parse_expr(p) {
  const e_2652 = Parser$parse_expr_bp(p, 0);
  let _t2655;
  const _t2654 = Parser$peek_kind(p);
  _t2656: {
    if (_t2654._tag === 74) {
      Parser$advance(p);
      undefined;
      const rhs_2657 = Parser$parse_expr_bp(p, 0);
      let _t2660;
      const _t2659 = e_2652;
      _t2661: {
        if (_t2659._tag === 49) {
          const inner = _t2659._val[1];
          _t2660 = inner;
          break _t2661;
        }
        if (true) {
          const e = _t2659;
          _t2660 = e;
          break _t2661;
        }
        _match_fail("line 16629");
      }
      const e_inner_2662 = _t2660;
      let _t2665;
      const _t2664 = e_inner_2662;
      _t2666: {
        if (_t2664._tag === 7) {
          const name = _t2664._val;
          _t2665 = ({_tag: 27, _name: "EAssign", _val: [name, rhs_2657]});
          break _t2666;
        }
        if (_t2664._tag === 18) {
          const obj = _t2664._val[0];
          const field = _t2664._val[1];
          _t2665 = ({_tag: 28, _name: "EFieldAssign", _val: [obj, field, rhs_2657]});
          break _t2666;
        }
        if (true) {
          _t2665 = Parser$error(p, "left side of := must be a variable or field access");
          break _t2666;
        }
        _match_fail("line 16629");
      }
      const assign_2667 = _t2665;
      let _t2670;
      const _t2669 = Parser$peek_kind(p);
      _t2671: {
        if (_t2669._tag === 60) {
          if (!_eq(Parser$peek_next_kind(p), ({_tag: 1, _name: "Some", _val: ({_tag: 60, _name: "SEMICOLON"})}))) {
            Parser$advance(p);
            undefined;
            let _t2672;
            if (Parser$at_expr_start(p)) {
              _t2672 = ({_tag: 29, _name: "ESeq", _val: [assign_2667, Parser$parse_expr(p)]});
            } else {
              _t2672 = assign_2667;
            }
            _t2670 = _t2672;
            break _t2671;
          }
        }
        if (true) {
          _t2670 = assign_2667;
          break _t2671;
        }
        _match_fail("line 16629");
      }
      const _t2668 = _t2670;
      const _t2663 = _t2668;
      const _t2658 = _t2663;
      _t2655 = _t2658;
      break _t2656;
    }
    if (_t2654._tag === 60) {
      if (!_eq(Parser$peek_next_kind(p), ({_tag: 1, _name: "Some", _val: ({_tag: 60, _name: "SEMICOLON"})}))) {
        Parser$advance(p);
        undefined;
        let _t2673;
        if (Parser$at_expr_start(p)) {
          const e2_2674 = Parser$parse_expr(p);
          const _t2675 = ({_tag: 29, _name: "ESeq", _val: [e_2652, e2_2674]});
          _t2673 = _t2675;
        } else {
          _t2673 = e_2652;
        }
        _t2655 = _t2673;
        break _t2656;
      }
    }
    if (true) {
      _t2655 = e_2652;
      break _t2656;
    }
    _match_fail("line 16629");
  }
  const _t2653 = _t2655;
  return _t2653;
}
function Parser$peek_next_kind(p) {
  let _t2676;
  if (((p.pos + 1) < Array$length(p.tokens))) {
    _t2676 = ({_tag: 1, _name: "Some", _val: Array$get(p.tokens, (p.pos + 1)).kind});
  } else {
    _t2676 = ({_tag: 0, _name: "None"});
  }
  return _t2676;
}
function Parser$parse_fun_param(p) {
  let _t2678;
  const _t2677 = Parser$peek_kind(p);
  _t2679: {
    if (_t2677._tag === 52) {
      Parser$advance(p);
      undefined;
      let _t2680;
      if (_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"}))) {
        Parser$advance(p);
        undefined;
        _t2680 = ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "TyName", _val: "unit"})}), is_generated: false, name: "_"})});
      } else {
        const pat_2681 = Parser$parse_pattern(p);
        let _t2683;
        if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
          const pats_2684 = Ref$create(({_hd: pat_2681, _tl: null}));
          let _t2686 = undefined;
          let _t2687 = false, _t2688;
          while (true) {
            if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"})))) break;
            Parser$advance(p);
            undefined;
            Ref$set(pats_2684, ({_hd: Parser$parse_pattern(p), _tl: Ref$get(pats_2684)}));
            if (_t2687) break;
          }
          _t2686 = _t2687 ? _t2688 : undefined;
          _t2686;
          const _t2685 = ({_tag: 7, _name: "PatTuple", _val: List$rev(Ref$get(pats_2684))});
          _t2683 = _t2685;
        } else {
          _t2683 = pat_2681;
        }
        const pat_2689 = _t2683;
        let _t2691;
        if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
          Parser$advance(p);
          undefined;
          _t2691 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
        } else {
          _t2691 = ({_tag: 0, _name: "None"});
        }
        const annot_2692 = _t2691;
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        let _t2695;
        const _t2694 = [pat_2689, annot_2692];
        _t2696: {
          if (_t2694[0]._tag === 1) {
            const name = _t2694[0]._val;
            _t2695 = ({_tag: 0, _name: "FPParam", _val: ({annot: annot_2692, is_generated: false, name: name})});
            break _t2696;
          }
          if (true) {
            const pname_2697 = Parser$fresh_param_name(undefined);
            const _t2698 = ({_tag: 1, _name: "FPPat", _val: [pname_2697, pat_2689, annot_2692]});
            _t2695 = _t2698;
            break _t2696;
          }
          _match_fail("line 16629");
        }
        const _t2693 = _t2695;
        const _t2690 = _t2693;
        const _t2682 = _t2690;
        _t2680 = _t2682;
      }
      _t2678 = _t2680;
      break _t2679;
    }
    if (_t2677._tag === 54) {
      const pat_2699 = Parser$parse_pattern_atom(p);
      const pname_2701 = Parser$fresh_param_name(undefined);
      const _t2702 = ({_tag: 1, _name: "FPPat", _val: [pname_2701, pat_2699, ({_tag: 0, _name: "None"})]});
      const _t2700 = _t2702;
      _t2678 = _t2700;
      break _t2679;
    }
    if (_t2677._tag === 8) {
      const s = _t2677._val;
      Parser$advance(p);
      undefined;
      _t2678 = ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: s})});
      break _t2679;
    }
    if (_t2677._tag === 67) {
      Parser$advance(p);
      undefined;
      _t2678 = ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "_"})});
      break _t2679;
    }
    if (true) {
      _t2678 = Parser$error(p, "expected parameter");
      break _t2679;
    }
    _match_fail("line 16629");
  }
  return _t2678;
}
function Parser$parse_fun(p) {
  Parser$expect(p, ({_tag: 16, _name: "FN"}));
  let _t2703;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    undefined;
    const arms_2704 = Ref$create(null);
    const continue__2706 = Ref$create(true);
    let _t2708 = undefined;
    let _t2709 = false, _t2710;
    while (true) {
      if (!(Ref$get(continue__2706))) break;
      const pat_2711 = Parser$parse_pattern(p);
      let _t2713;
      if (_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHEN"}))) {
        Parser$advance(p);
        undefined;
        _t2713 = ({_tag: 1, _name: "Some", _val: Parser$parse_expr(p)});
      } else {
        _t2713 = ({_tag: 0, _name: "None"});
      }
      const guard_2714 = _t2713;
      Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
      const body_2716 = Parser$parse_expr(p);
      Ref$set(arms_2704, ({_hd: [pat_2711, guard_2714, body_2716], _tl: Ref$get(arms_2704)}));
      let _t2718;
      if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
        Parser$advance(p);
        _t2718 = undefined;
      } else {
        _t2718 = Ref$set(continue__2706, false);
      }
      const _t2717 = _t2718;
      const _t2715 = _t2717;
      const _t2712 = _t2715;
      _t2712;
      if (_t2709) break;
    }
    _t2708 = _t2709 ? _t2710 : undefined;
    _t2708;
    const param_2719 = ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__x"});
    const _t2720 = ({_tag: 10, _name: "EFun", _val: [param_2719, ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: "__x"}), List$rev(Ref$get(arms_2704)), false]})]});
    const _t2707 = _t2720;
    const _t2705 = _t2707;
    _t2703 = _t2705;
  } else {
    const fun_params_2721 = Ref$create(null);
    let _t2723 = undefined;
    let _t2724 = false, _t2725;
    while (true) {
      if (!(!_eq(Parser$peek_kind(p), ({_tag: 58, _name: "ARROW"})))) break;
      Ref$set(fun_params_2721, ({_hd: Parser$parse_fun_param(p), _tl: Ref$get(fun_params_2721)}));
      if (_t2724) break;
    }
    _t2723 = _t2724 ? _t2725 : undefined;
    _t2723;
    let _t2726;
    if (_eq(Ref$get(fun_params_2721), null)) {
      _t2726 = Ref$set(fun_params_2721, ({_hd: ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "TyName", _val: "unit"})}), is_generated: false, name: "_"})}), _tl: null}));
    } else {
      _t2726 = undefined;
    }
    _t2726;
    Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
    const body_2727 = Parser$parse_expr(p);
    function _t2729(body, fp) {
      let _t2731;
      const _t2730 = fp;
      _t2732: {
        if (_t2730._tag === 0) {
          _t2731 = body;
          break _t2732;
        }
        if (_t2730._tag === 1) {
          const name = _t2730._val[0];
          const pat = _t2730._val[1];
          _t2731 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
          break _t2732;
        }
        _match_fail("line 16629");
      }
      return _t2731;
    }
    const body_2733 = List$fold(_t2729, body_2727, Ref$get(fun_params_2721));
    function _t2735(fp) {
      let _t2737;
      const _t2736 = fp;
      _t2738: {
        if (_t2736._tag === 0) {
          const param = _t2736._val;
          _t2737 = param;
          break _t2738;
        }
        if (_t2736._tag === 1) {
          const name = _t2736._val[0];
          const annot = _t2736._val[2];
          _t2737 = ({annot: annot, is_generated: false, name: name});
          break _t2738;
        }
        _match_fail("line 16629");
      }
      return _t2737;
    }
    const params_2739 = List$map(_t2735, Ref$get(fun_params_2721));
    function _t2741(body, param) {
      return ({_tag: 10, _name: "EFun", _val: [param, body]});
    }
    const _t2740 = List$fold(_t2741, body_2733, params_2739);
    const _t2734 = _t2740;
    const _t2728 = _t2734;
    const _t2722 = _t2728;
    _t2703 = _t2722;
  }
  return _t2703;
}
function Parser$parse_param(p) {
  return Parser$parse_fun_param(p);
}
function Parser$parse_if(p) {
  Parser$expect(p, ({_tag: 14, _name: "IF"}));
  const cond_2742 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 35, _name: "DO"}));
  const then_e_2744 = Parser$parse_expr(p);
  let _t2747;
  const _t2746 = Parser$peek_kind(p);
  _t2748: {
    if (_t2746._tag === 15) {
      Parser$advance(p);
      undefined;
      const else_e_2749 = Parser$parse_expr_no_seq(p);
      const _t2750 = ({_tag: 12, _name: "EIf", _val: [cond_2742, then_e_2744, else_e_2749]});
      _t2747 = _t2750;
      break _t2748;
    }
    if (_t2746._tag === 47) {
      Parser$advance(p);
      undefined;
      _t2747 = ({_tag: 12, _name: "EIf", _val: [cond_2742, then_e_2744, ({_tag: 6, _name: "EUnit"})]});
      break _t2748;
    }
    if (true) {
      _t2747 = Parser$error(p, "expected 'else' or 'end' after if body");
      break _t2748;
    }
    _match_fail("line 16629");
  }
  const _t2745 = _t2747;
  const _t2743 = _t2745;
  return _t2743;
}
function Parser$parse_type_params(p) {
  let _t2751;
  if ((_eq(Parser$peek_kind(p), ({_tag: 52, _name: "LPAREN"})) && _eq(Parser$peek_kind_at(p, 1), ({_tag: 19, _name: "TYPE"})))) {
    Parser$advance(p);
    undefined;
    Parser$advance(p);
    undefined;
    const tyvars_2752 = Ref$create(null);
    let _t2754 = undefined;
    let _t2755 = false, _t2756;
    while (true) {
      let _t2758;
      const _t2757 = Parser$peek_kind(p);
      _t2759: {
        if (_t2757._tag === 10) {
          _t2758 = true;
          break _t2759;
        }
        if (true) {
          _t2758 = false;
          break _t2759;
        }
        _match_fail("line 16629");
      }
      if (!(_t2758)) break;
      let _t2761;
      const _t2760 = Parser$advance(p);
      _t2762: {
        if (_t2760.kind._tag === 10) {
          const s = _t2760.kind._val;
          _t2761 = Ref$set(tyvars_2752, ({_hd: s, _tl: Ref$get(tyvars_2752)}));
          break _t2762;
        }
        if (true) {
          _t2761 = undefined;
          break _t2762;
        }
        _match_fail("line 16629");
      }
      _t2761;
      if (_t2755) break;
    }
    _t2754 = _t2755 ? _t2756 : undefined;
    _t2754;
    let _t2763;
    if (_eq(Ref$get(tyvars_2752), null)) {
      _t2763 = Parser$error(p, "expected type variable after 'type'");
    } else {
      _t2763 = undefined;
    }
    _t2763;
    Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
    const _t2753 = List$rev(Ref$get(tyvars_2752));
    _t2751 = _t2753;
  } else {
    _t2751 = null;
  }
  return _t2751;
}
function Parser$parse_let_expr(p) {
  Parser$expect(p, ({_tag: 11, _name: "LET"}));
  const is_rec_2764 = _eq(Parser$peek_kind(p), ({_tag: 12, _name: "REC"}));
  let _t2766;
  if (is_rec_2764) {
    Parser$advance(p);
    _t2766 = undefined;
  } else {
    _t2766 = undefined;
  }
  _t2766;
  const is_mut_2767 = _eq(Parser$peek_kind(p), ({_tag: 33, _name: "MUT"}));
  let _t2769;
  if (is_mut_2767) {
    Parser$advance(p);
    _t2769 = undefined;
  } else {
    _t2769 = undefined;
  }
  _t2769;
  let _t2770;
  if ((is_rec_2764 && is_mut_2767)) {
    _t2770 = Parser$error(p, "let rec mut is not supported");
  } else {
    _t2770 = undefined;
  }
  _t2770;
  let _t2771;
  if (((!is_rec_2764) && ((!is_mut_2767) && Parser$is_destruct_start(p)))) {
    const pat_2772 = Parser$parse_pattern(p);
    Parser$expect(p, ({_tag: 75, _name: "EQ"}));
    const e1_2774 = Parser$parse_expr(p);
    Parser$expect(p, ({_tag: 13, _name: "IN"}));
    const e2_2776 = Parser$parse_expr(p);
    const _t2777 = ({_tag: 25, _name: "EMatch", _val: [e1_2774, ({_hd: [pat_2772, ({_tag: 0, _name: "None"}), e2_2776], _tl: null}), true]});
    const _t2775 = _t2777;
    const _t2773 = _t2775;
    _t2771 = _t2773;
  } else {
    let _t2778;
    if (is_rec_2764) {
      _t2778 = Parser$parse_type_params(p);
    } else {
      _t2778 = null;
    }
    const type_params_2779 = _t2778;
    const name_2781 = Parser$expect_ident(p);
    let _t2783;
    if (is_mut_2767) {
      let _t2784;
      if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        _t2784 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
      } else {
        _t2784 = ({_tag: 0, _name: "None"});
      }
      const annot_2785 = _t2784;
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const body_2787 = Parser$parse_expr(p);
      let _t2790;
      const _t2789 = annot_2785;
      _t2791: {
        if (_t2789._tag === 1) {
          const ty = _t2789._val;
          _t2790 = ({_tag: 30, _name: "EAnnot", _val: [body_2787, ty]});
          break _t2791;
        }
        if (_t2789._tag === 0) {
          _t2790 = body_2787;
          break _t2791;
        }
        _match_fail("line 16629");
      }
      const body_2792 = _t2790;
      Parser$expect(p, ({_tag: 13, _name: "IN"}));
      const rest_2794 = Parser$parse_expr(p);
      const _t2795 = ({_tag: 26, _name: "ELetMut", _val: [name_2781, body_2792, rest_2794]});
      const _t2793 = _t2795;
      const _t2788 = _t2793;
      const _t2786 = _t2788;
      _t2783 = _t2786;
    } else {
      const params_2796 = Ref$create(null);
      let _t2798 = undefined;
      let _t2799 = false, _t2800;
      while (true) {
        if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && !_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))))) break;
        Ref$set(params_2796, ({_hd: Parser$parse_param(p), _tl: Ref$get(params_2796)}));
        if (_t2799) break;
      }
      _t2798 = _t2799 ? _t2800 : undefined;
      _t2798;
      let _t2801;
      if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        const ty_2802 = Parser$parse_ty(p);
        let _t2804;
        if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
          Parser$advance(p);
          undefined;
          let _t2805;
          if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
            Parser$advance(p);
            undefined;
            _t2805 = ({_tag: 0, _name: "EffAnnotPure"});
          } else {
            _t2805 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
          }
          const eff_2806 = _t2805;
          const _t2807 = ({_tag: 1, _name: "Some", _val: ({_tag: 10, _name: "TyWithEffect", _val: [ty_2802, eff_2806]})});
          _t2804 = _t2807;
        } else {
          _t2804 = ({_tag: 1, _name: "Some", _val: ty_2802});
        }
        const _t2803 = _t2804;
        _t2801 = _t2803;
      } else {
        _t2801 = ({_tag: 0, _name: "None"});
      }
      const ret_annot_2808 = _t2801;
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const body_2810 = Parser$parse_expr(p);
      const full_body_2812 = Parser$wrap_params_expr(List$rev(Ref$get(params_2796)), ret_annot_2808, body_2810);
      let _t2814;
      if ((is_rec_2764 && _eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) {
        const bindings_2815 = Ref$create(({_hd: [name_2781, type_params_2779, full_body_2812], _tl: null}));
        let _t2817 = undefined;
        let _t2818 = false, _t2819;
        while (true) {
          if (!(_eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) break;
          Parser$advance(p);
          undefined;
          const and_name_2820 = Parser$expect_ident(p);
          const and_type_params_2822 = Parser$parse_type_params(p);
          const and_params_2824 = Ref$create(null);
          let _t2826 = undefined;
          let _t2827 = false, _t2828;
          while (true) {
            if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && !_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))))) break;
            Ref$set(and_params_2824, ({_hd: Parser$parse_param(p), _tl: Ref$get(and_params_2824)}));
            if (_t2827) break;
          }
          _t2826 = _t2827 ? _t2828 : undefined;
          _t2826;
          let _t2829;
          if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
            Parser$advance(p);
            undefined;
            const ty_2830 = Parser$parse_ty(p);
            let _t2832;
            if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
              Parser$advance(p);
              undefined;
              let _t2833;
              if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
                Parser$advance(p);
                undefined;
                _t2833 = ({_tag: 0, _name: "EffAnnotPure"});
              } else {
                _t2833 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
              }
              const eff_2834 = _t2833;
              const _t2835 = ({_tag: 1, _name: "Some", _val: ({_tag: 10, _name: "TyWithEffect", _val: [ty_2830, eff_2834]})});
              _t2832 = _t2835;
            } else {
              _t2832 = ({_tag: 1, _name: "Some", _val: ty_2830});
            }
            const _t2831 = _t2832;
            _t2829 = _t2831;
          } else {
            _t2829 = ({_tag: 0, _name: "None"});
          }
          const and_ret_annot_2836 = _t2829;
          Parser$expect(p, ({_tag: 75, _name: "EQ"}));
          const and_body_2838 = Parser$parse_expr(p);
          const and_full_body_2840 = Parser$wrap_params_expr(List$rev(Ref$get(and_params_2824)), and_ret_annot_2836, and_body_2838);
          const _t2841 = Ref$set(bindings_2815, ({_hd: [and_name_2820, and_type_params_2822, and_full_body_2840], _tl: Ref$get(bindings_2815)}));
          const _t2839 = _t2841;
          const _t2837 = _t2839;
          const _t2825 = _t2837;
          const _t2823 = _t2825;
          const _t2821 = _t2823;
          _t2821;
          if (_t2818) break;
        }
        _t2817 = _t2818 ? _t2819 : undefined;
        _t2817;
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const rest_2842 = Parser$parse_expr(p);
        const _t2843 = ({_tag: 38, _name: "ELetRecAnd", _val: [List$rev(Ref$get(bindings_2815)), rest_2842]});
        const _t2816 = _t2843;
        _t2814 = _t2816;
      } else {
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const rest_2844 = Parser$parse_expr(p);
        let _t2846;
        if (is_rec_2764) {
          _t2846 = ({_tag: 9, _name: "ELetRec", _val: [name_2781, type_params_2779, full_body_2812, rest_2844]});
        } else {
          _t2846 = ({_tag: 8, _name: "ELet", _val: [name_2781, full_body_2812, rest_2844]});
        }
        const _t2845 = _t2846;
        _t2814 = _t2845;
      }
      const _t2813 = _t2814;
      const _t2811 = _t2813;
      const _t2809 = _t2811;
      const _t2797 = _t2809;
      _t2783 = _t2797;
    }
    const _t2782 = _t2783;
    const _t2780 = _t2782;
    _t2771 = _t2780;
  }
  const _t2768 = _t2771;
  const _t2765 = _t2768;
  return _t2765;
}
function Parser$is_destruct_start(p) {
  let _t2848;
  const _t2847 = Parser$peek_kind(p);
  _t2849: {
    if ((((_t2847._tag === 52 || _t2847._tag === 54) || _t2847._tag === 56) || _t2847._tag === 9)) {
      _t2848 = true;
      break _t2849;
    }
    if (_t2847._tag === 8) {
      if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 73, _name: "COLONCOLON"}))) {
        _t2848 = true;
        break _t2849;
      }
    }
    if (true) {
      _t2848 = false;
      break _t2849;
    }
    _match_fail("line 16629");
  }
  return _t2848;
}
function Parser$wrap_params_expr(fun_params, ret_annot, body) {
  function _t2850(body, fp) {
    let _t2852;
    const _t2851 = fp;
    _t2853: {
      if (_t2851._tag === 0) {
        _t2852 = body;
        break _t2853;
      }
      if (_t2851._tag === 1) {
        const name = _t2851._val[0];
        const pat = _t2851._val[1];
        _t2852 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
        break _t2853;
      }
      _match_fail("line 16629");
    }
    return _t2852;
  }
  const body_2854 = List$fold(_t2850, body, fun_params);
  function _t2856(fp) {
    let _t2858;
    const _t2857 = fp;
    _t2859: {
      if (_t2857._tag === 0) {
        const param = _t2857._val;
        _t2858 = param;
        break _t2859;
      }
      if (_t2857._tag === 1) {
        const name = _t2857._val[0];
        const annot = _t2857._val[2];
        _t2858 = ({annot: annot, is_generated: true, name: name});
        break _t2859;
      }
      _match_fail("line 16629");
    }
    return _t2858;
  }
  const params_2860 = List$map(_t2856, fun_params);
  let _t2863;
  const _t2862 = ret_annot;
  _t2864: {
    if (_t2862._tag === 1 && _t2862._val._tag === 10) {
      const ret_ty = _t2862._val._val[0];
      const eff_annot = _t2862._val._val[1];
      if (!_eq(params_2860, null)) {
        const body_2865 = ({_tag: 30, _name: "EAnnot", _val: [body_2854, ret_ty]});
        function _t2867(param, body) {
          return ({_tag: 10, _name: "EFun", _val: [param, body]});
        }
        const full_fun_2868 = List$fold_right(_t2867, params_2860, body_2865);
        function build_arrow(__x) {
          let _t2871;
          const _t2870 = __x;
          _t2872: {
            if (_t2870 === null) {
              _t2871 = ret_ty;
              break _t2872;
            }
            if (_t2870 !== null && _t2870._tl === null) {
              const p = _t2870._hd;
              let _t2874;
              const _t2873 = p.annot;
              _t2875: {
                if (_t2873._tag === 1) {
                  const t = _t2873._val;
                  _t2874 = t;
                  break _t2875;
                }
                if (_t2873._tag === 0) {
                  _t2874 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t2875;
                }
                _match_fail("line 16629");
              }
              const pty_2876 = _t2874;
              const _t2877 = ({_tag: 2, _name: "TyArrow", _val: [pty_2876, ret_ty, ({_tag: 1, _name: "Some", _val: eff_annot})]});
              _t2871 = _t2877;
              break _t2872;
            }
            if (_t2870 !== null) {
              const p = _t2870._hd;
              const rest = _t2870._tl;
              let _t2879;
              const _t2878 = p.annot;
              _t2880: {
                if (_t2878._tag === 1) {
                  const t = _t2878._val;
                  _t2879 = t;
                  break _t2880;
                }
                if (_t2878._tag === 0) {
                  _t2879 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t2880;
                }
                _match_fail("line 16629");
              }
              const pty_2881 = _t2879;
              const _t2882 = ({_tag: 2, _name: "TyArrow", _val: [pty_2881, build_arrow(rest), ({_tag: 0, _name: "None"})]});
              _t2871 = _t2882;
              break _t2872;
            }
            _match_fail("line 16629");
          }
          return _t2871;
        }
        const _t2883 = ({_tag: 30, _name: "EAnnot", _val: [full_fun_2868, build_arrow(params_2860)]});
        const _t2869 = _t2883;
        const _t2866 = _t2869;
        _t2863 = _t2866;
        break _t2864;
      }
    }
    if (true) {
      let _t2885;
      const _t2884 = ret_annot;
      _t2886: {
        if (_t2884._tag === 1) {
          const ty = _t2884._val;
          _t2885 = ({_tag: 30, _name: "EAnnot", _val: [body_2854, ty]});
          break _t2886;
        }
        if (_t2884._tag === 0) {
          _t2885 = body_2854;
          break _t2886;
        }
        _match_fail("line 16629");
      }
      const body_2887 = _t2885;
      function _t2889(param, body) {
        return ({_tag: 10, _name: "EFun", _val: [param, body]});
      }
      const _t2888 = List$fold_right(_t2889, params_2860, body_2887);
      _t2863 = _t2888;
      break _t2864;
    }
    _match_fail("line 16629");
  }
  const _t2861 = _t2863;
  const _t2855 = _t2861;
  return _t2855;
}
function Parser$parse_match(p, partial) {
  Parser$expect(p, ({_tag: 17, _name: "MATCH"}));
  const scrut_2890 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t2892;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    _t2892 = undefined;
  } else {
    _t2892 = undefined;
  }
  _t2892;
  const arms_2893 = Ref$create(null);
  const continue__2895 = Ref$create(true);
  let _t2897 = undefined;
  let _t2898 = false, _t2899;
  while (true) {
    if (!(Ref$get(continue__2895))) break;
    const pat_2900 = Parser$parse_pattern(p);
    let _t2902;
    if (_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHEN"}))) {
      Parser$advance(p);
      undefined;
      _t2902 = ({_tag: 1, _name: "Some", _val: Parser$parse_expr(p)});
    } else {
      _t2902 = ({_tag: 0, _name: "None"});
    }
    const guard_2903 = _t2902;
    Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
    const body_2905 = Parser$parse_expr(p);
    Ref$set(arms_2893, ({_hd: [pat_2900, guard_2903, body_2905], _tl: Ref$get(arms_2893)}));
    let _t2907;
    if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
      Parser$advance(p);
      _t2907 = undefined;
    } else {
      _t2907 = Ref$set(continue__2895, false);
    }
    const _t2906 = _t2907;
    const _t2904 = _t2906;
    const _t2901 = _t2904;
    _t2901;
    if (_t2898) break;
  }
  _t2897 = _t2898 ? _t2899 : undefined;
  _t2897;
  const _t2896 = ({_tag: 25, _name: "EMatch", _val: [scrut_2890, List$rev(Ref$get(arms_2893)), partial]});
  const _t2894 = _t2896;
  const _t2891 = _t2894;
  return _t2891;
}
function Parser$parse_handle_expr(p) {
  Parser$expect(p, ({_tag: 27, _name: "HANDLE"}));
  const body_2908 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t2910;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    _t2910 = undefined;
  } else {
    _t2910 = undefined;
  }
  _t2910;
  const arms_2911 = Ref$create(null);
  const continue_parsing_2913 = Ref$create(true);
  let _t2915 = undefined;
  let _t2916 = false, _t2917;
  while (true) {
    if (!(Ref$get(continue_parsing_2913))) break;
    let _t2919;
    const _t2918 = Parser$peek_kind(p);
    _t2920: {
      if (_t2918._tag === 32) {
        Parser$advance(p);
        undefined;
        const name_2921 = Parser$expect_ident(p);
        Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
        const handler_body_2923 = Parser$parse_expr(p);
        Ref$set(arms_2911, ({_hd: ({_tag: 0, _name: "HReturn", _val: [name_2921, handler_body_2923]}), _tl: Ref$get(arms_2911)}));
        let _t2925;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t2925 = undefined;
        } else {
          _t2925 = Ref$set(continue_parsing_2913, false);
        }
        const _t2924 = _t2925;
        const _t2922 = _t2924;
        _t2919 = _t2922;
        break _t2920;
      }
      if (_t2918._tag === 8) {
        const s = _t2918._val;
        Parser$advance(p);
        undefined;
        let _t2927;
        const _t2926 = Parser$peek_kind(p);
        _t2928: {
          if (_t2926._tag === 58) {
            _t2927 = ["_", "__k"];
            break _t2928;
          }
          if (_t2926._tag === 52) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 53, _name: "RPAREN"}))) {
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              let _t2929;
              if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "ARROW"}))) {
                _t2929 = ["_", "__k"];
              } else {
                _t2929 = ["_", Parser$expect_ident(p)];
              }
              _t2927 = _t2929;
              break _t2928;
            }
          }
          if (_t2926._tag === 8) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 58, _name: "ARROW"}))) {
              _t2927 = ["_", Parser$expect_ident(p)];
              break _t2928;
            }
          }
          if (true) {
            const arg_2930 = Parser$expect_ident(p);
            const k_2932 = Parser$expect_ident(p);
            const _t2933 = [arg_2930, k_2932];
            const _t2931 = _t2933;
            _t2927 = _t2931;
            break _t2928;
          }
          _match_fail("line 16629");
        }
        let _t2935;
        const _t2934 = _t2927;
        _t2936: {
          if (true) {
            const arg_name = _t2934[0];
            const k_name = _t2934[1];
            Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
            const handler_body_2937 = Parser$parse_expr(p);
            Ref$set(arms_2911, ({_hd: ({_tag: 1, _name: "HOp", _val: [s, arg_name, k_name, handler_body_2937]}), _tl: Ref$get(arms_2911)}));
            let _t2939;
            if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
              Parser$advance(p);
              _t2939 = undefined;
            } else {
              _t2939 = Ref$set(continue_parsing_2913, false);
            }
            const _t2938 = _t2939;
            _t2935 = _t2938;
            break _t2936;
          }
          _match_fail("line 16629");
        }
        _t2919 = _t2935;
        break _t2920;
      }
      if (true) {
        _t2919 = Ref$set(continue_parsing_2913, false);
        break _t2920;
      }
      _match_fail("line 16629");
    }
    _t2919;
    if (_t2916) break;
  }
  _t2915 = _t2916 ? _t2917 : undefined;
  _t2915;
  const _t2914 = ({_tag: 40, _name: "EHandle", _val: [body_2908, List$rev(Ref$get(arms_2911))]});
  const _t2912 = _t2914;
  const _t2909 = _t2912;
  return _t2909;
}
function Parser$parse_try_expr(p) {
  Parser$expect(p, ({_tag: 28, _name: "TRY"}));
  const body_2940 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t2942;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    _t2942 = undefined;
  } else {
    _t2942 = undefined;
  }
  _t2942;
  const arms_2943 = Ref$create(({_hd: ({_tag: 0, _name: "HReturn", _val: ["__x", ({_tag: 7, _name: "EVar", _val: "__x"})]}), _tl: null}));
  const continue_parsing_2945 = Ref$create(true);
  let _t2947 = undefined;
  let _t2948 = false, _t2949;
  while (true) {
    if (!(Ref$get(continue_parsing_2945))) break;
    let _t2951;
    const _t2950 = Parser$peek_kind(p);
    _t2952: {
      if (_t2950._tag === 8) {
        const s = _t2950._val;
        Parser$advance(p);
        undefined;
        let _t2954;
        const _t2953 = Parser$peek_kind(p);
        _t2955: {
          if (_t2953._tag === 58) {
            _t2954 = "_";
            break _t2955;
          }
          if (_t2953._tag === 52) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 53, _name: "RPAREN"}))) {
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2954 = "_";
              break _t2955;
            }
          }
          if (true) {
            _t2954 = Parser$expect_ident(p);
            break _t2955;
          }
          _match_fail("line 16629");
        }
        const arg_name_2956 = _t2954;
        Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
        const handler_body_2958 = Parser$parse_expr(p);
        Ref$set(arms_2943, ({_hd: ({_tag: 1, _name: "HOp", _val: [s, arg_name_2956, "__k", handler_body_2958]}), _tl: Ref$get(arms_2943)}));
        let _t2960;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t2960 = undefined;
        } else {
          _t2960 = Ref$set(continue_parsing_2945, false);
        }
        const _t2959 = _t2960;
        const _t2957 = _t2959;
        _t2951 = _t2957;
        break _t2952;
      }
      if (true) {
        _t2951 = Ref$set(continue_parsing_2945, false);
        break _t2952;
      }
      _match_fail("line 16629");
    }
    _t2951;
    if (_t2948) break;
  }
  _t2947 = _t2948 ? _t2949 : undefined;
  _t2947;
  const _t2946 = ({_tag: 40, _name: "EHandle", _val: [body_2940, List$rev(Ref$get(arms_2943))]});
  const _t2944 = _t2946;
  const _t2941 = _t2944;
  return _t2941;
}
function Parser$parse_provide_expr(p) {
  Parser$expect(p, ({_tag: 29, _name: "PROVIDE"}));
  const body_2961 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t2963;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    _t2963 = undefined;
  } else {
    _t2963 = undefined;
  }
  _t2963;
  const arms_2964 = Ref$create(({_hd: ({_tag: 0, _name: "HReturn", _val: ["__x", ({_tag: 7, _name: "EVar", _val: "__x"})]}), _tl: null}));
  const continue_parsing_2966 = Ref$create(true);
  let _t2968 = undefined;
  let _t2969 = false, _t2970;
  while (true) {
    if (!(Ref$get(continue_parsing_2966))) break;
    let _t2972;
    const _t2971 = Parser$peek_kind(p);
    _t2973: {
      if (_t2971._tag === 8) {
        const s = _t2971._val;
        Parser$advance(p);
        undefined;
        let _t2975;
        const _t2974 = Parser$peek_kind(p);
        _t2976: {
          if (_t2974._tag === 58) {
            _t2975 = "_";
            break _t2976;
          }
          if (_t2974._tag === 52) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 53, _name: "RPAREN"}))) {
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2975 = "_";
              break _t2976;
            }
          }
          if (true) {
            _t2975 = Parser$expect_ident(p);
            break _t2976;
          }
          _match_fail("line 16629");
        }
        const arg_name_2977 = _t2975;
        Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
        const handler_body_2979 = Parser$parse_expr(p);
        const resume_expr_2981 = ({_tag: 41, _name: "EResume", _val: [({_tag: 7, _name: "EVar", _val: "__k"}), handler_body_2979]});
        Ref$set(arms_2964, ({_hd: ({_tag: 1, _name: "HOp", _val: [s, arg_name_2977, "__k", resume_expr_2981]}), _tl: Ref$get(arms_2964)}));
        let _t2983;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t2983 = undefined;
        } else {
          _t2983 = Ref$set(continue_parsing_2966, false);
        }
        const _t2982 = _t2983;
        const _t2980 = _t2982;
        const _t2978 = _t2980;
        _t2972 = _t2978;
        break _t2973;
      }
      if (true) {
        _t2972 = Ref$set(continue_parsing_2966, false);
        break _t2973;
      }
      _match_fail("line 16629");
    }
    _t2972;
    if (_t2969) break;
  }
  _t2968 = _t2969 ? _t2970 : undefined;
  _t2968;
  const _t2967 = ({_tag: 40, _name: "EHandle", _val: [body_2961, List$rev(Ref$get(arms_2964))]});
  const _t2965 = _t2967;
  const _t2962 = _t2965;
  return _t2962;
}
function Parser$lookahead_in_after_balanced(p) {
  const depth_2984 = Ref$create(1);
  const i_2986 = Ref$create(1);
  const hit_eof_2988 = Ref$create(false);
  let _t2990 = undefined;
  let _t2991 = false, _t2992;
  while (true) {
    if (!(((Ref$get(depth_2984) > 0) && (!Ref$get(hit_eof_2988))))) break;
    let _t2994;
    const _t2993 = Parser$peek_kind_at(p, Ref$get(i_2986));
    _t2995: {
      if (((_t2993._tag === 52 || _t2993._tag === 54) || _t2993._tag === 56)) {
        _t2994 = Ref$set(depth_2984, (Ref$get(depth_2984) + 1));
        break _t2995;
      }
      if (((_t2993._tag === 53 || _t2993._tag === 55) || _t2993._tag === 57)) {
        _t2994 = Ref$set(depth_2984, (Ref$get(depth_2984) - 1));
        break _t2995;
      }
      if (_t2993._tag === 91) {
        _t2994 = Ref$set(hit_eof_2988, true);
        break _t2995;
      }
      if (true) {
        _t2994 = undefined;
        break _t2995;
      }
      _match_fail("line 16629");
    }
    _t2994;
    Ref$set(i_2986, (Ref$get(i_2986) + 1));
    if (_t2991) break;
  }
  _t2990 = _t2991 ? _t2992 : undefined;
  _t2990;
  const _t2989 = ((!Ref$get(hit_eof_2988)) && ((Ref$get(depth_2984) === 0) && _eq(Parser$peek_kind_at(p, Ref$get(i_2986)), ({_tag: 13, _name: "IN"}))));
  const _t2987 = _t2989;
  const _t2985 = _t2987;
  return _t2985;
}
function Parser$pat_to_name_and_wrap(pat) {
  let _t2997;
  const _t2996 = pat;
  _t2998: {
    if (_t2996._tag === 1) {
      const name = _t2996._val;
      function _t2999(body) {
        return body;
      }
      _t2997 = [name, _t2999];
      break _t2998;
    }
    if (_t2996._tag === 0) {
      function _t3000(body) {
        return body;
      }
      _t2997 = ["_", _t3000];
      break _t2998;
    }
    if (true) {
      const pname_3001 = Parser$fresh_param_name(undefined);
      function _t3003(body) {
        return ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: pname_3001}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
      }
      const _t3002 = [pname_3001, _t3003];
      _t2997 = _t3002;
      break _t2998;
    }
    _match_fail("line 16629");
  }
  return _t2997;
}
function Parser$parse_for_in_rest(p, elem_name, elem_wrap, coll) {
  let _t3005;
  const _t3004 = Parser$peek_kind(p);
  _t3006: {
    if (_t3004._tag === 18) {
      Parser$advance(p);
      undefined;
      let _t3008;
      const _t3007 = Parser$peek_kind(p);
      _t3009: {
        if (((_t3007._tag === 52 || _t3007._tag === 54) || _t3007._tag === 56)) {
          _t3008 = Parser$parse_pattern_atom(p);
          break _t3009;
        }
        if (true) {
          const name_3010 = Parser$expect_ident(p);
          const _t3011 = ({_tag: 1, _name: "PatVar", _val: name_3010});
          _t3008 = _t3011;
          break _t3009;
        }
        _match_fail("line 16629");
      }
      const acc_pat_3012 = _t3008;
      let _t3015;
      const _t3014 = Parser$pat_to_name_and_wrap(acc_pat_3012);
      _t3016: {
        if (true) {
          const acc_name = _t3014[0];
          const acc_wrap = _t3014[1];
          Parser$expect(p, ({_tag: 75, _name: "EQ"}));
          const init_3017 = Parser$parse_expr_bp(p, 0);
          Parser$expect(p, ({_tag: 35, _name: "DO"}));
          const body_3019 = Parser$parse_expr(p);
          Parser$expect(p, ({_tag: 47, _name: "END"}));
          const _t3020 = ({_tag: 33, _name: "EForFold", _val: [elem_name, coll, acc_name, init_3017, elem_wrap(acc_wrap(body_3019))]});
          const _t3018 = _t3020;
          _t3015 = _t3018;
          break _t3016;
        }
        _match_fail("line 16629");
      }
      const _t3013 = _t3015;
      _t3005 = _t3013;
      break _t3006;
    }
    if (_t3004._tag === 35) {
      Parser$advance(p);
      undefined;
      const body_3021 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t3022 = ({_tag: 32, _name: "EFor", _val: [elem_name, coll, elem_wrap(body_3021)]});
      _t3005 = _t3022;
      break _t3006;
    }
    if (true) {
      _t3005 = Parser$error(p, "expected 'do' or 'with' after for collection");
      break _t3006;
    }
    _match_fail("line 16629");
  }
  return _t3005;
}
function Parser$parse_for_expr(p) {
  Parser$expect(p, ({_tag: 34, _name: "FOR"}));
  let _t3024;
  const _t3023 = Parser$peek_kind(p);
  _t3025: {
    if (_t3023._tag === 35) {
      Parser$advance(p);
      undefined;
      const body_3026 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t3027 = ({_tag: 31, _name: "EWhile", _val: [({_tag: 2, _name: "EBool", _val: true}), body_3026]});
      _t3024 = _t3027;
      break _t3025;
    }
    if (_t3023._tag === 11) {
      Parser$advance(p);
      undefined;
      const pat_3028 = Parser$parse_pattern(p);
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const scrutinee_3030 = Parser$parse_expr_bp(p, 0);
      Parser$expect(p, ({_tag: 35, _name: "DO"}));
      const body_3032 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t3033 = ({_tag: 34, _name: "EWhileLet", _val: [pat_3028, scrutinee_3030, body_3032]});
      const _t3031 = _t3033;
      const _t3029 = _t3031;
      _t3024 = _t3029;
      break _t3025;
    }
    if ((_t3023._tag === 8 || _t3023._tag === 67)) {
      if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 13, _name: "IN"}))) {
        let _t3034;
        if (_eq(Parser$peek_kind(p), ({_tag: 67, _name: "UNDERSCORE"}))) {
          Parser$advance(p);
          undefined;
          _t3034 = "_";
        } else {
          _t3034 = Parser$expect_ident(p);
        }
        const var_name_3035 = _t3034;
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const coll_3037 = Parser$parse_expr_bp(p, 0);
        function _t3039(body) {
          return body;
        }
        const _t3038 = Parser$parse_for_in_rest(p, var_name_3035, _t3039, coll_3037);
        const _t3036 = _t3038;
        _t3024 = _t3036;
        break _t3025;
      }
    }
    if (((_t3023._tag === 52 || _t3023._tag === 54) || _t3023._tag === 56)) {
      if (Parser$lookahead_in_after_balanced(p)) {
        const pat_3040 = Parser$parse_pattern_atom(p);
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const coll_3042 = Parser$parse_expr_bp(p, 0);
        let _t3045;
        const _t3044 = Parser$pat_to_name_and_wrap(pat_3040);
        _t3046: {
          if (true) {
            const elem_name = _t3044[0];
            const elem_wrap = _t3044[1];
            _t3045 = Parser$parse_for_in_rest(p, elem_name, elem_wrap, coll_3042);
            break _t3046;
          }
          _match_fail("line 16629");
        }
        const _t3043 = _t3045;
        const _t3041 = _t3043;
        _t3024 = _t3041;
        break _t3025;
      }
    }
    if (true) {
      const cond_3047 = Parser$parse_expr_bp(p, 0);
      Parser$expect(p, ({_tag: 35, _name: "DO"}));
      const body_3049 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t3050 = ({_tag: 31, _name: "EWhile", _val: [cond_3047, body_3049]});
      const _t3048 = _t3050;
      _t3024 = _t3048;
      break _t3025;
    }
    _match_fail("line 16629");
  }
  return _t3024;
}
function Parser$parse_record_fields(p) {
  const fields_3051 = Ref$create(null);
  const first_3053 = Ref$create(true);
  let _t3055 = undefined;
  let _t3056 = false, _t3057;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
    let _t3058;
    if ((!Ref$get(first_3053))) {
      _t3058 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
    } else {
      _t3058 = undefined;
    }
    _t3058;
    let _t3059;
    if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
      _t3059 = undefined;
    } else {
      Ref$set(first_3053, false);
      const name_3060 = Parser$expect_ident(p);
      let _t3062;
      if (_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"}))) {
        Parser$advance(p);
        undefined;
        _t3062 = Parser$parse_expr_bp(p, 0);
      } else {
        _t3062 = ({_tag: 7, _name: "EVar", _val: name_3060});
      }
      const expr_3063 = _t3062;
      const _t3064 = Ref$set(fields_3051, ({_hd: [name_3060, expr_3063], _tl: Ref$get(fields_3051)}));
      const _t3061 = _t3064;
      _t3059 = _t3061;
    }
    _t3059;
    if (_t3056) break;
  }
  _t3055 = _t3056 ? _t3057 : undefined;
  _t3055;
  const _t3054 = List$rev(Ref$get(fields_3051));
  const _t3052 = _t3054;
  return _t3052;
}
function Parser$parse_map_pairs(p) {
  let _t3065;
  if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
    _t3065 = null;
  } else {
    const pairs_3066 = Ref$create(null);
    const first_3068 = Ref$create(true);
    let _t3070 = undefined;
    let _t3071 = false, _t3072;
    while (true) {
      if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
      let _t3073;
      if ((!Ref$get(first_3068))) {
        _t3073 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
      } else {
        _t3073 = undefined;
      }
      _t3073;
      Ref$set(first_3068, false);
      const key_3074 = Parser$parse_expr_bp(p, 0);
      Parser$expect(p, ({_tag: 62, _name: "COLON"}));
      const value_3076 = Parser$parse_expr_bp(p, 0);
      const _t3077 = Ref$set(pairs_3066, ({_hd: [key_3074, value_3076], _tl: Ref$get(pairs_3066)}));
      const _t3075 = _t3077;
      _t3075;
      if (_t3071) break;
    }
    _t3070 = _t3071 ? _t3072 : undefined;
    _t3070;
    const _t3069 = List$rev(Ref$get(pairs_3066));
    const _t3067 = _t3069;
    _t3065 = _t3067;
  }
  return _t3065;
}
function Parser$parse_set_or_map(p) {
  let _t3078;
  if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
    _t3078 = ({_tag: 887353506, _name: "`Map", _val: null});
  } else {
    const first_expr_3079 = Parser$parse_expr_bp(p, 0);
    let _t3081;
    if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
      Parser$advance(p);
      undefined;
      const first_val_3082 = Parser$parse_expr_bp(p, 0);
      const pairs_3084 = Ref$create(({_hd: [first_expr_3079, first_val_3082], _tl: null}));
      let _t3086 = undefined;
      let _t3087 = false, _t3088;
      while (true) {
        if (!(_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"})))) break;
        Parser$advance(p);
        undefined;
        let _t3089;
        if (!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
          const key_3090 = Parser$parse_expr_bp(p, 0);
          Parser$expect(p, ({_tag: 62, _name: "COLON"}));
          const value_3092 = Parser$parse_expr_bp(p, 0);
          const _t3093 = Ref$set(pairs_3084, ({_hd: [key_3090, value_3092], _tl: Ref$get(pairs_3084)}));
          const _t3091 = _t3093;
          _t3089 = _t3091;
        } else {
          _t3089 = undefined;
        }
        _t3089;
        if (_t3087) break;
      }
      _t3086 = _t3087 ? _t3088 : undefined;
      _t3086;
      const _t3085 = ({_tag: 887353506, _name: "`Map", _val: List$rev(Ref$get(pairs_3084))});
      const _t3083 = _t3085;
      _t3081 = _t3083;
    } else {
      let _t3094;
      if (_eq(Parser$peek_kind(p), ({_tag: 18, _name: "WITH"}))) {
        Parser$advance(p);
        undefined;
        const pairs_3095 = Ref$create(null);
        const continue__3097 = Ref$create(true);
        let _t3099 = undefined;
        let _t3100 = false, _t3101;
        while (true) {
          if (!(Ref$get(continue__3097))) break;
          const key_3102 = Parser$parse_expr_bp(p, 0);
          Parser$expect(p, ({_tag: 62, _name: "COLON"}));
          const value_3104 = Parser$parse_expr_bp(p, 0);
          Ref$set(pairs_3095, ({_hd: [key_3102, value_3104], _tl: Ref$get(pairs_3095)}));
          let _t3106;
          if (_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"}))) {
            Parser$advance(p);
            undefined;
            let _t3107;
            if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
              _t3107 = Ref$set(continue__3097, false);
            } else {
              _t3107 = undefined;
            }
            _t3106 = _t3107;
          } else {
            _t3106 = Ref$set(continue__3097, false);
          }
          const _t3105 = _t3106;
          const _t3103 = _t3105;
          _t3103;
          if (_t3100) break;
        }
        _t3099 = _t3100 ? _t3101 : undefined;
        _t3099;
        function _t3108(acc, __p54) {
          let _t3110;
          const _t3109 = __p54;
          _t3111: {
            if (true) {
              const k = _t3109[0];
              const v = _t3109[1];
              _t3110 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "set"}), k]}), v]}), acc]});
              break _t3111;
            }
            _match_fail("line 16629");
          }
          return _t3110;
        }
        const result_3112 = List$fold(_t3108, first_expr_3079, List$rev(Ref$get(pairs_3095)));
        const _t3113 = ({_tag: 533146490, _name: "`Update", _val: result_3112});
        const _t3098 = _t3113;
        const _t3096 = _t3098;
        _t3094 = _t3096;
      } else {
        const elems_3114 = Ref$create(({_hd: first_expr_3079, _tl: null}));
        let _t3116 = undefined;
        let _t3117 = false, _t3118;
        while (true) {
          if (!(_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"})))) break;
          Parser$advance(p);
          undefined;
          let _t3119;
          if (!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
            _t3119 = Ref$set(elems_3114, ({_hd: Parser$parse_expr_bp(p, 0), _tl: Ref$get(elems_3114)}));
          } else {
            _t3119 = undefined;
          }
          _t3119;
          if (_t3117) break;
        }
        _t3116 = _t3117 ? _t3118 : undefined;
        _t3116;
        const _t3115 = ({_tag: 98602162, _name: "`Set", _val: List$rev(Ref$get(elems_3114))});
        _t3094 = _t3115;
      }
      _t3081 = _t3094;
    }
    const _t3080 = _t3081;
    _t3078 = _t3080;
  }
  return _t3078;
}
function Parser$parse_list_elems(p) {
  const first_3120 = Parser$parse_expr_bp(p, 0);
  const elems_3122 = Ref$create(({_hd: first_3120, _tl: null}));
  let _t3124 = undefined;
  let _t3125 = false, _t3126;
  while (true) {
    if (!(_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"})))) break;
    Parser$advance(p);
    undefined;
    let _t3127;
    if (!_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
      _t3127 = Ref$set(elems_3122, ({_hd: Parser$parse_expr_bp(p, 0), _tl: Ref$get(elems_3122)}));
    } else {
      _t3127 = undefined;
    }
    _t3127;
    if (_t3125) break;
  }
  _t3124 = _t3125 ? _t3126 : undefined;
  _t3124;
  const _t3123 = List$rev(Ref$get(elems_3122));
  const _t3121 = _t3123;
  return _t3121;
}
function Parser$is_tyvar_token(__x) {
  let _t3129;
  const _t3128 = __x;
  _t3130: {
    if (_t3128._tag === 10) {
      _t3129 = true;
      break _t3130;
    }
    if (true) {
      _t3129 = false;
      break _t3130;
    }
    _match_fail("line 16629");
  }
  return _t3129;
}
function Parser$decompose_gadt_sig(ty) {
  function collect_args(__x) {
    let _t3132;
    const _t3131 = __x;
    _t3133: {
      if (_t3131._tag === 2) {
        const arg = _t3131._val[0];
        const rest = _t3131._val[1];
        let _t3135;
        const _t3134 = collect_args(rest);
        _t3136: {
          if (true) {
            const more_args = _t3134[0];
            const ret = _t3134[1];
            _t3135 = [({_hd: arg, _tl: more_args}), ret];
            break _t3136;
          }
          _match_fail("line 16629");
        }
        _t3132 = _t3135;
        break _t3133;
      }
      if (true) {
        const other = _t3131;
        _t3132 = [null, other];
        break _t3133;
      }
      _match_fail("line 16629");
    }
    return _t3132;
  }
  let _t3139;
  const _t3138 = collect_args(ty);
  _t3140: {
    if (_t3138[0] === null) {
      const ret = _t3138[1];
      _t3139 = [({_tag: 0, _name: "None"}), ret];
      break _t3140;
    }
    if (_t3138[0] !== null && _t3138[0]._tl === null) {
      const arg = _t3138[0]._hd;
      const ret = _t3138[1];
      _t3139 = [({_tag: 1, _name: "Some", _val: arg}), ret];
      break _t3140;
    }
    if (true) {
      const args = _t3138[0];
      const ret = _t3138[1];
      _t3139 = [({_tag: 1, _name: "Some", _val: ({_tag: 6, _name: "TyTuple", _val: args})}), ret];
      break _t3140;
    }
    _match_fail("line 16629");
  }
  const _t3137 = _t3139;
  return _t3137;
}
function Parser$parse_type_decl(p) {
  Parser$expect(p, ({_tag: 19, _name: "TYPE"}));
  let _t3142;
  const _t3141 = Parser$peek_kind(p);
  _t3143: {
    if (_t3141._tag === 10) {
      const s = _t3141._val;
      Parser$advance(p);
      undefined;
      _t3142 = ({_hd: s, _tl: null});
      break _t3143;
    }
    if (_t3141._tag === 52) {
      if (Parser$is_tyvar_token(Parser$peek_kind_at(p, 1))) {
        Parser$advance(p);
        undefined;
        const params_3144 = Ref$create(null);
        const first_3146 = Ref$create(true);
        let _t3148 = undefined;
        let _t3149 = false, _t3150;
        while (true) {
          if (!(!_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"})))) break;
          let _t3151;
          if ((!Ref$get(first_3146))) {
            _t3151 = Parser$expect(p, ({_tag: 59, _name: "COMMA"}));
          } else {
            _t3151 = undefined;
          }
          _t3151;
          Ref$set(first_3146, false);
          let _t3153;
          const _t3152 = Parser$peek_kind(p);
          _t3154: {
            if (_t3152._tag === 10) {
              const s = _t3152._val;
              Parser$advance(p);
              undefined;
              _t3153 = Ref$set(params_3144, ({_hd: s, _tl: Ref$get(params_3144)}));
              break _t3154;
            }
            if (true) {
              _t3153 = Parser$error(p, "expected type variable in type parameter list");
              break _t3154;
            }
            _match_fail("line 16629");
          }
          _t3153;
          if (_t3149) break;
        }
        _t3148 = _t3149 ? _t3150 : undefined;
        _t3148;
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        const _t3147 = List$rev(Ref$get(params_3144));
        const _t3145 = _t3147;
        _t3142 = _t3145;
        break _t3143;
      }
    }
    if (true) {
      _t3142 = null;
      break _t3143;
    }
    _match_fail("line 16629");
  }
  const type_params_3155 = _t3142;
  const name_3157 = Parser$expect_ident(p);
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  let _t3160;
  const _t3159 = Parser$peek_kind(p);
  _t3161: {
    if (_t3159._tag === 54) {
      Parser$advance(p);
      undefined;
      let _t3163;
      const _t3162 = Parser$parse_ty_record_fields(p);
      _t3164: {
        if (true) {
          const fields = _t3162[0];
          const _is_open = _t3162[1];
          Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
          _t3163 = ({_tag: 1, _name: "TDRecord", _val: fields});
          break _t3164;
        }
        _match_fail("line 16629");
      }
      _t3160 = _t3163;
      break _t3161;
    }
    if ((_t3159._tag === 65 || _t3159._tag === 9)) {
      let _t3165;
      if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
        Parser$advance(p);
        _t3165 = undefined;
      } else {
        _t3165 = undefined;
      }
      _t3165;
      const ctors_3166 = Ref$create(null);
      const continue__3168 = Ref$create(true);
      let _t3170 = undefined;
      let _t3171 = false, _t3172;
      while (true) {
        if (!(Ref$get(continue__3168))) break;
        const ctor_name_3173 = Parser$expect_uident(p);
        let _t3175;
        if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
          Parser$advance(p);
          undefined;
          const full_sig_3176 = Parser$parse_ty(p);
          let _t3179;
          const _t3178 = Parser$decompose_gadt_sig(full_sig_3176);
          _t3180: {
            if (true) {
              const arg_ty = _t3178[0];
              const ret_ty = _t3178[1];
              _t3179 = Ref$set(ctors_3166, ({_hd: [ctor_name_3173, arg_ty, ({_tag: 1, _name: "Some", _val: ret_ty})], _tl: Ref$get(ctors_3166)}));
              break _t3180;
            }
            _match_fail("line 16629");
          }
          const _t3177 = _t3179;
          _t3175 = _t3177;
        } else {
          let _t3181;
          if (_eq(Parser$peek_kind(p), ({_tag: 21, _name: "OF"}))) {
            Parser$advance(p);
            undefined;
            _t3181 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
          } else {
            _t3181 = ({_tag: 0, _name: "None"});
          }
          const arg_3182 = _t3181;
          const _t3183 = Ref$set(ctors_3166, ({_hd: [ctor_name_3173, arg_3182, ({_tag: 0, _name: "None"})], _tl: Ref$get(ctors_3166)}));
          _t3175 = _t3183;
        }
        _t3175;
        let _t3184;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t3184 = undefined;
        } else {
          _t3184 = Ref$set(continue__3168, false);
        }
        const _t3174 = _t3184;
        _t3174;
        if (_t3171) break;
      }
      _t3170 = _t3171 ? _t3172 : undefined;
      _t3170;
      const _t3169 = ({_tag: 0, _name: "TDVariant", _val: List$rev(Ref$get(ctors_3166))});
      const _t3167 = _t3169;
      _t3160 = _t3167;
      break _t3161;
    }
    if (true) {
      const rhs_3185 = Parser$parse_ty(p);
      const _t3186 = ({_tag: 2, _name: "TDAlias", _val: rhs_3185});
      _t3160 = _t3186;
      break _t3161;
    }
    _match_fail("line 16629");
  }
  const def_3187 = _t3160;
  let _t3189;
  if (_eq(Parser$peek_kind(p), ({_tag: 51, _name: "DERIVING"}))) {
    Parser$advance(p);
    undefined;
    const classes_3190 = Ref$create(null);
    const continue__3192 = Ref$create(true);
    let _t3194 = undefined;
    let _t3195 = false, _t3196;
    while (true) {
      let _t3200;
      if (Ref$get(continue__3192)) {
      let _t3198;
      const _t3197 = Parser$peek_kind(p);
      _t3199: {
        if (_t3197._tag === 9) {
          _t3198 = true;
          break _t3199;
        }
        if (true) {
          _t3198 = false;
          break _t3199;
        }
        _match_fail("line 16629");
      }
        _t3200 = _t3198;
      } else {
        _t3200 = false;
      }
      if (!(_t3200)) break;
      const cls_3201 = Parser$expect_uident(p);
      Ref$set(classes_3190, ({_hd: cls_3201, _tl: Ref$get(classes_3190)}));
      let _t3203;
      if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
        Parser$advance(p);
        _t3203 = undefined;
      } else {
        _t3203 = Ref$set(continue__3192, false);
      }
      const _t3202 = _t3203;
      _t3202;
      if (_t3195) break;
    }
    _t3194 = _t3195 ? _t3196 : undefined;
    _t3194;
    const _t3193 = List$rev(Ref$get(classes_3190));
    const _t3191 = _t3193;
    _t3189 = _t3191;
  } else {
    _t3189 = null;
  }
  const deriving__3204 = _t3189;
  let _t3206;
  if (!_eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"}))) {
    _t3206 = ({_tag: 4, _name: "DType", _val: [type_params_3155, name_3157, def_3187, deriving__3204]});
  } else {
    const defs_3207 = Ref$create(({_hd: [type_params_3155, name_3157, def_3187, deriving__3204], _tl: null}));
    let _t3209 = undefined;
    let _t3210 = false, _t3211;
    while (true) {
      if (!(_eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) break;
      Parser$advance(p);
      undefined;
      let _t3213;
      const _t3212 = Parser$peek_kind(p);
      _t3214: {
        if (_t3212._tag === 10) {
          const s = _t3212._val;
          Parser$advance(p);
          undefined;
          _t3213 = ({_hd: s, _tl: null});
          break _t3214;
        }
        if (_t3212._tag === 52) {
          if (Parser$is_tyvar_token(Parser$peek_kind_at(p, 1))) {
            Parser$advance(p);
            undefined;
            const params_3215 = Ref$create(null);
            const first_3217 = Ref$create(true);
            let _t3219 = undefined;
            let _t3220 = false, _t3221;
            while (true) {
              if (!(!_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"})))) break;
              let _t3222;
              if ((!Ref$get(first_3217))) {
                _t3222 = Parser$expect(p, ({_tag: 59, _name: "COMMA"}));
              } else {
                _t3222 = undefined;
              }
              _t3222;
              Ref$set(first_3217, false);
              let _t3224;
              const _t3223 = Parser$peek_kind(p);
              _t3225: {
                if (_t3223._tag === 10) {
                  const s = _t3223._val;
                  Parser$advance(p);
                  undefined;
                  _t3224 = Ref$set(params_3215, ({_hd: s, _tl: Ref$get(params_3215)}));
                  break _t3225;
                }
                if (true) {
                  _t3224 = Parser$error(p, "expected type variable in type parameter list");
                  break _t3225;
                }
                _match_fail("line 16629");
              }
              _t3224;
              if (_t3220) break;
            }
            _t3219 = _t3220 ? _t3221 : undefined;
            _t3219;
            Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
            const _t3218 = List$rev(Ref$get(params_3215));
            const _t3216 = _t3218;
            _t3213 = _t3216;
            break _t3214;
          }
        }
        if (true) {
          _t3213 = null;
          break _t3214;
        }
        _match_fail("line 16629");
      }
      const and_type_params_3226 = _t3213;
      const and_name_3228 = Parser$expect_ident(p);
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      let _t3231;
      const _t3230 = Parser$peek_kind(p);
      _t3232: {
        if (_t3230._tag === 54) {
          Parser$advance(p);
          undefined;
          let _t3234;
          const _t3233 = Parser$parse_ty_record_fields(p);
          _t3235: {
            if (true) {
              const fields = _t3233[0];
              const _is_open = _t3233[1];
              Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
              _t3234 = ({_tag: 1, _name: "TDRecord", _val: fields});
              break _t3235;
            }
            _match_fail("line 16629");
          }
          _t3231 = _t3234;
          break _t3232;
        }
        if ((_t3230._tag === 65 || _t3230._tag === 9)) {
          let _t3236;
          if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
            Parser$advance(p);
            _t3236 = undefined;
          } else {
            _t3236 = undefined;
          }
          _t3236;
          const ctors_3237 = Ref$create(null);
          const cont_3239 = Ref$create(true);
          let _t3241 = undefined;
          let _t3242 = false, _t3243;
          while (true) {
            if (!(Ref$get(cont_3239))) break;
            const ctor_name_3244 = Parser$expect_uident(p);
            let _t3246;
            if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
              Parser$advance(p);
              undefined;
              const full_sig_3247 = Parser$parse_ty(p);
              let _t3250;
              const _t3249 = Parser$decompose_gadt_sig(full_sig_3247);
              _t3251: {
                if (true) {
                  const arg_ty = _t3249[0];
                  const ret_ty = _t3249[1];
                  _t3250 = Ref$set(ctors_3237, ({_hd: [ctor_name_3244, arg_ty, ({_tag: 1, _name: "Some", _val: ret_ty})], _tl: Ref$get(ctors_3237)}));
                  break _t3251;
                }
                _match_fail("line 16629");
              }
              const _t3248 = _t3250;
              _t3246 = _t3248;
            } else {
              let _t3252;
              if (_eq(Parser$peek_kind(p), ({_tag: 21, _name: "OF"}))) {
                Parser$advance(p);
                undefined;
                _t3252 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
              } else {
                _t3252 = ({_tag: 0, _name: "None"});
              }
              const arg_3253 = _t3252;
              const _t3254 = Ref$set(ctors_3237, ({_hd: [ctor_name_3244, arg_3253, ({_tag: 0, _name: "None"})], _tl: Ref$get(ctors_3237)}));
              _t3246 = _t3254;
            }
            _t3246;
            let _t3255;
            if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
              Parser$advance(p);
              _t3255 = undefined;
            } else {
              _t3255 = Ref$set(cont_3239, false);
            }
            const _t3245 = _t3255;
            _t3245;
            if (_t3242) break;
          }
          _t3241 = _t3242 ? _t3243 : undefined;
          _t3241;
          const _t3240 = ({_tag: 0, _name: "TDVariant", _val: List$rev(Ref$get(ctors_3237))});
          const _t3238 = _t3240;
          _t3231 = _t3238;
          break _t3232;
        }
        if (true) {
          const rhs_3256 = Parser$parse_ty(p);
          const _t3257 = ({_tag: 2, _name: "TDAlias", _val: rhs_3256});
          _t3231 = _t3257;
          break _t3232;
        }
        _match_fail("line 16629");
      }
      const and_def_3258 = _t3231;
      let _t3260;
      if (_eq(Parser$peek_kind(p), ({_tag: 51, _name: "DERIVING"}))) {
        Parser$advance(p);
        undefined;
        const classes_3261 = Ref$create(null);
        const cont_3263 = Ref$create(true);
        let _t3265 = undefined;
        let _t3266 = false, _t3267;
        while (true) {
          let _t3271;
          if (Ref$get(cont_3263)) {
          let _t3269;
          const _t3268 = Parser$peek_kind(p);
          _t3270: {
            if (_t3268._tag === 9) {
              _t3269 = true;
              break _t3270;
            }
            if (true) {
              _t3269 = false;
              break _t3270;
            }
            _match_fail("line 16629");
          }
            _t3271 = _t3269;
          } else {
            _t3271 = false;
          }
          if (!(_t3271)) break;
          const cls_3272 = Parser$expect_uident(p);
          Ref$set(classes_3261, ({_hd: cls_3272, _tl: Ref$get(classes_3261)}));
          let _t3274;
          if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
            Parser$advance(p);
            _t3274 = undefined;
          } else {
            _t3274 = Ref$set(cont_3263, false);
          }
          const _t3273 = _t3274;
          _t3273;
          if (_t3266) break;
        }
        _t3265 = _t3266 ? _t3267 : undefined;
        _t3265;
        const _t3264 = List$rev(Ref$get(classes_3261));
        const _t3262 = _t3264;
        _t3260 = _t3262;
      } else {
        _t3260 = null;
      }
      const and_deriving_3275 = _t3260;
      const _t3276 = Ref$set(defs_3207, ({_hd: [and_type_params_3226, and_name_3228, and_def_3258, and_deriving_3275], _tl: Ref$get(defs_3207)}));
      const _t3259 = _t3276;
      const _t3229 = _t3259;
      const _t3227 = _t3229;
      _t3227;
      if (_t3210) break;
    }
    _t3209 = _t3210 ? _t3211 : undefined;
    _t3209;
    const _t3208 = ({_tag: 5, _name: "DTypeAnd", _val: List$rev(Ref$get(defs_3207))});
    _t3206 = _t3208;
  }
  const _t3205 = _t3206;
  const _t3188 = _t3205;
  const _t3158 = _t3188;
  const _t3156 = _t3158;
  return _t3156;
}
function Parser$parse_newtype_decl(p) {
  Parser$expect(p, ({_tag: 20, _name: "NEWTYPE"}));
  let _t3278;
  const _t3277 = Parser$peek_kind(p);
  _t3279: {
    if (_t3277._tag === 10) {
      const s = _t3277._val;
      Parser$advance(p);
      undefined;
      _t3278 = ({_hd: s, _tl: null});
      break _t3279;
    }
    if (_t3277._tag === 52) {
      if (Parser$is_tyvar_token(Parser$peek_kind_at(p, 1))) {
        Parser$advance(p);
        undefined;
        const params_3280 = Ref$create(null);
        const first_3282 = Ref$create(true);
        let _t3284 = undefined;
        let _t3285 = false, _t3286;
        while (true) {
          if (!(!_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"})))) break;
          let _t3287;
          if ((!Ref$get(first_3282))) {
            _t3287 = Parser$expect(p, ({_tag: 59, _name: "COMMA"}));
          } else {
            _t3287 = undefined;
          }
          _t3287;
          Ref$set(first_3282, false);
          let _t3289;
          const _t3288 = Parser$peek_kind(p);
          _t3290: {
            if (_t3288._tag === 10) {
              const s = _t3288._val;
              Parser$advance(p);
              undefined;
              _t3289 = Ref$set(params_3280, ({_hd: s, _tl: Ref$get(params_3280)}));
              break _t3290;
            }
            if (true) {
              _t3289 = Parser$error(p, "expected type variable in type parameter list");
              break _t3290;
            }
            _match_fail("line 16629");
          }
          _t3289;
          if (_t3285) break;
        }
        _t3284 = _t3285 ? _t3286 : undefined;
        _t3284;
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        const _t3283 = List$rev(Ref$get(params_3280));
        const _t3281 = _t3283;
        _t3278 = _t3281;
        break _t3279;
      }
    }
    if (true) {
      _t3278 = null;
      break _t3279;
    }
    _match_fail("line 16629");
  }
  const type_params_3291 = _t3278;
  const name_3293 = Parser$expect_ident(p);
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const ctor_name_3295 = Parser$expect_uident(p);
  Parser$expect(p, ({_tag: 21, _name: "OF"}));
  const underlying_3297 = Parser$parse_ty(p);
  let _t3299;
  if (_eq(Parser$peek_kind(p), ({_tag: 51, _name: "DERIVING"}))) {
    Parser$advance(p);
    undefined;
    const classes_3300 = Ref$create(null);
    const continue__3302 = Ref$create(true);
    let _t3304 = undefined;
    let _t3305 = false, _t3306;
    while (true) {
      let _t3310;
      if (Ref$get(continue__3302)) {
      let _t3308;
      const _t3307 = Parser$peek_kind(p);
      _t3309: {
        if (_t3307._tag === 9) {
          _t3308 = true;
          break _t3309;
        }
        if (true) {
          _t3308 = false;
          break _t3309;
        }
        _match_fail("line 16629");
      }
        _t3310 = _t3308;
      } else {
        _t3310 = false;
      }
      if (!(_t3310)) break;
      const cls_3311 = Parser$expect_uident(p);
      Ref$set(classes_3300, ({_hd: cls_3311, _tl: Ref$get(classes_3300)}));
      let _t3313;
      if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
        Parser$advance(p);
        _t3313 = undefined;
      } else {
        _t3313 = Ref$set(continue__3302, false);
      }
      const _t3312 = _t3313;
      _t3312;
      if (_t3305) break;
    }
    _t3304 = _t3305 ? _t3306 : undefined;
    _t3304;
    const _t3303 = List$rev(Ref$get(classes_3300));
    const _t3301 = _t3303;
    _t3299 = _t3301;
  } else {
    _t3299 = null;
  }
  const deriving__3314 = _t3299;
  const _t3315 = ({_tag: 4, _name: "DType", _val: [type_params_3291, name_3293, ({_tag: 3, _name: "TDNewtype", _val: [ctor_name_3295, underlying_3297]}), deriving__3314]});
  const _t3298 = _t3315;
  const _t3296 = _t3298;
  const _t3294 = _t3296;
  const _t3292 = _t3294;
  return _t3292;
}
function Parser$extract_pat_vars(__x) {
  while (true) {
    let _t3317;
    const _t3316 = __x;
    _t3318: {
      if (_t3316._tag === 1) {
        const name = _t3316._val;
        _t3317 = ({_hd: name, _tl: null});
        break _t3318;
      }
      if (((((((_t3316._tag === 0 || _t3316._tag === 2) || _t3316._tag === 3) || _t3316._tag === 4) || _t3316._tag === 5) || _t3316._tag === 6) || _t3316._tag === 9)) {
        _t3317 = null;
        break _t3318;
      }
      if (_t3316._tag === 7) {
        const pats = _t3316._val;
        _t3317 = List$concat_map(Parser$extract_pat_vars, pats);
        break _t3318;
      }
      if (_t3316._tag === 8) {
        const hd = _t3316._val[0];
        const tl = _t3316._val[1];
        _t3317 = List$concat(Parser$extract_pat_vars(hd), Parser$extract_pat_vars(tl));
        break _t3318;
      }
      if (_t3316._tag === 10 && _t3316._val[1]._tag === 0) {
        _t3317 = null;
        break _t3318;
      }
      if (_t3316._tag === 10 && _t3316._val[1]._tag === 1) {
        const p = _t3316._val[1]._val;
        const _t3319 = p;
        __x = _t3319;
        continue;
        _t3317 = undefined;
        break _t3318;
      }
      if (_t3316._tag === 11) {
        const fields = _t3316._val;
        function _t3320(__p55) {
          let _t3322;
          const _t3321 = __p55;
          _t3323: {
            if (true) {
              const p = _t3321[1];
              _t3322 = Parser$extract_pat_vars(p);
              break _t3323;
            }
            _match_fail("line 16629");
          }
          return _t3322;
        }
        _t3317 = List$concat_map(_t3320, fields);
        break _t3318;
      }
      if (_t3316._tag === 12) {
        const inner = _t3316._val[0];
        const name = _t3316._val[1];
        _t3317 = ({_hd: name, _tl: Parser$extract_pat_vars(inner)});
        break _t3318;
      }
      if (_t3316._tag === 13) {
        const p1 = _t3316._val[0];
        const _t3324 = p1;
        __x = _t3324;
        continue;
        _t3317 = undefined;
        break _t3318;
      }
      if (_t3316._tag === 14) {
        const pats = _t3316._val;
        _t3317 = List$concat_map(Parser$extract_pat_vars, pats);
        break _t3318;
      }
      if (_t3316._tag === 15) {
        const entries = _t3316._val;
        function _t3325(__p56) {
          let _t3327;
          const _t3326 = __p56;
          _t3328: {
            if (true) {
              const k = _t3326[0];
              const v = _t3326[1];
              _t3327 = List$concat(Parser$extract_pat_vars(k), Parser$extract_pat_vars(v));
              break _t3328;
            }
            _match_fail("line 16629");
          }
          return _t3327;
        }
        _t3317 = List$concat_map(_t3325, entries);
        break _t3318;
      }
      if (_t3316._tag === 16 && _t3316._val[1]._tag === 0) {
        _t3317 = null;
        break _t3318;
      }
      if (_t3316._tag === 16 && _t3316._val[1]._tag === 1) {
        const p = _t3316._val[1]._val;
        const _t3329 = p;
        __x = _t3329;
        continue;
        _t3317 = undefined;
        break _t3318;
      }
      if (_t3316._tag === 17) {
        _t3317 = null;
        break _t3318;
      }
      if (_t3316._tag === 18) {
        const p = _t3316._val[0];
        const _t3330 = p;
        __x = _t3330;
        continue;
        _t3317 = undefined;
        break _t3318;
      }
      _match_fail("line 16629");
    }
    return _t3317;
  }
}
function Parser$parse_constraints(p) {
  let _t3331;
  if (!_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"}))) {
    _t3331 = null;
  } else {
    Parser$advance(p);
    undefined;
    const constraints_3332 = Ref$create(null);
    const continue__3334 = Ref$create(true);
    let _t3336 = undefined;
    let _t3337 = false, _t3338;
    while (true) {
      if (!(Ref$get(continue__3334))) break;
      let _t3340;
      const _t3339 = Parser$peek_kind(p);
      _t3341: {
        if (_t3339._tag === 9) {
          const class_name_start = _t3339._val;
          Parser$advance(p);
          undefined;
          let _t3342;
          if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
            Parser$advance(p);
            undefined;
            let _t3344;
            const _t3343 = Parser$peek_kind(p);
            _t3345: {
              if (_t3343._tag === 9) {
                const s2 = _t3343._val;
                Parser$advance(p);
                undefined;
                _t3344 = (class_name_start + ("." + s2));
                break _t3345;
              }
              if (true) {
                _t3344 = Parser$error(p, "expected class name after dot");
                break _t3345;
              }
              _match_fail("line 16629");
            }
            _t3342 = _t3344;
          } else {
            _t3342 = class_name_start;
          }
          const class_name_3346 = _t3342;
          const tyvars_3348 = Ref$create(null);
          let _t3350 = undefined;
          let _t3351 = false, _t3352;
          while (true) {
            let _t3354;
            const _t3353 = Parser$peek_kind(p);
            _t3355: {
              if (_t3353._tag === 10) {
                _t3354 = true;
                break _t3355;
              }
              if (true) {
                _t3354 = false;
                break _t3355;
              }
              _match_fail("line 16629");
            }
            if (!(_t3354)) break;
            let _t3357;
            const _t3356 = Parser$advance(p).kind;
            _t3358: {
              if (_t3356._tag === 10) {
                const s = _t3356._val;
                _t3357 = Ref$set(tyvars_3348, ({_hd: s, _tl: Ref$get(tyvars_3348)}));
                break _t3358;
              }
              if (true) {
                _t3357 = undefined;
                break _t3358;
              }
              _match_fail("line 16629");
            }
            _t3357;
            if (_t3351) break;
          }
          _t3350 = _t3351 ? _t3352 : undefined;
          _t3350;
          let _t3359;
          if (_eq(Ref$get(tyvars_3348), null)) {
            _t3359 = Parser$error(p, "constraint requires at least one type variable");
          } else {
            _t3359 = undefined;
          }
          _t3359;
          Ref$set(constraints_3332, ({_hd: [class_name_3346, List$rev(Ref$get(tyvars_3348))], _tl: Ref$get(constraints_3332)}));
          let _t3360;
          if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
            Parser$advance(p);
            _t3360 = undefined;
          } else {
            _t3360 = Ref$set(continue__3334, false);
          }
          const _t3349 = _t3360;
          const _t3347 = _t3349;
          _t3340 = _t3347;
          break _t3341;
        }
        if (true) {
          _t3340 = Ref$set(continue__3334, false);
          break _t3341;
        }
        _match_fail("line 16629");
      }
      _t3340;
      if (_t3337) break;
    }
    _t3336 = _t3337 ? _t3338 : undefined;
    _t3336;
    const _t3335 = List$rev(Ref$get(constraints_3332));
    const _t3333 = _t3335;
    _t3331 = _t3333;
  }
  return _t3331;
}
function Parser$parse_let_decl(p) {
  Parser$expect(p, ({_tag: 11, _name: "LET"}));
  const is_rec_3361 = _eq(Parser$peek_kind(p), ({_tag: 12, _name: "REC"}));
  let _t3363;
  if (is_rec_3361) {
    Parser$advance(p);
    _t3363 = undefined;
  } else {
    _t3363 = undefined;
  }
  _t3363;
  const is_mut_3364 = _eq(Parser$peek_kind(p), ({_tag: 33, _name: "MUT"}));
  let _t3366;
  if (is_mut_3364) {
    Parser$advance(p);
    _t3366 = undefined;
  } else {
    _t3366 = undefined;
  }
  _t3366;
  let _t3367;
  if ((is_rec_3361 && is_mut_3364)) {
    _t3367 = Parser$error(p, "let rec mut is not supported");
  } else {
    _t3367 = undefined;
  }
  _t3367;
  let _t3368;
  if (((!is_rec_3361) && ((!is_mut_3364) && Parser$is_destruct_start(p)))) {
    const pat_3369 = Parser$parse_pattern(p);
    Parser$expect(p, ({_tag: 75, _name: "EQ"}));
    const body_3371 = Parser$parse_expr(p);
    let _t3373;
    if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
      Parser$advance(p);
      undefined;
      const rest_3374 = Parser$parse_expr(p);
      const _t3375 = ({_hd: ({_tag: 6, _name: "DExpr", _val: ({_tag: 25, _name: "EMatch", _val: [body_3371, ({_hd: [pat_3369, ({_tag: 0, _name: "None"}), rest_3374], _tl: null}), true]})}), _tl: null});
      _t3373 = _t3375;
    } else {
      const tmp_3376 = "__destruct";
      const vars_3378 = Parser$extract_pat_vars(pat_3369);
      const decls_3380 = ({_hd: ({_tag: 0, _name: "DLet", _val: [tmp_3376, null, ({_tag: 0, _name: "None"}), null, body_3371]}), _tl: null});
      function _t3382(v) {
        return ({_tag: 0, _name: "DLet", _val: [v, null, ({_tag: 0, _name: "None"}), null, ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: tmp_3376}), ({_hd: [pat_3369, ({_tag: 0, _name: "None"}), ({_tag: 7, _name: "EVar", _val: v})], _tl: null}), true]})]});
      }
      const _t3381 = List$concat(decls_3380, List$map(_t3382, vars_3378));
      const _t3379 = _t3381;
      const _t3377 = _t3379;
      _t3373 = _t3377;
    }
    const _t3372 = _t3373;
    const _t3370 = _t3372;
    _t3368 = _t3370;
  } else {
    let _t3383;
    if (is_mut_3364) {
      const name_3384 = Parser$expect_ident(p);
      let _t3386;
      if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        _t3386 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
      } else {
        _t3386 = ({_tag: 0, _name: "None"});
      }
      const annot_3387 = _t3386;
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const body_3389 = Parser$parse_expr(p);
      let _t3392;
      const _t3391 = annot_3387;
      _t3393: {
        if (_t3391._tag === 1) {
          const ty = _t3391._val;
          _t3392 = ({_tag: 30, _name: "EAnnot", _val: [body_3389, ty]});
          break _t3393;
        }
        if (_t3391._tag === 0) {
          _t3392 = body_3389;
          break _t3393;
        }
        _match_fail("line 16629");
      }
      const body_3394 = _t3392;
      let _t3396;
      if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
        Parser$advance(p);
        undefined;
        const rest_3397 = Parser$parse_expr(p);
        const _t3398 = ({_hd: ({_tag: 6, _name: "DExpr", _val: ({_tag: 26, _name: "ELetMut", _val: [name_3384, body_3394, rest_3397]})}), _tl: null});
        _t3396 = _t3398;
      } else {
        _t3396 = ({_hd: ({_tag: 1, _name: "DLetMut", _val: [name_3384, body_3394]}), _tl: null});
      }
      const _t3395 = _t3396;
      const _t3390 = _t3395;
      const _t3388 = _t3390;
      const _t3385 = _t3388;
      _t3383 = _t3385;
    } else {
      let _t3399;
      if (is_rec_3361) {
        _t3399 = Parser$parse_type_params(p);
      } else {
        _t3399 = null;
      }
      const type_params_3400 = _t3399;
      const name_3402 = Parser$expect_ident(p);
      const fun_params_3404 = Ref$create(null);
      let _t3406 = undefined;
      let _t3407 = false, _t3408;
      while (true) {
        if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && (!_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"})) && !_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"})))))) break;
        Ref$set(fun_params_3404, ({_hd: Parser$parse_param(p), _tl: Ref$get(fun_params_3404)}));
        if (_t3407) break;
      }
      _t3406 = _t3407 ? _t3408 : undefined;
      _t3406;
      let _t3409;
      if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        const ty_3410 = Parser$parse_ty(p);
        let _t3412;
        if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
          Parser$advance(p);
          undefined;
          let _t3413;
          if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
            Parser$advance(p);
            undefined;
            _t3413 = ({_tag: 0, _name: "EffAnnotPure"});
          } else {
            _t3413 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
          }
          const eff_3414 = _t3413;
          const _t3415 = ({_tag: 1, _name: "Some", _val: ({_tag: 10, _name: "TyWithEffect", _val: [ty_3410, eff_3414]})});
          _t3412 = _t3415;
        } else {
          _t3412 = ({_tag: 1, _name: "Some", _val: ty_3410});
        }
        const _t3411 = _t3412;
        _t3409 = _t3411;
      } else {
        _t3409 = ({_tag: 0, _name: "None"});
      }
      const ret_annot_3416 = _t3409;
      const constraints_3418 = Parser$parse_constraints(p);
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const body_3420 = Parser$parse_expr(p);
      const fun_params_3422 = List$rev(Ref$get(fun_params_3404));
      let _t3425;
      const _t3424 = Parser$resolve_fun_params(fun_params_3422, body_3420);
      _t3426: {
        if (true) {
          const params = _t3424[0];
          const body = _t3424[1];
          let _t3427;
          if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
            Parser$advance(p);
            undefined;
            const rest_3428 = Parser$parse_expr(p);
            const full_body_3430 = Parser$wrap_params_expr(fun_params_3422, ret_annot_3416, body);
            let _t3432;
            if (is_rec_3361) {
              _t3432 = ({_tag: 9, _name: "ELetRec", _val: [name_3402, type_params_3400, full_body_3430, rest_3428]});
            } else {
              _t3432 = ({_tag: 8, _name: "ELet", _val: [name_3402, full_body_3430, rest_3428]});
            }
            const expr_3433 = _t3432;
            const _t3434 = ({_hd: ({_tag: 6, _name: "DExpr", _val: expr_3433}), _tl: null});
            const _t3431 = _t3434;
            const _t3429 = _t3431;
            _t3427 = _t3429;
          } else {
            let _t3435;
            if ((is_rec_3361 && _eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) {
              const bindings_3436 = Ref$create(({_hd: [name_3402, type_params_3400, params, ret_annot_3416, constraints_3418, body], _tl: null}));
              let _t3438 = undefined;
              let _t3439 = false, _t3440;
              while (true) {
                if (!(_eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) break;
                Parser$advance(p);
                undefined;
                const and_name_3441 = Parser$expect_ident(p);
                const and_type_params_3443 = Parser$parse_type_params(p);
                const and_fun_params_3445 = Ref$create(null);
                let _t3447 = undefined;
                let _t3448 = false, _t3449;
                while (true) {
                  if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && (!_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"})) && !_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"})))))) break;
                  Ref$set(and_fun_params_3445, ({_hd: Parser$parse_param(p), _tl: Ref$get(and_fun_params_3445)}));
                  if (_t3448) break;
                }
                _t3447 = _t3448 ? _t3449 : undefined;
                _t3447;
                let _t3450;
                if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
                  Parser$advance(p);
                  undefined;
                  const ty_3451 = Parser$parse_ty(p);
                  let _t3453;
                  if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
                    Parser$advance(p);
                    undefined;
                    let _t3454;
                    if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
                      Parser$advance(p);
                      undefined;
                      _t3454 = ({_tag: 0, _name: "EffAnnotPure"});
                    } else {
                      _t3454 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
                    }
                    const eff_3455 = _t3454;
                    const _t3456 = ({_tag: 1, _name: "Some", _val: ({_tag: 10, _name: "TyWithEffect", _val: [ty_3451, eff_3455]})});
                    _t3453 = _t3456;
                  } else {
                    _t3453 = ({_tag: 1, _name: "Some", _val: ty_3451});
                  }
                  const _t3452 = _t3453;
                  _t3450 = _t3452;
                } else {
                  _t3450 = ({_tag: 0, _name: "None"});
                }
                const and_ret_annot_3457 = _t3450;
                const and_constraints_3459 = Parser$parse_constraints(p);
                Parser$expect(p, ({_tag: 75, _name: "EQ"}));
                const and_body_3461 = Parser$parse_expr(p);
                const and_fun_params_3463 = List$rev(Ref$get(and_fun_params_3445));
                let _t3466;
                const _t3465 = Parser$resolve_fun_params(and_fun_params_3463, and_body_3461);
                _t3467: {
                  if (true) {
                    const and_params = _t3465[0];
                    const and_body = _t3465[1];
                    _t3466 = Ref$set(bindings_3436, ({_hd: [and_name_3441, and_type_params_3443, and_params, and_ret_annot_3457, and_constraints_3459, and_body], _tl: Ref$get(bindings_3436)}));
                    break _t3467;
                  }
                  _match_fail("line 16629");
                }
                const _t3464 = _t3466;
                const _t3462 = _t3464;
                const _t3460 = _t3462;
                const _t3458 = _t3460;
                const _t3446 = _t3458;
                const _t3444 = _t3446;
                const _t3442 = _t3444;
                _t3442;
                if (_t3439) break;
              }
              _t3438 = _t3439 ? _t3440 : undefined;
              _t3438;
              let _t3468;
              if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
                Parser$advance(p);
                undefined;
                const rest_3469 = Parser$parse_expr(p);
                function _t3471(__p57) {
                  let _t3473;
                  const _t3472 = __p57;
                  _t3474: {
                    if (true) {
                      const n = _t3472[0];
                      const tp = _t3472[1];
                      const ps = _t3472[2];
                      const ra = _t3472[3];
                      const _cs = _t3472[4];
                      const b = _t3472[5];
                      function _t3475(p) {
                        return ({_tag: 0, _name: "FPParam", _val: p});
                      }
                      const full_3476 = Parser$wrap_params_expr(List$map(_t3475, ps), ra, b);
                      const _t3477 = [n, tp, full_3476];
                      _t3473 = _t3477;
                      break _t3474;
                    }
                    _match_fail("line 16629");
                  }
                  return _t3473;
                }
                const expr_bindings_3478 = List$map(_t3471, List$rev(Ref$get(bindings_3436)));
                const _t3479 = ({_hd: ({_tag: 6, _name: "DExpr", _val: ({_tag: 38, _name: "ELetRecAnd", _val: [expr_bindings_3478, rest_3469]})}), _tl: null});
                const _t3470 = _t3479;
                _t3468 = _t3470;
              } else {
                _t3468 = ({_hd: ({_tag: 3, _name: "DLetRecAnd", _val: List$rev(Ref$get(bindings_3436))}), _tl: null});
              }
              const _t3437 = _t3468;
              _t3435 = _t3437;
            } else {
              let _t3480;
              if (is_rec_3361) {
                _t3480 = ({_hd: ({_tag: 2, _name: "DLetRec", _val: [name_3402, type_params_3400, params, ret_annot_3416, constraints_3418, body]}), _tl: null});
              } else {
                _t3480 = ({_hd: ({_tag: 0, _name: "DLet", _val: [name_3402, params, ret_annot_3416, constraints_3418, body]}), _tl: null});
              }
              _t3435 = _t3480;
            }
            _t3427 = _t3435;
          }
          _t3425 = _t3427;
          break _t3426;
        }
        _match_fail("line 16629");
      }
      const _t3423 = _t3425;
      const _t3421 = _t3423;
      const _t3419 = _t3421;
      const _t3417 = _t3419;
      const _t3405 = _t3417;
      const _t3403 = _t3405;
      const _t3401 = _t3403;
      _t3383 = _t3401;
    }
    _t3368 = _t3383;
  }
  const _t3365 = _t3368;
  const _t3362 = _t3365;
  return _t3362;
}
function Parser$parse_class_name(p) {
  let _t3482;
  const _t3481 = Parser$peek_kind(p);
  _t3483: {
    if (_t3481._tag === 9) {
      const s = _t3481._val;
      Parser$advance(p);
      undefined;
      let _t3484;
      if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
        Parser$advance(p);
        undefined;
        let _t3486;
        const _t3485 = Parser$peek_kind(p);
        _t3487: {
          if (_t3485._tag === 9) {
            const s2 = _t3485._val;
            Parser$advance(p);
            undefined;
            _t3486 = (s + ("." + s2));
            break _t3487;
          }
          if (true) {
            _t3486 = Parser$error(p, "expected class name after dot");
            break _t3487;
          }
          _match_fail("line 16629");
        }
        _t3484 = _t3486;
      } else {
        _t3484 = s;
      }
      _t3482 = _t3484;
      break _t3483;
    }
    if (true) {
      _t3482 = Parser$error(p, "expected class name");
      break _t3483;
    }
    _match_fail("line 16629");
  }
  return _t3482;
}
function Parser$parse_class_decl(p) {
  Parser$expect(p, ({_tag: 22, _name: "CLASS"}));
  const class_name_3488 = Parser$expect_uident(p);
  let _t3490;
  if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
    _t3490 = Parser$error(p, "class declarations cannot use qualified names; define the class inside a module instead");
  } else {
    _t3490 = undefined;
  }
  _t3490;
  const tyvars_3491 = Ref$create(null);
  const continue_tyvars_3493 = Ref$create(true);
  let _t3495 = undefined;
  let _t3496 = false, _t3497;
  while (true) {
    if (!(Ref$get(continue_tyvars_3493))) break;
    let _t3499;
    const _t3498 = Parser$peek_kind(p);
    _t3500: {
      if (_t3498._tag === 10) {
        const s = _t3498._val;
        Parser$advance(p);
        undefined;
        _t3499 = Ref$set(tyvars_3491, ({_hd: s, _tl: Ref$get(tyvars_3491)}));
        break _t3500;
      }
      if (true) {
        _t3499 = Ref$set(continue_tyvars_3493, false);
        break _t3500;
      }
      _match_fail("line 16629");
    }
    _t3499;
    if (_t3496) break;
  }
  _t3495 = _t3496 ? _t3497 : undefined;
  _t3495;
  const tyvars_3501 = List$rev(Ref$get(tyvars_3491));
  let _t3503;
  if (_eq(tyvars_3501, null)) {
    _t3503 = Parser$error(p, "expected at least one type variable");
  } else {
    _t3503 = undefined;
  }
  _t3503;
  let _t3504;
  if (_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"}))) {
    Parser$advance(p);
    undefined;
    const deps_3505 = Ref$create(null);
    const continue__3507 = Ref$create(true);
    let _t3509 = undefined;
    let _t3510 = false, _t3511;
    while (true) {
      if (!(Ref$get(continue__3507))) break;
      const from_vars_3512 = Ref$create(null);
      let _t3514 = undefined;
      let _t3515 = false, _t3516;
      while (true) {
        let _t3518;
        const _t3517 = Parser$peek_kind(p);
        _t3519: {
          if (_t3517._tag === 10) {
            _t3518 = true;
            break _t3519;
          }
          if (true) {
            _t3518 = false;
            break _t3519;
          }
          _match_fail("line 16629");
        }
        if (!(_t3518)) break;
        let _t3521;
        const _t3520 = Parser$advance(p).kind;
        _t3522: {
          if (_t3520._tag === 10) {
            const s = _t3520._val;
            let _t3523;
            if ((!List$mem(s, tyvars_3501))) {
              _t3523 = Parser$error(p, (("functional dependency type variable '" + __dict_Show_string.show(s)) + " not in class parameters"));
            } else {
              _t3523 = undefined;
            }
            _t3523;
            _t3521 = Ref$set(from_vars_3512, ({_hd: s, _tl: Ref$get(from_vars_3512)}));
            break _t3522;
          }
          if (true) {
            _t3521 = undefined;
            break _t3522;
          }
          _match_fail("line 16629");
        }
        _t3521;
        if (_t3515) break;
      }
      _t3514 = _t3515 ? _t3516 : undefined;
      _t3514;
      let _t3524;
      if (_eq(Ref$get(from_vars_3512), null)) {
        _t3524 = Parser$error(p, "expected type variable(s) before '->'");
      } else {
        _t3524 = undefined;
      }
      _t3524;
      Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
      const to_vars_3525 = Ref$create(null);
      let _t3527 = undefined;
      let _t3528 = false, _t3529;
      while (true) {
        let _t3531;
        const _t3530 = Parser$peek_kind(p);
        _t3532: {
          if (_t3530._tag === 10) {
            _t3531 = true;
            break _t3532;
          }
          if (true) {
            _t3531 = false;
            break _t3532;
          }
          _match_fail("line 16629");
        }
        if (!(_t3531)) break;
        let _t3534;
        const _t3533 = Parser$advance(p).kind;
        _t3535: {
          if (_t3533._tag === 10) {
            const s = _t3533._val;
            let _t3536;
            if ((!List$mem(s, tyvars_3501))) {
              _t3536 = Parser$error(p, (("functional dependency type variable '" + __dict_Show_string.show(s)) + " not in class parameters"));
            } else {
              _t3536 = undefined;
            }
            _t3536;
            _t3534 = Ref$set(to_vars_3525, ({_hd: s, _tl: Ref$get(to_vars_3525)}));
            break _t3535;
          }
          if (true) {
            _t3534 = undefined;
            break _t3535;
          }
          _match_fail("line 16629");
        }
        _t3534;
        if (_t3528) break;
      }
      _t3527 = _t3528 ? _t3529 : undefined;
      _t3527;
      let _t3537;
      if (_eq(Ref$get(to_vars_3525), null)) {
        _t3537 = Parser$error(p, "expected type variable(s) after '->'");
      } else {
        _t3537 = undefined;
      }
      _t3537;
      Ref$set(deps_3505, ({_hd: [List$rev(Ref$get(from_vars_3512)), List$rev(Ref$get(to_vars_3525))], _tl: Ref$get(deps_3505)}));
      let _t3538;
      if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
        Parser$advance(p);
        _t3538 = undefined;
      } else {
        _t3538 = Ref$set(continue__3507, false);
      }
      const _t3526 = _t3538;
      const _t3513 = _t3526;
      _t3513;
      if (_t3510) break;
    }
    _t3509 = _t3510 ? _t3511 : undefined;
    _t3509;
    const _t3508 = List$rev(Ref$get(deps_3505));
    const _t3506 = _t3508;
    _t3504 = _t3506;
  } else {
    _t3504 = null;
  }
  const fundeps_3539 = _t3504;
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const methods_3541 = Ref$create(null);
  let _t3543 = undefined;
  let _t3544 = false, _t3545;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 47, _name: "END"})))) break;
    let _t3546;
    if (_eq(Parser$peek_kind(p), ({_tag: 52, _name: "LPAREN"}))) {
      Parser$advance(p);
      undefined;
      let _t3548;
      const _t3547 = Parser$peek_kind(p);
      _t3549: {
        if (_t3547._tag === 68) {
          _t3548 = "+";
          break _t3549;
        }
        if (_t3547._tag === 69) {
          _t3548 = "-";
          break _t3549;
        }
        if (_t3547._tag === 70) {
          _t3548 = "*";
          break _t3549;
        }
        if (_t3547._tag === 71) {
          _t3548 = "/";
          break _t3549;
        }
        if (_t3547._tag === 77) {
          _t3548 = "<";
          break _t3549;
        }
        if (_t3547._tag === 78) {
          _t3548 = ">";
          break _t3549;
        }
        if (_t3547._tag === 79) {
          _t3548 = "<=";
          break _t3549;
        }
        if (_t3547._tag === 80) {
          _t3548 = ">=";
          break _t3549;
        }
        if (_t3547._tag === 75) {
          _t3548 = "=";
          break _t3549;
        }
        if (_t3547._tag === 76) {
          _t3548 = "<>";
          break _t3549;
        }
        if (_t3547._tag === 83) {
          _t3548 = "land";
          break _t3549;
        }
        if (_t3547._tag === 84) {
          _t3548 = "lor";
          break _t3549;
        }
        if (_t3547._tag === 85) {
          _t3548 = "lxor";
          break _t3549;
        }
        if (_t3547._tag === 86) {
          _t3548 = "lnot";
          break _t3549;
        }
        if (_t3547._tag === 87) {
          _t3548 = "lsl";
          break _t3549;
        }
        if (_t3547._tag === 88) {
          _t3548 = "lsr";
          break _t3549;
        }
        if (true) {
          _t3548 = Parser$error(p, "expected operator");
          break _t3549;
        }
        _match_fail("line 16629");
      }
      const name_3550 = _t3548;
      Parser$advance(p);
      undefined;
      Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
      const _t3551 = name_3550;
      _t3546 = _t3551;
    } else {
      _t3546 = Parser$expect_ident(p);
    }
    const s_3552 = _t3546;
    Parser$expect(p, ({_tag: 62, _name: "COLON"}));
    const ty_3554 = Parser$parse_ty(p);
    Ref$set(methods_3541, ({_hd: [s_3552, ty_3554], _tl: Ref$get(methods_3541)}));
    let _t3556;
    if (_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"}))) {
      Parser$advance(p);
      _t3556 = undefined;
    } else {
      _t3556 = undefined;
    }
    const _t3555 = _t3556;
    const _t3553 = _t3555;
    _t3553;
    if (_t3544) break;
  }
  _t3543 = _t3544 ? _t3545 : undefined;
  _t3543;
  Parser$expect(p, ({_tag: 47, _name: "END"}));
  let _t3557;
  if (_eq(Ref$get(methods_3541), null)) {
    _t3557 = Parser$error(p, "class must have at least one method");
  } else {
    _t3557 = undefined;
  }
  _t3557;
  const _t3542 = ({_tag: 7, _name: "DClass", _val: [class_name_3488, tyvars_3501, fundeps_3539, List$rev(Ref$get(methods_3541))]});
  const _t3540 = _t3542;
  const _t3502 = _t3540;
  const _t3494 = _t3502;
  const _t3492 = _t3494;
  const _t3489 = _t3492;
  return _t3489;
}
function Parser$parse_instance_decl(p) {
  Parser$expect(p, ({_tag: 23, _name: "INSTANCE"}));
  const class_name_3558 = Parser$parse_class_name(p);
  const inst_tys_3560 = Ref$create(null);
  let _t3562 = undefined;
  let _t3563 = false, _t3564;
  while (true) {
    if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && !_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"}))))) break;
    Ref$set(inst_tys_3560, ({_hd: Parser$parse_ty_atom(p), _tl: Ref$get(inst_tys_3560)}));
    if (_t3563) break;
  }
  _t3562 = _t3563 ? _t3564 : undefined;
  _t3562;
  const inst_tys_3565 = List$rev(Ref$get(inst_tys_3560));
  let _t3567;
  if (_eq(inst_tys_3565, null)) {
    _t3567 = Parser$error(p, "expected at least one instance type");
  } else {
    _t3567 = undefined;
  }
  _t3567;
  const constraints_3568 = Parser$parse_constraints(p);
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const methods_3570 = Ref$create(null);
  let _t3572 = undefined;
  let _t3573 = false, _t3574;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 47, _name: "END"})))) break;
    Parser$expect(p, ({_tag: 11, _name: "LET"}));
    let _t3575;
    if (_eq(Parser$peek_kind(p), ({_tag: 52, _name: "LPAREN"}))) {
      Parser$advance(p);
      undefined;
      let _t3577;
      const _t3576 = Parser$peek_kind(p);
      _t3578: {
        if (_t3576._tag === 68) {
          _t3577 = "+";
          break _t3578;
        }
        if (_t3576._tag === 69) {
          _t3577 = "-";
          break _t3578;
        }
        if (_t3576._tag === 70) {
          _t3577 = "*";
          break _t3578;
        }
        if (_t3576._tag === 71) {
          _t3577 = "/";
          break _t3578;
        }
        if (_t3576._tag === 77) {
          _t3577 = "<";
          break _t3578;
        }
        if (_t3576._tag === 78) {
          _t3577 = ">";
          break _t3578;
        }
        if (_t3576._tag === 79) {
          _t3577 = "<=";
          break _t3578;
        }
        if (_t3576._tag === 80) {
          _t3577 = ">=";
          break _t3578;
        }
        if (_t3576._tag === 75) {
          _t3577 = "=";
          break _t3578;
        }
        if (_t3576._tag === 76) {
          _t3577 = "<>";
          break _t3578;
        }
        if (_t3576._tag === 83) {
          _t3577 = "land";
          break _t3578;
        }
        if (_t3576._tag === 84) {
          _t3577 = "lor";
          break _t3578;
        }
        if (_t3576._tag === 85) {
          _t3577 = "lxor";
          break _t3578;
        }
        if (_t3576._tag === 86) {
          _t3577 = "lnot";
          break _t3578;
        }
        if (_t3576._tag === 87) {
          _t3577 = "lsl";
          break _t3578;
        }
        if (_t3576._tag === 88) {
          _t3577 = "lsr";
          break _t3578;
        }
        if (true) {
          _t3577 = Parser$error(p, "expected operator");
          break _t3578;
        }
        _match_fail("line 16629");
      }
      const name_3579 = _t3577;
      Parser$advance(p);
      undefined;
      Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
      const _t3580 = name_3579;
      _t3575 = _t3580;
    } else {
      _t3575 = Parser$expect_ident(p);
    }
    const method_name_3581 = _t3575;
    const params_3583 = Ref$create(null);
    let _t3585 = undefined;
    let _t3586 = false, _t3587;
    while (true) {
      if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && (!_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"})) && !_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"})))))) break;
      Ref$set(params_3583, ({_hd: Parser$parse_param(p), _tl: Ref$get(params_3583)}));
      if (_t3586) break;
    }
    _t3585 = _t3586 ? _t3587 : undefined;
    _t3585;
    let _t3588;
    if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
      Parser$advance(p);
      undefined;
      _t3588 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
    } else {
      _t3588 = ({_tag: 0, _name: "None"});
    }
    const ret_annot_3589 = _t3588;
    const _constraints_3591 = Parser$parse_constraints(p);
    Parser$expect(p, ({_tag: 75, _name: "EQ"}));
    const body_3593 = Parser$parse_expr(p);
    const fun_params_3595 = List$rev(Ref$get(params_3583));
    function _t3597(body, fp) {
      let _t3599;
      const _t3598 = fp;
      _t3600: {
        if (_t3598._tag === 0) {
          _t3599 = body;
          break _t3600;
        }
        if (_t3598._tag === 1) {
          const name = _t3598._val[0];
          const pat = _t3598._val[1];
          _t3599 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
          break _t3600;
        }
        _match_fail("line 16629");
      }
      return _t3599;
    }
    const body_3601 = List$fold(_t3597, body_3593, fun_params_3595);
    let _t3604;
    const _t3603 = ret_annot_3589;
    _t3605: {
      if (_t3603._tag === 1) {
        const ty = _t3603._val;
        _t3604 = ({_tag: 30, _name: "EAnnot", _val: [body_3601, ty]});
        break _t3605;
      }
      if (_t3603._tag === 0) {
        _t3604 = body_3601;
        break _t3605;
      }
      _match_fail("line 16629");
    }
    const body_3606 = _t3604;
    function _t3608(fp) {
      let _t3610;
      const _t3609 = fp;
      _t3611: {
        if (_t3609._tag === 0) {
          const param = _t3609._val;
          _t3610 = param;
          break _t3611;
        }
        if (_t3609._tag === 1) {
          const name = _t3609._val[0];
          const annot = _t3609._val[2];
          _t3610 = ({annot: annot, is_generated: true, name: name});
          break _t3611;
        }
        _match_fail("line 16629");
      }
      return _t3610;
    }
    const plain_params_3612 = List$map(_t3608, fun_params_3595);
    const _t3613 = Ref$set(methods_3570, ({_hd: [method_name_3581, plain_params_3612, body_3606], _tl: Ref$get(methods_3570)}));
    const _t3607 = _t3613;
    const _t3602 = _t3607;
    const _t3596 = _t3602;
    const _t3594 = _t3596;
    const _t3592 = _t3594;
    const _t3590 = _t3592;
    const _t3584 = _t3590;
    const _t3582 = _t3584;
    _t3582;
    if (_t3573) break;
  }
  _t3572 = _t3573 ? _t3574 : undefined;
  _t3572;
  Parser$expect(p, ({_tag: 47, _name: "END"}));
  let _t3614;
  if (_eq(Ref$get(methods_3570), null)) {
    _t3614 = Parser$error(p, "instance must implement at least one method");
  } else {
    _t3614 = undefined;
  }
  _t3614;
  const _t3571 = ({_tag: 8, _name: "DInstance", _val: [class_name_3558, inst_tys_3565, constraints_3568, List$rev(Ref$get(methods_3570))]});
  const _t3569 = _t3571;
  const _t3566 = _t3569;
  const _t3561 = _t3566;
  const _t3559 = _t3561;
  return _t3559;
}
function Parser$parse_effect_decl(p) {
  Parser$expect(p, ({_tag: 24, _name: "EFFECT"}));
  const name_3615 = Parser$parse_class_name(p);
  const type_params_3617 = Ref$create(null);
  let _t3619 = undefined;
  let _t3620 = false, _t3621;
  while (true) {
    let _t3623;
    const _t3622 = Parser$peek_kind(p);
    _t3624: {
      if (_t3622._tag === 10) {
        _t3623 = true;
        break _t3624;
      }
      if (true) {
        _t3623 = false;
        break _t3624;
      }
      _match_fail("line 16629");
    }
    if (!(_t3623)) break;
    let _t3626;
    const _t3625 = Parser$advance(p).kind;
    _t3627: {
      if (_t3625._tag === 10) {
        const s = _t3625._val;
        _t3626 = Ref$set(type_params_3617, ({_hd: s, _tl: Ref$get(type_params_3617)}));
        break _t3627;
      }
      if (true) {
        _t3626 = undefined;
        break _t3627;
      }
      _match_fail("line 16629");
    }
    _t3626;
    if (_t3620) break;
  }
  _t3619 = _t3620 ? _t3621 : undefined;
  _t3619;
  const type_params_3628 = List$rev(Ref$get(type_params_3617));
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const ops_3630 = Ref$create(null);
  let _t3632 = undefined;
  let _t3633 = false, _t3634;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 47, _name: "END"})))) break;
    const s_3635 = Parser$expect_ident(p);
    Parser$expect(p, ({_tag: 62, _name: "COLON"}));
    const ty_3637 = Parser$parse_ty(p);
    Ref$set(ops_3630, ({_hd: [s_3635, ty_3637], _tl: Ref$get(ops_3630)}));
    let _t3639;
    if (_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"}))) {
      Parser$advance(p);
      _t3639 = undefined;
    } else {
      _t3639 = undefined;
    }
    const _t3638 = _t3639;
    const _t3636 = _t3638;
    _t3636;
    if (_t3633) break;
  }
  _t3632 = _t3633 ? _t3634 : undefined;
  _t3632;
  Parser$expect(p, ({_tag: 47, _name: "END"}));
  let _t3640;
  if (_eq(Ref$get(ops_3630), null)) {
    _t3640 = Parser$error(p, "effect must have at least one operation");
  } else {
    _t3640 = undefined;
  }
  _t3640;
  const _t3631 = ({_tag: 9, _name: "DEffect", _val: [name_3615, type_params_3628, List$rev(Ref$get(ops_3630))]});
  const _t3629 = _t3631;
  const _t3618 = _t3629;
  const _t3616 = _t3618;
  return _t3616;
}
function Parser$parse_extern_decl(p) {
  Parser$expect(p, ({_tag: 25, _name: "EXTERN"}));
  let _t3642;
  const _t3641 = Parser$peek_kind(p);
  _t3643: {
    if (_t3641._tag === 9) {
      const mod_name = _t3641._val;
      Parser$advance(p);
      undefined;
      Parser$expect(p, ({_tag: 63, _name: "DOT"}));
      const field_3644 = Parser$expect_ident(p);
      const _t3645 = (mod_name + ("." + field_3644));
      _t3642 = _t3645;
      break _t3643;
    }
    if (true) {
      _t3642 = Parser$expect_ident(p);
      break _t3643;
    }
    _match_fail("line 16629");
  }
  const name_3646 = _t3642;
  Parser$expect(p, ({_tag: 62, _name: "COLON"}));
  const ty_3648 = Parser$parse_ty(p);
  const _t3649 = ({_tag: 10, _name: "DExtern", _val: [name_3646, ty_3648]});
  const _t3647 = _t3649;
  return _t3647;
}
function Parser$parse_module_body_item(p) {
  let _t3651;
  const _t3650 = Parser$peek_kind(p);
  _t3652: {
    if (_t3650._tag === 45) {
      Parser$advance(p);
      undefined;
      const decls_3653 = Parser$parse_inner_decl(p);
      function _t3655(d) {
        return ({decl: d, vis: ({_tag: 0, _name: "Public"})});
      }
      const _t3654 = List$map(_t3655, decls_3653);
      _t3651 = _t3654;
      break _t3652;
    }
    if (_t3650._tag === 48) {
      Parser$advance(p);
      undefined;
      let _t3656;
      if (_eq(Parser$peek_kind(p), ({_tag: 20, _name: "NEWTYPE"}))) {
        _t3656 = Parser$parse_newtype_decl(p);
      } else {
        _t3656 = Parser$parse_type_decl(p);
      }
      const decl_3657 = _t3656;
      const _t3658 = ({_hd: ({decl: decl_3657, vis: ({_tag: 2, _name: "Opaque"})}), _tl: null});
      _t3651 = _t3658;
      break _t3652;
    }
    if (true) {
      const decls_3659 = Parser$parse_inner_decl(p);
      function _t3661(d) {
        return ({decl: d, vis: ({_tag: 1, _name: "Private"})});
      }
      const _t3660 = List$map(_t3661, decls_3659);
      _t3651 = _t3660;
      break _t3652;
    }
    _match_fail("line 16629");
  }
  return _t3651;
}
function Parser$parse_inner_decl(p) {
  let _t3663;
  const _t3662 = Parser$peek_kind(p);
  _t3664: {
    if (_t3662._tag === 19) {
      _t3663 = ({_hd: Parser$parse_type_decl(p), _tl: null});
      break _t3664;
    }
    if (_t3662._tag === 20) {
      _t3663 = ({_hd: Parser$parse_newtype_decl(p), _tl: null});
      break _t3664;
    }
    if (_t3662._tag === 11) {
      _t3663 = Parser$parse_let_decl(p);
      break _t3664;
    }
    if (_t3662._tag === 22) {
      _t3663 = ({_hd: Parser$parse_class_decl(p), _tl: null});
      break _t3664;
    }
    if (_t3662._tag === 23) {
      _t3663 = ({_hd: Parser$parse_instance_decl(p), _tl: null});
      break _t3664;
    }
    if (_t3662._tag === 24) {
      _t3663 = ({_hd: Parser$parse_effect_decl(p), _tl: null});
      break _t3664;
    }
    if (_t3662._tag === 25) {
      _t3663 = ({_hd: Parser$parse_extern_decl(p), _tl: null});
      break _t3664;
    }
    if (_t3662._tag === 44) {
      _t3663 = ({_hd: Parser$parse_module_decl(p), _tl: null});
      break _t3664;
    }
    if (_t3662._tag === 46) {
      _t3663 = ({_hd: Parser$parse_open_decl(p), _tl: null});
      break _t3664;
    }
    if (true) {
      _t3663 = Parser$error(p, "expected declaration inside module");
      break _t3664;
    }
    _match_fail("line 16629");
  }
  return _t3663;
}
function Parser$parse_module_decl(p) {
  Parser$expect(p, ({_tag: 44, _name: "MODULE"}));
  const name_3665 = Parser$expect_uident(p);
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const items_3667 = Ref$create(null);
  let _t3669 = undefined;
  let _t3670 = false, _t3671;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 47, _name: "END"})))) break;
    const module_items_3672 = Parser$parse_module_body_item(p);
    Ref$set(items_3667, List$rev_append(module_items_3672, Ref$get(items_3667)));
    let _t3674;
    if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "DOUBLE_SEMICOLON"}))) {
      Parser$advance(p);
      _t3674 = undefined;
    } else {
      _t3674 = undefined;
    }
    const _t3673 = _t3674;
    _t3673;
    if (_t3670) break;
  }
  _t3669 = _t3670 ? _t3671 : undefined;
  _t3669;
  Parser$expect(p, ({_tag: 47, _name: "END"}));
  const _t3668 = ({_tag: 11, _name: "DModule", _val: [name_3665, List$rev(Ref$get(items_3667))]});
  const _t3666 = _t3668;
  return _t3666;
}
function Parser$parse_open_decl(p) {
  Parser$expect(p, ({_tag: 46, _name: "OPEN"}));
  const name_3675 = Parser$expect_uident(p);
  let _t3677;
  if (_eq(Parser$peek_kind(p), ({_tag: 52, _name: "LPAREN"}))) {
    Parser$advance(p);
    undefined;
    const names_3678 = Ref$create(null);
    const first_3680 = Ref$create(true);
    let _t3682 = undefined;
    let _t3683 = false, _t3684;
    while (true) {
      if (!(!_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"})))) break;
      let _t3685;
      if ((!Ref$get(first_3680))) {
        _t3685 = Parser$expect(p, ({_tag: 59, _name: "COMMA"}));
      } else {
        _t3685 = undefined;
      }
      _t3685;
      Ref$set(first_3680, false);
      const n_3686 = Parser$expect_ident(p);
      const _t3687 = Ref$set(names_3678, ({_hd: n_3686, _tl: Ref$get(names_3678)}));
      _t3687;
      if (_t3683) break;
    }
    _t3682 = _t3683 ? _t3684 : undefined;
    _t3682;
    Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
    const _t3681 = ({_tag: 12, _name: "DOpen", _val: [name_3675, ({_tag: 1, _name: "Some", _val: List$rev(Ref$get(names_3678))})]});
    const _t3679 = _t3681;
    _t3677 = _t3679;
  } else {
    _t3677 = ({_tag: 12, _name: "DOpen", _val: [name_3675, ({_tag: 0, _name: "None"})]});
  }
  const _t3676 = _t3677;
  return _t3676;
}
function Parser$parse_decl(p) {
  let _t3689;
  const _t3688 = Parser$peek_kind(p);
  _t3690: {
    if (_t3688._tag === 19) {
      _t3689 = ({_hd: Parser$parse_type_decl(p), _tl: null});
      break _t3690;
    }
    if (_t3688._tag === 20) {
      _t3689 = ({_hd: Parser$parse_newtype_decl(p), _tl: null});
      break _t3690;
    }
    if (_t3688._tag === 11) {
      _t3689 = Parser$parse_let_decl(p);
      break _t3690;
    }
    if (_t3688._tag === 22) {
      _t3689 = ({_hd: Parser$parse_class_decl(p), _tl: null});
      break _t3690;
    }
    if (_t3688._tag === 23) {
      _t3689 = ({_hd: Parser$parse_instance_decl(p), _tl: null});
      break _t3690;
    }
    if (_t3688._tag === 24) {
      _t3689 = ({_hd: Parser$parse_effect_decl(p), _tl: null});
      break _t3690;
    }
    if (_t3688._tag === 25) {
      _t3689 = ({_hd: Parser$parse_extern_decl(p), _tl: null});
      break _t3690;
    }
    if (_t3688._tag === 44) {
      _t3689 = ({_hd: Parser$parse_module_decl(p), _tl: null});
      break _t3690;
    }
    if (_t3688._tag === 46) {
      _t3689 = ({_hd: Parser$parse_open_decl(p), _tl: null});
      break _t3690;
    }
    if (true) {
      const expr_3691 = Parser$parse_expr(p);
      const _t3692 = ({_hd: ({_tag: 6, _name: "DExpr", _val: expr_3691}), _tl: null});
      _t3689 = _t3692;
      break _t3690;
    }
    _match_fail("line 16629");
  }
  return _t3689;
}
function Parser$parse_program(tokens) {
  const p_3693 = Parser$create(tokens);
  const decls_3695 = Ref$create(null);
  let _t3697 = undefined;
  let _t3698 = false, _t3699;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p_3693), ({_tag: 91, _name: "EOF"})))) break;
    const ds_3700 = Parser$parse_decl(p_3693);
    Ref$set(decls_3695, List$rev_append(ds_3700, Ref$get(decls_3695)));
    let _t3702;
    if (_eq(Parser$peek_kind(p_3693), ({_tag: 61, _name: "DOUBLE_SEMICOLON"}))) {
      Parser$advance(p_3693);
      _t3702 = undefined;
    } else {
      _t3702 = undefined;
    }
    const _t3701 = _t3702;
    _t3701;
    if (_t3698) break;
  }
  _t3697 = _t3698 ? _t3699 : undefined;
  _t3697;
  const _t3696 = List$rev(Ref$get(decls_3695));
  const _t3694 = _t3696;
  return _t3694;
}
function Parser$parse_expr_string(tokens) {
  const p_3703 = Parser$create(tokens);
  const _t3704 = Parser$parse_expr(p_3703);
  return _t3704;
}
const Typechecker$current_loc = Ref$create(({col: 0, line: 0, offset: 0}));
function Typechecker$error(msg) {
  return _trampoline(function() {
    return _h["type_error"]([msg, Ref$get(Typechecker$current_loc)], function(_t3705) {
      return _bounce(function() {
        return _t3705;
      });
    });
  }, Typechecker$error);
}
function Typechecker$strip_loc(expr) {
  while (true) {
    let _t3707;
    const _t3706 = expr;
    _t3708: {
      if (_t3706._tag === 49) {
        const inner = _t3706._val[1];
        const _t3709 = inner;
        expr = _t3709;
        continue;
        _t3707 = undefined;
        break _t3708;
      }
      if (true) {
        const e = _t3706;
        _t3707 = e;
        break _t3708;
      }
      _match_fail("line 16629");
    }
    return _t3707;
  }
}
function Typechecker$is_constructive(expr) {
  while (true) {
    let _t3711;
    const _t3710 = Typechecker$strip_loc(expr);
    _t3712: {
      if ((((((((_t3710._tag === 0 || _t3710._tag === 1) || _t3710._tag === 2) || _t3710._tag === 3) || _t3710._tag === 4) || _t3710._tag === 5) || _t3710._tag === 6) || _t3710._tag === 21)) {
        _t3711 = true;
        break _t3712;
      }
      if (_t3710._tag === 7) {
        _t3711 = true;
        break _t3712;
      }
      if (_t3710._tag === 10) {
        _t3711 = true;
        break _t3712;
      }
      if (_t3710._tag === 20) {
        const hd = _t3710._val[0];
        const tl = _t3710._val[1];
        _t3711 = (Typechecker$is_constructive(hd) && Typechecker$is_constructive(tl));
        break _t3712;
      }
      if ((((_t3710._tag === 15 || _t3710._tag === 22) || _t3710._tag === 23) || _t3710._tag === 44)) {
        const es = _t3710._val;
        _t3711 = List$forall(Typechecker$is_constructive, es);
        break _t3712;
      }
      if (_t3710._tag === 16) {
        const fields = _t3710._val;
        function _t3713(__p58) {
          let _t3715;
          const _t3714 = __p58;
          _t3716: {
            if (true) {
              const e = _t3714[1];
              _t3715 = Typechecker$is_constructive(e);
              break _t3716;
            }
            _match_fail("line 16629");
          }
          return _t3715;
        }
        _t3711 = List$forall(_t3713, fields);
        break _t3712;
      }
      if ((_t3710._tag === 24 && _t3710._val[1]._tag === 0 || _t3710._tag === 46 && _t3710._val[1]._tag === 0)) {
        _t3711 = true;
        break _t3712;
      }
      if ((_t3710._tag === 24 && _t3710._val[1]._tag === 1 || _t3710._tag === 46 && _t3710._val[1]._tag === 1)) {
        const e = _t3710._val[1]._val;
        const _t3717 = e;
        expr = _t3717;
        continue;
        _t3711 = undefined;
        break _t3712;
      }
      if (_t3710._tag === 30) {
        const e = _t3710._val[0];
        const _t3718 = e;
        expr = _t3718;
        continue;
        _t3711 = undefined;
        break _t3712;
      }
      if (_t3710._tag === 8) {
        const e1 = _t3710._val[1];
        const e2 = _t3710._val[2];
        _t3711 = (Typechecker$is_constructive(e1) && Typechecker$is_constructive(e2));
        break _t3712;
      }
      if (_t3710._tag === 42) {
        const entries = _t3710._val;
        function _t3719(__p59) {
          let _t3721;
          const _t3720 = __p59;
          _t3722: {
            if (true) {
              const k = _t3720[0];
              const v = _t3720[1];
              _t3721 = (Typechecker$is_constructive(k) && Typechecker$is_constructive(v));
              break _t3722;
            }
            _match_fail("line 16629");
          }
          return _t3721;
        }
        _t3711 = List$forall(_t3719, entries);
        break _t3712;
      }
      if (_t3710._tag === 43) {
        const entries = _t3710._val[1];
        function _t3723(__p60) {
          let _t3725;
          const _t3724 = __p60;
          _t3726: {
            if (true) {
              const k = _t3724[0];
              const v = _t3724[1];
              _t3725 = (Typechecker$is_constructive(k) && Typechecker$is_constructive(v));
              break _t3726;
            }
            _match_fail("line 16629");
          }
          return _t3725;
        }
        _t3711 = List$forall(_t3723, entries);
        break _t3712;
      }
      if (_t3710._tag === 45) {
        const entries = _t3710._val[1];
        _t3711 = List$forall(Typechecker$is_constructive, entries);
        break _t3712;
      }
      if (_t3710._tag === 17) {
        const base = _t3710._val[0];
        const fields = _t3710._val[1];
        let _t3731;
        if (Typechecker$is_constructive(base)) {
        function _t3727(__p61) {
          let _t3729;
          const _t3728 = __p61;
          _t3730: {
            if (true) {
              const e = _t3728[1];
              _t3729 = Typechecker$is_constructive(e);
              break _t3730;
            }
            _match_fail("line 16629");
          }
          return _t3729;
        }
          _t3731 = List$forall(_t3727, fields);
        } else {
          _t3731 = false;
        }
        _t3711 = _t3731;
        break _t3712;
      }
      if (true) {
        _t3711 = false;
        break _t3712;
      }
      _match_fail("line 16629");
    }
    return _t3711;
  }
}
function Typechecker$is_immediately_linked(name, expr) {
  let _t3733;
  const _t3732 = Typechecker$strip_loc(expr);
  _t3734: {
    if (_t3732._tag === 7) {
      const n = _t3732._val;
      _t3733 = (n === name);
      break _t3734;
    }
    if (_t3732._tag === 30) {
      const e = _t3732._val[0];
      let _t3736;
      const _t3735 = Typechecker$strip_loc(e);
      _t3737: {
        if (_t3735._tag === 7) {
          const n = _t3735._val;
          _t3736 = (n === name);
          break _t3737;
        }
        if (true) {
          _t3736 = false;
          break _t3737;
        }
        _match_fail("line 16629");
      }
      _t3733 = _t3736;
      break _t3734;
    }
    if (true) {
      _t3733 = false;
      break _t3734;
    }
    _match_fail("line 16629");
  }
  return _t3733;
}
function Typechecker$try_unify(t1, t2) {
  const _t3738 = (function() {
    const _t3739 = _h;
    _h = Object.assign({}, _t3739, {
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const __x_3740 = Types$unify(t1, t2);
      return __x_3740;
    } catch (_exc) {
      if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return Typechecker$error(msg);
      } else { throw _exc; }
    } finally { _h = _t3739; }
  })();
  return _t3738;
}
function Typechecker$try_unify_eff(e1, e2) {
  const _t3741 = (function() {
    const _t3742 = _h;
    _h = Object.assign({}, _t3742, {
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const __x_3743 = Types$unify_eff(e1, e2);
      return __x_3743;
    } catch (_exc) {
      if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return Typechecker$error(msg);
      } else { throw _exc; }
    } finally { _h = _t3742; }
  })();
  return _t3741;
}
function Typechecker$try_subeffect(source, target) {
  const _t3744 = (function() {
    const _t3745 = _h;
    _h = Object.assign({}, _t3745, {
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const __x_3746 = Types$subeffect(source, target);
      return __x_3746;
    } catch (_exc) {
      if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return Typechecker$error(msg);
      } else { throw _exc; }
    } finally { _h = _t3745; }
  })();
  return _t3744;
}
function Typechecker$max_tgen_in_ty(__x) {
  while (true) {
    let _t3748;
    const _t3747 = __x;
    _t3749: {
      if (_t3747._tag === 16) {
        const i = _t3747._val;
        _t3748 = i;
        break _t3749;
      }
      if ((_t3747._tag === 7 || _t3747._tag === 8)) {
        const a = _t3747._val[0];
        const b = _t3747._val[2];
        _t3748 = max(Typechecker$max_tgen_in_ty(a), Typechecker$max_tgen_in_ty(b));
        break _t3749;
      }
      if (_t3747._tag === 9) {
        const ts = _t3747._val;
        function _t3750(acc, t) {
          return max(acc, Typechecker$max_tgen_in_ty(t));
        }
        _t3748 = List$fold(_t3750, (-1), ts);
        break _t3749;
      }
      if (_t3747._tag === 10) {
        const t = _t3747._val;
        const _t3751 = t;
        __x = _t3751;
        continue;
        _t3748 = undefined;
        break _t3749;
      }
      if (_t3747._tag === 11) {
        const row = _t3747._val;
        _t3748 = Typechecker$max_tgen_in_rrow(row);
        break _t3749;
      }
      if (_t3747._tag === 12) {
        const args = _t3747._val[1];
        function _t3752(acc, t) {
          return max(acc, Typechecker$max_tgen_in_ty(t));
        }
        _t3748 = List$fold(_t3752, (-1), args);
        break _t3749;
      }
      if (_t3747._tag === 13) {
        const t = _t3747._val;
        const _t3753 = t;
        __x = _t3753;
        continue;
        _t3748 = undefined;
        break _t3749;
      }
      if (true) {
        _t3748 = (-1);
        break _t3749;
      }
      _match_fail("line 16629");
    }
    return _t3748;
  }
}
function Typechecker$max_tgen_in_rrow(__x) {
  let _t3755;
  const _t3754 = __x;
  _t3756: {
    if (_t3754._tag === 0) {
      const ty = _t3754._val[1];
      const tail = _t3754._val[2];
      _t3755 = max(Typechecker$max_tgen_in_ty(ty), Typechecker$max_tgen_in_rrow(tail));
      break _t3756;
    }
    if (_t3754._tag === 3) {
      _t3755 = (-1);
      break _t3756;
    }
    if (true) {
      _t3755 = (-1);
      break _t3756;
    }
    _match_fail("line 16629");
  }
  return _t3755;
}
function Typechecker$max_effgen_in_eff(__x) {
  let _t3758;
  const _t3757 = __x;
  _t3759: {
    if (_t3757._tag === 3) {
      const i = _t3757._val;
      _t3758 = i;
      break _t3759;
    }
    if (_t3757._tag === 2) {
      const params = _t3757._val[1];
      const tail = _t3757._val[2];
      function _t3760(acc, t) {
        return max(acc, Typechecker$max_tgen_in_ty(t));
      }
      const ty_max_3761 = List$fold(_t3760, (-1), params);
      const _t3762 = max(ty_max_3761, Typechecker$max_effgen_in_eff(tail));
      _t3758 = _t3762;
      break _t3759;
    }
    if (true) {
      _t3758 = (-1);
      break _t3759;
    }
    _match_fail("line 16629");
  }
  return _t3758;
}
function Typechecker$max_effgen_in_ty(__x) {
  let _t3764;
  const _t3763 = __x;
  _t3765: {
    if ((_t3763._tag === 7 || _t3763._tag === 8)) {
      const a = _t3763._val[0];
      const eff = _t3763._val[1];
      const b = _t3763._val[2];
      _t3764 = max(max(Typechecker$max_tgen_in_ty(a), Typechecker$max_tgen_in_ty(b)), Typechecker$max_effgen_in_eff(eff));
      break _t3765;
    }
    if (true) {
      _t3764 = (-1);
      break _t3765;
    }
    _match_fail("line 16629");
  }
  return _t3764;
}
function Typechecker$lookup_var(ctx, level, name) {
  let _t3767;
  const _t3766 = List$assoc_opt(name, ctx.vars);
  _t3768: {
    if (_t3766._tag === 1) {
      const scheme = _t3766._val;
      _t3767 = Types$instantiate(level, scheme);
      break _t3768;
    }
    if (_t3766._tag === 0) {
      let _t3770;
      const _t3769 = String$rindex_opt(name, 46);
      _t3771: {
        if (_t3769._tag === 1) {
          const i = _t3769._val;
          const class_prefix_3772 = String$sub(name, 0, i);
          const method_name_3774 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
          function _t3776(cls) {
            let _t3781;
            if ((cls.class_name === class_prefix_3772)) {
            function _t3777(__p62) {
              let _t3779;
              const _t3778 = __p62;
              _t3780: {
                if (true) {
                  const m = _t3778[0];
                  _t3779 = (m === method_name_3774);
                  break _t3780;
                }
                _match_fail("line 16629");
              }
              return _t3779;
            }
              _t3781 = List$exists(_t3777, cls.class_methods);
            } else {
              _t3781 = false;
            }
            return _t3781;
          }
          let _t3783;
          const _t3782 = List$find(_t3776, ctx.type_env.classes);
          _t3784: {
            if (_t3782._tag === 1) {
              const class_def = _t3782._val;
              const method_ty_3785 = List$assoc(method_name_3774, class_def.class_methods);
              const num_class_params_3787 = List$length(class_def.class_params);
              const max_gen_3789 = Typechecker$max_tgen_in_ty(method_ty_3785);
              const quant_3791 = max((max_gen_3789 + 1), num_class_params_3787);
              const max_effgen_3793 = Typechecker$max_effgen_in_ty(method_ty_3785);
              let _t3795;
              if ((max_effgen_3793 >= 0)) {
                _t3795 = (max_effgen_3793 + 1);
              } else {
                _t3795 = 0;
              }
              const equant_3796 = _t3795;
              const scheme_3798 = ({body: method_ty_3785, constraints: null, equant: equant_3796, pvquant: 0, quant: quant_3791, record_evidences: null, rquant: 0});
              const _t3799 = Types$instantiate(level, scheme_3798);
              const _t3797 = _t3799;
              const _t3794 = _t3797;
              const _t3792 = _t3794;
              const _t3790 = _t3792;
              const _t3788 = _t3790;
              const _t3786 = _t3788;
              _t3783 = _t3786;
              break _t3784;
            }
            if (_t3782._tag === 0) {
              _t3783 = Typechecker$error(("unbound variable: " + __dict_Show_string.show(name)));
              break _t3784;
            }
            _match_fail("line 16629");
          }
          const _t3775 = _t3783;
          const _t3773 = _t3775;
          _t3770 = _t3773;
          break _t3771;
        }
        if (_t3769._tag === 0) {
          _t3770 = Typechecker$error(("unbound variable: " + __dict_Show_string.show(name)));
          break _t3771;
        }
        _match_fail("line 16629");
      }
      _t3767 = _t3770;
      break _t3768;
    }
    _match_fail("line 16629");
  }
  return _t3767;
}
function Typechecker$extend_var(ctx, name, scheme) {
  const __rec_upd_3800 = ctx;
  function _t3802(n) {
    return (n !== name);
  }
  const _t3801 = ({constraint_tvars: __rec_upd_3800.constraint_tvars, current_eff: __rec_upd_3800.current_eff, current_module: __rec_upd_3800.current_module, inside_handler: __rec_upd_3800.inside_handler, loop_info: __rec_upd_3800.loop_info, mutable_vars: List$filter(_t3802, ctx.mutable_vars), return_type: __rec_upd_3800.return_type, return_used: __rec_upd_3800.return_used, type_env: __rec_upd_3800.type_env, vars: ({_hd: [name, scheme], _tl: ctx.vars})});
  return _t3801;
}
function Typechecker$extend_var_mono(ctx, name, ty) {
  return Typechecker$extend_var(ctx, name, Types$mono(ty));
}
function Typechecker$extend_var_mutable(ctx, name, scheme) {
  const __rec_upd_3803 = ctx;
  function _t3805(n) {
    return (n !== name);
  }
  const _t3804 = ({constraint_tvars: __rec_upd_3803.constraint_tvars, current_eff: __rec_upd_3803.current_eff, current_module: __rec_upd_3803.current_module, inside_handler: __rec_upd_3803.inside_handler, loop_info: __rec_upd_3803.loop_info, mutable_vars: ({_hd: name, _tl: List$filter(_t3805, ctx.mutable_vars)}), return_type: __rec_upd_3803.return_type, return_used: __rec_upd_3803.return_used, type_env: __rec_upd_3803.type_env, vars: ({_hd: [name, scheme], _tl: ctx.vars})});
  return _t3804;
}
function Typechecker$resolve_type_alias(type_env, name) {
  let _t3807;
  const _t3806 = List$assoc_opt(name, type_env.type_aliases);
  _t3808: {
    if (_t3806._tag === 1) {
      const canonical = _t3806._val;
      _t3807 = canonical;
      break _t3808;
    }
    if (_t3806._tag === 0) {
      _t3807 = name;
      break _t3808;
    }
    _match_fail("line 16629");
  }
  return _t3807;
}
function Typechecker$find_variant_info(type_env, name) {
  const name_3809 = Typechecker$resolve_type_alias(type_env, name);
  function _t3811(__p63) {
    let _t3813;
    const _t3812 = __p63;
    _t3814: {
      if (true) {
        const n = _t3812[0];
        _t3813 = (n === name_3809);
        break _t3814;
      }
      _match_fail("line 16629");
    }
    return _t3813;
  }
  const _t3810 = List$find(_t3811, type_env.variants);
  return _t3810;
}
function Typechecker$subst_tgens(inst_tys, ty) {
  const arr_3815 = Array$of_list(inst_tys);
  function go(__x) {
    let _t3818;
    const _t3817 = __x;
    _t3819: {
      if (_t3817._tag === 16) {
        const i = _t3817._val;
        if ((i < Array$length(arr_3815))) {
          _t3818 = Array$get(arr_3815, i);
          break _t3819;
        }
      }
      if (_t3817._tag === 7) {
        const a = _t3817._val[0];
        const eff = _t3817._val[1];
        const b = _t3817._val[2];
        _t3818 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(b)]});
        break _t3819;
      }
      if (_t3817._tag === 8) {
        const a = _t3817._val[0];
        const eff = _t3817._val[1];
        const b = _t3817._val[2];
        _t3818 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(b)]});
        break _t3819;
      }
      if (_t3817._tag === 9) {
        const ts = _t3817._val;
        _t3818 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
        break _t3819;
      }
      if (_t3817._tag === 10) {
        const t = _t3817._val;
        _t3818 = ({_tag: 10, _name: "TList", _val: go(t)});
        break _t3819;
      }
      if (_t3817._tag === 13) {
        const t = _t3817._val;
        _t3818 = ({_tag: 13, _name: "TArray", _val: go(t)});
        break _t3819;
      }
      if (_t3817._tag === 11) {
        const row = _t3817._val;
        _t3818 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
        break _t3819;
      }
      if (_t3817._tag === 12) {
        const name = _t3817._val[0];
        const args = _t3817._val[1];
        _t3818 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
        break _t3819;
      }
      if (_t3817._tag === 14) {
        const row = _t3817._val;
        _t3818 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
        break _t3819;
      }
      if (true) {
        const t = _t3817;
        _t3818 = t;
        break _t3819;
      }
      _match_fail("line 16629");
    }
    return _t3818;
  }
  function go_eff(__x) {
    let _t3821;
    const _t3820 = __x;
    _t3822: {
      if (_t3820._tag === 2) {
        const label = _t3820._val[0];
        const params = _t3820._val[1];
        const tail = _t3820._val[2];
        _t3821 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
        break _t3822;
      }
      if (true) {
        const e = _t3820;
        _t3821 = e;
        break _t3822;
      }
      _match_fail("line 16629");
    }
    return _t3821;
  }
  function go_pv(__x) {
    let _t3824;
    const _t3823 = __x;
    _t3825: {
      if (_t3823._tag === 0) {
        const tag = _t3823._val[0];
        const ty_opt = _t3823._val[1];
        const tail = _t3823._val[2];
        _t3824 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
        break _t3825;
      }
      if (true) {
        const r = _t3823;
        _t3824 = r;
        break _t3825;
      }
      _match_fail("line 16629");
    }
    return _t3824;
  }
  function go_rrow(__x) {
    let _t3827;
    const _t3826 = __x;
    _t3828: {
      if (_t3826._tag === 0) {
        const name = _t3826._val[0];
        const ty = _t3826._val[1];
        const tail = _t3826._val[2];
        _t3827 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
        break _t3828;
      }
      if (true) {
        const r = _t3826;
        _t3827 = r;
        break _t3828;
      }
      _match_fail("line 16629");
    }
    return _t3827;
  }
  const _t3829 = go(ty);
  const _t3816 = _t3829;
  return _t3816;
}
function Typechecker$freshen_arrow_effects(level, ty) {
  function go(__x) {
    let _t3831;
    const _t3830 = __x;
    _t3832: {
      if (_t3830._tag === 7) {
        const a = _t3830._val[0];
        const eff = _t3830._val[1];
        const b = _t3830._val[2];
        let _t3834;
        const _t3833 = eff;
        _t3835: {
          if (_t3833._tag === 1) {
            _t3834 = Types$new_effvar(level);
            break _t3835;
          }
          if (true) {
            const e = _t3833;
            _t3834 = e;
            break _t3835;
          }
          _match_fail("line 16629");
        }
        const eff$p_3836 = _t3834;
        const _t3837 = ({_tag: 7, _name: "TArrow", _val: [go(a), eff$p_3836, go(b)]});
        _t3831 = _t3837;
        break _t3832;
      }
      if (_t3830._tag === 8) {
        const a = _t3830._val[0];
        const eff = _t3830._val[1];
        const b = _t3830._val[2];
        let _t3839;
        const _t3838 = eff;
        _t3840: {
          if (_t3838._tag === 1) {
            _t3839 = Types$new_effvar(level);
            break _t3840;
          }
          if (true) {
            const e = _t3838;
            _t3839 = e;
            break _t3840;
          }
          _match_fail("line 16629");
        }
        const eff$p_3841 = _t3839;
        const _t3842 = ({_tag: 8, _name: "TCont", _val: [go(a), eff$p_3841, go(b)]});
        _t3831 = _t3842;
        break _t3832;
      }
      if (_t3830._tag === 9) {
        const ts = _t3830._val;
        _t3831 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
        break _t3832;
      }
      if (_t3830._tag === 10) {
        const t = _t3830._val;
        _t3831 = ({_tag: 10, _name: "TList", _val: go(t)});
        break _t3832;
      }
      if (_t3830._tag === 13) {
        const t = _t3830._val;
        _t3831 = ({_tag: 13, _name: "TArray", _val: go(t)});
        break _t3832;
      }
      if (_t3830._tag === 11) {
        const row = _t3830._val;
        _t3831 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
        break _t3832;
      }
      if (_t3830._tag === 12) {
        const name = _t3830._val[0];
        const args = _t3830._val[1];
        _t3831 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
        break _t3832;
      }
      if (_t3830._tag === 14) {
        const row = _t3830._val;
        _t3831 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
        break _t3832;
      }
      if (true) {
        const t = _t3830;
        _t3831 = t;
        break _t3832;
      }
      _match_fail("line 16629");
    }
    return _t3831;
  }
  function go_pv(__x) {
    let _t3844;
    const _t3843 = __x;
    _t3845: {
      if (_t3843._tag === 0) {
        const tag = _t3843._val[0];
        const ty_opt = _t3843._val[1];
        const tail = _t3843._val[2];
        _t3844 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
        break _t3845;
      }
      if (true) {
        const r = _t3843;
        _t3844 = r;
        break _t3845;
      }
      _match_fail("line 16629");
    }
    return _t3844;
  }
  function go_rrow(__x) {
    let _t3847;
    const _t3846 = __x;
    _t3848: {
      if (_t3846._tag === 0) {
        const name = _t3846._val[0];
        const ty = _t3846._val[1];
        const tail = _t3846._val[2];
        _t3847 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
        break _t3848;
      }
      if (true) {
        const r = _t3846;
        _t3847 = r;
        break _t3848;
      }
      _match_fail("line 16629");
    }
    return _t3847;
  }
  const _t3849 = go(ty);
  return _t3849;
}
function Typechecker$freshen_tvars(level, ty) {
  const mapping_3850 = Hashtbl$create(4);
  function go(__x) {
    while (true) {
      let _t3853;
      const _t3852 = __x;
      _t3854: {
        if (_t3852._tag === 15 && _t3852._val.contents._tag === 0) {
          const id = _t3852._val.contents._val[0];
          let _t3856;
          const _t3855 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, mapping_3850, id]);
          _t3857: {
            if (_t3855._tag === 1) {
              const fresh = _t3855._val;
              _t3856 = fresh;
              break _t3857;
            }
            if (_t3855._tag === 0) {
              const fresh_3858 = Types$new_tvar(level);
              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, mapping_3850, id, fresh_3858]);
              const _t3859 = fresh_3858;
              _t3856 = _t3859;
              break _t3857;
            }
            _match_fail("line 16629");
          }
          _t3853 = _t3856;
          break _t3854;
        }
        if (_t3852._tag === 15 && _t3852._val.contents._tag === 1) {
          const t = _t3852._val.contents._val;
          const _t3860 = t;
          __x = _t3860;
          continue;
          _t3853 = undefined;
          break _t3854;
        }
        if (_t3852._tag === 7) {
          const a = _t3852._val[0];
          const eff = _t3852._val[1];
          const b = _t3852._val[2];
          _t3853 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(b)]});
          break _t3854;
        }
        if (_t3852._tag === 8) {
          const a = _t3852._val[0];
          const eff = _t3852._val[1];
          const b = _t3852._val[2];
          _t3853 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(b)]});
          break _t3854;
        }
        if (_t3852._tag === 9) {
          const ts = _t3852._val;
          _t3853 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t3854;
        }
        if (_t3852._tag === 10) {
          const t = _t3852._val;
          _t3853 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t3854;
        }
        if (_t3852._tag === 13) {
          const t = _t3852._val;
          _t3853 = ({_tag: 13, _name: "TArray", _val: go(t)});
          break _t3854;
        }
        if (_t3852._tag === 11) {
          const row = _t3852._val;
          _t3853 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
          break _t3854;
        }
        if (_t3852._tag === 12) {
          const name = _t3852._val[0];
          const args = _t3852._val[1];
          _t3853 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
          break _t3854;
        }
        if (_t3852._tag === 14) {
          const row = _t3852._val;
          _t3853 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
          break _t3854;
        }
        if (true) {
          const t = _t3852;
          _t3853 = t;
          break _t3854;
        }
        _match_fail("line 16629");
      }
      return _t3853;
    }
  }
  function go_eff(__x) {
    while (true) {
      let _t3862;
      const _t3861 = __x;
      _t3863: {
        if (_t3861._tag === 0 && _t3861._val.contents._tag === 0) {
          const e = _t3861;
          _t3862 = e;
          break _t3863;
        }
        if (_t3861._tag === 0 && _t3861._val.contents._tag === 1) {
          const e = _t3861._val.contents._val;
          const _t3864 = e;
          __x = _t3864;
          continue;
          _t3862 = undefined;
          break _t3863;
        }
        if (_t3861._tag === 2) {
          const label = _t3861._val[0];
          const params = _t3861._val[1];
          const tail = _t3861._val[2];
          _t3862 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
          break _t3863;
        }
        if (true) {
          const e = _t3861;
          _t3862 = e;
          break _t3863;
        }
        _match_fail("line 16629");
      }
      return _t3862;
    }
  }
  function go_pv(__x) {
    let _t3866;
    const _t3865 = __x;
    _t3867: {
      if (_t3865._tag === 0) {
        const tag = _t3865._val[0];
        const ty_opt = _t3865._val[1];
        const tail = _t3865._val[2];
        _t3866 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
        break _t3867;
      }
      if (true) {
        const r = _t3865;
        _t3866 = r;
        break _t3867;
      }
      _match_fail("line 16629");
    }
    return _t3866;
  }
  function go_rrow(__x) {
    while (true) {
      let _t3869;
      const _t3868 = __x;
      _t3870: {
        if (_t3868._tag === 0) {
          const name = _t3868._val[0];
          const ty = _t3868._val[1];
          const tail = _t3868._val[2];
          _t3869 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
          break _t3870;
        }
        if (_t3868._tag === 1 && _t3868._val.contents._tag === 0) {
          _t3869 = Types$new_rvar(level);
          break _t3870;
        }
        if (_t3868._tag === 1 && _t3868._val.contents._tag === 1) {
          const r = _t3868._val.contents._val;
          const _t3871 = r;
          __x = _t3871;
          continue;
          _t3869 = undefined;
          break _t3870;
        }
        if (true) {
          const r = _t3868;
          _t3869 = r;
          break _t3870;
        }
        _match_fail("line 16629");
      }
      return _t3869;
    }
  }
  const _t3872 = go(ty);
  const _t3851 = _t3872;
  return _t3851;
}
function Typechecker$resolve_ty_annot_shared(ctx, level, tvars, annot) {
  function go(__x) {
    while (true) {
      let _t3874;
      const _t3873 = __x;
      _t3875: {
        if (_t3873._tag === 1) {
          const name = _t3873._val;
          let _t3877;
          const _t3876 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars, name]);
          _t3878: {
            if (_t3876._tag === 1) {
              const tv = _t3876._val;
              _t3877 = tv;
              break _t3878;
            }
            if (_t3876._tag === 0) {
              const tv_3879 = Types$new_tvar(level);
              _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars, name, tv_3879]);
              const _t3880 = tv_3879;
              _t3877 = _t3880;
              break _t3878;
            }
            _match_fail("line 16629");
          }
          _t3874 = _t3877;
          break _t3875;
        }
        if (_t3873._tag === 0 && _t3873._val === "int") {
          _t3874 = ({_tag: 0, _name: "TInt"});
          break _t3875;
        }
        if (_t3873._tag === 0 && _t3873._val === "float") {
          _t3874 = ({_tag: 1, _name: "TFloat"});
          break _t3875;
        }
        if (_t3873._tag === 0 && _t3873._val === "bool") {
          _t3874 = ({_tag: 2, _name: "TBool"});
          break _t3875;
        }
        if (_t3873._tag === 0 && _t3873._val === "string") {
          _t3874 = ({_tag: 3, _name: "TString"});
          break _t3875;
        }
        if (_t3873._tag === 0 && _t3873._val === "byte") {
          _t3874 = ({_tag: 4, _name: "TByte"});
          break _t3875;
        }
        if (_t3873._tag === 0 && _t3873._val === "rune") {
          _t3874 = ({_tag: 5, _name: "TRune"});
          break _t3875;
        }
        if (_t3873._tag === 0 && _t3873._val === "unit") {
          _t3874 = ({_tag: 6, _name: "TUnit"});
          break _t3875;
        }
        if (_t3873._tag === 0) {
          const name = _t3873._val;
          const canonical_3881 = Typechecker$resolve_type_alias(ctx.type_env, name);
          let _t3883;
          if (List$mem(canonical_3881, ctx.type_env.hidden_types)) {
            _t3883 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
          } else {
            _t3883 = undefined;
          }
          _t3883;
          function _t3884(__p64) {
            let _t3886;
            const _t3885 = __p64;
            _t3887: {
              if (true) {
                const n = _t3885[0];
                _t3886 = (n === canonical_3881);
                break _t3887;
              }
              _match_fail("line 16629");
            }
            return _t3886;
          }
          let _t3889;
          const _t3888 = List$find(_t3884, ctx.type_env.type_synonyms);
          _t3890: {
            if (_t3888._tag === 1 && _t3888._val[1] === 0) {
              const ty = _t3888._val[2];
              _t3889 = Typechecker$freshen_tvars(level, Typechecker$freshen_arrow_effects(level, ty));
              break _t3890;
            }
            if (_t3888._tag === 1) {
              const n = _t3888._val[1];
              _t3889 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
              break _t3890;
            }
            if (_t3888._tag === 0) {
              let _t3892;
              const _t3891 = Typechecker$find_variant_info(ctx.type_env, name);
              _t3893: {
                if (_t3891._tag === 1 && _t3891._val[1] === 0) {
                  _t3892 = ({_tag: 12, _name: "TVariant", _val: [canonical_3881, null]});
                  break _t3893;
                }
                if (_t3891._tag === 1) {
                  const n = _t3891._val[1];
                  _t3892 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                  break _t3893;
                }
                if (_t3891._tag === 0) {
                  let _t3894;
                  if (!_eq(List$assoc_opt(canonical_3881, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                    const fields_3895 = List$assoc(canonical_3881, ctx.type_env.records);
                    let _t3897;
                    if (_eq(fields_3895, null)) {
                      _t3897 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                    } else {
                      _t3897 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_3895)});
                    }
                    const _t3896 = _t3897;
                    _t3894 = _t3896;
                  } else {
                    _t3894 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                  }
                  _t3892 = _t3894;
                  break _t3893;
                }
                _match_fail("line 16629");
              }
              _t3889 = _t3892;
              break _t3890;
            }
            _match_fail("line 16629");
          }
          const _t3882 = _t3889;
          _t3874 = _t3882;
          break _t3875;
        }
        if (_t3873._tag === 2) {
          const a = _t3873._val[0];
          const b = _t3873._val[1];
          const eff_opt = _t3873._val[2];
          let _t3899;
          const _t3898 = eff_opt;
          _t3900: {
            if (_t3898._tag === 0) {
              _t3899 = Types$new_effvar(level);
              break _t3900;
            }
            if (_t3898._tag === 1 && _t3898._val._tag === 0) {
              _t3899 = ({_tag: 1, _name: "EffEmpty"});
              break _t3900;
            }
            if (_t3898._tag === 1 && _t3898._val._tag === 1) {
              const items = _t3898._val._val;
              _t3899 = Typechecker$resolve_eff_items(ctx, level, tvars, items);
              break _t3900;
            }
            _match_fail("line 16629");
          }
          const eff_3901 = _t3899;
          const _t3902 = ({_tag: 7, _name: "TArrow", _val: [go(a), eff_3901, go(b)]});
          _t3874 = _t3902;
          break _t3875;
        }
        if (_t3873._tag === 6) {
          const ts = _t3873._val;
          _t3874 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t3875;
        }
        if (_t3873._tag === 4) {
          const t = _t3873._val;
          _t3874 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t3875;
        }
        if (_t3873._tag === 5) {
          const t = _t3873._val;
          _t3874 = ({_tag: 13, _name: "TArray", _val: go(t)});
          break _t3875;
        }
        if (_t3873._tag === 7) {
          const args = _t3873._val[0];
          const name = _t3873._val[1];
          const canonical_3903 = Typechecker$resolve_type_alias(ctx.type_env, name);
          let _t3905;
          if (List$mem(canonical_3903, ctx.type_env.hidden_types)) {
            _t3905 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
          } else {
            _t3905 = undefined;
          }
          _t3905;
          const arg_tys_3906 = List$map(go, args);
          function _t3908(__p65) {
            let _t3910;
            const _t3909 = __p65;
            _t3911: {
              if (true) {
                const n = _t3909[0];
                _t3910 = (n === canonical_3903);
                break _t3911;
              }
              _match_fail("line 16629");
            }
            return _t3910;
          }
          let _t3913;
          const _t3912 = List$find(_t3908, ctx.type_env.type_synonyms);
          _t3914: {
            if (_t3912._tag === 1) {
              const np = _t3912._val[1];
              const ty = _t3912._val[2];
              let _t3915;
              if ((List$length(arg_tys_3906) !== np)) {
                _t3915 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_3906))));
              } else {
                _t3915 = undefined;
              }
              _t3915;
              _t3913 = Typechecker$freshen_tvars(level, Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(arg_tys_3906, ty)));
              break _t3914;
            }
            if (_t3912._tag === 0) {
              let _t3917;
              const _t3916 = Typechecker$find_variant_info(ctx.type_env, name);
              _t3918: {
                if (_t3916._tag === 1) {
                  const np = _t3916._val[1];
                  let _t3919;
                  if ((List$length(arg_tys_3906) !== np)) {
                    _t3919 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_3906))));
                  } else {
                    _t3919 = undefined;
                  }
                  _t3919;
                  _t3917 = ({_tag: 12, _name: "TVariant", _val: [canonical_3903, arg_tys_3906]});
                  break _t3918;
                }
                if (_t3916._tag === 0) {
                  _t3917 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
                  break _t3918;
                }
                _match_fail("line 16629");
              }
              _t3913 = _t3917;
              break _t3914;
            }
            _match_fail("line 16629");
          }
          const _t3907 = _t3913;
          const _t3904 = _t3907;
          _t3874 = _t3904;
          break _t3875;
        }
        if (_t3873._tag === 3) {
          const fields = _t3873._val[0];
          const is_open = _t3873._val[1];
          function _t3920(__p66) {
            let _t3922;
            const _t3921 = __p66;
            _t3923: {
              if (true) {
                const n = _t3921[0];
                const t = _t3921[1];
                _t3922 = [n, go(t)];
                break _t3923;
              }
              _match_fail("line 16629");
            }
            return _t3922;
          }
          const fields_3924 = List$map(_t3920, fields);
          function _t3926(__p67, __p68) {
            let _t3928;
            const _t3927 = __p67;
            _t3929: {
              if (true) {
                const a = _t3927[0];
                let _t3931;
                const _t3930 = __p68;
                _t3932: {
                  if (true) {
                    const b = _t3930[0];
                    _t3931 = String$compare(a, b);
                    break _t3932;
                  }
                  _match_fail("line 16629");
                }
                _t3928 = _t3931;
                break _t3929;
              }
              _match_fail("line 16629");
            }
            return _t3928;
          }
          const fields_3933 = List$sort(_t3926, fields_3924);
          let _t3935;
          if (is_open) {
            _t3935 = Types$new_rvar(level);
          } else {
            _t3935 = ({_tag: 2, _name: "REmpty"});
          }
          const tail_3936 = _t3935;
          function _t3938(__p69, acc) {
            let _t3940;
            const _t3939 = __p69;
            _t3941: {
              if (true) {
                const n = _t3939[0];
                const t = _t3939[1];
                _t3940 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                break _t3941;
              }
              _match_fail("line 16629");
            }
            return _t3940;
          }
          const _t3937 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t3938, fields_3933, tail_3936)});
          const _t3934 = _t3937;
          const _t3925 = _t3934;
          _t3874 = _t3925;
          break _t3875;
        }
        if (_t3873._tag === 8) {
          const path = _t3873._val[0];
          const name = _t3873._val[1];
          const qualified_3942 = (String$concat(".", path) + ("." + name));
          const _t3944 = ({_tag: 0, _name: "TyName", _val: qualified_3942});
          __x = _t3944;
          continue;
          const _t3943 = undefined;
          _t3874 = _t3943;
          break _t3875;
        }
        if (_t3873._tag === 9) {
          const kind = _t3873._val[0];
          const tags = _t3873._val[1];
          let _t3946;
          const _t3945 = kind;
          _t3947: {
            if ((_t3945._tag === 0 || _t3945._tag === 2)) {
              _t3946 = ({_tag: 2, _name: "PVEmpty"});
              break _t3947;
            }
            if (_t3945._tag === 1) {
              _t3946 = Types$new_pvvar(level);
              break _t3947;
            }
            _match_fail("line 16629");
          }
          const tail_3948 = _t3946;
          function _t3950(__p70, acc) {
            let _t3952;
            const _t3951 = __p70;
            _t3953: {
              if (true) {
                const tag = _t3951[0];
                const payload_annot = _t3951[1];
                _t3952 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload_annot), acc]});
                break _t3953;
              }
              _match_fail("line 16629");
            }
            return _t3952;
          }
          const row_3954 = List$fold_right(_t3950, tags, tail_3948);
          const _t3955 = ({_tag: 14, _name: "TPolyVariant", _val: row_3954});
          const _t3949 = _t3955;
          _t3874 = _t3949;
          break _t3875;
        }
        if (_t3873._tag === 10) {
          const ty = _t3873._val[0];
          const _eff = _t3873._val[1];
          const _t3956 = ty;
          __x = _t3956;
          continue;
          _t3874 = undefined;
          break _t3875;
        }
        _match_fail("line 16629");
      }
      return _t3874;
    }
  }
  const _t3957 = go(annot);
  return _t3957;
}
function Typechecker$resolve_eff_items(ctx, level, tvars, items) {
  const labels_3958 = Ref$create(null);
  const row_var_3960 = Ref$create(({_tag: 0, _name: "None"}));
  function _t3962(item) {
    let _t3964;
    const _t3963 = item;
    _t3965: {
      if (_t3963._tag === 0) {
        const name = _t3963._val[0];
        const param_annots = _t3963._val[1];
        let _t3966;
        if (!_eq(Ref$get(row_var_3960), ({_tag: 0, _name: "None"}))) {
          _t3966 = Typechecker$error("effect labels must come before row variable");
        } else {
          _t3966 = undefined;
        }
        _t3966;
        function _t3967(e) {
          return (e.effect_name === name);
        }
        let _t3969;
        const _t3968 = List$find(_t3967, ctx.type_env.effects);
        _t3970: {
          if (_t3968._tag === 1) {
            const e = _t3968._val;
            _t3969 = e;
            break _t3970;
          }
          if (_t3968._tag === 0) {
            _t3969 = Typechecker$error(("unknown effect: " + __dict_Show_string.show(name)));
            break _t3970;
          }
          _match_fail("line 16629");
        }
        const edef_3971 = _t3969;
        const expected_params_3973 = List$length(edef_3971.effect_params);
        const actual_params_3975 = List$length(param_annots);
        let _t3977;
        if ((expected_params_3973 !== actual_params_3975)) {
          _t3977 = Typechecker$error(((((("effect " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(expected_params_3973)) + " type parameter(s), got ") + __dict_Show_int.show(actual_params_3975)));
        } else {
          _t3977 = undefined;
        }
        _t3977;
        const _t3976 = Ref$set(labels_3958, ({_hd: [name, param_annots], _tl: Ref$get(labels_3958)}));
        const _t3974 = _t3976;
        const _t3972 = _t3974;
        _t3964 = _t3972;
        break _t3965;
      }
      if (_t3963._tag === 1) {
        const name = _t3963._val;
        let _t3978;
        if (!_eq(Ref$get(row_var_3960), ({_tag: 0, _name: "None"}))) {
          _t3978 = Typechecker$error("at most one effect row variable allowed");
        } else {
          _t3978 = undefined;
        }
        _t3978;
        _t3964 = Ref$set(row_var_3960, ({_tag: 1, _name: "Some", _val: name}));
        break _t3965;
      }
      _match_fail("line 16629");
    }
    return _t3964;
  }
  List$iter(_t3962, items);
  const labels_3979 = List$rev(Ref$get(labels_3958));
  let _t3982;
  const _t3981 = Ref$get(row_var_3960);
  _t3983: {
    if (_t3981._tag === 0) {
      _t3982 = Types$new_effvar(level);
      break _t3983;
    }
    if (_t3981._tag === 1) {
      const _name = _t3981._val;
      _t3982 = Types$new_effvar(level);
      break _t3983;
    }
    _match_fail("line 16629");
  }
  const tail_3984 = _t3982;
  function _t3986(__p71, acc) {
    let _t3988;
    const _t3987 = __p71;
    _t3989: {
      if (true) {
        const name = _t3987[0];
        const param_annots = _t3987[1];
        const resolved_params_3990 = List$map(_call(Typechecker$resolve_ty_annot_shared, [ctx, level, tvars]), param_annots);
        const _t3991 = ({_tag: 2, _name: "EffRow", _val: [name, resolved_params_3990, acc]});
        _t3988 = _t3991;
        break _t3989;
      }
      _match_fail("line 16629");
    }
    return _t3988;
  }
  const _t3985 = List$fold_right(_t3986, labels_3979, tail_3984);
  const _t3980 = _t3985;
  const _t3961 = _t3980;
  const _t3959 = _t3961;
  return _t3959;
}
function Typechecker$resolve_ty_annot(ctx, level, annot) {
  const tvars_3992 = Hashtbl$create(4);
  const _t3993 = Typechecker$resolve_ty_annot_shared(ctx, level, tvars_3992, annot);
  return _t3993;
}
function Typechecker$instantiate_record_fields(level, fields) {
  function _t3994(acc, __p72) {
    let _t3996;
    const _t3995 = __p72;
    _t3997: {
      if (true) {
        const ty = _t3995[1];
        _t3996 = max(acc, Typechecker$max_tgen_in_ty(ty));
        break _t3997;
      }
      _match_fail("line 16629");
    }
    return _t3996;
  }
  const max_gen_3998 = List$fold(_t3994, (-1), fields);
  let _t4000;
  if ((max_gen_3998 < 0)) {
    _t4000 = fields;
  } else {
    function _t4001(_) {
      return Types$new_tvar(level);
    }
    const fresh_4002 = List$init((max_gen_3998 + 1), _t4001);
    function _t4004(__p73) {
      let _t4006;
      const _t4005 = __p73;
      _t4007: {
        if (true) {
          const n = _t4005[0];
          const ty = _t4005[1];
          _t4006 = [n, Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(fresh_4002, ty))];
          break _t4007;
        }
        _match_fail("line 16629");
      }
      return _t4006;
    }
    const _t4003 = List$map(_t4004, fields);
    _t4000 = _t4003;
  }
  const _t3999 = _t4000;
  return _t3999;
}
function Typechecker$instantiate_record_row(level, fields) {
  const fields_4008 = Typechecker$instantiate_record_fields(level, fields);
  const _t4009 = Types$fields_to_closed_row(fields_4008);
  return _t4009;
}
function _t4010(_, __2) {
  return failwith("find_module_in_env not yet initialized");
}
const Typechecker$find_module_in_env_ref = Ref$create(_t4010);
function _t4011(_, __2, __3) {
  return failwith("open_module_into_ctx not yet initialized");
}
const Typechecker$open_module_into_ctx_ref = Ref$create(_t4011);
function _t4012(_, __2, __3) {
  return undefined;
}
const Typechecker$exhaustiveness_check_ref = Ref$create(_t4012);
function Typechecker$mk(te, ty) {
  return ({expr: te, loc: Ref$get(Typechecker$current_loc), ty: ty});
}
function Typechecker$extract_fn_info(expr) {
  while (true) {
    let _t4014;
    const _t4013 = expr;
    _t4015: {
      if (_t4013._tag === 49) {
        const inner = _t4013._val[1];
        const _t4016 = inner;
        expr = _t4016;
        continue;
        _t4014 = undefined;
        break _t4015;
      }
      if (_t4013._tag === 30) {
        const inner = _t4013._val[0];
        let _t4018;
        const _t4017 = inner;
        _t4019: {
          if ((_t4017._tag === 10 || _t4017._tag === 49 && _t4017._val[1]._tag === 10)) {
            _t4018 = true;
            break _t4019;
          }
          if (true) {
            _t4018 = false;
            break _t4019;
          }
          _match_fail("line 16629");
        }
        if (_t4018) {
          const _t4020 = inner;
          expr = _t4020;
          continue;
          _t4014 = undefined;
          break _t4015;
        }
      }
      if (_t4013._tag === 10) {
        const param = _t4013._val[0];
        const body = _t4013._val[1];
        let _t4022;
        const _t4021 = Typechecker$extract_fn_info(body);
        _t4023: {
          if (true) {
            const params = _t4021[0];
            const ret = _t4021[1];
            const inner = _t4021[2];
            _t4022 = [({_hd: param, _tl: params}), ret, inner];
            break _t4023;
          }
          _match_fail("line 16629");
        }
        _t4014 = _t4022;
        break _t4015;
      }
      if (_t4013._tag === 30) {
        const inner = _t4013._val[0];
        const annot = _t4013._val[1];
        _t4014 = [null, ({_tag: 1, _name: "Some", _val: annot}), inner];
        break _t4015;
      }
      if (true) {
        _t4014 = [null, ({_tag: 0, _name: "None"}), expr];
        break _t4015;
      }
      _match_fail("line 16629");
    }
    return _t4014;
  }
}
function Typechecker$resolve_module_name(ctx, name) {
  let _t4025;
  const _t4024 = ctx.current_module;
  _t4026: {
    if (_t4024._tag === 1) {
      const prefix = _t4024._val;
      function try_prefix(p) {
        while (true) {
          const qualified_4027 = (p + name);
          function _t4029(__p74) {
            let _t4031;
            const _t4030 = __p74;
            _t4032: {
              if (true) {
                const n = _t4030[0];
                _t4031 = (n === qualified_4027);
                break _t4032;
              }
              _match_fail("line 16629");
            }
            return _t4031;
          }
          let _t4033;
          if (List$exists(_t4029, ctx.vars)) {
            _t4033 = qualified_4027;
          } else {
            const p$p_4034 = String$sub(p, 0, max(0, (String$length(p) - 1)));
            let _t4037;
            const _t4036 = String$rindex_opt(p$p_4034, 46);
            _t4038: {
              if (_t4036._tag === 1) {
                const idx = _t4036._val;
                const _t4039 = String$sub(p$p_4034, 0, (idx + 1));
                p = _t4039;
                continue;
                _t4037 = undefined;
                break _t4038;
              }
              if (_t4036._tag === 0) {
                _t4037 = name;
                break _t4038;
              }
              _match_fail("line 16629");
            }
            const _t4035 = _t4037;
            _t4033 = _t4035;
          }
          const _t4028 = _t4033;
          return _t4028;
        }
      }
      const _t4040 = try_prefix(prefix);
      _t4025 = _t4040;
      break _t4026;
    }
    if (_t4024._tag === 0) {
      _t4025 = name;
      break _t4026;
    }
    _match_fail("line 16629");
  }
  return _t4025;
}
function Typechecker$find_var_type_in(target_name, te) {
  const result_4041 = Ref$create(({_tag: 0, _name: "None"}));
  function go(te) {
    while (true) {
      let _t4043;
      if (Option$is_some(Ref$get(result_4041))) {
        _t4043 = undefined;
      } else {
        let _t4045;
        const _t4044 = te.expr;
        _t4046: {
          if (_t4044._tag === 7) {
            const n = _t4044._val;
            if ((n === target_name)) {
              _t4045 = Ref$set(result_4041, ({_tag: 1, _name: "Some", _val: te.ty}));
              break _t4046;
            }
          }
          if ((((((((((_t4044._tag === 7 || _t4044._tag === 0) || _t4044._tag === 1) || _t4044._tag === 2) || _t4044._tag === 3) || _t4044._tag === 4) || _t4044._tag === 5) || _t4044._tag === 6) || _t4044._tag === 22) || _t4044._tag === 34)) {
            _t4045 = undefined;
            break _t4046;
          }
          if (_t4044._tag === 11) {
            const fn_ = _t4044._val[0];
            const arg = _t4044._val[1];
            go(fn_);
            const _t4047 = arg;
            te = _t4047;
            continue;
            _t4045 = undefined;
            break _t4046;
          }
          if (((((((((_t4044._tag === 10 || _t4044._tag === 14) || _t4044._tag === 19) || _t4044._tag === 33) || _t4044._tag === 35) || _t4044._tag === 36) || _t4044._tag === 39) || _t4044._tag === 26) || _t4044._tag === 29)) {
            const body = ((((((((_t4044._tag === 10 || _t4044._tag === 14) || _t4044._tag === 19) || _t4044._tag === 33) || _t4044._tag === 35) || _t4044._tag === 36) || _t4044._tag === 39) || _t4044._tag === 26) ? (((((((_t4044._tag === 10 || _t4044._tag === 14) || _t4044._tag === 19) || _t4044._tag === 33) || _t4044._tag === 35) || _t4044._tag === 36) || _t4044._tag === 39) ? ((((((_t4044._tag === 10 || _t4044._tag === 14) || _t4044._tag === 19) || _t4044._tag === 33) || _t4044._tag === 35) || _t4044._tag === 36) ? (((((_t4044._tag === 10 || _t4044._tag === 14) || _t4044._tag === 19) || _t4044._tag === 33) || _t4044._tag === 35) ? ((((_t4044._tag === 10 || _t4044._tag === 14) || _t4044._tag === 19) || _t4044._tag === 33) ? (((_t4044._tag === 10 || _t4044._tag === 14) || _t4044._tag === 19) ? ((_t4044._tag === 10 || _t4044._tag === 14) ? _t4044._val[1] : _t4044._val[0]) : _t4044._val) : _t4044._val) : _t4044._val) : _t4044._val) : _t4044._val[1]) : _t4044._val[1]);
            const _t4048 = body;
            te = _t4048;
            continue;
            _t4045 = undefined;
            break _t4046;
          }
          if ((((((((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) || _t4044._tag === 28) || _t4044._tag === 32) || _t4044._tag === 31) || _t4044._tag === 27) || _t4044._tag === 20)) {
            const e1 = (((((((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) || _t4044._tag === 28) || _t4044._tag === 32) || _t4044._tag === 31) || _t4044._tag === 27) ? ((((((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) || _t4044._tag === 28) || _t4044._tag === 32) || _t4044._tag === 31) ? (((((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) || _t4044._tag === 28) || _t4044._tag === 32) ? ((((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) || _t4044._tag === 28) ? (((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) ? ((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) ? (((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) ? ((_t4044._tag === 8 || _t4044._tag === 9) ? _t4044._val[2] : _t4044._val[1]) : _t4044._val[1]) : _t4044._val[0]) : _t4044._val[0]) : _t4044._val[0]) : _t4044._val[0]) : _t4044._val[0]) : _t4044._val[0]);
            const e2 = (((((((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) || _t4044._tag === 28) || _t4044._tag === 32) || _t4044._tag === 31) || _t4044._tag === 27) ? ((((((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) || _t4044._tag === 28) || _t4044._tag === 32) || _t4044._tag === 31) ? (((((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) || _t4044._tag === 28) || _t4044._tag === 32) ? ((((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) || _t4044._tag === 28) ? (((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) || _t4044._tag === 21) ? ((((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) || _t4044._tag === 13) ? (((_t4044._tag === 8 || _t4044._tag === 9) || _t4044._tag === 25) ? ((_t4044._tag === 8 || _t4044._tag === 9) ? _t4044._val[3] : _t4044._val[2]) : _t4044._val[2]) : _t4044._val[1]) : _t4044._val[1]) : _t4044._val[1]) : _t4044._val[1]) : _t4044._val[2]) : _t4044._val[1]);
            go(e1);
            const _t4049 = e2;
            te = _t4049;
            continue;
            _t4045 = undefined;
            break _t4046;
          }
          if (_t4044._tag === 12) {
            const c = _t4044._val[0];
            const t = _t4044._val[1];
            const e = _t4044._val[2];
            go(c);
            go(t);
            const _t4050 = e;
            te = _t4050;
            continue;
            _t4045 = undefined;
            break _t4046;
          }
          if ((_t4044._tag === 15 || _t4044._tag === 38)) {
            const es = _t4044._val;
            _t4045 = List$iter(go, es);
            break _t4046;
          }
          if (_t4044._tag === 16) {
            const fields = _t4044._val;
            function _t4051(__p75) {
              let _t4053;
              const _t4052 = __p75;
              _t4054: {
                if (true) {
                  const e = _t4052[1];
                  _t4053 = go(e);
                  break _t4054;
                }
                _match_fail("line 16629");
              }
              return _t4053;
            }
            _t4045 = List$iter(_t4051, fields);
            break _t4046;
          }
          if (_t4044._tag === 17) {
            const base = _t4044._val[0];
            const overrides = _t4044._val[1];
            go(base);
            function _t4055(__p76) {
              let _t4057;
              const _t4056 = __p76;
              _t4058: {
                if (true) {
                  const e = _t4056[1];
                  _t4057 = go(e);
                  break _t4058;
                }
                _match_fail("line 16629");
              }
              return _t4057;
            }
            _t4045 = List$iter(_t4055, overrides);
            break _t4046;
          }
          if (_t4044._tag === 18) {
            const base = _t4044._val[0];
            const pairs = _t4044._val[1];
            go(base);
            function _t4059(__p77) {
              let _t4061;
              const _t4060 = __p77;
              _t4062: {
                if (true) {
                  const i = _t4060[0];
                  const v = _t4060[1];
                  go(i);
                  _t4061 = go(v);
                  break _t4062;
                }
                _match_fail("line 16629");
              }
              return _t4061;
            }
            _t4045 = List$iter(_t4059, pairs);
            break _t4046;
          }
          if (_t4044._tag === 23) {
            const arg = _t4044._val[1];
            _t4045 = Option$iter(go, arg);
            break _t4046;
          }
          if (_t4044._tag === 24) {
            const scr = _t4044._val[0];
            const arms = _t4044._val[1];
            go(scr);
            function _t4063(__p78) {
              let _t4065;
              const _t4064 = __p78;
              _t4066: {
                if (true) {
                  const g = _t4064[1];
                  const body = _t4064[2];
                  Option$iter(go, g);
                  _t4065 = go(body);
                  break _t4066;
                }
                _match_fail("line 16629");
              }
              return _t4065;
            }
            _t4045 = List$iter(_t4063, arms);
            break _t4046;
          }
          if (_t4044._tag === 30) {
            const body = _t4044._val[0];
            const arms = _t4044._val[1];
            go(body);
            function _t4067(arm) {
              let _t4069;
              const _t4068 = arm;
              _t4070: {
                if ((((_t4068._tag === 0 || _t4068._tag === 1) || _t4068._tag === 2) || _t4068._tag === 3)) {
                  const e = (((_t4068._tag === 0 || _t4068._tag === 1) || _t4068._tag === 2) ? ((_t4068._tag === 0 || _t4068._tag === 1) ? (_t4068._tag === 0 ? _t4068._val[1] : _t4068._val[3]) : _t4068._val[2]) : _t4068._val[2]);
                  _t4069 = go(e);
                  break _t4070;
                }
                _match_fail("line 16629");
              }
              return _t4069;
            }
            _t4045 = List$iter(_t4067, arms);
            break _t4046;
          }
          if (_t4044._tag === 37) {
            const bindings = _t4044._val[0];
            const body = _t4044._val[1];
            function _t4071(__p79) {
              let _t4073;
              const _t4072 = __p79;
              _t4074: {
                if (true) {
                  const e = _t4072[1];
                  _t4073 = go(e);
                  break _t4074;
                }
                _match_fail("line 16629");
              }
              return _t4073;
            }
            List$iter(_t4071, bindings);
            const _t4075 = body;
            te = _t4075;
            continue;
            _t4045 = undefined;
            break _t4046;
          }
          _match_fail("line 16629");
        }
        _t4043 = _t4045;
      }
      return _t4043;
    }
  }
  go(te);
  const _t4076 = Ref$get(result_4041);
  const _t4042 = _t4076;
  return _t4042;
}
function Typechecker$infer_implicit_constraints(binding_name, type_env, vars, te, scheme) {
  let _t4077;
  if ((!_eq(scheme.constraints, null) || (scheme.quant === 0))) {
    _t4077 = scheme;
  } else {
    const id_map_4078 = Hashtbl$create(8);
    function build_map(s, a) {
      while (true) {
        const a_4080 = Types$repr(a);
        let _t4083;
        const _t4082 = s;
        _t4084: {
          if (_t4082._tag === 16) {
            const i = _t4082._val;
            let _t4086;
            const _t4085 = a_4080;
            _t4087: {
              if (_t4085._tag === 15 && _t4085._val.contents._tag === 0) {
                const id = _t4085._val.contents._val[0];
                _t4086 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, id_map_4078, id, ({_tag: 16, _name: "TGen", _val: i})]);
                break _t4087;
              }
              if (true) {
                _t4086 = undefined;
                break _t4087;
              }
              _match_fail("line 16629");
            }
            _t4083 = _t4086;
            break _t4084;
          }
          if (_t4082._tag === 7) {
            const s1 = _t4082._val[0];
            const s2 = _t4082._val[2];
            let _t4089;
            const _t4088 = a_4080;
            _t4090: {
              if (_t4088._tag === 7) {
                const a1 = _t4088._val[0];
                const a2 = _t4088._val[2];
                build_map(s1, a1);
                const _t4091 = s2;
                const _t4092 = a2;
                s = _t4091;
                a = _t4092;
                continue;
                _t4089 = undefined;
                break _t4090;
              }
              if (true) {
                _t4089 = undefined;
                break _t4090;
              }
              _match_fail("line 16629");
            }
            _t4083 = _t4089;
            break _t4084;
          }
          if (_t4082._tag === 8) {
            const s1 = _t4082._val[0];
            const s2 = _t4082._val[2];
            let _t4094;
            const _t4093 = a_4080;
            _t4095: {
              if (_t4093._tag === 8) {
                const a1 = _t4093._val[0];
                const a2 = _t4093._val[2];
                build_map(s1, a1);
                const _t4096 = s2;
                const _t4097 = a2;
                s = _t4096;
                a = _t4097;
                continue;
                _t4094 = undefined;
                break _t4095;
              }
              if (true) {
                _t4094 = undefined;
                break _t4095;
              }
              _match_fail("line 16629");
            }
            _t4083 = _t4094;
            break _t4084;
          }
          if (_t4082._tag === 9) {
            const ss = _t4082._val;
            let _t4099;
            const _t4098 = a_4080;
            _t4100: {
              if (_t4098._tag === 9) {
                const aa = _t4098._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t4099 = List$iter2(build_map, ss, aa);
                  break _t4100;
                }
              }
              if (true) {
                _t4099 = undefined;
                break _t4100;
              }
              _match_fail("line 16629");
            }
            _t4083 = _t4099;
            break _t4084;
          }
          if (_t4082._tag === 10) {
            const s1 = _t4082._val;
            let _t4102;
            const _t4101 = a_4080;
            _t4103: {
              if (_t4101._tag === 10) {
                const a1 = _t4101._val;
                const _t4104 = s1;
                const _t4105 = a1;
                s = _t4104;
                a = _t4105;
                continue;
                _t4102 = undefined;
                break _t4103;
              }
              if (true) {
                _t4102 = undefined;
                break _t4103;
              }
              _match_fail("line 16629");
            }
            _t4083 = _t4102;
            break _t4084;
          }
          if (_t4082._tag === 13) {
            const s1 = _t4082._val;
            let _t4107;
            const _t4106 = a_4080;
            _t4108: {
              if (_t4106._tag === 13) {
                const a1 = _t4106._val;
                const _t4109 = s1;
                const _t4110 = a1;
                s = _t4109;
                a = _t4110;
                continue;
                _t4107 = undefined;
                break _t4108;
              }
              if (true) {
                _t4107 = undefined;
                break _t4108;
              }
              _match_fail("line 16629");
            }
            _t4083 = _t4107;
            break _t4084;
          }
          if (_t4082._tag === 12) {
            const ss = _t4082._val[1];
            let _t4112;
            const _t4111 = a_4080;
            _t4113: {
              if (_t4111._tag === 12) {
                const aa = _t4111._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t4112 = List$iter2(build_map, ss, aa);
                  break _t4113;
                }
              }
              if (true) {
                _t4112 = undefined;
                break _t4113;
              }
              _match_fail("line 16629");
            }
            _t4083 = _t4112;
            break _t4084;
          }
          if (_t4082._tag === 14) {
            const srow = _t4082._val;
            let _t4115;
            const _t4114 = a_4080;
            _t4116: {
              if (_t4114._tag === 14) {
                const arow = _t4114._val;
                _t4115 = build_map_pvrows(srow, arow);
                break _t4116;
              }
              if (true) {
                _t4115 = undefined;
                break _t4116;
              }
              _match_fail("line 16629");
            }
            _t4083 = _t4115;
            break _t4084;
          }
          if (_t4082._tag === 11) {
            const srow = _t4082._val;
            let _t4118;
            const _t4117 = a_4080;
            _t4119: {
              if (_t4117._tag === 11) {
                const arow = _t4117._val;
                _t4118 = build_map_rrows(srow, arow);
                break _t4119;
              }
              if (true) {
                _t4118 = undefined;
                break _t4119;
              }
              _match_fail("line 16629");
            }
            _t4083 = _t4118;
            break _t4084;
          }
          if (true) {
            _t4083 = undefined;
            break _t4084;
          }
          _match_fail("line 16629");
        }
        const _t4081 = _t4083;
        return _t4081;
      }
    }
    function build_map_rrows(srow, arow) {
      const sf_4120 = Types$record_row_to_fields(srow);
      const af_4122 = Types$record_row_to_fields(arow);
      let _t4124;
      if ((List$length(sf_4120) === List$length(af_4122))) {
        function _t4125(__p80, __p81) {
          let _t4127;
          const _t4126 = __p80;
          _t4128: {
            if (true) {
              const st = _t4126[1];
              let _t4130;
              const _t4129 = __p81;
              _t4131: {
                if (true) {
                  const at_ = _t4129[1];
                  _t4130 = build_map(st, at_);
                  break _t4131;
                }
                _match_fail("line 16629");
              }
              _t4127 = _t4130;
              break _t4128;
            }
            _match_fail("line 16629");
          }
          return _t4127;
        }
        _t4124 = List$iter2(_t4125, sf_4120, af_4122);
      } else {
        _t4124 = undefined;
      }
      const _t4123 = _t4124;
      const _t4121 = _t4123;
      return _t4121;
    }
    function build_map_pvrows(srow, arow) {
      function collect_tags(row) {
        while (true) {
          let _t4133;
          const _t4132 = row;
          _t4134: {
            if (_t4132._tag === 0) {
              const tag = _t4132._val[0];
              const ty_opt = _t4132._val[1];
              const tail = _t4132._val[2];
              _t4133 = ({_hd: [tag, ty_opt], _tl: collect_tags(tail)});
              break _t4134;
            }
            if (_t4132._tag === 1 && _t4132._val.contents._tag === 1) {
              const r = _t4132._val.contents._val;
              const _t4135 = r;
              row = _t4135;
              continue;
              _t4133 = undefined;
              break _t4134;
            }
            if (true) {
              _t4133 = null;
              break _t4134;
            }
            _match_fail("line 16629");
          }
          return _t4133;
        }
      }
      const atags_4137 = collect_tags(arow);
      function go(row) {
        while (true) {
          let _t4140;
          const _t4139 = row;
          _t4141: {
            if (_t4139._tag === 0) {
              const stag = _t4139._val[0];
              const sty_opt = _t4139._val[1];
              const stail = _t4139._val[2];
              let _t4143;
              const _t4142 = List$assoc_opt(stag, atags_4137);
              _t4144: {
                if (_t4142._tag === 1) {
                  const aty_opt = _t4142._val;
                  let _t4146;
                  const _t4145 = [sty_opt, aty_opt];
                  _t4147: {
                    if (_t4145[0]._tag === 1 && _t4145[1]._tag === 1) {
                      const sty = _t4145[0]._val;
                      const aty = _t4145[1]._val;
                      _t4146 = build_map(sty, aty);
                      break _t4147;
                    }
                    if (true) {
                      _t4146 = undefined;
                      break _t4147;
                    }
                    _match_fail("line 16629");
                  }
                  _t4143 = _t4146;
                  break _t4144;
                }
                if (_t4142._tag === 0) {
                  _t4143 = undefined;
                  break _t4144;
                }
                _match_fail("line 16629");
              }
              _t4143;
              const _t4148 = stail;
              row = _t4148;
              continue;
              _t4140 = undefined;
              break _t4141;
            }
            if (_t4139._tag === 1 && _t4139._val.contents._tag === 1) {
              const r = _t4139._val.contents._val;
              const _t4149 = r;
              row = _t4149;
              continue;
              _t4140 = undefined;
              break _t4141;
            }
            if (true) {
              _t4140 = undefined;
              break _t4141;
            }
            _match_fail("line 16629");
          }
          return _t4140;
        }
      }
      const _t4150 = go(srow);
      const _t4138 = _t4150;
      const _t4136 = _t4138;
      return _t4136;
    }
    build_map(scheme.body, te.ty);
    const found_multi_4152 = Ref$create(null);
    const pending_caty_4154 = Ref$create(null);
    const phantom_counter_4156 = Ref$create(scheme.quant);
    const tvar_to_phantom_4158 = Hashtbl$create(4);
    function _t4160(tbl, key) {
      function _t4161(k) {
        return _eq(k, key);
      }
      let _t4162;
      if ((!List$exists(_t4161, Ref$get(tbl)))) {
        _t4162 = Ref$set(tbl, ({_hd: key, _tl: Ref$get(tbl)}));
      } else {
        _t4162 = undefined;
      }
      return _t4162;
    }
    const set_add_4163 = _t4160;
    function _t4165(local_sch, actual_ty) {
      const call_map_4166 = Hashtbl$create(4);
      const phantom_remap_4168 = Hashtbl$create(4);
      function map_tgens(s, a) {
        while (true) {
          const a_4170 = Types$repr(a);
          let _t4173;
          const _t4172 = s;
          _t4174: {
            if (_t4172._tag === 16) {
              const i = _t4172._val;
              let _t4175;
              if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, call_map_4166, i]))) {
                _t4175 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, call_map_4166, i, a_4170]);
              } else {
                _t4175 = undefined;
              }
              _t4173 = _t4175;
              break _t4174;
            }
            if (_t4172._tag === 7) {
              const s1 = _t4172._val[0];
              const s2 = _t4172._val[2];
              let _t4177;
              const _t4176 = a_4170;
              _t4178: {
                if (_t4176._tag === 7) {
                  const a1 = _t4176._val[0];
                  const a2 = _t4176._val[2];
                  map_tgens(s1, a1);
                  const _t4179 = s2;
                  const _t4180 = a2;
                  s = _t4179;
                  a = _t4180;
                  continue;
                  _t4177 = undefined;
                  break _t4178;
                }
                if (true) {
                  _t4177 = undefined;
                  break _t4178;
                }
                _match_fail("line 16629");
              }
              _t4173 = _t4177;
              break _t4174;
            }
            if (_t4172._tag === 8) {
              const s1 = _t4172._val[0];
              const s2 = _t4172._val[2];
              let _t4182;
              const _t4181 = a_4170;
              _t4183: {
                if (_t4181._tag === 8) {
                  const a1 = _t4181._val[0];
                  const a2 = _t4181._val[2];
                  map_tgens(s1, a1);
                  const _t4184 = s2;
                  const _t4185 = a2;
                  s = _t4184;
                  a = _t4185;
                  continue;
                  _t4182 = undefined;
                  break _t4183;
                }
                if (true) {
                  _t4182 = undefined;
                  break _t4183;
                }
                _match_fail("line 16629");
              }
              _t4173 = _t4182;
              break _t4174;
            }
            if (_t4172._tag === 9) {
              const ss = _t4172._val;
              let _t4187;
              const _t4186 = a_4170;
              _t4188: {
                if (_t4186._tag === 9) {
                  const aa = _t4186._val;
                  if ((List$length(ss) === List$length(aa))) {
                    _t4187 = List$iter2(map_tgens, ss, aa);
                    break _t4188;
                  }
                }
                if (true) {
                  _t4187 = undefined;
                  break _t4188;
                }
                _match_fail("line 16629");
              }
              _t4173 = _t4187;
              break _t4174;
            }
            if (_t4172._tag === 10) {
              const s1 = _t4172._val;
              let _t4190;
              const _t4189 = a_4170;
              _t4191: {
                if (_t4189._tag === 10) {
                  const a1 = _t4189._val;
                  const _t4192 = s1;
                  const _t4193 = a1;
                  s = _t4192;
                  a = _t4193;
                  continue;
                  _t4190 = undefined;
                  break _t4191;
                }
                if (true) {
                  _t4190 = undefined;
                  break _t4191;
                }
                _match_fail("line 16629");
              }
              _t4173 = _t4190;
              break _t4174;
            }
            if (_t4172._tag === 13) {
              const s1 = _t4172._val;
              let _t4195;
              const _t4194 = a_4170;
              _t4196: {
                if (_t4194._tag === 13) {
                  const a1 = _t4194._val;
                  const _t4197 = s1;
                  const _t4198 = a1;
                  s = _t4197;
                  a = _t4198;
                  continue;
                  _t4195 = undefined;
                  break _t4196;
                }
                if (true) {
                  _t4195 = undefined;
                  break _t4196;
                }
                _match_fail("line 16629");
              }
              _t4173 = _t4195;
              break _t4174;
            }
            if (_t4172._tag === 12) {
              const ss = _t4172._val[1];
              let _t4200;
              const _t4199 = a_4170;
              _t4201: {
                if (_t4199._tag === 12) {
                  const aa = _t4199._val[1];
                  if ((List$length(ss) === List$length(aa))) {
                    _t4200 = List$iter2(map_tgens, ss, aa);
                    break _t4201;
                  }
                }
                if (true) {
                  _t4200 = undefined;
                  break _t4201;
                }
                _match_fail("line 16629");
              }
              _t4173 = _t4200;
              break _t4174;
            }
            if (true) {
              _t4173 = undefined;
              break _t4174;
            }
            _match_fail("line 16629");
          }
          const _t4171 = _t4173;
          return _t4171;
        }
      }
      map_tgens(local_sch.body, actual_ty);
      function _t4203(cc) {
        function _t4204(ca) {
          let _t4206;
          const _t4205 = ca;
          _t4207: {
            if (_t4205._tag === 0) {
              const tgen_idx = _t4205._val;
              let _t4209;
              const _t4208 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, call_map_4166, tgen_idx]);
              _t4210: {
                if (_t4208._tag === 1 && _t4208._val._tag === 15 && _t4208._val._val.contents._tag === 0) {
                  const id = _t4208._val._val.contents._val[0];
                  const tv = _t4208._val;
                  let _t4212;
                  const _t4211 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map_4078, id]);
                  _t4213: {
                    if (_t4211._tag === 1 && _t4211._val._tag === 16) {
                      const outer_tgen = _t4211._val._val;
                      _t4212 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "CATGen", _val: outer_tgen})});
                      break _t4213;
                    }
                    if (true) {
                      _t4212 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "CATy", _val: tv})});
                      break _t4213;
                    }
                    _match_fail("line 16629");
                  }
                  _t4209 = _t4212;
                  break _t4210;
                }
                if (_t4208._tag === 1) {
                  _t4209 = ({_tag: 0, _name: "None"});
                  break _t4210;
                }
                if (_t4208._tag === 0) {
                  _t4209 = ({_tag: 0, _name: "None"});
                  break _t4210;
                }
                _match_fail("line 16629");
              }
              _t4206 = _t4209;
              break _t4207;
            }
            if (_t4205._tag === 1) {
              const ty = _t4205._val;
              let _t4215;
              const _t4214 = Types$repr(ty);
              _t4216: {
                if (_t4214._tag === 15 && _t4214._val.contents._tag === 0) {
                  const id = _t4214._val.contents._val[0];
                  let _t4218;
                  const _t4217 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map_4078, id]);
                  _t4219: {
                    if (_t4217._tag === 1 && _t4217._val._tag === 16) {
                      const outer_tgen = _t4217._val._val;
                      _t4218 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "CATGen", _val: outer_tgen})});
                      break _t4219;
                    }
                    if (true) {
                      _t4218 = ({_tag: 1, _name: "Some", _val: ca});
                      break _t4219;
                    }
                    _match_fail("line 16629");
                  }
                  _t4215 = _t4218;
                  break _t4216;
                }
                if (true) {
                  _t4215 = ({_tag: 1, _name: "Some", _val: ca});
                  break _t4216;
                }
                _match_fail("line 16629");
              }
              _t4206 = _t4215;
              break _t4207;
            }
            if (_t4205._tag === 2) {
              _t4206 = ({_tag: 1, _name: "Some", _val: ({_tag: 2, _name: "CAWild"})});
              break _t4207;
            }
            if (_t4205._tag === 3) {
              const inner_idx = _t4205._val[0];
              let _t4221;
              const _t4220 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, phantom_remap_4168, inner_idx]);
              _t4222: {
                if (_t4220._tag === 1) {
                  const pair = _t4220._val;
                  _t4221 = pair;
                  break _t4222;
                }
                if (_t4220._tag === 0) {
                  const idx_4223 = Ref$get(phantom_counter_4156);
                  Ref$set(phantom_counter_4156, (Ref$get(phantom_counter_4156) + 1));
                  const tv_4225 = Types$new_tvar(1);
                  _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, phantom_remap_4168, inner_idx, [idx_4223, tv_4225]]);
                  const _t4226 = [idx_4223, tv_4225];
                  const _t4224 = _t4226;
                  _t4221 = _t4224;
                  break _t4222;
                }
                _match_fail("line 16629");
              }
              let _t4228;
              const _t4227 = _t4221;
              _t4229: {
                if (true) {
                  const outer_idx = _t4227[0];
                  const outer_tv = _t4227[1];
                  _t4228 = ({_tag: 1, _name: "Some", _val: ({_tag: 3, _name: "CAPhantom", _val: [outer_idx, outer_tv]})});
                  break _t4229;
                }
                _match_fail("line 16629");
              }
              _t4206 = _t4228;
              break _t4207;
            }
            _match_fail("line 16629");
          }
          return _t4206;
        }
        const outer_tgens_4230 = List$filter_map(_t4204, cc.cc_args);
        let _t4232;
        if ((List$length(outer_tgens_4230) === List$length(cc.cc_args))) {
          _t4232 = set_add_4163(found_multi_4152, [cc.cc_class, outer_tgens_4230]);
        } else {
          _t4232 = undefined;
        }
        const _t4231 = _t4232;
        return _t4231;
      }
      const _t4202 = List$iter(_t4203, local_sch.constraints);
      const _t4169 = _t4202;
      const _t4167 = _t4169;
      return _t4167;
    }
    const propagate_constrained_ref_4233 = _t4165;
    function walk(locals, te) {
      let _t4236;
      const _t4235 = te.expr;
      _t4237: {
        if (_t4235._tag === 7) {
          const name = _t4235._val;
          let _t4239;
          const _t4238 = List$assoc_opt(name, locals);
          _t4240: {
            if (_t4238._tag === 1) {
              const local_sch = _t4238._val;
              if (!_eq(local_sch.constraints, null)) {
                _t4239 = propagate_constrained_ref_4233(local_sch, te.ty);
                break _t4240;
              }
            }
            if (true) {
              _t4239 = undefined;
              break _t4240;
            }
            _match_fail("line 16629");
          }
          _t4239;
          let _t4242;
          const _t4241 = List$assoc_opt(name, vars);
          _t4243: {
            if (_t4241._tag === 1) {
              const var_sch = _t4241._val;
              if (!_eq(var_sch.constraints, null)) {
                _t4242 = propagate_constrained_ref_4233(var_sch, te.ty);
                break _t4243;
              }
            }
            if (true) {
              _t4242 = undefined;
              break _t4243;
            }
            _match_fail("line 16629");
          }
          _t4242;
          let _t4245;
          const _t4244 = Types$find_method_class(type_env.classes, name);
          _t4246: {
            if (_t4244._tag === 1) {
              const class_def = _t4244._val;
              if ((!(name === binding_name))) {
                const method_ty_4247 = List$assoc(name, class_def.class_methods);
                let _t4250;
                const _t4249 = List$assoc_opt(name, vars);
                _t4251: {
                  if (_t4249._tag === 1) {
                    const s = _t4249._val;
                    let _t4252;
                    if (_eq(s.body, method_ty_4247)) {
                      _t4252 = [({_tag: 1, _name: "Some", _val: class_def}), name];
                    } else {
                      _t4252 = [({_tag: 0, _name: "None"}), name];
                    }
                    _t4250 = _t4252;
                    break _t4251;
                  }
                  if (_t4249._tag === 0) {
                    _t4250 = [({_tag: 0, _name: "None"}), name];
                    break _t4251;
                  }
                  _match_fail("line 16629");
                }
                const _t4248 = _t4250;
                _t4245 = _t4248;
                break _t4246;
              }
            }
            if (true) {
              let _t4254;
              const _t4253 = String$rindex_opt(name, 46);
              _t4255: {
                if (_t4253._tag === 0) {
                  _t4254 = [({_tag: 0, _name: "None"}), name];
                  break _t4255;
                }
                if (_t4253._tag === 1) {
                  const i = _t4253._val;
                  const _mml$short_4256 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                  const class_prefix_4258 = String$sub(name, 0, i);
                  const mod_prefix_4260 = String$sub(name, 0, (i + 1));
                  let _t4263;
                  const _t4262 = Types$find_method_class(type_env.classes, _mml$short_4256);
                  _t4264: {
                    if (_t4262._tag === 1) {
                      const class_def = _t4262._val;
                      if (((!(_mml$short_4256 === binding_name)) && ((class_def.class_name === class_prefix_4258) || ((String$length(class_def.class_name) > String$length(mod_prefix_4260)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_4260)) === mod_prefix_4260))))) {
                        const method_ty_4265 = List$assoc(_mml$short_4256, class_def.class_methods);
                        let _t4268;
                        const _t4267 = List$assoc_opt(name, vars);
                        _t4269: {
                          if (_t4267._tag === 1) {
                            const r = _t4267;
                            _t4268 = r;
                            break _t4269;
                          }
                          if (_t4267._tag === 0) {
                            _t4268 = List$assoc_opt(_mml$short_4256, vars);
                            break _t4269;
                          }
                          _match_fail("line 16629");
                        }
                        const var_sch_4270 = _t4268;
                        let _t4273;
                        const _t4272 = var_sch_4270;
                        _t4274: {
                          if (_t4272._tag === 1) {
                            const s = _t4272._val;
                            let _t4275;
                            if (_eq(s.body, method_ty_4265)) {
                              _t4275 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_4256];
                            } else {
                              _t4275 = [({_tag: 0, _name: "None"}), name];
                            }
                            _t4273 = _t4275;
                            break _t4274;
                          }
                          if (_t4272._tag === 0) {
                            _t4273 = [({_tag: 0, _name: "None"}), name];
                            break _t4274;
                          }
                          _match_fail("line 16629");
                        }
                        const _t4271 = _t4273;
                        const _t4266 = _t4271;
                        _t4263 = _t4266;
                        break _t4264;
                      }
                    }
                    if (true) {
                      _t4263 = [({_tag: 0, _name: "None"}), name];
                      break _t4264;
                    }
                    _match_fail("line 16629");
                  }
                  const _t4261 = _t4263;
                  const _t4259 = _t4261;
                  const _t4257 = _t4259;
                  _t4254 = _t4257;
                  break _t4255;
                }
                _match_fail("line 16629");
              }
              _t4245 = _t4254;
              break _t4246;
            }
            _match_fail("line 16629");
          }
          let _t4277;
          const _t4276 = _t4245;
          _t4278: {
            if (true) {
              const class_match = _t4276[0];
              const method_name = _t4276[1];
              let _t4280;
              const _t4279 = class_match;
              _t4281: {
                if (_t4279._tag === 1) {
                  const class_def = _t4279._val;
                  const method_schema_ty_4282 = List$assoc(method_name, class_def.class_methods);
                  const num_params_4284 = List$length(class_def.class_params);
                  const param_map_4286 = Hashtbl$create(num_params_4284);
                  function go(s, r) {
                    while (true) {
                      const r_4288 = Types$repr(r);
                      let _t4291;
                      const _t4290 = [s, r_4288];
                      _t4292: {
                        if (_t4290[0]._tag === 16) {
                          const i = _t4290[0]._val;
                          if ((i < num_params_4284)) {
                            let _t4293;
                            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, param_map_4286, i]))) {
                              _t4293 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, param_map_4286, i, r_4288]);
                            } else {
                              _t4293 = undefined;
                            }
                            _t4291 = _t4293;
                            break _t4292;
                          }
                        }
                        if ((_t4290[0]._tag === 7 && _t4290[1]._tag === 7 || _t4290[0]._tag === 8 && _t4290[1]._tag === 8)) {
                          const s1 = _t4290[0]._val[0];
                          const s2 = _t4290[0]._val[2];
                          const r1 = _t4290[1]._val[0];
                          const r2 = _t4290[1]._val[2];
                          go(s1, r1);
                          const _t4294 = s2;
                          const _t4295 = r2;
                          s = _t4294;
                          r = _t4295;
                          continue;
                          _t4291 = undefined;
                          break _t4292;
                        }
                        if (_t4290[0]._tag === 9 && _t4290[1]._tag === 9) {
                          const ss = _t4290[0]._val;
                          const rs = _t4290[1]._val;
                          if ((List$length(ss) === List$length(rs))) {
                            _t4291 = List$iter2(go, ss, rs);
                            break _t4292;
                          }
                        }
                        if (_t4290[0]._tag === 10 && _t4290[1]._tag === 10) {
                          const s1 = _t4290[0]._val;
                          const r1 = _t4290[1]._val;
                          const _t4296 = s1;
                          const _t4297 = r1;
                          s = _t4296;
                          r = _t4297;
                          continue;
                          _t4291 = undefined;
                          break _t4292;
                        }
                        if (_t4290[0]._tag === 13 && _t4290[1]._tag === 13) {
                          const s1 = _t4290[0]._val;
                          const r1 = _t4290[1]._val;
                          const _t4298 = s1;
                          const _t4299 = r1;
                          s = _t4298;
                          r = _t4299;
                          continue;
                          _t4291 = undefined;
                          break _t4292;
                        }
                        if (_t4290[0]._tag === 12 && _t4290[1]._tag === 12) {
                          const ss = _t4290[0]._val[1];
                          const rs = _t4290[1]._val[1];
                          if ((List$length(ss) === List$length(rs))) {
                            _t4291 = List$iter2(go, ss, rs);
                            break _t4292;
                          }
                        }
                        if (true) {
                          _t4291 = undefined;
                          break _t4292;
                        }
                        _match_fail("line 16629");
                      }
                      const _t4289 = _t4291;
                      return _t4289;
                    }
                  }
                  go(method_schema_ty_4282, te.ty);
                  function _t4301(i) {
                    let _t4303;
                    const _t4302 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, param_map_4286, i]);
                    _t4304: {
                      if (_t4302._tag === 1 && _t4302._val._tag === 15 && _t4302._val._val.contents._tag === 0) {
                        const id = _t4302._val._val.contents._val[0];
                        const tv = _t4302._val;
                        let _t4306;
                        const _t4305 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map_4078, id]);
                        _t4307: {
                          if (_t4305._tag === 1 && _t4305._val._tag === 16) {
                            const tgen_idx = _t4305._val._val;
                            _t4306 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "CATGen", _val: tgen_idx})});
                            break _t4307;
                          }
                          if (true) {
                            function _t4308(fd) {
                              return List$mem(i, fd.fd_to);
                            }
                            const is_fundep_target_4309 = List$exists(_t4308, class_def.class_fundeps);
                            let _t4311;
                            if (is_fundep_target_4309) {
                              let _t4313;
                              const _t4312 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tvar_to_phantom_4158, id]);
                              _t4314: {
                                if (_t4312._tag === 1) {
                                  const idx = _t4312._val;
                                  _t4313 = idx;
                                  break _t4314;
                                }
                                if (_t4312._tag === 0) {
                                  const idx_4315 = Ref$get(phantom_counter_4156);
                                  Ref$set(phantom_counter_4156, (Ref$get(phantom_counter_4156) + 1));
                                  _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tvar_to_phantom_4158, id, idx_4315]);
                                  const _t4316 = idx_4315;
                                  _t4313 = _t4316;
                                  break _t4314;
                                }
                                _match_fail("line 16629");
                              }
                              const phantom_idx_4317 = _t4313;
                              const _t4318 = ({_tag: 1, _name: "Some", _val: ({_tag: 3, _name: "CAPhantom", _val: [phantom_idx_4317, tv]})});
                              _t4311 = _t4318;
                            } else {
                              _t4311 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "CATy", _val: tv})});
                            }
                            const _t4310 = _t4311;
                            _t4306 = _t4310;
                            break _t4307;
                          }
                          _match_fail("line 16629");
                        }
                        _t4303 = _t4306;
                        break _t4304;
                      }
                      if (_t4302._tag === 1) {
                        const ty = _t4302._val;
                        _t4303 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "CATy", _val: ty})});
                        break _t4304;
                      }
                      if (_t4302._tag === 0) {
                        function _t4319(fd) {
                          return List$mem(i, fd.fd_to);
                        }
                        const is_fundep_target_4320 = List$exists(_t4319, class_def.class_fundeps);
                        let _t4322;
                        if (is_fundep_target_4320) {
                          _t4322 = ({_tag: 1, _name: "Some", _val: ({_tag: 2, _name: "CAWild"})});
                        } else {
                          _t4322 = ({_tag: 0, _name: "None"});
                        }
                        const _t4321 = _t4322;
                        _t4303 = _t4321;
                        break _t4304;
                      }
                      _match_fail("line 16629");
                    }
                    return _t4303;
                  }
                  const cc_args_4323 = List$init(num_params_4284, _t4301);
                  function _t4325(opt) {
                    let _t4327;
                    const _t4326 = opt;
                    _t4328: {
                      if (_t4326._tag === 1 && _t4326._val._tag === 1) {
                        const ty = _t4326._val._val;
                        _t4327 = (!Types$is_concrete(ty));
                        break _t4328;
                      }
                      if (true) {
                        _t4327 = false;
                        break _t4328;
                      }
                      _match_fail("line 16629");
                    }
                    return _t4327;
                  }
                  const has_nonconc_caty_4329 = List$exists(_t4325, cc_args_4323);
                  function _t4331(opt) {
                    let _t4333;
                    const _t4332 = opt;
                    _t4334: {
                      if (_t4332._tag === 1 && _t4332._val._tag === 1) {
                        _t4333 = true;
                        break _t4334;
                      }
                      if (true) {
                        _t4333 = false;
                        break _t4334;
                      }
                      _match_fail("line 16629");
                    }
                    return _t4333;
                  }
                  const has_any_caty_4335 = List$exists(_t4331, cc_args_4323);
                  let _t4337;
                  if (has_nonconc_caty_4329) {
                    function _t4338(opt) {
                      let _t4340;
                      const _t4339 = opt;
                      _t4341: {
                        if (_t4339._tag === 1 && _t4339._val._tag === 2) {
                          _t4340 = ({_tag: 0, _name: "None"});
                          break _t4341;
                        }
                        if (_t4339._tag === 1 && _t4339._val._tag === 3) {
                          _t4340 = ({_tag: 0, _name: "None"});
                          break _t4341;
                        }
                        if (true) {
                          _t4340 = opt;
                          break _t4341;
                        }
                        _match_fail("line 16629");
                      }
                      return _t4340;
                    }
                    _t4337 = List$map(_t4338, cc_args_4323);
                  } else {
                    _t4337 = cc_args_4323;
                  }
                  const cc_args_4342 = _t4337;
                  function _t4344(opt) {
                    let _t4346;
                    const _t4345 = opt;
                    _t4347: {
                      if (_t4345._tag === 1 && _t4345._val._tag === 0) {
                        _t4346 = true;
                        break _t4347;
                      }
                      if (true) {
                        _t4346 = false;
                        break _t4347;
                      }
                      _match_fail("line 16629");
                    }
                    return _t4346;
                  }
                  const has_tgen_4348 = List$exists(_t4344, cc_args_4342);
                  const has_caty_4350 = has_any_caty_4335;
                  function _t4352(opt) {
                    return !_eq(opt, ({_tag: 0, _name: "None"}));
                  }
                  const all_resolved_4353 = List$forall(_t4352, cc_args_4342);
                  let _t4360;
                  if (has_tgen_4348) {
                  let _t4359;
                  if (all_resolved_4353) {
                  let _t4358;
                  if ((!has_caty_4350)) {
                    _t4358 = true;
                  } else {
                  let _t4356;
                  const _t4355 = scheme.body;
                  _t4357: {
                    if ((_t4355._tag === 7 || _t4355._tag === 8)) {
                      _t4356 = true;
                      break _t4357;
                    }
                    if (true) {
                      _t4356 = false;
                      break _t4357;
                    }
                    _match_fail("line 16629");
                  }
                    _t4358 = _t4356;
                  }
                    _t4359 = _t4358;
                  } else {
                    _t4359 = false;
                  }
                    _t4360 = _t4359;
                  } else {
                    _t4360 = false;
                  }
                  const allow_4361 = _t4360;
                  let _t4363;
                  if (allow_4361) {
                    function _t4364(x) {
                      return x;
                    }
                    const cc_args_4365 = List$filter_map(_t4364, cc_args_4342);
                    const _t4366 = set_add_4163(found_multi_4152, [class_def.class_name, cc_args_4365]);
                    _t4363 = _t4366;
                  } else {
                    let _t4367;
                    if (((!has_tgen_4348) && all_resolved_4353)) {
                      function _t4368(opt) {
                        let _t4370;
                        const _t4369 = opt;
                        _t4371: {
                          if (_t4369._tag === 1 && _t4369._val._tag === 1 && _t4369._val._val._tag === 15 && _t4369._val._val._val.contents._tag === 0) {
                            _t4370 = true;
                            break _t4371;
                          }
                          if (true) {
                            _t4370 = false;
                            break _t4371;
                          }
                          _match_fail("line 16629");
                        }
                        return _t4370;
                      }
                      const has_unbound_caty_4372 = List$exists(_t4368, cc_args_4342);
                      let _t4375;
                      const _t4374 = scheme.body;
                      _t4376: {
                        if ((_t4374._tag === 7 || _t4374._tag === 8)) {
                          _t4375 = true;
                          break _t4376;
                        }
                        if (true) {
                          _t4375 = false;
                          break _t4376;
                        }
                        _match_fail("line 16629");
                      }
                      const is_arrow_4377 = _t4375;
                      let _t4379;
                      if ((has_unbound_caty_4372 && is_arrow_4377)) {
                        function _t4380(x) {
                          return x;
                        }
                        const cc_args_4381 = List$filter_map(_t4380, cc_args_4342);
                        const _t4382 = set_add_4163(pending_caty_4154, [class_def.class_name, cc_args_4381]);
                        _t4379 = _t4382;
                      } else {
                        _t4379 = undefined;
                      }
                      const _t4378 = _t4379;
                      const _t4373 = _t4378;
                      _t4367 = _t4373;
                    } else {
                      _t4367 = undefined;
                    }
                    _t4363 = _t4367;
                  }
                  const _t4362 = _t4363;
                  const _t4354 = _t4362;
                  const _t4351 = _t4354;
                  const _t4349 = _t4351;
                  const _t4343 = _t4349;
                  const _t4336 = _t4343;
                  const _t4330 = _t4336;
                  const _t4324 = _t4330;
                  const _t4300 = _t4324;
                  const _t4287 = _t4300;
                  const _t4285 = _t4287;
                  const _t4283 = _t4285;
                  _t4280 = _t4283;
                  break _t4281;
                }
                if (_t4279._tag === 0) {
                  _t4280 = undefined;
                  break _t4281;
                }
                _match_fail("line 16629");
              }
              _t4277 = _t4280;
              break _t4278;
            }
            _match_fail("line 16629");
          }
          _t4236 = _t4277;
          break _t4237;
        }
        if (true) {
          _t4236 = undefined;
          break _t4237;
        }
        _match_fail("line 16629");
      }
      _t4236;
      return walk_children(locals, te);
    }
    function walk_children(locals, te) {
      let _t4384;
      const _t4383 = te.expr;
      _t4385: {
        if ((((((((((_t4383._tag === 0 || _t4383._tag === 1) || _t4383._tag === 2) || _t4383._tag === 3) || _t4383._tag === 4) || _t4383._tag === 5) || _t4383._tag === 6) || _t4383._tag === 7) || _t4383._tag === 22) || _t4383._tag === 34)) {
          _t4384 = undefined;
          break _t4385;
        }
        if ((_t4383._tag === 8 && _t4383._val[1]._tag === 1 || _t4383._tag === 9 && _t4383._val[1]._tag === 1)) {
          const name = _t4383._val[0];
          const sch = _t4383._val[1]._val;
          const _e1 = _t4383._val[2];
          const e2 = _t4383._val[3];
          _t4384 = walk(({_hd: [name, sch], _tl: locals}), e2);
          break _t4385;
        }
        if ((_t4383._tag === 8 && _t4383._val[1]._tag === 0 || _t4383._tag === 9 && _t4383._val[1]._tag === 0)) {
          const name = _t4383._val[0];
          const e1 = _t4383._val[2];
          const e2 = _t4383._val[3];
          let _t4387;
          const _t4386 = Types$repr(e1.ty);
          _t4388: {
            if (_t4386._tag === 15 && _t4386._val.contents._tag === 0) {
              let _t4390;
              const _t4389 = Typechecker$find_var_type_in(name, e2);
              _t4391: {
                if (_t4389._tag === 1) {
                  const inst_ty = _t4389._val;
                  let _t4393;
                  const _t4392 = Types$repr(inst_ty);
                  _t4394: {
                    if (_t4392._tag === 15 && _t4392._val.contents._tag === 0) {
                      _t4393 = Types$unify(e1.ty, inst_ty);
                      break _t4394;
                    }
                    if (true) {
                      _t4393 = undefined;
                      break _t4394;
                    }
                    _match_fail("line 16629");
                  }
                  _t4390 = _t4393;
                  break _t4391;
                }
                if (_t4389._tag === 0) {
                  _t4390 = undefined;
                  break _t4391;
                }
                _match_fail("line 16629");
              }
              _t4387 = _t4390;
              break _t4388;
            }
            if (true) {
              _t4387 = undefined;
              break _t4388;
            }
            _match_fail("line 16629");
          }
          _t4387;
          walk(locals, e1);
          _t4384 = walk(locals, e2);
          break _t4385;
        }
        if ((((((((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) || _t4383._tag === 28) || _t4383._tag === 32) || _t4383._tag === 31) || _t4383._tag === 27) || _t4383._tag === 20)) {
          const e1 = (((((((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) || _t4383._tag === 28) || _t4383._tag === 32) || _t4383._tag === 31) || _t4383._tag === 27) ? ((((((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) || _t4383._tag === 28) || _t4383._tag === 32) || _t4383._tag === 31) ? (((((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) || _t4383._tag === 28) || _t4383._tag === 32) ? ((((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) || _t4383._tag === 28) ? (((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) ? ((_t4383._tag === 25 || _t4383._tag === 13) ? _t4383._val[1] : _t4383._val[0]) : _t4383._val[0]) : _t4383._val[0]) : _t4383._val[0]) : _t4383._val[0]) : _t4383._val[0]);
          const e2 = (((((((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) || _t4383._tag === 28) || _t4383._tag === 32) || _t4383._tag === 31) || _t4383._tag === 27) ? ((((((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) || _t4383._tag === 28) || _t4383._tag === 32) || _t4383._tag === 31) ? (((((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) || _t4383._tag === 28) || _t4383._tag === 32) ? ((((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) || _t4383._tag === 28) ? (((_t4383._tag === 25 || _t4383._tag === 13) || _t4383._tag === 21) ? ((_t4383._tag === 25 || _t4383._tag === 13) ? _t4383._val[2] : _t4383._val[1]) : _t4383._val[1]) : _t4383._val[1]) : _t4383._val[1]) : _t4383._val[2]) : _t4383._val[1]);
          walk(locals, e1);
          _t4384 = walk(locals, e2);
          break _t4385;
        }
        if (_t4383._tag === 11) {
          const fn_ = _t4383._val[0];
          const arg = _t4383._val[1];
          walk(locals, fn_);
          _t4384 = walk(locals, arg);
          break _t4385;
        }
        if (((((((((_t4383._tag === 29 || _t4383._tag === 14) || _t4383._tag === 10) || _t4383._tag === 19) || _t4383._tag === 33) || _t4383._tag === 35) || _t4383._tag === 36) || _t4383._tag === 39) || _t4383._tag === 26)) {
          const e = ((((((((_t4383._tag === 29 || _t4383._tag === 14) || _t4383._tag === 10) || _t4383._tag === 19) || _t4383._tag === 33) || _t4383._tag === 35) || _t4383._tag === 36) || _t4383._tag === 39) ? (((((((_t4383._tag === 29 || _t4383._tag === 14) || _t4383._tag === 10) || _t4383._tag === 19) || _t4383._tag === 33) || _t4383._tag === 35) || _t4383._tag === 36) ? ((((((_t4383._tag === 29 || _t4383._tag === 14) || _t4383._tag === 10) || _t4383._tag === 19) || _t4383._tag === 33) || _t4383._tag === 35) ? (((((_t4383._tag === 29 || _t4383._tag === 14) || _t4383._tag === 10) || _t4383._tag === 19) || _t4383._tag === 33) ? ((((_t4383._tag === 29 || _t4383._tag === 14) || _t4383._tag === 10) || _t4383._tag === 19) ? (((_t4383._tag === 29 || _t4383._tag === 14) || _t4383._tag === 10) ? _t4383._val[1] : _t4383._val[0]) : _t4383._val) : _t4383._val) : _t4383._val) : _t4383._val) : _t4383._val[1]);
          _t4384 = walk(locals, e);
          break _t4385;
        }
        if (_t4383._tag === 12) {
          const c = _t4383._val[0];
          const t = _t4383._val[1];
          const e = _t4383._val[2];
          walk(locals, c);
          walk(locals, t);
          _t4384 = walk(locals, e);
          break _t4385;
        }
        if ((_t4383._tag === 15 || _t4383._tag === 38)) {
          const es = _t4383._val;
          _t4384 = List$iter(_call(walk, [locals]), es);
          break _t4385;
        }
        if (_t4383._tag === 16) {
          const fields = _t4383._val;
          function _t4395(__p82) {
            let _t4397;
            const _t4396 = __p82;
            _t4398: {
              if (true) {
                const e = _t4396[1];
                _t4397 = walk(locals, e);
                break _t4398;
              }
              _match_fail("line 16629");
            }
            return _t4397;
          }
          _t4384 = List$iter(_t4395, fields);
          break _t4385;
        }
        if (_t4383._tag === 17) {
          const base = _t4383._val[0];
          const overrides = _t4383._val[1];
          walk(locals, base);
          function _t4399(__p83) {
            let _t4401;
            const _t4400 = __p83;
            _t4402: {
              if (true) {
                const e = _t4400[1];
                _t4401 = walk(locals, e);
                break _t4402;
              }
              _match_fail("line 16629");
            }
            return _t4401;
          }
          _t4384 = List$iter(_t4399, overrides);
          break _t4385;
        }
        if (_t4383._tag === 18) {
          const base = _t4383._val[0];
          const pairs = _t4383._val[1];
          walk(locals, base);
          function _t4403(__p84) {
            let _t4405;
            const _t4404 = __p84;
            _t4406: {
              if (true) {
                const i = _t4404[0];
                const v = _t4404[1];
                walk(locals, i);
                _t4405 = walk(locals, v);
                break _t4406;
              }
              _match_fail("line 16629");
            }
            return _t4405;
          }
          _t4384 = List$iter(_t4403, pairs);
          break _t4385;
        }
        if (_t4383._tag === 23) {
          const arg = _t4383._val[1];
          _t4384 = Option$iter(_call(walk, [locals]), arg);
          break _t4385;
        }
        if (_t4383._tag === 24) {
          const scrutinee = _t4383._val[0];
          const arms = _t4383._val[1];
          walk(locals, scrutinee);
          function _t4407(__p85) {
            let _t4409;
            const _t4408 = __p85;
            _t4410: {
              if (true) {
                const guard = _t4408[1];
                const body = _t4408[2];
                Option$iter(_call(walk, [locals]), guard);
                _t4409 = walk(locals, body);
                break _t4410;
              }
              _match_fail("line 16629");
            }
            return _t4409;
          }
          _t4384 = List$iter(_t4407, arms);
          break _t4385;
        }
        if (_t4383._tag === 30) {
          const body = _t4383._val[0];
          const arms = _t4383._val[1];
          walk(locals, body);
          function _t4411(arm) {
            let _t4413;
            const _t4412 = arm;
            _t4414: {
              if ((((_t4412._tag === 0 || _t4412._tag === 1) || _t4412._tag === 2) || _t4412._tag === 3)) {
                const e = (((_t4412._tag === 0 || _t4412._tag === 1) || _t4412._tag === 2) ? ((_t4412._tag === 0 || _t4412._tag === 1) ? (_t4412._tag === 0 ? _t4412._val[1] : _t4412._val[3]) : _t4412._val[2]) : _t4412._val[2]);
                _t4413 = walk(locals, e);
                break _t4414;
              }
              _match_fail("line 16629");
            }
            return _t4413;
          }
          _t4384 = List$iter(_t4411, arms);
          break _t4385;
        }
        if (_t4383._tag === 37) {
          const bindings = _t4383._val[0];
          const body = _t4383._val[1];
          function _t4415(__p86) {
            let _t4417;
            const _t4416 = __p86;
            _t4418: {
              if (true) {
                const e = _t4416[1];
                _t4417 = walk(locals, e);
                break _t4418;
              }
              _match_fail("line 16629");
            }
            return _t4417;
          }
          List$iter(_t4415, bindings);
          _t4384 = walk(locals, body);
          break _t4385;
        }
        _match_fail("line 16629");
      }
      return _t4384;
    }
    walk(null, te);
    const changed_4420 = Ref$create(true);
    let _t4422 = undefined;
    let _t4423 = false, _t4424;
    while (true) {
      if (!(Ref$get(changed_4420))) break;
      Ref$set(changed_4420, false);
      function _t4425(acc, __p87) {
        let _t4427;
        const _t4426 = __p87;
        _t4428: {
          if (true) {
            const cls = _t4426[0];
            const args = _t4426[1];
            function _t4429(ca) {
              let _t4431;
              const _t4430 = ca;
              _t4432: {
                if (_t4430._tag === 1 && _t4430._val._tag === 15 && _t4430._val._val.contents._tag === 0) {
                  const id = _t4430._val._val.contents._val[0];
                  function _t4433(__p88) {
                    let _t4435;
                    const _t4434 = __p88;
                    _t4436: {
                      if (true) {
                        const _c = _t4434[0];
                        const fargs = _t4434[1];
                        function _t4437(fa) {
                          let _t4439;
                          const _t4438 = fa;
                          _t4440: {
                            if (_t4438._tag === 1 && _t4438._val._tag === 15 && _t4438._val._val.contents._tag === 0) {
                              const fid = _t4438._val._val.contents._val[0];
                              _t4439 = (fid === id);
                              break _t4440;
                            }
                            if (_t4438._tag === 3 && _t4438._val[1]._tag === 15 && _t4438._val[1]._val.contents._tag === 0) {
                              const fid = _t4438._val[1]._val.contents._val[0];
                              _t4439 = (fid === id);
                              break _t4440;
                            }
                            if (true) {
                              _t4439 = false;
                              break _t4440;
                            }
                            _match_fail("line 16629");
                          }
                          return _t4439;
                        }
                        _t4435 = List$exists(_t4437, fargs);
                        break _t4436;
                      }
                      _match_fail("line 16629");
                    }
                    return _t4435;
                  }
                  _t4431 = List$exists(_t4433, Ref$get(found_multi_4152));
                  break _t4432;
                }
                if (true) {
                  _t4431 = false;
                  break _t4432;
                }
                _match_fail("line 16629");
              }
              return _t4431;
            }
            const dominated_4441 = List$exists(_t4429, args);
            let _t4443;
            if (dominated_4441) {
              _t4443 = ({_hd: [cls, args], _tl: acc});
            } else {
              _t4443 = acc;
            }
            const _t4442 = _t4443;
            _t4427 = _t4442;
            break _t4428;
          }
          _match_fail("line 16629");
        }
        return _t4427;
      }
      const to_promote_4444 = List$fold(_t4425, null, Ref$get(pending_caty_4154));
      function _t4446(__p89) {
        let _t4448;
        const _t4447 = __p89;
        _t4449: {
          if (true) {
            const cls = _t4447[0];
            const args = _t4447[1];
            function _t4450(ca) {
              let _t4452;
              const _t4451 = ca;
              _t4453: {
                if (_t4451._tag === 1 && _t4451._val._tag === 15 && _t4451._val._val.contents._tag === 0) {
                  const id = _t4451._val._val.contents._val[0];
                  const tv = _t4451._val;
                  const phantom_idx_4454 = Ref$create(({_tag: 0, _name: "None"}));
                  function _t4456(__p90) {
                    let _t4458;
                    const _t4457 = __p90;
                    _t4459: {
                      if (true) {
                        const _c = _t4457[0];
                        const fargs = _t4457[1];
                        function _t4460(fa) {
                          let _t4462;
                          const _t4461 = fa;
                          _t4463: {
                            if (_t4461._tag === 3 && _t4461._val[1]._tag === 15 && _t4461._val[1]._val.contents._tag === 0) {
                              const idx = _t4461._val[0];
                              const fid = _t4461._val[1]._val.contents._val[0];
                              if ((fid === id)) {
                                _t4462 = Ref$set(phantom_idx_4454, ({_tag: 1, _name: "Some", _val: idx}));
                                break _t4463;
                              }
                            }
                            if (true) {
                              _t4462 = undefined;
                              break _t4463;
                            }
                            _match_fail("line 16629");
                          }
                          return _t4462;
                        }
                        _t4458 = List$iter(_t4460, fargs);
                        break _t4459;
                      }
                      _match_fail("line 16629");
                    }
                    return _t4458;
                  }
                  List$iter(_t4456, Ref$get(found_multi_4152));
                  let _t4465;
                  const _t4464 = Ref$get(phantom_idx_4454);
                  _t4466: {
                    if (_t4464._tag === 1) {
                      const idx = _t4464._val;
                      _t4465 = ({_tag: 3, _name: "CAPhantom", _val: [idx, tv]});
                      break _t4466;
                    }
                    if (_t4464._tag === 0) {
                      _t4465 = ca;
                      break _t4466;
                    }
                    _match_fail("line 16629");
                  }
                  const _t4455 = _t4465;
                  _t4452 = _t4455;
                  break _t4453;
                }
                if (true) {
                  _t4452 = ca;
                  break _t4453;
                }
                _match_fail("line 16629");
              }
              return _t4452;
            }
            const promoted_args_4467 = List$map(_t4450, args);
            function _t4469(k) {
              return !_eq(k, [cls, args]);
            }
            Ref$set(pending_caty_4154, List$filter(_t4469, Ref$get(pending_caty_4154)));
            set_add_4163(found_multi_4152, [cls, promoted_args_4467]);
            const _t4468 = Ref$set(changed_4420, true);
            _t4448 = _t4468;
            break _t4449;
          }
          _match_fail("line 16629");
        }
        return _t4448;
      }
      const _t4445 = List$iter(_t4446, to_promote_4444);
      _t4445;
      if (_t4423) break;
    }
    _t4422 = _t4423 ? _t4424 : undefined;
    _t4422;
    function _t4470(acc, __p91) {
      let _t4472;
      const _t4471 = __p91;
      _t4473: {
        if (true) {
          const class_name = _t4471[0];
          const cc_args = _t4471[1];
          function _t4474(cc) {
            return ((cc.cc_class === class_name) && _eq(cc.cc_args, cc_args));
          }
          const exists_4475 = List$exists(_t4474, acc);
          let _t4477;
          if (exists_4475) {
            _t4477 = acc;
          } else {
            _t4477 = ({_hd: ({cc_args: cc_args, cc_class: class_name}), _tl: acc});
          }
          const _t4476 = _t4477;
          _t4472 = _t4476;
          break _t4473;
        }
        _match_fail("line 16629");
      }
      return _t4472;
    }
    const cc_list_4478 = List$fold(_t4470, null, Ref$get(found_multi_4152));
    let _t4480;
    if (_eq(cc_list_4478, null)) {
      _t4480 = scheme;
    } else {
      function _t4481(a, b) {
        function _t4482(args) {
          function _t4483(ca) {
            let _t4485;
            const _t4484 = ca;
            _t4486: {
              if (_t4484._tag === 0) {
                _t4485 = true;
                break _t4486;
              }
              if (true) {
                _t4485 = false;
                break _t4486;
              }
              _match_fail("line 16629");
            }
            return _t4485;
          }
          return List$length(List$filter(_t4483, args));
        }
        const count_catgen_4487 = _t4482;
        const _t4488 = compare(count_catgen_4487(b.cc_args), count_catgen_4487(a.cc_args));
        return _t4488;
      }
      const cc_list_4489 = List$sort(_t4481, cc_list_4478);
      const __rec_upd_4491 = scheme;
      const _t4492 = ({body: __rec_upd_4491.body, constraints: cc_list_4489, equant: __rec_upd_4491.equant, pvquant: __rec_upd_4491.pvquant, quant: __rec_upd_4491.quant, record_evidences: __rec_upd_4491.record_evidences, rquant: __rec_upd_4491.rquant});
      const _t4490 = _t4492;
      _t4480 = _t4490;
    }
    const _t4479 = _t4480;
    const _t4421 = _t4479;
    const _t4419 = _t4421;
    const _t4234 = _t4419;
    const _t4164 = _t4234;
    const _t4159 = _t4164;
    const _t4157 = _t4159;
    const _t4155 = _t4157;
    const _t4153 = _t4155;
    const _t4151 = _t4153;
    const _t4079 = _t4151;
    _t4077 = _t4079;
  }
  return _t4077;
}
function Typechecker$build_rgen_map(schema_ty, actual_ty) {
  const map_4493 = Hashtbl$create(4);
  function walk(s, a) {
    while (true) {
      const a_4495 = Types$repr(a);
      let _t4498;
      const _t4497 = s;
      _t4499: {
        if (_t4497._tag === 7) {
          const s1 = _t4497._val[0];
          const s2 = _t4497._val[2];
          let _t4501;
          const _t4500 = a_4495;
          _t4502: {
            if (_t4500._tag === 7) {
              const a1 = _t4500._val[0];
              const a2 = _t4500._val[2];
              walk(s1, a1);
              const _t4503 = s2;
              const _t4504 = a2;
              s = _t4503;
              a = _t4504;
              continue;
              _t4501 = undefined;
              break _t4502;
            }
            if (true) {
              _t4501 = undefined;
              break _t4502;
            }
            _match_fail("line 16629");
          }
          _t4498 = _t4501;
          break _t4499;
        }
        if (_t4497._tag === 8) {
          const s1 = _t4497._val[0];
          const s2 = _t4497._val[2];
          let _t4506;
          const _t4505 = a_4495;
          _t4507: {
            if (_t4505._tag === 8) {
              const a1 = _t4505._val[0];
              const a2 = _t4505._val[2];
              walk(s1, a1);
              const _t4508 = s2;
              const _t4509 = a2;
              s = _t4508;
              a = _t4509;
              continue;
              _t4506 = undefined;
              break _t4507;
            }
            if (true) {
              _t4506 = undefined;
              break _t4507;
            }
            _match_fail("line 16629");
          }
          _t4498 = _t4506;
          break _t4499;
        }
        if (_t4497._tag === 9) {
          const ss = _t4497._val;
          let _t4511;
          const _t4510 = a_4495;
          _t4512: {
            if (_t4510._tag === 9) {
              const aa = _t4510._val;
              if ((List$length(ss) === List$length(aa))) {
                _t4511 = List$iter2(walk, ss, aa);
                break _t4512;
              }
            }
            if (true) {
              _t4511 = undefined;
              break _t4512;
            }
            _match_fail("line 16629");
          }
          _t4498 = _t4511;
          break _t4499;
        }
        if (_t4497._tag === 10) {
          const s1 = _t4497._val;
          let _t4514;
          const _t4513 = a_4495;
          _t4515: {
            if (_t4513._tag === 10) {
              const a1 = _t4513._val;
              const _t4516 = s1;
              const _t4517 = a1;
              s = _t4516;
              a = _t4517;
              continue;
              _t4514 = undefined;
              break _t4515;
            }
            if (true) {
              _t4514 = undefined;
              break _t4515;
            }
            _match_fail("line 16629");
          }
          _t4498 = _t4514;
          break _t4499;
        }
        if (_t4497._tag === 13) {
          const s1 = _t4497._val;
          let _t4519;
          const _t4518 = a_4495;
          _t4520: {
            if (_t4518._tag === 13) {
              const a1 = _t4518._val;
              const _t4521 = s1;
              const _t4522 = a1;
              s = _t4521;
              a = _t4522;
              continue;
              _t4519 = undefined;
              break _t4520;
            }
            if (true) {
              _t4519 = undefined;
              break _t4520;
            }
            _match_fail("line 16629");
          }
          _t4498 = _t4519;
          break _t4499;
        }
        if (_t4497._tag === 12) {
          const ss = _t4497._val[1];
          let _t4524;
          const _t4523 = a_4495;
          _t4525: {
            if (_t4523._tag === 12) {
              const aa = _t4523._val[1];
              if ((List$length(ss) === List$length(aa))) {
                _t4524 = List$iter2(walk, ss, aa);
                break _t4525;
              }
            }
            if (true) {
              _t4524 = undefined;
              break _t4525;
            }
            _match_fail("line 16629");
          }
          _t4498 = _t4524;
          break _t4499;
        }
        if (_t4497._tag === 11) {
          const srow = _t4497._val;
          let _t4527;
          const _t4526 = a_4495;
          _t4528: {
            if (_t4526._tag === 11) {
              const arow = _t4526._val;
              walk_rrows(srow, arow);
              const sf_4529 = Types$record_row_to_fields(srow);
              const af_4531 = Types$record_row_to_fields(arow);
              function _t4533(__p92) {
                let _t4535;
                const _t4534 = __p92;
                _t4536: {
                  if (true) {
                    const name = _t4534[0];
                    const sty = _t4534[1];
                    let _t4538;
                    const _t4537 = List$assoc_opt(name, af_4531);
                    _t4539: {
                      if (_t4537._tag === 1) {
                        const aty = _t4537._val;
                        _t4538 = walk(sty, aty);
                        break _t4539;
                      }
                      if (_t4537._tag === 0) {
                        _t4538 = undefined;
                        break _t4539;
                      }
                      _match_fail("line 16629");
                    }
                    _t4535 = _t4538;
                    break _t4536;
                  }
                  _match_fail("line 16629");
                }
                return _t4535;
              }
              const _t4532 = List$iter(_t4533, sf_4529);
              const _t4530 = _t4532;
              _t4527 = _t4530;
              break _t4528;
            }
            if (true) {
              _t4527 = undefined;
              break _t4528;
            }
            _match_fail("line 16629");
          }
          _t4498 = _t4527;
          break _t4499;
        }
        if (true) {
          _t4498 = undefined;
          break _t4499;
        }
        _match_fail("line 16629");
      }
      const _t4496 = _t4498;
      return _t4496;
    }
  }
  function walk_rrows(srow, arow) {
    while (true) {
      let _t4541;
      const _t4540 = srow;
      _t4542: {
        if (_t4540._tag === 3) {
          const i = _t4540._val;
          let _t4543;
          if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, map_4493, i]))) {
            _t4543 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, map_4493, i, arow]);
          } else {
            _t4543 = undefined;
          }
          _t4541 = _t4543;
          break _t4542;
        }
        if (_t4540._tag === 0) {
          const stail = _t4540._val[2];
          const _t4544 = stail;
          const _t4545 = arow;
          srow = _t4544;
          arow = _t4545;
          continue;
          _t4541 = undefined;
          break _t4542;
        }
        if (true) {
          _t4541 = undefined;
          break _t4542;
        }
        _match_fail("line 16629");
      }
      return _t4541;
    }
  }
  walk(schema_ty, actual_ty);
  const _t4546 = map_4493;
  const _t4494 = _t4546;
  return _t4494;
}
function Typechecker$infer_record_evidence(vars, te, scheme) {
  let _t4547;
  if ((scheme.rquant === 0)) {
    _t4547 = scheme;
  } else {
    const rvar_to_rgen_4548 = Hashtbl$create(4);
    function walk_rmap(s, a) {
      while (true) {
        const a_4550 = Types$repr(a);
        let _t4553;
        const _t4552 = s;
        _t4554: {
          if (_t4552._tag === 7) {
            const s1 = _t4552._val[0];
            const s2 = _t4552._val[2];
            let _t4556;
            const _t4555 = a_4550;
            _t4557: {
              if (_t4555._tag === 7) {
                const a1 = _t4555._val[0];
                const a2 = _t4555._val[2];
                walk_rmap(s1, a1);
                const _t4558 = s2;
                const _t4559 = a2;
                s = _t4558;
                a = _t4559;
                continue;
                _t4556 = undefined;
                break _t4557;
              }
              if (true) {
                _t4556 = undefined;
                break _t4557;
              }
              _match_fail("line 16629");
            }
            _t4553 = _t4556;
            break _t4554;
          }
          if (_t4552._tag === 8) {
            const s1 = _t4552._val[0];
            const s2 = _t4552._val[2];
            let _t4561;
            const _t4560 = a_4550;
            _t4562: {
              if (_t4560._tag === 8) {
                const a1 = _t4560._val[0];
                const a2 = _t4560._val[2];
                walk_rmap(s1, a1);
                const _t4563 = s2;
                const _t4564 = a2;
                s = _t4563;
                a = _t4564;
                continue;
                _t4561 = undefined;
                break _t4562;
              }
              if (true) {
                _t4561 = undefined;
                break _t4562;
              }
              _match_fail("line 16629");
            }
            _t4553 = _t4561;
            break _t4554;
          }
          if (_t4552._tag === 9) {
            const ss = _t4552._val;
            let _t4566;
            const _t4565 = a_4550;
            _t4567: {
              if (_t4565._tag === 9) {
                const aa = _t4565._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t4566 = List$iter2(walk_rmap, ss, aa);
                  break _t4567;
                }
              }
              if (true) {
                _t4566 = undefined;
                break _t4567;
              }
              _match_fail("line 16629");
            }
            _t4553 = _t4566;
            break _t4554;
          }
          if (_t4552._tag === 10) {
            const s1 = _t4552._val;
            let _t4569;
            const _t4568 = a_4550;
            _t4570: {
              if (_t4568._tag === 10) {
                const a1 = _t4568._val;
                const _t4571 = s1;
                const _t4572 = a1;
                s = _t4571;
                a = _t4572;
                continue;
                _t4569 = undefined;
                break _t4570;
              }
              if (true) {
                _t4569 = undefined;
                break _t4570;
              }
              _match_fail("line 16629");
            }
            _t4553 = _t4569;
            break _t4554;
          }
          if (_t4552._tag === 13) {
            const s1 = _t4552._val;
            let _t4574;
            const _t4573 = a_4550;
            _t4575: {
              if (_t4573._tag === 13) {
                const a1 = _t4573._val;
                const _t4576 = s1;
                const _t4577 = a1;
                s = _t4576;
                a = _t4577;
                continue;
                _t4574 = undefined;
                break _t4575;
              }
              if (true) {
                _t4574 = undefined;
                break _t4575;
              }
              _match_fail("line 16629");
            }
            _t4553 = _t4574;
            break _t4554;
          }
          if (_t4552._tag === 12) {
            const ss = _t4552._val[1];
            let _t4579;
            const _t4578 = a_4550;
            _t4580: {
              if (_t4578._tag === 12) {
                const aa = _t4578._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t4579 = List$iter2(walk_rmap, ss, aa);
                  break _t4580;
                }
              }
              if (true) {
                _t4579 = undefined;
                break _t4580;
              }
              _match_fail("line 16629");
            }
            _t4553 = _t4579;
            break _t4554;
          }
          if (_t4552._tag === 11) {
            const srow = _t4552._val;
            let _t4582;
            const _t4581 = a_4550;
            _t4583: {
              if (_t4581._tag === 11) {
                const arow = _t4581._val;
                _t4582 = walk_rmap_rrows(srow, arow);
                break _t4583;
              }
              if (true) {
                _t4582 = undefined;
                break _t4583;
              }
              _match_fail("line 16629");
            }
            _t4553 = _t4582;
            break _t4554;
          }
          if (true) {
            _t4553 = undefined;
            break _t4554;
          }
          _match_fail("line 16629");
        }
        const _t4551 = _t4553;
        return _t4551;
      }
    }
    function walk_rmap_rrows(srow, arow) {
      while (true) {
        let _t4585;
        const _t4584 = [srow, Types$rrow_repr(arow)];
        _t4586: {
          if (_t4584[0]._tag === 3 && _t4584[1]._tag === 1 && _t4584[1]._val.contents._tag === 0) {
            const i = _t4584[0]._val;
            const id = _t4584[1]._val.contents._val[0];
            _t4585 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4548, id, i]);
            break _t4586;
          }
          if (_t4584[0]._tag === 0 && _t4584[1]._tag === 0) {
            const sty = _t4584[0]._val[1];
            const stail = _t4584[0]._val[2];
            const aty = _t4584[1]._val[1];
            const atail = _t4584[1]._val[2];
            walk_rmap(sty, aty);
            const _t4587 = stail;
            const _t4588 = atail;
            srow = _t4587;
            arow = _t4588;
            continue;
            _t4585 = undefined;
            break _t4586;
          }
          if (true) {
            _t4585 = undefined;
            break _t4586;
          }
          _match_fail("line 16629");
        }
        return _t4585;
      }
    }
    walk_rmap(scheme.body, te.ty);
    const found_evidences_4590 = Hashtbl$create(4);
    function _t4592(__dict_Hash_resolved_0, __dict_Eq_resolved_1, rgen_idx, fields) {
      let _t4594;
      const _t4593 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_evidences_4590, rgen_idx]);
      _t4595: {
        if (_t4593._tag === 1) {
          const fs = _t4593._val;
          _t4594 = fs;
          break _t4595;
        }
        if (_t4593._tag === 0) {
          _t4594 = null;
          break _t4595;
        }
        _match_fail("line 16629");
      }
      const existing_4596 = _t4594;
      function _t4598(fs, f) {
        let _t4599;
        if (List$mem(f, fs)) {
          _t4599 = fs;
        } else {
          _t4599 = ({_hd: f, _tl: fs});
        }
        return _t4599;
      }
      const merged_4600 = List$fold(_t4598, existing_4596, fields);
      const _t4601 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_evidences_4590, rgen_idx, merged_4600]);
      const _t4597 = _t4601;
      return _t4597;
    }
    const add_evidence_4602 = _t4592;
    function get_row_tail(row) {
      while (true) {
        let _t4605;
        const _t4604 = Types$rrow_repr(row);
        _t4606: {
          if (_t4604._tag === 0) {
            const tail = _t4604._val[2];
            const _t4607 = tail;
            row = _t4607;
            continue;
            _t4605 = undefined;
            break _t4606;
          }
          if (true) {
            const tail = _t4604;
            _t4605 = tail;
            break _t4606;
          }
          _match_fail("line 16629");
        }
        return _t4605;
      }
    }
    function walk(te) {
      let _t4610;
      const _t4609 = te.expr;
      _t4611: {
        if (_t4609._tag === 17) {
          const _base = _t4609._val[0];
          const overrides = _t4609._val[1];
          let _t4613;
          const _t4612 = Types$repr(te.ty);
          _t4614: {
            if (_t4612._tag === 11) {
              const row = _t4612._val;
              let _t4616;
              const _t4615 = get_row_tail(row);
              _t4617: {
                if (_t4615._tag === 1 && _t4615._val.contents._tag === 0) {
                  const id = _t4615._val.contents._val[0];
                  let _t4619;
                  const _t4618 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4548, id]);
                  _t4620: {
                    if (_t4618._tag === 1) {
                      const rgen_idx = _t4618._val;
                      _t4619 = _call(add_evidence_4602, [__dict_Hash_int, __dict_Eq_int, rgen_idx, List$map(fst, overrides)]);
                      break _t4620;
                    }
                    if (_t4618._tag === 0) {
                      _t4619 = undefined;
                      break _t4620;
                    }
                    _match_fail("line 16629");
                  }
                  _t4616 = _t4619;
                  break _t4617;
                }
                if (true) {
                  _t4616 = undefined;
                  break _t4617;
                }
                _match_fail("line 16629");
              }
              _t4613 = _t4616;
              break _t4614;
            }
            if (true) {
              _t4613 = undefined;
              break _t4614;
            }
            _match_fail("line 16629");
          }
          _t4610 = _t4613;
          break _t4611;
        }
        if (_t4609._tag === 19) {
          const base_e = _t4609._val[0];
          const field_name = _t4609._val[1];
          let _t4622;
          const _t4621 = Types$repr(base_e.ty);
          _t4623: {
            if (_t4621._tag === 11) {
              const row = _t4621._val;
              let _t4625;
              const _t4624 = get_row_tail(row);
              _t4626: {
                if (_t4624._tag === 1 && _t4624._val.contents._tag === 0) {
                  const id = _t4624._val.contents._val[0];
                  let _t4628;
                  const _t4627 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4548, id]);
                  _t4629: {
                    if (_t4627._tag === 1) {
                      const rgen_idx = _t4627._val;
                      _t4628 = _call(add_evidence_4602, [__dict_Hash_int, __dict_Eq_int, rgen_idx, ({_hd: field_name, _tl: null})]);
                      break _t4629;
                    }
                    if (_t4627._tag === 0) {
                      _t4628 = undefined;
                      break _t4629;
                    }
                    _match_fail("line 16629");
                  }
                  _t4625 = _t4628;
                  break _t4626;
                }
                if (true) {
                  _t4625 = undefined;
                  break _t4626;
                }
                _match_fail("line 16629");
              }
              _t4622 = _t4625;
              break _t4623;
            }
            if (true) {
              _t4622 = undefined;
              break _t4623;
            }
            _match_fail("line 16629");
          }
          _t4610 = _t4622;
          break _t4611;
        }
        if (_t4609._tag === 27) {
          const base_e = _t4609._val[0];
          const field_name = _t4609._val[1];
          let _t4631;
          const _t4630 = Types$repr(base_e.ty);
          _t4632: {
            if (_t4630._tag === 11) {
              const row = _t4630._val;
              let _t4634;
              const _t4633 = get_row_tail(row);
              _t4635: {
                if (_t4633._tag === 1 && _t4633._val.contents._tag === 0) {
                  const id = _t4633._val.contents._val[0];
                  let _t4637;
                  const _t4636 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4548, id]);
                  _t4638: {
                    if (_t4636._tag === 1) {
                      const rgen_idx = _t4636._val;
                      _t4637 = _call(add_evidence_4602, [__dict_Hash_int, __dict_Eq_int, rgen_idx, ({_hd: field_name, _tl: null})]);
                      break _t4638;
                    }
                    if (_t4636._tag === 0) {
                      _t4637 = undefined;
                      break _t4638;
                    }
                    _match_fail("line 16629");
                  }
                  _t4634 = _t4637;
                  break _t4635;
                }
                if (true) {
                  _t4634 = undefined;
                  break _t4635;
                }
                _match_fail("line 16629");
              }
              _t4631 = _t4634;
              break _t4632;
            }
            if (true) {
              _t4631 = undefined;
              break _t4632;
            }
            _match_fail("line 16629");
          }
          _t4610 = _t4631;
          break _t4611;
        }
        if (_t4609._tag === 7) {
          const name = _t4609._val;
          let _t4640;
          const _t4639 = List$assoc_opt(name, vars);
          _t4641: {
            if (_t4639._tag === 1) {
              const callee_sch = _t4639._val;
              if (!_eq(callee_sch.record_evidences, null)) {
                const rgen_map_4642 = Typechecker$build_rgen_map(callee_sch.body, te.ty);
                function _t4644(re) {
                  let _t4646;
                  const _t4645 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rgen_map_4642, re.re_rgen]);
                  _t4647: {
                    if (_t4645._tag === 1) {
                      const arow = _t4645._val;
                      function is_open(r) {
                        while (true) {
                          let _t4649;
                          const _t4648 = Types$rrow_repr(r);
                          _t4650: {
                            if (_t4648._tag === 0) {
                              const tail = _t4648._val[2];
                              const _t4651 = tail;
                              r = _t4651;
                              continue;
                              _t4649 = undefined;
                              break _t4650;
                            }
                            if (_t4648._tag === 1 && _t4648._val.contents._tag === 0) {
                              _t4649 = true;
                              break _t4650;
                            }
                            if (true) {
                              _t4649 = false;
                              break _t4650;
                            }
                            _match_fail("line 16629");
                          }
                          return _t4649;
                        }
                      }
                      let _t4653;
                      if (is_open(arow)) {
                        let _t4655;
                        const _t4654 = get_row_tail(arow);
                        _t4656: {
                          if (_t4654._tag === 1 && _t4654._val.contents._tag === 0) {
                            const id = _t4654._val.contents._val[0];
                            let _t4658;
                            const _t4657 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4548, id]);
                            _t4659: {
                              if (_t4657._tag === 1) {
                                const caller_rgen = _t4657._val;
                                _t4658 = _call(add_evidence_4602, [__dict_Hash_int, __dict_Eq_int, caller_rgen, re.re_fields]);
                                break _t4659;
                              }
                              if (_t4657._tag === 0) {
                                _t4658 = undefined;
                                break _t4659;
                              }
                              _match_fail("line 16629");
                            }
                            _t4655 = _t4658;
                            break _t4656;
                          }
                          if (true) {
                            _t4655 = undefined;
                            break _t4656;
                          }
                          _match_fail("line 16629");
                        }
                        _t4653 = _t4655;
                      } else {
                        _t4653 = undefined;
                      }
                      const _t4652 = _t4653;
                      _t4646 = _t4652;
                      break _t4647;
                    }
                    if (_t4645._tag === 0) {
                      _t4646 = undefined;
                      break _t4647;
                    }
                    _match_fail("line 16629");
                  }
                  return _t4646;
                }
                const _t4643 = List$iter(_t4644, callee_sch.record_evidences);
                _t4640 = _t4643;
                break _t4641;
              }
            }
            if (true) {
              _t4640 = undefined;
              break _t4641;
            }
            _match_fail("line 16629");
          }
          _t4610 = _t4640;
          break _t4611;
        }
        if (true) {
          _t4610 = undefined;
          break _t4611;
        }
        _match_fail("line 16629");
      }
      _t4610;
      return walk_children(te);
    }
    function walk_children(te) {
      let _t4661;
      const _t4660 = te.expr;
      _t4662: {
        if ((((((((((_t4660._tag === 0 || _t4660._tag === 1) || _t4660._tag === 2) || _t4660._tag === 3) || _t4660._tag === 4) || _t4660._tag === 5) || _t4660._tag === 6) || _t4660._tag === 7) || _t4660._tag === 22) || _t4660._tag === 34)) {
          _t4661 = undefined;
          break _t4662;
        }
        if (((_t4660._tag === 8 || _t4660._tag === 9) || _t4660._tag === 25)) {
          const e1 = ((_t4660._tag === 8 || _t4660._tag === 9) ? _t4660._val[2] : _t4660._val[1]);
          const e2 = ((_t4660._tag === 8 || _t4660._tag === 9) ? _t4660._val[3] : _t4660._val[2]);
          walk(e1);
          _t4661 = walk(e2);
          break _t4662;
        }
        if (((((((_t4660._tag === 13 || _t4660._tag === 21) || _t4660._tag === 28) || _t4660._tag === 32) || _t4660._tag === 31) || _t4660._tag === 27) || _t4660._tag === 20)) {
          const e1 = ((((((_t4660._tag === 13 || _t4660._tag === 21) || _t4660._tag === 28) || _t4660._tag === 32) || _t4660._tag === 31) || _t4660._tag === 27) ? (((((_t4660._tag === 13 || _t4660._tag === 21) || _t4660._tag === 28) || _t4660._tag === 32) || _t4660._tag === 31) ? ((((_t4660._tag === 13 || _t4660._tag === 21) || _t4660._tag === 28) || _t4660._tag === 32) ? (((_t4660._tag === 13 || _t4660._tag === 21) || _t4660._tag === 28) ? ((_t4660._tag === 13 || _t4660._tag === 21) ? (_t4660._tag === 13 ? _t4660._val[1] : _t4660._val[0]) : _t4660._val[0]) : _t4660._val[0]) : _t4660._val[0]) : _t4660._val[0]) : _t4660._val[0]);
          const e2 = ((((((_t4660._tag === 13 || _t4660._tag === 21) || _t4660._tag === 28) || _t4660._tag === 32) || _t4660._tag === 31) || _t4660._tag === 27) ? (((((_t4660._tag === 13 || _t4660._tag === 21) || _t4660._tag === 28) || _t4660._tag === 32) || _t4660._tag === 31) ? ((((_t4660._tag === 13 || _t4660._tag === 21) || _t4660._tag === 28) || _t4660._tag === 32) ? (((_t4660._tag === 13 || _t4660._tag === 21) || _t4660._tag === 28) ? ((_t4660._tag === 13 || _t4660._tag === 21) ? (_t4660._tag === 13 ? _t4660._val[2] : _t4660._val[1]) : _t4660._val[1]) : _t4660._val[1]) : _t4660._val[1]) : _t4660._val[2]) : _t4660._val[1]);
          walk(e1);
          _t4661 = walk(e2);
          break _t4662;
        }
        if (_t4660._tag === 11) {
          const fn_ = _t4660._val[0];
          const arg = _t4660._val[1];
          walk(fn_);
          _t4661 = walk(arg);
          break _t4662;
        }
        if (((((((((_t4660._tag === 29 || _t4660._tag === 14) || _t4660._tag === 10) || _t4660._tag === 19) || _t4660._tag === 33) || _t4660._tag === 35) || _t4660._tag === 36) || _t4660._tag === 39) || _t4660._tag === 26)) {
          const e = ((((((((_t4660._tag === 29 || _t4660._tag === 14) || _t4660._tag === 10) || _t4660._tag === 19) || _t4660._tag === 33) || _t4660._tag === 35) || _t4660._tag === 36) || _t4660._tag === 39) ? (((((((_t4660._tag === 29 || _t4660._tag === 14) || _t4660._tag === 10) || _t4660._tag === 19) || _t4660._tag === 33) || _t4660._tag === 35) || _t4660._tag === 36) ? ((((((_t4660._tag === 29 || _t4660._tag === 14) || _t4660._tag === 10) || _t4660._tag === 19) || _t4660._tag === 33) || _t4660._tag === 35) ? (((((_t4660._tag === 29 || _t4660._tag === 14) || _t4660._tag === 10) || _t4660._tag === 19) || _t4660._tag === 33) ? ((((_t4660._tag === 29 || _t4660._tag === 14) || _t4660._tag === 10) || _t4660._tag === 19) ? (((_t4660._tag === 29 || _t4660._tag === 14) || _t4660._tag === 10) ? _t4660._val[1] : _t4660._val[0]) : _t4660._val) : _t4660._val) : _t4660._val) : _t4660._val) : _t4660._val[1]);
          _t4661 = walk(e);
          break _t4662;
        }
        if (_t4660._tag === 12) {
          const c = _t4660._val[0];
          const t = _t4660._val[1];
          const e = _t4660._val[2];
          walk(c);
          walk(t);
          _t4661 = walk(e);
          break _t4662;
        }
        if ((_t4660._tag === 15 || _t4660._tag === 38)) {
          const es = _t4660._val;
          _t4661 = List$iter(walk, es);
          break _t4662;
        }
        if (_t4660._tag === 16) {
          const fields = _t4660._val;
          function _t4663(__p93) {
            let _t4665;
            const _t4664 = __p93;
            _t4666: {
              if (true) {
                const e = _t4664[1];
                _t4665 = walk(e);
                break _t4666;
              }
              _match_fail("line 16629");
            }
            return _t4665;
          }
          _t4661 = List$iter(_t4663, fields);
          break _t4662;
        }
        if (_t4660._tag === 17) {
          const base = _t4660._val[0];
          const overrides = _t4660._val[1];
          walk(base);
          function _t4667(__p94) {
            let _t4669;
            const _t4668 = __p94;
            _t4670: {
              if (true) {
                const e = _t4668[1];
                _t4669 = walk(e);
                break _t4670;
              }
              _match_fail("line 16629");
            }
            return _t4669;
          }
          _t4661 = List$iter(_t4667, overrides);
          break _t4662;
        }
        if (_t4660._tag === 18) {
          const base = _t4660._val[0];
          const pairs = _t4660._val[1];
          walk(base);
          function _t4671(__p95) {
            let _t4673;
            const _t4672 = __p95;
            _t4674: {
              if (true) {
                const i = _t4672[0];
                const v = _t4672[1];
                walk(i);
                _t4673 = walk(v);
                break _t4674;
              }
              _match_fail("line 16629");
            }
            return _t4673;
          }
          _t4661 = List$iter(_t4671, pairs);
          break _t4662;
        }
        if (_t4660._tag === 23) {
          const arg = _t4660._val[1];
          _t4661 = Option$iter(walk, arg);
          break _t4662;
        }
        if (_t4660._tag === 24) {
          const scrutinee = _t4660._val[0];
          const arms = _t4660._val[1];
          walk(scrutinee);
          function _t4675(__p96) {
            let _t4677;
            const _t4676 = __p96;
            _t4678: {
              if (true) {
                const guard = _t4676[1];
                const body = _t4676[2];
                Option$iter(walk, guard);
                _t4677 = walk(body);
                break _t4678;
              }
              _match_fail("line 16629");
            }
            return _t4677;
          }
          _t4661 = List$iter(_t4675, arms);
          break _t4662;
        }
        if (_t4660._tag === 30) {
          const body = _t4660._val[0];
          const arms = _t4660._val[1];
          walk(body);
          function _t4679(arm) {
            let _t4681;
            const _t4680 = arm;
            _t4682: {
              if ((((_t4680._tag === 0 || _t4680._tag === 1) || _t4680._tag === 2) || _t4680._tag === 3)) {
                const e = (((_t4680._tag === 0 || _t4680._tag === 1) || _t4680._tag === 2) ? ((_t4680._tag === 0 || _t4680._tag === 1) ? (_t4680._tag === 0 ? _t4680._val[1] : _t4680._val[3]) : _t4680._val[2]) : _t4680._val[2]);
                _t4681 = walk(e);
                break _t4682;
              }
              _match_fail("line 16629");
            }
            return _t4681;
          }
          _t4661 = List$iter(_t4679, arms);
          break _t4662;
        }
        if (_t4660._tag === 37) {
          const bindings = _t4660._val[0];
          const body = _t4660._val[1];
          function _t4683(__p97) {
            let _t4685;
            const _t4684 = __p97;
            _t4686: {
              if (true) {
                const e = _t4684[1];
                _t4685 = walk(e);
                break _t4686;
              }
              _match_fail("line 16629");
            }
            return _t4685;
          }
          List$iter(_t4683, bindings);
          _t4661 = walk(body);
          break _t4662;
        }
        _match_fail("line 16629");
      }
      return _t4661;
    }
    walk(te);
    function _t4688(rgen_idx, fields, acc) {
      return ({_hd: ({re_fields: List$sort(String$compare, fields), re_rgen: rgen_idx}), _tl: acc});
    }
    const ev_list_4689 = Hashtbl$fold(_t4688, found_evidences_4590, null);
    let _t4691;
    if (_eq(ev_list_4689, null)) {
      _t4691 = scheme;
    } else {
      const __rec_upd_4692 = scheme;
      const _t4693 = ({body: __rec_upd_4692.body, constraints: __rec_upd_4692.constraints, equant: __rec_upd_4692.equant, pvquant: __rec_upd_4692.pvquant, quant: __rec_upd_4692.quant, record_evidences: ev_list_4689, rquant: __rec_upd_4692.rquant});
      _t4691 = _t4693;
    }
    const _t4690 = _t4691;
    const _t4687 = _t4690;
    const _t4608 = _t4687;
    const _t4603 = _t4608;
    const _t4591 = _t4603;
    const _t4589 = _t4591;
    const _t4549 = _t4589;
    _t4547 = _t4549;
  }
  return _t4547;
}
function Typechecker$scheme_needs_xform(scheme) {
  return (!_eq(scheme.constraints, null) || !_eq(scheme.record_evidences, null));
}
function Typechecker$improve_fundeps_in_expr(vars, type_env, te) {
  const classes_4694 = type_env.classes;
  const instances_4696 = type_env.instances;
  function _t4698(sch, ty) {
    const tgen_to_actual_4699 = Hashtbl$create(sch.quant);
    function map_tgens(s, a) {
      while (true) {
        const a_4701 = Types$repr(a);
        let _t4704;
        const _t4703 = s;
        _t4705: {
          if (_t4703._tag === 16) {
            const i = _t4703._val;
            let _t4706;
            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4699, i]))) {
              _t4706 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4699, i, a_4701]);
            } else {
              _t4706 = undefined;
            }
            _t4704 = _t4706;
            break _t4705;
          }
          if (_t4703._tag === 7) {
            const s1 = _t4703._val[0];
            const s2 = _t4703._val[2];
            let _t4708;
            const _t4707 = a_4701;
            _t4709: {
              if (_t4707._tag === 7) {
                const a1 = _t4707._val[0];
                const a2 = _t4707._val[2];
                map_tgens(s1, a1);
                const _t4710 = s2;
                const _t4711 = a2;
                s = _t4710;
                a = _t4711;
                continue;
                _t4708 = undefined;
                break _t4709;
              }
              if (true) {
                _t4708 = undefined;
                break _t4709;
              }
              _match_fail("line 16629");
            }
            _t4704 = _t4708;
            break _t4705;
          }
          if (_t4703._tag === 8) {
            const s1 = _t4703._val[0];
            const s2 = _t4703._val[2];
            let _t4713;
            const _t4712 = a_4701;
            _t4714: {
              if (_t4712._tag === 8) {
                const a1 = _t4712._val[0];
                const a2 = _t4712._val[2];
                map_tgens(s1, a1);
                const _t4715 = s2;
                const _t4716 = a2;
                s = _t4715;
                a = _t4716;
                continue;
                _t4713 = undefined;
                break _t4714;
              }
              if (true) {
                _t4713 = undefined;
                break _t4714;
              }
              _match_fail("line 16629");
            }
            _t4704 = _t4713;
            break _t4705;
          }
          if (_t4703._tag === 9) {
            const ss = _t4703._val;
            let _t4718;
            const _t4717 = a_4701;
            _t4719: {
              if (_t4717._tag === 9) {
                const aa = _t4717._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t4718 = List$iter2(map_tgens, ss, aa);
                  break _t4719;
                }
              }
              if (true) {
                _t4718 = undefined;
                break _t4719;
              }
              _match_fail("line 16629");
            }
            _t4704 = _t4718;
            break _t4705;
          }
          if (_t4703._tag === 10) {
            const s1 = _t4703._val;
            let _t4721;
            const _t4720 = a_4701;
            _t4722: {
              if (_t4720._tag === 10) {
                const a1 = _t4720._val;
                const _t4723 = s1;
                const _t4724 = a1;
                s = _t4723;
                a = _t4724;
                continue;
                _t4721 = undefined;
                break _t4722;
              }
              if (true) {
                _t4721 = undefined;
                break _t4722;
              }
              _match_fail("line 16629");
            }
            _t4704 = _t4721;
            break _t4705;
          }
          if (_t4703._tag === 13) {
            const s1 = _t4703._val;
            let _t4726;
            const _t4725 = a_4701;
            _t4727: {
              if (_t4725._tag === 13) {
                const a1 = _t4725._val;
                const _t4728 = s1;
                const _t4729 = a1;
                s = _t4728;
                a = _t4729;
                continue;
                _t4726 = undefined;
                break _t4727;
              }
              if (true) {
                _t4726 = undefined;
                break _t4727;
              }
              _match_fail("line 16629");
            }
            _t4704 = _t4726;
            break _t4705;
          }
          if (_t4703._tag === 12) {
            const ss = _t4703._val[1];
            let _t4731;
            const _t4730 = a_4701;
            _t4732: {
              if (_t4730._tag === 12) {
                const aa = _t4730._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t4731 = List$iter2(map_tgens, ss, aa);
                  break _t4732;
                }
              }
              if (true) {
                _t4731 = undefined;
                break _t4732;
              }
              _match_fail("line 16629");
            }
            _t4704 = _t4731;
            break _t4705;
          }
          if (true) {
            _t4704 = undefined;
            break _t4705;
          }
          _match_fail("line 16629");
        }
        const _t4702 = _t4704;
        return _t4702;
      }
    }
    map_tgens(sch.body, ty);
    function _t4734(cc) {
      function _t4735(cls) {
        return (cls.class_name === cc.cc_class);
      }
      let _t4737;
      const _t4736 = List$find(_t4735, classes_4694);
      _t4738: {
        if (_t4736._tag === 0) {
          _t4737 = undefined;
          break _t4738;
        }
        if (_t4736._tag === 1) {
          const class_def = _t4736._val;
          if (_eq(class_def.class_fundeps, null)) {
            _t4737 = undefined;
            break _t4738;
          }
        }
        if (_t4736._tag === 1) {
          const class_def = _t4736._val;
          const num_params_4739 = List$length(class_def.class_params);
          function _t4741(ca) {
            let _t4743;
            const _t4742 = ca;
            _t4744: {
              if (_t4742._tag === 0) {
                const tgen_idx = _t4742._val;
                let _t4746;
                const _t4745 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4699, tgen_idx]);
                _t4747: {
                  if (_t4745._tag === 1 && _t4745._val._tag === 15 && _t4745._val._val.contents._tag === 0) {
                    _t4746 = ({_tag: 0, _name: "None"});
                    break _t4747;
                  }
                  if (_t4745._tag === 1) {
                    const t = _t4745._val;
                    _t4746 = ({_tag: 1, _name: "Some", _val: t});
                    break _t4747;
                  }
                  if (_t4745._tag === 0) {
                    _t4746 = ({_tag: 0, _name: "None"});
                    break _t4747;
                  }
                  _match_fail("line 16629");
                }
                _t4743 = _t4746;
                break _t4744;
              }
              if (_t4742._tag === 1) {
                const ty = _t4742._val;
                let _t4749;
                const _t4748 = Types$repr(ty);
                _t4750: {
                  if (_t4748._tag === 15 && _t4748._val.contents._tag === 0) {
                    _t4749 = ({_tag: 0, _name: "None"});
                    break _t4750;
                  }
                  if (true) {
                    const t = _t4748;
                    _t4749 = ({_tag: 1, _name: "Some", _val: t});
                    break _t4750;
                  }
                  _match_fail("line 16629");
                }
                _t4743 = _t4749;
                break _t4744;
              }
              if (_t4742._tag === 2) {
                _t4743 = ({_tag: 0, _name: "None"});
                break _t4744;
              }
              if (_t4742._tag === 3) {
                _t4743 = ({_tag: 0, _name: "None"});
                break _t4744;
              }
              _match_fail("line 16629");
            }
            return _t4743;
          }
          const partial_4751 = List$map(_t4741, cc.cc_args);
          const improved_4753 = Types$improve_with_fundeps(instances_4696, class_def, partial_4751);
          function _t4755(i, opt) {
            let _t4756;
            if ((i < num_params_4739)) {
              let _t4758;
              const _t4757 = [opt, List$nth(partial_4751, i)];
              _t4759: {
                if (_t4757[0]._tag === 1 && _t4757[1]._tag === 0) {
                  const resolved_ty = _t4757[0]._val;
                  const ca_4760 = List$nth(cc.cc_args, i);
                  let _t4763;
                  const _t4762 = ca_4760;
                  _t4764: {
                    if (_t4762._tag === 0) {
                      const tgen_idx = _t4762._val;
                      _t4763 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4699, tgen_idx]);
                      break _t4764;
                    }
                    if (_t4762._tag === 1) {
                      const ty = _t4762._val;
                      _t4763 = ({_tag: 1, _name: "Some", _val: ty});
                      break _t4764;
                    }
                    if (_t4762._tag === 2) {
                      _t4763 = ({_tag: 0, _name: "None"});
                      break _t4764;
                    }
                    if (_t4762._tag === 3) {
                      _t4763 = ({_tag: 0, _name: "None"});
                      break _t4764;
                    }
                    _match_fail("line 16629");
                  }
                  const tvar_opt_4765 = _t4763;
                  let _t4768;
                  const _t4767 = tvar_opt_4765;
                  _t4769: {
                    if (_t4767._tag === 1 && _t4767._val._tag === 15 && _t4767._val._val.contents._tag === 0) {
                      const r = _t4767._val._val;
                      _t4768 = Types$unify(({_tag: 15, _name: "TVar", _val: r}), resolved_ty);
                      break _t4769;
                    }
                    if (true) {
                      _t4768 = undefined;
                      break _t4769;
                    }
                    _match_fail("line 16629");
                  }
                  const _t4766 = _t4768;
                  const _t4761 = _t4766;
                  _t4758 = _t4761;
                  break _t4759;
                }
                if (true) {
                  _t4758 = undefined;
                  break _t4759;
                }
                _match_fail("line 16629");
              }
              _t4756 = _t4758;
            } else {
              _t4756 = undefined;
            }
            return _t4756;
          }
          const _t4754 = List$iteri(_t4755, improved_4753);
          const _t4752 = _t4754;
          const _t4740 = _t4752;
          _t4737 = _t4740;
          break _t4738;
        }
        _match_fail("line 16629");
      }
      return _t4737;
    }
    const _t4733 = List$iter(_t4734, sch.constraints);
    const _t4700 = _t4733;
    return _t4700;
  }
  const improve_constrained_call_with_scheme_4770 = _t4698;
  function _t4772(name, ty) {
    let _t4774;
    const _t4773 = Types$find_method_class(classes_4694, name);
    _t4775: {
      if (_t4773._tag === 1) {
        const result = _t4773;
        _t4774 = [result, name];
        break _t4775;
      }
      if (_t4773._tag === 0) {
        let _t4777;
        const _t4776 = String$rindex_opt(name, 46);
        _t4778: {
          if (_t4776._tag === 0) {
            _t4777 = [({_tag: 0, _name: "None"}), name];
            break _t4778;
          }
          if (_t4776._tag === 1) {
            const i = _t4776._val;
            const mod_prefix_4779 = String$sub(name, 0, (i + 1));
            const _mml$short_4781 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
            const class_prefix_4783 = String$sub(name, 0, i);
            let _t4786;
            const _t4785 = Types$find_method_class(classes_4694, _mml$short_4781);
            _t4787: {
              if (_t4785._tag === 1) {
                const class_def = _t4785._val;
                if ((class_def.class_name === class_prefix_4783)) {
                  _t4786 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_4781];
                  break _t4787;
                }
              }
              if (_t4785._tag === 1) {
                const class_def = _t4785._val;
                if (((String$length(class_def.class_name) > String$length(mod_prefix_4779)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_4779)) === mod_prefix_4779))) {
                  _t4786 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_4781];
                  break _t4787;
                }
              }
              if (true) {
                _t4786 = [({_tag: 0, _name: "None"}), name];
                break _t4787;
              }
              _match_fail("line 16629");
            }
            const _t4784 = _t4786;
            const _t4782 = _t4784;
            const _t4780 = _t4782;
            _t4777 = _t4780;
            break _t4778;
          }
          _match_fail("line 16629");
        }
        _t4774 = _t4777;
        break _t4775;
      }
      _match_fail("line 16629");
    }
    let _t4789;
    const _t4788 = _t4774;
    _t4790: {
      if (true) {
        const class_opt = _t4788[0];
        const method_name = _t4788[1];
        let _t4792;
        const _t4791 = class_opt;
        _t4793: {
          if (_t4791._tag === 1) {
            const class_def = _t4791._val;
            if (!_eq(class_def.class_fundeps, null)) {
              const method_schema_ty_4794 = List$assoc(method_name, class_def.class_methods);
              const num_params_4796 = List$length(class_def.class_params);
              const found_4798 = Hashtbl$create(num_params_4796);
              function go(s, r) {
                while (true) {
                  const r_4800 = Types$repr(r);
                  let _t4803;
                  const _t4802 = [s, r_4800];
                  _t4804: {
                    if (_t4802[0]._tag === 16) {
                      const i = _t4802[0]._val;
                      if ((i < num_params_4796)) {
                        let _t4805;
                        if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, found_4798, i]))) {
                          _t4805 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_4798, i, r_4800]);
                        } else {
                          _t4805 = undefined;
                        }
                        _t4803 = _t4805;
                        break _t4804;
                      }
                    }
                    if ((_t4802[0]._tag === 7 && _t4802[1]._tag === 7 || _t4802[0]._tag === 8 && _t4802[1]._tag === 8)) {
                      const s1 = _t4802[0]._val[0];
                      const s2 = _t4802[0]._val[2];
                      const r1 = _t4802[1]._val[0];
                      const r2 = _t4802[1]._val[2];
                      go(s1, r1);
                      const _t4806 = s2;
                      const _t4807 = r2;
                      s = _t4806;
                      r = _t4807;
                      continue;
                      _t4803 = undefined;
                      break _t4804;
                    }
                    if (_t4802[0]._tag === 9 && _t4802[1]._tag === 9) {
                      const ss = _t4802[0]._val;
                      const rs = _t4802[1]._val;
                      if ((List$length(ss) === List$length(rs))) {
                        _t4803 = List$iter2(go, ss, rs);
                        break _t4804;
                      }
                    }
                    if (_t4802[0]._tag === 10 && _t4802[1]._tag === 10) {
                      const s1 = _t4802[0]._val;
                      const r1 = _t4802[1]._val;
                      const _t4808 = s1;
                      const _t4809 = r1;
                      s = _t4808;
                      r = _t4809;
                      continue;
                      _t4803 = undefined;
                      break _t4804;
                    }
                    if (_t4802[0]._tag === 13 && _t4802[1]._tag === 13) {
                      const s1 = _t4802[0]._val;
                      const r1 = _t4802[1]._val;
                      const _t4810 = s1;
                      const _t4811 = r1;
                      s = _t4810;
                      r = _t4811;
                      continue;
                      _t4803 = undefined;
                      break _t4804;
                    }
                    if (_t4802[0]._tag === 12 && _t4802[1]._tag === 12) {
                      const ss = _t4802[0]._val[1];
                      const rs = _t4802[1]._val[1];
                      if ((List$length(ss) === List$length(rs))) {
                        _t4803 = List$iter2(go, ss, rs);
                        break _t4804;
                      }
                    }
                    if (true) {
                      _t4803 = undefined;
                      break _t4804;
                    }
                    _match_fail("line 16629");
                  }
                  const _t4801 = _t4803;
                  return _t4801;
                }
              }
              go(method_schema_ty_4794, ty);
              function _t4813(i) {
                let _t4815;
                const _t4814 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_4798, i]);
                _t4816: {
                  if (_t4814._tag === 1 && _t4814._val._tag === 15 && _t4814._val._val.contents._tag === 0) {
                    _t4815 = ({_tag: 0, _name: "None"});
                    break _t4816;
                  }
                  if (_t4814._tag === 1) {
                    const t = _t4814._val;
                    _t4815 = ({_tag: 1, _name: "Some", _val: t});
                    break _t4816;
                  }
                  if (_t4814._tag === 0) {
                    _t4815 = ({_tag: 0, _name: "None"});
                    break _t4816;
                  }
                  _match_fail("line 16629");
                }
                return _t4815;
              }
              const partial_4817 = List$init(num_params_4796, _t4813);
              const improved_4819 = Types$improve_with_fundeps(instances_4696, class_def, partial_4817);
              function _t4821(i, opt) {
                let _t4823;
                const _t4822 = [opt, List$nth(partial_4817, i)];
                _t4824: {
                  if (_t4822[0]._tag === 1 && _t4822[1]._tag === 0) {
                    const resolved_ty = _t4822[0]._val;
                    let _t4826;
                    const _t4825 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_4798, i]);
                    _t4827: {
                      if (_t4825._tag === 1 && _t4825._val._tag === 15 && _t4825._val._val.contents._tag === 0) {
                        const r = _t4825._val._val;
                        _t4826 = Types$unify(({_tag: 15, _name: "TVar", _val: r}), resolved_ty);
                        break _t4827;
                      }
                      if (true) {
                        _t4826 = undefined;
                        break _t4827;
                      }
                      _match_fail("line 16629");
                    }
                    _t4823 = _t4826;
                    break _t4824;
                  }
                  if (true) {
                    _t4823 = undefined;
                    break _t4824;
                  }
                  _match_fail("line 16629");
                }
                return _t4823;
              }
              const _t4820 = List$iteri(_t4821, improved_4819);
              const _t4818 = _t4820;
              const _t4812 = _t4818;
              const _t4799 = _t4812;
              const _t4797 = _t4799;
              const _t4795 = _t4797;
              _t4792 = _t4795;
              break _t4793;
            }
          }
          if (true) {
            _t4792 = undefined;
            break _t4793;
          }
          _match_fail("line 16629");
        }
        _t4789 = _t4792;
        break _t4790;
      }
      _match_fail("line 16629");
    }
    return _t4789;
  }
  const improve_method_call_4828 = _t4772;
  function walk(locals, te) {
    let _t4831;
    const _t4830 = te.expr;
    _t4832: {
      if (_t4830._tag === 7) {
        const name = _t4830._val;
        improve_method_call_4828(name, te.ty);
        _t4831 = improve_constrained_call_local(locals, name, te.ty);
        break _t4832;
      }
      if (true) {
        _t4831 = undefined;
        break _t4832;
      }
      _match_fail("line 16629");
    }
    _t4831;
    return walk_children(locals, te);
  }
  function improve_constrained_call_local(locals, name, ty) {
    let _t4834;
    const _t4833 = List$assoc_opt(name, locals);
    _t4835: {
      if (_t4833._tag === 1) {
        const s = _t4833;
        _t4834 = s;
        break _t4835;
      }
      if (_t4833._tag === 0) {
        let _t4837;
        const _t4836 = List$assoc_opt(name, vars);
        _t4838: {
          if (_t4836._tag === 1) {
            const s = _t4836._val;
            if (!_eq(s.constraints, null)) {
              _t4837 = ({_tag: 1, _name: "Some", _val: s});
              break _t4838;
            }
          }
          if (true) {
            _t4837 = ({_tag: 0, _name: "None"});
            break _t4838;
          }
          _match_fail("line 16629");
        }
        _t4834 = _t4837;
        break _t4835;
      }
      _match_fail("line 16629");
    }
    const scheme_4839 = _t4834;
    let _t4842;
    const _t4841 = scheme_4839;
    _t4843: {
      if (_t4841._tag === 0) {
        _t4842 = undefined;
        break _t4843;
      }
      if (_t4841._tag === 1) {
        const sch = _t4841._val;
        _t4842 = improve_constrained_call_with_scheme_4770(sch, ty);
        break _t4843;
      }
      _match_fail("line 16629");
    }
    const _t4840 = _t4842;
    return _t4840;
  }
  function walk_children(locals, te) {
    let _t4845;
    const _t4844 = te.expr;
    _t4846: {
      if (((((((((_t4844._tag === 0 || _t4844._tag === 1) || _t4844._tag === 2) || _t4844._tag === 3) || _t4844._tag === 4) || _t4844._tag === 5) || _t4844._tag === 6) || _t4844._tag === 7) || _t4844._tag === 22)) {
        _t4845 = undefined;
        break _t4846;
      }
      if (_t4844._tag === 8) {
        const name = _t4844._val[0];
        const sch_opt = _t4844._val[1];
        const e1 = _t4844._val[2];
        const e2 = _t4844._val[3];
        walk(locals, e1);
        let _t4848;
        const _t4847 = sch_opt;
        _t4849: {
          if (_t4847._tag === 1) {
            const sch = _t4847._val;
            if (!_eq(sch.constraints, null)) {
              _t4848 = ({_hd: [name, sch], _tl: locals});
              break _t4849;
            }
          }
          if (true) {
            _t4848 = locals;
            break _t4849;
          }
          _match_fail("line 16629");
        }
        const locals$p_4850 = _t4848;
        const _t4851 = walk(locals$p_4850, e2);
        _t4845 = _t4851;
        break _t4846;
      }
      if (_t4844._tag === 9) {
        const name = _t4844._val[0];
        const sch_opt = _t4844._val[1];
        const e1 = _t4844._val[2];
        const e2 = _t4844._val[3];
        let _t4853;
        const _t4852 = sch_opt;
        _t4854: {
          if (_t4852._tag === 1) {
            const sch = _t4852._val;
            if (!_eq(sch.constraints, null)) {
              _t4853 = ({_hd: [name, sch], _tl: locals});
              break _t4854;
            }
          }
          if (true) {
            _t4853 = locals;
            break _t4854;
          }
          _match_fail("line 16629");
        }
        const locals$p_4855 = _t4853;
        walk(locals$p_4855, e1);
        const _t4856 = walk(locals$p_4855, e2);
        _t4845 = _t4856;
        break _t4846;
      }
      if (_t4844._tag === 25) {
        const e1 = _t4844._val[1];
        const e2 = _t4844._val[2];
        walk(locals, e1);
        _t4845 = walk(locals, e2);
        break _t4846;
      }
      if (_t4844._tag === 10) {
        const body = _t4844._val[1];
        _t4845 = walk(locals, body);
        break _t4846;
      }
      if (_t4844._tag === 11) {
        const f = _t4844._val[0];
        const a = _t4844._val[1];
        walk(locals, f);
        _t4845 = walk(locals, a);
        break _t4846;
      }
      if (_t4844._tag === 12) {
        const c = _t4844._val[0];
        const t = _t4844._val[1];
        const e = _t4844._val[2];
        walk(locals, c);
        walk(locals, t);
        _t4845 = walk(locals, e);
        break _t4846;
      }
      if (_t4844._tag === 13) {
        const l = _t4844._val[1];
        const r = _t4844._val[2];
        walk(locals, l);
        _t4845 = walk(locals, r);
        break _t4846;
      }
      if (_t4844._tag === 14) {
        const e = _t4844._val[1];
        _t4845 = walk(locals, e);
        break _t4846;
      }
      if (_t4844._tag === 15) {
        const es = _t4844._val;
        _t4845 = List$iter(_call(walk, [locals]), es);
        break _t4846;
      }
      if (_t4844._tag === 16) {
        const fs = _t4844._val;
        function _t4857(__p98) {
          let _t4859;
          const _t4858 = __p98;
          _t4860: {
            if (true) {
              const e = _t4858[1];
              _t4859 = walk(locals, e);
              break _t4860;
            }
            _match_fail("line 16629");
          }
          return _t4859;
        }
        _t4845 = List$iter(_t4857, fs);
        break _t4846;
      }
      if (_t4844._tag === 17) {
        const base = _t4844._val[0];
        const overrides = _t4844._val[1];
        walk(locals, base);
        function _t4861(__p99) {
          let _t4863;
          const _t4862 = __p99;
          _t4864: {
            if (true) {
              const e = _t4862[1];
              _t4863 = walk(locals, e);
              break _t4864;
            }
            _match_fail("line 16629");
          }
          return _t4863;
        }
        _t4845 = List$iter(_t4861, overrides);
        break _t4846;
      }
      if (_t4844._tag === 18) {
        const base = _t4844._val[0];
        const pairs = _t4844._val[1];
        walk(locals, base);
        function _t4865(__p100) {
          let _t4867;
          const _t4866 = __p100;
          _t4868: {
            if (true) {
              const i = _t4866[0];
              const v = _t4866[1];
              walk(locals, i);
              _t4867 = walk(locals, v);
              break _t4868;
            }
            _match_fail("line 16629");
          }
          return _t4867;
        }
        _t4845 = List$iter(_t4865, pairs);
        break _t4846;
      }
      if (_t4844._tag === 19) {
        const e = _t4844._val[0];
        _t4845 = walk(locals, e);
        break _t4846;
      }
      if (_t4844._tag === 20) {
        const e = _t4844._val[0];
        const i = _t4844._val[1];
        walk(locals, e);
        _t4845 = walk(locals, i);
        break _t4846;
      }
      if (_t4844._tag === 21) {
        const h = _t4844._val[0];
        const t = _t4844._val[1];
        walk(locals, h);
        _t4845 = walk(locals, t);
        break _t4846;
      }
      if (_t4844._tag === 23) {
        const arg = _t4844._val[1];
        _t4845 = Option$iter(_call(walk, [locals]), arg);
        break _t4846;
      }
      if (_t4844._tag === 24) {
        const s = _t4844._val[0];
        const arms = _t4844._val[1];
        walk(locals, s);
        function _t4869(__p101) {
          let _t4871;
          const _t4870 = __p101;
          _t4872: {
            if (true) {
              const g = _t4870[1];
              const b = _t4870[2];
              Option$iter(_call(walk, [locals]), g);
              _t4871 = walk(locals, b);
              break _t4872;
            }
            _match_fail("line 16629");
          }
          return _t4871;
        }
        _t4845 = List$iter(_t4869, arms);
        break _t4846;
      }
      if (_t4844._tag === 26) {
        const e = _t4844._val[1];
        _t4845 = walk(locals, e);
        break _t4846;
      }
      if (_t4844._tag === 27) {
        const e = _t4844._val[0];
        const v = _t4844._val[2];
        walk(locals, e);
        _t4845 = walk(locals, v);
        break _t4846;
      }
      if (_t4844._tag === 28) {
        const e1 = _t4844._val[0];
        const e2 = _t4844._val[1];
        walk(locals, e1);
        _t4845 = walk(locals, e2);
        break _t4846;
      }
      if (_t4844._tag === 38) {
        const es = _t4844._val;
        _t4845 = List$iter(_call(walk, [locals]), es);
        break _t4846;
      }
      if (_t4844._tag === 32) {
        const c = _t4844._val[0];
        const b = _t4844._val[1];
        walk(locals, c);
        _t4845 = walk(locals, b);
        break _t4846;
      }
      if (_t4844._tag === 36) {
        const e = _t4844._val;
        _t4845 = walk(locals, e);
        break _t4846;
      }
      if (_t4844._tag === 39) {
        const e = _t4844._val;
        _t4845 = walk(locals, e);
        break _t4846;
      }
      if (_t4844._tag === 33) {
        const e = _t4844._val;
        _t4845 = walk(locals, e);
        break _t4846;
      }
      if ((_t4844._tag === 34 || _t4844._tag === 35)) {
        _t4845 = undefined;
        break _t4846;
      }
      if (_t4844._tag === 29) {
        const e = _t4844._val[1];
        _t4845 = walk(locals, e);
        break _t4846;
      }
      if (_t4844._tag === 30) {
        const e = _t4844._val[0];
        const arms = _t4844._val[1];
        walk(locals, e);
        function _t4873(arm) {
          let _t4875;
          const _t4874 = arm;
          _t4876: {
            if ((((_t4874._tag === 0 || _t4874._tag === 1) || _t4874._tag === 2) || _t4874._tag === 3)) {
              const body = (((_t4874._tag === 0 || _t4874._tag === 1) || _t4874._tag === 2) ? ((_t4874._tag === 0 || _t4874._tag === 1) ? (_t4874._tag === 0 ? _t4874._val[1] : _t4874._val[3]) : _t4874._val[2]) : _t4874._val[2]);
              _t4875 = walk(locals, body);
              break _t4876;
            }
            _match_fail("line 16629");
          }
          return _t4875;
        }
        _t4845 = List$iter(_t4873, arms);
        break _t4846;
      }
      if (_t4844._tag === 31) {
        const e1 = _t4844._val[0];
        const e2 = _t4844._val[1];
        walk(locals, e1);
        _t4845 = walk(locals, e2);
        break _t4846;
      }
      if (_t4844._tag === 37) {
        const bindings = _t4844._val[0];
        const body = _t4844._val[1];
        function _t4877(__p102) {
          let _t4879;
          const _t4878 = __p102;
          _t4880: {
            if (true) {
              const e = _t4878[1];
              _t4879 = walk(locals, e);
              break _t4880;
            }
            _match_fail("line 16629");
          }
          return _t4879;
        }
        List$iter(_t4877, bindings);
        _t4845 = walk(locals, body);
        break _t4846;
      }
      _match_fail("line 16629");
    }
    return _t4845;
  }
  const _t4881 = walk(null, te);
  const _t4829 = _t4881;
  const _t4771 = _t4829;
  const _t4697 = _t4771;
  const _t4695 = _t4697;
  return _t4695;
}
function Typechecker$is_syntactic_value(expr) {
  while (true) {
    let _t4883;
    const _t4882 = expr;
    _t4884: {
      if (((((((_t4882._tag === 0 || _t4882._tag === 1) || _t4882._tag === 2) || _t4882._tag === 3) || _t4882._tag === 4) || _t4882._tag === 5) || _t4882._tag === 6)) {
        _t4883 = true;
        break _t4884;
      }
      if (_t4882._tag === 7) {
        _t4883 = true;
        break _t4884;
      }
      if (_t4882._tag === 10) {
        _t4883 = true;
        break _t4884;
      }
      if (_t4882._tag === 21) {
        _t4883 = true;
        break _t4884;
      }
      if (_t4882._tag === 24 && _t4882._val[1]._tag === 0) {
        _t4883 = true;
        break _t4884;
      }
      if (_t4882._tag === 24 && _t4882._val[1]._tag === 1) {
        const e = _t4882._val[1]._val;
        const _t4885 = e;
        expr = _t4885;
        continue;
        _t4883 = undefined;
        break _t4884;
      }
      if ((_t4882._tag === 15 || _t4882._tag === 22)) {
        const es = _t4882._val;
        _t4883 = List$forall(Typechecker$is_syntactic_value, es);
        break _t4884;
      }
      if (_t4882._tag === 16) {
        const fields = _t4882._val;
        function _t4886(__p103) {
          let _t4888;
          const _t4887 = __p103;
          _t4889: {
            if (true) {
              const e = _t4887[1];
              _t4888 = Typechecker$is_syntactic_value(e);
              break _t4889;
            }
            _match_fail("line 16629");
          }
          return _t4888;
        }
        _t4883 = List$forall(_t4886, fields);
        break _t4884;
      }
      if (_t4882._tag === 20) {
        const a = _t4882._val[0];
        const b = _t4882._val[1];
        _t4883 = (Typechecker$is_syntactic_value(a) && Typechecker$is_syntactic_value(b));
        break _t4884;
      }
      if (_t4882._tag === 46 && _t4882._val[1]._tag === 0) {
        _t4883 = true;
        break _t4884;
      }
      if (_t4882._tag === 46 && _t4882._val[1]._tag === 1) {
        const e = _t4882._val[1]._val;
        const _t4890 = e;
        expr = _t4890;
        continue;
        _t4883 = undefined;
        break _t4884;
      }
      if (((_t4882._tag === 30 || _t4882._tag === 47) || _t4882._tag === 49)) {
        const e = ((_t4882._tag === 30 || _t4882._tag === 47) ? _t4882._val[0] : _t4882._val[1]);
        const _t4891 = e;
        expr = _t4891;
        continue;
        _t4883 = undefined;
        break _t4884;
      }
      if (true) {
        _t4883 = false;
        break _t4884;
      }
      _match_fail("line 16629");
    }
    return _t4883;
  }
}
function Typechecker$mono_scheme(ty) {
  return ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: 0, record_evidences: null, rquant: 0});
}
function Typechecker$synth(ctx, level, expr) {
  while (true) {
    let _t4893;
    const _t4892 = expr;
    _t4894: {
      if (_t4892._tag === 49) {
        const loc = _t4892._val[0];
        const inner = _t4892._val[1];
        Ref$set(Typechecker$current_loc, loc);
        const _t4895 = ctx;
        const _t4896 = level;
        const _t4897 = inner;
        ctx = _t4895;
        level = _t4896;
        expr = _t4897;
        continue;
        _t4893 = undefined;
        break _t4894;
      }
      if (_t4892._tag === 0) {
        const n = _t4892._val;
        _t4893 = Typechecker$mk(({_tag: 0, _name: "TEInt", _val: n}), ({_tag: 0, _name: "TInt"}));
        break _t4894;
      }
      if (_t4892._tag === 1) {
        const f = _t4892._val;
        _t4893 = Typechecker$mk(({_tag: 1, _name: "TEFloat", _val: f}), ({_tag: 1, _name: "TFloat"}));
        break _t4894;
      }
      if (_t4892._tag === 2) {
        const b = _t4892._val;
        _t4893 = Typechecker$mk(({_tag: 2, _name: "TEBool", _val: b}), ({_tag: 2, _name: "TBool"}));
        break _t4894;
      }
      if (_t4892._tag === 3) {
        const s = _t4892._val;
        _t4893 = Typechecker$mk(({_tag: 3, _name: "TEString", _val: s}), ({_tag: 3, _name: "TString"}));
        break _t4894;
      }
      if (_t4892._tag === 4) {
        const n = _t4892._val;
        _t4893 = Typechecker$mk(({_tag: 4, _name: "TEByte", _val: n}), ({_tag: 4, _name: "TByte"}));
        break _t4894;
      }
      if (_t4892._tag === 5) {
        const n = _t4892._val;
        _t4893 = Typechecker$mk(({_tag: 5, _name: "TERune", _val: n}), ({_tag: 5, _name: "TRune"}));
        break _t4894;
      }
      if (_t4892._tag === 6) {
        _t4893 = Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}));
        break _t4894;
      }
      if (_t4892._tag === 21) {
        _t4893 = Typechecker$mk(({_tag: 22, _name: "TENil"}), ({_tag: 10, _name: "TList", _val: Types$new_tvar(level)}));
        break _t4894;
      }
      if (_t4892._tag === 7) {
        const name = _t4892._val;
        const ty_4898 = Typechecker$lookup_var(ctx, level, name);
        const resolved_name_4900 = Typechecker$resolve_module_name(ctx, name);
        const _t4901 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: resolved_name_4900}), ty_4898);
        const _t4899 = _t4901;
        _t4893 = _t4899;
        break _t4894;
      }
      if (_t4892._tag === 13) {
        const op = _t4892._val[0];
        const e1 = _t4892._val[1];
        const e2 = _t4892._val[2];
        _t4893 = Typechecker$synth_binop(ctx, level, op, e1, e2);
        break _t4894;
      }
      if (_t4892._tag === 14) {
        const op = _t4892._val[0];
        const e = _t4892._val[1];
        _t4893 = Typechecker$synth_unop(ctx, level, op, e);
        break _t4894;
      }
      if (_t4892._tag === 11) {
        const fn_ = _t4892._val[0];
        const arg = _t4892._val[1];
        const fn_te_4902 = Typechecker$synth(ctx, level, fn_);
        const arg_te_4904 = Typechecker$synth(ctx, level, arg);
        const ret_ty_4906 = Types$new_tvar(level);
        const call_eff_4908 = Types$new_effvar(level);
        Typechecker$try_unify(fn_te_4902.ty, ({_tag: 7, _name: "TArrow", _val: [arg_te_4904.ty, call_eff_4908, ret_ty_4906]}));
        Typechecker$try_subeffect(call_eff_4908, ctx.current_eff);
        const _t4909 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_te_4902, arg_te_4904]}), ret_ty_4906);
        const _t4907 = _t4909;
        const _t4905 = _t4907;
        const _t4903 = _t4905;
        _t4893 = _t4903;
        break _t4894;
      }
      if (_t4892._tag === 10) {
        const param = _t4892._val[0];
        const body = _t4892._val[1];
        let _t4911;
        const _t4910 = param.annot;
        _t4912: {
          if (_t4910._tag === 1) {
            const annot = _t4910._val;
            _t4911 = Typechecker$resolve_ty_annot(ctx, level, annot);
            break _t4912;
          }
          if (_t4910._tag === 0) {
            _t4911 = Types$new_tvar(level);
            break _t4912;
          }
          _match_fail("line 16629");
        }
        const param_ty_4913 = _t4911;
        const body_eff_4915 = Types$new_effvar(level);
        const ret_ty_4917 = Types$new_tvar(level);
        let _t4919;
        if (param.is_generated) {
          const __rec_upd_4920 = ctx;
          const _t4921 = ({constraint_tvars: __rec_upd_4920.constraint_tvars, current_eff: body_eff_4915, current_module: __rec_upd_4920.current_module, inside_handler: __rec_upd_4920.inside_handler, loop_info: __rec_upd_4920.loop_info, mutable_vars: __rec_upd_4920.mutable_vars, return_type: __rec_upd_4920.return_type, return_used: __rec_upd_4920.return_used, type_env: __rec_upd_4920.type_env, vars: __rec_upd_4920.vars});
          _t4919 = _t4921;
        } else {
          const return_used_4922 = Ref$create(false);
          const __rec_upd_4924 = ctx;
          const _t4925 = ({constraint_tvars: __rec_upd_4924.constraint_tvars, current_eff: body_eff_4915, current_module: __rec_upd_4924.current_module, inside_handler: false, loop_info: __rec_upd_4924.loop_info, mutable_vars: __rec_upd_4924.mutable_vars, return_type: ({_tag: 1, _name: "Some", _val: ret_ty_4917}), return_used: return_used_4922, type_env: __rec_upd_4924.type_env, vars: __rec_upd_4924.vars});
          const _t4923 = _t4925;
          _t4919 = _t4923;
        }
        const ctx$p_4926 = _t4919;
        const ctx$p_4928 = Typechecker$extend_var_mono(ctx$p_4926, param.name, param_ty_4913);
        const body_te_4930 = Typechecker$synth(ctx$p_4928, level, body);
        Typechecker$try_unify(body_te_4930.ty, ret_ty_4917);
        let _t4932;
        if (param.is_generated) {
          _t4932 = false;
        } else {
          _t4932 = Ref$get(ctx$p_4928.return_used);
        }
        const has_return_4933 = _t4932;
        const _t4934 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param.name, body_te_4930, has_return_4933]}), ({_tag: 7, _name: "TArrow", _val: [param_ty_4913, body_eff_4915, ret_ty_4917]}));
        const _t4931 = _t4934;
        const _t4929 = _t4931;
        const _t4927 = _t4929;
        const _t4918 = _t4927;
        const _t4916 = _t4918;
        const _t4914 = _t4916;
        _t4893 = _t4914;
        break _t4894;
      }
      if (_t4892._tag === 8) {
        const name = _t4892._val[0];
        const e1 = _t4892._val[1];
        const e2 = _t4892._val[2];
        const e1_te_4935 = Typechecker$synth(ctx, (level + 1), e1);
        Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, e1_te_4935);
        let _t4937;
        if (Typechecker$is_syntactic_value(e1)) {
          _t4937 = Types$generalize(level, e1_te_4935.ty);
        } else {
          _t4937 = Typechecker$mono_scheme(e1_te_4935.ty);
        }
        const scheme_4938 = _t4937;
        const scheme_4940 = Typechecker$infer_implicit_constraints("", ctx.type_env, ctx.vars, e1_te_4935, scheme_4938);
        const scheme_4942 = Typechecker$infer_record_evidence(ctx.vars, e1_te_4935, scheme_4940);
        let _t4944;
        if (Typechecker$scheme_needs_xform(scheme_4942)) {
          _t4944 = ({_tag: 1, _name: "Some", _val: scheme_4942});
        } else {
          _t4944 = ({_tag: 0, _name: "None"});
        }
        const stored_scheme_4945 = _t4944;
        const ctx$p_4947 = Typechecker$extend_var(ctx, name, scheme_4942);
        const e2_te_4949 = Typechecker$synth(ctx$p_4947, level, e2);
        const _t4950 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [name, stored_scheme_4945, e1_te_4935, e2_te_4949]}), e2_te_4949.ty);
        const _t4948 = _t4950;
        const _t4946 = _t4948;
        const _t4943 = _t4946;
        const _t4941 = _t4943;
        const _t4939 = _t4941;
        const _t4936 = _t4939;
        _t4893 = _t4936;
        break _t4894;
      }
      if (_t4892._tag === 26) {
        const name = _t4892._val[0];
        const e1 = _t4892._val[1];
        const e2 = _t4892._val[2];
        const e1_te_4951 = Typechecker$synth(ctx, (level + 1), e1);
        const scheme_4953 = ({body: e1_te_4951.ty, constraints: null, equant: 0, pvquant: 0, quant: 0, record_evidences: null, rquant: 0});
        const ctx$p_4955 = Typechecker$extend_var_mutable(ctx, name, scheme_4953);
        const e2_te_4957 = Typechecker$synth(ctx$p_4955, level, e2);
        const _t4958 = Typechecker$mk(({_tag: 25, _name: "TELetMut", _val: [name, e1_te_4951, e2_te_4957]}), e2_te_4957.ty);
        const _t4956 = _t4958;
        const _t4954 = _t4956;
        const _t4952 = _t4954;
        _t4893 = _t4952;
        break _t4894;
      }
      if (_t4892._tag === 27) {
        const name = _t4892._val[0];
        const e = _t4892._val[1];
        let _t4959;
        if ((!List$mem(name, ctx.mutable_vars))) {
          _t4959 = Typechecker$error((("variable " + __dict_Show_string.show(name)) + " is not mutable"));
        } else {
          _t4959 = undefined;
        }
        _t4959;
        const var_ty_4960 = Typechecker$lookup_var(ctx, level, name);
        const e_te_4962 = Typechecker$check(ctx, level, e, var_ty_4960);
        const resolved_name_4964 = Typechecker$resolve_module_name(ctx, name);
        const _t4965 = Typechecker$mk(({_tag: 26, _name: "TEAssign", _val: [resolved_name_4964, e_te_4962]}), ({_tag: 6, _name: "TUnit"}));
        const _t4963 = _t4965;
        const _t4961 = _t4963;
        _t4893 = _t4961;
        break _t4894;
      }
      if (_t4892._tag === 28) {
        const record_expr = _t4892._val[0];
        const field = _t4892._val[1];
        const value_expr = _t4892._val[2];
        const r_te_4966 = Typechecker$synth(ctx, level, record_expr);
        const field_ty_4968 = Types$new_tvar(level);
        const row_tail_4970 = Types$new_rvar(level);
        let _t4973;
        const _t4972 = Types$repr(r_te_4966.ty);
        _t4974: {
          if (_t4972._tag === 15) {
            function _t4975(__p104) {
              let _t4977;
              const _t4976 = __p104;
              _t4978: {
                if (true) {
                  const _name = _t4976[0];
                  const fields = _t4976[1];
                  _t4977 = List$mem_assoc(field, fields);
                  break _t4978;
                }
                _match_fail("line 16629");
              }
              return _t4977;
            }
            const candidates_4979 = List$filter(_t4975, ctx.type_env.records);
            let _t4982;
            const _t4981 = candidates_4979;
            _t4983: {
              if (_t4981 !== null && _t4981._tl === null) {
                const _name = _t4981._hd[0];
                const fields = _t4981._hd[1];
                const row_4984 = Typechecker$instantiate_record_row(level, fields);
                const _t4985 = Typechecker$try_unify(r_te_4966.ty, ({_tag: 11, _name: "TRecord", _val: row_4984}));
                _t4982 = _t4985;
                break _t4983;
              }
              if (true) {
                _t4982 = Typechecker$try_unify(r_te_4966.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_4968, row_tail_4970]})}));
                break _t4983;
              }
              _match_fail("line 16629");
            }
            const _t4980 = _t4982;
            _t4973 = _t4980;
            break _t4974;
          }
          if (true) {
            _t4973 = Typechecker$try_unify(r_te_4966.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_4968, row_tail_4970]})}));
            break _t4974;
          }
          _match_fail("line 16629");
        }
        _t4973;
        let _t4987;
        const _t4986 = Types$repr(r_te_4966.ty);
        _t4988: {
          if (_t4986._tag === 11) {
            const row = _t4986._val;
            const fields_4989 = Types$record_row_to_fields(row);
            let _t4992;
            const _t4991 = List$assoc_opt(field, fields_4989);
            _t4993: {
              if (_t4991._tag === 1) {
                const ty = _t4991._val;
                _t4992 = ty;
                break _t4993;
              }
              if (_t4991._tag === 0) {
                _t4992 = Typechecker$error(("record has no field " + __dict_Show_string.show(field)));
                break _t4993;
              }
              _match_fail("line 16629");
            }
            const _t4990 = _t4992;
            _t4987 = _t4990;
            break _t4988;
          }
          if (true) {
            _t4987 = Typechecker$error("field assignment on non-record type");
            break _t4988;
          }
          _match_fail("line 16629");
        }
        const actual_field_ty_4994 = _t4987;
        let _t4996;
        if ((!List$mem(field, ctx.type_env.mutable_fields))) {
          _t4996 = Typechecker$error((("field " + __dict_Show_string.show(field)) + " is not mutable"));
        } else {
          _t4996 = undefined;
        }
        _t4996;
        const v_te_4997 = Typechecker$check(ctx, level, value_expr, actual_field_ty_4994);
        const _t4998 = Typechecker$mk(({_tag: 27, _name: "TEFieldAssign", _val: [r_te_4966, field, v_te_4997]}), ({_tag: 6, _name: "TUnit"}));
        const _t4995 = _t4998;
        const _t4971 = _t4995;
        const _t4969 = _t4971;
        const _t4967 = _t4969;
        _t4893 = _t4967;
        break _t4894;
      }
      if (_t4892._tag === 9) {
        const name = _t4892._val[0];
        const type_params = _t4892._val[1];
        const e1 = _t4892._val[2];
        const e2 = _t4892._val[3];
        let _t5000;
        const _t4999 = Typechecker$strip_loc(e1);
        _t5001: {
          if ((_t4999._tag === 10 || _t4999._tag === 30 && _t4999._val[0]._tag === 10)) {
            let _t5002;
            if (!_eq(type_params, null)) {
              let _t5004;
              const _t5003 = Typechecker$extract_fn_info(e1);
              _t5005: {
                if (true) {
                  const params = _t5003[0];
                  const ret_annot = _t5003[1];
                  const body = _t5003[2];
                  let _t5007;
                  const _t5006 = Typechecker$synth_poly_rec_fn(ctx, level, name, "", type_params, params, ret_annot, body);
                  _t5008: {
                    if (true) {
                      const e1_te = _t5006[0];
                      const scheme = _t5006[1];
                      const ctx$p_5009 = Typechecker$extend_var(ctx, name, scheme);
                      const e2_te_5011 = Typechecker$synth(ctx$p_5009, level, e2);
                      const _t5012 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 0, _name: "None"}), e1_te, e2_te_5011]}), e2_te_5011.ty);
                      const _t5010 = _t5012;
                      _t5007 = _t5010;
                      break _t5008;
                    }
                    _match_fail("line 16629");
                  }
                  _t5004 = _t5007;
                  break _t5005;
                }
                _match_fail("line 16629");
              }
              _t5002 = _t5004;
            } else {
              const fn_var_5013 = Types$new_tvar((level + 1));
              const ctx$p_5015 = Typechecker$extend_var_mono(ctx, name, fn_var_5013);
              const e1_te_5017 = Typechecker$synth(ctx$p_5015, (level + 1), e1);
              Typechecker$try_unify(fn_var_5013, e1_te_5017.ty);
              Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, e1_te_5017);
              const scheme_5019 = Types$generalize(level, e1_te_5017.ty);
              const scheme_5021 = Typechecker$infer_implicit_constraints(name, ctx.type_env, ctx.vars, e1_te_5017, scheme_5019);
              const scheme_5023 = Typechecker$infer_record_evidence(ctx.vars, e1_te_5017, scheme_5021);
              let _t5025;
              if (Typechecker$scheme_needs_xform(scheme_5023)) {
                _t5025 = ({_tag: 1, _name: "Some", _val: scheme_5023});
              } else {
                _t5025 = ({_tag: 0, _name: "None"});
              }
              const stored_scheme_5026 = _t5025;
              const ctx$p$p_5028 = Typechecker$extend_var(ctx, name, scheme_5023);
              const e2_te_5030 = Typechecker$synth(ctx$p$p_5028, level, e2);
              const _t5031 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, stored_scheme_5026, e1_te_5017, e2_te_5030]}), e2_te_5030.ty);
              const _t5029 = _t5031;
              const _t5027 = _t5029;
              const _t5024 = _t5027;
              const _t5022 = _t5024;
              const _t5020 = _t5022;
              const _t5018 = _t5020;
              const _t5016 = _t5018;
              const _t5014 = _t5016;
              _t5002 = _t5014;
            }
            _t5000 = _t5002;
            break _t5001;
          }
          if (true) {
            if ((Typechecker$is_constructive(e1) && (!Typechecker$is_immediately_linked(name, e1)))) {
              let _t5032;
              if (!_eq(type_params, null)) {
                _t5032 = Typechecker$error("recursive value binding does not support polymorphic type parameters");
              } else {
                _t5032 = undefined;
              }
              _t5032;
              const val_var_5033 = Types$new_tvar((level + 1));
              const ctx$p_5035 = Typechecker$extend_var_mono(ctx, name, val_var_5033);
              const e1_te_5037 = Typechecker$synth(ctx$p_5035, (level + 1), e1);
              Typechecker$try_unify(val_var_5033, e1_te_5037.ty);
              const scheme_5039 = Types$generalize(level, e1_te_5037.ty);
              const ctx$p$p_5041 = Typechecker$extend_var(ctx, name, scheme_5039);
              const e2_te_5043 = Typechecker$synth(ctx$p$p_5041, level, e2);
              const _t5044 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 0, _name: "None"}), e1_te_5037, e2_te_5043]}), e2_te_5043.ty);
              const _t5042 = _t5044;
              const _t5040 = _t5042;
              const _t5038 = _t5040;
              const _t5036 = _t5038;
              const _t5034 = _t5036;
              _t5000 = _t5034;
              break _t5001;
            }
          }
          if (true) {
            _t5000 = Typechecker$error("let rec binding must be a function or constructive expression");
            break _t5001;
          }
          _match_fail("line 16629");
        }
        _t4893 = _t5000;
        break _t4894;
      }
      if (_t4892._tag === 12) {
        const cond = _t4892._val[0];
        const then_e = _t4892._val[1];
        const else_e = _t4892._val[2];
        const cond_te_5045 = Typechecker$check(ctx, level, cond, ({_tag: 2, _name: "TBool"}));
        const then_te_5047 = Typechecker$synth(ctx, level, then_e);
        const else_te_5049 = Typechecker$check(ctx, level, else_e, then_te_5047.ty);
        const _t5050 = Typechecker$mk(({_tag: 12, _name: "TEIf", _val: [cond_te_5045, then_te_5047, else_te_5049]}), then_te_5047.ty);
        const _t5048 = _t5050;
        const _t5046 = _t5048;
        _t4893 = _t5046;
        break _t4894;
      }
      if (_t4892._tag === 15) {
        const exprs = _t4892._val;
        const tes_5051 = List$map(_call(Typechecker$synth, [ctx, level]), exprs);
        function _t5053(te) {
          return te.ty;
        }
        const tys_5054 = List$map(_t5053, tes_5051);
        const _t5055 = Typechecker$mk(({_tag: 15, _name: "TETuple", _val: tes_5051}), ({_tag: 9, _name: "TTuple", _val: tys_5054}));
        const _t5052 = _t5055;
        _t4893 = _t5052;
        break _t4894;
      }
      if (_t4892._tag === 16) {
        const fields = _t4892._val;
        function _t5056(__p105) {
          let _t5058;
          const _t5057 = __p105;
          _t5059: {
            if (true) {
              const n = _t5057[0];
              const e = _t5057[1];
              const te_5060 = Typechecker$synth(ctx, level, e);
              const _t5061 = [n, te_5060];
              _t5058 = _t5061;
              break _t5059;
            }
            _match_fail("line 16629");
          }
          return _t5058;
        }
        const typed_fields_5062 = List$map(_t5056, fields);
        function _t5064(__p106) {
          let _t5066;
          const _t5065 = __p106;
          _t5067: {
            if (true) {
              const n = _t5065[0];
              const te = _t5065[1];
              _t5066 = [n, te.ty];
              break _t5067;
            }
            _match_fail("line 16629");
          }
          return _t5066;
        }
        const field_tys_5068 = List$map(_t5064, typed_fields_5062);
        function _t5070(__p107, __p108) {
          let _t5072;
          const _t5071 = __p107;
          _t5073: {
            if (true) {
              const a = _t5071[0];
              let _t5075;
              const _t5074 = __p108;
              _t5076: {
                if (true) {
                  const b = _t5074[0];
                  _t5075 = String$compare(a, b);
                  break _t5076;
                }
                _match_fail("line 16629");
              }
              _t5072 = _t5075;
              break _t5073;
            }
            _match_fail("line 16629");
          }
          return _t5072;
        }
        const field_tys_5077 = List$sort(_t5070, field_tys_5068);
        const row_5079 = Types$fields_to_closed_row(field_tys_5077);
        const _t5080 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: typed_fields_5062}), ({_tag: 11, _name: "TRecord", _val: row_5079}));
        const _t5078 = _t5080;
        const _t5069 = _t5078;
        const _t5063 = _t5069;
        _t4893 = _t5063;
        break _t4894;
      }
      if (_t4892._tag === 17) {
        const base = _t4892._val[0];
        const overrides = _t4892._val[1];
        const base_te_5081 = Typechecker$synth(ctx, level, base);
        let _t5084;
        const _t5083 = Types$repr(base_te_5081.ty);
        _t5085: {
          if (_t5083._tag === 15) {
            const override_names_5086 = List$map(fst, overrides);
            function _t5088(__p109) {
              let _t5090;
              const _t5089 = __p109;
              _t5091: {
                if (true) {
                  const _name = _t5089[0];
                  const rfields = _t5089[1];
                  function _t5092(f) {
                    return List$mem_assoc(f, rfields);
                  }
                  _t5090 = List$forall(_t5092, override_names_5086);
                  break _t5091;
                }
                _match_fail("line 16629");
              }
              return _t5090;
            }
            const candidates_5093 = List$filter(_t5088, ctx.type_env.records);
            let _t5096;
            const _t5095 = candidates_5093;
            _t5097: {
              if (_t5095 !== null && _t5095._tl === null) {
                const rfields = _t5095._hd[1];
                const row_5098 = Typechecker$instantiate_record_row(level, rfields);
                const _t5099 = Typechecker$try_unify(base_te_5081.ty, ({_tag: 11, _name: "TRecord", _val: row_5098}));
                _t5096 = _t5099;
                break _t5097;
              }
              if (true) {
                const row_tail_5100 = Types$new_rvar(level);
                function _t5102(name, acc) {
                  return ({_tag: 0, _name: "RRow", _val: [name, Types$new_tvar(level), acc]});
                }
                const row_5103 = List$fold_right(_t5102, override_names_5086, row_tail_5100);
                const _t5104 = Typechecker$try_unify(base_te_5081.ty, ({_tag: 11, _name: "TRecord", _val: row_5103}));
                const _t5101 = _t5104;
                _t5096 = _t5101;
                break _t5097;
              }
              _match_fail("line 16629");
            }
            const _t5094 = _t5096;
            const _t5087 = _t5094;
            _t5084 = _t5087;
            break _t5085;
          }
          if (_t5083._tag === 11) {
            _t5084 = undefined;
            break _t5085;
          }
          if (true) {
            _t5084 = Typechecker$error("record update on non-record type");
            break _t5085;
          }
          _match_fail("line 16629");
        }
        _t5084;
        function _t5105(__p110) {
          let _t5107;
          const _t5106 = __p110;
          _t5108: {
            if (true) {
              const name = _t5106[0];
              const field_ty_5109 = Types$new_tvar(level);
              const row_tail_5111 = Types$new_rvar(level);
              Typechecker$try_unify(base_te_5081.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [name, field_ty_5109, row_tail_5111]})}));
              let _t5114;
              const _t5113 = Types$repr(base_te_5081.ty);
              _t5115: {
                if (_t5113._tag === 11) {
                  const row = _t5113._val;
                  const fields_5116 = Types$record_row_to_fields(row);
                  let _t5119;
                  const _t5118 = List$assoc_opt(name, fields_5116);
                  _t5120: {
                    if (_t5118._tag === 1) {
                      const ty = _t5118._val;
                      _t5119 = ty;
                      break _t5120;
                    }
                    if (_t5118._tag === 0) {
                      _t5119 = field_ty_5109;
                      break _t5120;
                    }
                    _match_fail("line 16629");
                  }
                  const _t5117 = _t5119;
                  _t5114 = _t5117;
                  break _t5115;
                }
                if (true) {
                  _t5114 = field_ty_5109;
                  break _t5115;
                }
                _match_fail("line 16629");
              }
              const actual_ty_5121 = _t5114;
              const _t5122 = [name, actual_ty_5121];
              const _t5112 = _t5122;
              const _t5110 = _t5112;
              _t5107 = _t5110;
              break _t5108;
            }
            _match_fail("line 16629");
          }
          return _t5107;
        }
        const override_field_tys_5123 = List$map(_t5105, overrides);
        function _t5125(__p111, __p112) {
          let _t5127;
          const _t5126 = __p111;
          _t5128: {
            if (true) {
              const name = _t5126[0];
              const e = _t5126[1];
              let _t5130;
              const _t5129 = __p112;
              _t5131: {
                if (true) {
                  const expected_ty = _t5129[1];
                  const te_5132 = Typechecker$check(ctx, level, e, expected_ty);
                  const _t5133 = [name, te_5132];
                  _t5130 = _t5133;
                  break _t5131;
                }
                _match_fail("line 16629");
              }
              _t5127 = _t5130;
              break _t5128;
            }
            _match_fail("line 16629");
          }
          return _t5127;
        }
        const typed_overrides_5134 = List$map2(_t5125, overrides, override_field_tys_5123);
        function has_open_tail(row) {
          while (true) {
            let _t5137;
            const _t5136 = Types$rrow_repr(row);
            _t5138: {
              if (_t5136._tag === 0) {
                const tail = _t5136._val[2];
                const _t5139 = tail;
                row = _t5139;
                continue;
                _t5137 = undefined;
                break _t5138;
              }
              if (_t5136._tag === 1 && _t5136._val.contents._tag === 0) {
                _t5137 = true;
                break _t5138;
              }
              if (true) {
                _t5137 = false;
                break _t5138;
              }
              _match_fail("line 16629");
            }
            return _t5137;
          }
        }
        let _t5142;
        const _t5141 = Types$repr(base_te_5081.ty);
        _t5143: {
          if (_t5141._tag === 11) {
            const row = _t5141._val;
            _t5142 = has_open_tail(row);
            break _t5143;
          }
          if (true) {
            _t5142 = false;
            break _t5143;
          }
          _match_fail("line 16629");
        }
        const is_open_5144 = _t5142;
        let _t5146;
        if (is_open_5144) {
          _t5146 = Typechecker$mk(({_tag: 17, _name: "TERecordUpdate", _val: [base_te_5081, typed_overrides_5134]}), base_te_5081.ty);
        } else {
          let _t5148;
          const _t5147 = Types$repr(base_te_5081.ty);
          _t5149: {
            if (_t5147._tag === 11) {
              const row = _t5147._val;
              _t5148 = Types$record_row_to_fields(row);
              break _t5149;
            }
            if (true) {
              _t5148 = Typechecker$error("record update on non-record type");
              break _t5149;
            }
            _match_fail("line 16629");
          }
          const field_tys_5150 = _t5148;
          const tmp_5152 = "__rec_upd";
          const tmp_ty_5154 = base_te_5081.ty;
          function _t5156(__p113) {
            let _t5158;
            const _t5157 = __p113;
            _t5159: {
              if (true) {
                const name = _t5157[0];
                const ty = _t5157[1];
                let _t5161;
                const _t5160 = List$assoc_opt(name, typed_overrides_5134);
                _t5162: {
                  if (_t5160._tag === 1) {
                    const te = _t5160._val;
                    _t5161 = [name, te];
                    break _t5162;
                  }
                  if (_t5160._tag === 0) {
                    _t5161 = [name, Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: tmp_5152}), tmp_ty_5154), name]}), ty)];
                    break _t5162;
                  }
                  _match_fail("line 16629");
                }
                _t5158 = _t5161;
                break _t5159;
              }
              _match_fail("line 16629");
            }
            return _t5158;
          }
          const all_fields_5163 = List$map(_t5156, field_tys_5150);
          const record_row_5165 = Types$fields_to_closed_row(field_tys_5150);
          const record_expr_5167 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: all_fields_5163}), ({_tag: 11, _name: "TRecord", _val: record_row_5165}));
          const _t5168 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [tmp_5152, ({_tag: 0, _name: "None"}), base_te_5081, record_expr_5167]}), ({_tag: 11, _name: "TRecord", _val: record_row_5165}));
          const _t5166 = _t5168;
          const _t5164 = _t5166;
          const _t5155 = _t5164;
          const _t5153 = _t5155;
          const _t5151 = _t5153;
          _t5146 = _t5151;
        }
        const _t5145 = _t5146;
        const _t5140 = _t5145;
        const _t5135 = _t5140;
        const _t5124 = _t5135;
        const _t5082 = _t5124;
        _t4893 = _t5082;
        break _t4894;
      }
      if (_t4892._tag === 18) {
        const e = _t4892._val[0];
        const field = _t4892._val[1];
        const te_5169 = Typechecker$synth(ctx, level, e);
        const field_ty_5171 = Types$new_tvar(level);
        const row_tail_5173 = Types$new_rvar(level);
        let _t5176;
        const _t5175 = Types$repr(te_5169.ty);
        _t5177: {
          if (_t5175._tag === 15) {
            function _t5178(__p114) {
              let _t5180;
              const _t5179 = __p114;
              _t5181: {
                if (true) {
                  const _name = _t5179[0];
                  const fields = _t5179[1];
                  _t5180 = List$mem_assoc(field, fields);
                  break _t5181;
                }
                _match_fail("line 16629");
              }
              return _t5180;
            }
            const candidates_5182 = List$filter(_t5178, ctx.type_env.records);
            let _t5185;
            const _t5184 = candidates_5182;
            _t5186: {
              if (_t5184 !== null && _t5184._tl === null) {
                const _name = _t5184._hd[0];
                const fields = _t5184._hd[1];
                const row_5187 = Typechecker$instantiate_record_row(level, fields);
                const _t5188 = Typechecker$try_unify(te_5169.ty, ({_tag: 11, _name: "TRecord", _val: row_5187}));
                _t5185 = _t5188;
                break _t5186;
              }
              if (true) {
                _t5185 = Typechecker$try_unify(te_5169.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_5171, row_tail_5173]})}));
                break _t5186;
              }
              _match_fail("line 16629");
            }
            const _t5183 = _t5185;
            _t5176 = _t5183;
            break _t5177;
          }
          if (true) {
            _t5176 = Typechecker$try_unify(te_5169.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_5171, row_tail_5173]})}));
            break _t5177;
          }
          _match_fail("line 16629");
        }
        _t5176;
        let _t5190;
        const _t5189 = Types$repr(te_5169.ty);
        _t5191: {
          if (_t5189._tag === 11) {
            const row = _t5189._val;
            const fields_5192 = Types$record_row_to_fields(row);
            let _t5195;
            const _t5194 = List$assoc_opt(field, fields_5192);
            _t5196: {
              if (_t5194._tag === 1) {
                const ty = _t5194._val;
                _t5195 = ty;
                break _t5196;
              }
              if (_t5194._tag === 0) {
                _t5195 = field_ty_5171;
                break _t5196;
              }
              _match_fail("line 16629");
            }
            const _t5193 = _t5195;
            _t5190 = _t5193;
            break _t5191;
          }
          if (true) {
            _t5190 = field_ty_5171;
            break _t5191;
          }
          _match_fail("line 16629");
        }
        const actual_field_ty_5197 = _t5190;
        const _t5198 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [te_5169, field]}), actual_field_ty_5197);
        const _t5174 = _t5198;
        const _t5172 = _t5174;
        const _t5170 = _t5172;
        _t4893 = _t5170;
        break _t4894;
      }
      if (_t4892._tag === 19) {
        const base = _t4892._val[0];
        const idx = _t4892._val[1];
        const te_base_5199 = Typechecker$synth(ctx, level, base);
        let _t5202;
        const _t5201 = Types$repr(te_base_5199.ty);
        _t5203: {
          if (_t5201._tag === 3) {
            const te_idx_5204 = Typechecker$check(ctx, level, idx, ({_tag: 0, _name: "TInt"}));
            const _t5205 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [te_base_5199, te_idx_5204]}), ({_tag: 4, _name: "TByte"}));
            _t5202 = _t5205;
            break _t5203;
          }
          if (_t5201._tag === 13) {
            const t = _t5201._val;
            const te_idx_5206 = Typechecker$check(ctx, level, idx, ({_tag: 0, _name: "TInt"}));
            const _t5207 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [te_base_5199, te_idx_5206]}), t);
            _t5202 = _t5207;
            break _t5203;
          }
          if (true) {
            const te_5208 = Typechecker$synth(ctx, level, ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "at"}), idx]}), base]}));
            function _t5210(c) {
              return (c.class_name === "Index");
            }
            let _t5212;
            const _t5211 = List$find(_t5210, ctx.type_env.classes);
            _t5213: {
              if (_t5211._tag === 1) {
                const class_def = _t5211._val;
                if (!_eq(class_def.class_fundeps, null)) {
                  const container_ty_5214 = Types$repr(te_base_5199.ty);
                  const partial_5216 = ({_hd: ({_tag: 1, _name: "Some", _val: container_ty_5214}), _tl: ({_hd: ({_tag: 0, _name: "None"}), _tl: ({_hd: ({_tag: 0, _name: "None"}), _tl: null})})});
                  const improved_5218 = Types$improve_with_fundeps(ctx.type_env.instances, class_def, partial_5216);
                  let _t5221;
                  const _t5220 = List$nth_opt(improved_5218, 2);
                  _t5222: {
                    if (_t5220._tag === 1 && _t5220._val._tag === 1) {
                      const val_ty = _t5220._val._val;
                      _t5221 = Typechecker$try_unify(te_5208.ty, val_ty);
                      break _t5222;
                    }
                    if (true) {
                      _t5221 = undefined;
                      break _t5222;
                    }
                    _match_fail("line 16629");
                  }
                  const _t5219 = _t5221;
                  const _t5217 = _t5219;
                  const _t5215 = _t5217;
                  _t5212 = _t5215;
                  break _t5213;
                }
              }
              if (true) {
                _t5212 = undefined;
                break _t5213;
              }
              _match_fail("line 16629");
            }
            _t5212;
            const _t5209 = te_5208;
            _t5202 = _t5209;
            break _t5203;
          }
          _match_fail("line 16629");
        }
        const _t5200 = _t5202;
        _t4893 = _t5200;
        break _t4894;
      }
      if (_t4892._tag === 20) {
        const hd = _t4892._val[0];
        const tl = _t4892._val[1];
        const hd_te_5223 = Typechecker$synth(ctx, level, hd);
        const list_ty_5225 = ({_tag: 10, _name: "TList", _val: hd_te_5223.ty});
        const tl_te_5227 = Typechecker$check(ctx, level, tl, list_ty_5225);
        const _t5228 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [hd_te_5223, tl_te_5227]}), list_ty_5225);
        const _t5226 = _t5228;
        const _t5224 = _t5226;
        _t4893 = _t5224;
        break _t4894;
      }
      if (_t4892._tag === 22 && _t4892._val !== null) {
        const first = _t4892._val._hd;
        const rest = _t4892._val._tl;
        const first_te_5229 = Typechecker$synth(ctx, level, first);
        function _t5231(e) {
          return Typechecker$check(ctx, level, e, first_te_5229.ty);
        }
        const rest_tes_5232 = List$map(_t5231, rest);
        const list_ty_5234 = ({_tag: 10, _name: "TList", _val: first_te_5229.ty});
        function _t5236(te, acc) {
          return Typechecker$mk(({_tag: 21, _name: "TECons", _val: [te, acc]}), list_ty_5234);
        }
        const _t5235 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [first_te_5229, List$fold_right(_t5236, rest_tes_5232, Typechecker$mk(({_tag: 22, _name: "TENil"}), list_ty_5234))]}), list_ty_5234);
        const _t5233 = _t5235;
        const _t5230 = _t5233;
        _t4893 = _t5230;
        break _t4894;
      }
      if (_t4892._tag === 22 && _t4892._val === null) {
        _t4893 = Typechecker$mk(({_tag: 22, _name: "TENil"}), ({_tag: 10, _name: "TList", _val: Types$new_tvar(level)}));
        break _t4894;
      }
      if (_t4892._tag === 23 && _t4892._val !== null) {
        const first = _t4892._val._hd;
        const rest = _t4892._val._tl;
        const first_te_5237 = Typechecker$synth(ctx, level, first);
        function _t5239(e) {
          return Typechecker$check(ctx, level, e, first_te_5237.ty);
        }
        const rest_tes_5240 = List$map(_t5239, rest);
        const _t5241 = Typechecker$mk(({_tag: 38, _name: "TEArray", _val: ({_hd: first_te_5237, _tl: rest_tes_5240})}), ({_tag: 13, _name: "TArray", _val: first_te_5237.ty}));
        const _t5238 = _t5241;
        _t4893 = _t5238;
        break _t4894;
      }
      if (_t4892._tag === 23 && _t4892._val === null) {
        _t4893 = Typechecker$mk(({_tag: 38, _name: "TEArray", _val: null}), ({_tag: 13, _name: "TArray", _val: Types$new_tvar(level)}));
        break _t4894;
      }
      if (_t4892._tag === 24) {
        const name = _t4892._val[0];
        const arg = _t4892._val[1];
        _t4893 = Typechecker$synth_construct(ctx, level, name, arg);
        break _t4894;
      }
      if (_t4892._tag === 25) {
        const scrut = _t4892._val[0];
        const arms = _t4892._val[1];
        const partial = _t4892._val[2];
        _t4893 = Typechecker$synth_match(({_tag: 0, _name: "None"}), ctx, level, scrut, arms, partial);
        break _t4894;
      }
      if (_t4892._tag === 29) {
        const e1 = _t4892._val[0];
        const e2 = _t4892._val[1];
        const e1_te_5242 = Typechecker$synth(ctx, level, e1);
        const e2_te_5244 = Typechecker$synth(ctx, level, e2);
        const _t5245 = Typechecker$mk(({_tag: 28, _name: "TESeq", _val: [e1_te_5242, e2_te_5244]}), e2_te_5244.ty);
        const _t5243 = _t5245;
        _t4893 = _t5243;
        break _t4894;
      }
      if (_t4892._tag === 30) {
        const e = _t4892._val[0];
        const annot = _t4892._val[1];
        const ty_5246 = Typechecker$resolve_ty_annot(ctx, level, annot);
        const te_5248 = Typechecker$check(ctx, level, e, ty_5246);
        const _t5249 = te_5248;
        const _t5247 = _t5249;
        _t4893 = _t5247;
        break _t4894;
      }
      if (_t4892._tag === 46 && _t4892._val[1]._tag === 0) {
        const tag = _t4892._val[0];
        const tail_5250 = Types$new_pvvar(level);
        const row_5252 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 0, _name: "None"}), tail_5250]});
        const _t5253 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [("`" + tag), ({_tag: 0, _name: "None"})]}), ({_tag: 14, _name: "TPolyVariant", _val: row_5252}));
        const _t5251 = _t5253;
        _t4893 = _t5251;
        break _t4894;
      }
      if (_t4892._tag === 46 && _t4892._val[1]._tag === 1) {
        const tag = _t4892._val[0];
        const arg = _t4892._val[1]._val;
        const arg_te_5254 = Typechecker$synth(ctx, level, arg);
        const tail_5256 = Types$new_pvvar(level);
        const row_5258 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 1, _name: "Some", _val: arg_te_5254.ty}), tail_5256]});
        const _t5259 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [("`" + tag), ({_tag: 1, _name: "Some", _val: arg_te_5254})]}), ({_tag: 14, _name: "TPolyVariant", _val: row_5258}));
        const _t5257 = _t5259;
        const _t5255 = _t5257;
        _t4893 = _t5255;
        break _t4894;
      }
      if (_t4892._tag === 47) {
        const inner = _t4892._val[0];
        const target_annot = _t4892._val[1];
        const inner_te_5260 = Typechecker$synth(ctx, level, inner);
        const target_ty_5262 = Typechecker$resolve_ty_annot(ctx, level, target_annot);
        Typechecker$try_unify(inner_te_5260.ty, target_ty_5262);
        const __rec_upd_5264 = inner_te_5260;
        const _t5265 = ({expr: __rec_upd_5264.expr, loc: __rec_upd_5264.loc, ty: target_ty_5262});
        const _t5263 = _t5265;
        const _t5261 = _t5263;
        _t4893 = _t5261;
        break _t4894;
      }
      if (_t4892._tag === 39) {
        const op_name = _t4892._val[0];
        const arg = _t4892._val[1];
        _t4893 = Typechecker$synth_perform(ctx, level, op_name, arg);
        break _t4894;
      }
      if (_t4892._tag === 40) {
        const body = _t4892._val[0];
        const arms = _t4892._val[1];
        _t4893 = Typechecker$synth_handle(ctx, level, body, arms);
        break _t4894;
      }
      if (_t4892._tag === 31) {
        const cond = _t4892._val[0];
        const body = _t4892._val[1];
        const __rec_upd_5266 = ctx;
        const _t5267 = ({constraint_tvars: __rec_upd_5266.constraint_tvars, current_eff: __rec_upd_5266.current_eff, current_module: __rec_upd_5266.current_module, inside_handler: __rec_upd_5266.inside_handler, loop_info: ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "WhileLoop"})}), mutable_vars: __rec_upd_5266.mutable_vars, return_type: __rec_upd_5266.return_type, return_used: __rec_upd_5266.return_used, type_env: __rec_upd_5266.type_env, vars: __rec_upd_5266.vars});
        const ctx$p_5268 = _t5267;
        const cond_te_5270 = Typechecker$check(ctx$p_5268, level, cond, ({_tag: 2, _name: "TBool"}));
        const body_te_5272 = Typechecker$check(ctx$p_5268, level, body, ({_tag: 6, _name: "TUnit"}));
        const _t5273 = Typechecker$mk(({_tag: 32, _name: "TEWhile", _val: [cond_te_5270, body_te_5272]}), ({_tag: 6, _name: "TUnit"}));
        const _t5271 = _t5273;
        const _t5269 = _t5271;
        _t4893 = _t5269;
        break _t4894;
      }
      if (_t4892._tag === 32) {
        const var_name = _t4892._val[0];
        const coll_expr = _t4892._val[1];
        const body_expr = _t4892._val[2];
        const __rec_upd_5274 = ctx;
        const _t5275 = ({constraint_tvars: __rec_upd_5274.constraint_tvars, current_eff: __rec_upd_5274.current_eff, current_module: __rec_upd_5274.current_module, inside_handler: __rec_upd_5274.inside_handler, loop_info: ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "UnitLoop"})}), mutable_vars: __rec_upd_5274.mutable_vars, return_type: __rec_upd_5274.return_type, return_used: __rec_upd_5274.return_used, type_env: __rec_upd_5274.type_env, vars: __rec_upd_5274.vars});
        const ctx$p_5276 = _t5275;
        const desugared_5278 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "fold"}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: "_"}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: var_name}), ({_tag: 29, _name: "ESeq", _val: [body_expr, ({_tag: 6, _name: "EUnit"})]})]})]})]}), ({_tag: 6, _name: "EUnit"})]}), coll_expr]});
        const fold_te_5280 = Typechecker$synth(ctx$p_5276, level, desugared_5278);
        const _t5281 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: fold_te_5280}), ({_tag: 6, _name: "TUnit"}));
        const _t5279 = _t5281;
        const _t5277 = _t5279;
        _t4893 = _t5277;
        break _t4894;
      }
      if (_t4892._tag === 33) {
        const var_name = _t4892._val[0];
        const coll_expr = _t4892._val[1];
        const acc_name = _t4892._val[2];
        const init_expr = _t4892._val[3];
        const body_expr = _t4892._val[4];
        const __rec_upd_5282 = ctx;
        const _t5283 = ({constraint_tvars: __rec_upd_5282.constraint_tvars, current_eff: __rec_upd_5282.current_eff, current_module: __rec_upd_5282.current_module, inside_handler: __rec_upd_5282.inside_handler, loop_info: ({_tag: 1, _name: "Some", _val: ({_tag: 2, _name: "FoldLoop", _val: acc_name})}), mutable_vars: __rec_upd_5282.mutable_vars, return_type: __rec_upd_5282.return_type, return_used: __rec_upd_5282.return_used, type_env: __rec_upd_5282.type_env, vars: __rec_upd_5282.vars});
        const ctx$p_5284 = _t5283;
        const desugared_5286 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "fold"}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: acc_name}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: var_name}), body_expr]})]})]}), init_expr]}), coll_expr]});
        const fold_te_5288 = Typechecker$synth(ctx$p_5284, level, desugared_5286);
        const _t5289 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: fold_te_5288}), fold_te_5288.ty);
        const _t5287 = _t5289;
        const _t5285 = _t5287;
        _t4893 = _t5285;
        break _t4894;
      }
      if (_t4892._tag === 35) {
        const value_opt = _t4892._val;
        let _t5291;
        const _t5290 = ctx.loop_info;
        _t5292: {
          if (_t5290._tag === 0) {
            _t5291 = Typechecker$error("break outside of loop");
            break _t5292;
          }
          if (_t5290._tag === 1 && _t5290._val._tag === 0) {
            let _t5293;
            if (!_eq(value_opt, ({_tag: 0, _name: "None"}))) {
              _t5293 = Typechecker$error("break with value only allowed in fold loops");
            } else {
              _t5293 = undefined;
            }
            _t5293;
            _t5291 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}))}), ({_tag: 6, _name: "TUnit"}));
            break _t5292;
          }
          if (_t5290._tag === 1 && _t5290._val._tag === 1) {
            let _t5294;
            if (!_eq(value_opt, ({_tag: 0, _name: "None"}))) {
              _t5294 = Typechecker$error("break with value only allowed in fold loops");
            } else {
              _t5294 = undefined;
            }
            _t5294;
            _t5291 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}))}), ({_tag: 6, _name: "TUnit"}));
            break _t5292;
          }
          if (_t5290._tag === 1 && _t5290._val._tag === 2) {
            const acc_name = _t5290._val._val;
            let _t5296;
            const _t5295 = value_opt;
            _t5297: {
              if (_t5295._tag === 1) {
                const e = _t5295._val;
                _t5296 = Typechecker$synth(ctx, level, e);
                break _t5297;
              }
              if (_t5295._tag === 0) {
                _t5296 = Typechecker$synth(ctx, level, ({_tag: 7, _name: "EVar", _val: acc_name}));
                break _t5297;
              }
              _match_fail("line 16629");
            }
            const v_te_5298 = _t5296;
            const _t5299 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: v_te_5298}), Types$new_tvar(level));
            _t5291 = _t5299;
            break _t5292;
          }
          _match_fail("line 16629");
        }
        _t4893 = _t5291;
        break _t4894;
      }
      if (_t4892._tag === 36) {
        let _t5301;
        const _t5300 = ctx.loop_info;
        _t5302: {
          if (_t5300._tag === 0) {
            _t5301 = Typechecker$error("continue outside of loop");
            break _t5302;
          }
          if (_t5300._tag === 1 && _t5300._val._tag === 0) {
            _t5301 = Typechecker$mk(({_tag: 34, _name: "TEContinueLoop"}), ({_tag: 6, _name: "TUnit"}));
            break _t5302;
          }
          if (_t5300._tag === 1 && _t5300._val._tag === 1) {
            _t5301 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}))}), ({_tag: 6, _name: "TUnit"}));
            break _t5302;
          }
          if (_t5300._tag === 1 && _t5300._val._tag === 2) {
            const acc_name = _t5300._val._val;
            const acc_te_5303 = Typechecker$synth(ctx, level, ({_tag: 7, _name: "EVar", _val: acc_name}));
            const _t5304 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: acc_te_5303}), Types$new_tvar(level));
            _t5301 = _t5304;
            break _t5302;
          }
          _match_fail("line 16629");
        }
        _t4893 = _t5301;
        break _t4894;
      }
      if (_t4892._tag === 37) {
        const e = _t4892._val;
        let _t5306;
        const _t5305 = ctx.return_type;
        _t5307: {
          if (_t5305._tag === 0) {
            _t5306 = Typechecker$error("return outside of function");
            break _t5307;
          }
          if (_t5305._tag === 1) {
            const ret_ty = _t5305._val;
            let _t5308;
            if (ctx.inside_handler) {
              _t5308 = Typechecker$error("Type error: return inside try/with is not supported");
            } else {
              _t5308 = undefined;
            }
            _t5308;
            Ref$set(ctx.return_used, true);
            const e_te_5309 = Typechecker$synth(ctx, level, e);
            Typechecker$try_unify(e_te_5309.ty, ret_ty);
            const _t5310 = Typechecker$mk(({_tag: 39, _name: "TEReturn", _val: e_te_5309}), Types$new_tvar(level));
            _t5306 = _t5310;
            break _t5307;
          }
          _match_fail("line 16629");
        }
        _t4893 = _t5306;
        break _t4894;
      }
      if (_t4892._tag === 34) {
        const pat = _t4892._val[0];
        const scrutinee = _t4892._val[1];
        const body = _t4892._val[2];
        const desugared_5311 = ({_tag: 31, _name: "EWhile", _val: [({_tag: 2, _name: "EBool", _val: true}), ({_tag: 25, _name: "EMatch", _val: [scrutinee, ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: ({_hd: [({_tag: 0, _name: "PatWild"}), ({_tag: 0, _name: "None"}), ({_tag: 35, _name: "EBreak", _val: ({_tag: 0, _name: "None"})})], _tl: null})}), false]})]});
        const _t5312 = Typechecker$synth(ctx, level, desugared_5311);
        _t4893 = _t5312;
        break _t4894;
      }
      if (_t4892._tag === 41) {
        const k_expr = _t4892._val[0];
        const v_expr = _t4892._val[1];
        const k_te_5313 = Typechecker$synth(ctx, level, k_expr);
        const v_te_5315 = Typechecker$synth(ctx, level, v_expr);
        const ret_ty_5317 = Types$new_tvar(level);
        const call_eff_5319 = Types$new_effvar(level);
        Typechecker$try_unify(k_te_5313.ty, ({_tag: 8, _name: "TCont", _val: [v_te_5315.ty, call_eff_5319, ret_ty_5317]}));
        Typechecker$try_subeffect(call_eff_5319, ctx.current_eff);
        const _t5320 = Typechecker$mk(({_tag: 31, _name: "TEResume", _val: [k_te_5313, v_te_5315]}), ret_ty_5317);
        const _t5318 = _t5320;
        const _t5316 = _t5318;
        const _t5314 = _t5316;
        _t4893 = _t5314;
        break _t4894;
      }
      if (_t4892._tag === 42) {
        const pairs = _t4892._val;
        function _t5321(__p115) {
          let _t5323;
          const _t5322 = __p115;
          _t5324: {
            if (true) {
              const k = _t5322[0];
              const v = _t5322[1];
              _t5323 = ({_tag: 15, _name: "ETuple", _val: ({_hd: k, _tl: ({_hd: v, _tl: null})})});
              break _t5324;
            }
            _match_fail("line 16629");
          }
          return _t5323;
        }
        const pair_list_5325 = ({_tag: 22, _name: "EList", _val: List$map(_t5321, pairs)});
        const desugared_5327 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "Map.of_list"}), pair_list_5325]});
        const _t5328 = Typechecker$synth(ctx, level, desugared_5327);
        const _t5326 = _t5328;
        _t4893 = _t5326;
        break _t4894;
      }
      if (_t4892._tag === 43) {
        const mod_name = _t4892._val[0];
        const pairs = _t4892._val[1];
        function _t5329(__p116) {
          let _t5331;
          const _t5330 = __p116;
          _t5332: {
            if (true) {
              const k = _t5330[0];
              const v = _t5330[1];
              _t5331 = ({_tag: 15, _name: "ETuple", _val: ({_hd: k, _tl: ({_hd: v, _tl: null})})});
              break _t5332;
            }
            _match_fail("line 16629");
          }
          return _t5331;
        }
        const pair_list_5333 = ({_tag: 22, _name: "EList", _val: List$map(_t5329, pairs)});
        const desugared_5335 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: (mod_name + ".of_list")}), pair_list_5333]});
        const _t5336 = Typechecker$synth(ctx, level, desugared_5335);
        const _t5334 = _t5336;
        _t4893 = _t5334;
        break _t4894;
      }
      if (_t4892._tag === 44) {
        const elems = _t4892._val;
        const list_expr_5337 = ({_tag: 22, _name: "EList", _val: elems});
        const desugared_5339 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "Set.of_list"}), list_expr_5337]});
        const _t5340 = Typechecker$synth(ctx, level, desugared_5339);
        const _t5338 = _t5340;
        _t4893 = _t5338;
        break _t4894;
      }
      if (_t4892._tag === 45) {
        const mod_name = _t4892._val[0];
        const elems = _t4892._val[1];
        const list_expr_5341 = ({_tag: 22, _name: "EList", _val: elems});
        const desugared_5343 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: (mod_name + ".of_list")}), list_expr_5341]});
        const _t5344 = Typechecker$synth(ctx, level, desugared_5343);
        const _t5342 = _t5344;
        _t4893 = _t5342;
        break _t4894;
      }
      if (_t4892._tag === 48) {
        const mod_name = _t4892._val[0];
        const inner_expr = _t4892._val[1];
        let _t5346;
        const _t5345 = Ref$get(Typechecker$find_module_in_env_ref, ctx.type_env, mod_name);
        _t5347: {
          if (_t5345._tag === 1) {
            const m = _t5345._val;
            _t5346 = m;
            break _t5347;
          }
          if (_t5345._tag === 0) {
            _t5346 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
            break _t5347;
          }
          _match_fail("line 16629");
        }
        const minfo_5348 = _t5346;
        function _t5350(body, __p117) {
          let _t5352;
          const _t5351 = __p117;
          _t5353: {
            if (true) {
              const _mml$short = _t5351[0];
              const _scheme = _t5351[1];
              const qualified_5354 = (mod_name + ("." + _mml$short));
              const _t5355 = ({_tag: 8, _name: "ELet", _val: [_mml$short, ({_tag: 7, _name: "EVar", _val: qualified_5354}), body]});
              _t5352 = _t5355;
              break _t5353;
            }
            _match_fail("line 16629");
          }
          return _t5352;
        }
        const desugared_5356 = List$fold(_t5350, inner_expr, minfo_5348.mod_pub_vars);
        const _t5357 = Typechecker$synth(ctx, level, desugared_5356);
        const _t5349 = _t5357;
        _t4893 = _t5349;
        break _t4894;
      }
      if (_t4892._tag === 38) {
        const bindings = _t4892._val[0];
        const body = _t4892._val[1];
        function _t5358(__p118) {
          let _t5360;
          const _t5359 = __p118;
          _t5361: {
            if (true) {
              const tp = _t5359[1];
              _t5360 = !_eq(tp, null);
              break _t5361;
            }
            _match_fail("line 16629");
          }
          return _t5360;
        }
        const has_poly_5362 = List$exists(_t5358, bindings);
        let _t5364;
        if (has_poly_5362) {
          function _t5365(__p119) {
            let _t5367;
            const _t5366 = __p119;
            _t5368: {
              if (true) {
                const name = _t5366[0];
                const type_params = _t5366[1];
                const fn_expr = _t5366[2];
                let _t5370;
                const _t5369 = Typechecker$extract_fn_info(fn_expr);
                _t5371: {
                  if (true) {
                    const params = _t5369[0];
                    const ret_annot = _t5369[1];
                    const inner_body = _t5369[2];
                    _t5370 = [name, type_params, params, ret_annot, inner_body];
                    break _t5371;
                  }
                  _match_fail("line 16629");
                }
                _t5367 = _t5370;
                break _t5368;
              }
              _match_fail("line 16629");
            }
            return _t5367;
          }
          const infos_5372 = List$map(_t5365, bindings);
          function _t5374(__p120) {
            let _t5376;
            const _t5375 = __p120;
            _t5377: {
              if (true) {
                const type_params = _t5375[1];
                const params = _t5375[2];
                const ret_annot = _t5375[3];
                const shared_tvars_5378 = Hashtbl$create(4);
                function _t5380(tp) {
                  return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_5378, tp, Types$new_tvar((level + 1))]);
                }
                List$iter(_t5380, type_params);
                function _t5381(p) {
                  let _t5383;
                  const _t5382 = p.annot;
                  _t5384: {
                    if (_t5382._tag === 1) {
                      const annot = _t5382._val;
                      _t5383 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5378, annot);
                      break _t5384;
                    }
                    if (_t5382._tag === 0) {
                      _t5383 = Types$new_tvar((level + 1));
                      break _t5384;
                    }
                    _match_fail("line 16629");
                  }
                  return _t5383;
                }
                const param_tys_5385 = List$map(_t5381, params);
                let _t5388;
                const _t5387 = ret_annot;
                _t5389: {
                  if (_t5387._tag === 1 && _t5387._val._tag === 10) {
                    const ty = _t5387._val._val[0];
                    const eff_annot = _t5387._val._val[1];
                    const ty$p_5390 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5378, ty);
                    let _t5393;
                    const _t5392 = eff_annot;
                    _t5394: {
                      if (_t5392._tag === 0) {
                        _t5393 = ({_tag: 1, _name: "EffEmpty"});
                        break _t5394;
                      }
                      if (_t5392._tag === 1) {
                        const items = _t5392._val;
                        _t5393 = Typechecker$resolve_eff_items(ctx, (level + 1), shared_tvars_5378, items);
                        break _t5394;
                      }
                      _match_fail("line 16629");
                    }
                    const eff_5395 = _t5393;
                    const _t5396 = [ty$p_5390, eff_5395];
                    const _t5391 = _t5396;
                    _t5388 = _t5391;
                    break _t5389;
                  }
                  if (_t5387._tag === 1) {
                    const annot = _t5387._val;
                    _t5388 = [Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5378, annot), Types$new_effvar((level + 1))];
                    break _t5389;
                  }
                  if (_t5387._tag === 0) {
                    _t5388 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
                    break _t5389;
                  }
                  _match_fail("line 16629");
                }
                let _t5398;
                const _t5397 = _t5388;
                _t5399: {
                  if (true) {
                    const ret_ty = _t5397[0];
                    const body_eff = _t5397[1];
                    let _t5401;
                    const _t5400 = List$rev(param_tys_5385);
                    _t5402: {
                      if (_t5400 === null) {
                        _t5401 = ret_ty;
                        break _t5402;
                      }
                      if (_t5400 !== null) {
                        const last = _t5400._hd;
                        const rest = _t5400._tl;
                        const inner_5403 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
                        function _t5405(acc, pty) {
                          return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
                        }
                        const _t5404 = List$fold(_t5405, inner_5403, rest);
                        _t5401 = _t5404;
                        break _t5402;
                      }
                      _match_fail("line 16629");
                    }
                    const fn_ty_5406 = _t5401;
                    const _t5407 = [param_tys_5385, ret_ty, body_eff, fn_ty_5406];
                    _t5398 = _t5407;
                    break _t5399;
                  }
                  _match_fail("line 16629");
                }
                const _t5386 = _t5398;
                const _t5379 = _t5386;
                _t5376 = _t5379;
                break _t5377;
              }
              _match_fail("line 16629");
            }
            return _t5376;
          }
          const tvars_list_5408 = List$map(_t5374, infos_5372);
          function _t5410(__p121) {
            let _t5412;
            const _t5411 = __p121;
            _t5413: {
              if (true) {
                const fn_ty = _t5411[3];
                _t5412 = Types$generalize(level, fn_ty);
                break _t5413;
              }
              _match_fail("line 16629");
            }
            return _t5412;
          }
          const schemes_5414 = List$map(_t5410, tvars_list_5408);
          function _t5416(ctx, __p122, scheme) {
            let _t5418;
            const _t5417 = __p122;
            _t5419: {
              if (true) {
                const name = _t5417[0];
                _t5418 = Typechecker$extend_var(ctx, name, scheme);
                break _t5419;
              }
              _match_fail("line 16629");
            }
            return _t5418;
          }
          const ctx$p_5420 = List$fold2(_t5416, ctx, infos_5372, schemes_5414);
          function _t5422(__p123, __p124) {
            let _t5424;
            const _t5423 = __p123;
            _t5425: {
              if (true) {
                const params = _t5423[2];
                const inner_body = _t5423[4];
                let _t5427;
                const _t5426 = __p124;
                _t5428: {
                  if (true) {
                    const param_tys = _t5426[0];
                    const ret_ty = _t5426[1];
                    const body_eff = _t5426[2];
                    function _t5429(c, p, ty) {
                      return Typechecker$extend_var_mono(c, p.name, ty);
                    }
                    const __rec_upd_5430 = ctx$p_5420;
                    const _t5431 = ({constraint_tvars: __rec_upd_5430.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_5430.current_module, inside_handler: __rec_upd_5430.inside_handler, loop_info: __rec_upd_5430.loop_info, mutable_vars: __rec_upd_5430.mutable_vars, return_type: __rec_upd_5430.return_type, return_used: __rec_upd_5430.return_used, type_env: __rec_upd_5430.type_env, vars: __rec_upd_5430.vars});
                    const inner_ctx_5432 = List$fold2(_t5429, _t5431, params, param_tys);
                    const body_te_5434 = Typechecker$check(inner_ctx_5432, (level + 1), inner_body, ret_ty);
                    let _t5437;
                    const _t5436 = [List$rev(params), List$rev(param_tys)];
                    _t5438: {
                      if (_t5436[0] === null && _t5436[1] === null) {
                        _t5437 = body_te_5434;
                        break _t5438;
                      }
                      if (_t5436[0] !== null && _t5436[1] !== null) {
                        const last_p = _t5436[0]._hd;
                        const rest_ps = _t5436[0]._tl;
                        const last_pty = _t5436[1]._hd;
                        const rest_ptys = _t5436[1]._tl;
                        const inner_5439 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_5434, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_5434.ty]}));
                        function _t5441(acc, p, pty) {
                          return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
                        }
                        const _t5440 = List$fold2(_t5441, inner_5439, rest_ps, rest_ptys);
                        _t5437 = _t5440;
                        break _t5438;
                      }
                      if (true) {
                        _t5437 = failwith("assert false");
                        break _t5438;
                      }
                      _match_fail("line 16629");
                    }
                    const _t5435 = _t5437;
                    const _t5433 = _t5435;
                    _t5427 = _t5433;
                    break _t5428;
                  }
                  _match_fail("line 16629");
                }
                _t5424 = _t5427;
                break _t5425;
              }
              _match_fail("line 16629");
            }
            return _t5424;
          }
          const body_tes_5442 = List$map2(_t5422, infos_5372, tvars_list_5408);
          function _t5444(ctx, __p125, scheme) {
            let _t5446;
            const _t5445 = __p125;
            _t5447: {
              if (true) {
                const name = _t5445[0];
                _t5446 = Typechecker$extend_var(ctx, name, scheme);
                break _t5447;
              }
              _match_fail("line 16629");
            }
            return _t5446;
          }
          const ctx$p$p_5448 = List$fold2(_t5444, ctx, infos_5372, schemes_5414);
          const body_te_5450 = Typechecker$synth(ctx$p$p_5448, level, body);
          function _t5452(__p126, te) {
            let _t5454;
            const _t5453 = __p126;
            _t5455: {
              if (true) {
                const name = _t5453[0];
                _t5454 = [name, te];
                break _t5455;
              }
              _match_fail("line 16629");
            }
            return _t5454;
          }
          const typed_bindings_5456 = List$map2(_t5452, infos_5372, body_tes_5442);
          const _t5457 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [typed_bindings_5456, body_te_5450]}), body_te_5450.ty);
          const _t5451 = _t5457;
          const _t5449 = _t5451;
          const _t5443 = _t5449;
          const _t5421 = _t5443;
          const _t5415 = _t5421;
          const _t5409 = _t5415;
          const _t5373 = _t5409;
          _t5364 = _t5373;
        } else {
          function _t5458(__p127) {
            let _t5460;
            const _t5459 = __p127;
            _t5461: {
              if (true) {
                const name = _t5459[0];
                _t5460 = name;
                break _t5461;
              }
              _match_fail("line 16629");
            }
            return _t5460;
          }
          const all_names_5462 = List$map(_t5458, bindings);
          function _t5464(__p128) {
            let _t5466;
            const _t5465 = __p128;
            _t5467: {
              if (true) {
                const name = _t5465[0];
                const fn_expr = _t5465[2];
                let _t5469;
                const _t5468 = Typechecker$strip_loc(fn_expr);
                _t5470: {
                  if ((_t5468._tag === 10 || _t5468._tag === 30 && _t5468._val[0]._tag === 10)) {
                    _t5469 = undefined;
                    break _t5470;
                  }
                  if (true) {
                    if ((Typechecker$is_constructive(fn_expr) && (!Typechecker$is_immediately_linked(name, fn_expr)))) {
                      _t5469 = undefined;
                      break _t5470;
                    }
                  }
                  if (true) {
                    _t5469 = Typechecker$error((("let rec binding for '" + __dict_Show_string.show(name)) + "' must be a function or constructive expression"));
                    break _t5470;
                  }
                  _match_fail("line 16629");
                }
                _t5466 = _t5469;
                break _t5467;
              }
              _match_fail("line 16629");
            }
            return _t5466;
          }
          List$iter(_t5464, bindings);
          all_names_5462;
          undefined;
          function _t5471(__p129) {
            let _t5473;
            const _t5472 = __p129;
            _t5474: {
              if (true) {
                const name = _t5472[0];
                _t5473 = [name, Types$new_tvar((level + 1))];
                break _t5474;
              }
              _match_fail("line 16629");
            }
            return _t5473;
          }
          const fn_vars_5475 = List$map(_t5471, bindings);
          function _t5477(ctx, __p130) {
            let _t5479;
            const _t5478 = __p130;
            _t5480: {
              if (true) {
                const name = _t5478[0];
                const tv = _t5478[1];
                _t5479 = Typechecker$extend_var_mono(ctx, name, tv);
                break _t5480;
              }
              _match_fail("line 16629");
            }
            return _t5479;
          }
          const ctx$p_5481 = List$fold(_t5477, ctx, fn_vars_5475);
          function _t5483(__p131, __p132) {
            let _t5485;
            const _t5484 = __p131;
            _t5486: {
              if (true) {
                const fn_expr = _t5484[2];
                let _t5488;
                const _t5487 = __p132;
                _t5489: {
                  if (true) {
                    const tv = _t5487[1];
                    const te_5490 = Typechecker$synth(ctx$p_5481, (level + 1), fn_expr);
                    Typechecker$try_unify(tv, te_5490.ty);
                    const _t5491 = te_5490;
                    _t5488 = _t5491;
                    break _t5489;
                  }
                  _match_fail("line 16629");
                }
                _t5485 = _t5488;
                break _t5486;
              }
              _match_fail("line 16629");
            }
            return _t5485;
          }
          const body_tes_5492 = List$map2(_t5483, bindings, fn_vars_5475);
          function _t5494(ctx, __p133, __p134) {
            let _t5496;
            const _t5495 = __p133;
            _t5497: {
              if (true) {
                const name = _t5495[0];
                let _t5499;
                const _t5498 = __p134;
                _t5500: {
                  if (true) {
                    const tv = _t5498[1];
                    const scheme_5501 = Types$generalize(level, tv);
                    const _t5502 = Typechecker$extend_var(ctx, name, scheme_5501);
                    _t5499 = _t5502;
                    break _t5500;
                  }
                  _match_fail("line 16629");
                }
                _t5496 = _t5499;
                break _t5497;
              }
              _match_fail("line 16629");
            }
            return _t5496;
          }
          const ctx$p$p_5503 = List$fold2(_t5494, ctx, bindings, fn_vars_5475);
          const body_te_5505 = Typechecker$synth(ctx$p$p_5503, level, body);
          function _t5507(__p135, te) {
            let _t5509;
            const _t5508 = __p135;
            _t5510: {
              if (true) {
                const name = _t5508[0];
                _t5509 = [name, te];
                break _t5510;
              }
              _match_fail("line 16629");
            }
            return _t5509;
          }
          const typed_bindings_5511 = List$map2(_t5507, bindings, body_tes_5492);
          const _t5512 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [typed_bindings_5511, body_te_5505]}), body_te_5505.ty);
          const _t5506 = _t5512;
          const _t5504 = _t5506;
          const _t5493 = _t5504;
          const _t5482 = _t5493;
          const _t5476 = _t5482;
          const _t5463 = _t5476;
          _t5364 = _t5463;
        }
        const _t5363 = _t5364;
        _t4893 = _t5363;
        break _t4894;
      }
      _match_fail("line 16629");
    }
    return _t4893;
  }
}
function Typechecker$synth_perform(ctx, level, op_name, arg) {
  let _t5514;
  const _t5513 = Types$find_effect_op(ctx.type_env, op_name);
  _t5515: {
    if (_t5513._tag === 0) {
      _t5514 = Typechecker$error(("unknown effect operation: " + __dict_Show_string.show(op_name)));
      break _t5515;
    }
    if (_t5513._tag === 1) {
      const effect_name = _t5513._val[0];
      const op_ty = _t5513._val[1];
      function _t5516(e) {
        return (e.effect_name === effect_name);
      }
      const edef_5517 = list_find(_t5516, ctx.type_env.effects);
      function _t5519(_) {
        return Types$new_tvar(level);
      }
      const fresh_params_5520 = List$map(_t5519, edef_5517.effect_params);
      const concrete_op_ty_5522 = Typechecker$freshen_tvars(level, op_ty);
      let _t5524;
      if (_eq(fresh_params_5520, null)) {
        _t5524 = concrete_op_ty_5522;
      } else {
        _t5524 = Typechecker$subst_tgens(fresh_params_5520, concrete_op_ty_5522);
      }
      const concrete_op_ty_5525 = _t5524;
      let _t5528;
      const _t5527 = Types$repr(concrete_op_ty_5525);
      _t5529: {
        if (_t5527._tag === 7) {
          const param_ty = _t5527._val[0];
          const ret_ty = _t5527._val[2];
          const arg_te_5530 = Typechecker$check(ctx, level, arg, param_ty);
          const fresh_tail_5532 = Types$new_effvar(level);
          Typechecker$try_unify_eff(ctx.current_eff, ({_tag: 2, _name: "EffRow", _val: [effect_name, fresh_params_5520, fresh_tail_5532]}));
          const _t5533 = Typechecker$mk(({_tag: 29, _name: "TEPerform", _val: [op_name, arg_te_5530]}), ret_ty);
          const _t5531 = _t5533;
          _t5528 = _t5531;
          break _t5529;
        }
        if (true) {
          _t5528 = Typechecker$error((("effect operation " + __dict_Show_string.show(op_name)) + " must have function type"));
          break _t5529;
        }
        _match_fail("line 16629");
      }
      const _t5526 = _t5528;
      const _t5523 = _t5526;
      const _t5521 = _t5523;
      const _t5518 = _t5521;
      _t5514 = _t5518;
      break _t5515;
    }
    _match_fail("line 16629");
  }
  return _t5514;
}
function Typechecker$synth_handle(ctx, level, body, arms) {
  const body_eff_5534 = Types$new_effvar(level);
  const __rec_upd_5536 = ctx;
  const _t5537 = ({constraint_tvars: __rec_upd_5536.constraint_tvars, current_eff: body_eff_5534, current_module: __rec_upd_5536.current_module, inside_handler: true, loop_info: __rec_upd_5536.loop_info, mutable_vars: __rec_upd_5536.mutable_vars, return_type: __rec_upd_5536.return_type, return_used: __rec_upd_5536.return_used, type_env: __rec_upd_5536.type_env, vars: __rec_upd_5536.vars});
  const body_ctx_5538 = _t5537;
  const body_te_5540 = Typechecker$synth(body_ctx_5538, level, body);
  const result_ty_5542 = Types$new_tvar(level);
  function _t5544(arm) {
    let _t5546;
    const _t5545 = arm;
    _t5547: {
      if (_t5545._tag === 1) {
        const op_name = _t5545._val[0];
        let _t5549;
        const _t5548 = Types$find_effect_op(ctx.type_env, op_name);
        _t5550: {
          if (_t5548._tag === 1) {
            const effect_name = _t5548._val[0];
            _t5549 = ({_tag: 1, _name: "Some", _val: effect_name});
            break _t5550;
          }
          if (_t5548._tag === 0) {
            _t5549 = Typechecker$error(("unknown effect operation in handler: " + __dict_Show_string.show(op_name)));
            break _t5550;
          }
          _match_fail("line 16629");
        }
        _t5546 = _t5549;
        break _t5547;
      }
      if (true) {
        _t5546 = ({_tag: 0, _name: "None"});
        break _t5547;
      }
      _match_fail("line 16629");
    }
    return _t5546;
  }
  const handled_effects_5551 = List$filter_map(_t5544, arms);
  const unique_effects_5553 = List$sort_uniq(String$compare, handled_effects_5551);
  function _t5555(effect_name) {
    function _t5556(e) {
      return (e.effect_name === effect_name);
    }
    const edef_5557 = list_find(_t5556, ctx.type_env.effects);
    function _t5559(_) {
      return Types$new_tvar(level);
    }
    const fresh_params_5560 = List$map(_t5559, edef_5557.effect_params);
    const _t5561 = [effect_name, fresh_params_5560];
    const _t5558 = _t5561;
    return _t5558;
  }
  const effect_fresh_params_5562 = List$map(_t5555, unique_effects_5553);
  function _t5564(eff, __p136) {
    let _t5566;
    const _t5565 = __p136;
    _t5567: {
      if (true) {
        const effect_name = _t5565[0];
        const fresh_params = _t5565[1];
        const _t5568 = (function() {
          const _t5569 = _h;
          _h = Object.assign({}, _t5569, {
            "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
          });
          try {
            const __x_5570 = Types$rewrite_row(effect_name, fresh_params, eff);
            return __x_5570;
          } catch (_exc) {
            if (_exc && _exc._e === "unify_error") {
              const msg = _exc._v;
              return Typechecker$error(msg);
            } else { throw _exc; }
          } finally { _h = _t5569; }
        })();
        _t5566 = _t5568;
        break _t5567;
      }
      _match_fail("line 16629");
    }
    return _t5566;
  }
  const remaining_eff_5571 = List$fold(_t5564, Types$eff_repr(body_eff_5534), effect_fresh_params_5562);
  Typechecker$try_unify_eff(remaining_eff_5571, ctx.current_eff);
  function _t5573(arm) {
    let _t5575;
    const _t5574 = arm;
    _t5576: {
      if (_t5574._tag === 0) {
        const name = _t5574._val[0];
        const handler_body = _t5574._val[1];
        const ctx$p_5577 = Typechecker$extend_var_mono(ctx, name, body_te_5540.ty);
        const handler_te_5579 = Typechecker$check(ctx$p_5577, level, handler_body, result_ty_5542);
        const _t5580 = ({_tag: 0, _name: "THReturn", _val: [name, handler_te_5579]});
        const _t5578 = _t5580;
        _t5575 = _t5578;
        break _t5576;
      }
      if (_t5574._tag === 1) {
        const op_name = _t5574._val[0];
        const arg_name = _t5574._val[1];
        const k_name = _t5574._val[2];
        const handler_body = _t5574._val[3];
        let _t5582;
        const _t5581 = Types$find_effect_op(ctx.type_env, op_name);
        _t5583: {
          if (_t5581._tag === 0) {
            _t5582 = Typechecker$error(("unknown effect operation in handler: " + __dict_Show_string.show(op_name)));
            break _t5583;
          }
          if (_t5581._tag === 1) {
            const effect_name = _t5581._val[0];
            const op_ty = _t5581._val[1];
            let _t5585;
            const _t5584 = List$assoc_opt(effect_name, effect_fresh_params_5562);
            _t5586: {
              if (_t5584._tag === 1) {
                const p = _t5584._val;
                _t5585 = p;
                break _t5586;
              }
              if (_t5584._tag === 0) {
                _t5585 = null;
                break _t5586;
              }
              _match_fail("line 16629");
            }
            const fresh_params_5587 = _t5585;
            let _t5589;
            if (_eq(fresh_params_5587, null)) {
              _t5589 = op_ty;
            } else {
              _t5589 = Typechecker$subst_tgens(fresh_params_5587, op_ty);
            }
            const concrete_op_ty_5590 = _t5589;
            let _t5593;
            const _t5592 = Types$repr(concrete_op_ty_5590);
            _t5594: {
              if (_t5592._tag === 7) {
                const a = _t5592._val[0];
                const b = _t5592._val[2];
                _t5593 = [a, b];
                break _t5594;
              }
              if (true) {
                _t5593 = Typechecker$error((("effect operation " + __dict_Show_string.show(op_name)) + " must have function type"));
                break _t5594;
              }
              _match_fail("line 16629");
            }
            let _t5596;
            const _t5595 = _t5593;
            _t5597: {
              if (true) {
                const param_ty = _t5595[0];
                const ret_ty_op = _t5595[1];
                const k_ty_5598 = ({_tag: 8, _name: "TCont", _val: [ret_ty_op, ctx.current_eff, result_ty_5542]});
                const ctx$p_5600 = Typechecker$extend_var_mono(ctx, arg_name, param_ty);
                const ctx$p_5602 = Typechecker$extend_var_mono(ctx$p_5600, k_name, k_ty_5598);
                const handler_te_5604 = Typechecker$check(ctx$p_5602, level, handler_body, result_ty_5542);
                const _t5605 = ({_tag: 1, _name: "THOp", _val: [op_name, arg_name, k_name, handler_te_5604]});
                const _t5603 = _t5605;
                const _t5601 = _t5603;
                const _t5599 = _t5601;
                _t5596 = _t5599;
                break _t5597;
              }
              _match_fail("line 16629");
            }
            const _t5591 = _t5596;
            const _t5588 = _t5591;
            _t5582 = _t5588;
            break _t5583;
          }
          _match_fail("line 16629");
        }
        _t5575 = _t5582;
        break _t5576;
      }
      _match_fail("line 16629");
    }
    return _t5575;
  }
  const typed_arms_5606 = List$map(_t5573, arms);
  const _t5607 = Typechecker$mk(({_tag: 30, _name: "TEHandle", _val: [body_te_5540, typed_arms_5606]}), result_ty_5542);
  const _t5572 = _t5607;
  const _t5563 = _t5572;
  const _t5554 = _t5563;
  const _t5552 = _t5554;
  const _t5543 = _t5552;
  const _t5541 = _t5543;
  const _t5539 = _t5541;
  const _t5535 = _t5539;
  return _t5535;
}
function Typechecker$synth_binop(ctx, level, op, e1, e2) {
  let _t5609;
  const _t5608 = op;
  _t5610: {
    if ((((_t5608._tag === 0 || _t5608._tag === 1) || _t5608._tag === 2) || _t5608._tag === 3)) {
      const te1_5611 = Typechecker$synth(ctx, level, e1);
      const te2_5613 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5611.ty, te2_5613.ty);
      const resolved_5615 = Types$repr(te1_5611.ty);
      let _t5618;
      const _t5617 = resolved_5615;
      _t5619: {
        if (_t5617._tag === 1) {
          _t5618 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5611, te2_5613]}), ({_tag: 1, _name: "TFloat"}));
          break _t5619;
        }
        if (_t5617._tag === 15 && _t5617._val.contents._tag === 0) {
          const id = _t5617._val.contents._val[0];
          let _t5620;
          if (List$mem(id, ctx.constraint_tvars)) {
            _t5620 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5611, te2_5613]}), Types$repr(te1_5611.ty));
          } else {
            Typechecker$try_unify(te1_5611.ty, ({_tag: 0, _name: "TInt"}));
            _t5620 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5611, te2_5613]}), ({_tag: 0, _name: "TInt"}));
          }
          _t5618 = _t5620;
          break _t5619;
        }
        if (_t5617._tag === 0) {
          _t5618 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5611, te2_5613]}), ({_tag: 0, _name: "TInt"}));
          break _t5619;
        }
        if (true) {
          _t5618 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5611, te2_5613]}), Types$repr(te1_5611.ty));
          break _t5619;
        }
        _match_fail("line 16629");
      }
      const _t5616 = _t5618;
      const _t5614 = _t5616;
      const _t5612 = _t5614;
      _t5609 = _t5612;
      break _t5610;
    }
    if (_t5608._tag === 4) {
      const te1_5621 = Typechecker$check(ctx, level, e1, ({_tag: 0, _name: "TInt"}));
      const te2_5623 = Typechecker$check(ctx, level, e2, ({_tag: 0, _name: "TInt"}));
      const _t5624 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5621, te2_5623]}), ({_tag: 0, _name: "TInt"}));
      const _t5622 = _t5624;
      _t5609 = _t5622;
      break _t5610;
    }
    if ((((_t5608._tag === 7 || _t5608._tag === 8) || _t5608._tag === 9) || _t5608._tag === 10)) {
      const te1_5625 = Typechecker$synth(ctx, level, e1);
      const te2_5627 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5625.ty, te2_5627.ty);
      const _t5628 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5625, te2_5627]}), ({_tag: 2, _name: "TBool"}));
      const _t5626 = _t5628;
      _t5609 = _t5626;
      break _t5610;
    }
    if ((_t5608._tag === 5 || _t5608._tag === 6)) {
      const te1_5629 = Typechecker$synth(ctx, level, e1);
      const te2_5631 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5629.ty, te2_5631.ty);
      const _t5632 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5629, te2_5631]}), ({_tag: 2, _name: "TBool"}));
      const _t5630 = _t5632;
      _t5609 = _t5630;
      break _t5610;
    }
    if ((_t5608._tag === 11 || _t5608._tag === 12)) {
      const te1_5633 = Typechecker$check(ctx, level, e1, ({_tag: 2, _name: "TBool"}));
      const te2_5635 = Typechecker$check(ctx, level, e2, ({_tag: 2, _name: "TBool"}));
      const _t5636 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5633, te2_5635]}), ({_tag: 2, _name: "TBool"}));
      const _t5634 = _t5636;
      _t5609 = _t5634;
      break _t5610;
    }
    if (_t5608._tag === 13) {
      const te1_5637 = Typechecker$check(ctx, level, e1, ({_tag: 3, _name: "TString"}));
      const te2_5639 = Typechecker$check(ctx, level, e2, ({_tag: 3, _name: "TString"}));
      const _t5640 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5637, te2_5639]}), ({_tag: 3, _name: "TString"}));
      const _t5638 = _t5640;
      _t5609 = _t5638;
      break _t5610;
    }
    if (((((_t5608._tag === 14 || _t5608._tag === 15) || _t5608._tag === 16) || _t5608._tag === 17) || _t5608._tag === 18)) {
      const te1_5641 = Typechecker$synth(ctx, level, e1);
      const te2_5643 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5641.ty, te2_5643.ty);
      const resolved_5645 = Types$repr(te1_5641.ty);
      let _t5648;
      const _t5647 = resolved_5645;
      _t5649: {
        if (_t5647._tag === 0) {
          _t5648 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5641, te2_5643]}), ({_tag: 0, _name: "TInt"}));
          break _t5649;
        }
        if (_t5647._tag === 15 && _t5647._val.contents._tag === 0) {
          const id = _t5647._val.contents._val[0];
          let _t5650;
          if (List$mem(id, ctx.constraint_tvars)) {
            _t5650 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5641, te2_5643]}), Types$repr(te1_5641.ty));
          } else {
            Typechecker$try_unify(te1_5641.ty, ({_tag: 0, _name: "TInt"}));
            _t5650 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5641, te2_5643]}), ({_tag: 0, _name: "TInt"}));
          }
          _t5648 = _t5650;
          break _t5649;
        }
        if (true) {
          _t5648 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5641, te2_5643]}), Types$repr(te1_5641.ty));
          break _t5649;
        }
        _match_fail("line 16629");
      }
      const _t5646 = _t5648;
      const _t5644 = _t5646;
      const _t5642 = _t5644;
      _t5609 = _t5642;
      break _t5610;
    }
    if (_t5608._tag === 19) {
      const te1_5651 = Typechecker$synth(ctx, level, e1);
      const te2_5653 = Typechecker$synth(ctx, level, e2);
      const ret_ty_5655 = Types$new_tvar(level);
      const call_eff_5657 = Types$new_effvar(level);
      Typechecker$try_unify(te2_5653.ty, ({_tag: 7, _name: "TArrow", _val: [te1_5651.ty, call_eff_5657, ret_ty_5655]}));
      Typechecker$try_subeffect(call_eff_5657, ctx.current_eff);
      const _t5658 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5651, te2_5653]}), ret_ty_5655);
      const _t5656 = _t5658;
      const _t5654 = _t5656;
      const _t5652 = _t5654;
      _t5609 = _t5652;
      break _t5610;
    }
    _match_fail("line 16629");
  }
  return _t5609;
}
function Typechecker$synth_unop(ctx, level, op, e) {
  let _t5660;
  const _t5659 = op;
  _t5661: {
    if (_t5659._tag === 0) {
      const te_5662 = Typechecker$synth(ctx, level, e);
      const resolved_5664 = Types$repr(te_5662.ty);
      let _t5667;
      const _t5666 = resolved_5664;
      _t5668: {
        if (_t5666._tag === 1) {
          _t5667 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5662]}), ({_tag: 1, _name: "TFloat"}));
          break _t5668;
        }
        if (_t5666._tag === 15 && _t5666._val.contents._tag === 0) {
          const id = _t5666._val.contents._val[0];
          let _t5669;
          if (List$mem(id, ctx.constraint_tvars)) {
            _t5669 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5662]}), Types$repr(te_5662.ty));
          } else {
            Typechecker$try_unify(te_5662.ty, ({_tag: 0, _name: "TInt"}));
            _t5669 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5662]}), ({_tag: 0, _name: "TInt"}));
          }
          _t5667 = _t5669;
          break _t5668;
        }
        if (_t5666._tag === 0) {
          _t5667 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5662]}), ({_tag: 0, _name: "TInt"}));
          break _t5668;
        }
        if (true) {
          _t5667 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5662]}), te_5662.ty);
          break _t5668;
        }
        _match_fail("line 16629");
      }
      const _t5665 = _t5667;
      const _t5663 = _t5665;
      _t5660 = _t5663;
      break _t5661;
    }
    if (_t5659._tag === 1) {
      const te_5670 = Typechecker$check(ctx, level, e, ({_tag: 2, _name: "TBool"}));
      const _t5671 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5670]}), ({_tag: 2, _name: "TBool"}));
      _t5660 = _t5671;
      break _t5661;
    }
    if (_t5659._tag === 2) {
      const te_5672 = Typechecker$synth(ctx, level, e);
      const resolved_5674 = Types$repr(te_5672.ty);
      let _t5677;
      const _t5676 = resolved_5674;
      _t5678: {
        if (_t5676._tag === 0) {
          _t5677 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5672]}), ({_tag: 0, _name: "TInt"}));
          break _t5678;
        }
        if (_t5676._tag === 15 && _t5676._val.contents._tag === 0) {
          Typechecker$try_unify(te_5672.ty, ({_tag: 0, _name: "TInt"}));
          _t5677 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5672]}), ({_tag: 0, _name: "TInt"}));
          break _t5678;
        }
        if (true) {
          _t5677 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5672]}), te_5672.ty);
          break _t5678;
        }
        _match_fail("line 16629");
      }
      const _t5675 = _t5677;
      const _t5673 = _t5675;
      _t5660 = _t5673;
      break _t5661;
    }
    _match_fail("line 16629");
  }
  return _t5660;
}
function Typechecker$qualify_ctor_name(type_env, name, info) {
  let _t5679;
  if (String$contains(".", name)) {
    _t5679 = name;
  } else {
    let _t5681;
    const _t5680 = String$rindex_opt(info.ctor_type_name, 46);
    _t5682: {
      if (_t5680._tag === 1) {
        const i = _t5680._val;
        const qualified_5683 = (String$sub(info.ctor_type_name, 0, (i + 1)) + name);
        let _t5685;
        if (!_eq(List$assoc_opt(qualified_5683, type_env.constructors), ({_tag: 0, _name: "None"}))) {
          _t5685 = qualified_5683;
        } else {
          _t5685 = name;
        }
        const _t5684 = _t5685;
        _t5681 = _t5684;
        break _t5682;
      }
      if (_t5680._tag === 0) {
        _t5681 = name;
        break _t5682;
      }
      _match_fail("line 16629");
    }
    _t5679 = _t5681;
  }
  return _t5679;
}
function Typechecker$qualify_pattern(type_env, pat) {
  function go(pat) {
    let _t5687;
    const _t5686 = pat;
    _t5688: {
      if (_t5686._tag === 10) {
        const name = _t5686._val[0];
        const arg = _t5686._val[1];
        let _t5690;
        const _t5689 = List$assoc_opt(name, type_env.constructors);
        _t5691: {
          if (_t5689._tag === 1) {
            const info = _t5689._val;
            _t5690 = Typechecker$qualify_ctor_name(type_env, name, info);
            break _t5691;
          }
          if (_t5689._tag === 0) {
            _t5690 = name;
            break _t5691;
          }
          _match_fail("line 16629");
        }
        const qname_5692 = _t5690;
        const _t5693 = ({_tag: 10, _name: "PatConstruct", _val: [qname_5692, Option$map(go, arg)]});
        _t5687 = _t5693;
        break _t5688;
      }
      if (_t5686._tag === 7) {
        const ps = _t5686._val;
        _t5687 = ({_tag: 7, _name: "PatTuple", _val: List$map(go, ps)});
        break _t5688;
      }
      if (_t5686._tag === 8) {
        const hd = _t5686._val[0];
        const tl = _t5686._val[1];
        _t5687 = ({_tag: 8, _name: "PatCons", _val: [go(hd), go(tl)]});
        break _t5688;
      }
      if (_t5686._tag === 13) {
        const p1 = _t5686._val[0];
        const p2 = _t5686._val[1];
        _t5687 = ({_tag: 13, _name: "PatOr", _val: [go(p1), go(p2)]});
        break _t5688;
      }
      if (_t5686._tag === 12) {
        const p = _t5686._val[0];
        const n = _t5686._val[1];
        _t5687 = ({_tag: 12, _name: "PatAs", _val: [go(p), n]});
        break _t5688;
      }
      if (_t5686._tag === 11) {
        const fields = _t5686._val;
        function _t5694(__p137) {
          let _t5696;
          const _t5695 = __p137;
          _t5697: {
            if (true) {
              const f = _t5695[0];
              const p = _t5695[1];
              _t5696 = [f, go(p)];
              break _t5697;
            }
            _match_fail("line 16629");
          }
          return _t5696;
        }
        _t5687 = ({_tag: 11, _name: "PatRecord", _val: List$map(_t5694, fields)});
        break _t5688;
      }
      if (_t5686._tag === 14) {
        const ps = _t5686._val;
        _t5687 = ({_tag: 14, _name: "PatArray", _val: List$map(go, ps)});
        break _t5688;
      }
      if (_t5686._tag === 15) {
        const kvs = _t5686._val;
        function _t5698(__p138) {
          let _t5700;
          const _t5699 = __p138;
          _t5701: {
            if (true) {
              const k = _t5699[0];
              const v = _t5699[1];
              _t5700 = [go(k), go(v)];
              break _t5701;
            }
            _match_fail("line 16629");
          }
          return _t5700;
        }
        _t5687 = ({_tag: 15, _name: "PatMap", _val: List$map(_t5698, kvs)});
        break _t5688;
      }
      if (_t5686._tag === 18) {
        const p = _t5686._val[0];
        const a = _t5686._val[1];
        _t5687 = ({_tag: 18, _name: "PatAnnot", _val: [go(p), a]});
        break _t5688;
      }
      if (true) {
        _t5687 = pat;
        break _t5688;
      }
      _match_fail("line 16629");
    }
    return _t5687;
  }
  const _t5702 = go(pat);
  return _t5702;
}
function Typechecker$synth_construct(ctx, level, name, arg) {
  let _t5704;
  const _t5703 = List$assoc_opt(name, ctx.type_env.constructors);
  _t5705: {
    if (_t5703._tag === 0) {
      _t5704 = Typechecker$error(("unknown constructor: " + __dict_Show_string.show(name)));
      break _t5705;
    }
    if (_t5703._tag === 1) {
      const info = _t5703._val;
      let _t5706;
      if (List$mem(info.ctor_type_name, ctx.type_env.hidden_ctor_types)) {
        _t5706 = Typechecker$error(("unknown constructor: " + __dict_Show_string.show(name)));
      } else {
        _t5706 = undefined;
      }
      _t5706;
      const qname_5707 = Typechecker$qualify_ctor_name(ctx.type_env, name, info);
      const num_fresh_5709 = (info.ctor_num_params + info.ctor_existentials);
      function _t5711(_) {
        return Types$new_tvar(level);
      }
      const all_fresh_5712 = List$init(num_fresh_5709, _t5711);
      function _t5714(i, _) {
        return (i < info.ctor_num_params);
      }
      const fresh_universals_5715 = List$filteri(_t5714, all_fresh_5712);
      let _t5718;
      const _t5717 = info.ctor_return_ty_params;
      _t5719: {
        if (_t5717._tag === 0) {
          _t5718 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, fresh_universals_5715]});
          break _t5719;
        }
        if (_t5717._tag === 1) {
          const params = _t5717._val;
          _t5718 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, List$map(_call(Typechecker$subst_tgens, [all_fresh_5712]), params)]});
          break _t5719;
        }
        _match_fail("line 16629");
      }
      const result_ty_5720 = _t5718;
      let _t5723;
      const _t5722 = [info.ctor_arg_ty, arg];
      _t5724: {
        if (_t5722[0]._tag === 0 && _t5722[1]._tag === 0) {
          _t5723 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [qname_5707, ({_tag: 0, _name: "None"})]}), result_ty_5720);
          break _t5724;
        }
        if (_t5722[0]._tag === 1 && _t5722[1]._tag === 1) {
          const expected_ty = _t5722[0]._val;
          const arg_expr = _t5722[1]._val;
          const concrete_ty_5725 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(all_fresh_5712, expected_ty));
          const arg_te_5727 = Typechecker$check(ctx, level, arg_expr, concrete_ty_5725);
          const _t5728 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [qname_5707, ({_tag: 1, _name: "Some", _val: arg_te_5727})]}), result_ty_5720);
          const _t5726 = _t5728;
          _t5723 = _t5726;
          break _t5724;
        }
        if (_t5722[0]._tag === 0 && _t5722[1]._tag === 1) {
          _t5723 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " takes no arguments"));
          break _t5724;
        }
        if (_t5722[0]._tag === 1 && _t5722[1]._tag === 0) {
          const expected_ty = _t5722[0]._val;
          const concrete_ty_5729 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(all_fresh_5712, expected_ty));
          const param_5731 = "__x";
          const param_var_5733 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: param_5731}), concrete_ty_5729);
          const body_5735 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [qname_5707, ({_tag: 1, _name: "Some", _val: param_var_5733})]}), result_ty_5720);
          const _t5736 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param_5731, body_5735, false]}), ({_tag: 7, _name: "TArrow", _val: [concrete_ty_5729, ({_tag: 1, _name: "EffEmpty"}), result_ty_5720]}));
          const _t5734 = _t5736;
          const _t5732 = _t5734;
          const _t5730 = _t5732;
          _t5723 = _t5730;
          break _t5724;
        }
        _match_fail("line 16629");
      }
      const _t5721 = _t5723;
      const _t5716 = _t5721;
      const _t5713 = _t5716;
      const _t5710 = _t5713;
      const _t5708 = _t5710;
      _t5704 = _t5708;
      break _t5705;
    }
    _match_fail("line 16629");
  }
  return _t5704;
}
function Typechecker$freeze_texpr(te) {
  const ft_5737 = Types$deep_repr(te.ty);
  let _t5740;
  const _t5739 = te.expr;
  _t5741: {
    if (((((((((_t5739._tag === 0 || _t5739._tag === 1) || _t5739._tag === 2) || _t5739._tag === 3) || _t5739._tag === 4) || _t5739._tag === 5) || _t5739._tag === 6) || _t5739._tag === 7) || _t5739._tag === 22)) {
      _t5740 = te.expr;
      break _t5741;
    }
    if (_t5739._tag === 8) {
      const n = _t5739._val[0];
      const s = _t5739._val[1];
      const e1 = _t5739._val[2];
      const e2 = _t5739._val[3];
      _t5740 = ({_tag: 8, _name: "TELet", _val: [n, s, Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5741;
    }
    if (_t5739._tag === 9) {
      const n = _t5739._val[0];
      const s = _t5739._val[1];
      const e1 = _t5739._val[2];
      const e2 = _t5739._val[3];
      _t5740 = ({_tag: 9, _name: "TELetRec", _val: [n, s, Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5741;
    }
    if (_t5739._tag === 10) {
      const p = _t5739._val[0];
      const body = _t5739._val[1];
      const hr = _t5739._val[2];
      _t5740 = ({_tag: 10, _name: "TEFun", _val: [p, Typechecker$freeze_texpr(body), hr]});
      break _t5741;
    }
    if (_t5739._tag === 11) {
      const f = _t5739._val[0];
      const a = _t5739._val[1];
      _t5740 = ({_tag: 11, _name: "TEApp", _val: [Typechecker$freeze_texpr(f), Typechecker$freeze_texpr(a)]});
      break _t5741;
    }
    if (_t5739._tag === 12) {
      const c = _t5739._val[0];
      const t = _t5739._val[1];
      const e = _t5739._val[2];
      _t5740 = ({_tag: 12, _name: "TEIf", _val: [Typechecker$freeze_texpr(c), Typechecker$freeze_texpr(t), Typechecker$freeze_texpr(e)]});
      break _t5741;
    }
    if (_t5739._tag === 13) {
      const op = _t5739._val[0];
      const l = _t5739._val[1];
      const r = _t5739._val[2];
      _t5740 = ({_tag: 13, _name: "TEBinop", _val: [op, Typechecker$freeze_texpr(l), Typechecker$freeze_texpr(r)]});
      break _t5741;
    }
    if (_t5739._tag === 14) {
      const op = _t5739._val[0];
      const e = _t5739._val[1];
      _t5740 = ({_tag: 14, _name: "TEUnop", _val: [op, Typechecker$freeze_texpr(e)]});
      break _t5741;
    }
    if (_t5739._tag === 15) {
      const es = _t5739._val;
      _t5740 = ({_tag: 15, _name: "TETuple", _val: List$map(Typechecker$freeze_texpr, es)});
      break _t5741;
    }
    if (_t5739._tag === 16) {
      const fs = _t5739._val;
      function _t5742(__p139) {
        let _t5744;
        const _t5743 = __p139;
        _t5745: {
          if (true) {
            const n = _t5743[0];
            const e = _t5743[1];
            _t5744 = [n, Typechecker$freeze_texpr(e)];
            break _t5745;
          }
          _match_fail("line 16629");
        }
        return _t5744;
      }
      _t5740 = ({_tag: 16, _name: "TERecord", _val: List$map(_t5742, fs)});
      break _t5741;
    }
    if (_t5739._tag === 17) {
      const base = _t5739._val[0];
      const overrides = _t5739._val[1];
      function _t5746(__p140) {
        let _t5748;
        const _t5747 = __p140;
        _t5749: {
          if (true) {
            const n = _t5747[0];
            const e = _t5747[1];
            _t5748 = [n, Typechecker$freeze_texpr(e)];
            break _t5749;
          }
          _match_fail("line 16629");
        }
        return _t5748;
      }
      _t5740 = ({_tag: 17, _name: "TERecordUpdate", _val: [Typechecker$freeze_texpr(base), List$map(_t5746, overrides)]});
      break _t5741;
    }
    if (_t5739._tag === 18) {
      const base = _t5739._val[0];
      const pairs = _t5739._val[1];
      function _t5750(__p141) {
        let _t5752;
        const _t5751 = __p141;
        _t5753: {
          if (true) {
            const i = _t5751[0];
            const v = _t5751[1];
            _t5752 = [Typechecker$freeze_texpr(i), Typechecker$freeze_texpr(v)];
            break _t5753;
          }
          _match_fail("line 16629");
        }
        return _t5752;
      }
      _t5740 = ({_tag: 18, _name: "TERecordUpdateIdx", _val: [Typechecker$freeze_texpr(base), List$map(_t5750, pairs)]});
      break _t5741;
    }
    if (_t5739._tag === 19) {
      const e = _t5739._val[0];
      const f = _t5739._val[1];
      _t5740 = ({_tag: 19, _name: "TEField", _val: [Typechecker$freeze_texpr(e), f]});
      break _t5741;
    }
    if (_t5739._tag === 20) {
      const e = _t5739._val[0];
      const i = _t5739._val[1];
      _t5740 = ({_tag: 20, _name: "TEIndex", _val: [Typechecker$freeze_texpr(e), Typechecker$freeze_texpr(i)]});
      break _t5741;
    }
    if (_t5739._tag === 21) {
      const h = _t5739._val[0];
      const t = _t5739._val[1];
      _t5740 = ({_tag: 21, _name: "TECons", _val: [Typechecker$freeze_texpr(h), Typechecker$freeze_texpr(t)]});
      break _t5741;
    }
    if (_t5739._tag === 23) {
      const n = _t5739._val[0];
      const arg = _t5739._val[1];
      _t5740 = ({_tag: 23, _name: "TEConstruct", _val: [n, Option$map(Typechecker$freeze_texpr, arg)]});
      break _t5741;
    }
    if (_t5739._tag === 24) {
      const s = _t5739._val[0];
      const arms = _t5739._val[1];
      const p = _t5739._val[2];
      function _t5754(__p142) {
        let _t5756;
        const _t5755 = __p142;
        _t5757: {
          if (true) {
            const pat = _t5755[0];
            const g = _t5755[1];
            const b = _t5755[2];
            _t5756 = [pat, Option$map(Typechecker$freeze_texpr, g), Typechecker$freeze_texpr(b)];
            break _t5757;
          }
          _match_fail("line 16629");
        }
        return _t5756;
      }
      _t5740 = ({_tag: 24, _name: "TEMatch", _val: [Typechecker$freeze_texpr(s), List$map(_t5754, arms), p]});
      break _t5741;
    }
    if (_t5739._tag === 25) {
      const n = _t5739._val[0];
      const e1 = _t5739._val[1];
      const e2 = _t5739._val[2];
      _t5740 = ({_tag: 25, _name: "TELetMut", _val: [n, Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5741;
    }
    if (_t5739._tag === 26) {
      const n = _t5739._val[0];
      const e = _t5739._val[1];
      _t5740 = ({_tag: 26, _name: "TEAssign", _val: [n, Typechecker$freeze_texpr(e)]});
      break _t5741;
    }
    if (_t5739._tag === 27) {
      const e = _t5739._val[0];
      const f = _t5739._val[1];
      const v = _t5739._val[2];
      _t5740 = ({_tag: 27, _name: "TEFieldAssign", _val: [Typechecker$freeze_texpr(e), f, Typechecker$freeze_texpr(v)]});
      break _t5741;
    }
    if (_t5739._tag === 28) {
      const e1 = _t5739._val[0];
      const e2 = _t5739._val[1];
      _t5740 = ({_tag: 28, _name: "TESeq", _val: [Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5741;
    }
    if (_t5739._tag === 29) {
      const name = _t5739._val[0];
      const e = _t5739._val[1];
      _t5740 = ({_tag: 29, _name: "TEPerform", _val: [name, Typechecker$freeze_texpr(e)]});
      break _t5741;
    }
    if (_t5739._tag === 30) {
      const e = _t5739._val[0];
      const arms = _t5739._val[1];
      function _t5758(arm) {
        let _t5760;
        const _t5759 = arm;
        _t5761: {
          if (_t5759._tag === 0) {
            const n = _t5759._val[0];
            const b = _t5759._val[1];
            _t5760 = ({_tag: 0, _name: "THReturn", _val: [n, Typechecker$freeze_texpr(b)]});
            break _t5761;
          }
          if (_t5759._tag === 1) {
            const eff = _t5759._val[0];
            const x = _t5759._val[1];
            const k = _t5759._val[2];
            const b = _t5759._val[3];
            _t5760 = ({_tag: 1, _name: "THOp", _val: [eff, x, k, Typechecker$freeze_texpr(b)]});
            break _t5761;
          }
          if (_t5759._tag === 2) {
            const eff = _t5759._val[0];
            const x = _t5759._val[1];
            const b = _t5759._val[2];
            _t5760 = ({_tag: 2, _name: "THOpProvide", _val: [eff, x, Typechecker$freeze_texpr(b)]});
            break _t5761;
          }
          if (_t5759._tag === 3) {
            const eff = _t5759._val[0];
            const x = _t5759._val[1];
            const b = _t5759._val[2];
            _t5760 = ({_tag: 3, _name: "THOpTry", _val: [eff, x, Typechecker$freeze_texpr(b)]});
            break _t5761;
          }
          _match_fail("line 16629");
        }
        return _t5760;
      }
      _t5740 = ({_tag: 30, _name: "TEHandle", _val: [Typechecker$freeze_texpr(e), List$map(_t5758, arms)]});
      break _t5741;
    }
    if (_t5739._tag === 31) {
      const k = _t5739._val[0];
      const v = _t5739._val[1];
      _t5740 = ({_tag: 31, _name: "TEResume", _val: [Typechecker$freeze_texpr(k), Typechecker$freeze_texpr(v)]});
      break _t5741;
    }
    if (_t5739._tag === 32) {
      const c = _t5739._val[0];
      const b = _t5739._val[1];
      _t5740 = ({_tag: 32, _name: "TEWhile", _val: [Typechecker$freeze_texpr(c), Typechecker$freeze_texpr(b)]});
      break _t5741;
    }
    if (_t5739._tag === 33) {
      const e = _t5739._val;
      _t5740 = ({_tag: 33, _name: "TEBreak", _val: Typechecker$freeze_texpr(e)});
      break _t5741;
    }
    if (_t5739._tag === 34) {
      _t5740 = ({_tag: 34, _name: "TEContinueLoop"});
      break _t5741;
    }
    if (_t5739._tag === 35) {
      const e = _t5739._val;
      _t5740 = ({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$freeze_texpr(e)});
      break _t5741;
    }
    if (_t5739._tag === 36) {
      const e = _t5739._val;
      _t5740 = ({_tag: 36, _name: "TEForLoop", _val: Typechecker$freeze_texpr(e)});
      break _t5741;
    }
    if (_t5739._tag === 37) {
      const binds = _t5739._val[0];
      const body = _t5739._val[1];
      function _t5762(__p143) {
        let _t5764;
        const _t5763 = __p143;
        _t5765: {
          if (true) {
            const n = _t5763[0];
            const e = _t5763[1];
            _t5764 = [n, Typechecker$freeze_texpr(e)];
            break _t5765;
          }
          _match_fail("line 16629");
        }
        return _t5764;
      }
      _t5740 = ({_tag: 37, _name: "TELetRecAnd", _val: [List$map(_t5762, binds), Typechecker$freeze_texpr(body)]});
      break _t5741;
    }
    if (_t5739._tag === 38) {
      const es = _t5739._val;
      _t5740 = ({_tag: 38, _name: "TEArray", _val: List$map(Typechecker$freeze_texpr, es)});
      break _t5741;
    }
    if (_t5739._tag === 39) {
      const e = _t5739._val;
      _t5740 = ({_tag: 39, _name: "TEReturn", _val: Typechecker$freeze_texpr(e)});
      break _t5741;
    }
    _match_fail("line 16629");
  }
  const fe_5766 = _t5740;
  const _t5767 = ({expr: fe_5766, loc: te.loc, ty: ft_5737});
  const _t5738 = _t5767;
  return _t5738;
}
function Typechecker$check_pattern_gadt(ctx, level, pat, scrut_ty) {
  let _t5769;
  const _t5768 = pat;
  _t5770: {
    if (_t5768._tag === 10) {
      const name = _t5768._val[0];
      const arg_pat = _t5768._val[1];
      let _t5772;
      const _t5771 = List$assoc_opt(name, ctx.type_env.constructors);
      _t5773: {
        if (_t5771._tag === 0) {
          _t5772 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
          break _t5773;
        }
        if (_t5771._tag === 1) {
          const info = _t5771._val;
          let _t5774;
          if (List$mem(info.ctor_type_name, ctx.type_env.hidden_ctor_types)) {
            _t5774 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
          } else {
            _t5774 = undefined;
          }
          _t5774;
          const num_fresh_5775 = (info.ctor_num_params + info.ctor_existentials);
          function _t5777(_) {
            return Types$new_tvar(level);
          }
          const all_fresh_5778 = List$init(num_fresh_5775, _t5777);
          function _t5780(i) {
            let _t5781;
            if ((i >= info.ctor_num_params)) {
              let _t5783;
              const _t5782 = List$nth(all_fresh_5778, i);
              _t5784: {
                if (_t5782._tag === 15) {
                  const r = _t5782._val;
                  _t5783 = ({_tag: 1, _name: "Some", _val: r});
                  break _t5784;
                }
                if (true) {
                  _t5783 = ({_tag: 0, _name: "None"});
                  break _t5784;
                }
                _match_fail("line 16629");
              }
              _t5781 = _t5783;
            } else {
              _t5781 = ({_tag: 0, _name: "None"});
            }
            return _t5781;
          }
          function _t5785(x) {
            return x;
          }
          const existential_refs_5786 = List$filter_map(_t5780, List$init(num_fresh_5775, _t5785));
          let _t5789;
          const _t5788 = info.ctor_return_ty_params;
          _t5790: {
            if (_t5788._tag === 1) {
              const params = _t5788._val;
              _t5789 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, List$map(_call(Typechecker$subst_tgens, [all_fresh_5778]), params)]});
              break _t5790;
            }
            if (_t5788._tag === 0) {
              function _t5791(i, _) {
                return (i < info.ctor_num_params);
              }
              const fresh_universals_5792 = List$filteri(_t5791, all_fresh_5778);
              const _t5793 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, fresh_universals_5792]});
              _t5789 = _t5793;
              break _t5790;
            }
            _match_fail("line 16629");
          }
          const return_ty_5794 = _t5789;
          Typechecker$try_unify(scrut_ty, return_ty_5794);
          let _t5797;
          const _t5796 = [info.ctor_arg_ty, arg_pat];
          _t5798: {
            if (_t5796[0]._tag === 0 && _t5796[1]._tag === 0) {
              _t5797 = null;
              break _t5798;
            }
            if (_t5796[0]._tag === 1 && _t5796[1]._tag === 1) {
              const arg_ty = _t5796[0]._val;
              const p = _t5796[1]._val;
              const concrete_ty_5799 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(all_fresh_5778, arg_ty));
              const _t5800 = Typechecker$check_pattern(ctx, level, p, concrete_ty_5799);
              _t5797 = _t5800;
              break _t5798;
            }
            if (_t5796[0]._tag === 0 && _t5796[1]._tag === 1) {
              _t5797 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " takes no arguments"));
              break _t5798;
            }
            if (_t5796[0]._tag === 1 && _t5796[1]._tag === 0) {
              _t5797 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " requires an argument"));
              break _t5798;
            }
            _match_fail("line 16629");
          }
          const bindings_5801 = _t5797;
          const _t5802 = [bindings_5801, existential_refs_5786];
          const _t5795 = _t5802;
          const _t5787 = _t5795;
          const _t5779 = _t5787;
          const _t5776 = _t5779;
          _t5772 = _t5776;
          break _t5773;
        }
        _match_fail("line 16629");
      }
      _t5769 = _t5772;
      break _t5770;
    }
    if (true) {
      _t5769 = [Typechecker$check_pattern(ctx, level, pat, scrut_ty), null];
      break _t5770;
    }
    _match_fail("line 16629");
  }
  return _t5769;
}
function Typechecker$check_existential_escape(existential_refs, result_ty) {
  function collect_tvar_refs(acc, ty) {
    while (true) {
      let _t5804;
      const _t5803 = Types$repr(ty);
      _t5805: {
        if (_t5803._tag === 15 && _t5803._val.contents._tag === 0) {
          const r = _t5803._val;
          function _t5806(x) {
            return _eq(x, r);
          }
          let _t5807;
          if (List$exists(_t5806, acc)) {
            _t5807 = acc;
          } else {
            _t5807 = ({_hd: r, _tl: acc});
          }
          _t5804 = _t5807;
          break _t5805;
        }
        if ((_t5803._tag === 7 || _t5803._tag === 8)) {
          const a = _t5803._val[0];
          const b = _t5803._val[2];
          const _t5808 = collect_tvar_refs(acc, a);
          const _t5809 = b;
          acc = _t5808;
          ty = _t5809;
          continue;
          _t5804 = undefined;
          break _t5805;
        }
        if (_t5803._tag === 9) {
          const ts = _t5803._val;
          _t5804 = List$fold(collect_tvar_refs, acc, ts);
          break _t5805;
        }
        if (_t5803._tag === 10) {
          const t = _t5803._val;
          const _t5810 = acc;
          const _t5811 = t;
          acc = _t5810;
          ty = _t5811;
          continue;
          _t5804 = undefined;
          break _t5805;
        }
        if (_t5803._tag === 13) {
          const t = _t5803._val;
          const _t5812 = acc;
          const _t5813 = t;
          acc = _t5812;
          ty = _t5813;
          continue;
          _t5804 = undefined;
          break _t5805;
        }
        if (_t5803._tag === 11) {
          const row = _t5803._val;
          function _t5814(a, __p144) {
            let _t5816;
            const _t5815 = __p144;
            _t5817: {
              if (true) {
                const t = _t5815[1];
                _t5816 = collect_tvar_refs(a, t);
                break _t5817;
              }
              _match_fail("line 16629");
            }
            return _t5816;
          }
          _t5804 = List$fold(_t5814, acc, Types$record_row_to_fields(row));
          break _t5805;
        }
        if (_t5803._tag === 12) {
          const args = _t5803._val[1];
          _t5804 = List$fold(collect_tvar_refs, acc, args);
          break _t5805;
        }
        if (_t5803._tag === 14) {
          const row = _t5803._val;
          function collect_pv(a, __x) {
            while (true) {
              let _t5819;
              const _t5818 = __x;
              _t5820: {
                if (_t5818._tag === 0 && _t5818._val[1]._tag === 1) {
                  const t = _t5818._val[1]._val;
                  const tail = _t5818._val[2];
                  const _t5821 = collect_tvar_refs(a, t);
                  const _t5822 = tail;
                  a = _t5821;
                  __x = _t5822;
                  continue;
                  _t5819 = undefined;
                  break _t5820;
                }
                if (_t5818._tag === 0 && _t5818._val[1]._tag === 0) {
                  const tail = _t5818._val[2];
                  const _t5823 = a;
                  const _t5824 = tail;
                  a = _t5823;
                  __x = _t5824;
                  continue;
                  _t5819 = undefined;
                  break _t5820;
                }
                if (true) {
                  _t5819 = a;
                  break _t5820;
                }
                _match_fail("line 16629");
              }
              return _t5819;
            }
          }
          const _t5825 = collect_pv(acc, row);
          _t5804 = _t5825;
          break _t5805;
        }
        if (true) {
          _t5804 = acc;
          break _t5805;
        }
        _match_fail("line 16629");
      }
      return _t5804;
    }
  }
  const result_refs_5827 = collect_tvar_refs(null, Types$deep_repr(result_ty));
  function _t5829(exist_ref) {
    let _t5831;
    const _t5830 = Types$repr(({_tag: 15, _name: "TVar", _val: exist_ref}));
    _t5832: {
      if (_t5830._tag === 15 && _t5830._val.contents._tag === 0) {
        const resolved_ref = _t5830._val;
        function _t5833(r) {
          return _eq(r, resolved_ref);
        }
        _t5831 = List$exists(_t5833, result_refs_5827);
        break _t5832;
      }
      if (true) {
        const resolved = _t5830;
        const exist_refs_5834 = collect_tvar_refs(null, resolved);
        function _t5836(er) {
          function _t5837(rr) {
            return _eq(er, rr);
          }
          return List$exists(_t5837, result_refs_5827);
        }
        const _t5835 = List$exists(_t5836, exist_refs_5834);
        _t5831 = _t5835;
        break _t5832;
      }
      _match_fail("line 16629");
    }
    return _t5831;
  }
  const has_escape_5838 = List$exists(_t5829, existential_refs);
  let _t5840;
  if (has_escape_5838) {
    _t5840 = Typechecker$error("existential type variable would escape the scope of its GADT match arm");
  } else {
    _t5840 = undefined;
  }
  const _t5839 = _t5840;
  const _t5828 = _t5839;
  const _t5826 = _t5828;
  return _t5826;
}
function Typechecker$synth_match(expected_ty, ctx, level, scrut, arms, partial) {
  const scrut_te_5841 = Typechecker$synth(ctx, level, scrut);
  let _t5844;
  const _t5843 = Types$repr(scrut_te_5841.ty);
  _t5845: {
    if (_t5843._tag === 12) {
      const name = _t5843._val[0];
      const params = _t5843._val[1];
      let _t5847;
      const _t5846 = Typechecker$find_variant_info(ctx.type_env, name);
      _t5848: {
        if (_t5846._tag === 1 && _t5846._val[3]) {
          _t5847 = ({_tag: 1, _name: "Some", _val: [name, params]});
          break _t5848;
        }
        if (true) {
          _t5847 = ({_tag: 0, _name: "None"});
          break _t5848;
        }
        _match_fail("line 16629");
      }
      _t5844 = _t5847;
      break _t5845;
    }
    if (true) {
      _t5844 = ({_tag: 0, _name: "None"});
      break _t5845;
    }
    _match_fail("line 16629");
  }
  const gadt_info_5849 = _t5844;
  let _t5852;
  const _t5851 = gadt_info_5849;
  _t5853: {
    if (_t5851._tag === 1) {
      const _gadt_name = _t5851._val[0];
      const scrut_params = _t5851._val[1];
      let _t5855;
      const _t5854 = expected_ty;
      _t5856: {
        if (_t5854._tag === 1) {
          const ty = _t5854._val;
          _t5855 = ty;
          break _t5856;
        }
        if (_t5854._tag === 0) {
          _t5855 = Types$new_tvar(level);
          break _t5856;
        }
        _match_fail("line 16629");
      }
      const result_ty_5857 = _t5855;
      function _t5859(ty) {
        let _t5861;
        const _t5860 = Types$repr(ty);
        _t5862: {
          if (_t5860._tag === 15) {
            const r = _t5860._val;
            _t5861 = ({_tag: 1, _name: "Some", _val: r});
            break _t5862;
          }
          if (true) {
            _t5861 = ({_tag: 0, _name: "None"});
            break _t5862;
          }
          _match_fail("line 16629");
        }
        return _t5861;
      }
      const get_tvar_ref_5863 = _t5859;
      function _t5865(p) {
        let _t5867;
        const _t5866 = get_tvar_ref_5863(p);
        _t5868: {
          if (_t5866._tag === 1) {
            const r = _t5866._val;
            _t5867 = ({_tag: 1, _name: "Some", _val: [r, Ref$get(r)]});
            break _t5868;
          }
          if (_t5866._tag === 0) {
            _t5867 = ({_tag: 0, _name: "None"});
            break _t5868;
          }
          _match_fail("line 16629");
        }
        return _t5867;
      }
      const param_refs_5869 = List$filter_map(_t5865, scrut_params);
      function _t5871(_) {
        function _t5872(__p145) {
          let _t5874;
          const _t5873 = __p145;
          _t5875: {
            if (true) {
              const r = _t5873[0];
              _t5874 = [r, Ref$get(r)];
              break _t5875;
            }
            _match_fail("line 16629");
          }
          return _t5874;
        }
        return List$map(_t5872, param_refs_5869);
      }
      const save_snapshot_5876 = _t5871;
      function _t5878(saved) {
        function _t5879(__p146) {
          let _t5881;
          const _t5880 = __p146;
          _t5882: {
            if (true) {
              const r = _t5880[0];
              const v = _t5880[1];
              _t5881 = Ref$set(r, v);
              break _t5882;
            }
            _match_fail("line 16629");
          }
          return _t5881;
        }
        return List$iter(_t5879, saved);
      }
      const restore_snapshot_5883 = _t5878;
      function _t5885(__p147) {
        let _t5887;
        const _t5886 = __p147;
        _t5888: {
          if (true) {
            const pat = _t5886[0];
            const guard = _t5886[1];
            const body = _t5886[2];
            const snapshot_5889 = save_snapshot_5876(undefined);
            let _t5892;
            const _t5891 = pat;
            _t5893: {
              if (_t5891._tag === 10) {
                const name = _t5891._val[0];
                _t5892 = ({_tag: 1, _name: "Some", _val: name});
                break _t5893;
              }
              if (true) {
                _t5892 = ({_tag: 0, _name: "None"});
                break _t5893;
              }
              _match_fail("line 16629");
            }
            const ctor_name_5894 = _t5892;
            let _t5897;
            const _t5896 = ctor_name_5894;
            _t5898: {
              if (_t5896._tag === 1) {
                const name = _t5896._val;
                let _t5900;
                const _t5899 = List$assoc_opt(name, ctx.type_env.constructors);
                _t5901: {
                  if (_t5899._tag === 1) {
                    const info = _t5899._val;
                    _t5900 = !_eq(info.ctor_return_ty_params, ({_tag: 0, _name: "None"}));
                    break _t5901;
                  }
                  if (_t5899._tag === 0) {
                    _t5900 = false;
                    break _t5901;
                  }
                  _match_fail("line 16629");
                }
                _t5897 = _t5900;
                break _t5898;
              }
              if (_t5896._tag === 0) {
                _t5897 = false;
                break _t5898;
              }
              _match_fail("line 16629");
            }
            const is_gadt_ctor_5902 = _t5897;
            let _t5904;
            if (is_gadt_ctor_5902) {
              _t5904 = Typechecker$check_pattern_gadt(ctx, level, pat, scrut_te_5841.ty);
            } else {
              _t5904 = [Typechecker$check_pattern(ctx, level, pat, scrut_te_5841.ty), null];
            }
            let _t5906;
            const _t5905 = _t5904;
            _t5907: {
              if (true) {
                const bindings = _t5905[0];
                const existential_refs = _t5905[1];
                function _t5908(c, __p148) {
                  let _t5910;
                  const _t5909 = __p148;
                  _t5911: {
                    if (true) {
                      const n = _t5909[0];
                      const t = _t5909[1];
                      _t5910 = Typechecker$extend_var_mono(c, n, t);
                      break _t5911;
                    }
                    _match_fail("line 16629");
                  }
                  return _t5910;
                }
                const ctx$p_5912 = List$fold(_t5908, ctx, bindings);
                let _t5915;
                const _t5914 = guard;
                _t5916: {
                  if (_t5914._tag === 1) {
                    const g = _t5914._val;
                    _t5915 = ({_tag: 1, _name: "Some", _val: Typechecker$check(ctx$p_5912, level, g, ({_tag: 2, _name: "TBool"}))});
                    break _t5916;
                  }
                  if (_t5914._tag === 0) {
                    _t5915 = ({_tag: 0, _name: "None"});
                    break _t5916;
                  }
                  _match_fail("line 16629");
                }
                const guard_te_5917 = _t5915;
                const body_te_5919 = Typechecker$check(ctx$p_5912, level, body, result_ty_5857);
                const guard_te_5921 = Option$map(Typechecker$freeze_texpr, guard_te_5917);
                const body_te_5923 = Typechecker$freeze_texpr(body_te_5919);
                let _t5925;
                if (!_eq(existential_refs, null)) {
                  _t5925 = Typechecker$check_existential_escape(existential_refs, result_ty_5857);
                } else {
                  _t5925 = undefined;
                }
                _t5925;
                restore_snapshot_5883(snapshot_5889);
                const _t5924 = [Typechecker$qualify_pattern(ctx.type_env, pat), guard_te_5921, body_te_5923];
                const _t5922 = _t5924;
                const _t5920 = _t5922;
                const _t5918 = _t5920;
                const _t5913 = _t5918;
                _t5906 = _t5913;
                break _t5907;
              }
              _match_fail("line 16629");
            }
            const _t5903 = _t5906;
            const _t5895 = _t5903;
            const _t5890 = _t5895;
            _t5887 = _t5890;
            break _t5888;
          }
          _match_fail("line 16629");
        }
        return _t5887;
      }
      const check_gadt_arm_5926 = _t5885;
      let _t5929;
      const _t5928 = arms;
      _t5930: {
        if (_t5928 === null) {
          _t5929 = Typechecker$error("match expression has no arms");
          break _t5930;
        }
        if (_t5928 !== null) {
          const first = _t5928._hd;
          const rest = _t5928._tl;
          const first_arm_5931 = check_gadt_arm_5926(first);
          const rest_arms_5933 = List$map(check_gadt_arm_5926, rest);
          const all_arms_5935 = ({_hd: first_arm_5931, _tl: rest_arms_5933});
          let _t5937;
          if ((!partial)) {
            _t5937 = Ref$get(Typechecker$exhaustiveness_check_ref, ctx, Types$repr(scrut_te_5841.ty), all_arms_5935);
          } else {
            _t5937 = undefined;
          }
          _t5937;
          const _t5936 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [scrut_te_5841, all_arms_5935, partial]}), result_ty_5857);
          const _t5934 = _t5936;
          const _t5932 = _t5934;
          _t5929 = _t5932;
          break _t5930;
        }
        _match_fail("line 16629");
      }
      const _t5927 = _t5929;
      const _t5884 = _t5927;
      const _t5877 = _t5884;
      const _t5870 = _t5877;
      const _t5864 = _t5870;
      const _t5858 = _t5864;
      _t5852 = _t5858;
      break _t5853;
    }
    if (_t5851._tag === 0) {
      function _t5938(ctx, __p149) {
        let _t5940;
        const _t5939 = __p149;
        _t5941: {
          if (true) {
            const pat = _t5939[0];
            const guard = _t5939[1];
            const body = _t5939[2];
            const bindings_5942 = Typechecker$check_pattern(ctx, level, pat, scrut_te_5841.ty);
            function _t5944(c, __p150) {
              let _t5946;
              const _t5945 = __p150;
              _t5947: {
                if (true) {
                  const n = _t5945[0];
                  const t = _t5945[1];
                  _t5946 = Typechecker$extend_var_mono(c, n, t);
                  break _t5947;
                }
                _match_fail("line 16629");
              }
              return _t5946;
            }
            const ctx$p_5948 = List$fold(_t5944, ctx, bindings_5942);
            let _t5951;
            const _t5950 = guard;
            _t5952: {
              if (_t5950._tag === 1) {
                const g = _t5950._val;
                const gte_5953 = Typechecker$check(ctx$p_5948, level, g, ({_tag: 2, _name: "TBool"}));
                const _t5954 = ({_tag: 1, _name: "Some", _val: gte_5953});
                _t5951 = _t5954;
                break _t5952;
              }
              if (_t5950._tag === 0) {
                _t5951 = ({_tag: 0, _name: "None"});
                break _t5952;
              }
              _match_fail("line 16629");
            }
            const guard_te_5955 = _t5951;
            const body_te_5957 = Typechecker$synth(ctx$p_5948, level, body);
            const _t5958 = [Typechecker$qualify_pattern(ctx.type_env, pat), guard_te_5955, body_te_5957];
            const _t5956 = _t5958;
            const _t5949 = _t5956;
            const _t5943 = _t5949;
            _t5940 = _t5943;
            break _t5941;
          }
          _match_fail("line 16629");
        }
        return _t5940;
      }
      const check_arm_5959 = _t5938;
      let _t5962;
      const _t5961 = arms;
      _t5963: {
        if (_t5961 === null) {
          _t5962 = Typechecker$error("match expression has no arms");
          break _t5963;
        }
        if (_t5961 !== null) {
          const first = _t5961._hd;
          const rest = _t5961._tl;
          let _t5965;
          const _t5964 = check_arm_5959(ctx, first);
          _t5966: {
            if (true) {
              const fp = _t5964[0];
              const fg = _t5964[1];
              const fb = _t5964[2];
              const result_ty_5967 = fb.ty;
              function _t5969(arm) {
                let _t5971;
                const _t5970 = check_arm_5959(ctx, arm);
                _t5972: {
                  if (true) {
                    const p = _t5970[0];
                    const g = _t5970[1];
                    const b = _t5970[2];
                    Typechecker$try_unify(b.ty, result_ty_5967);
                    _t5971 = [p, g, b];
                    break _t5972;
                  }
                  _match_fail("line 16629");
                }
                return _t5971;
              }
              const all_arms_5973 = ({_hd: [fp, fg, fb], _tl: List$map(_t5969, rest)});
              let _t5975;
              if ((!partial)) {
                _t5975 = Ref$get(Typechecker$exhaustiveness_check_ref, ctx, Types$repr(scrut_te_5841.ty), all_arms_5973);
              } else {
                _t5975 = undefined;
              }
              _t5975;
              const _t5974 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [scrut_te_5841, all_arms_5973, partial]}), result_ty_5967);
              const _t5968 = _t5974;
              _t5965 = _t5968;
              break _t5966;
            }
            _match_fail("line 16629");
          }
          _t5962 = _t5965;
          break _t5963;
        }
        _match_fail("line 16629");
      }
      const _t5960 = _t5962;
      _t5852 = _t5960;
      break _t5853;
    }
    _match_fail("line 16629");
  }
  const _t5850 = _t5852;
  const _t5842 = _t5850;
  return _t5842;
}
function Typechecker$check(ctx, level, expr, expected) {
  while (true) {
    let _t5977;
    const _t5976 = expr;
    _t5978: {
      if (_t5976._tag === 49) {
        const loc = _t5976._val[0];
        const inner = _t5976._val[1];
        Ref$set(Typechecker$current_loc, loc);
        const _t5979 = ctx;
        const _t5980 = level;
        const _t5981 = inner;
        const _t5982 = expected;
        ctx = _t5979;
        level = _t5980;
        expr = _t5981;
        expected = _t5982;
        continue;
        _t5977 = undefined;
        break _t5978;
      }
      if (_t5976._tag === 10) {
        const param = _t5976._val[0];
        const body = _t5976._val[1];
        if (_eq(param.annot, ({_tag: 0, _name: "None"}))) {
          const arg_ty_5983 = Types$new_tvar(level);
          const ret_ty_5985 = Types$new_tvar(level);
          const fn_eff_5987 = Types$new_effvar(level);
          Typechecker$try_unify(expected, ({_tag: 7, _name: "TArrow", _val: [arg_ty_5983, fn_eff_5987, ret_ty_5985]}));
          const return_used_5989 = Ref$create(false);
          const __rec_upd_5991 = ctx;
          const _t5992 = ({constraint_tvars: __rec_upd_5991.constraint_tvars, current_eff: fn_eff_5987, current_module: __rec_upd_5991.current_module, inside_handler: false, loop_info: __rec_upd_5991.loop_info, mutable_vars: __rec_upd_5991.mutable_vars, return_type: ({_tag: 1, _name: "Some", _val: ret_ty_5985}), return_used: return_used_5989, type_env: __rec_upd_5991.type_env, vars: __rec_upd_5991.vars});
          const ctx$p_5993 = Typechecker$extend_var_mono(_t5992, param.name, Types$repr(arg_ty_5983));
          const body_te_5995 = Typechecker$check(ctx$p_5993, level, body, ret_ty_5985);
          let _t5997;
          if (param.is_generated) {
            _t5997 = false;
          } else {
            _t5997 = Ref$get(return_used_5989);
          }
          const has_return_5998 = _t5997;
          const _t5999 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param.name, body_te_5995, has_return_5998]}), ({_tag: 7, _name: "TArrow", _val: [arg_ty_5983, fn_eff_5987, body_te_5995.ty]}));
          const _t5996 = _t5999;
          const _t5994 = _t5996;
          const _t5990 = _t5994;
          const _t5988 = _t5990;
          const _t5986 = _t5988;
          const _t5984 = _t5986;
          _t5977 = _t5984;
          break _t5978;
        }
      }
      if (_t5976._tag === 25) {
        const scrut = _t5976._val[0];
        const arms = _t5976._val[1];
        const partial = _t5976._val[2];
        _t5977 = Typechecker$synth_match(({_tag: 1, _name: "Some", _val: expected}), ctx, level, scrut, arms, partial);
        break _t5978;
      }
      if (true) {
        const te_6000 = Typechecker$synth(ctx, level, expr);
        Typechecker$try_unify(te_6000.ty, expected);
        const __rec_upd_6002 = te_6000;
        const _t6003 = ({expr: __rec_upd_6002.expr, loc: __rec_upd_6002.loc, ty: expected});
        const _t6001 = _t6003;
        _t5977 = _t6001;
        break _t5978;
      }
      _match_fail("line 16629");
    }
    return _t5977;
  }
}
function Typechecker$check_pattern(ctx, level, pat, ty) {
  while (true) {
    let _t6005;
    const _t6004 = pat;
    _t6006: {
      if (_t6004._tag === 0) {
        _t6005 = null;
        break _t6006;
      }
      if (_t6004._tag === 1) {
        const name = _t6004._val;
        _t6005 = ({_hd: [name, ty], _tl: null});
        break _t6006;
      }
      if (_t6004._tag === 2) {
        Typechecker$try_unify(ty, ({_tag: 0, _name: "TInt"}));
        _t6005 = null;
        break _t6006;
      }
      if (_t6004._tag === 3) {
        Typechecker$try_unify(ty, ({_tag: 1, _name: "TFloat"}));
        _t6005 = null;
        break _t6006;
      }
      if (_t6004._tag === 4) {
        Typechecker$try_unify(ty, ({_tag: 2, _name: "TBool"}));
        _t6005 = null;
        break _t6006;
      }
      if (_t6004._tag === 5) {
        Typechecker$try_unify(ty, ({_tag: 3, _name: "TString"}));
        _t6005 = null;
        break _t6006;
      }
      if (_t6004._tag === 6) {
        Typechecker$try_unify(ty, ({_tag: 6, _name: "TUnit"}));
        _t6005 = null;
        break _t6006;
      }
      if (_t6004._tag === 7) {
        const pats = _t6004._val;
        function _t6007(_) {
          return Types$new_tvar(level);
        }
        const tys_6008 = List$map(_t6007, pats);
        Typechecker$try_unify(ty, ({_tag: 9, _name: "TTuple", _val: tys_6008}));
        const _t6009 = List$flatten(List$map2(_call(Typechecker$check_pattern, [ctx, level]), pats, tys_6008));
        _t6005 = _t6009;
        break _t6006;
      }
      if (_t6004._tag === 8) {
        const hd_pat = _t6004._val[0];
        const tl_pat = _t6004._val[1];
        const elem_ty_6010 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 10, _name: "TList", _val: elem_ty_6010}));
        const hd_bindings_6012 = Typechecker$check_pattern(ctx, level, hd_pat, elem_ty_6010);
        const tl_bindings_6014 = Typechecker$check_pattern(ctx, level, tl_pat, ty);
        const _t6015 = List$concat(hd_bindings_6012, tl_bindings_6014);
        const _t6013 = _t6015;
        const _t6011 = _t6013;
        _t6005 = _t6011;
        break _t6006;
      }
      if (_t6004._tag === 9) {
        const elem_ty_6016 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 10, _name: "TList", _val: elem_ty_6016}));
        const _t6017 = null;
        _t6005 = _t6017;
        break _t6006;
      }
      if (_t6004._tag === 10) {
        const name = _t6004._val[0];
        const arg_pat = _t6004._val[1];
        let _t6019;
        const _t6018 = List$assoc_opt(name, ctx.type_env.constructors);
        _t6020: {
          if (_t6018._tag === 0) {
            _t6019 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
            break _t6020;
          }
          if (_t6018._tag === 1) {
            const info = _t6018._val;
            let _t6021;
            if (List$mem(info.ctor_type_name, ctx.type_env.hidden_ctor_types)) {
              _t6021 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
            } else {
              _t6021 = undefined;
            }
            _t6021;
            function _t6022(_) {
              return Types$new_tvar(level);
            }
            const fresh_args_6023 = List$init(info.ctor_num_params, _t6022);
            const expected_variant_6025 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, fresh_args_6023]});
            Typechecker$try_unify(ty, expected_variant_6025);
            let _t6028;
            const _t6027 = [info.ctor_arg_ty, arg_pat];
            _t6029: {
              if (_t6027[0]._tag === 0 && _t6027[1]._tag === 0) {
                _t6028 = null;
                break _t6029;
              }
              if (_t6027[0]._tag === 1 && _t6027[1]._tag === 1) {
                const arg_ty = _t6027[0]._val;
                const p = _t6027[1]._val;
                const concrete_ty_6030 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(fresh_args_6023, arg_ty));
                const _t6032 = ctx;
                const _t6033 = level;
                const _t6034 = p;
                const _t6035 = concrete_ty_6030;
                ctx = _t6032;
                level = _t6033;
                pat = _t6034;
                ty = _t6035;
                continue;
                const _t6031 = undefined;
                _t6028 = _t6031;
                break _t6029;
              }
              if (_t6027[0]._tag === 0 && _t6027[1]._tag === 1) {
                _t6028 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " takes no arguments"));
                break _t6029;
              }
              if (_t6027[0]._tag === 1 && _t6027[1]._tag === 0) {
                _t6028 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " requires an argument"));
                break _t6029;
              }
              _match_fail("line 16629");
            }
            const _t6026 = _t6028;
            const _t6024 = _t6026;
            _t6019 = _t6024;
            break _t6020;
          }
          _match_fail("line 16629");
        }
        _t6005 = _t6019;
        break _t6006;
      }
      if (_t6004._tag === 11) {
        const field_pats = _t6004._val;
        let _t6037;
        const _t6036 = Types$repr(ty);
        _t6038: {
          if (_t6036._tag === 11) {
            const row = _t6036._val;
            _t6037 = Types$record_row_to_fields(row);
            break _t6038;
          }
          if (true) {
            const pat_field_names_6039 = List$map(fst, field_pats);
            function _t6041(__p151) {
              let _t6043;
              const _t6042 = __p151;
              _t6044: {
                if (true) {
                  const _name = _t6042[0];
                  const fields = _t6042[1];
                  function _t6045(fn_) {
                    return List$mem_assoc(fn_, fields);
                  }
                  _t6043 = List$forall(_t6045, pat_field_names_6039);
                  break _t6044;
                }
                _match_fail("line 16629");
              }
              return _t6043;
            }
            const candidates_6046 = List$filter(_t6041, ctx.type_env.records);
            let _t6049;
            const _t6048 = candidates_6046;
            _t6050: {
              if (_t6048 !== null && _t6048._tl === null) {
                const _name = _t6048._hd[0];
                const fields = _t6048._hd[1];
                const row_6051 = Typechecker$instantiate_record_row(level, fields);
                Typechecker$try_unify(ty, ({_tag: 11, _name: "TRecord", _val: row_6051}));
                const _t6052 = Typechecker$instantiate_record_fields(level, fields);
                _t6049 = _t6052;
                break _t6050;
              }
              if (_t6048 === null) {
                let _t6054;
                const _t6053 = Types$repr(ty);
                _t6055: {
                  if (_t6053._tag === 15) {
                    function _t6056(fname, rest) {
                      return ({_tag: 0, _name: "RRow", _val: [fname, Types$new_tvar(level), rest]});
                    }
                    const row_6057 = List$fold_right(_t6056, pat_field_names_6039, Types$new_rvar(level));
                    Typechecker$try_unify(ty, ({_tag: 11, _name: "TRecord", _val: row_6057}));
                    let _t6060;
                    const _t6059 = Types$repr(ty);
                    _t6061: {
                      if (_t6059._tag === 11) {
                        const r = _t6059._val;
                        _t6060 = r;
                        break _t6061;
                      }
                      if (true) {
                        _t6060 = Typechecker$error("record pattern used with non-record type");
                        break _t6061;
                      }
                      _match_fail("line 16629");
                    }
                    const _t6058 = Types$record_row_to_fields(_t6060);
                    _t6054 = _t6058;
                    break _t6055;
                  }
                  if (true) {
                    _t6054 = Typechecker$error("record pattern used with non-record type");
                    break _t6055;
                  }
                  _match_fail("line 16629");
                }
                _t6049 = _t6054;
                break _t6050;
              }
              if (true) {
                _t6049 = Typechecker$error("ambiguous record pattern â€” annotate the type");
                break _t6050;
              }
              _match_fail("line 16629");
            }
            const _t6047 = _t6049;
            const _t6040 = _t6047;
            _t6037 = _t6040;
            break _t6038;
          }
          _match_fail("line 16629");
        }
        const field_tys_6062 = _t6037;
        function _t6064(__p152) {
          let _t6066;
          const _t6065 = __p152;
          _t6067: {
            if (true) {
              const name = _t6065[0];
              const pat = _t6065[1];
              let _t6069;
              const _t6068 = List$assoc_opt(name, field_tys_6062);
              _t6070: {
                if (_t6068._tag === 1) {
                  const fty = _t6068._val;
                  _t6069 = Typechecker$check_pattern(ctx, level, pat, fty);
                  break _t6070;
                }
                if (_t6068._tag === 0) {
                  _t6069 = Typechecker$error(("record type has no field " + __dict_Show_string.show(name)));
                  break _t6070;
                }
                _match_fail("line 16629");
              }
              _t6066 = _t6069;
              break _t6067;
            }
            _match_fail("line 16629");
          }
          return _t6066;
        }
        const _t6063 = List$flatten(List$map(_t6064, field_pats));
        _t6005 = _t6063;
        break _t6006;
      }
      if (_t6004._tag === 12) {
        const inner_pat = _t6004._val[0];
        const name = _t6004._val[1];
        const bindings_6071 = Typechecker$check_pattern(ctx, level, inner_pat, ty);
        const _t6072 = ({_hd: [name, ty], _tl: bindings_6071});
        _t6005 = _t6072;
        break _t6006;
      }
      if (_t6004._tag === 13) {
        const p1 = _t6004._val[0];
        const p2 = _t6004._val[1];
        const bindings1_6073 = Typechecker$check_pattern(ctx, level, p1, ty);
        const bindings2_6075 = Typechecker$check_pattern(ctx, level, p2, ty);
        const names1_6077 = _call(_call(List$sort, [String$compare]), [List$map(fst, bindings1_6073)]);
        const names2_6079 = _call(_call(List$sort, [String$compare]), [List$map(fst, bindings2_6075)]);
        let _t6081;
        if (!_eq(names1_6077, names2_6079)) {
          _t6081 = Typechecker$error("or-pattern branches must bind the same variables");
        } else {
          _t6081 = undefined;
        }
        _t6081;
        function _t6082(__p153) {
          let _t6084;
          const _t6083 = __p153;
          _t6085: {
            if (true) {
              const name = _t6083[0];
              const ty1 = _t6083[1];
              let _t6087;
              const _t6086 = List$assoc_opt(name, bindings2_6075);
              _t6088: {
                if (_t6086._tag === 1) {
                  const ty2 = _t6086._val;
                  _t6087 = Typechecker$try_unify(ty1, ty2);
                  break _t6088;
                }
                if (_t6086._tag === 0) {
                  _t6087 = undefined;
                  break _t6088;
                }
                _match_fail("line 16629");
              }
              _t6084 = _t6087;
              break _t6085;
            }
            _match_fail("line 16629");
          }
          return _t6084;
        }
        List$iter(_t6082, bindings1_6073);
        const _t6080 = bindings1_6073;
        const _t6078 = _t6080;
        const _t6076 = _t6078;
        const _t6074 = _t6076;
        _t6005 = _t6074;
        break _t6006;
      }
      if (_t6004._tag === 14) {
        const pats = _t6004._val;
        const elem_ty_6089 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 13, _name: "TArray", _val: elem_ty_6089}));
        function _t6091(p) {
          return Typechecker$check_pattern(ctx, level, p, elem_ty_6089);
        }
        const _t6090 = List$concat_map(_t6091, pats);
        _t6005 = _t6090;
        break _t6006;
      }
      if (_t6004._tag === 15) {
        const entries = _t6004._val;
        const key_ty_6092 = Types$new_tvar(level);
        const val_ty_6094 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 12, _name: "TVariant", _val: ["map", ({_hd: key_ty_6092, _tl: ({_hd: val_ty_6094, _tl: null})})]}));
        function _t6096(__p154) {
          let _t6098;
          const _t6097 = __p154;
          _t6099: {
            if (true) {
              const kpat = _t6097[0];
              const vpat = _t6097[1];
              _t6098 = List$concat(Typechecker$check_pattern(ctx, level, kpat, key_ty_6092), Typechecker$check_pattern(ctx, level, vpat, val_ty_6094));
              break _t6099;
            }
            _match_fail("line 16629");
          }
          return _t6098;
        }
        const _t6095 = List$concat_map(_t6096, entries);
        const _t6093 = _t6095;
        _t6005 = _t6093;
        break _t6006;
      }
      if (_t6004._tag === 16 && _t6004._val[1]._tag === 0) {
        const tag = _t6004._val[0];
        const tail_6100 = Types$new_pvvar(level);
        const row_6102 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 0, _name: "None"}), tail_6100]});
        Typechecker$try_unify(ty, ({_tag: 14, _name: "TPolyVariant", _val: row_6102}));
        const _t6103 = null;
        const _t6101 = _t6103;
        _t6005 = _t6101;
        break _t6006;
      }
      if (_t6004._tag === 16 && _t6004._val[1]._tag === 1) {
        const tag = _t6004._val[0];
        const sub_pat = _t6004._val[1]._val;
        const payload_ty_6104 = Types$new_tvar(level);
        const tail_6106 = Types$new_pvvar(level);
        const row_6108 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 1, _name: "Some", _val: payload_ty_6104}), tail_6106]});
        Typechecker$try_unify(ty, ({_tag: 14, _name: "TPolyVariant", _val: row_6108}));
        const _t6110 = ctx;
        const _t6111 = level;
        const _t6112 = sub_pat;
        const _t6113 = payload_ty_6104;
        ctx = _t6110;
        level = _t6111;
        pat = _t6112;
        ty = _t6113;
        continue;
        const _t6109 = undefined;
        const _t6107 = _t6109;
        const _t6105 = _t6107;
        _t6005 = _t6105;
        break _t6006;
      }
      if (_t6004._tag === 17) {
        const name = _t6004._val;
        let _t6115;
        const _t6114 = List$assoc_opt(name, ctx.vars);
        _t6116: {
          if (_t6114._tag === 1) {
            const scheme = _t6114._val;
            const var_ty_6117 = Types$instantiate(level, scheme);
            Typechecker$try_unify(ty, var_ty_6117);
            const _t6118 = null;
            _t6115 = _t6118;
            break _t6116;
          }
          if (_t6114._tag === 0) {
            _t6115 = Typechecker$error(("unbound variable in pin pattern: " + __dict_Show_string.show(name)));
            break _t6116;
          }
          _match_fail("line 16629");
        }
        _t6005 = _t6115;
        break _t6006;
      }
      if (_t6004._tag === 18) {
        const inner_pat = _t6004._val[0];
        const annot = _t6004._val[1];
        const annot_ty_6119 = Typechecker$resolve_ty_annot(ctx, level, annot);
        Typechecker$try_unify(ty, annot_ty_6119);
        const _t6121 = ctx;
        const _t6122 = level;
        const _t6123 = inner_pat;
        const _t6124 = ty;
        ctx = _t6121;
        level = _t6122;
        pat = _t6123;
        ty = _t6124;
        continue;
        const _t6120 = undefined;
        _t6005 = _t6120;
        break _t6006;
      }
      _match_fail("line 16629");
    }
    return _t6005;
  }
}
function Typechecker$synth_poly_rec_fn(ctx, level, name, qualified_name, type_params, params, ret_annot, body) {
  const shared_tvars_6125 = Hashtbl$create(4);
  function _t6127(tp) {
    return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_6125, tp, Types$new_tvar((level + 1))]);
  }
  List$iter(_t6127, type_params);
  function _t6128(p) {
    let _t6130;
    const _t6129 = p.annot;
    _t6131: {
      if (_t6129._tag === 1) {
        const annot = _t6129._val;
        _t6130 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_6125, annot);
        break _t6131;
      }
      if (_t6129._tag === 0) {
        _t6130 = Types$new_tvar((level + 1));
        break _t6131;
      }
      _match_fail("line 16629");
    }
    return _t6130;
  }
  const param_tys_6132 = List$map(_t6128, params);
  let _t6135;
  const _t6134 = ret_annot;
  _t6136: {
    if (_t6134._tag === 1 && _t6134._val._tag === 10) {
      const ty = _t6134._val._val[0];
      const eff_annot = _t6134._val._val[1];
      const ty$p_6137 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_6125, ty);
      let _t6140;
      const _t6139 = eff_annot;
      _t6141: {
        if (_t6139._tag === 0) {
          _t6140 = ({_tag: 1, _name: "EffEmpty"});
          break _t6141;
        }
        if (_t6139._tag === 1) {
          const items = _t6139._val;
          _t6140 = Typechecker$resolve_eff_items(ctx, (level + 1), shared_tvars_6125, items);
          break _t6141;
        }
        _match_fail("line 16629");
      }
      const eff_6142 = _t6140;
      const _t6143 = [ty$p_6137, eff_6142];
      const _t6138 = _t6143;
      _t6135 = _t6138;
      break _t6136;
    }
    if (_t6134._tag === 1) {
      const annot = _t6134._val;
      _t6135 = [Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_6125, annot), Types$new_effvar((level + 1))];
      break _t6136;
    }
    if (_t6134._tag === 0) {
      _t6135 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
      break _t6136;
    }
    _match_fail("line 16629");
  }
  let _t6145;
  const _t6144 = _t6135;
  _t6146: {
    if (true) {
      const ret_ty = _t6144[0];
      const body_eff = _t6144[1];
      let _t6148;
      const _t6147 = List$rev(param_tys_6132);
      _t6149: {
        if (_t6147 === null) {
          _t6148 = ret_ty;
          break _t6149;
        }
        if (_t6147 !== null) {
          const last = _t6147._hd;
          const rest = _t6147._tl;
          const inner_6150 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
          function _t6152(acc, pty) {
            return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
          }
          const _t6151 = List$fold(_t6152, inner_6150, rest);
          _t6148 = _t6151;
          break _t6149;
        }
        _match_fail("line 16629");
      }
      const fn_ty_6153 = _t6148;
      const scheme_6155 = Types$generalize(level, fn_ty_6153);
      const ctx_with_self_6157 = Typechecker$extend_var(ctx, name, scheme_6155);
      let _t6159;
      if ((qualified_name !== "")) {
        _t6159 = Typechecker$extend_var(ctx_with_self_6157, qualified_name, scheme_6155);
      } else {
        _t6159 = ctx_with_self_6157;
      }
      const ctx_with_self_6160 = _t6159;
      function _t6162(c, p, ty) {
        return Typechecker$extend_var_mono(c, p.name, ty);
      }
      const __rec_upd_6163 = ctx_with_self_6160;
      const _t6164 = ({constraint_tvars: __rec_upd_6163.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_6163.current_module, inside_handler: __rec_upd_6163.inside_handler, loop_info: __rec_upd_6163.loop_info, mutable_vars: __rec_upd_6163.mutable_vars, return_type: __rec_upd_6163.return_type, return_used: __rec_upd_6163.return_used, type_env: __rec_upd_6163.type_env, vars: __rec_upd_6163.vars});
      const inner_ctx_6165 = List$fold2(_t6162, _t6164, params, param_tys_6132);
      const body_te_6167 = Typechecker$check(inner_ctx_6165, (level + 1), body, ret_ty);
      let _t6170;
      const _t6169 = [List$rev(params), List$rev(param_tys_6132)];
      _t6171: {
        if (_t6169[0] === null && _t6169[1] === null) {
          _t6170 = body_te_6167;
          break _t6171;
        }
        if (_t6169[0] !== null && _t6169[1] !== null) {
          const last_p = _t6169[0]._hd;
          const rest_ps = _t6169[0]._tl;
          const last_pty = _t6169[1]._hd;
          const rest_ptys = _t6169[1]._tl;
          const inner_6172 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_6167, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_6167.ty]}));
          function _t6174(acc, p, pty) {
            return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
          }
          const _t6173 = List$fold2(_t6174, inner_6172, rest_ps, rest_ptys);
          _t6170 = _t6173;
          break _t6171;
        }
        if (true) {
          _t6170 = failwith("assert false");
          break _t6171;
        }
        _match_fail("line 16629");
      }
      const te_6175 = _t6170;
      const _t6176 = [te_6175, scheme_6155];
      const _t6168 = _t6176;
      const _t6166 = _t6168;
      const _t6161 = _t6166;
      const _t6158 = _t6161;
      const _t6156 = _t6158;
      const _t6154 = _t6156;
      _t6145 = _t6154;
      break _t6146;
    }
    _match_fail("line 16629");
  }
  const _t6133 = _t6145;
  const _t6126 = _t6133;
  return _t6126;
}
function Typechecker$normalize_pattern(pat) {
  while (true) {
    let _t6178;
    const _t6177 = pat;
    _t6179: {
      if (_t6177._tag === 12) {
        const inner = _t6177._val[0];
        const _t6180 = inner;
        pat = _t6180;
        continue;
        _t6178 = undefined;
        break _t6179;
      }
      if (_t6177._tag === 13) {
        const p1 = _t6177._val[0];
        const p2 = _t6177._val[1];
        _t6178 = List$concat(Typechecker$normalize_pattern(p1), Typechecker$normalize_pattern(p2));
        break _t6179;
      }
      if (true) {
        const p = _t6177;
        _t6178 = ({_hd: p, _tl: null});
        break _t6179;
      }
      _match_fail("line 16629");
    }
    return _t6178;
  }
}
function Typechecker$ctor_short_name(name) {
  let _t6182;
  const _t6181 = String$rindex_opt(name, 46);
  _t6183: {
    if (_t6181._tag === 1) {
      const i = _t6181._val;
      _t6182 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
      break _t6183;
    }
    if (_t6181._tag === 0) {
      _t6182 = name;
      break _t6183;
    }
    _match_fail("line 16629");
  }
  return _t6182;
}
function Typechecker$specialize_variant(pats, ctor_name) {
  function _t6184(pat) {
    let _t6186;
    const _t6185 = pat;
    _t6187: {
      if (_t6185._tag === 10) {
        const name = _t6185._val[0];
        const sub = _t6185._val[1];
        if ((Typechecker$ctor_short_name(name) === ctor_name)) {
          let _t6189;
          const _t6188 = sub;
          _t6190: {
            if (_t6188._tag === 1) {
              const p = _t6188._val;
              _t6189 = Typechecker$normalize_pattern(p);
              break _t6190;
            }
            if (_t6188._tag === 0) {
              _t6189 = ({_hd: ({_tag: 0, _name: "PatWild"}), _tl: null});
              break _t6190;
            }
            _match_fail("line 16629");
          }
          _t6186 = _t6189;
          break _t6187;
        }
      }
      if (_t6185._tag === 10) {
        _t6186 = null;
        break _t6187;
      }
      if ((_t6185._tag === 0 || _t6185._tag === 1)) {
        _t6186 = ({_hd: ({_tag: 0, _name: "PatWild"}), _tl: null});
        break _t6187;
      }
      if (_t6185._tag === 12) {
        const inner = _t6185._val[0];
        _t6186 = Typechecker$specialize_variant(Typechecker$normalize_pattern(inner), ctor_name);
        break _t6187;
      }
      if (_t6185._tag === 13) {
        const p1 = _t6185._val[0];
        const p2 = _t6185._val[1];
        _t6186 = List$concat(Typechecker$specialize_variant(Typechecker$normalize_pattern(p1), ctor_name), Typechecker$specialize_variant(Typechecker$normalize_pattern(p2), ctor_name));
        break _t6187;
      }
      if (true) {
        _t6186 = null;
        break _t6187;
      }
      _match_fail("line 16629");
    }
    return _t6186;
  }
  return List$concat_map(_t6184, pats);
}
function Typechecker$has_wildcard(pats) {
  function _t6191(p) {
    let _t6193;
    const _t6192 = p;
    _t6194: {
      if ((_t6192._tag === 0 || _t6192._tag === 1)) {
        _t6193 = true;
        break _t6194;
      }
      if (true) {
        _t6193 = false;
        break _t6194;
      }
      _match_fail("line 16629");
    }
    return _t6193;
  }
  return List$exists(_t6191, pats);
}
function Typechecker$uncovered_patterns(type_env, ty, pats) {
  const pats_6195 = List$concat_map(Typechecker$normalize_pattern, pats);
  let _t6197;
  if (Typechecker$has_wildcard(pats_6195)) {
    _t6197 = null;
  } else {
    let _t6199;
    const _t6198 = Types$repr(ty);
    _t6200: {
      if (_t6198._tag === 12) {
        const name = _t6198._val[0];
        const args = _t6198._val[1];
        let _t6202;
        const _t6201 = Typechecker$find_variant_info(type_env, name);
        _t6203: {
          if (_t6201._tag === 0) {
            _t6202 = null;
            break _t6203;
          }
          if (_t6201._tag === 1) {
            const ctors = _t6201._val[2];
            const is_gadt = _t6201._val[3];
            let _t6204;
            if (is_gadt) {
              function _t6205(__p155) {
                let _t6207;
                const _t6206 = __p155;
                _t6208: {
                  if (true) {
                    const ctor_name = _t6206[0];
                    let _t6210;
                    const _t6209 = List$assoc_opt(ctor_name, type_env.constructors);
                    _t6211: {
                      if (_t6209._tag === 1) {
                        const info = _t6209._val;
                        let _t6213;
                        const _t6212 = info.ctor_return_ty_params;
                        _t6214: {
                          if (_t6212._tag === 0) {
                            _t6213 = true;
                            break _t6214;
                          }
                          if (_t6212._tag === 1) {
                            const ret_params = _t6212._val;
                            let _t6216;
                            if ((List$length(ret_params) === List$length(args))) {
                            function _t6215(p) {
                              return Typechecker$subst_tgens(args, p);
                            }
                              _t6216 = List$forall2(Types$types_compatible, List$map(_t6215, ret_params), args);
                            } else {
                              _t6216 = false;
                            }
                            _t6213 = _t6216;
                            break _t6214;
                          }
                          _match_fail("line 16629");
                        }
                        _t6210 = _t6213;
                        break _t6211;
                      }
                      if (_t6209._tag === 0) {
                        _t6210 = true;
                        break _t6211;
                      }
                      _match_fail("line 16629");
                    }
                    _t6207 = _t6210;
                    break _t6208;
                  }
                  _match_fail("line 16629");
                }
                return _t6207;
              }
              _t6204 = List$filter(_t6205, ctors);
            } else {
              _t6204 = ctors;
            }
            const reachable_ctors_6217 = _t6204;
            function _t6219(__p156) {
              let _t6221;
              const _t6220 = __p156;
              _t6222: {
                if (true) {
                  const ctor_name = _t6220[0];
                  const ctor_arg_ty = _t6220[1];
                  const sub_pats_6223 = Typechecker$specialize_variant(pats_6195, ctor_name);
                  let _t6226;
                  const _t6225 = ctor_arg_ty;
                  _t6227: {
                    if (_t6225._tag === 0) {
                      let _t6228;
                      if ((List$length(sub_pats_6223) === 0)) {
                        _t6228 = ({_hd: ctor_name, _tl: null});
                      } else {
                        _t6228 = null;
                      }
                      _t6226 = _t6228;
                      break _t6227;
                    }
                    if (_t6225._tag === 1) {
                      const arg_ty = _t6225._val;
                      let _t6229;
                      if ((List$length(sub_pats_6223) === 0)) {
                        _t6229 = ({_hd: (ctor_name + " _"), _tl: null});
                      } else {
                        const sub_missing_6230 = Typechecker$uncovered_patterns(type_env, arg_ty, sub_pats_6223);
                        function _t6232(m) {
                          return (ctor_name + (" (" + (m + ")")));
                        }
                        const _t6231 = List$map(_t6232, sub_missing_6230);
                        _t6229 = _t6231;
                      }
                      _t6226 = _t6229;
                      break _t6227;
                    }
                    _match_fail("line 16629");
                  }
                  const _t6224 = _t6226;
                  _t6221 = _t6224;
                  break _t6222;
                }
                _match_fail("line 16629");
              }
              return _t6221;
            }
            const _t6218 = List$concat_map(_t6219, reachable_ctors_6217);
            _t6202 = _t6218;
            break _t6203;
          }
          _match_fail("line 16629");
        }
        _t6199 = _t6202;
        break _t6200;
      }
      if (_t6198._tag === 2) {
        function _t6233(p) {
          let _t6235;
          const _t6234 = p;
          _t6236: {
            if (_t6234._tag === 4 && _t6234._val) {
              _t6235 = true;
              break _t6236;
            }
            if (true) {
              _t6235 = false;
              break _t6236;
            }
            _match_fail("line 16629");
          }
          return _t6235;
        }
        const has_true_6237 = List$exists(_t6233, pats_6195);
        function _t6239(p) {
          let _t6241;
          const _t6240 = p;
          _t6242: {
            if (_t6240._tag === 4 && !_t6240._val) {
              _t6241 = true;
              break _t6242;
            }
            if (true) {
              _t6241 = false;
              break _t6242;
            }
            _match_fail("line 16629");
          }
          return _t6241;
        }
        const has_false_6243 = List$exists(_t6239, pats_6195);
        const missing_6245 = Ref$create(null);
        let _t6247;
        if ((!has_true_6237)) {
          _t6247 = Ref$set(missing_6245, ({_hd: "true", _tl: Ref$get(missing_6245)}));
        } else {
          _t6247 = undefined;
        }
        _t6247;
        let _t6248;
        if ((!has_false_6243)) {
          _t6248 = Ref$set(missing_6245, ({_hd: "false", _tl: Ref$get(missing_6245)}));
        } else {
          _t6248 = undefined;
        }
        _t6248;
        const _t6246 = Ref$get(missing_6245);
        const _t6244 = _t6246;
        const _t6238 = _t6244;
        _t6199 = _t6238;
        break _t6200;
      }
      if (_t6198._tag === 10) {
        function _t6249(p) {
          let _t6251;
          const _t6250 = p;
          _t6252: {
            if (_t6250._tag === 9) {
              _t6251 = true;
              break _t6252;
            }
            if (true) {
              _t6251 = false;
              break _t6252;
            }
            _match_fail("line 16629");
          }
          return _t6251;
        }
        const has_nil_6253 = List$exists(_t6249, pats_6195);
        function _t6255(p) {
          let _t6257;
          const _t6256 = p;
          _t6258: {
            if (_t6256._tag === 8) {
              _t6257 = true;
              break _t6258;
            }
            if (true) {
              _t6257 = false;
              break _t6258;
            }
            _match_fail("line 16629");
          }
          return _t6257;
        }
        const has_cons_6259 = List$exists(_t6255, pats_6195);
        const missing_6261 = Ref$create(null);
        let _t6263;
        if ((!has_nil_6253)) {
          _t6263 = Ref$set(missing_6261, ({_hd: "[]", _tl: Ref$get(missing_6261)}));
        } else {
          _t6263 = undefined;
        }
        _t6263;
        let _t6264;
        if ((!has_cons_6259)) {
          _t6264 = Ref$set(missing_6261, ({_hd: "_ :: _", _tl: Ref$get(missing_6261)}));
        } else {
          _t6264 = undefined;
        }
        _t6264;
        const _t6262 = Ref$get(missing_6261);
        const _t6260 = _t6262;
        const _t6254 = _t6260;
        _t6199 = _t6254;
        break _t6200;
      }
      if (_t6198._tag === 13) {
        function _t6265(p) {
          let _t6267;
          const _t6266 = p;
          _t6268: {
            if (_t6266._tag === 14) {
              const elems = _t6266._val;
              _t6267 = ({_tag: 1, _name: "Some", _val: List$length(elems)});
              break _t6268;
            }
            if (true) {
              _t6267 = ({_tag: 0, _name: "None"});
              break _t6268;
            }
            _match_fail("line 16629");
          }
          return _t6267;
        }
        const lengths_6269 = List$filter_map(_t6265, pats_6195);
        const lengths_set_6271 = List$sort_uniq(compare, lengths_6269);
        function find_missing(n) {
          while (true) {
            let _t6273;
            if (List$mem(n, lengths_set_6271)) {
              const _t6274 = (n + 1);
              n = _t6274;
              continue;
              _t6273 = undefined;
            } else {
              _t6273 = n;
            }
            return _t6273;
          }
        }
        const missing_len_6276 = find_missing(0);
        let _t6278;
        if ((missing_len_6276 === 0)) {
          _t6278 = "#[]";
        } else {
          function _t6279(_) {
            return "_";
          }
          _t6278 = ("#[" + (String$concat("; ", List$init(missing_len_6276, _t6279)) + "]"));
        }
        const missing_pat_6280 = _t6278;
        const _t6281 = ({_hd: missing_pat_6280, _tl: null});
        const _t6277 = _t6281;
        const _t6275 = _t6277;
        const _t6272 = _t6275;
        const _t6270 = _t6272;
        _t6199 = _t6270;
        break _t6200;
      }
      if (((_t6198._tag === 0 || _t6198._tag === 1) || _t6198._tag === 3)) {
        _t6199 = ({_hd: "_", _tl: null});
        break _t6200;
      }
      if (_t6198._tag === 6) {
        function _t6282(p) {
          let _t6284;
          const _t6283 = p;
          _t6285: {
            if (_t6283._tag === 6) {
              _t6284 = true;
              break _t6285;
            }
            if (true) {
              _t6284 = false;
              break _t6285;
            }
            _match_fail("line 16629");
          }
          return _t6284;
        }
        const has_unit_6286 = List$exists(_t6282, pats_6195);
        let _t6288;
        if (has_unit_6286) {
          _t6288 = null;
        } else {
          _t6288 = ({_hd: "()", _tl: null});
        }
        const _t6287 = _t6288;
        _t6199 = _t6287;
        break _t6200;
      }
      if (_t6198._tag === 9) {
        const ts = _t6198._val;
        function _t6289(p) {
          let _t6291;
          const _t6290 = p;
          _t6292: {
            if (_t6290._tag === 7) {
              const ps = _t6290._val;
              if ((List$length(ps) === List$length(ts))) {
                _t6291 = ({_tag: 1, _name: "Some", _val: ps});
                break _t6292;
              }
            }
            if (true) {
              _t6291 = ({_tag: 0, _name: "None"});
              break _t6292;
            }
            _match_fail("line 16629");
          }
          return _t6291;
        }
        const tuple_pats_6293 = List$filter_map(_t6289, pats_6195);
        let _t6295;
        if (_eq(tuple_pats_6293, null)) {
          function _t6296(_) {
            return "_";
          }
          _t6295 = ({_hd: ("(" + (String$concat(", ", List$init(List$length(ts), _t6296)) + ")")), _tl: null});
        } else {
          function check_positions(i, __x) {
            while (true) {
              let _t6298;
              const _t6297 = __x;
              _t6299: {
                if (_t6297 === null) {
                  _t6298 = null;
                  break _t6299;
                }
                if (_t6297 !== null) {
                  const elem_ty = _t6297._hd;
                  const rest_tys = _t6297._tl;
                  function _t6300(ps) {
                    return List$nth(ps, i);
                  }
                  const position_pats_6301 = List$map(_t6300, tuple_pats_6293);
                  const sub_missing_6303 = Typechecker$uncovered_patterns(type_env, elem_ty, position_pats_6301);
                  let _t6305;
                  if (!_eq(sub_missing_6303, null)) {
                    function _t6306(j) {
                      let _t6307;
                      if ((j === i)) {
                        _t6307 = List$hd(sub_missing_6303);
                      } else {
                        _t6307 = "_";
                      }
                      return _t6307;
                    }
                    const template_6308 = List$init(List$length(ts), _t6306);
                    const _t6309 = ({_hd: ("(" + (String$concat(", ", template_6308) + ")")), _tl: null});
                    _t6305 = _t6309;
                  } else {
                    const _t6310 = (i + 1);
                    const _t6311 = rest_tys;
                    i = _t6310;
                    __x = _t6311;
                    continue;
                    _t6305 = undefined;
                  }
                  const _t6304 = _t6305;
                  const _t6302 = _t6304;
                  _t6298 = _t6302;
                  break _t6299;
                }
                _match_fail("line 16629");
              }
              return _t6298;
            }
          }
          const _t6312 = check_positions(0, ts);
          _t6295 = _t6312;
        }
        const _t6294 = _t6295;
        _t6199 = _t6294;
        break _t6200;
      }
      if (true) {
        _t6199 = null;
        break _t6200;
      }
      _match_fail("line 16629");
    }
    _t6197 = _t6199;
  }
  const _t6196 = _t6197;
  return _t6196;
}
function Typechecker$exhaustiveness_check(ctx, ty, arms) {
  function _t6313(__p157) {
    let _t6315;
    const _t6314 = __p157;
    _t6316: {
      if (true) {
        const pat = _t6314[0];
        const guard = _t6314[1];
        const _body = _t6314[2];
        let _t6318;
        const _t6317 = guard;
        _t6319: {
          if (_t6317._tag === 0) {
            _t6318 = ({_tag: 1, _name: "Some", _val: pat});
            break _t6319;
          }
          if (_t6317._tag === 1) {
            _t6318 = ({_tag: 0, _name: "None"});
            break _t6319;
          }
          _match_fail("line 16629");
        }
        _t6315 = _t6318;
        break _t6316;
      }
      _match_fail("line 16629");
    }
    return _t6315;
  }
  const unguarded_pats_6320 = List$filter_map(_t6313, arms);
  const missing_6322 = Typechecker$uncovered_patterns(ctx.type_env, ty, unguarded_pats_6320);
  let _t6324;
  if (!_eq(missing_6322, null)) {
    _t6324 = Typechecker$error(("non-exhaustive match, missing: " + __dict_Show_string.show(String$concat(", ", missing_6322))));
  } else {
    _t6324 = undefined;
  }
  const _t6323 = _t6324;
  const _t6321 = _t6323;
  return _t6321;
}
const Typechecker$__destruct = Ref$set(Typechecker$exhaustiveness_check_ref, Typechecker$exhaustiveness_check);
function Typechecker$process_type_def(ctx, type_params, type_name, def) {
  const num_params_6325 = List$length(type_params);
  let _t6328;
  const _t6327 = def;
  _t6329: {
    if (_t6327._tag === 0) {
      const ctors = _t6327._val;
      const __rec_upd_6330 = ctx;
      const __rec_upd_6332 = ctx.type_env;
      const _t6333 = ({classes: __rec_upd_6332.classes, constructors: __rec_upd_6332.constructors, effects: __rec_upd_6332.effects, hidden_ctor_types: __rec_upd_6332.hidden_ctor_types, hidden_types: __rec_upd_6332.hidden_types, instances: __rec_upd_6332.instances, modules: __rec_upd_6332.modules, mutable_fields: __rec_upd_6332.mutable_fields, newtypes: __rec_upd_6332.newtypes, records: __rec_upd_6332.records, type_aliases: __rec_upd_6332.type_aliases, type_synonyms: __rec_upd_6332.type_synonyms, variants: ({_hd: [type_name, num_params_6325, null, false], _tl: ctx.type_env.variants})});
      const _t6331 = ({constraint_tvars: __rec_upd_6330.constraint_tvars, current_eff: __rec_upd_6330.current_eff, current_module: __rec_upd_6330.current_module, inside_handler: __rec_upd_6330.inside_handler, loop_info: __rec_upd_6330.loop_info, mutable_vars: __rec_upd_6330.mutable_vars, return_type: __rec_upd_6330.return_type, return_used: __rec_upd_6330.return_used, type_env: _t6333, vars: __rec_upd_6330.vars});
      const pre_ctx_6334 = _t6331;
      const param_tbl_6336 = Hashtbl$create(4);
      function _t6338(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6336, name, i]);
      }
      List$iteri(_t6338, type_params);
      function _t6339(annot) {
        const tvars_6340 = Hashtbl$create(4);
        function go(__x) {
          while (true) {
            let _t6343;
            const _t6342 = __x;
            _t6344: {
              if (_t6342._tag === 1) {
                const name = _t6342._val;
                let _t6346;
                const _t6345 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6336, name]);
                _t6347: {
                  if (_t6345._tag === 1) {
                    const idx = _t6345._val;
                    _t6346 = ({_tag: 16, _name: "TGen", _val: idx});
                    break _t6347;
                  }
                  if (_t6345._tag === 0) {
                    let _t6349;
                    const _t6348 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6340, name]);
                    _t6350: {
                      if (_t6348._tag === 1) {
                        const tv = _t6348._val;
                        _t6349 = tv;
                        break _t6350;
                      }
                      if (_t6348._tag === 0) {
                        const tv_6351 = Types$new_tvar(0);
                        _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6340, name, tv_6351]);
                        const _t6352 = tv_6351;
                        _t6349 = _t6352;
                        break _t6350;
                      }
                      _match_fail("line 16629");
                    }
                    _t6346 = _t6349;
                    break _t6347;
                  }
                  _match_fail("line 16629");
                }
                _t6343 = _t6346;
                break _t6344;
              }
              if (_t6342._tag === 0 && _t6342._val === "int") {
                _t6343 = ({_tag: 0, _name: "TInt"});
                break _t6344;
              }
              if (_t6342._tag === 0 && _t6342._val === "float") {
                _t6343 = ({_tag: 1, _name: "TFloat"});
                break _t6344;
              }
              if (_t6342._tag === 0 && _t6342._val === "bool") {
                _t6343 = ({_tag: 2, _name: "TBool"});
                break _t6344;
              }
              if (_t6342._tag === 0 && _t6342._val === "string") {
                _t6343 = ({_tag: 3, _name: "TString"});
                break _t6344;
              }
              if (_t6342._tag === 0 && _t6342._val === "unit") {
                _t6343 = ({_tag: 6, _name: "TUnit"});
                break _t6344;
              }
              if (_t6342._tag === 0) {
                const name = _t6342._val;
                const canonical_6353 = Typechecker$resolve_type_alias(pre_ctx_6334.type_env, name);
                function _t6355(__p158) {
                  let _t6357;
                  const _t6356 = __p158;
                  _t6358: {
                    if (true) {
                      const n = _t6356[0];
                      _t6357 = (n === canonical_6353);
                      break _t6358;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6357;
                }
                let _t6360;
                const _t6359 = List$find(_t6355, pre_ctx_6334.type_env.type_synonyms);
                _t6361: {
                  if (_t6359._tag === 1 && _t6359._val[1] === 0) {
                    const ty = _t6359._val[2];
                    _t6360 = ty;
                    break _t6361;
                  }
                  if (_t6359._tag === 1) {
                    const n = _t6359._val[1];
                    _t6360 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                    break _t6361;
                  }
                  if (_t6359._tag === 0) {
                    let _t6363;
                    const _t6362 = Typechecker$find_variant_info(pre_ctx_6334.type_env, name);
                    _t6364: {
                      if (_t6362._tag === 1 && _t6362._val[1] === 0) {
                        _t6363 = ({_tag: 12, _name: "TVariant", _val: [canonical_6353, null]});
                        break _t6364;
                      }
                      if (_t6362._tag === 1) {
                        const n = _t6362._val[1];
                        _t6363 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                        break _t6364;
                      }
                      if (_t6362._tag === 0) {
                        let _t6365;
                        if (!_eq(List$assoc_opt(canonical_6353, pre_ctx_6334.type_env.records), ({_tag: 0, _name: "None"}))) {
                          const fields_6366 = List$assoc(canonical_6353, pre_ctx_6334.type_env.records);
                          const _t6367 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6366)});
                          _t6365 = _t6367;
                        } else {
                          _t6365 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                        }
                        _t6363 = _t6365;
                        break _t6364;
                      }
                      _match_fail("line 16629");
                    }
                    _t6360 = _t6363;
                    break _t6361;
                  }
                  _match_fail("line 16629");
                }
                const _t6354 = _t6360;
                _t6343 = _t6354;
                break _t6344;
              }
              if (_t6342._tag === 2) {
                const a = _t6342._val[0];
                const b = _t6342._val[1];
                _t6343 = ({_tag: 7, _name: "TArrow", _val: [go(a), ({_tag: 1, _name: "EffEmpty"}), go(b)]});
                break _t6344;
              }
              if (_t6342._tag === 6) {
                const ts = _t6342._val;
                _t6343 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
                break _t6344;
              }
              if (_t6342._tag === 4) {
                const t = _t6342._val;
                _t6343 = ({_tag: 10, _name: "TList", _val: go(t)});
                break _t6344;
              }
              if (_t6342._tag === 5) {
                const t = _t6342._val;
                _t6343 = ({_tag: 13, _name: "TArray", _val: go(t)});
                break _t6344;
              }
              if (_t6342._tag === 7) {
                const args = _t6342._val[0];
                const tname = _t6342._val[1];
                const canonical_6368 = Typechecker$resolve_type_alias(pre_ctx_6334.type_env, tname);
                const arg_tys_6370 = List$map(go, args);
                function _t6372(__p159) {
                  let _t6374;
                  const _t6373 = __p159;
                  _t6375: {
                    if (true) {
                      const n = _t6373[0];
                      _t6374 = (n === canonical_6368);
                      break _t6375;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6374;
                }
                let _t6377;
                const _t6376 = List$find(_t6372, pre_ctx_6334.type_env.type_synonyms);
                _t6378: {
                  if (_t6376._tag === 1) {
                    const np = _t6376._val[1];
                    const ty = _t6376._val[2];
                    let _t6379;
                    if ((List$length(arg_tys_6370) !== np)) {
                      _t6379 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6370))));
                    } else {
                      _t6379 = undefined;
                    }
                    _t6379;
                    _t6377 = Typechecker$subst_tgens(arg_tys_6370, ty);
                    break _t6378;
                  }
                  if (_t6376._tag === 0) {
                    let _t6381;
                    const _t6380 = Typechecker$find_variant_info(pre_ctx_6334.type_env, tname);
                    _t6382: {
                      if (_t6380._tag === 1) {
                        const np = _t6380._val[1];
                        let _t6383;
                        if ((List$length(arg_tys_6370) !== np)) {
                          _t6383 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6370))));
                        } else {
                          _t6383 = undefined;
                        }
                        _t6383;
                        _t6381 = ({_tag: 12, _name: "TVariant", _val: [canonical_6368, arg_tys_6370]});
                        break _t6382;
                      }
                      if (_t6380._tag === 0) {
                        _t6381 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                        break _t6382;
                      }
                      _match_fail("line 16629");
                    }
                    _t6377 = _t6381;
                    break _t6378;
                  }
                  _match_fail("line 16629");
                }
                const _t6371 = _t6377;
                const _t6369 = _t6371;
                _t6343 = _t6369;
                break _t6344;
              }
              if (_t6342._tag === 3) {
                const fields = _t6342._val[0];
                const is_open = _t6342._val[1];
                function _t6384(__p160) {
                  let _t6386;
                  const _t6385 = __p160;
                  _t6387: {
                    if (true) {
                      const n = _t6385[0];
                      const t = _t6385[1];
                      _t6386 = [n, go(t)];
                      break _t6387;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6386;
                }
                const fields_6388 = List$map(_t6384, fields);
                function _t6390(__p161, __p162) {
                  let _t6392;
                  const _t6391 = __p161;
                  _t6393: {
                    if (true) {
                      const a = _t6391[0];
                      let _t6395;
                      const _t6394 = __p162;
                      _t6396: {
                        if (true) {
                          const b = _t6394[0];
                          _t6395 = String$compare(a, b);
                          break _t6396;
                        }
                        _match_fail("line 16629");
                      }
                      _t6392 = _t6395;
                      break _t6393;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6392;
                }
                const fields_6397 = List$sort(_t6390, fields_6388);
                let _t6399;
                if (is_open) {
                  _t6399 = Types$new_rvar(0);
                } else {
                  _t6399 = ({_tag: 2, _name: "REmpty"});
                }
                const tail_6400 = _t6399;
                function _t6402(__p163, acc) {
                  let _t6404;
                  const _t6403 = __p163;
                  _t6405: {
                    if (true) {
                      const n = _t6403[0];
                      const t = _t6403[1];
                      _t6404 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                      break _t6405;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6404;
                }
                const _t6401 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6402, fields_6397, tail_6400)});
                const _t6398 = _t6401;
                const _t6389 = _t6398;
                _t6343 = _t6389;
                break _t6344;
              }
              if (_t6342._tag === 8) {
                const path = _t6342._val[0];
                const name = _t6342._val[1];
                const qualified_6406 = (String$concat(".", path) + ("." + name));
                const _t6408 = ({_tag: 0, _name: "TyName", _val: qualified_6406});
                __x = _t6408;
                continue;
                const _t6407 = undefined;
                _t6343 = _t6407;
                break _t6344;
              }
              if (_t6342._tag === 9) {
                const _kind = _t6342._val[0];
                const tags = _t6342._val[1];
                function _t6409(__p164, acc) {
                  let _t6411;
                  const _t6410 = __p164;
                  _t6412: {
                    if (true) {
                      const tag = _t6410[0];
                      const payload_annot = _t6410[1];
                      _t6411 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload_annot), acc]});
                      break _t6412;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6411;
                }
                const row_6413 = List$fold_right(_t6409, tags, ({_tag: 2, _name: "PVEmpty"}));
                const _t6414 = ({_tag: 14, _name: "TPolyVariant", _val: row_6413});
                _t6343 = _t6414;
                break _t6344;
              }
              if (_t6342._tag === 10) {
                const ty = _t6342._val[0];
                const _t6415 = ty;
                __x = _t6415;
                continue;
                _t6343 = undefined;
                break _t6344;
              }
              _match_fail("line 16629");
            }
            return _t6343;
          }
        }
        const _t6416 = go(annot);
        const _t6341 = _t6416;
        return _t6341;
      }
      const resolve_with_params_6417 = _t6339;
      function _t6419(__p165) {
        let _t6421;
        const _t6420 = __p165;
        _t6422: {
          if (true) {
            const ret = _t6420[2];
            _t6421 = !_eq(ret, ({_tag: 0, _name: "None"}));
            break _t6422;
          }
          _match_fail("line 16629");
        }
        return _t6421;
      }
      const is_gadt_6423 = List$exists(_t6419, ctors);
      function collect_annot_vars(acc, __x) {
        while (true) {
          let _t6426;
          const _t6425 = __x;
          _t6427: {
            if (_t6425._tag === 1) {
              const name = _t6425._val;
              let _t6428;
              if (List$mem(name, acc)) {
                _t6428 = acc;
              } else {
                _t6428 = ({_hd: name, _tl: acc});
              }
              _t6426 = _t6428;
              break _t6427;
            }
            if (_t6425._tag === 2) {
              const a = _t6425._val[0];
              const b = _t6425._val[1];
              const _t6429 = collect_annot_vars(acc, a);
              const _t6430 = b;
              acc = _t6429;
              __x = _t6430;
              continue;
              _t6426 = undefined;
              break _t6427;
            }
            if (_t6425._tag === 6) {
              const ts = _t6425._val;
              _t6426 = List$fold(collect_annot_vars, acc, ts);
              break _t6427;
            }
            if ((_t6425._tag === 4 || _t6425._tag === 5)) {
              const t = _t6425._val;
              const _t6431 = acc;
              const _t6432 = t;
              acc = _t6431;
              __x = _t6432;
              continue;
              _t6426 = undefined;
              break _t6427;
            }
            if (_t6425._tag === 7) {
              const args = _t6425._val[0];
              _t6426 = List$fold(collect_annot_vars, acc, args);
              break _t6427;
            }
            if (_t6425._tag === 3) {
              const fs = _t6425._val[0];
              function _t6433(a, __p166) {
                let _t6435;
                const _t6434 = __p166;
                _t6436: {
                  if (true) {
                    const t = _t6434[1];
                    _t6435 = collect_annot_vars(a, t);
                    break _t6436;
                  }
                  _match_fail("line 16629");
                }
                return _t6435;
              }
              _t6426 = List$fold(_t6433, acc, fs);
              break _t6427;
            }
            if ((_t6425._tag === 8 || _t6425._tag === 0)) {
              _t6426 = acc;
              break _t6427;
            }
            if (_t6425._tag === 9) {
              const tags = _t6425._val[1];
              function _t6437(a, __p167) {
                let _t6439;
                const _t6438 = __p167;
                _t6440: {
                  if (true) {
                    const ty_opt = _t6438[1];
                    let _t6442;
                    const _t6441 = ty_opt;
                    _t6443: {
                      if (_t6441._tag === 1) {
                        const t = _t6441._val;
                        _t6442 = collect_annot_vars(a, t);
                        break _t6443;
                      }
                      if (_t6441._tag === 0) {
                        _t6442 = a;
                        break _t6443;
                      }
                      _match_fail("line 16629");
                    }
                    _t6439 = _t6442;
                    break _t6440;
                  }
                  _match_fail("line 16629");
                }
                return _t6439;
              }
              _t6426 = List$fold(_t6437, acc, tags);
              break _t6427;
            }
            if (_t6425._tag === 10) {
              const ty = _t6425._val[0];
              const _t6444 = acc;
              const _t6445 = ty;
              acc = _t6444;
              __x = _t6445;
              continue;
              _t6426 = undefined;
              break _t6427;
            }
            _match_fail("line 16629");
          }
          return _t6426;
        }
      }
      function _t6447(__dict_Show_0, __p168) {
        let _t6449;
        const _t6448 = __p168;
        _t6450: {
          if (true) {
            const name = _t6448[0];
            const arg_annot = _t6448[1];
            const ret_annot = _t6448[2];
            let _t6452;
            const _t6451 = ret_annot;
            _t6453: {
              if (_t6451._tag === 0) {
                const arg_ty_6454 = Option$map(resolve_with_params_6417, arg_annot);
                const info_6456 = ({ctor_arg_ty: arg_ty_6454, ctor_existentials: 0, ctor_num_params: num_params_6325, ctor_return_ty_params: ({_tag: 0, _name: "None"}), ctor_type_name: type_name});
                const _t6457 = [[name, arg_ty_6454], [name, info_6456]];
                const _t6455 = _t6457;
                _t6452 = _t6455;
                break _t6453;
              }
              if (_t6451._tag === 1) {
                const ret = _t6451._val;
                let _t6459;
                const _t6458 = ret;
                _t6460: {
                  if (_t6458._tag === 0) {
                    const n = _t6458._val;
                    _t6459 = [n, null];
                    break _t6460;
                  }
                  if (_t6458._tag === 7) {
                    const args = _t6458._val[0];
                    const n = _t6458._val[1];
                    _t6459 = [n, args];
                    break _t6460;
                  }
                  if (true) {
                    _t6459 = Typechecker$error(((("GADT constructor " + __dict_Show_0.show(name)) + ": return type must be ") + __dict_Show_string.show(type_name)));
                    break _t6460;
                  }
                  _match_fail("line 16629");
                }
                let _t6462;
                const _t6461 = _t6459;
                _t6463: {
                  if (true) {
                    const ret_type_name = _t6461[0];
                    const ret_type_args = _t6461[1];
                    const canonical_ret_6464 = Typechecker$resolve_type_alias(pre_ctx_6334.type_env, ret_type_name);
                    let _t6471;
                    if ((canonical_ret_6464 === type_name)) {
                      _t6471 = true;
                    } else {
                    let _t6467;
                    const _t6466 = String$rindex_opt(type_name, 46);
                    _t6468: {
                      if (_t6466._tag === 1) {
                        const i = _t6466._val;
                        const _mml$short_6469 = String$sub(type_name, (i + 1), ((String$length(type_name) - i) - 1));
                        const _t6470 = (ret_type_name === _mml$short_6469);
                        _t6467 = _t6470;
                        break _t6468;
                      }
                      if (_t6466._tag === 0) {
                        _t6467 = false;
                        break _t6468;
                      }
                      _match_fail("line 16629");
                    }
                      _t6471 = _t6467;
                    }
                    const name_matches_6472 = _t6471;
                    let _t6474;
                    if ((!name_matches_6472)) {
                      _t6474 = Typechecker$error(((((("GADT constructor " + __dict_Show_0.show(name)) + ": return type must be ") + __dict_Show_string.show(type_name)) + ", got ") + __dict_Show_string.show(ret_type_name)));
                    } else {
                      _t6474 = undefined;
                    }
                    _t6474;
                    let _t6475;
                    if ((List$length(ret_type_args) !== num_params_6325)) {
                      _t6475 = Typechecker$error(((((("GADT constructor " + __dict_Show_0.show(name)) + ": return type has ") + __dict_Show_int.show(List$length(ret_type_args))) + " type arg(s), expected ") + __dict_Show_int.show(num_params_6325)));
                    } else {
                      _t6475 = undefined;
                    }
                    _t6475;
                    const ret_vars_6476 = List$fold(collect_annot_vars, null, ret_type_args);
                    let _t6479;
                    const _t6478 = arg_annot;
                    _t6480: {
                      if (_t6478._tag === 0) {
                        _t6479 = null;
                        break _t6480;
                      }
                      if (_t6478._tag === 1) {
                        const a = _t6478._val;
                        _t6479 = collect_annot_vars(null, a);
                        break _t6480;
                      }
                      _match_fail("line 16629");
                    }
                    const arg_vars_6481 = _t6479;
                    function _t6483(v) {
                      return ((!List$mem(v, ret_vars_6476)) && (!List$mem(v, type_params)));
                    }
                    const existentials_6484 = List$filter(_t6483, arg_vars_6481);
                    const num_exist_6486 = List$length(existentials_6484);
                    const gadt_tbl_6488 = Hashtbl$create(8);
                    function _t6490(i, p) {
                      return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, gadt_tbl_6488, p, i]);
                    }
                    List$iteri(_t6490, type_params);
                    function _t6491(i, e) {
                      return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, gadt_tbl_6488, e, (num_params_6325 + i)]);
                    }
                    List$iteri(_t6491, existentials_6484);
                    const gadt_tvars_6492 = Hashtbl$create(4);
                    function gadt_resolve(__x) {
                      while (true) {
                        let _t6495;
                        const _t6494 = __x;
                        _t6496: {
                          if (_t6494._tag === 1) {
                            const vname = _t6494._val;
                            let _t6498;
                            const _t6497 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, gadt_tbl_6488, vname]);
                            _t6499: {
                              if (_t6497._tag === 1) {
                                const idx = _t6497._val;
                                _t6498 = ({_tag: 16, _name: "TGen", _val: idx});
                                break _t6499;
                              }
                              if (_t6497._tag === 0) {
                                let _t6501;
                                const _t6500 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, gadt_tvars_6492, vname]);
                                _t6502: {
                                  if (_t6500._tag === 1) {
                                    const tv = _t6500._val;
                                    _t6501 = tv;
                                    break _t6502;
                                  }
                                  if (_t6500._tag === 0) {
                                    const tv_6503 = Types$new_tvar(0);
                                    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, gadt_tvars_6492, vname, tv_6503]);
                                    const _t6504 = tv_6503;
                                    _t6501 = _t6504;
                                    break _t6502;
                                  }
                                  _match_fail("line 16629");
                                }
                                _t6498 = _t6501;
                                break _t6499;
                              }
                              _match_fail("line 16629");
                            }
                            _t6495 = _t6498;
                            break _t6496;
                          }
                          if (_t6494._tag === 0 && _t6494._val === "int") {
                            _t6495 = ({_tag: 0, _name: "TInt"});
                            break _t6496;
                          }
                          if (_t6494._tag === 0 && _t6494._val === "float") {
                            _t6495 = ({_tag: 1, _name: "TFloat"});
                            break _t6496;
                          }
                          if (_t6494._tag === 0 && _t6494._val === "bool") {
                            _t6495 = ({_tag: 2, _name: "TBool"});
                            break _t6496;
                          }
                          if (_t6494._tag === 0 && _t6494._val === "string") {
                            _t6495 = ({_tag: 3, _name: "TString"});
                            break _t6496;
                          }
                          if (_t6494._tag === 0 && _t6494._val === "unit") {
                            _t6495 = ({_tag: 6, _name: "TUnit"});
                            break _t6496;
                          }
                          if (_t6494._tag === 0) {
                            const n = _t6494._val;
                            const canonical_6505 = Typechecker$resolve_type_alias(pre_ctx_6334.type_env, n);
                            function _t6507(__p169) {
                              let _t6509;
                              const _t6508 = __p169;
                              _t6510: {
                                if (true) {
                                  const tn = _t6508[0];
                                  _t6509 = (tn === canonical_6505);
                                  break _t6510;
                                }
                                _match_fail("line 16629");
                              }
                              return _t6509;
                            }
                            let _t6512;
                            const _t6511 = List$find(_t6507, pre_ctx_6334.type_env.type_synonyms);
                            _t6513: {
                              if (_t6511._tag === 1 && _t6511._val[1] === 0) {
                                const ty = _t6511._val[2];
                                _t6512 = ty;
                                break _t6513;
                              }
                              if (_t6511._tag === 1) {
                                const np = _t6511._val[1];
                                _t6512 = Typechecker$error((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s)"));
                                break _t6513;
                              }
                              if (_t6511._tag === 0) {
                                let _t6515;
                                const _t6514 = Typechecker$find_variant_info(pre_ctx_6334.type_env, n);
                                _t6516: {
                                  if (_t6514._tag === 1 && _t6514._val[1] === 0) {
                                    _t6515 = ({_tag: 12, _name: "TVariant", _val: [canonical_6505, null]});
                                    break _t6516;
                                  }
                                  if (_t6514._tag === 1) {
                                    const np = _t6514._val[1];
                                    _t6515 = Typechecker$error((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s)"));
                                    break _t6516;
                                  }
                                  if (_t6514._tag === 0) {
                                    let _t6517;
                                    if (!_eq(List$assoc_opt(canonical_6505, pre_ctx_6334.type_env.records), ({_tag: 0, _name: "None"}))) {
                                      const fields_6518 = List$assoc(canonical_6505, pre_ctx_6334.type_env.records);
                                      let _t6520;
                                      if (_eq(fields_6518, null)) {
                                        _t6520 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                                      } else {
                                        _t6520 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6518)});
                                      }
                                      const _t6519 = _t6520;
                                      _t6517 = _t6519;
                                    } else {
                                      _t6517 = Typechecker$error(("unknown type: " + __dict_Show_string.show(n)));
                                    }
                                    _t6515 = _t6517;
                                    break _t6516;
                                  }
                                  _match_fail("line 16629");
                                }
                                _t6512 = _t6515;
                                break _t6513;
                              }
                              _match_fail("line 16629");
                            }
                            const _t6506 = _t6512;
                            _t6495 = _t6506;
                            break _t6496;
                          }
                          if (_t6494._tag === 2) {
                            const a = _t6494._val[0];
                            const b = _t6494._val[1];
                            _t6495 = ({_tag: 7, _name: "TArrow", _val: [gadt_resolve(a), ({_tag: 1, _name: "EffEmpty"}), gadt_resolve(b)]});
                            break _t6496;
                          }
                          if (_t6494._tag === 6) {
                            const ts = _t6494._val;
                            _t6495 = ({_tag: 9, _name: "TTuple", _val: List$map(gadt_resolve, ts)});
                            break _t6496;
                          }
                          if (_t6494._tag === 4) {
                            const t = _t6494._val;
                            _t6495 = ({_tag: 10, _name: "TList", _val: gadt_resolve(t)});
                            break _t6496;
                          }
                          if (_t6494._tag === 5) {
                            const t = _t6494._val;
                            _t6495 = ({_tag: 13, _name: "TArray", _val: gadt_resolve(t)});
                            break _t6496;
                          }
                          if (_t6494._tag === 7) {
                            const args = _t6494._val[0];
                            const tname = _t6494._val[1];
                            const canonical_6521 = Typechecker$resolve_type_alias(pre_ctx_6334.type_env, tname);
                            const arg_tys_6523 = List$map(gadt_resolve, args);
                            function _t6525(__p170) {
                              let _t6527;
                              const _t6526 = __p170;
                              _t6528: {
                                if (true) {
                                  const tn = _t6526[0];
                                  _t6527 = (tn === canonical_6521);
                                  break _t6528;
                                }
                                _match_fail("line 16629");
                              }
                              return _t6527;
                            }
                            let _t6530;
                            const _t6529 = List$find(_t6525, pre_ctx_6334.type_env.type_synonyms);
                            _t6531: {
                              if (_t6529._tag === 1) {
                                const np = _t6529._val[1];
                                const ty = _t6529._val[2];
                                let _t6532;
                                if ((List$length(arg_tys_6523) !== np)) {
                                  _t6532 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6523))));
                                } else {
                                  _t6532 = undefined;
                                }
                                _t6532;
                                _t6530 = Typechecker$subst_tgens(arg_tys_6523, ty);
                                break _t6531;
                              }
                              if (_t6529._tag === 0) {
                                let _t6534;
                                const _t6533 = Typechecker$find_variant_info(pre_ctx_6334.type_env, tname);
                                _t6535: {
                                  if (_t6533._tag === 1) {
                                    const np = _t6533._val[1];
                                    let _t6536;
                                    if ((List$length(arg_tys_6523) !== np)) {
                                      _t6536 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6523))));
                                    } else {
                                      _t6536 = undefined;
                                    }
                                    _t6536;
                                    _t6534 = ({_tag: 12, _name: "TVariant", _val: [canonical_6521, arg_tys_6523]});
                                    break _t6535;
                                  }
                                  if (_t6533._tag === 0) {
                                    _t6534 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                                    break _t6535;
                                  }
                                  _match_fail("line 16629");
                                }
                                _t6530 = _t6534;
                                break _t6531;
                              }
                              _match_fail("line 16629");
                            }
                            const _t6524 = _t6530;
                            const _t6522 = _t6524;
                            _t6495 = _t6522;
                            break _t6496;
                          }
                          if (_t6494._tag === 3) {
                            const fields = _t6494._val[0];
                            const is_open = _t6494._val[1];
                            function _t6537(__p171, __p172) {
                              let _t6539;
                              const _t6538 = __p171;
                              _t6540: {
                                if (true) {
                                  const a = _t6538[0];
                                  let _t6542;
                                  const _t6541 = __p172;
                                  _t6543: {
                                    if (true) {
                                      const b = _t6541[0];
                                      _t6542 = String$compare(a, b);
                                      break _t6543;
                                    }
                                    _match_fail("line 16629");
                                  }
                                  _t6539 = _t6542;
                                  break _t6540;
                                }
                                _match_fail("line 16629");
                              }
                              return _t6539;
                            }
                            function _t6544(__p173) {
                              let _t6546;
                              const _t6545 = __p173;
                              _t6547: {
                                if (true) {
                                  const fn_ = _t6545[0];
                                  const ft = _t6545[1];
                                  _t6546 = [fn_, gadt_resolve(ft)];
                                  break _t6547;
                                }
                                _match_fail("line 16629");
                              }
                              return _t6546;
                            }
                            const fields_6548 = List$sort(_t6537, List$map(_t6544, fields));
                            let _t6550;
                            if (is_open) {
                              _t6550 = Types$new_rvar(0);
                            } else {
                              _t6550 = ({_tag: 2, _name: "REmpty"});
                            }
                            const tail_6551 = _t6550;
                            function _t6553(__p174, acc) {
                              let _t6555;
                              const _t6554 = __p174;
                              _t6556: {
                                if (true) {
                                  const n = _t6554[0];
                                  const t = _t6554[1];
                                  _t6555 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                                  break _t6556;
                                }
                                _match_fail("line 16629");
                              }
                              return _t6555;
                            }
                            const _t6552 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6553, fields_6548, tail_6551)});
                            const _t6549 = _t6552;
                            _t6495 = _t6549;
                            break _t6496;
                          }
                          if (_t6494._tag === 8) {
                            const path = _t6494._val[0];
                            const n = _t6494._val[1];
                            const qualified_6557 = (String$concat(".", path) + ("." + n));
                            const _t6559 = ({_tag: 0, _name: "TyName", _val: qualified_6557});
                            __x = _t6559;
                            continue;
                            const _t6558 = undefined;
                            _t6495 = _t6558;
                            break _t6496;
                          }
                          if (_t6494._tag === 9) {
                            const _kind = _t6494._val[0];
                            const tags = _t6494._val[1];
                            function _t6560(__p175, acc) {
                              let _t6562;
                              const _t6561 = __p175;
                              _t6563: {
                                if (true) {
                                  const tag = _t6561[0];
                                  const payload_annot = _t6561[1];
                                  _t6562 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(gadt_resolve, payload_annot), acc]});
                                  break _t6563;
                                }
                                _match_fail("line 16629");
                              }
                              return _t6562;
                            }
                            const row_6564 = List$fold_right(_t6560, tags, ({_tag: 2, _name: "PVEmpty"}));
                            const _t6565 = ({_tag: 14, _name: "TPolyVariant", _val: row_6564});
                            _t6495 = _t6565;
                            break _t6496;
                          }
                          if (_t6494._tag === 10) {
                            const ty = _t6494._val[0];
                            const _t6566 = ty;
                            __x = _t6566;
                            continue;
                            _t6495 = undefined;
                            break _t6496;
                          }
                          _match_fail("line 16629");
                        }
                        return _t6495;
                      }
                    }
                    const arg_ty_6568 = Option$map(gadt_resolve, arg_annot);
                    const ret_params_6570 = List$map(gadt_resolve, ret_type_args);
                    const info_6572 = ({ctor_arg_ty: arg_ty_6568, ctor_existentials: num_exist_6486, ctor_num_params: num_params_6325, ctor_return_ty_params: ({_tag: 1, _name: "Some", _val: ret_params_6570}), ctor_type_name: type_name});
                    const _t6573 = [[name, arg_ty_6568], [name, info_6572]];
                    const _t6571 = _t6573;
                    const _t6569 = _t6571;
                    const _t6567 = _t6569;
                    const _t6493 = _t6567;
                    const _t6489 = _t6493;
                    const _t6487 = _t6489;
                    const _t6485 = _t6487;
                    const _t6482 = _t6485;
                    const _t6477 = _t6482;
                    const _t6473 = _t6477;
                    const _t6465 = _t6473;
                    _t6462 = _t6465;
                    break _t6463;
                  }
                  _match_fail("line 16629");
                }
                _t6452 = _t6462;
                break _t6453;
              }
              _match_fail("line 16629");
            }
            _t6449 = _t6452;
            break _t6450;
          }
          _match_fail("line 16629");
        }
        return _t6449;
      }
      const process_ctor_6574 = _t6447;
      const results_6576 = List$map(_call(process_ctor_6574, [__dict_Show_string]), ctors);
      const variant_def_6578 = List$map(fst, results_6576);
      const ctor_infos_6580 = List$map(snd, results_6576);
      const __rec_upd_6582 = ctx.type_env;
      const _t6583 = ({classes: __rec_upd_6582.classes, constructors: List$concat(ctor_infos_6580, ctx.type_env.constructors), effects: __rec_upd_6582.effects, hidden_ctor_types: __rec_upd_6582.hidden_ctor_types, hidden_types: __rec_upd_6582.hidden_types, instances: __rec_upd_6582.instances, modules: __rec_upd_6582.modules, mutable_fields: __rec_upd_6582.mutable_fields, newtypes: __rec_upd_6582.newtypes, records: __rec_upd_6582.records, type_aliases: __rec_upd_6582.type_aliases, type_synonyms: __rec_upd_6582.type_synonyms, variants: ({_hd: [type_name, num_params_6325, variant_def_6578, is_gadt_6423], _tl: ctx.type_env.variants})});
      const type_env_6584 = _t6583;
      const __rec_upd_6586 = ctx;
      const _t6587 = ({constraint_tvars: __rec_upd_6586.constraint_tvars, current_eff: __rec_upd_6586.current_eff, current_module: __rec_upd_6586.current_module, inside_handler: __rec_upd_6586.inside_handler, loop_info: __rec_upd_6586.loop_info, mutable_vars: __rec_upd_6586.mutable_vars, return_type: __rec_upd_6586.return_type, return_used: __rec_upd_6586.return_used, type_env: type_env_6584, vars: __rec_upd_6586.vars});
      const _t6585 = _t6587;
      const _t6581 = _t6585;
      const _t6579 = _t6581;
      const _t6577 = _t6579;
      const _t6575 = _t6577;
      const _t6446 = _t6575;
      const _t6424 = _t6446;
      const _t6418 = _t6424;
      const _t6337 = _t6418;
      const _t6335 = _t6337;
      _t6328 = _t6335;
      break _t6329;
    }
    if (_t6327._tag === 1) {
      const fields = _t6327._val;
      const __rec_upd_6588 = ctx;
      const __rec_upd_6590 = ctx.type_env;
      const _t6591 = ({classes: __rec_upd_6590.classes, constructors: __rec_upd_6590.constructors, effects: __rec_upd_6590.effects, hidden_ctor_types: __rec_upd_6590.hidden_ctor_types, hidden_types: __rec_upd_6590.hidden_types, instances: __rec_upd_6590.instances, modules: __rec_upd_6590.modules, mutable_fields: __rec_upd_6590.mutable_fields, newtypes: __rec_upd_6590.newtypes, records: ({_hd: [type_name, null], _tl: ctx.type_env.records}), type_aliases: __rec_upd_6590.type_aliases, type_synonyms: __rec_upd_6590.type_synonyms, variants: __rec_upd_6590.variants});
      const _t6589 = ({constraint_tvars: __rec_upd_6588.constraint_tvars, current_eff: __rec_upd_6588.current_eff, current_module: __rec_upd_6588.current_module, inside_handler: __rec_upd_6588.inside_handler, loop_info: __rec_upd_6588.loop_info, mutable_vars: __rec_upd_6588.mutable_vars, return_type: __rec_upd_6588.return_type, return_used: __rec_upd_6588.return_used, type_env: _t6591, vars: __rec_upd_6588.vars});
      const pre_ctx_6592 = _t6589;
      const param_tbl_6594 = Hashtbl$create(4);
      function _t6596(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6594, name, i]);
      }
      List$iteri(_t6596, type_params);
      function _t6597(__p176) {
        let _t6599;
        const _t6598 = __p176;
        _t6600: {
          if (true) {
            const _is_mut = _t6598[0];
            const name = _t6598[1];
            const annot = _t6598[2];
            const tvars_6601 = Hashtbl$create(4);
            function resolve_field(__x) {
              while (true) {
                let _t6604;
                const _t6603 = __x;
                _t6605: {
                  if (_t6603._tag === 1) {
                    const vname = _t6603._val;
                    let _t6607;
                    const _t6606 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6594, vname]);
                    _t6608: {
                      if (_t6606._tag === 1) {
                        const idx = _t6606._val;
                        _t6607 = ({_tag: 16, _name: "TGen", _val: idx});
                        break _t6608;
                      }
                      if (_t6606._tag === 0) {
                        let _t6610;
                        const _t6609 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6601, vname]);
                        _t6611: {
                          if (_t6609._tag === 1) {
                            const tv = _t6609._val;
                            _t6610 = tv;
                            break _t6611;
                          }
                          if (_t6609._tag === 0) {
                            const tv_6612 = Types$new_tvar(0);
                            _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6601, vname, tv_6612]);
                            const _t6613 = tv_6612;
                            _t6610 = _t6613;
                            break _t6611;
                          }
                          _match_fail("line 16629");
                        }
                        _t6607 = _t6610;
                        break _t6608;
                      }
                      _match_fail("line 16629");
                    }
                    _t6604 = _t6607;
                    break _t6605;
                  }
                  if (_t6603._tag === 0 && _t6603._val === "int") {
                    _t6604 = ({_tag: 0, _name: "TInt"});
                    break _t6605;
                  }
                  if (_t6603._tag === 0 && _t6603._val === "float") {
                    _t6604 = ({_tag: 1, _name: "TFloat"});
                    break _t6605;
                  }
                  if (_t6603._tag === 0 && _t6603._val === "bool") {
                    _t6604 = ({_tag: 2, _name: "TBool"});
                    break _t6605;
                  }
                  if (_t6603._tag === 0 && _t6603._val === "string") {
                    _t6604 = ({_tag: 3, _name: "TString"});
                    break _t6605;
                  }
                  if (_t6603._tag === 0 && _t6603._val === "unit") {
                    _t6604 = ({_tag: 6, _name: "TUnit"});
                    break _t6605;
                  }
                  if (_t6603._tag === 0) {
                    const n = _t6603._val;
                    _t6604 = Typechecker$resolve_ty_annot(pre_ctx_6592, 0, ({_tag: 0, _name: "TyName", _val: n}));
                    break _t6605;
                  }
                  if (_t6603._tag === 2) {
                    const a = _t6603._val[0];
                    const b = _t6603._val[1];
                    _t6604 = ({_tag: 7, _name: "TArrow", _val: [resolve_field(a), ({_tag: 1, _name: "EffEmpty"}), resolve_field(b)]});
                    break _t6605;
                  }
                  if (_t6603._tag === 6) {
                    const ts = _t6603._val;
                    _t6604 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve_field, ts)});
                    break _t6605;
                  }
                  if (_t6603._tag === 4) {
                    const t = _t6603._val;
                    _t6604 = ({_tag: 10, _name: "TList", _val: resolve_field(t)});
                    break _t6605;
                  }
                  if (_t6603._tag === 5) {
                    const t = _t6603._val;
                    _t6604 = ({_tag: 13, _name: "TArray", _val: resolve_field(t)});
                    break _t6605;
                  }
                  if (_t6603._tag === 7) {
                    const args = _t6603._val[0];
                    const n = _t6603._val[1];
                    const arg_tys_6614 = List$map(resolve_field, args);
                    function _t6616(__p177) {
                      let _t6618;
                      const _t6617 = __p177;
                      _t6619: {
                        if (true) {
                          const tn = _t6617[0];
                          _t6618 = (tn === n);
                          break _t6619;
                        }
                        _match_fail("line 16629");
                      }
                      return _t6618;
                    }
                    let _t6621;
                    const _t6620 = List$find(_t6616, pre_ctx_6592.type_env.type_synonyms);
                    _t6622: {
                      if (_t6620._tag === 1) {
                        const np = _t6620._val[1];
                        const ty = _t6620._val[2];
                        let _t6623;
                        if ((List$length(arg_tys_6614) !== np)) {
                          _t6623 = Typechecker$error(((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " arg(s), got ") + __dict_Show_int.show(List$length(arg_tys_6614))));
                        } else {
                          _t6623 = undefined;
                        }
                        _t6623;
                        _t6621 = Typechecker$subst_tgens(arg_tys_6614, ty);
                        break _t6622;
                      }
                      if (_t6620._tag === 0) {
                        let _t6625;
                        const _t6624 = Typechecker$find_variant_info(pre_ctx_6592.type_env, n);
                        _t6626: {
                          if (_t6624._tag === 1) {
                            const np = _t6624._val[1];
                            let _t6627;
                            if ((List$length(arg_tys_6614) !== np)) {
                              _t6627 = Typechecker$error(((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " arg(s), got ") + __dict_Show_int.show(List$length(arg_tys_6614))));
                            } else {
                              _t6627 = undefined;
                            }
                            _t6627;
                            const canonical_6628 = Typechecker$resolve_type_alias(pre_ctx_6592.type_env, n);
                            const _t6629 = ({_tag: 12, _name: "TVariant", _val: [canonical_6628, arg_tys_6614]});
                            _t6625 = _t6629;
                            break _t6626;
                          }
                          if (_t6624._tag === 0) {
                            _t6625 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(n)));
                            break _t6626;
                          }
                          _match_fail("line 16629");
                        }
                        _t6621 = _t6625;
                        break _t6622;
                      }
                      _match_fail("line 16629");
                    }
                    const _t6615 = _t6621;
                    _t6604 = _t6615;
                    break _t6605;
                  }
                  if (_t6603._tag === 3) {
                    const fs = _t6603._val[0];
                    const is_open = _t6603._val[1];
                    function _t6630(__p178, __p179) {
                      let _t6632;
                      const _t6631 = __p178;
                      _t6633: {
                        if (true) {
                          const a = _t6631[0];
                          let _t6635;
                          const _t6634 = __p179;
                          _t6636: {
                            if (true) {
                              const b = _t6634[0];
                              _t6635 = String$compare(a, b);
                              break _t6636;
                            }
                            _match_fail("line 16629");
                          }
                          _t6632 = _t6635;
                          break _t6633;
                        }
                        _match_fail("line 16629");
                      }
                      return _t6632;
                    }
                    function _t6637(__p180) {
                      let _t6639;
                      const _t6638 = __p180;
                      _t6640: {
                        if (true) {
                          const fn_ = _t6638[0];
                          const ft = _t6638[1];
                          _t6639 = [fn_, resolve_field(ft)];
                          break _t6640;
                        }
                        _match_fail("line 16629");
                      }
                      return _t6639;
                    }
                    const fields_6641 = List$sort(_t6630, List$map(_t6637, fs));
                    let _t6643;
                    if (is_open) {
                      _t6643 = Types$new_rvar(0);
                    } else {
                      _t6643 = ({_tag: 2, _name: "REmpty"});
                    }
                    const tail_6644 = _t6643;
                    function _t6646(__p181, acc) {
                      let _t6648;
                      const _t6647 = __p181;
                      _t6649: {
                        if (true) {
                          const n = _t6647[0];
                          const t = _t6647[1];
                          _t6648 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                          break _t6649;
                        }
                        _match_fail("line 16629");
                      }
                      return _t6648;
                    }
                    const _t6645 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6646, fields_6641, tail_6644)});
                    const _t6642 = _t6645;
                    _t6604 = _t6642;
                    break _t6605;
                  }
                  if (_t6603._tag === 8) {
                    const path = _t6603._val[0];
                    const n = _t6603._val[1];
                    const qualified_6650 = (String$concat(".", path) + ("." + n));
                    const _t6652 = ({_tag: 0, _name: "TyName", _val: qualified_6650});
                    __x = _t6652;
                    continue;
                    const _t6651 = undefined;
                    _t6604 = _t6651;
                    break _t6605;
                  }
                  if (_t6603._tag === 9) {
                    const _kind = _t6603._val[0];
                    const tags = _t6603._val[1];
                    function _t6653(__p182, acc) {
                      let _t6655;
                      const _t6654 = __p182;
                      _t6656: {
                        if (true) {
                          const tag = _t6654[0];
                          const payload_annot = _t6654[1];
                          _t6655 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve_field, payload_annot), acc]});
                          break _t6656;
                        }
                        _match_fail("line 16629");
                      }
                      return _t6655;
                    }
                    const row_6657 = List$fold_right(_t6653, tags, ({_tag: 2, _name: "PVEmpty"}));
                    const _t6658 = ({_tag: 14, _name: "TPolyVariant", _val: row_6657});
                    _t6604 = _t6658;
                    break _t6605;
                  }
                  if (_t6603._tag === 10) {
                    const ty = _t6603._val[0];
                    const _t6659 = ty;
                    __x = _t6659;
                    continue;
                    _t6604 = undefined;
                    break _t6605;
                  }
                  _match_fail("line 16629");
                }
                return _t6604;
              }
            }
            const _t6660 = [name, resolve_field(annot)];
            const _t6602 = _t6660;
            _t6599 = _t6602;
            break _t6600;
          }
          _match_fail("line 16629");
        }
        return _t6599;
      }
      const typed_fields_6661 = List$map(_t6597, fields);
      function _t6663(__p183) {
        let _t6665;
        const _t6664 = __p183;
        _t6666: {
          if (true) {
            const is_mut = _t6664[0];
            const name = _t6664[1];
            let _t6667;
            if (is_mut) {
              _t6667 = ({_tag: 1, _name: "Some", _val: name});
            } else {
              _t6667 = ({_tag: 0, _name: "None"});
            }
            _t6665 = _t6667;
            break _t6666;
          }
          _match_fail("line 16629");
        }
        return _t6665;
      }
      const mut_fields_6668 = List$filter_map(_t6663, fields);
      function _t6670(__p184, __p185) {
        let _t6672;
        const _t6671 = __p184;
        _t6673: {
          if (true) {
            const a = _t6671[0];
            let _t6675;
            const _t6674 = __p185;
            _t6676: {
              if (true) {
                const b = _t6674[0];
                _t6675 = String$compare(a, b);
                break _t6676;
              }
              _match_fail("line 16629");
            }
            _t6672 = _t6675;
            break _t6673;
          }
          _match_fail("line 16629");
        }
        return _t6672;
      }
      const sorted_fields_6677 = List$sort(_t6670, typed_fields_6661);
      const __rec_upd_6679 = ctx.type_env;
      const _t6680 = ({classes: __rec_upd_6679.classes, constructors: __rec_upd_6679.constructors, effects: __rec_upd_6679.effects, hidden_ctor_types: __rec_upd_6679.hidden_ctor_types, hidden_types: __rec_upd_6679.hidden_types, instances: __rec_upd_6679.instances, modules: __rec_upd_6679.modules, mutable_fields: List$concat(mut_fields_6668, ctx.type_env.mutable_fields), newtypes: __rec_upd_6679.newtypes, records: ({_hd: [type_name, sorted_fields_6677], _tl: ctx.type_env.records}), type_aliases: __rec_upd_6679.type_aliases, type_synonyms: ({_hd: [type_name, num_params_6325, ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(sorted_fields_6677)})], _tl: ctx.type_env.type_synonyms}), variants: __rec_upd_6679.variants});
      const type_env_6681 = _t6680;
      const __rec_upd_6683 = ctx;
      const _t6684 = ({constraint_tvars: __rec_upd_6683.constraint_tvars, current_eff: __rec_upd_6683.current_eff, current_module: __rec_upd_6683.current_module, inside_handler: __rec_upd_6683.inside_handler, loop_info: __rec_upd_6683.loop_info, mutable_vars: __rec_upd_6683.mutable_vars, return_type: __rec_upd_6683.return_type, return_used: __rec_upd_6683.return_used, type_env: type_env_6681, vars: __rec_upd_6683.vars});
      const _t6682 = _t6684;
      const _t6678 = _t6682;
      const _t6669 = _t6678;
      const _t6662 = _t6669;
      const _t6595 = _t6662;
      const _t6593 = _t6595;
      _t6328 = _t6593;
      break _t6329;
    }
    if (_t6327._tag === 2) {
      const annot = _t6327._val;
      const param_tbl_6685 = Hashtbl$create(4);
      function _t6687(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6685, name, i]);
      }
      List$iteri(_t6687, type_params);
      const tvars_6688 = Hashtbl$create(4);
      function resolve_alias(__x) {
        while (true) {
          let _t6691;
          const _t6690 = __x;
          _t6692: {
            if (_t6690._tag === 1) {
              const name = _t6690._val;
              let _t6694;
              const _t6693 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6685, name]);
              _t6695: {
                if (_t6693._tag === 1) {
                  const idx = _t6693._val;
                  _t6694 = ({_tag: 16, _name: "TGen", _val: idx});
                  break _t6695;
                }
                if (_t6693._tag === 0) {
                  let _t6697;
                  const _t6696 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6688, name]);
                  _t6698: {
                    if (_t6696._tag === 1) {
                      const tv = _t6696._val;
                      _t6697 = tv;
                      break _t6698;
                    }
                    if (_t6696._tag === 0) {
                      const tv_6699 = Types$new_tvar(0);
                      _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6688, name, tv_6699]);
                      const _t6700 = tv_6699;
                      _t6697 = _t6700;
                      break _t6698;
                    }
                    _match_fail("line 16629");
                  }
                  _t6694 = _t6697;
                  break _t6695;
                }
                _match_fail("line 16629");
              }
              _t6691 = _t6694;
              break _t6692;
            }
            if (_t6690._tag === 0 && _t6690._val === "int") {
              _t6691 = ({_tag: 0, _name: "TInt"});
              break _t6692;
            }
            if (_t6690._tag === 0 && _t6690._val === "float") {
              _t6691 = ({_tag: 1, _name: "TFloat"});
              break _t6692;
            }
            if (_t6690._tag === 0 && _t6690._val === "bool") {
              _t6691 = ({_tag: 2, _name: "TBool"});
              break _t6692;
            }
            if (_t6690._tag === 0 && _t6690._val === "string") {
              _t6691 = ({_tag: 3, _name: "TString"});
              break _t6692;
            }
            if (_t6690._tag === 0 && _t6690._val === "unit") {
              _t6691 = ({_tag: 6, _name: "TUnit"});
              break _t6692;
            }
            if (_t6690._tag === 0) {
              const name = _t6690._val;
              const canonical_6701 = Typechecker$resolve_type_alias(ctx.type_env, name);
              function _t6703(__p186) {
                let _t6705;
                const _t6704 = __p186;
                _t6706: {
                  if (true) {
                    const n = _t6704[0];
                    _t6705 = (n === canonical_6701);
                    break _t6706;
                  }
                  _match_fail("line 16629");
                }
                return _t6705;
              }
              let _t6708;
              const _t6707 = List$find(_t6703, ctx.type_env.type_synonyms);
              _t6709: {
                if (_t6707._tag === 1 && _t6707._val[1] === 0) {
                  const ty = _t6707._val[2];
                  _t6708 = ty;
                  break _t6709;
                }
                if (_t6707._tag === 1) {
                  const n = _t6707._val[1];
                  _t6708 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                  break _t6709;
                }
                if (_t6707._tag === 0) {
                  let _t6711;
                  const _t6710 = Typechecker$find_variant_info(ctx.type_env, name);
                  _t6712: {
                    if (_t6710._tag === 1 && _t6710._val[1] === 0) {
                      _t6711 = ({_tag: 12, _name: "TVariant", _val: [canonical_6701, null]});
                      break _t6712;
                    }
                    if (_t6710._tag === 1) {
                      const n = _t6710._val[1];
                      _t6711 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                      break _t6712;
                    }
                    if (_t6710._tag === 0) {
                      let _t6713;
                      if (!_eq(List$assoc_opt(canonical_6701, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                        const fields_6714 = List$assoc(canonical_6701, ctx.type_env.records);
                        let _t6716;
                        if (_eq(fields_6714, null)) {
                          _t6716 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                        } else {
                          _t6716 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6714)});
                        }
                        const _t6715 = _t6716;
                        _t6713 = _t6715;
                      } else {
                        _t6713 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                      }
                      _t6711 = _t6713;
                      break _t6712;
                    }
                    _match_fail("line 16629");
                  }
                  _t6708 = _t6711;
                  break _t6709;
                }
                _match_fail("line 16629");
              }
              const _t6702 = _t6708;
              _t6691 = _t6702;
              break _t6692;
            }
            if (_t6690._tag === 2) {
              const a = _t6690._val[0];
              const b = _t6690._val[1];
              _t6691 = ({_tag: 7, _name: "TArrow", _val: [resolve_alias(a), ({_tag: 1, _name: "EffEmpty"}), resolve_alias(b)]});
              break _t6692;
            }
            if (_t6690._tag === 6) {
              const ts = _t6690._val;
              _t6691 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve_alias, ts)});
              break _t6692;
            }
            if (_t6690._tag === 4) {
              const t = _t6690._val;
              _t6691 = ({_tag: 10, _name: "TList", _val: resolve_alias(t)});
              break _t6692;
            }
            if (_t6690._tag === 5) {
              const t = _t6690._val;
              _t6691 = ({_tag: 13, _name: "TArray", _val: resolve_alias(t)});
              break _t6692;
            }
            if (_t6690._tag === 7) {
              const args = _t6690._val[0];
              const tname = _t6690._val[1];
              const canonical_6717 = Typechecker$resolve_type_alias(ctx.type_env, tname);
              const arg_tys_6719 = List$map(resolve_alias, args);
              function _t6721(__p187) {
                let _t6723;
                const _t6722 = __p187;
                _t6724: {
                  if (true) {
                    const n = _t6722[0];
                    _t6723 = (n === canonical_6717);
                    break _t6724;
                  }
                  _match_fail("line 16629");
                }
                return _t6723;
              }
              let _t6726;
              const _t6725 = List$find(_t6721, ctx.type_env.type_synonyms);
              _t6727: {
                if (_t6725._tag === 1) {
                  const np = _t6725._val[1];
                  const ty = _t6725._val[2];
                  let _t6728;
                  if ((List$length(arg_tys_6719) !== np)) {
                    _t6728 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6719))));
                  } else {
                    _t6728 = undefined;
                  }
                  _t6728;
                  _t6726 = Typechecker$subst_tgens(arg_tys_6719, ty);
                  break _t6727;
                }
                if (_t6725._tag === 0) {
                  let _t6730;
                  const _t6729 = Typechecker$find_variant_info(ctx.type_env, tname);
                  _t6731: {
                    if (_t6729._tag === 1) {
                      const np = _t6729._val[1];
                      let _t6732;
                      if ((List$length(arg_tys_6719) !== np)) {
                        _t6732 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6719))));
                      } else {
                        _t6732 = undefined;
                      }
                      _t6732;
                      _t6730 = ({_tag: 12, _name: "TVariant", _val: [canonical_6717, arg_tys_6719]});
                      break _t6731;
                    }
                    if (_t6729._tag === 0) {
                      _t6730 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                      break _t6731;
                    }
                    _match_fail("line 16629");
                  }
                  _t6726 = _t6730;
                  break _t6727;
                }
                _match_fail("line 16629");
              }
              const _t6720 = _t6726;
              const _t6718 = _t6720;
              _t6691 = _t6718;
              break _t6692;
            }
            if (_t6690._tag === 3) {
              const fields = _t6690._val[0];
              const is_open = _t6690._val[1];
              function _t6733(__p188) {
                let _t6735;
                const _t6734 = __p188;
                _t6736: {
                  if (true) {
                    const n = _t6734[0];
                    const t = _t6734[1];
                    _t6735 = [n, resolve_alias(t)];
                    break _t6736;
                  }
                  _match_fail("line 16629");
                }
                return _t6735;
              }
              const fields_6737 = List$map(_t6733, fields);
              function _t6739(__p189, __p190) {
                let _t6741;
                const _t6740 = __p189;
                _t6742: {
                  if (true) {
                    const a = _t6740[0];
                    let _t6744;
                    const _t6743 = __p190;
                    _t6745: {
                      if (true) {
                        const b = _t6743[0];
                        _t6744 = String$compare(a, b);
                        break _t6745;
                      }
                      _match_fail("line 16629");
                    }
                    _t6741 = _t6744;
                    break _t6742;
                  }
                  _match_fail("line 16629");
                }
                return _t6741;
              }
              const fields_6746 = List$sort(_t6739, fields_6737);
              let _t6748;
              if (is_open) {
                _t6748 = Types$new_rvar(0);
              } else {
                _t6748 = ({_tag: 2, _name: "REmpty"});
              }
              const tail_6749 = _t6748;
              function _t6751(__p191, acc) {
                let _t6753;
                const _t6752 = __p191;
                _t6754: {
                  if (true) {
                    const n = _t6752[0];
                    const t = _t6752[1];
                    _t6753 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                    break _t6754;
                  }
                  _match_fail("line 16629");
                }
                return _t6753;
              }
              const _t6750 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6751, fields_6746, tail_6749)});
              const _t6747 = _t6750;
              const _t6738 = _t6747;
              _t6691 = _t6738;
              break _t6692;
            }
            if (_t6690._tag === 8) {
              const path = _t6690._val[0];
              const name = _t6690._val[1];
              const qualified_6755 = (String$concat(".", path) + ("." + name));
              const _t6757 = ({_tag: 0, _name: "TyName", _val: qualified_6755});
              __x = _t6757;
              continue;
              const _t6756 = undefined;
              _t6691 = _t6756;
              break _t6692;
            }
            if (_t6690._tag === 9) {
              const _kind = _t6690._val[0];
              const tags = _t6690._val[1];
              function _t6758(__p192, acc) {
                let _t6760;
                const _t6759 = __p192;
                _t6761: {
                  if (true) {
                    const tag = _t6759[0];
                    const payload_annot = _t6759[1];
                    _t6760 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve_alias, payload_annot), acc]});
                    break _t6761;
                  }
                  _match_fail("line 16629");
                }
                return _t6760;
              }
              const row_6762 = List$fold_right(_t6758, tags, ({_tag: 2, _name: "PVEmpty"}));
              const _t6763 = ({_tag: 14, _name: "TPolyVariant", _val: row_6762});
              _t6691 = _t6763;
              break _t6692;
            }
            if (_t6690._tag === 10) {
              const ty = _t6690._val[0];
              const _t6764 = ty;
              __x = _t6764;
              continue;
              _t6691 = undefined;
              break _t6692;
            }
            _match_fail("line 16629");
          }
          return _t6691;
        }
      }
      const resolved_ty_6766 = resolve_alias(annot);
      const __rec_upd_6768 = ctx.type_env;
      const _t6769 = ({classes: __rec_upd_6768.classes, constructors: __rec_upd_6768.constructors, effects: __rec_upd_6768.effects, hidden_ctor_types: __rec_upd_6768.hidden_ctor_types, hidden_types: __rec_upd_6768.hidden_types, instances: __rec_upd_6768.instances, modules: __rec_upd_6768.modules, mutable_fields: __rec_upd_6768.mutable_fields, newtypes: __rec_upd_6768.newtypes, records: __rec_upd_6768.records, type_aliases: __rec_upd_6768.type_aliases, type_synonyms: ({_hd: [type_name, num_params_6325, resolved_ty_6766], _tl: ctx.type_env.type_synonyms}), variants: __rec_upd_6768.variants});
      const type_env_6770 = _t6769;
      const __rec_upd_6772 = ctx;
      const _t6773 = ({constraint_tvars: __rec_upd_6772.constraint_tvars, current_eff: __rec_upd_6772.current_eff, current_module: __rec_upd_6772.current_module, inside_handler: __rec_upd_6772.inside_handler, loop_info: __rec_upd_6772.loop_info, mutable_vars: __rec_upd_6772.mutable_vars, return_type: __rec_upd_6772.return_type, return_used: __rec_upd_6772.return_used, type_env: type_env_6770, vars: __rec_upd_6772.vars});
      const _t6771 = _t6773;
      const _t6767 = _t6771;
      const _t6765 = _t6767;
      const _t6689 = _t6765;
      const _t6686 = _t6689;
      _t6328 = _t6686;
      break _t6329;
    }
    if (_t6327._tag === 3) {
      const ctor_name = _t6327._val[0];
      const underlying_annot = _t6327._val[1];
      const param_tbl_6774 = Hashtbl$create(4);
      function _t6776(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6774, name, i]);
      }
      List$iteri(_t6776, type_params);
      const tvars_6777 = Hashtbl$create(4);
      function resolve_nt(__x) {
        while (true) {
          let _t6780;
          const _t6779 = __x;
          _t6781: {
            if (_t6779._tag === 1) {
              const name = _t6779._val;
              let _t6783;
              const _t6782 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6774, name]);
              _t6784: {
                if (_t6782._tag === 1) {
                  const idx = _t6782._val;
                  _t6783 = ({_tag: 16, _name: "TGen", _val: idx});
                  break _t6784;
                }
                if (_t6782._tag === 0) {
                  let _t6786;
                  const _t6785 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6777, name]);
                  _t6787: {
                    if (_t6785._tag === 1) {
                      const tv = _t6785._val;
                      _t6786 = tv;
                      break _t6787;
                    }
                    if (_t6785._tag === 0) {
                      const tv_6788 = Types$new_tvar(0);
                      _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6777, name, tv_6788]);
                      const _t6789 = tv_6788;
                      _t6786 = _t6789;
                      break _t6787;
                    }
                    _match_fail("line 16629");
                  }
                  _t6783 = _t6786;
                  break _t6784;
                }
                _match_fail("line 16629");
              }
              _t6780 = _t6783;
              break _t6781;
            }
            if (_t6779._tag === 0 && _t6779._val === "int") {
              _t6780 = ({_tag: 0, _name: "TInt"});
              break _t6781;
            }
            if (_t6779._tag === 0 && _t6779._val === "float") {
              _t6780 = ({_tag: 1, _name: "TFloat"});
              break _t6781;
            }
            if (_t6779._tag === 0 && _t6779._val === "bool") {
              _t6780 = ({_tag: 2, _name: "TBool"});
              break _t6781;
            }
            if (_t6779._tag === 0 && _t6779._val === "string") {
              _t6780 = ({_tag: 3, _name: "TString"});
              break _t6781;
            }
            if (_t6779._tag === 0 && _t6779._val === "unit") {
              _t6780 = ({_tag: 6, _name: "TUnit"});
              break _t6781;
            }
            if (_t6779._tag === 0) {
              const name = _t6779._val;
              const canonical_6790 = Typechecker$resolve_type_alias(ctx.type_env, name);
              function _t6792(__p193) {
                let _t6794;
                const _t6793 = __p193;
                _t6795: {
                  if (true) {
                    const n = _t6793[0];
                    _t6794 = (n === canonical_6790);
                    break _t6795;
                  }
                  _match_fail("line 16629");
                }
                return _t6794;
              }
              let _t6797;
              const _t6796 = List$find(_t6792, ctx.type_env.type_synonyms);
              _t6798: {
                if (_t6796._tag === 1 && _t6796._val[1] === 0) {
                  const ty = _t6796._val[2];
                  _t6797 = ty;
                  break _t6798;
                }
                if (_t6796._tag === 1) {
                  const n = _t6796._val[1];
                  _t6797 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                  break _t6798;
                }
                if (_t6796._tag === 0) {
                  let _t6800;
                  const _t6799 = Typechecker$find_variant_info(ctx.type_env, name);
                  _t6801: {
                    if (_t6799._tag === 1 && _t6799._val[1] === 0) {
                      _t6800 = ({_tag: 12, _name: "TVariant", _val: [canonical_6790, null]});
                      break _t6801;
                    }
                    if (_t6799._tag === 1) {
                      const n = _t6799._val[1];
                      _t6800 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                      break _t6801;
                    }
                    if (_t6799._tag === 0) {
                      let _t6802;
                      if (!_eq(List$assoc_opt(canonical_6790, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                        const fields_6803 = List$assoc(canonical_6790, ctx.type_env.records);
                        let _t6805;
                        if (_eq(fields_6803, null)) {
                          _t6805 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                        } else {
                          _t6805 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6803)});
                        }
                        const _t6804 = _t6805;
                        _t6802 = _t6804;
                      } else {
                        _t6802 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                      }
                      _t6800 = _t6802;
                      break _t6801;
                    }
                    _match_fail("line 16629");
                  }
                  _t6797 = _t6800;
                  break _t6798;
                }
                _match_fail("line 16629");
              }
              const _t6791 = _t6797;
              _t6780 = _t6791;
              break _t6781;
            }
            if (_t6779._tag === 2) {
              const a = _t6779._val[0];
              const b = _t6779._val[1];
              _t6780 = ({_tag: 7, _name: "TArrow", _val: [resolve_nt(a), ({_tag: 1, _name: "EffEmpty"}), resolve_nt(b)]});
              break _t6781;
            }
            if (_t6779._tag === 6) {
              const ts = _t6779._val;
              _t6780 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve_nt, ts)});
              break _t6781;
            }
            if (_t6779._tag === 4) {
              const t = _t6779._val;
              _t6780 = ({_tag: 10, _name: "TList", _val: resolve_nt(t)});
              break _t6781;
            }
            if (_t6779._tag === 5) {
              const t = _t6779._val;
              _t6780 = ({_tag: 13, _name: "TArray", _val: resolve_nt(t)});
              break _t6781;
            }
            if (_t6779._tag === 7) {
              const args = _t6779._val[0];
              const tname = _t6779._val[1];
              const canonical_6806 = Typechecker$resolve_type_alias(ctx.type_env, tname);
              const arg_tys_6808 = List$map(resolve_nt, args);
              function _t6810(__p194) {
                let _t6812;
                const _t6811 = __p194;
                _t6813: {
                  if (true) {
                    const n = _t6811[0];
                    _t6812 = (n === canonical_6806);
                    break _t6813;
                  }
                  _match_fail("line 16629");
                }
                return _t6812;
              }
              let _t6815;
              const _t6814 = List$find(_t6810, ctx.type_env.type_synonyms);
              _t6816: {
                if (_t6814._tag === 1) {
                  const np = _t6814._val[1];
                  const ty = _t6814._val[2];
                  let _t6817;
                  if ((List$length(arg_tys_6808) !== np)) {
                    _t6817 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6808))));
                  } else {
                    _t6817 = undefined;
                  }
                  _t6817;
                  _t6815 = Typechecker$subst_tgens(arg_tys_6808, ty);
                  break _t6816;
                }
                if (_t6814._tag === 0) {
                  let _t6819;
                  const _t6818 = Typechecker$find_variant_info(ctx.type_env, tname);
                  _t6820: {
                    if (_t6818._tag === 1) {
                      const np = _t6818._val[1];
                      let _t6821;
                      if ((List$length(arg_tys_6808) !== np)) {
                        _t6821 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6808))));
                      } else {
                        _t6821 = undefined;
                      }
                      _t6821;
                      _t6819 = ({_tag: 12, _name: "TVariant", _val: [canonical_6806, arg_tys_6808]});
                      break _t6820;
                    }
                    if (_t6818._tag === 0) {
                      _t6819 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                      break _t6820;
                    }
                    _match_fail("line 16629");
                  }
                  _t6815 = _t6819;
                  break _t6816;
                }
                _match_fail("line 16629");
              }
              const _t6809 = _t6815;
              const _t6807 = _t6809;
              _t6780 = _t6807;
              break _t6781;
            }
            if (_t6779._tag === 3) {
              const fields = _t6779._val[0];
              const is_open = _t6779._val[1];
              function _t6822(__p195) {
                let _t6824;
                const _t6823 = __p195;
                _t6825: {
                  if (true) {
                    const n = _t6823[0];
                    const t = _t6823[1];
                    _t6824 = [n, resolve_nt(t)];
                    break _t6825;
                  }
                  _match_fail("line 16629");
                }
                return _t6824;
              }
              const fields_6826 = List$map(_t6822, fields);
              function _t6828(__p196, __p197) {
                let _t6830;
                const _t6829 = __p196;
                _t6831: {
                  if (true) {
                    const a = _t6829[0];
                    let _t6833;
                    const _t6832 = __p197;
                    _t6834: {
                      if (true) {
                        const b = _t6832[0];
                        _t6833 = String$compare(a, b);
                        break _t6834;
                      }
                      _match_fail("line 16629");
                    }
                    _t6830 = _t6833;
                    break _t6831;
                  }
                  _match_fail("line 16629");
                }
                return _t6830;
              }
              const fields_6835 = List$sort(_t6828, fields_6826);
              let _t6837;
              if (is_open) {
                _t6837 = Types$new_rvar(0);
              } else {
                _t6837 = ({_tag: 2, _name: "REmpty"});
              }
              const tail_6838 = _t6837;
              function _t6840(__p198, acc) {
                let _t6842;
                const _t6841 = __p198;
                _t6843: {
                  if (true) {
                    const n = _t6841[0];
                    const t = _t6841[1];
                    _t6842 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                    break _t6843;
                  }
                  _match_fail("line 16629");
                }
                return _t6842;
              }
              const _t6839 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6840, fields_6835, tail_6838)});
              const _t6836 = _t6839;
              const _t6827 = _t6836;
              _t6780 = _t6827;
              break _t6781;
            }
            if (_t6779._tag === 8) {
              const path = _t6779._val[0];
              const name = _t6779._val[1];
              const qualified_6844 = (String$concat(".", path) + ("." + name));
              const _t6846 = ({_tag: 0, _name: "TyName", _val: qualified_6844});
              __x = _t6846;
              continue;
              const _t6845 = undefined;
              _t6780 = _t6845;
              break _t6781;
            }
            if (_t6779._tag === 9) {
              const _kind = _t6779._val[0];
              const tags = _t6779._val[1];
              function _t6847(__p199, acc) {
                let _t6849;
                const _t6848 = __p199;
                _t6850: {
                  if (true) {
                    const tag = _t6848[0];
                    const payload_annot = _t6848[1];
                    _t6849 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve_nt, payload_annot), acc]});
                    break _t6850;
                  }
                  _match_fail("line 16629");
                }
                return _t6849;
              }
              const row_6851 = List$fold_right(_t6847, tags, ({_tag: 2, _name: "PVEmpty"}));
              const _t6852 = ({_tag: 14, _name: "TPolyVariant", _val: row_6851});
              _t6780 = _t6852;
              break _t6781;
            }
            if (_t6779._tag === 10) {
              const ty = _t6779._val[0];
              const _t6853 = ty;
              __x = _t6853;
              continue;
              _t6780 = undefined;
              break _t6781;
            }
            _match_fail("line 16629");
          }
          return _t6780;
        }
      }
      const underlying_ty_6855 = resolve_nt(underlying_annot);
      const variant_def_6857 = ({_hd: [ctor_name, ({_tag: 1, _name: "Some", _val: underlying_ty_6855})], _tl: null});
      const ctor_info_6859 = ({ctor_arg_ty: ({_tag: 1, _name: "Some", _val: underlying_ty_6855}), ctor_existentials: 0, ctor_num_params: num_params_6325, ctor_return_ty_params: ({_tag: 0, _name: "None"}), ctor_type_name: type_name});
      const __rec_upd_6861 = ctx.type_env;
      const _t6862 = ({classes: __rec_upd_6861.classes, constructors: ({_hd: [ctor_name, ctor_info_6859], _tl: ctx.type_env.constructors}), effects: __rec_upd_6861.effects, hidden_ctor_types: __rec_upd_6861.hidden_ctor_types, hidden_types: __rec_upd_6861.hidden_types, instances: __rec_upd_6861.instances, modules: __rec_upd_6861.modules, mutable_fields: __rec_upd_6861.mutable_fields, newtypes: ({_hd: type_name, _tl: ctx.type_env.newtypes}), records: __rec_upd_6861.records, type_aliases: __rec_upd_6861.type_aliases, type_synonyms: __rec_upd_6861.type_synonyms, variants: ({_hd: [type_name, num_params_6325, variant_def_6857, false], _tl: ctx.type_env.variants})});
      const type_env_6863 = _t6862;
      const __rec_upd_6865 = ctx;
      const _t6866 = ({constraint_tvars: __rec_upd_6865.constraint_tvars, current_eff: __rec_upd_6865.current_eff, current_module: __rec_upd_6865.current_module, inside_handler: __rec_upd_6865.inside_handler, loop_info: __rec_upd_6865.loop_info, mutable_vars: __rec_upd_6865.mutable_vars, return_type: __rec_upd_6865.return_type, return_used: __rec_upd_6865.return_used, type_env: type_env_6863, vars: __rec_upd_6865.vars});
      const _t6864 = _t6866;
      const _t6860 = _t6864;
      const _t6858 = _t6860;
      const _t6856 = _t6858;
      const _t6854 = _t6856;
      const _t6778 = _t6854;
      const _t6775 = _t6778;
      _t6328 = _t6775;
      break _t6329;
    }
    _match_fail("line 16629");
  }
  const _t6326 = _t6328;
  return _t6326;
}
function Typechecker$wrap_params_decl(params, ret_annot, body) {
  let _t6868;
  const _t6867 = ret_annot;
  _t6869: {
    if (_t6867._tag === 1 && _t6867._val._tag === 10) {
      const ret_ty = _t6867._val._val[0];
      const eff_annot = _t6867._val._val[1];
      if (!_eq(params, null)) {
        const body_6870 = ({_tag: 30, _name: "EAnnot", _val: [body, ret_ty]});
        function _t6872(param, body) {
          return ({_tag: 10, _name: "EFun", _val: [param, body]});
        }
        const full_fun_6873 = List$fold_right(_t6872, params, body_6870);
        function build_arrow(__x) {
          let _t6876;
          const _t6875 = __x;
          _t6877: {
            if (_t6875 === null) {
              _t6876 = ret_ty;
              break _t6877;
            }
            if (_t6875 !== null && _t6875._tl === null) {
              const p = _t6875._hd;
              let _t6879;
              const _t6878 = p.annot;
              _t6880: {
                if (_t6878._tag === 1) {
                  const t = _t6878._val;
                  _t6879 = t;
                  break _t6880;
                }
                if (_t6878._tag === 0) {
                  _t6879 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t6880;
                }
                _match_fail("line 16629");
              }
              const pty_6881 = _t6879;
              const _t6882 = ({_tag: 2, _name: "TyArrow", _val: [pty_6881, ret_ty, ({_tag: 1, _name: "Some", _val: eff_annot})]});
              _t6876 = _t6882;
              break _t6877;
            }
            if (_t6875 !== null) {
              const p = _t6875._hd;
              const rest = _t6875._tl;
              let _t6884;
              const _t6883 = p.annot;
              _t6885: {
                if (_t6883._tag === 1) {
                  const t = _t6883._val;
                  _t6884 = t;
                  break _t6885;
                }
                if (_t6883._tag === 0) {
                  _t6884 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t6885;
                }
                _match_fail("line 16629");
              }
              const pty_6886 = _t6884;
              const _t6887 = ({_tag: 2, _name: "TyArrow", _val: [pty_6886, build_arrow(rest), ({_tag: 0, _name: "None"})]});
              _t6876 = _t6887;
              break _t6877;
            }
            _match_fail("line 16629");
          }
          return _t6876;
        }
        const _t6888 = ({_tag: 30, _name: "EAnnot", _val: [full_fun_6873, build_arrow(params)]});
        const _t6874 = _t6888;
        const _t6871 = _t6874;
        _t6868 = _t6871;
        break _t6869;
      }
    }
    if (true) {
      let _t6890;
      const _t6889 = ret_annot;
      _t6891: {
        if (_t6889._tag === 1) {
          const ty = _t6889._val;
          _t6890 = ({_tag: 30, _name: "EAnnot", _val: [body, ty]});
          break _t6891;
        }
        if (_t6889._tag === 0) {
          _t6890 = body;
          break _t6891;
        }
        _match_fail("line 16629");
      }
      const body_6892 = _t6890;
      function _t6894(param, body) {
        return ({_tag: 10, _name: "EFun", _val: [param, body]});
      }
      const _t6893 = List$fold_right(_t6894, params, body_6892);
      _t6868 = _t6893;
      break _t6869;
    }
    _match_fail("line 16629");
  }
  return _t6868;
}
function Typechecker$process_class_def(ctx, class_name, tyvar_names, fundep_annots, methods) {
  function _t6895(c) {
    return (c.class_name === class_name);
  }
  let _t6896;
  if (List$exists(_t6895, ctx.type_env.classes)) {
    _t6896 = Typechecker$error(("duplicate class definition: " + __dict_Show_string.show(class_name)));
  } else {
    _t6896 = undefined;
  }
  _t6896;
  const num_class_params_6897 = List$length(tyvar_names);
  function _t6899(__p200) {
    let _t6901;
    const _t6900 = __p200;
    _t6902: {
      if (true) {
        const mname = _t6900[0];
        const annot = _t6900[1];
        const tvars_6903 = Hashtbl$create(4);
        function _t6905(i, name) {
          return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6903, name, ({_tag: 16, _name: "TGen", _val: i})]);
        }
        List$iteri(_t6905, tyvar_names);
        const next_gen_6906 = Ref$create(num_class_params_6897);
        const eff_tvars_6908 = Hashtbl$create(2);
        const next_effgen_6910 = Ref$create(0);
        function _t6912(__dict_Hash_0, __dict_Eq_0, name) {
          let _t6914;
          const _t6913 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, eff_tvars_6908, name]);
          _t6915: {
            if (_t6913._tag === 1) {
              const eg = _t6913._val;
              _t6914 = eg;
              break _t6915;
            }
            if (_t6913._tag === 0) {
              const idx_6916 = Ref$get(next_effgen_6910);
              Ref$set(next_effgen_6910, (idx_6916 + 1));
              const eg_6918 = ({_tag: 3, _name: "EffGen", _val: idx_6916});
              _call(Hashtbl$set, [__dict_Hash_0, __dict_Eq_0, eff_tvars_6908, name, eg_6918]);
              const _t6919 = eg_6918;
              const _t6917 = _t6919;
              _t6914 = _t6917;
              break _t6915;
            }
            _match_fail("line 16629");
          }
          return _t6914;
        }
        const resolve_eff_var_6920 = _t6912;
        function resolve(__x) {
          while (true) {
            let _t6923;
            const _t6922 = __x;
            _t6924: {
              if (_t6922._tag === 1) {
                const name = _t6922._val;
                let _t6926;
                const _t6925 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6903, name]);
                _t6927: {
                  if (_t6925._tag === 1) {
                    const tv = _t6925._val;
                    _t6926 = tv;
                    break _t6927;
                  }
                  if (_t6925._tag === 0) {
                    const idx_6928 = Ref$get(next_gen_6906);
                    Ref$set(next_gen_6906, (idx_6928 + 1));
                    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6903, name, ({_tag: 16, _name: "TGen", _val: idx_6928})]);
                    const _t6929 = ({_tag: 16, _name: "TGen", _val: idx_6928});
                    _t6926 = _t6929;
                    break _t6927;
                  }
                  _match_fail("line 16629");
                }
                _t6923 = _t6926;
                break _t6924;
              }
              if (_t6922._tag === 0 && _t6922._val === "int") {
                _t6923 = ({_tag: 0, _name: "TInt"});
                break _t6924;
              }
              if (_t6922._tag === 0 && _t6922._val === "float") {
                _t6923 = ({_tag: 1, _name: "TFloat"});
                break _t6924;
              }
              if (_t6922._tag === 0 && _t6922._val === "bool") {
                _t6923 = ({_tag: 2, _name: "TBool"});
                break _t6924;
              }
              if (_t6922._tag === 0 && _t6922._val === "string") {
                _t6923 = ({_tag: 3, _name: "TString"});
                break _t6924;
              }
              if (_t6922._tag === 0 && _t6922._val === "unit") {
                _t6923 = ({_tag: 6, _name: "TUnit"});
                break _t6924;
              }
              if (_t6922._tag === 0) {
                const name = _t6922._val;
                const canonical_6930 = Typechecker$resolve_type_alias(ctx.type_env, name);
                let _t6933;
                const _t6932 = Typechecker$find_variant_info(ctx.type_env, name);
                _t6934: {
                  if (_t6932._tag === 1 && _t6932._val[1] === 0) {
                    _t6933 = ({_tag: 12, _name: "TVariant", _val: [canonical_6930, null]});
                    break _t6934;
                  }
                  if (_t6932._tag === 1) {
                    const n = _t6932._val[1];
                    _t6933 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                    break _t6934;
                  }
                  if (_t6932._tag === 0) {
                    _t6933 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                    break _t6934;
                  }
                  _match_fail("line 16629");
                }
                const _t6931 = _t6933;
                _t6923 = _t6931;
                break _t6924;
              }
              if (_t6922._tag === 2) {
                const a = _t6922._val[0];
                const b = _t6922._val[1];
                const eff_opt = _t6922._val[2];
                let _t6936;
                const _t6935 = eff_opt;
                _t6937: {
                  if (_t6935._tag === 0) {
                    _t6936 = ({_tag: 1, _name: "EffEmpty"});
                    break _t6937;
                  }
                  if (_t6935._tag === 1 && _t6935._val._tag === 0) {
                    _t6936 = ({_tag: 1, _name: "EffEmpty"});
                    break _t6937;
                  }
                  if (_t6935._tag === 1 && _t6935._val._tag === 1) {
                    const items = _t6935._val._val;
                    _t6936 = resolve_class_eff_items(items);
                    break _t6937;
                  }
                  _match_fail("line 16629");
                }
                const eff_6938 = _t6936;
                const _t6939 = ({_tag: 7, _name: "TArrow", _val: [resolve(a), eff_6938, resolve(b)]});
                _t6923 = _t6939;
                break _t6924;
              }
              if (_t6922._tag === 6) {
                const ts = _t6922._val;
                _t6923 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve, ts)});
                break _t6924;
              }
              if (_t6922._tag === 4) {
                const t = _t6922._val;
                _t6923 = ({_tag: 10, _name: "TList", _val: resolve(t)});
                break _t6924;
              }
              if (_t6922._tag === 5) {
                const t = _t6922._val;
                _t6923 = ({_tag: 13, _name: "TArray", _val: resolve(t)});
                break _t6924;
              }
              if (_t6922._tag === 7) {
                const args = _t6922._val[0];
                const name = _t6922._val[1];
                const canonical_6940 = Typechecker$resolve_type_alias(ctx.type_env, name);
                const arg_tys_6942 = List$map(resolve, args);
                let _t6945;
                const _t6944 = Typechecker$find_variant_info(ctx.type_env, name);
                _t6946: {
                  if (_t6944._tag === 1) {
                    const np = _t6944._val[1];
                    let _t6947;
                    if ((List$length(arg_tys_6942) !== np)) {
                      _t6947 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6942))));
                    } else {
                      _t6947 = undefined;
                    }
                    _t6947;
                    _t6945 = ({_tag: 12, _name: "TVariant", _val: [canonical_6940, arg_tys_6942]});
                    break _t6946;
                  }
                  if (_t6944._tag === 0) {
                    _t6945 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
                    break _t6946;
                  }
                  _match_fail("line 16629");
                }
                const _t6943 = _t6945;
                const _t6941 = _t6943;
                _t6923 = _t6941;
                break _t6924;
              }
              if (_t6922._tag === 3) {
                const fields = _t6922._val[0];
                const is_open = _t6922._val[1];
                function _t6948(__p201, __p202) {
                  let _t6950;
                  const _t6949 = __p201;
                  _t6951: {
                    if (true) {
                      const a = _t6949[0];
                      let _t6953;
                      const _t6952 = __p202;
                      _t6954: {
                        if (true) {
                          const b = _t6952[0];
                          _t6953 = String$compare(a, b);
                          break _t6954;
                        }
                        _match_fail("line 16629");
                      }
                      _t6950 = _t6953;
                      break _t6951;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6950;
                }
                function _t6955(__p203) {
                  let _t6957;
                  const _t6956 = __p203;
                  _t6958: {
                    if (true) {
                      const n = _t6956[0];
                      const t = _t6956[1];
                      _t6957 = [n, resolve(t)];
                      break _t6958;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6957;
                }
                const fields_6959 = List$sort(_t6948, List$map(_t6955, fields));
                let _t6961;
                if (is_open) {
                  _t6961 = Types$new_rvar(0);
                } else {
                  _t6961 = ({_tag: 2, _name: "REmpty"});
                }
                const tail_6962 = _t6961;
                function _t6964(__p204, acc) {
                  let _t6966;
                  const _t6965 = __p204;
                  _t6967: {
                    if (true) {
                      const n = _t6965[0];
                      const t = _t6965[1];
                      _t6966 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                      break _t6967;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6966;
                }
                const _t6963 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6964, fields_6959, tail_6962)});
                const _t6960 = _t6963;
                _t6923 = _t6960;
                break _t6924;
              }
              if (_t6922._tag === 8) {
                const path = _t6922._val[0];
                const name = _t6922._val[1];
                const qualified_6968 = (String$concat(".", path) + ("." + name));
                const _t6970 = ({_tag: 0, _name: "TyName", _val: qualified_6968});
                __x = _t6970;
                continue;
                const _t6969 = undefined;
                _t6923 = _t6969;
                break _t6924;
              }
              if (_t6922._tag === 9) {
                const _kind = _t6922._val[0];
                const tags = _t6922._val[1];
                function _t6971(__p205, acc) {
                  let _t6973;
                  const _t6972 = __p205;
                  _t6974: {
                    if (true) {
                      const tag = _t6972[0];
                      const payload_annot = _t6972[1];
                      _t6973 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve, payload_annot), acc]});
                      break _t6974;
                    }
                    _match_fail("line 16629");
                  }
                  return _t6973;
                }
                const row_6975 = List$fold_right(_t6971, tags, ({_tag: 2, _name: "PVEmpty"}));
                const _t6976 = ({_tag: 14, _name: "TPolyVariant", _val: row_6975});
                _t6923 = _t6976;
                break _t6924;
              }
              if (_t6922._tag === 10) {
                const ty = _t6922._val[0];
                const _t6977 = ty;
                __x = _t6977;
                continue;
                _t6923 = undefined;
                break _t6924;
              }
              _match_fail("line 16629");
            }
            return _t6923;
          }
        }
        function resolve_class_eff_items(items) {
          const labels_6978 = Ref$create(null);
          const tail_6980 = Ref$create(({_tag: 1, _name: "EffEmpty"}));
          function _t6982(item) {
            let _t6984;
            const _t6983 = item;
            _t6985: {
              if (_t6983._tag === 0) {
                const name = _t6983._val[0];
                const param_annots = _t6983._val[1];
                const resolved_params_6986 = List$map(resolve, param_annots);
                const _t6987 = Ref$set(labels_6978, ({_hd: [name, resolved_params_6986], _tl: Ref$get(labels_6978)}));
                _t6984 = _t6987;
                break _t6985;
              }
              if (_t6983._tag === 1) {
                const name = _t6983._val;
                _t6984 = Ref$set(tail_6980, _call(resolve_eff_var_6920, [__dict_Hash_string, __dict_Eq_string, name]));
                break _t6985;
              }
              _match_fail("line 16629");
            }
            return _t6984;
          }
          List$iter(_t6982, items);
          function _t6988(__p206, acc) {
            let _t6990;
            const _t6989 = __p206;
            _t6991: {
              if (true) {
                const name = _t6989[0];
                const params = _t6989[1];
                _t6990 = ({_tag: 2, _name: "EffRow", _val: [name, params, acc]});
                break _t6991;
              }
              _match_fail("line 16629");
            }
            return _t6990;
          }
          const _t6981 = List$fold_right(_t6988, List$rev(Ref$get(labels_6978)), Ref$get(tail_6980));
          const _t6979 = _t6981;
          return _t6979;
        }
        const ty_6993 = resolve(annot);
        const method_quant_6995 = Ref$get(next_gen_6906);
        const method_equant_6997 = Ref$get(next_effgen_6910);
        const _t6998 = [mname, ty_6993, method_quant_6995, method_equant_6997];
        const _t6996 = _t6998;
        const _t6994 = _t6996;
        const _t6992 = _t6994;
        const _t6921 = _t6992;
        const _t6911 = _t6921;
        const _t6909 = _t6911;
        const _t6907 = _t6909;
        const _t6904 = _t6907;
        _t6901 = _t6904;
        break _t6902;
      }
      _match_fail("line 16629");
    }
    return _t6901;
  }
  const method_tys_6999 = List$map(_t6899, methods);
  function _t7001(__p207) {
    let _t7003;
    const _t7002 = __p207;
    _t7004: {
      if (true) {
        const from_names = _t7002[0];
        const to_names = _t7002[1];
        function _t7005(name) {
          function _t7006(n) {
            return (n === name);
          }
          let _t7008;
          const _t7007 = List$find_index(_t7006, tyvar_names);
          _t7009: {
            if (_t7007._tag === 1) {
              const i = _t7007._val;
              _t7008 = i;
              break _t7009;
            }
            if (_t7007._tag === 0) {
              _t7008 = Typechecker$error((("functional dependency type variable '" + __dict_Show_string.show(name)) + " not in class parameters"));
              break _t7009;
            }
            _match_fail("line 16629");
          }
          return _t7008;
        }
        const resolve_idx_7010 = _t7005;
        const _t7011 = ({fd_from: List$map(resolve_idx_7010, from_names), fd_to: List$map(resolve_idx_7010, to_names)});
        _t7003 = _t7011;
        break _t7004;
      }
      _match_fail("line 16629");
    }
    return _t7003;
  }
  const class_fundeps_7012 = List$map(_t7001, fundep_annots);
  function _t7014(__p208) {
    let _t7016;
    const _t7015 = __p208;
    _t7017: {
      if (true) {
        const m = _t7015[0];
        const t = _t7015[1];
        _t7016 = [m, t];
        break _t7017;
      }
      _match_fail("line 16629");
    }
    return _t7016;
  }
  const class_def_7018 = ({class_fundeps: class_fundeps_7012, class_methods: List$map(_t7014, method_tys_6999), class_name: class_name, class_params: tyvar_names});
  function _t7020(ctx, __p209) {
    let _t7022;
    const _t7021 = __p209;
    _t7023: {
      if (true) {
        const mname = _t7021[0];
        const mty = _t7021[1];
        const mquant = _t7021[2];
        const mequant = _t7021[3];
        const scheme_7024 = ({body: mty, constraints: null, equant: mequant, pvquant: 0, quant: mquant, record_evidences: null, rquant: 0});
        const _t7025 = Typechecker$extend_var(ctx, mname, scheme_7024);
        _t7022 = _t7025;
        break _t7023;
      }
      _match_fail("line 16629");
    }
    return _t7022;
  }
  const ctx_7026 = List$fold(_t7020, ctx, method_tys_6999);
  const __rec_upd_7028 = ctx_7026.type_env;
  const _t7029 = ({classes: ({_hd: class_def_7018, _tl: ctx_7026.type_env.classes}), constructors: __rec_upd_7028.constructors, effects: __rec_upd_7028.effects, hidden_ctor_types: __rec_upd_7028.hidden_ctor_types, hidden_types: __rec_upd_7028.hidden_types, instances: __rec_upd_7028.instances, modules: __rec_upd_7028.modules, mutable_fields: __rec_upd_7028.mutable_fields, newtypes: __rec_upd_7028.newtypes, records: __rec_upd_7028.records, type_aliases: __rec_upd_7028.type_aliases, type_synonyms: __rec_upd_7028.type_synonyms, variants: __rec_upd_7028.variants});
  const type_env_7030 = _t7029;
  const __rec_upd_7032 = ctx_7026;
  const _t7033 = ({constraint_tvars: __rec_upd_7032.constraint_tvars, current_eff: __rec_upd_7032.current_eff, current_module: __rec_upd_7032.current_module, inside_handler: __rec_upd_7032.inside_handler, loop_info: __rec_upd_7032.loop_info, mutable_vars: __rec_upd_7032.mutable_vars, return_type: __rec_upd_7032.return_type, return_used: __rec_upd_7032.return_used, type_env: type_env_7030, vars: __rec_upd_7032.vars});
  const ctx_7034 = _t7033;
  const _t7035 = [ctx_7034, ({_tag: 6, _name: "TDClass", _val: class_name})];
  const _t7031 = _t7035;
  const _t7027 = _t7031;
  const _t7019 = _t7027;
  const _t7013 = _t7019;
  const _t7000 = _t7013;
  const _t6898 = _t7000;
  return _t6898;
}
function Typechecker$resolve_inst_tys(ctx, annots) {
  const tvars_7036 = Hashtbl$create(4);
  const next_idx_7038 = Ref$create(0);
  function go(__x) {
    while (true) {
      let _t7041;
      const _t7040 = __x;
      _t7042: {
        if (_t7040._tag === 1) {
          const name = _t7040._val;
          let _t7044;
          const _t7043 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_7036, name]);
          _t7045: {
            if (_t7043._tag === 1) {
              const idx = _t7043._val;
              _t7044 = ({_tag: 16, _name: "TGen", _val: idx});
              break _t7045;
            }
            if (_t7043._tag === 0) {
              const idx_7046 = Ref$get(next_idx_7038);
              Ref$set(next_idx_7038, (idx_7046 + 1));
              _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_7036, name, idx_7046]);
              const _t7047 = ({_tag: 16, _name: "TGen", _val: idx_7046});
              _t7044 = _t7047;
              break _t7045;
            }
            _match_fail("line 16629");
          }
          _t7041 = _t7044;
          break _t7042;
        }
        if (_t7040._tag === 0 && _t7040._val === "int") {
          _t7041 = ({_tag: 0, _name: "TInt"});
          break _t7042;
        }
        if (_t7040._tag === 0 && _t7040._val === "float") {
          _t7041 = ({_tag: 1, _name: "TFloat"});
          break _t7042;
        }
        if (_t7040._tag === 0 && _t7040._val === "bool") {
          _t7041 = ({_tag: 2, _name: "TBool"});
          break _t7042;
        }
        if (_t7040._tag === 0 && _t7040._val === "string") {
          _t7041 = ({_tag: 3, _name: "TString"});
          break _t7042;
        }
        if (_t7040._tag === 0 && _t7040._val === "byte") {
          _t7041 = ({_tag: 4, _name: "TByte"});
          break _t7042;
        }
        if (_t7040._tag === 0 && _t7040._val === "rune") {
          _t7041 = ({_tag: 5, _name: "TRune"});
          break _t7042;
        }
        if (_t7040._tag === 0 && _t7040._val === "unit") {
          _t7041 = ({_tag: 6, _name: "TUnit"});
          break _t7042;
        }
        if (_t7040._tag === 0) {
          const name = _t7040._val;
          const canonical_7048 = Typechecker$resolve_type_alias(ctx.type_env, name);
          let _t7051;
          const _t7050 = Typechecker$find_variant_info(ctx.type_env, name);
          _t7052: {
            if (_t7050._tag === 1 && _t7050._val[1] === 0) {
              _t7051 = ({_tag: 12, _name: "TVariant", _val: [canonical_7048, null]});
              break _t7052;
            }
            if (_t7050._tag === 1) {
              const n = _t7050._val[1];
              _t7051 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
              break _t7052;
            }
            if (_t7050._tag === 0) {
              let _t7053;
              if (!_eq(List$assoc_opt(name, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                const fields_7054 = List$assoc(name, ctx.type_env.records);
                let _t7056;
                if (_eq(fields_7054, null)) {
                  _t7056 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                } else {
                  _t7056 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_7054)});
                }
                const _t7055 = _t7056;
                _t7053 = _t7055;
              } else {
                _t7053 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
              }
              _t7051 = _t7053;
              break _t7052;
            }
            _match_fail("line 16629");
          }
          const _t7049 = _t7051;
          _t7041 = _t7049;
          break _t7042;
        }
        if (_t7040._tag === 2) {
          const a = _t7040._val[0];
          const b = _t7040._val[1];
          _t7041 = ({_tag: 7, _name: "TArrow", _val: [go(a), ({_tag: 1, _name: "EffEmpty"}), go(b)]});
          break _t7042;
        }
        if (_t7040._tag === 6) {
          const ts = _t7040._val;
          _t7041 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t7042;
        }
        if (_t7040._tag === 4) {
          const t = _t7040._val;
          _t7041 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t7042;
        }
        if (_t7040._tag === 5) {
          const t = _t7040._val;
          _t7041 = ({_tag: 13, _name: "TArray", _val: go(t)});
          break _t7042;
        }
        if (_t7040._tag === 7) {
          const args = _t7040._val[0];
          const name = _t7040._val[1];
          const canonical_7057 = Typechecker$resolve_type_alias(ctx.type_env, name);
          const arg_tys_7059 = List$map(go, args);
          let _t7062;
          const _t7061 = Typechecker$find_variant_info(ctx.type_env, name);
          _t7063: {
            if (_t7061._tag === 1) {
              const np = _t7061._val[1];
              let _t7064;
              if ((List$length(arg_tys_7059) !== np)) {
                _t7064 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_7059))));
              } else {
                _t7064 = undefined;
              }
              _t7064;
              _t7062 = ({_tag: 12, _name: "TVariant", _val: [canonical_7057, arg_tys_7059]});
              break _t7063;
            }
            if (_t7061._tag === 0) {
              _t7062 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
              break _t7063;
            }
            _match_fail("line 16629");
          }
          const _t7060 = _t7062;
          const _t7058 = _t7060;
          _t7041 = _t7058;
          break _t7042;
        }
        if (_t7040._tag === 3) {
          const fields = _t7040._val[0];
          const is_open = _t7040._val[1];
          function _t7065(__p210) {
            let _t7067;
            const _t7066 = __p210;
            _t7068: {
              if (true) {
                const n = _t7066[0];
                const t = _t7066[1];
                _t7067 = [n, go(t)];
                break _t7068;
              }
              _match_fail("line 16629");
            }
            return _t7067;
          }
          const fields_7069 = List$map(_t7065, fields);
          function _t7071(__p211, __p212) {
            let _t7073;
            const _t7072 = __p211;
            _t7074: {
              if (true) {
                const a = _t7072[0];
                let _t7076;
                const _t7075 = __p212;
                _t7077: {
                  if (true) {
                    const b = _t7075[0];
                    _t7076 = String$compare(a, b);
                    break _t7077;
                  }
                  _match_fail("line 16629");
                }
                _t7073 = _t7076;
                break _t7074;
              }
              _match_fail("line 16629");
            }
            return _t7073;
          }
          const fields_7078 = List$sort(_t7071, fields_7069);
          let _t7080;
          if (is_open) {
            _t7080 = Types$new_rvar(0);
          } else {
            _t7080 = ({_tag: 2, _name: "REmpty"});
          }
          const tail_7081 = _t7080;
          function _t7083(__p213, acc) {
            let _t7085;
            const _t7084 = __p213;
            _t7086: {
              if (true) {
                const n = _t7084[0];
                const t = _t7084[1];
                _t7085 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                break _t7086;
              }
              _match_fail("line 16629");
            }
            return _t7085;
          }
          const _t7082 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t7083, fields_7078, tail_7081)});
          const _t7079 = _t7082;
          const _t7070 = _t7079;
          _t7041 = _t7070;
          break _t7042;
        }
        if (_t7040._tag === 8) {
          const path = _t7040._val[0];
          const name = _t7040._val[1];
          const qualified_7087 = (String$concat(".", path) + ("." + name));
          const _t7089 = ({_tag: 0, _name: "TyName", _val: qualified_7087});
          __x = _t7089;
          continue;
          const _t7088 = undefined;
          _t7041 = _t7088;
          break _t7042;
        }
        if (_t7040._tag === 9) {
          const _kind = _t7040._val[0];
          const tags = _t7040._val[1];
          function _t7090(__p214, acc) {
            let _t7092;
            const _t7091 = __p214;
            _t7093: {
              if (true) {
                const tag = _t7091[0];
                const payload_annot = _t7091[1];
                _t7092 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload_annot), acc]});
                break _t7093;
              }
              _match_fail("line 16629");
            }
            return _t7092;
          }
          const row_7094 = List$fold_right(_t7090, tags, ({_tag: 2, _name: "PVEmpty"}));
          const _t7095 = ({_tag: 14, _name: "TPolyVariant", _val: row_7094});
          _t7041 = _t7095;
          break _t7042;
        }
        if (_t7040._tag === 10) {
          const ty = _t7040._val[0];
          const _t7096 = ty;
          __x = _t7096;
          continue;
          _t7041 = undefined;
          break _t7042;
        }
        _match_fail("line 16629");
      }
      return _t7041;
    }
  }
  const tys_7098 = List$map(go, annots);
  const _t7099 = [tys_7098, Ref$get(next_idx_7038), tvars_7036];
  const _t7097 = _t7099;
  const _t7039 = _t7097;
  const _t7037 = _t7039;
  return _t7037;
}
function Typechecker$process_instance_def(ctx, level, class_name, inst_ty_annots, constraints, methods) {
  const class_name_7100 = Typechecker$resolve_type_alias(ctx.type_env, class_name);
  function _t7102(c) {
    return (c.class_name === class_name_7100);
  }
  let _t7104;
  const _t7103 = List$find(_t7102, ctx.type_env.classes);
  _t7105: {
    if (_t7103._tag === 1) {
      const c = _t7103._val;
      _t7104 = c;
      break _t7105;
    }
    if (_t7103._tag === 0) {
      _t7104 = Typechecker$error(("unknown class: " + __dict_Show_string.show(class_name_7100)));
      break _t7105;
    }
    _match_fail("line 16629");
  }
  const class_def_7106 = _t7104;
  const num_class_params_7108 = List$length(class_def_7106.class_params);
  let _t7111;
  const _t7110 = Typechecker$resolve_inst_tys(ctx, inst_ty_annots);
  _t7112: {
    if (true) {
      const stored_tys = _t7110[0];
      const num_inst_vars = _t7110[1];
      const inst_tvars = _t7110[2];
      let _t7113;
      if ((List$length(stored_tys) !== num_class_params_7108)) {
        _t7113 = Typechecker$error(((((("class " + __dict_Show_string.show(class_name_7100)) + " expects ") + __dict_Show_int.show(num_class_params_7108)) + " type parameters, got ") + __dict_Show_int.show(List$length(stored_tys))));
      } else {
        _t7113 = undefined;
      }
      _t7113;
      const dname_7114 = _call(Types$dict_name, [__dict_Show_string, class_name_7100, stored_tys]);
      function _t7116(_) {
        return Types$new_tvar((level + 1));
      }
      const check_tvar_list_7117 = List$init(num_inst_vars, _t7116);
      function _t7119(t) {
        return Typechecker$subst_tgens(check_tvar_list_7117, t);
      }
      const check_tys_7120 = List$map(_t7119, stored_tys);
      function _t7122(i) {
        let _t7125;
        if ((i.inst_class === class_name_7100)) {
        let _t7124;
        if ((List$length(i.inst_tys) === List$length(stored_tys))) {
        function _t7123(t) {
          return ({_tag: 1, _name: "Some", _val: t});
        }
          _t7124 = Types$match_partial_inst(i.inst_tys, List$map(_t7123, stored_tys));
        } else {
          _t7124 = false;
        }
          _t7125 = _t7124;
        } else {
          _t7125 = false;
        }
        return _t7125;
      }
      let _t7126;
      if (List$exists(_t7122, ctx.type_env.instances)) {
        _t7126 = Typechecker$error(((("duplicate instance " + __dict_Show_string.show(class_name_7100)) + " for types ") + __dict_Show_string.show(String$concat(", ", List$map(Types$pp_ty, stored_tys)))));
      } else {
        _t7126 = undefined;
      }
      _t7126;
      function _t7127(__p215) {
        let _t7129;
        const _t7128 = __p215;
        _t7130: {
          if (true) {
            const mname = _t7128[0];
            function _t7131(__p216) {
              let _t7133;
              const _t7132 = __p216;
              _t7134: {
                if (true) {
                  const n = _t7132[0];
                  _t7133 = (n === mname);
                  break _t7134;
                }
                _match_fail("line 16629");
              }
              return _t7133;
            }
            let _t7135;
            if ((!List$exists(_t7131, methods))) {
              _t7135 = Typechecker$error(((((("instance " + __dict_Show_string.show(class_name_7100)) + " ") + __dict_Show_string.show(String$concat(" ", List$map(Types$pp_ty, stored_tys)))) + " missing method: ") + __dict_Show_string.show(mname)));
            } else {
              _t7135 = undefined;
            }
            _t7129 = _t7135;
            break _t7130;
          }
          _match_fail("line 16629");
        }
        return _t7129;
      }
      List$iter(_t7127, class_def_7106.class_methods);
      function _t7136(__p217) {
        let _t7138;
        const _t7137 = __p217;
        _t7139: {
          if (true) {
            const mname = _t7137[0];
            const params = _t7137[1];
            const body = _t7137[2];
            let _t7141;
            const _t7140 = List$assoc_opt(mname, class_def_7106.class_methods);
            _t7142: {
              if (_t7140._tag === 1) {
                const ty = _t7140._val;
                _t7141 = ty;
                break _t7142;
              }
              if (_t7140._tag === 0) {
                _t7141 = Typechecker$error(((__dict_Show_string.show(mname) + " is not a method of class ") + __dict_Show_string.show(class_name_7100)));
                break _t7142;
              }
              _match_fail("line 16629");
            }
            const method_schema_ty_7143 = _t7141;
            const concrete_method_ty_7145 = Typechecker$subst_tgens(check_tys_7120, method_schema_ty_7143);
            const max_tgen_7147 = Typechecker$max_tgen_in_ty(concrete_method_ty_7145);
            const max_effgen_7149 = Typechecker$max_effgen_in_ty(concrete_method_ty_7145);
            let _t7151;
            if ((max_tgen_7147 >= 0)) {
              _t7151 = (max_tgen_7147 + 1);
            } else {
              _t7151 = 0;
            }
            const quant_7152 = _t7151;
            let _t7154;
            if ((max_effgen_7149 >= 0)) {
              _t7154 = (max_effgen_7149 + 1);
            } else {
              _t7154 = 0;
            }
            const equant_7155 = _t7154;
            let _t7157;
            if (((quant_7152 > 0) || (equant_7155 > 0))) {
              _t7157 = Types$instantiate((level + 1), ({body: concrete_method_ty_7145, constraints: null, equant: equant_7155, pvquant: 0, quant: quant_7152, record_evidences: null, rquant: 0}));
            } else {
              _t7157 = concrete_method_ty_7145;
            }
            const concrete_method_ty_7158 = _t7157;
            const full_body_7160 = Typechecker$wrap_params_decl(params, ({_tag: 0, _name: "None"}), body);
            const te_7162 = Typechecker$check(ctx, (level + 1), full_body_7160, concrete_method_ty_7158);
            const _t7163 = [mname, te_7162];
            const _t7161 = _t7163;
            const _t7159 = _t7161;
            const _t7156 = _t7159;
            const _t7153 = _t7156;
            const _t7150 = _t7153;
            const _t7148 = _t7150;
            const _t7146 = _t7148;
            const _t7144 = _t7146;
            _t7138 = _t7144;
            break _t7139;
          }
          _match_fail("line 16629");
        }
        return _t7138;
      }
      const typed_methods_7164 = List$map(_t7136, methods);
      function _t7166(__p218, __p219) {
        let _t7168;
        const _t7167 = __p218;
        _t7169: {
          if (true) {
            const a = _t7167[0];
            let _t7171;
            const _t7170 = __p219;
            _t7172: {
              if (true) {
                const b = _t7170[0];
                _t7171 = String$compare(a, b);
                break _t7172;
              }
              _match_fail("line 16629");
            }
            _t7168 = _t7171;
            break _t7169;
          }
          _match_fail("line 16629");
        }
        return _t7168;
      }
      const sorted_methods_7173 = List$sort(_t7166, typed_methods_7164);
      function _t7175(__p220) {
        let _t7177;
        const _t7176 = __p220;
        _t7178: {
          if (true) {
            const n = _t7176[0];
            const te = _t7176[1];
            _t7177 = [n, te.ty];
            break _t7178;
          }
          _match_fail("line 16629");
        }
        return _t7177;
      }
      const record_ty_7179 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(List$map(_t7175, sorted_methods_7173))});
      const dict_expr_7181 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: sorted_methods_7173}), record_ty_7179);
      function _t7183(__p221) {
        let _t7185;
        const _t7184 = __p221;
        _t7186: {
          if (true) {
            const cclass = _t7184[0];
            const tyvar_names = _t7184[1];
            const cclass_7187 = Typechecker$resolve_type_alias(ctx.type_env, cclass);
            function _t7189(tvname) {
              let _t7191;
              const _t7190 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, inst_tvars, tvname]);
              _t7192: {
                if (_t7190._tag === 1) {
                  const idx = _t7190._val;
                  _t7191 = ({_tag: 0, _name: "CATGen", _val: idx});
                  break _t7192;
                }
                if (_t7190._tag === 0) {
                  _t7191 = Typechecker$error((("constraint type variable '" + __dict_Show_string.show(tvname)) + " not found in instance type parameters"));
                  break _t7192;
                }
                _match_fail("line 16629");
              }
              return _t7191;
            }
            const cc_args_7193 = List$map(_t7189, tyvar_names);
            const _t7194 = ({cc_args: cc_args_7193, cc_class: cclass_7187});
            const _t7188 = _t7194;
            _t7185 = _t7188;
            break _t7186;
          }
          _match_fail("line 16629");
        }
        return _t7185;
      }
      const inst_constraints_7195 = List$map(_t7183, constraints);
      const inst_def_7197 = ({inst_class: class_name_7100, inst_constraints: inst_constraints_7195, inst_dict_name: dname_7114, inst_tys: stored_tys});
      const _t7199 = (function() {
        const _t7200 = _h;
        _h = Object.assign({}, _t7200, {
          "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
        });
        try {
          const __x_7201 = Types$check_fundep_consistency(class_def_7106, inst_def_7197, ctx.type_env.instances);
          return __x_7201;
        } catch (_exc) {
          if (_exc && _exc._e === "unify_error") {
            const msg = _exc._v;
            return Typechecker$error(msg);
          } else { throw _exc; }
        } finally { _h = _t7200; }
      })();
      _t7199;
      const __rec_upd_7202 = ctx.type_env;
      const _t7203 = ({classes: __rec_upd_7202.classes, constructors: __rec_upd_7202.constructors, effects: __rec_upd_7202.effects, hidden_ctor_types: __rec_upd_7202.hidden_ctor_types, hidden_types: __rec_upd_7202.hidden_types, instances: ({_hd: inst_def_7197, _tl: ctx.type_env.instances}), modules: __rec_upd_7202.modules, mutable_fields: __rec_upd_7202.mutable_fields, newtypes: __rec_upd_7202.newtypes, records: __rec_upd_7202.records, type_aliases: __rec_upd_7202.type_aliases, type_synonyms: __rec_upd_7202.type_synonyms, variants: __rec_upd_7202.variants});
      const type_env_7204 = _t7203;
      const __rec_upd_7206 = ctx;
      const _t7207 = ({constraint_tvars: __rec_upd_7206.constraint_tvars, current_eff: __rec_upd_7206.current_eff, current_module: __rec_upd_7206.current_module, inside_handler: __rec_upd_7206.inside_handler, loop_info: __rec_upd_7206.loop_info, mutable_vars: __rec_upd_7206.mutable_vars, return_type: __rec_upd_7206.return_type, return_used: __rec_upd_7206.return_used, type_env: type_env_7204, vars: __rec_upd_7206.vars});
      const ctx_7208 = _t7207;
      const _t7209 = [ctx_7208, ({_tag: 0, _name: "TDLet", _val: [dname_7114, dict_expr_7181]})];
      const _t7205 = _t7209;
      const _t7198 = _t7205;
      const _t7196 = _t7198;
      const _t7182 = _t7196;
      const _t7180 = _t7182;
      const _t7174 = _t7180;
      const _t7165 = _t7174;
      const _t7121 = _t7165;
      const _t7118 = _t7121;
      const _t7115 = _t7118;
      _t7111 = _t7115;
      break _t7112;
    }
    _match_fail("line 16629");
  }
  const _t7109 = _t7111;
  const _t7107 = _t7109;
  const _t7101 = _t7107;
  return _t7101;
}
function Typechecker$extract_tyvar_ids(annot, ty) {
  let _t7211;
  const _t7210 = Hashtbl$create(4);
  _t7212: {
    if (true) {
      const mapping = _t7210;
      function walk(annot, ty) {
        while (true) {
          let _t7214;
          const _t7213 = [annot, Types$repr(ty)];
          _t7215: {
            if (_t7213[0]._tag === 1 && _t7213[1]._tag === 15 && _t7213[1]._val.contents._tag === 0) {
              const name = _t7213[0]._val;
              const id = _t7213[1]._val.contents._val[0];
              let _t7216;
              if ((!_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, mapping, name]))) {
                _t7216 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, mapping, name, id]);
              } else {
                _t7216 = undefined;
              }
              _t7214 = _t7216;
              break _t7215;
            }
            if (_t7213[0]._tag === 2 && (_t7213[1]._tag === 7 || _t7213[1]._tag === 8)) {
              const a1 = _t7213[0]._val[0];
              const a2 = _t7213[0]._val[1];
              const t1 = _t7213[1]._val[0];
              const t2 = _t7213[1]._val[2];
              walk(a1, t1);
              const _t7217 = a2;
              const _t7218 = t2;
              annot = _t7217;
              ty = _t7218;
              continue;
              _t7214 = undefined;
              break _t7215;
            }
            if (_t7213[0]._tag === 6 && _t7213[1]._tag === 9) {
              const anns = _t7213[0]._val;
              const tys = _t7213[1]._val;
              if ((List$length(anns) === List$length(tys))) {
                _t7214 = List$iter2(walk, anns, tys);
                break _t7215;
              }
            }
            if (_t7213[0]._tag === 4 && _t7213[1]._tag === 10) {
              const a = _t7213[0]._val;
              const t = _t7213[1]._val;
              const _t7219 = a;
              const _t7220 = t;
              annot = _t7219;
              ty = _t7220;
              continue;
              _t7214 = undefined;
              break _t7215;
            }
            if (_t7213[0]._tag === 5 && _t7213[1]._tag === 13) {
              const a = _t7213[0]._val;
              const t = _t7213[1]._val;
              const _t7221 = a;
              const _t7222 = t;
              annot = _t7221;
              ty = _t7222;
              continue;
              _t7214 = undefined;
              break _t7215;
            }
            if (_t7213[0]._tag === 7 && _t7213[1]._tag === 12) {
              const args = _t7213[0]._val[0];
              const tys = _t7213[1]._val[1];
              if ((List$length(args) === List$length(tys))) {
                _t7214 = List$iter2(walk, args, tys);
                break _t7215;
              }
            }
            if (_t7213[0]._tag === 10) {
              const a = _t7213[0]._val[0];
              const _t7223 = a;
              const _t7224 = ty;
              annot = _t7223;
              ty = _t7224;
              continue;
              _t7214 = undefined;
              break _t7215;
            }
            if (true) {
              _t7214 = undefined;
              break _t7215;
            }
            _match_fail("line 16629");
          }
          return _t7214;
        }
      }
      walk(annot, ty);
      const _t7225 = mapping;
      _t7211 = _t7225;
      break _t7212;
    }
    _match_fail("line 16629");
  }
  return _t7211;
}
function Typechecker$resolve_let_constraints(type_env, level, constraints, params, ret_annot, te_ty, shared_tvars) {
  let _t7226;
  if (_eq(constraints, null)) {
    _t7226 = Types$generalize(level, te_ty);
  } else {
    let _t7228;
    const _t7227 = Hashtbl$create(4);
    _t7229: {
      if (true) {
        const name_to_tvar = _t7227;
        function _t7230(tbl) {
          function _t7231(k, v) {
            let _t7232;
            if ((!_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, name_to_tvar, k]))) {
              _t7232 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, name_to_tvar, k, v]);
            } else {
              _t7232 = undefined;
            }
            return _t7232;
          }
          return Hashtbl$iter(_t7231, tbl);
        }
        const merge_into_7233 = _t7230;
        function walk_params(params, ty) {
          while (true) {
            let _t7236;
            const _t7235 = [params, Types$repr(ty)];
            _t7237: {
              if (_t7235[0] !== null && (_t7235[1]._tag === 7 || _t7235[1]._tag === 8)) {
                const p = _t7235[0]._hd;
                const rest = _t7235[0]._tl;
                const param_ty = _t7235[1]._val[0];
                const ret_ty = _t7235[1]._val[2];
                let _t7239;
                const _t7238 = p.annot;
                _t7240: {
                  if (_t7238._tag === 1) {
                    const annot = _t7238._val;
                    _t7239 = merge_into_7233(Typechecker$extract_tyvar_ids(annot, param_ty));
                    break _t7240;
                  }
                  if (_t7238._tag === 0) {
                    _t7239 = undefined;
                    break _t7240;
                  }
                  _match_fail("line 16629");
                }
                _t7239;
                const _t7241 = rest;
                const _t7242 = ret_ty;
                params = _t7241;
                ty = _t7242;
                continue;
                _t7236 = undefined;
                break _t7237;
              }
              if (true) {
                _t7236 = undefined;
                break _t7237;
              }
              _match_fail("line 16629");
            }
            return _t7236;
          }
        }
        walk_params(params, te_ty);
        let _t7245;
        const _t7244 = ret_annot;
        _t7246: {
          if (_t7244._tag === 1) {
            const annot = _t7244._val;
            function skip_arrows(ty, n) {
              while (true) {
                let _t7247;
                if ((n === 0)) {
                  _t7247 = ty;
                } else {
                  let _t7249;
                  const _t7248 = Types$repr(ty);
                  _t7250: {
                    if ((_t7248._tag === 7 || _t7248._tag === 8)) {
                      const rest = _t7248._val[2];
                      const _t7251 = rest;
                      const _t7252 = (n - 1);
                      ty = _t7251;
                      n = _t7252;
                      continue;
                      _t7249 = undefined;
                      break _t7250;
                    }
                    if (true) {
                      _t7249 = ty;
                      break _t7250;
                    }
                    _match_fail("line 16629");
                  }
                  _t7247 = _t7249;
                }
                return _t7247;
              }
            }
            const ret_ty_7254 = skip_arrows(te_ty, List$length(params));
            const _t7255 = merge_into_7233(Typechecker$extract_tyvar_ids(annot, ret_ty_7254));
            const _t7253 = _t7255;
            _t7245 = _t7253;
            break _t7246;
          }
          if (_t7244._tag === 0) {
            _t7245 = undefined;
            break _t7246;
          }
          _match_fail("line 16629");
        }
        _t7245;
        let _t7257;
        const _t7256 = Types$generalize_with_map(level, te_ty);
        _t7258: {
          if (true) {
            const scheme = _t7256[0];
            const id_map = _t7256[1];
            const phantom_counter_7259 = Ref$create(scheme.quant);
            const phantom_map_7261 = Hashtbl$create(4);
            function _t7263(__p222) {
              let _t7265;
              const _t7264 = __p222;
              _t7266: {
                if (true) {
                  const cclass = _t7264[0];
                  const tyvar_names = _t7264[1];
                  const cclass_7267 = Typechecker$resolve_type_alias(type_env, cclass);
                  function _t7269(tvname) {
                    let _t7271;
                    const _t7270 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, name_to_tvar, tvname]);
                    _t7272: {
                      if (_t7270._tag === 1) {
                        const tvar_id = _t7270._val;
                        let _t7274;
                        const _t7273 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, tvar_id]);
                        _t7275: {
                          if (_t7273._tag === 1 && _t7273._val._tag === 16) {
                            const idx = _t7273._val._val;
                            _t7274 = ({_tag: 0, _name: "CATGen", _val: idx});
                            break _t7275;
                          }
                          if (true) {
                            _t7274 = Typechecker$error((("constraint type variable '" + __dict_Show_string.show(tvname)) + " is not polymorphic"));
                            break _t7275;
                          }
                          _match_fail("line 16629");
                        }
                        _t7271 = _t7274;
                        break _t7272;
                      }
                      if (_t7270._tag === 0) {
                        let _t7277;
                        const _t7276 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, shared_tvars, tvname]);
                        _t7278: {
                          if (_t7276._tag === 1) {
                            const tv = _t7276._val;
                            let _t7280;
                            const _t7279 = Types$repr(tv);
                            _t7281: {
                              if (_t7279._tag === 15 && _t7279._val.contents._tag === 0) {
                                const id = _t7279._val.contents._val[0];
                                _t7280 = ({_tag: 1, _name: "Some", _val: id});
                                break _t7281;
                              }
                              if (true) {
                                _t7280 = ({_tag: 0, _name: "None"});
                                break _t7281;
                              }
                              _match_fail("line 16629");
                            }
                            const tv_id_7282 = _t7280;
                            let _t7285;
                            const _t7284 = tv_id_7282;
                            _t7286: {
                              if (_t7284._tag === 1) {
                                const id = _t7284._val;
                                _t7285 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, id]);
                                break _t7286;
                              }
                              if (_t7284._tag === 0) {
                                _t7285 = ({_tag: 0, _name: "None"});
                                break _t7286;
                              }
                              _match_fail("line 16629");
                            }
                            const tgen_from_map_7287 = _t7285;
                            let _t7290;
                            const _t7289 = tgen_from_map_7287;
                            _t7291: {
                              if (_t7289._tag === 1 && _t7289._val._tag === 16) {
                                const idx = _t7289._val._val;
                                _t7290 = ({_tag: 0, _name: "CATGen", _val: idx});
                                break _t7291;
                              }
                              if (true) {
                                let _t7293;
                                const _t7292 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, phantom_map_7261, tvname]);
                                _t7294: {
                                  if (_t7292._tag === 1) {
                                    const idx = _t7292._val;
                                    _t7293 = idx;
                                    break _t7294;
                                  }
                                  if (_t7292._tag === 0) {
                                    const idx_7295 = Ref$get(phantom_counter_7259);
                                    Ref$set(phantom_counter_7259, (Ref$get(phantom_counter_7259) + 1));
                                    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, phantom_map_7261, tvname, idx_7295]);
                                    const _t7296 = idx_7295;
                                    _t7293 = _t7296;
                                    break _t7294;
                                  }
                                  _match_fail("line 16629");
                                }
                                const idx_7297 = _t7293;
                                const _t7298 = ({_tag: 3, _name: "CAPhantom", _val: [idx_7297, tv]});
                                _t7290 = _t7298;
                                break _t7291;
                              }
                              _match_fail("line 16629");
                            }
                            const _t7288 = _t7290;
                            const _t7283 = _t7288;
                            _t7277 = _t7283;
                            break _t7278;
                          }
                          if (_t7276._tag === 0) {
                            _t7277 = Typechecker$error((("constraint type variable '" + __dict_Show_string.show(tvname)) + " not found in function signature"));
                            break _t7278;
                          }
                          _match_fail("line 16629");
                        }
                        _t7271 = _t7277;
                        break _t7272;
                      }
                      _match_fail("line 16629");
                    }
                    return _t7271;
                  }
                  const cc_args_7299 = List$map(_t7269, tyvar_names);
                  const _t7300 = ({cc_args: cc_args_7299, cc_class: cclass_7267});
                  const _t7268 = _t7300;
                  _t7265 = _t7268;
                  break _t7266;
                }
                _match_fail("line 16629");
              }
              return _t7265;
            }
            const cc_list_7301 = List$map(_t7263, constraints);
            const __rec_upd_7303 = scheme;
            const _t7304 = ({body: __rec_upd_7303.body, constraints: cc_list_7301, equant: __rec_upd_7303.equant, pvquant: __rec_upd_7303.pvquant, quant: __rec_upd_7303.quant, record_evidences: __rec_upd_7303.record_evidences, rquant: __rec_upd_7303.rquant});
            const _t7302 = _t7304;
            const _t7262 = _t7302;
            const _t7260 = _t7262;
            _t7257 = _t7260;
            break _t7258;
          }
          _match_fail("line 16629");
        }
        const _t7243 = _t7257;
        const _t7234 = _t7243;
        _t7228 = _t7234;
        break _t7229;
      }
      _match_fail("line 16629");
    }
    _t7226 = _t7228;
  }
  return _t7226;
}
function Typechecker$unify_constraint_tvars(__dict_Hash_0, __dict_Eq_0, type_env, constraints, shared_tvars, body_te) {
  const classes_7305 = type_env.classes;
  function walk(te) {
    let _t7308;
    const _t7307 = te.expr;
    _t7309: {
      if (_t7307._tag === 7) {
        const name = _t7307._val;
        let _t7311;
        const _t7310 = Types$find_method_class(classes_7305, name);
        _t7312: {
          if (_t7310._tag === 1) {
            const r = _t7310;
            _t7311 = r;
            break _t7312;
          }
          if (_t7310._tag === 0) {
            let _t7314;
            const _t7313 = String$rindex_opt(name, 46);
            _t7315: {
              if (_t7313._tag === 0) {
                _t7314 = ({_tag: 0, _name: "None"});
                break _t7315;
              }
              if (_t7313._tag === 1) {
                const i = _t7313._val;
                const _mml$short_7316 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                const _t7317 = Types$find_method_class(classes_7305, _mml$short_7316);
                _t7314 = _t7317;
                break _t7315;
              }
              _match_fail("line 16629");
            }
            _t7311 = _t7314;
            break _t7312;
          }
          _match_fail("line 16629");
        }
        const class_opt_7318 = _t7311;
        let _t7321;
        const _t7320 = class_opt_7318;
        _t7322: {
          if (_t7320._tag === 1) {
            const class_def = _t7320._val;
            let _t7324;
            const _t7323 = String$rindex_opt(name, 46);
            _t7325: {
              if (_t7323._tag === 1) {
                const i = _t7323._val;
                _t7324 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                break _t7325;
              }
              if (_t7323._tag === 0) {
                _t7324 = name;
                break _t7325;
              }
              _match_fail("line 16629");
            }
            const method_name_7326 = _t7324;
            let _t7329;
            const _t7328 = List$assoc_opt(method_name_7326, class_def.class_methods);
            _t7330: {
              if (_t7328._tag === 1) {
                const method_schema_ty = _t7328._val;
                const num_params_7331 = List$length(class_def.class_params);
                const param_map_7333 = Hashtbl$create(num_params_7331);
                function go(s, r) {
                  while (true) {
                    const r_7335 = Types$repr(r);
                    let _t7338;
                    const _t7337 = [s, r_7335];
                    _t7339: {
                      if (_t7337[0]._tag === 16) {
                        const i = _t7337[0]._val;
                        if ((i < num_params_7331)) {
                          let _t7340;
                          if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, param_map_7333, i]))) {
                            _t7340 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, param_map_7333, i, r_7335]);
                          } else {
                            _t7340 = undefined;
                          }
                          _t7338 = _t7340;
                          break _t7339;
                        }
                      }
                      if ((_t7337[0]._tag === 7 && _t7337[1]._tag === 7 || _t7337[0]._tag === 8 && _t7337[1]._tag === 8)) {
                        const s1 = _t7337[0]._val[0];
                        const s2 = _t7337[0]._val[2];
                        const r1 = _t7337[1]._val[0];
                        const r2 = _t7337[1]._val[2];
                        go(s1, r1);
                        const _t7341 = s2;
                        const _t7342 = r2;
                        s = _t7341;
                        r = _t7342;
                        continue;
                        _t7338 = undefined;
                        break _t7339;
                      }
                      if (_t7337[0]._tag === 9 && _t7337[1]._tag === 9) {
                        const ss = _t7337[0]._val;
                        const rs = _t7337[1]._val;
                        if ((List$length(ss) === List$length(rs))) {
                          _t7338 = List$iter2(go, ss, rs);
                          break _t7339;
                        }
                      }
                      if (_t7337[0]._tag === 10 && _t7337[1]._tag === 10) {
                        const s1 = _t7337[0]._val;
                        const r1 = _t7337[1]._val;
                        const _t7343 = s1;
                        const _t7344 = r1;
                        s = _t7343;
                        r = _t7344;
                        continue;
                        _t7338 = undefined;
                        break _t7339;
                      }
                      if (_t7337[0]._tag === 13 && _t7337[1]._tag === 13) {
                        const s1 = _t7337[0]._val;
                        const r1 = _t7337[1]._val;
                        const _t7345 = s1;
                        const _t7346 = r1;
                        s = _t7345;
                        r = _t7346;
                        continue;
                        _t7338 = undefined;
                        break _t7339;
                      }
                      if (_t7337[0]._tag === 12 && _t7337[1]._tag === 12) {
                        const ss = _t7337[0]._val[1];
                        const rs = _t7337[1]._val[1];
                        if ((List$length(ss) === List$length(rs))) {
                          _t7338 = List$iter2(go, ss, rs);
                          break _t7339;
                        }
                      }
                      if (true) {
                        _t7338 = undefined;
                        break _t7339;
                      }
                      _match_fail("line 16629");
                    }
                    const _t7336 = _t7338;
                    return _t7336;
                  }
                }
                go(method_schema_ty, te.ty);
                function _t7348(__p223) {
                  let _t7350;
                  const _t7349 = __p223;
                  _t7351: {
                    if (true) {
                      const cclass = _t7349[0];
                      const tyvar_names = _t7349[1];
                      let _t7352;
                      if (((cclass === class_def.class_name) && (List$length(tyvar_names) === num_params_7331))) {
                        function _t7353(fd) {
                          function _t7354(fi) {
                            let _t7356;
                            const _t7355 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, param_map_7333, fi]);
                            _t7357: {
                              if (_t7355._tag === 1) {
                                const body_tv = _t7355._val;
                                const tvname_7358 = List$nth(tyvar_names, fi);
                                let _t7361;
                                const _t7360 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, shared_tvars, tvname_7358]);
                                _t7362: {
                                  if (_t7360._tag === 1) {
                                    const constraint_tv = _t7360._val;
                                    _t7361 = _eq(Types$repr(body_tv), Types$repr(constraint_tv));
                                    break _t7362;
                                  }
                                  if (_t7360._tag === 0) {
                                    _t7361 = true;
                                    break _t7362;
                                  }
                                  _match_fail("line 16629");
                                }
                                const _t7359 = _t7361;
                                _t7356 = _t7359;
                                break _t7357;
                              }
                              if (_t7355._tag === 0) {
                                _t7356 = true;
                                break _t7357;
                              }
                              _match_fail("line 16629");
                            }
                            return _t7356;
                          }
                          return List$forall(_t7354, fd.fd_from);
                        }
                        const from_match_7363 = List$forall(_t7353, class_def.class_fundeps);
                        let _t7365;
                        if (from_match_7363) {
                          function _t7366(fd) {
                            function _t7367(ti) {
                              let _t7369;
                              const _t7368 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, param_map_7333, ti]);
                              _t7370: {
                                if (_t7368._tag === 1) {
                                  const body_tv = _t7368._val;
                                  const tvname_7371 = List$nth(tyvar_names, ti);
                                  let _t7374;
                                  const _t7373 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, shared_tvars, tvname_7371]);
                                  _t7375: {
                                    if (_t7373._tag === 1) {
                                      const constraint_tv = _t7373._val;
                                      _t7374 = Types$unify(body_tv, constraint_tv);
                                      break _t7375;
                                    }
                                    if (_t7373._tag === 0) {
                                      _t7374 = undefined;
                                      break _t7375;
                                    }
                                    _match_fail("line 16629");
                                  }
                                  const _t7372 = _t7374;
                                  _t7369 = _t7372;
                                  break _t7370;
                                }
                                if (_t7368._tag === 0) {
                                  _t7369 = undefined;
                                  break _t7370;
                                }
                                _match_fail("line 16629");
                              }
                              return _t7369;
                            }
                            return List$iter(_t7367, fd.fd_to);
                          }
                          _t7365 = List$iter(_t7366, class_def.class_fundeps);
                        } else {
                          _t7365 = undefined;
                        }
                        const _t7364 = _t7365;
                        _t7352 = _t7364;
                      } else {
                        _t7352 = undefined;
                      }
                      _t7350 = _t7352;
                      break _t7351;
                    }
                    _match_fail("line 16629");
                  }
                  return _t7350;
                }
                const _t7347 = List$iter(_t7348, constraints);
                const _t7334 = _t7347;
                const _t7332 = _t7334;
                _t7329 = _t7332;
                break _t7330;
              }
              if (_t7328._tag === 0) {
                _t7329 = undefined;
                break _t7330;
              }
              _match_fail("line 16629");
            }
            const _t7327 = _t7329;
            _t7321 = _t7327;
            break _t7322;
          }
          if (_t7320._tag === 0) {
            _t7321 = undefined;
            break _t7322;
          }
          _match_fail("line 16629");
        }
        const _t7319 = _t7321;
        _t7308 = _t7319;
        break _t7309;
      }
      if (_t7307._tag === 11) {
        const f = _t7307._val[0];
        const x = _t7307._val[1];
        walk(f);
        _t7308 = walk(x);
        break _t7309;
      }
      if (_t7307._tag === 10) {
        const body = _t7307._val[1];
        _t7308 = walk(body);
        break _t7309;
      }
      if (_t7307._tag === 8) {
        const e1 = _t7307._val[2];
        const e2 = _t7307._val[3];
        walk(e1);
        _t7308 = walk(e2);
        break _t7309;
      }
      if (_t7307._tag === 9) {
        const e1 = _t7307._val[2];
        const e2 = _t7307._val[3];
        walk(e1);
        _t7308 = walk(e2);
        break _t7309;
      }
      if (_t7307._tag === 12) {
        const c = _t7307._val[0];
        const t = _t7307._val[1];
        const e = _t7307._val[2];
        walk(c);
        walk(t);
        _t7308 = walk(e);
        break _t7309;
      }
      if (_t7307._tag === 13) {
        const a = _t7307._val[1];
        const b = _t7307._val[2];
        walk(a);
        _t7308 = walk(b);
        break _t7309;
      }
      if (_t7307._tag === 14) {
        const a = _t7307._val[1];
        _t7308 = walk(a);
        break _t7309;
      }
      if (_t7307._tag === 15) {
        const es = _t7307._val;
        _t7308 = List$iter(walk, es);
        break _t7309;
      }
      if (_t7307._tag === 16) {
        const fields = _t7307._val;
        function _t7376(__p224) {
          let _t7378;
          const _t7377 = __p224;
          _t7379: {
            if (true) {
              const e = _t7377[1];
              _t7378 = walk(e);
              break _t7379;
            }
            _match_fail("line 16629");
          }
          return _t7378;
        }
        _t7308 = List$iter(_t7376, fields);
        break _t7309;
      }
      if (_t7307._tag === 17) {
        const e = _t7307._val[0];
        const fields = _t7307._val[1];
        walk(e);
        function _t7380(__p225) {
          let _t7382;
          const _t7381 = __p225;
          _t7383: {
            if (true) {
              const e = _t7381[1];
              _t7382 = walk(e);
              break _t7383;
            }
            _match_fail("line 16629");
          }
          return _t7382;
        }
        _t7308 = List$iter(_t7380, fields);
        break _t7309;
      }
      if (_t7307._tag === 18) {
        const e = _t7307._val[0];
        const pairs = _t7307._val[1];
        walk(e);
        function _t7384(__p226) {
          let _t7386;
          const _t7385 = __p226;
          _t7387: {
            if (true) {
              const i = _t7385[0];
              const v = _t7385[1];
              walk(i);
              _t7386 = walk(v);
              break _t7387;
            }
            _match_fail("line 16629");
          }
          return _t7386;
        }
        _t7308 = List$iter(_t7384, pairs);
        break _t7309;
      }
      if (_t7307._tag === 19) {
        const e = _t7307._val[0];
        _t7308 = walk(e);
        break _t7309;
      }
      if (_t7307._tag === 20) {
        const e1 = _t7307._val[0];
        const e2 = _t7307._val[1];
        walk(e1);
        _t7308 = walk(e2);
        break _t7309;
      }
      if (_t7307._tag === 21) {
        const hd = _t7307._val[0];
        const tl = _t7307._val[1];
        walk(hd);
        _t7308 = walk(tl);
        break _t7309;
      }
      if (_t7307._tag === 24) {
        const scrut = _t7307._val[0];
        const branches = _t7307._val[1];
        walk(scrut);
        function _t7388(__p227) {
          let _t7390;
          const _t7389 = __p227;
          _t7391: {
            if (true) {
              const guard = _t7389[1];
              const body = _t7389[2];
              let _t7393;
              const _t7392 = guard;
              _t7394: {
                if (_t7392._tag === 1) {
                  const g = _t7392._val;
                  _t7393 = walk(g);
                  break _t7394;
                }
                if (_t7392._tag === 0) {
                  _t7393 = undefined;
                  break _t7394;
                }
                _match_fail("line 16629");
              }
              _t7393;
              _t7390 = walk(body);
              break _t7391;
            }
            _match_fail("line 16629");
          }
          return _t7390;
        }
        _t7308 = List$iter(_t7388, branches);
        break _t7309;
      }
      if (_t7307._tag === 28) {
        const e1 = _t7307._val[0];
        const e2 = _t7307._val[1];
        walk(e1);
        _t7308 = walk(e2);
        break _t7309;
      }
      if (_t7307._tag === 25) {
        const e1 = _t7307._val[1];
        const e2 = _t7307._val[2];
        walk(e1);
        _t7308 = walk(e2);
        break _t7309;
      }
      if (_t7307._tag === 26) {
        const e = _t7307._val[1];
        _t7308 = walk(e);
        break _t7309;
      }
      if (_t7307._tag === 27) {
        const e1 = _t7307._val[0];
        const e2 = _t7307._val[2];
        walk(e1);
        _t7308 = walk(e2);
        break _t7309;
      }
      if (_t7307._tag === 23 && _t7307._val[1]._tag === 1) {
        const e = _t7307._val[1]._val;
        _t7308 = walk(e);
        break _t7309;
      }
      if (_t7307._tag === 29) {
        const e = _t7307._val[1];
        _t7308 = walk(e);
        break _t7309;
      }
      if (_t7307._tag === 30) {
        const body = _t7307._val[0];
        _t7308 = walk(body);
        break _t7309;
      }
      if (_t7307._tag === 31) {
        const e1 = _t7307._val[0];
        const e2 = _t7307._val[1];
        walk(e1);
        _t7308 = walk(e2);
        break _t7309;
      }
      if (_t7307._tag === 32) {
        const cond = _t7307._val[0];
        const body = _t7307._val[1];
        walk(cond);
        _t7308 = walk(body);
        break _t7309;
      }
      if (_t7307._tag === 36) {
        const body = _t7307._val;
        _t7308 = walk(body);
        break _t7309;
      }
      if (_t7307._tag === 38) {
        const es = _t7307._val;
        _t7308 = List$iter(walk, es);
        break _t7309;
      }
      if (_t7307._tag === 39) {
        const e = _t7307._val;
        _t7308 = walk(e);
        break _t7309;
      }
      if (_t7307._tag === 33) {
        const e = _t7307._val;
        _t7308 = walk(e);
        break _t7309;
      }
      if (_t7307._tag === 35) {
        const e = _t7307._val;
        _t7308 = walk(e);
        break _t7309;
      }
      if (_t7307._tag === 37) {
        const bindings = _t7307._val[0];
        const body = _t7307._val[1];
        function _t7395(__p228) {
          let _t7397;
          const _t7396 = __p228;
          _t7398: {
            if (true) {
              const e = _t7396[1];
              _t7397 = walk(e);
              break _t7398;
            }
            _match_fail("line 16629");
          }
          return _t7397;
        }
        List$iter(_t7395, bindings);
        _t7308 = walk(body);
        break _t7309;
      }
      if (true) {
        _t7308 = undefined;
        break _t7309;
      }
      _match_fail("line 16629");
    }
    return _t7308;
  }
  const _t7399 = walk(body_te);
  const _t7306 = _t7399;
  return _t7306;
}
function Typechecker$synth_constrained_fn(ctx, level, constraints, params, ret_annot, body) {
  const shared_tvars_7400 = Hashtbl$create(4);
  function _t7402(__p229) {
    let _t7404;
    const _t7403 = __p229;
    _t7405: {
      if (true) {
        const names = _t7403[1];
        _t7404 = names;
        break _t7405;
      }
      _match_fail("line 16629");
    }
    return _t7404;
  }
  const constraint_tyvar_names_7406 = _call(_call(List$sort_uniq, [String$compare]), [List$flatten(List$map(_t7402, constraints))]);
  function _t7408(tvname) {
    return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_7400, tvname, Types$new_tvar((level + 1))]);
  }
  List$iter(_t7408, constraint_tyvar_names_7406);
  function _t7409(tvname) {
    let _t7411;
    const _t7410 = Types$repr(_call(Hashtbl$find, [__dict_Hash_string, __dict_Eq_string, shared_tvars_7400, tvname]));
    _t7412: {
      if (_t7410._tag === 15 && _t7410._val.contents._tag === 0) {
        const id = _t7410._val.contents._val[0];
        _t7411 = ({_tag: 1, _name: "Some", _val: id});
        break _t7412;
      }
      if (true) {
        _t7411 = ({_tag: 0, _name: "None"});
        break _t7412;
      }
      _match_fail("line 16629");
    }
    return _t7411;
  }
  const constraint_tvar_ids_7413 = List$filter_map(_t7409, constraint_tyvar_names_7406);
  function _t7415(p) {
    let _t7417;
    const _t7416 = p.annot;
    _t7418: {
      if (_t7416._tag === 1) {
        const annot = _t7416._val;
        _t7417 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_7400, annot);
        break _t7418;
      }
      if (_t7416._tag === 0) {
        _t7417 = Types$new_tvar((level + 1));
        break _t7418;
      }
      _match_fail("line 16629");
    }
    return _t7417;
  }
  const param_tys_7419 = List$map(_t7415, params);
  let _t7422;
  const _t7421 = ret_annot;
  _t7423: {
    if (_t7421._tag === 1) {
      const annot = _t7421._val;
      _t7422 = ({_tag: 1, _name: "Some", _val: Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_7400, annot)});
      break _t7423;
    }
    if (_t7421._tag === 0) {
      _t7422 = ({_tag: 0, _name: "None"});
      break _t7423;
    }
    _match_fail("line 16629");
  }
  const ret_ty_opt_7424 = _t7422;
  const body_eff_7426 = Types$new_effvar((level + 1));
  function _t7428(c, p, ty) {
    return Typechecker$extend_var_mono(c, p.name, ty);
  }
  const __rec_upd_7429 = ctx;
  const _t7430 = ({constraint_tvars: List$concat(constraint_tvar_ids_7413, ctx.constraint_tvars), current_eff: body_eff_7426, current_module: __rec_upd_7429.current_module, inside_handler: __rec_upd_7429.inside_handler, loop_info: __rec_upd_7429.loop_info, mutable_vars: __rec_upd_7429.mutable_vars, return_type: __rec_upd_7429.return_type, return_used: __rec_upd_7429.return_used, type_env: __rec_upd_7429.type_env, vars: __rec_upd_7429.vars});
  const inner_ctx_7431 = List$fold2(_t7428, _t7430, params, param_tys_7419);
  let _t7434;
  const _t7433 = ret_ty_opt_7424;
  _t7435: {
    if (_t7433._tag === 1) {
      const ret_ty = _t7433._val;
      _t7434 = Typechecker$check(inner_ctx_7431, (level + 1), body, ret_ty);
      break _t7435;
    }
    if (_t7433._tag === 0) {
      _t7434 = Typechecker$synth(inner_ctx_7431, (level + 1), body);
      break _t7435;
    }
    _match_fail("line 16629");
  }
  const body_te_7436 = _t7434;
  _call(Typechecker$unify_constraint_tvars, [__dict_Hash_string, __dict_Eq_string, ctx.type_env, constraints, shared_tvars_7400, body_te_7436]);
  let _t7439;
  const _t7438 = [List$rev(params), List$rev(param_tys_7419)];
  _t7440: {
    if (_t7438[0] === null && _t7438[1] === null) {
      _t7439 = body_te_7436;
      break _t7440;
    }
    if (_t7438[0] !== null && _t7438[1] !== null) {
      const last_p = _t7438[0]._hd;
      const rest_ps = _t7438[0]._tl;
      const last_pty = _t7438[1]._hd;
      const rest_ptys = _t7438[1]._tl;
      const inner_7441 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_7436, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff_7426, body_te_7436.ty]}));
      function _t7443(acc, p, pty) {
        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
      }
      const _t7442 = List$fold2(_t7443, inner_7441, rest_ps, rest_ptys);
      _t7439 = _t7442;
      break _t7440;
    }
    if (true) {
      _t7439 = failwith("assert false");
      break _t7440;
    }
    _match_fail("line 16629");
  }
  const te_7444 = _t7439;
  const scheme_7446 = Typechecker$resolve_let_constraints(ctx.type_env, level, constraints, params, ret_annot, te_7444.ty, shared_tvars_7400);
  const _t7447 = [te_7444, scheme_7446];
  const _t7445 = _t7447;
  const _t7437 = _t7445;
  const _t7432 = _t7437;
  const _t7427 = _t7432;
  const _t7425 = _t7427;
  const _t7420 = _t7425;
  const _t7414 = _t7420;
  const _t7407 = _t7414;
  const _t7401 = _t7407;
  return _t7401;
}
function Typechecker$find_module_in_env(type_env, mod_name) {
  let _t7449;
  const _t7448 = String$split(".", mod_name);
  _t7450: {
    if (_t7448 === null) {
      _t7449 = ({_tag: 0, _name: "None"});
      break _t7450;
    }
    if (_t7448 !== null && _t7448._tl === null) {
      const name = _t7448._hd;
      _t7449 = List$assoc_opt(name, type_env.modules);
      break _t7450;
    }
    if (_t7448 !== null) {
      const first = _t7448._hd;
      const rest = _t7448._tl;
      let _t7452;
      const _t7451 = List$assoc_opt(first, type_env.modules);
      _t7453: {
        if (_t7451._tag === 0) {
          _t7452 = ({_tag: 0, _name: "None"});
          break _t7453;
        }
        if (_t7451._tag === 1) {
          const minfo = _t7451._val;
          function drill(mi, __x) {
            while (true) {
              let _t7455;
              const _t7454 = __x;
              _t7456: {
                if (_t7454 === null) {
                  _t7455 = ({_tag: 1, _name: "Some", _val: mi});
                  break _t7456;
                }
                if (_t7454 !== null) {
                  const seg = _t7454._hd;
                  const rest = _t7454._tl;
                  let _t7458;
                  const _t7457 = List$assoc_opt(seg, mi.mod_submodules);
                  _t7459: {
                    if (_t7457._tag === 0) {
                      _t7458 = ({_tag: 0, _name: "None"});
                      break _t7459;
                    }
                    if (_t7457._tag === 1) {
                      const sub = _t7457._val;
                      const _t7460 = sub;
                      const _t7461 = rest;
                      mi = _t7460;
                      __x = _t7461;
                      continue;
                      _t7458 = undefined;
                      break _t7459;
                    }
                    _match_fail("line 16629");
                  }
                  _t7455 = _t7458;
                  break _t7456;
                }
                _match_fail("line 16629");
              }
              return _t7455;
            }
          }
          const _t7462 = drill(minfo, rest);
          _t7452 = _t7462;
          break _t7453;
        }
        _match_fail("line 16629");
      }
      _t7449 = _t7452;
      break _t7450;
    }
    _match_fail("line 16629");
  }
  return _t7449;
}
function Typechecker$open_module_into_ctx(ctx, mod_name, names_opt) {
  let _t7464;
  const _t7463 = Typechecker$find_module_in_env(ctx.type_env, mod_name);
  _t7465: {
    if (_t7463._tag === 0) {
      _t7464 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
      break _t7465;
    }
    if (_t7463._tag === 1) {
      const minfo = _t7463._val;
      function _t7466(name) {
        let _t7468;
        const _t7467 = names_opt;
        _t7469: {
          if (_t7467._tag === 0) {
            _t7468 = true;
            break _t7469;
          }
          if (_t7467._tag === 1) {
            const names = _t7467._val;
            _t7468 = List$mem(name, names);
            break _t7469;
          }
          _match_fail("line 16629");
        }
        return _t7468;
      }
      const filter_7470 = _t7466;
      function _t7472(ctx, __p230) {
        let _t7474;
        const _t7473 = __p230;
        _t7475: {
          if (true) {
            const _mml$short = _t7473[0];
            const scheme = _t7473[1];
            let _t7476;
            if (filter_7470(_mml$short)) {
              let _t7477;
              if (List$mem(_mml$short, minfo.mod_pub_mutable_vars)) {
                _t7477 = Typechecker$extend_var_mutable(ctx, _mml$short, scheme);
              } else {
                _t7477 = Typechecker$extend_var(ctx, _mml$short, scheme);
              }
              _t7476 = _t7477;
            } else {
              _t7476 = ctx;
            }
            _t7474 = _t7476;
            break _t7475;
          }
          _match_fail("line 16629");
        }
        return _t7474;
      }
      const ctx_7478 = List$fold(_t7472, ctx, minfo.mod_pub_vars);
      function _t7480(te, __p231) {
        let _t7482;
        const _t7481 = __p231;
        _t7483: {
          if (true) {
            const _mml$short = _t7481[0];
            const info = _t7481[1];
            let _t7484;
            if (filter_7470(_mml$short)) {
              const __rec_upd_7485 = te;
              const _t7486 = ({classes: __rec_upd_7485.classes, constructors: ({_hd: [_mml$short, info], _tl: te.constructors}), effects: __rec_upd_7485.effects, hidden_ctor_types: __rec_upd_7485.hidden_ctor_types, hidden_types: __rec_upd_7485.hidden_types, instances: __rec_upd_7485.instances, modules: __rec_upd_7485.modules, mutable_fields: __rec_upd_7485.mutable_fields, newtypes: __rec_upd_7485.newtypes, records: __rec_upd_7485.records, type_aliases: __rec_upd_7485.type_aliases, type_synonyms: __rec_upd_7485.type_synonyms, variants: __rec_upd_7485.variants});
              _t7484 = _t7486;
            } else {
              _t7484 = te;
            }
            _t7482 = _t7484;
            break _t7483;
          }
          _match_fail("line 16629");
        }
        return _t7482;
      }
      const type_env_7487 = List$fold(_t7480, ctx_7478.type_env, minfo.mod_pub_constructors);
      function _t7489(te, qname) {
        let _t7491;
        const _t7490 = String$rindex_opt(qname, 46);
        _t7492: {
          if (_t7490._tag === 1) {
            const i = _t7490._val;
            _t7491 = String$sub(qname, (i + 1), ((String$length(qname) - i) - 1));
            break _t7492;
          }
          if (_t7490._tag === 0) {
            _t7491 = qname;
            break _t7492;
          }
          _match_fail("line 16629");
        }
        const _mml$short_7493 = _t7491;
        let _t7495;
        if (filter_7470(_mml$short_7493)) {
          function _t7496(__p232) {
            let _t7498;
            const _t7497 = __p232;
            _t7499: {
              if (true) {
                const n = _t7497[0];
                _t7498 = (n === qname);
                break _t7499;
              }
              _match_fail("line 16629");
            }
            return _t7498;
          }
          let _t7501;
          const _t7500 = List$find(_t7496, te.variants);
          _t7502: {
            if (_t7500._tag === 1) {
              const np = _t7500._val[1];
              const vdef = _t7500._val[2];
              const is_gadt = _t7500._val[3];
              function _t7503(__p233) {
                let _t7505;
                const _t7504 = __p233;
                _t7506: {
                  if (true) {
                    const n = _t7504[0];
                    _t7505 = (n === _mml$short_7493);
                    break _t7506;
                  }
                  _match_fail("line 16629");
                }
                return _t7505;
              }
              let _t7507;
              if (List$exists(_t7503, te.variants)) {
                _t7507 = te;
              } else {
                const __rec_upd_7508 = te;
                const _t7509 = ({classes: __rec_upd_7508.classes, constructors: __rec_upd_7508.constructors, effects: __rec_upd_7508.effects, hidden_ctor_types: __rec_upd_7508.hidden_ctor_types, hidden_types: __rec_upd_7508.hidden_types, instances: __rec_upd_7508.instances, modules: __rec_upd_7508.modules, mutable_fields: __rec_upd_7508.mutable_fields, newtypes: __rec_upd_7508.newtypes, records: __rec_upd_7508.records, type_aliases: __rec_upd_7508.type_aliases, type_synonyms: __rec_upd_7508.type_synonyms, variants: ({_hd: [_mml$short_7493, np, vdef, is_gadt], _tl: te.variants})});
                _t7507 = _t7509;
              }
              _t7501 = _t7507;
              break _t7502;
            }
            if (_t7500._tag === 0) {
              _t7501 = te;
              break _t7502;
            }
            _match_fail("line 16629");
          }
          const te_7510 = _t7501;
          let _t7513;
          const _t7512 = List$assoc_opt(qname, te_7510.records);
          _t7514: {
            if (_t7512._tag === 1) {
              const fields = _t7512._val;
              let _t7515;
              if (!_eq(List$assoc_opt(_mml$short_7493, te_7510.records), ({_tag: 0, _name: "None"}))) {
                _t7515 = te_7510;
              } else {
                const __rec_upd_7516 = te_7510;
                const _t7517 = ({classes: __rec_upd_7516.classes, constructors: __rec_upd_7516.constructors, effects: __rec_upd_7516.effects, hidden_ctor_types: __rec_upd_7516.hidden_ctor_types, hidden_types: __rec_upd_7516.hidden_types, instances: __rec_upd_7516.instances, modules: __rec_upd_7516.modules, mutable_fields: __rec_upd_7516.mutable_fields, newtypes: __rec_upd_7516.newtypes, records: ({_hd: [_mml$short_7493, fields], _tl: te_7510.records}), type_aliases: __rec_upd_7516.type_aliases, type_synonyms: __rec_upd_7516.type_synonyms, variants: __rec_upd_7516.variants});
                _t7515 = _t7517;
              }
              _t7513 = _t7515;
              break _t7514;
            }
            if (_t7512._tag === 0) {
              _t7513 = te_7510;
              break _t7514;
            }
            _match_fail("line 16629");
          }
          const te_7518 = _t7513;
          function _t7520(__p234) {
            let _t7522;
            const _t7521 = __p234;
            _t7523: {
              if (true) {
                const n = _t7521[0];
                _t7522 = (n === qname);
                break _t7523;
              }
              _match_fail("line 16629");
            }
            return _t7522;
          }
          let _t7525;
          const _t7524 = List$find(_t7520, te_7518.type_synonyms);
          _t7526: {
            if (_t7524._tag === 1) {
              const np = _t7524._val[1];
              const expanded = _t7524._val[2];
              function _t7527(__p235) {
                let _t7529;
                const _t7528 = __p235;
                _t7530: {
                  if (true) {
                    const n = _t7528[0];
                    _t7529 = (n === _mml$short_7493);
                    break _t7530;
                  }
                  _match_fail("line 16629");
                }
                return _t7529;
              }
              let _t7531;
              if (List$exists(_t7527, te_7518.type_synonyms)) {
                _t7531 = te_7518;
              } else {
                const __rec_upd_7532 = te_7518;
                const _t7533 = ({classes: __rec_upd_7532.classes, constructors: __rec_upd_7532.constructors, effects: __rec_upd_7532.effects, hidden_ctor_types: __rec_upd_7532.hidden_ctor_types, hidden_types: __rec_upd_7532.hidden_types, instances: __rec_upd_7532.instances, modules: __rec_upd_7532.modules, mutable_fields: __rec_upd_7532.mutable_fields, newtypes: __rec_upd_7532.newtypes, records: __rec_upd_7532.records, type_aliases: __rec_upd_7532.type_aliases, type_synonyms: ({_hd: [_mml$short_7493, np, expanded], _tl: te_7518.type_synonyms}), variants: __rec_upd_7532.variants});
                _t7531 = _t7533;
              }
              _t7525 = _t7531;
              break _t7526;
            }
            if (_t7524._tag === 0) {
              _t7525 = te_7518;
              break _t7526;
            }
            _match_fail("line 16629");
          }
          const te_7534 = _t7525;
          let _t7536;
          if ((_mml$short_7493 === qname)) {
            _t7536 = te_7534;
          } else {
            const __rec_upd_7537 = te_7534;
            const _t7538 = ({classes: __rec_upd_7537.classes, constructors: __rec_upd_7537.constructors, effects: __rec_upd_7537.effects, hidden_ctor_types: __rec_upd_7537.hidden_ctor_types, hidden_types: __rec_upd_7537.hidden_types, instances: __rec_upd_7537.instances, modules: __rec_upd_7537.modules, mutable_fields: __rec_upd_7537.mutable_fields, newtypes: __rec_upd_7537.newtypes, records: __rec_upd_7537.records, type_aliases: ({_hd: [_mml$short_7493, qname], _tl: te_7534.type_aliases}), type_synonyms: __rec_upd_7537.type_synonyms, variants: __rec_upd_7537.variants});
            _t7536 = _t7538;
          }
          const te_7539 = _t7536;
          const _t7540 = te_7539;
          const _t7535 = _t7540;
          const _t7519 = _t7535;
          const _t7511 = _t7519;
          _t7495 = _t7511;
        } else {
          _t7495 = te;
        }
        const _t7494 = _t7495;
        return _t7494;
      }
      const type_env_7541 = List$fold(_t7489, type_env_7487, minfo.mod_pub_types);
      function _t7543(te, qname) {
        let _t7544;
        if (List$mem(qname, te.newtypes)) {
          _t7544 = te;
        } else {
          const __rec_upd_7545 = te;
          const _t7546 = ({classes: __rec_upd_7545.classes, constructors: __rec_upd_7545.constructors, effects: __rec_upd_7545.effects, hidden_ctor_types: __rec_upd_7545.hidden_ctor_types, hidden_types: __rec_upd_7545.hidden_types, instances: __rec_upd_7545.instances, modules: __rec_upd_7545.modules, mutable_fields: __rec_upd_7545.mutable_fields, newtypes: ({_hd: qname, _tl: te.newtypes}), records: __rec_upd_7545.records, type_aliases: __rec_upd_7545.type_aliases, type_synonyms: __rec_upd_7545.type_synonyms, variants: __rec_upd_7545.variants});
          _t7544 = _t7546;
        }
        return _t7544;
      }
      const type_env_7547 = List$fold(_t7543, type_env_7541, minfo.mod_newtypes);
      function _t7549(te, __p236) {
        let _t7551;
        const _t7550 = __p236;
        _t7552: {
          if (true) {
            const sub_name = _t7550[0];
            const sub_info = _t7550[1];
            let _t7553;
            if (filter_7470(sub_name)) {
              const __rec_upd_7554 = te;
              const _t7555 = ({classes: __rec_upd_7554.classes, constructors: __rec_upd_7554.constructors, effects: __rec_upd_7554.effects, hidden_ctor_types: __rec_upd_7554.hidden_ctor_types, hidden_types: __rec_upd_7554.hidden_types, instances: __rec_upd_7554.instances, modules: ({_hd: [sub_name, sub_info], _tl: te.modules}), mutable_fields: __rec_upd_7554.mutable_fields, newtypes: __rec_upd_7554.newtypes, records: __rec_upd_7554.records, type_aliases: __rec_upd_7554.type_aliases, type_synonyms: __rec_upd_7554.type_synonyms, variants: __rec_upd_7554.variants});
              _t7553 = _t7555;
            } else {
              _t7553 = te;
            }
            _t7551 = _t7553;
            break _t7552;
          }
          _match_fail("line 16629");
        }
        return _t7551;
      }
      const type_env_7556 = List$fold(_t7549, type_env_7547, minfo.mod_submodules);
      function _t7558(te, qname) {
        let _t7560;
        const _t7559 = String$rindex_opt(qname, 46);
        _t7561: {
          if (_t7559._tag === 1) {
            const i = _t7559._val;
            _t7560 = String$sub(qname, (i + 1), ((String$length(qname) - i) - 1));
            break _t7561;
          }
          if (_t7559._tag === 0) {
            _t7560 = qname;
            break _t7561;
          }
          _match_fail("line 16629");
        }
        const _mml$short_7562 = _t7560;
        let _t7564;
        if (filter_7470(_mml$short_7562)) {
          const __rec_upd_7565 = te;
          const _t7566 = ({classes: __rec_upd_7565.classes, constructors: __rec_upd_7565.constructors, effects: __rec_upd_7565.effects, hidden_ctor_types: __rec_upd_7565.hidden_ctor_types, hidden_types: __rec_upd_7565.hidden_types, instances: __rec_upd_7565.instances, modules: __rec_upd_7565.modules, mutable_fields: __rec_upd_7565.mutable_fields, newtypes: __rec_upd_7565.newtypes, records: __rec_upd_7565.records, type_aliases: ({_hd: [_mml$short_7562, qname], _tl: te.type_aliases}), type_synonyms: __rec_upd_7565.type_synonyms, variants: __rec_upd_7565.variants});
          _t7564 = _t7566;
        } else {
          _t7564 = te;
        }
        const _t7563 = _t7564;
        return _t7563;
      }
      const type_env_7567 = List$fold(_t7558, type_env_7556, minfo.mod_pub_classes);
      const __rec_upd_7569 = ctx_7478;
      const _t7570 = ({constraint_tvars: __rec_upd_7569.constraint_tvars, current_eff: __rec_upd_7569.current_eff, current_module: __rec_upd_7569.current_module, inside_handler: __rec_upd_7569.inside_handler, loop_info: __rec_upd_7569.loop_info, mutable_vars: __rec_upd_7569.mutable_vars, return_type: __rec_upd_7569.return_type, return_used: __rec_upd_7569.return_used, type_env: type_env_7567, vars: __rec_upd_7569.vars});
      const _t7568 = _t7570;
      const _t7557 = _t7568;
      const _t7548 = _t7557;
      const _t7542 = _t7548;
      const _t7488 = _t7542;
      const _t7479 = _t7488;
      const _t7471 = _t7479;
      _t7464 = _t7471;
      break _t7465;
    }
    _match_fail("line 16629");
  }
  return _t7464;
}
const _t7571_Typechecker$__destruct = Ref$set(Typechecker$find_module_in_env_ref, Typechecker$find_module_in_env);
const _t7572_Typechecker$__destruct = Ref$set(Typechecker$open_module_into_ctx_ref, Typechecker$open_module_into_ctx);
function Typechecker$collect_tyvars_annot(__x) {
  while (true) {
    let _t7574;
    const _t7573 = __x;
    _t7575: {
      if (_t7573._tag === 1) {
        const s = _t7573._val;
        _t7574 = ({_hd: s, _tl: null});
        break _t7575;
      }
      if (_t7573._tag === 2) {
        const a = _t7573._val[0];
        const b = _t7573._val[1];
        _t7574 = List$concat(Typechecker$collect_tyvars_annot(a), Typechecker$collect_tyvars_annot(b));
        break _t7575;
      }
      if (_t7573._tag === 6) {
        const ts = _t7573._val;
        _t7574 = List$concat_map(Typechecker$collect_tyvars_annot, ts);
        break _t7575;
      }
      if ((_t7573._tag === 4 || _t7573._tag === 5)) {
        const t = _t7573._val;
        const _t7576 = t;
        __x = _t7576;
        continue;
        _t7574 = undefined;
        break _t7575;
      }
      if (_t7573._tag === 7) {
        const args = _t7573._val[0];
        _t7574 = List$concat_map(Typechecker$collect_tyvars_annot, args);
        break _t7575;
      }
      if (_t7573._tag === 3) {
        const fs = _t7573._val[0];
        function _t7577(__p237) {
          let _t7579;
          const _t7578 = __p237;
          _t7580: {
            if (true) {
              const t = _t7578[1];
              _t7579 = Typechecker$collect_tyvars_annot(t);
              break _t7580;
            }
            _match_fail("line 16629");
          }
          return _t7579;
        }
        _t7574 = List$concat_map(_t7577, fs);
        break _t7575;
      }
      if ((_t7573._tag === 0 || _t7573._tag === 8)) {
        _t7574 = null;
        break _t7575;
      }
      if (_t7573._tag === 9) {
        const tags = _t7573._val[1];
        function _t7581(__p238) {
          let _t7583;
          const _t7582 = __p238;
          _t7584: {
            if (true) {
              const ty_opt = _t7582[1];
              let _t7586;
              const _t7585 = ty_opt;
              _t7587: {
                if (_t7585._tag === 1) {
                  const t = _t7585._val;
                  _t7586 = Typechecker$collect_tyvars_annot(t);
                  break _t7587;
                }
                if (_t7585._tag === 0) {
                  _t7586 = null;
                  break _t7587;
                }
                _match_fail("line 16629");
              }
              _t7583 = _t7586;
              break _t7584;
            }
            _match_fail("line 16629");
          }
          return _t7583;
        }
        _t7574 = List$concat_map(_t7581, tags);
        break _t7575;
      }
      if (_t7573._tag === 10) {
        const ty = _t7573._val[0];
        const _t7588 = ty;
        __x = _t7588;
        continue;
        _t7574 = undefined;
        break _t7575;
      }
      _match_fail("line 16629");
    }
    return _t7574;
  }
}
function Typechecker$concat_str_exprs(__x) {
  let _t7590;
  const _t7589 = __x;
  _t7591: {
    if (_t7589 === null) {
      _t7590 = ({_tag: 3, _name: "EString", _val: ""});
      break _t7591;
    }
    if (_t7589 !== null && _t7589._tl === null) {
      const e = _t7589._hd;
      _t7590 = e;
      break _t7591;
    }
    if (_t7589 !== null) {
      const first = _t7589._hd;
      const rest = _t7589._tl;
      function _t7592(acc, e) {
        return ({_tag: 13, _name: "EBinop", _val: [({_tag: 13, _name: "Concat"}), acc, e]});
      }
      _t7590 = List$fold(_t7592, first, rest);
      break _t7591;
    }
    _match_fail("line 16629");
  }
  return _t7590;
}
function Typechecker$make_inst_ty(type_params, name) {
  let _t7593;
  if (_eq(type_params, null)) {
    _t7593 = ({_tag: 0, _name: "TyName", _val: name});
  } else {
    function _t7594(p) {
      return ({_tag: 1, _name: "TyVar", _val: p});
    }
    _t7593 = ({_tag: 7, _name: "TyApp", _val: [List$map(_t7594, type_params), name]});
  }
  return _t7593;
}
function Typechecker$make_constraints(class_name, type_params, annots) {
  function _t7595(ann) {
    return Typechecker$collect_tyvars_annot(ann);
  }
  const all_vars_7596 = List$concat_map(_t7595, annots);
  const unique_vars_7598 = List$sort_uniq(String$compare, all_vars_7596);
  function _t7600(v) {
    return List$mem(v, type_params);
  }
  const param_vars_7601 = List$filter(_t7600, unique_vars_7598);
  function _t7603(v) {
    return [class_name, ({_hd: v, _tl: null})];
  }
  const _t7602 = List$map(_t7603, param_vars_7601);
  const _t7599 = _t7602;
  const _t7597 = _t7599;
  return _t7597;
}
function Typechecker$gen_show_variant(type_params, name, ctors) {
  const inst_ty_7604 = Typechecker$make_inst_ty(type_params, name);
  function _t7606(__p239) {
    let _t7608;
    const _t7607 = __p239;
    _t7609: {
      if (true) {
        const a = _t7607[1];
        _t7608 = a;
        break _t7609;
      }
      _match_fail("line 16629");
    }
    return _t7608;
  }
  const annots_7610 = List$filter_map(_t7606, ctors);
  const constraints_7612 = Typechecker$make_constraints("Show", type_params, annots_7610);
  function _t7614(__p240) {
    let _t7616;
    const _t7615 = __p240;
    _t7617: {
      if (true) {
        const ctor_name = _t7615[0];
        const arg_annot = _t7615[1];
        let _t7619;
        const _t7618 = arg_annot;
        _t7620: {
          if (_t7618._tag === 0) {
            _t7619 = [({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 0, _name: "None"})]}), ({_tag: 0, _name: "None"}), ({_tag: 3, _name: "EString", _val: ctor_name})];
            break _t7620;
          }
          if (_t7618._tag === 1 && _t7618._val._tag === 6) {
            const tys = _t7618._val._val;
            const n_7621 = List$length(tys);
            function _t7623(i) {
              return ("__v" + __dict_Show_int.show(i));
            }
            const vars_7624 = List$init(n_7621, _t7623);
            function _t7626(v) {
              return ({_tag: 1, _name: "PatVar", _val: v});
            }
            const pat_7627 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 7, _name: "PatTuple", _val: List$map(_t7626, vars_7624)})})]});
            function _t7629(i, v) {
              const sv_7630 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), ({_tag: 7, _name: "EVar", _val: v})]});
              let _t7632;
              if ((i === 0)) {
                _t7632 = ({_hd: sv_7630, _tl: null});
              } else {
                _t7632 = ({_hd: ({_tag: 3, _name: "EString", _val: ", "}), _tl: ({_hd: sv_7630, _tl: null})});
              }
              const _t7631 = _t7632;
              return _t7631;
            }
            const parts_7633 = List$concat(({_hd: ({_tag: 3, _name: "EString", _val: (ctor_name + "(")}), _tl: null}), List$concat(List$flatten(List$mapi(_t7629, vars_7624)), ({_hd: ({_tag: 3, _name: "EString", _val: ")"}), _tl: null})));
            const _t7634 = [pat_7627, ({_tag: 0, _name: "None"}), Typechecker$concat_str_exprs(parts_7633)];
            const _t7628 = _t7634;
            const _t7625 = _t7628;
            const _t7622 = _t7625;
            _t7619 = _t7622;
            break _t7620;
          }
          if (_t7618._tag === 1) {
            const pat_7635 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "PatVar", _val: "__v0"})})]});
            const body_7637 = Typechecker$concat_str_exprs(({_hd: ({_tag: 3, _name: "EString", _val: (ctor_name + "(")}), _tl: ({_hd: ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), ({_tag: 7, _name: "EVar", _val: "__v0"})]}), _tl: ({_hd: ({_tag: 3, _name: "EString", _val: ")"}), _tl: null})})}));
            const _t7638 = [pat_7635, ({_tag: 0, _name: "None"}), body_7637];
            const _t7636 = _t7638;
            _t7619 = _t7636;
            break _t7620;
          }
          _match_fail("line 16629");
        }
        _t7616 = _t7619;
        break _t7617;
      }
      _match_fail("line 16629");
    }
    return _t7616;
  }
  const arms_7639 = List$map(_t7614, ctors);
  const body_7641 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: "__x"}), arms_7639, false]});
  const _t7642 = ["Show", ({_hd: inst_ty_7604, _tl: null}), constraints_7612, ({_hd: ["show", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__x"}), _tl: null}), body_7641], _tl: null})];
  const _t7640 = _t7642;
  const _t7613 = _t7640;
  const _t7611 = _t7613;
  const _t7605 = _t7611;
  return _t7605;
}
function Typechecker$gen_show_record(type_params, name, fields) {
  const inst_ty_7643 = Typechecker$make_inst_ty(type_params, name);
  function _t7645(__p241) {
    let _t7647;
    const _t7646 = __p241;
    _t7648: {
      if (true) {
        const a = _t7646[2];
        _t7647 = a;
        break _t7648;
      }
      _match_fail("line 16629");
    }
    return _t7647;
  }
  const annots_7649 = List$map(_t7645, fields);
  const constraints_7651 = Typechecker$make_constraints("Show", type_params, annots_7649);
  function _t7653(i, __p242) {
    let _t7655;
    const _t7654 = __p242;
    _t7656: {
      if (true) {
        const fname = _t7654[1];
        const sf_7657 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__x"}), fname]})]});
        let _t7659;
        if ((i === 0)) {
          _t7659 = ({_hd: ({_tag: 3, _name: "EString", _val: (fname + " = ")}), _tl: ({_hd: sf_7657, _tl: null})});
        } else {
          _t7659 = ({_hd: ({_tag: 3, _name: "EString", _val: ("; " + (fname + " = "))}), _tl: ({_hd: sf_7657, _tl: null})});
        }
        const _t7658 = _t7659;
        _t7655 = _t7658;
        break _t7656;
      }
      _match_fail("line 16629");
    }
    return _t7655;
  }
  const parts_7660 = List$concat(({_hd: ({_tag: 3, _name: "EString", _val: "{ "}), _tl: null}), List$concat(List$flatten(List$mapi(_t7653, fields)), ({_hd: ({_tag: 3, _name: "EString", _val: " }"}), _tl: null})));
  const body_7662 = Typechecker$concat_str_exprs(parts_7660);
  const _t7663 = ["Show", ({_hd: inst_ty_7643, _tl: null}), constraints_7651, ({_hd: ["show", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__x"}), _tl: null}), body_7662], _tl: null})];
  const _t7661 = _t7663;
  const _t7652 = _t7661;
  const _t7650 = _t7652;
  const _t7644 = _t7650;
  return _t7644;
}
function Typechecker$gen_eq_variant(type_params, name, ctors) {
  const inst_ty_7664 = Typechecker$make_inst_ty(type_params, name);
  function _t7666(__p243) {
    let _t7668;
    const _t7667 = __p243;
    _t7669: {
      if (true) {
        const a = _t7667[1];
        _t7668 = a;
        break _t7669;
      }
      _match_fail("line 16629");
    }
    return _t7668;
  }
  const annots_7670 = List$filter_map(_t7666, ctors);
  const constraints_7672 = Typechecker$make_constraints("Eq", type_params, annots_7670);
  function _t7674(__x) {
    let _t7676;
    const _t7675 = __x;
    _t7677: {
      if (_t7675 === null) {
        _t7676 = ({_tag: 2, _name: "EBool", _val: true});
        break _t7677;
      }
      if (_t7675 !== null && _t7675._tl === null) {
        const e = _t7675._hd;
        _t7676 = e;
        break _t7677;
      }
      if (_t7675 !== null) {
        const first = _t7675._hd;
        const rest = _t7675._tl;
        function _t7678(a, e) {
          return ({_tag: 13, _name: "EBinop", _val: [({_tag: 11, _name: "And"}), a, e]});
        }
        _t7676 = List$fold(_t7678, first, rest);
        break _t7677;
      }
      _match_fail("line 16629");
    }
    return _t7676;
  }
  const and_exprs_7679 = _t7674;
  function _t7681(__p244) {
    let _t7683;
    const _t7682 = __p244;
    _t7684: {
      if (true) {
        const ctor_name = _t7682[0];
        const arg_annot = _t7682[1];
        let _t7686;
        const _t7685 = arg_annot;
        _t7687: {
          if (_t7685._tag === 0) {
            const pat_7688 = ({_tag: 7, _name: "PatTuple", _val: ({_hd: ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 0, _name: "None"})]}), _tl: ({_hd: ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 0, _name: "None"})]}), _tl: null})})});
            const _t7689 = [pat_7688, ({_tag: 0, _name: "None"}), ({_tag: 2, _name: "EBool", _val: true})];
            _t7686 = _t7689;
            break _t7687;
          }
          if (_t7685._tag === 1 && _t7685._val._tag === 6) {
            const tys = _t7685._val._val;
            const n_7690 = List$length(tys);
            function _t7692(i) {
              return ("__v" + __dict_Show_int.show(i));
            }
            const vs_7693 = List$init(n_7690, _t7692);
            function _t7695(i) {
              return ("__w" + __dict_Show_int.show(i));
            }
            const ws_7696 = List$init(n_7690, _t7695);
            function _t7698(v) {
              return ({_tag: 1, _name: "PatVar", _val: v});
            }
            const lp_7699 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 7, _name: "PatTuple", _val: List$map(_t7698, vs_7693)})})]});
            function _t7701(v) {
              return ({_tag: 1, _name: "PatVar", _val: v});
            }
            const rp_7702 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 7, _name: "PatTuple", _val: List$map(_t7701, ws_7696)})})]});
            function _t7704(v, w) {
              return ({_tag: 13, _name: "EBinop", _val: [({_tag: 5, _name: "Eq"}), ({_tag: 7, _name: "EVar", _val: v}), ({_tag: 7, _name: "EVar", _val: w})]});
            }
            const eqs_7705 = List$map2(_t7704, vs_7693, ws_7696);
            const _t7706 = [({_tag: 7, _name: "PatTuple", _val: ({_hd: lp_7699, _tl: ({_hd: rp_7702, _tl: null})})}), ({_tag: 0, _name: "None"}), and_exprs_7679(eqs_7705)];
            const _t7703 = _t7706;
            const _t7700 = _t7703;
            const _t7697 = _t7700;
            const _t7694 = _t7697;
            const _t7691 = _t7694;
            _t7686 = _t7691;
            break _t7687;
          }
          if (_t7685._tag === 1) {
            const lp_7707 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "PatVar", _val: "__v0"})})]});
            const rp_7709 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "PatVar", _val: "__w0"})})]});
            const _t7710 = [({_tag: 7, _name: "PatTuple", _val: ({_hd: lp_7707, _tl: ({_hd: rp_7709, _tl: null})})}), ({_tag: 0, _name: "None"}), ({_tag: 13, _name: "EBinop", _val: [({_tag: 5, _name: "Eq"}), ({_tag: 7, _name: "EVar", _val: "__v0"}), ({_tag: 7, _name: "EVar", _val: "__w0"})]})];
            const _t7708 = _t7710;
            _t7686 = _t7708;
            break _t7687;
          }
          _match_fail("line 16629");
        }
        _t7683 = _t7686;
        break _t7684;
      }
      _match_fail("line 16629");
    }
    return _t7683;
  }
  const arms_7711 = List$map(_t7681, ctors);
  const arms_7713 = List$concat(arms_7711, ({_hd: [({_tag: 0, _name: "PatWild"}), ({_tag: 0, _name: "None"}), ({_tag: 2, _name: "EBool", _val: false})], _tl: null}));
  const eq_body_7715 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 15, _name: "ETuple", _val: ({_hd: ({_tag: 7, _name: "EVar", _val: "__a"}), _tl: ({_hd: ({_tag: 7, _name: "EVar", _val: "__b"}), _tl: null})})}), arms_7713, false]});
  function _t7717(__p245) {
    let _t7719;
    const _t7718 = __p245;
    _t7720: {
      if (true) {
        const p = _t7718[0];
        const g = _t7718[1];
        const e = _t7718[2];
        _t7719 = [p, g, e];
        break _t7720;
      }
      _match_fail("line 16629");
    }
    return _t7719;
  }
  const neq_body_7721 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 1, _name: "Not"}), ({_tag: 25, _name: "EMatch", _val: [({_tag: 15, _name: "ETuple", _val: ({_hd: ({_tag: 7, _name: "EVar", _val: "__a"}), _tl: ({_hd: ({_tag: 7, _name: "EVar", _val: "__b"}), _tl: null})})}), List$map(_t7717, arms_7713), false]})]});
  const _t7722 = ["Eq", ({_hd: inst_ty_7664, _tl: null}), constraints_7672, ({_hd: ["=", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), eq_body_7715], _tl: ({_hd: ["<>", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), neq_body_7721], _tl: null})})];
  const _t7716 = _t7722;
  const _t7714 = _t7716;
  const _t7712 = _t7714;
  const _t7680 = _t7712;
  const _t7673 = _t7680;
  const _t7671 = _t7673;
  const _t7665 = _t7671;
  return _t7665;
}
function Typechecker$gen_eq_record(type_params, name, fields) {
  const inst_ty_7723 = Typechecker$make_inst_ty(type_params, name);
  function _t7725(__p246) {
    let _t7727;
    const _t7726 = __p246;
    _t7728: {
      if (true) {
        const a = _t7726[2];
        _t7727 = a;
        break _t7728;
      }
      _match_fail("line 16629");
    }
    return _t7727;
  }
  const annots_7729 = List$map(_t7725, fields);
  const constraints_7731 = Typechecker$make_constraints("Eq", type_params, annots_7729);
  function _t7733(__p247) {
    let _t7735;
    const _t7734 = __p247;
    _t7736: {
      if (true) {
        const fname = _t7734[1];
        _t7735 = ({_tag: 13, _name: "EBinop", _val: [({_tag: 5, _name: "Eq"}), ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__a"}), fname]}), ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__b"}), fname]})]});
        break _t7736;
      }
      _match_fail("line 16629");
    }
    return _t7735;
  }
  const eqs_7737 = List$map(_t7733, fields);
  let _t7740;
  const _t7739 = eqs_7737;
  _t7741: {
    if (_t7739 === null) {
      _t7740 = ({_tag: 2, _name: "EBool", _val: true});
      break _t7741;
    }
    if (_t7739 !== null && _t7739._tl === null) {
      const e = _t7739._hd;
      _t7740 = e;
      break _t7741;
    }
    if (_t7739 !== null) {
      const first = _t7739._hd;
      const rest = _t7739._tl;
      function _t7742(a, e) {
        return ({_tag: 13, _name: "EBinop", _val: [({_tag: 11, _name: "And"}), a, e]});
      }
      _t7740 = List$fold(_t7742, first, rest);
      break _t7741;
    }
    _match_fail("line 16629");
  }
  const eq_body_7743 = _t7740;
  const neq_body_7745 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 1, _name: "Not"}), eq_body_7743]});
  const _t7746 = ["Eq", ({_hd: inst_ty_7723, _tl: null}), constraints_7731, ({_hd: ["=", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), eq_body_7743], _tl: ({_hd: ["<>", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), neq_body_7745], _tl: null})})];
  const _t7744 = _t7746;
  const _t7738 = _t7744;
  const _t7732 = _t7738;
  const _t7730 = _t7732;
  const _t7724 = _t7730;
  return _t7724;
}
function Typechecker$generate_derived_instance(type_params, name, def, class_name) {
  let _t7748;
  const _t7747 = [class_name, def];
  _t7749: {
    if (_t7747[1]._tag === 0) {
      const ctors = _t7747[1]._val;
      function _t7750(__p248) {
        let _t7752;
        const _t7751 = __p248;
        _t7753: {
          if (true) {
            const ret = _t7751[2];
            _t7752 = !_eq(ret, ({_tag: 0, _name: "None"}));
            break _t7753;
          }
          _match_fail("line 16629");
        }
        return _t7752;
      }
      if (List$exists(_t7750, ctors)) {
        _t7748 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(class_name)) + " for GADT type ") + __dict_Show_string.show(name)));
        break _t7749;
      }
    }
    if (_t7747[0] === "Show" && _t7747[1]._tag === 0) {
      const ctors = _t7747[1]._val;
      _t7748 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_show_variant(type_params, name, ctors)});
      break _t7749;
    }
    if (_t7747[0] === "Show" && _t7747[1]._tag === 1) {
      const fields = _t7747[1]._val;
      _t7748 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_show_record(type_params, name, fields)});
      break _t7749;
    }
    if (_t7747[0] === "Show" && _t7747[1]._tag === 3) {
      const ctor_name = _t7747[1]._val[0];
      const underlying = _t7747[1]._val[1];
      _t7748 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_show_variant(type_params, name, ({_hd: [ctor_name, ({_tag: 1, _name: "Some", _val: underlying}), ({_tag: 0, _name: "None"})], _tl: null}))});
      break _t7749;
    }
    if (_t7747[0] === "Eq" && _t7747[1]._tag === 0) {
      const ctors = _t7747[1]._val;
      _t7748 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_eq_variant(type_params, name, ctors)});
      break _t7749;
    }
    if (_t7747[0] === "Eq" && _t7747[1]._tag === 1) {
      const fields = _t7747[1]._val;
      _t7748 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_eq_record(type_params, name, fields)});
      break _t7749;
    }
    if (_t7747[0] === "Eq" && _t7747[1]._tag === 3) {
      const ctor_name = _t7747[1]._val[0];
      const underlying = _t7747[1]._val[1];
      _t7748 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_eq_variant(type_params, name, ({_hd: [ctor_name, ({_tag: 1, _name: "Some", _val: underlying}), ({_tag: 0, _name: "None"})], _tl: null}))});
      break _t7749;
    }
    if (true) {
      _t7748 = ({_tag: 0, _name: "None"});
      break _t7749;
    }
    _match_fail("line 16629");
  }
  return _t7748;
}
function Typechecker$process_module_def(ctx, level, mod_name, items) {
  let _t7755;
  const _t7754 = ctx.current_module;
  _t7756: {
    if (_t7754._tag === 0) {
      _t7755 = (mod_name + ".");
      break _t7756;
    }
    if (_t7754._tag === 1) {
      const parent = _t7754._val;
      _t7755 = (parent + (mod_name + "."));
      break _t7756;
    }
    _match_fail("line 16629");
  }
  const prefix_7757 = _t7755;
  const __rec_upd_7759 = ctx;
  const _t7760 = ({constraint_tvars: __rec_upd_7759.constraint_tvars, current_eff: __rec_upd_7759.current_eff, current_module: ({_tag: 1, _name: "Some", _val: prefix_7757}), inside_handler: __rec_upd_7759.inside_handler, loop_info: __rec_upd_7759.loop_info, mutable_vars: __rec_upd_7759.mutable_vars, return_type: __rec_upd_7759.return_type, return_used: __rec_upd_7759.return_used, type_env: __rec_upd_7759.type_env, vars: __rec_upd_7759.vars});
  const sub_ctx_7761 = _t7760;
  const pub_vars_7763 = Ref$create(null);
  const pub_mutable_vars_7765 = Ref$create(null);
  const pub_types_7767 = Ref$create(null);
  const opaque_types_7769 = Ref$create(null);
  const newtypes_7771 = Ref$create(null);
  const pub_constructors_7773 = Ref$create(null);
  const all_instances_7775 = Ref$create(null);
  const submodules_7777 = Ref$create(null);
  const pub_classes_7779 = Ref$create(null);
  const typed_decls_7781 = Ref$create(null);
  function _t7783(sub_ctx, item) {
    let _t7785;
    const _t7784 = Typechecker$check_module_item(sub_ctx, level, prefix_7757, item, pub_vars_7763, pub_mutable_vars_7765, pub_types_7767, opaque_types_7769, newtypes_7771, pub_constructors_7773, all_instances_7775, submodules_7777, pub_classes_7779, typed_decls_7781);
    _t7786: {
      if (true) {
        const sub_ctx$p = _t7784[0];
        const tdecl = _t7784[1];
        Ref$set(typed_decls_7781, ({_hd: tdecl, _tl: Ref$get(typed_decls_7781)}));
        _t7785 = sub_ctx$p;
        break _t7786;
      }
      _match_fail("line 16629");
    }
    return _t7785;
  }
  const sub_ctx_7787 = List$fold(_t7783, sub_ctx_7761, items);
  const minfo_7789 = ({mod_instances: Ref$get(all_instances_7775), mod_name: mod_name, mod_newtypes: Ref$get(newtypes_7771), mod_opaque_types: Ref$get(opaque_types_7769), mod_pub_classes: Ref$get(pub_classes_7779), mod_pub_constructors: Ref$get(pub_constructors_7773), mod_pub_mutable_vars: Ref$get(pub_mutable_vars_7765), mod_pub_types: Ref$get(pub_types_7767), mod_pub_vars: Ref$get(pub_vars_7763), mod_submodules: Ref$get(submodules_7777)});
  const __rec_upd_7791 = sub_ctx_7787.type_env;
  const _t7792 = ({classes: __rec_upd_7791.classes, constructors: __rec_upd_7791.constructors, effects: __rec_upd_7791.effects, hidden_ctor_types: __rec_upd_7791.hidden_ctor_types, hidden_types: __rec_upd_7791.hidden_types, instances: __rec_upd_7791.instances, modules: ({_hd: [mod_name, minfo_7789], _tl: ctx.type_env.modules}), mutable_fields: __rec_upd_7791.mutable_fields, newtypes: __rec_upd_7791.newtypes, records: __rec_upd_7791.records, type_aliases: __rec_upd_7791.type_aliases, type_synonyms: __rec_upd_7791.type_synonyms, variants: __rec_upd_7791.variants});
  const outer_type_env_7793 = _t7792;
  const __rec_upd_7795 = outer_type_env_7793;
  const _t7796 = ({classes: __rec_upd_7795.classes, constructors: __rec_upd_7795.constructors, effects: __rec_upd_7795.effects, hidden_ctor_types: __rec_upd_7795.hidden_ctor_types, hidden_types: __rec_upd_7795.hidden_types, instances: __rec_upd_7795.instances, modules: __rec_upd_7795.modules, mutable_fields: __rec_upd_7795.mutable_fields, newtypes: __rec_upd_7795.newtypes, records: __rec_upd_7795.records, type_aliases: ctx.type_env.type_aliases, type_synonyms: __rec_upd_7795.type_synonyms, variants: __rec_upd_7795.variants});
  const outer_type_env_7797 = _t7796;
  function _t7799(__p249) {
    let _t7801;
    const _t7800 = __p249;
    _t7802: {
      if (true) {
        const name = _t7800[0];
        function _t7803(__p250) {
          let _t7805;
          const _t7804 = __p250;
          _t7806: {
            if (true) {
              const n = _t7804[0];
              _t7805 = (n === name);
              break _t7806;
            }
            _match_fail("line 16629");
          }
          return _t7805;
        }
        _t7801 = (!List$exists(_t7803, ctx.type_env.variants));
        break _t7802;
      }
      _match_fail("line 16629");
    }
    return _t7801;
  }
  const new_variants_7807 = List$filter(_t7799, sub_ctx_7787.type_env.variants);
  function _t7809(__p251) {
    let _t7811;
    const _t7810 = __p251;
    _t7812: {
      if (true) {
        const name = _t7810[0];
        function _t7813(__p252) {
          let _t7815;
          const _t7814 = __p252;
          _t7816: {
            if (true) {
              const n = _t7814[0];
              _t7815 = (n === name);
              break _t7816;
            }
            _match_fail("line 16629");
          }
          return _t7815;
        }
        _t7811 = (!List$exists(_t7813, ctx.type_env.records));
        break _t7812;
      }
      _match_fail("line 16629");
    }
    return _t7811;
  }
  const new_records_7817 = List$filter(_t7809, sub_ctx_7787.type_env.records);
  function _t7819(__p253) {
    let _t7821;
    const _t7820 = __p253;
    _t7822: {
      if (true) {
        const name = _t7820[0];
        function _t7823(__p254) {
          let _t7825;
          const _t7824 = __p254;
          _t7826: {
            if (true) {
              const n = _t7824[0];
              _t7825 = (n === name);
              break _t7826;
            }
            _match_fail("line 16629");
          }
          return _t7825;
        }
        _t7821 = (!List$exists(_t7823, ctx.type_env.type_synonyms));
        break _t7822;
      }
      _match_fail("line 16629");
    }
    return _t7821;
  }
  const new_synonyms_7827 = List$filter(_t7819, sub_ctx_7787.type_env.type_synonyms);
  function submodule_types(info) {
    function _t7829(__p255) {
      let _t7831;
      const _t7830 = __p255;
      _t7832: {
        if (true) {
          const sub = _t7830[1];
          _t7831 = submodule_types(sub);
          break _t7832;
        }
        _match_fail("line 16629");
      }
      return _t7831;
    }
    return List$concat(info.mod_pub_types, List$concat_map(_t7829, info.mod_submodules));
  }
  function _t7834(__p256) {
    let _t7836;
    const _t7835 = __p256;
    _t7837: {
      if (true) {
        const info = _t7835[1];
        _t7836 = submodule_types(info);
        break _t7837;
      }
      _match_fail("line 16629");
    }
    return _t7836;
  }
  const submod_type_names_7838 = List$concat_map(_t7834, Ref$get(submodules_7777));
  function _t7840(name) {
    return (List$mem(name, Ref$get(pub_types_7767)) || List$mem(name, submod_type_names_7838));
  }
  const is_exported_7841 = _t7840;
  function _t7843(__p257) {
    let _t7845;
    const _t7844 = __p257;
    _t7846: {
      if (true) {
        const name = _t7844[0];
        let _t7847;
        if (is_exported_7841(name)) {
          _t7847 = ({_tag: 0, _name: "None"});
        } else {
          _t7847 = ({_tag: 1, _name: "Some", _val: name});
        }
        _t7845 = _t7847;
        break _t7846;
      }
      _match_fail("line 16629");
    }
    return _t7845;
  }
  function _t7848(__p258) {
    let _t7850;
    const _t7849 = __p258;
    _t7851: {
      if (true) {
        const name = _t7849[0];
        let _t7852;
        if (is_exported_7841(name)) {
          _t7852 = ({_tag: 0, _name: "None"});
        } else {
          _t7852 = ({_tag: 1, _name: "Some", _val: name});
        }
        _t7850 = _t7852;
        break _t7851;
      }
      _match_fail("line 16629");
    }
    return _t7850;
  }
  function _t7853(__p259) {
    let _t7855;
    const _t7854 = __p259;
    _t7856: {
      if (true) {
        const name = _t7854[0];
        let _t7857;
        if (is_exported_7841(name)) {
          _t7857 = ({_tag: 0, _name: "None"});
        } else {
          _t7857 = ({_tag: 1, _name: "Some", _val: name});
        }
        _t7855 = _t7857;
        break _t7856;
      }
      _match_fail("line 16629");
    }
    return _t7855;
  }
  const private_type_names_7858 = List$concat(List$filter_map(_t7843, new_variants_7807), List$concat(List$filter_map(_t7848, new_records_7817), List$filter_map(_t7853, new_synonyms_7827)));
  const __rec_upd_7860 = outer_type_env_7797;
  const _t7861 = ({classes: __rec_upd_7860.classes, constructors: __rec_upd_7860.constructors, effects: __rec_upd_7860.effects, hidden_ctor_types: __rec_upd_7860.hidden_ctor_types, hidden_types: List$concat(private_type_names_7858, outer_type_env_7797.hidden_types), instances: __rec_upd_7860.instances, modules: __rec_upd_7860.modules, mutable_fields: __rec_upd_7860.mutable_fields, newtypes: __rec_upd_7860.newtypes, records: __rec_upd_7860.records, type_aliases: __rec_upd_7860.type_aliases, type_synonyms: __rec_upd_7860.type_synonyms, variants: __rec_upd_7860.variants});
  const outer_type_env_7862 = _t7861;
  const hidden_ctor_type_names_7864 = List$concat(private_type_names_7858, Ref$get(opaque_types_7769));
  const __rec_upd_7866 = outer_type_env_7862;
  const _t7867 = ({classes: __rec_upd_7866.classes, constructors: __rec_upd_7866.constructors, effects: __rec_upd_7866.effects, hidden_ctor_types: List$concat(hidden_ctor_type_names_7864, outer_type_env_7862.hidden_ctor_types), hidden_types: __rec_upd_7866.hidden_types, instances: __rec_upd_7866.instances, modules: __rec_upd_7866.modules, mutable_fields: __rec_upd_7866.mutable_fields, newtypes: __rec_upd_7866.newtypes, records: __rec_upd_7866.records, type_aliases: __rec_upd_7866.type_aliases, type_synonyms: __rec_upd_7866.type_synonyms, variants: __rec_upd_7866.variants});
  const outer_type_env_7868 = _t7867;
  function collect_type_names(acc, ty) {
    while (true) {
      let _t7871;
      const _t7870 = Types$repr(ty);
      _t7872: {
        if (_t7870._tag === 12) {
          const name = _t7870._val[0];
          const args = _t7870._val[1];
          _t7871 = List$fold(collect_type_names, ({_hd: name, _tl: acc}), args);
          break _t7872;
        }
        if (_t7870._tag === 7) {
          const a = _t7870._val[0];
          const b = _t7870._val[2];
          const _t7873 = collect_type_names(acc, a);
          const _t7874 = b;
          acc = _t7873;
          ty = _t7874;
          continue;
          _t7871 = undefined;
          break _t7872;
        }
        if (_t7870._tag === 9) {
          const ts = _t7870._val;
          _t7871 = List$fold(collect_type_names, acc, ts);
          break _t7872;
        }
        if ((_t7870._tag === 10 || _t7870._tag === 13)) {
          const t = _t7870._val;
          const _t7875 = acc;
          const _t7876 = t;
          acc = _t7875;
          ty = _t7876;
          continue;
          _t7871 = undefined;
          break _t7872;
        }
        if (_t7870._tag === 11) {
          const row = _t7870._val;
          _t7871 = collect_row_names(acc, row);
          break _t7872;
        }
        if (true) {
          _t7871 = acc;
          break _t7872;
        }
        _match_fail("line 16629");
      }
      return _t7871;
    }
  }
  function collect_row_names(acc, __x) {
    while (true) {
      let _t7878;
      const _t7877 = __x;
      _t7879: {
        if (_t7877._tag === 0) {
          const ty = _t7877._val[1];
          const rest = _t7877._val[2];
          const _t7880 = collect_type_names(acc, ty);
          const _t7881 = rest;
          acc = _t7880;
          __x = _t7881;
          continue;
          _t7878 = undefined;
          break _t7879;
        }
        if (true) {
          _t7878 = acc;
          break _t7879;
        }
        _match_fail("line 16629");
      }
      return _t7878;
    }
  }
  let _t7883;
  if (!_eq(private_type_names_7858, null)) {
    function _t7884(__p260) {
      let _t7886;
      const _t7885 = __p260;
      _t7887: {
        if (true) {
          const _mml$short = _t7885[0];
          const scheme = _t7885[1];
          const type_names_7888 = collect_type_names(null, scheme.body);
          function _t7890(tname) {
            let _t7891;
            if (List$mem(tname, private_type_names_7858)) {
              let _t7893;
              const _t7892 = String$rindex_opt(tname, 46);
              _t7894: {
                if (_t7892._tag === 1) {
                  const i = _t7892._val;
                  _t7893 = String$sub(tname, (i + 1), ((String$length(tname) - i) - 1));
                  break _t7894;
                }
                if (_t7892._tag === 0) {
                  _t7893 = tname;
                  break _t7894;
                }
                _match_fail("line 16629");
              }
              const short_tname_7895 = _t7893;
              const _t7896 = Typechecker$error((((("public binding '" + __dict_Show_string.show(_mml$short)) + "' exposes private type '") + __dict_Show_string.show(short_tname_7895)) + "'. Use 'pub type' or 'opaque type' to export it"));
              _t7891 = _t7896;
            } else {
              _t7891 = undefined;
            }
            return _t7891;
          }
          const _t7889 = List$iter(_t7890, type_names_7888);
          _t7886 = _t7889;
          break _t7887;
        }
        _match_fail("line 16629");
      }
      return _t7886;
    }
    _t7883 = List$iter(_t7884, Ref$get(pub_vars_7763));
  } else {
    _t7883 = undefined;
  }
  _t7883;
  function _t7897(vars, __p261) {
    let _t7899;
    const _t7898 = __p261;
    _t7900: {
      if (true) {
        const _mml$short = _t7898[0];
        const scheme = _t7898[1];
        const qualified_7901 = (prefix_7757 + _mml$short);
        const _t7902 = ({_hd: [qualified_7901, scheme], _tl: vars});
        _t7899 = _t7902;
        break _t7900;
      }
      _match_fail("line 16629");
    }
    return _t7899;
  }
  const outer_vars_7903 = List$fold(_t7897, ctx.vars, Ref$get(pub_vars_7763));
  function _t7905(te, __p262) {
    let _t7907;
    const _t7906 = __p262;
    _t7908: {
      if (true) {
        const _mml$short = _t7906[0];
        const info = _t7906[1];
        const qualified_7909 = (prefix_7757 + _mml$short);
        const __rec_upd_7911 = te;
        const _t7912 = ({classes: __rec_upd_7911.classes, constructors: ({_hd: [qualified_7909, info], _tl: te.constructors}), effects: __rec_upd_7911.effects, hidden_ctor_types: __rec_upd_7911.hidden_ctor_types, hidden_types: __rec_upd_7911.hidden_types, instances: __rec_upd_7911.instances, modules: __rec_upd_7911.modules, mutable_fields: __rec_upd_7911.mutable_fields, newtypes: __rec_upd_7911.newtypes, records: __rec_upd_7911.records, type_aliases: __rec_upd_7911.type_aliases, type_synonyms: __rec_upd_7911.type_synonyms, variants: __rec_upd_7911.variants});
        const _t7910 = _t7912;
        _t7907 = _t7910;
        break _t7908;
      }
      _match_fail("line 16629");
    }
    return _t7907;
  }
  const outer_type_env_7913 = List$fold(_t7905, outer_type_env_7868, Ref$get(pub_constructors_7773));
  function _t7915(i) {
    return i.inst_dict_name;
  }
  const existing_dict_names_7916 = List$map(_t7915, outer_type_env_7913.instances);
  function _t7918(inst) {
    return (!List$mem(inst.inst_dict_name, existing_dict_names_7916));
  }
  const new_insts_7919 = List$filter(_t7918, Ref$get(all_instances_7775));
  const __rec_upd_7921 = outer_type_env_7913;
  const _t7922 = ({classes: __rec_upd_7921.classes, constructors: __rec_upd_7921.constructors, effects: __rec_upd_7921.effects, hidden_ctor_types: __rec_upd_7921.hidden_ctor_types, hidden_types: __rec_upd_7921.hidden_types, instances: List$concat(new_insts_7919, outer_type_env_7913.instances), modules: __rec_upd_7921.modules, mutable_fields: __rec_upd_7921.mutable_fields, newtypes: __rec_upd_7921.newtypes, records: __rec_upd_7921.records, type_aliases: __rec_upd_7921.type_aliases, type_synonyms: __rec_upd_7921.type_synonyms, variants: __rec_upd_7921.variants});
  const outer_type_env_7923 = _t7922;
  function _t7925(mvs, _mml$short) {
    const qualified_7926 = (prefix_7757 + _mml$short);
    const _t7927 = ({_hd: qualified_7926, _tl: mvs});
    return _t7927;
  }
  const outer_mutable_vars_7928 = List$fold(_t7925, ctx.mutable_vars, Ref$get(pub_mutable_vars_7765));
  const __rec_upd_7930 = ctx;
  const _t7931 = ({constraint_tvars: __rec_upd_7930.constraint_tvars, current_eff: __rec_upd_7930.current_eff, current_module: __rec_upd_7930.current_module, inside_handler: __rec_upd_7930.inside_handler, loop_info: __rec_upd_7930.loop_info, mutable_vars: outer_mutable_vars_7928, return_type: __rec_upd_7930.return_type, return_used: __rec_upd_7930.return_used, type_env: outer_type_env_7923, vars: outer_vars_7903});
  const outer_ctx_7932 = _t7931;
  const _t7933 = [outer_ctx_7932, ({_tag: 9, _name: "TDModule", _val: [mod_name, List$rev(Ref$get(typed_decls_7781))]})];
  const _t7929 = _t7933;
  const _t7924 = _t7929;
  const _t7920 = _t7924;
  const _t7917 = _t7920;
  const _t7914 = _t7917;
  const _t7904 = _t7914;
  const _t7882 = _t7904;
  const _t7869 = _t7882;
  const _t7865 = _t7869;
  const _t7863 = _t7865;
  const _t7859 = _t7863;
  const _t7842 = _t7859;
  const _t7839 = _t7842;
  const _t7833 = _t7839;
  const _t7828 = _t7833;
  const _t7818 = _t7828;
  const _t7808 = _t7818;
  const _t7798 = _t7808;
  const _t7794 = _t7798;
  const _t7790 = _t7794;
  const _t7788 = _t7790;
  const _t7782 = _t7788;
  const _t7780 = _t7782;
  const _t7778 = _t7780;
  const _t7776 = _t7778;
  const _t7774 = _t7776;
  const _t7772 = _t7774;
  const _t7770 = _t7772;
  const _t7768 = _t7770;
  const _t7766 = _t7768;
  const _t7764 = _t7766;
  const _t7762 = _t7764;
  const _t7758 = _t7762;
  return _t7758;
}
function Typechecker$check_module_item(sub_ctx, level, prefix, item, pub_vars, pub_mutable_vars, pub_types, opaque_types, newtypes, pub_constructors, all_instances, submodules, pub_classes, typed_decls) {
  const decl_7934 = item.decl;
  let _t7937;
  const _t7936 = decl_7934;
  _t7938: {
    if (_t7936._tag === 11) {
      const inner_name = _t7936._val[0];
      const inner_items = _t7936._val[1];
      let _t7940;
      const _t7939 = Typechecker$process_module_def(sub_ctx, level, inner_name, inner_items);
      _t7941: {
        if (true) {
          const sub_ctx$p = _t7939[0];
          const tdecl = _t7939[1];
          let _t7943;
          const _t7942 = item.vis;
          _t7944: {
            if (_t7942._tag === 0) {
              let _t7946;
              const _t7945 = Typechecker$find_module_in_env(sub_ctx$p.type_env, inner_name);
              _t7947: {
                if (_t7945._tag === 1) {
                  const inner_info = _t7945._val;
                  Ref$set(submodules, ({_hd: [inner_name, inner_info], _tl: Ref$get(submodules)}));
                  function _t7948(__p263) {
                    let _t7950;
                    const _t7949 = __p263;
                    _t7951: {
                      if (true) {
                        const _mml$short = _t7949[0];
                        const scheme = _t7949[1];
                        _t7950 = Ref$set(pub_vars, ({_hd: [(inner_name + ("." + _mml$short)), scheme], _tl: Ref$get(pub_vars)}));
                        break _t7951;
                      }
                      _match_fail("line 16629");
                    }
                    return _t7950;
                  }
                  List$iter(_t7948, inner_info.mod_pub_vars);
                  function _t7952(__p264) {
                    let _t7954;
                    const _t7953 = __p264;
                    _t7955: {
                      if (true) {
                        const _mml$short = _t7953[0];
                        const info = _t7953[1];
                        _t7954 = Ref$set(pub_constructors, ({_hd: [(inner_name + ("." + _mml$short)), info], _tl: Ref$get(pub_constructors)}));
                        break _t7955;
                      }
                      _match_fail("line 16629");
                    }
                    return _t7954;
                  }
                  _t7946 = List$iter(_t7952, inner_info.mod_pub_constructors);
                  break _t7947;
                }
                if (_t7945._tag === 0) {
                  _t7946 = undefined;
                  break _t7947;
                }
                _match_fail("line 16629");
              }
              _t7943 = _t7946;
              break _t7944;
            }
            if (true) {
              _t7943 = undefined;
              break _t7944;
            }
            _match_fail("line 16629");
          }
          _t7943;
          _t7940 = [sub_ctx$p, tdecl];
          break _t7941;
        }
        _match_fail("line 16629");
      }
      _t7937 = _t7940;
      break _t7938;
    }
    if (_t7936._tag === 4) {
      const type_params = _t7936._val[0];
      const name = _t7936._val[1];
      const def = _t7936._val[2];
      const deriving_ = _t7936._val[3];
      const qualified_name_7956 = (prefix + name);
      const __rec_upd_7958 = sub_ctx;
      const __rec_upd_7960 = sub_ctx.type_env;
      const _t7961 = ({classes: __rec_upd_7960.classes, constructors: __rec_upd_7960.constructors, effects: __rec_upd_7960.effects, hidden_ctor_types: __rec_upd_7960.hidden_ctor_types, hidden_types: __rec_upd_7960.hidden_types, instances: __rec_upd_7960.instances, modules: __rec_upd_7960.modules, mutable_fields: __rec_upd_7960.mutable_fields, newtypes: __rec_upd_7960.newtypes, records: __rec_upd_7960.records, type_aliases: ({_hd: [name, qualified_name_7956], _tl: sub_ctx.type_env.type_aliases}), type_synonyms: __rec_upd_7960.type_synonyms, variants: __rec_upd_7960.variants});
      const _t7959 = ({constraint_tvars: __rec_upd_7958.constraint_tvars, current_eff: __rec_upd_7958.current_eff, current_module: __rec_upd_7958.current_module, inside_handler: __rec_upd_7958.inside_handler, loop_info: __rec_upd_7958.loop_info, mutable_vars: __rec_upd_7958.mutable_vars, return_type: __rec_upd_7958.return_type, return_used: __rec_upd_7958.return_used, type_env: _t7961, vars: __rec_upd_7958.vars});
      const sub_ctx_with_alias_7962 = _t7959;
      const sub_ctx$p_7964 = Typechecker$process_type_def(sub_ctx_with_alias_7962, type_params, qualified_name_7956, def);
      let _t7967;
      const _t7966 = def;
      _t7968: {
        if (_t7966._tag === 3) {
          _t7967 = Ref$set(newtypes, ({_hd: qualified_name_7956, _tl: Ref$get(newtypes)}));
          break _t7968;
        }
        if (true) {
          _t7967 = undefined;
          break _t7968;
        }
        _match_fail("line 16629");
      }
      _t7967;
      let _t7970;
      const _t7969 = item.vis;
      _t7971: {
        if (_t7969._tag === 0) {
          Ref$set(pub_types, ({_hd: qualified_name_7956, _tl: Ref$get(pub_types)}));
          let _t7973;
          const _t7972 = def;
          _t7974: {
            if (_t7972._tag === 0) {
              const ctors = _t7972._val;
              function _t7975(__p265) {
                let _t7977;
                const _t7976 = __p265;
                _t7978: {
                  if (true) {
                    const ctor_name = _t7976[0];
                    let _t7980;
                    const _t7979 = List$assoc_opt(ctor_name, sub_ctx$p_7964.type_env.constructors);
                    _t7981: {
                      if (_t7979._tag === 1) {
                        const info = _t7979._val;
                        const __rec_upd_7982 = info;
                        const _t7983 = ({ctor_arg_ty: __rec_upd_7982.ctor_arg_ty, ctor_existentials: __rec_upd_7982.ctor_existentials, ctor_num_params: __rec_upd_7982.ctor_num_params, ctor_return_ty_params: __rec_upd_7982.ctor_return_ty_params, ctor_type_name: qualified_name_7956});
                        const qual_info_7984 = _t7983;
                        const _t7985 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_7984], _tl: Ref$get(pub_constructors)}));
                        _t7980 = _t7985;
                        break _t7981;
                      }
                      if (_t7979._tag === 0) {
                        _t7980 = undefined;
                        break _t7981;
                      }
                      _match_fail("line 16629");
                    }
                    _t7977 = _t7980;
                    break _t7978;
                  }
                  _match_fail("line 16629");
                }
                return _t7977;
              }
              _t7973 = List$iter(_t7975, ctors);
              break _t7974;
            }
            if (_t7972._tag === 3) {
              const ctor_name = _t7972._val[0];
              let _t7987;
              const _t7986 = List$assoc_opt(ctor_name, sub_ctx$p_7964.type_env.constructors);
              _t7988: {
                if (_t7986._tag === 1) {
                  const info = _t7986._val;
                  const __rec_upd_7989 = info;
                  const _t7990 = ({ctor_arg_ty: __rec_upd_7989.ctor_arg_ty, ctor_existentials: __rec_upd_7989.ctor_existentials, ctor_num_params: __rec_upd_7989.ctor_num_params, ctor_return_ty_params: __rec_upd_7989.ctor_return_ty_params, ctor_type_name: qualified_name_7956});
                  const qual_info_7991 = _t7990;
                  const _t7992 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_7991], _tl: Ref$get(pub_constructors)}));
                  _t7987 = _t7992;
                  break _t7988;
                }
                if (_t7986._tag === 0) {
                  _t7987 = undefined;
                  break _t7988;
                }
                _match_fail("line 16629");
              }
              _t7973 = _t7987;
              break _t7974;
            }
            if ((_t7972._tag === 1 || _t7972._tag === 2)) {
              _t7973 = undefined;
              break _t7974;
            }
            _match_fail("line 16629");
          }
          _t7970 = _t7973;
          break _t7971;
        }
        if (_t7969._tag === 2) {
          Ref$set(pub_types, ({_hd: qualified_name_7956, _tl: Ref$get(pub_types)}));
          _t7970 = Ref$set(opaque_types, ({_hd: qualified_name_7956, _tl: Ref$get(opaque_types)}));
          break _t7971;
        }
        if (_t7969._tag === 1) {
          _t7970 = undefined;
          break _t7971;
        }
        _match_fail("line 16629");
      }
      _t7970;
      function _t7993(ctx, cls) {
        let _t7995;
        const _t7994 = Typechecker$generate_derived_instance(type_params, name, def, cls);
        _t7996: {
          if (_t7994._tag === 1) {
            const class_name = _t7994._val[0];
            const inst_tys = _t7994._val[1];
            const constraints = _t7994._val[2];
            const methods = _t7994._val[3];
            let _t7998;
            const _t7997 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
            _t7999: {
              if (true) {
                const ctx$p = _t7997[0];
                const tdecl = _t7997[1];
                Ref$set(typed_decls, ({_hd: tdecl, _tl: Ref$get(typed_decls)}));
                Ref$set(all_instances, ctx$p.type_env.instances);
                _t7998 = ctx$p;
                break _t7999;
              }
              _match_fail("line 16629");
            }
            _t7995 = _t7998;
            break _t7996;
          }
          if (_t7994._tag === 0) {
            _t7995 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
            break _t7996;
          }
          _match_fail("line 16629");
        }
        return _t7995;
      }
      const sub_ctx$p_8000 = List$fold(_t7993, sub_ctx$p_7964, deriving_);
      const _t8001 = [sub_ctx$p_8000, ({_tag: 4, _name: "TDType", _val: [qualified_name_7956, def]})];
      const _t7965 = _t8001;
      const _t7963 = _t7965;
      const _t7957 = _t7963;
      _t7937 = _t7957;
      break _t7938;
    }
    if (_t7936._tag === 0) {
      const name = _t7936._val[0];
      const params = _t7936._val[1];
      const ret_annot = _t7936._val[2];
      const constraints = _t7936._val[3];
      const body = _t7936._val[4];
      const qualified_name_8002 = (prefix + name);
      let _t8004;
      if (!_eq(constraints, null)) {
        _t8004 = Typechecker$synth_constrained_fn(sub_ctx, level, constraints, params, ret_annot, body);
      } else {
        const full_body_8005 = Typechecker$wrap_params_decl(params, ret_annot, body);
        const te_8007 = Typechecker$synth(sub_ctx, (level + 1), full_body_8005);
        Typechecker$improve_fundeps_in_expr(sub_ctx.vars, sub_ctx.type_env, te_8007);
        let _t8009;
        if ((_eq(params, null) && (!Typechecker$is_syntactic_value(body)))) {
          _t8009 = Typechecker$mono_scheme(te_8007.ty);
        } else {
          _t8009 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, te_8007.ty, Hashtbl$create(0));
        }
        const scheme_8010 = _t8009;
        const scheme_8012 = Typechecker$infer_implicit_constraints("", sub_ctx.type_env, sub_ctx.vars, te_8007, scheme_8010);
        const scheme_8014 = Typechecker$infer_record_evidence(sub_ctx.vars, te_8007, scheme_8012);
        const _t8015 = [te_8007, scheme_8014];
        const _t8013 = _t8015;
        const _t8011 = _t8013;
        const _t8008 = _t8011;
        const _t8006 = _t8008;
        _t8004 = _t8006;
      }
      let _t8017;
      const _t8016 = _t8004;
      _t8018: {
        if (true) {
          const te = _t8016[0];
          const scheme = _t8016[1];
          const sub_ctx$p_8019 = Typechecker$extend_var(sub_ctx, name, scheme);
          const sub_ctx$p_8021 = Typechecker$extend_var(sub_ctx$p_8019, qualified_name_8002, scheme);
          let _t8024;
          const _t8023 = item.vis;
          _t8025: {
            if (_t8023._tag === 0) {
              _t8024 = Ref$set(pub_vars, ({_hd: [name, scheme], _tl: Ref$get(pub_vars)}));
              break _t8025;
            }
            if (true) {
              _t8024 = undefined;
              break _t8025;
            }
            _match_fail("line 16629");
          }
          _t8024;
          const _t8022 = [sub_ctx$p_8021, ({_tag: 0, _name: "TDLet", _val: [qualified_name_8002, te]})];
          const _t8020 = _t8022;
          _t8017 = _t8020;
          break _t8018;
        }
        _match_fail("line 16629");
      }
      const _t8003 = _t8017;
      _t7937 = _t8003;
      break _t7938;
    }
    if (_t7936._tag === 1) {
      const name = _t7936._val[0];
      const body = _t7936._val[1];
      const qualified_name_8026 = (prefix + name);
      const te_8028 = Typechecker$synth(sub_ctx, (level + 1), body);
      const scheme_8030 = Typechecker$mono_scheme(te_8028.ty);
      const sub_ctx$p_8032 = Typechecker$extend_var_mutable(sub_ctx, name, scheme_8030);
      const sub_ctx$p_8034 = Typechecker$extend_var_mutable(sub_ctx$p_8032, qualified_name_8026, scheme_8030);
      let _t8037;
      const _t8036 = item.vis;
      _t8038: {
        if (_t8036._tag === 0) {
          Ref$set(pub_vars, ({_hd: [name, scheme_8030], _tl: Ref$get(pub_vars)}));
          _t8037 = Ref$set(pub_mutable_vars, ({_hd: name, _tl: Ref$get(pub_mutable_vars)}));
          break _t8038;
        }
        if (true) {
          _t8037 = undefined;
          break _t8038;
        }
        _match_fail("line 16629");
      }
      _t8037;
      const _t8035 = [sub_ctx$p_8034, ({_tag: 1, _name: "TDLetMut", _val: [qualified_name_8026, te_8028]})];
      const _t8033 = _t8035;
      const _t8031 = _t8033;
      const _t8029 = _t8031;
      const _t8027 = _t8029;
      _t7937 = _t8027;
      break _t7938;
    }
    if (_t7936._tag === 2) {
      const name = _t7936._val[0];
      const type_params = _t7936._val[1];
      const params = _t7936._val[2];
      const ret_annot = _t7936._val[3];
      const constraints = _t7936._val[4];
      const body = _t7936._val[5];
      const qualified_name_8039 = (prefix + name);
      let _t8041;
      if (!_eq(type_params, null)) {
        _t8041 = Typechecker$synth_poly_rec_fn(sub_ctx, level, name, qualified_name_8039, type_params, params, ret_annot, body);
      } else {
        let _t8042;
        if (!_eq(constraints, null)) {
          const fn_var_8043 = Types$new_tvar((level + 1));
          const sub_ctx_self_8045 = Typechecker$extend_var_mono(sub_ctx, name, fn_var_8043);
          const sub_ctx_self_8047 = Typechecker$extend_var_mono(sub_ctx_self_8045, qualified_name_8039, fn_var_8043);
          let _t8050;
          const _t8049 = Typechecker$synth_constrained_fn(sub_ctx_self_8047, level, constraints, params, ret_annot, body);
          _t8051: {
            if (true) {
              const te = _t8049[0];
              const scheme = _t8049[1];
              Typechecker$try_unify(fn_var_8043, te.ty);
              _t8050 = [te, scheme];
              break _t8051;
            }
            _match_fail("line 16629");
          }
          const _t8048 = _t8050;
          const _t8046 = _t8048;
          const _t8044 = _t8046;
          _t8042 = _t8044;
        } else {
          const full_body_8052 = Typechecker$wrap_params_decl(params, ret_annot, body);
          const fn_var_8054 = Types$new_tvar((level + 1));
          const sub_ctx$p_8056 = Typechecker$extend_var_mono(sub_ctx, name, fn_var_8054);
          const sub_ctx$p_8058 = Typechecker$extend_var_mono(sub_ctx$p_8056, qualified_name_8039, fn_var_8054);
          const fn_te_8060 = Typechecker$synth(sub_ctx$p_8058, (level + 1), full_body_8052);
          Typechecker$try_unify(fn_var_8054, fn_te_8060.ty);
          Typechecker$improve_fundeps_in_expr(sub_ctx.vars, sub_ctx.type_env, fn_te_8060);
          const scheme_8062 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, fn_te_8060.ty, Hashtbl$create(0));
          const scheme_8064 = Typechecker$infer_implicit_constraints(name, sub_ctx.type_env, sub_ctx.vars, fn_te_8060, scheme_8062);
          const scheme_8066 = Typechecker$infer_record_evidence(sub_ctx.vars, fn_te_8060, scheme_8064);
          const _t8067 = [fn_te_8060, scheme_8066];
          const _t8065 = _t8067;
          const _t8063 = _t8065;
          const _t8061 = _t8063;
          const _t8059 = _t8061;
          const _t8057 = _t8059;
          const _t8055 = _t8057;
          const _t8053 = _t8055;
          _t8042 = _t8053;
        }
        _t8041 = _t8042;
      }
      let _t8069;
      const _t8068 = _t8041;
      _t8070: {
        if (true) {
          const fn_te = _t8068[0];
          const scheme = _t8068[1];
          const sub_ctx$p$p_8071 = Typechecker$extend_var(sub_ctx, name, scheme);
          const sub_ctx$p$p_8073 = Typechecker$extend_var(sub_ctx$p$p_8071, qualified_name_8039, scheme);
          let _t8076;
          const _t8075 = item.vis;
          _t8077: {
            if (_t8075._tag === 0) {
              _t8076 = Ref$set(pub_vars, ({_hd: [name, scheme], _tl: Ref$get(pub_vars)}));
              break _t8077;
            }
            if (true) {
              _t8076 = undefined;
              break _t8077;
            }
            _match_fail("line 16629");
          }
          _t8076;
          const _t8074 = [sub_ctx$p$p_8073, ({_tag: 2, _name: "TDLetRec", _val: [qualified_name_8039, fn_te]})];
          const _t8072 = _t8074;
          _t8069 = _t8072;
          break _t8070;
        }
        _match_fail("line 16629");
      }
      const _t8040 = _t8069;
      _t7937 = _t8040;
      break _t7938;
    }
    if (_t7936._tag === 7) {
      const name = _t7936._val[0];
      const tyvars = _t7936._val[1];
      const fundeps = _t7936._val[2];
      const methods = _t7936._val[3];
      const qualified_8078 = (prefix + name);
      let _t8081;
      const _t8080 = Typechecker$process_class_def(sub_ctx, qualified_8078, tyvars, fundeps, methods);
      _t8082: {
        if (true) {
          const sub_ctx$p = _t8080[0];
          const tdecl = _t8080[1];
          const __rec_upd_8083 = sub_ctx$p;
          const __rec_upd_8085 = sub_ctx$p.type_env;
          const _t8086 = ({classes: __rec_upd_8085.classes, constructors: __rec_upd_8085.constructors, effects: __rec_upd_8085.effects, hidden_ctor_types: __rec_upd_8085.hidden_ctor_types, hidden_types: __rec_upd_8085.hidden_types, instances: __rec_upd_8085.instances, modules: __rec_upd_8085.modules, mutable_fields: __rec_upd_8085.mutable_fields, newtypes: __rec_upd_8085.newtypes, records: __rec_upd_8085.records, type_aliases: ({_hd: [name, qualified_8078], _tl: sub_ctx$p.type_env.type_aliases}), type_synonyms: __rec_upd_8085.type_synonyms, variants: __rec_upd_8085.variants});
          const _t8084 = ({constraint_tvars: __rec_upd_8083.constraint_tvars, current_eff: __rec_upd_8083.current_eff, current_module: __rec_upd_8083.current_module, inside_handler: __rec_upd_8083.inside_handler, loop_info: __rec_upd_8083.loop_info, mutable_vars: __rec_upd_8083.mutable_vars, return_type: __rec_upd_8083.return_type, return_used: __rec_upd_8083.return_used, type_env: _t8086, vars: __rec_upd_8083.vars});
          const sub_ctx$p_8087 = _t8084;
          let _t8090;
          const _t8089 = item.vis;
          _t8091: {
            if (_t8089._tag === 0) {
              Ref$set(pub_classes, ({_hd: qualified_8078, _tl: Ref$get(pub_classes)}));
              function _t8092(__p266) {
                let _t8094;
                const _t8093 = __p266;
                _t8095: {
                  if (true) {
                    const mname = _t8093[0];
                    let _t8097;
                    const _t8096 = List$assoc_opt(mname, sub_ctx$p_8087.vars);
                    _t8098: {
                      if (_t8096._tag === 1) {
                        const scheme = _t8096._val;
                        _t8097 = Ref$set(pub_vars, ({_hd: [mname, scheme], _tl: Ref$get(pub_vars)}));
                        break _t8098;
                      }
                      if (_t8096._tag === 0) {
                        _t8097 = undefined;
                        break _t8098;
                      }
                      _match_fail("line 16629");
                    }
                    _t8094 = _t8097;
                    break _t8095;
                  }
                  _match_fail("line 16629");
                }
                return _t8094;
              }
              _t8090 = List$iter(_t8092, methods);
              break _t8091;
            }
            if (true) {
              _t8090 = undefined;
              break _t8091;
            }
            _match_fail("line 16629");
          }
          _t8090;
          const _t8088 = [sub_ctx$p_8087, tdecl];
          _t8081 = _t8088;
          break _t8082;
        }
        _match_fail("line 16629");
      }
      const _t8079 = _t8081;
      _t7937 = _t8079;
      break _t7938;
    }
    if (_t7936._tag === 8) {
      const class_name = _t7936._val[0];
      const inst_ty_annots = _t7936._val[1];
      const constraints = _t7936._val[2];
      const methods = _t7936._val[3];
      let _t8100;
      const _t8099 = Typechecker$process_instance_def(sub_ctx, level, class_name, inst_ty_annots, constraints, methods);
      _t8101: {
        if (true) {
          const sub_ctx$p = _t8099[0];
          const tdecl = _t8099[1];
          function _t8102(inst) {
            function _t8103(prev) {
              return (prev.inst_dict_name === inst.inst_dict_name);
            }
            return (!List$exists(_t8103, sub_ctx.type_env.instances));
          }
          const new_insts_8104 = List$filter(_t8102, sub_ctx$p.type_env.instances);
          Ref$set(all_instances, List$concat(new_insts_8104, Ref$get(all_instances)));
          const _t8105 = [sub_ctx$p, tdecl];
          _t8100 = _t8105;
          break _t8101;
        }
        _match_fail("line 16629");
      }
      _t7937 = _t8100;
      break _t7938;
    }
    if (_t7936._tag === 9) {
      const name = _t7936._val[0];
      const type_params = _t7936._val[1];
      const ops = _t7936._val[2];
      const tvars_8106 = Hashtbl$create(4);
      function _t8108(i, p) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_8106, p, ({_tag: 16, _name: "TGen", _val: i})]);
      }
      List$iteri(_t8108, type_params);
      function _t8109(__p267) {
        let _t8111;
        const _t8110 = __p267;
        _t8112: {
          if (true) {
            const op_name = _t8110[0];
            const annot = _t8110[1];
            const ty_8113 = Typechecker$resolve_ty_annot_shared(sub_ctx, 0, tvars_8106, annot);
            const _t8114 = [op_name, ty_8113];
            _t8111 = _t8114;
            break _t8112;
          }
          _match_fail("line 16629");
        }
        return _t8111;
      }
      const resolved_ops_8115 = List$map(_t8109, ops);
      const effect_def_8117 = ({effect_name: name, effect_ops: resolved_ops_8115, effect_params: type_params});
      const __rec_upd_8119 = sub_ctx.type_env;
      const _t8120 = ({classes: __rec_upd_8119.classes, constructors: __rec_upd_8119.constructors, effects: ({_hd: effect_def_8117, _tl: sub_ctx.type_env.effects}), hidden_ctor_types: __rec_upd_8119.hidden_ctor_types, hidden_types: __rec_upd_8119.hidden_types, instances: __rec_upd_8119.instances, modules: __rec_upd_8119.modules, mutable_fields: __rec_upd_8119.mutable_fields, newtypes: __rec_upd_8119.newtypes, records: __rec_upd_8119.records, type_aliases: __rec_upd_8119.type_aliases, type_synonyms: __rec_upd_8119.type_synonyms, variants: __rec_upd_8119.variants});
      const type_env_8121 = _t8120;
      const __rec_upd_8123 = sub_ctx;
      const _t8124 = ({constraint_tvars: __rec_upd_8123.constraint_tvars, current_eff: __rec_upd_8123.current_eff, current_module: __rec_upd_8123.current_module, inside_handler: __rec_upd_8123.inside_handler, loop_info: __rec_upd_8123.loop_info, mutable_vars: __rec_upd_8123.mutable_vars, return_type: __rec_upd_8123.return_type, return_used: __rec_upd_8123.return_used, type_env: type_env_8121, vars: __rec_upd_8123.vars});
      const sub_ctx$p_8125 = _t8124;
      const _t8126 = [sub_ctx$p_8125, ({_tag: 7, _name: "TDEffect", _val: name})];
      const _t8122 = _t8126;
      const _t8118 = _t8122;
      const _t8116 = _t8118;
      const _t8107 = _t8116;
      _t7937 = _t8107;
      break _t7938;
    }
    if (_t7936._tag === 10) {
      const name = _t7936._val[0];
      const ty_annot = _t7936._val[1];
      const qualified_name_8127 = (prefix + name);
      const tvars_8129 = Hashtbl$create(4);
      const ty_8131 = Typechecker$resolve_ty_annot_shared(sub_ctx, 1, tvars_8129, ty_annot);
      const scheme_8133 = Types$generalize(0, ty_8131);
      const sub_ctx$p_8135 = Typechecker$extend_var(sub_ctx, name, scheme_8133);
      const sub_ctx$p_8137 = Typechecker$extend_var(sub_ctx$p_8135, qualified_name_8127, scheme_8133);
      let _t8140;
      const _t8139 = item.vis;
      _t8141: {
        if (_t8139._tag === 0) {
          _t8140 = Ref$set(pub_vars, ({_hd: [name, scheme_8133], _tl: Ref$get(pub_vars)}));
          break _t8141;
        }
        if (true) {
          _t8140 = undefined;
          break _t8141;
        }
        _match_fail("line 16629");
      }
      _t8140;
      const _t8138 = [sub_ctx$p_8137, ({_tag: 8, _name: "TDExtern", _val: [qualified_name_8127, scheme_8133]})];
      const _t8136 = _t8138;
      const _t8134 = _t8136;
      const _t8132 = _t8134;
      const _t8130 = _t8132;
      const _t8128 = _t8130;
      _t7937 = _t8128;
      break _t7938;
    }
    if (_t7936._tag === 6) {
      const expr = _t7936._val;
      const te_8142 = Typechecker$synth(sub_ctx, level, expr);
      const _t8143 = [sub_ctx, ({_tag: 5, _name: "TDExpr", _val: te_8142})];
      _t7937 = _t8143;
      break _t7938;
    }
    if (_t7936._tag === 12) {
      const mod_name = _t7936._val[0];
      const names_opt = _t7936._val[1];
      const sub_ctx$p_8144 = Typechecker$open_module_into_ctx(sub_ctx, mod_name, names_opt);
      let _t8147;
      const _t8146 = Typechecker$find_module_in_env(sub_ctx.type_env, mod_name);
      _t8148: {
        if (_t8146._tag === 1) {
          const m = _t8146._val;
          _t8147 = m;
          break _t8148;
        }
        if (_t8146._tag === 0) {
          _t8147 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
          break _t8148;
        }
        _match_fail("line 16629");
      }
      const minfo_8149 = _t8147;
      function _t8151(qname) {
        function _t8152(c) {
          return (c.class_name === qname);
        }
        let _t8154;
        const _t8153 = List$find(_t8152, sub_ctx.type_env.classes);
        _t8155: {
          if (_t8153._tag === 1) {
            const cls = _t8153._val;
            _t8154 = List$map(fst, cls.class_methods);
            break _t8155;
          }
          if (_t8153._tag === 0) {
            _t8154 = null;
            break _t8155;
          }
          _match_fail("line 16629");
        }
        return _t8154;
      }
      const class_method_names_8156 = List$concat_map(_t8151, minfo_8149.mod_pub_classes);
      function _t8158(name) {
        let _t8160;
        const _t8159 = names_opt;
        _t8161: {
          if (_t8159._tag === 0) {
            _t8160 = true;
            break _t8161;
          }
          if (_t8159._tag === 1) {
            const names = _t8159._val;
            _t8160 = List$mem(name, names);
            break _t8161;
          }
          _match_fail("line 16629");
        }
        return _t8160;
      }
      const filter_8162 = _t8158;
      function _t8164(__p268) {
        let _t8166;
        const _t8165 = __p268;
        _t8167: {
          if (true) {
            const _mml$short = _t8165[0];
            const scheme = _t8165[1];
            let _t8168;
            if ((filter_8162(_mml$short) && (!List$mem(_mml$short, class_method_names_8156)))) {
              const qualified_dst_8169 = (prefix + _mml$short);
              const qualified_src_8171 = (mod_name + ("." + _mml$short));
              scheme;
              undefined;
              const _t8172 = ({_tag: 1, _name: "Some", _val: [qualified_dst_8169, qualified_src_8171]});
              const _t8170 = _t8172;
              _t8168 = _t8170;
            } else {
              _t8168 = ({_tag: 0, _name: "None"});
            }
            _t8166 = _t8168;
            break _t8167;
          }
          _match_fail("line 16629");
        }
        return _t8166;
      }
      const alias_pairs_8173 = List$filter_map(_t8164, minfo_8149.mod_pub_vars);
      function _t8175(ctx, __p269) {
        let _t8177;
        const _t8176 = __p269;
        _t8178: {
          if (true) {
            const _mml$short = _t8176[0];
            const scheme = _t8176[1];
            let _t8179;
            if ((filter_8162(_mml$short) && (!List$mem(_mml$short, class_method_names_8156)))) {
              _t8179 = Typechecker$extend_var(ctx, (prefix + _mml$short), scheme);
            } else {
              _t8179 = ctx;
            }
            _t8177 = _t8179;
            break _t8178;
          }
          _match_fail("line 16629");
        }
        return _t8177;
      }
      const sub_ctx$p_8180 = List$fold(_t8175, sub_ctx$p_8144, minfo_8149.mod_pub_vars);
      const _t8181 = [sub_ctx$p_8180, ({_tag: 10, _name: "TDOpen", _val: alias_pairs_8173})];
      const _t8174 = _t8181;
      const _t8163 = _t8174;
      const _t8157 = _t8163;
      const _t8150 = _t8157;
      const _t8145 = _t8150;
      _t7937 = _t8145;
      break _t7938;
    }
    if (_t7936._tag === 3) {
      const bindings = _t7936._val;
      function _t8182(__p270) {
        let _t8184;
        const _t8183 = __p270;
        _t8185: {
          if (true) {
            const tp = _t8183[1];
            _t8184 = !_eq(tp, null);
            break _t8185;
          }
          _match_fail("line 16629");
        }
        return _t8184;
      }
      const has_poly_8186 = List$exists(_t8182, bindings);
      let _t8188;
      if (has_poly_8186) {
        function _t8189(__p271) {
          let _t8191;
          const _t8190 = __p271;
          _t8192: {
            if (true) {
              const type_params = _t8190[1];
              const params = _t8190[2];
              const ret_annot = _t8190[3];
              const shared_tvars_8193 = Hashtbl$create(4);
              function _t8195(tp) {
                return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_8193, tp, Types$new_tvar((level + 1))]);
              }
              List$iter(_t8195, type_params);
              function _t8196(p) {
                let _t8198;
                const _t8197 = p.annot;
                _t8199: {
                  if (_t8197._tag === 1) {
                    const annot = _t8197._val;
                    _t8198 = Typechecker$resolve_ty_annot_shared(sub_ctx, (level + 1), shared_tvars_8193, annot);
                    break _t8199;
                  }
                  if (_t8197._tag === 0) {
                    _t8198 = Types$new_tvar((level + 1));
                    break _t8199;
                  }
                  _match_fail("line 16629");
                }
                return _t8198;
              }
              const param_tys_8200 = List$map(_t8196, params);
              let _t8203;
              const _t8202 = ret_annot;
              _t8204: {
                if (_t8202._tag === 1 && _t8202._val._tag === 10) {
                  const ty = _t8202._val._val[0];
                  const eff_annot = _t8202._val._val[1];
                  const ty$p_8205 = Typechecker$resolve_ty_annot_shared(sub_ctx, (level + 1), shared_tvars_8193, ty);
                  let _t8208;
                  const _t8207 = eff_annot;
                  _t8209: {
                    if (_t8207._tag === 0) {
                      _t8208 = ({_tag: 1, _name: "EffEmpty"});
                      break _t8209;
                    }
                    if (_t8207._tag === 1) {
                      const items = _t8207._val;
                      _t8208 = Typechecker$resolve_eff_items(sub_ctx, (level + 1), shared_tvars_8193, items);
                      break _t8209;
                    }
                    _match_fail("line 16629");
                  }
                  const eff_8210 = _t8208;
                  const _t8211 = [ty$p_8205, eff_8210];
                  const _t8206 = _t8211;
                  _t8203 = _t8206;
                  break _t8204;
                }
                if (_t8202._tag === 1) {
                  const annot = _t8202._val;
                  _t8203 = [Typechecker$resolve_ty_annot_shared(sub_ctx, (level + 1), shared_tvars_8193, annot), Types$new_effvar((level + 1))];
                  break _t8204;
                }
                if (_t8202._tag === 0) {
                  _t8203 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
                  break _t8204;
                }
                _match_fail("line 16629");
              }
              let _t8213;
              const _t8212 = _t8203;
              _t8214: {
                if (true) {
                  const ret_ty = _t8212[0];
                  const body_eff = _t8212[1];
                  let _t8216;
                  const _t8215 = List$rev(param_tys_8200);
                  _t8217: {
                    if (_t8215 === null) {
                      _t8216 = ret_ty;
                      break _t8217;
                    }
                    if (_t8215 !== null) {
                      const last = _t8215._hd;
                      const rest = _t8215._tl;
                      const inner_8218 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
                      function _t8220(acc, pty) {
                        return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
                      }
                      const _t8219 = List$fold(_t8220, inner_8218, rest);
                      _t8216 = _t8219;
                      break _t8217;
                    }
                    _match_fail("line 16629");
                  }
                  const fn_ty_8221 = _t8216;
                  const _t8222 = [shared_tvars_8193, param_tys_8200, ret_ty, body_eff, fn_ty_8221];
                  _t8213 = _t8222;
                  break _t8214;
                }
                _match_fail("line 16629");
              }
              const _t8201 = _t8213;
              const _t8194 = _t8201;
              _t8191 = _t8194;
              break _t8192;
            }
            _match_fail("line 16629");
          }
          return _t8191;
        }
        const shared_tvars_list_8223 = List$map(_t8189, bindings);
        function _t8225(__p272) {
          let _t8227;
          const _t8226 = __p272;
          _t8228: {
            if (true) {
              const fn_ty = _t8226[4];
              _t8227 = Types$generalize(level, fn_ty);
              break _t8228;
            }
            _match_fail("line 16629");
          }
          return _t8227;
        }
        const schemes_8229 = List$map(_t8225, shared_tvars_list_8223);
        function _t8231(ctx, __p273, scheme) {
          let _t8233;
          const _t8232 = __p273;
          _t8234: {
            if (true) {
              const name = _t8232[0];
              const qualified_name_8235 = (prefix + name);
              const ctx_8237 = Typechecker$extend_var(ctx, name, scheme);
              const _t8238 = Typechecker$extend_var(ctx_8237, qualified_name_8235, scheme);
              const _t8236 = _t8238;
              _t8233 = _t8236;
              break _t8234;
            }
            _match_fail("line 16629");
          }
          return _t8233;
        }
        const sub_ctx$p_8239 = List$fold2(_t8231, sub_ctx, bindings, schemes_8229);
        function _t8241(__p274, __p275) {
          let _t8243;
          const _t8242 = __p274;
          _t8244: {
            if (true) {
              const params = _t8242[2];
              const body = _t8242[5];
              let _t8246;
              const _t8245 = __p275;
              _t8247: {
                if (true) {
                  const param_tys = _t8245[1];
                  const ret_ty = _t8245[2];
                  const body_eff = _t8245[3];
                  function _t8248(c, p, ty) {
                    return Typechecker$extend_var_mono(c, p.name, ty);
                  }
                  const __rec_upd_8249 = sub_ctx$p_8239;
                  const _t8250 = ({constraint_tvars: __rec_upd_8249.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_8249.current_module, inside_handler: __rec_upd_8249.inside_handler, loop_info: __rec_upd_8249.loop_info, mutable_vars: __rec_upd_8249.mutable_vars, return_type: __rec_upd_8249.return_type, return_used: __rec_upd_8249.return_used, type_env: __rec_upd_8249.type_env, vars: __rec_upd_8249.vars});
                  const inner_ctx_8251 = List$fold2(_t8248, _t8250, params, param_tys);
                  const body_te_8253 = Typechecker$check(inner_ctx_8251, (level + 1), body, ret_ty);
                  let _t8256;
                  const _t8255 = [List$rev(params), List$rev(param_tys)];
                  _t8257: {
                    if (_t8255[0] === null && _t8255[1] === null) {
                      _t8256 = body_te_8253;
                      break _t8257;
                    }
                    if (_t8255[0] !== null && _t8255[1] !== null) {
                      const last_p = _t8255[0]._hd;
                      const rest_ps = _t8255[0]._tl;
                      const last_pty = _t8255[1]._hd;
                      const rest_ptys = _t8255[1]._tl;
                      const inner_8258 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_8253, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_8253.ty]}));
                      function _t8260(acc, p, pty) {
                        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
                      }
                      const _t8259 = List$fold2(_t8260, inner_8258, rest_ps, rest_ptys);
                      _t8256 = _t8259;
                      break _t8257;
                    }
                    if (true) {
                      _t8256 = failwith("assert false");
                      break _t8257;
                    }
                    _match_fail("line 16629");
                  }
                  const _t8254 = _t8256;
                  const _t8252 = _t8254;
                  _t8246 = _t8252;
                  break _t8247;
                }
                _match_fail("line 16629");
              }
              _t8243 = _t8246;
              break _t8244;
            }
            _match_fail("line 16629");
          }
          return _t8243;
        }
        const body_tes_8261 = List$map2(_t8241, bindings, shared_tvars_list_8223);
        function _t8263(ctx, __p276, scheme) {
          let _t8265;
          const _t8264 = __p276;
          _t8266: {
            if (true) {
              const name = _t8264[0];
              const qualified_name_8267 = (prefix + name);
              const ctx_8269 = Typechecker$extend_var(ctx, name, scheme);
              const _t8270 = Typechecker$extend_var(ctx_8269, qualified_name_8267, scheme);
              const _t8268 = _t8270;
              _t8265 = _t8268;
              break _t8266;
            }
            _match_fail("line 16629");
          }
          return _t8265;
        }
        const sub_ctx$p$p_8271 = List$fold2(_t8263, sub_ctx, bindings, schemes_8229);
        function _t8273(__p277, te) {
          let _t8275;
          const _t8274 = __p277;
          _t8276: {
            if (true) {
              const name = _t8274[0];
              const qualified_name_8277 = (prefix + name);
              const _t8278 = [qualified_name_8277, te];
              _t8275 = _t8278;
              break _t8276;
            }
            _match_fail("line 16629");
          }
          return _t8275;
        }
        const typed_bindings_8279 = List$map2(_t8273, bindings, body_tes_8261);
        function _t8281(__p278) {
          let _t8283;
          const _t8282 = __p278;
          _t8284: {
            if (true) {
              const name = _t8282[0];
              function _t8285(__p279, s) {
                let _t8287;
                const _t8286 = __p279;
                _t8288: {
                  if (true) {
                    const n = _t8286[0];
                    _t8287 = [n, s];
                    break _t8288;
                  }
                  _match_fail("line 16629");
                }
                return _t8287;
              }
              const scheme_8289 = List$assoc(name, List$map2(_t8285, bindings, schemes_8229));
              let _t8292;
              const _t8291 = item.vis;
              _t8293: {
                if (_t8291._tag === 0) {
                  _t8292 = Ref$set(pub_vars, ({_hd: [name, scheme_8289], _tl: Ref$get(pub_vars)}));
                  break _t8293;
                }
                if (true) {
                  _t8292 = undefined;
                  break _t8293;
                }
                _match_fail("line 16629");
              }
              const _t8290 = _t8292;
              _t8283 = _t8290;
              break _t8284;
            }
            _match_fail("line 16629");
          }
          return _t8283;
        }
        List$iter(_t8281, bindings);
        const _t8280 = [sub_ctx$p$p_8271, ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_8279})];
        const _t8272 = _t8280;
        const _t8262 = _t8272;
        const _t8240 = _t8262;
        const _t8230 = _t8240;
        const _t8224 = _t8230;
        _t8188 = _t8224;
      } else {
        function _t8294(__p280) {
          let _t8296;
          const _t8295 = __p280;
          _t8297: {
            if (true) {
              const name = _t8295[0];
              _t8296 = [name, Types$new_tvar((level + 1))];
              break _t8297;
            }
            _match_fail("line 16629");
          }
          return _t8296;
        }
        const fn_vars_8298 = List$map(_t8294, bindings);
        function _t8300(ctx, __p281) {
          let _t8302;
          const _t8301 = __p281;
          _t8303: {
            if (true) {
              const name = _t8301[0];
              const tv = _t8301[1];
              const qualified_name_8304 = (prefix + name);
              const ctx_8306 = Typechecker$extend_var_mono(ctx, name, tv);
              const _t8307 = Typechecker$extend_var_mono(ctx_8306, qualified_name_8304, tv);
              const _t8305 = _t8307;
              _t8302 = _t8305;
              break _t8303;
            }
            _match_fail("line 16629");
          }
          return _t8302;
        }
        const sub_ctx$p_8308 = List$fold(_t8300, sub_ctx, fn_vars_8298);
        function _t8310(__p282, __p283) {
          let _t8312;
          const _t8311 = __p282;
          _t8313: {
            if (true) {
              const name = _t8311[0];
              const params = _t8311[2];
              const ret_annot = _t8311[3];
              const constraints = _t8311[4];
              const body = _t8311[5];
              let _t8315;
              const _t8314 = __p283;
              _t8316: {
                if (true) {
                  const tv = _t8314[1];
                  name;
                  undefined;
                  let _t8317;
                  if (!_eq(constraints, null)) {
                    let _t8319;
                    const _t8318 = Typechecker$synth_constrained_fn(sub_ctx$p_8308, level, constraints, params, ret_annot, body);
                    _t8320: {
                      if (true) {
                        const te = _t8318[0];
                        const _scheme = _t8318[1];
                        Typechecker$try_unify(tv, te.ty);
                        _t8319 = te;
                        break _t8320;
                      }
                      _match_fail("line 16629");
                    }
                    _t8317 = _t8319;
                  } else {
                    const full_body_8321 = Typechecker$wrap_params_decl(params, ret_annot, body);
                    const te_8323 = Typechecker$synth(sub_ctx$p_8308, (level + 1), full_body_8321);
                    Typechecker$try_unify(tv, te_8323.ty);
                    const _t8324 = te_8323;
                    const _t8322 = _t8324;
                    _t8317 = _t8322;
                  }
                  _t8315 = _t8317;
                  break _t8316;
                }
                _match_fail("line 16629");
              }
              _t8312 = _t8315;
              break _t8313;
            }
            _match_fail("line 16629");
          }
          return _t8312;
        }
        const body_tes_8325 = List$map2(_t8310, bindings, fn_vars_8298);
        function _t8327(ctx, __p284, __p285) {
          let _t8329;
          const _t8328 = __p284;
          _t8330: {
            if (true) {
              const name = _t8328[0];
              let _t8332;
              const _t8331 = __p285;
              _t8333: {
                if (true) {
                  const tv = _t8331[1];
                  const qualified_name_8334 = (prefix + name);
                  const scheme_8336 = Types$generalize(level, tv);
                  const ctx_8338 = Typechecker$extend_var(ctx, name, scheme_8336);
                  const _t8339 = Typechecker$extend_var(ctx_8338, qualified_name_8334, scheme_8336);
                  const _t8337 = _t8339;
                  const _t8335 = _t8337;
                  _t8332 = _t8335;
                  break _t8333;
                }
                _match_fail("line 16629");
              }
              _t8329 = _t8332;
              break _t8330;
            }
            _match_fail("line 16629");
          }
          return _t8329;
        }
        const sub_ctx$p$p_8340 = List$fold2(_t8327, sub_ctx, bindings, fn_vars_8298);
        function _t8342(__p286, te) {
          let _t8344;
          const _t8343 = __p286;
          _t8345: {
            if (true) {
              const name = _t8343[0];
              const qualified_name_8346 = (prefix + name);
              const _t8347 = [qualified_name_8346, te];
              _t8344 = _t8347;
              break _t8345;
            }
            _match_fail("line 16629");
          }
          return _t8344;
        }
        const typed_bindings_8348 = List$map2(_t8342, bindings, body_tes_8325);
        function _t8350(__p287, __p288) {
          let _t8352;
          const _t8351 = __p287;
          _t8353: {
            if (true) {
              const name = _t8351[0];
              let _t8355;
              const _t8354 = __p288;
              _t8356: {
                if (true) {
                  const tv = _t8354[1];
                  const scheme_8357 = Types$generalize(level, tv);
                  let _t8360;
                  const _t8359 = item.vis;
                  _t8361: {
                    if (_t8359._tag === 0) {
                      _t8360 = Ref$set(pub_vars, ({_hd: [name, scheme_8357], _tl: Ref$get(pub_vars)}));
                      break _t8361;
                    }
                    if (true) {
                      _t8360 = undefined;
                      break _t8361;
                    }
                    _match_fail("line 16629");
                  }
                  const _t8358 = _t8360;
                  _t8355 = _t8358;
                  break _t8356;
                }
                _match_fail("line 16629");
              }
              _t8352 = _t8355;
              break _t8353;
            }
            _match_fail("line 16629");
          }
          return _t8352;
        }
        List$iter2(_t8350, bindings, fn_vars_8298);
        const _t8349 = [sub_ctx$p$p_8340, ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_8348})];
        const _t8341 = _t8349;
        const _t8326 = _t8341;
        const _t8309 = _t8326;
        const _t8299 = _t8309;
        _t8188 = _t8299;
      }
      const _t8187 = _t8188;
      _t7937 = _t8187;
      break _t7938;
    }
    if (_t7936._tag === 5) {
      const type_defs = _t7936._val;
      function _t8362(ctx, __p289) {
        let _t8364;
        const _t8363 = __p289;
        _t8365: {
          if (true) {
            const type_params = _t8363[0];
            const name = _t8363[1];
            const def = _t8363[2];
            const _deriving = _t8363[3];
            const qualified_name_8366 = (prefix + name);
            const num_params_8368 = List$length(type_params);
            const __rec_upd_8370 = ctx;
            const __rec_upd_8372 = ctx.type_env;
            const _t8373 = ({classes: __rec_upd_8372.classes, constructors: __rec_upd_8372.constructors, effects: __rec_upd_8372.effects, hidden_ctor_types: __rec_upd_8372.hidden_ctor_types, hidden_types: __rec_upd_8372.hidden_types, instances: __rec_upd_8372.instances, modules: __rec_upd_8372.modules, mutable_fields: __rec_upd_8372.mutable_fields, newtypes: __rec_upd_8372.newtypes, records: __rec_upd_8372.records, type_aliases: ({_hd: [name, qualified_name_8366], _tl: ctx.type_env.type_aliases}), type_synonyms: __rec_upd_8372.type_synonyms, variants: __rec_upd_8372.variants});
            const _t8371 = ({constraint_tvars: __rec_upd_8370.constraint_tvars, current_eff: __rec_upd_8370.current_eff, current_module: __rec_upd_8370.current_module, inside_handler: __rec_upd_8370.inside_handler, loop_info: __rec_upd_8370.loop_info, mutable_vars: __rec_upd_8370.mutable_vars, return_type: __rec_upd_8370.return_type, return_used: __rec_upd_8370.return_used, type_env: _t8373, vars: __rec_upd_8370.vars});
            const ctx_8374 = _t8371;
            let _t8377;
            const _t8376 = def;
            _t8378: {
              if (_t8376._tag === 0) {
                const __rec_upd_8379 = ctx_8374;
                const __rec_upd_8381 = ctx_8374.type_env;
                const _t8382 = ({classes: __rec_upd_8381.classes, constructors: __rec_upd_8381.constructors, effects: __rec_upd_8381.effects, hidden_ctor_types: __rec_upd_8381.hidden_ctor_types, hidden_types: __rec_upd_8381.hidden_types, instances: __rec_upd_8381.instances, modules: __rec_upd_8381.modules, mutable_fields: __rec_upd_8381.mutable_fields, newtypes: __rec_upd_8381.newtypes, records: __rec_upd_8381.records, type_aliases: __rec_upd_8381.type_aliases, type_synonyms: __rec_upd_8381.type_synonyms, variants: ({_hd: [qualified_name_8366, num_params_8368, null, false], _tl: ctx_8374.type_env.variants})});
                const _t8380 = ({constraint_tvars: __rec_upd_8379.constraint_tvars, current_eff: __rec_upd_8379.current_eff, current_module: __rec_upd_8379.current_module, inside_handler: __rec_upd_8379.inside_handler, loop_info: __rec_upd_8379.loop_info, mutable_vars: __rec_upd_8379.mutable_vars, return_type: __rec_upd_8379.return_type, return_used: __rec_upd_8379.return_used, type_env: _t8382, vars: __rec_upd_8379.vars});
                _t8377 = _t8380;
                break _t8378;
              }
              if (_t8376._tag === 1) {
                const __rec_upd_8383 = ctx_8374;
                const __rec_upd_8385 = ctx_8374.type_env;
                const _t8386 = ({classes: __rec_upd_8385.classes, constructors: __rec_upd_8385.constructors, effects: __rec_upd_8385.effects, hidden_ctor_types: __rec_upd_8385.hidden_ctor_types, hidden_types: __rec_upd_8385.hidden_types, instances: __rec_upd_8385.instances, modules: __rec_upd_8385.modules, mutable_fields: __rec_upd_8385.mutable_fields, newtypes: __rec_upd_8385.newtypes, records: ({_hd: [qualified_name_8366, null], _tl: ctx_8374.type_env.records}), type_aliases: __rec_upd_8385.type_aliases, type_synonyms: __rec_upd_8385.type_synonyms, variants: __rec_upd_8385.variants});
                const _t8384 = ({constraint_tvars: __rec_upd_8383.constraint_tvars, current_eff: __rec_upd_8383.current_eff, current_module: __rec_upd_8383.current_module, inside_handler: __rec_upd_8383.inside_handler, loop_info: __rec_upd_8383.loop_info, mutable_vars: __rec_upd_8383.mutable_vars, return_type: __rec_upd_8383.return_type, return_used: __rec_upd_8383.return_used, type_env: _t8386, vars: __rec_upd_8383.vars});
                _t8377 = _t8384;
                break _t8378;
              }
              if (_t8376._tag === 2) {
                _t8377 = ctx_8374;
                break _t8378;
              }
              if (_t8376._tag === 3) {
                const __rec_upd_8387 = ctx_8374;
                const __rec_upd_8389 = ctx_8374.type_env;
                const _t8390 = ({classes: __rec_upd_8389.classes, constructors: __rec_upd_8389.constructors, effects: __rec_upd_8389.effects, hidden_ctor_types: __rec_upd_8389.hidden_ctor_types, hidden_types: __rec_upd_8389.hidden_types, instances: __rec_upd_8389.instances, modules: __rec_upd_8389.modules, mutable_fields: __rec_upd_8389.mutable_fields, newtypes: __rec_upd_8389.newtypes, records: __rec_upd_8389.records, type_aliases: __rec_upd_8389.type_aliases, type_synonyms: __rec_upd_8389.type_synonyms, variants: ({_hd: [qualified_name_8366, num_params_8368, null, false], _tl: ctx_8374.type_env.variants})});
                const _t8388 = ({constraint_tvars: __rec_upd_8387.constraint_tvars, current_eff: __rec_upd_8387.current_eff, current_module: __rec_upd_8387.current_module, inside_handler: __rec_upd_8387.inside_handler, loop_info: __rec_upd_8387.loop_info, mutable_vars: __rec_upd_8387.mutable_vars, return_type: __rec_upd_8387.return_type, return_used: __rec_upd_8387.return_used, type_env: _t8390, vars: __rec_upd_8387.vars});
                _t8377 = _t8388;
                break _t8378;
              }
              _match_fail("line 16629");
            }
            const _t8375 = _t8377;
            const _t8369 = _t8375;
            const _t8367 = _t8369;
            _t8364 = _t8367;
            break _t8365;
          }
          _match_fail("line 16629");
        }
        return _t8364;
      }
      const sub_ctx$p_8391 = List$fold(_t8362, sub_ctx, type_defs);
      function _t8393(ctx, __p290) {
        let _t8395;
        const _t8394 = __p290;
        _t8396: {
          if (true) {
            const type_params = _t8394[0];
            const name = _t8394[1];
            const def = _t8394[2];
            const _deriving = _t8394[3];
            let _t8398;
            const _t8397 = def;
            _t8399: {
              if (_t8397._tag === 1) {
                const qualified_name_8400 = (prefix + name);
                const _t8401 = Typechecker$process_type_def(ctx, type_params, qualified_name_8400, def);
                _t8398 = _t8401;
                break _t8399;
              }
              if (true) {
                _t8398 = ctx;
                break _t8399;
              }
              _match_fail("line 16629");
            }
            _t8395 = _t8398;
            break _t8396;
          }
          _match_fail("line 16629");
        }
        return _t8395;
      }
      const sub_ctx$p_8402 = List$fold(_t8393, sub_ctx$p_8391, type_defs);
      function _t8404(ctx, __p291) {
        let _t8406;
        const _t8405 = __p291;
        _t8407: {
          if (true) {
            const type_params = _t8405[0];
            const name = _t8405[1];
            const def = _t8405[2];
            const _deriving = _t8405[3];
            let _t8409;
            const _t8408 = def;
            _t8410: {
              if (_t8408._tag === 1) {
                _t8409 = ctx;
                break _t8410;
              }
              if (true) {
                const qualified_name_8411 = (prefix + name);
                const _t8412 = Typechecker$process_type_def(ctx, type_params, qualified_name_8411, def);
                _t8409 = _t8412;
                break _t8410;
              }
              _match_fail("line 16629");
            }
            _t8406 = _t8409;
            break _t8407;
          }
          _match_fail("line 16629");
        }
        return _t8406;
      }
      const sub_ctx$p_8413 = List$fold(_t8404, sub_ctx$p_8402, type_defs);
      function _t8415(__p292) {
        let _t8417;
        const _t8416 = __p292;
        _t8418: {
          if (true) {
            const _type_params = _t8416[0];
            const name = _t8416[1];
            const def = _t8416[2];
            const _deriving = _t8416[3];
            const qualified_name_8419 = (prefix + name);
            let _t8422;
            const _t8421 = item.vis;
            _t8423: {
              if (_t8421._tag === 0) {
                Ref$set(pub_types, ({_hd: qualified_name_8419, _tl: Ref$get(pub_types)}));
                let _t8425;
                const _t8424 = def;
                _t8426: {
                  if (_t8424._tag === 0) {
                    const ctors = _t8424._val;
                    function _t8427(__p293) {
                      let _t8429;
                      const _t8428 = __p293;
                      _t8430: {
                        if (true) {
                          const ctor_name = _t8428[0];
                          let _t8432;
                          const _t8431 = List$assoc_opt(ctor_name, sub_ctx$p_8413.type_env.constructors);
                          _t8433: {
                            if (_t8431._tag === 1) {
                              const info = _t8431._val;
                              const __rec_upd_8434 = info;
                              const _t8435 = ({ctor_arg_ty: __rec_upd_8434.ctor_arg_ty, ctor_existentials: __rec_upd_8434.ctor_existentials, ctor_num_params: __rec_upd_8434.ctor_num_params, ctor_return_ty_params: __rec_upd_8434.ctor_return_ty_params, ctor_type_name: qualified_name_8419});
                              const qual_info_8436 = _t8435;
                              const _t8437 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_8436], _tl: Ref$get(pub_constructors)}));
                              _t8432 = _t8437;
                              break _t8433;
                            }
                            if (_t8431._tag === 0) {
                              _t8432 = undefined;
                              break _t8433;
                            }
                            _match_fail("line 16629");
                          }
                          _t8429 = _t8432;
                          break _t8430;
                        }
                        _match_fail("line 16629");
                      }
                      return _t8429;
                    }
                    _t8425 = List$iter(_t8427, ctors);
                    break _t8426;
                  }
                  if (_t8424._tag === 3) {
                    const ctor_name = _t8424._val[0];
                    Ref$set(newtypes, ({_hd: qualified_name_8419, _tl: Ref$get(newtypes)}));
                    let _t8439;
                    const _t8438 = List$assoc_opt(ctor_name, sub_ctx$p_8413.type_env.constructors);
                    _t8440: {
                      if (_t8438._tag === 1) {
                        const info = _t8438._val;
                        const __rec_upd_8441 = info;
                        const _t8442 = ({ctor_arg_ty: __rec_upd_8441.ctor_arg_ty, ctor_existentials: __rec_upd_8441.ctor_existentials, ctor_num_params: __rec_upd_8441.ctor_num_params, ctor_return_ty_params: __rec_upd_8441.ctor_return_ty_params, ctor_type_name: qualified_name_8419});
                        const qual_info_8443 = _t8442;
                        const _t8444 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_8443], _tl: Ref$get(pub_constructors)}));
                        _t8439 = _t8444;
                        break _t8440;
                      }
                      if (_t8438._tag === 0) {
                        _t8439 = undefined;
                        break _t8440;
                      }
                      _match_fail("line 16629");
                    }
                    _t8425 = _t8439;
                    break _t8426;
                  }
                  if ((_t8424._tag === 1 || _t8424._tag === 2)) {
                    _t8425 = undefined;
                    break _t8426;
                  }
                  _match_fail("line 16629");
                }
                _t8422 = _t8425;
                break _t8423;
              }
              if (_t8421._tag === 2) {
                Ref$set(pub_types, ({_hd: qualified_name_8419, _tl: Ref$get(pub_types)}));
                Ref$set(opaque_types, ({_hd: qualified_name_8419, _tl: Ref$get(opaque_types)}));
                let _t8446;
                const _t8445 = def;
                _t8447: {
                  if (_t8445._tag === 3) {
                    _t8446 = Ref$set(newtypes, ({_hd: qualified_name_8419, _tl: Ref$get(newtypes)}));
                    break _t8447;
                  }
                  if (true) {
                    _t8446 = undefined;
                    break _t8447;
                  }
                  _match_fail("line 16629");
                }
                _t8422 = _t8446;
                break _t8423;
              }
              if (_t8421._tag === 1) {
                let _t8449;
                const _t8448 = def;
                _t8450: {
                  if (_t8448._tag === 3) {
                    _t8449 = Ref$set(newtypes, ({_hd: qualified_name_8419, _tl: Ref$get(newtypes)}));
                    break _t8450;
                  }
                  if (true) {
                    _t8449 = undefined;
                    break _t8450;
                  }
                  _match_fail("line 16629");
                }
                _t8422 = _t8449;
                break _t8423;
              }
              _match_fail("line 16629");
            }
            const _t8420 = _t8422;
            _t8417 = _t8420;
            break _t8418;
          }
          _match_fail("line 16629");
        }
        return _t8417;
      }
      List$iter(_t8415, type_defs);
      function _t8451(ctx, __p294) {
        let _t8453;
        const _t8452 = __p294;
        _t8454: {
          if (true) {
            const type_params = _t8452[0];
            const name = _t8452[1];
            const def = _t8452[2];
            const deriving_ = _t8452[3];
            function _t8455(ctx, cls) {
              let _t8457;
              const _t8456 = Typechecker$generate_derived_instance(type_params, name, def, cls);
              _t8458: {
                if (_t8456._tag === 1) {
                  const class_name = _t8456._val[0];
                  const inst_tys = _t8456._val[1];
                  const constraints = _t8456._val[2];
                  const methods = _t8456._val[3];
                  let _t8460;
                  const _t8459 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
                  _t8461: {
                    if (true) {
                      const ctx$p = _t8459[0];
                      const tdecl = _t8459[1];
                      Ref$set(typed_decls, ({_hd: tdecl, _tl: Ref$get(typed_decls)}));
                      Ref$set(all_instances, ctx$p.type_env.instances);
                      _t8460 = ctx$p;
                      break _t8461;
                    }
                    _match_fail("line 16629");
                  }
                  _t8457 = _t8460;
                  break _t8458;
                }
                if (_t8456._tag === 0) {
                  _t8457 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
                  break _t8458;
                }
                _match_fail("line 16629");
              }
              return _t8457;
            }
            _t8453 = List$fold(_t8455, ctx, deriving_);
            break _t8454;
          }
          _match_fail("line 16629");
        }
        return _t8453;
      }
      const sub_ctx$p_8462 = List$fold(_t8451, sub_ctx$p_8413, type_defs);
      function _t8464(__p295) {
        let _t8466;
        const _t8465 = __p295;
        _t8467: {
          if (true) {
            const _tp = _t8465[0];
            const name = _t8465[1];
            const def = _t8465[2];
            const _d = _t8465[3];
            _t8466 = ({_tag: 4, _name: "TDType", _val: [(prefix + name), def]});
            break _t8467;
          }
          _match_fail("line 16629");
        }
        return _t8466;
      }
      const type_decls_8468 = List$map(_t8464, type_defs);
      function push_all_but_last(__x) {
        while (true) {
          let _t8471;
          const _t8470 = __x;
          _t8472: {
            if (_t8470 === null) {
              _t8471 = failwith("empty DTypeAnd");
              break _t8472;
            }
            if (_t8470 !== null && _t8470._tl === null) {
              const last = _t8470._hd;
              _t8471 = last;
              break _t8472;
            }
            if (_t8470 !== null) {
              const hd = _t8470._hd;
              const tl = _t8470._tl;
              Ref$set(typed_decls, ({_hd: hd, _tl: Ref$get(typed_decls)}));
              const _t8473 = tl;
              __x = _t8473;
              continue;
              _t8471 = undefined;
              break _t8472;
            }
            _match_fail("line 16629");
          }
          return _t8471;
        }
      }
      const last_tdecl_8475 = push_all_but_last(type_decls_8468);
      const _t8476 = [sub_ctx$p_8462, last_tdecl_8475];
      const _t8474 = _t8476;
      const _t8469 = _t8474;
      const _t8463 = _t8469;
      const _t8414 = _t8463;
      const _t8403 = _t8414;
      const _t8392 = _t8403;
      _t7937 = _t8392;
      break _t7938;
    }
    _match_fail("line 16629");
  }
  const _t7935 = _t7937;
  return _t7935;
}
function Typechecker$process_open(ctx, mod_name, names_opt) {
  let _t8478;
  const _t8477 = Typechecker$find_module_in_env(ctx.type_env, mod_name);
  _t8479: {
    if (_t8477._tag === 1) {
      const m = _t8477._val;
      _t8478 = m;
      break _t8479;
    }
    if (_t8477._tag === 0) {
      _t8478 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
      break _t8479;
    }
    _match_fail("line 16629");
  }
  const minfo_8480 = _t8478;
  function _t8482(qname) {
    function _t8483(c) {
      return (c.class_name === qname);
    }
    let _t8485;
    const _t8484 = List$find(_t8483, ctx.type_env.classes);
    _t8486: {
      if (_t8484._tag === 1) {
        const cls = _t8484._val;
        _t8485 = List$map(fst, cls.class_methods);
        break _t8486;
      }
      if (_t8484._tag === 0) {
        _t8485 = null;
        break _t8486;
      }
      _match_fail("line 16629");
    }
    return _t8485;
  }
  const class_method_names_8487 = List$concat_map(_t8482, minfo_8480.mod_pub_classes);
  const alias_pairs_8489 = Ref$create(null);
  function _t8491(name) {
    let _t8493;
    const _t8492 = names_opt;
    _t8494: {
      if (_t8492._tag === 0) {
        _t8493 = true;
        break _t8494;
      }
      if (_t8492._tag === 1) {
        const names = _t8492._val;
        _t8493 = List$mem(name, names);
        break _t8494;
      }
      _match_fail("line 16629");
    }
    return _t8493;
  }
  const filter_8495 = _t8491;
  function _t8497(__p296) {
    let _t8499;
    const _t8498 = __p296;
    _t8500: {
      if (true) {
        const _mml$short = _t8498[0];
        const _scheme = _t8498[1];
        let _t8501;
        if ((filter_8495(_mml$short) && (!List$mem(_mml$short, class_method_names_8487)))) {
          const qualified_8502 = (mod_name + ("." + _mml$short));
          const _t8503 = Ref$set(alias_pairs_8489, ({_hd: [_mml$short, qualified_8502], _tl: Ref$get(alias_pairs_8489)}));
          _t8501 = _t8503;
        } else {
          _t8501 = undefined;
        }
        _t8499 = _t8501;
        break _t8500;
      }
      _match_fail("line 16629");
    }
    return _t8499;
  }
  List$iter(_t8497, minfo_8480.mod_pub_vars);
  const ctx$p_8504 = Typechecker$open_module_into_ctx(ctx, mod_name, names_opt);
  const _t8505 = [ctx$p_8504, ({_tag: 10, _name: "TDOpen", _val: Ref$get(alias_pairs_8489)})];
  const _t8496 = _t8505;
  const _t8490 = _t8496;
  const _t8488 = _t8490;
  const _t8481 = _t8488;
  return _t8481;
}
function Typechecker$check_decl(ctx, level, decl) {
  let _t8507;
  const _t8506 = decl;
  _t8508: {
    if (_t8506._tag === 4) {
      const type_params = _t8506._val[0];
      const name = _t8506._val[1];
      const def = _t8506._val[2];
      const deriving_ = _t8506._val[3];
      const ctx$p_8509 = Typechecker$process_type_def(ctx, type_params, name, def);
      function _t8511(__p297, cls) {
        let _t8513;
        const _t8512 = __p297;
        _t8514: {
          if (true) {
            const ctx = _t8512[0];
            const acc = _t8512[1];
            let _t8516;
            const _t8515 = Typechecker$generate_derived_instance(type_params, name, def, cls);
            _t8517: {
              if (_t8515._tag === 1) {
                const class_name = _t8515._val[0];
                const inst_tys = _t8515._val[1];
                const constraints = _t8515._val[2];
                const methods = _t8515._val[3];
                let _t8519;
                const _t8518 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
                _t8520: {
                  if (true) {
                    const ctx$p = _t8518[0];
                    const tdecl = _t8518[1];
                    _t8519 = [ctx$p, ({_hd: tdecl, _tl: acc})];
                    break _t8520;
                  }
                  _match_fail("line 16629");
                }
                _t8516 = _t8519;
                break _t8517;
              }
              if (_t8515._tag === 0) {
                _t8516 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
                break _t8517;
              }
              _match_fail("line 16629");
            }
            _t8513 = _t8516;
            break _t8514;
          }
          _match_fail("line 16629");
        }
        return _t8513;
      }
      let _t8522;
      const _t8521 = List$fold(_t8511, [ctx$p_8509, null], deriving_);
      _t8523: {
        if (true) {
          const ctx$p = _t8521[0];
          const derived_tdecls = _t8521[1];
          _t8522 = [ctx$p, ({_hd: ({_tag: 4, _name: "TDType", _val: [name, def]}), _tl: List$rev(derived_tdecls)})];
          break _t8523;
        }
        _match_fail("line 16629");
      }
      const _t8510 = _t8522;
      _t8507 = _t8510;
      break _t8508;
    }
    if (_t8506._tag === 0) {
      const name = _t8506._val[0];
      const params = _t8506._val[1];
      const ret_annot = _t8506._val[2];
      const constraints = _t8506._val[3];
      const body = _t8506._val[4];
      let _t8524;
      if (!_eq(constraints, null)) {
        let _t8526;
        const _t8525 = Typechecker$synth_constrained_fn(ctx, level, constraints, params, ret_annot, body);
        _t8527: {
          if (true) {
            const te = _t8525[0];
            const scheme = _t8525[1];
            const ctx$p_8528 = Typechecker$extend_var(ctx, name, scheme);
            const _t8529 = [ctx$p_8528, ({_hd: ({_tag: 0, _name: "TDLet", _val: [name, te]}), _tl: null})];
            _t8526 = _t8529;
            break _t8527;
          }
          _match_fail("line 16629");
        }
        _t8524 = _t8526;
      } else {
        const eff_8530 = Types$new_effvar(level);
        const __rec_upd_8532 = ctx;
        const _t8533 = ({constraint_tvars: __rec_upd_8532.constraint_tvars, current_eff: eff_8530, current_module: __rec_upd_8532.current_module, inside_handler: __rec_upd_8532.inside_handler, loop_info: __rec_upd_8532.loop_info, mutable_vars: __rec_upd_8532.mutable_vars, return_type: __rec_upd_8532.return_type, return_used: __rec_upd_8532.return_used, type_env: __rec_upd_8532.type_env, vars: __rec_upd_8532.vars});
        const eff_ctx_8534 = _t8533;
        const full_body_8536 = Typechecker$wrap_params_decl(params, ret_annot, body);
        const te_8538 = Typechecker$synth(eff_ctx_8534, (level + 1), full_body_8536);
        Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, te_8538);
        let _t8540;
        if ((_eq(params, null) && (!Typechecker$is_syntactic_value(body)))) {
          _t8540 = Typechecker$mono_scheme(te_8538.ty);
        } else {
          _t8540 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, te_8538.ty, Hashtbl$create(0));
        }
        const scheme_8541 = _t8540;
        const scheme_8543 = Typechecker$infer_implicit_constraints("", ctx.type_env, ctx.vars, te_8538, scheme_8541);
        const scheme_8545 = Typechecker$infer_record_evidence(ctx.vars, te_8538, scheme_8543);
        const ctx$p_8547 = Typechecker$extend_var(ctx, name, scheme_8545);
        const _t8548 = [ctx$p_8547, ({_hd: ({_tag: 0, _name: "TDLet", _val: [name, te_8538]}), _tl: null})];
        const _t8546 = _t8548;
        const _t8544 = _t8546;
        const _t8542 = _t8544;
        const _t8539 = _t8542;
        const _t8537 = _t8539;
        const _t8535 = _t8537;
        const _t8531 = _t8535;
        _t8524 = _t8531;
      }
      _t8507 = _t8524;
      break _t8508;
    }
    if (_t8506._tag === 1) {
      const name = _t8506._val[0];
      const body = _t8506._val[1];
      const eff_8549 = Types$new_effvar(level);
      const __rec_upd_8551 = ctx;
      const _t8552 = ({constraint_tvars: __rec_upd_8551.constraint_tvars, current_eff: eff_8549, current_module: __rec_upd_8551.current_module, inside_handler: __rec_upd_8551.inside_handler, loop_info: __rec_upd_8551.loop_info, mutable_vars: __rec_upd_8551.mutable_vars, return_type: __rec_upd_8551.return_type, return_used: __rec_upd_8551.return_used, type_env: __rec_upd_8551.type_env, vars: __rec_upd_8551.vars});
      const eff_ctx_8553 = _t8552;
      const te_8555 = Typechecker$synth(eff_ctx_8553, (level + 1), body);
      const scheme_8557 = Typechecker$mono_scheme(te_8555.ty);
      const ctx$p_8559 = Typechecker$extend_var_mutable(ctx, name, scheme_8557);
      const _t8560 = [ctx$p_8559, ({_hd: ({_tag: 1, _name: "TDLetMut", _val: [name, te_8555]}), _tl: null})];
      const _t8558 = _t8560;
      const _t8556 = _t8558;
      const _t8554 = _t8556;
      const _t8550 = _t8554;
      _t8507 = _t8550;
      break _t8508;
    }
    if (_t8506._tag === 2) {
      const name = _t8506._val[0];
      const type_params = _t8506._val[1];
      const params = _t8506._val[2];
      const ret_annot = _t8506._val[3];
      const constraints = _t8506._val[4];
      const body = _t8506._val[5];
      let _t8561;
      if (!_eq(type_params, null)) {
        let _t8563;
        const _t8562 = Typechecker$synth_poly_rec_fn(ctx, level, name, "", type_params, params, ret_annot, body);
        _t8564: {
          if (true) {
            const te = _t8562[0];
            const scheme = _t8562[1];
            const ctx$p_8565 = Typechecker$extend_var(ctx, name, scheme);
            const _t8566 = [ctx$p_8565, ({_hd: ({_tag: 2, _name: "TDLetRec", _val: [name, te]}), _tl: null})];
            _t8563 = _t8566;
            break _t8564;
          }
          _match_fail("line 16629");
        }
        _t8561 = _t8563;
      } else {
        let _t8567;
        if (!_eq(constraints, null)) {
          const fn_var_8568 = Types$new_tvar((level + 1));
          const ctx_with_self_8570 = Typechecker$extend_var_mono(ctx, name, fn_var_8568);
          let _t8573;
          const _t8572 = Typechecker$synth_constrained_fn(ctx_with_self_8570, level, constraints, params, ret_annot, body);
          _t8574: {
            if (true) {
              const te = _t8572[0];
              const scheme = _t8572[1];
              Typechecker$try_unify(fn_var_8568, te.ty);
              const ctx$p_8575 = Typechecker$extend_var(ctx, name, scheme);
              const _t8576 = [ctx$p_8575, ({_hd: ({_tag: 2, _name: "TDLetRec", _val: [name, te]}), _tl: null})];
              _t8573 = _t8576;
              break _t8574;
            }
            _match_fail("line 16629");
          }
          const _t8571 = _t8573;
          const _t8569 = _t8571;
          _t8567 = _t8569;
        } else {
          let _t8577;
          if (_eq(params, null)) {
            let _t8579;
            const _t8578 = Typechecker$strip_loc(body);
            _t8580: {
              if ((_t8578._tag === 10 || _t8578._tag === 30 && _t8578._val[0]._tag === 10)) {
                _t8579 = undefined;
                break _t8580;
              }
              if (true) {
                if ((Typechecker$is_constructive(body) && (!Typechecker$is_immediately_linked(name, body)))) {
                  _t8579 = undefined;
                  break _t8580;
                }
              }
              if (true) {
                _t8579 = Typechecker$error("let rec binding must be a function or constructive expression");
                break _t8580;
              }
              _match_fail("line 16629");
            }
            _t8577 = _t8579;
          } else {
            _t8577 = undefined;
          }
          _t8577;
          const eff_8581 = Types$new_effvar(level);
          const __rec_upd_8583 = ctx;
          const _t8584 = ({constraint_tvars: __rec_upd_8583.constraint_tvars, current_eff: eff_8581, current_module: __rec_upd_8583.current_module, inside_handler: __rec_upd_8583.inside_handler, loop_info: __rec_upd_8583.loop_info, mutable_vars: __rec_upd_8583.mutable_vars, return_type: __rec_upd_8583.return_type, return_used: __rec_upd_8583.return_used, type_env: __rec_upd_8583.type_env, vars: __rec_upd_8583.vars});
          const eff_ctx_8585 = _t8584;
          const full_body_8587 = Typechecker$wrap_params_decl(params, ret_annot, body);
          const fn_var_8589 = Types$new_tvar((level + 1));
          const ctx$p_8591 = Typechecker$extend_var_mono(eff_ctx_8585, name, fn_var_8589);
          const fn_te_8593 = Typechecker$synth(ctx$p_8591, (level + 1), full_body_8587);
          Typechecker$try_unify(fn_var_8589, fn_te_8593.ty);
          Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, fn_te_8593);
          const scheme_8595 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, fn_te_8593.ty, Hashtbl$create(0));
          const scheme_8597 = Typechecker$infer_implicit_constraints(name, ctx.type_env, ctx.vars, fn_te_8593, scheme_8595);
          const scheme_8599 = Typechecker$infer_record_evidence(ctx.vars, fn_te_8593, scheme_8597);
          const ctx$p$p_8601 = Typechecker$extend_var(ctx, name, scheme_8599);
          const _t8602 = [ctx$p$p_8601, ({_hd: ({_tag: 2, _name: "TDLetRec", _val: [name, fn_te_8593]}), _tl: null})];
          const _t8600 = _t8602;
          const _t8598 = _t8600;
          const _t8596 = _t8598;
          const _t8594 = _t8596;
          const _t8592 = _t8594;
          const _t8590 = _t8592;
          const _t8588 = _t8590;
          const _t8586 = _t8588;
          const _t8582 = _t8586;
          _t8567 = _t8582;
        }
        _t8561 = _t8567;
      }
      _t8507 = _t8561;
      break _t8508;
    }
    if (_t8506._tag === 6) {
      const expr = _t8506._val;
      const eff_8603 = Types$new_effvar(level);
      const __rec_upd_8605 = ctx;
      const _t8606 = ({constraint_tvars: __rec_upd_8605.constraint_tvars, current_eff: eff_8603, current_module: __rec_upd_8605.current_module, inside_handler: __rec_upd_8605.inside_handler, loop_info: __rec_upd_8605.loop_info, mutable_vars: __rec_upd_8605.mutable_vars, return_type: __rec_upd_8605.return_type, return_used: __rec_upd_8605.return_used, type_env: __rec_upd_8605.type_env, vars: __rec_upd_8605.vars});
      const ctx$p_8607 = _t8606;
      const te_8609 = Typechecker$synth(ctx$p_8607, level, expr);
      const _t8611 = (function() {
        const _t8612 = _h;
        _h = Object.assign({}, _t8612, {
          "unify_error": function(_, __k_try) { throw {_e: "unify_error", _v: _}; },
        });
        try {
          const __x_8613 = Types$unify_eff(Types$eff_repr(eff_8603), ({_tag: 1, _name: "EffEmpty"}));
          return __x_8613;
        } catch (_exc) {
          if (_exc && _exc._e === "unify_error") {
            const _ = _exc._v;
            return Typechecker$error(("expression has unhandled effects: " + __dict_Show_string.show(Types$pp_eff(eff_8603))));
          } else { throw _exc; }
        } finally { _h = _t8612; }
      })();
      _t8611;
      const _t8610 = [ctx, ({_hd: ({_tag: 5, _name: "TDExpr", _val: te_8609}), _tl: null})];
      const _t8608 = _t8610;
      const _t8604 = _t8608;
      _t8507 = _t8604;
      break _t8508;
    }
    if (_t8506._tag === 7) {
      const name = _t8506._val[0];
      const tyvars = _t8506._val[1];
      const fundeps = _t8506._val[2];
      const methods = _t8506._val[3];
      let _t8615;
      const _t8614 = Typechecker$process_class_def(ctx, name, tyvars, fundeps, methods);
      _t8616: {
        if (true) {
          const ctx$p = _t8614[0];
          const td = _t8614[1];
          _t8615 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8616;
        }
        _match_fail("line 16629");
      }
      _t8507 = _t8615;
      break _t8508;
    }
    if (_t8506._tag === 8) {
      const class_name = _t8506._val[0];
      const inst_ty_annots = _t8506._val[1];
      const constraints = _t8506._val[2];
      const methods = _t8506._val[3];
      let _t8618;
      const _t8617 = Typechecker$process_instance_def(ctx, level, class_name, inst_ty_annots, constraints, methods);
      _t8619: {
        if (true) {
          const ctx$p = _t8617[0];
          const td = _t8617[1];
          _t8618 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8619;
        }
        _match_fail("line 16629");
      }
      _t8507 = _t8618;
      break _t8508;
    }
    if (_t8506._tag === 9) {
      const name = _t8506._val[0];
      const type_params = _t8506._val[1];
      const ops = _t8506._val[2];
      const tvars_8620 = Hashtbl$create(4);
      function _t8622(i, p) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_8620, p, ({_tag: 16, _name: "TGen", _val: i})]);
      }
      List$iteri(_t8622, type_params);
      function _t8623(__p298) {
        let _t8625;
        const _t8624 = __p298;
        _t8626: {
          if (true) {
            const op_name = _t8624[0];
            const annot = _t8624[1];
            const ty_8627 = Typechecker$resolve_ty_annot_shared(ctx, 0, tvars_8620, annot);
            const _t8628 = [op_name, ty_8627];
            _t8625 = _t8628;
            break _t8626;
          }
          _match_fail("line 16629");
        }
        return _t8625;
      }
      const resolved_ops_8629 = List$map(_t8623, ops);
      const effect_def_8631 = ({effect_name: name, effect_ops: resolved_ops_8629, effect_params: type_params});
      const __rec_upd_8633 = ctx.type_env;
      const _t8634 = ({classes: __rec_upd_8633.classes, constructors: __rec_upd_8633.constructors, effects: ({_hd: effect_def_8631, _tl: ctx.type_env.effects}), hidden_ctor_types: __rec_upd_8633.hidden_ctor_types, hidden_types: __rec_upd_8633.hidden_types, instances: __rec_upd_8633.instances, modules: __rec_upd_8633.modules, mutable_fields: __rec_upd_8633.mutable_fields, newtypes: __rec_upd_8633.newtypes, records: __rec_upd_8633.records, type_aliases: __rec_upd_8633.type_aliases, type_synonyms: __rec_upd_8633.type_synonyms, variants: __rec_upd_8633.variants});
      const type_env_8635 = _t8634;
      const __rec_upd_8637 = ctx;
      const _t8638 = ({constraint_tvars: __rec_upd_8637.constraint_tvars, current_eff: __rec_upd_8637.current_eff, current_module: __rec_upd_8637.current_module, inside_handler: __rec_upd_8637.inside_handler, loop_info: __rec_upd_8637.loop_info, mutable_vars: __rec_upd_8637.mutable_vars, return_type: __rec_upd_8637.return_type, return_used: __rec_upd_8637.return_used, type_env: type_env_8635, vars: __rec_upd_8637.vars});
      const ctx_8639 = _t8638;
      const _t8640 = [ctx_8639, ({_hd: ({_tag: 7, _name: "TDEffect", _val: name}), _tl: null})];
      const _t8636 = _t8640;
      const _t8632 = _t8636;
      const _t8630 = _t8632;
      const _t8621 = _t8630;
      _t8507 = _t8621;
      break _t8508;
    }
    if (_t8506._tag === 10) {
      const name = _t8506._val[0];
      const ty_annot = _t8506._val[1];
      const tvars_8641 = Hashtbl$create(4);
      const ty_8643 = Typechecker$resolve_ty_annot_shared(ctx, 1, tvars_8641, ty_annot);
      const scheme_8645 = Types$generalize(0, ty_8643);
      const ctx_8647 = Typechecker$extend_var(ctx, name, scheme_8645);
      const _t8648 = [ctx_8647, ({_hd: ({_tag: 8, _name: "TDExtern", _val: [name, scheme_8645]}), _tl: null})];
      const _t8646 = _t8648;
      const _t8644 = _t8646;
      const _t8642 = _t8644;
      _t8507 = _t8642;
      break _t8508;
    }
    if (_t8506._tag === 11) {
      const name = _t8506._val[0];
      const items = _t8506._val[1];
      let _t8650;
      const _t8649 = Typechecker$process_module_def(ctx, level, name, items);
      _t8651: {
        if (true) {
          const ctx$p = _t8649[0];
          const td = _t8649[1];
          _t8650 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8651;
        }
        _match_fail("line 16629");
      }
      _t8507 = _t8650;
      break _t8508;
    }
    if (_t8506._tag === 12) {
      const mod_name = _t8506._val[0];
      const names_opt = _t8506._val[1];
      let _t8653;
      const _t8652 = Typechecker$process_open(ctx, mod_name, names_opt);
      _t8654: {
        if (true) {
          const ctx$p = _t8652[0];
          const td = _t8652[1];
          _t8653 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8654;
        }
        _match_fail("line 16629");
      }
      _t8507 = _t8653;
      break _t8508;
    }
    if (_t8506._tag === 3) {
      const bindings = _t8506._val;
      function _t8655(__p299) {
        let _t8657;
        const _t8656 = __p299;
        _t8658: {
          if (true) {
            const tp = _t8656[1];
            _t8657 = !_eq(tp, null);
            break _t8658;
          }
          _match_fail("line 16629");
        }
        return _t8657;
      }
      const has_poly_8659 = List$exists(_t8655, bindings);
      let _t8661;
      if (has_poly_8659) {
        function _t8662(__p300) {
          let _t8664;
          const _t8663 = __p300;
          _t8665: {
            if (true) {
              const type_params = _t8663[1];
              const params = _t8663[2];
              const ret_annot = _t8663[3];
              const shared_tvars_8666 = Hashtbl$create(4);
              function _t8668(tp) {
                return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_8666, tp, Types$new_tvar((level + 1))]);
              }
              List$iter(_t8668, type_params);
              function _t8669(p) {
                let _t8671;
                const _t8670 = p.annot;
                _t8672: {
                  if (_t8670._tag === 1) {
                    const annot = _t8670._val;
                    _t8671 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_8666, annot);
                    break _t8672;
                  }
                  if (_t8670._tag === 0) {
                    _t8671 = Types$new_tvar((level + 1));
                    break _t8672;
                  }
                  _match_fail("line 16629");
                }
                return _t8671;
              }
              const param_tys_8673 = List$map(_t8669, params);
              let _t8676;
              const _t8675 = ret_annot;
              _t8677: {
                if (_t8675._tag === 1 && _t8675._val._tag === 10) {
                  const ty = _t8675._val._val[0];
                  const eff_annot = _t8675._val._val[1];
                  const ty$p_8678 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_8666, ty);
                  let _t8681;
                  const _t8680 = eff_annot;
                  _t8682: {
                    if (_t8680._tag === 0) {
                      _t8681 = ({_tag: 1, _name: "EffEmpty"});
                      break _t8682;
                    }
                    if (_t8680._tag === 1) {
                      const items = _t8680._val;
                      _t8681 = Typechecker$resolve_eff_items(ctx, (level + 1), shared_tvars_8666, items);
                      break _t8682;
                    }
                    _match_fail("line 16629");
                  }
                  const eff_8683 = _t8681;
                  const _t8684 = [ty$p_8678, eff_8683];
                  const _t8679 = _t8684;
                  _t8676 = _t8679;
                  break _t8677;
                }
                if (_t8675._tag === 1) {
                  const annot = _t8675._val;
                  _t8676 = [Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_8666, annot), Types$new_effvar((level + 1))];
                  break _t8677;
                }
                if (_t8675._tag === 0) {
                  _t8676 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
                  break _t8677;
                }
                _match_fail("line 16629");
              }
              let _t8686;
              const _t8685 = _t8676;
              _t8687: {
                if (true) {
                  const ret_ty = _t8685[0];
                  const body_eff = _t8685[1];
                  let _t8689;
                  const _t8688 = List$rev(param_tys_8673);
                  _t8690: {
                    if (_t8688 === null) {
                      _t8689 = ret_ty;
                      break _t8690;
                    }
                    if (_t8688 !== null) {
                      const last = _t8688._hd;
                      const rest = _t8688._tl;
                      const inner_8691 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
                      function _t8693(acc, pty) {
                        return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
                      }
                      const _t8692 = List$fold(_t8693, inner_8691, rest);
                      _t8689 = _t8692;
                      break _t8690;
                    }
                    _match_fail("line 16629");
                  }
                  const fn_ty_8694 = _t8689;
                  const _t8695 = [shared_tvars_8666, param_tys_8673, ret_ty, body_eff, fn_ty_8694];
                  _t8686 = _t8695;
                  break _t8687;
                }
                _match_fail("line 16629");
              }
              const _t8674 = _t8686;
              const _t8667 = _t8674;
              _t8664 = _t8667;
              break _t8665;
            }
            _match_fail("line 16629");
          }
          return _t8664;
        }
        const shared_tvars_list_8696 = List$map(_t8662, bindings);
        function _t8698(__p301) {
          let _t8700;
          const _t8699 = __p301;
          _t8701: {
            if (true) {
              const fn_ty = _t8699[4];
              _t8700 = Types$generalize(level, fn_ty);
              break _t8701;
            }
            _match_fail("line 16629");
          }
          return _t8700;
        }
        const schemes_8702 = List$map(_t8698, shared_tvars_list_8696);
        function _t8704(ctx, __p302, scheme) {
          let _t8706;
          const _t8705 = __p302;
          _t8707: {
            if (true) {
              const name = _t8705[0];
              _t8706 = Typechecker$extend_var(ctx, name, scheme);
              break _t8707;
            }
            _match_fail("line 16629");
          }
          return _t8706;
        }
        const ctx$p_8708 = List$fold2(_t8704, ctx, bindings, schemes_8702);
        function _t8710(__p303, __p304) {
          let _t8712;
          const _t8711 = __p303;
          _t8713: {
            if (true) {
              const params = _t8711[2];
              const body = _t8711[5];
              let _t8715;
              const _t8714 = __p304;
              _t8716: {
                if (true) {
                  const param_tys = _t8714[1];
                  const ret_ty = _t8714[2];
                  const body_eff = _t8714[3];
                  function _t8717(c, p, ty) {
                    return Typechecker$extend_var_mono(c, p.name, ty);
                  }
                  const __rec_upd_8718 = ctx$p_8708;
                  const _t8719 = ({constraint_tvars: __rec_upd_8718.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_8718.current_module, inside_handler: __rec_upd_8718.inside_handler, loop_info: __rec_upd_8718.loop_info, mutable_vars: __rec_upd_8718.mutable_vars, return_type: __rec_upd_8718.return_type, return_used: __rec_upd_8718.return_used, type_env: __rec_upd_8718.type_env, vars: __rec_upd_8718.vars});
                  const inner_ctx_8720 = List$fold2(_t8717, _t8719, params, param_tys);
                  const body_te_8722 = Typechecker$check(inner_ctx_8720, (level + 1), body, ret_ty);
                  let _t8725;
                  const _t8724 = [List$rev(params), List$rev(param_tys)];
                  _t8726: {
                    if (_t8724[0] === null && _t8724[1] === null) {
                      _t8725 = body_te_8722;
                      break _t8726;
                    }
                    if (_t8724[0] !== null && _t8724[1] !== null) {
                      const last_p = _t8724[0]._hd;
                      const rest_ps = _t8724[0]._tl;
                      const last_pty = _t8724[1]._hd;
                      const rest_ptys = _t8724[1]._tl;
                      const inner_8727 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_8722, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_8722.ty]}));
                      function _t8729(acc, p, pty) {
                        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
                      }
                      const _t8728 = List$fold2(_t8729, inner_8727, rest_ps, rest_ptys);
                      _t8725 = _t8728;
                      break _t8726;
                    }
                    if (true) {
                      _t8725 = failwith("assert false");
                      break _t8726;
                    }
                    _match_fail("line 16629");
                  }
                  const _t8723 = _t8725;
                  const _t8721 = _t8723;
                  _t8715 = _t8721;
                  break _t8716;
                }
                _match_fail("line 16629");
              }
              _t8712 = _t8715;
              break _t8713;
            }
            _match_fail("line 16629");
          }
          return _t8712;
        }
        const body_tes_8730 = List$map2(_t8710, bindings, shared_tvars_list_8696);
        function _t8732(ctx, __p305, scheme) {
          let _t8734;
          const _t8733 = __p305;
          _t8735: {
            if (true) {
              const name = _t8733[0];
              _t8734 = Typechecker$extend_var(ctx, name, scheme);
              break _t8735;
            }
            _match_fail("line 16629");
          }
          return _t8734;
        }
        const ctx$p$p_8736 = List$fold2(_t8732, ctx, bindings, schemes_8702);
        function _t8738(__p306, te) {
          let _t8740;
          const _t8739 = __p306;
          _t8741: {
            if (true) {
              const name = _t8739[0];
              _t8740 = [name, te];
              break _t8741;
            }
            _match_fail("line 16629");
          }
          return _t8740;
        }
        const typed_bindings_8742 = List$map2(_t8738, bindings, body_tes_8730);
        const _t8743 = [ctx$p$p_8736, ({_hd: ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_8742}), _tl: null})];
        const _t8737 = _t8743;
        const _t8731 = _t8737;
        const _t8709 = _t8731;
        const _t8703 = _t8709;
        const _t8697 = _t8703;
        _t8661 = _t8697;
      } else {
        function _t8744(__p307) {
          let _t8746;
          const _t8745 = __p307;
          _t8747: {
            if (true) {
              const name = _t8745[0];
              const params = _t8745[2];
              const body = _t8745[5];
              let _t8748;
              if (_eq(params, null)) {
                let _t8750;
                const _t8749 = Typechecker$strip_loc(body);
                _t8751: {
                  if ((_t8749._tag === 10 || _t8749._tag === 30 && _t8749._val[0]._tag === 10)) {
                    _t8750 = undefined;
                    break _t8751;
                  }
                  if (true) {
                    if ((Typechecker$is_constructive(body) && (!Typechecker$is_immediately_linked(name, body)))) {
                      _t8750 = undefined;
                      break _t8751;
                    }
                  }
                  if (true) {
                    _t8750 = Typechecker$error((("let rec binding for '" + __dict_Show_string.show(name)) + "' must be a function or constructive expression"));
                    break _t8751;
                  }
                  _match_fail("line 16629");
                }
                _t8748 = _t8750;
              } else {
                _t8748 = undefined;
              }
              _t8746 = _t8748;
              break _t8747;
            }
            _match_fail("line 16629");
          }
          return _t8746;
        }
        List$iter(_t8744, bindings);
        function _t8752(__p308) {
          let _t8754;
          const _t8753 = __p308;
          _t8755: {
            if (true) {
              const name = _t8753[0];
              _t8754 = [name, Types$new_tvar((level + 1))];
              break _t8755;
            }
            _match_fail("line 16629");
          }
          return _t8754;
        }
        const fn_vars_8756 = List$map(_t8752, bindings);
        function _t8758(ctx, __p309) {
          let _t8760;
          const _t8759 = __p309;
          _t8761: {
            if (true) {
              const name = _t8759[0];
              const tv = _t8759[1];
              _t8760 = Typechecker$extend_var_mono(ctx, name, tv);
              break _t8761;
            }
            _match_fail("line 16629");
          }
          return _t8760;
        }
        const ctx$p_8762 = List$fold(_t8758, ctx, fn_vars_8756);
        function _t8764(__p310, __p311) {
          let _t8766;
          const _t8765 = __p310;
          _t8767: {
            if (true) {
              const name = _t8765[0];
              const params = _t8765[2];
              const ret_annot = _t8765[3];
              const constraints = _t8765[4];
              const body = _t8765[5];
              let _t8769;
              const _t8768 = __p311;
              _t8770: {
                if (true) {
                  const tv = _t8768[1];
                  name;
                  undefined;
                  let _t8771;
                  if (!_eq(constraints, null)) {
                    let _t8773;
                    const _t8772 = Typechecker$synth_constrained_fn(ctx$p_8762, level, constraints, params, ret_annot, body);
                    _t8774: {
                      if (true) {
                        const te = _t8772[0];
                        const _scheme = _t8772[1];
                        Typechecker$try_unify(tv, te.ty);
                        _t8773 = te;
                        break _t8774;
                      }
                      _match_fail("line 16629");
                    }
                    _t8771 = _t8773;
                  } else {
                    const full_body_8775 = Typechecker$wrap_params_decl(params, ret_annot, body);
                    const te_8777 = Typechecker$synth(ctx$p_8762, (level + 1), full_body_8775);
                    Typechecker$try_unify(tv, te_8777.ty);
                    const _t8778 = te_8777;
                    const _t8776 = _t8778;
                    _t8771 = _t8776;
                  }
                  _t8769 = _t8771;
                  break _t8770;
                }
                _match_fail("line 16629");
              }
              _t8766 = _t8769;
              break _t8767;
            }
            _match_fail("line 16629");
          }
          return _t8766;
        }
        const body_tes_8779 = List$map2(_t8764, bindings, fn_vars_8756);
        function _t8781(ctx, __p312, __p313) {
          let _t8783;
          const _t8782 = __p312;
          _t8784: {
            if (true) {
              const name = _t8782[0];
              let _t8786;
              const _t8785 = __p313;
              _t8787: {
                if (true) {
                  const tv = _t8785[1];
                  const scheme_8788 = Types$generalize(level, tv);
                  const _t8789 = Typechecker$extend_var(ctx, name, scheme_8788);
                  _t8786 = _t8789;
                  break _t8787;
                }
                _match_fail("line 16629");
              }
              _t8783 = _t8786;
              break _t8784;
            }
            _match_fail("line 16629");
          }
          return _t8783;
        }
        const ctx$p$p_8790 = List$fold2(_t8781, ctx, bindings, fn_vars_8756);
        function _t8792(__p314, te) {
          let _t8794;
          const _t8793 = __p314;
          _t8795: {
            if (true) {
              const name = _t8793[0];
              _t8794 = [name, te];
              break _t8795;
            }
            _match_fail("line 16629");
          }
          return _t8794;
        }
        const typed_bindings_8796 = List$map2(_t8792, bindings, body_tes_8779);
        const _t8797 = [ctx$p$p_8790, ({_hd: ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_8796}), _tl: null})];
        const _t8791 = _t8797;
        const _t8780 = _t8791;
        const _t8763 = _t8780;
        const _t8757 = _t8763;
        _t8661 = _t8757;
      }
      const _t8660 = _t8661;
      _t8507 = _t8660;
      break _t8508;
    }
    if (_t8506._tag === 5) {
      const type_defs = _t8506._val;
      function _t8798(ctx, __p315) {
        let _t8800;
        const _t8799 = __p315;
        _t8801: {
          if (true) {
            const type_params = _t8799[0];
            const name = _t8799[1];
            const def = _t8799[2];
            const _deriving = _t8799[3];
            const num_params_8802 = List$length(type_params);
            let _t8805;
            const _t8804 = def;
            _t8806: {
              if (_t8804._tag === 0) {
                const __rec_upd_8807 = ctx.type_env;
                const _t8808 = ({classes: __rec_upd_8807.classes, constructors: __rec_upd_8807.constructors, effects: __rec_upd_8807.effects, hidden_ctor_types: __rec_upd_8807.hidden_ctor_types, hidden_types: __rec_upd_8807.hidden_types, instances: __rec_upd_8807.instances, modules: __rec_upd_8807.modules, mutable_fields: __rec_upd_8807.mutable_fields, newtypes: __rec_upd_8807.newtypes, records: __rec_upd_8807.records, type_aliases: __rec_upd_8807.type_aliases, type_synonyms: __rec_upd_8807.type_synonyms, variants: ({_hd: [name, num_params_8802, null, false], _tl: ctx.type_env.variants})});
                const type_env_8809 = _t8808;
                const __rec_upd_8811 = ctx;
                const _t8812 = ({constraint_tvars: __rec_upd_8811.constraint_tvars, current_eff: __rec_upd_8811.current_eff, current_module: __rec_upd_8811.current_module, inside_handler: __rec_upd_8811.inside_handler, loop_info: __rec_upd_8811.loop_info, mutable_vars: __rec_upd_8811.mutable_vars, return_type: __rec_upd_8811.return_type, return_used: __rec_upd_8811.return_used, type_env: type_env_8809, vars: __rec_upd_8811.vars});
                const _t8810 = _t8812;
                _t8805 = _t8810;
                break _t8806;
              }
              if (_t8804._tag === 1) {
                const __rec_upd_8813 = ctx.type_env;
                const _t8814 = ({classes: __rec_upd_8813.classes, constructors: __rec_upd_8813.constructors, effects: __rec_upd_8813.effects, hidden_ctor_types: __rec_upd_8813.hidden_ctor_types, hidden_types: __rec_upd_8813.hidden_types, instances: __rec_upd_8813.instances, modules: __rec_upd_8813.modules, mutable_fields: __rec_upd_8813.mutable_fields, newtypes: __rec_upd_8813.newtypes, records: ({_hd: [name, null], _tl: ctx.type_env.records}), type_aliases: __rec_upd_8813.type_aliases, type_synonyms: __rec_upd_8813.type_synonyms, variants: __rec_upd_8813.variants});
                const type_env_8815 = _t8814;
                const __rec_upd_8817 = ctx;
                const _t8818 = ({constraint_tvars: __rec_upd_8817.constraint_tvars, current_eff: __rec_upd_8817.current_eff, current_module: __rec_upd_8817.current_module, inside_handler: __rec_upd_8817.inside_handler, loop_info: __rec_upd_8817.loop_info, mutable_vars: __rec_upd_8817.mutable_vars, return_type: __rec_upd_8817.return_type, return_used: __rec_upd_8817.return_used, type_env: type_env_8815, vars: __rec_upd_8817.vars});
                const _t8816 = _t8818;
                _t8805 = _t8816;
                break _t8806;
              }
              if (_t8804._tag === 2) {
                _t8805 = ctx;
                break _t8806;
              }
              if (_t8804._tag === 3) {
                const __rec_upd_8819 = ctx.type_env;
                const _t8820 = ({classes: __rec_upd_8819.classes, constructors: __rec_upd_8819.constructors, effects: __rec_upd_8819.effects, hidden_ctor_types: __rec_upd_8819.hidden_ctor_types, hidden_types: __rec_upd_8819.hidden_types, instances: __rec_upd_8819.instances, modules: __rec_upd_8819.modules, mutable_fields: __rec_upd_8819.mutable_fields, newtypes: __rec_upd_8819.newtypes, records: __rec_upd_8819.records, type_aliases: __rec_upd_8819.type_aliases, type_synonyms: __rec_upd_8819.type_synonyms, variants: ({_hd: [name, num_params_8802, null, false], _tl: ctx.type_env.variants})});
                const type_env_8821 = _t8820;
                const __rec_upd_8823 = ctx;
                const _t8824 = ({constraint_tvars: __rec_upd_8823.constraint_tvars, current_eff: __rec_upd_8823.current_eff, current_module: __rec_upd_8823.current_module, inside_handler: __rec_upd_8823.inside_handler, loop_info: __rec_upd_8823.loop_info, mutable_vars: __rec_upd_8823.mutable_vars, return_type: __rec_upd_8823.return_type, return_used: __rec_upd_8823.return_used, type_env: type_env_8821, vars: __rec_upd_8823.vars});
                const _t8822 = _t8824;
                _t8805 = _t8822;
                break _t8806;
              }
              _match_fail("line 16629");
            }
            const _t8803 = _t8805;
            _t8800 = _t8803;
            break _t8801;
          }
          _match_fail("line 16629");
        }
        return _t8800;
      }
      const ctx$p_8825 = List$fold(_t8798, ctx, type_defs);
      function _t8827(ctx, __p316) {
        let _t8829;
        const _t8828 = __p316;
        _t8830: {
          if (true) {
            const type_params = _t8828[0];
            const name = _t8828[1];
            const def = _t8828[2];
            const _deriving = _t8828[3];
            let _t8832;
            const _t8831 = def;
            _t8833: {
              if (_t8831._tag === 1) {
                _t8832 = Typechecker$process_type_def(ctx, type_params, name, def);
                break _t8833;
              }
              if (true) {
                _t8832 = ctx;
                break _t8833;
              }
              _match_fail("line 16629");
            }
            _t8829 = _t8832;
            break _t8830;
          }
          _match_fail("line 16629");
        }
        return _t8829;
      }
      const ctx$p_8834 = List$fold(_t8827, ctx$p_8825, type_defs);
      function _t8836(ctx, __p317) {
        let _t8838;
        const _t8837 = __p317;
        _t8839: {
          if (true) {
            const type_params = _t8837[0];
            const name = _t8837[1];
            const def = _t8837[2];
            const _deriving = _t8837[3];
            let _t8841;
            const _t8840 = def;
            _t8842: {
              if (_t8840._tag === 1) {
                _t8841 = ctx;
                break _t8842;
              }
              if (true) {
                _t8841 = Typechecker$process_type_def(ctx, type_params, name, def);
                break _t8842;
              }
              _match_fail("line 16629");
            }
            _t8838 = _t8841;
            break _t8839;
          }
          _match_fail("line 16629");
        }
        return _t8838;
      }
      const ctx$p$p_8843 = List$fold(_t8836, ctx$p_8834, type_defs);
      function _t8845(__p318, __p319) {
        let _t8847;
        const _t8846 = __p318;
        _t8848: {
          if (true) {
            const ctx = _t8846[0];
            const acc = _t8846[1];
            let _t8850;
            const _t8849 = __p319;
            _t8851: {
              if (true) {
                const type_params = _t8849[0];
                const name = _t8849[1];
                const def = _t8849[2];
                const deriving_ = _t8849[3];
                function _t8852(__p320, cls) {
                  let _t8854;
                  const _t8853 = __p320;
                  _t8855: {
                    if (true) {
                      const ctx = _t8853[0];
                      const acc = _t8853[1];
                      let _t8857;
                      const _t8856 = Typechecker$generate_derived_instance(type_params, name, def, cls);
                      _t8858: {
                        if (_t8856._tag === 1) {
                          const class_name = _t8856._val[0];
                          const inst_tys = _t8856._val[1];
                          const constraints = _t8856._val[2];
                          const methods = _t8856._val[3];
                          let _t8860;
                          const _t8859 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
                          _t8861: {
                            if (true) {
                              const ctx$p = _t8859[0];
                              const tdecl = _t8859[1];
                              _t8860 = [ctx$p, ({_hd: tdecl, _tl: acc})];
                              break _t8861;
                            }
                            _match_fail("line 16629");
                          }
                          _t8857 = _t8860;
                          break _t8858;
                        }
                        if (_t8856._tag === 0) {
                          _t8857 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
                          break _t8858;
                        }
                        _match_fail("line 16629");
                      }
                      _t8854 = _t8857;
                      break _t8855;
                    }
                    _match_fail("line 16629");
                  }
                  return _t8854;
                }
                let _t8863;
                const _t8862 = List$fold(_t8852, [ctx, null], deriving_);
                _t8864: {
                  if (true) {
                    const ctx$p = _t8862[0];
                    const new_decls = _t8862[1];
                    _t8863 = [ctx$p, List$concat(List$rev(new_decls), acc)];
                    break _t8864;
                  }
                  _match_fail("line 16629");
                }
                _t8850 = _t8863;
                break _t8851;
              }
              _match_fail("line 16629");
            }
            _t8847 = _t8850;
            break _t8848;
          }
          _match_fail("line 16629");
        }
        return _t8847;
      }
      let _t8866;
      const _t8865 = List$fold(_t8845, [ctx$p$p_8843, null], type_defs);
      _t8867: {
        if (true) {
          const ctx_final = _t8865[0];
          const derived_tdecls = _t8865[1];
          function _t8868(__p321) {
            let _t8870;
            const _t8869 = __p321;
            _t8871: {
              if (true) {
                const _tp = _t8869[0];
                const name = _t8869[1];
                const def = _t8869[2];
                const _d = _t8869[3];
                _t8870 = ({_tag: 4, _name: "TDType", _val: [name, def]});
                break _t8871;
              }
              _match_fail("line 16629");
            }
            return _t8870;
          }
          const type_decls_8872 = List$map(_t8868, type_defs);
          const _t8873 = [ctx_final, List$concat(type_decls_8872, List$rev(derived_tdecls))];
          _t8866 = _t8873;
          break _t8867;
        }
        _match_fail("line 16629");
      }
      const _t8844 = _t8866;
      const _t8835 = _t8844;
      const _t8826 = _t8835;
      _t8507 = _t8826;
      break _t8508;
    }
    _match_fail("line 16629");
  }
  return _t8507;
}
const Typechecker$empty_ctx = ({constraint_tvars: null, current_eff: ({_tag: 1, _name: "EffEmpty"}), current_module: ({_tag: 0, _name: "None"}), inside_handler: false, loop_info: ({_tag: 0, _name: "None"}), mutable_vars: null, return_type: ({_tag: 0, _name: "None"}), return_used: Ref$create(false), type_env: Types$empty_type_env, vars: null});
function Typechecker$build_tgen_map(schema_ty, actual_ty) {
  const map_8874 = Hashtbl$create(4);
  function walk(s, a) {
    while (true) {
      const a_8876 = Types$repr(a);
      let _t8879;
      const _t8878 = s;
      _t8880: {
        if (_t8878._tag === 16) {
          const i = _t8878._val;
          let _t8881;
          if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, map_8874, i]))) {
            _t8881 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, map_8874, i, a_8876]);
          } else {
            _t8881 = undefined;
          }
          _t8879 = _t8881;
          break _t8880;
        }
        if (_t8878._tag === 7) {
          const s1 = _t8878._val[0];
          const s2 = _t8878._val[2];
          let _t8883;
          const _t8882 = a_8876;
          _t8884: {
            if (_t8882._tag === 7) {
              const a1 = _t8882._val[0];
              const a2 = _t8882._val[2];
              walk(s1, a1);
              const _t8885 = s2;
              const _t8886 = a2;
              s = _t8885;
              a = _t8886;
              continue;
              _t8883 = undefined;
              break _t8884;
            }
            if (true) {
              _t8883 = undefined;
              break _t8884;
            }
            _match_fail("line 16629");
          }
          _t8879 = _t8883;
          break _t8880;
        }
        if (_t8878._tag === 8) {
          const s1 = _t8878._val[0];
          const s2 = _t8878._val[2];
          let _t8888;
          const _t8887 = a_8876;
          _t8889: {
            if (_t8887._tag === 8) {
              const a1 = _t8887._val[0];
              const a2 = _t8887._val[2];
              walk(s1, a1);
              const _t8890 = s2;
              const _t8891 = a2;
              s = _t8890;
              a = _t8891;
              continue;
              _t8888 = undefined;
              break _t8889;
            }
            if (true) {
              _t8888 = undefined;
              break _t8889;
            }
            _match_fail("line 16629");
          }
          _t8879 = _t8888;
          break _t8880;
        }
        if (_t8878._tag === 9) {
          const ss = _t8878._val;
          let _t8893;
          const _t8892 = a_8876;
          _t8894: {
            if (_t8892._tag === 9) {
              const aa = _t8892._val;
              if ((List$length(ss) === List$length(aa))) {
                _t8893 = List$iter2(walk, ss, aa);
                break _t8894;
              }
            }
            if (true) {
              _t8893 = undefined;
              break _t8894;
            }
            _match_fail("line 16629");
          }
          _t8879 = _t8893;
          break _t8880;
        }
        if (_t8878._tag === 10) {
          const s1 = _t8878._val;
          let _t8896;
          const _t8895 = a_8876;
          _t8897: {
            if (_t8895._tag === 10) {
              const a1 = _t8895._val;
              const _t8898 = s1;
              const _t8899 = a1;
              s = _t8898;
              a = _t8899;
              continue;
              _t8896 = undefined;
              break _t8897;
            }
            if (true) {
              _t8896 = undefined;
              break _t8897;
            }
            _match_fail("line 16629");
          }
          _t8879 = _t8896;
          break _t8880;
        }
        if (_t8878._tag === 13) {
          const s1 = _t8878._val;
          let _t8901;
          const _t8900 = a_8876;
          _t8902: {
            if (_t8900._tag === 13) {
              const a1 = _t8900._val;
              const _t8903 = s1;
              const _t8904 = a1;
              s = _t8903;
              a = _t8904;
              continue;
              _t8901 = undefined;
              break _t8902;
            }
            if (true) {
              _t8901 = undefined;
              break _t8902;
            }
            _match_fail("line 16629");
          }
          _t8879 = _t8901;
          break _t8880;
        }
        if (_t8878._tag === 12) {
          const ss = _t8878._val[1];
          let _t8906;
          const _t8905 = a_8876;
          _t8907: {
            if (_t8905._tag === 12) {
              const aa = _t8905._val[1];
              if ((List$length(ss) === List$length(aa))) {
                _t8906 = List$iter2(walk, ss, aa);
                break _t8907;
              }
            }
            if (true) {
              _t8906 = undefined;
              break _t8907;
            }
            _match_fail("line 16629");
          }
          _t8879 = _t8906;
          break _t8880;
        }
        if (_t8878._tag === 11) {
          const srow = _t8878._val;
          let _t8909;
          const _t8908 = a_8876;
          _t8910: {
            if (_t8908._tag === 11) {
              const arow = _t8908._val;
              const sf_8911 = Types$record_row_to_fields(srow);
              const af_8913 = Types$record_row_to_fields(arow);
              function _t8915(__p322) {
                let _t8917;
                const _t8916 = __p322;
                _t8918: {
                  if (true) {
                    const sname = _t8916[0];
                    const sty = _t8916[1];
                    let _t8920;
                    const _t8919 = List$assoc_opt(sname, af_8913);
                    _t8921: {
                      if (_t8919._tag === 1) {
                        const aty = _t8919._val;
                        _t8920 = walk(sty, aty);
                        break _t8921;
                      }
                      if (_t8919._tag === 0) {
                        _t8920 = undefined;
                        break _t8921;
                      }
                      _match_fail("line 16629");
                    }
                    _t8917 = _t8920;
                    break _t8918;
                  }
                  _match_fail("line 16629");
                }
                return _t8917;
              }
              const _t8914 = List$iter(_t8915, sf_8911);
              const _t8912 = _t8914;
              _t8909 = _t8912;
              break _t8910;
            }
            if (true) {
              _t8909 = undefined;
              break _t8910;
            }
            _match_fail("line 16629");
          }
          _t8879 = _t8909;
          break _t8880;
        }
        if (_t8878._tag === 14) {
          const srow = _t8878._val;
          let _t8923;
          const _t8922 = a_8876;
          _t8924: {
            if (_t8922._tag === 14) {
              const arow = _t8922._val;
              _t8923 = walk_pvrows(srow, arow);
              break _t8924;
            }
            if (true) {
              _t8923 = undefined;
              break _t8924;
            }
            _match_fail("line 16629");
          }
          _t8879 = _t8923;
          break _t8880;
        }
        if (true) {
          _t8879 = undefined;
          break _t8880;
        }
        _match_fail("line 16629");
      }
      const _t8877 = _t8879;
      return _t8877;
    }
  }
  function walk_pvrows(srow, arow) {
    function collect_tags(row) {
      while (true) {
        let _t8926;
        const _t8925 = row;
        _t8927: {
          if (_t8925._tag === 0) {
            const tag = _t8925._val[0];
            const ty_opt = _t8925._val[1];
            const tail = _t8925._val[2];
            _t8926 = ({_hd: [tag, ty_opt], _tl: collect_tags(tail)});
            break _t8927;
          }
          if (_t8925._tag === 1 && _t8925._val.contents._tag === 1) {
            const r = _t8925._val.contents._val;
            const _t8928 = r;
            row = _t8928;
            continue;
            _t8926 = undefined;
            break _t8927;
          }
          if (true) {
            _t8926 = null;
            break _t8927;
          }
          _match_fail("line 16629");
        }
        return _t8926;
      }
    }
    const atags_8930 = collect_tags(arow);
    function go(row) {
      while (true) {
        let _t8933;
        const _t8932 = row;
        _t8934: {
          if (_t8932._tag === 0) {
            const stag = _t8932._val[0];
            const sty_opt = _t8932._val[1];
            const stail = _t8932._val[2];
            let _t8936;
            const _t8935 = List$assoc_opt(stag, atags_8930);
            _t8937: {
              if (_t8935._tag === 1) {
                const aty_opt = _t8935._val;
                let _t8939;
                const _t8938 = [sty_opt, aty_opt];
                _t8940: {
                  if (_t8938[0]._tag === 1 && _t8938[1]._tag === 1) {
                    const sty = _t8938[0]._val;
                    const aty = _t8938[1]._val;
                    _t8939 = walk(sty, aty);
                    break _t8940;
                  }
                  if (true) {
                    _t8939 = undefined;
                    break _t8940;
                  }
                  _match_fail("line 16629");
                }
                _t8936 = _t8939;
                break _t8937;
              }
              if (_t8935._tag === 0) {
                _t8936 = undefined;
                break _t8937;
              }
              _match_fail("line 16629");
            }
            _t8936;
            const _t8941 = stail;
            row = _t8941;
            continue;
            _t8933 = undefined;
            break _t8934;
          }
          if (_t8932._tag === 1 && _t8932._val.contents._tag === 1) {
            const r = _t8932._val.contents._val;
            const _t8942 = r;
            row = _t8942;
            continue;
            _t8933 = undefined;
            break _t8934;
          }
          if (true) {
            _t8933 = undefined;
            break _t8934;
          }
          _match_fail("line 16629");
        }
        return _t8933;
      }
    }
    const _t8943 = go(srow);
    const _t8931 = _t8943;
    const _t8929 = _t8931;
    return _t8929;
  }
  walk(schema_ty, actual_ty);
  const _t8944 = map_8874;
  const _t8875 = _t8944;
  return _t8875;
}
function Typechecker$find_constrained_dict(xctx, tvar_id, class_name) {
  function _t8945(__p323) {
    let _t8947;
    const _t8946 = __p323;
    _t8948: {
      if (true) {
        const tid = _t8946[0];
        const dparam = _t8946[1];
        const cls = _t8946[2];
        let _t8949;
        if (((tid === tvar_id) && (cls === class_name))) {
          _t8949 = ({_tag: 1, _name: "Some", _val: dparam});
        } else {
          _t8949 = ({_tag: 0, _name: "None"});
        }
        _t8947 = _t8949;
        break _t8948;
      }
      _match_fail("line 16629");
    }
    return _t8947;
  }
  return List$find_map(_t8945, xctx.xf_constrained);
}
function Typechecker$resolve_dict_arg(xctx, cc, tgen_map) {
  function _t8950(ca) {
    let _t8952;
    const _t8951 = ca;
    _t8953: {
      if (_t8951._tag === 0) {
        const idx = _t8951._val;
        let _t8955;
        const _t8954 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_map, idx]);
        _t8956: {
          if (_t8954._tag === 1) {
            const ty = _t8954._val;
            _t8955 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t8956;
          }
          if (_t8954._tag === 0) {
            _t8955 = ({_tag: 0, _name: "None"});
            break _t8956;
          }
          _match_fail("line 16629");
        }
        _t8952 = _t8955;
        break _t8953;
      }
      if (_t8951._tag === 1) {
        const ty = _t8951._val;
        _t8952 = ({_tag: 1, _name: "Some", _val: Types$freshen_unbound(ty)});
        break _t8953;
      }
      if (_t8951._tag === 2) {
        _t8952 = ({_tag: 1, _name: "Some", _val: Types$new_tvar(1)});
        break _t8953;
      }
      if (_t8951._tag === 3) {
        const idx = _t8951._val[0];
        let _t8958;
        const _t8957 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_map, idx]);
        _t8959: {
          if (_t8957._tag === 1) {
            const ty = _t8957._val;
            _t8958 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t8959;
          }
          if (_t8957._tag === 0) {
            const tv_8960 = Types$new_tvar(1);
            _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tgen_map, idx, tv_8960]);
            const _t8961 = ({_tag: 1, _name: "Some", _val: tv_8960});
            _t8958 = _t8961;
            break _t8959;
          }
          _match_fail("line 16629");
        }
        _t8952 = _t8958;
        break _t8953;
      }
      _match_fail("line 16629");
    }
    return _t8952;
  }
  const arg_types_8962 = List$map(_t8950, cc.cc_args);
  function _t8964(opt) {
    return _eq(opt, ({_tag: 0, _name: "None"}));
  }
  const has_unresolved_8965 = List$exists(_t8964, arg_types_8962);
  let _t8967;
  if (has_unresolved_8965) {
    let _t8968;
    if ((cc.cc_class === "Show")) {
      _t8968 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: ({_hd: ["show", Typechecker$mk(({_tag: 7, _name: "TEVar", _val: "__show_value"}), ({_tag: 6, _name: "TUnit"}))], _tl: null})}), ({_tag: 6, _name: "TUnit"}));
    } else {
      _t8968 = Typechecker$error(("could not resolve constraint type argument for " + __dict_Show_string.show(cc.cc_class)));
    }
    _t8967 = _t8968;
  } else {
    function _t8969(x) {
      return x;
    }
    const arg_types_8970 = List$filter_map(_t8969, arg_types_8962);
    function _t8972(ty) {
      let _t8974;
      const _t8973 = ty;
      _t8975: {
        if (_t8973._tag === 15 && _t8973._val.contents._tag === 0) {
          _t8974 = true;
          break _t8975;
        }
        if (true) {
          _t8974 = false;
          break _t8975;
        }
        _match_fail("line 16629");
      }
      return _t8974;
    }
    const has_unbound_8976 = List$exists(_t8972, arg_types_8970);
    let _t8978;
    if (has_unbound_8976) {
      function _t8979(cls) {
        return ((cls.class_name === cc.cc_class) && !_eq(cls.class_fundeps, null));
      }
      const class_opt_8980 = List$find(_t8979, xctx.xf_type_env.classes);
      let _t8983;
      const _t8982 = class_opt_8980;
      _t8984: {
        if (_t8982._tag === 1) {
          const class_def = _t8982._val;
          function _t8985(ty) {
            let _t8987;
            const _t8986 = Types$repr(ty);
            _t8988: {
              if (_t8986._tag === 15 && _t8986._val.contents._tag === 0) {
                _t8987 = ({_tag: 0, _name: "None"});
                break _t8988;
              }
              if (true) {
                const t = _t8986;
                _t8987 = ({_tag: 1, _name: "Some", _val: t});
                break _t8988;
              }
              _match_fail("line 16629");
            }
            return _t8987;
          }
          const partial_8989 = List$map(_t8985, arg_types_8970);
          const improved_8991 = Types$improve_with_fundeps(xctx.xf_type_env.instances, class_def, partial_8989);
          function _t8993(orig_ty, imp) {
            let _t8995;
            const _t8994 = [imp, Types$repr(orig_ty)];
            _t8996: {
              if (_t8994[0]._tag === 1 && _t8994[1]._tag === 15 && _t8994[1]._val.contents._tag === 0) {
                const resolved = _t8994[0]._val;
                const r = _t8994[1]._val;
                _t8995 = Types$unify(({_tag: 15, _name: "TVar", _val: r}), resolved);
                break _t8996;
              }
              if (true) {
                _t8995 = undefined;
                break _t8996;
              }
              _match_fail("line 16629");
            }
            return _t8995;
          }
          List$iter2(_t8993, arg_types_8970, improved_8991);
          const _t8992 = List$map(Types$repr, arg_types_8970);
          const _t8990 = _t8992;
          _t8983 = _t8990;
          break _t8984;
        }
        if (_t8982._tag === 0) {
          _t8983 = arg_types_8970;
          break _t8984;
        }
        _match_fail("line 16629");
      }
      const _t8981 = _t8983;
      _t8978 = _t8981;
    } else {
      _t8978 = arg_types_8970;
    }
    const _t8977 = _t8978;
    const arg_types_8997 = _t8977;
    function _t8999(ty) {
      let _t9001;
      const _t9000 = ty;
      _t9002: {
        if (_t9000._tag === 15 && _t9000._val.contents._tag === 0) {
          const id = _t9000._val.contents._val[0];
          _t9001 = Typechecker$find_constrained_dict(xctx, id, cc.cc_class);
          break _t9002;
        }
        if (true) {
          _t9001 = ({_tag: 0, _name: "None"});
          break _t9002;
        }
        _match_fail("line 16629");
      }
      return _t9001;
    }
    const constrained_match_9003 = List$find_map(_t8999, arg_types_8997);
    let _t9006;
    const _t9005 = constrained_match_9003;
    _t9007: {
      if (_t9005._tag === 1) {
        const dparam = _t9005._val;
        _t9006 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dparam}), ({_tag: 6, _name: "TUnit"}));
        break _t9007;
      }
      if (_t9005._tag === 0) {
        function _t9008(ty) {
          let _t9010;
          const _t9009 = ty;
          _t9011: {
            if (_t9009._tag === 15 && _t9009._val.contents._tag === 0) {
              _t9010 = true;
              break _t9011;
            }
            if (true) {
              _t9010 = false;
              break _t9011;
            }
            _match_fail("line 16629");
          }
          return _t9010;
        }
        const has_unbound_tvar_9012 = List$exists(_t9008, arg_types_8997);
        let _t9014;
        if (has_unbound_tvar_9012) {
          let _t9015;
          if ((cc.cc_class === "Show")) {
            _t9015 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: ({_hd: ["show", Typechecker$mk(({_tag: 7, _name: "TEVar", _val: "__show_value"}), ({_tag: 6, _name: "TUnit"}))], _tl: null})}), ({_tag: 6, _name: "TUnit"}));
          } else {
            _t9015 = Typechecker$error(((("no instance of " + __dict_Show_string.show(cc.cc_class)) + " for types ") + __dict_Show_string.show(String$concat(", ", List$map(Types$pp_ty, arg_types_8997)))));
          }
          _t9014 = _t9015;
        } else {
          function _t9016(ty) {
            return ({_tag: 1, _name: "Some", _val: ty});
          }
          const partial_9017 = List$map(_t9016, arg_types_8997);
          function _t9019(inst) {
            return ((inst.inst_class === cc.cc_class) && ((List$length(inst.inst_tys) === List$length(arg_types_8997)) && Types$match_partial_inst(inst.inst_tys, partial_9017)));
          }
          const matching_9020 = List$filter(_t9019, xctx.xf_type_env.instances);
          let _t9023;
          const _t9022 = matching_9020;
          _t9024: {
            if (_t9022 !== null && _t9022._tl === null) {
              const inst = _t9022._hd;
              let _t9025;
              if (!_eq(inst.inst_constraints, null)) {
                _t9025 = Typechecker$resolve_factory_dict(xctx, inst, arg_types_8997);
              } else {
                _t9025 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"}));
              }
              _t9023 = _t9025;
              break _t9024;
            }
            if (_t9022 === null) {
              function _t9026(ty) {
                let _t9028;
                const _t9027 = Types$repr(ty);
                _t9029: {
                  if ((_t9027._tag === 14 || _t9027._tag === 11)) {
                    _t9028 = true;
                    break _t9029;
                  }
                  if (true) {
                    _t9028 = false;
                    break _t9029;
                  }
                  _match_fail("line 16629");
                }
                return _t9028;
              }
              const is_structural_9030 = List$exists(_t9026, arg_types_8997);
              let _t9032;
              if ((is_structural_9030 && (cc.cc_class === "Show"))) {
                _t9032 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: ({_hd: ["show", Typechecker$mk(({_tag: 7, _name: "TEVar", _val: "__show_value"}), ({_tag: 6, _name: "TUnit"}))], _tl: null})}), ({_tag: 6, _name: "TUnit"}));
              } else {
                _t9032 = Typechecker$error(((("no instance of " + __dict_Show_string.show(cc.cc_class)) + " for types ") + __dict_Show_string.show(String$concat(", ", List$map(Types$pp_ty, arg_types_8997)))));
              }
              const _t9031 = _t9032;
              _t9023 = _t9031;
              break _t9024;
            }
            if (true) {
              let _t9034;
              const _t9033 = Types$most_specific_inst(matching_9020);
              _t9035: {
                if (_t9033._tag === 1) {
                  const inst = _t9033._val;
                  let _t9036;
                  if (!_eq(inst.inst_constraints, null)) {
                    _t9036 = Typechecker$resolve_factory_dict(xctx, inst, arg_types_8997);
                  } else {
                    _t9036 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"}));
                  }
                  _t9034 = _t9036;
                  break _t9035;
                }
                if (_t9033._tag === 0) {
                  _t9034 = Typechecker$error(("ambiguous instance for " + __dict_Show_string.show(cc.cc_class)));
                  break _t9035;
                }
                _match_fail("line 16629");
              }
              _t9023 = _t9034;
              break _t9024;
            }
            _match_fail("line 16629");
          }
          const _t9021 = _t9023;
          const _t9018 = _t9021;
          _t9014 = _t9018;
        }
        const _t9013 = _t9014;
        _t9006 = _t9013;
        break _t9007;
      }
      _match_fail("line 16629");
    }
    const _t9004 = _t9006;
    const _t8998 = _t9004;
    const _t8971 = _t8998;
    _t8967 = _t8971;
  }
  const _t8966 = _t8967;
  const _t8963 = _t8966;
  return _t8963;
}
function Typechecker$resolve_factory_dict(xctx, inst, arg_types) {
  const sub_map_9037 = Hashtbl$create(4);
  function _t9039(inst_ty, actual_ty) {
    function walk(s, a) {
      while (true) {
        const a_9040 = Types$repr(a);
        let _t9043;
        const _t9042 = s;
        _t9044: {
          if (_t9042._tag === 16) {
            const i = _t9042._val;
            let _t9045;
            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, sub_map_9037, i]))) {
              _t9045 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, sub_map_9037, i, a_9040]);
            } else {
              _t9045 = undefined;
            }
            _t9043 = _t9045;
            break _t9044;
          }
          if (_t9042._tag === 7) {
            const s1 = _t9042._val[0];
            const s2 = _t9042._val[2];
            let _t9047;
            const _t9046 = a_9040;
            _t9048: {
              if (_t9046._tag === 7) {
                const a1 = _t9046._val[0];
                const a2 = _t9046._val[2];
                walk(s1, a1);
                const _t9049 = s2;
                const _t9050 = a2;
                s = _t9049;
                a = _t9050;
                continue;
                _t9047 = undefined;
                break _t9048;
              }
              if (true) {
                _t9047 = undefined;
                break _t9048;
              }
              _match_fail("line 16629");
            }
            _t9043 = _t9047;
            break _t9044;
          }
          if (_t9042._tag === 8) {
            const s1 = _t9042._val[0];
            const s2 = _t9042._val[2];
            let _t9052;
            const _t9051 = a_9040;
            _t9053: {
              if (_t9051._tag === 8) {
                const a1 = _t9051._val[0];
                const a2 = _t9051._val[2];
                walk(s1, a1);
                const _t9054 = s2;
                const _t9055 = a2;
                s = _t9054;
                a = _t9055;
                continue;
                _t9052 = undefined;
                break _t9053;
              }
              if (true) {
                _t9052 = undefined;
                break _t9053;
              }
              _match_fail("line 16629");
            }
            _t9043 = _t9052;
            break _t9044;
          }
          if (_t9042._tag === 9) {
            const ss = _t9042._val;
            let _t9057;
            const _t9056 = a_9040;
            _t9058: {
              if (_t9056._tag === 9) {
                const aa = _t9056._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t9057 = List$iter2(walk, ss, aa);
                  break _t9058;
                }
              }
              if (true) {
                _t9057 = undefined;
                break _t9058;
              }
              _match_fail("line 16629");
            }
            _t9043 = _t9057;
            break _t9044;
          }
          if (_t9042._tag === 10) {
            const s1 = _t9042._val;
            let _t9060;
            const _t9059 = a_9040;
            _t9061: {
              if (_t9059._tag === 10) {
                const a1 = _t9059._val;
                const _t9062 = s1;
                const _t9063 = a1;
                s = _t9062;
                a = _t9063;
                continue;
                _t9060 = undefined;
                break _t9061;
              }
              if (true) {
                _t9060 = undefined;
                break _t9061;
              }
              _match_fail("line 16629");
            }
            _t9043 = _t9060;
            break _t9044;
          }
          if (_t9042._tag === 13) {
            const s1 = _t9042._val;
            let _t9065;
            const _t9064 = a_9040;
            _t9066: {
              if (_t9064._tag === 13) {
                const a1 = _t9064._val;
                const _t9067 = s1;
                const _t9068 = a1;
                s = _t9067;
                a = _t9068;
                continue;
                _t9065 = undefined;
                break _t9066;
              }
              if (true) {
                _t9065 = undefined;
                break _t9066;
              }
              _match_fail("line 16629");
            }
            _t9043 = _t9065;
            break _t9044;
          }
          if (_t9042._tag === 12) {
            const ss = _t9042._val[1];
            let _t9070;
            const _t9069 = a_9040;
            _t9071: {
              if (_t9069._tag === 12) {
                const aa = _t9069._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t9070 = List$iter2(walk, ss, aa);
                  break _t9071;
                }
              }
              if (true) {
                _t9070 = undefined;
                break _t9071;
              }
              _match_fail("line 16629");
            }
            _t9043 = _t9070;
            break _t9044;
          }
          if (true) {
            _t9043 = undefined;
            break _t9044;
          }
          _match_fail("line 16629");
        }
        const _t9041 = _t9043;
        return _t9041;
      }
    }
    const _t9072 = walk(inst_ty, actual_ty);
    return _t9072;
  }
  List$iter2(_t9039, inst.inst_tys, arg_types);
  const base_9073 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"}));
  function _t9075(fn_, sub_cc) {
    const sub_dict_9076 = Typechecker$resolve_dict_arg(xctx, sub_cc, sub_map_9037);
    const _t9077 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_, sub_dict_9076]}), ({_tag: 6, _name: "TUnit"}));
    return _t9077;
  }
  const _t9074 = List$fold(_t9075, base_9073, inst.inst_constraints);
  const _t9038 = _t9074;
  return _t9038;
}
function Typechecker$pat_bound_names(__x) {
  while (true) {
    let _t9079;
    const _t9078 = __x;
    _t9080: {
      if (_t9078._tag === 1) {
        const name = _t9078._val;
        _t9079 = ({_hd: name, _tl: null});
        break _t9080;
      }
      if ((_t9078._tag === 7 || _t9078._tag === 14)) {
        const pats = _t9078._val;
        _t9079 = List$concat_map(Typechecker$pat_bound_names, pats);
        break _t9080;
      }
      if (_t9078._tag === 8) {
        const p1 = _t9078._val[0];
        const p2 = _t9078._val[1];
        _t9079 = List$concat(Typechecker$pat_bound_names(p1), Typechecker$pat_bound_names(p2));
        break _t9080;
      }
      if ((_t9078._tag === 10 && _t9078._val[1]._tag === 1 || _t9078._tag === 16 && _t9078._val[1]._tag === 1)) {
        const p = _t9078._val[1]._val;
        const _t9081 = p;
        __x = _t9081;
        continue;
        _t9079 = undefined;
        break _t9080;
      }
      if (_t9078._tag === 11) {
        const fields = _t9078._val;
        function _t9082(__p324) {
          let _t9084;
          const _t9083 = __p324;
          _t9085: {
            if (true) {
              const p = _t9083[1];
              _t9084 = Typechecker$pat_bound_names(p);
              break _t9085;
            }
            _match_fail("line 16629");
          }
          return _t9084;
        }
        _t9079 = List$concat_map(_t9082, fields);
        break _t9080;
      }
      if (_t9078._tag === 12) {
        const p = _t9078._val[0];
        const name = _t9078._val[1];
        _t9079 = ({_hd: name, _tl: Typechecker$pat_bound_names(p)});
        break _t9080;
      }
      if (_t9078._tag === 13) {
        const p1 = _t9078._val[0];
        const _t9086 = p1;
        __x = _t9086;
        continue;
        _t9079 = undefined;
        break _t9080;
      }
      if (_t9078._tag === 15) {
        const pairs = _t9078._val;
        function _t9087(__p325) {
          let _t9089;
          const _t9088 = __p325;
          _t9090: {
            if (true) {
              const v = _t9088[1];
              _t9089 = Typechecker$pat_bound_names(v);
              break _t9090;
            }
            _match_fail("line 16629");
          }
          return _t9089;
        }
        _t9079 = List$concat_map(_t9087, pairs);
        break _t9080;
      }
      if (_t9078._tag === 18) {
        const p = _t9078._val[0];
        const _t9091 = p;
        __x = _t9091;
        continue;
        _t9079 = undefined;
        break _t9080;
      }
      if ((((((((((_t9078._tag === 0 || _t9078._tag === 2) || _t9078._tag === 3) || _t9078._tag === 4) || _t9078._tag === 5) || _t9078._tag === 6) || _t9078._tag === 9) || _t9078._tag === 17) || _t9078._tag === 10 && _t9078._val[1]._tag === 0) || _t9078._tag === 16 && _t9078._val[1]._tag === 0)) {
        _t9079 = null;
        break _t9080;
      }
      _match_fail("line 16629");
    }
    return _t9079;
  }
}
function Typechecker$xform_expr(xctx, te) {
  let _t9093;
  const _t9092 = te.expr;
  _t9094: {
    if (_t9092._tag === 7) {
      const name = _t9092._val;
      const te_9095 = Typechecker$xform_class_method(xctx, name, te);
      const _t9096 = Typechecker$xform_constrained_ref(xctx, name, te_9095);
      _t9093 = _t9096;
      break _t9094;
    }
    if (_t9092._tag === 13) {
      const op = _t9092._val[0];
      const e1 = _t9092._val[1];
      const e2 = _t9092._val[2];
      const e1$p_9097 = Typechecker$xform_expr(xctx, e1);
      const e2$p_9099 = Typechecker$xform_expr(xctx, e2);
      const _t9100 = Typechecker$xform_binop(xctx, op, e1$p_9097, e2$p_9099, te.ty);
      const _t9098 = _t9100;
      _t9093 = _t9098;
      break _t9094;
    }
    if (_t9092._tag === 14) {
      const op = _t9092._val[0];
      const e = _t9092._val[1];
      const e$p_9101 = Typechecker$xform_expr(xctx, e);
      const _t9102 = Typechecker$xform_unop(xctx, op, e$p_9101, te.ty);
      _t9093 = _t9102;
      break _t9094;
    }
    if (_t9092._tag === 11) {
      const fn_ = _t9092._val[0];
      const arg = _t9092._val[1];
      const fn$p_9103 = Typechecker$xform_expr(xctx, fn_);
      const arg$p_9105 = Typechecker$xform_expr(xctx, arg);
      const _t9106 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn$p_9103, arg$p_9105]}), te.ty);
      const _t9104 = _t9106;
      _t9093 = _t9104;
      break _t9094;
    }
    if (_t9092._tag === 10) {
      const param = _t9092._val[0];
      const body = _t9092._val[1];
      const hr = _t9092._val[2];
      const __rec_upd_9107 = xctx;
      const _t9108 = ({xf_constrained: __rec_upd_9107.xf_constrained, xf_locals: ({_hd: param, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9107.xf_record_evidence, xf_schemes: __rec_upd_9107.xf_schemes, xf_type_env: __rec_upd_9107.xf_type_env});
      const xctx$p_9109 = _t9108;
      const _t9110 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param, Typechecker$xform_expr(xctx$p_9109, body), hr]}), te.ty);
      _t9093 = _t9110;
      break _t9094;
    }
    if (_t9092._tag === 8 && _t9092._val[1]._tag === 1) {
      const name = _t9092._val[0];
      const scheme = _t9092._val[1]._val;
      const e1 = _t9092._val[2];
      const e2 = _t9092._val[3];
      const e1$p_9111 = Typechecker$xform_constrained_def(xctx, scheme, e1);
      const __rec_upd_9113 = xctx;
      const _t9114 = ({xf_constrained: __rec_upd_9113.xf_constrained, xf_locals: __rec_upd_9113.xf_locals, xf_record_evidence: __rec_upd_9113.xf_record_evidence, xf_schemes: ({_hd: [name, scheme], _tl: xctx.xf_schemes}), xf_type_env: __rec_upd_9113.xf_type_env});
      const xctx$p_9115 = _t9114;
      const _t9116 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [name, ({_tag: 1, _name: "Some", _val: scheme}), e1$p_9111, Typechecker$xform_expr(xctx$p_9115, e2)]}), te.ty);
      const _t9112 = _t9116;
      _t9093 = _t9112;
      break _t9094;
    }
    if (_t9092._tag === 8 && _t9092._val[1]._tag === 0) {
      const name = _t9092._val[0];
      const e1 = _t9092._val[2];
      const e2 = _t9092._val[3];
      const __rec_upd_9117 = xctx;
      const _t9118 = ({xf_constrained: __rec_upd_9117.xf_constrained, xf_locals: ({_hd: name, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9117.xf_record_evidence, xf_schemes: __rec_upd_9117.xf_schemes, xf_type_env: __rec_upd_9117.xf_type_env});
      const xctx$p_9119 = _t9118;
      const _t9120 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [name, ({_tag: 0, _name: "None"}), Typechecker$xform_expr(xctx, e1), Typechecker$xform_expr(xctx$p_9119, e2)]}), te.ty);
      _t9093 = _t9120;
      break _t9094;
    }
    if (_t9092._tag === 9 && _t9092._val[1]._tag === 1) {
      const name = _t9092._val[0];
      const scheme = _t9092._val[1]._val;
      const e1 = _t9092._val[2];
      const e2 = _t9092._val[3];
      const __rec_upd_9121 = xctx;
      const _t9122 = ({xf_constrained: __rec_upd_9121.xf_constrained, xf_locals: __rec_upd_9121.xf_locals, xf_record_evidence: __rec_upd_9121.xf_record_evidence, xf_schemes: ({_hd: [name, scheme], _tl: xctx.xf_schemes}), xf_type_env: __rec_upd_9121.xf_type_env});
      const xctx$p_9123 = _t9122;
      const e1$p_9125 = Typechecker$xform_constrained_def(xctx$p_9123, scheme, e1);
      const _t9126 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 1, _name: "Some", _val: scheme}), e1$p_9125, Typechecker$xform_expr(xctx$p_9123, e2)]}), te.ty);
      const _t9124 = _t9126;
      _t9093 = _t9124;
      break _t9094;
    }
    if (_t9092._tag === 9 && _t9092._val[1]._tag === 0) {
      const name = _t9092._val[0];
      const e1 = _t9092._val[2];
      const e2 = _t9092._val[3];
      const __rec_upd_9127 = xctx;
      const _t9128 = ({xf_constrained: __rec_upd_9127.xf_constrained, xf_locals: ({_hd: name, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9127.xf_record_evidence, xf_schemes: __rec_upd_9127.xf_schemes, xf_type_env: __rec_upd_9127.xf_type_env});
      const xctx$p_9129 = _t9128;
      const _t9130 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 0, _name: "None"}), Typechecker$xform_expr(xctx$p_9129, e1), Typechecker$xform_expr(xctx$p_9129, e2)]}), te.ty);
      _t9093 = _t9130;
      break _t9094;
    }
    if (_t9092._tag === 25) {
      const name = _t9092._val[0];
      const e1 = _t9092._val[1];
      const e2 = _t9092._val[2];
      const __rec_upd_9131 = xctx;
      const _t9132 = ({xf_constrained: __rec_upd_9131.xf_constrained, xf_locals: ({_hd: name, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9131.xf_record_evidence, xf_schemes: __rec_upd_9131.xf_schemes, xf_type_env: __rec_upd_9131.xf_type_env});
      const xctx$p_9133 = _t9132;
      const _t9134 = Typechecker$mk(({_tag: 25, _name: "TELetMut", _val: [name, Typechecker$xform_expr(xctx, e1), Typechecker$xform_expr(xctx$p_9133, e2)]}), te.ty);
      _t9093 = _t9134;
      break _t9094;
    }
    if (_t9092._tag === 32) {
      const cond = _t9092._val[0];
      const body = _t9092._val[1];
      _t9093 = Typechecker$mk(({_tag: 32, _name: "TEWhile", _val: [Typechecker$xform_expr(xctx, cond), Typechecker$xform_expr(xctx, body)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 37) {
      const bindings = _t9092._val[0];
      const body = _t9092._val[1];
      const names_9135 = List$map(fst, bindings);
      const __rec_upd_9137 = xctx;
      const _t9138 = ({xf_constrained: __rec_upd_9137.xf_constrained, xf_locals: List$concat(names_9135, xctx.xf_locals), xf_record_evidence: __rec_upd_9137.xf_record_evidence, xf_schemes: __rec_upd_9137.xf_schemes, xf_type_env: __rec_upd_9137.xf_type_env});
      const xctx$p_9139 = _t9138;
      function _t9141(__p326) {
        let _t9143;
        const _t9142 = __p326;
        _t9144: {
          if (true) {
            const n = _t9142[0];
            const e = _t9142[1];
            _t9143 = [n, Typechecker$xform_expr(xctx$p_9139, e)];
            break _t9144;
          }
          _match_fail("line 16629");
        }
        return _t9143;
      }
      const bindings$p_9145 = List$map(_t9141, bindings);
      const _t9146 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [bindings$p_9145, Typechecker$xform_expr(xctx$p_9139, body)]}), te.ty);
      const _t9140 = _t9146;
      const _t9136 = _t9140;
      _t9093 = _t9136;
      break _t9094;
    }
    if (_t9092._tag === 12) {
      const c = _t9092._val[0];
      const t = _t9092._val[1];
      const e = _t9092._val[2];
      _t9093 = Typechecker$mk(({_tag: 12, _name: "TEIf", _val: [Typechecker$xform_expr(xctx, c), Typechecker$xform_expr(xctx, t), Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 15) {
      const es = _t9092._val;
      _t9093 = Typechecker$mk(({_tag: 15, _name: "TETuple", _val: List$map(_call(Typechecker$xform_expr, [xctx]), es)}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 16) {
      const fields = _t9092._val;
      function _t9147(__p327) {
        let _t9149;
        const _t9148 = __p327;
        _t9150: {
          if (true) {
            const n = _t9148[0];
            const e = _t9148[1];
            _t9149 = [n, Typechecker$xform_expr(xctx, e)];
            break _t9150;
          }
          _match_fail("line 16629");
        }
        return _t9149;
      }
      _t9093 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: List$map(_t9147, fields)}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 17) {
      const base = _t9092._val[0];
      const overrides = _t9092._val[1];
      const base$p_9151 = Typechecker$xform_expr(xctx, base);
      function _t9153(__p328) {
        let _t9155;
        const _t9154 = __p328;
        _t9156: {
          if (true) {
            const n = _t9154[0];
            const e = _t9154[1];
            _t9155 = [n, Typechecker$xform_expr(xctx, e)];
            break _t9156;
          }
          _match_fail("line 16629");
        }
        return _t9155;
      }
      const overrides$p_9157 = List$map(_t9153, overrides);
      function get_row_tail(row) {
        while (true) {
          let _t9160;
          const _t9159 = Types$rrow_repr(row);
          _t9161: {
            if (_t9159._tag === 0) {
              const tail = _t9159._val[2];
              const _t9162 = tail;
              row = _t9162;
              continue;
              _t9160 = undefined;
              break _t9161;
            }
            if (true) {
              const tail = _t9159;
              _t9160 = tail;
              break _t9161;
            }
            _match_fail("line 16629");
          }
          return _t9160;
        }
      }
      let _t9165;
      const _t9164 = Types$repr(base$p_9151.ty);
      _t9166: {
        if (_t9164._tag === 11) {
          const row = _t9164._val;
          let _t9168;
          const _t9167 = get_row_tail(row);
          _t9169: {
            if (_t9167._tag === 1 && _t9167._val.contents._tag === 0) {
              const id = _t9167._val.contents._val[0];
              function _t9170(__p329) {
                let _t9172;
                const _t9171 = __p329;
                _t9173: {
                  if (true) {
                    const rid = _t9171[0];
                    _t9172 = (rid === id);
                    break _t9173;
                  }
                  _match_fail("line 16629");
                }
                return _t9172;
              }
              _t9168 = List$exists(_t9170, xctx.xf_record_evidence);
              break _t9169;
            }
            if (true) {
              _t9168 = false;
              break _t9169;
            }
            _match_fail("line 16629");
          }
          _t9165 = _t9168;
          break _t9166;
        }
        if (true) {
          _t9165 = false;
          break _t9166;
        }
        _match_fail("line 16629");
      }
      const has_evidence_9174 = _t9165;
      let _t9176;
      if (has_evidence_9174) {
        let _t9178;
        const _t9177 = Types$repr(base$p_9151.ty);
        _t9179: {
          if (_t9177._tag === 11) {
            const r = _t9177._val;
            _t9178 = r;
            break _t9179;
          }
          if (true) {
            _t9178 = failwith("assert false");
            break _t9179;
          }
          _match_fail("line 16629");
        }
        const row_9180 = _t9178;
        let _t9183;
        const _t9182 = get_row_tail(row_9180);
        _t9184: {
          if (_t9182._tag === 1 && _t9182._val.contents._tag === 0) {
            const id = _t9182._val.contents._val[0];
            _t9183 = id;
            break _t9184;
          }
          if (true) {
            _t9183 = failwith("assert false");
            break _t9184;
          }
          _match_fail("line 16629");
        }
        const rvar_id_9185 = _t9183;
        function _t9187(__p330) {
          let _t9189;
          const _t9188 = __p330;
          _t9190: {
            if (true) {
              const name = _t9188[0];
              const e = _t9188[1];
              function _t9191(__p331) {
                let _t9193;
                const _t9192 = __p331;
                _t9194: {
                  if (true) {
                    const rid = _t9192[0];
                    const fname = _t9192[1];
                    const pname = _t9192[2];
                    let _t9195;
                    if (((rid === rvar_id_9185) && (fname === name))) {
                      _t9195 = ({_tag: 1, _name: "Some", _val: pname});
                    } else {
                      _t9195 = ({_tag: 0, _name: "None"});
                    }
                    _t9193 = _t9195;
                    break _t9194;
                  }
                  _match_fail("line 16629");
                }
                return _t9193;
              }
              const ev_param_9196 = List$find_map(_t9191, xctx.xf_record_evidence);
              let _t9199;
              const _t9198 = ev_param_9196;
              _t9200: {
                if (_t9198._tag === 1) {
                  const pname = _t9198._val;
                  _t9199 = [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: pname}), ({_tag: 0, _name: "TInt"})), e];
                  break _t9200;
                }
                if (_t9198._tag === 0) {
                  _t9199 = Typechecker$error(("missing record evidence for field " + __dict_Show_string.show(name)));
                  break _t9200;
                }
                _match_fail("line 16629");
              }
              const _t9197 = _t9199;
              _t9189 = _t9197;
              break _t9190;
            }
            _match_fail("line 16629");
          }
          return _t9189;
        }
        const idx_val_pairs_9201 = List$map(_t9187, overrides$p_9157);
        const _t9202 = Typechecker$mk(({_tag: 18, _name: "TERecordUpdateIdx", _val: [base$p_9151, idx_val_pairs_9201]}), te.ty);
        const _t9186 = _t9202;
        const _t9181 = _t9186;
        _t9176 = _t9181;
      } else {
        _t9176 = Typechecker$mk(({_tag: 17, _name: "TERecordUpdate", _val: [base$p_9151, overrides$p_9157]}), te.ty);
      }
      const _t9175 = _t9176;
      const _t9163 = _t9175;
      const _t9158 = _t9163;
      const _t9152 = _t9158;
      _t9093 = _t9152;
      break _t9094;
    }
    if (_t9092._tag === 18) {
      const base = _t9092._val[0];
      const pairs = _t9092._val[1];
      function _t9203(__p332) {
        let _t9205;
        const _t9204 = __p332;
        _t9206: {
          if (true) {
            const i = _t9204[0];
            const v = _t9204[1];
            _t9205 = [Typechecker$xform_expr(xctx, i), Typechecker$xform_expr(xctx, v)];
            break _t9206;
          }
          _match_fail("line 16629");
        }
        return _t9205;
      }
      _t9093 = Typechecker$mk(({_tag: 18, _name: "TERecordUpdateIdx", _val: [Typechecker$xform_expr(xctx, base), List$map(_t9203, pairs)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 19) {
      const e = _t9092._val[0];
      const name = _t9092._val[1];
      _t9093 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$xform_expr(xctx, e), name]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 21) {
      const hd = _t9092._val[0];
      const tl = _t9092._val[1];
      _t9093 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [Typechecker$xform_expr(xctx, hd), Typechecker$xform_expr(xctx, tl)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 23) {
      const name = _t9092._val[0];
      const arg = _t9092._val[1];
      _t9093 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [name, Option$map(_call(Typechecker$xform_expr, [xctx]), arg)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 24) {
      const scrutinee = _t9092._val[0];
      const arms = _t9092._val[1];
      const partial = _t9092._val[2];
      function _t9207(__p333) {
        let _t9209;
        const _t9208 = __p333;
        _t9210: {
          if (true) {
            const pat = _t9208[0];
            const guard = _t9208[1];
            const body = _t9208[2];
            const pvars_9211 = Typechecker$pat_bound_names(pat);
            const __rec_upd_9213 = xctx;
            const _t9214 = ({xf_constrained: __rec_upd_9213.xf_constrained, xf_locals: List$concat(pvars_9211, xctx.xf_locals), xf_record_evidence: __rec_upd_9213.xf_record_evidence, xf_schemes: __rec_upd_9213.xf_schemes, xf_type_env: __rec_upd_9213.xf_type_env});
            const xctx$p_9215 = _t9214;
            const _t9216 = [pat, Option$map(_call(Typechecker$xform_expr, [xctx$p_9215]), guard), Typechecker$xform_expr(xctx$p_9215, body)];
            const _t9212 = _t9216;
            _t9209 = _t9212;
            break _t9210;
          }
          _match_fail("line 16629");
        }
        return _t9209;
      }
      const arms$p_9217 = List$map(_t9207, arms);
      const _t9218 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [Typechecker$xform_expr(xctx, scrutinee), arms$p_9217, partial]}), te.ty);
      _t9093 = _t9218;
      break _t9094;
    }
    if (_t9092._tag === 26) {
      const name = _t9092._val[0];
      const e = _t9092._val[1];
      _t9093 = Typechecker$mk(({_tag: 26, _name: "TEAssign", _val: [name, Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 27) {
      const r = _t9092._val[0];
      const f = _t9092._val[1];
      const e = _t9092._val[2];
      _t9093 = Typechecker$mk(({_tag: 27, _name: "TEFieldAssign", _val: [Typechecker$xform_expr(xctx, r), f, Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 28) {
      const e1 = _t9092._val[0];
      const e2 = _t9092._val[1];
      _t9093 = Typechecker$mk(({_tag: 28, _name: "TESeq", _val: [Typechecker$xform_expr(xctx, e1), Typechecker$xform_expr(xctx, e2)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 29) {
      const name = _t9092._val[0];
      const e = _t9092._val[1];
      _t9093 = Typechecker$mk(({_tag: 29, _name: "TEPerform", _val: [name, Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 30) {
      const body = _t9092._val[0];
      const arms = _t9092._val[1];
      function _t9219(arm) {
        let _t9221;
        const _t9220 = arm;
        _t9222: {
          if (_t9220._tag === 0) {
            const n = _t9220._val[0];
            const e = _t9220._val[1];
            const __rec_upd_9223 = xctx;
            const _t9224 = ({xf_constrained: __rec_upd_9223.xf_constrained, xf_locals: ({_hd: n, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9223.xf_record_evidence, xf_schemes: __rec_upd_9223.xf_schemes, xf_type_env: __rec_upd_9223.xf_type_env});
            const xctx$p_9225 = _t9224;
            const _t9226 = ({_tag: 0, _name: "THReturn", _val: [n, Typechecker$xform_expr(xctx$p_9225, e)]});
            _t9221 = _t9226;
            break _t9222;
          }
          if (_t9220._tag === 1) {
            const op = _t9220._val[0];
            const p = _t9220._val[1];
            const k = _t9220._val[2];
            const e = _t9220._val[3];
            const __rec_upd_9227 = xctx;
            const _t9228 = ({xf_constrained: __rec_upd_9227.xf_constrained, xf_locals: ({_hd: k, _tl: ({_hd: p, _tl: xctx.xf_locals})}), xf_record_evidence: __rec_upd_9227.xf_record_evidence, xf_schemes: __rec_upd_9227.xf_schemes, xf_type_env: __rec_upd_9227.xf_type_env});
            const xctx$p_9229 = _t9228;
            const _t9230 = ({_tag: 1, _name: "THOp", _val: [op, p, k, Typechecker$xform_expr(xctx$p_9229, e)]});
            _t9221 = _t9230;
            break _t9222;
          }
          if (_t9220._tag === 2) {
            const op = _t9220._val[0];
            const p = _t9220._val[1];
            const e = _t9220._val[2];
            const __rec_upd_9231 = xctx;
            const _t9232 = ({xf_constrained: __rec_upd_9231.xf_constrained, xf_locals: ({_hd: p, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9231.xf_record_evidence, xf_schemes: __rec_upd_9231.xf_schemes, xf_type_env: __rec_upd_9231.xf_type_env});
            const xctx$p_9233 = _t9232;
            const _t9234 = ({_tag: 2, _name: "THOpProvide", _val: [op, p, Typechecker$xform_expr(xctx$p_9233, e)]});
            _t9221 = _t9234;
            break _t9222;
          }
          if (_t9220._tag === 3) {
            const op = _t9220._val[0];
            const p = _t9220._val[1];
            const e = _t9220._val[2];
            const __rec_upd_9235 = xctx;
            const _t9236 = ({xf_constrained: __rec_upd_9235.xf_constrained, xf_locals: ({_hd: p, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9235.xf_record_evidence, xf_schemes: __rec_upd_9235.xf_schemes, xf_type_env: __rec_upd_9235.xf_type_env});
            const xctx$p_9237 = _t9236;
            const _t9238 = ({_tag: 3, _name: "THOpTry", _val: [op, p, Typechecker$xform_expr(xctx$p_9237, e)]});
            _t9221 = _t9238;
            break _t9222;
          }
          _match_fail("line 16629");
        }
        return _t9221;
      }
      const arms$p_9239 = List$map(_t9219, arms);
      const _t9240 = Typechecker$mk(({_tag: 30, _name: "TEHandle", _val: [Typechecker$xform_expr(xctx, body), arms$p_9239]}), te.ty);
      _t9093 = _t9240;
      break _t9094;
    }
    if (_t9092._tag === 31) {
      const k = _t9092._val[0];
      const e = _t9092._val[1];
      _t9093 = Typechecker$mk(({_tag: 31, _name: "TEResume", _val: [Typechecker$xform_expr(xctx, k), Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 38) {
      const es = _t9092._val;
      _t9093 = Typechecker$mk(({_tag: 38, _name: "TEArray", _val: List$map(_call(Typechecker$xform_expr, [xctx]), es)}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 20) {
      const base = _t9092._val[0];
      const idx = _t9092._val[1];
      _t9093 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [Typechecker$xform_expr(xctx, base), Typechecker$xform_expr(xctx, idx)]}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 33) {
      const e = _t9092._val;
      _t9093 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 34) {
      _t9093 = te;
      break _t9094;
    }
    if (_t9092._tag === 35) {
      const e = _t9092._val;
      _t9093 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 36) {
      const e = _t9092._val;
      _t9093 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t9094;
    }
    if (_t9092._tag === 39) {
      const e = _t9092._val;
      _t9093 = Typechecker$mk(({_tag: 39, _name: "TEReturn", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t9094;
    }
    if ((((((((_t9092._tag === 0 || _t9092._tag === 1) || _t9092._tag === 2) || _t9092._tag === 3) || _t9092._tag === 4) || _t9092._tag === 5) || _t9092._tag === 6) || _t9092._tag === 22)) {
      _t9093 = te;
      break _t9094;
    }
    _match_fail("line 16629");
  }
  return _t9093;
}
function Typechecker$xform_class_method(xctx, name, te) {
  let _t9241;
  if (List$mem(name, xctx.xf_locals)) {
    _t9241 = te;
  } else {
    let _t9243;
    const _t9242 = Types$find_method_class(xctx.xf_type_env.classes, name);
    _t9244: {
      if (_t9242._tag === 1) {
        const result = _t9242;
        _t9243 = [result, name];
        break _t9244;
      }
      if (_t9242._tag === 0) {
        let _t9246;
        const _t9245 = String$rindex_opt(name, 46);
        _t9247: {
          if (_t9245._tag === 0) {
            _t9246 = [({_tag: 0, _name: "None"}), name];
            break _t9247;
          }
          if (_t9245._tag === 1) {
            const i = _t9245._val;
            const mod_prefix_9248 = String$sub(name, 0, (i + 1));
            const _mml$short_9250 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
            const class_prefix_9252 = String$sub(name, 0, i);
            let _t9255;
            const _t9254 = Types$find_method_class(xctx.xf_type_env.classes, _mml$short_9250);
            _t9256: {
              if (_t9254._tag === 1) {
                const class_def = _t9254._val;
                if ((class_def.class_name === class_prefix_9252)) {
                  _t9255 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_9250];
                  break _t9256;
                }
              }
              if (_t9254._tag === 1) {
                const class_def = _t9254._val;
                if (((String$length(class_def.class_name) > String$length(mod_prefix_9248)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_9248)) === mod_prefix_9248))) {
                  _t9255 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_9250];
                  break _t9256;
                }
              }
              if (true) {
                _t9255 = [({_tag: 0, _name: "None"}), name];
                break _t9256;
              }
              _match_fail("line 16629");
            }
            const _t9253 = _t9255;
            const _t9251 = _t9253;
            const _t9249 = _t9251;
            _t9246 = _t9249;
            break _t9247;
          }
          _match_fail("line 16629");
        }
        _t9243 = _t9246;
        break _t9244;
      }
      _match_fail("line 16629");
    }
    let _t9258;
    const _t9257 = _t9243;
    _t9259: {
      if (true) {
        const class_opt = _t9257[0];
        const method_name = _t9257[1];
        let _t9261;
        const _t9260 = class_opt;
        _t9262: {
          if (_t9260._tag === 1) {
            const class_def = _t9260._val;
            const method_schema_ty_9263 = List$assoc(method_name, class_def.class_methods);
            let _t9266;
            const _t9265 = List$assoc_opt(name, xctx.xf_schemes);
            _t9267: {
              if (_t9265._tag === 1) {
                const s = _t9265._val;
                _t9266 = !_eq(s.body, method_schema_ty_9263);
                break _t9267;
              }
              if (_t9265._tag === 0) {
                _t9266 = false;
                break _t9267;
              }
              _match_fail("line 16629");
            }
            const is_overridden_9268 = _t9266;
            let _t9270;
            if (is_overridden_9268) {
              _t9270 = te;
            } else {
              const num_params_9271 = List$length(class_def.class_params);
              const found_9273 = Hashtbl$create(num_params_9271);
              function go(s, r) {
                while (true) {
                  const r_9275 = Types$repr(r);
                  let _t9278;
                  const _t9277 = [s, r_9275];
                  _t9279: {
                    if (_t9277[0]._tag === 16) {
                      const i = _t9277[0]._val;
                      if ((i < num_params_9271)) {
                        let _t9280;
                        if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, found_9273, i]))) {
                          _t9280 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_9273, i, r_9275]);
                        } else {
                          _t9280 = undefined;
                        }
                        _t9278 = _t9280;
                        break _t9279;
                      }
                    }
                    if ((_t9277[0]._tag === 7 && _t9277[1]._tag === 7 || _t9277[0]._tag === 8 && _t9277[1]._tag === 8)) {
                      const s1 = _t9277[0]._val[0];
                      const s2 = _t9277[0]._val[2];
                      const r1 = _t9277[1]._val[0];
                      const r2 = _t9277[1]._val[2];
                      go(s1, r1);
                      const _t9281 = s2;
                      const _t9282 = r2;
                      s = _t9281;
                      r = _t9282;
                      continue;
                      _t9278 = undefined;
                      break _t9279;
                    }
                    if (_t9277[0]._tag === 9 && _t9277[1]._tag === 9) {
                      const ss = _t9277[0]._val;
                      const rs = _t9277[1]._val;
                      if ((List$length(ss) === List$length(rs))) {
                        _t9278 = List$iter2(go, ss, rs);
                        break _t9279;
                      }
                    }
                    if (_t9277[0]._tag === 10 && _t9277[1]._tag === 10) {
                      const s1 = _t9277[0]._val;
                      const r1 = _t9277[1]._val;
                      const _t9283 = s1;
                      const _t9284 = r1;
                      s = _t9283;
                      r = _t9284;
                      continue;
                      _t9278 = undefined;
                      break _t9279;
                    }
                    if (_t9277[0]._tag === 13 && _t9277[1]._tag === 13) {
                      const s1 = _t9277[0]._val;
                      const r1 = _t9277[1]._val;
                      const _t9285 = s1;
                      const _t9286 = r1;
                      s = _t9285;
                      r = _t9286;
                      continue;
                      _t9278 = undefined;
                      break _t9279;
                    }
                    if (_t9277[0]._tag === 12 && _t9277[1]._tag === 12) {
                      const ss = _t9277[0]._val[1];
                      const rs = _t9277[1]._val[1];
                      if ((List$length(ss) === List$length(rs))) {
                        _t9278 = List$iter2(go, ss, rs);
                        break _t9279;
                      }
                    }
                    if (true) {
                      _t9278 = undefined;
                      break _t9279;
                    }
                    _match_fail("line 16629");
                  }
                  const _t9276 = _t9278;
                  return _t9276;
                }
              }
              go(method_schema_ty_9263, te.ty);
              let _t9288;
              if (!_eq(xctx.xf_constrained, null)) {
                function _t9289(i) {
                  let _t9291;
                  const _t9290 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_9273, i]);
                  _t9292: {
                    if (_t9290._tag === 1 && _t9290._val._tag === 15 && _t9290._val._val.contents._tag === 0) {
                      const id = _t9290._val._val.contents._val[0];
                      _t9291 = Typechecker$find_constrained_dict(xctx, id, class_def.class_name);
                      break _t9292;
                    }
                    if (true) {
                      _t9291 = ({_tag: 0, _name: "None"});
                      break _t9292;
                    }
                    _match_fail("line 16629");
                  }
                  return _t9291;
                }
                function _t9293(x) {
                  return x;
                }
                const exact_match_9294 = List$find_map(_t9289, List$init(num_params_9271, _t9293));
                let _t9297;
                const _t9296 = exact_match_9294;
                _t9298: {
                  if (_t9296._tag === 1) {
                    _t9297 = exact_match_9294;
                    break _t9298;
                  }
                  if (_t9296._tag === 0) {
                    function _t9299(i) {
                      let _t9301;
                      const _t9300 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_9273, i]);
                      _t9302: {
                        if (_t9300._tag === 1 && _t9300._val._tag === 15 && _t9300._val._val.contents._tag === 0) {
                          _t9301 = true;
                          break _t9302;
                        }
                        if (true) {
                          _t9301 = false;
                          break _t9302;
                        }
                        _match_fail("line 16629");
                      }
                      return _t9301;
                    }
                    function _t9303(x) {
                      return x;
                    }
                    const has_unbound_arg_9304 = List$exists(_t9299, List$init(num_params_9271, _t9303));
                    let _t9306;
                    if (has_unbound_arg_9304) {
                      function _t9307(__p334) {
                        let _t9309;
                        const _t9308 = __p334;
                        _t9310: {
                          if (true) {
                            const _tid = _t9308[0];
                            const _dp = _t9308[1];
                            const cls = _t9308[2];
                            _t9309 = (cls === class_def.class_name);
                            break _t9310;
                          }
                          _match_fail("line 16629");
                        }
                        return _t9309;
                      }
                      const matching_constraints_9311 = List$filter(_t9307, xctx.xf_constrained);
                      let _t9314;
                      const _t9313 = matching_constraints_9311;
                      _t9315: {
                        if (_t9313 !== null && _t9313._tl === null) {
                          const _tid = _t9313._hd[0];
                          const dp = _t9313._hd[1];
                          const _cls = _t9313._hd[2];
                          _t9314 = ({_tag: 1, _name: "Some", _val: dp});
                          break _t9315;
                        }
                        if (true) {
                          _t9314 = ({_tag: 0, _name: "None"});
                          break _t9315;
                        }
                        _match_fail("line 16629");
                      }
                      const _t9312 = _t9314;
                      _t9306 = _t9312;
                    } else {
                      _t9306 = ({_tag: 0, _name: "None"});
                    }
                    const _t9305 = _t9306;
                    _t9297 = _t9305;
                    break _t9298;
                  }
                  _match_fail("line 16629");
                }
                const _t9295 = _t9297;
                _t9288 = _t9295;
              } else {
                _t9288 = ({_tag: 0, _name: "None"});
              }
              const constrained_match_9316 = _t9288;
              let _t9319;
              const _t9318 = constrained_match_9316;
              _t9320: {
                if (_t9318._tag === 1) {
                  const dp = _t9318._val;
                  _t9319 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dp}), ({_tag: 6, _name: "TUnit"})), method_name]}), te.ty);
                  break _t9320;
                }
                if (_t9318._tag === 0) {
                  function _t9321(i) {
                    return _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_9273, i]);
                  }
                  const type_args_9322 = List$init(num_params_9271, _t9321);
                  function _t9324(opt) {
                    let _t9326;
                    const _t9325 = opt;
                    _t9327: {
                      if (_t9325._tag === 1) {
                        const ty = _t9325._val;
                        let _t9329;
                        const _t9328 = Types$repr(ty);
                        _t9330: {
                          if (_t9328._tag === 15 && _t9328._val.contents._tag === 0) {
                            _t9329 = ({_tag: 0, _name: "None"});
                            break _t9330;
                          }
                          if (true) {
                            _t9329 = ({_tag: 1, _name: "Some", _val: ty});
                            break _t9330;
                          }
                          _match_fail("line 16629");
                        }
                        _t9326 = _t9329;
                        break _t9327;
                      }
                      if (_t9325._tag === 0) {
                        _t9326 = ({_tag: 0, _name: "None"});
                        break _t9327;
                      }
                      _match_fail("line 16629");
                    }
                    return _t9326;
                  }
                  const partial_args_9331 = List$map(_t9324, type_args_9322);
                  function _t9333(opt) {
                    return !_eq(opt, ({_tag: 0, _name: "None"}));
                  }
                  const has_info_9334 = List$exists(_t9333, partial_args_9331);
                  let _t9336;
                  if (has_info_9334) {
                    function _t9337(inst) {
                      return ((inst.inst_class === class_def.class_name) && ((List$length(inst.inst_tys) === List$length(partial_args_9331)) && Types$match_partial_inst(inst.inst_tys, partial_args_9331)));
                    }
                    const matching_9338 = List$filter(_t9337, xctx.xf_type_env.instances);
                    function _t9340(opt) {
                      return !_eq(opt, ({_tag: 0, _name: "None"}));
                    }
                    const all_concrete_9341 = List$forall(_t9340, partial_args_9331);
                    let _t9344;
                    const _t9343 = matching_9338;
                    _t9345: {
                      if (_t9343 !== null && _t9343._tl === null) {
                        const inst = _t9343._hd;
                        _t9344 = ({_tag: 1, _name: "Some", _val: inst});
                        break _t9345;
                      }
                      if (_t9343 !== null) {
                        _t9344 = Types$most_specific_inst(matching_9338);
                        break _t9345;
                      }
                      if (_t9343 === null) {
                        _t9344 = ({_tag: 0, _name: "None"});
                        break _t9345;
                      }
                      _match_fail("line 16629");
                    }
                    const resolved_9346 = _t9344;
                    function _t9348(inst) {
                      function _t9349(__p335) {
                        let _t9351;
                        const _t9350 = __p335;
                        _t9352: {
                          if (true) {
                            const n = _t9350[0];
                            _t9351 = (n === method_name);
                            break _t9352;
                          }
                          _match_fail("line 16629");
                        }
                        return _t9351;
                      }
                      let _t9354;
                      const _t9353 = List$find(_t9349, class_def.class_methods);
                      _t9355: {
                        if (_t9353._tag === 1) {
                          const method_ty = _t9353._val[1];
                          function _t9356(ty, __p336) {
                            let _t9358;
                            const _t9357 = __p336;
                            _t9359: {
                              if (true) {
                                const i = _t9357[0];
                                const inst_ty = _t9357[1];
                                function subst(t) {
                                  let _t9361;
                                  const _t9360 = t;
                                  _t9362: {
                                    if (_t9360._tag === 16) {
                                      const j = _t9360._val;
                                      if ((j === i)) {
                                        _t9361 = inst_ty;
                                        break _t9362;
                                      }
                                    }
                                    if (_t9360._tag === 7) {
                                      const a = _t9360._val[0];
                                      const e = _t9360._val[1];
                                      const r = _t9360._val[2];
                                      _t9361 = ({_tag: 7, _name: "TArrow", _val: [subst(a), e, subst(r)]});
                                      break _t9362;
                                    }
                                    if (_t9360._tag === 9) {
                                      const ts = _t9360._val;
                                      _t9361 = ({_tag: 9, _name: "TTuple", _val: List$map(subst, ts)});
                                      break _t9362;
                                    }
                                    if (_t9360._tag === 10) {
                                      const t = _t9360._val;
                                      _t9361 = ({_tag: 10, _name: "TList", _val: subst(t)});
                                      break _t9362;
                                    }
                                    if (_t9360._tag === 13) {
                                      const t = _t9360._val;
                                      _t9361 = ({_tag: 13, _name: "TArray", _val: subst(t)});
                                      break _t9362;
                                    }
                                    if (true) {
                                      _t9361 = t;
                                      break _t9362;
                                    }
                                    _match_fail("line 16629");
                                  }
                                  return _t9361;
                                }
                                const _t9363 = subst(ty);
                                _t9358 = _t9363;
                                break _t9359;
                              }
                              _match_fail("line 16629");
                            }
                            return _t9358;
                          }
                          function _t9364(i, t) {
                            return [i, t];
                          }
                          const concrete_ty_9365 = List$fold(_t9356, method_ty, List$mapi(_t9364, inst.inst_tys));
                          const _t9366 = concrete_ty_9365;
                          _t9354 = _t9366;
                          break _t9355;
                        }
                        if (_t9353._tag === 0) {
                          _t9354 = te.ty;
                          break _t9355;
                        }
                        _match_fail("line 16629");
                      }
                      return _t9354;
                    }
                    const resolve_method_type_9367 = _t9348;
                    let _t9370;
                    const _t9369 = resolved_9346;
                    _t9371: {
                      if (_t9369._tag === 1) {
                        const inst = _t9369._val;
                        if ((!_eq(inst.inst_constraints, null) && all_concrete_9341)) {
                          function _t9372(x) {
                            return x;
                          }
                          const arg_types_9373 = List$filter_map(_t9372, type_args_9322);
                          const factory_9375 = Typechecker$resolve_factory_dict(xctx, inst, arg_types_9373);
                          const resolved_ty_9377 = resolve_method_type_9367(inst);
                          const _t9378 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [factory_9375, method_name]}), resolved_ty_9377);
                          const _t9376 = _t9378;
                          const _t9374 = _t9376;
                          _t9370 = _t9374;
                          break _t9371;
                        }
                      }
                      if (_t9369._tag === 1) {
                        const inst = _t9369._val;
                        if (_eq(inst.inst_constraints, null)) {
                          const resolved_ty_9379 = resolve_method_type_9367(inst);
                          const _t9380 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"})), method_name]}), resolved_ty_9379);
                          _t9370 = _t9380;
                          break _t9371;
                        }
                      }
                      if (true) {
                        _t9370 = te;
                        break _t9371;
                      }
                      _match_fail("line 16629");
                    }
                    const _t9368 = _t9370;
                    const _t9347 = _t9368;
                    const _t9342 = _t9347;
                    const _t9339 = _t9342;
                    _t9336 = _t9339;
                  } else {
                    function _t9381(inst) {
                      return ((inst.inst_class === class_def.class_name) && _eq(inst.inst_constraints, null));
                    }
                    let _t9383;
                    const _t9382 = List$filter(_t9381, xctx.xf_type_env.instances);
                    _t9384: {
                      if (_t9382 !== null && _t9382._tl === null) {
                        const inst = _t9382._hd;
                        _t9383 = ({_tag: 1, _name: "Some", _val: inst});
                        break _t9384;
                      }
                      if (true) {
                        _t9383 = ({_tag: 0, _name: "None"});
                        break _t9384;
                      }
                      _match_fail("line 16629");
                    }
                    const singleton_inst_9385 = _t9383;
                    let _t9388;
                    const _t9387 = singleton_inst_9385;
                    _t9389: {
                      if (_t9387._tag === 1) {
                        const inst = _t9387._val;
                        function _t9390(inst) {
                          function _t9391(__p337) {
                            let _t9393;
                            const _t9392 = __p337;
                            _t9394: {
                              if (true) {
                                const n = _t9392[0];
                                _t9393 = (n === method_name);
                                break _t9394;
                              }
                              _match_fail("line 16629");
                            }
                            return _t9393;
                          }
                          let _t9396;
                          const _t9395 = List$find(_t9391, class_def.class_methods);
                          _t9397: {
                            if (_t9395._tag === 1) {
                              const method_ty = _t9395._val[1];
                              function _t9398(ty, __p338) {
                                let _t9400;
                                const _t9399 = __p338;
                                _t9401: {
                                  if (true) {
                                    const i = _t9399[0];
                                    const inst_ty = _t9399[1];
                                    function subst(t) {
                                      let _t9403;
                                      const _t9402 = t;
                                      _t9404: {
                                        if (_t9402._tag === 16) {
                                          const j = _t9402._val;
                                          if ((j === i)) {
                                            _t9403 = inst_ty;
                                            break _t9404;
                                          }
                                        }
                                        if (_t9402._tag === 7) {
                                          const a = _t9402._val[0];
                                          const e = _t9402._val[1];
                                          const r = _t9402._val[2];
                                          _t9403 = ({_tag: 7, _name: "TArrow", _val: [subst(a), e, subst(r)]});
                                          break _t9404;
                                        }
                                        if (_t9402._tag === 9) {
                                          const ts = _t9402._val;
                                          _t9403 = ({_tag: 9, _name: "TTuple", _val: List$map(subst, ts)});
                                          break _t9404;
                                        }
                                        if (_t9402._tag === 10) {
                                          const t = _t9402._val;
                                          _t9403 = ({_tag: 10, _name: "TList", _val: subst(t)});
                                          break _t9404;
                                        }
                                        if (_t9402._tag === 13) {
                                          const t = _t9402._val;
                                          _t9403 = ({_tag: 13, _name: "TArray", _val: subst(t)});
                                          break _t9404;
                                        }
                                        if (true) {
                                          _t9403 = t;
                                          break _t9404;
                                        }
                                        _match_fail("line 16629");
                                      }
                                      return _t9403;
                                    }
                                    const _t9405 = subst(ty);
                                    _t9400 = _t9405;
                                    break _t9401;
                                  }
                                  _match_fail("line 16629");
                                }
                                return _t9400;
                              }
                              function _t9406(i, t) {
                                return [i, t];
                              }
                              const concrete_ty_9407 = List$fold(_t9398, method_ty, List$mapi(_t9406, inst.inst_tys));
                              const _t9408 = concrete_ty_9407;
                              _t9396 = _t9408;
                              break _t9397;
                            }
                            if (_t9395._tag === 0) {
                              _t9396 = te.ty;
                              break _t9397;
                            }
                            _match_fail("line 16629");
                          }
                          return _t9396;
                        }
                        const resolve_method_type_9409 = _t9390;
                        const resolved_ty_9411 = resolve_method_type_9409(inst);
                        const _t9412 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"})), method_name]}), resolved_ty_9411);
                        const _t9410 = _t9412;
                        _t9388 = _t9410;
                        break _t9389;
                      }
                      if (_t9387._tag === 0) {
                        _t9388 = te;
                        break _t9389;
                      }
                      _match_fail("line 16629");
                    }
                    const _t9386 = _t9388;
                    _t9336 = _t9386;
                  }
                  const _t9335 = _t9336;
                  const _t9332 = _t9335;
                  const _t9323 = _t9332;
                  _t9319 = _t9323;
                  break _t9320;
                }
                _match_fail("line 16629");
              }
              const _t9317 = _t9319;
              const _t9287 = _t9317;
              const _t9274 = _t9287;
              const _t9272 = _t9274;
              _t9270 = _t9272;
            }
            const _t9269 = _t9270;
            const _t9264 = _t9269;
            _t9261 = _t9264;
            break _t9262;
          }
          if (_t9260._tag === 0) {
            _t9261 = te;
            break _t9262;
          }
          _match_fail("line 16629");
        }
        _t9258 = _t9261;
        break _t9259;
      }
      _match_fail("line 16629");
    }
    _t9241 = _t9258;
  }
  return _t9241;
}
function Typechecker$xform_constrained_ref(xctx, name, te) {
  let _t9414;
  const _t9413 = List$assoc_opt(name, xctx.xf_schemes);
  _t9415: {
    if (_t9413._tag === 1) {
      const scheme = _t9413._val;
      if (Typechecker$scheme_needs_xform(scheme)) {
        const result_9416 = Ref$create(te);
        let _t9418;
        if (!_eq(scheme.constraints, null)) {
          const tgen_map_9419 = Typechecker$build_tgen_map(scheme.body, te.ty);
          function _t9421(cc) {
            return Typechecker$resolve_dict_arg(xctx, cc, tgen_map_9419);
          }
          const dict_args_9422 = List$map(_t9421, scheme.constraints);
          function _t9424(fn_, dict_arg) {
            return Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_, dict_arg]}), ({_tag: 6, _name: "TUnit"}));
          }
          const _t9423 = Ref$set(result_9416, List$fold(_t9424, Ref$get(result_9416), dict_args_9422));
          const _t9420 = _t9423;
          _t9418 = _t9420;
        } else {
          _t9418 = undefined;
        }
        _t9418;
        let _t9425;
        if (!_eq(scheme.record_evidences, null)) {
          const rgen_map_9426 = Typechecker$build_rgen_map(scheme.body, te.ty);
          function _t9428(re) {
            return Typechecker$resolve_record_evidence_args(xctx, rgen_map_9426, re);
          }
          const ev_args_9429 = List$concat_map(_t9428, scheme.record_evidences);
          function _t9431(fn_, ev_arg) {
            return Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_, ev_arg]}), ({_tag: 6, _name: "TUnit"}));
          }
          const _t9430 = Ref$set(result_9416, List$fold(_t9431, Ref$get(result_9416), ev_args_9429));
          const _t9427 = _t9430;
          _t9425 = _t9427;
        } else {
          _t9425 = undefined;
        }
        _t9425;
        const _t9417 = Ref$get(result_9416);
        _t9414 = _t9417;
        break _t9415;
      }
    }
    if (true) {
      _t9414 = te;
      break _t9415;
    }
    _match_fail("line 16629");
  }
  return _t9414;
}
function Typechecker$resolve_record_evidence_args(xctx, rgen_map, re) {
  let _t9433;
  const _t9432 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rgen_map, re.re_rgen]);
  _t9434: {
    if (_t9432._tag === 1) {
      const arow = _t9432._val;
      const fields_9435 = Types$record_row_to_fields(arow);
      function _t9437(__p339, __p340) {
        let _t9439;
        const _t9438 = __p339;
        _t9440: {
          if (true) {
            const a = _t9438[0];
            let _t9442;
            const _t9441 = __p340;
            _t9443: {
              if (true) {
                const b = _t9441[0];
                _t9442 = String$compare(a, b);
                break _t9443;
              }
              _match_fail("line 16629");
            }
            _t9439 = _t9442;
            break _t9440;
          }
          _match_fail("line 16629");
        }
        return _t9439;
      }
      const sorted_names_9444 = List$map(fst, List$sort(_t9437, fields_9435));
      function is_closed(r) {
        while (true) {
          let _t9447;
          const _t9446 = Types$rrow_repr(r);
          _t9448: {
            if (_t9446._tag === 0) {
              const tail = _t9446._val[2];
              const _t9449 = tail;
              r = _t9449;
              continue;
              _t9447 = undefined;
              break _t9448;
            }
            if (_t9446._tag === 2) {
              _t9447 = true;
              break _t9448;
            }
            if (true) {
              _t9447 = false;
              break _t9448;
            }
            _match_fail("line 16629");
          }
          return _t9447;
        }
      }
      let _t9451;
      if (is_closed(arow)) {
        function _t9452(field_name) {
          const idx_9453 = Ref$create((-1));
          function _t9455(i, n) {
            let _t9456;
            if ((n === field_name)) {
              _t9456 = Ref$set(idx_9453, i);
            } else {
              _t9456 = undefined;
            }
            return _t9456;
          }
          List$iteri(_t9455, sorted_names_9444);
          let _t9457;
          if ((Ref$get(idx_9453) >= 0)) {
            _t9457 = Typechecker$mk(({_tag: 0, _name: "TEInt", _val: Ref$get(idx_9453)}), ({_tag: 0, _name: "TInt"}));
          } else {
            _t9457 = Typechecker$error((("field " + __dict_Show_string.show(field_name)) + " not found in concrete record for evidence"));
          }
          const _t9454 = _t9457;
          return _t9454;
        }
        _t9451 = List$map(_t9452, re.re_fields);
      } else {
        function get_tail(r) {
          while (true) {
            let _t9459;
            const _t9458 = Types$rrow_repr(r);
            _t9460: {
              if (_t9458._tag === 0) {
                const tail = _t9458._val[2];
                const _t9461 = tail;
                r = _t9461;
                continue;
                _t9459 = undefined;
                break _t9460;
              }
              if (true) {
                const tail = _t9458;
                _t9459 = tail;
                break _t9460;
              }
              _match_fail("line 16629");
            }
            return _t9459;
          }
        }
        let _t9464;
        const _t9463 = get_tail(arow);
        _t9465: {
          if (_t9463._tag === 1 && _t9463._val.contents._tag === 0) {
            const id = _t9463._val.contents._val[0];
            function _t9466(field_name) {
              function _t9467(__p341) {
                let _t9469;
                const _t9468 = __p341;
                _t9470: {
                  if (true) {
                    const rid = _t9468[0];
                    const fname = _t9468[1];
                    const pname = _t9468[2];
                    let _t9471;
                    if (((rid === id) && (fname === field_name))) {
                      _t9471 = ({_tag: 1, _name: "Some", _val: pname});
                    } else {
                      _t9471 = ({_tag: 0, _name: "None"});
                    }
                    _t9469 = _t9471;
                    break _t9470;
                  }
                  _match_fail("line 16629");
                }
                return _t9469;
              }
              let _t9473;
              const _t9472 = List$find_map(_t9467, xctx.xf_record_evidence);
              _t9474: {
                if (_t9472._tag === 1) {
                  const pname = _t9472._val;
                  _t9473 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: pname}), ({_tag: 0, _name: "TInt"}));
                  break _t9474;
                }
                if (_t9472._tag === 0) {
                  _t9473 = Typechecker$error((("no evidence for field " + __dict_Show_string.show(field_name)) + " in polymorphic context"));
                  break _t9474;
                }
                _match_fail("line 16629");
              }
              return _t9473;
            }
            _t9464 = List$map(_t9466, re.re_fields);
            break _t9465;
          }
          if (true) {
            _t9464 = Typechecker$error("expected open row for evidence forwarding");
            break _t9465;
          }
          _match_fail("line 16629");
        }
        const _t9462 = _t9464;
        _t9451 = _t9462;
      }
      const _t9450 = _t9451;
      const _t9445 = _t9450;
      const _t9436 = _t9445;
      _t9433 = _t9436;
      break _t9434;
    }
    if (_t9432._tag === 0) {
      _t9433 = Typechecker$error((("internal error: no record evidence for fields [" + __dict_Show_string.show(String$concat(", ", re.re_fields))) + "]"));
      break _t9434;
    }
    _match_fail("line 16629");
  }
  return _t9433;
}
function Typechecker$xform_binop(xctx, op, e1, e2, result_ty) {
  let _t9476;
  const _t9475 = op;
  _t9477: {
    if (_t9475._tag === 0) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Num", "+"]});
      break _t9477;
    }
    if (_t9475._tag === 1) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Num", "-"]});
      break _t9477;
    }
    if (_t9475._tag === 2) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Num", "*"]});
      break _t9477;
    }
    if (_t9475._tag === 3) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Num", "/"]});
      break _t9477;
    }
    if (_t9475._tag === 5) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Eq", "="]});
      break _t9477;
    }
    if (_t9475._tag === 6) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Eq", "<>"]});
      break _t9477;
    }
    if (_t9475._tag === 7) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Ord", "<"]});
      break _t9477;
    }
    if (_t9475._tag === 8) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Ord", ">"]});
      break _t9477;
    }
    if (_t9475._tag === 9) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Ord", "<="]});
      break _t9477;
    }
    if (_t9475._tag === 10) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Ord", ">="]});
      break _t9477;
    }
    if (_t9475._tag === 14) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "land"]});
      break _t9477;
    }
    if (_t9475._tag === 15) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lor"]});
      break _t9477;
    }
    if (_t9475._tag === 16) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lxor"]});
      break _t9477;
    }
    if (_t9475._tag === 17) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lsl"]});
      break _t9477;
    }
    if (_t9475._tag === 18) {
      _t9476 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lsr"]});
      break _t9477;
    }
    if (true) {
      _t9476 = ({_tag: 0, _name: "None"});
      break _t9477;
    }
    _match_fail("line 16629");
  }
  const class_info_9478 = _t9476;
  let _t9481;
  const _t9480 = class_info_9478;
  _t9482: {
    if (_t9480._tag === 1) {
      const class_name = _t9480._val[0];
      const method_name = _t9480._val[1];
      if (!_eq(xctx.xf_constrained, null)) {
        let _t9484;
        const _t9483 = Types$repr(e1.ty);
        _t9485: {
          if (_t9483._tag === 15 && _t9483._val.contents._tag === 0) {
            const id = _t9483._val.contents._val[0];
            let _t9487;
            const _t9486 = Typechecker$find_constrained_dict(xctx, id, class_name);
            _t9488: {
              if (_t9486._tag === 1) {
                const dparam = _t9486._val;
                const dict_ref_9489 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dparam}), ({_tag: 6, _name: "TUnit"}));
                const method_ref_9491 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [dict_ref_9489, method_name]}), ({_tag: 6, _name: "TUnit"}));
                const app1_9493 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [method_ref_9491, e1]}), ({_tag: 6, _name: "TUnit"}));
                const _t9494 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [app1_9493, e2]}), result_ty);
                const _t9492 = _t9494;
                const _t9490 = _t9492;
                _t9487 = _t9490;
                break _t9488;
              }
              if (_t9486._tag === 0) {
                _t9487 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, e1, e2]}), result_ty);
                break _t9488;
              }
              _match_fail("line 16629");
            }
            _t9484 = _t9487;
            break _t9485;
          }
          if (true) {
            _t9484 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, e1, e2]}), result_ty);
            break _t9485;
          }
          _match_fail("line 16629");
        }
        _t9481 = _t9484;
        break _t9482;
      }
    }
    if (true) {
      _t9481 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, e1, e2]}), result_ty);
      break _t9482;
    }
    _match_fail("line 16629");
  }
  const _t9479 = _t9481;
  return _t9479;
}
function Typechecker$xform_unop(xctx, op, e, result_ty) {
  let _t9496;
  const _t9495 = op;
  _t9497: {
    if (_t9495._tag === 0) {
      _t9496 = ({_tag: 1, _name: "Some", _val: ["Num", "negate"]});
      break _t9497;
    }
    if (true) {
      _t9496 = ({_tag: 0, _name: "None"});
      break _t9497;
    }
    _match_fail("line 16629");
  }
  const class_info_9498 = _t9496;
  let _t9501;
  const _t9500 = class_info_9498;
  _t9502: {
    if (_t9500._tag === 1) {
      const class_name = _t9500._val[0];
      const method_name = _t9500._val[1];
      if (!_eq(xctx.xf_constrained, null)) {
        let _t9504;
        const _t9503 = Types$repr(e.ty);
        _t9505: {
          if (_t9503._tag === 15 && _t9503._val.contents._tag === 0) {
            const id = _t9503._val.contents._val[0];
            let _t9507;
            const _t9506 = Typechecker$find_constrained_dict(xctx, id, class_name);
            _t9508: {
              if (_t9506._tag === 1) {
                const dparam = _t9506._val;
                const dict_ref_9509 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dparam}), ({_tag: 6, _name: "TUnit"}));
                const method_ref_9511 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [dict_ref_9509, method_name]}), ({_tag: 6, _name: "TUnit"}));
                const _t9512 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [method_ref_9511, e]}), result_ty);
                const _t9510 = _t9512;
                _t9507 = _t9510;
                break _t9508;
              }
              if (_t9506._tag === 0) {
                _t9507 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, e]}), result_ty);
                break _t9508;
              }
              _match_fail("line 16629");
            }
            _t9504 = _t9507;
            break _t9505;
          }
          if (true) {
            _t9504 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, e]}), result_ty);
            break _t9505;
          }
          _match_fail("line 16629");
        }
        _t9501 = _t9504;
        break _t9502;
      }
    }
    if (true) {
      _t9501 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, e]}), result_ty);
      break _t9502;
    }
    _match_fail("line 16629");
  }
  const _t9499 = _t9501;
  return _t9499;
}
function Typechecker$xform_constrained_def(xctx, scheme, te) {
  const tgen_map_9513 = Typechecker$build_tgen_map(scheme.body, te.ty);
  function _t9515(__p342, cc) {
    let _t9517;
    const _t9516 = __p342;
    _t9518: {
      if (true) {
        const entries = _t9516[0];
        const params = _t9516[1];
        function _t9519(ca) {
          let _t9521;
          const _t9520 = ca;
          _t9522: {
            if (_t9520._tag === 0) {
              const tgen_idx = _t9520._val;
              let _t9524;
              const _t9523 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_map_9513, tgen_idx]);
              _t9525: {
                if (_t9523._tag === 1 && _t9523._val._tag === 15 && _t9523._val._val.contents._tag === 0) {
                  const id = _t9523._val._val.contents._val[0];
                  _t9524 = ({_tag: 1, _name: "Some", _val: [id, tgen_idx]});
                  break _t9525;
                }
                if (true) {
                  _t9524 = ({_tag: 0, _name: "None"});
                  break _t9525;
                }
                _match_fail("line 16629");
              }
              _t9521 = _t9524;
              break _t9522;
            }
            if (_t9520._tag === 1) {
              const ty = _t9520._val;
              let _t9527;
              const _t9526 = Types$repr(ty);
              _t9528: {
                if (_t9526._tag === 15 && _t9526._val.contents._tag === 0) {
                  const id = _t9526._val.contents._val[0];
                  _t9527 = ({_tag: 1, _name: "Some", _val: [id, (1000 + id)]});
                  break _t9528;
                }
                if (true) {
                  _t9527 = ({_tag: 0, _name: "None"});
                  break _t9528;
                }
                _match_fail("line 16629");
              }
              _t9521 = _t9527;
              break _t9522;
            }
            if (_t9520._tag === 2) {
              _t9521 = ({_tag: 0, _name: "None"});
              break _t9522;
            }
            if (_t9520._tag === 3) {
              const tv = _t9520._val[1];
              let _t9530;
              const _t9529 = Types$repr(tv);
              _t9531: {
                if (_t9529._tag === 15 && _t9529._val.contents._tag === 0) {
                  const id = _t9529._val.contents._val[0];
                  _t9530 = ({_tag: 1, _name: "Some", _val: [id, (1000 + id)]});
                  break _t9531;
                }
                if (true) {
                  _t9530 = ({_tag: 0, _name: "None"});
                  break _t9531;
                }
                _match_fail("line 16629");
              }
              _t9521 = _t9530;
              break _t9522;
            }
            _match_fail("line 16629");
          }
          return _t9521;
        }
        const tvar_entries_9532 = List$filter_map(_t9519, cc.cc_args);
        let _t9535;
        const _t9534 = tvar_entries_9532;
        _t9536: {
          if (_t9534 === null) {
            const dparam_9537 = ((("__dict_" + __dict_Show_string.show(cc.cc_class)) + "_resolved_") + __dict_Show_int.show(List$length(params)));
            const _t9538 = [entries, ({_hd: dparam_9537, _tl: params})];
            _t9535 = _t9538;
            break _t9536;
          }
          if (true) {
            function _t9539(__p343) {
              let _t9541;
              const _t9540 = __p343;
              _t9542: {
                if (true) {
                  const idx = _t9540[1];
                  _t9541 = string_of_int(idx);
                  break _t9542;
                }
                _match_fail("line 16629");
              }
              return _t9541;
            }
            const dparam_9543 = ((("__dict_" + __dict_Show_string.show(cc.cc_class)) + "_") + __dict_Show_string.show(String$concat("_", List$map(_t9539, tvar_entries_9532))));
            function _t9545(__p344) {
              let _t9547;
              const _t9546 = __p344;
              _t9548: {
                if (true) {
                  const id = _t9546[0];
                  _t9547 = [id, dparam_9543, cc.cc_class];
                  break _t9548;
                }
                _match_fail("line 16629");
              }
              return _t9547;
            }
            const new_entries_9549 = List$map(_t9545, tvar_entries_9532);
            const _t9550 = [List$concat(new_entries_9549, entries), ({_hd: dparam_9543, _tl: params})];
            const _t9544 = _t9550;
            _t9535 = _t9544;
            break _t9536;
          }
          _match_fail("line 16629");
        }
        const _t9533 = _t9535;
        _t9517 = _t9533;
        break _t9518;
      }
      _match_fail("line 16629");
    }
    return _t9517;
  }
  let _t9552;
  const _t9551 = List$fold(_t9515, [null, null], scheme.constraints);
  _t9553: {
    if (true) {
      const all_constrained = _t9551[0];
      const dict_param_names = _t9551[1];
      const dict_param_names_9554 = List$rev(dict_param_names);
      const rgen_map_9556 = Typechecker$build_rgen_map(scheme.body, te.ty);
      function _t9558(__p345, re) {
        let _t9560;
        const _t9559 = __p345;
        _t9561: {
          if (true) {
            const entries = _t9559[0];
            const params = _t9559[1];
            function _t9562(__p346, field_name) {
              let _t9564;
              const _t9563 = __p346;
              _t9565: {
                if (true) {
                  const entries = _t9563[0];
                  const params = _t9563[1];
                  const pname_9566 = ((("__ev_" + __dict_Show_string.show(field_name)) + "_r") + __dict_Show_int.show(re.re_rgen));
                  let _t9569;
                  const _t9568 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rgen_map_9556, re.re_rgen]);
                  _t9570: {
                    if (_t9568._tag === 1) {
                      const arow = _t9568._val;
                      function get_tail(r) {
                        while (true) {
                          let _t9572;
                          const _t9571 = Types$rrow_repr(r);
                          _t9573: {
                            if (_t9571._tag === 0) {
                              const tail = _t9571._val[2];
                              const _t9574 = tail;
                              r = _t9574;
                              continue;
                              _t9572 = undefined;
                              break _t9573;
                            }
                            if (true) {
                              const tail = _t9571;
                              _t9572 = tail;
                              break _t9573;
                            }
                            _match_fail("line 16629");
                          }
                          return _t9572;
                        }
                      }
                      let _t9577;
                      const _t9576 = get_tail(arow);
                      _t9578: {
                        if (_t9576._tag === 1 && _t9576._val.contents._tag === 0) {
                          const id = _t9576._val.contents._val[0];
                          _t9577 = ({_hd: [id, field_name, pname_9566], _tl: null});
                          break _t9578;
                        }
                        if (true) {
                          _t9577 = null;
                          break _t9578;
                        }
                        _match_fail("line 16629");
                      }
                      const _t9575 = _t9577;
                      _t9569 = _t9575;
                      break _t9570;
                    }
                    if (_t9568._tag === 0) {
                      _t9569 = null;
                      break _t9570;
                    }
                    _match_fail("line 16629");
                  }
                  const rvar_entries_9579 = _t9569;
                  const _t9580 = [List$concat(rvar_entries_9579, entries), ({_hd: pname_9566, _tl: params})];
                  const _t9567 = _t9580;
                  _t9564 = _t9567;
                  break _t9565;
                }
                _match_fail("line 16629");
              }
              return _t9564;
            }
            _t9560 = List$fold(_t9562, [entries, params], re.re_fields);
            break _t9561;
          }
          _match_fail("line 16629");
        }
        return _t9560;
      }
      let _t9582;
      const _t9581 = List$fold(_t9558, [null, null], scheme.record_evidences);
      _t9583: {
        if (true) {
          const all_record_ev = _t9581[0];
          const ev_param_names = _t9581[1];
          const ev_param_names_9584 = List$rev(ev_param_names);
          const __rec_upd_9586 = xctx;
          const _t9587 = ({xf_constrained: List$concat(all_constrained, xctx.xf_constrained), xf_locals: __rec_upd_9586.xf_locals, xf_record_evidence: List$concat(all_record_ev, xctx.xf_record_evidence), xf_schemes: __rec_upd_9586.xf_schemes, xf_type_env: __rec_upd_9586.xf_type_env});
          const xctx_9588 = _t9587;
          const rewritten_9590 = Typechecker$xform_expr(xctx_9588, te);
          const all_params_9592 = List$concat(dict_param_names_9554, ev_param_names_9584);
          function _t9594(dparam, body) {
            return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [dparam, body, false]}), ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), body.ty]}));
          }
          const _t9593 = List$fold_right(_t9594, all_params_9592, rewritten_9590);
          const _t9591 = _t9593;
          const _t9589 = _t9591;
          const _t9585 = _t9589;
          _t9582 = _t9585;
          break _t9583;
        }
        _match_fail("line 16629");
      }
      const _t9557 = _t9582;
      const _t9555 = _t9557;
      _t9552 = _t9555;
      break _t9553;
    }
    _match_fail("line 16629");
  }
  const _t9514 = _t9552;
  return _t9514;
}
function Typechecker$xform_constrained_inst(xctx, inst_def, dict_expr) {
  let _t9596;
  const _t9595 = dict_expr.expr;
  _t9597: {
    if (_t9595._tag === 16) {
      const fs = _t9595._val;
      _t9596 = fs;
      break _t9597;
    }
    if (true) {
      _t9596 = failwith("assert false");
      break _t9597;
    }
    _match_fail("line 16629");
  }
  let _t9599;
  const _t9598 = Types$find_method_class(xctx.xf_type_env.classes, fst(List$hd(_t9596)));
  _t9600: {
    if (_t9598._tag === 1) {
      const cd = _t9598._val;
      if ((cd.class_name === inst_def.inst_class)) {
        _t9599 = cd;
        break _t9600;
      }
    }
    if (true) {
      function _t9601(c) {
        return (c.class_name === inst_def.inst_class);
      }
      let _t9603;
      const _t9602 = List$find(_t9601, xctx.xf_type_env.classes);
      _t9604: {
        if (_t9602._tag === 1) {
          const cd = _t9602._val;
          _t9603 = cd;
          break _t9604;
        }
        if (_t9602._tag === 0) {
          _t9603 = Typechecker$error((("class " + __dict_Show_string.show(inst_def.inst_class)) + " not found"));
          break _t9604;
        }
        _match_fail("line 16629");
      }
      _t9599 = _t9603;
      break _t9600;
    }
    _match_fail("line 16629");
  }
  const class_def_9605 = _t9599;
  const class_param_map_9607 = Hashtbl$create(4);
  const inst_tvar_map_9609 = Hashtbl$create(4);
  let _t9612;
  const _t9611 = dict_expr.expr;
  _t9613: {
    if (_t9611._tag === 16) {
      const fields = _t9611._val;
      function _t9614(__p347) {
        let _t9616;
        const _t9615 = __p347;
        _t9617: {
          if (true) {
            const mname = _t9615[0];
            const mte = _t9615[1];
            let _t9619;
            const _t9618 = List$assoc_opt(mname, class_def_9605.class_methods);
            _t9620: {
              if (_t9618._tag === 1) {
                const class_method_ty = _t9618._val;
                function walk_class(s, a) {
                  while (true) {
                    const a_9621 = Types$repr(a);
                    let _t9624;
                    const _t9623 = s;
                    _t9625: {
                      if (_t9623._tag === 16) {
                        const i = _t9623._val;
                        let _t9626;
                        if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, class_param_map_9607, i]))) {
                          _t9626 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, class_param_map_9607, i, a_9621]);
                        } else {
                          _t9626 = undefined;
                        }
                        _t9624 = _t9626;
                        break _t9625;
                      }
                      if (_t9623._tag === 7) {
                        const s1 = _t9623._val[0];
                        const s2 = _t9623._val[2];
                        let _t9628;
                        const _t9627 = a_9621;
                        _t9629: {
                          if (_t9627._tag === 7) {
                            const a1 = _t9627._val[0];
                            const a2 = _t9627._val[2];
                            walk_class(s1, a1);
                            const _t9630 = s2;
                            const _t9631 = a2;
                            s = _t9630;
                            a = _t9631;
                            continue;
                            _t9628 = undefined;
                            break _t9629;
                          }
                          if (true) {
                            _t9628 = undefined;
                            break _t9629;
                          }
                          _match_fail("line 16629");
                        }
                        _t9624 = _t9628;
                        break _t9625;
                      }
                      if (_t9623._tag === 8) {
                        const s1 = _t9623._val[0];
                        const s2 = _t9623._val[2];
                        let _t9633;
                        const _t9632 = a_9621;
                        _t9634: {
                          if (_t9632._tag === 8) {
                            const a1 = _t9632._val[0];
                            const a2 = _t9632._val[2];
                            walk_class(s1, a1);
                            const _t9635 = s2;
                            const _t9636 = a2;
                            s = _t9635;
                            a = _t9636;
                            continue;
                            _t9633 = undefined;
                            break _t9634;
                          }
                          if (true) {
                            _t9633 = undefined;
                            break _t9634;
                          }
                          _match_fail("line 16629");
                        }
                        _t9624 = _t9633;
                        break _t9625;
                      }
                      if (_t9623._tag === 9) {
                        const ss = _t9623._val;
                        let _t9638;
                        const _t9637 = a_9621;
                        _t9639: {
                          if (_t9637._tag === 9) {
                            const aa = _t9637._val;
                            if ((List$length(ss) === List$length(aa))) {
                              _t9638 = List$iter2(walk_class, ss, aa);
                              break _t9639;
                            }
                          }
                          if (true) {
                            _t9638 = undefined;
                            break _t9639;
                          }
                          _match_fail("line 16629");
                        }
                        _t9624 = _t9638;
                        break _t9625;
                      }
                      if (_t9623._tag === 10) {
                        const s1 = _t9623._val;
                        let _t9641;
                        const _t9640 = a_9621;
                        _t9642: {
                          if (_t9640._tag === 10) {
                            const a1 = _t9640._val;
                            const _t9643 = s1;
                            const _t9644 = a1;
                            s = _t9643;
                            a = _t9644;
                            continue;
                            _t9641 = undefined;
                            break _t9642;
                          }
                          if (true) {
                            _t9641 = undefined;
                            break _t9642;
                          }
                          _match_fail("line 16629");
                        }
                        _t9624 = _t9641;
                        break _t9625;
                      }
                      if (_t9623._tag === 13) {
                        const s1 = _t9623._val;
                        let _t9646;
                        const _t9645 = a_9621;
                        _t9647: {
                          if (_t9645._tag === 13) {
                            const a1 = _t9645._val;
                            const _t9648 = s1;
                            const _t9649 = a1;
                            s = _t9648;
                            a = _t9649;
                            continue;
                            _t9646 = undefined;
                            break _t9647;
                          }
                          if (true) {
                            _t9646 = undefined;
                            break _t9647;
                          }
                          _match_fail("line 16629");
                        }
                        _t9624 = _t9646;
                        break _t9625;
                      }
                      if (_t9623._tag === 12) {
                        const ss = _t9623._val[1];
                        let _t9651;
                        const _t9650 = a_9621;
                        _t9652: {
                          if (_t9650._tag === 12) {
                            const aa = _t9650._val[1];
                            if ((List$length(ss) === List$length(aa))) {
                              _t9651 = List$iter2(walk_class, ss, aa);
                              break _t9652;
                            }
                          }
                          if (true) {
                            _t9651 = undefined;
                            break _t9652;
                          }
                          _match_fail("line 16629");
                        }
                        _t9624 = _t9651;
                        break _t9625;
                      }
                      if (true) {
                        _t9624 = undefined;
                        break _t9625;
                      }
                      _match_fail("line 16629");
                    }
                    const _t9622 = _t9624;
                    return _t9622;
                  }
                }
                const _t9653 = walk_class(class_method_ty, mte.ty);
                _t9619 = _t9653;
                break _t9620;
              }
              if (_t9618._tag === 0) {
                _t9619 = undefined;
                break _t9620;
              }
              _match_fail("line 16629");
            }
            _t9616 = _t9619;
            break _t9617;
          }
          _match_fail("line 16629");
        }
        return _t9616;
      }
      List$iter(_t9614, fields);
      function _t9654(class_idx, stored_ty) {
        let _t9656;
        const _t9655 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, class_param_map_9607, class_idx]);
        _t9657: {
          if (_t9655._tag === 1) {
            const actual_ty = _t9655._val;
            function walk_inst(s, a) {
              while (true) {
                const a_9658 = Types$repr(a);
                let _t9661;
                const _t9660 = s;
                _t9662: {
                  if (_t9660._tag === 16) {
                    const i = _t9660._val;
                    let _t9663;
                    if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, inst_tvar_map_9609, i]))) {
                      let _t9665;
                      const _t9664 = a_9658;
                      _t9666: {
                        if (_t9664._tag === 15 && _t9664._val.contents._tag === 0) {
                          const id = _t9664._val.contents._val[0];
                          _t9665 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, inst_tvar_map_9609, i, id]);
                          break _t9666;
                        }
                        if (true) {
                          _t9665 = undefined;
                          break _t9666;
                        }
                        _match_fail("line 16629");
                      }
                      _t9663 = _t9665;
                    } else {
                      _t9663 = undefined;
                    }
                    _t9661 = _t9663;
                    break _t9662;
                  }
                  if (_t9660._tag === 7) {
                    const s1 = _t9660._val[0];
                    const s2 = _t9660._val[2];
                    let _t9668;
                    const _t9667 = a_9658;
                    _t9669: {
                      if (_t9667._tag === 7) {
                        const a1 = _t9667._val[0];
                        const a2 = _t9667._val[2];
                        walk_inst(s1, a1);
                        const _t9670 = s2;
                        const _t9671 = a2;
                        s = _t9670;
                        a = _t9671;
                        continue;
                        _t9668 = undefined;
                        break _t9669;
                      }
                      if (true) {
                        _t9668 = undefined;
                        break _t9669;
                      }
                      _match_fail("line 16629");
                    }
                    _t9661 = _t9668;
                    break _t9662;
                  }
                  if (_t9660._tag === 8) {
                    const s1 = _t9660._val[0];
                    const s2 = _t9660._val[2];
                    let _t9673;
                    const _t9672 = a_9658;
                    _t9674: {
                      if (_t9672._tag === 8) {
                        const a1 = _t9672._val[0];
                        const a2 = _t9672._val[2];
                        walk_inst(s1, a1);
                        const _t9675 = s2;
                        const _t9676 = a2;
                        s = _t9675;
                        a = _t9676;
                        continue;
                        _t9673 = undefined;
                        break _t9674;
                      }
                      if (true) {
                        _t9673 = undefined;
                        break _t9674;
                      }
                      _match_fail("line 16629");
                    }
                    _t9661 = _t9673;
                    break _t9662;
                  }
                  if (_t9660._tag === 9) {
                    const ss = _t9660._val;
                    let _t9678;
                    const _t9677 = a_9658;
                    _t9679: {
                      if (_t9677._tag === 9) {
                        const aa = _t9677._val;
                        if ((List$length(ss) === List$length(aa))) {
                          _t9678 = List$iter2(walk_inst, ss, aa);
                          break _t9679;
                        }
                      }
                      if (true) {
                        _t9678 = undefined;
                        break _t9679;
                      }
                      _match_fail("line 16629");
                    }
                    _t9661 = _t9678;
                    break _t9662;
                  }
                  if (_t9660._tag === 10) {
                    const s1 = _t9660._val;
                    let _t9681;
                    const _t9680 = a_9658;
                    _t9682: {
                      if (_t9680._tag === 10) {
                        const a1 = _t9680._val;
                        const _t9683 = s1;
                        const _t9684 = a1;
                        s = _t9683;
                        a = _t9684;
                        continue;
                        _t9681 = undefined;
                        break _t9682;
                      }
                      if (true) {
                        _t9681 = undefined;
                        break _t9682;
                      }
                      _match_fail("line 16629");
                    }
                    _t9661 = _t9681;
                    break _t9662;
                  }
                  if (_t9660._tag === 13) {
                    const s1 = _t9660._val;
                    let _t9686;
                    const _t9685 = a_9658;
                    _t9687: {
                      if (_t9685._tag === 13) {
                        const a1 = _t9685._val;
                        const _t9688 = s1;
                        const _t9689 = a1;
                        s = _t9688;
                        a = _t9689;
                        continue;
                        _t9686 = undefined;
                        break _t9687;
                      }
                      if (true) {
                        _t9686 = undefined;
                        break _t9687;
                      }
                      _match_fail("line 16629");
                    }
                    _t9661 = _t9686;
                    break _t9662;
                  }
                  if (_t9660._tag === 12) {
                    const ss = _t9660._val[1];
                    let _t9691;
                    const _t9690 = a_9658;
                    _t9692: {
                      if (_t9690._tag === 12) {
                        const aa = _t9690._val[1];
                        if ((List$length(ss) === List$length(aa))) {
                          _t9691 = List$iter2(walk_inst, ss, aa);
                          break _t9692;
                        }
                      }
                      if (true) {
                        _t9691 = undefined;
                        break _t9692;
                      }
                      _match_fail("line 16629");
                    }
                    _t9661 = _t9691;
                    break _t9662;
                  }
                  if (true) {
                    _t9661 = undefined;
                    break _t9662;
                  }
                  _match_fail("line 16629");
                }
                const _t9659 = _t9661;
                return _t9659;
              }
            }
            const _t9693 = walk_inst(stored_ty, actual_ty);
            _t9656 = _t9693;
            break _t9657;
          }
          if (_t9655._tag === 0) {
            _t9656 = undefined;
            break _t9657;
          }
          _match_fail("line 16629");
        }
        return _t9656;
      }
      _t9612 = List$iteri(_t9654, inst_def.inst_tys);
      break _t9613;
    }
    if (true) {
      _t9612 = undefined;
      break _t9613;
    }
    _match_fail("line 16629");
  }
  _t9612;
  function _t9694(__p348, cc) {
    let _t9696;
    const _t9695 = __p348;
    _t9697: {
      if (true) {
        const entries = _t9695[0];
        const params = _t9695[1];
        function _t9698(ca) {
          let _t9700;
          const _t9699 = ca;
          _t9701: {
            if (_t9699._tag === 0) {
              const tgen_idx = _t9699._val;
              let _t9703;
              const _t9702 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, inst_tvar_map_9609, tgen_idx]);
              _t9704: {
                if (_t9702._tag === 1) {
                  const tvar_id = _t9702._val;
                  _t9703 = ({_tag: 1, _name: "Some", _val: [tvar_id, tgen_idx]});
                  break _t9704;
                }
                if (_t9702._tag === 0) {
                  _t9703 = ({_tag: 0, _name: "None"});
                  break _t9704;
                }
                _match_fail("line 16629");
              }
              _t9700 = _t9703;
              break _t9701;
            }
            if (_t9699._tag === 1) {
              _t9700 = ({_tag: 0, _name: "None"});
              break _t9701;
            }
            if (_t9699._tag === 2) {
              _t9700 = ({_tag: 0, _name: "None"});
              break _t9701;
            }
            if (_t9699._tag === 3) {
              _t9700 = ({_tag: 0, _name: "None"});
              break _t9701;
            }
            _match_fail("line 16629");
          }
          return _t9700;
        }
        const tvar_entries_9705 = List$filter_map(_t9698, cc.cc_args);
        let _t9708;
        const _t9707 = tvar_entries_9705;
        _t9709: {
          if (_t9707 === null) {
            _t9708 = [entries, params];
            break _t9709;
          }
          if (true) {
            function _t9710(__p349) {
              let _t9712;
              const _t9711 = __p349;
              _t9713: {
                if (true) {
                  const idx = _t9711[1];
                  _t9712 = string_of_int(idx);
                  break _t9713;
                }
                _match_fail("line 16629");
              }
              return _t9712;
            }
            const dparam_9714 = ((("__dict_" + __dict_Show_string.show(cc.cc_class)) + "_") + __dict_Show_string.show(String$concat("_", List$map(_t9710, tvar_entries_9705))));
            function _t9716(__p350) {
              let _t9718;
              const _t9717 = __p350;
              _t9719: {
                if (true) {
                  const id = _t9717[0];
                  _t9718 = [id, dparam_9714, cc.cc_class];
                  break _t9719;
                }
                _match_fail("line 16629");
              }
              return _t9718;
            }
            const new_entries_9720 = List$map(_t9716, tvar_entries_9705);
            const _t9721 = [List$concat(new_entries_9720, entries), ({_hd: dparam_9714, _tl: params})];
            const _t9715 = _t9721;
            _t9708 = _t9715;
            break _t9709;
          }
          _match_fail("line 16629");
        }
        const _t9706 = _t9708;
        _t9696 = _t9706;
        break _t9697;
      }
      _match_fail("line 16629");
    }
    return _t9696;
  }
  let _t9723;
  const _t9722 = List$fold(_t9694, [null, null], inst_def.inst_constraints);
  _t9724: {
    if (true) {
      const all_constrained = _t9722[0];
      const dict_param_names = _t9722[1];
      const dict_param_names_9725 = List$rev(dict_param_names);
      const __rec_upd_9727 = xctx;
      const _t9728 = ({xf_constrained: List$concat(all_constrained, xctx.xf_constrained), xf_locals: __rec_upd_9727.xf_locals, xf_record_evidence: __rec_upd_9727.xf_record_evidence, xf_schemes: __rec_upd_9727.xf_schemes, xf_type_env: __rec_upd_9727.xf_type_env});
      const xctx_9729 = _t9728;
      const rewritten_9731 = Typechecker$xform_expr(xctx_9729, dict_expr);
      function _t9733(dparam, body) {
        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [dparam, body, false]}), ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), body.ty]}));
      }
      const _t9732 = List$fold_right(_t9733, dict_param_names_9725, rewritten_9731);
      const _t9730 = _t9732;
      const _t9726 = _t9730;
      _t9723 = _t9726;
      break _t9724;
    }
    _match_fail("line 16629");
  }
  const _t9610 = _t9723;
  const _t9608 = _t9610;
  const _t9606 = _t9608;
  return _t9606;
}
function Typechecker$apply_fundep_improvement(type_env, vars, tprog) {
  function _t9734(tdecl) {
    let _t9736;
    const _t9735 = tdecl;
    _t9737: {
      if ((((_t9735._tag === 0 || _t9735._tag === 2) || _t9735._tag === 5) || _t9735._tag === 1)) {
        const te = (((_t9735._tag === 0 || _t9735._tag === 2) || _t9735._tag === 5) ? ((_t9735._tag === 0 || _t9735._tag === 2) ? _t9735._val[1] : _t9735._val) : _t9735._val[1]);
        _t9736 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
        break _t9737;
      }
      if (_t9735._tag === 3) {
        const bindings = _t9735._val;
        function _t9738(__p351) {
          let _t9740;
          const _t9739 = __p351;
          _t9741: {
            if (true) {
              const te = _t9739[1];
              _t9740 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
              break _t9741;
            }
            _match_fail("line 16629");
          }
          return _t9740;
        }
        _t9736 = List$iter(_t9738, bindings);
        break _t9737;
      }
      if (_t9735._tag === 9) {
        const decls = _t9735._val[1];
        function _t9742(d) {
          let _t9744;
          const _t9743 = d;
          _t9745: {
            if ((((_t9743._tag === 0 || _t9743._tag === 2) || _t9743._tag === 5) || _t9743._tag === 1)) {
              const te = (((_t9743._tag === 0 || _t9743._tag === 2) || _t9743._tag === 5) ? ((_t9743._tag === 0 || _t9743._tag === 2) ? _t9743._val[1] : _t9743._val) : _t9743._val[1]);
              _t9744 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
              break _t9745;
            }
            if (_t9743._tag === 3) {
              const bindings = _t9743._val;
              function _t9746(__p352) {
                let _t9748;
                const _t9747 = __p352;
                _t9749: {
                  if (true) {
                    const te = _t9747[1];
                    _t9748 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
                    break _t9749;
                  }
                  _match_fail("line 16629");
                }
                return _t9748;
              }
              _t9744 = List$iter(_t9746, bindings);
              break _t9745;
            }
            if (true) {
              _t9744 = undefined;
              break _t9745;
            }
            _match_fail("line 16629");
          }
          return _t9744;
        }
        _t9736 = List$iter(_t9742, decls);
        break _t9737;
      }
      if (true) {
        _t9736 = undefined;
        break _t9737;
      }
      _match_fail("line 16629");
    }
    return _t9736;
  }
  return List$iter(_t9734, tprog);
}
function Typechecker$transform_constraints(ctx, tprog) {
  Typechecker$apply_fundep_improvement(ctx.type_env, ctx.vars, tprog);
  const xctx_9750 = ({xf_constrained: null, xf_locals: null, xf_record_evidence: null, xf_schemes: ctx.vars, xf_type_env: ctx.type_env});
  function _t9752(xctx, tdecl) {
    let _t9754;
    const _t9753 = tdecl;
    _t9755: {
      if (_t9753._tag === 0) {
        const name = _t9753._val[0];
        const te = _t9753._val[1];
        let _t9757;
        const _t9756 = List$assoc_opt(name, xctx.xf_schemes);
        _t9758: {
          if (_t9756._tag === 1) {
            const scheme = _t9756._val;
            if (Typechecker$scheme_needs_xform(scheme)) {
              _t9757 = ({_tag: 0, _name: "TDLet", _val: [name, Typechecker$xform_constrained_def(xctx, scheme, te)]});
              break _t9758;
            }
          }
          if (true) {
            function _t9759(i) {
              return ((i.inst_dict_name === name) && !_eq(i.inst_constraints, null));
            }
            const inst_9760 = List$find(_t9759, xctx.xf_type_env.instances);
            let _t9763;
            const _t9762 = inst_9760;
            _t9764: {
              if (_t9762._tag === 1) {
                const inst_def = _t9762._val;
                _t9763 = ({_tag: 0, _name: "TDLet", _val: [name, Typechecker$xform_constrained_inst(xctx, inst_def, te)]});
                break _t9764;
              }
              if (_t9762._tag === 0) {
                _t9763 = ({_tag: 0, _name: "TDLet", _val: [name, Typechecker$xform_expr(xctx, te)]});
                break _t9764;
              }
              _match_fail("line 16629");
            }
            const _t9761 = _t9763;
            _t9757 = _t9761;
            break _t9758;
          }
          _match_fail("line 16629");
        }
        _t9754 = _t9757;
        break _t9755;
      }
      if (_t9753._tag === 2) {
        const name = _t9753._val[0];
        const te = _t9753._val[1];
        let _t9766;
        const _t9765 = List$assoc_opt(name, xctx.xf_schemes);
        _t9767: {
          if (_t9765._tag === 1) {
            const scheme = _t9765._val;
            if (Typechecker$scheme_needs_xform(scheme)) {
              _t9766 = ({_tag: 2, _name: "TDLetRec", _val: [name, Typechecker$xform_constrained_def(xctx, scheme, te)]});
              break _t9767;
            }
          }
          if (true) {
            _t9766 = ({_tag: 2, _name: "TDLetRec", _val: [name, Typechecker$xform_expr(xctx, te)]});
            break _t9767;
          }
          _match_fail("line 16629");
        }
        _t9754 = _t9766;
        break _t9755;
      }
      if (_t9753._tag === 3) {
        const bindings = _t9753._val;
        function _t9768(__p353) {
          let _t9770;
          const _t9769 = __p353;
          _t9771: {
            if (true) {
              const n = _t9769[0];
              const te = _t9769[1];
              let _t9773;
              const _t9772 = List$assoc_opt(n, xctx.xf_schemes);
              _t9774: {
                if (_t9772._tag === 1) {
                  const scheme = _t9772._val;
                  if (Typechecker$scheme_needs_xform(scheme)) {
                    _t9773 = [n, Typechecker$xform_constrained_def(xctx, scheme, te)];
                    break _t9774;
                  }
                }
                if (true) {
                  _t9773 = [n, Typechecker$xform_expr(xctx, te)];
                  break _t9774;
                }
                _match_fail("line 16629");
              }
              _t9770 = _t9773;
              break _t9771;
            }
            _match_fail("line 16629");
          }
          return _t9770;
        }
        _t9754 = ({_tag: 3, _name: "TDLetRecAnd", _val: List$map(_t9768, bindings)});
        break _t9755;
      }
      if (_t9753._tag === 5) {
        const te = _t9753._val;
        _t9754 = ({_tag: 5, _name: "TDExpr", _val: Typechecker$xform_expr(xctx, te)});
        break _t9755;
      }
      if (_t9753._tag === 1) {
        const name = _t9753._val[0];
        const te = _t9753._val[1];
        _t9754 = ({_tag: 1, _name: "TDLetMut", _val: [name, Typechecker$xform_expr(xctx, te)]});
        break _t9755;
      }
      if (true) {
        const other = _t9753;
        _t9754 = other;
        break _t9755;
      }
      _match_fail("line 16629");
    }
    return _t9754;
  }
  const xform_decl_9775 = _t9752;
  function _t9777(tdecl) {
    let _t9779;
    const _t9778 = tdecl;
    _t9780: {
      if (((_t9778._tag === 0 || _t9778._tag === 2) || _t9778._tag === 1)) {
        const name = _t9778._val[0];
        _t9779 = ({_hd: name, _tl: null});
        break _t9780;
      }
      if (_t9778._tag === 3) {
        const bindings = _t9778._val;
        _t9779 = List$map(fst, bindings);
        break _t9780;
      }
      if (true) {
        _t9779 = null;
        break _t9780;
      }
      _match_fail("line 16629");
    }
    return _t9779;
  }
  const decl_names_9781 = _t9777;
  function _t9783(xctx, tdecl) {
    let _t9785;
    const _t9784 = tdecl;
    _t9786: {
      if (_t9784._tag === 10) {
        const alias_pairs = _t9784._val;
        function _t9787(schemes, __p354) {
          let _t9789;
          const _t9788 = __p354;
          _t9790: {
            if (true) {
              const dst = _t9788[0];
              const src = _t9788[1];
              let _t9792;
              const _t9791 = List$assoc_opt(src, schemes);
              _t9793: {
                if (_t9791._tag === 1) {
                  const scheme = _t9791._val;
                  _t9792 = ({_hd: [dst, scheme], _tl: schemes});
                  break _t9793;
                }
                if (_t9791._tag === 0) {
                  _t9792 = schemes;
                  break _t9793;
                }
                _match_fail("line 16629");
              }
              _t9789 = _t9792;
              break _t9790;
            }
            _match_fail("line 16629");
          }
          return _t9789;
        }
        _t9785 = List$fold(_t9787, xctx.xf_schemes, alias_pairs);
        break _t9786;
      }
      if (true) {
        _t9785 = xctx.xf_schemes;
        break _t9786;
      }
      _match_fail("line 16629");
    }
    return _t9785;
  }
  const open_schemes_9794 = _t9783;
  function xform_decls(xctx, __x) {
    let _t9797;
    const _t9796 = __x;
    _t9798: {
      if (_t9796 === null) {
        _t9797 = null;
        break _t9798;
      }
      if (_t9796 !== null) {
        const tdecl = _t9796._hd;
        const rest = _t9796._tl;
        let _t9800;
        const _t9799 = tdecl;
        _t9801: {
          if (_t9799._tag === 9) {
            const name = _t9799._val[0];
            const decls = _t9799._val[1];
            _t9800 = ({_tag: 9, _name: "TDModule", _val: [name, xform_decls(xctx, decls)]});
            break _t9801;
          }
          if (true) {
            _t9800 = xform_decl_9775(xctx, tdecl);
            break _t9801;
          }
          _match_fail("line 16629");
        }
        const tdecl$p_9802 = _t9800;
        const names_9804 = decl_names_9781(tdecl);
        const __rec_upd_9806 = xctx;
        const _t9807 = ({xf_constrained: __rec_upd_9806.xf_constrained, xf_locals: List$concat(names_9804, xctx.xf_locals), xf_record_evidence: __rec_upd_9806.xf_record_evidence, xf_schemes: open_schemes_9794(xctx, tdecl$p_9802), xf_type_env: __rec_upd_9806.xf_type_env});
        const xctx$p_9808 = _t9807;
        const _t9809 = ({_hd: tdecl$p_9802, _tl: xform_decls(xctx$p_9808, rest)});
        const _t9805 = _t9809;
        const _t9803 = _t9805;
        _t9797 = _t9803;
        break _t9798;
      }
      _match_fail("line 16629");
    }
    return _t9797;
  }
  const _t9810 = xform_decls(xctx_9750, tprog);
  const _t9795 = _t9810;
  const _t9782 = _t9795;
  const _t9776 = _t9782;
  const _t9751 = _t9776;
  return _t9751;
}
function Typechecker$check_program(program) {
  function _t9811(__p355, decl) {
    let _t9813;
    const _t9812 = __p355;
    _t9814: {
      if (true) {
        const ctx = _t9812[0];
        const decls = _t9812[1];
        let _t9816;
        const _t9815 = Typechecker$check_decl(ctx, 0, decl);
        _t9817: {
          if (true) {
            const ctx$p = _t9815[0];
            const tdecls = _t9815[1];
            _t9816 = [ctx$p, List$rev_append(tdecls, decls)];
            break _t9817;
          }
          _match_fail("line 16629");
        }
        _t9813 = _t9816;
        break _t9814;
      }
      _match_fail("line 16629");
    }
    return _t9813;
  }
  let _t9819;
  const _t9818 = List$fold(_t9811, [Typechecker$empty_ctx, null], program);
  _t9820: {
    if (true) {
      const ctx = _t9818[0];
      const decls = _t9818[1];
      _t9819 = [List$rev(decls), ctx.type_env];
      break _t9820;
    }
    _match_fail("line 16629");
  }
  return _t9819;
}
function Typechecker$check_program_in_ctx(ctx, program) {
  function _t9821(__p356, decl) {
    let _t9823;
    const _t9822 = __p356;
    _t9824: {
      if (true) {
        const ctx = _t9822[0];
        const decls = _t9822[1];
        let _t9826;
        const _t9825 = Typechecker$check_decl(ctx, 0, decl);
        _t9827: {
          if (true) {
            const ctx$p = _t9825[0];
            const tdecls = _t9825[1];
            _t9826 = [ctx$p, List$rev_append(tdecls, decls)];
            break _t9827;
          }
          _match_fail("line 16629");
        }
        _t9823 = _t9826;
        break _t9824;
      }
      _match_fail("line 16629");
    }
    return _t9823;
  }
  let _t9829;
  const _t9828 = List$fold(_t9821, [ctx, null], program);
  _t9830: {
    if (true) {
      const ctx = _t9828[0];
      const decls = _t9828[1];
      _t9829 = [ctx, List$rev(decls)];
      break _t9830;
    }
    _match_fail("line 16629");
  }
  return _t9829;
}
function Typechecker$handler_body_has_resume(te) {
  while (true) {
    let _t9832;
    const _t9831 = te.expr;
    _t9833: {
      if (_t9831._tag === 31) {
        _t9832 = true;
        break _t9833;
      }
      if (((_t9831._tag === 8 || _t9831._tag === 28) || _t9831._tag === 25)) {
        const e1 = ((_t9831._tag === 8 || _t9831._tag === 28) ? (_t9831._tag === 8 ? _t9831._val[2] : _t9831._val[0]) : _t9831._val[1]);
        const e2 = ((_t9831._tag === 8 || _t9831._tag === 28) ? (_t9831._tag === 8 ? _t9831._val[3] : _t9831._val[1]) : _t9831._val[2]);
        _t9832 = (Typechecker$handler_body_has_resume(e1) || Typechecker$handler_body_has_resume(e2));
        break _t9833;
      }
      if (_t9831._tag === 12) {
        const e1 = _t9831._val[1];
        const e2 = _t9831._val[2];
        _t9832 = (Typechecker$handler_body_has_resume(e1) || Typechecker$handler_body_has_resume(e2));
        break _t9833;
      }
      if (_t9831._tag === 24) {
        const arms = _t9831._val[1];
        function _t9834(__p357) {
          let _t9836;
          const _t9835 = __p357;
          _t9837: {
            if (true) {
              const body = _t9835[2];
              _t9836 = Typechecker$handler_body_has_resume(body);
              break _t9837;
            }
            _match_fail("line 16629");
          }
          return _t9836;
        }
        _t9832 = List$exists(_t9834, arms);
        break _t9833;
      }
      if (_t9831._tag === 9) {
        const e2 = _t9831._val[3];
        const _t9838 = e2;
        te = _t9838;
        continue;
        _t9832 = undefined;
        break _t9833;
      }
      if (_t9831._tag === 37) {
        const e2 = _t9831._val[1];
        const _t9839 = e2;
        te = _t9839;
        continue;
        _t9832 = undefined;
        break _t9833;
      }
      if (true) {
        _t9832 = false;
        break _t9833;
      }
      _match_fail("line 16629");
    }
    return _t9832;
  }
}
function Typechecker$handler_body_has_perform(te) {
  while (true) {
    let _t9841;
    const _t9840 = te.expr;
    _t9842: {
      if (_t9840._tag === 29) {
        _t9841 = true;
        break _t9842;
      }
      if (_t9840._tag === 31) {
        _t9841 = true;
        break _t9842;
      }
      if (((_t9840._tag === 8 || _t9840._tag === 28) || _t9840._tag === 25)) {
        const e1 = ((_t9840._tag === 8 || _t9840._tag === 28) ? (_t9840._tag === 8 ? _t9840._val[2] : _t9840._val[0]) : _t9840._val[1]);
        const e2 = ((_t9840._tag === 8 || _t9840._tag === 28) ? (_t9840._tag === 8 ? _t9840._val[3] : _t9840._val[1]) : _t9840._val[2]);
        _t9841 = (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2));
        break _t9842;
      }
      if (_t9840._tag === 12) {
        const cond = _t9840._val[0];
        const e1 = _t9840._val[1];
        const e2 = _t9840._val[2];
        _t9841 = (Typechecker$handler_body_has_perform(cond) || (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2)));
        break _t9842;
      }
      if (_t9840._tag === 24) {
        const scrut = _t9840._val[0];
        const arms = _t9840._val[1];
        let _t9851;
        if (Typechecker$handler_body_has_perform(scrut)) {
          _t9851 = true;
        } else {
        function _t9843(__p358) {
          let _t9845;
          const _t9844 = __p358;
          _t9846: {
            if (true) {
              const g = _t9844[1];
              const body = _t9844[2];
              let _t9850;
              if (Typechecker$handler_body_has_perform(body)) {
                _t9850 = true;
              } else {
              let _t9848;
              const _t9847 = g;
              _t9849: {
                if (_t9847._tag === 1) {
                  const g = _t9847._val;
                  _t9848 = Typechecker$handler_body_has_perform(g);
                  break _t9849;
                }
                if (_t9847._tag === 0) {
                  _t9848 = false;
                  break _t9849;
                }
                _match_fail("line 16629");
              }
                _t9850 = _t9848;
              }
              _t9845 = _t9850;
              break _t9846;
            }
            _match_fail("line 16629");
          }
          return _t9845;
        }
          _t9851 = List$exists(_t9843, arms);
        }
        _t9841 = _t9851;
        break _t9842;
      }
      if (_t9840._tag === 9) {
        const e2 = _t9840._val[3];
        const _t9852 = e2;
        te = _t9852;
        continue;
        _t9841 = undefined;
        break _t9842;
      }
      if (_t9840._tag === 37) {
        const e2 = _t9840._val[1];
        const _t9853 = e2;
        te = _t9853;
        continue;
        _t9841 = undefined;
        break _t9842;
      }
      if (_t9840._tag === 11) {
        const fn_ = _t9840._val[0];
        const arg = _t9840._val[1];
        _t9841 = (Typechecker$handler_body_has_perform(fn_) || Typechecker$handler_body_has_perform(arg));
        break _t9842;
      }
      if (_t9840._tag === 13) {
        const e1 = _t9840._val[1];
        const e2 = _t9840._val[2];
        _t9841 = (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2));
        break _t9842;
      }
      if (_t9840._tag === 14) {
        const e = _t9840._val[1];
        const _t9854 = e;
        te = _t9854;
        continue;
        _t9841 = undefined;
        break _t9842;
      }
      if (_t9840._tag === 21) {
        const e1 = _t9840._val[0];
        const e2 = _t9840._val[1];
        _t9841 = (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2));
        break _t9842;
      }
      if (_t9840._tag === 15) {
        const es = _t9840._val;
        _t9841 = List$exists(Typechecker$handler_body_has_perform, es);
        break _t9842;
      }
      if (_t9840._tag === 16) {
        const fields = _t9840._val;
        function _t9855(__p359) {
          let _t9857;
          const _t9856 = __p359;
          _t9858: {
            if (true) {
              const e = _t9856[1];
              _t9857 = Typechecker$handler_body_has_perform(e);
              break _t9858;
            }
            _match_fail("line 16629");
          }
          return _t9857;
        }
        _t9841 = List$exists(_t9855, fields);
        break _t9842;
      }
      if (true) {
        _t9841 = false;
        break _t9842;
      }
      _match_fail("line 16629");
    }
    return _t9841;
  }
}
function Typechecker$classify_all_branches_resume(te) {
  while (true) {
    let _t9860;
    const _t9859 = te.expr;
    _t9861: {
      if (_t9859._tag === 31) {
        _t9860 = true;
        break _t9861;
      }
      if (((((_t9859._tag === 8 || _t9859._tag === 9) || _t9859._tag === 37) || _t9859._tag === 25) || _t9859._tag === 28)) {
        const e2 = ((((_t9859._tag === 8 || _t9859._tag === 9) || _t9859._tag === 37) || _t9859._tag === 25) ? (((_t9859._tag === 8 || _t9859._tag === 9) || _t9859._tag === 37) ? ((_t9859._tag === 8 || _t9859._tag === 9) ? _t9859._val[3] : _t9859._val[1]) : _t9859._val[2]) : _t9859._val[1]);
        const _t9862 = e2;
        te = _t9862;
        continue;
        _t9860 = undefined;
        break _t9861;
      }
      if (_t9859._tag === 12) {
        const then_e = _t9859._val[1];
        const else_e = _t9859._val[2];
        _t9860 = (Typechecker$classify_all_branches_resume(then_e) && Typechecker$classify_all_branches_resume(else_e));
        break _t9861;
      }
      if (_t9859._tag === 24) {
        const arms = _t9859._val[1];
        function _t9863(__p360) {
          let _t9865;
          const _t9864 = __p360;
          _t9866: {
            if (true) {
              const body = _t9864[2];
              _t9865 = Typechecker$classify_all_branches_resume(body);
              break _t9866;
            }
            _match_fail("line 16629");
          }
          return _t9865;
        }
        _t9860 = List$forall(_t9863, arms);
        break _t9861;
      }
      if (true) {
        _t9860 = false;
        break _t9861;
      }
      _match_fail("line 16629");
    }
    return _t9860;
  }
}
function Typechecker$classify_all_resumes_tail(te) {
  while (true) {
    let _t9868;
    const _t9867 = te.expr;
    _t9869: {
      if (_t9867._tag === 31) {
        _t9868 = true;
        break _t9869;
      }
      if (_t9867._tag === 28) {
        const e2 = _t9867._val[1];
        const _t9870 = e2;
        te = _t9870;
        continue;
        _t9868 = undefined;
        break _t9869;
      }
      if (_t9867._tag === 8) {
        const e1 = _t9867._val[2];
        const e2 = _t9867._val[3];
        _t9868 = ((!Typechecker$handler_body_has_perform(e1)) && Typechecker$classify_all_resumes_tail(e2));
        break _t9869;
      }
      if (_t9867._tag === 9) {
        const e2 = _t9867._val[3];
        const _t9871 = e2;
        te = _t9871;
        continue;
        _t9868 = undefined;
        break _t9869;
      }
      if (_t9867._tag === 25) {
        const e1 = _t9867._val[1];
        const e2 = _t9867._val[2];
        _t9868 = ((!Typechecker$handler_body_has_perform(e1)) && Typechecker$classify_all_resumes_tail(e2));
        break _t9869;
      }
      if (_t9867._tag === 12) {
        const then_e = _t9867._val[1];
        const else_e = _t9867._val[2];
        _t9868 = (Typechecker$classify_all_resumes_tail(then_e) && Typechecker$classify_all_resumes_tail(else_e));
        break _t9869;
      }
      if (_t9867._tag === 24) {
        const arms = _t9867._val[1];
        function _t9872(__p361) {
          let _t9874;
          const _t9873 = __p361;
          _t9875: {
            if (true) {
              const body = _t9873[2];
              _t9874 = Typechecker$classify_all_resumes_tail(body);
              break _t9875;
            }
            _match_fail("line 16629");
          }
          return _t9874;
        }
        _t9868 = List$forall(_t9872, arms);
        break _t9869;
      }
      if (true) {
        _t9868 = true;
        break _t9869;
      }
      _match_fail("line 16629");
    }
    return _t9868;
  }
}
function Typechecker$strip_tail_resume(te) {
  let _t9877;
  const _t9876 = te.expr;
  _t9878: {
    if (_t9876._tag === 31) {
      const value = _t9876._val[1];
      _t9877 = value;
      break _t9878;
    }
    if (_t9876._tag === 8) {
      const r = _t9876._val[0];
      const n = _t9876._val[1];
      const e1 = _t9876._val[2];
      const e2 = _t9876._val[3];
      const __rec_upd_9879 = te;
      const _t9880 = ({expr: ({_tag: 8, _name: "TELet", _val: [r, n, e1, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9879.loc, ty: __rec_upd_9879.ty});
      _t9877 = _t9880;
      break _t9878;
    }
    if (_t9876._tag === 9) {
      const r = _t9876._val[0];
      const n = _t9876._val[1];
      const fn_e = _t9876._val[2];
      const e2 = _t9876._val[3];
      const __rec_upd_9881 = te;
      const _t9882 = ({expr: ({_tag: 9, _name: "TELetRec", _val: [r, n, fn_e, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9881.loc, ty: __rec_upd_9881.ty});
      _t9877 = _t9882;
      break _t9878;
    }
    if (_t9876._tag === 37) {
      const binds = _t9876._val[0];
      const e2 = _t9876._val[1];
      const __rec_upd_9883 = te;
      const _t9884 = ({expr: ({_tag: 37, _name: "TELetRecAnd", _val: [binds, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9883.loc, ty: __rec_upd_9883.ty});
      _t9877 = _t9884;
      break _t9878;
    }
    if (_t9876._tag === 25) {
      const n = _t9876._val[0];
      const e1 = _t9876._val[1];
      const e2 = _t9876._val[2];
      const __rec_upd_9885 = te;
      const _t9886 = ({expr: ({_tag: 25, _name: "TELetMut", _val: [n, e1, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9885.loc, ty: __rec_upd_9885.ty});
      _t9877 = _t9886;
      break _t9878;
    }
    if (_t9876._tag === 28) {
      const e1 = _t9876._val[0];
      const e2 = _t9876._val[1];
      const __rec_upd_9887 = te;
      const _t9888 = ({expr: ({_tag: 28, _name: "TESeq", _val: [e1, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_9887.loc, ty: __rec_upd_9887.ty});
      _t9877 = _t9888;
      break _t9878;
    }
    if (_t9876._tag === 12) {
      const c = _t9876._val[0];
      const t = _t9876._val[1];
      const f = _t9876._val[2];
      const __rec_upd_9889 = te;
      const _t9890 = ({expr: ({_tag: 12, _name: "TEIf", _val: [c, Typechecker$strip_tail_resume(t), Typechecker$strip_tail_resume(f)]}), loc: __rec_upd_9889.loc, ty: __rec_upd_9889.ty});
      _t9877 = _t9890;
      break _t9878;
    }
    if (_t9876._tag === 24) {
      const s = _t9876._val[0];
      const arms = _t9876._val[1];
      const p = _t9876._val[2];
      function _t9891(__p362) {
        let _t9893;
        const _t9892 = __p362;
        _t9894: {
          if (true) {
            const pat = _t9892[0];
            const g = _t9892[1];
            const body = _t9892[2];
            _t9893 = [pat, g, Typechecker$strip_tail_resume(body)];
            break _t9894;
          }
          _match_fail("line 16629");
        }
        return _t9893;
      }
      const arms$p_9895 = List$map(_t9891, arms);
      const __rec_upd_9897 = te;
      const _t9898 = ({expr: ({_tag: 24, _name: "TEMatch", _val: [s, arms$p_9895, p]}), loc: __rec_upd_9897.loc, ty: __rec_upd_9897.ty});
      const _t9896 = _t9898;
      _t9877 = _t9896;
      break _t9878;
    }
    if (true) {
      _t9877 = te;
      break _t9878;
    }
    _match_fail("line 16629");
  }
  return _t9877;
}
function Typechecker$classify_arm(arm) {
  let _t9900;
  const _t9899 = arm;
  _t9901: {
    if (_t9899._tag === 1) {
      const op = _t9899._val[0];
      const arg = _t9899._val[1];
      const _k = _t9899._val[2];
      const body = _t9899._val[3];
      let _t9902;
      if (((!Typechecker$handler_body_has_resume(body)) && (!Typechecker$handler_body_has_perform(body)))) {
        _t9902 = ({_tag: 3, _name: "THOpTry", _val: [op, arg, body]});
      } else {
        let _t9903;
        if ((Typechecker$handler_body_has_resume(body) && (Typechecker$classify_all_branches_resume(body) && Typechecker$classify_all_resumes_tail(body)))) {
          _t9903 = ({_tag: 2, _name: "THOpProvide", _val: [op, arg, Typechecker$strip_tail_resume(body)]});
        } else {
          _t9903 = arm;
        }
        _t9902 = _t9903;
      }
      _t9900 = _t9902;
      break _t9901;
    }
    if (true) {
      _t9900 = arm;
      break _t9901;
    }
    _match_fail("line 16629");
  }
  return _t9900;
}
function Typechecker$classify_texpr(te) {
  function _t9904(e) {
    const __rec_upd_9905 = te;
    const _t9906 = ({expr: e, loc: __rec_upd_9905.loc, ty: __rec_upd_9905.ty});
    return _t9906;
  }
  const mk_9907 = _t9904;
  let _t9910;
  const _t9909 = te.expr;
  _t9911: {
    if (_t9909._tag === 30) {
      const body = _t9909._val[0];
      const arms = _t9909._val[1];
      const body$p_9912 = Typechecker$classify_texpr(body);
      function _t9914(arm) {
        let _t9916;
        const _t9915 = arm;
        _t9917: {
          if (_t9915._tag === 0) {
            const n = _t9915._val[0];
            const e = _t9915._val[1];
            _t9916 = ({_tag: 0, _name: "THReturn", _val: [n, Typechecker$classify_texpr(e)]});
            break _t9917;
          }
          if (_t9915._tag === 1) {
            const op = _t9915._val[0];
            const arg = _t9915._val[1];
            const k = _t9915._val[2];
            const e = _t9915._val[3];
            _t9916 = Typechecker$classify_arm(({_tag: 1, _name: "THOp", _val: [op, arg, k, Typechecker$classify_texpr(e)]}));
            break _t9917;
          }
          if (_t9915._tag === 2) {
            const op = _t9915._val[0];
            const arg = _t9915._val[1];
            const e = _t9915._val[2];
            _t9916 = ({_tag: 2, _name: "THOpProvide", _val: [op, arg, Typechecker$classify_texpr(e)]});
            break _t9917;
          }
          if (_t9915._tag === 3) {
            const op = _t9915._val[0];
            const arg = _t9915._val[1];
            const e = _t9915._val[2];
            _t9916 = ({_tag: 3, _name: "THOpTry", _val: [op, arg, Typechecker$classify_texpr(e)]});
            break _t9917;
          }
          _match_fail("line 16629");
        }
        return _t9916;
      }
      const arms$p_9918 = List$map(_t9914, arms);
      const _t9919 = Typechecker$mk(({_tag: 30, _name: "TEHandle", _val: [body$p_9912, arms$p_9918]}));
      const _t9913 = _t9919;
      _t9910 = _t9913;
      break _t9911;
    }
    if (_t9909._tag === 8) {
      const r = _t9909._val[0];
      const n = _t9909._val[1];
      const e1 = _t9909._val[2];
      const e2 = _t9909._val[3];
      _t9910 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [r, n, Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9911;
    }
    if (_t9909._tag === 9) {
      const r = _t9909._val[0];
      const n = _t9909._val[1];
      const fn_e = _t9909._val[2];
      const body = _t9909._val[3];
      _t9910 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [r, n, Typechecker$classify_texpr(fn_e), Typechecker$classify_texpr(body)]}));
      break _t9911;
    }
    if (_t9909._tag === 37) {
      const binds = _t9909._val[0];
      const body = _t9909._val[1];
      function _t9920(__p363) {
        let _t9922;
        const _t9921 = __p363;
        _t9923: {
          if (true) {
            const n = _t9921[0];
            const e = _t9921[1];
            _t9922 = [n, Typechecker$classify_texpr(e)];
            break _t9923;
          }
          _match_fail("line 16629");
        }
        return _t9922;
      }
      _t9910 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [List$map(_t9920, binds), Typechecker$classify_texpr(body)]}));
      break _t9911;
    }
    if (_t9909._tag === 10) {
      const p = _t9909._val[0];
      const body = _t9909._val[1];
      const f = _t9909._val[2];
      _t9910 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p, Typechecker$classify_texpr(body), f]}));
      break _t9911;
    }
    if (_t9909._tag === 11) {
      const fn_ = _t9909._val[0];
      const arg = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [Typechecker$classify_texpr(fn_), Typechecker$classify_texpr(arg)]}));
      break _t9911;
    }
    if (_t9909._tag === 12) {
      const c = _t9909._val[0];
      const t = _t9909._val[1];
      const f = _t9909._val[2];
      _t9910 = Typechecker$mk(({_tag: 12, _name: "TEIf", _val: [Typechecker$classify_texpr(c), Typechecker$classify_texpr(t), Typechecker$classify_texpr(f)]}));
      break _t9911;
    }
    if (_t9909._tag === 28) {
      const e1 = _t9909._val[0];
      const e2 = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 28, _name: "TESeq", _val: [Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9911;
    }
    if (_t9909._tag === 25) {
      const n = _t9909._val[0];
      const e1 = _t9909._val[1];
      const e2 = _t9909._val[2];
      _t9910 = Typechecker$mk(({_tag: 25, _name: "TELetMut", _val: [n, Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9911;
    }
    if (_t9909._tag === 24) {
      const scrut = _t9909._val[0];
      const arms = _t9909._val[1];
      const p = _t9909._val[2];
      function _t9924(__p364) {
        let _t9926;
        const _t9925 = __p364;
        _t9927: {
          if (true) {
            const pat = _t9925[0];
            const g = _t9925[1];
            const body = _t9925[2];
            _t9926 = [pat, Option$map(Typechecker$classify_texpr, g), Typechecker$classify_texpr(body)];
            break _t9927;
          }
          _match_fail("line 16629");
        }
        return _t9926;
      }
      _t9910 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [Typechecker$classify_texpr(scrut), List$map(_t9924, arms), p]}));
      break _t9911;
    }
    if (_t9909._tag === 13) {
      const op = _t9909._val[0];
      const e1 = _t9909._val[1];
      const e2 = _t9909._val[2];
      _t9910 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9911;
    }
    if (_t9909._tag === 14) {
      const op = _t9909._val[0];
      const e = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, Typechecker$classify_texpr(e)]}));
      break _t9911;
    }
    if (_t9909._tag === 15) {
      const es = _t9909._val;
      _t9910 = Typechecker$mk(({_tag: 15, _name: "TETuple", _val: List$map(Typechecker$classify_texpr, es)}));
      break _t9911;
    }
    if (_t9909._tag === 16) {
      const fields = _t9909._val;
      function _t9928(__p365) {
        let _t9930;
        const _t9929 = __p365;
        _t9931: {
          if (true) {
            const n = _t9929[0];
            const e = _t9929[1];
            _t9930 = [n, Typechecker$classify_texpr(e)];
            break _t9931;
          }
          _match_fail("line 16629");
        }
        return _t9930;
      }
      _t9910 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: List$map(_t9928, fields)}));
      break _t9911;
    }
    if (_t9909._tag === 17) {
      const base = _t9909._val[0];
      const fields = _t9909._val[1];
      function _t9932(__p366) {
        let _t9934;
        const _t9933 = __p366;
        _t9935: {
          if (true) {
            const n = _t9933[0];
            const e = _t9933[1];
            _t9934 = [n, Typechecker$classify_texpr(e)];
            break _t9935;
          }
          _match_fail("line 16629");
        }
        return _t9934;
      }
      _t9910 = Typechecker$mk(({_tag: 17, _name: "TERecordUpdate", _val: [Typechecker$classify_texpr(base), List$map(_t9932, fields)]}));
      break _t9911;
    }
    if (_t9909._tag === 18) {
      const base = _t9909._val[0];
      const pairs = _t9909._val[1];
      function _t9936(__p367) {
        let _t9938;
        const _t9937 = __p367;
        _t9939: {
          if (true) {
            const i = _t9937[0];
            const v = _t9937[1];
            _t9938 = [Typechecker$classify_texpr(i), Typechecker$classify_texpr(v)];
            break _t9939;
          }
          _match_fail("line 16629");
        }
        return _t9938;
      }
      _t9910 = Typechecker$mk(({_tag: 18, _name: "TERecordUpdateIdx", _val: [Typechecker$classify_texpr(base), List$map(_t9936, pairs)]}));
      break _t9911;
    }
    if (_t9909._tag === 19) {
      const e = _t9909._val[0];
      const f = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$classify_texpr(e), f]}));
      break _t9911;
    }
    if (_t9909._tag === 20) {
      const e1 = _t9909._val[0];
      const e2 = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9911;
    }
    if (_t9909._tag === 21) {
      const e1 = _t9909._val[0];
      const e2 = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t9911;
    }
    if (_t9909._tag === 23) {
      const name = _t9909._val[0];
      const arg = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [name, Option$map(Typechecker$classify_texpr, arg)]}));
      break _t9911;
    }
    if (_t9909._tag === 26) {
      const n = _t9909._val[0];
      const e = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 26, _name: "TEAssign", _val: [n, Typechecker$classify_texpr(e)]}));
      break _t9911;
    }
    if (_t9909._tag === 27) {
      const e1 = _t9909._val[0];
      const f = _t9909._val[1];
      const e2 = _t9909._val[2];
      _t9910 = Typechecker$mk(({_tag: 27, _name: "TEFieldAssign", _val: [Typechecker$classify_texpr(e1), f, Typechecker$classify_texpr(e2)]}));
      break _t9911;
    }
    if (_t9909._tag === 29) {
      const name = _t9909._val[0];
      const e = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 29, _name: "TEPerform", _val: [name, Typechecker$classify_texpr(e)]}));
      break _t9911;
    }
    if (_t9909._tag === 31) {
      const k = _t9909._val[0];
      const v = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 31, _name: "TEResume", _val: [Typechecker$classify_texpr(k), Typechecker$classify_texpr(v)]}));
      break _t9911;
    }
    if (_t9909._tag === 32) {
      const c = _t9909._val[0];
      const b = _t9909._val[1];
      _t9910 = Typechecker$mk(({_tag: 32, _name: "TEWhile", _val: [Typechecker$classify_texpr(c), Typechecker$classify_texpr(b)]}));
      break _t9911;
    }
    if (_t9909._tag === 33) {
      const e = _t9909._val;
      _t9910 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$classify_texpr(e)}));
      break _t9911;
    }
    if (_t9909._tag === 35) {
      const e = _t9909._val;
      _t9910 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$classify_texpr(e)}));
      break _t9911;
    }
    if (_t9909._tag === 36) {
      const e = _t9909._val;
      _t9910 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: Typechecker$classify_texpr(e)}));
      break _t9911;
    }
    if (_t9909._tag === 38) {
      const es = _t9909._val;
      _t9910 = Typechecker$mk(({_tag: 38, _name: "TEArray", _val: List$map(Typechecker$classify_texpr, es)}));
      break _t9911;
    }
    if (_t9909._tag === 39) {
      const e = _t9909._val;
      _t9910 = Typechecker$mk(({_tag: 39, _name: "TEReturn", _val: Typechecker$classify_texpr(e)}));
      break _t9911;
    }
    if ((((((((((_t9909._tag === 0 || _t9909._tag === 1) || _t9909._tag === 2) || _t9909._tag === 3) || _t9909._tag === 4) || _t9909._tag === 5) || _t9909._tag === 6) || _t9909._tag === 7) || _t9909._tag === 22) || _t9909._tag === 34)) {
      _t9910 = te;
      break _t9911;
    }
    _match_fail("line 16629");
  }
  const _t9908 = _t9910;
  return _t9908;
}
function Typechecker$classify_handlers(program) {
  function _t9940(decl) {
    let _t9942;
    const _t9941 = decl;
    _t9943: {
      if (_t9941._tag === 0) {
        const n = _t9941._val[0];
        const e = _t9941._val[1];
        _t9942 = ({_tag: 0, _name: "TDLet", _val: [n, Typechecker$classify_texpr(e)]});
        break _t9943;
      }
      if (_t9941._tag === 1) {
        const n = _t9941._val[0];
        const e = _t9941._val[1];
        _t9942 = ({_tag: 1, _name: "TDLetMut", _val: [n, Typechecker$classify_texpr(e)]});
        break _t9943;
      }
      if (_t9941._tag === 2) {
        const n = _t9941._val[0];
        const e = _t9941._val[1];
        _t9942 = ({_tag: 2, _name: "TDLetRec", _val: [n, Typechecker$classify_texpr(e)]});
        break _t9943;
      }
      if (_t9941._tag === 5) {
        const e = _t9941._val;
        _t9942 = ({_tag: 5, _name: "TDExpr", _val: Typechecker$classify_texpr(e)});
        break _t9943;
      }
      if (_t9941._tag === 3) {
        const binds = _t9941._val;
        function _t9944(__p368) {
          let _t9946;
          const _t9945 = __p368;
          _t9947: {
            if (true) {
              const n = _t9945[0];
              const e = _t9945[1];
              _t9946 = [n, Typechecker$classify_texpr(e)];
              break _t9947;
            }
            _match_fail("line 16629");
          }
          return _t9946;
        }
        _t9942 = ({_tag: 3, _name: "TDLetRecAnd", _val: List$map(_t9944, binds)});
        break _t9943;
      }
      if (_t9941._tag === 9) {
        const name = _t9941._val[0];
        const decls = _t9941._val[1];
        _t9942 = ({_tag: 9, _name: "TDModule", _val: [name, Typechecker$classify_handlers(decls)]});
        break _t9943;
      }
      if (((((_t9941._tag === 7 || _t9941._tag === 4) || _t9941._tag === 6) || _t9941._tag === 8) || _t9941._tag === 10)) {
        _t9942 = decl;
        break _t9943;
      }
      _match_fail("line 16629");
    }
    return _t9942;
  }
  return List$map(_t9940, program);
}
function Optimize$collect_jump_targets(code) {
  const targets_9948 = Hashtbl$create(64);
  function _t9950(op) {
    let _t9952;
    const _t9951 = op;
    _t9953: {
      if (((((_t9951._tag === 37 || _t9951._tag === 38) || _t9951._tag === 39) || _t9951._tag === 68) || _t9951._tag === 71)) {
        const t = _t9951._val;
        _t9952 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, targets_9948, t, undefined]);
        break _t9953;
      }
      if (true) {
        _t9952 = undefined;
        break _t9953;
      }
      _match_fail("line 16629");
    }
    return _t9952;
  }
  Array$iter(_t9950, code);
  const _t9949 = targets_9948;
  return _t9949;
}
function Optimize$is_jump_target(__dict_Hash_0, __dict_Eq_0, targets, offset) {
  return _call(Hashtbl$has, [__dict_Hash_0, __dict_Eq_0, targets, offset]);
}
function Optimize$mark_dead_after_tail_call(code, targets, actions) {
  const len_9954 = Array$length(code);
  const i_9956 = Ref$create(0);
  let _t9958 = undefined;
  let _t9959 = false, _t9960;
  while (true) {
    if (!((Ref$get(i_9956) < len_9954))) break;
    let _t9962;
    const _t9961 = Array$get(code, Ref$get(i_9956));
    _t9963: {
      if ((_t9961._tag === 43 || _t9961._tag === 83)) {
        const j_9964 = Ref$create((Ref$get(i_9956) + 1));
        let _t9966 = undefined;
        let _t9967 = false, _t9968;
        while (true) {
          if (!(((Ref$get(j_9964) < len_9954) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, Ref$get(j_9964)]))))) break;
          Array$set(actions, Ref$get(j_9964), ({_tag: 1, _name: "Remove"}));
          Ref$set(j_9964, (Ref$get(j_9964) + 1));
          if (_t9967) break;
        }
        _t9966 = _t9967 ? _t9968 : undefined;
        _t9966;
        const _t9965 = Ref$set(i_9956, Ref$get(j_9964));
        _t9962 = _t9965;
        break _t9963;
      }
      if (true) {
        _t9962 = Ref$set(i_9956, (Ref$get(i_9956) + 1));
        break _t9963;
      }
      _match_fail("line 16629");
    }
    _t9962;
    if (_t9959) break;
  }
  _t9958 = _t9959 ? _t9960 : undefined;
  const _t9957 = _t9958;
  const _t9955 = _t9957;
  return _t9955;
}
function Optimize$mark_jump_to_next(code, actions) {
  const len_9969 = Array$length(code);
  let i_9971 = 0;
  let _t9973 = undefined;
  let _t9974 = false, _t9975;
  while (true) {
    if (!((i_9971 <= (len_9969 - 1)))) break;
    let _t9977;
    const _t9976 = Array$get(code, i_9971);
    _t9978: {
      if (_t9976._tag === 37) {
        const target = _t9976._val;
        if ((target === (i_9971 + 1))) {
          _t9977 = Array$set(actions, i_9971, ({_tag: 1, _name: "Remove"}));
          break _t9978;
        }
      }
      if (true) {
        _t9977 = undefined;
        break _t9978;
      }
      _match_fail("line 16629");
    }
    _t9977;
    (i_9971 = (i_9971 + 1), undefined);
    if (_t9974) break;
  }
  _t9973 = _t9974 ? _t9975 : undefined;
  const _t9972 = _t9973;
  const _t9970 = _t9972;
  return _t9970;
}
function Optimize$reads_slot(op, n) {
  let _t9980;
  const _t9979 = op;
  _t9981: {
    if ((((_t9979._tag === 3 || _t9979._tag === 76) || _t9979._tag === 77) || _t9979._tag === 78)) {
      const s = (((_t9979._tag === 3 || _t9979._tag === 76) || _t9979._tag === 77) ? ((_t9979._tag === 3 || _t9979._tag === 76) ? (_t9979._tag === 3 ? _t9979._val : _t9979._val[0]) : _t9979._val[0]) : _t9979._val[0]);
      _t9980 = (s === n);
      break _t9981;
    }
    if ((_t9979._tag === 40 || _t9979._tag === 41)) {
      const caps = _t9979._val[1];
      function _t9982(c) {
        return _eq(c, ({_tag: 0, _name: "CaptureLocal", _val: n}));
      }
      _t9980 = List$exists(_t9982, caps);
      break _t9981;
    }
    if (true) {
      _t9980 = false;
      break _t9981;
    }
    _match_fail("line 16629");
  }
  return _t9980;
}
function Optimize$writes_slot(op, n) {
  let _t9984;
  const _t9983 = op;
  _t9985: {
    if (_t9983._tag === 4) {
      const s = _t9983._val;
      _t9984 = (s === n);
      break _t9985;
    }
    if (true) {
      _t9984 = false;
      break _t9985;
    }
    _match_fail("line 16629");
  }
  return _t9984;
}
function Optimize$is_slot_dead(code, actions, targets, n, start) {
  const len_9986 = Array$length(code);
  const i_9988 = Ref$create(start);
  const result_9990 = Ref$create(true);
  const done__9992 = Ref$create(false);
  let _t9994 = undefined;
  let _t9995 = false, _t9996;
  while (true) {
    if (!(((Ref$get(i_9988) < len_9986) && (!Ref$get(done__9992))))) break;
    let _t9997;
    if (_eq(Array$get(actions, Ref$get(i_9988)), ({_tag: 1, _name: "Remove"}))) {
      _t9997 = Ref$set(i_9988, (Ref$get(i_9988) + 1));
    } else {
      let _t9998;
      if (_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, Ref$get(i_9988)])) {
        Ref$set(result_9990, false);
        _t9998 = Ref$set(done__9992, true);
      } else {
        const op_9999 = Array$get(code, Ref$get(i_9988));
        let _t10001;
        if (Optimize$reads_slot(op_9999, n)) {
          Ref$set(result_9990, false);
          _t10001 = Ref$set(done__9992, true);
        } else {
          let _t10002;
          if (Optimize$writes_slot(op_9999, n)) {
            _t10002 = Ref$set(done__9992, true);
          } else {
            let _t10004;
            const _t10003 = op_9999;
            _t10005: {
              if ((((((_t10003._tag === 44 || _t10003._tag === 45) || _t10003._tag === 43) || _t10003._tag === 83) || _t10003._tag === 64) || _t10003._tag === 75)) {
                _t10004 = Ref$set(done__9992, true);
                break _t10005;
              }
              if ((((((((_t10003._tag === 37 || _t10003._tag === 38) || _t10003._tag === 39) || _t10003._tag === 70) || _t10003._tag === 71) || _t10003._tag === 72) || _t10003._tag === 68) || _t10003._tag === 81)) {
                Ref$set(result_9990, false);
                _t10004 = Ref$set(done__9992, true);
                break _t10005;
              }
              if (true) {
                _t10004 = Ref$set(i_9988, (Ref$get(i_9988) + 1));
                break _t10005;
              }
              _match_fail("line 16629");
            }
            _t10002 = _t10004;
          }
          _t10001 = _t10002;
        }
        const _t10000 = _t10001;
        _t9998 = _t10000;
      }
      _t9997 = _t9998;
    }
    _t9997;
    if (_t9995) break;
  }
  _t9994 = _t9995 ? _t9996 : undefined;
  _t9994;
  const _t9993 = Ref$get(result_9990);
  const _t9991 = _t9993;
  const _t9989 = _t9991;
  const _t9987 = _t9989;
  return _t9987;
}
function Optimize$mark_set_get_pairs(code, targets, actions) {
  const len_10006 = Array$length(code);
  const i_10008 = Ref$create(0);
  let _t10010 = undefined;
  let _t10011 = false, _t10012;
  while (true) {
    if (!((Ref$get(i_10008) < (len_10006 - 1)))) break;
    let _t10013;
    if ((_eq(Array$get(actions, Ref$get(i_10008)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_10008) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_10008) + 1)]))))) {
      let _t10015;
      const _t10014 = [Array$get(code, Ref$get(i_10008)), Array$get(code, (Ref$get(i_10008) + 1))];
      _t10016: {
        if (_t10014[0]._tag === 4 && _t10014[1]._tag === 3) {
          const n = _t10014[0]._val;
          const m = _t10014[1]._val;
          if ((n === m)) {
            let _t10017;
            if (Optimize$is_slot_dead(code, actions, targets, n, (Ref$get(i_10008) + 2))) {
              Array$set(actions, Ref$get(i_10008), ({_tag: 1, _name: "Remove"}));
              Array$set(actions, (Ref$get(i_10008) + 1), ({_tag: 1, _name: "Remove"}));
              _t10017 = Ref$set(i_10008, (Ref$get(i_10008) + 2));
            } else {
              Array$set(actions, Ref$get(i_10008), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 2, _name: "DUP"}), _tl: ({_hd: ({_tag: 4, _name: "SET_LOCAL", _val: n}), _tl: null})})}));
              Array$set(actions, (Ref$get(i_10008) + 1), ({_tag: 1, _name: "Remove"}));
              _t10017 = Ref$set(i_10008, (Ref$get(i_10008) + 2));
            }
            _t10015 = _t10017;
            break _t10016;
          }
        }
        if (true) {
          _t10015 = Ref$set(i_10008, (Ref$get(i_10008) + 1));
          break _t10016;
        }
        _match_fail("line 16629");
      }
      _t10013 = _t10015;
    } else {
      _t10013 = Ref$set(i_10008, (Ref$get(i_10008) + 1));
    }
    _t10013;
    if (_t10011) break;
  }
  _t10010 = _t10011 ? _t10012 : undefined;
  const _t10009 = _t10010;
  const _t10007 = _t10009;
  return _t10007;
}
function Optimize$mark_dead_stores(code, targets, actions) {
  const len_10018 = Array$length(code);
  const i_10020 = Ref$create(0);
  let _t10022 = undefined;
  let _t10023 = false, _t10024;
  while (true) {
    if (!((Ref$get(i_10020) < len_10018))) break;
    const handled_10025 = Ref$create(false);
    let _t10027;
    if ((((Ref$get(i_10020) + 1) < len_10018) && (_eq(Array$get(actions, Ref$get(i_10020)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_10020) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_10020) + 1)])))))) {
      let _t10029;
      const _t10028 = [Array$get(code, Ref$get(i_10020)), Array$get(code, (Ref$get(i_10020) + 1))];
      _t10030: {
        if (_t10028[0]._tag === 2 && _t10028[1]._tag === 4) {
          const n = _t10028[1]._val;
          if (Optimize$is_slot_dead(code, actions, targets, n, (Ref$get(i_10020) + 2))) {
            Array$set(actions, Ref$get(i_10020), ({_tag: 1, _name: "Remove"}));
            Array$set(actions, (Ref$get(i_10020) + 1), ({_tag: 1, _name: "Remove"}));
            Ref$set(i_10020, (Ref$get(i_10020) + 2));
            _t10029 = Ref$set(handled_10025, true);
            break _t10030;
          }
        }
        if (true) {
          _t10029 = undefined;
          break _t10030;
        }
        _match_fail("line 16629");
      }
      _t10027 = _t10029;
    } else {
      _t10027 = undefined;
    }
    _t10027;
    let _t10031;
    if ((!Ref$get(handled_10025))) {
      let _t10033;
      const _t10032 = Array$get(code, Ref$get(i_10020));
      _t10034: {
        if (_t10032._tag === 4) {
          const n = _t10032._val;
          if ((_eq(Array$get(actions, Ref$get(i_10020)), ({_tag: 0, _name: "Keep"})) && Optimize$is_slot_dead(code, actions, targets, n, (Ref$get(i_10020) + 1)))) {
            Array$set(actions, Ref$get(i_10020), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 1, _name: "POP"}), _tl: null})}));
            _t10033 = Ref$set(i_10020, (Ref$get(i_10020) + 1));
            break _t10034;
          }
        }
        if (true) {
          _t10033 = Ref$set(i_10020, (Ref$get(i_10020) + 1));
          break _t10034;
        }
        _match_fail("line 16629");
      }
      _t10031 = _t10033;
    } else {
      _t10031 = undefined;
    }
    const _t10026 = _t10031;
    _t10026;
    if (_t10023) break;
  }
  _t10022 = _t10023 ? _t10024 : undefined;
  const _t10021 = _t10022;
  const _t10019 = _t10021;
  return _t10019;
}
function Optimize$mark_superinstructions(code, targets, actions) {
  const len_10035 = Array$length(code);
  const i_10037 = Ref$create(0);
  let _t10039 = undefined;
  let _t10040 = false, _t10041;
  while (true) {
    if (!((Ref$get(i_10037) < len_10035))) break;
    let _t10042;
    if ((((Ref$get(i_10037) + 1) < len_10035) && (_eq(Array$get(actions, Ref$get(i_10037)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_10037) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_10037) + 1)])))))) {
      let _t10044;
      const _t10043 = [Array$get(code, Ref$get(i_10037)), Array$get(code, (Ref$get(i_10037) + 1))];
      _t10045: {
        if (_t10043[0]._tag === 3 && _t10043[1]._tag === 42) {
          const slot = _t10043[0]._val;
          const arity = _t10043[1]._val;
          Array$set(actions, Ref$get(i_10037), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 76, _name: "GET_LOCAL_CALL", _val: [slot, arity]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10037) + 1), ({_tag: 1, _name: "Remove"}));
          _t10044 = Ref$set(i_10037, (Ref$get(i_10037) + 2));
          break _t10045;
        }
        if (_t10043[0]._tag === 3 && _t10043[1]._tag === 49) {
          const slot = _t10043[0]._val;
          const idx = _t10043[1]._val;
          Array$set(actions, Ref$get(i_10037), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 77, _name: "GET_LOCAL_TUPLE_GET", _val: [slot, idx]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10037) + 1), ({_tag: 1, _name: "Remove"}));
          _t10044 = Ref$set(i_10037, (Ref$get(i_10037) + 2));
          break _t10045;
        }
        if (_t10043[0]._tag === 3 && _t10043[1]._tag === 51) {
          const slot = _t10043[0]._val;
          const name = _t10043[1]._val;
          Array$set(actions, Ref$get(i_10037), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 78, _name: "GET_LOCAL_FIELD", _val: [slot, name]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10037) + 1), ({_tag: 1, _name: "Remove"}));
          _t10044 = Ref$set(i_10037, (Ref$get(i_10037) + 2));
          break _t10045;
        }
        if (_t10043[0]._tag === 10 && _t10043[1]._tag === 42) {
          const idx = _t10043[0]._val;
          const arity = _t10043[1]._val;
          Array$set(actions, Ref$get(i_10037), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 79, _name: "GET_GLOBAL_CALL", _val: [idx, arity]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10037) + 1), ({_tag: 1, _name: "Remove"}));
          _t10044 = Ref$set(i_10037, (Ref$get(i_10037) + 2));
          break _t10045;
        }
        if (_t10043[0]._tag === 10 && _t10043[1]._tag === 51) {
          const idx = _t10043[0]._val;
          const name = _t10043[1]._val;
          Array$set(actions, Ref$get(i_10037), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 80, _name: "GET_GLOBAL_FIELD", _val: [idx, name]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10037) + 1), ({_tag: 1, _name: "Remove"}));
          _t10044 = Ref$set(i_10037, (Ref$get(i_10037) + 2));
          break _t10045;
        }
        if (true) {
          _t10044 = Ref$set(i_10037, (Ref$get(i_10037) + 1));
          break _t10045;
        }
        _match_fail("line 16629");
      }
      _t10042 = _t10044;
    } else {
      _t10042 = Ref$set(i_10037, (Ref$get(i_10037) + 1));
    }
    _t10042;
    if (_t10040) break;
  }
  _t10039 = _t10040 ? _t10041 : undefined;
  const _t10038 = _t10039;
  const _t10036 = _t10038;
  return _t10036;
}
function Optimize$detect_tag_chain(code, _targets, start_pos, scrut_slot) {
  const len_10046 = Array$length(code);
  const arms_10048 = Ref$create(null);
  const pos_10050 = Ref$create(start_pos);
  const continue__10052 = Ref$create(true);
  const default_target_10054 = Ref$create(0);
  const chain_positions_10056 = Hashtbl$create(16);
  let _t10058 = undefined;
  let _t10059 = false, _t10060;
  while (true) {
    if (!(Ref$get(continue__10052))) break;
    let _t10072;
    if (((Ref$get(pos_10050) + 2) < len_10046)) {
    let _t10062;
    const _t10061 = Array$get(code, Ref$get(pos_10050));
    _t10063: {
      if (_t10061._tag === 3) {
        const s = _t10061._val;
        if ((s === scrut_slot)) {
          _t10062 = true;
          break _t10063;
        }
      }
      if (true) {
        _t10062 = false;
        break _t10063;
      }
      _match_fail("line 16629");
    }
    let _t10071;
    if (_t10062) {
    let _t10065;
    const _t10064 = Array$get(code, (Ref$get(pos_10050) + 1));
    _t10066: {
      if (_t10064._tag === 58) {
        _t10065 = true;
        break _t10066;
      }
      if (true) {
        _t10065 = false;
        break _t10066;
      }
      _match_fail("line 16629");
    }
    let _t10070;
    if (_t10065) {
    let _t10068;
    const _t10067 = Array$get(code, (Ref$get(pos_10050) + 2));
    _t10069: {
      if (_t10067._tag === 38) {
        const t = _t10067._val;
        _t10068 = (t > Ref$get(pos_10050));
        break _t10069;
      }
      if (true) {
        _t10068 = false;
        break _t10069;
      }
      _match_fail("line 16629");
    }
      _t10070 = _t10068;
    } else {
      _t10070 = false;
    }
      _t10071 = _t10070;
    } else {
      _t10071 = false;
    }
      _t10072 = _t10071;
    } else {
      _t10072 = false;
    }
    let _t10073;
    if (_t10072) {
      let _t10075;
      const _t10074 = Array$get(code, (Ref$get(pos_10050) + 1));
      _t10076: {
        if (_t10074._tag === 58) {
          const t = _t10074._val;
          _t10075 = t;
          break _t10076;
        }
        if (true) {
          _t10075 = failwith("assert false");
          break _t10076;
        }
        _match_fail("line 16629");
      }
      const tag_10077 = _t10075;
      let _t10080;
      const _t10079 = Array$get(code, (Ref$get(pos_10050) + 2));
      _t10081: {
        if (_t10079._tag === 38) {
          const t = _t10079._val;
          _t10080 = t;
          break _t10081;
        }
        if (true) {
          _t10080 = failwith("assert false");
          break _t10081;
        }
        _match_fail("line 16629");
      }
      const next_10082 = _t10080;
      const arm_body_10084 = (Ref$get(pos_10050) + 3);
      Ref$set(arms_10048, ({_hd: [tag_10077, arm_body_10084], _tl: Ref$get(arms_10048)}));
      _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, chain_positions_10056, Ref$get(pos_10050), undefined]);
      _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, chain_positions_10056, (Ref$get(pos_10050) + 1), undefined]);
      _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, chain_positions_10056, (Ref$get(pos_10050) + 2), undefined]);
      const _t10085 = Ref$set(pos_10050, next_10082);
      const _t10083 = _t10085;
      const _t10078 = _t10083;
      _t10073 = _t10078;
    } else {
      Ref$set(default_target_10054, Ref$get(pos_10050));
      _t10073 = Ref$set(continue__10052, false);
    }
    _t10073;
    if (_t10059) break;
  }
  _t10058 = _t10059 ? _t10060 : undefined;
  _t10058;
  const arms_10086 = List$rev(Ref$get(arms_10048));
  const valid_10088 = (List$length(arms_10086) >= 2);
  let _t10101;
  if (valid_10088) {
  const ok_10090 = Ref$create(true);
  function _t10092(i, op) {
    let _t10093;
    if ((Ref$get(ok_10090) && (!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, chain_positions_10056, i])))) {
      function _t10094(t) {
        let _t10095;
        if (_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, chain_positions_10056, t])) {
          _t10095 = Ref$set(ok_10090, false);
        } else {
          _t10095 = undefined;
        }
        return _t10095;
      }
      const check_target_10096 = _t10094;
      let _t10099;
      const _t10098 = op;
      _t10100: {
        if (((((_t10098._tag === 37 || _t10098._tag === 38) || _t10098._tag === 39) || _t10098._tag === 68) || _t10098._tag === 71)) {
          const t = _t10098._val;
          _t10099 = check_target_10096(t);
          break _t10100;
        }
        if (true) {
          _t10099 = undefined;
          break _t10100;
        }
        _match_fail("line 16629");
      }
      const _t10097 = _t10099;
      _t10093 = _t10097;
    } else {
      _t10093 = undefined;
    }
    return _t10093;
  }
  Array$iteri(_t10092, code);
  const _t10091 = Ref$get(ok_10090);
    _t10101 = _t10091;
  } else {
    _t10101 = false;
  }
  const valid_10102 = _t10101;
  let _t10104;
  if ((valid_10102 && !_eq(arms_10086, null))) {
    const tags_10105 = List$map(fst, arms_10086);
    const unique_tags_10107 = List$sort_uniq(compare, tags_10105);
    let _t10109;
    if ((List$length(unique_tags_10107) !== List$length(tags_10105))) {
      _t10109 = ({_tag: 0, _name: "None"});
    } else {
      const min_tag_10110 = List$fold(min, List$hd(tags_10105), tags_10105);
      const max_tag_10112 = List$fold(max, List$hd(tags_10105), tags_10105);
      const range_10114 = ((max_tag_10112 - min_tag_10110) + 1);
      let _t10116;
      if ((range_10114 <= (2 * List$length(arms_10086)))) {
        _t10116 = ({_tag: 1, _name: "Some", _val: [arms_10086, min_tag_10110, max_tag_10112, Ref$get(default_target_10054)]});
      } else {
        _t10116 = ({_tag: 0, _name: "None"});
      }
      const _t10115 = _t10116;
      const _t10113 = _t10115;
      const _t10111 = _t10113;
      _t10109 = _t10111;
    }
    const _t10108 = _t10109;
    const _t10106 = _t10108;
    _t10104 = _t10106;
  } else {
    _t10104 = ({_tag: 0, _name: "None"});
  }
  const _t10103 = _t10104;
  const _t10089 = _t10103;
  const _t10087 = _t10089;
  const _t10057 = _t10087;
  const _t10055 = _t10057;
  const _t10053 = _t10055;
  const _t10051 = _t10053;
  const _t10049 = _t10051;
  const _t10047 = _t10049;
  return _t10047;
}
function Optimize$mark_jump_tables(code, targets, actions) {
  const len_10117 = Array$length(code);
  const i_10119 = Ref$create(0);
  let _t10121 = undefined;
  let _t10122 = false, _t10123;
  while (true) {
    if (!((Ref$get(i_10119) < len_10117))) break;
    let _t10124;
    if ((((Ref$get(i_10119) + 2) < len_10117) && _eq(Array$get(actions, Ref$get(i_10119)), ({_tag: 0, _name: "Keep"})))) {
      let _t10126;
      const _t10125 = [Array$get(code, Ref$get(i_10119)), Array$get(code, (Ref$get(i_10119) + 1)), Array$get(code, (Ref$get(i_10119) + 2))];
      _t10127: {
        if (_t10125[0]._tag === 3 && _t10125[1]._tag === 58 && _t10125[2]._tag === 38) {
          const scrut_slot = _t10125[0]._val;
          let _t10129;
          const _t10128 = Optimize$detect_tag_chain(code, targets, Ref$get(i_10119), scrut_slot);
          _t10130: {
            if (_t10128._tag === 1) {
              const arms = _t10128._val[0];
              const min_tag = _t10128._val[1];
              const max_tag = _t10128._val[2];
              const default_target = _t10128._val[3];
              const range_10131 = ((max_tag - min_tag) + 1);
              const table_10133 = Array$make(range_10131, default_target);
              function _t10135(__p369) {
                let _t10137;
                const _t10136 = __p369;
                _t10138: {
                  if (true) {
                    const tag = _t10136[0];
                    const arm_body = _t10136[1];
                    _t10137 = Array$set(table_10133, (tag - min_tag), arm_body);
                    break _t10138;
                  }
                  _match_fail("line 16629");
                }
                return _t10137;
              }
              List$iter(_t10135, arms);
              Array$set(actions, (Ref$get(i_10119) + 1), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 81, _name: "JUMP_TABLE", _val: [min_tag, table_10133, default_target]}), _tl: null})}));
              Array$set(actions, (Ref$get(i_10119) + 2), ({_tag: 1, _name: "Remove"}));
              const remaining_10139 = List$tl(arms);
              function _t10141(__p370) {
                let _t10143;
                const _t10142 = __p370;
                _t10144: {
                  if (true) {
                    const arm_body = _t10142[1];
                    const chain_start_10145 = (arm_body - 3);
                    let _t10147;
                    if (((chain_start_10145 >= 0) && (chain_start_10145 < len_10117))) {
                      let _t10148;
                      if (_eq(Array$get(actions, chain_start_10145), ({_tag: 0, _name: "Keep"}))) {
                        _t10148 = Array$set(actions, chain_start_10145, ({_tag: 1, _name: "Remove"}));
                      } else {
                        _t10148 = undefined;
                      }
                      _t10148;
                      let _t10149;
                      if ((((chain_start_10145 + 1) < len_10117) && _eq(Array$get(actions, (chain_start_10145 + 1)), ({_tag: 0, _name: "Keep"})))) {
                        _t10149 = Array$set(actions, (chain_start_10145 + 1), ({_tag: 1, _name: "Remove"}));
                      } else {
                        _t10149 = undefined;
                      }
                      _t10149;
                      let _t10150;
                      if ((((chain_start_10145 + 2) < len_10117) && _eq(Array$get(actions, (chain_start_10145 + 2)), ({_tag: 0, _name: "Keep"})))) {
                        _t10150 = Array$set(actions, (chain_start_10145 + 2), ({_tag: 1, _name: "Remove"}));
                      } else {
                        _t10150 = undefined;
                      }
                      _t10147 = _t10150;
                    } else {
                      _t10147 = undefined;
                    }
                    const _t10146 = _t10147;
                    _t10143 = _t10146;
                    break _t10144;
                  }
                  _match_fail("line 16629");
                }
                return _t10143;
              }
              List$iter(_t10141, remaining_10139);
              const last_arm_10151 = List$nth(arms, (List$length(arms) - 1));
              const _t10152 = Ref$set(i_10119, snd(last_arm_10151));
              const _t10140 = _t10152;
              const _t10134 = _t10140;
              const _t10132 = _t10134;
              _t10129 = _t10132;
              break _t10130;
            }
            if (_t10128._tag === 0) {
              _t10129 = Ref$set(i_10119, (Ref$get(i_10119) + 1));
              break _t10130;
            }
            _match_fail("line 16629");
          }
          _t10126 = _t10129;
          break _t10127;
        }
        if (true) {
          _t10126 = Ref$set(i_10119, (Ref$get(i_10119) + 1));
          break _t10127;
        }
        _match_fail("line 16629");
      }
      _t10124 = _t10126;
    } else {
      _t10124 = Ref$set(i_10119, (Ref$get(i_10119) + 1));
    }
    _t10124;
    if (_t10122) break;
  }
  _t10121 = _t10122 ? _t10123 : undefined;
  const _t10120 = _t10121;
  const _t10118 = _t10120;
  return _t10118;
}
function Optimize$mark_push_pop(code, targets, actions) {
  const len_10153 = Array$length(code);
  const i_10155 = Ref$create(0);
  let _t10157 = undefined;
  let _t10158 = false, _t10159;
  while (true) {
    if (!((Ref$get(i_10155) < (len_10153 - 1)))) break;
    let _t10160;
    if ((_eq(Array$get(actions, Ref$get(i_10155)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_10155) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_10155) + 1)]))))) {
      let _t10162;
      const _t10161 = Array$get(code, Ref$get(i_10155));
      _t10163: {
        if ((((((_t10161._tag === 0 || _t10161._tag === 3) || _t10161._tag === 10) || _t10161._tag === 5) || _t10161._tag === 57) || _t10161._tag === 2)) {
          _t10162 = true;
          break _t10163;
        }
        if (true) {
          _t10162 = false;
          break _t10163;
        }
        _match_fail("line 16629");
      }
      const is_pure_push_10164 = _t10162;
      let _t10167;
      const _t10166 = Array$get(code, (Ref$get(i_10155) + 1));
      _t10168: {
        if (_t10166._tag === 1) {
          if (is_pure_push_10164) {
            Array$set(actions, Ref$get(i_10155), ({_tag: 1, _name: "Remove"}));
            Array$set(actions, (Ref$get(i_10155) + 1), ({_tag: 1, _name: "Remove"}));
            _t10167 = Ref$set(i_10155, (Ref$get(i_10155) + 2));
            break _t10168;
          }
        }
        if (true) {
          _t10167 = Ref$set(i_10155, (Ref$get(i_10155) + 1));
          break _t10168;
        }
        _match_fail("line 16629");
      }
      const _t10165 = _t10167;
      _t10160 = _t10165;
    } else {
      _t10160 = Ref$set(i_10155, (Ref$get(i_10155) + 1));
    }
    _t10160;
    if (_t10158) break;
  }
  _t10157 = _t10158 ? _t10159 : undefined;
  const _t10156 = _t10157;
  const _t10154 = _t10156;
  return _t10154;
}
function Optimize$rewrite(code, line_table, actions) {
  const len_10169 = Array$length(code);
  const new_code_10171 = Ref$create(null);
  const new_lines_10173 = Ref$create(null);
  const offset_map_10175 = Array$make((len_10169 + 1), 0);
  const new_offset_10177 = Ref$create(0);
  let i_10179 = 0;
  let _t10181 = undefined;
  let _t10182 = false, _t10183;
  while (true) {
    if (!((i_10179 <= (len_10169 - 1)))) break;
    Array$set(offset_map_10175, i_10179, Ref$get(new_offset_10177));
    let _t10184;
    if ((i_10179 < Array$length(line_table))) {
      _t10184 = Array$get(line_table, i_10179);
    } else {
      _t10184 = 0;
    }
    const line_10185 = _t10184;
    let _t10188;
    const _t10187 = Array$get(actions, i_10179);
    _t10189: {
      if (_t10187._tag === 0) {
        Ref$set(new_code_10171, ({_hd: Array$get(code, i_10179), _tl: Ref$get(new_code_10171)}));
        Ref$set(new_lines_10173, ({_hd: line_10185, _tl: Ref$get(new_lines_10173)}));
        _t10188 = Ref$set(new_offset_10177, (Ref$get(new_offset_10177) + 1));
        break _t10189;
      }
      if (_t10187._tag === 1) {
        _t10188 = undefined;
        break _t10189;
      }
      if (_t10187._tag === 2) {
        const ops = _t10187._val;
        function _t10190(op) {
          Ref$set(new_code_10171, ({_hd: op, _tl: Ref$get(new_code_10171)}));
          Ref$set(new_lines_10173, ({_hd: line_10185, _tl: Ref$get(new_lines_10173)}));
          return Ref$set(new_offset_10177, (Ref$get(new_offset_10177) + 1));
        }
        _t10188 = List$iter(_t10190, ops);
        break _t10189;
      }
      _match_fail("line 16629");
    }
    const _t10186 = _t10188;
    _t10186;
    (i_10179 = (i_10179 + 1), undefined);
    if (_t10182) break;
  }
  _t10181 = _t10182 ? _t10183 : undefined;
  _t10181;
  Array$set(offset_map_10175, len_10169, Ref$get(new_offset_10177));
  const new_code_10191 = Array$of_list(List$rev(Ref$get(new_code_10171)));
  const new_lines_10193 = Array$of_list(List$rev(Ref$get(new_lines_10173)));
  const _t10194 = [new_code_10191, new_lines_10193, offset_map_10175];
  const _t10192 = _t10194;
  const _t10180 = _t10192;
  const _t10178 = _t10180;
  const _t10176 = _t10178;
  const _t10174 = _t10176;
  const _t10172 = _t10174;
  const _t10170 = _t10172;
  return _t10170;
}
function Optimize$fixup_jumps(code, offset_map) {
  const map_len_10195 = Array$length(offset_map);
  function _t10197(t) {
    let _t10198;
    if (((t >= 0) && (t < map_len_10195))) {
      _t10198 = Array$get(offset_map, t);
    } else {
      _t10198 = t;
    }
    return _t10198;
  }
  const remap_10199 = _t10197;
  function _t10201(i, op) {
    let _t10203;
    const _t10202 = op;
    _t10204: {
      if (_t10202._tag === 37) {
        const t = _t10202._val;
        _t10203 = ({_tag: 37, _name: "JUMP", _val: remap_10199(t)});
        break _t10204;
      }
      if (_t10202._tag === 38) {
        const t = _t10202._val;
        _t10203 = ({_tag: 38, _name: "JUMP_IF_FALSE", _val: remap_10199(t)});
        break _t10204;
      }
      if (_t10202._tag === 39) {
        const t = _t10202._val;
        _t10203 = ({_tag: 39, _name: "JUMP_IF_TRUE", _val: remap_10199(t)});
        break _t10204;
      }
      if (_t10202._tag === 68) {
        const t = _t10202._val;
        _t10203 = ({_tag: 68, _name: "ENTER_LOOP", _val: remap_10199(t)});
        break _t10204;
      }
      if (_t10202._tag === 71) {
        const t = _t10202._val;
        _t10203 = ({_tag: 71, _name: "LOOP_CONTINUE", _val: remap_10199(t)});
        break _t10204;
      }
      if (_t10202._tag === 81) {
        const min_tag = _t10202._val[0];
        const targets = _t10202._val[1];
        const _mml$default = _t10202._val[2];
        function _t10205(t) {
          return remap_10199(t);
        }
        const new_targets_10206 = Array$map(_t10205, targets);
        const new_default_10208 = remap_10199(_mml$default);
        const _t10209 = ({_tag: 81, _name: "JUMP_TABLE", _val: [min_tag, new_targets_10206, new_default_10208]});
        const _t10207 = _t10209;
        _t10203 = _t10207;
        break _t10204;
      }
      if (true) {
        const other = _t10202;
        _t10203 = other;
        break _t10204;
      }
      _match_fail("line 16629");
    }
    const remapped_10210 = _t10203;
    const _t10211 = Array$set(code, i, remapped_10210);
    return _t10211;
  }
  const _t10200 = Array$iteri(_t10201, code);
  const _t10196 = _t10200;
  return _t10196;
}
function Optimize$thread_jumps(code) {
  const len_10212 = Array$length(code);
  let _t10214;
  if ((len_10212 === 0)) {
    _t10214 = undefined;
  } else {
    function _t10215(target) {
      const visited_10216 = Hashtbl$create(8);
      const t_10218 = Ref$create(target);
      const continue__10220 = Ref$create(true);
      let _t10222 = undefined;
      let _t10223 = false, _t10224;
      while (true) {
        if (!(Ref$get(continue__10220))) break;
        let _t10225;
        if (((Ref$get(t_10218) < 0) || ((Ref$get(t_10218) >= len_10212) || _call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, visited_10216, Ref$get(t_10218)])))) {
          _t10225 = Ref$set(continue__10220, false);
        } else {
          let _t10227;
          const _t10226 = Array$get(code, Ref$get(t_10218));
          _t10228: {
            if (_t10226._tag === 37) {
              const next = _t10226._val;
              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, visited_10216, Ref$get(t_10218), undefined]);
              _t10227 = Ref$set(t_10218, next);
              break _t10228;
            }
            if (true) {
              _t10227 = Ref$set(continue__10220, false);
              break _t10228;
            }
            _match_fail("line 16629");
          }
          _t10225 = _t10227;
        }
        _t10225;
        if (_t10223) break;
      }
      _t10222 = _t10223 ? _t10224 : undefined;
      _t10222;
      const _t10221 = Ref$get(t_10218);
      const _t10219 = _t10221;
      const _t10217 = _t10219;
      return _t10217;
    }
    const resolve_target_10229 = _t10215;
    const control_depth_10231 = Array$make(len_10212, 0);
    const depth_10233 = Ref$create(0);
    let i_10235 = 0;
    let _t10237 = undefined;
    let _t10238 = false, _t10239;
    while (true) {
      if (!((i_10235 <= (len_10212 - 1)))) break;
      Array$set(control_depth_10231, i_10235, Ref$get(depth_10233));
      let _t10241;
      const _t10240 = Array$get(code, i_10235);
      _t10242: {
        if (_t10240._tag === 68) {
          _t10241 = Ref$set(depth_10233, (Ref$get(depth_10233) + 1));
          break _t10242;
        }
        if (_t10240._tag === 69) {
          let _t10243;
          if ((Ref$get(depth_10233) > 0)) {
            _t10243 = Ref$set(depth_10233, (Ref$get(depth_10233) - 1));
          } else {
            _t10243 = undefined;
          }
          _t10241 = _t10243;
          break _t10242;
        }
        if (true) {
          _t10241 = undefined;
          break _t10242;
        }
        _match_fail("line 16629");
      }
      _t10241;
      (i_10235 = (i_10235 + 1), undefined);
      if (_t10238) break;
    }
    _t10237 = _t10238 ? _t10239 : undefined;
    _t10237;
    let i_10244 = 0;
    let _t10246 = undefined;
    let _t10247 = false, _t10248;
    while (true) {
      if (!((i_10244 <= (len_10212 - 1)))) break;
      let _t10250;
      const _t10249 = Array$get(code, i_10244);
      _t10251: {
        if (_t10249._tag === 37) {
          const target = _t10249._val;
          const final_target_10252 = resolve_target_10229(target);
          let _t10254;
          if (((final_target_10252 >= 0) && ((final_target_10252 < len_10212) && (Array$get(control_depth_10231, i_10244) === 0)))) {
            let _t10256;
            const _t10255 = Array$get(code, final_target_10252);
            _t10257: {
              if (_t10255._tag === 44) {
                _t10256 = Array$set(code, i_10244, ({_tag: 44, _name: "RETURN"}));
                break _t10257;
              }
              if (true) {
                let _t10258;
                if ((final_target_10252 !== target)) {
                  _t10258 = Array$set(code, i_10244, ({_tag: 37, _name: "JUMP", _val: final_target_10252}));
                } else {
                  _t10258 = undefined;
                }
                _t10256 = _t10258;
                break _t10257;
              }
              _match_fail("line 16629");
            }
            _t10254 = _t10256;
          } else {
            let _t10259;
            if ((final_target_10252 !== target)) {
              _t10259 = Array$set(code, i_10244, ({_tag: 37, _name: "JUMP", _val: final_target_10252}));
            } else {
              _t10259 = undefined;
            }
            _t10254 = _t10259;
          }
          const _t10253 = _t10254;
          _t10250 = _t10253;
          break _t10251;
        }
        if (_t10249._tag === 38) {
          const target = _t10249._val;
          const final_target_10260 = resolve_target_10229(target);
          let _t10262;
          if ((final_target_10260 !== target)) {
            _t10262 = Array$set(code, i_10244, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: final_target_10260}));
          } else {
            _t10262 = undefined;
          }
          const _t10261 = _t10262;
          _t10250 = _t10261;
          break _t10251;
        }
        if (_t10249._tag === 39) {
          const target = _t10249._val;
          const final_target_10263 = resolve_target_10229(target);
          let _t10265;
          if ((final_target_10263 !== target)) {
            _t10265 = Array$set(code, i_10244, ({_tag: 39, _name: "JUMP_IF_TRUE", _val: final_target_10263}));
          } else {
            _t10265 = undefined;
          }
          const _t10264 = _t10265;
          _t10250 = _t10264;
          break _t10251;
        }
        if (_t10249._tag === 81) {
          const min_tag = _t10249._val[0];
          const targets = _t10249._val[1];
          const default_target = _t10249._val[2];
          const changed_10266 = Ref$create(false);
          function _t10268(t) {
            const final_t_10269 = resolve_target_10229(t);
            let _t10271;
            if ((final_t_10269 !== t)) {
              _t10271 = Ref$set(changed_10266, true);
            } else {
              _t10271 = undefined;
            }
            _t10271;
            const _t10270 = final_t_10269;
            return _t10270;
          }
          const new_targets_10272 = Array$map(_t10268, targets);
          const new_default_10274 = resolve_target_10229(default_target);
          let _t10276;
          if ((new_default_10274 !== default_target)) {
            _t10276 = Ref$set(changed_10266, true);
          } else {
            _t10276 = undefined;
          }
          _t10276;
          let _t10277;
          if (Ref$get(changed_10266)) {
            _t10277 = Array$set(code, i_10244, ({_tag: 81, _name: "JUMP_TABLE", _val: [min_tag, new_targets_10272, new_default_10274]}));
          } else {
            _t10277 = undefined;
          }
          const _t10275 = _t10277;
          const _t10273 = _t10275;
          const _t10267 = _t10273;
          _t10250 = _t10267;
          break _t10251;
        }
        if (true) {
          _t10250 = undefined;
          break _t10251;
        }
        _match_fail("line 16629");
      }
      _t10250;
      (i_10244 = (i_10244 + 1), undefined);
      if (_t10247) break;
    }
    _t10246 = _t10247 ? _t10248 : undefined;
    const _t10245 = _t10246;
    const _t10236 = _t10245;
    const _t10234 = _t10236;
    const _t10232 = _t10234;
    const _t10230 = _t10232;
    _t10214 = _t10230;
  }
  const _t10213 = _t10214;
  return _t10213;
}
function Optimize$optimize_code(_constants, code, line_table) {
  const len_10278 = Array$length(code);
  let _t10280;
  if ((len_10278 === 0)) {
    _t10280 = [code, line_table];
  } else {
    const targets_10281 = Optimize$collect_jump_targets(code);
    const actions_10283 = Array$make(len_10278, ({_tag: 0, _name: "Keep"}));
    Optimize$mark_dead_after_tail_call(code, targets_10281, actions_10283);
    Optimize$mark_jump_to_next(code, actions_10283);
    Optimize$mark_dead_stores(code, targets_10281, actions_10283);
    Optimize$mark_set_get_pairs(code, targets_10281, actions_10283);
    Optimize$mark_jump_tables(code, targets_10281, actions_10283);
    Optimize$mark_push_pop(code, targets_10281, actions_10283);
    Optimize$mark_superinstructions(code, targets_10281, actions_10283);
    const any_changes_10285 = Ref$create(false);
    function _t10287(a) {
      let _t10288;
      if (!_eq(a, ({_tag: 0, _name: "Keep"}))) {
        _t10288 = Ref$set(any_changes_10285, true);
      } else {
        _t10288 = undefined;
      }
      return _t10288;
    }
    Array$iter(_t10287, actions_10283);
    let _t10289;
    if ((!Ref$get(any_changes_10285))) {
      _t10289 = [code, line_table];
    } else {
      let _t10291;
      const _t10290 = Optimize$rewrite(code, line_table, actions_10283);
      _t10292: {
        if (true) {
          const new_code = _t10290[0];
          const new_lines = _t10290[1];
          const offset_map = _t10290[2];
          Optimize$fixup_jumps(new_code, offset_map);
          _t10291 = [new_code, new_lines];
          break _t10292;
        }
        _match_fail("line 16629");
      }
      _t10289 = _t10291;
    }
    let _t10294;
    const _t10293 = _t10289;
    _t10295: {
      if (true) {
        const final_code = _t10293[0];
        const final_lines = _t10293[1];
        Optimize$thread_jumps(final_code);
        _t10294 = [final_code, final_lines];
        break _t10295;
      }
      _match_fail("line 16629");
    }
    const _t10286 = _t10294;
    const _t10284 = _t10286;
    const _t10282 = _t10284;
    _t10280 = _t10282;
  }
  const _t10279 = _t10280;
  return _t10279;
}
function Optimize$optimize_proto(proto) {
  function _t10296(v) {
    let _t10298;
    const _t10297 = v;
    _t10299: {
      if (_t10297._tag === 13) {
        const p = _t10297._val;
        _t10298 = ({_tag: 13, _name: "VProto", _val: Optimize$optimize_proto(p)});
        break _t10299;
      }
      if (true) {
        const other = _t10297;
        _t10298 = other;
        break _t10299;
      }
      _match_fail("line 16629");
    }
    return _t10298;
  }
  const new_constants_10300 = Array$map(_t10296, proto.constants);
  let _t10303;
  const _t10302 = Optimize$optimize_code(new_constants_10300, proto.code, proto.line_table);
  _t10304: {
    if (true) {
      const new_code = _t10302[0];
      const new_lines = _t10302[1];
      const __rec_upd_10305 = proto;
      const _t10306 = ({arity: __rec_upd_10305.arity, code: new_code, constants: new_constants_10300, line_table: new_lines, name: __rec_upd_10305.name, num_locals: __rec_upd_10305.num_locals});
      _t10303 = _t10306;
      break _t10304;
    }
    _match_fail("line 16629");
  }
  const _t10301 = _t10303;
  return _t10301;
}
const Compiler$optimize_enabled = Ref$create(true);
function Compiler$error(msg) {
  return _trampoline(function() {
    return _h["compile_error"](msg, function(_t10307) {
      return _bounce(function() {
        return _t10307;
      });
    });
  }, Compiler$error);
}
function Compiler$create_state(enclosing, arity, global_names, mutable_globals, type_env, name) {
  return ({arity: arity, code: Dynarray$empty(undefined), constants: Dynarray$empty(undefined), current_line: 0, enclosing: enclosing, global_names: global_names, lines: Dynarray$empty(undefined), locals: null, loop_start: ({_tag: 0, _name: "None"}), max_locals: 0, mutable_globals: mutable_globals, mutable_locals: null, num_locals: 0, operand_depth: 0, proto_name: name, scope_depth: 0, type_env: type_env, upvalues: null});
}
function Compiler$emit(__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, op) {
  Dynarray$push(s.code, op);
  return Dynarray$push(s.lines, s.current_line);
}
function Compiler$emit_idx(__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, op) {
  const idx_10308 = Dynarray$length(s.code);
  Dynarray$push(s.code, op);
  Dynarray$push(s.lines, s.current_line);
  const _t10309 = idx_10308;
  return _t10309;
}
function Compiler$patch(__ev_code_r0, s, idx, op) {
  return Dynarray$set(s.code, idx, op);
}
function Compiler$current_offset(__ev_code_r0, s) {
  return Dynarray$length(s.code);
}
function Compiler$add_constant(__ev_constants_r0, s, v) {
  const len_10310 = Dynarray$length(s.constants);
  function find(i) {
    while (true) {
      let _t10312;
      if ((i >= len_10310)) {
        Dynarray$push(s.constants, v);
        _t10312 = len_10310;
      } else {
        let _t10313;
        if (_eq(Dynarray$get(s.constants, i), v)) {
          _t10313 = i;
        } else {
          const _t10314 = (i + 1);
          i = _t10314;
          continue;
          _t10313 = undefined;
        }
        _t10312 = _t10313;
      }
      return _t10312;
    }
  }
  const _t10315 = find(0);
  const _t10311 = _t10315;
  return _t10311;
}
function Compiler$emit_constant(__ev_code_r0, __ev_constants_r0, __ev_current_line_r0, __ev_lines_r0, s, v) {
  const idx_10316 = _call(Compiler$add_constant, [__ev_constants_r0, s, v]);
  const _t10317 = _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 0, _name: "CONST", _val: idx_10316})]);
  return _t10317;
}
function Compiler$allocate_local(__ev_locals_r0, __ev_max_locals_r0, __ev_num_locals_r0, __ev_scope_depth_r0, s, name) {
  const slot_10318 = s.num_locals;
  (s.locals = ({_hd: ({depth: s.scope_depth, name: name, slot: slot_10318}), _tl: s.locals}), undefined);
  (s.num_locals = (s.num_locals + 1), undefined);
  let _t10320;
  if ((s.num_locals > s.max_locals)) {
    _t10320 = (s.max_locals = s.num_locals, undefined);
  } else {
    _t10320 = undefined;
  }
  _t10320;
  const _t10319 = slot_10318;
  return _t10319;
}
function Compiler$free_local(s) {
  let _t10322;
  const _t10321 = s.locals;
  _t10323: {
    if (_t10321 === null) {
      _t10322 = Compiler$error("no locals to free");
      break _t10323;
    }
    if (_t10321 !== null) {
      const rest = _t10321._tl;
      (s.locals = rest, undefined);
      _t10322 = (s.num_locals = (s.num_locals - 1), undefined);
      break _t10323;
    }
    _match_fail("line 16629");
  }
  return _t10322;
}
function Compiler$find_local(s, name) {
  function search(__ev_name_r0, __ev_slot_r0, __x) {
    while (true) {
      let _t10325;
      const _t10324 = __x;
      _t10326: {
        if (_t10324 === null) {
          _t10325 = ({_tag: 0, _name: "None"});
          break _t10326;
        }
        if (_t10324 !== null) {
          const local = _t10324._hd;
          if ((local.name === name)) {
            _t10325 = ({_tag: 1, _name: "Some", _val: local.slot});
            break _t10326;
          }
        }
        if (_t10324 !== null) {
          const rest = _t10324._tl;
          const _t10327 = __ev_name_r0;
          const _t10328 = __ev_slot_r0;
          const _t10329 = rest;
          __ev_name_r0 = _t10327;
          __ev_slot_r0 = _t10328;
          __x = _t10329;
          continue;
          _t10325 = undefined;
          break _t10326;
        }
        _match_fail("line 16629");
      }
      return _t10325;
    }
  }
  const _t10330 = _call(search, [1, 2, s.locals]);
  return _t10330;
}
function Compiler$remove_first_occurrence(name, __x) {
  let _t10332;
  const _t10331 = __x;
  _t10333: {
    if (_t10331 === null) {
      _t10332 = null;
      break _t10333;
    }
    if (_t10331 !== null) {
      const x = _t10331._hd;
      const rest = _t10331._tl;
      if (_eq(x, name)) {
        _t10332 = rest;
        break _t10333;
      }
    }
    if (_t10331 !== null) {
      const x = _t10331._hd;
      const rest = _t10331._tl;
      _t10332 = ({_hd: x, _tl: Compiler$remove_first_occurrence(name, rest)});
      break _t10333;
    }
    _match_fail("line 16629");
  }
  return _t10332;
}
function Compiler$is_mutable_local(s, name) {
  while (true) {
    let _t10334;
    if (List$mem(name, s.mutable_locals)) {
      _t10334 = true;
    } else {
      let _t10336;
      const _t10335 = s.enclosing;
      _t10337: {
        if (_t10335._tag === 1) {
          const enc = _t10335._val;
          const _t10338 = enc;
          const _t10339 = name;
          s = _t10338;
          name = _t10339;
          continue;
          _t10336 = undefined;
          break _t10337;
        }
        if (_t10335._tag === 0) {
          _t10336 = false;
          break _t10337;
        }
        _match_fail("line 16629");
      }
      _t10334 = _t10336;
    }
    return _t10334;
  }
}
function Compiler$is_mutable_global(s, name) {
  return _call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
}
function Compiler$add_upvalue(__ev_upvalues_r0, s, capture, name) {
  function find(i, __x) {
    while (true) {
      let _t10341;
      const _t10340 = __x;
      _t10342: {
        if (_t10340 === null) {
          (s.upvalues = List$concat(s.upvalues, ({_hd: ({capture: capture, uv_name: name}), _tl: null})), undefined);
          _t10341 = (List$length(s.upvalues) - 1);
          break _t10342;
        }
        if (_t10340 !== null) {
          const uv = _t10340._hd;
          if (((uv.uv_name === name) && _eq(uv.capture, capture))) {
            _t10341 = i;
            break _t10342;
          }
        }
        if (_t10340 !== null) {
          const rest = _t10340._tl;
          const _t10343 = (i + 1);
          const _t10344 = rest;
          i = _t10343;
          __x = _t10344;
          continue;
          _t10341 = undefined;
          break _t10342;
        }
        _match_fail("line 16629");
      }
      return _t10341;
    }
  }
  const _t10345 = find(0, s.upvalues);
  return _t10345;
}
function Compiler$resolve_upvalue(s, name) {
  let _t10347;
  const _t10346 = s.enclosing;
  _t10348: {
    if (_t10346._tag === 0) {
      _t10347 = ({_tag: 0, _name: "None"});
      break _t10348;
    }
    if (_t10346._tag === 1) {
      const enc = _t10346._val;
      let _t10350;
      const _t10349 = Compiler$find_local(enc, name);
      _t10351: {
        if (_t10349._tag === 1) {
          const slot = _t10349._val;
          const idx_10352 = _call(Compiler$add_upvalue, [17, s, ({_tag: 0, _name: "CaptureLocal", _val: slot}), name]);
          const _t10353 = ({_tag: 1, _name: "Some", _val: idx_10352});
          _t10350 = _t10353;
          break _t10351;
        }
        if (_t10349._tag === 0) {
          let _t10355;
          const _t10354 = Compiler$resolve_upvalue(enc, name);
          _t10356: {
            if (_t10354._tag === 1) {
              const enc_uv_idx = _t10354._val;
              const idx_10357 = _call(Compiler$add_upvalue, [17, s, ({_tag: 1, _name: "CaptureUpvalue", _val: enc_uv_idx}), name]);
              const _t10358 = ({_tag: 1, _name: "Some", _val: idx_10357});
              _t10355 = _t10358;
              break _t10356;
            }
            if (_t10354._tag === 0) {
              _t10355 = ({_tag: 0, _name: "None"});
              break _t10356;
            }
            _match_fail("line 16629");
          }
          _t10350 = _t10355;
          break _t10351;
        }
        _match_fail("line 16629");
      }
      _t10347 = _t10350;
      break _t10348;
    }
    _match_fail("line 16629");
  }
  return _t10347;
}
function Compiler$find_global(__ev_global_names_r0, s, name) {
  const len_10359 = Dynarray$length(s.global_names);
  function find(i) {
    while (true) {
      let _t10361;
      if ((i >= len_10359)) {
        _t10361 = ({_tag: 0, _name: "None"});
      } else {
        let _t10362;
        if (_eq(Dynarray$get(s.global_names, i), name)) {
          _t10362 = ({_tag: 1, _name: "Some", _val: i});
        } else {
          const _t10363 = (i + 1);
          i = _t10363;
          continue;
          _t10362 = undefined;
        }
        _t10361 = _t10362;
      }
      return _t10361;
    }
  }
  const _t10364 = find(0);
  const _t10360 = _t10364;
  return _t10360;
}
function Compiler$find_or_add_global(__ev_global_names_r0, s, name) {
  let _t10366;
  const _t10365 = _call(Compiler$find_global, [__ev_global_names_r0, s, name]);
  _t10367: {
    if (_t10365._tag === 1) {
      const i = _t10365._val;
      _t10366 = i;
      break _t10367;
    }
    if (_t10365._tag === 0) {
      const len_10368 = Dynarray$length(s.global_names);
      Dynarray$push(s.global_names, name);
      const _t10369 = len_10368;
      _t10366 = _t10369;
      break _t10367;
    }
    _match_fail("line 16629");
  }
  return _t10366;
}
function Compiler$tag_for_constructor(type_env, name) {
  let _t10371;
  const _t10370 = List$assoc_opt(name, type_env.constructors);
  _t10372: {
    if (_t10370._tag === 0) {
      _t10371 = Compiler$error(("unknown constructor: " + __dict_Show_string.show(name)));
      break _t10372;
    }
    if (_t10370._tag === 1) {
      const info = _t10370._val;
      function _t10373(__p371) {
        let _t10375;
        const _t10374 = __p371;
        _t10376: {
          if (true) {
            const n = _t10374[0];
            _t10375 = (n === info.ctor_type_name);
            break _t10376;
          }
          _match_fail("line 16629");
        }
        return _t10375;
      }
      let _t10378;
      const _t10377 = list_find(_t10373, type_env.variants);
      _t10379: {
        if (true) {
          const variant_def = _t10377[2];
          let _t10381;
          const _t10380 = String$rindex_opt(name, 46);
          _t10382: {
            if (_t10380._tag === 1) {
              const i = _t10380._val;
              _t10381 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
              break _t10382;
            }
            if (_t10380._tag === 0) {
              _t10381 = name;
              break _t10382;
            }
            _match_fail("line 16629");
          }
          const short_name_10383 = _t10381;
          function find_tag(i, __x) {
            while (true) {
              let _t10386;
              const _t10385 = __x;
              _t10387: {
                if (_t10385 === null) {
                  _t10386 = Compiler$error((("constructor " + __dict_Show_string.show(name)) + " not found in type"));
                  break _t10387;
                }
                if (_t10385 !== null) {
                  const cname = _t10385._hd[0];
                  if ((cname === short_name_10383)) {
                    _t10386 = i;
                    break _t10387;
                  }
                }
                if (_t10385 !== null) {
                  const rest = _t10385._tl;
                  const _t10388 = (i + 1);
                  const _t10389 = rest;
                  i = _t10388;
                  __x = _t10389;
                  continue;
                  _t10386 = undefined;
                  break _t10387;
                }
                _match_fail("line 16629");
              }
              return _t10386;
            }
          }
          const _t10390 = find_tag(0, variant_def);
          const _t10384 = _t10390;
          _t10378 = _t10384;
          break _t10379;
        }
        _match_fail("line 16629");
      }
      _t10371 = _t10378;
      break _t10372;
    }
    _match_fail("line 16629");
  }
  return _t10371;
}
function Compiler$is_newtype_ctor(type_env, name) {
  let _t10392;
  const _t10391 = List$assoc_opt(name, type_env.constructors);
  _t10393: {
    if (_t10391._tag === 1) {
      const info = _t10391._val;
      _t10392 = List$mem(info.ctor_type_name, type_env.newtypes);
      break _t10393;
    }
    if (_t10391._tag === 0) {
      _t10392 = false;
      break _t10393;
    }
    _match_fail("line 16629");
  }
  return _t10392;
}
function Compiler$extract_class_ty_args(num_params, schema_ty, resolved_ty) {
  const found_10394 = Hashtbl$create(num_params);
  function go(schema_ty, resolved_ty) {
    while (true) {
      const resolved_ty_10396 = Types$repr(resolved_ty);
      let _t10399;
      const _t10398 = [schema_ty, resolved_ty_10396];
      _t10400: {
        if (_t10398[0]._tag === 16) {
          const i = _t10398[0]._val;
          const ty = _t10398[1];
          if ((i < num_params)) {
            let _t10401;
            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, found_10394, i]))) {
              _t10401 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_10394, i, ty]);
            } else {
              _t10401 = undefined;
            }
            _t10399 = _t10401;
            break _t10400;
          }
        }
        if ((_t10398[0]._tag === 7 && _t10398[1]._tag === 7 || _t10398[0]._tag === 8 && _t10398[1]._tag === 8)) {
          const s_a = _t10398[0]._val[0];
          const s_r = _t10398[0]._val[2];
          const r_a = _t10398[1]._val[0];
          const r_r = _t10398[1]._val[2];
          go(s_a, r_a);
          const _t10402 = s_r;
          const _t10403 = r_r;
          schema_ty = _t10402;
          resolved_ty = _t10403;
          continue;
          _t10399 = undefined;
          break _t10400;
        }
        if (_t10398[0]._tag === 9 && _t10398[1]._tag === 9) {
          const ss = _t10398[0]._val;
          const rs = _t10398[1]._val;
          if ((List$length(ss) === List$length(rs))) {
            _t10399 = List$iter2(go, ss, rs);
            break _t10400;
          }
        }
        if (_t10398[0]._tag === 10 && _t10398[1]._tag === 10) {
          const s = _t10398[0]._val;
          const r = _t10398[1]._val;
          const _t10404 = s;
          const _t10405 = r;
          schema_ty = _t10404;
          resolved_ty = _t10405;
          continue;
          _t10399 = undefined;
          break _t10400;
        }
        if (true) {
          _t10399 = undefined;
          break _t10400;
        }
        _match_fail("line 16629");
      }
      const _t10397 = _t10399;
      return _t10397;
    }
  }
  go(schema_ty, resolved_ty);
  function _t10407(i) {
    return _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_10394, i]);
  }
  const _t10406 = List$init(num_params, _t10407);
  const _t10395 = _t10406;
  return _t10395;
}
function Compiler$emit_builtin_call1(__ev_code_r0, __ev_current_line_r0, __ev_global_names_r0, __ev_lines_r0, s, name) {
  const gidx_10408 = _call(Compiler$find_or_add_global, [__ev_global_names_r0, s, name]);
  _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10408})]);
  const _t10409 = _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 42, _name: "CALL", _val: 1})]);
  return _t10409;
}
function Compiler$emit_builtin_call2(__ev_code_r0, __ev_current_line_r0, __ev_global_names_r0, __ev_lines_r0, s, name) {
  const gidx_10410 = _call(Compiler$find_or_add_global, [__ev_global_names_r0, s, name]);
  const _t10411 = _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10410})]);
  return _t10411;
}
function Compiler$compile_expr(tail, s, te) {
  let _t10412;
  if ((te.loc.line > 0)) {
    _t10412 = (s.current_line = te.loc.line, undefined);
  } else {
    _t10412 = undefined;
  }
  _t10412;
  let _t10414;
  const _t10413 = te.expr;
  _t10415: {
    if (_t10413._tag === 0) {
      const n = _t10413._val;
      _t10414 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: n})]);
      break _t10415;
    }
    if (_t10413._tag === 1) {
      const f = _t10413._val;
      _t10414 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 1, _name: "VFloat", _val: f})]);
      break _t10415;
    }
    if (_t10413._tag === 2) {
      const b = _t10413._val;
      _t10414 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 2, _name: "VBool", _val: b})]);
      break _t10415;
    }
    if (_t10413._tag === 3) {
      const str = _t10413._val;
      _t10414 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: str})]);
      break _t10415;
    }
    if (_t10413._tag === 4) {
      const n = _t10413._val;
      _t10414 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 4, _name: "VByte", _val: n})]);
      break _t10415;
    }
    if (_t10413._tag === 5) {
      const n = _t10413._val;
      _t10414 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 5, _name: "VRune", _val: n})]);
      break _t10415;
    }
    if (_t10413._tag === 6) {
      _t10414 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
      break _t10415;
    }
    if (_t10413._tag === 22) {
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 57, _name: "NIL"})]);
      break _t10415;
    }
    if (_t10413._tag === 7) {
      const name = _t10413._val;
      let _t10416;
      if ((_eq(Compiler$find_local(s, name), ({_tag: 0, _name: "None"})) && (_eq(Compiler$resolve_upvalue(s, name), ({_tag: 0, _name: "None"})) && _eq(_call(Compiler$find_global, [5, s, name]), ({_tag: 0, _name: "None"}))))) {
        let _t10418;
        const _t10417 = Types$find_method_class(s.type_env.classes, name);
        _t10419: {
          if (_t10417._tag === 1) {
            const result = _t10417;
            _t10418 = [result, name];
            break _t10419;
          }
          if (_t10417._tag === 0) {
            let _t10421;
            const _t10420 = String$rindex_opt(name, 46);
            _t10422: {
              if (_t10420._tag === 0) {
                _t10421 = [({_tag: 0, _name: "None"}), name];
                break _t10422;
              }
              if (_t10420._tag === 1) {
                const i = _t10420._val;
                const mod_prefix_10423 = String$sub(name, 0, (i + 1));
                const _mml$short_10425 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                const class_prefix_10427 = String$sub(name, 0, i);
                let _t10430;
                const _t10429 = Types$find_method_class(s.type_env.classes, _mml$short_10425);
                _t10431: {
                  if (_t10429._tag === 1) {
                    const class_def = _t10429._val;
                    if ((class_def.class_name === class_prefix_10427)) {
                      _t10430 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_10425];
                      break _t10431;
                    }
                  }
                  if (_t10429._tag === 1) {
                    const class_def = _t10429._val;
                    if (((String$length(class_def.class_name) > String$length(mod_prefix_10423)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_10423)) === mod_prefix_10423))) {
                      _t10430 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_10425];
                      break _t10431;
                    }
                  }
                  if (true) {
                    _t10430 = [({_tag: 0, _name: "None"}), name];
                    break _t10431;
                  }
                  _match_fail("line 16629");
                }
                const _t10428 = _t10430;
                const _t10426 = _t10428;
                const _t10424 = _t10426;
                _t10421 = _t10424;
                break _t10422;
              }
              _match_fail("line 16629");
            }
            _t10418 = _t10421;
            break _t10419;
          }
          _match_fail("line 16629");
        }
        let _t10433;
        const _t10432 = _t10418;
        _t10434: {
          if (true) {
            const class_opt = _t10432[0];
            const method_name = _t10432[1];
            let _t10436;
            const _t10435 = class_opt;
            _t10437: {
              if (_t10435._tag === 1) {
                const class_def = _t10435._val;
                const method_schema_ty_10438 = List$assoc(method_name, class_def.class_methods);
                const num_params_10440 = List$length(class_def.class_params);
                const partial_10442 = Compiler$extract_class_ty_args(num_params_10440, method_schema_ty_10438, te.ty);
                function _t10444(opt) {
                  let _t10446;
                  const _t10445 = opt;
                  _t10447: {
                    if (_t10445._tag === 1) {
                      const ty = _t10445._val;
                      let _t10449;
                      const _t10448 = Types$repr(ty);
                      _t10450: {
                        if (_t10448._tag === 15 && _t10448._val.contents._tag === 0) {
                          _t10449 = ({_tag: 0, _name: "None"});
                          break _t10450;
                        }
                        if (true) {
                          _t10449 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
                          break _t10450;
                        }
                        _match_fail("line 16629");
                      }
                      _t10446 = _t10449;
                      break _t10447;
                    }
                    if (_t10445._tag === 0) {
                      _t10446 = ({_tag: 0, _name: "None"});
                      break _t10447;
                    }
                    _match_fail("line 16629");
                  }
                  return _t10446;
                }
                const concrete_partial_10451 = List$map(_t10444, partial_10442);
                let _t10453;
                if (!_eq(class_def.class_fundeps, null)) {
                  _t10453 = Types$improve_with_fundeps(s.type_env.instances, class_def, concrete_partial_10451);
                } else {
                  _t10453 = concrete_partial_10451;
                }
                const concrete_partial_10454 = _t10453;
                function _t10456(inst) {
                  return ((inst.inst_class === class_def.class_name) && ((List$length(inst.inst_tys) === num_params_10440) && Types$match_partial_inst(inst.inst_tys, concrete_partial_10454)));
                }
                const matching_10457 = List$filter(_t10456, s.type_env.instances);
                let _t10460;
                const _t10459 = matching_10457;
                _t10461: {
                  if (_t10459 !== null && _t10459._tl === null) {
                    const inst = _t10459._hd;
                    let _t10462;
                    if (_eq(inst.inst_constraints, null)) {
                      const method_gidx_10463 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
                      const _t10464 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10463})]);
                      _t10462 = _t10464;
                    } else {
                      const dict_gidx_10465 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
                      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10465})]);
                      const _t10466 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
                      _t10462 = _t10466;
                    }
                    _t10460 = _t10462;
                    break _t10461;
                  }
                  if (_t10459 === null) {
                    function _t10467(__x) {
                      let _t10469;
                      const _t10468 = __x;
                      _t10470: {
                        if (_t10468._tag === 1) {
                          const ty = _t10468._val;
                          let _t10472;
                          const _t10471 = Types$repr(ty);
                          _t10473: {
                            if ((_t10471._tag === 14 || _t10471._tag === 11)) {
                              _t10472 = true;
                              break _t10473;
                            }
                            if (true) {
                              _t10472 = false;
                              break _t10473;
                            }
                            _match_fail("line 16629");
                          }
                          _t10469 = _t10472;
                          break _t10470;
                        }
                        if (_t10468._tag === 0) {
                          _t10469 = false;
                          break _t10470;
                        }
                        _match_fail("line 16629");
                      }
                      return _t10469;
                    }
                    const is_structural_10474 = List$exists(_t10467, partial_10442);
                    let _t10476;
                    if ((is_structural_10474 && ((class_def.class_name === "Show") && (method_name === "show")))) {
                      const gidx_10477 = _call(Compiler$find_or_add_global, [5, s, "__show_value"]);
                      const _t10478 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10477})]);
                      _t10476 = _t10478;
                    } else {
                      function _t10479(__x) {
                        let _t10481;
                        const _t10480 = __x;
                        _t10482: {
                          if (_t10480._tag === 1) {
                            const ty = _t10480._val;
                            _t10481 = Types$pp_ty(ty);
                            break _t10482;
                          }
                          if (_t10480._tag === 0) {
                            _t10481 = "_";
                            break _t10482;
                          }
                          _match_fail("line 16629");
                        }
                        return _t10481;
                      }
                      const ty_strs_10483 = List$map(_t10479, partial_10442);
                      const _t10484 = Compiler$error(((("no instance of " + __dict_Show_string.show(class_def.class_name)) + " for types ") + __dict_Show_string.show(String$concat(", ", ty_strs_10483))));
                      _t10476 = _t10484;
                    }
                    const _t10475 = _t10476;
                    _t10460 = _t10475;
                    break _t10461;
                  }
                  if (true) {
                    let _t10486;
                    const _t10485 = Types$most_specific_inst(matching_10457);
                    _t10487: {
                      if (_t10485._tag === 1) {
                        const inst = _t10485._val;
                        let _t10488;
                        if (_eq(inst.inst_constraints, null)) {
                          const method_gidx_10489 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
                          const _t10490 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10489})]);
                          _t10488 = _t10490;
                        } else {
                          const dict_gidx_10491 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
                          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10491})]);
                          const _t10492 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
                          _t10488 = _t10492;
                        }
                        _t10486 = _t10488;
                        break _t10487;
                      }
                      if (_t10485._tag === 0) {
                        _t10486 = Compiler$error(((("ambiguous instance for " + __dict_Show_string.show(class_def.class_name)) + " method ") + __dict_Show_string.show(method_name)));
                        break _t10487;
                      }
                      _match_fail("line 16629");
                    }
                    _t10460 = _t10486;
                    break _t10461;
                  }
                  _match_fail("line 16629");
                }
                const _t10458 = _t10460;
                const _t10455 = _t10458;
                const _t10452 = _t10455;
                const _t10443 = _t10452;
                const _t10441 = _t10443;
                const _t10439 = _t10441;
                _t10436 = _t10439;
                break _t10437;
              }
              if (_t10435._tag === 0) {
                _t10436 = Compiler$compile_var_access(s, name);
                break _t10437;
              }
              _match_fail("line 16629");
            }
            _t10433 = _t10436;
            break _t10434;
          }
          _match_fail("line 16629");
        }
        _t10416 = _t10433;
      } else {
        _t10416 = Compiler$compile_var_access(s, name);
      }
      _t10414 = _t10416;
      break _t10415;
    }
    if (_t10413._tag === 13) {
      const op = _t10413._val[0];
      const e1 = _t10413._val[1];
      const e2 = _t10413._val[2];
      _t10414 = Compiler$compile_binop(s, op, e1, e2);
      break _t10415;
    }
    if (_t10413._tag === 14) {
      const op = _t10413._val[0];
      const e = _t10413._val[1];
      _t10414 = Compiler$compile_unop(s, op, e);
      break _t10415;
    }
    if (_t10413._tag === 11) {
      const fn_ = _t10413._val[0];
      const arg = _t10413._val[1];
      function collect_args(expr, acc) {
        while (true) {
          let _t10494;
          const _t10493 = expr.expr;
          _t10495: {
            if (_t10493._tag === 11) {
              const inner_fn = _t10493._val[0];
              const inner_arg = _t10493._val[1];
              const _t10496 = inner_fn;
              const _t10497 = ({_hd: inner_arg, _tl: acc});
              expr = _t10496;
              acc = _t10497;
              continue;
              _t10494 = undefined;
              break _t10495;
            }
            if (true) {
              _t10494 = [expr, acc];
              break _t10495;
            }
            _match_fail("line 16629");
          }
          return _t10494;
        }
      }
      let _t10500;
      const _t10499 = collect_args(fn_, ({_hd: arg, _tl: null}));
      _t10501: {
        if (true) {
          const base_fn = _t10499[0];
          const all_args = _t10499[1];
          const n_10502 = List$length(all_args);
          Compiler$compile_expr(false, s, base_fn);
          function _t10504(a) {
            return Compiler$compile_expr(false, s, a);
          }
          List$iter(_t10504, all_args);
          let _t10505;
          if ((n_10502 > 1)) {
            let _t10506;
            if (tail) {
              _t10506 = ({_tag: 83, _name: "TAIL_CALL_N", _val: n_10502});
            } else {
              _t10506 = ({_tag: 82, _name: "CALL_N", _val: n_10502});
            }
            _t10505 = _call(Compiler$emit, [1, 3, 6, s, _t10506]);
          } else {
            let _t10507;
            if (tail) {
              _t10507 = ({_tag: 43, _name: "TAIL_CALL", _val: 1});
            } else {
              _t10507 = ({_tag: 42, _name: "CALL", _val: 1});
            }
            _t10505 = _call(Compiler$emit, [1, 3, 6, s, _t10507]);
          }
          const _t10503 = _t10505;
          _t10500 = _t10503;
          break _t10501;
        }
        _match_fail("line 16629");
      }
      const _t10498 = _t10500;
      _t10414 = _t10498;
      break _t10415;
    }
    if (_t10413._tag === 10) {
      const param = _t10413._val[0];
      const body = _t10413._val[1];
      const has_return = _t10413._val[2];
      _t10414 = Compiler$compile_function(has_return, s, param, body, te.ty);
      break _t10415;
    }
    if (_t10413._tag === 8) {
      const name = _t10413._val[0];
      const _scheme = _t10413._val[1];
      const e1 = _t10413._val[2];
      const e2 = _t10413._val[3];
      Compiler$compile_expr(false, s, e1);
      const was_mutable_10508 = List$mem(name, s.mutable_locals);
      let _t10510;
      if (was_mutable_10508) {
        function _t10511(n) {
          return (n !== name);
        }
        _t10510 = (s.mutable_locals = List$filter(_t10511, s.mutable_locals), undefined);
      } else {
        _t10510 = undefined;
      }
      _t10510;
      const slot_10512 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10512})]);
      Compiler$compile_expr(tail, s, e2);
      let _t10514;
      if (was_mutable_10508) {
        _t10514 = (s.mutable_locals = ({_hd: name, _tl: s.mutable_locals}), undefined);
      } else {
        _t10514 = undefined;
      }
      _t10514;
      const _t10513 = Compiler$free_local(s);
      const _t10509 = _t10513;
      _t10414 = _t10509;
      break _t10415;
    }
    if (_t10413._tag === 25) {
      const name = _t10413._val[0];
      const e1 = _t10413._val[1];
      const e2 = _t10413._val[2];
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 7, _name: "MAKE_REF"})]);
      const slot_10515 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
      (s.mutable_locals = ({_hd: name, _tl: s.mutable_locals}), undefined);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10515})]);
      Compiler$compile_expr(tail, s, e2);
      (s.mutable_locals = Compiler$remove_first_occurrence(name, s.mutable_locals), undefined);
      const _t10516 = Compiler$free_local(s);
      _t10414 = _t10516;
      break _t10415;
    }
    if (_t10413._tag === 32) {
      const cond = _t10413._val[0];
      const body = _t10413._val[1];
      const enter_idx_10517 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 68, _name: "ENTER_LOOP", _val: 0})]);
      const prev_loop_start_10519 = s.loop_start;
      const loop_start_10521 = _call(Compiler$current_offset, [1, s]);
      (s.loop_start = ({_tag: 1, _name: "Some", _val: loop_start_10521}), undefined);
      Compiler$compile_expr(false, s, cond);
      const exit_jump_10523 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]);
      Compiler$compile_expr(false, s, body);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: loop_start_10521})]);
      const exit_normal_10525 = _call(Compiler$current_offset, [1, s]);
      _call(Compiler$patch, [1, s, exit_jump_10523, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: exit_normal_10525})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 69, _name: "EXIT_LOOP"})]);
      const unit_idx_10527 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10527})]);
      const end_jump_10529 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
      const break_target_10531 = _call(Compiler$current_offset, [1, s]);
      const end_target_10533 = _call(Compiler$current_offset, [1, s]);
      _call(Compiler$patch, [1, s, enter_idx_10517, ({_tag: 68, _name: "ENTER_LOOP", _val: break_target_10531})]);
      _call(Compiler$patch, [1, s, end_jump_10529, ({_tag: 37, _name: "JUMP", _val: end_target_10533})]);
      const _t10534 = (s.loop_start = prev_loop_start_10519, undefined);
      const _t10532 = _t10534;
      const _t10530 = _t10532;
      const _t10528 = _t10530;
      const _t10526 = _t10528;
      const _t10524 = _t10526;
      const _t10522 = _t10524;
      const _t10520 = _t10522;
      const _t10518 = _t10520;
      _t10414 = _t10518;
      break _t10415;
    }
    if (_t10413._tag === 26) {
      const name = _t10413._val[0];
      const e = _t10413._val[1];
      let _t10536;
      const _t10535 = Compiler$find_local(s, name);
      _t10537: {
        if (_t10535._tag === 1) {
          const slot = _t10535._val;
          Compiler$compile_expr(false, s, e);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
          _t10536 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
          break _t10537;
        }
        if (_t10535._tag === 0) {
          let _t10539;
          const _t10538 = Compiler$resolve_upvalue(s, name);
          _t10540: {
            if (_t10538._tag === 1) {
              const idx = _t10538._val;
              Compiler$compile_expr(false, s, e);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 5, _name: "GET_UPVALUE", _val: idx})]);
              _t10539 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
              break _t10540;
            }
            if (_t10538._tag === 0) {
              Compiler$compile_expr(false, s, e);
              const gidx_10541 = _call(Compiler$find_or_add_global, [5, s, name]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10541})]);
              const _t10542 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
              _t10539 = _t10542;
              break _t10540;
            }
            _match_fail("line 16629");
          }
          _t10536 = _t10539;
          break _t10537;
        }
        _match_fail("line 16629");
      }
      _t10536;
      _t10414 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
      break _t10415;
    }
    if (_t10413._tag === 27) {
      const record_e = _t10413._val[0];
      const field = _t10413._val[1];
      const value_e = _t10413._val[2];
      Compiler$compile_expr(false, s, record_e);
      Compiler$compile_expr(false, s, value_e);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 52, _name: "SET_FIELD", _val: field})]);
      _t10414 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
      break _t10415;
    }
    if (_t10413._tag === 9) {
      const name = _t10413._val[0];
      const _scheme = _t10413._val[1];
      const e1 = _t10413._val[2];
      const e2 = _t10413._val[3];
      Compiler$compile_let_rec(s, name, e1);
      Compiler$compile_expr(tail, s, e2);
      _t10414 = Compiler$free_local(s);
      break _t10415;
    }
    if (_t10413._tag === 12) {
      const cond = _t10413._val[0];
      const then_e = _t10413._val[1];
      const else_e = _t10413._val[2];
      _t10414 = Compiler$compile_if(tail, s, cond, then_e, else_e);
      break _t10415;
    }
    if (_t10413._tag === 15) {
      const exprs = _t10413._val;
      List$iter(_call(Compiler$compile_expr, [false, s]), exprs);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 48, _name: "MAKE_TUPLE", _val: List$length(exprs)})]);
      break _t10415;
    }
    if (_t10413._tag === 16) {
      const fields = _t10413._val;
      function _t10543(__p372, __p373) {
        let _t10545;
        const _t10544 = __p372;
        _t10546: {
          if (true) {
            const a = _t10544[0];
            let _t10548;
            const _t10547 = __p373;
            _t10549: {
              if (true) {
                const b = _t10547[0];
                _t10548 = String$compare(a, b);
                break _t10549;
              }
              _match_fail("line 16629");
            }
            _t10545 = _t10548;
            break _t10546;
          }
          _match_fail("line 16629");
        }
        return _t10545;
      }
      const sorted_10550 = List$sort(_t10543, fields);
      const names_10552 = List$map(fst, sorted_10550);
      function _t10554(__p374) {
        let _t10556;
        const _t10555 = __p374;
        _t10557: {
          if (true) {
            const e = _t10555[1];
            _t10556 = Compiler$compile_expr(false, s, e);
            break _t10557;
          }
          _match_fail("line 16629");
        }
        return _t10556;
      }
      List$iter(_t10554, sorted_10550);
      const _t10553 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 50, _name: "MAKE_RECORD", _val: names_10552})]);
      const _t10551 = _t10553;
      _t10414 = _t10551;
      break _t10415;
    }
    if (_t10413._tag === 17) {
      const base = _t10413._val[0];
      const overrides = _t10413._val[1];
      Compiler$compile_expr(false, s, base);
      function _t10558(__p375) {
        let _t10560;
        const _t10559 = __p375;
        _t10561: {
          if (true) {
            const e = _t10559[1];
            _t10560 = Compiler$compile_expr(false, s, e);
            break _t10561;
          }
          _match_fail("line 16629");
        }
        return _t10560;
      }
      List$iter(_t10558, overrides);
      const field_names_10562 = List$map(fst, overrides);
      const _t10563 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 53, _name: "RECORD_UPDATE", _val: field_names_10562})]);
      _t10414 = _t10563;
      break _t10415;
    }
    if (_t10413._tag === 18) {
      const base = _t10413._val[0];
      const pairs = _t10413._val[1];
      Compiler$compile_expr(false, s, base);
      function _t10564(__p376) {
        let _t10566;
        const _t10565 = __p376;
        _t10567: {
          if (true) {
            const idx_e = _t10565[0];
            const val_e = _t10565[1];
            Compiler$compile_expr(false, s, idx_e);
            _t10566 = Compiler$compile_expr(false, s, val_e);
            break _t10567;
          }
          _match_fail("line 16629");
        }
        return _t10566;
      }
      List$iter(_t10564, pairs);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 54, _name: "RECORD_UPDATE_DYN", _val: List$length(pairs)})]);
      break _t10415;
    }
    if (_t10413._tag === 19) {
      const e = _t10413._val[0];
      const field = _t10413._val[1];
      Compiler$compile_expr(false, s, e);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: field})]);
      break _t10415;
    }
    if (_t10413._tag === 20) {
      const base = _t10413._val[0];
      const idx = _t10413._val[1];
      Compiler$compile_expr(false, s, base);
      Compiler$compile_expr(false, s, idx);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 74, _name: "INDEX"})]);
      break _t10415;
    }
    if (_t10413._tag === 21) {
      const hd = _t10413._val[0];
      const tl = _t10413._val[1];
      Compiler$compile_expr(false, s, hd);
      Compiler$compile_expr(false, s, tl);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 56, _name: "CONS"})]);
      break _t10415;
    }
    if (_t10413._tag === 23) {
      const name = _t10413._val[0];
      const arg = _t10413._val[1];
      let _t10568;
      if (Compiler$is_newtype_ctor(s.type_env, name)) {
        let _t10570;
        const _t10569 = arg;
        _t10571: {
          if (_t10569._tag === 1) {
            const e = _t10569._val;
            _t10570 = Compiler$compile_expr(tail, s, e);
            break _t10571;
          }
          if (_t10569._tag === 0) {
            _t10570 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
            break _t10571;
          }
          _match_fail("line 16629");
        }
        _t10568 = _t10570;
      } else {
        let _t10572;
        if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
          _t10572 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
        } else {
          _t10572 = Compiler$tag_for_constructor(s.type_env, name);
        }
        const tag_10573 = _t10572;
        let _t10576;
        const _t10575 = String$rindex_opt(name, 46);
        _t10577: {
          if (_t10575._tag === 1) {
            const i = _t10575._val;
            _t10576 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
            break _t10577;
          }
          if (_t10575._tag === 0) {
            _t10576 = name;
            break _t10577;
          }
          _match_fail("line 16629");
        }
        const short_name_10578 = _t10576;
        let _t10581;
        const _t10580 = arg;
        _t10582: {
          if (_t10580._tag === 1) {
            const e = _t10580._val;
            Compiler$compile_expr(false, s, e);
            _t10581 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_10573, short_name_10578, true]})]);
            break _t10582;
          }
          if (_t10580._tag === 0) {
            _t10581 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_10573, short_name_10578, false]})]);
            break _t10582;
          }
          _match_fail("line 16629");
        }
        const _t10579 = _t10581;
        const _t10574 = _t10579;
        _t10568 = _t10574;
      }
      _t10414 = _t10568;
      break _t10415;
    }
    if (_t10413._tag === 24) {
      const scrut = _t10413._val[0];
      const arms = _t10413._val[1];
      const _partial = _t10413._val[2];
      _t10414 = Compiler$compile_match(tail, s, scrut, arms);
      break _t10415;
    }
    if (_t10413._tag === 28) {
      const e1 = _t10413._val[0];
      const e2 = _t10413._val[1];
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      _t10414 = Compiler$compile_expr(tail, s, e2);
      break _t10415;
    }
    if (_t10413._tag === 29) {
      const op_name = _t10413._val[0];
      const arg_te = _t10413._val[1];
      Compiler$compile_expr(false, s, arg_te);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 65, _name: "PERFORM", _val: op_name})]);
      break _t10415;
    }
    if (_t10413._tag === 30) {
      const body_te = _t10413._val[0];
      const arms = _t10413._val[1];
      _t10414 = Compiler$compile_handle(s, body_te, arms);
      break _t10415;
    }
    if (_t10413._tag === 31) {
      const k_te = _t10413._val[0];
      const v_te = _t10413._val[1];
      Compiler$compile_expr(false, s, k_te);
      Compiler$compile_expr(false, s, v_te);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 67, _name: "RESUME"})]);
      break _t10415;
    }
    if (_t10413._tag === 33) {
      const value_te = _t10413._val;
      Compiler$compile_expr(false, s, value_te);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 70, _name: "LOOP_BREAK"})]);
      break _t10415;
    }
    if (_t10413._tag === 34) {
      let _t10584;
      const _t10583 = s.loop_start;
      _t10585: {
        if (_t10583._tag === 1) {
          const target = _t10583._val;
          _t10584 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 71, _name: "LOOP_CONTINUE", _val: target})]);
          break _t10585;
        }
        if (_t10583._tag === 0) {
          _t10584 = Compiler$error("continue outside of loop");
          break _t10585;
        }
        _match_fail("line 16629");
      }
      _t10414 = _t10584;
      break _t10415;
    }
    if (_t10413._tag === 35) {
      const value_te = _t10413._val;
      const depth_before_10586 = s.operand_depth;
      Compiler$compile_expr(false, s, value_te);
      const n_pops_10588 = depth_before_10586;
      const _t10589 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 72, _name: "FOLD_CONTINUE", _val: n_pops_10588})]);
      const _t10587 = _t10589;
      _t10414 = _t10587;
      break _t10415;
    }
    if (_t10413._tag === 36) {
      const fold_te = _t10413._val;
      const enter_idx_10590 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 68, _name: "ENTER_LOOP", _val: 0})]);
      const prev_loop_start_10592 = s.loop_start;
      (s.loop_start = ({_tag: 0, _name: "None"}), undefined);
      Compiler$compile_expr(false, s, fold_te);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 69, _name: "EXIT_LOOP"})]);
      const end_jump_10594 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
      const break_target_10596 = _call(Compiler$current_offset, [1, s]);
      const end_target_10598 = _call(Compiler$current_offset, [1, s]);
      _call(Compiler$patch, [1, s, enter_idx_10590, ({_tag: 68, _name: "ENTER_LOOP", _val: break_target_10596})]);
      _call(Compiler$patch, [1, s, end_jump_10594, ({_tag: 37, _name: "JUMP", _val: end_target_10598})]);
      const _t10599 = (s.loop_start = prev_loop_start_10592, undefined);
      const _t10597 = _t10599;
      const _t10595 = _t10597;
      const _t10593 = _t10595;
      const _t10591 = _t10593;
      _t10414 = _t10591;
      break _t10415;
    }
    if (_t10413._tag === 38) {
      const elems = _t10413._val;
      List$iter(_call(Compiler$compile_expr, [false, s]), elems);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 73, _name: "MAKE_ARRAY", _val: List$length(elems)})]);
      break _t10415;
    }
    if (_t10413._tag === 39) {
      const value_te = _t10413._val;
      Compiler$compile_expr(false, s, value_te);
      _t10414 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 45, _name: "FUNC_RETURN"})]);
      break _t10415;
    }
    if (_t10413._tag === 37) {
      const bindings = _t10413._val[0];
      const body = _t10413._val[1];
      function _t10600(__p377) {
        let _t10602;
        const _t10601 = __p377;
        _t10603: {
          if (true) {
            const name = _t10601[0];
            const te = _t10601[1];
            let _t10605;
            const _t10604 = te.expr;
            _t10606: {
              if (_t10604._tag === 10) {
                _t10605 = true;
                break _t10606;
              }
              if (true) {
                _t10605 = false;
                break _t10606;
              }
              _match_fail("line 16629");
            }
            const is_fun_10607 = _t10605;
            const slot_10609 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
            let _t10611;
            if (is_fun_10607) {
              const unit_idx_10612 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10612})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 7, _name: "MAKE_REF"})]);
              (s.mutable_locals = ({_hd: name, _tl: s.mutable_locals}), undefined);
              const _t10613 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10609})]);
              _t10611 = _t10613;
            } else {
              Compiler$emit_rec_placeholder(s, te);
              _t10611 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10609})]);
            }
            _t10611;
            const _t10610 = [name, te, slot_10609, is_fun_10607];
            const _t10608 = _t10610;
            _t10602 = _t10608;
            break _t10603;
          }
          _match_fail("line 16629");
        }
        return _t10602;
      }
      const binding_info_10614 = List$map(_t10600, bindings);
      function _t10616(__p378) {
        let _t10618;
        const _t10617 = __p378;
        _t10619: {
          if (true) {
            const te = _t10617[1];
            const slot = _t10617[2];
            const is_fun = _t10617[3];
            Compiler$compile_expr(false, s, te);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
            let _t10620;
            if (is_fun) {
              _t10620 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
            } else {
              _t10620 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 84, _name: "UPDATE_REC"})]);
            }
            _t10618 = _t10620;
            break _t10619;
          }
          _match_fail("line 16629");
        }
        return _t10618;
      }
      List$iter(_t10616, binding_info_10614);
      Compiler$compile_expr(tail, s, body);
      function _t10621(__p379) {
        let _t10623;
        const _t10622 = __p379;
        _t10624: {
          if (true) {
            const name = _t10622[0];
            const is_fun = _t10622[3];
            let _t10625;
            if (is_fun) {
              function _t10626(n) {
                return (n !== name);
              }
              _t10625 = (s.mutable_locals = List$filter(_t10626, s.mutable_locals), undefined);
            } else {
              _t10625 = undefined;
            }
            _t10623 = _t10625;
            break _t10624;
          }
          _match_fail("line 16629");
        }
        return _t10623;
      }
      List$iter(_t10621, binding_info_10614);
      function _t10627(_) {
        return Compiler$free_local(s);
      }
      const _t10615 = List$iter(_t10627, bindings);
      _t10414 = _t10615;
      break _t10415;
    }
    _match_fail("line 16629");
  }
  return _t10414;
}
function Compiler$compile_var_access(s, name) {
  let _t10629;
  const _t10628 = Compiler$find_local(s, name);
  _t10630: {
    if (_t10628._tag === 1) {
      const slot = _t10628._val;
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
      let _t10631;
      if (Compiler$is_mutable_local(s, name)) {
        _t10631 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 8, _name: "DEREF"})]);
      } else {
        _t10631 = undefined;
      }
      _t10629 = _t10631;
      break _t10630;
    }
    if (_t10628._tag === 0) {
      let _t10633;
      const _t10632 = Compiler$resolve_upvalue(s, name);
      _t10634: {
        if (_t10632._tag === 1) {
          const idx = _t10632._val;
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 5, _name: "GET_UPVALUE", _val: idx})]);
          let _t10635;
          if (Compiler$is_mutable_local(s, name)) {
            _t10635 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 8, _name: "DEREF"})]);
          } else {
            _t10635 = undefined;
          }
          _t10633 = _t10635;
          break _t10634;
        }
        if (_t10632._tag === 0) {
          const gidx_10636 = _call(Compiler$find_or_add_global, [5, s, name]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10636})]);
          let _t10638;
          if (Compiler$is_mutable_global(s, name)) {
            _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 8, _name: "DEREF"})]);
          } else {
            _t10638 = undefined;
          }
          const _t10637 = _t10638;
          _t10633 = _t10637;
          break _t10634;
        }
        _match_fail("line 16629");
      }
      _t10629 = _t10633;
      break _t10630;
    }
    _match_fail("line 16629");
  }
  return _t10629;
}
function Compiler$compile_binop(s, op, e1, e2) {
  let _t10640;
  const _t10639 = op;
  _t10641: {
    if (_t10639._tag === 11) {
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 2, _name: "DUP"})]);
      const jump_idx_10642 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      Compiler$compile_expr(false, s, e2);
      const target_10644 = _call(Compiler$current_offset, [1, s]);
      const _t10645 = _call(Compiler$patch, [1, s, jump_idx_10642, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: target_10644})]);
      const _t10643 = _t10645;
      _t10640 = _t10643;
      break _t10641;
    }
    if (_t10639._tag === 12) {
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 2, _name: "DUP"})]);
      const jump_idx_10646 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 39, _name: "JUMP_IF_TRUE", _val: 0})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      Compiler$compile_expr(false, s, e2);
      const target_10648 = _call(Compiler$current_offset, [1, s]);
      const _t10649 = _call(Compiler$patch, [1, s, jump_idx_10646, ({_tag: 39, _name: "JUMP_IF_TRUE", _val: target_10648})]);
      const _t10647 = _t10649;
      _t10640 = _t10647;
      break _t10641;
    }
    if ((((_t10639._tag === 0 || _t10639._tag === 1) || _t10639._tag === 2) || _t10639._tag === 3)) {
      const resolved_10650 = Types$repr(e1.ty);
      let _t10653;
      const _t10652 = resolved_10650;
      _t10654: {
        if (_t10652._tag === 0) {
          Compiler$compile_expr(false, s, e1);
          Compiler$compile_expr(false, s, e2);
          let _t10656;
          const _t10655 = op;
          _t10657: {
            if (_t10655._tag === 0) {
              _t10656 = ({_tag: 13, _name: "ADD"});
              break _t10657;
            }
            if (_t10655._tag === 1) {
              _t10656 = ({_tag: 14, _name: "SUB"});
              break _t10657;
            }
            if (_t10655._tag === 2) {
              _t10656 = ({_tag: 15, _name: "MUL"});
              break _t10657;
            }
            if (_t10655._tag === 3) {
              _t10656 = ({_tag: 16, _name: "DIV"});
              break _t10657;
            }
            if (true) {
              _t10656 = failwith("assert false");
              break _t10657;
            }
            _match_fail("line 16629");
          }
          _t10653 = _call(Compiler$emit, [1, 3, 6, s, _t10656]);
          break _t10654;
        }
        if (_t10652._tag === 1) {
          Compiler$compile_expr(false, s, e1);
          Compiler$compile_expr(false, s, e2);
          let _t10659;
          const _t10658 = op;
          _t10660: {
            if (_t10658._tag === 0) {
              _t10659 = ({_tag: 19, _name: "FADD"});
              break _t10660;
            }
            if (_t10658._tag === 1) {
              _t10659 = ({_tag: 20, _name: "FSUB"});
              break _t10660;
            }
            if (_t10658._tag === 2) {
              _t10659 = ({_tag: 21, _name: "FMUL"});
              break _t10660;
            }
            if (_t10658._tag === 3) {
              _t10659 = ({_tag: 22, _name: "FDIV"});
              break _t10660;
            }
            if (true) {
              _t10659 = failwith("assert false");
              break _t10660;
            }
            _match_fail("line 16629");
          }
          _t10653 = _call(Compiler$emit, [1, 3, 6, s, _t10659]);
          break _t10654;
        }
        if (true) {
          let _t10662;
          const _t10661 = op;
          _t10663: {
            if (_t10661._tag === 0) {
              _t10662 = "+";
              break _t10663;
            }
            if (_t10661._tag === 1) {
              _t10662 = "-";
              break _t10663;
            }
            if (_t10661._tag === 2) {
              _t10662 = "*";
              break _t10663;
            }
            if (_t10661._tag === 3) {
              _t10662 = "/";
              break _t10663;
            }
            if (true) {
              _t10662 = failwith("assert false");
              break _t10663;
            }
            _match_fail("line 16629");
          }
          const method_name_10664 = _t10662;
          const _t10665 = Compiler$compile_class_binop(s, "Num", method_name_10664, e1.ty, e1, e2);
          _t10653 = _t10665;
          break _t10654;
        }
        _match_fail("line 16629");
      }
      const _t10651 = _t10653;
      _t10640 = _t10651;
      break _t10641;
    }
    if (_t10639._tag === 4) {
      Compiler$compile_expr(false, s, e1);
      Compiler$compile_expr(false, s, e2);
      _t10640 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 17, _name: "MOD"})]);
      break _t10641;
    }
    if ((_t10639._tag === 5 || _t10639._tag === 6)) {
      const resolved_10666 = Types$repr(e1.ty);
      function _t10668(class_name, ty) {
        function _t10669(inst) {
          return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === 1) && Types$match_partial_inst(inst.inst_tys, ({_hd: ({_tag: 1, _name: "Some", _val: ty}), _tl: null}))));
        }
        return List$exists(_t10669, s.type_env.instances);
      }
      const has_custom_instance_10670 = _t10668;
      let _t10673;
      const _t10672 = resolved_10666;
      _t10674: {
        if (((((((((((((_t10672._tag === 0 || _t10672._tag === 1) || _t10672._tag === 2) || _t10672._tag === 3) || _t10672._tag === 4) || _t10672._tag === 5) || _t10672._tag === 6) || _t10672._tag === 10) || _t10672._tag === 9) || _t10672._tag === 12) || _t10672._tag === 14) || _t10672._tag === 13) || _t10672._tag === 15 && _t10672._val.contents._tag === 0)) {
          _t10673 = true;
          break _t10674;
        }
        if (_t10672._tag === 11) {
          _t10673 = (!has_custom_instance_10670("Eq", resolved_10666));
          break _t10674;
        }
        if (true) {
          _t10673 = false;
          break _t10674;
        }
        _match_fail("line 16629");
      }
      const use_structural_10675 = _t10673;
      let _t10677;
      if (use_structural_10675) {
        Compiler$compile_expr(false, s, e1);
        Compiler$compile_expr(false, s, e2);
        let _t10678;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t10678 = ({_tag: 24, _name: "EQ"});
        } else {
          _t10678 = ({_tag: 25, _name: "NEQ"});
        }
        _t10677 = _call(Compiler$emit, [1, 3, 6, s, _t10678]);
      } else {
        let _t10679;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t10679 = "=";
        } else {
          _t10679 = "<>";
        }
        const method_name_10680 = _t10679;
        const _t10681 = Compiler$compile_class_binop(s, "Eq", method_name_10680, e1.ty, e1, e2);
        _t10677 = _t10681;
      }
      const _t10676 = _t10677;
      const _t10671 = _t10676;
      const _t10667 = _t10671;
      _t10640 = _t10667;
      break _t10641;
    }
    if ((((_t10639._tag === 7 || _t10639._tag === 8) || _t10639._tag === 9) || _t10639._tag === 10)) {
      const resolved_10682 = Types$repr(e1.ty);
      let _t10685;
      const _t10684 = resolved_10682;
      _t10686: {
        if ((((((_t10684._tag === 0 || _t10684._tag === 1) || _t10684._tag === 3) || _t10684._tag === 4) || _t10684._tag === 5) || _t10684._tag === 15 && _t10684._val.contents._tag === 0)) {
          _t10685 = true;
          break _t10686;
        }
        if (true) {
          _t10685 = false;
          break _t10686;
        }
        _match_fail("line 16629");
      }
      const is_builtin_10687 = _t10685;
      let _t10689;
      if (is_builtin_10687) {
        Compiler$compile_expr(false, s, e1);
        Compiler$compile_expr(false, s, e2);
        let _t10691;
        const _t10690 = op;
        _t10692: {
          if (_t10690._tag === 7) {
            _t10691 = ({_tag: 26, _name: "LT"});
            break _t10692;
          }
          if (_t10690._tag === 8) {
            _t10691 = ({_tag: 27, _name: "GT"});
            break _t10692;
          }
          if (_t10690._tag === 9) {
            _t10691 = ({_tag: 28, _name: "LE"});
            break _t10692;
          }
          if (_t10690._tag === 10) {
            _t10691 = ({_tag: 29, _name: "GE"});
            break _t10692;
          }
          if (true) {
            _t10691 = failwith("assert false");
            break _t10692;
          }
          _match_fail("line 16629");
        }
        _t10689 = _call(Compiler$emit, [1, 3, 6, s, _t10691]);
      } else {
        let _t10694;
        const _t10693 = op;
        _t10695: {
          if (_t10693._tag === 7) {
            _t10694 = "<";
            break _t10695;
          }
          if (_t10693._tag === 8) {
            _t10694 = ">";
            break _t10695;
          }
          if (_t10693._tag === 9) {
            _t10694 = "<=";
            break _t10695;
          }
          if (_t10693._tag === 10) {
            _t10694 = ">=";
            break _t10695;
          }
          if (true) {
            _t10694 = failwith("assert false");
            break _t10695;
          }
          _match_fail("line 16629");
        }
        const method_name_10696 = _t10694;
        const _t10697 = Compiler$compile_class_binop(s, "Ord", method_name_10696, e1.ty, e1, e2);
        _t10689 = _t10697;
      }
      const _t10688 = _t10689;
      const _t10683 = _t10688;
      _t10640 = _t10683;
      break _t10641;
    }
    if (_t10639._tag === 13) {
      const gidx_10698 = _call(Compiler$find_or_add_global, [5, s, "^"]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10698})]);
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      Compiler$compile_expr(false, s, e2);
      const _t10699 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      _t10640 = _t10699;
      break _t10641;
    }
    if (((((_t10639._tag === 14 || _t10639._tag === 15) || _t10639._tag === 16) || _t10639._tag === 17) || _t10639._tag === 18)) {
      const resolved_10700 = Types$repr(e1.ty);
      let _t10703;
      const _t10702 = resolved_10700;
      _t10704: {
        if (_t10702._tag === 0) {
          Compiler$compile_expr(false, s, e1);
          Compiler$compile_expr(false, s, e2);
          let _t10706;
          const _t10705 = op;
          _t10707: {
            if (_t10705._tag === 14) {
              _t10706 = ({_tag: 31, _name: "BAND"});
              break _t10707;
            }
            if (_t10705._tag === 15) {
              _t10706 = ({_tag: 32, _name: "BOR"});
              break _t10707;
            }
            if (_t10705._tag === 16) {
              _t10706 = ({_tag: 33, _name: "BXOR"});
              break _t10707;
            }
            if (_t10705._tag === 17) {
              _t10706 = ({_tag: 35, _name: "BSHL"});
              break _t10707;
            }
            if (_t10705._tag === 18) {
              _t10706 = ({_tag: 36, _name: "BSHR"});
              break _t10707;
            }
            if (true) {
              _t10706 = failwith("assert false");
              break _t10707;
            }
            _match_fail("line 16629");
          }
          _t10703 = _call(Compiler$emit, [1, 3, 6, s, _t10706]);
          break _t10704;
        }
        if (true) {
          let _t10709;
          const _t10708 = op;
          _t10710: {
            if (_t10708._tag === 14) {
              _t10709 = "land";
              break _t10710;
            }
            if (_t10708._tag === 15) {
              _t10709 = "lor";
              break _t10710;
            }
            if (_t10708._tag === 16) {
              _t10709 = "lxor";
              break _t10710;
            }
            if (_t10708._tag === 17) {
              _t10709 = "lsl";
              break _t10710;
            }
            if (_t10708._tag === 18) {
              _t10709 = "lsr";
              break _t10710;
            }
            if (true) {
              _t10709 = failwith("assert false");
              break _t10710;
            }
            _match_fail("line 16629");
          }
          const method_name_10711 = _t10709;
          const _t10712 = Compiler$compile_class_binop(s, "Bitwise", method_name_10711, e1.ty, e1, e2);
          _t10703 = _t10712;
          break _t10704;
        }
        _match_fail("line 16629");
      }
      const _t10701 = _t10703;
      _t10640 = _t10701;
      break _t10641;
    }
    if (_t10639._tag === 19) {
      Compiler$compile_expr(false, s, e2);
      Compiler$compile_expr(false, s, e1);
      _t10640 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      break _t10641;
    }
    _match_fail("line 16629");
  }
  return _t10640;
}
function Compiler$compile_class_binop(s, class_name, method_name, operand_ty, e1, e2) {
  const conc_ty_10713 = Types$repr(operand_ty);
  function _t10715(c) {
    return (c.class_name === class_name);
  }
  let _t10717;
  const _t10716 = List$find(_t10715, s.type_env.classes);
  _t10718: {
    if (_t10716._tag === 1) {
      const cd = _t10716._val;
      _t10717 = cd;
      break _t10718;
    }
    if (_t10716._tag === 0) {
      _t10717 = Compiler$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t10718;
    }
    _match_fail("line 16629");
  }
  const class_def_10719 = _t10717;
  const num_params_10721 = List$length(class_def_10719.class_params);
  function _t10723(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_10713});
  }
  const partial_10724 = List$init(num_params_10721, _t10723);
  function _t10726(opt) {
    let _t10728;
    const _t10727 = opt;
    _t10729: {
      if (_t10727._tag === 1) {
        const ty = _t10727._val;
        let _t10731;
        const _t10730 = Types$repr(ty);
        _t10732: {
          if (_t10730._tag === 15 && _t10730._val.contents._tag === 0) {
            _t10731 = ({_tag: 0, _name: "None"});
            break _t10732;
          }
          if (true) {
            _t10731 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t10732;
          }
          _match_fail("line 16629");
        }
        _t10728 = _t10731;
        break _t10729;
      }
      if (_t10727._tag === 0) {
        _t10728 = ({_tag: 0, _name: "None"});
        break _t10729;
      }
      _match_fail("line 16629");
    }
    return _t10728;
  }
  const concrete_partial_10733 = List$map(_t10726, partial_10724);
  function _t10735(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_10721) && Types$match_partial_inst(inst.inst_tys, concrete_partial_10733)));
  }
  const matching_10736 = List$filter(_t10735, s.type_env.instances);
  let _t10739;
  const _t10738 = matching_10736;
  _t10740: {
    if (_t10738 !== null && _t10738._tl === null) {
      const inst = _t10738._hd;
      let _t10741;
      if (_eq(inst.inst_constraints, null)) {
        const method_gidx_10742 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
        const _t10743 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10742})]);
        _t10741 = _t10743;
      } else {
        const dict_gidx_10744 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10744})]);
        const _t10745 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
        _t10741 = _t10745;
      }
      _t10741;
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      Compiler$compile_expr(false, s, e2);
      _t10739 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      break _t10740;
    }
    if (_t10738 === null) {
      _t10739 = Compiler$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_10713))));
      break _t10740;
    }
    if (true) {
      _t10739 = Compiler$error(((("ambiguous instance for " + __dict_Show_string.show(class_name)) + " method ") + __dict_Show_string.show(method_name)));
      break _t10740;
    }
    _match_fail("line 16629");
  }
  const _t10737 = _t10739;
  const _t10734 = _t10737;
  const _t10725 = _t10734;
  const _t10722 = _t10725;
  const _t10720 = _t10722;
  const _t10714 = _t10720;
  return _t10714;
}
function Compiler$compile_class_unop(s, class_name, method_name, operand_ty, e) {
  const conc_ty_10746 = Types$repr(operand_ty);
  function _t10748(c) {
    return (c.class_name === class_name);
  }
  let _t10750;
  const _t10749 = List$find(_t10748, s.type_env.classes);
  _t10751: {
    if (_t10749._tag === 1) {
      const cd = _t10749._val;
      _t10750 = cd;
      break _t10751;
    }
    if (_t10749._tag === 0) {
      _t10750 = Compiler$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t10751;
    }
    _match_fail("line 16629");
  }
  const class_def_10752 = _t10750;
  const num_params_10754 = List$length(class_def_10752.class_params);
  function _t10756(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_10746});
  }
  const partial_10757 = List$init(num_params_10754, _t10756);
  function _t10759(opt) {
    let _t10761;
    const _t10760 = opt;
    _t10762: {
      if (_t10760._tag === 1) {
        const ty = _t10760._val;
        let _t10764;
        const _t10763 = Types$repr(ty);
        _t10765: {
          if (_t10763._tag === 15 && _t10763._val.contents._tag === 0) {
            _t10764 = ({_tag: 0, _name: "None"});
            break _t10765;
          }
          if (true) {
            _t10764 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t10765;
          }
          _match_fail("line 16629");
        }
        _t10761 = _t10764;
        break _t10762;
      }
      if (_t10760._tag === 0) {
        _t10761 = ({_tag: 0, _name: "None"});
        break _t10762;
      }
      _match_fail("line 16629");
    }
    return _t10761;
  }
  const concrete_partial_10766 = List$map(_t10759, partial_10757);
  function _t10768(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_10754) && Types$match_partial_inst(inst.inst_tys, concrete_partial_10766)));
  }
  const matching_10769 = List$filter(_t10768, s.type_env.instances);
  let _t10772;
  const _t10771 = matching_10769;
  _t10773: {
    if (_t10771 !== null && _t10771._tl === null) {
      const inst = _t10771._hd;
      let _t10774;
      if (_eq(inst.inst_constraints, null)) {
        const method_gidx_10775 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
        const _t10776 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10775})]);
        _t10774 = _t10776;
      } else {
        const dict_gidx_10777 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10777})]);
        const _t10778 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
        _t10774 = _t10778;
      }
      _t10774;
      Compiler$compile_expr(false, s, e);
      _t10772 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      break _t10773;
    }
    if (_t10771 === null) {
      _t10772 = Compiler$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_10746))));
      break _t10773;
    }
    if (true) {
      _t10772 = Compiler$error(((("ambiguous instance for " + __dict_Show_string.show(class_name)) + " method ") + __dict_Show_string.show(method_name)));
      break _t10773;
    }
    _match_fail("line 16629");
  }
  const _t10770 = _t10772;
  const _t10767 = _t10770;
  const _t10758 = _t10767;
  const _t10755 = _t10758;
  const _t10753 = _t10755;
  const _t10747 = _t10753;
  return _t10747;
}
function Compiler$compile_unop(s, op, e) {
  let _t10780;
  const _t10779 = op;
  _t10781: {
    if (_t10779._tag === 0) {
      const resolved_10782 = Types$repr(e.ty);
      let _t10785;
      const _t10784 = resolved_10782;
      _t10786: {
        if (_t10784._tag === 0) {
          Compiler$compile_expr(false, s, e);
          _t10785 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 18, _name: "NEG"})]);
          break _t10786;
        }
        if (_t10784._tag === 1) {
          Compiler$compile_expr(false, s, e);
          _t10785 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 23, _name: "FNEG"})]);
          break _t10786;
        }
        if (true) {
          _t10785 = Compiler$compile_class_unop(s, "Num", "neg", e.ty, e);
          break _t10786;
        }
        _match_fail("line 16629");
      }
      const _t10783 = _t10785;
      _t10780 = _t10783;
      break _t10781;
    }
    if (_t10779._tag === 1) {
      Compiler$compile_expr(false, s, e);
      _t10780 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 30, _name: "NOT"})]);
      break _t10781;
    }
    if (_t10779._tag === 2) {
      const resolved_10787 = Types$repr(e.ty);
      let _t10790;
      const _t10789 = resolved_10787;
      _t10791: {
        if (_t10789._tag === 0) {
          Compiler$compile_expr(false, s, e);
          _t10790 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 34, _name: "BNOT"})]);
          break _t10791;
        }
        if (true) {
          _t10790 = Compiler$compile_class_unop(s, "Bitwise", "lnot", e.ty, e);
          break _t10791;
        }
        _match_fail("line 16629");
      }
      const _t10788 = _t10790;
      _t10780 = _t10788;
      break _t10781;
    }
    _match_fail("line 16629");
  }
  return _t10780;
}
function Compiler$compile_if(tail, s, cond, then_e, else_e) {
  Compiler$compile_expr(false, s, cond);
  const else_jump_10792 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]);
  Compiler$compile_expr(tail, s, then_e);
  const end_jump_10794 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
  const else_target_10796 = _call(Compiler$current_offset, [1, s]);
  _call(Compiler$patch, [1, s, else_jump_10792, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: else_target_10796})]);
  Compiler$compile_expr(tail, s, else_e);
  const end_target_10798 = _call(Compiler$current_offset, [1, s]);
  const _t10799 = _call(Compiler$patch, [1, s, end_jump_10794, ({_tag: 37, _name: "JUMP", _val: end_target_10798})]);
  const _t10797 = _t10799;
  const _t10795 = _t10797;
  const _t10793 = _t10795;
  return _t10793;
}
function Compiler$compile_function(has_return, s, param_name, body, _fn_ty) {
  function collect_params(params, body_expr, hr) {
    while (true) {
      let _t10801;
      const _t10800 = body_expr.expr;
      _t10802: {
        if (_t10800._tag === 10) {
          const p = _t10800._val[0];
          const inner = _t10800._val[1];
          const inner_hr = _t10800._val[2];
          const _t10803 = ({_hd: p, _tl: params});
          const _t10804 = inner;
          const _t10805 = (hr || inner_hr);
          params = _t10803;
          body_expr = _t10804;
          hr = _t10805;
          continue;
          _t10801 = undefined;
          break _t10802;
        }
        if (true) {
          _t10801 = [List$rev(params), body_expr, hr];
          break _t10802;
        }
        _match_fail("line 16629");
      }
      return _t10801;
    }
  }
  let _t10808;
  const _t10807 = collect_params(null, body, has_return);
  _t10809: {
    if (true) {
      const extra_params = _t10807[0];
      const final_body = _t10807[1];
      const combined_hr = _t10807[2];
      const all_params_10810 = ({_hd: param_name, _tl: extra_params});
      const arity_10812 = List$length(all_params_10810);
      const sub_10814 = Compiler$create_state(({_tag: 1, _name: "Some", _val: s}), arity_10812, s.global_names, s.mutable_globals, s.type_env, param_name);
      function _t10816(p) {
        _call(Compiler$allocate_local, [7, 9, 12, 15, sub_10814, p]);
        return undefined;
      }
      List$iter(_t10816, all_params_10810);
      let _t10817;
      if (combined_hr) {
        _t10817 = _call(Compiler$emit, [1, 3, 6, sub_10814, ({_tag: 46, _name: "ENTER_FUNC"})]);
      } else {
        _t10817 = undefined;
      }
      _t10817;
      Compiler$compile_expr((!combined_hr), sub_10814, final_body);
      let _t10818;
      if (combined_hr) {
        _t10818 = _call(Compiler$emit, [1, 3, 6, sub_10814, ({_tag: 47, _name: "EXIT_FUNC"})]);
      } else {
        _t10818 = undefined;
      }
      _t10818;
      _call(Compiler$emit, [1, 3, 6, sub_10814, ({_tag: 44, _name: "RETURN"})]);
      const proto_10819 = Compiler$finalize_proto(sub_10814);
      const proto_idx_10821 = _call(Compiler$add_constant, [2, s, ({_tag: 13, _name: "VProto", _val: proto_10819})]);
      function _t10823(uv) {
        return uv.capture;
      }
      const captures_10824 = List$map(_t10823, sub_10814.upvalues);
      const _t10825 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 40, _name: "CLOSURE", _val: [proto_idx_10821, captures_10824]})]);
      const _t10822 = _t10825;
      const _t10820 = _t10822;
      const _t10815 = _t10820;
      const _t10813 = _t10815;
      const _t10811 = _t10813;
      _t10808 = _t10811;
      break _t10809;
    }
    _match_fail("line 16629");
  }
  const _t10806 = _t10808;
  return _t10806;
}
function Compiler$count_arrows(ty) {
  let _t10827;
  const _t10826 = Types$repr(ty);
  _t10828: {
    if ((_t10826._tag === 7 || _t10826._tag === 8)) {
      const r = _t10826._val[2];
      _t10827 = (1 + Compiler$count_arrows(r));
      break _t10828;
    }
    if (true) {
      _t10827 = 0;
      break _t10828;
    }
    _match_fail("line 16629");
  }
  return _t10827;
}
function Compiler$finalize_proto(s) {
  return ({arity: s.arity, code: Dynarray$to_array(s.code), constants: Dynarray$to_array(s.constants), line_table: Dynarray$to_array(s.lines), name: s.proto_name, num_locals: s.max_locals});
}
function Compiler$emit_rec_placeholder(s, te) {
  function go(te) {
    while (true) {
      let _t10830;
      const _t10829 = te.expr;
      _t10831: {
        if (_t10829._tag === 21) {
          const unit_idx_10832 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10832})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 57, _name: "NIL"})]);
          const _t10833 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 56, _name: "CONS"})]);
          _t10830 = _t10833;
          break _t10831;
        }
        if (_t10829._tag === 15) {
          const es = _t10829._val;
          const unit_idx_10834 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
          function _t10836(_) {
            return _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10834})]);
          }
          List$iter(_t10836, es);
          const _t10835 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 48, _name: "MAKE_TUPLE", _val: List$length(es)})]);
          _t10830 = _t10835;
          break _t10831;
        }
        if (_t10829._tag === 16) {
          const fields = _t10829._val;
          function _t10837(__p380, __p381) {
            let _t10839;
            const _t10838 = __p380;
            _t10840: {
              if (true) {
                const a = _t10838[0];
                let _t10842;
                const _t10841 = __p381;
                _t10843: {
                  if (true) {
                    const b = _t10841[0];
                    _t10842 = String$compare(a, b);
                    break _t10843;
                  }
                  _match_fail("line 16629");
                }
                _t10839 = _t10842;
                break _t10840;
              }
              _match_fail("line 16629");
            }
            return _t10839;
          }
          const sorted_10844 = List$sort(_t10837, fields);
          const names_10846 = List$map(fst, sorted_10844);
          const unit_idx_10848 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
          function _t10850(_) {
            return _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10848})]);
          }
          List$iter(_t10850, names_10846);
          const _t10849 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 50, _name: "MAKE_RECORD", _val: names_10846})]);
          const _t10847 = _t10849;
          const _t10845 = _t10847;
          _t10830 = _t10845;
          break _t10831;
        }
        if (_t10829._tag === 23) {
          const name = _t10829._val[0];
          const payload_opt = _t10829._val[1];
          let _t10851;
          if (Compiler$is_newtype_ctor(s.type_env, name)) {
            let _t10853;
            const _t10852 = payload_opt;
            _t10854: {
              if (_t10852._tag === 1) {
                const inner = _t10852._val;
                const _t10855 = inner;
                te = _t10855;
                continue;
                _t10853 = undefined;
                break _t10854;
              }
              if (_t10852._tag === 0) {
                _t10853 = Compiler$error("cannot create placeholder for nullary newtype constructor");
                break _t10854;
              }
              _match_fail("line 16629");
            }
            _t10851 = _t10853;
          } else {
            let _t10856;
            if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
              _t10856 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
            } else {
              _t10856 = Compiler$tag_for_constructor(s.type_env, name);
            }
            const tag_10857 = _t10856;
            let _t10860;
            const _t10859 = String$rindex_opt(name, 46);
            _t10861: {
              if (_t10859._tag === 1) {
                const i = _t10859._val;
                _t10860 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                break _t10861;
              }
              if (_t10859._tag === 0) {
                _t10860 = name;
                break _t10861;
              }
              _match_fail("line 16629");
            }
            const short_name_10862 = _t10860;
            let _t10865;
            const _t10864 = payload_opt;
            _t10866: {
              if (_t10864._tag === 1) {
                const unit_idx_10867 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10867})]);
                const _t10868 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_10857, short_name_10862, true]})]);
                _t10865 = _t10868;
                break _t10866;
              }
              if (_t10864._tag === 0) {
                _t10865 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_10857, short_name_10862, false]})]);
                break _t10866;
              }
              _match_fail("line 16629");
            }
            const _t10863 = _t10865;
            const _t10858 = _t10863;
            _t10851 = _t10858;
          }
          _t10830 = _t10851;
          break _t10831;
        }
        if (_t10829._tag === 38) {
          const es = _t10829._val;
          const unit_idx_10869 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
          function _t10871(_) {
            return _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10869})]);
          }
          List$iter(_t10871, es);
          const _t10870 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 73, _name: "MAKE_ARRAY", _val: List$length(es)})]);
          _t10830 = _t10870;
          break _t10831;
        }
        if (_t10829._tag === 8) {
          const body = _t10829._val[3];
          const _t10872 = body;
          te = _t10872;
          continue;
          _t10830 = undefined;
          break _t10831;
        }
        if (_t10829._tag === 28) {
          const body = _t10829._val[1];
          const _t10873 = body;
          te = _t10873;
          continue;
          _t10830 = undefined;
          break _t10831;
        }
        if (true) {
          _t10830 = Compiler$error("cannot create placeholder for recursive value binding");
          break _t10831;
        }
        _match_fail("line 16629");
      }
      return _t10830;
    }
  }
  const _t10874 = go(te);
  return _t10874;
}
function Compiler$compile_let_rec(s, name, fn_expr) {
  const slot_10875 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
  let _t10878;
  const _t10877 = fn_expr.expr;
  _t10879: {
    if (_t10877._tag === 10) {
      const param = _t10877._val[0];
      const body = _t10877._val[1];
      const has_return = _t10877._val[2];
      function collect_params(params, body_expr, hr) {
        while (true) {
          let _t10881;
          const _t10880 = body_expr.expr;
          _t10882: {
            if (_t10880._tag === 10) {
              const p = _t10880._val[0];
              const inner = _t10880._val[1];
              const inner_hr = _t10880._val[2];
              const _t10883 = ({_hd: p, _tl: params});
              const _t10884 = inner;
              const _t10885 = (hr || inner_hr);
              params = _t10883;
              body_expr = _t10884;
              hr = _t10885;
              continue;
              _t10881 = undefined;
              break _t10882;
            }
            if (true) {
              _t10881 = [List$rev(params), body_expr, hr];
              break _t10882;
            }
            _match_fail("line 16629");
          }
          return _t10881;
        }
      }
      let _t10888;
      const _t10887 = collect_params(null, body, has_return);
      _t10889: {
        if (true) {
          const extra_params = _t10887[0];
          const final_body = _t10887[1];
          const combined_hr = _t10887[2];
          const all_params_10890 = ({_hd: param, _tl: extra_params});
          const arity_10892 = List$length(all_params_10890);
          const sub_10894 = Compiler$create_state(({_tag: 1, _name: "Some", _val: s}), arity_10892, s.global_names, s.mutable_globals, s.type_env, name);
          function _t10896(p) {
            _call(Compiler$allocate_local, [7, 9, 12, 15, sub_10894, p]);
            return undefined;
          }
          List$iter(_t10896, all_params_10890);
          let _t10897;
          if (combined_hr) {
            _t10897 = _call(Compiler$emit, [1, 3, 6, sub_10894, ({_tag: 46, _name: "ENTER_FUNC"})]);
          } else {
            _t10897 = undefined;
          }
          _t10897;
          Compiler$compile_expr((!combined_hr), sub_10894, final_body);
          let _t10898;
          if (combined_hr) {
            _t10898 = _call(Compiler$emit, [1, 3, 6, sub_10894, ({_tag: 47, _name: "EXIT_FUNC"})]);
          } else {
            _t10898 = undefined;
          }
          _t10898;
          _call(Compiler$emit, [1, 3, 6, sub_10894, ({_tag: 44, _name: "RETURN"})]);
          const proto_10899 = Compiler$finalize_proto(sub_10894);
          const proto_idx_10901 = _call(Compiler$add_constant, [2, s, ({_tag: 13, _name: "VProto", _val: proto_10899})]);
          function _t10903(uv) {
            return uv.capture;
          }
          const captures_10904 = List$map(_t10903, sub_10894.upvalues);
          function _t10906(__p382) {
            let _t10908;
            const _t10907 = __p382;
            _t10909: {
              if (true) {
                const i = _t10907[0];
                const uv = _t10907[1];
                let _t10910;
                if ((uv.uv_name === name)) {
                  _t10910 = ({_tag: 1, _name: "Some", _val: i});
                } else {
                  _t10910 = ({_tag: 0, _name: "None"});
                }
                _t10908 = _t10910;
                break _t10909;
              }
              _match_fail("line 16629");
            }
            return _t10908;
          }
          function _t10911(i, uv) {
            return [i, uv];
          }
          const self_idx_10912 = List$find_map(_t10906, List$mapi(_t10911, sub_10894.upvalues));
          let _t10915;
          const _t10914 = self_idx_10912;
          _t10916: {
            if (_t10914._tag === 1) {
              const si = _t10914._val;
              _t10915 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 41, _name: "CLOSURE_REC", _val: [proto_idx_10901, captures_10904, si]})]);
              break _t10916;
            }
            if (_t10914._tag === 0) {
              _t10915 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 40, _name: "CLOSURE", _val: [proto_idx_10901, captures_10904]})]);
              break _t10916;
            }
            _match_fail("line 16629");
          }
          _t10915;
          const _t10913 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10875})]);
          const _t10905 = _t10913;
          const _t10902 = _t10905;
          const _t10900 = _t10902;
          const _t10895 = _t10900;
          const _t10893 = _t10895;
          const _t10891 = _t10893;
          _t10888 = _t10891;
          break _t10889;
        }
        _match_fail("line 16629");
      }
      const _t10886 = _t10888;
      _t10878 = _t10886;
      break _t10879;
    }
    if (true) {
      Compiler$emit_rec_placeholder(s, fn_expr);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10875})]);
      Compiler$compile_expr(false, s, fn_expr);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot_10875})]);
      _t10878 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 84, _name: "UPDATE_REC"})]);
      break _t10879;
    }
    _match_fail("line 16629");
  }
  const _t10876 = _t10878;
  return _t10876;
}
function Compiler$compile_match(tail, s, scrut, arms) {
  Compiler$compile_expr(false, s, scrut);
  const scrut_slot_10917 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_match_scrut"]);
  _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: scrut_slot_10917})]);
  const end_jumps_10919 = Ref$create(null);
  function _t10921(__p383) {
    let _t10923;
    const _t10922 = __p383;
    _t10924: {
      if (true) {
        const pat = _t10922[0];
        const guard = _t10922[1];
        const body = _t10922[2];
        const saved_num_locals_10925 = s.num_locals;
        const saved_locals_10927 = s.locals;
        const fail_jumps_10929 = Ref$create(null);
        Compiler$compile_pattern(s, scrut_slot_10917, pat, fail_jumps_10929);
        let _t10932;
        const _t10931 = guard;
        _t10933: {
          if (_t10931._tag === 1) {
            const guard_te = _t10931._val;
            Compiler$compile_expr(false, s, guard_te);
            _t10932 = Ref$set(fail_jumps_10929, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps_10929)}));
            break _t10933;
          }
          if (_t10931._tag === 0) {
            _t10932 = undefined;
            break _t10933;
          }
          _match_fail("line 16629");
        }
        _t10932;
        Compiler$compile_expr(tail, s, body);
        (s.num_locals = saved_num_locals_10925, undefined);
        (s.locals = saved_locals_10927, undefined);
        Ref$set(end_jumps_10919, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]), _tl: Ref$get(end_jumps_10919)}));
        const target_10934 = _call(Compiler$current_offset, [1, s]);
        function _t10936(idx) {
          return _call(Compiler$patch, [1, s, idx, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: target_10934})]);
        }
        const _t10935 = List$iter(_t10936, Ref$get(fail_jumps_10929));
        const _t10930 = _t10935;
        const _t10928 = _t10930;
        const _t10926 = _t10928;
        _t10923 = _t10926;
        break _t10924;
      }
      _match_fail("line 16629");
    }
    return _t10923;
  }
  List$iter(_t10921, arms);
  const loc_str_10937 = ("line " + __dict_Show_int.show(scrut.loc.line));
  _call(Compiler$emit, [1, 3, 6, s, ({_tag: 64, _name: "MATCH_FAIL", _val: loc_str_10937})]);
  const end_target_10939 = _call(Compiler$current_offset, [1, s]);
  function _t10941(idx) {
    return _call(Compiler$patch, [1, s, idx, ({_tag: 37, _name: "JUMP", _val: end_target_10939})]);
  }
  List$iter(_t10941, Ref$get(end_jumps_10919));
  const _t10940 = Compiler$free_local(s);
  const _t10938 = _t10940;
  const _t10920 = _t10938;
  const _t10918 = _t10920;
  return _t10918;
}
function Compiler$compile_pattern(s, slot, pat, fail_jumps) {
  while (true) {
    let _t10943;
    const _t10942 = pat;
    _t10944: {
      if (_t10942._tag === 0) {
        _t10943 = undefined;
        break _t10944;
      }
      if (_t10942._tag === 1) {
        const name = _t10942._val;
        const var_slot_10945 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        const _t10946 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: var_slot_10945})]);
        _t10943 = _t10946;
        break _t10944;
      }
      if (_t10942._tag === 2) {
        const n = _t10942._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: n})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10943 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10944;
      }
      if (_t10942._tag === 3) {
        const f = _t10942._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 1, _name: "VFloat", _val: f})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10943 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10944;
      }
      if (_t10942._tag === 4) {
        const b = _t10942._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 2, _name: "VBool", _val: b})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10943 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10944;
      }
      if (_t10942._tag === 5) {
        const str = _t10942._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: str})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10943 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10944;
      }
      if (_t10942._tag === 6) {
        _t10943 = undefined;
        break _t10944;
      }
      if (_t10942._tag === 9) {
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 59, _name: "IS_NIL"})]);
        _t10943 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10944;
      }
      if (_t10942._tag === 8) {
        const hd_pat = _t10942._val[0];
        const tl_pat = _t10942._val[1];
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 60, _name: "IS_CONS"})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        const hd_slot_10947 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_hd"]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 61, _name: "HEAD"})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: hd_slot_10947})]);
        const tl_slot_10949 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_tl"]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 62, _name: "TAIL"})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: tl_slot_10949})]);
        Compiler$compile_pattern(s, hd_slot_10947, hd_pat, fail_jumps);
        const _t10951 = s;
        const _t10952 = tl_slot_10949;
        const _t10953 = tl_pat;
        const _t10954 = fail_jumps;
        s = _t10951;
        slot = _t10952;
        pat = _t10953;
        fail_jumps = _t10954;
        continue;
        const _t10950 = undefined;
        const _t10948 = _t10950;
        _t10943 = _t10948;
        break _t10944;
      }
      if (_t10942._tag === 10) {
        const name = _t10942._val[0];
        const arg_pat = _t10942._val[1];
        if (Compiler$is_newtype_ctor(s.type_env, name)) {
          let _t10956;
          const _t10955 = arg_pat;
          _t10957: {
            if (_t10955._tag === 1) {
              const sub_pat = _t10955._val;
              const _t10958 = s;
              const _t10959 = slot;
              const _t10960 = sub_pat;
              const _t10961 = fail_jumps;
              s = _t10958;
              slot = _t10959;
              pat = _t10960;
              fail_jumps = _t10961;
              continue;
              _t10956 = undefined;
              break _t10957;
            }
            if (_t10955._tag === 0) {
              _t10956 = undefined;
              break _t10957;
            }
            _match_fail("line 16629");
          }
          _t10943 = _t10956;
          break _t10944;
        }
      }
      if (_t10942._tag === 10) {
        const name = _t10942._val[0];
        const arg_pat = _t10942._val[1];
        const tag_10962 = Compiler$tag_for_constructor(s.type_env, name);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 58, _name: "TAG_EQ", _val: tag_10962})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        let _t10965;
        const _t10964 = arg_pat;
        _t10966: {
          if (_t10964._tag === 1) {
            const sub_pat = _t10964._val;
            const payload_slot_10967 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_payload"]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 63, _name: "VARIANT_PAYLOAD"})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: payload_slot_10967})]);
            const _t10969 = s;
            const _t10970 = payload_slot_10967;
            const _t10971 = sub_pat;
            const _t10972 = fail_jumps;
            s = _t10969;
            slot = _t10970;
            pat = _t10971;
            fail_jumps = _t10972;
            continue;
            const _t10968 = undefined;
            _t10965 = _t10968;
            break _t10966;
          }
          if (_t10964._tag === 0) {
            _t10965 = undefined;
            break _t10966;
          }
          _match_fail("line 16629");
        }
        const _t10963 = _t10965;
        _t10943 = _t10963;
        break _t10944;
      }
      if (_t10942._tag === 7) {
        const pats = _t10942._val;
        function _t10973(i, sub_pat) {
          const elem_slot_10974 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_tup"]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 49, _name: "TUPLE_GET", _val: i})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: elem_slot_10974})]);
          const _t10975 = Compiler$compile_pattern(s, elem_slot_10974, sub_pat, fail_jumps);
          return _t10975;
        }
        _t10943 = List$iteri(_t10973, pats);
        break _t10944;
      }
      if (_t10942._tag === 11) {
        const field_pats = _t10942._val;
        function _t10976(__p384) {
          let _t10978;
          const _t10977 = __p384;
          _t10979: {
            if (true) {
              const fname = _t10977[0];
              const sub_pat = _t10977[1];
              const field_slot_10980 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_fld"]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: fname})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: field_slot_10980})]);
              const _t10981 = Compiler$compile_pattern(s, field_slot_10980, sub_pat, fail_jumps);
              _t10978 = _t10981;
              break _t10979;
            }
            _match_fail("line 16629");
          }
          return _t10978;
        }
        _t10943 = List$iter(_t10976, field_pats);
        break _t10944;
      }
      if (_t10942._tag === 12) {
        const inner_pat = _t10942._val[0];
        const name = _t10942._val[1];
        Compiler$compile_pattern(s, slot, inner_pat, fail_jumps);
        const var_slot_10982 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        const _t10983 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: var_slot_10982})]);
        _t10943 = _t10983;
        break _t10944;
      }
      if (_t10942._tag === 13) {
        const p1 = _t10942._val[0];
        const p2 = _t10942._val[1];
        const saved_locals_10984 = s.locals;
        const saved_num_locals_10986 = s.num_locals;
        const or_fail_jumps_10988 = Ref$create(null);
        Compiler$compile_pattern(s, slot, p1, or_fail_jumps_10988);
        function _t10990(l) {
          let _t10991;
          if (((l.slot >= saved_num_locals_10986) && ((l.name !== "") && (String$get(l.name, 0) !== 95)))) {
            _t10991 = ({_tag: 1, _name: "Some", _val: [l.name, l.slot]});
          } else {
            _t10991 = ({_tag: 0, _name: "None"});
          }
          return _t10991;
        }
        const p1_bindings_10992 = List$filter_map(_t10990, s.locals);
        const success_jump_10994 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
        const p2_target_10996 = _call(Compiler$current_offset, [1, s]);
        function _t10998(idx) {
          return _call(Compiler$patch, [1, s, idx, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: p2_target_10996})]);
        }
        List$iter(_t10998, Ref$get(or_fail_jumps_10988));
        (s.locals = saved_locals_10984, undefined);
        (s.num_locals = saved_num_locals_10986, undefined);
        Compiler$compile_pattern(s, slot, p2, fail_jumps);
        function _t10999(__p385) {
          let _t11001;
          const _t11000 = __p385;
          _t11002: {
            if (true) {
              const name = _t11000[0];
              const p1_slot = _t11000[1];
              function _t11003(l) {
                return ((l.name === name) && (l.slot >= saved_num_locals_10986));
              }
              let _t11005;
              const _t11004 = List$find(_t11003, s.locals);
              _t11006: {
                if (_t11004._tag === 1) {
                  const l = _t11004._val;
                  if ((l.slot !== p1_slot)) {
                    _t11005 = ({_tag: 1, _name: "Some", _val: [l.slot, p1_slot]});
                    break _t11006;
                  }
                }
                if (true) {
                  _t11005 = ({_tag: 0, _name: "None"});
                  break _t11006;
                }
                _match_fail("line 16629");
              }
              _t11001 = _t11005;
              break _t11002;
            }
            _match_fail("line 16629");
          }
          return _t11001;
        }
        const remaps_11007 = List$filter_map(_t10999, p1_bindings_10992);
        let _t11009;
        if (!_eq(remaps_11007, null)) {
          function _t11010(__p386) {
            let _t11012;
            const _t11011 = __p386;
            _t11013: {
              if (true) {
                const src = _t11011[0];
                const _dst = _t11011[1];
                const tmp_11014 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_or_tmp"]);
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: src})]);
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: tmp_11014})]);
                const _t11015 = tmp_11014;
                _t11012 = _t11015;
                break _t11013;
              }
              _match_fail("line 16629");
            }
            return _t11012;
          }
          const temps_11016 = List$map(_t11010, remaps_11007);
          function _t11018(tmp, __p387) {
            let _t11020;
            const _t11019 = __p387;
            _t11021: {
              if (true) {
                const _src = _t11019[0];
                const dst = _t11019[1];
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: tmp})]);
                _t11020 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: dst})]);
                break _t11021;
              }
              _match_fail("line 16629");
            }
            return _t11020;
          }
          const _t11017 = List$iter2(_t11018, temps_11016, remaps_11007);
          _t11009 = _t11017;
        } else {
          _t11009 = undefined;
        }
        _t11009;
        const success_target_11022 = _call(Compiler$current_offset, [1, s]);
        _call(Compiler$patch, [1, s, success_jump_10994, ({_tag: 37, _name: "JUMP", _val: success_target_11022})]);
        function _t11024(l) {
          let _t11029;
          if ((l.slot < saved_num_locals_10986)) {
            _t11029 = true;
          } else {
          function _t11025(__p388) {
            let _t11027;
            const _t11026 = __p388;
            _t11028: {
              if (true) {
                const n = _t11026[0];
                _t11027 = (n === l.name);
                break _t11028;
              }
              _match_fail("line 16629");
            }
            return _t11027;
          }
            _t11029 = List$exists(_t11025, p1_bindings_10992);
          }
          return _t11029;
        }
        const p2_only_locals_11030 = List$filter(_t11024, s.locals);
        function _t11032(l) {
          let _t11034;
          const _t11033 = List$assoc_opt(l.name, p1_bindings_10992);
          _t11035: {
            if (_t11033._tag === 1) {
              const p1_slot = _t11033._val;
              if ((l.slot >= saved_num_locals_10986)) {
                const __rec_upd_11036 = l;
                const _t11037 = ({depth: __rec_upd_11036.depth, name: __rec_upd_11036.name, slot: p1_slot});
                _t11034 = _t11037;
                break _t11035;
              }
            }
            if (true) {
              _t11034 = l;
              break _t11035;
            }
            _match_fail("line 16629");
          }
          return _t11034;
        }
        const remapped_11038 = List$map(_t11032, p2_only_locals_11030);
        const _t11039 = (s.locals = remapped_11038, undefined);
        const _t11031 = _t11039;
        const _t11023 = _t11031;
        const _t11008 = _t11023;
        const _t10997 = _t11008;
        const _t10995 = _t10997;
        const _t10993 = _t10995;
        const _t10989 = _t10993;
        const _t10987 = _t10989;
        const _t10985 = _t10987;
        _t10943 = _t10985;
        break _t10944;
      }
      if (_t10942._tag === 14) {
        const pats = _t10942._val;
        const al_gidx_11040 = _call(Compiler$find_or_add_global, [5, s, "array_length"]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: al_gidx_11040})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: List$length(pats)})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        function _t11042(i, sub_pat) {
          const elem_slot_11043 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_arr_elem"]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
          _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: i})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 74, _name: "INDEX"})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: elem_slot_11043})]);
          const _t11044 = Compiler$compile_pattern(s, elem_slot_11043, sub_pat, fail_jumps);
          return _t11044;
        }
        const _t11041 = List$iteri(_t11042, pats);
        _t10943 = _t11041;
        break _t10944;
      }
      if (_t10942._tag === 15) {
        const entries = _t10942._val;
        const has_gidx_11045 = _call(Compiler$find_or_add_global, [5, s, "Map.has"]);
        const get_gidx_11047 = _call(Compiler$find_or_add_global, [5, s, "Map.get"]);
        function _t11049(key_pat) {
          let _t11051;
          const _t11050 = key_pat;
          _t11052: {
            if (_t11050._tag === 2) {
              const n = _t11050._val;
              _t11051 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: n})]);
              break _t11052;
            }
            if (_t11050._tag === 5) {
              const str = _t11050._val;
              _t11051 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: str})]);
              break _t11052;
            }
            if (_t11050._tag === 4) {
              const b = _t11050._val;
              _t11051 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 2, _name: "VBool", _val: b})]);
              break _t11052;
            }
            if (_t11050._tag === 3) {
              const f = _t11050._val;
              _t11051 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 1, _name: "VFloat", _val: f})]);
              break _t11052;
            }
            if (_t11050._tag === 17) {
              const name = _t11050._val;
              _t11051 = Compiler$compile_var_access(s, name);
              break _t11052;
            }
            if (true) {
              _t11051 = Compiler$error("map pattern keys must be literals or pin patterns");
              break _t11052;
            }
            _match_fail("line 16629");
          }
          return _t11051;
        }
        const emit_map_key_11053 = _t11049;
        function _t11055(__p389) {
          let _t11057;
          const _t11056 = __p389;
          _t11058: {
            if (true) {
              const key_pat = _t11056[0];
              const val_pat = _t11056[1];
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: has_gidx_11045})]);
              emit_map_key_11053(key_pat);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
              const val_slot_11059 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_map_val"]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: get_gidx_11047})]);
              emit_map_key_11053(key_pat);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 63, _name: "VARIANT_PAYLOAD"})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: val_slot_11059})]);
              const _t11060 = Compiler$compile_pattern(s, val_slot_11059, val_pat, fail_jumps);
              _t11057 = _t11060;
              break _t11058;
            }
            _match_fail("line 16629");
          }
          return _t11057;
        }
        const _t11054 = List$iter(_t11055, entries);
        const _t11048 = _t11054;
        const _t11046 = _t11048;
        _t10943 = _t11046;
        break _t10944;
      }
      if (_t10942._tag === 16) {
        const tag = _t10942._val[0];
        const arg_pat = _t10942._val[1];
        const num_tag_11061 = (__dict_Hash_string.hash(tag) & 1073741823);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 58, _name: "TAG_EQ", _val: num_tag_11061})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        let _t11064;
        const _t11063 = arg_pat;
        _t11065: {
          if (_t11063._tag === 1) {
            const sub_pat = _t11063._val;
            const payload_slot_11066 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_payload"]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 63, _name: "VARIANT_PAYLOAD"})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: payload_slot_11066})]);
            const _t11068 = s;
            const _t11069 = payload_slot_11066;
            const _t11070 = sub_pat;
            const _t11071 = fail_jumps;
            s = _t11068;
            slot = _t11069;
            pat = _t11070;
            fail_jumps = _t11071;
            continue;
            const _t11067 = undefined;
            _t11064 = _t11067;
            break _t11065;
          }
          if (_t11063._tag === 0) {
            _t11064 = undefined;
            break _t11065;
          }
          _match_fail("line 16629");
        }
        const _t11062 = _t11064;
        _t10943 = _t11062;
        break _t10944;
      }
      if (_t10942._tag === 17) {
        const name = _t10942._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        Compiler$compile_var_access(s, name);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t10943 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t10944;
      }
      if (_t10942._tag === 18) {
        const inner_pat = _t10942._val[0];
        const _t11072 = s;
        const _t11073 = slot;
        const _t11074 = inner_pat;
        const _t11075 = fail_jumps;
        s = _t11072;
        slot = _t11073;
        pat = _t11074;
        fail_jumps = _t11075;
        continue;
        _t10943 = undefined;
        break _t10944;
      }
      _match_fail("line 16629");
    }
    return _t10943;
  }
}
function Compiler$compile_handle(s, body_te, arms) {
  const return_arm_11076 = Ref$create(({_tag: 0, _name: "None"}));
  const op_arms_11078 = Ref$create(null);
  function _t11080(__x) {
    let _t11082;
    const _t11081 = __x;
    _t11083: {
      if (_t11081._tag === 0) {
        const name = _t11081._val[0];
        const handler_body = _t11081._val[1];
        _t11082 = Ref$set(return_arm_11076, ({_tag: 1, _name: "Some", _val: [name, handler_body]}));
        break _t11083;
      }
      if (_t11081._tag === 1) {
        const op_name = _t11081._val[0];
        const arg_name = _t11081._val[1];
        const k_name = _t11081._val[2];
        const handler_body = _t11081._val[3];
        _t11082 = Ref$set(op_arms_11078, ({_hd: [op_name, arg_name, k_name, handler_body], _tl: Ref$get(op_arms_11078)}));
        break _t11083;
      }
      if (_t11081._tag === 2) {
        const op_name = _t11081._val[0];
        const arg_name = _t11081._val[1];
        const value_expr = _t11081._val[2];
        const k_name_11084 = "__k_provide";
        const __rec_upd_11086 = value_expr;
        const _t11087 = ({expr: ({_tag: 7, _name: "TEVar", _val: k_name_11084}), loc: __rec_upd_11086.loc, ty: ({_tag: 6, _name: "TUnit"})});
        const k_var_11088 = _t11087;
        const __rec_upd_11090 = value_expr;
        const _t11091 = ({expr: ({_tag: 31, _name: "TEResume", _val: [k_var_11088, value_expr]}), loc: __rec_upd_11090.loc, ty: __rec_upd_11090.ty});
        const resume_expr_11092 = _t11091;
        const _t11093 = Ref$set(op_arms_11078, ({_hd: [op_name, arg_name, k_name_11084, resume_expr_11092], _tl: Ref$get(op_arms_11078)}));
        const _t11089 = _t11093;
        const _t11085 = _t11089;
        _t11082 = _t11085;
        break _t11083;
      }
      if (_t11081._tag === 3) {
        const op_name = _t11081._val[0];
        const arg_name = _t11081._val[1];
        const fallback_expr = _t11081._val[2];
        _t11082 = Ref$set(op_arms_11078, ({_hd: [op_name, arg_name, "__k_try", fallback_expr], _tl: Ref$get(op_arms_11078)}));
        break _t11083;
      }
      _match_fail("line 16629");
    }
    return _t11082;
  }
  List$iter(_t11080, arms);
  const op_arms_11094 = List$rev(Ref$get(op_arms_11078));
  let _t11097;
  const _t11096 = Ref$get(return_arm_11076);
  _t11098: {
    if (_t11096._tag === 1) {
      const arm = _t11096._val;
      _t11097 = arm;
      break _t11098;
    }
    if (_t11096._tag === 0) {
      _t11097 = Compiler$error("handle expression missing return arm");
      break _t11098;
    }
    _match_fail("line 16629");
  }
  let _t11100;
  const _t11099 = _t11097;
  _t11101: {
    if (true) {
      const ret_name = _t11099[0];
      const ret_body = _t11099[1];
      Compiler$compile_function(false, s, "_", body_te, ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), ({_tag: 6, _name: "TUnit"})]}));
      Compiler$compile_function(false, s, ret_name, ret_body, ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), ({_tag: 6, _name: "TUnit"})]}));
      function _t11102(__p390) {
        let _t11104;
        const _t11103 = __p390;
        _t11105: {
          if (true) {
            const op_name = _t11103[0];
            const arg_name = _t11103[1];
            const k_name = _t11103[2];
            const handler_body = _t11103[3];
            _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: op_name})]);
            _t11104 = Compiler$compile_op_handler(s, arg_name, k_name, handler_body);
            break _t11105;
          }
          _match_fail("line 16629");
        }
        return _t11104;
      }
      List$iter(_t11102, op_arms_11094);
      _t11100 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 66, _name: "HANDLE", _val: List$length(op_arms_11094)})]);
      break _t11101;
    }
    _match_fail("line 16629");
  }
  const _t11095 = _t11100;
  const _t11079 = _t11095;
  const _t11077 = _t11079;
  return _t11077;
}
function Compiler$compile_op_handler(s, arg_name, k_name, handler_body) {
  const sub_11106 = Compiler$create_state(({_tag: 1, _name: "Some", _val: s}), 1, s.global_names, s.mutable_globals, s.type_env, "__handler");
  const pair_slot_11108 = _call(Compiler$allocate_local, [7, 9, 12, 15, sub_11106, "__pair"]);
  const arg_slot_11110 = _call(Compiler$allocate_local, [7, 9, 12, 15, sub_11106, arg_name]);
  _call(Compiler$emit, [1, 3, 6, sub_11106, ({_tag: 3, _name: "GET_LOCAL", _val: pair_slot_11108})]);
  _call(Compiler$emit, [1, 3, 6, sub_11106, ({_tag: 49, _name: "TUPLE_GET", _val: 0})]);
  _call(Compiler$emit, [1, 3, 6, sub_11106, ({_tag: 4, _name: "SET_LOCAL", _val: arg_slot_11110})]);
  const k_slot_11112 = _call(Compiler$allocate_local, [7, 9, 12, 15, sub_11106, k_name]);
  _call(Compiler$emit, [1, 3, 6, sub_11106, ({_tag: 3, _name: "GET_LOCAL", _val: pair_slot_11108})]);
  _call(Compiler$emit, [1, 3, 6, sub_11106, ({_tag: 49, _name: "TUPLE_GET", _val: 1})]);
  _call(Compiler$emit, [1, 3, 6, sub_11106, ({_tag: 4, _name: "SET_LOCAL", _val: k_slot_11112})]);
  [arg_slot_11110, k_slot_11112];
  undefined;
  Compiler$compile_expr(true, sub_11106, handler_body);
  _call(Compiler$emit, [1, 3, 6, sub_11106, ({_tag: 44, _name: "RETURN"})]);
  const proto_11114 = Compiler$finalize_proto(sub_11106);
  const proto_idx_11116 = _call(Compiler$add_constant, [2, s, ({_tag: 13, _name: "VProto", _val: proto_11114})]);
  function _t11118(uv) {
    return uv.capture;
  }
  const captures_11119 = List$map(_t11118, sub_11106.upvalues);
  const _t11120 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 40, _name: "CLOSURE", _val: [proto_idx_11116, captures_11119]})]);
  const _t11117 = _t11120;
  const _t11115 = _t11117;
  const _t11113 = _t11115;
  const _t11111 = _t11113;
  const _t11109 = _t11111;
  const _t11107 = _t11109;
  return _t11107;
}
function Compiler$compile_decl(s, decl) {
  let _t11122;
  const _t11121 = decl;
  _t11123: {
    if (((_t11121._tag === 4 || _t11121._tag === 6) || _t11121._tag === 7)) {
      _t11122 = undefined;
      break _t11123;
    }
    if (_t11121._tag === 8) {
      const name = _t11121._val[0];
      _call(Compiler$find_or_add_global, [5, s, name]);
      _t11122 = undefined;
      break _t11123;
    }
    if (_t11121._tag === 0) {
      const name = _t11121._val[0];
      const te = _t11121._val[1];
      Compiler$compile_expr(false, s, te);
      _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
      const gidx_11124 = _call(Compiler$find_or_add_global, [5, s, name]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11124})]);
      let _t11126;
      if (((String$length(name) > 6) && (String$sub(name, 0, 6) === "__dict"))) {
        function _t11127(inst) {
          return (inst.inst_dict_name === name);
        }
        const inst_opt_11128 = List$find(_t11127, s.type_env.instances);
        let _t11131;
        const _t11130 = inst_opt_11128;
        _t11132: {
          if (_t11130._tag === 1) {
            const inst = _t11130._val;
            if (_eq(inst.inst_constraints, null)) {
              function _t11133(c) {
                return (c.class_name === inst.inst_class);
              }
              const class_opt_11134 = List$find(_t11133, s.type_env.classes);
              let _t11137;
              const _t11136 = class_opt_11134;
              _t11138: {
                if (_t11136._tag === 1) {
                  const class_def = _t11136._val;
                  function _t11139(__p391) {
                    let _t11141;
                    const _t11140 = __p391;
                    _t11142: {
                      if (true) {
                        const method_name = _t11140[0];
                        const mgidx_11143 = _call(Compiler$find_or_add_global, [5, s, (name + ("$" + method_name))]);
                        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_11124})]);
                        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
                        const _t11144 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: mgidx_11143})]);
                        _t11141 = _t11144;
                        break _t11142;
                      }
                      _match_fail("line 16629");
                    }
                    return _t11141;
                  }
                  _t11137 = List$iter(_t11139, class_def.class_methods);
                  break _t11138;
                }
                if (_t11136._tag === 0) {
                  _t11137 = undefined;
                  break _t11138;
                }
                _match_fail("line 16629");
              }
              const _t11135 = _t11137;
              _t11131 = _t11135;
              break _t11132;
            }
          }
          if (true) {
            _t11131 = undefined;
            break _t11132;
          }
          _match_fail("line 16629");
        }
        const _t11129 = _t11131;
        _t11126 = _t11129;
      } else {
        _t11126 = undefined;
      }
      const _t11125 = _t11126;
      _t11122 = _t11125;
      break _t11123;
    }
    if (_t11121._tag === 1) {
      const name = _t11121._val[0];
      const te = _t11121._val[1];
      Compiler$compile_expr(false, s, te);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 7, _name: "MAKE_REF"})]);
      _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name, undefined]);
      const gidx_11145 = _call(Compiler$find_or_add_global, [5, s, name]);
      const _t11146 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11145})]);
      _t11122 = _t11146;
      break _t11123;
    }
    if (_t11121._tag === 2) {
      const name = _t11121._val[0];
      const te = _t11121._val[1];
      _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
      const gidx_11147 = _call(Compiler$find_or_add_global, [5, s, name]);
      let _t11150;
      const _t11149 = te.expr;
      _t11151: {
        if (_t11149._tag === 10) {
          _t11150 = true;
          break _t11151;
        }
        if (true) {
          _t11150 = false;
          break _t11151;
        }
        _match_fail("line 16629");
      }
      const is_fun_11152 = _t11150;
      let _t11154;
      if (is_fun_11152) {
        Compiler$compile_expr(false, s, te);
        _t11154 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11147})]);
      } else {
        Compiler$emit_rec_placeholder(s, te);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11147})]);
        Compiler$compile_expr(false, s, te);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_11147})]);
        _t11154 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 84, _name: "UPDATE_REC"})]);
      }
      const _t11153 = _t11154;
      const _t11148 = _t11153;
      _t11122 = _t11148;
      break _t11123;
    }
    if (_t11121._tag === 3) {
      const bindings = _t11121._val;
      function _t11155(__p392) {
        let _t11157;
        const _t11156 = __p392;
        _t11158: {
          if (true) {
            const name = _t11156[0];
            _t11157 = _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
            break _t11158;
          }
          _match_fail("line 16629");
        }
        return _t11157;
      }
      List$iter(_t11155, bindings);
      function _t11159(__p393) {
        let _t11161;
        const _t11160 = __p393;
        _t11162: {
          if (true) {
            const name = _t11160[0];
            const te = _t11160[1];
            const gidx_11163 = _call(Compiler$find_or_add_global, [5, s, name]);
            let _t11166;
            const _t11165 = te.expr;
            _t11167: {
              if (_t11165._tag === 10) {
                _t11166 = true;
                break _t11167;
              }
              if (true) {
                _t11166 = false;
                break _t11167;
              }
              _match_fail("line 16629");
            }
            const is_fun_11168 = _t11166;
            let _t11170;
            if ((!is_fun_11168)) {
              Compiler$emit_rec_placeholder(s, te);
              _t11170 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11163})]);
            } else {
              _t11170 = undefined;
            }
            _t11170;
            const _t11169 = [name, te, gidx_11163, is_fun_11168];
            const _t11164 = _t11169;
            _t11161 = _t11164;
            break _t11162;
          }
          _match_fail("line 16629");
        }
        return _t11161;
      }
      const binding_info_11171 = List$map(_t11159, bindings);
      function _t11173(__p394) {
        let _t11175;
        const _t11174 = __p394;
        _t11176: {
          if (true) {
            const te = _t11174[1];
            const gidx = _t11174[2];
            const is_fun = _t11174[3];
            Compiler$compile_expr(false, s, te);
            let _t11177;
            if (is_fun) {
              _t11177 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx})]);
            } else {
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx})]);
              _t11177 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 84, _name: "UPDATE_REC"})]);
            }
            _t11175 = _t11177;
            break _t11176;
          }
          _match_fail("line 16629");
        }
        return _t11175;
      }
      const _t11172 = List$iter(_t11173, binding_info_11171);
      _t11122 = _t11172;
      break _t11123;
    }
    if (_t11121._tag === 5) {
      const te = _t11121._val;
      Compiler$compile_expr(false, s, te);
      _t11122 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      break _t11123;
    }
    if (_t11121._tag === 9) {
      const _name = _t11121._val[0];
      const inner_decls = _t11121._val[1];
      function _t11178(d) {
        return Compiler$compile_decl(s, d);
      }
      _t11122 = List$iter(_t11178, inner_decls);
      break _t11123;
    }
    if (_t11121._tag === 10) {
      const alias_pairs = _t11121._val;
      function _t11179(__p395) {
        let _t11181;
        const _t11180 = __p395;
        _t11182: {
          if (true) {
            const short_name = _t11180[0];
            const qualified_name = _t11180[1];
            const src_idx_11183 = _call(Compiler$find_or_add_global, [5, s, qualified_name]);
            const dst_idx_11185 = _call(Compiler$find_or_add_global, [5, s, short_name]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: src_idx_11183})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: dst_idx_11185})]);
            let _t11187;
            if (Compiler$is_mutable_global(s, qualified_name)) {
              _t11187 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, short_name, undefined]);
            } else {
              _t11187 = _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, short_name]);
            }
            const _t11186 = _t11187;
            const _t11184 = _t11186;
            _t11181 = _t11184;
            break _t11182;
          }
          _match_fail("line 16629");
        }
        return _t11181;
      }
      _t11122 = List$iter(_t11179, alias_pairs);
      break _t11123;
    }
    _match_fail("line 16629");
  }
  return _t11122;
}
function Compiler$compile_decl_last(s, decl) {
  let _t11189;
  const _t11188 = decl;
  _t11190: {
    if (_t11188._tag === 5) {
      const te = _t11188._val;
      _t11189 = Compiler$compile_expr(false, s, te);
      break _t11190;
    }
    if (true) {
      _t11189 = Compiler$compile_decl(s, decl);
      break _t11190;
    }
    _match_fail("line 16629");
  }
  return _t11189;
}
function Compiler$compile_program_with_globals(type_env, global_names, mutable_globals, program) {
  const s_11191 = Compiler$create_state(({_tag: 0, _name: "None"}), 0, global_names, mutable_globals, type_env, "<main>");
  function compile_all(__x) {
    while (true) {
      let _t11194;
      const _t11193 = __x;
      _t11195: {
        if (_t11193 === null) {
          _t11194 = undefined;
          break _t11195;
        }
        if (_t11193 !== null && _t11193._tl === null) {
          const last = _t11193._hd;
          _t11194 = Compiler$compile_decl_last(s_11191, last);
          break _t11195;
        }
        if (_t11193 !== null) {
          const decl = _t11193._hd;
          const rest = _t11193._tl;
          Compiler$compile_decl(s_11191, decl);
          const _t11196 = rest;
          __x = _t11196;
          continue;
          _t11194 = undefined;
          break _t11195;
        }
        _match_fail("line 16629");
      }
      return _t11194;
    }
  }
  compile_all(program);
  _call(Compiler$emit, [1, 3, 6, s_11191, ({_tag: 75, _name: "HALT"})]);
  const main_11198 = Compiler$finalize_proto(s_11191);
  let _t11200;
  if (Ref$get(Compiler$optimize_enabled)) {
    _t11200 = Optimize$optimize_proto(main_11198);
  } else {
    _t11200 = main_11198;
  }
  const main_11201 = _t11200;
  const gn_11203 = Dynarray$to_array(global_names);
  const _t11204 = ({global_names: gn_11203, main: main_11201});
  const _t11202 = _t11204;
  const _t11199 = _t11202;
  const _t11197 = _t11199;
  const _t11192 = _t11197;
  return _t11192;
}
function Compiler$compile_program(type_env, program) {
  return Compiler$compile_program_with_globals(type_env, Dynarray$empty(undefined), Hashtbl$create(8), program);
}
function Serialize$json_escape_string(s) {
  const buf_11205 = Buffer$create((String$length(s) + 8));
  Buffer$add_byte(buf_11205, 34);
  function _t11207(c) {
    let _t11209;
    const _t11208 = c;
    _t11210: {
      if (true) {
        const _c = _t11208;
        if ((_c === 34)) {
          _t11209 = Buffer$add_string(buf_11205, "\\\"");
          break _t11210;
        }
      }
      if (true) {
        const _c = _t11208;
        if ((_c === 92)) {
          _t11209 = Buffer$add_string(buf_11205, "\\\\");
          break _t11210;
        }
      }
      if (true) {
        const _c = _t11208;
        if ((_c === 10)) {
          _t11209 = Buffer$add_string(buf_11205, "\\n");
          break _t11210;
        }
      }
      if (true) {
        const _c = _t11208;
        if ((_c === 13)) {
          _t11209 = Buffer$add_string(buf_11205, "\\r");
          break _t11210;
        }
      }
      if (true) {
        const _c = _t11208;
        if ((_c === 9)) {
          _t11209 = Buffer$add_string(buf_11205, "\\t");
          break _t11210;
        }
      }
      if (true) {
        const c = _t11208;
        if ((Byte$to_int(c) < 32)) {
          _t11209 = Buffer$add_string(buf_11205, ("\\u" + __fmt_zero_pad(4, __fmt_hex(Byte$to_int(c)))));
          break _t11210;
        }
      }
      if (true) {
        const c = _t11208;
        _t11209 = Buffer$add_byte(buf_11205, c);
        break _t11210;
      }
      _match_fail("line 16629");
    }
    return _t11209;
  }
  String$iter(_t11207, s);
  Buffer$add_byte(buf_11205, 34);
  const _t11206 = Buffer$contents(buf_11205);
  return _t11206;
}
function Serialize$serialize_capture(__x) {
  let _t11212;
  const _t11211 = __x;
  _t11213: {
    if (_t11211._tag === 0) {
      const i = _t11211._val;
      _t11212 = (("[\"local\"," + __dict_Show_int.show(i)) + "]");
      break _t11213;
    }
    if (_t11211._tag === 1) {
      const i = _t11211._val;
      _t11212 = (("[\"upvalue\"," + __dict_Show_int.show(i)) + "]");
      break _t11213;
    }
    _match_fail("line 16629");
  }
  return _t11212;
}
function Serialize$serialize_captures(caps) {
  return ("[" + (String$concat(",", List$map(Serialize$serialize_capture, caps)) + "]"));
}
function Serialize$serialize_opcode(__x) {
  let _t11215;
  const _t11214 = __x;
  _t11216: {
    if (_t11214._tag === 0) {
      const i = _t11214._val;
      _t11215 = (("[\"CONST\"," + __dict_Show_int.show(i)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 1) {
      _t11215 = "[\"POP\"]";
      break _t11216;
    }
    if (_t11214._tag === 2) {
      _t11215 = "[\"DUP\"]";
      break _t11216;
    }
    if (_t11214._tag === 3) {
      const i = _t11214._val;
      _t11215 = (("[\"GET_LOCAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 4) {
      const i = _t11214._val;
      _t11215 = (("[\"SET_LOCAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 5) {
      const i = _t11214._val;
      _t11215 = (("[\"GET_UPVALUE\"," + __dict_Show_int.show(i)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 6) {
      const i = _t11214._val;
      _t11215 = (("[\"SET_UPVALUE\"," + __dict_Show_int.show(i)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 7) {
      _t11215 = "[\"MAKE_REF\"]";
      break _t11216;
    }
    if (_t11214._tag === 8) {
      _t11215 = "[\"DEREF\"]";
      break _t11216;
    }
    if (_t11214._tag === 9) {
      _t11215 = "[\"SET_REF\"]";
      break _t11216;
    }
    if (_t11214._tag === 10) {
      const i = _t11214._val;
      _t11215 = (("[\"GET_GLOBAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 11) {
      const i = _t11214._val;
      _t11215 = (("[\"SET_GLOBAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 12) {
      const i = _t11214._val;
      _t11215 = (("[\"DEF_GLOBAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 13) {
      _t11215 = "[\"ADD\"]";
      break _t11216;
    }
    if (_t11214._tag === 14) {
      _t11215 = "[\"SUB\"]";
      break _t11216;
    }
    if (_t11214._tag === 15) {
      _t11215 = "[\"MUL\"]";
      break _t11216;
    }
    if (_t11214._tag === 16) {
      _t11215 = "[\"DIV\"]";
      break _t11216;
    }
    if (_t11214._tag === 17) {
      _t11215 = "[\"MOD\"]";
      break _t11216;
    }
    if (_t11214._tag === 18) {
      _t11215 = "[\"NEG\"]";
      break _t11216;
    }
    if (_t11214._tag === 19) {
      _t11215 = "[\"FADD\"]";
      break _t11216;
    }
    if (_t11214._tag === 20) {
      _t11215 = "[\"FSUB\"]";
      break _t11216;
    }
    if (_t11214._tag === 21) {
      _t11215 = "[\"FMUL\"]";
      break _t11216;
    }
    if (_t11214._tag === 22) {
      _t11215 = "[\"FDIV\"]";
      break _t11216;
    }
    if (_t11214._tag === 23) {
      _t11215 = "[\"FNEG\"]";
      break _t11216;
    }
    if (_t11214._tag === 24) {
      _t11215 = "[\"EQ\"]";
      break _t11216;
    }
    if (_t11214._tag === 25) {
      _t11215 = "[\"NEQ\"]";
      break _t11216;
    }
    if (_t11214._tag === 26) {
      _t11215 = "[\"LT\"]";
      break _t11216;
    }
    if (_t11214._tag === 27) {
      _t11215 = "[\"GT\"]";
      break _t11216;
    }
    if (_t11214._tag === 28) {
      _t11215 = "[\"LE\"]";
      break _t11216;
    }
    if (_t11214._tag === 29) {
      _t11215 = "[\"GE\"]";
      break _t11216;
    }
    if (_t11214._tag === 30) {
      _t11215 = "[\"NOT\"]";
      break _t11216;
    }
    if (_t11214._tag === 31) {
      _t11215 = "[\"BAND\"]";
      break _t11216;
    }
    if (_t11214._tag === 32) {
      _t11215 = "[\"BOR\"]";
      break _t11216;
    }
    if (_t11214._tag === 33) {
      _t11215 = "[\"BXOR\"]";
      break _t11216;
    }
    if (_t11214._tag === 34) {
      _t11215 = "[\"BNOT\"]";
      break _t11216;
    }
    if (_t11214._tag === 35) {
      _t11215 = "[\"BSHL\"]";
      break _t11216;
    }
    if (_t11214._tag === 36) {
      _t11215 = "[\"BSHR\"]";
      break _t11216;
    }
    if (_t11214._tag === 37) {
      const off = _t11214._val;
      _t11215 = (("[\"JUMP\"," + __dict_Show_int.show(off)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 38) {
      const off = _t11214._val;
      _t11215 = (("[\"JUMP_IF_FALSE\"," + __dict_Show_int.show(off)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 39) {
      const off = _t11214._val;
      _t11215 = (("[\"JUMP_IF_TRUE\"," + __dict_Show_int.show(off)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 40) {
      const i = _t11214._val[0];
      const caps = _t11214._val[1];
      _t11215 = (((("[\"CLOSURE\"," + __dict_Show_int.show(i)) + ",") + __dict_Show_string.show(Serialize$serialize_captures(caps))) + "]");
      break _t11216;
    }
    if (_t11214._tag === 41) {
      const i = _t11214._val[0];
      const caps = _t11214._val[1];
      const self = _t11214._val[2];
      _t11215 = (((((("[\"CLOSURE_REC\"," + __dict_Show_int.show(i)) + ",") + __dict_Show_string.show(Serialize$serialize_captures(caps))) + ",") + __dict_Show_int.show(self)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 42) {
      const n = _t11214._val;
      _t11215 = (("[\"CALL\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 43) {
      const n = _t11214._val;
      _t11215 = (("[\"TAIL_CALL\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 44) {
      _t11215 = "[\"RETURN\"]";
      break _t11216;
    }
    if (_t11214._tag === 45) {
      _t11215 = "[\"FUNC_RETURN\"]";
      break _t11216;
    }
    if (_t11214._tag === 46) {
      _t11215 = "[\"ENTER_FUNC\"]";
      break _t11216;
    }
    if (_t11214._tag === 47) {
      _t11215 = "[\"EXIT_FUNC\"]";
      break _t11216;
    }
    if (_t11214._tag === 48) {
      const n = _t11214._val;
      _t11215 = (("[\"MAKE_TUPLE\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 49) {
      const i = _t11214._val;
      _t11215 = (("[\"TUPLE_GET\"," + __dict_Show_int.show(i)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 50) {
      const fields = _t11214._val;
      _t11215 = (("[\"MAKE_RECORD\",[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$json_escape_string, fields)))) + "]]");
      break _t11216;
    }
    if (_t11214._tag === 51) {
      const name = _t11214._val;
      _t11215 = (("[\"FIELD\"," + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t11216;
    }
    if (_t11214._tag === 52) {
      const name = _t11214._val;
      _t11215 = (("[\"SET_FIELD\"," + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t11216;
    }
    if (_t11214._tag === 53) {
      const fields = _t11214._val;
      _t11215 = (("[\"RECORD_UPDATE\",[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$json_escape_string, fields)))) + "]]");
      break _t11216;
    }
    if (_t11214._tag === 54) {
      const n = _t11214._val;
      _t11215 = (("[\"RECORD_UPDATE_DYN\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 55) {
      const tag = _t11214._val[0];
      const name = _t11214._val[1];
      const has_payload = _t11214._val[2];
      _t11215 = (((((("[\"MAKE_VARIANT\"," + __dict_Show_int.show(tag)) + ",") + __dict_Show_string.show(Serialize$json_escape_string(name))) + ",") + __dict_Show_bool.show(has_payload)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 56) {
      _t11215 = "[\"CONS\"]";
      break _t11216;
    }
    if (_t11214._tag === 57) {
      _t11215 = "[\"NIL\"]";
      break _t11216;
    }
    if (_t11214._tag === 58) {
      const tag = _t11214._val;
      _t11215 = (("[\"TAG_EQ\"," + __dict_Show_int.show(tag)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 59) {
      _t11215 = "[\"IS_NIL\"]";
      break _t11216;
    }
    if (_t11214._tag === 60) {
      _t11215 = "[\"IS_CONS\"]";
      break _t11216;
    }
    if (_t11214._tag === 61) {
      _t11215 = "[\"HEAD\"]";
      break _t11216;
    }
    if (_t11214._tag === 62) {
      _t11215 = "[\"TAIL\"]";
      break _t11216;
    }
    if (_t11214._tag === 63) {
      _t11215 = "[\"VARIANT_PAYLOAD\"]";
      break _t11216;
    }
    if (_t11214._tag === 64) {
      const loc = _t11214._val;
      _t11215 = (("[\"MATCH_FAIL\"," + __dict_Show_string.show(Serialize$json_escape_string(loc))) + "]");
      break _t11216;
    }
    if (_t11214._tag === 65) {
      const op = _t11214._val;
      _t11215 = (("[\"PERFORM\"," + __dict_Show_string.show(Serialize$json_escape_string(op))) + "]");
      break _t11216;
    }
    if (_t11214._tag === 66) {
      const n = _t11214._val;
      _t11215 = (("[\"HANDLE\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 67) {
      _t11215 = "[\"RESUME\"]";
      break _t11216;
    }
    if (_t11214._tag === 68) {
      const n = _t11214._val;
      _t11215 = (("[\"ENTER_LOOP\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 69) {
      _t11215 = "[\"EXIT_LOOP\"]";
      break _t11216;
    }
    if (_t11214._tag === 70) {
      _t11215 = "[\"LOOP_BREAK\"]";
      break _t11216;
    }
    if (_t11214._tag === 71) {
      const n = _t11214._val;
      _t11215 = (("[\"LOOP_CONTINUE\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 72) {
      const n = _t11214._val;
      _t11215 = (("[\"FOLD_CONTINUE\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 73) {
      const n = _t11214._val;
      _t11215 = (("[\"MAKE_ARRAY\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 74) {
      _t11215 = "[\"INDEX\"]";
      break _t11216;
    }
    if (_t11214._tag === 75) {
      _t11215 = "[\"HALT\"]";
      break _t11216;
    }
    if (_t11214._tag === 76) {
      const slot = _t11214._val[0];
      const arity = _t11214._val[1];
      _t11215 = (((("[\"GET_LOCAL_CALL\"," + __dict_Show_int.show(slot)) + ",") + __dict_Show_int.show(arity)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 77) {
      const slot = _t11214._val[0];
      const idx = _t11214._val[1];
      _t11215 = (((("[\"GET_LOCAL_TUPLE_GET\"," + __dict_Show_int.show(slot)) + ",") + __dict_Show_int.show(idx)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 78) {
      const slot = _t11214._val[0];
      const name = _t11214._val[1];
      _t11215 = (((("[\"GET_LOCAL_FIELD\"," + __dict_Show_int.show(slot)) + ",") + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t11216;
    }
    if (_t11214._tag === 79) {
      const idx = _t11214._val[0];
      const arity = _t11214._val[1];
      _t11215 = (((("[\"GET_GLOBAL_CALL\"," + __dict_Show_int.show(idx)) + ",") + __dict_Show_int.show(arity)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 80) {
      const idx = _t11214._val[0];
      const name = _t11214._val[1];
      _t11215 = (((("[\"GET_GLOBAL_FIELD\"," + __dict_Show_int.show(idx)) + ",") + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t11216;
    }
    if (_t11214._tag === 81) {
      const min_tag = _t11214._val[0];
      const targets = _t11214._val[1];
      const _mml$default = _t11214._val[2];
      _t11215 = (((((("[\"JUMP_TABLE\"," + __dict_Show_int.show(min_tag)) + ",[") + __dict_Show_string.show(String$concat(",", Array$to_list(Array$map(string_of_int, targets))))) + "],") + __dict_Show_int.show(_mml$default)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 82) {
      const n = _t11214._val;
      _t11215 = (("[\"CALL_N\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 83) {
      const n = _t11214._val;
      _t11215 = (("[\"TAIL_CALL_N\"," + __dict_Show_int.show(n)) + "]");
      break _t11216;
    }
    if (_t11214._tag === 84) {
      _t11215 = "[\"UPDATE_REC\"]";
      break _t11216;
    }
    _match_fail("line 16629");
  }
  return _t11215;
}
function Serialize$serialize_value(__x) {
  let _t11218;
  const _t11217 = __x;
  _t11219: {
    if (_t11217._tag === 0) {
      const n = _t11217._val;
      _t11218 = (("{\"t\":\"i\",\"v\":" + __dict_Show_int.show(n)) + "}");
      break _t11219;
    }
    if (_t11217._tag === 1) {
      const f = _t11217._val;
      const s_11220 = __dict_Show_float.show(f);
      const len_11222 = String$length(s_11220);
      let _t11224;
      if (((len_11222 > 0) && (String$get(s_11220, (len_11222 - 1)) === 46))) {
        _t11224 = String$sub(s_11220, 0, (len_11222 - 1));
      } else {
        _t11224 = s_11220;
      }
      const s_11225 = _t11224;
      const _t11226 = (("{\"t\":\"f\",\"v\":" + __dict_Show_string.show(s_11225)) + "}");
      const _t11223 = _t11226;
      const _t11221 = _t11223;
      _t11218 = _t11221;
      break _t11219;
    }
    if (_t11217._tag === 2) {
      const b = _t11217._val;
      _t11218 = (("{\"t\":\"b\",\"v\":" + __dict_Show_bool.show(b)) + "}");
      break _t11219;
    }
    if (_t11217._tag === 3) {
      const s = _t11217._val;
      _t11218 = (("{\"t\":\"s\",\"v\":" + __dict_Show_string.show(Serialize$json_escape_string(s))) + "}");
      break _t11219;
    }
    if (_t11217._tag === 4) {
      const n = _t11217._val;
      _t11218 = (("{\"t\":\"y\",\"v\":" + __dict_Show_int.show(n)) + "}");
      break _t11219;
    }
    if (_t11217._tag === 5) {
      const n = _t11217._val;
      _t11218 = (("{\"t\":\"r\",\"v\":" + __dict_Show_int.show(n)) + "}");
      break _t11219;
    }
    if (_t11217._tag === 6) {
      _t11218 = "{\"t\":\"u\"}";
      break _t11219;
    }
    if (_t11217._tag === 13) {
      const p = _t11217._val;
      _t11218 = (("{\"t\":\"p\",\"v\":" + __dict_Show_string.show(Serialize$serialize_prototype(p))) + "}");
      break _t11219;
    }
    if (_t11217._tag === 7) {
      const vs = _t11217._val;
      _t11218 = (("{\"t\":\"T\",\"v\":[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$serialize_value, Array$to_list(vs))))) + "]}");
      break _t11219;
    }
    if (_t11217._tag === 8) {
      const vs = _t11217._val;
      _t11218 = (("{\"t\":\"L\",\"v\":[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$serialize_value, vs)))) + "]}");
      break _t11219;
    }
    if (_t11217._tag === 10) {
      const tag = _t11217._val[0];
      const name = _t11217._val[1];
      const payload = _t11217._val[2];
      let _t11228;
      const _t11227 = payload;
      _t11229: {
        if (_t11227._tag === 0) {
          _t11228 = "null";
          break _t11229;
        }
        if (_t11227._tag === 1) {
          const v = _t11227._val;
          _t11228 = Serialize$serialize_value(v);
          break _t11229;
        }
        _match_fail("line 16629");
      }
      const payload_str_11230 = _t11228;
      const _t11231 = (((((("{\"t\":\"V\",\"tag\":" + __dict_Show_int.show(tag)) + ",\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(name))) + ",\"payload\":") + __dict_Show_string.show(payload_str_11230)) + "}");
      _t11218 = _t11231;
      break _t11219;
    }
    if (true) {
      _t11218 = failwith("serialize_value: unsupported value type in constants");
      break _t11219;
    }
    _match_fail("line 16629");
  }
  return _t11218;
}
function Serialize$serialize_prototype(proto) {
  const code_strs_11232 = Array$to_list(Array$map(Serialize$serialize_opcode, proto.code));
  const const_strs_11234 = Array$to_list(Array$map(Serialize$serialize_value, proto.constants));
  const line_strs_11236 = Array$to_list(Array$map(string_of_int, proto.line_table));
  const _t11237 = (((((((((((("{\"name\":" + __dict_Show_string.show(Serialize$json_escape_string(proto.name))) + ",\"arity\":") + __dict_Show_int.show(proto.arity)) + ",\"num_locals\":") + __dict_Show_int.show(proto.num_locals)) + ",\"code\":[") + __dict_Show_string.show(String$concat(",", code_strs_11232))) + "],\"constants\":[") + __dict_Show_string.show(String$concat(",", const_strs_11234))) + "],\"line_table\":[") + __dict_Show_string.show(String$concat(",", line_strs_11236))) + "]}");
  const _t11235 = _t11237;
  const _t11233 = _t11235;
  return _t11233;
}
function Serialize$serialize_native_global(idx, value) {
  let _t11239;
  const _t11238 = value;
  _t11240: {
    if (_t11238._tag === 14) {
      const ext = _t11238._val;
      _t11239 = ({_tag: 1, _name: "Some", _val: (((((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"external\",\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(ext.ext_name))) + ",\"arity\":") + __dict_Show_int.show(ext.ext_arity)) + "}")});
      break _t11240;
    }
    if (_t11238._tag === 9) {
      const shape = _t11238._val[0];
      const values = _t11238._val[1];
      function _t11241(v) {
        let _t11243;
        const _t11242 = v;
        _t11244: {
          if (_t11242._tag === 14) {
            _t11243 = true;
            break _t11244;
          }
          if (true) {
            _t11243 = false;
            break _t11244;
          }
          _match_fail("line 16629");
        }
        return _t11243;
      }
      const all_external_11245 = Array$forall(_t11241, values);
      let _t11247;
      if ((all_external_11245 && (Array$length(values) > 0))) {
        function _t11248(i) {
          const name_11249 = Array$get(shape.rs_fields, i);
          let _t11252;
          const _t11251 = Array$get(values, i);
          _t11253: {
            if (_t11251._tag === 14) {
              const ext = _t11251._val;
              _t11252 = (((((__dict_Show_string.show(Serialize$json_escape_string(name_11249)) + ":{\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(ext.ext_name))) + ",\"arity\":") + __dict_Show_int.show(ext.ext_arity)) + "}");
              break _t11253;
            }
            if (true) {
              _t11252 = failwith("assert false");
              break _t11253;
            }
            _match_fail("line 16629");
          }
          const _t11250 = _t11252;
          return _t11250;
        }
        const field_strs_11254 = List$init(Array$length(shape.rs_fields), _t11248);
        const _t11255 = ({_tag: 1, _name: "Some", _val: (((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"dict\",\"fields\":{") + __dict_Show_string.show(String$concat(",", field_strs_11254))) + "}}")});
        _t11247 = _t11255;
      } else {
        _t11247 = ({_tag: 0, _name: "None"});
      }
      const _t11246 = _t11247;
      _t11239 = _t11246;
      break _t11240;
    }
    if (true) {
      _t11239 = ({_tag: 0, _name: "None"});
      break _t11240;
    }
    _match_fail("line 16629");
  }
  return _t11239;
}
function Serialize$serialize_native_ext(__dict_Show_0, idx, name, arity) {
  return (((((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"external\",\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(name))) + ",\"arity\":") + __dict_Show_0.show(arity)) + "}");
}
function Serialize$serialize_native_dict(__dict_Show_0, idx, fields) {
  function _t11256(__p396) {
    let _t11258;
    const _t11257 = __p396;
    _t11259: {
      if (true) {
        const name = _t11257[0];
        const ext_name = _t11257[1];
        const arity = _t11257[2];
        _t11258 = (((((__dict_Show_string.show(Serialize$json_escape_string(name)) + ":{\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(ext_name))) + ",\"arity\":") + __dict_Show_0.show(arity)) + "}");
        break _t11259;
      }
      _match_fail("line 16629");
    }
    return _t11258;
  }
  const field_strs_11260 = List$map(_t11256, fields);
  const _t11261 = (((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"dict\",\"fields\":{") + __dict_Show_string.show(String$concat(",", field_strs_11260))) + "}}");
  return _t11261;
}
function Serialize$build_native_globals_json(globals) {
  const parts_11262 = Ref$create(null);
  function _t11264(idx, value) {
    let _t11266;
    const _t11265 = Serialize$serialize_native_global(idx, value);
    _t11267: {
      if (_t11265._tag === 1) {
        const s = _t11265._val;
        _t11266 = Ref$set(parts_11262, ({_hd: s, _tl: Ref$get(parts_11262)}));
        break _t11267;
      }
      if (_t11265._tag === 0) {
        _t11266 = undefined;
        break _t11267;
      }
      _match_fail("line 16629");
    }
    return _t11266;
  }
  Hashtbl$iter(_t11264, globals);
  const _t11263 = String$concat(",", Ref$get(parts_11262));
  return _t11263;
}
function Serialize$serialize_bundle(global_names, native_globals_json, setup_protos, main_proto) {
  const buf_11268 = Buffer$create(4096);
  Buffer$add_string(buf_11268, "{\"version\":1");
  const names_11270 = Dynarray$to_array(global_names);
  Buffer$add_string(buf_11268, ",\"global_names\":[");
  function _t11272(i, name) {
    let _t11273;
    if ((i > 0)) {
      _t11273 = Buffer$add_byte(buf_11268, 44);
    } else {
      _t11273 = undefined;
    }
    _t11273;
    return Buffer$add_string(buf_11268, Serialize$json_escape_string(name));
  }
  Array$iteri(_t11272, names_11270);
  Buffer$add_string(buf_11268, "]");
  Buffer$add_string(buf_11268, ",\"native_globals\":{");
  Buffer$add_string(buf_11268, native_globals_json);
  Buffer$add_string(buf_11268, "}");
  Buffer$add_string(buf_11268, ",\"setup\":[");
  function _t11274(i, proto) {
    let _t11275;
    if ((i > 0)) {
      _t11275 = Buffer$add_byte(buf_11268, 44);
    } else {
      _t11275 = undefined;
    }
    _t11275;
    return Buffer$add_string(buf_11268, Serialize$serialize_prototype(proto));
  }
  List$iteri(_t11274, setup_protos);
  Buffer$add_string(buf_11268, "]");
  Buffer$add_string(buf_11268, ",\"main\":");
  Buffer$add_string(buf_11268, Serialize$serialize_prototype(main_proto));
  Buffer$add_string(buf_11268, "}");
  const _t11271 = Buffer$contents(buf_11268);
  const _t11269 = _t11271;
  return _t11269;
}
function Js_codegen$error(msg) {
  return _trampoline(function() {
    return _h["codegen_error"](msg, function(_t11276) {
      return _bounce(function() {
        return _t11276;
      });
    });
  }, Js_codegen$error);
}
const Js_codegen$js_runtime = "\"use strict\";\nfunction _call(f, args) {\n  while (args.length > 0) {\n    const a = f._arity !== undefined ? f._arity : f.length;\n    if (a === 0) { f = f(); continue; }\n    if (args.length < a) return _partial(f, a, args);\n    const taken = args.splice(0, a);\n    f = f.apply(null, taken);\n  }\n  return f;\n}\nfunction _partial(fn, arity, args) {\n  const p = function() {\n    return _call(fn, args.concat(Array.from(arguments)));\n  };\n  p._arity = arity - args.length;\n  return p;\n}\nfunction _eq(a, b) {\n  if (a === b) return true;\n  if (a == null || b == null) return a === b;\n  if (typeof a !== \"object\") return false;\n  if (Array.isArray(a)) {\n    if (!Array.isArray(b) || a.length !== b.length) return false;\n    for (let i = 0; i < a.length; i++) if (!_eq(a[i], b[i])) return false;\n    return true;\n  }\n  if (\"_arr\" in a && \"_arr\" in b) {\n    if (a._arr.length !== b._arr.length) return false;\n    for (let i = 0; i < a._arr.length; i++) if (!_eq(a._arr[i], b._arr[i])) return false;\n    return true;\n  }\n  if (\"_hd\" in a && \"_hd\" in b) {\n    let ca = a, cb = b;\n    while (ca !== null && cb !== null) {\n      if (!(\"_hd\" in ca) || !(\"_hd\" in cb)) return ca === cb;\n      if (!_eq(ca._hd, cb._hd)) return false;\n      ca = ca._tl; cb = cb._tl;\n    }\n    return ca === cb;\n  }\n  if (\"_tag\" in a) return a._tag === b._tag && _eq(a._val, b._val);\n  if (\"_ref\" in a) return _eq(a._ref, b._ref);\n  const ka = Object.keys(a), kb = Object.keys(b);\n  if (ka.length !== kb.length) return false;\n  for (const k of ka) if (!_eq(a[k], b[k])) return false;\n  return true;\n}\nfunction _compare(a, b) {\n  if (a < b) return -1;\n  if (a > b) return 1;\n  return 0;\n}\nfunction _match_fail(loc) { throw new Error(\"Match failure at \" + loc); }\nfunction _pp(v) {\n  if (v === undefined) return \"()\";\n  if (v === null) return \"[]\";\n  if (typeof v === \"number\") {\n    if (!Number.isInteger(v)) {\n      const s = String(v);\n      return s.includes(\".\") || s.includes(\"e\") ? s : s + \".\";\n    }\n    return String(v);\n  }\n  if (typeof v === \"boolean\") return String(v);\n  if (typeof v === \"string\") return v;\n  if (Array.isArray(v)) return \"(\" + v.map(_pp).join(\", \") + \")\";\n  if (v !== null && typeof v === \"object\") {\n    if (\"_arr\" in v) return \"#[\" + v._arr.map(_pp).join(\"; \") + \"]\";\n    if (\"_hd\" in v) {\n      const r = [];\n      let c = v;\n      while (c !== null && typeof c === \"object\" && \"_hd\" in c) { r.push(_pp(c._hd)); c = c._tl; }\n      return \"[\" + r.join(\"; \") + \"]\";\n    }\n    if (\"_tag\" in v) {\n      if (v._val !== undefined) {\n        const pv = _pp(v._val);\n        if (Array.isArray(v._val) || (typeof v._val === \"object\" && v._val !== null && \"_tag\" in v._val && v._val._val !== undefined))\n          return v._name + \" (\" + pv + \")\";\n        return v._name + \" \" + pv;\n      }\n      return v._name;\n    }\n    if (\"_ref\" in v) return \"ref(\" + _pp(v._ref) + \")\";\n    return \"{ \" + Object.entries(v).map(([k,val]) => k + \" = \" + _pp(val)).join(\"; \") + \" }\";\n  }\n  return String(v);\n}\nlet _h = {};\nfunction _bounce(fn) { fn._tramp = true; return fn; }\nconst _trampolining = new Set();\nfunction _trampoline(fn, tag) {\n  if (tag !== undefined && _trampolining.has(tag)) return fn();\n  if (tag !== undefined) _trampolining.add(tag);\n  try {\n    let result = fn();\n    while (typeof result === 'function' && result._tramp) {\n      result = result();\n    }\n    return result;\n  } finally { if (tag !== undefined) _trampolining.delete(tag); }\n}\nfunction _resolve(v) { while (typeof v === 'function' && v._tramp) v = v(); return v; }\n";
const Js_codegen$js_reserved = ({_hd: "abstract", _tl: ({_hd: "arguments", _tl: ({_hd: "await", _tl: ({_hd: "boolean", _tl: ({_hd: "break", _tl: ({_hd: "byte", _tl: ({_hd: "case", _tl: ({_hd: "catch", _tl: ({_hd: "char", _tl: ({_hd: "class", _tl: ({_hd: "const", _tl: ({_hd: "continue", _tl: ({_hd: "debugger", _tl: ({_hd: "default", _tl: ({_hd: "delete", _tl: ({_hd: "do", _tl: ({_hd: "double", _tl: ({_hd: "else", _tl: ({_hd: "enum", _tl: ({_hd: "eval", _tl: ({_hd: "export", _tl: ({_hd: "extends", _tl: ({_hd: "false", _tl: ({_hd: "final", _tl: ({_hd: "finally", _tl: ({_hd: "float", _tl: ({_hd: "for", _tl: ({_hd: "function", _tl: ({_hd: "goto", _tl: ({_hd: "if", _tl: ({_hd: "implements", _tl: ({_hd: "import", _tl: ({_hd: "in", _tl: ({_hd: "instanceof", _tl: ({_hd: "int", _tl: ({_hd: "interface", _tl: ({_hd: "let", _tl: ({_hd: "long", _tl: ({_hd: "native", _tl: ({_hd: "new", _tl: ({_hd: "null", _tl: ({_hd: "package", _tl: ({_hd: "private", _tl: ({_hd: "protected", _tl: ({_hd: "public", _tl: ({_hd: "return", _tl: ({_hd: "short", _tl: ({_hd: "static", _tl: ({_hd: "super", _tl: ({_hd: "switch", _tl: ({_hd: "synchronized", _tl: ({_hd: "this", _tl: ({_hd: "throw", _tl: ({_hd: "throws", _tl: ({_hd: "transient", _tl: ({_hd: "true", _tl: ({_hd: "try", _tl: ({_hd: "typeof", _tl: ({_hd: "undefined", _tl: ({_hd: "var", _tl: ({_hd: "void", _tl: ({_hd: "volatile", _tl: ({_hd: "while", _tl: ({_hd: "with", _tl: ({_hd: "yield", _tl: ({_hd: "of", _tl: null})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})});
function Js_codegen$is_js_reserved(name) {
  return List$mem(name, Js_codegen$js_reserved);
}
function Js_codegen$mangle_name(name) {
  const buf_11277 = Buffer$create(String$length(name));
  function _t11279(c) {
    let _t11281;
    const _t11280 = c;
    _t11282: {
      if (true) {
        const _c = _t11280;
        if ((_c === 46)) {
          _t11281 = Buffer$add_byte(buf_11277, 36);
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 39)) {
          _t11281 = Buffer$add_string(buf_11277, "$p");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 43)) {
          _t11281 = Buffer$add_string(buf_11277, "$plus");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 45)) {
          _t11281 = Buffer$add_string(buf_11277, "$minus");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 42)) {
          _t11281 = Buffer$add_string(buf_11277, "$star");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 47)) {
          _t11281 = Buffer$add_string(buf_11277, "$slash");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 94)) {
          _t11281 = Buffer$add_string(buf_11277, "$caret");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 61)) {
          _t11281 = Buffer$add_string(buf_11277, "$eq");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 60)) {
          _t11281 = Buffer$add_string(buf_11277, "$lt");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 62)) {
          _t11281 = Buffer$add_string(buf_11277, "$gt");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 33)) {
          _t11281 = Buffer$add_string(buf_11277, "$bang");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 58)) {
          _t11281 = Buffer$add_string(buf_11277, "$colon");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 126)) {
          _t11281 = Buffer$add_string(buf_11277, "$tilde");
          break _t11282;
        }
      }
      if (true) {
        const _c = _t11280;
        if ((_c === 35)) {
          _t11281 = Buffer$add_string(buf_11277, "$hash");
          break _t11282;
        }
      }
      if (true) {
        const c = _t11280;
        _t11281 = Buffer$add_byte(buf_11277, c);
        break _t11282;
      }
      _match_fail("line 16629");
    }
    return _t11281;
  }
  String$iter(_t11279, name);
  const result_11283 = Buffer$contents(buf_11277);
  let _t11285;
  if (Js_codegen$is_js_reserved(result_11283)) {
    _t11285 = ("_mml$" + result_11283);
  } else {
    _t11285 = result_11283;
  }
  const _t11284 = _t11285;
  const _t11278 = _t11284;
  return _t11278;
}
function Js_codegen$create_ctx(type_env) {
  const tbl_11286 = Hashtbl$create(16);
  const _t11287 = ({break_flag_name: "_break_flag", break_val_name: "_break_val", buf: Buffer$create(4096), current_fn_name: ({_tag: 0, _name: "None"}), current_fn_params: null, current_module: ({_tag: 0, _name: "None"}), direct_dispatch_ops: null, handler_tail_resume: false, in_cps: false, in_tail_position: false, indent: 0, scopes: ({_hd: tbl_11286, _tl: null}), tco_used: false, tmp_counter: 0, top_level_exports: null, trywith_ops: null, type_env: type_env});
  return _t11287;
}
function Js_codegen$push_scope(ctx) {
  return (ctx.scopes = ({_hd: Hashtbl$create(8), _tl: ctx.scopes}), undefined);
}
function Js_codegen$pop_scope(ctx) {
  let _t11289;
  const _t11288 = ctx.scopes;
  _t11290: {
    if (_t11288 !== null) {
      const rest = _t11288._tl;
      _t11289 = (ctx.scopes = rest, undefined);
      break _t11290;
    }
    if (_t11288 === null) {
      _t11289 = failwith("pop_scope: empty");
      break _t11290;
    }
    _match_fail("line 16629");
  }
  return _t11289;
}
function Js_codegen$bind_var(ctx, mml_name, js_name) {
  let _t11292;
  const _t11291 = ctx.scopes;
  _t11293: {
    if (_t11291 !== null) {
      const tbl = _t11291._hd;
      _t11292 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tbl, mml_name, js_name]);
      break _t11293;
    }
    if (_t11291 === null) {
      _t11292 = failwith("bind_var: empty scope");
      break _t11293;
    }
    _match_fail("line 16629");
  }
  return _t11292;
}
function Js_codegen$lookup_var(ctx, name) {
  function search(__x) {
    while (true) {
      let _t11295;
      const _t11294 = __x;
      _t11296: {
        if (_t11294 === null) {
          _t11295 = Js_codegen$mangle_name(name);
          break _t11296;
        }
        if (_t11294 !== null) {
          const tbl = _t11294._hd;
          const rest = _t11294._tl;
          let _t11298;
          const _t11297 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tbl, name]);
          _t11299: {
            if (_t11297._tag === 1) {
              const js = _t11297._val;
              _t11298 = js;
              break _t11299;
            }
            if (_t11297._tag === 0) {
              const _t11300 = rest;
              __x = _t11300;
              continue;
              _t11298 = undefined;
              break _t11299;
            }
            _match_fail("line 16629");
          }
          _t11295 = _t11298;
          break _t11296;
        }
        _match_fail("line 16629");
      }
      return _t11295;
    }
  }
  const _t11301 = search(ctx.scopes);
  return _t11301;
}
function Js_codegen$fresh_tmp(ctx) {
  const n_11302 = ctx.tmp_counter;
  (ctx.tmp_counter = (n_11302 + 1), undefined);
  const _t11303 = ("_t" + __dict_Show_int.show(n_11302));
  return _t11303;
}
function Js_codegen$dedup_js_params(params) {
  const seen_11304 = Hashtbl$create(8);
  function _t11306(p) {
    let _t11308;
    const _t11307 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, seen_11304, p]);
    _t11309: {
      if (_t11307._tag === 1) {
        const n = _t11307._val;
        _t11308 = n;
        break _t11309;
      }
      if (_t11307._tag === 0) {
        _t11308 = 0;
        break _t11309;
      }
      _match_fail("line 16629");
    }
    const count_11310 = _t11308;
    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, seen_11304, p, (count_11310 + 1)]);
    let _t11312;
    if ((count_11310 === 0)) {
      _t11312 = p;
    } else {
      _t11312 = (p + ("_" + string_of_int((count_11310 + 1))));
    }
    const _t11311 = _t11312;
    return _t11311;
  }
  const _t11305 = List$map(_t11306, params);
  return _t11305;
}
function Js_codegen$emit(ctx, s) {
  return Buffer$add_string(ctx.buf, s);
}
function Js_codegen$emit_indent(ctx) {
  let _loop_var_11313 = 1;
  let _t11315 = undefined;
  let _t11316 = false, _t11317;
  while (true) {
    if (!((_loop_var_11313 <= ctx.indent))) break;
    Buffer$add_string(ctx.buf, "  ");
    (_loop_var_11313 = (_loop_var_11313 + 1), undefined);
    if (_t11316) break;
  }
  _t11315 = _t11316 ? _t11317 : undefined;
  const _t11314 = _t11315;
  return _t11314;
}
function Js_codegen$emit_line(ctx, s) {
  Js_codegen$emit_indent(ctx);
  Js_codegen$emit(ctx, s);
  return Js_codegen$emit(ctx, "\n");
}
function Js_codegen$escape_js_string(s) {
  const buf_11318 = Buffer$create((String$length(s) + 2));
  Buffer$add_byte(buf_11318, 34);
  function _t11320(c) {
    let _t11322;
    const _t11321 = c;
    _t11323: {
      if (true) {
        const _c = _t11321;
        if ((_c === 34)) {
          _t11322 = Buffer$add_string(buf_11318, "\\\"");
          break _t11323;
        }
      }
      if (true) {
        const _c = _t11321;
        if ((_c === 92)) {
          _t11322 = Buffer$add_string(buf_11318, "\\\\");
          break _t11323;
        }
      }
      if (true) {
        const _c = _t11321;
        if ((_c === 10)) {
          _t11322 = Buffer$add_string(buf_11318, "\\n");
          break _t11323;
        }
      }
      if (true) {
        const _c = _t11321;
        if ((_c === 13)) {
          _t11322 = Buffer$add_string(buf_11318, "\\r");
          break _t11323;
        }
      }
      if (true) {
        const _c = _t11321;
        if ((_c === 9)) {
          _t11322 = Buffer$add_string(buf_11318, "\\t");
          break _t11323;
        }
      }
      if (true) {
        const c = _t11321;
        if ((Byte$to_int(c) < 32)) {
          _t11322 = Buffer$add_string(buf_11318, ("\\x" + __fmt_zero_pad(2, __fmt_hex(Byte$to_int(c)))));
          break _t11323;
        }
      }
      if (true) {
        const c = _t11321;
        _t11322 = Buffer$add_byte(buf_11318, c);
        break _t11323;
      }
      _match_fail("line 16629");
    }
    return _t11322;
  }
  String$iter(_t11320, s);
  Buffer$add_byte(buf_11318, 34);
  const _t11319 = Buffer$contents(buf_11318);
  return _t11319;
}
function Js_codegen$tag_for_constructor(type_env, name) {
  let _t11325;
  const _t11324 = List$assoc_opt(name, type_env.constructors);
  _t11326: {
    if (_t11324._tag === 0) {
      _t11325 = Js_codegen$error(("unknown constructor: " + __dict_Show_string.show(name)));
      break _t11326;
    }
    if (_t11324._tag === 1) {
      const info = _t11324._val;
      function _t11327(__p397) {
        let _t11329;
        const _t11328 = __p397;
        _t11330: {
          if (true) {
            const n = _t11328[0];
            _t11329 = (n === info.ctor_type_name);
            break _t11330;
          }
          _match_fail("line 16629");
        }
        return _t11329;
      }
      let _t11332;
      const _t11331 = list_find(_t11327, type_env.variants);
      _t11333: {
        if (true) {
          const variant_def = _t11331[2];
          let _t11335;
          const _t11334 = String$rindex_opt(name, 46);
          _t11336: {
            if (_t11334._tag === 1) {
              const i = _t11334._val;
              _t11335 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
              break _t11336;
            }
            if (_t11334._tag === 0) {
              _t11335 = name;
              break _t11336;
            }
            _match_fail("line 16629");
          }
          const short_name_11337 = _t11335;
          function find_tag(idx, __x) {
            while (true) {
              let _t11340;
              const _t11339 = __x;
              _t11341: {
                if (_t11339 === null) {
                  _t11340 = Js_codegen$error((("constructor " + __dict_Show_string.show(name)) + " not found in variant"));
                  break _t11341;
                }
                if (_t11339 !== null) {
                  const cname = _t11339._hd[0];
                  if ((cname === short_name_11337)) {
                    _t11340 = idx;
                    break _t11341;
                  }
                }
                if (_t11339 !== null) {
                  const rest = _t11339._tl;
                  const _t11342 = (idx + 1);
                  const _t11343 = rest;
                  idx = _t11342;
                  __x = _t11343;
                  continue;
                  _t11340 = undefined;
                  break _t11341;
                }
                _match_fail("line 16629");
              }
              return _t11340;
            }
          }
          const _t11344 = find_tag(0, variant_def);
          const _t11338 = _t11344;
          _t11332 = _t11338;
          break _t11333;
        }
        _match_fail("line 16629");
      }
      _t11325 = _t11332;
      break _t11326;
    }
    _match_fail("line 16629");
  }
  return _t11325;
}
function Js_codegen$short_constructor_name(name) {
  let _t11346;
  const _t11345 = String$rindex_opt(name, 46);
  _t11347: {
    if (_t11345._tag === 1) {
      const i = _t11345._val;
      _t11346 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
      break _t11347;
    }
    if (_t11345._tag === 0) {
      _t11346 = name;
      break _t11347;
    }
    _match_fail("line 16629");
  }
  return _t11346;
}
function Js_codegen$is_newtype_ctor(type_env, name) {
  let _t11349;
  const _t11348 = List$assoc_opt(name, type_env.constructors);
  _t11350: {
    if (_t11348._tag === 1) {
      const info = _t11348._val;
      _t11349 = List$mem(info.ctor_type_name, type_env.newtypes);
      break _t11350;
    }
    if (_t11348._tag === 0) {
      _t11349 = false;
      break _t11350;
    }
    _match_fail("line 16629");
  }
  return _t11349;
}
function Js_codegen$expr_has_perform(te) {
  while (true) {
    let _t11352;
    const _t11351 = te.expr;
    _t11353: {
      if (_t11351._tag === 29) {
        _t11352 = true;
        break _t11353;
      }
      if (_t11351._tag === 31) {
        _t11352 = true;
        break _t11353;
      }
      if ((_t11351._tag === 8 || _t11351._tag === 28)) {
        const e1 = (_t11351._tag === 8 ? _t11351._val[2] : _t11351._val[0]);
        const e2 = (_t11351._tag === 8 ? _t11351._val[3] : _t11351._val[1]);
        _t11352 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t11353;
      }
      if (_t11351._tag === 12) {
        const cond = _t11351._val[0];
        const e1 = _t11351._val[1];
        const e2 = _t11351._val[2];
        _t11352 = (Js_codegen$expr_has_perform(cond) || (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2)));
        break _t11353;
      }
      if (_t11351._tag === 24) {
        const scrut = _t11351._val[0];
        const arms = _t11351._val[1];
        let _t11362;
        if (Js_codegen$expr_has_perform(scrut)) {
          _t11362 = true;
        } else {
        function _t11354(__p398) {
          let _t11356;
          const _t11355 = __p398;
          _t11357: {
            if (true) {
              const g = _t11355[1];
              const body = _t11355[2];
              let _t11361;
              if (Js_codegen$expr_has_perform(body)) {
                _t11361 = true;
              } else {
              let _t11359;
              const _t11358 = g;
              _t11360: {
                if (_t11358._tag === 1) {
                  const g = _t11358._val;
                  _t11359 = Js_codegen$expr_has_perform(g);
                  break _t11360;
                }
                if (_t11358._tag === 0) {
                  _t11359 = false;
                  break _t11360;
                }
                _match_fail("line 16629");
              }
                _t11361 = _t11359;
              }
              _t11356 = _t11361;
              break _t11357;
            }
            _match_fail("line 16629");
          }
          return _t11356;
        }
          _t11362 = List$exists(_t11354, arms);
        }
        _t11352 = _t11362;
        break _t11353;
      }
      if (_t11351._tag === 9) {
        const fn_e = _t11351._val[2];
        const body = _t11351._val[3];
        _t11352 = (Js_codegen$expr_has_perform(fn_e) || Js_codegen$expr_has_perform(body));
        break _t11353;
      }
      if (_t11351._tag === 37) {
        const bindings = _t11351._val[0];
        const body = _t11351._val[1];
        function _t11363(__p399) {
          let _t11365;
          const _t11364 = __p399;
          _t11366: {
            if (true) {
              const e = _t11364[1];
              _t11365 = Js_codegen$expr_has_perform(e);
              break _t11366;
            }
            _match_fail("line 16629");
          }
          return _t11365;
        }
        _t11352 = (List$exists(_t11363, bindings) || Js_codegen$expr_has_perform(body));
        break _t11353;
      }
      if (_t11351._tag === 10) {
        const body = _t11351._val[1];
        const _t11367 = body;
        te = _t11367;
        continue;
        _t11352 = undefined;
        break _t11353;
      }
      if (_t11351._tag === 11) {
        const fn_ = _t11351._val[0];
        const arg = _t11351._val[1];
        _t11352 = (Js_codegen$expr_has_perform(fn_) || Js_codegen$expr_has_perform(arg));
        break _t11353;
      }
      if (_t11351._tag === 30) {
        const body = _t11351._val[0];
        const arms = _t11351._val[1];
        let _t11372;
        if (Js_codegen$expr_has_perform(body)) {
          _t11372 = true;
        } else {
        function _t11368(arm) {
          let _t11370;
          const _t11369 = arm;
          _t11371: {
            if ((((_t11369._tag === 0 || _t11369._tag === 1) || _t11369._tag === 2) || _t11369._tag === 3)) {
              const e = (((_t11369._tag === 0 || _t11369._tag === 1) || _t11369._tag === 2) ? ((_t11369._tag === 0 || _t11369._tag === 1) ? (_t11369._tag === 0 ? _t11369._val[1] : _t11369._val[3]) : _t11369._val[2]) : _t11369._val[2]);
              _t11370 = Js_codegen$expr_has_perform(e);
              break _t11371;
            }
            _match_fail("line 16629");
          }
          return _t11370;
        }
          _t11372 = List$exists(_t11368, arms);
        }
        _t11352 = _t11372;
        break _t11353;
      }
      if (_t11351._tag === 25) {
        const e1 = _t11351._val[1];
        const e2 = _t11351._val[2];
        _t11352 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t11353;
      }
      if (_t11351._tag === 32) {
        const c = _t11351._val[0];
        const b = _t11351._val[1];
        _t11352 = (Js_codegen$expr_has_perform(c) || Js_codegen$expr_has_perform(b));
        break _t11353;
      }
      if (_t11351._tag === 21) {
        const e1 = _t11351._val[0];
        const e2 = _t11351._val[1];
        _t11352 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t11353;
      }
      if (_t11351._tag === 15) {
        const es = _t11351._val;
        _t11352 = List$exists(Js_codegen$expr_has_perform, es);
        break _t11353;
      }
      if (_t11351._tag === 16) {
        const fields = _t11351._val;
        function _t11373(__p400) {
          let _t11375;
          const _t11374 = __p400;
          _t11376: {
            if (true) {
              const e = _t11374[1];
              _t11375 = Js_codegen$expr_has_perform(e);
              break _t11376;
            }
            _match_fail("line 16629");
          }
          return _t11375;
        }
        _t11352 = List$exists(_t11373, fields);
        break _t11353;
      }
      if (_t11351._tag === 13) {
        const e1 = _t11351._val[1];
        const e2 = _t11351._val[2];
        _t11352 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t11353;
      }
      if (_t11351._tag === 14) {
        const e = _t11351._val[1];
        const _t11377 = e;
        te = _t11377;
        continue;
        _t11352 = undefined;
        break _t11353;
      }
      if (true) {
        _t11352 = false;
        break _t11353;
      }
      _match_fail("line 16629");
    }
    return _t11352;
  }
}
function Js_codegen$all_resumes_are_tail(te) {
  while (true) {
    let _t11379;
    const _t11378 = te.expr;
    _t11380: {
      if (_t11378._tag === 31) {
        _t11379 = true;
        break _t11380;
      }
      if (_t11378._tag === 28) {
        const e2 = _t11378._val[1];
        const _t11381 = e2;
        te = _t11381;
        continue;
        _t11379 = undefined;
        break _t11380;
      }
      if (_t11378._tag === 8) {
        const e1 = _t11378._val[2];
        const e2 = _t11378._val[3];
        _t11379 = ((!Js_codegen$expr_has_perform(e1)) && Js_codegen$all_resumes_are_tail(e2));
        break _t11380;
      }
      if (_t11378._tag === 9) {
        const e2 = _t11378._val[3];
        const _t11382 = e2;
        te = _t11382;
        continue;
        _t11379 = undefined;
        break _t11380;
      }
      if (_t11378._tag === 25) {
        const e1 = _t11378._val[1];
        const e2 = _t11378._val[2];
        _t11379 = ((!Js_codegen$expr_has_perform(e1)) && Js_codegen$all_resumes_are_tail(e2));
        break _t11380;
      }
      if (_t11378._tag === 12) {
        const then_e = _t11378._val[1];
        const else_e = _t11378._val[2];
        _t11379 = (Js_codegen$all_resumes_are_tail(then_e) && Js_codegen$all_resumes_are_tail(else_e));
        break _t11380;
      }
      if (_t11378._tag === 24) {
        const arms = _t11378._val[1];
        function _t11383(__p401) {
          let _t11385;
          const _t11384 = __p401;
          _t11386: {
            if (true) {
              const body = _t11384[2];
              _t11385 = Js_codegen$all_resumes_are_tail(body);
              break _t11386;
            }
            _match_fail("line 16629");
          }
          return _t11385;
        }
        _t11379 = List$forall(_t11383, arms);
        break _t11380;
      }
      if (true) {
        _t11379 = true;
        break _t11380;
      }
      _match_fail("line 16629");
    }
    return _t11379;
  }
}
function Js_codegen$expr_has_unhandled_perform(handled_ops, te) {
  while (true) {
    let _t11388;
    const _t11387 = te.expr;
    _t11389: {
      if (_t11387._tag === 29) {
        const op_name = _t11387._val[0];
        _t11388 = (!List$mem(op_name, handled_ops));
        break _t11389;
      }
      if (_t11387._tag === 31) {
        _t11388 = true;
        break _t11389;
      }
      if ((_t11387._tag === 8 || _t11387._tag === 28)) {
        const e1 = (_t11387._tag === 8 ? _t11387._val[2] : _t11387._val[0]);
        const e2 = (_t11387._tag === 8 ? _t11387._val[3] : _t11387._val[1]);
        _t11388 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t11389;
      }
      if (_t11387._tag === 12) {
        const cond = _t11387._val[0];
        const e1 = _t11387._val[1];
        const e2 = _t11387._val[2];
        _t11388 = (Js_codegen$expr_has_unhandled_perform(handled_ops, cond) || (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2)));
        break _t11389;
      }
      if (_t11387._tag === 24) {
        const scrut = _t11387._val[0];
        const arms = _t11387._val[1];
        let _t11398;
        if (Js_codegen$expr_has_unhandled_perform(handled_ops, scrut)) {
          _t11398 = true;
        } else {
        function _t11390(__p402) {
          let _t11392;
          const _t11391 = __p402;
          _t11393: {
            if (true) {
              const g = _t11391[1];
              const body = _t11391[2];
              let _t11397;
              if (Js_codegen$expr_has_unhandled_perform(handled_ops, body)) {
                _t11397 = true;
              } else {
              let _t11395;
              const _t11394 = g;
              _t11396: {
                if (_t11394._tag === 1) {
                  const g = _t11394._val;
                  _t11395 = Js_codegen$expr_has_unhandled_perform(handled_ops, g);
                  break _t11396;
                }
                if (_t11394._tag === 0) {
                  _t11395 = false;
                  break _t11396;
                }
                _match_fail("line 16629");
              }
                _t11397 = _t11395;
              }
              _t11392 = _t11397;
              break _t11393;
            }
            _match_fail("line 16629");
          }
          return _t11392;
        }
          _t11398 = List$exists(_t11390, arms);
        }
        _t11388 = _t11398;
        break _t11389;
      }
      if (_t11387._tag === 9) {
        const fn_e = _t11387._val[2];
        const body = _t11387._val[3];
        _t11388 = (Js_codegen$expr_has_unhandled_perform(handled_ops, fn_e) || Js_codegen$expr_has_unhandled_perform(handled_ops, body));
        break _t11389;
      }
      if (_t11387._tag === 37) {
        const bindings = _t11387._val[0];
        const body = _t11387._val[1];
        function _t11399(__p403) {
          let _t11401;
          const _t11400 = __p403;
          _t11402: {
            if (true) {
              const e = _t11400[1];
              _t11401 = Js_codegen$expr_has_unhandled_perform(handled_ops, e);
              break _t11402;
            }
            _match_fail("line 16629");
          }
          return _t11401;
        }
        _t11388 = (List$exists(_t11399, bindings) || Js_codegen$expr_has_unhandled_perform(handled_ops, body));
        break _t11389;
      }
      if (_t11387._tag === 10) {
        const body = _t11387._val[1];
        const _t11403 = handled_ops;
        const _t11404 = body;
        handled_ops = _t11403;
        te = _t11404;
        continue;
        _t11388 = undefined;
        break _t11389;
      }
      if (_t11387._tag === 11) {
        const fn_ = _t11387._val[0];
        const arg = _t11387._val[1];
        _t11388 = (Js_codegen$expr_has_unhandled_perform(handled_ops, fn_) || Js_codegen$expr_has_unhandled_perform(handled_ops, arg));
        break _t11389;
      }
      if (_t11387._tag === 30) {
        const body = _t11387._val[0];
        const arms = _t11387._val[1];
        let _t11409;
        if (Js_codegen$expr_has_unhandled_perform(handled_ops, body)) {
          _t11409 = true;
        } else {
        function _t11405(arm) {
          let _t11407;
          const _t11406 = arm;
          _t11408: {
            if ((((_t11406._tag === 0 || _t11406._tag === 1) || _t11406._tag === 2) || _t11406._tag === 3)) {
              const e = (((_t11406._tag === 0 || _t11406._tag === 1) || _t11406._tag === 2) ? ((_t11406._tag === 0 || _t11406._tag === 1) ? (_t11406._tag === 0 ? _t11406._val[1] : _t11406._val[3]) : _t11406._val[2]) : _t11406._val[2]);
              _t11407 = Js_codegen$expr_has_unhandled_perform(handled_ops, e);
              break _t11408;
            }
            _match_fail("line 16629");
          }
          return _t11407;
        }
          _t11409 = List$exists(_t11405, arms);
        }
        _t11388 = _t11409;
        break _t11389;
      }
      if (_t11387._tag === 25) {
        const e1 = _t11387._val[1];
        const e2 = _t11387._val[2];
        _t11388 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t11389;
      }
      if (_t11387._tag === 32) {
        const c = _t11387._val[0];
        const b = _t11387._val[1];
        _t11388 = (Js_codegen$expr_has_unhandled_perform(handled_ops, c) || Js_codegen$expr_has_unhandled_perform(handled_ops, b));
        break _t11389;
      }
      if (_t11387._tag === 21) {
        const e1 = _t11387._val[0];
        const e2 = _t11387._val[1];
        _t11388 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t11389;
      }
      if (_t11387._tag === 15) {
        const es = _t11387._val;
        _t11388 = List$exists(_call(Js_codegen$expr_has_unhandled_perform, [handled_ops]), es);
        break _t11389;
      }
      if (_t11387._tag === 16) {
        const fields = _t11387._val;
        function _t11410(__p404) {
          let _t11412;
          const _t11411 = __p404;
          _t11413: {
            if (true) {
              const e = _t11411[1];
              _t11412 = Js_codegen$expr_has_unhandled_perform(handled_ops, e);
              break _t11413;
            }
            _match_fail("line 16629");
          }
          return _t11412;
        }
        _t11388 = List$exists(_t11410, fields);
        break _t11389;
      }
      if (_t11387._tag === 13) {
        const e1 = _t11387._val[1];
        const e2 = _t11387._val[2];
        _t11388 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t11389;
      }
      if (_t11387._tag === 14) {
        const e = _t11387._val[1];
        const _t11414 = handled_ops;
        const _t11415 = e;
        handled_ops = _t11414;
        te = _t11415;
        continue;
        _t11388 = undefined;
        break _t11389;
      }
      if (true) {
        _t11388 = false;
        break _t11389;
      }
      _match_fail("line 16629");
    }
    return _t11388;
  }
}
function Js_codegen$is_exportable_name(name) {
  return (!((String$length(name) >= 2) && ((String$get(name, 0) === 95) && (String$get(name, 1) === 95))));
}
function Js_codegen$compile_non_tail(ctx, te) {
  const saved_11416 = ctx.in_tail_position;
  (ctx.in_tail_position = false, undefined);
  const r_11418 = Js_codegen$compile_expr(ctx, te);
  (ctx.in_tail_position = saved_11416, undefined);
  const _t11419 = r_11418;
  const _t11417 = _t11419;
  return _t11417;
}
function Js_codegen$compile_expr(ctx, te) {
  while (true) {
    let _t11421;
    const _t11420 = te.expr;
    _t11422: {
      if (_t11420._tag === 0) {
        const n = _t11420._val;
        let _t11423;
        if ((n < 0)) {
          _t11423 = (("(" + __dict_Show_int.show(n)) + ")");
        } else {
          _t11423 = string_of_int(n);
        }
        _t11421 = _t11423;
        break _t11422;
      }
      if (_t11420._tag === 1) {
        const f = _t11420._val;
        const s_11424 = __dict_Show_float.show(f);
        let _t11426;
        if ((String$contains(".", s_11424) || (String$contains("e", s_11424) || String$contains("i", s_11424)))) {
          _t11426 = s_11424;
        } else {
          _t11426 = (s_11424 + ".0");
        }
        const _t11425 = _t11426;
        _t11421 = _t11425;
        break _t11422;
      }
      if (_t11420._tag === 2 && _t11420._val) {
        _t11421 = "true";
        break _t11422;
      }
      if (_t11420._tag === 2 && !_t11420._val) {
        _t11421 = "false";
        break _t11422;
      }
      if (_t11420._tag === 3) {
        const s = _t11420._val;
        _t11421 = Js_codegen$escape_js_string(s);
        break _t11422;
      }
      if (_t11420._tag === 4) {
        const n = _t11420._val;
        _t11421 = string_of_int(n);
        break _t11422;
      }
      if (_t11420._tag === 5) {
        const n = _t11420._val;
        _t11421 = string_of_int(n);
        break _t11422;
      }
      if (_t11420._tag === 6) {
        _t11421 = "undefined";
        break _t11422;
      }
      if (_t11420._tag === 22) {
        _t11421 = "null";
        break _t11422;
      }
      if (_t11420._tag === 7) {
        const name = _t11420._val;
        _t11421 = Js_codegen$lookup_var(ctx, name);
        break _t11422;
      }
      if (_t11420._tag === 8) {
        const name = _t11420._val[0];
        const _scheme = _t11420._val[1];
        const e1 = _t11420._val[2];
        const e2 = _t11420._val[3];
        _t11421 = Js_codegen$compile_let(ctx, name, e1, e2);
        break _t11422;
      }
      if (_t11420._tag === 9) {
        const name = _t11420._val[0];
        const _scheme = _t11420._val[1];
        const fn_expr = _t11420._val[2];
        const body = _t11420._val[3];
        _t11421 = Js_codegen$compile_letrec(ctx, name, fn_expr, body);
        break _t11422;
      }
      if (_t11420._tag === 37) {
        const bindings = _t11420._val[0];
        const body = _t11420._val[1];
        _t11421 = Js_codegen$compile_letrec_and(ctx, bindings, body);
        break _t11422;
      }
      if (_t11420._tag === 10) {
        const param = _t11420._val[0];
        const body = _t11420._val[1];
        const _has_return = _t11420._val[2];
        _t11421 = Js_codegen$compile_fun(ctx, param, body);
        break _t11422;
      }
      if (_t11420._tag === 11) {
        const fn_ = _t11420._val[0];
        const arg = _t11420._val[1];
        _t11421 = Js_codegen$compile_app(ctx, te, fn_, arg);
        break _t11422;
      }
      if (_t11420._tag === 13) {
        const op = _t11420._val[0];
        const e1 = _t11420._val[1];
        const e2 = _t11420._val[2];
        _t11421 = Js_codegen$compile_binop(ctx, op, e1, e2);
        break _t11422;
      }
      if (_t11420._tag === 14) {
        const op = _t11420._val[0];
        const e = _t11420._val[1];
        _t11421 = Js_codegen$compile_unop(ctx, op, e);
        break _t11422;
      }
      if (_t11420._tag === 12) {
        const cond = _t11420._val[0];
        const then_e = _t11420._val[1];
        const else_e = _t11420._val[2];
        _t11421 = Js_codegen$compile_if(ctx, cond, then_e, else_e);
        break _t11422;
      }
      if (_t11420._tag === 15) {
        const exprs = _t11420._val;
        const elts_11427 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), exprs);
        const _t11428 = ("[" + (String$concat(", ", elts_11427) + "]"));
        _t11421 = _t11428;
        break _t11422;
      }
      if (_t11420._tag === 16) {
        const fields = _t11420._val;
        function _t11429(__p405, __p406) {
          let _t11431;
          const _t11430 = __p405;
          _t11432: {
            if (true) {
              const a = _t11430[0];
              let _t11434;
              const _t11433 = __p406;
              _t11435: {
                if (true) {
                  const b = _t11433[0];
                  _t11434 = String$compare(a, b);
                  break _t11435;
                }
                _match_fail("line 16629");
              }
              _t11431 = _t11434;
              break _t11432;
            }
            _match_fail("line 16629");
          }
          return _t11431;
        }
        const sorted_11436 = List$sort(_t11429, fields);
        function _t11438(__p407) {
          let _t11440;
          const _t11439 = __p407;
          _t11441: {
            if (true) {
              const name = _t11439[0];
              const e = _t11439[1];
              const js_name_11442 = Js_codegen$mangle_name(name);
              const v_11444 = Js_codegen$compile_non_tail(ctx, e);
              let _t11446;
              if ((js_name_11442 === name)) {
                _t11446 = (name + (": " + v_11444));
              } else {
                _t11446 = ((__dict_Show_string.show(js_name_11442) + ": ") + __dict_Show_string.show(v_11444));
              }
              const _t11445 = _t11446;
              const _t11443 = _t11445;
              _t11440 = _t11443;
              break _t11441;
            }
            _match_fail("line 16629");
          }
          return _t11440;
        }
        const field_strs_11447 = List$map(_t11438, sorted_11436);
        const _t11448 = ("({" + (String$concat(", ", field_strs_11447) + "})"));
        const _t11437 = _t11448;
        _t11421 = _t11437;
        break _t11422;
      }
      if (_t11420._tag === 17) {
        const base = _t11420._val[0];
        const overrides = _t11420._val[1];
        const base_js_11449 = Js_codegen$compile_non_tail(ctx, base);
        function _t11451(__p408) {
          let _t11453;
          const _t11452 = __p408;
          _t11454: {
            if (true) {
              const name = _t11452[0];
              const e = _t11452[1];
              const js_name_11455 = Js_codegen$mangle_name(name);
              const _t11456 = (js_name_11455 + (": " + Js_codegen$compile_non_tail(ctx, e)));
              _t11453 = _t11456;
              break _t11454;
            }
            _match_fail("line 16629");
          }
          return _t11453;
        }
        const field_strs_11457 = List$map(_t11451, overrides);
        const _t11458 = ("({..." + (base_js_11449 + (", " + (String$concat(", ", field_strs_11457) + "})"))));
        const _t11450 = _t11458;
        _t11421 = _t11450;
        break _t11422;
      }
      if (_t11420._tag === 18) {
        const base = _t11420._val[0];
        const pairs = _t11420._val[1];
        const tmp_11459 = Js_codegen$fresh_tmp(ctx);
        const base_js_11461 = Js_codegen$compile_non_tail(ctx, base);
        function _t11463(__p409) {
          let _t11465;
          const _t11464 = __p409;
          _t11466: {
            if (true) {
              const idx_e = _t11464[0];
              const val_e = _t11464[1];
              const idx_js_11467 = Js_codegen$compile_non_tail(ctx, idx_e);
              const val_js_11469 = Js_codegen$compile_non_tail(ctx, val_e);
              const _t11470 = ((("[" + __dict_Show_string.show(idx_js_11467)) + "]: ") + __dict_Show_string.show(val_js_11469));
              const _t11468 = _t11470;
              _t11465 = _t11468;
              break _t11466;
            }
            _match_fail("line 16629");
          }
          return _t11465;
        }
        const pair_strs_11471 = List$map(_t11463, pairs);
        const _t11472 = (((((((("(" + __dict_Show_string.show(tmp_11459)) + " = {...") + __dict_Show_string.show(base_js_11461)) + ", ") + __dict_Show_string.show(String$concat(", ", pair_strs_11471))) + "}, ") + __dict_Show_string.show(tmp_11459)) + ")");
        const _t11462 = _t11472;
        const _t11460 = _t11462;
        _t11421 = _t11460;
        break _t11422;
      }
      if (_t11420._tag === 19) {
        const e = _t11420._val[0];
        const field = _t11420._val[1];
        const base_11473 = Js_codegen$compile_non_tail(ctx, e);
        const _t11474 = (base_11473 + ("." + Js_codegen$mangle_name(field)));
        _t11421 = _t11474;
        break _t11422;
      }
      if (_t11420._tag === 20) {
        const base_e = _t11420._val[0];
        const idx_e = _t11420._val[1];
        const base_11475 = Js_codegen$compile_non_tail(ctx, base_e);
        const idx_11477 = Js_codegen$compile_non_tail(ctx, idx_e);
        const resolved_11479 = Types$repr(base_e.ty);
        let _t11482;
        const _t11481 = resolved_11479;
        _t11483: {
          if (_t11481._tag === 3) {
            _t11482 = (base_11475 + (".charCodeAt(" + (idx_11477 + ")")));
            break _t11483;
          }
          if (_t11481._tag === 13) {
            _t11482 = (base_11475 + ("._arr[" + (idx_11477 + "]")));
            break _t11483;
          }
          if (true) {
            _t11482 = (base_11475 + ("[" + (idx_11477 + "]")));
            break _t11483;
          }
          _match_fail("line 16629");
        }
        const _t11480 = _t11482;
        const _t11478 = _t11480;
        const _t11476 = _t11478;
        _t11421 = _t11476;
        break _t11422;
      }
      if (_t11420._tag === 21) {
        const hd = _t11420._val[0];
        const tl = _t11420._val[1];
        const hd_js_11484 = Js_codegen$compile_non_tail(ctx, hd);
        const tl_js_11486 = Js_codegen$compile_non_tail(ctx, tl);
        const _t11487 = ("({_hd: " + (hd_js_11484 + (", _tl: " + (tl_js_11486 + "})"))));
        const _t11485 = _t11487;
        _t11421 = _t11485;
        break _t11422;
      }
      if (_t11420._tag === 23) {
        const name = _t11420._val[0];
        const arg = _t11420._val[1];
        let _t11488;
        if (Js_codegen$is_newtype_ctor(ctx.type_env, name)) {
          let _t11490;
          const _t11489 = arg;
          _t11491: {
            if (_t11489._tag === 1) {
              const e = _t11489._val;
              _t11490 = Js_codegen$compile_non_tail(ctx, e);
              break _t11491;
            }
            if (_t11489._tag === 0) {
              _t11490 = "undefined";
              break _t11491;
            }
            _match_fail("line 16629");
          }
          _t11488 = _t11490;
        } else {
          let _t11492;
          if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
            _t11492 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
          } else {
            _t11492 = Js_codegen$tag_for_constructor(ctx.type_env, name);
          }
          const tag_11493 = _t11492;
          const sname_11495 = Js_codegen$short_constructor_name(name);
          let _t11498;
          const _t11497 = arg;
          _t11499: {
            if (_t11497._tag === 1) {
              const e = _t11497._val;
              const v_11500 = Js_codegen$compile_non_tail(ctx, e);
              const _t11501 = (((((("({_tag: " + __dict_Show_int.show(tag_11493)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11495))) + ", _val: ") + __dict_Show_string.show(v_11500)) + "})");
              _t11498 = _t11501;
              break _t11499;
            }
            if (_t11497._tag === 0) {
              _t11498 = (((("({_tag: " + __dict_Show_int.show(tag_11493)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11495))) + "})");
              break _t11499;
            }
            _match_fail("line 16629");
          }
          const _t11496 = _t11498;
          const _t11494 = _t11496;
          _t11488 = _t11494;
        }
        _t11421 = _t11488;
        break _t11422;
      }
      if (_t11420._tag === 24) {
        const scrut = _t11420._val[0];
        const arms = _t11420._val[1];
        const _partial = _t11420._val[2];
        _t11421 = Js_codegen$compile_match(ctx, scrut, arms, te.loc);
        break _t11422;
      }
      if (_t11420._tag === 28) {
        const e1 = _t11420._val[0];
        const e2 = _t11420._val[1];
        _t11421 = Js_codegen$compile_seq(ctx, e1, e2);
        break _t11422;
      }
      if (_t11420._tag === 25) {
        const name = _t11420._val[0];
        const init = _t11420._val[1];
        const body = _t11420._val[2];
        _t11421 = Js_codegen$compile_let_mut(ctx, name, init, body);
        break _t11422;
      }
      if (_t11420._tag === 26) {
        const name = _t11420._val[0];
        const e = _t11420._val[1];
        const js_name_11502 = Js_codegen$lookup_var(ctx, name);
        const v_11504 = Js_codegen$compile_non_tail(ctx, e);
        const _t11505 = ("(" + (js_name_11502 + (" = " + (v_11504 + ", undefined)"))));
        const _t11503 = _t11505;
        _t11421 = _t11503;
        break _t11422;
      }
      if (_t11420._tag === 27) {
        const record_e = _t11420._val[0];
        const field = _t11420._val[1];
        const value_e = _t11420._val[2];
        const base_11506 = Js_codegen$compile_non_tail(ctx, record_e);
        const v_11508 = Js_codegen$compile_non_tail(ctx, value_e);
        const _t11509 = ("(" + (base_11506 + ("." + (Js_codegen$mangle_name(field) + (" = " + (v_11508 + ", undefined)"))))));
        const _t11507 = _t11509;
        _t11421 = _t11507;
        break _t11422;
      }
      if (_t11420._tag === 32) {
        const cond = _t11420._val[0];
        const body = _t11420._val[1];
        _t11421 = Js_codegen$compile_while(ctx, cond, body);
        break _t11422;
      }
      if (_t11420._tag === 33) {
        const value_te = _t11420._val;
        const v_11510 = Js_codegen$compile_non_tail(ctx, value_te);
        const _t11511 = ("(" + (ctx.break_val_name + (" = " + (v_11510 + (", " + (ctx.break_flag_name + " = true, undefined)"))))));
        _t11421 = _t11511;
        break _t11422;
      }
      if (_t11420._tag === 34) {
        _t11421 = "(_cont_flag = true, undefined)";
        break _t11422;
      }
      if (_t11420._tag === 35) {
        const value_te = _t11420._val;
        const v_11512 = Js_codegen$compile_non_tail(ctx, value_te);
        const _t11513 = ("(_fold_cont_val = " + (v_11512 + ", _fold_cont_flag = true, undefined)"));
        _t11421 = _t11513;
        break _t11422;
      }
      if (_t11420._tag === 36) {
        const fold_te = _t11420._val;
        const _t11514 = ctx;
        const _t11515 = fold_te;
        ctx = _t11514;
        te = _t11515;
        continue;
        _t11421 = undefined;
        break _t11422;
      }
      if (_t11420._tag === 38) {
        const elts = _t11420._val;
        const elt_strs_11516 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), elts);
        const _t11517 = ("{_arr: [" + (String$concat(", ", elt_strs_11516) + "]}"));
        _t11421 = _t11517;
        break _t11422;
      }
      if (_t11420._tag === 39) {
        const value_te = _t11420._val;
        const v_11518 = Js_codegen$compile_non_tail(ctx, value_te);
        const _t11519 = ("(_ret_val = " + (v_11518 + ", _ret_flag = true, undefined)"));
        _t11421 = _t11519;
        break _t11422;
      }
      if (_t11420._tag === 29) {
        const op_name = _t11420._val[0];
        const arg = _t11420._val[1];
        let _t11521;
        const _t11520 = List$assoc_opt(op_name, ctx.direct_dispatch_ops);
        _t11522: {
          if (_t11520._tag === 1) {
            const direct_fn = _t11520._val;
            const arg_js_11523 = Js_codegen$compile_non_tail(ctx, arg);
            const _t11524 = (direct_fn + ("(" + (arg_js_11523 + ")")));
            _t11521 = _t11524;
            break _t11522;
          }
          if (_t11520._tag === 0) {
            if (List$mem(op_name, ctx.trywith_ops)) {
              const arg_js_11525 = Js_codegen$compile_non_tail(ctx, arg);
              const result_11527 = Js_codegen$fresh_tmp(ctx);
              Js_codegen$emit_line(ctx, (((("throw {_e: \"" + __dict_Show_string.show(op_name)) + "\", _v: ") + __dict_Show_string.show(arg_js_11525)) + "};"));
              Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(result_11527)) + " = undefined;"));
              const _t11528 = result_11527;
              const _t11526 = _t11528;
              _t11521 = _t11526;
              break _t11522;
            }
          }
          if (_t11520._tag === 0) {
            const arg_js_11529 = Js_codegen$compile_non_tail(ctx, arg);
            const result_11531 = Js_codegen$fresh_tmp(ctx);
            Js_codegen$emit_line(ctx, (((((("const " + __dict_Show_string.show(result_11531)) + " = _trampoline(function() { return _h[\"") + __dict_Show_string.show(op_name)) + "\"](") + __dict_Show_string.show(arg_js_11529)) + ", function(_r) { return _r; }); });"));
            const _t11532 = result_11531;
            const _t11530 = _t11532;
            _t11521 = _t11530;
            break _t11522;
          }
          _match_fail("line 16629");
        }
        _t11421 = _t11521;
        break _t11422;
      }
      if (_t11420._tag === 30) {
        const body = _t11420._val[0];
        const arms = _t11420._val[1];
        _t11421 = Js_codegen$compile_handle(ctx, body, arms);
        break _t11422;
      }
      if (_t11420._tag === 31) {
        const k_expr = _t11420._val[0];
        const val_expr = _t11420._val[1];
        const k_js_11533 = Js_codegen$compile_non_tail(ctx, k_expr);
        const v_js_11535 = Js_codegen$compile_non_tail(ctx, val_expr);
        let _t11537;
        if (ctx.handler_tail_resume) {
          _t11537 = (k_js_11533 + ("(" + (v_js_11535 + ")")));
        } else {
          _t11537 = ("_trampoline(function() { return " + (k_js_11533 + ("(" + (v_js_11535 + "); })"))));
        }
        const _t11536 = _t11537;
        const _t11534 = _t11536;
        _t11421 = _t11534;
        break _t11422;
      }
      _match_fail("line 16629");
    }
    return _t11421;
  }
}
function Js_codegen$compile_let(ctx, name, e1, e2) {
  const v1_11538 = Js_codegen$compile_non_tail(ctx, e1);
  const js_name_11540 = Js_codegen$mangle_name(name);
  let _t11542;
  if ((js_name_11540 === "_")) {
    _t11542 = Js_codegen$fresh_tmp(ctx);
  } else {
    function _t11543(n) {
      (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
      return n;
    }
    _t11542 = _call(_t11543, [(js_name_11540 + ("_" + (string_of_int(ctx.tmp_counter) + "")))]);
  }
  const actual_name_11544 = _t11542;
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, actual_name_11544);
  const result_11546 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_name_11544)) + " = ") + __dict_Show_string.show(v1_11538)) + ";"));
  const v2_11548 = Js_codegen$compile_expr(ctx, e2);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11546)) + " = ") + __dict_Show_string.show(v2_11548)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11549 = result_11546;
  const _t11547 = _t11549;
  const _t11545 = _t11547;
  const _t11541 = _t11545;
  const _t11539 = _t11541;
  return _t11539;
}
function Js_codegen$emit_js_placeholder(ctx, js_name, te) {
  function go(te) {
    while (true) {
      let _t11551;
      const _t11550 = te.expr;
      _t11552: {
        if (_t11550._tag === 21) {
          _t11551 = Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(js_name)) + " = {_hd: null, _tl: null};"));
          break _t11552;
        }
        if (_t11550._tag === 15) {
          const es = _t11550._val;
          function _t11553(_) {
            return "null";
          }
          const nulls_11554 = String$concat(", ", List$map(_t11553, es));
          const _t11555 = Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(js_name)) + " = [") + __dict_Show_string.show(nulls_11554)) + "];"));
          _t11551 = _t11555;
          break _t11552;
        }
        if (_t11550._tag === 16) {
          const fields = _t11550._val;
          function _t11556(__p410, __p411) {
            let _t11558;
            const _t11557 = __p410;
            _t11559: {
              if (true) {
                const a = _t11557[0];
                let _t11561;
                const _t11560 = __p411;
                _t11562: {
                  if (true) {
                    const b = _t11560[0];
                    _t11561 = String$compare(a, b);
                    break _t11562;
                  }
                  _match_fail("line 16629");
                }
                _t11558 = _t11561;
                break _t11559;
              }
              _match_fail("line 16629");
            }
            return _t11558;
          }
          const sorted_11563 = List$sort(_t11556, fields);
          function _t11565(__p412) {
            let _t11567;
            const _t11566 = __p412;
            _t11568: {
              if (true) {
                const name = _t11566[0];
                _t11567 = (Js_codegen$mangle_name(name) + ": null");
                break _t11568;
              }
              _match_fail("line 16629");
            }
            return _t11567;
          }
          const field_strs_11569 = List$map(_t11565, sorted_11563);
          const _t11570 = Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(js_name)) + " = {") + __dict_Show_string.show(String$concat(", ", field_strs_11569))) + "};"));
          const _t11564 = _t11570;
          _t11551 = _t11564;
          break _t11552;
        }
        if (_t11550._tag === 23) {
          const name = _t11550._val[0];
          const payload_opt = _t11550._val[1];
          let _t11571;
          if (Js_codegen$is_newtype_ctor(ctx.type_env, name)) {
            let _t11573;
            const _t11572 = payload_opt;
            _t11574: {
              if (_t11572._tag === 1) {
                const inner = _t11572._val;
                const _t11575 = inner;
                te = _t11575;
                continue;
                _t11573 = undefined;
                break _t11574;
              }
              if (_t11572._tag === 0) {
                _t11573 = Js_codegen$error("cannot create placeholder for nullary newtype constructor");
                break _t11574;
              }
              _match_fail("line 16629");
            }
            _t11571 = _t11573;
          } else {
            let _t11576;
            if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
              _t11576 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
            } else {
              _t11576 = Js_codegen$tag_for_constructor(ctx.type_env, name);
            }
            const tag_11577 = _t11576;
            const sname_11579 = Js_codegen$short_constructor_name(name);
            let _t11582;
            const _t11581 = payload_opt;
            _t11583: {
              if (_t11581._tag === 1) {
                _t11582 = Js_codegen$emit_line(ctx, (((((("let " + __dict_Show_string.show(js_name)) + " = {_tag: ") + __dict_Show_int.show(tag_11577)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11579))) + ", _val: null};"));
                break _t11583;
              }
              if (_t11581._tag === 0) {
                _t11582 = Js_codegen$emit_line(ctx, (((((("let " + __dict_Show_string.show(js_name)) + " = {_tag: ") + __dict_Show_int.show(tag_11577)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11579))) + "};"));
                break _t11583;
              }
              _match_fail("line 16629");
            }
            const _t11580 = _t11582;
            const _t11578 = _t11580;
            _t11571 = _t11578;
          }
          _t11551 = _t11571;
          break _t11552;
        }
        if (_t11550._tag === 38) {
          const es = _t11550._val;
          function _t11584(_) {
            return "null";
          }
          const nulls_11585 = String$concat(", ", List$map(_t11584, es));
          const _t11586 = Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(js_name)) + " = {_arr: [") + __dict_Show_string.show(nulls_11585)) + "]};"));
          _t11551 = _t11586;
          break _t11552;
        }
        if ((_t11550._tag === 8 || _t11550._tag === 28)) {
          const inner = (_t11550._tag === 8 ? _t11550._val[3] : _t11550._val[1]);
          const _t11587 = inner;
          te = _t11587;
          continue;
          _t11551 = undefined;
          break _t11552;
        }
        if (true) {
          _t11551 = Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(js_name)) + " = null;"));
          break _t11552;
        }
        _match_fail("line 16629");
      }
      return _t11551;
    }
  }
  const _t11588 = go(te);
  return _t11588;
}
function Js_codegen$emit_js_backpatch(ctx, js_name, te) {
  function go(te) {
    while (true) {
      let _t11590;
      const _t11589 = te.expr;
      _t11591: {
        if (_t11589._tag === 21) {
          const computed_11592 = Js_codegen$compile_non_tail(ctx, te);
          const _t11593 = Js_codegen$emit_line(ctx, (((((((__dict_Show_string.show(js_name) + "._hd = ") + __dict_Show_string.show(computed_11592)) + "._hd; ") + __dict_Show_string.show(js_name)) + "._tl = ") + __dict_Show_string.show(computed_11592)) + "._tl;"));
          _t11590 = _t11593;
          break _t11591;
        }
        if (_t11589._tag === 15) {
          const computed_11594 = Js_codegen$compile_non_tail(ctx, te);
          const tmp_11596 = Js_codegen$fresh_tmp(ctx);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(tmp_11596)) + " = ") + __dict_Show_string.show(computed_11594)) + ";"));
          const _t11597 = Js_codegen$emit_line(ctx, (((((("for (let _i = 0; _i < " + __dict_Show_string.show(tmp_11596)) + ".length; _i++) ") + __dict_Show_string.show(js_name)) + "[_i] = ") + __dict_Show_string.show(tmp_11596)) + "[_i];"));
          const _t11595 = _t11597;
          _t11590 = _t11595;
          break _t11591;
        }
        if (_t11589._tag === 16) {
          const computed_11598 = Js_codegen$compile_non_tail(ctx, te);
          const _t11599 = Js_codegen$emit_line(ctx, (((("Object.assign(" + __dict_Show_string.show(js_name)) + ", ") + __dict_Show_string.show(computed_11598)) + ");"));
          _t11590 = _t11599;
          break _t11591;
        }
        if (_t11589._tag === 23) {
          const name = _t11589._val[0];
          if (Js_codegen$is_newtype_ctor(ctx.type_env, name)) {
            const _t11600 = te;
            te = _t11600;
            continue;
            _t11590 = undefined;
            break _t11591;
          }
        }
        if (_t11589._tag === 23) {
          const computed_11601 = Js_codegen$compile_non_tail(ctx, te);
          const tmp_11603 = Js_codegen$fresh_tmp(ctx);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(tmp_11603)) + " = ") + __dict_Show_string.show(computed_11601)) + ";"));
          const _t11604 = Js_codegen$emit_line(ctx, (((((((((((((__dict_Show_string.show(js_name) + "._tag = ") + __dict_Show_string.show(tmp_11603)) + "._tag; ") + __dict_Show_string.show(js_name)) + "._name = ") + __dict_Show_string.show(tmp_11603)) + "._name; if (\"_val\" in ") + __dict_Show_string.show(tmp_11603)) + ") ") + __dict_Show_string.show(js_name)) + "._val = ") + __dict_Show_string.show(tmp_11603)) + "._val;"));
          const _t11602 = _t11604;
          _t11590 = _t11602;
          break _t11591;
        }
        if (_t11589._tag === 38) {
          const computed_11605 = Js_codegen$compile_non_tail(ctx, te);
          const tmp_11607 = Js_codegen$fresh_tmp(ctx);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(tmp_11607)) + " = ") + __dict_Show_string.show(computed_11605)) + ";"));
          const _t11608 = Js_codegen$emit_line(ctx, (((((("for (let _i = 0; _i < " + __dict_Show_string.show(tmp_11607)) + "._arr.length; _i++) ") + __dict_Show_string.show(js_name)) + "._arr[_i] = ") + __dict_Show_string.show(tmp_11607)) + "._arr[_i];"));
          const _t11606 = _t11608;
          _t11590 = _t11606;
          break _t11591;
        }
        if ((_t11589._tag === 8 || _t11589._tag === 28)) {
          const _inner = (_t11589._tag === 8 ? _t11589._val[3] : _t11589._val[1]);
          const computed_11609 = Js_codegen$compile_non_tail(ctx, te);
          const _t11610 = Js_codegen$emit_line(ctx, (((("Object.assign(" + __dict_Show_string.show(js_name)) + ", ") + __dict_Show_string.show(computed_11609)) + ");"));
          _t11590 = _t11610;
          break _t11591;
        }
        if (true) {
          const computed_11611 = Js_codegen$compile_non_tail(ctx, te);
          const _t11612 = Js_codegen$emit_line(ctx, (((("Object.assign(" + __dict_Show_string.show(js_name)) + ", ") + __dict_Show_string.show(computed_11611)) + ");"));
          _t11590 = _t11612;
          break _t11591;
        }
        _match_fail("line 16629");
      }
      return _t11590;
    }
  }
  const _t11613 = go(te);
  return _t11613;
}
function Js_codegen$compile_letrec(ctx, name, fn_expr, body) {
  const js_name_11614 = Js_codegen$mangle_name(name);
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, js_name_11614);
  let _t11617;
  const _t11616 = fn_expr.expr;
  _t11618: {
    if (_t11616._tag === 10) {
      _t11617 = Js_codegen$compile_named_function(ctx, js_name_11614, fn_expr);
      break _t11618;
    }
    if (true) {
      Js_codegen$emit_js_placeholder(ctx, js_name_11614, fn_expr);
      _t11617 = Js_codegen$emit_js_backpatch(ctx, js_name_11614, fn_expr);
      break _t11618;
    }
    _match_fail("line 16629");
  }
  _t11617;
  const result_11619 = Js_codegen$fresh_tmp(ctx);
  const v_11621 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11619)) + " = ") + __dict_Show_string.show(v_11621)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11622 = result_11619;
  const _t11620 = _t11622;
  const _t11615 = _t11620;
  return _t11615;
}
function Js_codegen$compile_letrec_and(ctx, bindings, body) {
  Js_codegen$push_scope(ctx);
  function _t11623(__p413) {
    let _t11625;
    const _t11624 = __p413;
    _t11626: {
      if (true) {
        const name = _t11624[0];
        const te = _t11624[1];
        const js_name_11627 = Js_codegen$mangle_name(name);
        Js_codegen$bind_var(ctx, name, js_name_11627);
        let _t11630;
        const _t11629 = te.expr;
        _t11631: {
          if (_t11629._tag === 10) {
            _t11630 = undefined;
            break _t11631;
          }
          if (true) {
            _t11630 = Js_codegen$emit_js_placeholder(ctx, js_name_11627, te);
            break _t11631;
          }
          _match_fail("line 16629");
        }
        const _t11628 = _t11630;
        _t11625 = _t11628;
        break _t11626;
      }
      _match_fail("line 16629");
    }
    return _t11625;
  }
  List$iter(_t11623, bindings);
  function _t11632(__p414) {
    let _t11634;
    const _t11633 = __p414;
    _t11635: {
      if (true) {
        const name = _t11633[0];
        const fn_expr = _t11633[1];
        const js_name_11636 = Js_codegen$mangle_name(name);
        let _t11639;
        const _t11638 = fn_expr.expr;
        _t11640: {
          if (_t11638._tag === 10) {
            _t11639 = Js_codegen$compile_named_function(ctx, js_name_11636, fn_expr);
            break _t11640;
          }
          if (true) {
            _t11639 = undefined;
            break _t11640;
          }
          _match_fail("line 16629");
        }
        const _t11637 = _t11639;
        _t11634 = _t11637;
        break _t11635;
      }
      _match_fail("line 16629");
    }
    return _t11634;
  }
  List$iter(_t11632, bindings);
  function _t11641(__p415) {
    let _t11643;
    const _t11642 = __p415;
    _t11644: {
      if (true) {
        const name = _t11642[0];
        const te = _t11642[1];
        const js_name_11645 = Js_codegen$mangle_name(name);
        let _t11648;
        const _t11647 = te.expr;
        _t11649: {
          if (_t11647._tag === 10) {
            _t11648 = undefined;
            break _t11649;
          }
          if (true) {
            _t11648 = Js_codegen$emit_js_backpatch(ctx, js_name_11645, te);
            break _t11649;
          }
          _match_fail("line 16629");
        }
        const _t11646 = _t11648;
        _t11643 = _t11646;
        break _t11644;
      }
      _match_fail("line 16629");
    }
    return _t11643;
  }
  List$iter(_t11641, bindings);
  const result_11650 = Js_codegen$fresh_tmp(ctx);
  const v_11652 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11650)) + " = ") + __dict_Show_string.show(v_11652)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11653 = result_11650;
  const _t11651 = _t11653;
  return _t11651;
}
function Js_codegen$compile_fun(ctx, param, body) {
  function collect_params(params, body_expr) {
    while (true) {
      let _t11655;
      const _t11654 = body_expr.expr;
      _t11656: {
        if (_t11654._tag === 10) {
          const p = _t11654._val[0];
          const inner = _t11654._val[1];
          const _t11657 = ({_hd: p, _tl: params});
          const _t11658 = inner;
          params = _t11657;
          body_expr = _t11658;
          continue;
          _t11655 = undefined;
          break _t11656;
        }
        if (true) {
          _t11655 = [List$rev(params), body_expr];
          break _t11656;
        }
        _match_fail("line 16629");
      }
      return _t11655;
    }
  }
  let _t11661;
  const _t11660 = collect_params(({_hd: param, _tl: null}), body);
  _t11662: {
    if (true) {
      const all_params = _t11660[0];
      const final_body = _t11660[1];
      const js_params_11663 = Js_codegen$dedup_js_params(List$map(Js_codegen$mangle_name, all_params));
      const fn_name_11665 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_indent(ctx);
      Js_codegen$emit(ctx, (((("function " + __dict_Show_string.show(fn_name_11665)) + "(") + __dict_Show_string.show(String$concat(", ", js_params_11663))) + ") "));
      Js_codegen$emit(ctx, "{\n");
      (ctx.indent = (ctx.indent + 1), undefined);
      Js_codegen$push_scope(ctx);
      function _t11667(mml_name, js_name) {
        return Js_codegen$bind_var(ctx, mml_name, js_name);
      }
      List$iter2(_t11667, all_params, js_params_11663);
      const saved_fn_11668 = ctx.current_fn_name;
      const saved_params_11670 = ctx.current_fn_params;
      const saved_tco_11672 = ctx.tco_used;
      (ctx.current_fn_name = ({_tag: 0, _name: "None"}), undefined);
      (ctx.current_fn_params = null, undefined);
      (ctx.tco_used = false, undefined);
      const saved_ddo_11674 = ctx.direct_dispatch_ops;
      const saved_two_11676 = ctx.trywith_ops;
      (ctx.direct_dispatch_ops = null, undefined);
      (ctx.trywith_ops = null, undefined);
      let _t11678;
      if (Js_codegen$expr_has_perform(final_body)) {
        Js_codegen$emit_line(ctx, "return _trampoline(function() {");
        (ctx.indent = (ctx.indent + 1), undefined);
        function _t11679(v) {
          return Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v)) + ";"));
        }
        Js_codegen$compile_cps(ctx, final_body, _t11679);
        (ctx.indent = (ctx.indent - 1), undefined);
        _t11678 = Js_codegen$emit_line(ctx, "});");
      } else {
        const v_11680 = Js_codegen$compile_expr(ctx, final_body);
        const _t11681 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11680)) + ";"));
        _t11678 = _t11681;
      }
      _t11678;
      (ctx.direct_dispatch_ops = saved_ddo_11674, undefined);
      (ctx.trywith_ops = saved_two_11676, undefined);
      (ctx.current_fn_name = saved_fn_11668, undefined);
      (ctx.current_fn_params = saved_params_11670, undefined);
      (ctx.tco_used = saved_tco_11672, undefined);
      Js_codegen$pop_scope(ctx);
      (ctx.indent = (ctx.indent - 1), undefined);
      Js_codegen$emit_line(ctx, "}");
      const _t11677 = fn_name_11665;
      const _t11675 = _t11677;
      const _t11673 = _t11675;
      const _t11671 = _t11673;
      const _t11669 = _t11671;
      const _t11666 = _t11669;
      const _t11664 = _t11666;
      _t11661 = _t11664;
      break _t11662;
    }
    _match_fail("line 16629");
  }
  const _t11659 = _t11661;
  return _t11659;
}
function Js_codegen$compile_named_function(ctx, js_name, fn_expr) {
  function collect_params(params, body_expr) {
    while (true) {
      let _t11683;
      const _t11682 = body_expr.expr;
      _t11684: {
        if (_t11682._tag === 10) {
          const p = _t11682._val[0];
          const inner = _t11682._val[1];
          const _t11685 = ({_hd: p, _tl: params});
          const _t11686 = inner;
          params = _t11685;
          body_expr = _t11686;
          continue;
          _t11683 = undefined;
          break _t11684;
        }
        if (true) {
          _t11683 = [List$rev(params), body_expr];
          break _t11684;
        }
        _match_fail("line 16629");
      }
      return _t11683;
    }
  }
  let _t11689;
  const _t11688 = fn_expr.expr;
  _t11690: {
    if (_t11688._tag === 10) {
      const param = _t11688._val[0];
      const body = _t11688._val[1];
      const has_return = _t11688._val[2];
      let _t11692;
      const _t11691 = collect_params(({_hd: param, _tl: null}), body);
      _t11693: {
        if (true) {
          const all_params = _t11691[0];
          const final_body = _t11691[1];
          const js_params_11694 = Js_codegen$dedup_js_params(List$map(Js_codegen$mangle_name, all_params));
          Js_codegen$emit_indent(ctx);
          Js_codegen$emit(ctx, (((("function " + __dict_Show_string.show(js_name)) + "(") + __dict_Show_string.show(String$concat(", ", js_params_11694))) + ") "));
          Js_codegen$emit(ctx, "{\n");
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          function _t11696(mml_name, js_nm) {
            return Js_codegen$bind_var(ctx, mml_name, js_nm);
          }
          List$iter2(_t11696, all_params, js_params_11694);
          const saved_fn_11697 = ctx.current_fn_name;
          const saved_params_11699 = ctx.current_fn_params;
          const saved_tco_11701 = ctx.tco_used;
          (ctx.current_fn_name = ({_tag: 1, _name: "Some", _val: js_name}), undefined);
          (ctx.current_fn_params = js_params_11694, undefined);
          (ctx.tco_used = false, undefined);
          (ctx.in_tail_position = true, undefined);
          const saved_ddo_11703 = ctx.direct_dispatch_ops;
          const saved_two_11705 = ctx.trywith_ops;
          (ctx.direct_dispatch_ops = null, undefined);
          (ctx.trywith_ops = null, undefined);
          const body_code_start_11707 = Buffer$length(ctx.buf);
          let _t11709;
          if (Js_codegen$expr_has_perform(final_body)) {
            Js_codegen$emit_line(ctx, "return _trampoline(function() {");
            (ctx.indent = (ctx.indent + 1), undefined);
            function _t11710(v) {
              return Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v)) + ";"));
            }
            Js_codegen$compile_cps(ctx, final_body, _t11710);
            (ctx.indent = (ctx.indent - 1), undefined);
            _t11709 = Js_codegen$emit_line(ctx, (("}, " + __dict_Show_string.show(js_name)) + ");"));
          } else {
            let _t11711;
            if (has_return) {
              Js_codegen$emit_line(ctx, "let _ret_flag = false, _ret_val;");
              const v_11712 = Js_codegen$compile_expr(ctx, final_body);
              const _t11713 = Js_codegen$emit_line(ctx, (("return _ret_flag ? _ret_val : " + __dict_Show_string.show(v_11712)) + ";"));
              _t11711 = _t11713;
            } else {
              const v_11714 = Js_codegen$compile_expr(ctx, final_body);
              const _t11715 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11714)) + ";"));
              _t11711 = _t11715;
            }
            _t11709 = _t11711;
          }
          _t11709;
          const tco_was_used_11716 = ctx.tco_used;
          (ctx.direct_dispatch_ops = saved_ddo_11703, undefined);
          (ctx.trywith_ops = saved_two_11705, undefined);
          (ctx.current_fn_name = saved_fn_11697, undefined);
          (ctx.current_fn_params = saved_params_11699, undefined);
          (ctx.tco_used = saved_tco_11701, undefined);
          (ctx.in_tail_position = false, undefined);
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          let _t11718;
          if (tco_was_used_11716) {
            const full_code_11719 = Buffer$contents(ctx.buf);
            const body_code_11721 = String$sub(full_code_11719, body_code_start_11707, (String$length(full_code_11719) - body_code_start_11707));
            const before_body_11723 = String$sub(full_code_11719, 0, body_code_start_11707);
            Buffer$clear(ctx.buf);
            Buffer$add_string(ctx.buf, before_body_11723);
            const indent_str_11725 = String$make(((ctx.indent + 1) * 2), 32);
            Buffer$add_string(ctx.buf, (indent_str_11725 + "while (true) {\n"));
            const body_lines_11727 = String$split("\n", body_code_11721);
            function _t11729(line) {
              let _t11730;
              if ((String$length(line) > 0)) {
                _t11730 = Buffer$add_string(ctx.buf, ("  " + (line + "\n")));
              } else {
                _t11730 = undefined;
              }
              return _t11730;
            }
            List$iter(_t11729, body_lines_11727);
            const _t11728 = Buffer$add_string(ctx.buf, (indent_str_11725 + "}\n"));
            const _t11726 = _t11728;
            const _t11724 = _t11726;
            const _t11722 = _t11724;
            const _t11720 = _t11722;
            _t11718 = _t11720;
          } else {
            _t11718 = undefined;
          }
          _t11718;
          const _t11717 = Js_codegen$emit_line(ctx, "}");
          const _t11708 = _t11717;
          const _t11706 = _t11708;
          const _t11704 = _t11706;
          const _t11702 = _t11704;
          const _t11700 = _t11702;
          const _t11698 = _t11700;
          const _t11695 = _t11698;
          _t11692 = _t11695;
          break _t11693;
        }
        _match_fail("line 16629");
      }
      _t11689 = _t11692;
      break _t11690;
    }
    if (true) {
      const v_11731 = Js_codegen$compile_expr(ctx, fn_expr);
      const _t11732 = Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_name)) + " = ") + __dict_Show_string.show(v_11731)) + ";"));
      _t11689 = _t11732;
      break _t11690;
    }
    _match_fail("line 16629");
  }
  const _t11687 = _t11689;
  return _t11687;
}
function Js_codegen$compile_app(ctx, _te, fn_, arg) {
  function collect_args(expr, acc) {
    while (true) {
      let _t11734;
      const _t11733 = expr.expr;
      _t11735: {
        if (_t11733._tag === 11) {
          const inner_fn = _t11733._val[0];
          const inner_arg = _t11733._val[1];
          const _t11736 = inner_fn;
          const _t11737 = ({_hd: inner_arg, _tl: acc});
          expr = _t11736;
          acc = _t11737;
          continue;
          _t11734 = undefined;
          break _t11735;
        }
        if (true) {
          _t11734 = [expr, acc];
          break _t11735;
        }
        _match_fail("line 16629");
      }
      return _t11734;
    }
  }
  let _t11740;
  const _t11739 = collect_args(fn_, ({_hd: arg, _tl: null}));
  _t11741: {
    if (true) {
      const base_fn = _t11739[0];
      const all_args = _t11739[1];
      const n_11742 = List$length(all_args);
      let _t11745;
      const _t11744 = [ctx.current_fn_name, base_fn.expr];
      _t11746: {
        if (_t11744[0]._tag === 1 && _t11744[1]._tag === 7) {
          const fn_name = _t11744[0]._val;
          const var_name = _t11744[1]._val;
          _t11745 = ((Js_codegen$mangle_name(var_name) === fn_name) && (n_11742 === List$length(ctx.current_fn_params)));
          break _t11746;
        }
        if (true) {
          _t11745 = false;
          break _t11746;
        }
        _match_fail("line 16629");
      }
      const is_self_call_11747 = _t11745;
      let _t11749;
      if ((is_self_call_11747 && ctx.in_tail_position)) {
        (ctx.tco_used = true, undefined);
        function _t11750(a) {
          const tmp_11751 = Js_codegen$fresh_tmp(ctx);
          const v_11753 = Js_codegen$compile_non_tail(ctx, a);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(tmp_11751)) + " = ") + __dict_Show_string.show(v_11753)) + ";"));
          const _t11754 = tmp_11751;
          const _t11752 = _t11754;
          return _t11752;
        }
        const arg_tmps_11755 = List$map(_t11750, all_args);
        function _t11757(param, tmp) {
          return Js_codegen$emit_line(ctx, (((__dict_Show_string.show(param) + " = ") + __dict_Show_string.show(tmp)) + ";"));
        }
        List$iter2(_t11757, ctx.current_fn_params, arg_tmps_11755);
        Js_codegen$emit_line(ctx, "continue;");
        const _t11756 = "undefined";
        _t11749 = _t11756;
      } else {
        const fn_js_11758 = Js_codegen$compile_non_tail(ctx, base_fn);
        const args_js_11760 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), all_args);
        const known_arity_11762 = Js_codegen$count_arrows(base_fn.ty);
        function _t11764(a) {
          let _t11766;
          const _t11765 = a.expr;
          _t11767: {
            if (_t11765._tag === 7) {
              const name = _t11765._val;
              _t11766 = (((String$length(name) >= 7) && (String$sub(name, 0, 7) === "__dict_")) || ((String$length(name) >= 5) && (String$sub(name, 0, 5) === "__ev_")));
              break _t11767;
            }
            if (true) {
              _t11766 = false;
              break _t11767;
            }
            _match_fail("line 16629");
          }
          return _t11766;
        }
        const has_implicit_args_11768 = List$exists(_t11764, all_args);
        let _t11770;
        if ((_eq(known_arity_11762, ({_tag: 1, _name: "Some", _val: n_11742})) && (!has_implicit_args_11768))) {
          _t11770 = (fn_js_11758 + ("(" + (String$concat(", ", args_js_11760) + ")")));
        } else {
          _t11770 = ("_call(" + (fn_js_11758 + (", [" + (String$concat(", ", args_js_11760) + "])"))));
        }
        const _t11769 = _t11770;
        const _t11763 = _t11769;
        const _t11761 = _t11763;
        const _t11759 = _t11761;
        _t11749 = _t11759;
      }
      const _t11748 = _t11749;
      const _t11743 = _t11748;
      _t11740 = _t11743;
      break _t11741;
    }
    _match_fail("line 16629");
  }
  const _t11738 = _t11740;
  return _t11738;
}
function Js_codegen$count_arrows(ty) {
  function go(ty, n) {
    while (true) {
      let _t11772;
      const _t11771 = Types$repr(ty);
      _t11773: {
        if (_t11771._tag === 7) {
          const ret = _t11771._val[2];
          const _t11774 = ret;
          const _t11775 = (n + 1);
          ty = _t11774;
          n = _t11775;
          continue;
          _t11772 = undefined;
          break _t11773;
        }
        if (true) {
          _t11772 = n;
          break _t11773;
        }
        _match_fail("line 16629");
      }
      return _t11772;
    }
  }
  const n_11777 = go(ty, 0);
  let _t11779;
  if ((n_11777 > 0)) {
    _t11779 = ({_tag: 1, _name: "Some", _val: n_11777});
  } else {
    _t11779 = ({_tag: 0, _name: "None"});
  }
  const _t11778 = _t11779;
  const _t11776 = _t11778;
  return _t11776;
}
function Js_codegen$compile_binop(ctx, op, e1, e2) {
  let _t11781;
  const _t11780 = op;
  _t11782: {
    if (_t11780._tag === 11) {
      const a_11783 = Js_codegen$compile_non_tail(ctx, e1);
      const buf_before_11785 = Buffer$length(ctx.buf);
      const b_11787 = Js_codegen$compile_non_tail(ctx, e2);
      let _t11789;
      if ((Buffer$length(ctx.buf) === buf_before_11785)) {
        _t11789 = ("(" + (a_11783 + (" && " + (b_11787 + ")"))));
      } else {
        const stmts_11790 = Buffer$sub(ctx.buf, buf_before_11785, (Buffer$length(ctx.buf) - buf_before_11785));
        Buffer$truncate(ctx.buf, buf_before_11785);
        const result_11792 = Js_codegen$fresh_tmp(ctx);
        Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_11792)) + ";"));
        Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(a_11783)) + ") {"));
        (ctx.indent = (ctx.indent + 1), undefined);
        Buffer$add_string(ctx.buf, stmts_11790);
        Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11792) + " = ") + __dict_Show_string.show(b_11787)) + ";"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "} else {");
        (ctx.indent = (ctx.indent + 1), undefined);
        Js_codegen$emit_line(ctx, (__dict_Show_string.show(result_11792) + " = false;"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "}");
        const _t11793 = result_11792;
        const _t11791 = _t11793;
        _t11789 = _t11791;
      }
      const _t11788 = _t11789;
      const _t11786 = _t11788;
      const _t11784 = _t11786;
      _t11781 = _t11784;
      break _t11782;
    }
    if (_t11780._tag === 12) {
      const a_11794 = Js_codegen$compile_non_tail(ctx, e1);
      const buf_before_11796 = Buffer$length(ctx.buf);
      const b_11798 = Js_codegen$compile_non_tail(ctx, e2);
      let _t11800;
      if ((Buffer$length(ctx.buf) === buf_before_11796)) {
        _t11800 = ("(" + (a_11794 + (" || " + (b_11798 + ")"))));
      } else {
        const stmts_11801 = Buffer$sub(ctx.buf, buf_before_11796, (Buffer$length(ctx.buf) - buf_before_11796));
        Buffer$truncate(ctx.buf, buf_before_11796);
        const result_11803 = Js_codegen$fresh_tmp(ctx);
        Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_11803)) + ";"));
        Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(a_11794)) + ") {"));
        (ctx.indent = (ctx.indent + 1), undefined);
        Js_codegen$emit_line(ctx, (__dict_Show_string.show(result_11803) + " = true;"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "} else {");
        (ctx.indent = (ctx.indent + 1), undefined);
        Buffer$add_string(ctx.buf, stmts_11801);
        Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11803) + " = ") + __dict_Show_string.show(b_11798)) + ";"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "}");
        const _t11804 = result_11803;
        const _t11802 = _t11804;
        _t11800 = _t11802;
      }
      const _t11799 = _t11800;
      const _t11797 = _t11799;
      const _t11795 = _t11797;
      _t11781 = _t11795;
      break _t11782;
    }
    if ((((_t11780._tag === 0 || _t11780._tag === 1) || _t11780._tag === 2) || _t11780._tag === 3)) {
      const resolved_11805 = Types$repr(e1.ty);
      let _t11808;
      const _t11807 = resolved_11805;
      _t11809: {
        if ((_t11807._tag === 0 || _t11807._tag === 1)) {
          const a_11810 = Js_codegen$compile_non_tail(ctx, e1);
          const b_11812 = Js_codegen$compile_non_tail(ctx, e2);
          let _t11815;
          const _t11814 = op;
          _t11816: {
            if (_t11814._tag === 0) {
              _t11815 = "+";
              break _t11816;
            }
            if (_t11814._tag === 1) {
              _t11815 = "-";
              break _t11816;
            }
            if (_t11814._tag === 2) {
              _t11815 = "*";
              break _t11816;
            }
            if (_t11814._tag === 3) {
              _t11815 = "/";
              break _t11816;
            }
            if (true) {
              _t11815 = failwith("assert false");
              break _t11816;
            }
            _match_fail("line 16629");
          }
          const js_op_11817 = _t11815;
          let _t11819;
          if ((_eq(resolved_11805, ({_tag: 0, _name: "TInt"})) && _eq(op, ({_tag: 3, _name: "Div"})))) {
            _t11819 = ("((" + (a_11810 + (" " + (js_op_11817 + (" " + (b_11812 + ") | 0)"))))));
          } else {
            _t11819 = ("(" + (a_11810 + (" " + (js_op_11817 + (" " + (b_11812 + ")"))))));
          }
          const _t11818 = _t11819;
          const _t11813 = _t11818;
          const _t11811 = _t11813;
          _t11808 = _t11811;
          break _t11809;
        }
        if (true) {
          let _t11821;
          const _t11820 = op;
          _t11822: {
            if (_t11820._tag === 0) {
              _t11821 = "+";
              break _t11822;
            }
            if (_t11820._tag === 1) {
              _t11821 = "-";
              break _t11822;
            }
            if (_t11820._tag === 2) {
              _t11821 = "*";
              break _t11822;
            }
            if (_t11820._tag === 3) {
              _t11821 = "/";
              break _t11822;
            }
            if (true) {
              _t11821 = failwith("assert false");
              break _t11822;
            }
            _match_fail("line 16629");
          }
          const method_name_11823 = _t11821;
          const _t11824 = Js_codegen$compile_class_binop(ctx, "Num", method_name_11823, e1, e2);
          _t11808 = _t11824;
          break _t11809;
        }
        _match_fail("line 16629");
      }
      const _t11806 = _t11808;
      _t11781 = _t11806;
      break _t11782;
    }
    if (_t11780._tag === 4) {
      const a_11825 = Js_codegen$compile_non_tail(ctx, e1);
      const b_11827 = Js_codegen$compile_non_tail(ctx, e2);
      const _t11828 = ("(" + (a_11825 + (" % " + (b_11827 + ")"))));
      const _t11826 = _t11828;
      _t11781 = _t11826;
      break _t11782;
    }
    if ((_t11780._tag === 5 || _t11780._tag === 6)) {
      const resolved_11829 = Types$repr(e1.ty);
      let _t11832;
      const _t11831 = resolved_11829;
      _t11833: {
        if (((((((_t11831._tag === 0 || _t11831._tag === 1) || _t11831._tag === 2) || _t11831._tag === 3) || _t11831._tag === 4) || _t11831._tag === 5) || _t11831._tag === 6)) {
          _t11832 = true;
          break _t11833;
        }
        if (true) {
          _t11832 = false;
          break _t11833;
        }
        _match_fail("line 16629");
      }
      const is_primitive_11834 = _t11832;
      const a_11836 = Js_codegen$compile_non_tail(ctx, e1);
      const b_11838 = Js_codegen$compile_non_tail(ctx, e2);
      let _t11840;
      if (is_primitive_11834) {
        let _t11841;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t11841 = "===";
        } else {
          _t11841 = "!==";
        }
        const js_op_11842 = _t11841;
        const _t11843 = ("(" + (a_11836 + (" " + (js_op_11842 + (" " + (b_11838 + ")"))))));
        _t11840 = _t11843;
      } else {
        const eq_call_11844 = ("_eq(" + (a_11836 + (", " + (b_11838 + ")"))));
        let _t11846;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t11846 = eq_call_11844;
        } else {
          _t11846 = ("!" + eq_call_11844);
        }
        const _t11845 = _t11846;
        _t11840 = _t11845;
      }
      const _t11839 = _t11840;
      const _t11837 = _t11839;
      const _t11835 = _t11837;
      const _t11830 = _t11835;
      _t11781 = _t11830;
      break _t11782;
    }
    if ((((_t11780._tag === 7 || _t11780._tag === 8) || _t11780._tag === 9) || _t11780._tag === 10)) {
      const resolved_11847 = Types$repr(e1.ty);
      let _t11850;
      const _t11849 = resolved_11847;
      _t11851: {
        if ((((((_t11849._tag === 0 || _t11849._tag === 1) || _t11849._tag === 3) || _t11849._tag === 4) || _t11849._tag === 5) || _t11849._tag === 15 && _t11849._val.contents._tag === 0)) {
          _t11850 = true;
          break _t11851;
        }
        if (true) {
          _t11850 = false;
          break _t11851;
        }
        _match_fail("line 16629");
      }
      const is_builtin_11852 = _t11850;
      let _t11854;
      if (is_builtin_11852) {
        const a_11855 = Js_codegen$compile_non_tail(ctx, e1);
        const b_11857 = Js_codegen$compile_non_tail(ctx, e2);
        let _t11860;
        const _t11859 = op;
        _t11861: {
          if (_t11859._tag === 7) {
            _t11860 = "<";
            break _t11861;
          }
          if (_t11859._tag === 8) {
            _t11860 = ">";
            break _t11861;
          }
          if (_t11859._tag === 9) {
            _t11860 = "<=";
            break _t11861;
          }
          if (_t11859._tag === 10) {
            _t11860 = ">=";
            break _t11861;
          }
          if (true) {
            _t11860 = failwith("assert false");
            break _t11861;
          }
          _match_fail("line 16629");
        }
        const js_op_11862 = _t11860;
        const _t11863 = ("(" + (a_11855 + (" " + (js_op_11862 + (" " + (b_11857 + ")"))))));
        const _t11858 = _t11863;
        const _t11856 = _t11858;
        _t11854 = _t11856;
      } else {
        let _t11865;
        const _t11864 = op;
        _t11866: {
          if (_t11864._tag === 7) {
            _t11865 = "<";
            break _t11866;
          }
          if (_t11864._tag === 8) {
            _t11865 = ">";
            break _t11866;
          }
          if (_t11864._tag === 9) {
            _t11865 = "<=";
            break _t11866;
          }
          if (_t11864._tag === 10) {
            _t11865 = ">=";
            break _t11866;
          }
          if (true) {
            _t11865 = failwith("assert false");
            break _t11866;
          }
          _match_fail("line 16629");
        }
        const method_name_11867 = _t11865;
        const _t11868 = Js_codegen$compile_class_binop(ctx, "Ord", method_name_11867, e1, e2);
        _t11854 = _t11868;
      }
      const _t11853 = _t11854;
      const _t11848 = _t11853;
      _t11781 = _t11848;
      break _t11782;
    }
    if (_t11780._tag === 13) {
      const a_11869 = Js_codegen$compile_non_tail(ctx, e1);
      const b_11871 = Js_codegen$compile_non_tail(ctx, e2);
      const _t11872 = ("(" + (a_11869 + (" + " + (b_11871 + ")"))));
      const _t11870 = _t11872;
      _t11781 = _t11870;
      break _t11782;
    }
    if (((((_t11780._tag === 14 || _t11780._tag === 15) || _t11780._tag === 16) || _t11780._tag === 17) || _t11780._tag === 18)) {
      const resolved_11873 = Types$repr(e1.ty);
      let _t11876;
      const _t11875 = resolved_11873;
      _t11877: {
        if (_t11875._tag === 0) {
          const a_11878 = Js_codegen$compile_non_tail(ctx, e1);
          const b_11880 = Js_codegen$compile_non_tail(ctx, e2);
          let _t11883;
          const _t11882 = op;
          _t11884: {
            if (_t11882._tag === 14) {
              _t11883 = "&";
              break _t11884;
            }
            if (_t11882._tag === 15) {
              _t11883 = "|";
              break _t11884;
            }
            if (_t11882._tag === 16) {
              _t11883 = "^";
              break _t11884;
            }
            if (_t11882._tag === 17) {
              _t11883 = "<<";
              break _t11884;
            }
            if (_t11882._tag === 18) {
              _t11883 = ">>";
              break _t11884;
            }
            if (true) {
              _t11883 = failwith("assert false");
              break _t11884;
            }
            _match_fail("line 16629");
          }
          const js_op_11885 = _t11883;
          const _t11886 = ("(" + (a_11878 + (" " + (js_op_11885 + (" " + (b_11880 + ")"))))));
          const _t11881 = _t11886;
          const _t11879 = _t11881;
          _t11876 = _t11879;
          break _t11877;
        }
        if (true) {
          let _t11888;
          const _t11887 = op;
          _t11889: {
            if (_t11887._tag === 14) {
              _t11888 = "land";
              break _t11889;
            }
            if (_t11887._tag === 15) {
              _t11888 = "lor";
              break _t11889;
            }
            if (_t11887._tag === 16) {
              _t11888 = "lxor";
              break _t11889;
            }
            if (_t11887._tag === 17) {
              _t11888 = "lsl";
              break _t11889;
            }
            if (_t11887._tag === 18) {
              _t11888 = "lsr";
              break _t11889;
            }
            if (true) {
              _t11888 = failwith("assert false");
              break _t11889;
            }
            _match_fail("line 16629");
          }
          const method_name_11890 = _t11888;
          const _t11891 = Js_codegen$compile_class_binop(ctx, "Bitwise", method_name_11890, e1, e2);
          _t11876 = _t11891;
          break _t11877;
        }
        _match_fail("line 16629");
      }
      const _t11874 = _t11876;
      _t11781 = _t11874;
      break _t11782;
    }
    if (_t11780._tag === 19) {
      const fn_js_11892 = Js_codegen$compile_non_tail(ctx, e2);
      const arg_js_11894 = Js_codegen$compile_non_tail(ctx, e1);
      const _t11895 = ("_call(" + (fn_js_11892 + (", [" + (arg_js_11894 + "])"))));
      const _t11893 = _t11895;
      _t11781 = _t11893;
      break _t11782;
    }
    _match_fail("line 16629");
  }
  return _t11781;
}
function Js_codegen$compile_class_binop(ctx, class_name, method_name, e1, e2) {
  const conc_ty_11896 = Types$repr(e1.ty);
  function _t11898(c) {
    return (c.class_name === class_name);
  }
  let _t11900;
  const _t11899 = List$find(_t11898, ctx.type_env.classes);
  _t11901: {
    if (_t11899._tag === 1) {
      const cd = _t11899._val;
      _t11900 = cd;
      break _t11901;
    }
    if (_t11899._tag === 0) {
      _t11900 = Js_codegen$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t11901;
    }
    _match_fail("line 16629");
  }
  const class_def_11902 = _t11900;
  const num_params_11904 = List$length(class_def_11902.class_params);
  function _t11906(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_11896});
  }
  const partial_11907 = List$init(num_params_11904, _t11906);
  function _t11909(opt) {
    let _t11911;
    const _t11910 = opt;
    _t11912: {
      if (_t11910._tag === 1) {
        const ty = _t11910._val;
        let _t11914;
        const _t11913 = Types$repr(ty);
        _t11915: {
          if (_t11913._tag === 15 && _t11913._val.contents._tag === 0) {
            _t11914 = ({_tag: 0, _name: "None"});
            break _t11915;
          }
          if (true) {
            _t11914 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t11915;
          }
          _match_fail("line 16629");
        }
        _t11911 = _t11914;
        break _t11912;
      }
      if (_t11910._tag === 0) {
        _t11911 = ({_tag: 0, _name: "None"});
        break _t11912;
      }
      _match_fail("line 16629");
    }
    return _t11911;
  }
  const concrete_partial_11916 = List$map(_t11909, partial_11907);
  function _t11918(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_11904) && Types$match_partial_inst(inst.inst_tys, concrete_partial_11916)));
  }
  const matching_11919 = List$filter(_t11918, ctx.type_env.instances);
  let _t11922;
  const _t11921 = matching_11919;
  _t11923: {
    if (_t11921 !== null && _t11921._tl === null) {
      const inst = _t11921._hd;
      const dict_access_11924 = (Js_codegen$mangle_name(inst.inst_dict_name) + ("." + Js_codegen$mangle_name(method_name)));
      const a_11926 = Js_codegen$compile_non_tail(ctx, e1);
      const b_11928 = Js_codegen$compile_non_tail(ctx, e2);
      const _t11929 = ("_call(" + (dict_access_11924 + (", [" + (a_11926 + (", " + (b_11928 + "])"))))));
      const _t11927 = _t11929;
      const _t11925 = _t11927;
      _t11922 = _t11925;
      break _t11923;
    }
    if (_t11921 === null) {
      _t11922 = Js_codegen$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_11896))));
      break _t11923;
    }
    if (true) {
      let _t11931;
      const _t11930 = Types$most_specific_inst(matching_11919);
      _t11932: {
        if (_t11930._tag === 1) {
          const inst = _t11930._val;
          let _t11933;
          if (_eq(inst.inst_constraints, null)) {
            _t11933 = Js_codegen$mangle_name((inst.inst_dict_name + ("$" + method_name)));
          } else {
            _t11933 = (Js_codegen$mangle_name(inst.inst_dict_name) + ("." + Js_codegen$mangle_name(method_name)));
          }
          const dict_access_11934 = _t11933;
          const a_11936 = Js_codegen$compile_non_tail(ctx, e1);
          const b_11938 = Js_codegen$compile_non_tail(ctx, e2);
          const _t11939 = ("_call(" + (dict_access_11934 + (", [" + (a_11936 + (", " + (b_11938 + "])"))))));
          const _t11937 = _t11939;
          const _t11935 = _t11937;
          _t11931 = _t11935;
          break _t11932;
        }
        if (_t11930._tag === 0) {
          _t11931 = Js_codegen$error(((("ambiguous instance for " + __dict_Show_string.show(class_name)) + " method ") + __dict_Show_string.show(method_name)));
          break _t11932;
        }
        _match_fail("line 16629");
      }
      _t11922 = _t11931;
      break _t11923;
    }
    _match_fail("line 16629");
  }
  const _t11920 = _t11922;
  const _t11917 = _t11920;
  const _t11908 = _t11917;
  const _t11905 = _t11908;
  const _t11903 = _t11905;
  const _t11897 = _t11903;
  return _t11897;
}
function Js_codegen$compile_unop(ctx, op, e) {
  let _t11941;
  const _t11940 = op;
  _t11942: {
    if (_t11940._tag === 0) {
      const resolved_11943 = Types$repr(e.ty);
      let _t11946;
      const _t11945 = resolved_11943;
      _t11947: {
        if ((_t11945._tag === 0 || _t11945._tag === 1)) {
          const v_11948 = Js_codegen$compile_non_tail(ctx, e);
          const _t11949 = ("(-" + (v_11948 + ")"));
          _t11946 = _t11949;
          break _t11947;
        }
        if (true) {
          _t11946 = Js_codegen$compile_class_unop(ctx, "Num", "neg", e);
          break _t11947;
        }
        _match_fail("line 16629");
      }
      const _t11944 = _t11946;
      _t11941 = _t11944;
      break _t11942;
    }
    if (_t11940._tag === 1) {
      const v_11950 = Js_codegen$compile_non_tail(ctx, e);
      const _t11951 = ("(!" + (v_11950 + ")"));
      _t11941 = _t11951;
      break _t11942;
    }
    if (_t11940._tag === 2) {
      const resolved_11952 = Types$repr(e.ty);
      let _t11955;
      const _t11954 = resolved_11952;
      _t11956: {
        if (_t11954._tag === 0) {
          const v_11957 = Js_codegen$compile_non_tail(ctx, e);
          const _t11958 = ("(~" + (v_11957 + ")"));
          _t11955 = _t11958;
          break _t11956;
        }
        if (true) {
          _t11955 = Js_codegen$compile_class_unop(ctx, "Bitwise", "lnot", e);
          break _t11956;
        }
        _match_fail("line 16629");
      }
      const _t11953 = _t11955;
      _t11941 = _t11953;
      break _t11942;
    }
    _match_fail("line 16629");
  }
  return _t11941;
}
function Js_codegen$compile_class_unop(ctx, class_name, method_name, e) {
  const conc_ty_11959 = Types$repr(e.ty);
  function _t11961(c) {
    return (c.class_name === class_name);
  }
  let _t11963;
  const _t11962 = List$find(_t11961, ctx.type_env.classes);
  _t11964: {
    if (_t11962._tag === 1) {
      const cd = _t11962._val;
      _t11963 = cd;
      break _t11964;
    }
    if (_t11962._tag === 0) {
      _t11963 = Js_codegen$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t11964;
    }
    _match_fail("line 16629");
  }
  const class_def_11965 = _t11963;
  const num_params_11967 = List$length(class_def_11965.class_params);
  function _t11969(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_11959});
  }
  const partial_11970 = List$init(num_params_11967, _t11969);
  function _t11972(opt) {
    let _t11974;
    const _t11973 = opt;
    _t11975: {
      if (_t11973._tag === 1) {
        const ty = _t11973._val;
        let _t11977;
        const _t11976 = Types$repr(ty);
        _t11978: {
          if (_t11976._tag === 15 && _t11976._val.contents._tag === 0) {
            _t11977 = ({_tag: 0, _name: "None"});
            break _t11978;
          }
          if (true) {
            _t11977 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t11978;
          }
          _match_fail("line 16629");
        }
        _t11974 = _t11977;
        break _t11975;
      }
      if (_t11973._tag === 0) {
        _t11974 = ({_tag: 0, _name: "None"});
        break _t11975;
      }
      _match_fail("line 16629");
    }
    return _t11974;
  }
  const concrete_partial_11979 = List$map(_t11972, partial_11970);
  function _t11981(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_11967) && Types$match_partial_inst(inst.inst_tys, concrete_partial_11979)));
  }
  const matching_11982 = List$filter(_t11981, ctx.type_env.instances);
  let _t11985;
  const _t11984 = matching_11982;
  _t11986: {
    if (_t11984 !== null && _t11984._tl === null) {
      const inst = _t11984._hd;
      const dict_access_11987 = (Js_codegen$mangle_name(inst.inst_dict_name) + ("." + Js_codegen$mangle_name(method_name)));
      const v_11989 = Js_codegen$compile_non_tail(ctx, e);
      const _t11990 = ("_call(" + (dict_access_11987 + (", [" + (v_11989 + "])"))));
      const _t11988 = _t11990;
      _t11985 = _t11988;
      break _t11986;
    }
    if (_t11984 === null) {
      _t11985 = Js_codegen$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_11959))));
      break _t11986;
    }
    if (true) {
      _t11985 = Js_codegen$error(("ambiguous instance for " + __dict_Show_string.show(class_name)));
      break _t11986;
    }
    _match_fail("line 16629");
  }
  const _t11983 = _t11985;
  const _t11980 = _t11983;
  const _t11971 = _t11980;
  const _t11968 = _t11971;
  const _t11966 = _t11968;
  const _t11960 = _t11966;
  return _t11960;
}
function Js_codegen$compile_if(ctx, cond, then_e, else_e) {
  const c_11991 = Js_codegen$compile_expr(ctx, cond);
  const result_11993 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_11993)) + ";"));
  Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(c_11991)) + ") {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  const t_11995 = Js_codegen$compile_expr(ctx, then_e);
  Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11993) + " = ") + __dict_Show_string.show(t_11995)) + ";"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "} else {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const e_11997 = Js_codegen$compile_expr(ctx, else_e);
  Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11993) + " = ") + __dict_Show_string.show(e_11997)) + ";"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  const _t11998 = result_11993;
  const _t11996 = _t11998;
  const _t11994 = _t11996;
  const _t11992 = _t11994;
  return _t11992;
}
function Js_codegen$compile_seq(ctx, e1, e2) {
  const v1_11999 = Js_codegen$compile_non_tail(ctx, e1);
  Js_codegen$emit_line(ctx, (v1_11999 + ";"));
  const _t12000 = Js_codegen$compile_expr(ctx, e2);
  return _t12000;
}
function Js_codegen$compile_let_mut(ctx, name, init, body) {
  const v_12001 = Js_codegen$compile_expr(ctx, init);
  const js_name_12003 = Js_codegen$mangle_name(name);
  const actual_name_12005 = (js_name_12003 + ("_" + string_of_int(ctx.tmp_counter)));
  (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, actual_name_12005);
  Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(actual_name_12005)) + " = ") + __dict_Show_string.show(v_12001)) + ";"));
  const result_12007 = Js_codegen$fresh_tmp(ctx);
  const b_12009 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_12007)) + " = ") + __dict_Show_string.show(b_12009)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t12010 = result_12007;
  const _t12008 = _t12010;
  const _t12006 = _t12008;
  const _t12004 = _t12006;
  const _t12002 = _t12004;
  return _t12002;
}
function Js_codegen$compile_while(ctx, cond, body) {
  const result_12011 = Js_codegen$fresh_tmp(ctx);
  const break_flag_12013 = Js_codegen$fresh_tmp(ctx);
  const break_val_12015 = Js_codegen$fresh_tmp(ctx);
  const saved_break_flag_12017 = ctx.break_flag_name;
  const saved_break_val_12019 = ctx.break_val_name;
  (ctx.break_flag_name = break_flag_12013, undefined);
  (ctx.break_val_name = break_val_12015, undefined);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_12011)) + " = undefined;"));
  Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(break_flag_12013)) + " = false, ") + __dict_Show_string.show(break_val_12015)) + ";"));
  Js_codegen$emit_line(ctx, "while (true) {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const c_12021 = Js_codegen$compile_expr(ctx, cond);
  Js_codegen$emit_line(ctx, (("if (!(" + __dict_Show_string.show(c_12021)) + ")) break;"));
  const v_body_12023 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (v_body_12023 + ";"));
  Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(break_flag_12013)) + ") break;"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  Js_codegen$emit_line(ctx, (((((__dict_Show_string.show(result_12011) + " = ") + __dict_Show_string.show(break_flag_12013)) + " ? ") + __dict_Show_string.show(break_val_12015)) + " : undefined;"));
  (ctx.break_flag_name = saved_break_flag_12017, undefined);
  (ctx.break_val_name = saved_break_val_12019, undefined);
  const _t12024 = result_12011;
  const _t12022 = _t12024;
  const _t12020 = _t12022;
  const _t12018 = _t12020;
  const _t12016 = _t12018;
  const _t12014 = _t12016;
  const _t12012 = _t12014;
  return _t12012;
}
function Js_codegen$compile_match(ctx, scrut, arms, loc) {
  const scrut_js_12025 = Js_codegen$compile_non_tail(ctx, scrut);
  const scrut_tmp_12027 = Js_codegen$fresh_tmp(ctx);
  const result_12029 = Js_codegen$fresh_tmp(ctx);
  const label_12031 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_12029)) + ";"));
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(scrut_tmp_12027)) + " = ") + __dict_Show_string.show(scrut_js_12025)) + ";"));
  Js_codegen$emit_line(ctx, (__dict_Show_string.show(label_12031) + ": {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  function _t12033(__p416) {
    let _t12035;
    const _t12034 = __p416;
    _t12036: {
      if (true) {
        const pat = _t12034[0];
        const guard = _t12034[1];
        const body = _t12034[2];
        let _t12038;
        const _t12037 = Js_codegen$compile_pattern(ctx, scrut_tmp_12027, pat);
        _t12039: {
          if (true) {
            const conds = _t12037[0];
            const bindings = _t12037[1];
            let _t12041;
            const _t12040 = conds;
            _t12042: {
              if (_t12040 === null) {
                _t12041 = "true";
                break _t12042;
              }
              if (true) {
                _t12041 = String$concat(" && ", conds);
                break _t12042;
              }
              _match_fail("line 16629");
            }
            const cond_str_12043 = _t12041;
            Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(cond_str_12043)) + ") {"));
            (ctx.indent = (ctx.indent + 1), undefined);
            Js_codegen$push_scope(ctx);
            function _t12045(__p417) {
              let _t12047;
              const _t12046 = __p417;
              _t12048: {
                if (true) {
                  const mml_name = _t12046[0];
                  const js_expr = _t12046[1];
                  const js_name_12049 = Js_codegen$mangle_name(mml_name);
                  Js_codegen$bind_var(ctx, mml_name, js_name_12049);
                  const _t12050 = Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_name_12049)) + " = ") + __dict_Show_string.show(js_expr)) + ";"));
                  _t12047 = _t12050;
                  break _t12048;
                }
                _match_fail("line 16629");
              }
              return _t12047;
            }
            List$iter(_t12045, bindings);
            let _t12052;
            const _t12051 = guard;
            _t12053: {
              if (_t12051._tag === 1) {
                const g = _t12051._val;
                const guard_js_12054 = Js_codegen$compile_expr(ctx, g);
                Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(guard_js_12054)) + ") {"));
                (ctx.indent = (ctx.indent + 1), undefined);
                const b_12056 = Js_codegen$compile_expr(ctx, body);
                Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_12029) + " = ") + __dict_Show_string.show(b_12056)) + ";"));
                Js_codegen$emit_line(ctx, (("break " + __dict_Show_string.show(label_12031)) + ";"));
                (ctx.indent = (ctx.indent - 1), undefined);
                const _t12057 = Js_codegen$emit_line(ctx, "}");
                const _t12055 = _t12057;
                _t12052 = _t12055;
                break _t12053;
              }
              if (_t12051._tag === 0) {
                const b_12058 = Js_codegen$compile_expr(ctx, body);
                Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_12029) + " = ") + __dict_Show_string.show(b_12058)) + ";"));
                const _t12059 = Js_codegen$emit_line(ctx, (("break " + __dict_Show_string.show(label_12031)) + ";"));
                _t12052 = _t12059;
                break _t12053;
              }
              _match_fail("line 16629");
            }
            _t12052;
            Js_codegen$pop_scope(ctx);
            (ctx.indent = (ctx.indent - 1), undefined);
            const _t12044 = Js_codegen$emit_line(ctx, "}");
            _t12038 = _t12044;
            break _t12039;
          }
          _match_fail("line 16629");
        }
        _t12035 = _t12038;
        break _t12036;
      }
      _match_fail("line 16629");
    }
    return _t12035;
  }
  List$iter(_t12033, arms);
  Js_codegen$emit_line(ctx, (("_match_fail(\"line " + __dict_Show_int.show(loc.line)) + "\");"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  const _t12032 = result_12029;
  const _t12030 = _t12032;
  const _t12028 = _t12030;
  const _t12026 = _t12028;
  return _t12026;
}
function Js_codegen$compile_pattern(ctx, scrutinee, pat) {
  while (true) {
    let _t12061;
    const _t12060 = pat;
    _t12062: {
      if (_t12060._tag === 0) {
        _t12061 = [null, null];
        break _t12062;
      }
      if (_t12060._tag === 1) {
        const name = _t12060._val;
        _t12061 = [null, ({_hd: [name, scrutinee], _tl: null})];
        break _t12062;
      }
      if (_t12060._tag === 2) {
        const n = _t12060._val;
        _t12061 = [({_hd: ((__dict_Show_string.show(scrutinee) + " === ") + __dict_Show_int.show(n)), _tl: null}), null];
        break _t12062;
      }
      if (_t12060._tag === 3) {
        const f = _t12060._val;
        _t12061 = [({_hd: ((__dict_Show_string.show(scrutinee) + " === ") + __dict_Show_string.show(__dict_Show_float.show(f))), _tl: null}), null];
        break _t12062;
      }
      if (_t12060._tag === 4 && _t12060._val) {
        _t12061 = [({_hd: scrutinee, _tl: null}), null];
        break _t12062;
      }
      if (_t12060._tag === 4 && !_t12060._val) {
        _t12061 = [({_hd: ("!" + scrutinee), _tl: null}), null];
        break _t12062;
      }
      if (_t12060._tag === 5) {
        const s = _t12060._val;
        _t12061 = [({_hd: ((__dict_Show_string.show(scrutinee) + " === ") + __dict_Show_string.show(Js_codegen$escape_js_string(s))), _tl: null}), null];
        break _t12062;
      }
      if (_t12060._tag === 6) {
        _t12061 = [null, null];
        break _t12062;
      }
      if (_t12060._tag === 9) {
        _t12061 = [({_hd: (scrutinee + " === null"), _tl: null}), null];
        break _t12062;
      }
      if (_t12060._tag === 8) {
        const hd_pat = _t12060._val[0];
        const tl_pat = _t12060._val[1];
        const hd_expr_12063 = (scrutinee + "._hd");
        const tl_expr_12065 = (scrutinee + "._tl");
        let _t12068;
        const _t12067 = Js_codegen$compile_pattern(ctx, hd_expr_12063, hd_pat);
        _t12069: {
          if (true) {
            const hd_conds = _t12067[0];
            const hd_binds = _t12067[1];
            let _t12071;
            const _t12070 = Js_codegen$compile_pattern(ctx, tl_expr_12065, tl_pat);
            _t12072: {
              if (true) {
                const tl_conds = _t12070[0];
                const tl_binds = _t12070[1];
                const conds_12073 = List$concat(({_hd: (scrutinee + " !== null"), _tl: hd_conds}), tl_conds);
                const _t12074 = [conds_12073, List$concat(hd_binds, tl_binds)];
                _t12071 = _t12074;
                break _t12072;
              }
              _match_fail("line 16629");
            }
            _t12068 = _t12071;
            break _t12069;
          }
          _match_fail("line 16629");
        }
        const _t12066 = _t12068;
        const _t12064 = _t12066;
        _t12061 = _t12064;
        break _t12062;
      }
      if (_t12060._tag === 7) {
        const pats = _t12060._val;
        const all_conds_12075 = Ref$create(null);
        const all_binds_12077 = Ref$create(null);
        function _t12079(i, sub_pat) {
          const elem_expr_12080 = (((__dict_Show_string.show(scrutinee) + "[") + __dict_Show_int.show(i)) + "]");
          let _t12083;
          const _t12082 = Js_codegen$compile_pattern(ctx, elem_expr_12080, sub_pat);
          _t12084: {
            if (true) {
              const c = _t12082[0];
              const b = _t12082[1];
              Ref$set(all_conds_12075, List$concat(Ref$get(all_conds_12075), c));
              _t12083 = Ref$set(all_binds_12077, List$concat(Ref$get(all_binds_12077), b));
              break _t12084;
            }
            _match_fail("line 16629");
          }
          const _t12081 = _t12083;
          return _t12081;
        }
        List$iteri(_t12079, pats);
        const _t12078 = [Ref$get(all_conds_12075), Ref$get(all_binds_12077)];
        const _t12076 = _t12078;
        _t12061 = _t12076;
        break _t12062;
      }
      if (_t12060._tag === 10) {
        const name = _t12060._val[0];
        const arg_pat = _t12060._val[1];
        if (Js_codegen$is_newtype_ctor(ctx.type_env, name)) {
          let _t12086;
          const _t12085 = arg_pat;
          _t12087: {
            if (_t12085._tag === 1) {
              const sub_pat = _t12085._val;
              const _t12088 = ctx;
              const _t12089 = scrutinee;
              const _t12090 = sub_pat;
              ctx = _t12088;
              scrutinee = _t12089;
              pat = _t12090;
              continue;
              _t12086 = undefined;
              break _t12087;
            }
            if (_t12085._tag === 0) {
              _t12086 = [null, null];
              break _t12087;
            }
            _match_fail("line 16629");
          }
          _t12061 = _t12086;
          break _t12062;
        }
      }
      if (_t12060._tag === 10) {
        const name = _t12060._val[0];
        const arg_pat = _t12060._val[1];
        let _t12091;
        if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
          _t12091 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
        } else {
          _t12091 = Js_codegen$tag_for_constructor(ctx.type_env, name);
        }
        const tag_12092 = _t12091;
        const conds_12094 = ({_hd: ((__dict_Show_string.show(scrutinee) + "._tag === ") + __dict_Show_int.show(tag_12092)), _tl: null});
        let _t12097;
        const _t12096 = arg_pat;
        _t12098: {
          if (_t12096._tag === 0) {
            _t12097 = [conds_12094, null];
            break _t12098;
          }
          if (_t12096._tag === 1) {
            const sub_pat = _t12096._val;
            const payload_expr_12099 = (scrutinee + "._val");
            let _t12102;
            const _t12101 = Js_codegen$compile_pattern(ctx, payload_expr_12099, sub_pat);
            _t12103: {
              if (true) {
                const sub_conds = _t12101[0];
                const sub_binds = _t12101[1];
                _t12102 = [List$concat(conds_12094, sub_conds), sub_binds];
                break _t12103;
              }
              _match_fail("line 16629");
            }
            const _t12100 = _t12102;
            _t12097 = _t12100;
            break _t12098;
          }
          _match_fail("line 16629");
        }
        const _t12095 = _t12097;
        const _t12093 = _t12095;
        _t12061 = _t12093;
        break _t12062;
      }
      if (_t12060._tag === 11) {
        const field_pats = _t12060._val;
        const all_conds_12104 = Ref$create(null);
        const all_binds_12106 = Ref$create(null);
        function _t12108(__p418) {
          let _t12110;
          const _t12109 = __p418;
          _t12111: {
            if (true) {
              const fname = _t12109[0];
              const sub_pat = _t12109[1];
              const field_expr_12112 = (scrutinee + ("." + Js_codegen$mangle_name(fname)));
              let _t12115;
              const _t12114 = Js_codegen$compile_pattern(ctx, field_expr_12112, sub_pat);
              _t12116: {
                if (true) {
                  const c = _t12114[0];
                  const b = _t12114[1];
                  Ref$set(all_conds_12104, List$concat(Ref$get(all_conds_12104), c));
                  _t12115 = Ref$set(all_binds_12106, List$concat(Ref$get(all_binds_12106), b));
                  break _t12116;
                }
                _match_fail("line 16629");
              }
              const _t12113 = _t12115;
              _t12110 = _t12113;
              break _t12111;
            }
            _match_fail("line 16629");
          }
          return _t12110;
        }
        List$iter(_t12108, field_pats);
        const _t12107 = [Ref$get(all_conds_12104), Ref$get(all_binds_12106)];
        const _t12105 = _t12107;
        _t12061 = _t12105;
        break _t12062;
      }
      if (_t12060._tag === 12) {
        const inner_pat = _t12060._val[0];
        const name = _t12060._val[1];
        let _t12118;
        const _t12117 = Js_codegen$compile_pattern(ctx, scrutinee, inner_pat);
        _t12119: {
          if (true) {
            const conds = _t12117[0];
            const binds = _t12117[1];
            _t12118 = [conds, List$concat(binds, ({_hd: [name, scrutinee], _tl: null}))];
            break _t12119;
          }
          _match_fail("line 16629");
        }
        _t12061 = _t12118;
        break _t12062;
      }
      if (_t12060._tag === 13) {
        const p1 = _t12060._val[0];
        const p2 = _t12060._val[1];
        let _t12121;
        const _t12120 = Js_codegen$compile_pattern(ctx, scrutinee, p1);
        _t12122: {
          if (true) {
            const conds1 = _t12120[0];
            const binds1 = _t12120[1];
            let _t12124;
            const _t12123 = Js_codegen$compile_pattern(ctx, scrutinee, p2);
            _t12125: {
              if (true) {
                const conds2 = _t12123[0];
                const binds2 = _t12123[1];
                let _t12127;
                const _t12126 = conds1;
                _t12128: {
                  if (_t12126 === null) {
                    _t12127 = "true";
                    break _t12128;
                  }
                  if (true) {
                    const cs = _t12126;
                    _t12127 = String$concat(" && ", cs);
                    break _t12128;
                  }
                  _match_fail("line 16629");
                }
                const cond1_12129 = _t12127;
                let _t12132;
                const _t12131 = conds2;
                _t12133: {
                  if (_t12131 === null) {
                    _t12132 = "true";
                    break _t12133;
                  }
                  if (true) {
                    const cs = _t12131;
                    _t12132 = String$concat(" && ", cs);
                    break _t12133;
                  }
                  _match_fail("line 16629");
                }
                const cond2_12134 = _t12132;
                const or_cond_12136 = ("(" + (cond1_12129 + (" || " + (cond2_12134 + ")"))));
                let _t12138;
                if (_eq(binds1, binds2)) {
                  _t12138 = binds1;
                } else {
                  function _t12139(__p419) {
                    let _t12141;
                    const _t12140 = __p419;
                    _t12142: {
                      if (true) {
                        const name = _t12140[0];
                        const expr1 = _t12140[1];
                        const expr2_12143 = List$assoc(name, binds2);
                        let _t12145;
                        if ((expr1 === expr2_12143)) {
                          _t12145 = [name, expr1];
                        } else {
                          _t12145 = [name, (((((("(" + __dict_Show_string.show(cond1_12129)) + " ? ") + __dict_Show_string.show(expr1)) + " : ") + __dict_Show_string.show(expr2_12143)) + ")")];
                        }
                        const _t12144 = _t12145;
                        _t12141 = _t12144;
                        break _t12142;
                      }
                      _match_fail("line 16629");
                    }
                    return _t12141;
                  }
                  _t12138 = List$map(_t12139, binds1);
                }
                const binds_12146 = _t12138;
                const _t12147 = [({_hd: or_cond_12136, _tl: null}), binds_12146];
                const _t12137 = _t12147;
                const _t12135 = _t12137;
                const _t12130 = _t12135;
                _t12124 = _t12130;
                break _t12125;
              }
              _match_fail("line 16629");
            }
            _t12121 = _t12124;
            break _t12122;
          }
          _match_fail("line 16629");
        }
        _t12061 = _t12121;
        break _t12062;
      }
      if (_t12060._tag === 14) {
        const pats = _t12060._val;
        const len_cond_12148 = ((__dict_Show_string.show(scrutinee) + "._arr.length === ") + __dict_Show_int.show(List$length(pats)));
        const all_conds_12150 = Ref$create(({_hd: len_cond_12148, _tl: null}));
        const all_binds_12152 = Ref$create(null);
        function _t12154(i, sub_pat) {
          const elem_expr_12155 = (((__dict_Show_string.show(scrutinee) + "._arr[") + __dict_Show_int.show(i)) + "]");
          let _t12158;
          const _t12157 = Js_codegen$compile_pattern(ctx, elem_expr_12155, sub_pat);
          _t12159: {
            if (true) {
              const c = _t12157[0];
              const b = _t12157[1];
              Ref$set(all_conds_12150, List$concat(Ref$get(all_conds_12150), c));
              _t12158 = Ref$set(all_binds_12152, List$concat(Ref$get(all_binds_12152), b));
              break _t12159;
            }
            _match_fail("line 16629");
          }
          const _t12156 = _t12158;
          return _t12156;
        }
        List$iteri(_t12154, pats);
        const _t12153 = [Ref$get(all_conds_12150), Ref$get(all_binds_12152)];
        const _t12151 = _t12153;
        const _t12149 = _t12151;
        _t12061 = _t12149;
        break _t12062;
      }
      if (_t12060._tag === 16) {
        const tag = _t12060._val[0];
        const arg_pat = _t12060._val[1];
        const num_tag_12160 = (__dict_Hash_string.hash(tag) & 1073741823);
        const conds_12162 = ({_hd: ((__dict_Show_string.show(scrutinee) + "._tag === ") + __dict_Show_int.show(num_tag_12160)), _tl: null});
        let _t12165;
        const _t12164 = arg_pat;
        _t12166: {
          if (_t12164._tag === 0) {
            _t12165 = [conds_12162, null];
            break _t12166;
          }
          if (_t12164._tag === 1) {
            const sub_pat = _t12164._val;
            const payload_expr_12167 = (scrutinee + "._val");
            let _t12170;
            const _t12169 = Js_codegen$compile_pattern(ctx, payload_expr_12167, sub_pat);
            _t12171: {
              if (true) {
                const sub_conds = _t12169[0];
                const sub_binds = _t12169[1];
                _t12170 = [List$concat(conds_12162, sub_conds), sub_binds];
                break _t12171;
              }
              _match_fail("line 16629");
            }
            const _t12168 = _t12170;
            _t12165 = _t12168;
            break _t12166;
          }
          _match_fail("line 16629");
        }
        const _t12163 = _t12165;
        const _t12161 = _t12163;
        _t12061 = _t12161;
        break _t12062;
      }
      if (_t12060._tag === 17) {
        const name = _t12060._val;
        const js_name_12172 = Js_codegen$lookup_var(ctx, name);
        const _t12173 = [({_hd: (((("_eq(" + __dict_Show_string.show(scrutinee)) + ", ") + __dict_Show_string.show(js_name_12172)) + ")"), _tl: null}), null];
        _t12061 = _t12173;
        break _t12062;
      }
      if (_t12060._tag === 18) {
        const inner_pat = _t12060._val[0];
        const _t12174 = ctx;
        const _t12175 = scrutinee;
        const _t12176 = inner_pat;
        ctx = _t12174;
        scrutinee = _t12175;
        pat = _t12176;
        continue;
        _t12061 = undefined;
        break _t12062;
      }
      if (_t12060._tag === 15) {
        const entries = _t12060._val;
        const all_conds_12177 = Ref$create(null);
        const all_binds_12179 = Ref$create(null);
        function _t12181(key_pat) {
          let _t12183;
          const _t12182 = key_pat;
          _t12184: {
            if (_t12182._tag === 2) {
              const n = _t12182._val;
              _t12183 = string_of_int(n);
              break _t12184;
            }
            if (_t12182._tag === 5) {
              const s = _t12182._val;
              _t12183 = Js_codegen$escape_js_string(s);
              break _t12184;
            }
            if (_t12182._tag === 4) {
              const b = _t12182._val;
              let _t12185;
              if (b) {
                _t12185 = "true";
              } else {
                _t12185 = "false";
              }
              _t12183 = _t12185;
              break _t12184;
            }
            if (_t12182._tag === 3) {
              const f = _t12182._val;
              _t12183 = __dict_Show_float.show(f);
              break _t12184;
            }
            if (_t12182._tag === 17) {
              const name = _t12182._val;
              _t12183 = Js_codegen$lookup_var(ctx, name);
              break _t12184;
            }
            if (true) {
              _t12183 = Js_codegen$error("map pattern keys must be literals or pin patterns");
              break _t12184;
            }
            _match_fail("line 16629");
          }
          return _t12183;
        }
        const emit_key_expr_12186 = _t12181;
        function _t12188(__p420) {
          let _t12190;
          const _t12189 = __p420;
          _t12191: {
            if (true) {
              const key_pat = _t12189[0];
              const val_pat = _t12189[1];
              const key_expr_12192 = emit_key_expr_12186(key_pat);
              Ref$set(all_conds_12177, List$concat(Ref$get(all_conds_12177), ({_hd: (((((__dict_Show_string.show(Js_codegen$mangle_name("Map.has")) + "(") + __dict_Show_string.show(key_expr_12192)) + ")(") + __dict_Show_string.show(scrutinee)) + ")"), _tl: null})));
              const val_expr_12194 = (((((__dict_Show_string.show(Js_codegen$mangle_name("Map.get")) + "(") + __dict_Show_string.show(key_expr_12192)) + ")(") + __dict_Show_string.show(scrutinee)) + ")._val");
              let _t12197;
              const _t12196 = Js_codegen$compile_pattern(ctx, val_expr_12194, val_pat);
              _t12198: {
                if (true) {
                  const c = _t12196[0];
                  const b = _t12196[1];
                  Ref$set(all_conds_12177, List$concat(Ref$get(all_conds_12177), c));
                  _t12197 = Ref$set(all_binds_12179, List$concat(Ref$get(all_binds_12179), b));
                  break _t12198;
                }
                _match_fail("line 16629");
              }
              const _t12195 = _t12197;
              const _t12193 = _t12195;
              _t12190 = _t12193;
              break _t12191;
            }
            _match_fail("line 16629");
          }
          return _t12190;
        }
        List$iter(_t12188, entries);
        const _t12187 = [Ref$get(all_conds_12177), Ref$get(all_binds_12179)];
        const _t12180 = _t12187;
        const _t12178 = _t12180;
        _t12061 = _t12178;
        break _t12062;
      }
      _match_fail("line 16629");
    }
    return _t12061;
  }
}
function Js_codegen$compile_handle_trywith(ctx, body, op_arms, return_arm, result) {
  Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(result)) + " = (function() {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  const h_saved_12199 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(h_saved_12199)) + " = _h;"));
  Js_codegen$emit_line(ctx, (("_h = Object.assign({}, " + __dict_Show_string.show(h_saved_12199)) + ", {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  function _t12201(__p421) {
    let _t12203;
    const _t12202 = __p421;
    _t12204: {
      if (true) {
        const op_name = _t12202[0];
        const arg_name = _t12202[1];
        const k_name = _t12202[2];
        const arg_js_12205 = Js_codegen$mangle_name(arg_name);
        const k_js_12207 = Js_codegen$mangle_name(k_name);
        const _t12208 = Js_codegen$emit_line(ctx, (((((((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_12205)) + ", ") + __dict_Show_string.show(k_js_12207)) + ") { throw {_e: \"") + __dict_Show_string.show(op_name)) + "\", _v: ") + __dict_Show_string.show(arg_js_12205)) + "}; },"));
        const _t12206 = _t12208;
        _t12203 = _t12206;
        break _t12204;
      }
      _match_fail("line 16629");
    }
    return _t12203;
  }
  List$iter(_t12201, op_arms);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "});");
  Js_codegen$emit_line(ctx, "try {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const saved_two_12209 = ctx.trywith_ops;
  function _t12211(__p422) {
    let _t12213;
    const _t12212 = __p422;
    _t12214: {
      if (true) {
        const op = _t12212[0];
        _t12213 = op;
        break _t12214;
      }
      _match_fail("line 16629");
    }
    return _t12213;
  }
  const handled_op_names_12215 = List$map(_t12211, op_arms);
  (ctx.trywith_ops = List$concat(handled_op_names_12215, ctx.trywith_ops), undefined);
  const body_needs_cps_12217 = Js_codegen$expr_has_unhandled_perform(handled_op_names_12215, body);
  let _t12219;
  if (body_needs_cps_12217) {
    Js_codegen$emit_line(ctx, "return _trampoline(function() {");
    (ctx.indent = (ctx.indent + 1), undefined);
    function _t12220(body_result) {
      let _t12222;
      const _t12221 = return_arm;
      _t12223: {
        if (_t12221._tag === 1) {
          const ret_name = _t12221._val[0];
          const ret_body = _t12221._val[1];
          const ret_js_12224 = Js_codegen$mangle_name(ret_name);
          const actual_ret_12226 = (ret_js_12224 + ("_" + string_of_int(ctx.tmp_counter)));
          (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, ret_name, actual_ret_12226);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_12226)) + " = ") + __dict_Show_string.show(body_result)) + ";"));
          const v_12228 = Js_codegen$compile_non_tail(ctx, ret_body);
          Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_12228)) + ";"));
          const _t12229 = Js_codegen$pop_scope(ctx);
          const _t12227 = _t12229;
          const _t12225 = _t12227;
          _t12222 = _t12225;
          break _t12223;
        }
        if (_t12221._tag === 0) {
          _t12222 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_result)) + ";"));
          break _t12223;
        }
        _match_fail("line 16629");
      }
      return _t12222;
    }
    Js_codegen$compile_cps(ctx, body, _t12220);
    (ctx.indent = (ctx.indent - 1), undefined);
    _t12219 = Js_codegen$emit_line(ctx, "});");
  } else {
    const body_v_12230 = Js_codegen$compile_non_tail(ctx, body);
    let _t12233;
    const _t12232 = return_arm;
    _t12234: {
      if (_t12232._tag === 1) {
        const ret_name = _t12232._val[0];
        const ret_body = _t12232._val[1];
        const ret_js_12235 = Js_codegen$mangle_name(ret_name);
        const actual_ret_12237 = (ret_js_12235 + ("_" + string_of_int(ctx.tmp_counter)));
        (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
        Js_codegen$push_scope(ctx);
        Js_codegen$bind_var(ctx, ret_name, actual_ret_12237);
        Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_12237)) + " = ") + __dict_Show_string.show(body_v_12230)) + ";"));
        const rv_12239 = Js_codegen$compile_non_tail(ctx, ret_body);
        Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(rv_12239)) + ";"));
        const _t12240 = Js_codegen$pop_scope(ctx);
        const _t12238 = _t12240;
        const _t12236 = _t12238;
        _t12233 = _t12236;
        break _t12234;
      }
      if (_t12232._tag === 0) {
        _t12233 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_v_12230)) + ";"));
        break _t12234;
      }
      _match_fail("line 16629");
    }
    const _t12231 = _t12233;
    _t12219 = _t12231;
  }
  _t12219;
  (ctx.trywith_ops = saved_two_12209, undefined);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "} catch (_exc) {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const first_12241 = Ref$create(true);
  function _t12243(__p423) {
    let _t12245;
    const _t12244 = __p423;
    _t12246: {
      if (true) {
        const op_name = _t12244[0];
        const arg_name = _t12244[1];
        const _k_name = _t12244[2];
        const handler_body = _t12244[3];
        let _t12247;
        if (Ref$get(first_12241)) {
          _t12247 = "if";
        } else {
          _t12247 = "} else if";
        }
        const prefix_12248 = _t12247;
        Ref$set(first_12241, false);
        Js_codegen$emit_line(ctx, (((__dict_Show_string.show(prefix_12248) + " (_exc && _exc._e === \"") + __dict_Show_string.show(op_name)) + "\") {"));
        (ctx.indent = (ctx.indent + 1), undefined);
        Js_codegen$push_scope(ctx);
        const arg_js_12250 = Js_codegen$mangle_name(arg_name);
        Js_codegen$bind_var(ctx, arg_name, arg_js_12250);
        Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(arg_js_12250)) + " = _exc._v;"));
        const v_12252 = Js_codegen$compile_non_tail(ctx, handler_body);
        Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_12252)) + ";"));
        Js_codegen$pop_scope(ctx);
        const _t12253 = (ctx.indent = (ctx.indent - 1), undefined);
        const _t12251 = _t12253;
        const _t12249 = _t12251;
        _t12245 = _t12249;
        break _t12246;
      }
      _match_fail("line 16629");
    }
    return _t12245;
  }
  List$iter(_t12243, op_arms);
  Js_codegen$emit_line(ctx, "} else { throw _exc; }");
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, (("} finally { _h = " + __dict_Show_string.show(h_saved_12199)) + "; }"));
  (ctx.indent = (ctx.indent - 1), undefined);
  const _t12242 = Js_codegen$emit_line(ctx, "})();");
  const _t12218 = _t12242;
  const _t12216 = _t12218;
  const _t12210 = _t12216;
  const _t12200 = _t12210;
  return _t12200;
}
function Js_codegen$compile_handle(ctx, body, arms) {
  const result_12254 = Js_codegen$fresh_tmp(ctx);
  const return_arm_12256 = Ref$create(({_tag: 0, _name: "None"}));
  const provide_ops_12258 = Ref$create(null);
  const try_ops_12260 = Ref$create(null);
  const full_ops_12262 = Ref$create(null);
  function _t12264(arm) {
    let _t12266;
    const _t12265 = arm;
    _t12267: {
      if (_t12265._tag === 0) {
        const name = _t12265._val[0];
        const body = _t12265._val[1];
        _t12266 = Ref$set(return_arm_12256, ({_tag: 1, _name: "Some", _val: [name, body]}));
        break _t12267;
      }
      if (_t12265._tag === 1) {
        const op = _t12265._val[0];
        const arg = _t12265._val[1];
        const k = _t12265._val[2];
        const body = _t12265._val[3];
        _t12266 = Ref$set(full_ops_12262, ({_hd: [op, arg, k, body], _tl: Ref$get(full_ops_12262)}));
        break _t12267;
      }
      if (_t12265._tag === 2) {
        const op = _t12265._val[0];
        const arg = _t12265._val[1];
        const body = _t12265._val[2];
        _t12266 = Ref$set(provide_ops_12258, ({_hd: [op, arg, body], _tl: Ref$get(provide_ops_12258)}));
        break _t12267;
      }
      if (_t12265._tag === 3) {
        const op = _t12265._val[0];
        const arg = _t12265._val[1];
        const body = _t12265._val[2];
        _t12266 = Ref$set(try_ops_12260, ({_hd: [op, arg, body], _tl: Ref$get(try_ops_12260)}));
        break _t12267;
      }
      _match_fail("line 16629");
    }
    return _t12266;
  }
  List$iter(_t12264, arms);
  const provide_ops_12268 = List$rev(Ref$get(provide_ops_12258));
  const try_ops_12270 = List$rev(Ref$get(try_ops_12260));
  const full_ops_12272 = List$rev(Ref$get(full_ops_12262));
  let _t12275;
  const _t12274 = Ref$get(return_arm_12256);
  _t12276: {
    if (_t12274._tag === 1) {
      const rb = _t12274._val[1];
      _t12275 = (!Js_codegen$expr_has_perform(rb));
      break _t12276;
    }
    if (_t12274._tag === 0) {
      _t12275 = true;
      break _t12276;
    }
    _match_fail("line 16629");
  }
  const return_arm_pure_12277 = _t12275;
  let _t12279;
  if ((_eq(full_ops_12272, null) && (_eq(provide_ops_12268, null) && (!_eq(try_ops_12270, null) && return_arm_pure_12277)))) {
    function _t12280(__p424) {
      let _t12282;
      const _t12281 = __p424;
      _t12283: {
        if (true) {
          const op = _t12281[0];
          const arg = _t12281[1];
          const body = _t12281[2];
          _t12282 = [op, arg, "__k_try", body];
          break _t12283;
        }
        _match_fail("line 16629");
      }
      return _t12282;
    }
    const trywith_arms_12284 = List$map(_t12280, try_ops_12270);
    const _t12285 = Js_codegen$compile_handle_trywith(ctx, body, trywith_arms_12284, Ref$get(return_arm_12256), result_12254);
    _t12279 = _t12285;
  } else {
    function _t12286(__p425) {
      let _t12288;
      const _t12287 = __p425;
      _t12289: {
        if (true) {
          const op = _t12287[0];
          _t12288 = op;
          break _t12289;
        }
        _match_fail("line 16629");
      }
      return _t12288;
    }
    const simple_ops_12290 = List$map(_t12286, provide_ops_12268);
    Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(result_12254)) + " = (function() {"));
    (ctx.indent = (ctx.indent + 1), undefined);
    const h_saved_12292 = Js_codegen$fresh_tmp(ctx);
    Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(h_saved_12292)) + " = _h;"));
    const saved_direct_ops_12294 = ctx.direct_dispatch_ops;
    function _t12296(__p426) {
      let _t12298;
      const _t12297 = __p426;
      _t12299: {
        if (true) {
          const op_name = _t12297[0];
          const arg_name = _t12297[1];
          const value_body = _t12297[2];
          const direct_fn_12300 = Js_codegen$fresh_tmp(ctx);
          const arg_js_12302 = Js_codegen$mangle_name(arg_name);
          Js_codegen$emit_line(ctx, (((("function " + __dict_Show_string.show(direct_fn_12300)) + "(") + __dict_Show_string.show(arg_js_12302)) + ") {"));
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, arg_name, arg_js_12302);
          const v_12304 = Js_codegen$compile_non_tail(ctx, value_body);
          Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_12304)) + ";"));
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          Js_codegen$emit_line(ctx, "}");
          const _t12305 = (ctx.direct_dispatch_ops = ({_hd: [op_name, direct_fn_12300], _tl: ctx.direct_dispatch_ops}), undefined);
          const _t12303 = _t12305;
          const _t12301 = _t12303;
          _t12298 = _t12301;
          break _t12299;
        }
        _match_fail("line 16629");
      }
      return _t12298;
    }
    List$iter(_t12296, provide_ops_12268);
    function _t12306(__p427) {
      let _t12308;
      const _t12307 = __p427;
      _t12309: {
        if (true) {
          const op = _t12307[0];
          _t12308 = op;
          break _t12309;
        }
        _match_fail("line 16629");
      }
      return _t12308;
    }
    function _t12310(__p428) {
      let _t12312;
      const _t12311 = __p428;
      _t12313: {
        if (true) {
          const op = _t12311[0];
          _t12312 = op;
          break _t12313;
        }
        _match_fail("line 16629");
      }
      return _t12312;
    }
    const shadowed_ops_12314 = List$concat(List$map(_t12306, full_ops_12272), List$map(_t12310, try_ops_12270));
    let _t12316;
    if (!_eq(shadowed_ops_12314, null)) {
      function _t12317(__p429) {
        let _t12319;
        const _t12318 = __p429;
        _t12320: {
          if (true) {
            const op = _t12318[0];
            _t12319 = (!List$mem(op, shadowed_ops_12314));
            break _t12320;
          }
          _match_fail("line 16629");
        }
        return _t12319;
      }
      _t12316 = (ctx.direct_dispatch_ops = List$filter(_t12317, ctx.direct_dispatch_ops), undefined);
    } else {
      _t12316 = undefined;
    }
    _t12316;
    Js_codegen$emit_line(ctx, (("_h = Object.assign({}, " + __dict_Show_string.show(h_saved_12292)) + ", {"));
    (ctx.indent = (ctx.indent + 1), undefined);
    function _t12321(__p430) {
      let _t12323;
      const _t12322 = __p430;
      _t12324: {
        if (true) {
          const op_name = _t12322[0];
          const arg_name = _t12322[1];
          const arg_js_12325 = Js_codegen$mangle_name(arg_name);
          const k_js_12327 = "_k";
          const direct_fn_12329 = List$assoc(op_name, ctx.direct_dispatch_ops);
          const _t12330 = Js_codegen$emit_line(ctx, (((((((((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_12325)) + ", ") + __dict_Show_string.show(k_js_12327)) + ") { return _bounce(function() { return ") + __dict_Show_string.show(k_js_12327)) + "(") + __dict_Show_string.show(direct_fn_12329)) + "(") + __dict_Show_string.show(arg_js_12325)) + ")); }); },"));
          const _t12328 = _t12330;
          const _t12326 = _t12328;
          _t12323 = _t12326;
          break _t12324;
        }
        _match_fail("line 16629");
      }
      return _t12323;
    }
    List$iter(_t12321, provide_ops_12268);
    function _t12331(__p431) {
      let _t12333;
      const _t12332 = __p431;
      _t12334: {
        if (true) {
          const op_name = _t12332[0];
          const arg_name = _t12332[1];
          const fallback_body = _t12332[2];
          const arg_js_12335 = Js_codegen$mangle_name(arg_name);
          const k_js_12337 = "_k";
          Js_codegen$emit_line(ctx, (((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_12335)) + ", ") + __dict_Show_string.show(k_js_12337)) + ") {"));
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, arg_name, arg_js_12335);
          const v_12339 = Js_codegen$compile_non_tail(ctx, fallback_body);
          Js_codegen$emit_line(ctx, (("return _bounce(function() { return " + __dict_Show_string.show(v_12339)) + "; });"));
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          const _t12340 = Js_codegen$emit_line(ctx, "},");
          const _t12338 = _t12340;
          const _t12336 = _t12338;
          _t12333 = _t12336;
          break _t12334;
        }
        _match_fail("line 16629");
      }
      return _t12333;
    }
    List$iter(_t12331, try_ops_12270);
    function _t12341(__p432) {
      let _t12343;
      const _t12342 = __p432;
      _t12344: {
        if (true) {
          const op_name = _t12342[0];
          const arg_name = _t12342[1];
          const k_name = _t12342[2];
          const handler_body = _t12342[3];
          const arg_js_12345 = Js_codegen$mangle_name(arg_name);
          const k_js_12347 = Js_codegen$mangle_name(k_name);
          Js_codegen$emit_line(ctx, (((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_12345)) + ", ") + __dict_Show_string.show(k_js_12347)) + ") {"));
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, arg_name, arg_js_12345);
          Js_codegen$bind_var(ctx, k_name, k_js_12347);
          const saved_htr_12349 = ctx.handler_tail_resume;
          (ctx.handler_tail_resume = Js_codegen$all_resumes_are_tail(handler_body), undefined);
          const v_12351 = Js_codegen$compile_non_tail(ctx, handler_body);
          (ctx.handler_tail_resume = saved_htr_12349, undefined);
          Js_codegen$emit_line(ctx, (("return _bounce(function() { return " + __dict_Show_string.show(v_12351)) + "; });"));
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          const _t12352 = Js_codegen$emit_line(ctx, "},");
          const _t12350 = _t12352;
          const _t12348 = _t12350;
          const _t12346 = _t12348;
          _t12343 = _t12346;
          break _t12344;
        }
        _match_fail("line 16629");
      }
      return _t12343;
    }
    List$iter(_t12341, full_ops_12272);
    (ctx.indent = (ctx.indent - 1), undefined);
    Js_codegen$emit_line(ctx, "});");
    let _t12353;
    if (_eq(simple_ops_12290, null)) {
      _t12353 = Js_codegen$expr_has_perform(body);
    } else {
      _t12353 = Js_codegen$expr_has_unhandled_perform(simple_ops_12290, body);
    }
    const body_needs_cps_12354 = _t12353;
    Js_codegen$emit_line(ctx, "try {");
    (ctx.indent = (ctx.indent + 1), undefined);
    let _t12356;
    if (body_needs_cps_12354) {
      Js_codegen$emit_line(ctx, "return _trampoline(function() {");
      (ctx.indent = (ctx.indent + 1), undefined);
      function _t12357(body_result) {
        let _t12359;
        const _t12358 = Ref$get(return_arm_12256);
        _t12360: {
          if (_t12358._tag === 1) {
            const ret_name = _t12358._val[0];
            const ret_body = _t12358._val[1];
            const ret_js_12361 = Js_codegen$mangle_name(ret_name);
            const actual_ret_12363 = (ret_js_12361 + ("_" + string_of_int(ctx.tmp_counter)));
            (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
            Js_codegen$push_scope(ctx);
            Js_codegen$bind_var(ctx, ret_name, actual_ret_12363);
            Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_12363)) + " = ") + __dict_Show_string.show(body_result)) + ";"));
            const v_12365 = Js_codegen$compile_non_tail(ctx, ret_body);
            Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_12365)) + ";"));
            const _t12366 = Js_codegen$pop_scope(ctx);
            const _t12364 = _t12366;
            const _t12362 = _t12364;
            _t12359 = _t12362;
            break _t12360;
          }
          if (_t12358._tag === 0) {
            _t12359 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_result)) + ";"));
            break _t12360;
          }
          _match_fail("line 16629");
        }
        return _t12359;
      }
      Js_codegen$compile_cps(ctx, body, _t12357);
      (ctx.indent = (ctx.indent - 1), undefined);
      _t12356 = Js_codegen$emit_line(ctx, "});");
    } else {
      const body_v_12367 = Js_codegen$compile_non_tail(ctx, body);
      let _t12370;
      const _t12369 = Ref$get(return_arm_12256);
      _t12371: {
        if (_t12369._tag === 1) {
          const ret_name = _t12369._val[0];
          const ret_body = _t12369._val[1];
          const ret_js_12372 = Js_codegen$mangle_name(ret_name);
          const actual_ret_12374 = (ret_js_12372 + ("_" + string_of_int(ctx.tmp_counter)));
          (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, ret_name, actual_ret_12374);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_12374)) + " = ") + __dict_Show_string.show(body_v_12367)) + ";"));
          const rv_12376 = Js_codegen$compile_non_tail(ctx, ret_body);
          Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(rv_12376)) + ";"));
          const _t12377 = Js_codegen$pop_scope(ctx);
          const _t12375 = _t12377;
          const _t12373 = _t12375;
          _t12370 = _t12373;
          break _t12371;
        }
        if (_t12369._tag === 0) {
          _t12370 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_v_12367)) + ";"));
          break _t12371;
        }
        _match_fail("line 16629");
      }
      const _t12368 = _t12370;
      _t12356 = _t12368;
    }
    _t12356;
    (ctx.indent = (ctx.indent - 1), undefined);
    Js_codegen$emit_line(ctx, (("} finally { _h = " + __dict_Show_string.show(h_saved_12292)) + "; }"));
    (ctx.direct_dispatch_ops = saved_direct_ops_12294, undefined);
    (ctx.indent = (ctx.indent - 1), undefined);
    const _t12355 = Js_codegen$emit_line(ctx, "})();");
    const _t12315 = _t12355;
    const _t12295 = _t12315;
    const _t12293 = _t12295;
    const _t12291 = _t12293;
    _t12279 = _t12291;
  }
  _t12279;
  const _t12278 = result_12254;
  const _t12273 = _t12278;
  const _t12271 = _t12273;
  const _t12269 = _t12271;
  const _t12263 = _t12269;
  const _t12261 = _t12263;
  const _t12259 = _t12261;
  const _t12257 = _t12259;
  const _t12255 = _t12257;
  return _t12255;
}
function Js_codegen$compile_cps(ctx, te, cont) {
  while (true) {
    let _t12378;
    if ((!Js_codegen$expr_has_perform(te))) {
      const v_12379 = Js_codegen$compile_non_tail(ctx, te);
      const _t12380 = cont(v_12379);
      _t12378 = _t12380;
    } else {
      let _t12382;
      const _t12381 = te.expr;
      _t12383: {
        if (_t12381._tag === 29) {
          const op_name = _t12381._val[0];
          const arg = _t12381._val[1];
          _t12382 = Js_codegen$compile_perform_cps(ctx, op_name, arg, cont);
          break _t12383;
        }
        if (_t12381._tag === 30) {
          const v_12384 = Js_codegen$compile_non_tail(ctx, te);
          const _t12385 = cont(v_12384);
          _t12382 = _t12385;
          break _t12383;
        }
        if (_t12381._tag === 31) {
          const k_expr = _t12381._val[0];
          const val_expr = _t12381._val[1];
          const k_js_12386 = Js_codegen$compile_non_tail(ctx, k_expr);
          const v_js_12388 = Js_codegen$compile_non_tail(ctx, val_expr);
          const _t12389 = Js_codegen$emit_line(ctx, (((("return _bounce(function() { return " + __dict_Show_string.show(k_js_12386)) + "(") + __dict_Show_string.show(v_js_12388)) + "); });"));
          const _t12387 = _t12389;
          _t12382 = _t12387;
          break _t12383;
        }
        if (_t12381._tag === 8) {
          const name = _t12381._val[0];
          const e1 = _t12381._val[2];
          const e2 = _t12381._val[3];
          _t12382 = Js_codegen$compile_let_cps(ctx, name, e1, e2, cont);
          break _t12383;
        }
        if (_t12381._tag === 9) {
          const name = _t12381._val[0];
          const fn_expr = _t12381._val[2];
          const body = _t12381._val[3];
          _t12382 = Js_codegen$compile_letrec_cps(ctx, name, fn_expr, body, cont);
          break _t12383;
        }
        if (_t12381._tag === 28) {
          const e1 = _t12381._val[0];
          const e2 = _t12381._val[1];
          _t12382 = Js_codegen$compile_seq_cps(ctx, e1, e2, cont);
          break _t12383;
        }
        if (_t12381._tag === 12) {
          const cond = _t12381._val[0];
          const then_e = _t12381._val[1];
          const else_e = _t12381._val[2];
          _t12382 = Js_codegen$compile_if_cps(ctx, cond, then_e, else_e, cont);
          break _t12383;
        }
        if (_t12381._tag === 24) {
          const scrut = _t12381._val[0];
          const arms = _t12381._val[1];
          const _partial = _t12381._val[2];
          _t12382 = Js_codegen$compile_match_cps(ctx, scrut, arms, te.loc, cont);
          break _t12383;
        }
        if (_t12381._tag === 11) {
          const fn_ = _t12381._val[0];
          const arg = _t12381._val[1];
          _t12382 = Js_codegen$compile_app_cps(ctx, te, fn_, arg, cont);
          break _t12383;
        }
        if (_t12381._tag === 10) {
          const v_12390 = Js_codegen$compile_non_tail(ctx, te);
          const _t12391 = cont(v_12390);
          _t12382 = _t12391;
          break _t12383;
        }
        if (_t12381._tag === 25) {
          const name = _t12381._val[0];
          const init = _t12381._val[1];
          const body = _t12381._val[2];
          let _t12392;
          if (Js_codegen$expr_has_perform(init)) {
            const _t12393 = ctx;
            const _t12394 = init;
            function _t12396(init_v) {
              const js_name_12397 = Js_codegen$mangle_name(name);
              const actual_name_12399 = (js_name_12397 + ("_" + string_of_int(ctx.tmp_counter)));
              (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
              Js_codegen$push_scope(ctx);
              Js_codegen$bind_var(ctx, name, actual_name_12399);
              Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(actual_name_12399)) + " = _resolve(") + __dict_Show_string.show(init_v)) + ");"));
              Js_codegen$compile_cps(ctx, body, cont);
              const _t12400 = Js_codegen$pop_scope(ctx);
              const _t12398 = _t12400;
              return _t12398;
            }
            const _t12395 = _t12396;
            ctx = _t12393;
            te = _t12394;
            cont = _t12395;
            continue;
            _t12392 = undefined;
          } else {
            const v_12401 = Js_codegen$compile_non_tail(ctx, init);
            const js_name_12403 = Js_codegen$mangle_name(name);
            const actual_name_12405 = (js_name_12403 + ("_" + string_of_int(ctx.tmp_counter)));
            (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
            Js_codegen$push_scope(ctx);
            Js_codegen$bind_var(ctx, name, actual_name_12405);
            Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(actual_name_12405)) + " = _resolve(") + __dict_Show_string.show(v_12401)) + ");"));
            Js_codegen$compile_cps(ctx, body, cont);
            const _t12406 = Js_codegen$pop_scope(ctx);
            const _t12404 = _t12406;
            const _t12402 = _t12404;
            _t12392 = _t12402;
          }
          _t12382 = _t12392;
          break _t12383;
        }
        if (_t12381._tag === 32) {
          const cond = _t12381._val[0];
          const body = _t12381._val[1];
          _t12382 = Js_codegen$compile_while_cps(ctx, cond, body, cont);
          break _t12383;
        }
        if (true) {
          const v_12407 = Js_codegen$compile_non_tail(ctx, te);
          const _t12408 = cont(v_12407);
          _t12382 = _t12408;
          break _t12383;
        }
        _match_fail("line 16629");
      }
      _t12378 = _t12382;
    }
    return _t12378;
  }
}
function Js_codegen$compile_while_cps(ctx, cond, body, cont) {
  const loop_fn_12409 = Js_codegen$fresh_tmp(ctx);
  const break_flag_12411 = Js_codegen$fresh_tmp(ctx);
  const break_val_12413 = Js_codegen$fresh_tmp(ctx);
  const saved_break_flag_12415 = ctx.break_flag_name;
  const saved_break_val_12417 = ctx.break_val_name;
  (ctx.break_flag_name = break_flag_12411, undefined);
  (ctx.break_val_name = break_val_12413, undefined);
  Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(break_flag_12411)) + " = false, ") + __dict_Show_string.show(break_val_12413)) + ";"));
  Js_codegen$emit_line(ctx, (("function " + __dict_Show_string.show(loop_fn_12409)) + "() {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  const c_12419 = Js_codegen$compile_non_tail(ctx, cond);
  Js_codegen$emit_line(ctx, (("if (!(" + __dict_Show_string.show(c_12419)) + ")) {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  cont("undefined");
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  function _t12421(body_val) {
    Js_codegen$emit_line(ctx, (__dict_Show_string.show(body_val) + ";"));
    Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(break_flag_12411)) + ") {"));
    (ctx.indent = (ctx.indent + 1), undefined);
    cont(break_val_12413);
    (ctx.indent = (ctx.indent - 1), undefined);
    Js_codegen$emit_line(ctx, "}");
    return Js_codegen$emit_line(ctx, (("return _bounce(" + __dict_Show_string.show(loop_fn_12409)) + ");"));
  }
  Js_codegen$compile_cps(ctx, body, _t12421);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  Js_codegen$emit_line(ctx, (("return _bounce(" + __dict_Show_string.show(loop_fn_12409)) + ");"));
  (ctx.break_flag_name = saved_break_flag_12415, undefined);
  const _t12420 = (ctx.break_val_name = saved_break_val_12417, undefined);
  const _t12418 = _t12420;
  const _t12416 = _t12418;
  const _t12414 = _t12416;
  const _t12412 = _t12414;
  const _t12410 = _t12412;
  return _t12410;
}
function Js_codegen$compile_perform_cps(ctx, op_name, arg, cont) {
  let _t12423;
  const _t12422 = List$assoc_opt(op_name, ctx.direct_dispatch_ops);
  _t12424: {
    if (_t12422._tag === 1) {
      const direct_fn = _t12422._val;
      const arg_js_12425 = Js_codegen$compile_non_tail(ctx, arg);
      const result_var_12427 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_line(ctx, (((((("const " + __dict_Show_string.show(result_var_12427)) + " = ") + __dict_Show_string.show(direct_fn)) + "(") + __dict_Show_string.show(arg_js_12425)) + ");"));
      const _t12428 = cont(result_var_12427);
      const _t12426 = _t12428;
      _t12423 = _t12426;
      break _t12424;
    }
    if (_t12422._tag === 0) {
      if (List$mem(op_name, ctx.trywith_ops)) {
        const arg_js_12429 = Js_codegen$compile_non_tail(ctx, arg);
        const _t12430 = Js_codegen$emit_line(ctx, (((("throw {_e: \"" + __dict_Show_string.show(op_name)) + "\", _v: ") + __dict_Show_string.show(arg_js_12429)) + "};"));
        _t12423 = _t12430;
        break _t12424;
      }
    }
    if (_t12422._tag === 0) {
      const arg_js_12431 = Js_codegen$compile_non_tail(ctx, arg);
      const result_var_12433 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_line(ctx, (((((("return _h[\"" + __dict_Show_string.show(op_name)) + "\"](") + __dict_Show_string.show(arg_js_12431)) + ", function(") + __dict_Show_string.show(result_var_12433)) + ") {"));
      (ctx.indent = (ctx.indent + 1), undefined);
      Js_codegen$emit_line(ctx, "return _bounce(function() {");
      (ctx.indent = (ctx.indent + 1), undefined);
      cont(result_var_12433);
      (ctx.indent = (ctx.indent - 1), undefined);
      Js_codegen$emit_line(ctx, "});");
      (ctx.indent = (ctx.indent - 1), undefined);
      const _t12434 = Js_codegen$emit_line(ctx, "});");
      const _t12432 = _t12434;
      _t12423 = _t12432;
      break _t12424;
    }
    _match_fail("line 16629");
  }
  return _t12423;
}
function Js_codegen$compile_let_cps(ctx, name, e1, e2, cont) {
  let _t12435;
  if (Js_codegen$expr_has_perform(e1)) {
    function _t12436(v1) {
      const js_name_12437 = Js_codegen$mangle_name(name);
      let _t12439;
      if ((js_name_12437 === "_")) {
        _t12439 = Js_codegen$fresh_tmp(ctx);
      } else {
        function _t12440(n) {
          (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
          return n;
        }
        _t12439 = _call(_t12440, [(js_name_12437 + ("_" + string_of_int(ctx.tmp_counter)))]);
      }
      const actual_name_12441 = _t12439;
      Js_codegen$push_scope(ctx);
      Js_codegen$bind_var(ctx, name, actual_name_12441);
      Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_name_12441)) + " = _resolve(") + __dict_Show_string.show(v1)) + ");"));
      Js_codegen$compile_cps(ctx, e2, cont);
      const _t12442 = Js_codegen$pop_scope(ctx);
      const _t12438 = _t12442;
      return _t12438;
    }
    _t12435 = Js_codegen$compile_cps(ctx, e1, _t12436);
  } else {
    const v1_12443 = Js_codegen$compile_non_tail(ctx, e1);
    const js_name_12445 = Js_codegen$mangle_name(name);
    let _t12447;
    if ((js_name_12445 === "_")) {
      _t12447 = Js_codegen$fresh_tmp(ctx);
    } else {
      function _t12448(n) {
        (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
        return n;
      }
      _t12447 = _call(_t12448, [(js_name_12445 + ("_" + string_of_int(ctx.tmp_counter)))]);
    }
    const actual_name_12449 = _t12447;
    Js_codegen$push_scope(ctx);
    Js_codegen$bind_var(ctx, name, actual_name_12449);
    Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_name_12449)) + " = _resolve(") + __dict_Show_string.show(v1_12443)) + ");"));
    Js_codegen$compile_cps(ctx, e2, cont);
    const _t12450 = Js_codegen$pop_scope(ctx);
    const _t12446 = _t12450;
    const _t12444 = _t12446;
    _t12435 = _t12444;
  }
  return _t12435;
}
function Js_codegen$compile_letrec_cps(ctx, name, fn_expr, body, cont) {
  const js_name_12451 = Js_codegen$mangle_name(name);
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, js_name_12451);
  let _t12454;
  const _t12453 = fn_expr.expr;
  _t12455: {
    if (_t12453._tag === 10) {
      _t12454 = Js_codegen$compile_named_function(ctx, js_name_12451, fn_expr);
      break _t12455;
    }
    if (true) {
      Js_codegen$emit_js_placeholder(ctx, js_name_12451, fn_expr);
      _t12454 = Js_codegen$emit_js_backpatch(ctx, js_name_12451, fn_expr);
      break _t12455;
    }
    _match_fail("line 16629");
  }
  _t12454;
  Js_codegen$compile_cps(ctx, body, cont);
  const _t12452 = Js_codegen$pop_scope(ctx);
  return _t12452;
}
function Js_codegen$compile_seq_cps(ctx, e1, e2, cont) {
  let _t12456;
  if (Js_codegen$expr_has_perform(e1)) {
    function _t12457(v1) {
      Js_codegen$emit_line(ctx, (("_resolve(" + __dict_Show_string.show(v1)) + ");"));
      return Js_codegen$compile_cps(ctx, e2, cont);
    }
    _t12456 = Js_codegen$compile_cps(ctx, e1, _t12457);
  } else {
    const v1_12458 = Js_codegen$compile_non_tail(ctx, e1);
    Js_codegen$emit_line(ctx, (("_resolve(" + __dict_Show_string.show(v1_12458)) + ");"));
    const _t12459 = Js_codegen$compile_cps(ctx, e2, cont);
    _t12456 = _t12459;
  }
  return _t12456;
}
function Js_codegen$compile_if_cps(ctx, cond, then_e, else_e, cont) {
  const c_12460 = Js_codegen$compile_non_tail(ctx, cond);
  Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(c_12460)) + ") {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  Js_codegen$compile_cps(ctx, then_e, cont);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "} else {");
  (ctx.indent = (ctx.indent + 1), undefined);
  Js_codegen$compile_cps(ctx, else_e, cont);
  (ctx.indent = (ctx.indent - 1), undefined);
  const _t12461 = Js_codegen$emit_line(ctx, "}");
  return _t12461;
}
function Js_codegen$compile_match_cps(ctx, scrut, arms, loc, cont) {
  const scrut_js_12462 = Js_codegen$compile_non_tail(ctx, scrut);
  const scrut_tmp_12464 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(scrut_tmp_12464)) + " = ") + __dict_Show_string.show(scrut_js_12462)) + ";"));
  const matched_12466 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(matched_12466)) + " = false;"));
  function _t12468(__p433) {
    let _t12470;
    const _t12469 = __p433;
    _t12471: {
      if (true) {
        const pat = _t12469[0];
        const guard = _t12469[1];
        const body = _t12469[2];
        let _t12473;
        const _t12472 = Js_codegen$compile_pattern(ctx, scrut_tmp_12464, pat);
        _t12474: {
          if (true) {
            const conds = _t12472[0];
            const bindings = _t12472[1];
            let _t12476;
            const _t12475 = conds;
            _t12477: {
              if (_t12475 === null) {
                _t12476 = "true";
                break _t12477;
              }
              if (true) {
                _t12476 = String$concat(" && ", conds);
                break _t12477;
              }
              _match_fail("line 16629");
            }
            const cond_str_12478 = _t12476;
            Js_codegen$emit_line(ctx, (((("if (!" + __dict_Show_string.show(matched_12466)) + " && ") + __dict_Show_string.show(cond_str_12478)) + ") {"));
            (ctx.indent = (ctx.indent + 1), undefined);
            Js_codegen$push_scope(ctx);
            function _t12480(__p434) {
              let _t12482;
              const _t12481 = __p434;
              _t12483: {
                if (true) {
                  const mml_name = _t12481[0];
                  const js_expr = _t12481[1];
                  const js_nm_12484 = Js_codegen$mangle_name(mml_name);
                  Js_codegen$bind_var(ctx, mml_name, js_nm_12484);
                  const _t12485 = Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_nm_12484)) + " = ") + __dict_Show_string.show(js_expr)) + ";"));
                  _t12482 = _t12485;
                  break _t12483;
                }
                _match_fail("line 16629");
              }
              return _t12482;
            }
            List$iter(_t12480, bindings);
            let _t12487;
            const _t12486 = guard;
            _t12488: {
              if (_t12486._tag === 1) {
                const g = _t12486._val;
                const guard_js_12489 = Js_codegen$compile_non_tail(ctx, g);
                Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(guard_js_12489)) + ") {"));
                (ctx.indent = (ctx.indent + 1), undefined);
                Js_codegen$emit_line(ctx, (__dict_Show_string.show(matched_12466) + " = true;"));
                Js_codegen$compile_cps(ctx, body, cont);
                (ctx.indent = (ctx.indent - 1), undefined);
                const _t12490 = Js_codegen$emit_line(ctx, "}");
                _t12487 = _t12490;
                break _t12488;
              }
              if (_t12486._tag === 0) {
                Js_codegen$emit_line(ctx, (__dict_Show_string.show(matched_12466) + " = true;"));
                _t12487 = Js_codegen$compile_cps(ctx, body, cont);
                break _t12488;
              }
              _match_fail("line 16629");
            }
            _t12487;
            Js_codegen$pop_scope(ctx);
            (ctx.indent = (ctx.indent - 1), undefined);
            const _t12479 = Js_codegen$emit_line(ctx, "}");
            _t12473 = _t12479;
            break _t12474;
          }
          _match_fail("line 16629");
        }
        _t12470 = _t12473;
        break _t12471;
      }
      _match_fail("line 16629");
    }
    return _t12470;
  }
  List$iter(_t12468, arms);
  const _t12467 = Js_codegen$emit_line(ctx, (((("if (!" + __dict_Show_string.show(matched_12466)) + ") _match_fail(\"line ") + __dict_Show_int.show(loc.line)) + "\");"));
  const _t12465 = _t12467;
  const _t12463 = _t12465;
  return _t12463;
}
function Js_codegen$compile_app_cps(ctx, _te, fn_, arg, cont) {
  function collect_args(expr, acc) {
    while (true) {
      let _t12492;
      const _t12491 = expr.expr;
      _t12493: {
        if (_t12491._tag === 11) {
          const inner_fn = _t12491._val[0];
          const inner_arg = _t12491._val[1];
          const _t12494 = inner_fn;
          const _t12495 = ({_hd: inner_arg, _tl: acc});
          expr = _t12494;
          acc = _t12495;
          continue;
          _t12492 = undefined;
          break _t12493;
        }
        if (true) {
          _t12492 = [expr, acc];
          break _t12493;
        }
        _match_fail("line 16629");
      }
      return _t12492;
    }
  }
  let _t12498;
  const _t12497 = collect_args(fn_, ({_hd: arg, _tl: null}));
  _t12499: {
    if (true) {
      const base_fn = _t12497[0];
      const all_args = _t12497[1];
      const fn_js_12500 = Js_codegen$compile_non_tail(ctx, base_fn);
      const args_js_12502 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), all_args);
      const n_12504 = List$length(all_args);
      const known_arity_12506 = Js_codegen$count_arrows(base_fn.ty);
      let _t12508;
      if (_eq(known_arity_12506, ({_tag: 1, _name: "Some", _val: n_12504}))) {
        _t12508 = (fn_js_12500 + ("(" + (String$concat(", ", args_js_12502) + ")")));
      } else {
        _t12508 = ("_call(" + (fn_js_12500 + (", [" + (String$concat(", ", args_js_12502) + "])"))));
      }
      const call_expr_12509 = _t12508;
      const result_var_12511 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_var_12511)) + " = _resolve(") + __dict_Show_string.show(call_expr_12509)) + ");"));
      const _t12512 = cont(result_var_12511);
      const _t12510 = _t12512;
      const _t12507 = _t12510;
      const _t12505 = _t12507;
      const _t12503 = _t12505;
      const _t12501 = _t12503;
      _t12498 = _t12501;
      break _t12499;
    }
    _match_fail("line 16629");
  }
  const _t12496 = _t12498;
  return _t12496;
}
function Js_codegen$compile_decl(ctx, decl) {
  let _t12514;
  const _t12513 = decl;
  _t12515: {
    if (_t12513._tag === 0) {
      const name = _t12513._val[0];
      const te = _t12513._val[1];
      let _t12516;
      if ((name === "_")) {
        const v_12517 = Js_codegen$compile_expr(ctx, te);
        const _t12518 = Js_codegen$emit_line(ctx, (__dict_Show_string.show(v_12517) + ";"));
        _t12516 = _t12518;
      } else {
        const base_name_12519 = Js_codegen$mangle_name(name);
        let _t12522;
        const _t12521 = ctx.scopes;
        _t12523: {
          if (_t12521 !== null) {
            const tbl = _t12521._hd;
            if (_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, tbl, name])) {
              _t12522 = (Js_codegen$fresh_tmp(ctx) + ("_" + base_name_12519));
              break _t12523;
            }
          }
          if (true) {
            _t12522 = base_name_12519;
            break _t12523;
          }
          _match_fail("line 16629");
        }
        const js_name_12524 = _t12522;
        let _t12527;
        const _t12526 = te.expr;
        _t12528: {
          if (_t12526._tag === 10) {
            Js_codegen$compile_named_function(ctx, js_name_12524, te);
            _t12527 = Js_codegen$bind_var(ctx, name, js_name_12524);
            break _t12528;
          }
          if (true) {
            const v_12529 = Js_codegen$compile_expr(ctx, te);
            Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_name_12524)) + " = ") + __dict_Show_string.show(v_12529)) + ";"));
            const _t12530 = Js_codegen$bind_var(ctx, name, js_name_12524);
            _t12527 = _t12530;
            break _t12528;
          }
          _match_fail("line 16629");
        }
        _t12527;
        let _t12531;
        if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
          _t12531 = (ctx.top_level_exports = ({_hd: [name, js_name_12524], _tl: ctx.top_level_exports}), undefined);
        } else {
          _t12531 = undefined;
        }
        const _t12525 = _t12531;
        const _t12520 = _t12525;
        _t12516 = _t12520;
      }
      _t12514 = _t12516;
      break _t12515;
    }
    if (_t12513._tag === 1) {
      const name = _t12513._val[0];
      const te = _t12513._val[1];
      const base_name_12532 = Js_codegen$mangle_name(name);
      let _t12535;
      const _t12534 = ctx.scopes;
      _t12536: {
        if (_t12534 !== null) {
          const tbl = _t12534._hd;
          if (_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, tbl, name])) {
            _t12535 = (Js_codegen$fresh_tmp(ctx) + ("_" + base_name_12532));
            break _t12536;
          }
        }
        if (true) {
          _t12535 = base_name_12532;
          break _t12536;
        }
        _match_fail("line 16629");
      }
      const js_name_12537 = _t12535;
      const v_12539 = Js_codegen$compile_expr(ctx, te);
      Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(js_name_12537)) + " = ") + __dict_Show_string.show(v_12539)) + ";"));
      Js_codegen$bind_var(ctx, name, js_name_12537);
      let _t12541;
      if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
        _t12541 = (ctx.top_level_exports = ({_hd: [name, js_name_12537], _tl: ctx.top_level_exports}), undefined);
      } else {
        _t12541 = undefined;
      }
      const _t12540 = _t12541;
      const _t12538 = _t12540;
      const _t12533 = _t12538;
      _t12514 = _t12533;
      break _t12515;
    }
    if (_t12513._tag === 2) {
      const name = _t12513._val[0];
      const te = _t12513._val[1];
      const base_name_12542 = Js_codegen$mangle_name(name);
      let _t12545;
      const _t12544 = ctx.scopes;
      _t12546: {
        if (_t12544 !== null) {
          const tbl = _t12544._hd;
          if (_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, tbl, name])) {
            _t12545 = (Js_codegen$fresh_tmp(ctx) + ("_" + base_name_12542));
            break _t12546;
          }
        }
        if (true) {
          _t12545 = base_name_12542;
          break _t12546;
        }
        _match_fail("line 16629");
      }
      const js_name_12547 = _t12545;
      Js_codegen$bind_var(ctx, name, js_name_12547);
      let _t12550;
      const _t12549 = te.expr;
      _t12551: {
        if (_t12549._tag === 10) {
          _t12550 = Js_codegen$compile_named_function(ctx, js_name_12547, te);
          break _t12551;
        }
        if (true) {
          Js_codegen$emit_js_placeholder(ctx, js_name_12547, te);
          _t12550 = Js_codegen$emit_js_backpatch(ctx, js_name_12547, te);
          break _t12551;
        }
        _match_fail("line 16629");
      }
      _t12550;
      let _t12552;
      if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
        _t12552 = (ctx.top_level_exports = ({_hd: [name, js_name_12547], _tl: ctx.top_level_exports}), undefined);
      } else {
        _t12552 = undefined;
      }
      const _t12548 = _t12552;
      const _t12543 = _t12548;
      _t12514 = _t12543;
      break _t12515;
    }
    if (_t12513._tag === 3) {
      const bindings = _t12513._val;
      function _t12553(__p435) {
        let _t12555;
        const _t12554 = __p435;
        _t12556: {
          if (true) {
            const name = _t12554[0];
            const te = _t12554[1];
            const base_name_12557 = Js_codegen$mangle_name(name);
            let _t12560;
            const _t12559 = ctx.scopes;
            _t12561: {
              if (_t12559 !== null) {
                const tbl = _t12559._hd;
                if (_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, tbl, name])) {
                  _t12560 = (Js_codegen$fresh_tmp(ctx) + ("_" + base_name_12557));
                  break _t12561;
                }
              }
              if (true) {
                _t12560 = base_name_12557;
                break _t12561;
              }
              _match_fail("line 16629");
            }
            const js_name_12562 = _t12560;
            const _t12563 = [name, js_name_12562, te];
            const _t12558 = _t12563;
            _t12555 = _t12558;
            break _t12556;
          }
          _match_fail("line 16629");
        }
        return _t12555;
      }
      const named_bindings_12564 = List$map(_t12553, bindings);
      function _t12566(__p436) {
        let _t12568;
        const _t12567 = __p436;
        _t12569: {
          if (true) {
            const name = _t12567[0];
            const js_name = _t12567[1];
            const te = _t12567[2];
            Js_codegen$bind_var(ctx, name, js_name);
            let _t12570;
            if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
              _t12570 = (ctx.top_level_exports = ({_hd: [name, js_name], _tl: ctx.top_level_exports}), undefined);
            } else {
              _t12570 = undefined;
            }
            _t12570;
            let _t12572;
            const _t12571 = te.expr;
            _t12573: {
              if (_t12571._tag === 10) {
                _t12572 = undefined;
                break _t12573;
              }
              if (true) {
                _t12572 = Js_codegen$emit_js_placeholder(ctx, js_name, te);
                break _t12573;
              }
              _match_fail("line 16629");
            }
            _t12568 = _t12572;
            break _t12569;
          }
          _match_fail("line 16629");
        }
        return _t12568;
      }
      List$iter(_t12566, named_bindings_12564);
      function _t12574(__p437) {
        let _t12576;
        const _t12575 = __p437;
        _t12577: {
          if (true) {
            const _name = _t12575[0];
            const js_name = _t12575[1];
            const fn_expr = _t12575[2];
            let _t12579;
            const _t12578 = fn_expr.expr;
            _t12580: {
              if (_t12578._tag === 10) {
                _t12579 = Js_codegen$compile_named_function(ctx, js_name, fn_expr);
                break _t12580;
              }
              if (true) {
                _t12579 = undefined;
                break _t12580;
              }
              _match_fail("line 16629");
            }
            _t12576 = _t12579;
            break _t12577;
          }
          _match_fail("line 16629");
        }
        return _t12576;
      }
      List$iter(_t12574, named_bindings_12564);
      function _t12581(__p438) {
        let _t12583;
        const _t12582 = __p438;
        _t12584: {
          if (true) {
            const _name = _t12582[0];
            const js_name = _t12582[1];
            const te = _t12582[2];
            let _t12586;
            const _t12585 = te.expr;
            _t12587: {
              if (_t12585._tag === 10) {
                _t12586 = undefined;
                break _t12587;
              }
              if (true) {
                _t12586 = Js_codegen$emit_js_backpatch(ctx, js_name, te);
                break _t12587;
              }
              _match_fail("line 16629");
            }
            _t12583 = _t12586;
            break _t12584;
          }
          _match_fail("line 16629");
        }
        return _t12583;
      }
      const _t12565 = List$iter(_t12581, named_bindings_12564);
      _t12514 = _t12565;
      break _t12515;
    }
    if (_t12513._tag === 4) {
      _t12514 = undefined;
      break _t12515;
    }
    if (_t12513._tag === 6) {
      _t12514 = undefined;
      break _t12515;
    }
    if (_t12513._tag === 7) {
      _t12514 = undefined;
      break _t12515;
    }
    if (_t12513._tag === 5) {
      const te = _t12513._val;
      const v_12588 = Js_codegen$compile_expr(ctx, te);
      const _t12589 = Js_codegen$emit_line(ctx, (("_last_val = " + __dict_Show_string.show(v_12588)) + ";"));
      _t12514 = _t12589;
      break _t12515;
    }
    if (_t12513._tag === 8) {
      const name = _t12513._val[0];
      const _scheme = _t12513._val[1];
      const js_name_12590 = Js_codegen$mangle_name(name);
      Js_codegen$emit_line(ctx, (((((((((("if (typeof " + __dict_Show_string.show(js_name_12590)) + " === \"undefined\") { if (globalThis._mmlExterns && globalThis._mmlExterns[") + __dict_Show_string.show(Js_codegen$escape_js_string(name))) + "]) var ") + __dict_Show_string.show(js_name_12590)) + " = globalThis._mmlExterns[") + __dict_Show_string.show(Js_codegen$escape_js_string(name))) + "]; else throw new Error(\"extern \" + ") + __dict_Show_string.show(Js_codegen$escape_js_string(name))) + " + \" not provided\"); }"));
      const _t12591 = Js_codegen$bind_var(ctx, name, js_name_12590);
      _t12514 = _t12591;
      break _t12515;
    }
    if (_t12513._tag === 9) {
      const mod_name = _t12513._val[0];
      const decls = _t12513._val[1];
      const saved_module_12592 = ctx.current_module;
      (ctx.current_module = ({_tag: 1, _name: "Some", _val: mod_name}), undefined);
      Js_codegen$push_scope(ctx);
      List$iter(_call(Js_codegen$compile_decl, [ctx]), decls);
      (ctx.current_module = saved_module_12592, undefined);
      let _t12595;
      const _t12594 = ctx.scopes;
      _t12596: {
        if (_t12594 !== null) {
          const current = _t12594._hd;
          function _t12597(mml_name, js_name) {
            const qualified_12598 = (mod_name + ("." + mml_name));
            let _t12601;
            const _t12600 = ctx.scopes;
            _t12602: {
              if (_t12600 !== null && _t12600._tl !== null) {
                const parent = _t12600._tl._hd;
                _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, parent, qualified_12598, js_name]);
                _t12601 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, parent, mml_name, js_name]);
                break _t12602;
              }
              if (true) {
                _t12601 = undefined;
                break _t12602;
              }
              _match_fail("line 16629");
            }
            const _t12599 = _t12601;
            return _t12599;
          }
          _t12595 = Hashtbl$iter(_t12597, current);
          break _t12596;
        }
        if (_t12594 === null) {
          _t12595 = undefined;
          break _t12596;
        }
        _match_fail("line 16629");
      }
      _t12595;
      const _t12593 = Js_codegen$pop_scope(ctx);
      _t12514 = _t12593;
      break _t12515;
    }
    if (_t12513._tag === 10) {
      const aliases = _t12513._val;
      function _t12603(__p439) {
        let _t12605;
        const _t12604 = __p439;
        _t12606: {
          if (true) {
            const short_name = _t12604[0];
            const qualified_name = _t12604[1];
            const js_name_12607 = Js_codegen$lookup_var(ctx, qualified_name);
            const _t12608 = Js_codegen$bind_var(ctx, short_name, js_name_12607);
            _t12605 = _t12608;
            break _t12606;
          }
          _match_fail("line 16629");
        }
        return _t12605;
      }
      _t12514 = List$iter(_t12603, aliases);
      break _t12515;
    }
    _match_fail("line 16629");
  }
  return _t12514;
}
const Js_codegen$js_builtins = "// --- Builtins ---\nfunction print(v) {\n  const s = (typeof v === \"string\") ? v : _pp(v);\n  if (typeof globalThis._jsOutput === \"function\") globalThis._jsOutput(s);\n  else if (typeof process !== \"undefined\") process.stdout.write(s);\n  return undefined;\n}\nfunction println(v) {\n  const s = (typeof v === \"string\") ? v : _pp(v);\n  if (typeof globalThis._jsOutput === \"function\") globalThis._jsOutput(s + \"\\n\");\n  else if (typeof process !== \"undefined\") process.stdout.write(s + \"\\n\");\n  return undefined;\n}\nfunction string_of_int(n) { return String(n); }\nfunction int_of_string(s) { const n = parseInt(s, 10); if (isNaN(n)) throw new Error(\"int_of_string: \" + s); return n; }\nfunction float_of_int(n) { return n; }\nfunction int_of_float(f) { return Math.trunc(f); }\nfunction float_of_string(s) { const f = parseFloat(s); if (isNaN(f)) throw new Error(\"float_of_string: \" + s); return f; }\nfunction string_of_float(f) {\n  const s = String(f);\n  return s.includes(\".\") || s.includes(\"e\") ? s : s + \".\";\n}\nfunction string_of_bool(b) { return String(b); }\nfunction failwith(msg) { throw new Error(msg); }\nconst not = (b) => !b;\nfunction $caret(a, b) { return a + b; }\nfunction $mod(a, b) { return a % b; }\nfunction __show_value(v) { return _pp(v); }\nfunction copy_continuation(k) { return k; }\nconst ignore = (_) => undefined;\nfunction fst(t) { return t[0]; }\nfunction snd(t) { return t[1]; }\nfunction string_length(s) { return s.length; }\nfunction string_sub(s, start, len) { return s.substring(start, start + len); }\nfunction string_get(s, i) { return s.charCodeAt(i); }\nfunction string_contains(s, sub) { return s.includes(sub); }\nfunction string_concat(sep, parts) {\n  const arr = [];\n  let c = parts;\n  while (c !== null) { arr.push(c._hd); c = c._tl; }\n  return arr.join(sep);\n}\nfunction array_length(a) { return a._arr.length; }\nfunction array_get(a, i) { return a._arr[i]; }\nfunction array_set(a, i, v) { a._arr[i] = v; return undefined; }\nfunction array_make(n, v) { return {_arr: new Array(n).fill(v)}; }\nfunction array_of_list(lst) {\n  const arr = [];\n  let c = lst;\n  while (c !== null) { arr.push(c._hd); c = c._tl; }\n  return {_arr: arr};\n}\nfunction array_to_list(arr) {\n  const a = arr._arr;\n  let result = null;\n  for (let i = a.length - 1; i >= 0; i--) result = {_hd: a[i], _tl: result};\n  return result;\n}\nfunction array_copy(a) { return {_arr: a._arr.slice()}; }\nfunction array_sub(a, start, len) { return {_arr: a._arr.slice(start, start + len)}; }\nfunction __math_pow(a, b) { return Math.pow(a, b); }\nfunction __math_sqrt(x) { return Math.sqrt(x); }\nfunction __math_floor(x) { return Math.floor(x); }\nfunction __math_ceil(x) { return Math.ceil(x); }\nfunction __math_round(x) { return Math.round(x); }\nfunction __math_abs(x) { return Math.abs(x); }\nfunction __math_sin(x) { return Math.sin(x); }\nfunction __math_cos(x) { return Math.cos(x); }\nfunction __math_abs_float(x) { return Math.abs(x); }\nfunction __byte_to_char(b) { return String.fromCharCode(b); }\nfunction __byte_to_int(b) { return b; }\nfunction __byte_of_int(n) { return n & 0xFF; }\nfunction __byte_to_string(b) { return String.fromCharCode(b); }\nfunction __char_to_byte(s) { return s.charCodeAt(0); }\nfunction __rune_to_string(cp) {\n  return String.fromCodePoint(cp);\n}\nfunction __string_to_runes(s) {\n  const cps = Array.from(s).map(c => c.codePointAt(0));\n  let result = null;\n  for (let i = cps.length - 1; i >= 0; i--) result = {_hd: cps[i], _tl: result};\n  return result;\n}\nfunction __rune_to_int(r) { return r; }\nfunction __rune_of_int(n) { return n; }\nfunction __int_to_hex(n) { return n.toString(16); }\nfunction __int_to_oct(n) { return n.toString(8); }\nfunction __int_to_bin(n) { return n.toString(2); }\nfunction __fmt_float(prec, f) { return f.toFixed(prec); }\nfunction __fmt_hex(n) { return n.toString(16); }\nfunction __fmt_hex_upper(n) { return n.toString(16).toUpperCase(); }\nfunction __fmt_oct(n) { return n.toString(8); }\nfunction __fmt_bin(n) { return n.toString(2); }\nfunction __fmt_zero_pad(width, s) { return s.padStart(width, \"0\"); }\nfunction __fmt_pad_left(width, s) { return s.padStart(width, \" \"); }\nfunction __fmt_pad_right(width, s) { return s.padEnd(width, \" \"); }\nfunction __sys_time() { return Date.now() / 1000.0; }\nfunction __sys_exit(code) { if (typeof process !== \"undefined\") process.exit(code); throw new Error(\"exit: \" + code); }\n// --- Module extern stubs ---\n// String module\nfunction String$length(s) { return s.length; }\nfunction String$sub(s, start, len) {\n  if (start < 0 || len < 0 || start + len > s.length)\n    throw new Error(\"String.sub: index out of bounds\");\n  return s.substring(start, start + len);\n}\nfunction String$split(delim, input) {\n  if (delim.length === 0) {\n    let r = null;\n    for (let i = input.length - 1; i >= 0; i--) r = {_hd: input[i], _tl: r};\n    return r;\n  }\n  const parts = input.split(delim);\n  let r = null;\n  for (let i = parts.length - 1; i >= 0; i--) r = {_hd: parts[i], _tl: r};\n  return r;\n}\nfunction String$trim(s) { return s.trim(); }\nfunction String$starts_with(prefix, s) { return s.startsWith(prefix); }\nfunction String$contains(sub, s) { return s.includes(sub); }\nfunction String$replace(old_s, new_s, input) {\n  if (old_s.length === 0) return input;\n  return input.split(old_s).join(new_s);\n}\nfunction String$to_int(s) { const n = parseInt(s,10); return isNaN(n) ? {_tag:0,_name:\"None\"} : {_tag:1,_name:\"Some\",_val:n}; }\nfunction String$to_float(s) { const f = parseFloat(s); return isNaN(f) ? {_tag:0,_name:\"None\"} : {_tag:1,_name:\"Some\",_val:f}; }\nfunction String$uppercase(s) { return s.toUpperCase(); }\nfunction String$lowercase(s) { return s.toLowerCase(); }\nfunction String$get(s, i) {\n  if (i < 0 || i >= s.length) throw new Error(\"String.get: index \" + i + \" out of bounds (length \" + s.length + \")\");\n  return s.charCodeAt(i);\n}\nfunction String$to_bytes(s) {\n  let r = null;\n  for (let i = s.length - 1; i >= 0; i--) r = {_hd: s.charCodeAt(i), _tl: r};\n  return r;\n}\nfunction String$of_bytes(lst) {\n  let r = \"\";\n  let c = lst;\n  while (c !== null) { r += String.fromCharCode(c._hd); c = c._tl; }\n  return r;\n}\nfunction String$to_byte_array(s) {\n  const a = new Array(s.length);\n  for (let i = 0; i < s.length; i++) a[i] = s.charCodeAt(i);\n  return {_arr: a};\n}\nfunction String$of_byte_array(a) {\n  let r = \"\";\n  for (let i = 0; i < a._arr.length; i++) r += String.fromCharCode(a._arr[i]);\n  return r;\n}\nfunction String$to_runes(s) { return __string_to_runes(s); }\nfunction String$of_runes(lst) {\n  let r = \"\";\n  let c = lst;\n  while (c !== null) { r += String.fromCodePoint(c._hd); c = c._tl; }\n  return r;\n}\nfunction String$get_rune(s, n) {\n  const cps = Array.from(s);\n  if (n < 0 || n >= cps.length) throw new Error(\"String.get_rune: index \" + n + \" out of bounds\");\n  return cps[n].codePointAt(0);\n}\nfunction String$of_byte(b) { return String.fromCharCode(b); }\nfunction String$rune_length(s) { return Array.from(s).length; }\nfunction String$make(n, b) {\n  if (n < 0) throw new Error(\"String.make: negative length\");\n  return String.fromCharCode(b).repeat(n);\n}\nfunction String$index_opt(s, b) { const i=s.indexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:\"None\"}:{_tag:1,_name:\"Some\",_val:i}; }\nfunction String$rindex_opt(s, b) { const i=s.lastIndexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:\"None\"}:{_tag:1,_name:\"Some\",_val:i}; }\nfunction String$concat(sep, lst) { return string_concat(sep, lst); }\nfunction String$compare(a, b) { return a < b ? -1 : a > b ? 1 : 0; }\n// Array module\nfunction Array$make(n, v) { return array_make(n, v); }\nfunction Array$get(a, i) { return array_get(a, i); }\nfunction Array$set(a, i, v) { return array_set(a, i, v); }\nfunction Array$length(a) { return array_length(a); }\nfunction Array$to_list(a) { return array_to_list(a); }\nfunction Array$of_list(l) { return array_of_list(l); }\nfunction Array$copy(a) { return array_copy(a); }\nfunction Array$sub(a, s, l) { return array_sub(a, s, l); }\n// IO module\nfunction IO$read_file(path) {\n  if (typeof globalThis._jsReadFile === \"function\") return globalThis._jsReadFile(path);\n  if (typeof require !== \"undefined\") return require(\"fs\").readFileSync(path,\"utf8\");\n  throw new Error(\"IO.read_file: not available in this environment\");\n}\nfunction IO$write_file(path, data) {\n  if (typeof require !== \"undefined\") { require(\"fs\").writeFileSync(path,data); return undefined; }\n  throw new Error(\"IO.write_file: not available in this environment\");\n}\nfunction IO$append_file(path, data) {\n  if (typeof require !== \"undefined\") { require(\"fs\").appendFileSync(path,data); return undefined; }\n  throw new Error(\"IO.append_file: not available in this environment\");\n}\nfunction IO$read_line(u) {\n  if (typeof require !== \"undefined\") {\n    const buf = Buffer.alloc(1);\n    let line = \"\";\n    const fd = require(\"fs\").openSync(\"/dev/stdin\", \"rs\");\n    while (true) {\n      const n = require(\"fs\").readSync(fd, buf, 0, 1);\n      if (n === 0 || buf[0] === 10) break;\n      line += String.fromCharCode(buf[0]);\n    }\n    return line;\n  }\n  return \"\";\n}\nfunction IO$file_exists(path) {\n  if (typeof require !== \"undefined\") return require(\"fs\").existsSync(path);\n  return false;\n}\n// Sys module\nfunction Sys$args(u) {\n  if (globalThis._jsSysArgs) {\n    const a = globalThis._jsSysArgs;\n    let r = null;\n    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};\n    return r;\n  }\n  if (typeof process !== \"undefined\") {\n    const a = process.argv.slice(1);\n    let r = null;\n    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};\n    return r;\n  }\n  return null;\n}\nfunction Sys$getenv(name) {\n  if (typeof process !== \"undefined\") {\n    const v = process.env[name];\n    return v === undefined ? {_tag:0,_name:\"None\"} : {_tag:1,_name:\"Some\",_val:v};\n  }\n  return {_tag:0,_name:\"None\"};\n}\nfunction Sys$exit(code) { __sys_exit(code); }\nfunction Sys$time(u) { return __sys_time(); }\n// Runtime module (stubs â€” eval not supported in compiled JS)\nfunction Runtime$eval(s) { throw new Error(\"Runtime.eval: not supported in compiled JS\"); }\nfunction Runtime$eval_file(s) { throw new Error(\"Runtime.eval_file: not supported in compiled JS\"); }\n// --- Typeclass primitive externs ---\nfunction __num_add_int(a, b) { return a + b; }\nfunction __num_sub_int(a, b) { return a - b; }\nfunction __num_mul_int(a, b) { return a * b; }\nfunction __num_div_int(a, b) { if (b === 0) throw new Error(\"division by zero\"); return (a / b) | 0; }\nfunction __num_neg_int(a) { return -a; }\nfunction __num_add_float(a, b) { return a + b; }\nfunction __num_sub_float(a, b) { return a - b; }\nfunction __num_mul_float(a, b) { return a * b; }\nfunction __num_div_float(a, b) { return a / b; }\nfunction __num_neg_float(a) { return -a; }\nfunction __eq_int(a, b) { return a === b; }\nfunction __neq_int(a, b) { return a !== b; }\nfunction __eq_float(a, b) { return a === b; }\nfunction __neq_float(a, b) { return a !== b; }\nfunction __eq_string(a, b) { return a === b; }\nfunction __neq_string(a, b) { return a !== b; }\nfunction __eq_bool(a, b) { return a === b; }\nfunction __neq_bool(a, b) { return a !== b; }\nfunction __eq_byte(a, b) { return a === b; }\nfunction __neq_byte(a, b) { return a !== b; }\nfunction __eq_rune(a, b) { return a === b; }\nfunction __neq_rune(a, b) { return a !== b; }\nfunction __lt_int(a, b) { return a < b; }\nfunction __gt_int(a, b) { return a > b; }\nfunction __le_int(a, b) { return a <= b; }\nfunction __ge_int(a, b) { return a >= b; }\nfunction __lt_float(a, b) { return a < b; }\nfunction __gt_float(a, b) { return a > b; }\nfunction __le_float(a, b) { return a <= b; }\nfunction __ge_float(a, b) { return a >= b; }\nfunction __lt_string(a, b) { return a < b; }\nfunction __gt_string(a, b) { return a > b; }\nfunction __le_string(a, b) { return a <= b; }\nfunction __ge_string(a, b) { return a >= b; }\nfunction __lt_byte(a, b) { return a < b; }\nfunction __gt_byte(a, b) { return a > b; }\nfunction __le_byte(a, b) { return a <= b; }\nfunction __ge_byte(a, b) { return a >= b; }\nfunction __lt_rune(a, b) { return a < b; }\nfunction __gt_rune(a, b) { return a > b; }\nfunction __le_rune(a, b) { return a <= b; }\nfunction __ge_rune(a, b) { return a >= b; }\nfunction __band_int(a, b) { return a & b; }\nfunction __bor_int(a, b) { return a | b; }\nfunction __bxor_int(a, b) { return a ^ b; }\nfunction __bshl_int(a, b) { return a << b; }\nfunction __bshr_int(a, b) { return a >> b; }\nfunction __bnot_int(a) { return ~a; }\nfunction __show_int(a) { return String(a); }\nfunction __show_float(a) { return string_of_float(a); }\nfunction __show_bool(a) { return String(a); }\nfunction __show_string(a) { return a; }\nfunction __show_unit(_) { return \"()\"; }\nfunction __show_byte(a) { return \"#\" + a.toString(16).padStart(2, \"0\"); }\nfunction __show_rune(a) { return String.fromCodePoint(a); }\nfunction __index_at_array(i, arr) { if (i < 0 || i >= arr.length) throw new Error(\"array index out of bounds: \" + i + \" (length \" + arr.length + \")\"); return arr[i]; }\nfunction __index_at_string(i, s) { if (i < 0 || i >= s.length) throw new Error(\"string index out of bounds: \" + i + \" (length \" + s.length + \")\"); return s.charCodeAt(i); }\n// --- Canvas builtins (browser only) ---\nfunction Canvas$init(w, h) {\n  if (typeof globalThis._canvasInit === \"function\") globalThis._canvasInit(w, h);\n  return undefined;\n}\nfunction Canvas$clear(color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height); }\n  return undefined;\n}\nfunction Canvas$fill_rect(x, y, w, h, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.fillRect(x, y, w, h); }\n  return undefined;\n}\nfunction Canvas$stroke_rect(x, y, w, h, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.strokeStyle = color; ctx.lineWidth = 1; ctx.strokeRect(x, y, w, h); }\n  return undefined;\n}\nfunction Canvas$fill_circle(x, y, r, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x, y, r, 0, 2*Math.PI); ctx.fill(); }\n  return undefined;\n}\nfunction Canvas$draw_text(text, x, y, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.textBaseline = \"top\"; ctx.fillText(text, x, y); }\n  return undefined;\n}\nfunction Canvas$set_font(font) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.font = font; }\n  return undefined;\n}\nfunction Canvas$mouse_x(_) { return globalThis._canvasMouseX || 0; }\nfunction Canvas$mouse_y(_) { return globalThis._canvasMouseY || 0; }\nfunction Canvas$mouse_down(_) { return !!globalThis._canvasMouseDown; }\nfunction Canvas$mouse_clicked(_) { return !!globalThis._canvasMouseClicked; }\nfunction Canvas$key_down(key) { return !!(globalThis._canvasKeysDown && globalThis._canvasKeysDown[key]); }\nfunction Canvas$key_pressed(key) { return !!(globalThis._canvasKeysPressed && globalThis._canvasKeysPressed[key]); }\nfunction Canvas$start_app(init_fn, frame_fn) {\n  globalThis._canvasApp = { initFn: init_fn, frameFn: frame_fn, jsMode: true, call: _call };\n  return undefined;\n}\n";
function Js_codegen$emit_exports(ctx) {
  Js_codegen$emit(ctx, "var _mml_exports = {\"_result\": _last_val, \"_call\": _call, \"_pp\": _pp");
  function _t12609(__p440) {
    let _t12611;
    const _t12610 = __p440;
    _t12612: {
      if (true) {
        const mml_name = _t12610[0];
        const js_name = _t12610[1];
        _t12611 = Js_codegen$emit(ctx, (((", " + __dict_Show_string.show(Js_codegen$escape_js_string(mml_name))) + ": ") + __dict_Show_string.show(js_name)));
        break _t12612;
      }
      _match_fail("line 16629");
    }
    return _t12611;
  }
  List$iter(_t12609, List$rev(ctx.top_level_exports));
  Js_codegen$emit(ctx, "};\n");
  return Js_codegen$emit(ctx, "if (typeof globalThis !== \"undefined\") globalThis._mmlExports = _mml_exports;\n");
}
function Js_codegen$compile_program(type_env, program) {
  const ctx_12613 = Js_codegen$create_ctx(type_env);
  Js_codegen$emit(ctx_12613, Js_codegen$js_runtime);
  Js_codegen$emit(ctx_12613, Js_codegen$js_builtins);
  Js_codegen$emit(ctx_12613, "// --- Compiled MiniML ---\n");
  Js_codegen$emit(ctx_12613, "let _last_val;\n");
  List$iter(_call(Js_codegen$compile_decl, [ctx_12613]), program);
  Js_codegen$emit(ctx_12613, "if (_last_val !== undefined) println(_pp(_last_val));\n");
  Js_codegen$emit_exports(ctx_12613);
  const _t12614 = Buffer$contents(ctx_12613.buf);
  return _t12614;
}
function Js_codegen$compile_program_with_stdlib(type_env, stdlib_programs, user_program) {
  const ctx_12615 = Js_codegen$create_ctx(type_env);
  Js_codegen$emit(ctx_12615, Js_codegen$js_runtime);
  Js_codegen$emit(ctx_12615, Js_codegen$js_builtins);
  Js_codegen$emit(ctx_12615, "// --- Stdlib ---\n");
  function _t12617(__p441) {
    let _t12619;
    const _t12618 = __p441;
    _t12620: {
      if (true) {
        const _te = _t12618[0];
        const prog = _t12618[1];
        function _t12621(decl) {
          const saved_pos_12622 = Buffer$length(ctx_12615.buf);
          const saved_indent_12624 = ctx_12615.indent;
          const _t12626 = (function() {
            const _t12627 = _h;
            _h = Object.assign({}, _t12627, {
              "codegen_error": function(_, __k_try) { throw {_e: "codegen_error", _v: _}; },
            });
            try {
              const __x_12628 = Js_codegen$compile_decl(ctx_12615, decl);
              return __x_12628;
            } catch (_exc) {
              if (_exc && _exc._e === "codegen_error") {
                const _ = _exc._v;
                const full_12629 = Buffer$contents(ctx_12615.buf);
                Buffer$clear(ctx_12615.buf);
                Buffer$add_string(ctx_12615.buf, String$sub(full_12629, 0, saved_pos_12622));
                const _t12630 = (ctx_12615.indent = saved_indent_12624, undefined);
                return _t12630;
              } else { throw _exc; }
            } finally { _h = _t12627; }
          })();
          const _t12625 = _t12626;
          const _t12623 = _t12625;
          return _t12623;
        }
        _t12619 = List$iter(_t12621, prog);
        break _t12620;
      }
      _match_fail("line 16629");
    }
    return _t12619;
  }
  List$iter(_t12617, stdlib_programs);
  Js_codegen$emit(ctx_12615, "// --- Compiled MiniML ---\n");
  Js_codegen$emit(ctx_12615, "let _last_val;\n");
  const stdlib_exports_12631 = ctx_12615.top_level_exports;
  (ctx_12615.top_level_exports = null, undefined);
  List$iter(_call(Js_codegen$compile_decl, [ctx_12615]), user_program);
  Js_codegen$emit(ctx_12615, "if (_last_val !== undefined) println(_pp(_last_val));\n");
  const user_exports_12633 = ctx_12615.top_level_exports;
  (ctx_12615.top_level_exports = user_exports_12633, undefined);
  stdlib_exports_12631;
  undefined;
  Js_codegen$emit_exports(ctx_12615);
  const _t12634 = Buffer$contents(ctx_12615.buf);
  const _t12632 = _t12634;
  const _t12616 = _t12632;
  return _t12616;
}
function Main$list_iter(f, xs) {
  while (true) {
    let _t12636;
    const _t12635 = xs;
    _t12637: {
      if (_t12635 === null) {
        _t12636 = undefined;
        break _t12637;
      }
      if (_t12635 !== null) {
        const x = _t12635._hd;
        const rest = _t12635._tl;
        f(x);
        const _t12638 = f;
        const _t12639 = rest;
        f = _t12638;
        xs = _t12639;
        continue;
        _t12636 = undefined;
        break _t12637;
      }
      _match_fail("line 16629");
    }
    return _t12636;
  }
}
function Main$list_iteri_aux(f, i, xs) {
  while (true) {
    let _t12641;
    const _t12640 = xs;
    _t12642: {
      if (_t12640 === null) {
        _t12641 = undefined;
        break _t12642;
      }
      if (_t12640 !== null) {
        const x = _t12640._hd;
        const rest = _t12640._tl;
        f(i, x);
        const _t12643 = f;
        const _t12644 = (i + 1);
        const _t12645 = rest;
        f = _t12643;
        i = _t12644;
        xs = _t12645;
        continue;
        _t12641 = undefined;
        break _t12642;
      }
      _match_fail("line 16629");
    }
    return _t12641;
  }
}
function Main$list_iteri(f, xs) {
  return Main$list_iteri_aux(f, 0, xs);
}
let Main$native_global_entries = null;
function Main$register_native_ext(idx, name, arity) {
  return (Main$native_global_entries = ({_hd: _call(Serialize$serialize_native_ext, [({show: __show_value}), idx, name, arity]), _tl: Main$native_global_entries}), undefined);
}
function Main$register_native_dict(idx, fields) {
  return (Main$native_global_entries = ({_hd: _call(Serialize$serialize_native_dict, [({show: __show_value}), idx, fields]), _tl: Main$native_global_entries}), undefined);
}
function _t12646_Main$build_native_globals_json(_) {
  return String$concat(",", List$rev(Main$native_global_entries));
}
function Main$add_global(global_names, name) {
  const idx_12647 = Dynarray$length(global_names);
  Dynarray$push(global_names, name);
  const _t12648 = idx_12647;
  return _t12648;
}
function Main$register_builtin(ctx, global_names, name, ty, quant, arity) {
  const scheme_12649 = ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: quant, record_evidences: null, rquant: 0});
  const idx_12651 = Main$add_global(global_names, name);
  Main$register_native_ext(idx_12651, name, arity);
  const stdlib_name_12653 = ("Stdlib." + name);
  const sidx_12655 = Main$add_global(global_names, stdlib_name_12653);
  Main$register_native_ext(sidx_12655, name, arity);
  const vars_12657 = ({_hd: [stdlib_name_12653, scheme_12649], _tl: ({_hd: [name, scheme_12649], _tl: ctx.vars})});
  const __rec_upd_12659 = ctx;
  const _t12660 = ({constraint_tvars: __rec_upd_12659.constraint_tvars, current_eff: __rec_upd_12659.current_eff, current_module: __rec_upd_12659.current_module, inside_handler: __rec_upd_12659.inside_handler, loop_info: __rec_upd_12659.loop_info, mutable_vars: __rec_upd_12659.mutable_vars, return_type: __rec_upd_12659.return_type, return_used: __rec_upd_12659.return_used, type_env: __rec_upd_12659.type_env, vars: vars_12657});
  const _t12658 = [scheme_12649, _t12660];
  const _t12656 = _t12658;
  const _t12654 = _t12656;
  const _t12652 = _t12654;
  const _t12650 = _t12652;
  return _t12650;
}
function Main$register_module_fn(ctx, global_names, mod_name, fn_name, ty, arity) {
  const qualified_12661 = ((mod_name + ".") + fn_name);
  const idx_12663 = Main$add_global(global_names, qualified_12661);
  Main$register_native_ext(idx_12663, qualified_12661, arity);
  const max_gen_12665 = Typechecker$max_tgen_in_ty(ty);
  let _t12667;
  if ((max_gen_12665 >= 0)) {
    _t12667 = ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: (max_gen_12665 + 1), record_evidences: null, rquant: 0});
  } else {
    _t12667 = Types$mono(ty);
  }
  const scheme_12668 = _t12667;
  const vars_12670 = ({_hd: [qualified_12661, scheme_12668], _tl: ctx.vars});
  const __rec_upd_12672 = ctx;
  const _t12673 = ({constraint_tvars: __rec_upd_12672.constraint_tvars, current_eff: __rec_upd_12672.current_eff, current_module: __rec_upd_12672.current_module, inside_handler: __rec_upd_12672.inside_handler, loop_info: __rec_upd_12672.loop_info, mutable_vars: __rec_upd_12672.mutable_vars, return_type: __rec_upd_12672.return_type, return_used: __rec_upd_12672.return_used, type_env: __rec_upd_12672.type_env, vars: vars_12670});
  const _t12671 = [[fn_name, scheme_12668], _t12673];
  const _t12669 = _t12671;
  const _t12666 = _t12669;
  const _t12664 = _t12666;
  const _t12662 = _t12664;
  return _t12662;
}
function Main$register_class_in_ctx(ctx, name, tyvars, methods) {
  const num_params_12674 = List$length(tyvars);
  const class_def_12676 = ({class_fundeps: null, class_methods: methods, class_name: name, class_params: tyvars});
  function _t12678(vars, __p442) {
    let _t12680;
    const _t12679 = __p442;
    _t12681: {
      if (true) {
        const mname = _t12679[0];
        const mty = _t12679[1];
        const max_gen_12682 = Typechecker$max_tgen_in_ty(mty);
        let _t12684;
        if (((max_gen_12682 + 1) > num_params_12674)) {
          _t12684 = (max_gen_12682 + 1);
        } else {
          _t12684 = num_params_12674;
        }
        const quant_12685 = _t12684;
        const _t12686 = ({_hd: [mname, ({body: mty, constraints: null, equant: 0, pvquant: 0, quant: quant_12685, record_evidences: null, rquant: 0})], _tl: vars});
        const _t12683 = _t12686;
        _t12680 = _t12683;
        break _t12681;
      }
      _match_fail("line 16629");
    }
    return _t12680;
  }
  const new_vars_12687 = List$fold(_t12678, ctx.vars, methods);
  const __rec_upd_12689 = ctx.type_env;
  const _t12690 = ({classes: ({_hd: class_def_12676, _tl: ctx.type_env.classes}), constructors: __rec_upd_12689.constructors, effects: __rec_upd_12689.effects, hidden_ctor_types: __rec_upd_12689.hidden_ctor_types, hidden_types: __rec_upd_12689.hidden_types, instances: __rec_upd_12689.instances, modules: __rec_upd_12689.modules, mutable_fields: __rec_upd_12689.mutable_fields, newtypes: __rec_upd_12689.newtypes, records: __rec_upd_12689.records, type_aliases: __rec_upd_12689.type_aliases, type_synonyms: __rec_upd_12689.type_synonyms, variants: __rec_upd_12689.variants});
  const type_env_12691 = _t12690;
  const __rec_upd_12693 = ctx;
  const _t12694 = ({constraint_tvars: __rec_upd_12693.constraint_tvars, current_eff: __rec_upd_12693.current_eff, current_module: __rec_upd_12693.current_module, inside_handler: __rec_upd_12693.inside_handler, loop_info: __rec_upd_12693.loop_info, mutable_vars: __rec_upd_12693.mutable_vars, return_type: __rec_upd_12693.return_type, return_used: __rec_upd_12693.return_used, type_env: type_env_12691, vars: new_vars_12687});
  const _t12692 = _t12694;
  const _t12688 = _t12692;
  const _t12677 = _t12688;
  const _t12675 = _t12677;
  return _t12675;
}
function Main$register_native_instance(ctx, global_names, class_name, tys, methods) {
  const dname_12695 = _call(Types$dict_name, [__dict_Show_string, class_name, tys]);
  const idx_12697 = Main$add_global(global_names, dname_12695);
  function _t12699(__p443) {
    let _t12701;
    const _t12700 = __p443;
    _t12702: {
      if (true) {
        const mname = _t12700[0];
        const ext_name = _t12700[1];
        const arity = _t12700[2];
        _t12701 = [mname, ext_name, arity];
        break _t12702;
      }
      _match_fail("line 16629");
    }
    return _t12701;
  }
  const dict_fields_12703 = List$map(_t12699, methods);
  Main$register_native_dict(idx_12697, dict_fields_12703);
  function _t12705(__p444, __p445) {
    let _t12707;
    const _t12706 = __p444;
    _t12708: {
      if (true) {
        const a = _t12706[0];
        let _t12710;
        const _t12709 = __p445;
        _t12711: {
          if (true) {
            const b = _t12709[0];
            _t12710 = String$compare(a, b);
            break _t12711;
          }
          _match_fail("line 16629");
        }
        _t12707 = _t12710;
        break _t12708;
      }
      _match_fail("line 16629");
    }
    return _t12707;
  }
  const sorted_12712 = List$sort(_t12705, methods);
  function _t12714(__p446) {
    let _t12716;
    const _t12715 = __p446;
    _t12717: {
      if (true) {
        const mname = _t12715[0];
        const ext_name = _t12715[1];
        const arity = _t12715[2];
        const midx_12718 = Main$add_global(global_names, ((dname_12695 + "$") + mname));
        const _t12719 = Main$register_native_ext(midx_12718, ext_name, arity);
        _t12716 = _t12719;
        break _t12717;
      }
      _match_fail("line 16629");
    }
    return _t12716;
  }
  List$iter(_t12714, sorted_12712);
  const inst_12720 = ({inst_class: class_name, inst_constraints: null, inst_dict_name: dname_12695, inst_tys: tys});
  const __rec_upd_12722 = ctx.type_env;
  const _t12723 = ({classes: __rec_upd_12722.classes, constructors: __rec_upd_12722.constructors, effects: __rec_upd_12722.effects, hidden_ctor_types: __rec_upd_12722.hidden_ctor_types, hidden_types: __rec_upd_12722.hidden_types, instances: ({_hd: inst_12720, _tl: ctx.type_env.instances}), modules: __rec_upd_12722.modules, mutable_fields: __rec_upd_12722.mutable_fields, newtypes: __rec_upd_12722.newtypes, records: __rec_upd_12722.records, type_aliases: __rec_upd_12722.type_aliases, type_synonyms: __rec_upd_12722.type_synonyms, variants: __rec_upd_12722.variants});
  const type_env_12724 = _t12723;
  const __rec_upd_12726 = ctx;
  const _t12727 = ({constraint_tvars: __rec_upd_12726.constraint_tvars, current_eff: __rec_upd_12726.current_eff, current_module: __rec_upd_12726.current_module, inside_handler: __rec_upd_12726.inside_handler, loop_info: __rec_upd_12726.loop_info, mutable_vars: __rec_upd_12726.mutable_vars, return_type: __rec_upd_12726.return_type, return_used: __rec_upd_12726.return_used, type_env: type_env_12724, vars: __rec_upd_12726.vars});
  const _t12725 = _t12727;
  const _t12721 = _t12725;
  const _t12713 = _t12721;
  const _t12704 = _t12713;
  const _t12698 = _t12704;
  const _t12696 = _t12698;
  return _t12696;
}
let Main$js_capture_mode = false;
let Main$captured_typed_setups = null;
function Main$compile_setup(ctx, global_names, mutable_globals, source) {
  const tokens_12728 = Lexer$tokenize(source);
  const program_12730 = Parser$parse_program(tokens_12728);
  let _t12733;
  const _t12732 = Typechecker$check_program_in_ctx(ctx, program_12730);
  _t12734: {
    if (true) {
      const ctx2 = _t12732[0];
      const typed_program = _t12732[1];
      const typed_program2_12735 = Typechecker$transform_constraints(ctx2, typed_program);
      let _t12737;
      if (Main$js_capture_mode) {
        (Main$captured_typed_setups = List$concat(Main$captured_typed_setups, ({_hd: [ctx2.type_env, typed_program2_12735], _tl: null})), undefined);
        _t12737 = [ctx2, ({arity: 0, code: Array$of_list(null), constants: Array$of_list(null), line_table: Array$of_list(null), name: "", num_locals: 0})];
      } else {
        const compiled_12738 = Compiler$compile_program_with_globals(ctx2.type_env, global_names, mutable_globals, typed_program2_12735);
        const _t12739 = [ctx2, compiled_12738.main];
        _t12737 = _t12739;
      }
      const _t12736 = _t12737;
      _t12733 = _t12736;
      break _t12734;
    }
    _match_fail("line 16629");
  }
  const _t12731 = _t12733;
  const _t12729 = _t12731;
  return _t12729;
}
function Main$arr(a, b) {
  return ({_tag: 7, _name: "TArrow", _val: [a, ({_tag: 1, _name: "EffEmpty"}), b]});
}
function Main$arr2(a, b, c) {
  return Main$arr(a, Main$arr(b, c));
}
function Main$arr3(a, b, c, d) {
  return Main$arr(a, Main$arr(b, Main$arr(c, d)));
}
function Main$setup_builtins(_) {
  const global_names_12740 = Dynarray$create(256, "");
  const mutable_globals_12742 = Hashtbl$create(8);
  let stdlib_pub_vars_12744 = null;
  const int2_12746 = Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}));
  const bool2_12748 = Main$arr2(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}));
  let ctx_12750 = Typechecker$empty_ctx;
  let _t12753;
  const _t12752 = Main$register_builtin(ctx_12750, global_names_12740, "mod", int2_12746, 0, 2);
  _t12754: {
    if (true) {
      const sch = _t12752[0];
      const ctx2 = _t12752[1];
      (ctx_12750 = ctx2, undefined);
      (stdlib_pub_vars_12744 = ({_hd: ["mod", sch], _tl: stdlib_pub_vars_12744}), undefined);
      let _t12756;
      const _t12755 = Main$register_builtin(ctx_12750, global_names_12740, "print", Main$arr(({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 6, _name: "TUnit"})), 1, 1);
      _t12757: {
        if (true) {
          const sch = _t12755[0];
          const ctx2 = _t12755[1];
          (ctx_12750 = ctx2, undefined);
          (stdlib_pub_vars_12744 = ({_hd: ["print", sch], _tl: stdlib_pub_vars_12744}), undefined);
          let _t12759;
          const _t12758 = Main$register_builtin(ctx_12750, global_names_12740, "failwith", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 16, _name: "TGen", _val: 0})), 1, 1);
          _t12760: {
            if (true) {
              const sch = _t12758[0];
              const ctx2 = _t12758[1];
              (ctx_12750 = ctx2, undefined);
              (stdlib_pub_vars_12744 = ({_hd: ["failwith", sch], _tl: stdlib_pub_vars_12744}), undefined);
              let _t12762;
              const _t12761 = Main$register_builtin(ctx_12750, global_names_12740, "^", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
              _t12763: {
                if (true) {
                  const sch = _t12761[0];
                  const ctx2 = _t12761[1];
                  (ctx_12750 = ctx2, undefined);
                  (stdlib_pub_vars_12744 = ({_hd: ["^", sch], _tl: stdlib_pub_vars_12744}), undefined);
                  let _t12765;
                  const _t12764 = Main$register_builtin(ctx_12750, global_names_12740, "&&", bool2_12748, 0, 2);
                  _t12766: {
                    if (true) {
                      const sch = _t12764[0];
                      const ctx2 = _t12764[1];
                      (ctx_12750 = ctx2, undefined);
                      (stdlib_pub_vars_12744 = ({_hd: ["&&", sch], _tl: stdlib_pub_vars_12744}), undefined);
                      let _t12768;
                      const _t12767 = Main$register_builtin(ctx_12750, global_names_12740, "||", bool2_12748, 0, 2);
                      _t12769: {
                        if (true) {
                          const sch = _t12767[0];
                          const ctx2 = _t12767[1];
                          (ctx_12750 = ctx2, undefined);
                          (stdlib_pub_vars_12744 = ({_hd: ["||", sch], _tl: stdlib_pub_vars_12744}), undefined);
                          let _t12771;
                          const _t12770 = Main$register_builtin(ctx_12750, global_names_12740, "not", Main$arr(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"})), 0, 1);
                          _t12772: {
                            if (true) {
                              const sch = _t12770[0];
                              const ctx2 = _t12770[1];
                              (ctx_12750 = ctx2, undefined);
                              (stdlib_pub_vars_12744 = ({_hd: ["not", sch], _tl: stdlib_pub_vars_12744}), undefined);
                              let _t12774;
                              const _t12773 = Main$register_builtin(ctx_12750, global_names_12740, "phys_equal", Main$arr2(({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 2, _name: "TBool"})), 1, 2);
                              _t12775: {
                                if (true) {
                                  const sch = _t12773[0];
                                  const ctx2 = _t12773[1];
                                  (ctx_12750 = ctx2, undefined);
                                  (stdlib_pub_vars_12744 = ({_hd: ["phys_equal", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                  let _t12777;
                                  const _t12776 = Main$register_builtin(ctx_12750, global_names_12740, "float_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 1, _name: "TFloat"})), 0, 1);
                                  _t12778: {
                                    if (true) {
                                      const sch = _t12776[0];
                                      const ctx2 = _t12776[1];
                                      (ctx_12750 = ctx2, undefined);
                                      (stdlib_pub_vars_12744 = ({_hd: ["float_of_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                      let _t12780;
                                      const _t12779 = Main$register_builtin(ctx_12750, global_names_12740, "int_of_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                      _t12781: {
                                        if (true) {
                                          const sch = _t12779[0];
                                          const ctx2 = _t12779[1];
                                          (ctx_12750 = ctx2, undefined);
                                          (stdlib_pub_vars_12744 = ({_hd: ["int_of_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                          let _t12783;
                                          const _t12782 = Main$register_builtin(ctx_12750, global_names_12740, "string_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                          _t12784: {
                                            if (true) {
                                              const sch = _t12782[0];
                                              const ctx2 = _t12782[1];
                                              (ctx_12750 = ctx2, undefined);
                                              (stdlib_pub_vars_12744 = ({_hd: ["string_of_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                              let _t12786;
                                              const _t12785 = Main$register_builtin(ctx_12750, global_names_12740, "string_of_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                              _t12787: {
                                                if (true) {
                                                  const sch = _t12785[0];
                                                  const ctx2 = _t12785[1];
                                                  (ctx_12750 = ctx2, undefined);
                                                  (stdlib_pub_vars_12744 = ({_hd: ["string_of_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                  let _t12789;
                                                  const _t12788 = Main$register_builtin(ctx_12750, global_names_12740, "string_of_bool", Main$arr(({_tag: 2, _name: "TBool"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                  _t12790: {
                                                    if (true) {
                                                      const sch = _t12788[0];
                                                      const ctx2 = _t12788[1];
                                                      (ctx_12750 = ctx2, undefined);
                                                      (stdlib_pub_vars_12744 = ({_hd: ["string_of_bool", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                      let _t12792;
                                                      const _t12791 = Main$register_builtin(ctx_12750, global_names_12740, "array_get", Main$arr2(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 16, _name: "TGen", _val: 0})), 1, 2);
                                                      _t12793: {
                                                        if (true) {
                                                          const sch = _t12791[0];
                                                          const ctx2 = _t12791[1];
                                                          (ctx_12750 = ctx2, undefined);
                                                          (stdlib_pub_vars_12744 = ({_hd: ["array_get", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                          let _t12795;
                                                          const _t12794 = Main$register_builtin(ctx_12750, global_names_12740, "array_length", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"})), 1, 1);
                                                          _t12796: {
                                                            if (true) {
                                                              const sch = _t12794[0];
                                                              const ctx2 = _t12794[1];
                                                              (ctx_12750 = ctx2, undefined);
                                                              (stdlib_pub_vars_12744 = ({_hd: ["array_length", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                              let _t12798;
                                                              const _t12797 = Main$register_builtin(ctx_12750, global_names_12740, "__byte_to_int", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                              _t12799: {
                                                                if (true) {
                                                                  const sch = _t12797[0];
                                                                  const ctx2 = _t12797[1];
                                                                  (ctx_12750 = ctx2, undefined);
                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__byte_to_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                  let _t12801;
                                                                  const _t12800 = Main$register_builtin(ctx_12750, global_names_12740, "__byte_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 4, _name: "TByte"})), 0, 1);
                                                                  _t12802: {
                                                                    if (true) {
                                                                      const sch = _t12800[0];
                                                                      const ctx2 = _t12800[1];
                                                                      (ctx_12750 = ctx2, undefined);
                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__byte_of_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                      let _t12804;
                                                                      const _t12803 = Main$register_builtin(ctx_12750, global_names_12740, "__byte_to_string", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                      _t12805: {
                                                                        if (true) {
                                                                          const sch = _t12803[0];
                                                                          const ctx2 = _t12803[1];
                                                                          (ctx_12750 = ctx2, undefined);
                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__byte_to_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                          let _t12807;
                                                                          const _t12806 = Main$register_builtin(ctx_12750, global_names_12740, "__rune_to_int", Main$arr(({_tag: 5, _name: "TRune"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                          _t12808: {
                                                                            if (true) {
                                                                              const sch = _t12806[0];
                                                                              const ctx2 = _t12806[1];
                                                                              (ctx_12750 = ctx2, undefined);
                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__rune_to_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                              let _t12810;
                                                                              const _t12809 = Main$register_builtin(ctx_12750, global_names_12740, "__rune_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 5, _name: "TRune"})), 0, 1);
                                                                              _t12811: {
                                                                                if (true) {
                                                                                  const sch = _t12809[0];
                                                                                  const ctx2 = _t12809[1];
                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__rune_of_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                  let _t12813;
                                                                                  const _t12812 = Main$register_builtin(ctx_12750, global_names_12740, "__rune_to_string", Main$arr(({_tag: 5, _name: "TRune"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                  _t12814: {
                                                                                    if (true) {
                                                                                      const sch = _t12812[0];
                                                                                      const ctx2 = _t12812[1];
                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__rune_to_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                      let _t12816;
                                                                                      const _t12815 = Main$register_builtin(ctx_12750, global_names_12740, "__math_pow", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                      _t12817: {
                                                                                        if (true) {
                                                                                          const sch = _t12815[0];
                                                                                          const ctx2 = _t12815[1];
                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__math_pow", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                          let _t12819;
                                                                                          const _t12818 = Main$register_builtin(ctx_12750, global_names_12740, "__math_sqrt", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 1);
                                                                                          _t12820: {
                                                                                            if (true) {
                                                                                              const sch = _t12818[0];
                                                                                              const ctx2 = _t12818[1];
                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__math_sqrt", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                              let _t12822;
                                                                                              const _t12821 = Main$register_builtin(ctx_12750, global_names_12740, "__math_floor", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                              _t12823: {
                                                                                                if (true) {
                                                                                                  const sch = _t12821[0];
                                                                                                  const ctx2 = _t12821[1];
                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__math_floor", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                  let _t12825;
                                                                                                  const _t12824 = Main$register_builtin(ctx_12750, global_names_12740, "__math_ceil", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                  _t12826: {
                                                                                                    if (true) {
                                                                                                      const sch = _t12824[0];
                                                                                                      const ctx2 = _t12824[1];
                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__math_ceil", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                      let _t12828;
                                                                                                      const _t12827 = Main$register_builtin(ctx_12750, global_names_12740, "__math_round", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                      _t12829: {
                                                                                                        if (true) {
                                                                                                          const sch = _t12827[0];
                                                                                                          const ctx2 = _t12827[1];
                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__math_round", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                          let _t12831;
                                                                                                          const _t12830 = Main$register_builtin(ctx_12750, global_names_12740, "__fmt_float", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                          _t12832: {
                                                                                                            if (true) {
                                                                                                              const sch = _t12830[0];
                                                                                                              const ctx2 = _t12830[1];
                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__fmt_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                              let _t12834;
                                                                                                              const _t12833 = Main$register_builtin(ctx_12750, global_names_12740, "__fmt_hex", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                              _t12835: {
                                                                                                                if (true) {
                                                                                                                  const sch = _t12833[0];
                                                                                                                  const ctx2 = _t12833[1];
                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__fmt_hex", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                  let _t12837;
                                                                                                                  const _t12836 = Main$register_builtin(ctx_12750, global_names_12740, "__fmt_hex_upper", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                  _t12838: {
                                                                                                                    if (true) {
                                                                                                                      const sch = _t12836[0];
                                                                                                                      const ctx2 = _t12836[1];
                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__fmt_hex_upper", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                      let _t12840;
                                                                                                                      const _t12839 = Main$register_builtin(ctx_12750, global_names_12740, "__fmt_oct", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                      _t12841: {
                                                                                                                        if (true) {
                                                                                                                          const sch = _t12839[0];
                                                                                                                          const ctx2 = _t12839[1];
                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__fmt_oct", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                          let _t12843;
                                                                                                                          const _t12842 = Main$register_builtin(ctx_12750, global_names_12740, "__fmt_bin", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                          _t12844: {
                                                                                                                            if (true) {
                                                                                                                              const sch = _t12842[0];
                                                                                                                              const ctx2 = _t12842[1];
                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__fmt_bin", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                              let _t12846;
                                                                                                                              const _t12845 = Main$register_builtin(ctx_12750, global_names_12740, "__fmt_zero_pad", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                              _t12847: {
                                                                                                                                if (true) {
                                                                                                                                  const sch = _t12845[0];
                                                                                                                                  const ctx2 = _t12845[1];
                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__fmt_zero_pad", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                  let _t12849;
                                                                                                                                  const _t12848 = Main$register_builtin(ctx_12750, global_names_12740, "__fmt_pad_left", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                                  _t12850: {
                                                                                                                                    if (true) {
                                                                                                                                      const sch = _t12848[0];
                                                                                                                                      const ctx2 = _t12848[1];
                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__fmt_pad_left", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                      let _t12852;
                                                                                                                                      const _t12851 = Main$register_builtin(ctx_12750, global_names_12740, "__fmt_pad_right", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                                      _t12853: {
                                                                                                                                        if (true) {
                                                                                                                                          const sch = _t12851[0];
                                                                                                                                          const ctx2 = _t12851[1];
                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__fmt_pad_right", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                          let _t12855;
                                                                                                                                          const _t12854 = Main$register_builtin(ctx_12750, global_names_12740, "__show_value", Main$arr(({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 3, _name: "TString"})), 1, 1);
                                                                                                                                          _t12856: {
                                                                                                                                            if (true) {
                                                                                                                                              const sch = _t12854[0];
                                                                                                                                              const ctx2 = _t12854[1];
                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__show_value", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                              let _t12858;
                                                                                                                                              const _t12857 = Main$register_builtin(ctx_12750, global_names_12740, "__num_add_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                              _t12859: {
                                                                                                                                                if (true) {
                                                                                                                                                  const sch = _t12857[0];
                                                                                                                                                  const ctx2 = _t12857[1];
                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__num_add_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                  let _t12861;
                                                                                                                                                  const _t12860 = Main$register_builtin(ctx_12750, global_names_12740, "__num_sub_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                  _t12862: {
                                                                                                                                                    if (true) {
                                                                                                                                                      const sch = _t12860[0];
                                                                                                                                                      const ctx2 = _t12860[1];
                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__num_sub_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                      let _t12864;
                                                                                                                                                      const _t12863 = Main$register_builtin(ctx_12750, global_names_12740, "__num_mul_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                      _t12865: {
                                                                                                                                                        if (true) {
                                                                                                                                                          const sch = _t12863[0];
                                                                                                                                                          const ctx2 = _t12863[1];
                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__num_mul_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                          let _t12867;
                                                                                                                                                          const _t12866 = Main$register_builtin(ctx_12750, global_names_12740, "__num_div_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                          _t12868: {
                                                                                                                                                            if (true) {
                                                                                                                                                              const sch = _t12866[0];
                                                                                                                                                              const ctx2 = _t12866[1];
                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__num_div_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                              let _t12870;
                                                                                                                                                              const _t12869 = Main$register_builtin(ctx_12750, global_names_12740, "__num_neg_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                                                                              _t12871: {
                                                                                                                                                                if (true) {
                                                                                                                                                                  const sch = _t12869[0];
                                                                                                                                                                  const ctx2 = _t12869[1];
                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__num_neg_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                  let _t12873;
                                                                                                                                                                  const _t12872 = Main$register_builtin(ctx_12750, global_names_12740, "__num_add_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                                                                                                  _t12874: {
                                                                                                                                                                    if (true) {
                                                                                                                                                                      const sch = _t12872[0];
                                                                                                                                                                      const ctx2 = _t12872[1];
                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__num_add_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                      let _t12876;
                                                                                                                                                                      const _t12875 = Main$register_builtin(ctx_12750, global_names_12740, "__num_sub_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                                                                                                      _t12877: {
                                                                                                                                                                        if (true) {
                                                                                                                                                                          const sch = _t12875[0];
                                                                                                                                                                          const ctx2 = _t12875[1];
                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__num_sub_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                          let _t12879;
                                                                                                                                                                          const _t12878 = Main$register_builtin(ctx_12750, global_names_12740, "__num_mul_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                                                                                                          _t12880: {
                                                                                                                                                                            if (true) {
                                                                                                                                                                              const sch = _t12878[0];
                                                                                                                                                                              const ctx2 = _t12878[1];
                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__num_mul_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                              let _t12882;
                                                                                                                                                                              const _t12881 = Main$register_builtin(ctx_12750, global_names_12740, "__num_div_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                                                                                                              _t12883: {
                                                                                                                                                                                if (true) {
                                                                                                                                                                                  const sch = _t12881[0];
                                                                                                                                                                                  const ctx2 = _t12881[1];
                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__num_div_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                  let _t12885;
                                                                                                                                                                                  const _t12884 = Main$register_builtin(ctx_12750, global_names_12740, "__num_neg_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 1);
                                                                                                                                                                                  _t12886: {
                                                                                                                                                                                    if (true) {
                                                                                                                                                                                      const sch = _t12884[0];
                                                                                                                                                                                      const ctx2 = _t12884[1];
                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__num_neg_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                      let _t12888;
                                                                                                                                                                                      const _t12887 = Main$register_builtin(ctx_12750, global_names_12740, "__eq_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                      _t12889: {
                                                                                                                                                                                        if (true) {
                                                                                                                                                                                          const sch = _t12887[0];
                                                                                                                                                                                          const ctx2 = _t12887[1];
                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__eq_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                          let _t12891;
                                                                                                                                                                                          const _t12890 = Main$register_builtin(ctx_12750, global_names_12740, "__neq_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                          _t12892: {
                                                                                                                                                                                            if (true) {
                                                                                                                                                                                              const sch = _t12890[0];
                                                                                                                                                                                              const ctx2 = _t12890[1];
                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__neq_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                              let _t12894;
                                                                                                                                                                                              const _t12893 = Main$register_builtin(ctx_12750, global_names_12740, "__eq_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                              _t12895: {
                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                  const sch = _t12893[0];
                                                                                                                                                                                                  const ctx2 = _t12893[1];
                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__eq_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                  let _t12897;
                                                                                                                                                                                                  const _t12896 = Main$register_builtin(ctx_12750, global_names_12740, "__neq_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                  _t12898: {
                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                      const sch = _t12896[0];
                                                                                                                                                                                                      const ctx2 = _t12896[1];
                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__neq_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                      let _t12900;
                                                                                                                                                                                                      const _t12899 = Main$register_builtin(ctx_12750, global_names_12740, "__eq_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                      _t12901: {
                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                          const sch = _t12899[0];
                                                                                                                                                                                                          const ctx2 = _t12899[1];
                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__eq_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                          let _t12903;
                                                                                                                                                                                                          const _t12902 = Main$register_builtin(ctx_12750, global_names_12740, "__neq_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                          _t12904: {
                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                              const sch = _t12902[0];
                                                                                                                                                                                                              const ctx2 = _t12902[1];
                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__neq_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                              let _t12906;
                                                                                                                                                                                                              const _t12905 = Main$register_builtin(ctx_12750, global_names_12740, "__eq_bool", Main$arr2(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                              _t12907: {
                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                  const sch = _t12905[0];
                                                                                                                                                                                                                  const ctx2 = _t12905[1];
                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__eq_bool", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                  let _t12909;
                                                                                                                                                                                                                  const _t12908 = Main$register_builtin(ctx_12750, global_names_12740, "__neq_bool", Main$arr2(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                  _t12910: {
                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                      const sch = _t12908[0];
                                                                                                                                                                                                                      const ctx2 = _t12908[1];
                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__neq_bool", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                      let _t12912;
                                                                                                                                                                                                                      const _t12911 = Main$register_builtin(ctx_12750, global_names_12740, "__eq_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                      _t12913: {
                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                          const sch = _t12911[0];
                                                                                                                                                                                                                          const ctx2 = _t12911[1];
                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__eq_byte", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                          let _t12915;
                                                                                                                                                                                                                          const _t12914 = Main$register_builtin(ctx_12750, global_names_12740, "__neq_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                          _t12916: {
                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                              const sch = _t12914[0];
                                                                                                                                                                                                                              const ctx2 = _t12914[1];
                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__neq_byte", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                              let _t12918;
                                                                                                                                                                                                                              const _t12917 = Main$register_builtin(ctx_12750, global_names_12740, "__eq_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                              _t12919: {
                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                  const sch = _t12917[0];
                                                                                                                                                                                                                                  const ctx2 = _t12917[1];
                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__eq_rune", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                  let _t12921;
                                                                                                                                                                                                                                  const _t12920 = Main$register_builtin(ctx_12750, global_names_12740, "__neq_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                  _t12922: {
                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                      const sch = _t12920[0];
                                                                                                                                                                                                                                      const ctx2 = _t12920[1];
                                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__neq_rune", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                      let _t12924;
                                                                                                                                                                                                                                      const _t12923 = Main$register_builtin(ctx_12750, global_names_12740, "__lt_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                      _t12925: {
                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                          const sch = _t12923[0];
                                                                                                                                                                                                                                          const ctx2 = _t12923[1];
                                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__lt_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                          let _t12927;
                                                                                                                                                                                                                                          const _t12926 = Main$register_builtin(ctx_12750, global_names_12740, "__gt_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                          _t12928: {
                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                              const sch = _t12926[0];
                                                                                                                                                                                                                                              const ctx2 = _t12926[1];
                                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__gt_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                              let _t12930;
                                                                                                                                                                                                                                              const _t12929 = Main$register_builtin(ctx_12750, global_names_12740, "__le_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                              _t12931: {
                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                  const sch = _t12929[0];
                                                                                                                                                                                                                                                  const ctx2 = _t12929[1];
                                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__le_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                  let _t12933;
                                                                                                                                                                                                                                                  const _t12932 = Main$register_builtin(ctx_12750, global_names_12740, "__ge_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                  _t12934: {
                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                      const sch = _t12932[0];
                                                                                                                                                                                                                                                      const ctx2 = _t12932[1];
                                                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__ge_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                      let _t12936;
                                                                                                                                                                                                                                                      const _t12935 = Main$register_builtin(ctx_12750, global_names_12740, "__lt_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                      _t12937: {
                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                          const sch = _t12935[0];
                                                                                                                                                                                                                                                          const ctx2 = _t12935[1];
                                                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__lt_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                          let _t12939;
                                                                                                                                                                                                                                                          const _t12938 = Main$register_builtin(ctx_12750, global_names_12740, "__gt_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                          _t12940: {
                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                              const sch = _t12938[0];
                                                                                                                                                                                                                                                              const ctx2 = _t12938[1];
                                                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__gt_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                              let _t12942;
                                                                                                                                                                                                                                                              const _t12941 = Main$register_builtin(ctx_12750, global_names_12740, "__le_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                              _t12943: {
                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                  const sch = _t12941[0];
                                                                                                                                                                                                                                                                  const ctx2 = _t12941[1];
                                                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__le_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                  let _t12945;
                                                                                                                                                                                                                                                                  const _t12944 = Main$register_builtin(ctx_12750, global_names_12740, "__ge_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                  _t12946: {
                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                      const sch = _t12944[0];
                                                                                                                                                                                                                                                                      const ctx2 = _t12944[1];
                                                                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__ge_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                      let _t12948;
                                                                                                                                                                                                                                                                      const _t12947 = Main$register_builtin(ctx_12750, global_names_12740, "__lt_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                      _t12949: {
                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                          const sch = _t12947[0];
                                                                                                                                                                                                                                                                          const ctx2 = _t12947[1];
                                                                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__lt_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                          let _t12951;
                                                                                                                                                                                                                                                                          const _t12950 = Main$register_builtin(ctx_12750, global_names_12740, "__gt_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                          _t12952: {
                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                              const sch = _t12950[0];
                                                                                                                                                                                                                                                                              const ctx2 = _t12950[1];
                                                                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__gt_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                              let _t12954;
                                                                                                                                                                                                                                                                              const _t12953 = Main$register_builtin(ctx_12750, global_names_12740, "__le_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                              _t12955: {
                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                  const sch = _t12953[0];
                                                                                                                                                                                                                                                                                  const ctx2 = _t12953[1];
                                                                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__le_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                  let _t12957;
                                                                                                                                                                                                                                                                                  const _t12956 = Main$register_builtin(ctx_12750, global_names_12740, "__ge_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                  _t12958: {
                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                      const sch = _t12956[0];
                                                                                                                                                                                                                                                                                      const ctx2 = _t12956[1];
                                                                                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__ge_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                      let _t12960;
                                                                                                                                                                                                                                                                                      const _t12959 = Main$register_builtin(ctx_12750, global_names_12740, "__lt_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                      _t12961: {
                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                          const sch = _t12959[0];
                                                                                                                                                                                                                                                                                          const ctx2 = _t12959[1];
                                                                                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__lt_byte", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                          let _t12963;
                                                                                                                                                                                                                                                                                          const _t12962 = Main$register_builtin(ctx_12750, global_names_12740, "__gt_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                          _t12964: {
                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                              const sch = _t12962[0];
                                                                                                                                                                                                                                                                                              const ctx2 = _t12962[1];
                                                                                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__gt_byte", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                              let _t12966;
                                                                                                                                                                                                                                                                                              const _t12965 = Main$register_builtin(ctx_12750, global_names_12740, "__le_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                              _t12967: {
                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                  const sch = _t12965[0];
                                                                                                                                                                                                                                                                                                  const ctx2 = _t12965[1];
                                                                                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__le_byte", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                  let _t12969;
                                                                                                                                                                                                                                                                                                  const _t12968 = Main$register_builtin(ctx_12750, global_names_12740, "__ge_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                  _t12970: {
                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                      const sch = _t12968[0];
                                                                                                                                                                                                                                                                                                      const ctx2 = _t12968[1];
                                                                                                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__ge_byte", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                      let _t12972;
                                                                                                                                                                                                                                                                                                      const _t12971 = Main$register_builtin(ctx_12750, global_names_12740, "__lt_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                      _t12973: {
                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                          const sch = _t12971[0];
                                                                                                                                                                                                                                                                                                          const ctx2 = _t12971[1];
                                                                                                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__lt_rune", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                          let _t12975;
                                                                                                                                                                                                                                                                                                          const _t12974 = Main$register_builtin(ctx_12750, global_names_12740, "__gt_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                          _t12976: {
                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                              const sch = _t12974[0];
                                                                                                                                                                                                                                                                                                              const ctx2 = _t12974[1];
                                                                                                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__gt_rune", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                              let _t12978;
                                                                                                                                                                                                                                                                                                              const _t12977 = Main$register_builtin(ctx_12750, global_names_12740, "__le_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                              _t12979: {
                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                  const sch = _t12977[0];
                                                                                                                                                                                                                                                                                                                  const ctx2 = _t12977[1];
                                                                                                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__le_rune", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                  let _t12981;
                                                                                                                                                                                                                                                                                                                  const _t12980 = Main$register_builtin(ctx_12750, global_names_12740, "__ge_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                                  _t12982: {
                                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                                      const sch = _t12980[0];
                                                                                                                                                                                                                                                                                                                      const ctx2 = _t12980[1];
                                                                                                                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__ge_rune", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                      let _t12984;
                                                                                                                                                                                                                                                                                                                      const _t12983 = Main$register_builtin(ctx_12750, global_names_12740, "__band_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                      _t12985: {
                                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                                          const sch = _t12983[0];
                                                                                                                                                                                                                                                                                                                          const ctx2 = _t12983[1];
                                                                                                                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__band_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                          let _t12987;
                                                                                                                                                                                                                                                                                                                          const _t12986 = Main$register_builtin(ctx_12750, global_names_12740, "__bor_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                          _t12988: {
                                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                                              const sch = _t12986[0];
                                                                                                                                                                                                                                                                                                                              const ctx2 = _t12986[1];
                                                                                                                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__bor_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                              let _t12990;
                                                                                                                                                                                                                                                                                                                              const _t12989 = Main$register_builtin(ctx_12750, global_names_12740, "__bxor_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                              _t12991: {
                                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                                  const sch = _t12989[0];
                                                                                                                                                                                                                                                                                                                                  const ctx2 = _t12989[1];
                                                                                                                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__bxor_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                  let _t12993;
                                                                                                                                                                                                                                                                                                                                  const _t12992 = Main$register_builtin(ctx_12750, global_names_12740, "__bshl_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                                  _t12994: {
                                                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                                                      const sch = _t12992[0];
                                                                                                                                                                                                                                                                                                                                      const ctx2 = _t12992[1];
                                                                                                                                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__bshl_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                      let _t12996;
                                                                                                                                                                                                                                                                                                                                      const _t12995 = Main$register_builtin(ctx_12750, global_names_12740, "__bshr_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                                      _t12997: {
                                                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                                                          const sch = _t12995[0];
                                                                                                                                                                                                                                                                                                                                          const ctx2 = _t12995[1];
                                                                                                                                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__bshr_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                          let _t12999;
                                                                                                                                                                                                                                                                                                                                          const _t12998 = Main$register_builtin(ctx_12750, global_names_12740, "__bnot_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                          _t13000: {
                                                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                                                              const sch = _t12998[0];
                                                                                                                                                                                                                                                                                                                                              const ctx2 = _t12998[1];
                                                                                                                                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__bnot_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                              let _t13002;
                                                                                                                                                                                                                                                                                                                                              const _t13001 = Main$register_builtin(ctx_12750, global_names_12740, "__show_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                              _t13003: {
                                                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                                                  const sch = _t13001[0];
                                                                                                                                                                                                                                                                                                                                                  const ctx2 = _t13001[1];
                                                                                                                                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__show_int", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                  let _t13005;
                                                                                                                                                                                                                                                                                                                                                  const _t13004 = Main$register_builtin(ctx_12750, global_names_12740, "__show_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                  _t13006: {
                                                                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                                                                      const sch = _t13004[0];
                                                                                                                                                                                                                                                                                                                                                      const ctx2 = _t13004[1];
                                                                                                                                                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__show_float", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                      let _t13008;
                                                                                                                                                                                                                                                                                                                                                      const _t13007 = Main$register_builtin(ctx_12750, global_names_12740, "__show_bool", Main$arr(({_tag: 2, _name: "TBool"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                      _t13009: {
                                                                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                                                                          const sch = _t13007[0];
                                                                                                                                                                                                                                                                                                                                                          const ctx2 = _t13007[1];
                                                                                                                                                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__show_bool", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                          let _t13011;
                                                                                                                                                                                                                                                                                                                                                          const _t13010 = Main$register_builtin(ctx_12750, global_names_12740, "__show_string", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                          _t13012: {
                                                                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                                                                              const sch = _t13010[0];
                                                                                                                                                                                                                                                                                                                                                              const ctx2 = _t13010[1];
                                                                                                                                                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__show_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                              let _t13014;
                                                                                                                                                                                                                                                                                                                                                              const _t13013 = Main$register_builtin(ctx_12750, global_names_12740, "__show_unit", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                              _t13015: {
                                                                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                                                                  const sch = _t13013[0];
                                                                                                                                                                                                                                                                                                                                                                  const ctx2 = _t13013[1];
                                                                                                                                                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__show_unit", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                                  let _t13017;
                                                                                                                                                                                                                                                                                                                                                                  const _t13016 = Main$register_builtin(ctx_12750, global_names_12740, "__show_byte", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                                  _t13018: {
                                                                                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                                                                                      const sch = _t13016[0];
                                                                                                                                                                                                                                                                                                                                                                      const ctx2 = _t13016[1];
                                                                                                                                                                                                                                                                                                                                                                      (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12744 = ({_hd: ["__show_byte", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                                      let _t13020;
                                                                                                                                                                                                                                                                                                                                                                      const _t13019 = Main$register_builtin(ctx_12750, global_names_12740, "__show_rune", Main$arr(({_tag: 5, _name: "TRune"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                                      _t13021: {
                                                                                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                                                                                          const sch = _t13019[0];
                                                                                                                                                                                                                                                                                                                                                                          const ctx2 = _t13019[1];
                                                                                                                                                                                                                                                                                                                                                                          (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12744 = ({_hd: ["__show_rune", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                                          let _t13023;
                                                                                                                                                                                                                                                                                                                                                                          const _t13022 = Main$register_builtin(ctx_12750, global_names_12740, "__index_at_array", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 16, _name: "TGen", _val: 0})), 1, 2);
                                                                                                                                                                                                                                                                                                                                                                          _t13024: {
                                                                                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                                                                                              const sch = _t13022[0];
                                                                                                                                                                                                                                                                                                                                                                              const ctx2 = _t13022[1];
                                                                                                                                                                                                                                                                                                                                                                              (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12744 = ({_hd: ["__index_at_array", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                                              let _t13026;
                                                                                                                                                                                                                                                                                                                                                                              const _t13025 = Main$register_builtin(ctx_12750, global_names_12740, "__index_at_string", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 4, _name: "TByte"})), 0, 2);
                                                                                                                                                                                                                                                                                                                                                                              _t13027: {
                                                                                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                                                                                  const sch = _t13025[0];
                                                                                                                                                                                                                                                                                                                                                                                  const ctx2 = _t13025[1];
                                                                                                                                                                                                                                                                                                                                                                                  (ctx_12750 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["__index_at_string", sch], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                                                  const copy_ty_13028 = Main$arr(({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 16, _name: "TGen", _val: 0}));
                                                                                                                                                                                                                                                                                                                                                                                  const copy_scheme_13030 = ({body: copy_ty_13028, constraints: null, equant: 0, pvquant: 0, quant: 1, record_evidences: null, rquant: 0});
                                                                                                                                                                                                                                                                                                                                                                                  const cidx_13032 = Main$add_global(global_names_12740, "copy_continuation");
                                                                                                                                                                                                                                                                                                                                                                                  Main$register_native_ext(cidx_13032, "copy_continuation", 1);
                                                                                                                                                                                                                                                                                                                                                                                  const csidx_13034 = Main$add_global(global_names_12740, "Stdlib.copy_continuation");
                                                                                                                                                                                                                                                                                                                                                                                  Main$register_native_ext(csidx_13034, "copy_continuation", 1);
                                                                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12744 = ({_hd: ["copy_continuation", copy_scheme_13030], _tl: stdlib_pub_vars_12744}), undefined);
                                                                                                                                                                                                                                                                                                                                                                                  const __rec_upd_13036 = ctx_12750;
                                                                                                                                                                                                                                                                                                                                                                                  const _t13037 = ({constraint_tvars: __rec_upd_13036.constraint_tvars, current_eff: __rec_upd_13036.current_eff, current_module: __rec_upd_13036.current_module, inside_handler: __rec_upd_13036.inside_handler, loop_info: __rec_upd_13036.loop_info, mutable_vars: __rec_upd_13036.mutable_vars, return_type: __rec_upd_13036.return_type, return_used: __rec_upd_13036.return_used, type_env: __rec_upd_13036.type_env, vars: ({_hd: ["Stdlib.copy_continuation", copy_scheme_13030], _tl: ({_hd: ["copy_continuation", copy_scheme_13030], _tl: ctx_12750.vars})})});
                                                                                                                                                                                                                                                                                                                                                                                  (ctx_12750 = _t13037, undefined);
                                                                                                                                                                                                                                                                                                                                                                                  const _t13035 = [ctx_12750, global_names_12740, mutable_globals_12742, stdlib_pub_vars_12744];
                                                                                                                                                                                                                                                                                                                                                                                  const _t13033 = _t13035;
                                                                                                                                                                                                                                                                                                                                                                                  const _t13031 = _t13033;
                                                                                                                                                                                                                                                                                                                                                                                  const _t13029 = _t13031;
                                                                                                                                                                                                                                                                                                                                                                                  _t13026 = _t13029;
                                                                                                                                                                                                                                                                                                                                                                                  break _t13027;
                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                              _t13023 = _t13026;
                                                                                                                                                                                                                                                                                                                                                                              break _t13024;
                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                          _t13020 = _t13023;
                                                                                                                                                                                                                                                                                                                                                                          break _t13021;
                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                      _t13017 = _t13020;
                                                                                                                                                                                                                                                                                                                                                                      break _t13018;
                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                  _t13014 = _t13017;
                                                                                                                                                                                                                                                                                                                                                                  break _t13015;
                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                              _t13011 = _t13014;
                                                                                                                                                                                                                                                                                                                                                              break _t13012;
                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                          _t13008 = _t13011;
                                                                                                                                                                                                                                                                                                                                                          break _t13009;
                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                      _t13005 = _t13008;
                                                                                                                                                                                                                                                                                                                                                      break _t13006;
                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                  _t13002 = _t13005;
                                                                                                                                                                                                                                                                                                                                                  break _t13003;
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                              _t12999 = _t13002;
                                                                                                                                                                                                                                                                                                                                              break _t13000;
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                          _t12996 = _t12999;
                                                                                                                                                                                                                                                                                                                                          break _t12997;
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                      _t12993 = _t12996;
                                                                                                                                                                                                                                                                                                                                      break _t12994;
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                  _t12990 = _t12993;
                                                                                                                                                                                                                                                                                                                                  break _t12991;
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                              _t12987 = _t12990;
                                                                                                                                                                                                                                                                                                                              break _t12988;
                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                          _t12984 = _t12987;
                                                                                                                                                                                                                                                                                                                          break _t12985;
                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                      _t12981 = _t12984;
                                                                                                                                                                                                                                                                                                                      break _t12982;
                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                  _t12978 = _t12981;
                                                                                                                                                                                                                                                                                                                  break _t12979;
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                              _t12975 = _t12978;
                                                                                                                                                                                                                                                                                                              break _t12976;
                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                          _t12972 = _t12975;
                                                                                                                                                                                                                                                                                                          break _t12973;
                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                      _t12969 = _t12972;
                                                                                                                                                                                                                                                                                                      break _t12970;
                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                  _t12966 = _t12969;
                                                                                                                                                                                                                                                                                                  break _t12967;
                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                              _t12963 = _t12966;
                                                                                                                                                                                                                                                                                              break _t12964;
                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                          _t12960 = _t12963;
                                                                                                                                                                                                                                                                                          break _t12961;
                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                      _t12957 = _t12960;
                                                                                                                                                                                                                                                                                      break _t12958;
                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                  _t12954 = _t12957;
                                                                                                                                                                                                                                                                                  break _t12955;
                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                              _t12951 = _t12954;
                                                                                                                                                                                                                                                                              break _t12952;
                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                          _t12948 = _t12951;
                                                                                                                                                                                                                                                                          break _t12949;
                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                      _t12945 = _t12948;
                                                                                                                                                                                                                                                                      break _t12946;
                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                  _t12942 = _t12945;
                                                                                                                                                                                                                                                                  break _t12943;
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                              _t12939 = _t12942;
                                                                                                                                                                                                                                                              break _t12940;
                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                          _t12936 = _t12939;
                                                                                                                                                                                                                                                          break _t12937;
                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                      _t12933 = _t12936;
                                                                                                                                                                                                                                                      break _t12934;
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                  _t12930 = _t12933;
                                                                                                                                                                                                                                                  break _t12931;
                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                              _t12927 = _t12930;
                                                                                                                                                                                                                                              break _t12928;
                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                          _t12924 = _t12927;
                                                                                                                                                                                                                                          break _t12925;
                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                      _t12921 = _t12924;
                                                                                                                                                                                                                                      break _t12922;
                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                  _t12918 = _t12921;
                                                                                                                                                                                                                                  break _t12919;
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                                              }
                                                                                                                                                                                                                              _t12915 = _t12918;
                                                                                                                                                                                                                              break _t12916;
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                                          }
                                                                                                                                                                                                                          _t12912 = _t12915;
                                                                                                                                                                                                                          break _t12913;
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                                      }
                                                                                                                                                                                                                      _t12909 = _t12912;
                                                                                                                                                                                                                      break _t12910;
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                                  }
                                                                                                                                                                                                                  _t12906 = _t12909;
                                                                                                                                                                                                                  break _t12907;
                                                                                                                                                                                                                }
                                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                                              }
                                                                                                                                                                                                              _t12903 = _t12906;
                                                                                                                                                                                                              break _t12904;
                                                                                                                                                                                                            }
                                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                                          }
                                                                                                                                                                                                          _t12900 = _t12903;
                                                                                                                                                                                                          break _t12901;
                                                                                                                                                                                                        }
                                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                                      }
                                                                                                                                                                                                      _t12897 = _t12900;
                                                                                                                                                                                                      break _t12898;
                                                                                                                                                                                                    }
                                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                                  }
                                                                                                                                                                                                  _t12894 = _t12897;
                                                                                                                                                                                                  break _t12895;
                                                                                                                                                                                                }
                                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                                              }
                                                                                                                                                                                              _t12891 = _t12894;
                                                                                                                                                                                              break _t12892;
                                                                                                                                                                                            }
                                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                                          }
                                                                                                                                                                                          _t12888 = _t12891;
                                                                                                                                                                                          break _t12889;
                                                                                                                                                                                        }
                                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                                      }
                                                                                                                                                                                      _t12885 = _t12888;
                                                                                                                                                                                      break _t12886;
                                                                                                                                                                                    }
                                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                                  }
                                                                                                                                                                                  _t12882 = _t12885;
                                                                                                                                                                                  break _t12883;
                                                                                                                                                                                }
                                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                                              }
                                                                                                                                                                              _t12879 = _t12882;
                                                                                                                                                                              break _t12880;
                                                                                                                                                                            }
                                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                                          }
                                                                                                                                                                          _t12876 = _t12879;
                                                                                                                                                                          break _t12877;
                                                                                                                                                                        }
                                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                                      }
                                                                                                                                                                      _t12873 = _t12876;
                                                                                                                                                                      break _t12874;
                                                                                                                                                                    }
                                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                                  }
                                                                                                                                                                  _t12870 = _t12873;
                                                                                                                                                                  break _t12871;
                                                                                                                                                                }
                                                                                                                                                                _match_fail("line 16629");
                                                                                                                                                              }
                                                                                                                                                              _t12867 = _t12870;
                                                                                                                                                              break _t12868;
                                                                                                                                                            }
                                                                                                                                                            _match_fail("line 16629");
                                                                                                                                                          }
                                                                                                                                                          _t12864 = _t12867;
                                                                                                                                                          break _t12865;
                                                                                                                                                        }
                                                                                                                                                        _match_fail("line 16629");
                                                                                                                                                      }
                                                                                                                                                      _t12861 = _t12864;
                                                                                                                                                      break _t12862;
                                                                                                                                                    }
                                                                                                                                                    _match_fail("line 16629");
                                                                                                                                                  }
                                                                                                                                                  _t12858 = _t12861;
                                                                                                                                                  break _t12859;
                                                                                                                                                }
                                                                                                                                                _match_fail("line 16629");
                                                                                                                                              }
                                                                                                                                              _t12855 = _t12858;
                                                                                                                                              break _t12856;
                                                                                                                                            }
                                                                                                                                            _match_fail("line 16629");
                                                                                                                                          }
                                                                                                                                          _t12852 = _t12855;
                                                                                                                                          break _t12853;
                                                                                                                                        }
                                                                                                                                        _match_fail("line 16629");
                                                                                                                                      }
                                                                                                                                      _t12849 = _t12852;
                                                                                                                                      break _t12850;
                                                                                                                                    }
                                                                                                                                    _match_fail("line 16629");
                                                                                                                                  }
                                                                                                                                  _t12846 = _t12849;
                                                                                                                                  break _t12847;
                                                                                                                                }
                                                                                                                                _match_fail("line 16629");
                                                                                                                              }
                                                                                                                              _t12843 = _t12846;
                                                                                                                              break _t12844;
                                                                                                                            }
                                                                                                                            _match_fail("line 16629");
                                                                                                                          }
                                                                                                                          _t12840 = _t12843;
                                                                                                                          break _t12841;
                                                                                                                        }
                                                                                                                        _match_fail("line 16629");
                                                                                                                      }
                                                                                                                      _t12837 = _t12840;
                                                                                                                      break _t12838;
                                                                                                                    }
                                                                                                                    _match_fail("line 16629");
                                                                                                                  }
                                                                                                                  _t12834 = _t12837;
                                                                                                                  break _t12835;
                                                                                                                }
                                                                                                                _match_fail("line 16629");
                                                                                                              }
                                                                                                              _t12831 = _t12834;
                                                                                                              break _t12832;
                                                                                                            }
                                                                                                            _match_fail("line 16629");
                                                                                                          }
                                                                                                          _t12828 = _t12831;
                                                                                                          break _t12829;
                                                                                                        }
                                                                                                        _match_fail("line 16629");
                                                                                                      }
                                                                                                      _t12825 = _t12828;
                                                                                                      break _t12826;
                                                                                                    }
                                                                                                    _match_fail("line 16629");
                                                                                                  }
                                                                                                  _t12822 = _t12825;
                                                                                                  break _t12823;
                                                                                                }
                                                                                                _match_fail("line 16629");
                                                                                              }
                                                                                              _t12819 = _t12822;
                                                                                              break _t12820;
                                                                                            }
                                                                                            _match_fail("line 16629");
                                                                                          }
                                                                                          _t12816 = _t12819;
                                                                                          break _t12817;
                                                                                        }
                                                                                        _match_fail("line 16629");
                                                                                      }
                                                                                      _t12813 = _t12816;
                                                                                      break _t12814;
                                                                                    }
                                                                                    _match_fail("line 16629");
                                                                                  }
                                                                                  _t12810 = _t12813;
                                                                                  break _t12811;
                                                                                }
                                                                                _match_fail("line 16629");
                                                                              }
                                                                              _t12807 = _t12810;
                                                                              break _t12808;
                                                                            }
                                                                            _match_fail("line 16629");
                                                                          }
                                                                          _t12804 = _t12807;
                                                                          break _t12805;
                                                                        }
                                                                        _match_fail("line 16629");
                                                                      }
                                                                      _t12801 = _t12804;
                                                                      break _t12802;
                                                                    }
                                                                    _match_fail("line 16629");
                                                                  }
                                                                  _t12798 = _t12801;
                                                                  break _t12799;
                                                                }
                                                                _match_fail("line 16629");
                                                              }
                                                              _t12795 = _t12798;
                                                              break _t12796;
                                                            }
                                                            _match_fail("line 16629");
                                                          }
                                                          _t12792 = _t12795;
                                                          break _t12793;
                                                        }
                                                        _match_fail("line 16629");
                                                      }
                                                      _t12789 = _t12792;
                                                      break _t12790;
                                                    }
                                                    _match_fail("line 16629");
                                                  }
                                                  _t12786 = _t12789;
                                                  break _t12787;
                                                }
                                                _match_fail("line 16629");
                                              }
                                              _t12783 = _t12786;
                                              break _t12784;
                                            }
                                            _match_fail("line 16629");
                                          }
                                          _t12780 = _t12783;
                                          break _t12781;
                                        }
                                        _match_fail("line 16629");
                                      }
                                      _t12777 = _t12780;
                                      break _t12778;
                                    }
                                    _match_fail("line 16629");
                                  }
                                  _t12774 = _t12777;
                                  break _t12775;
                                }
                                _match_fail("line 16629");
                              }
                              _t12771 = _t12774;
                              break _t12772;
                            }
                            _match_fail("line 16629");
                          }
                          _t12768 = _t12771;
                          break _t12769;
                        }
                        _match_fail("line 16629");
                      }
                      _t12765 = _t12768;
                      break _t12766;
                    }
                    _match_fail("line 16629");
                  }
                  _t12762 = _t12765;
                  break _t12763;
                }
                _match_fail("line 16629");
              }
              _t12759 = _t12762;
              break _t12760;
            }
            _match_fail("line 16629");
          }
          _t12756 = _t12759;
          break _t12757;
        }
        _match_fail("line 16629");
      }
      _t12753 = _t12756;
      break _t12754;
    }
    _match_fail("line 16629");
  }
  const _t12751 = _t12753;
  const _t12749 = _t12751;
  const _t12747 = _t12749;
  const _t12745 = _t12747;
  const _t12743 = _t12745;
  const _t12741 = _t12743;
  return _t12741;
}
function Main$setup_classes(ctx, global_names, mutable_globals, stdlib_pub_vars) {
  let ctx_13038 = ctx;
  let setup_protos_13040 = null;
  function _t13042(name) {
    let _t13044;
    const _t13043 = Main$compile_setup(ctx_13038, global_names, mutable_globals, IO$read_file((("stdlib/" + name) + ".mml")));
    _t13045: {
      if (true) {
        const ctx2 = _t13043[0];
        const proto = _t13043[1];
        (ctx_13038 = ctx2, undefined);
        _t13044 = (setup_protos_13040 = ({_hd: proto, _tl: setup_protos_13040}), undefined);
        break _t13045;
      }
      _match_fail("line 16629");
    }
    return _t13044;
  }
  const load_13046 = _t13042;
  load_13046("classes");
  load_13046("option_type");
  load_13046("iter");
  load_13046("map_class");
  load_13046("show");
  function _t13048(__p447) {
    let _t13050;
    const _t13049 = __p447;
    _t13051: {
      if (true) {
        const name = _t13049[0];
        _t13050 = ((name === "None") || (name === "Some"));
        break _t13051;
      }
      _match_fail("line 16629");
    }
    return _t13050;
  }
  const stdlib_constructors_13052 = List$filter(_t13048, ctx_13038.type_env.constructors);
  const stdlib_info_13054 = ({mod_instances: null, mod_name: "Stdlib", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: stdlib_constructors_13052, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: stdlib_pub_vars, mod_submodules: null});
  const __rec_upd_13056 = ctx_13038;
  const __rec_upd_13058 = ctx_13038.type_env;
  const _t13059 = ({classes: __rec_upd_13058.classes, constructors: __rec_upd_13058.constructors, effects: __rec_upd_13058.effects, hidden_ctor_types: __rec_upd_13058.hidden_ctor_types, hidden_types: __rec_upd_13058.hidden_types, instances: __rec_upd_13058.instances, modules: ({_hd: ["Stdlib", stdlib_info_13054], _tl: ctx_13038.type_env.modules}), mutable_fields: __rec_upd_13058.mutable_fields, newtypes: __rec_upd_13058.newtypes, records: __rec_upd_13058.records, type_aliases: __rec_upd_13058.type_aliases, type_synonyms: __rec_upd_13058.type_synonyms, variants: __rec_upd_13058.variants});
  const _t13057 = ({constraint_tvars: __rec_upd_13056.constraint_tvars, current_eff: __rec_upd_13056.current_eff, current_module: __rec_upd_13056.current_module, inside_handler: __rec_upd_13056.inside_handler, loop_info: __rec_upd_13056.loop_info, mutable_vars: __rec_upd_13056.mutable_vars, return_type: __rec_upd_13056.return_type, return_used: __rec_upd_13056.return_used, type_env: _t13059, vars: __rec_upd_13056.vars});
  (ctx_13038 = _t13057, undefined);
  const _t13055 = [ctx_13038, List$rev(setup_protos_13040)];
  const _t13053 = _t13055;
  const _t13047 = _t13053;
  const _t13041 = _t13047;
  const _t13039 = _t13041;
  return _t13039;
}
function Main$setup_modules(ctx, global_names, mutable_globals) {
  let pub_vars_13060 = null;
  let ctx_13062 = ctx;
  let setup_protos_13064 = null;
  function _t13066(__dict_Show_0, mod_name, fn_name, ty, arity) {
    let _t13068;
    const _t13067 = Main$register_module_fn(ctx_13062, global_names, mod_name, fn_name, ty, arity);
    _t13069: {
      if (true) {
        const pv = _t13067[0];
        const ctx2 = _t13067[1];
        (pub_vars_13060 = ({_hd: pv, _tl: pub_vars_13060}), undefined);
        _t13068 = (ctx_13062 = ctx2, undefined);
        break _t13069;
      }
      _match_fail("line 16629");
    }
    return _t13068;
  }
  const register_fn_13070 = _t13066;
  function _t13072(name) {
    let _t13074;
    const _t13073 = Main$compile_setup(ctx_13062, global_names, mutable_globals, IO$read_file((("stdlib/" + name) + ".mml")));
    _t13075: {
      if (true) {
        const ctx2 = _t13073[0];
        const proto = _t13073[1];
        (ctx_13062 = ctx2, undefined);
        _t13074 = (setup_protos_13064 = ({_hd: proto, _tl: setup_protos_13064}), undefined);
        break _t13075;
      }
      _match_fail("line 16629");
    }
    return _t13074;
  }
  const load_13076 = _t13072;
  function _t13078(source) {
    let _t13080;
    const _t13079 = Main$compile_setup(ctx_13062, global_names, mutable_globals, source);
    _t13081: {
      if (true) {
        const ctx2 = _t13079[0];
        const proto = _t13079[1];
        (ctx_13062 = ctx2, undefined);
        _t13080 = (setup_protos_13064 = ({_hd: proto, _tl: setup_protos_13064}), undefined);
        break _t13081;
      }
      _match_fail("line 16629");
    }
    return _t13080;
  }
  const load_source_13082 = _t13078;
  (pub_vars_13060 = null, undefined);
  _call(register_fn_13070, [__dict_Show_int, "String", "length", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "sub", Main$arr3(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 3]);
  _call(register_fn_13070, [__dict_Show_int, "String", "split", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 3, _name: "TString"})})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "String", "trim", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "starts_with", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "String", "contains", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "String", "replace", Main$arr3(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 3]);
  _call(register_fn_13070, [__dict_Show_int, "String", "to_int", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null})]})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "to_float", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 1, _name: "TFloat"}), _tl: null})]})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "uppercase", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "lowercase", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "get", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"}), ({_tag: 4, _name: "TByte"})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "String", "to_bytes", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 4, _name: "TByte"})})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "of_bytes", Main$arr(({_tag: 10, _name: "TList", _val: ({_tag: 4, _name: "TByte"})}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "to_byte_array", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 13, _name: "TArray", _val: ({_tag: 4, _name: "TByte"})})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "of_byte_array", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 4, _name: "TByte"})}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "to_runes", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 5, _name: "TRune"})})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "of_runes", Main$arr(({_tag: 10, _name: "TList", _val: ({_tag: 5, _name: "TRune"})}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "get_rune", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"}), ({_tag: 5, _name: "TRune"})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "String", "of_byte", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "rune_length", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "String", "make", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "String", "index_opt", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 4, _name: "TByte"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null})]})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "String", "rindex_opt", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 4, _name: "TByte"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null})]})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "String", "concat", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 3, _name: "TString"})}), ({_tag: 3, _name: "TString"})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "String", "compare", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"})), 2]);
  const string_info_13084 = ({mod_instances: null, mod_name: "String", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13060, mod_submodules: null});
  const __rec_upd_13086 = ctx_13062;
  const __rec_upd_13088 = ctx_13062.type_env;
  const _t13089 = ({classes: __rec_upd_13088.classes, constructors: __rec_upd_13088.constructors, effects: __rec_upd_13088.effects, hidden_ctor_types: __rec_upd_13088.hidden_ctor_types, hidden_types: __rec_upd_13088.hidden_types, instances: __rec_upd_13088.instances, modules: ({_hd: ["String", string_info_13084], _tl: ctx_13062.type_env.modules}), mutable_fields: __rec_upd_13088.mutable_fields, newtypes: __rec_upd_13088.newtypes, records: __rec_upd_13088.records, type_aliases: __rec_upd_13088.type_aliases, type_synonyms: __rec_upd_13088.type_synonyms, variants: __rec_upd_13088.variants});
  const _t13087 = ({constraint_tvars: __rec_upd_13086.constraint_tvars, current_eff: __rec_upd_13086.current_eff, current_module: __rec_upd_13086.current_module, inside_handler: __rec_upd_13086.inside_handler, loop_info: __rec_upd_13086.loop_info, mutable_vars: __rec_upd_13086.mutable_vars, return_type: __rec_upd_13086.return_type, return_used: __rec_upd_13086.return_used, type_env: _t13089, vars: __rec_upd_13086.vars});
  (ctx_13062 = _t13087, undefined);
  load_source_13082("module String = pub let iter f s = let n = String.length s in let rec go i = if i >= n do () else (f (String.get s i); go (i + 1)) in go 0 end");
  load_13076("list");
  (pub_vars_13060 = null, undefined);
  _call(register_fn_13070, [__dict_Show_int, "Array", "make", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "Array", "get", Main$arr2(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 16, _name: "TGen", _val: 0})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "Array", "set", Main$arr3(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 6, _name: "TUnit"})), 3]);
  _call(register_fn_13070, [__dict_Show_int, "Array", "length", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "Array", "to_list", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 10, _name: "TList", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "Array", "of_list", Main$arr(({_tag: 10, _name: "TList", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "Array", "copy", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "Array", "sub", Main$arr3(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 3]);
  const array_info_13090 = ({mod_instances: null, mod_name: "Array", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13060, mod_submodules: null});
  const __rec_upd_13092 = ctx_13062;
  const __rec_upd_13094 = ctx_13062.type_env;
  const _t13095 = ({classes: __rec_upd_13094.classes, constructors: __rec_upd_13094.constructors, effects: __rec_upd_13094.effects, hidden_ctor_types: __rec_upd_13094.hidden_ctor_types, hidden_types: __rec_upd_13094.hidden_types, instances: __rec_upd_13094.instances, modules: ({_hd: ["Array", array_info_13090], _tl: ctx_13062.type_env.modules}), mutable_fields: __rec_upd_13094.mutable_fields, newtypes: __rec_upd_13094.newtypes, records: __rec_upd_13094.records, type_aliases: __rec_upd_13094.type_aliases, type_synonyms: __rec_upd_13094.type_synonyms, variants: __rec_upd_13094.variants});
  const _t13093 = ({constraint_tvars: __rec_upd_13092.constraint_tvars, current_eff: __rec_upd_13092.current_eff, current_module: __rec_upd_13092.current_module, inside_handler: __rec_upd_13092.inside_handler, loop_info: __rec_upd_13092.loop_info, mutable_vars: __rec_upd_13092.mutable_vars, return_type: __rec_upd_13092.return_type, return_used: __rec_upd_13092.return_used, type_env: _t13095, vars: __rec_upd_13092.vars});
  (ctx_13062 = _t13093, undefined);
  load_13076("array_extra");
  (pub_vars_13060 = null, undefined);
  _call(register_fn_13070, [__dict_Show_int, "IO", "read_file", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "IO", "write_file", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "IO", "append_file", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 2]);
  _call(register_fn_13070, [__dict_Show_int, "IO", "read_line", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "IO", "file_exists", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 1]);
  const io_info_13096 = ({mod_instances: null, mod_name: "IO", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13060, mod_submodules: null});
  const __rec_upd_13098 = ctx_13062;
  const __rec_upd_13100 = ctx_13062.type_env;
  const _t13101 = ({classes: __rec_upd_13100.classes, constructors: __rec_upd_13100.constructors, effects: __rec_upd_13100.effects, hidden_ctor_types: __rec_upd_13100.hidden_ctor_types, hidden_types: __rec_upd_13100.hidden_types, instances: __rec_upd_13100.instances, modules: ({_hd: ["IO", io_info_13096], _tl: ctx_13062.type_env.modules}), mutable_fields: __rec_upd_13100.mutable_fields, newtypes: __rec_upd_13100.newtypes, records: __rec_upd_13100.records, type_aliases: __rec_upd_13100.type_aliases, type_synonyms: __rec_upd_13100.type_synonyms, variants: __rec_upd_13100.variants});
  const _t13099 = ({constraint_tvars: __rec_upd_13098.constraint_tvars, current_eff: __rec_upd_13098.current_eff, current_module: __rec_upd_13098.current_module, inside_handler: __rec_upd_13098.inside_handler, loop_info: __rec_upd_13098.loop_info, mutable_vars: __rec_upd_13098.mutable_vars, return_type: __rec_upd_13098.return_type, return_used: __rec_upd_13098.return_used, type_env: _t13101, vars: __rec_upd_13098.vars});
  (ctx_13062 = _t13099, undefined);
  (pub_vars_13060 = null, undefined);
  _call(register_fn_13070, [__dict_Show_int, "Sys", "args", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 10, _name: "TList", _val: ({_tag: 3, _name: "TString"})})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "Sys", "getenv", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 3, _name: "TString"}), _tl: null})]})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "Sys", "exit", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 6, _name: "TUnit"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "Sys", "time", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "TFloat"})), 1]);
  const sys_info_13102 = ({mod_instances: null, mod_name: "Sys", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13060, mod_submodules: null});
  const __rec_upd_13104 = ctx_13062;
  const __rec_upd_13106 = ctx_13062.type_env;
  const _t13107 = ({classes: __rec_upd_13106.classes, constructors: __rec_upd_13106.constructors, effects: __rec_upd_13106.effects, hidden_ctor_types: __rec_upd_13106.hidden_ctor_types, hidden_types: __rec_upd_13106.hidden_types, instances: __rec_upd_13106.instances, modules: ({_hd: ["Sys", sys_info_13102], _tl: ctx_13062.type_env.modules}), mutable_fields: __rec_upd_13106.mutable_fields, newtypes: __rec_upd_13106.newtypes, records: __rec_upd_13106.records, type_aliases: __rec_upd_13106.type_aliases, type_synonyms: __rec_upd_13106.type_synonyms, variants: __rec_upd_13106.variants});
  const _t13105 = ({constraint_tvars: __rec_upd_13104.constraint_tvars, current_eff: __rec_upd_13104.current_eff, current_module: __rec_upd_13104.current_module, inside_handler: __rec_upd_13104.inside_handler, loop_info: __rec_upd_13104.loop_info, mutable_vars: __rec_upd_13104.mutable_vars, return_type: __rec_upd_13104.return_type, return_used: __rec_upd_13104.return_used, type_env: _t13107, vars: __rec_upd_13104.vars});
  (ctx_13062 = _t13105, undefined);
  load_13076("math");
  load_13076("result");
  load_13076("byte");
  load_13076("rune");
  load_13076("map");
  load_13076("set");
  load_13076("enum");
  load_13076("seq");
  load_13076("option");
  load_13076("buffer");
  load_13076("fmt");
  load_13076("hash");
  load_13076("hashtbl");
  load_13076("ref");
  load_13076("dynarray");
  load_13076("compat");
  (pub_vars_13060 = null, undefined);
  _call(register_fn_13070, [__dict_Show_int, "Runtime", "eval", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 1]);
  _call(register_fn_13070, [__dict_Show_int, "Runtime", "eval_file", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 1]);
  const runtime_info_13108 = ({mod_instances: null, mod_name: "Runtime", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13060, mod_submodules: null});
  const __rec_upd_13110 = ctx_13062;
  const __rec_upd_13112 = ctx_13062.type_env;
  const _t13113 = ({classes: __rec_upd_13112.classes, constructors: __rec_upd_13112.constructors, effects: __rec_upd_13112.effects, hidden_ctor_types: __rec_upd_13112.hidden_ctor_types, hidden_types: __rec_upd_13112.hidden_types, instances: __rec_upd_13112.instances, modules: ({_hd: ["Runtime", runtime_info_13108], _tl: ctx_13062.type_env.modules}), mutable_fields: __rec_upd_13112.mutable_fields, newtypes: __rec_upd_13112.newtypes, records: __rec_upd_13112.records, type_aliases: __rec_upd_13112.type_aliases, type_synonyms: __rec_upd_13112.type_synonyms, variants: __rec_upd_13112.variants});
  const _t13111 = ({constraint_tvars: __rec_upd_13110.constraint_tvars, current_eff: __rec_upd_13110.current_eff, current_module: __rec_upd_13110.current_module, inside_handler: __rec_upd_13110.inside_handler, loop_info: __rec_upd_13110.loop_info, mutable_vars: __rec_upd_13110.mutable_vars, return_type: __rec_upd_13110.return_type, return_used: __rec_upd_13110.return_used, type_env: _t13113, vars: __rec_upd_13110.vars});
  (ctx_13062 = _t13111, undefined);
  const _t13109 = [ctx_13062, List$rev(setup_protos_13064)];
  const _t13103 = _t13109;
  const _t13097 = _t13103;
  const _t13091 = _t13097;
  const _t13085 = _t13091;
  const _t13083 = _t13085;
  const _t13077 = _t13083;
  const _t13071 = _t13077;
  const _t13065 = _t13071;
  const _t13063 = _t13065;
  const _t13061 = _t13063;
  return _t13061;
}
function Main$run_batch(manifest_file) {
  const _t13114 = (function() {
    const _t13115 = _h;
    _h = Object.assign({}, _t13115, {
      "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
      "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
      "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
      "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const manifest_13116 = IO$read_file(manifest_file);
      function _t13118(s) {
        return (s !== "");
      }
      const files_13119 = List$filter(_t13118, String$split("\n", manifest_13116));
      let _t13122;
      const _t13121 = Main$setup_builtins(undefined);
      _t13123: {
        if (true) {
          const ctx = _t13121[0];
          const global_names = _t13121[1];
          const mutable_globals = _t13121[2];
          const stdlib_pub_vars = _t13121[3];
          let _t13125;
          const _t13124 = Main$setup_classes(ctx, global_names, mutable_globals, stdlib_pub_vars);
          _t13126: {
            if (true) {
              const ctx = _t13124[0];
              const class_protos = _t13124[1];
              let _t13128;
              const _t13127 = Main$setup_modules(ctx, global_names, mutable_globals);
              _t13129: {
                if (true) {
                  const ctx = _t13127[0];
                  const module_protos = _t13127[1];
                  const setup_protos_13130 = List$concat(class_protos, module_protos);
                  const base_gn_len_13132 = Dynarray$length(global_names);
                  const base_native_13134 = Main$native_global_entries;
                  const base_mutable_13136 = Hashtbl$to_list(mutable_globals);
                  function _t13138(filename) {
                    (global_names.count = base_gn_len_13132, undefined);
                    (Main$native_global_entries = base_native_13134, undefined);
                    Hashtbl$clear(mutable_globals);
                    function _t13139(__p448) {
                      let _t13141;
                      const _t13140 = __p448;
                      _t13142: {
                        if (true) {
                          const k = _t13140[0];
                          const v = _t13140[1];
                          _t13141 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, mutable_globals, k, v]);
                          break _t13142;
                        }
                        _match_fail("line 16629");
                      }
                      return _t13141;
                    }
                    Main$list_iter(_t13139, base_mutable_13136);
                    const _t13143 = (function() {
                      const _t13144 = _h;
                      _h = Object.assign({}, _t13144, {
                        "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
                        "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
                        "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
                        "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
                        "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
                      });
                      try {
                        const source_13145 = IO$read_file(filename);
                        const tokens_13147 = Lexer$tokenize(source_13145);
                        const program_13149 = Parser$parse_program(tokens_13147);
                        let _t13152;
                        const _t13151 = Typechecker$check_program_in_ctx(ctx, program_13149);
                        _t13153: {
                          if (true) {
                            const ctx2 = _t13151[0];
                            const typed_program = _t13151[1];
                            const typed_program2_13154 = Typechecker$transform_constraints(ctx2, typed_program);
                            const compiled_13156 = Compiler$compile_program_with_globals(ctx2.type_env, global_names, mutable_globals, typed_program2_13154);
                            const ng_json_13158 = _t12646_Main$build_native_globals_json(undefined);
                            const json_13160 = Serialize$serialize_bundle(global_names, ng_json_13158, setup_protos_13130, compiled_13156.main);
                            print(json_13160);
                            const _t13161 = print("===BATCH-SEP===");
                            const _t13159 = _t13161;
                            const _t13157 = _t13159;
                            const _t13155 = _t13157;
                            _t13152 = _t13155;
                            break _t13153;
                          }
                          _match_fail("line 16629");
                        }
                        const _t13150 = _t13152;
                        const _t13148 = _t13150;
                        const _t13146 = _t13148;
                        const x_13162 = _t13146;
                        return x_13162;
                      } catch (_exc) {
                        if (_exc && _exc._e === "lex_error") {
                          const arg = _exc._v;
                          let _t13164;
                          const _t13163 = arg;
                          _t13165: {
                            if (true) {
                              const msg = _t13163[0];
                              const _loc = _t13163[1];
                              print(("COMPILE-ERROR:" + msg));
                              _t13164 = print("===BATCH-SEP===");
                              break _t13165;
                            }
                            _match_fail("line 16629");
                          }
                          return _t13164;
                        } else if (_exc && _exc._e === "parse_error") {
                          const arg = _exc._v;
                          let _t13167;
                          const _t13166 = arg;
                          _t13168: {
                            if (true) {
                              const msg = _t13166[0];
                              const _loc = _t13166[1];
                              print(("COMPILE-ERROR:" + msg));
                              _t13167 = print("===BATCH-SEP===");
                              break _t13168;
                            }
                            _match_fail("line 16629");
                          }
                          return _t13167;
                        } else if (_exc && _exc._e === "type_error") {
                          const arg = _exc._v;
                          let _t13170;
                          const _t13169 = arg;
                          _t13171: {
                            if (true) {
                              const msg = _t13169[0];
                              const _loc = _t13169[1];
                              print(("COMPILE-ERROR:" + msg));
                              _t13170 = print("===BATCH-SEP===");
                              break _t13171;
                            }
                            _match_fail("line 16629");
                          }
                          return _t13170;
                        } else if (_exc && _exc._e === "compile_error") {
                          const msg = _exc._v;
                          print(("COMPILE-ERROR:" + msg));
                          return print("===BATCH-SEP===");
                        } else if (_exc && _exc._e === "unify_error") {
                          const msg = _exc._v;
                          print(("COMPILE-ERROR:" + msg));
                          return print("===BATCH-SEP===");
                        } else { throw _exc; }
                      } finally { _h = _t13144; }
                    })();
                    return _t13143;
                  }
                  const _t13137 = Main$list_iter(_t13138, files_13119);
                  const _t13135 = _t13137;
                  const _t13133 = _t13135;
                  const _t13131 = _t13133;
                  _t13128 = _t13131;
                  break _t13129;
                }
                _match_fail("line 16629");
              }
              _t13125 = _t13128;
              break _t13126;
            }
            _match_fail("line 16629");
          }
          _t13122 = _t13125;
          break _t13123;
        }
        _match_fail("line 16629");
      }
      const _t13120 = _t13122;
      const _t13117 = _t13120;
      const x_13172 = _t13117;
      return x_13172;
    } catch (_exc) {
      if (_exc && _exc._e === "lex_error") {
        const arg = _exc._v;
        let _t13174;
        const _t13173 = arg;
        _t13175: {
          if (true) {
            const msg = _t13173[0];
            const _loc = _t13173[1];
            _t13174 = failwith(msg);
            break _t13175;
          }
          _match_fail("line 16629");
        }
        return _t13174;
      } else if (_exc && _exc._e === "parse_error") {
        const arg = _exc._v;
        let _t13177;
        const _t13176 = arg;
        _t13178: {
          if (true) {
            const msg = _t13176[0];
            const _loc = _t13176[1];
            _t13177 = failwith(msg);
            break _t13178;
          }
          _match_fail("line 16629");
        }
        return _t13177;
      } else if (_exc && _exc._e === "type_error") {
        const arg = _exc._v;
        let _t13180;
        const _t13179 = arg;
        _t13181: {
          if (true) {
            const msg = _t13179[0];
            const _loc = _t13179[1];
            _t13180 = failwith(msg);
            break _t13181;
          }
          _match_fail("line 16629");
        }
        return _t13180;
      } else if (_exc && _exc._e === "compile_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else { throw _exc; }
    } finally { _h = _t13115; }
  })();
  return _t13114;
}
function Main$run_emit_js(args) {
  const _t13182 = (function() {
    const _t13183 = _h;
    _h = Object.assign({}, _t13183, {
      "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
      "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
      "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
      "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
      "codegen_error": function(msg, __k_try) { throw {_e: "codegen_error", _v: msg}; },
    });
    try {
      (Main$js_capture_mode = true, undefined);
      (Main$captured_typed_setups = null, undefined);
      let _t13185;
      const _t13184 = Main$setup_builtins(undefined);
      _t13186: {
        if (true) {
          const ctx = _t13184[0];
          const global_names = _t13184[1];
          const mutable_globals = _t13184[2];
          const stdlib_pub_vars = _t13184[3];
          let _t13188;
          const _t13187 = Main$setup_classes(ctx, global_names, mutable_globals, stdlib_pub_vars);
          _t13189: {
            if (true) {
              const ctx = _t13187[0];
              const _class_protos = _t13187[1];
              let _t13191;
              const _t13190 = Main$setup_modules(ctx, global_names, mutable_globals);
              _t13192: {
                if (true) {
                  const ctx = _t13190[0];
                  const _module_protos = _t13190[1];
                  let _t13194;
                  const _t13193 = args;
                  _t13195: {
                    if (_t13193 !== null && _t13193._tl !== null) {
                      const file = _t13193._tl._hd;
                      _t13194 = file;
                      break _t13195;
                    }
                    if (true) {
                      _t13194 = failwith("Usage: compiler --emit-js <source-file>");
                      break _t13195;
                    }
                    _match_fail("line 16629");
                  }
                  const filename_13196 = _t13194;
                  const source_13198 = IO$read_file(filename_13196);
                  const tokens_13200 = Lexer$tokenize(source_13198);
                  const program_13202 = Parser$parse_program(tokens_13200);
                  let _t13205;
                  const _t13204 = Typechecker$check_program_in_ctx(ctx, program_13202);
                  _t13206: {
                    if (true) {
                      const ctx2 = _t13204[0];
                      const typed_program = _t13204[1];
                      const typed_program2_13207 = Typechecker$transform_constraints(ctx2, typed_program);
                      const js_13209 = Js_codegen$compile_program_with_stdlib(ctx2.type_env, Main$captured_typed_setups, typed_program2_13207);
                      const _t13210 = print(js_13209);
                      const _t13208 = _t13210;
                      _t13205 = _t13208;
                      break _t13206;
                    }
                    _match_fail("line 16629");
                  }
                  const _t13203 = _t13205;
                  const _t13201 = _t13203;
                  const _t13199 = _t13201;
                  const _t13197 = _t13199;
                  _t13191 = _t13197;
                  break _t13192;
                }
                _match_fail("line 16629");
              }
              _t13188 = _t13191;
              break _t13189;
            }
            _match_fail("line 16629");
          }
          _t13185 = _t13188;
          break _t13186;
        }
        _match_fail("line 16629");
      }
      const x_13211 = _t13185;
      return x_13211;
    } catch (_exc) {
      if (_exc && _exc._e === "lex_error") {
        const arg = _exc._v;
        let _t13213;
        const _t13212 = arg;
        _t13214: {
          if (true) {
            const msg = _t13212[0];
            const _loc = _t13212[1];
            _t13213 = failwith(msg);
            break _t13214;
          }
          _match_fail("line 16629");
        }
        return _t13213;
      } else if (_exc && _exc._e === "parse_error") {
        const arg = _exc._v;
        let _t13216;
        const _t13215 = arg;
        _t13217: {
          if (true) {
            const msg = _t13215[0];
            const _loc = _t13215[1];
            _t13216 = failwith(msg);
            break _t13217;
          }
          _match_fail("line 16629");
        }
        return _t13216;
      } else if (_exc && _exc._e === "type_error") {
        const arg = _exc._v;
        let _t13219;
        const _t13218 = arg;
        _t13220: {
          if (true) {
            const msg = _t13218[0];
            const _loc = _t13218[1];
            _t13219 = failwith(msg);
            break _t13220;
          }
          _match_fail("line 16629");
        }
        return _t13219;
      } else if (_exc && _exc._e === "compile_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else if (_exc && _exc._e === "codegen_error") {
        const msg = _exc._v;
        return failwith(("JS codegen error: " + msg));
      } else { throw _exc; }
    } finally { _h = _t13183; }
  })();
  return _t13182;
}
const args_13222 = Sys$args(undefined);
let _t13225;
const _t13224 = args_13222;
_t13226: {
  if (_t13224 !== null && _t13224._tl !== null && _t13224._tl._hd === "--batch" && _t13224._tl._tl !== null) {
    const f = _t13224._tl._tl._hd;
    _t13225 = ({_tag: 1, _name: "Some", _val: f});
    break _t13226;
  }
  if (true) {
    _t13225 = ({_tag: 0, _name: "None"});
    break _t13226;
  }
  _match_fail("line 16629");
}
const batch_file_13227 = _t13225;
function _t13229(a) {
  return (a === "--emit-js");
}
const emit_js_13230 = List$exists(_t13229, args_13222);
function _t13232(a) {
  return (a === "--no-optimize");
}
const no_optimize_13233 = List$exists(_t13232, args_13222);
let _t13235;
if (no_optimize_13233) {
  _t13235 = Ref$set(Compiler$optimize_enabled, false);
} else {
  _t13235 = undefined;
}
_t13235;
function _t13236(a) {
  return ((a !== "--no-optimize") && (a !== "--emit-js"));
}
const args_13237 = List$filter(_t13236, args_13222);
let _t13240;
const _t13239 = batch_file_13227;
_t13241: {
  if (_t13239._tag === 1) {
    const f = _t13239._val;
    _t13240 = Main$run_batch(f);
    break _t13241;
  }
  if (_t13239._tag === 0) {
    let _t13242;
    if (emit_js_13230) {
      _t13242 = Main$run_emit_js(args_13237);
    } else {
      const _t13243 = (function() {
        const _t13244 = _h;
        _h = Object.assign({}, _t13244, {
          "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
          "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
          "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
          "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
          "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
        });
        try {
          let _t13246;
          const _t13245 = args_13237;
          _t13247: {
            if (_t13245 !== null && _t13245._tl !== null && _t13245._tl._hd === "--emit-json" && _t13245._tl._tl !== null) {
              const file = _t13245._tl._tl._hd;
              _t13246 = file;
              break _t13247;
            }
            if (_t13245 !== null && _t13245._tl !== null) {
              const file = _t13245._tl._hd;
              _t13246 = file;
              break _t13247;
            }
            if (true) {
              _t13246 = failwith("Usage: compiler [--emit-json | --emit-js | --batch <manifest>] <source-file>");
              break _t13247;
            }
            _match_fail("line 16629");
          }
          const filename_13248 = _t13246;
          const source_13250 = IO$read_file(filename_13248);
          let _t13253;
          const _t13252 = Main$setup_builtins(undefined);
          _t13254: {
            if (true) {
              const ctx = _t13252[0];
              const global_names = _t13252[1];
              const mutable_globals = _t13252[2];
              const stdlib_pub_vars = _t13252[3];
              let _t13256;
              const _t13255 = Main$setup_classes(ctx, global_names, mutable_globals, stdlib_pub_vars);
              _t13257: {
                if (true) {
                  const ctx = _t13255[0];
                  const class_protos = _t13255[1];
                  let _t13259;
                  const _t13258 = Main$setup_modules(ctx, global_names, mutable_globals);
                  _t13260: {
                    if (true) {
                      const ctx = _t13258[0];
                      const module_protos = _t13258[1];
                      const setup_protos_13261 = List$concat(class_protos, module_protos);
                      const tokens_13263 = Lexer$tokenize(source_13250);
                      const program_13265 = Parser$parse_program(tokens_13263);
                      let _t13268;
                      const _t13267 = Typechecker$check_program_in_ctx(ctx, program_13265);
                      _t13269: {
                        if (true) {
                          const ctx2 = _t13267[0];
                          const typed_program = _t13267[1];
                          const typed_program2_13270 = Typechecker$transform_constraints(ctx2, typed_program);
                          const compiled_13272 = Compiler$compile_program_with_globals(ctx2.type_env, global_names, mutable_globals, typed_program2_13270);
                          const ng_json_13274 = _t12646_Main$build_native_globals_json(undefined);
                          const json_13276 = Serialize$serialize_bundle(global_names, ng_json_13274, setup_protos_13261, compiled_13272.main);
                          const _t13277 = print(json_13276);
                          const _t13275 = _t13277;
                          const _t13273 = _t13275;
                          const _t13271 = _t13273;
                          _t13268 = _t13271;
                          break _t13269;
                        }
                        _match_fail("line 16629");
                      }
                      const _t13266 = _t13268;
                      const _t13264 = _t13266;
                      const _t13262 = _t13264;
                      _t13259 = _t13262;
                      break _t13260;
                    }
                    _match_fail("line 16629");
                  }
                  _t13256 = _t13259;
                  break _t13257;
                }
                _match_fail("line 16629");
              }
              _t13253 = _t13256;
              break _t13254;
            }
            _match_fail("line 16629");
          }
          const _t13251 = _t13253;
          const _t13249 = _t13251;
          const x_13278 = _t13249;
          return x_13278;
        } catch (_exc) {
          if (_exc && _exc._e === "lex_error") {
            const arg = _exc._v;
            let _t13280;
            const _t13279 = arg;
            _t13281: {
              if (true) {
                const msg = _t13279[0];
                const _loc = _t13279[1];
                _t13280 = failwith(msg);
                break _t13281;
              }
              _match_fail("line 16629");
            }
            return _t13280;
          } else if (_exc && _exc._e === "parse_error") {
            const arg = _exc._v;
            let _t13283;
            const _t13282 = arg;
            _t13284: {
              if (true) {
                const msg = _t13282[0];
                const _loc = _t13282[1];
                _t13283 = failwith(msg);
                break _t13284;
              }
              _match_fail("line 16629");
            }
            return _t13283;
          } else if (_exc && _exc._e === "type_error") {
            const arg = _exc._v;
            let _t13286;
            const _t13285 = arg;
            _t13287: {
              if (true) {
                const msg = _t13285[0];
                const _loc = _t13285[1];
                _t13286 = failwith(msg);
                break _t13287;
              }
              _match_fail("line 16629");
            }
            return _t13286;
          } else if (_exc && _exc._e === "compile_error") {
            const msg = _exc._v;
            return failwith(msg);
          } else if (_exc && _exc._e === "unify_error") {
            const msg = _exc._v;
            return failwith(msg);
          } else { throw _exc; }
        } finally { _h = _t13244; }
      })();
      _t13242 = _t13243;
    }
    _t13240 = _t13242;
    break _t13241;
  }
  _match_fail("line 16629");
}
const _t13238 = _t13240;
const _t13234 = _t13238;
const _t13231 = _t13234;
const _t13228 = _t13231;
const _t13223 = _t13228;
const _t13221_Main$__destruct = _t13223;
if (_last_val !== undefined) println(_pp(_last_val));
var _mml_exports = {"_result": _last_val, "_call": _call, "_pp": _pp};
if (typeof globalThis !== "undefined") globalThis._mmlExports = _mml_exports;
