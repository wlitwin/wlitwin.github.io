"use strict";
function _call(f, args) {
  while (args.length > 0) {
    const a = f._arity !== undefined ? f._arity : f.length;
    if (a === 0) { f = f(); continue; }
    if (args.length < a) return _partial(f, a, args);
    const taken = args.splice(0, a);
    f = f.apply(null, taken);
  }
  return f;
}
function _partial(fn, arity, args) {
  const p = function() {
    return _call(fn, args.concat(Array.from(arguments)));
  };
  p._arity = arity - args.length;
  return p;
}
function _eq(a, b) {
  if (a === b) return true;
  if (a == null || b == null) return a === b;
  if (typeof a !== "object") return false;
  if (Array.isArray(a)) {
    if (!Array.isArray(b) || a.length !== b.length) return false;
    for (let i = 0; i < a.length; i++) if (!_eq(a[i], b[i])) return false;
    return true;
  }
  if ("_arr" in a && "_arr" in b) {
    if (a._arr.length !== b._arr.length) return false;
    for (let i = 0; i < a._arr.length; i++) if (!_eq(a._arr[i], b._arr[i])) return false;
    return true;
  }
  if ("_hd" in a && "_hd" in b) {
    let ca = a, cb = b;
    while (ca !== null && cb !== null) {
      if (!("_hd" in ca) || !("_hd" in cb)) return ca === cb;
      if (!_eq(ca._hd, cb._hd)) return false;
      ca = ca._tl; cb = cb._tl;
    }
    return ca === cb;
  }
  if ("_tag" in a) return a._tag === b._tag && _eq(a._val, b._val);
  if ("_ref" in a) return _eq(a._ref, b._ref);
  const ka = Object.keys(a), kb = Object.keys(b);
  if (ka.length !== kb.length) return false;
  for (const k of ka) if (!_eq(a[k], b[k])) return false;
  return true;
}
function _compare(a, b) {
  if (a < b) return -1;
  if (a > b) return 1;
  return 0;
}
function _match_fail(loc) { throw new Error("Match failure at " + loc); }
function _pp(v) {
  if (v === undefined) return "()";
  if (v === null) return "[]";
  if (typeof v === "number") {
    if (!Number.isInteger(v)) {
      const s = String(v);
      return s.includes(".") || s.includes("e") ? s : s + ".";
    }
    return String(v);
  }
  if (typeof v === "boolean") return String(v);
  if (typeof v === "string") return v;
  if (Array.isArray(v)) return "(" + v.map(_pp).join(", ") + ")";
  if (v !== null && typeof v === "object") {
    if ("_arr" in v) return "#[" + v._arr.map(_pp).join("; ") + "]";
    if ("_hd" in v) {
      const r = [];
      let c = v;
      while (c !== null && typeof c === "object" && "_hd" in c) { r.push(_pp(c._hd)); c = c._tl; }
      return "[" + r.join("; ") + "]";
    }
    if ("_tag" in v) {
      if (v._val !== undefined) {
        const pv = _pp(v._val);
        if (Array.isArray(v._val) || (typeof v._val === "object" && v._val !== null && "_tag" in v._val && v._val._val !== undefined))
          return v._name + " (" + pv + ")";
        return v._name + " " + pv;
      }
      return v._name;
    }
    if ("_ref" in v) return "ref(" + _pp(v._ref) + ")";
    return "{ " + Object.entries(v).map(([k,val]) => k + " = " + _pp(val)).join("; ") + " }";
  }
  return String(v);
}
function _throw_break(v) { throw {_tag: "_break", _val: v}; }
function _throw_fold_cont(v) { throw {_tag: "_fold_cont", _val: v}; }
function _throw_return(v) { throw {_tag: "_return", _val: v}; }
let _h = {};
function _bounce(fn) { fn._tramp = true; return fn; }
const _trampolining = new Set();
function _trampoline(fn, tag) {
  if (tag !== undefined && _trampolining.has(tag)) return fn();
  if (tag !== undefined) _trampolining.add(tag);
  try {
    let result = fn();
    while (typeof result === 'function' && result._tramp) {
      result = result();
    }
    return result;
  } finally { if (tag !== undefined) _trampolining.delete(tag); }
}
function _resolve(v) { while (typeof v === 'function' && v._tramp) v = v(); return v; }
// --- Builtins ---
function print(v) {
  const s = (typeof v === "string") ? v : _pp(v);
  if (typeof globalThis._jsOutput === "function") globalThis._jsOutput(s);
  else if (typeof process !== "undefined") process.stdout.write(s);
  return undefined;
}
function println(v) {
  const s = (typeof v === "string") ? v : _pp(v);
  if (typeof globalThis._jsOutput === "function") globalThis._jsOutput(s + "\n");
  else if (typeof process !== "undefined") process.stdout.write(s + "\n");
  return undefined;
}
function string_of_int(n) { return String(n); }
function int_of_string(s) { const n = parseInt(s, 10); if (isNaN(n)) throw new Error("int_of_string: " + s); return n; }
function float_of_int(n) { return n; }
function int_of_float(f) { return Math.trunc(f); }
function float_of_string(s) { const f = parseFloat(s); if (isNaN(f)) throw new Error("float_of_string: " + s); return f; }
function string_of_float(f) {
  const s = String(f);
  return s.includes(".") || s.includes("e") ? s : s + ".";
}
function string_of_bool(b) { return String(b); }
function failwith(msg) { throw new Error(msg); }
const not = (b) => !b;
function $caret(a, b) { return a + b; }
function $mod(a, b) { return a % b; }
function __show_value(v) { return _pp(v); }
function copy_continuation(k) { return k; }
const ignore = (_) => undefined;
function fst(t) { return t[0]; }
function snd(t) { return t[1]; }
function string_length(s) { return s.length; }
function string_sub(s, start, len) { return s.substring(start, start + len); }
function string_get(s, i) { return s.charCodeAt(i); }
function string_contains(s, sub) { return s.includes(sub); }
function string_concat(sep, parts) {
  const arr = [];
  let c = parts;
  while (c !== null) { arr.push(c._hd); c = c._tl; }
  return arr.join(sep);
}
function array_length(a) { return a._arr.length; }
function array_get(a, i) { return a._arr[i]; }
function array_set(a, i, v) { a._arr[i] = v; return undefined; }
function array_make(n, v) { return {_arr: new Array(n).fill(v)}; }
function array_of_list(lst) {
  const arr = [];
  let c = lst;
  while (c !== null) { arr.push(c._hd); c = c._tl; }
  return {_arr: arr};
}
function array_to_list(arr) {
  const a = arr._arr;
  let result = null;
  for (let i = a.length - 1; i >= 0; i--) result = {_hd: a[i], _tl: result};
  return result;
}
function array_copy(a) { return {_arr: a._arr.slice()}; }
function array_sub(a, start, len) { return {_arr: a._arr.slice(start, start + len)}; }
function __math_pow(a, b) { return Math.pow(a, b); }
function __math_sqrt(x) { return Math.sqrt(x); }
function __math_floor(x) { return Math.floor(x); }
function __math_ceil(x) { return Math.ceil(x); }
function __math_round(x) { return Math.round(x); }
function __math_abs(x) { return Math.abs(x); }
function __math_sin(x) { return Math.sin(x); }
function __math_cos(x) { return Math.cos(x); }
function __math_abs_float(x) { return Math.abs(x); }
function __byte_to_char(b) { return String.fromCharCode(b); }
function __byte_to_int(b) { return b; }
function __byte_of_int(n) { return n & 0xFF; }
function __byte_to_string(b) { return String.fromCharCode(b); }
function __char_to_byte(s) { return s.charCodeAt(0); }
function __rune_to_string(cp) {
  return String.fromCodePoint(cp);
}
function __string_to_runes(s) {
  const cps = Array.from(s).map(c => c.codePointAt(0));
  let result = null;
  for (let i = cps.length - 1; i >= 0; i--) result = {_hd: cps[i], _tl: result};
  return result;
}
function __rune_to_int(r) { return r; }
function __rune_of_int(n) { return n; }
function __int_to_hex(n) { return n.toString(16); }
function __int_to_oct(n) { return n.toString(8); }
function __int_to_bin(n) { return n.toString(2); }
function __fmt_float(prec, f) { return f.toFixed(prec); }
function __fmt_hex(n) { return n.toString(16); }
function __fmt_hex_upper(n) { return n.toString(16).toUpperCase(); }
function __fmt_oct(n) { return n.toString(8); }
function __fmt_bin(n) { return n.toString(2); }
function __fmt_zero_pad(width, s) { return s.padStart(width, "0"); }
function __fmt_pad_left(width, s) { return s.padStart(width, " "); }
function __fmt_pad_right(width, s) { return s.padEnd(width, " "); }
function __sys_time() { return Date.now() / 1000.0; }
function __sys_exit(code) { if (typeof process !== "undefined") process.exit(code); throw new Error("exit: " + code); }
// --- Module extern stubs ---
// String module
function String$length(s) { return s.length; }
function String$sub(s, start, len) {
  if (start < 0 || len < 0 || start + len > s.length)
    throw new Error("String.sub: index out of bounds");
  return s.substring(start, start + len);
}
function String$split(delim, input) {
  if (delim.length === 0) {
    let r = null;
    for (let i = input.length - 1; i >= 0; i--) r = {_hd: input[i], _tl: r};
    return r;
  }
  const parts = input.split(delim);
  let r = null;
  for (let i = parts.length - 1; i >= 0; i--) r = {_hd: parts[i], _tl: r};
  return r;
}
function String$trim(s) { return s.trim(); }
function String$starts_with(prefix, s) { return s.startsWith(prefix); }
function String$contains(sub, s) { return s.includes(sub); }
function String$replace(old_s, new_s, input) {
  if (old_s.length === 0) return input;
  return input.split(old_s).join(new_s);
}
function String$to_int(s) { const n = parseInt(s,10); return isNaN(n) ? {_tag:0,_name:"None"} : {_tag:1,_name:"Some",_val:n}; }
function String$to_float(s) { const f = parseFloat(s); return isNaN(f) ? {_tag:0,_name:"None"} : {_tag:1,_name:"Some",_val:f}; }
function String$uppercase(s) { return s.toUpperCase(); }
function String$lowercase(s) { return s.toLowerCase(); }
function String$get(s, i) {
  if (i < 0 || i >= s.length) throw new Error("String.get: index " + i + " out of bounds (length " + s.length + ")");
  return s.charCodeAt(i);
}
function String$to_bytes(s) {
  let r = null;
  for (let i = s.length - 1; i >= 0; i--) r = {_hd: s.charCodeAt(i), _tl: r};
  return r;
}
function String$of_bytes(lst) {
  let r = "";
  let c = lst;
  while (c !== null) { r += String.fromCharCode(c._hd); c = c._tl; }
  return r;
}
function String$to_byte_array(s) {
  const a = new Array(s.length);
  for (let i = 0; i < s.length; i++) a[i] = s.charCodeAt(i);
  return {_arr: a};
}
function String$of_byte_array(a) {
  let r = "";
  for (let i = 0; i < a._arr.length; i++) r += String.fromCharCode(a._arr[i]);
  return r;
}
function String$to_runes(s) { return __string_to_runes(s); }
function String$of_runes(lst) {
  let r = "";
  let c = lst;
  while (c !== null) { r += String.fromCodePoint(c._hd); c = c._tl; }
  return r;
}
function String$get_rune(s, n) {
  const cps = Array.from(s);
  if (n < 0 || n >= cps.length) throw new Error("String.get_rune: index " + n + " out of bounds");
  return cps[n].codePointAt(0);
}
function String$of_byte(b) { return String.fromCharCode(b); }
function String$rune_length(s) { return Array.from(s).length; }
function String$make(n, b) {
  if (n < 0) throw new Error("String.make: negative length");
  return String.fromCharCode(b).repeat(n);
}
function String$index_opt(s, b) { const i=s.indexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:"None"}:{_tag:1,_name:"Some",_val:i}; }
function String$rindex_opt(s, b) { const i=s.lastIndexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:"None"}:{_tag:1,_name:"Some",_val:i}; }
function String$concat(sep, lst) { return string_concat(sep, lst); }
function String$compare(a, b) { return a < b ? -1 : a > b ? 1 : 0; }
// Array module
function Array$make(n, v) { return array_make(n, v); }
function Array$get(a, i) { return array_get(a, i); }
function Array$set(a, i, v) { return array_set(a, i, v); }
function Array$length(a) { return array_length(a); }
function Array$to_list(a) { return array_to_list(a); }
function Array$of_list(l) { return array_of_list(l); }
function Array$copy(a) { return array_copy(a); }
function Array$sub(a, s, l) { return array_sub(a, s, l); }
// IO module
function IO$read_file(path) {
  if (typeof globalThis._jsReadFile === "function") return globalThis._jsReadFile(path);
  if (typeof require !== "undefined") return require("fs").readFileSync(path,"utf8");
  throw new Error("IO.read_file: not available in this environment");
}
function IO$write_file(path, data) {
  if (typeof require !== "undefined") { require("fs").writeFileSync(path,data); return undefined; }
  throw new Error("IO.write_file: not available in this environment");
}
function IO$append_file(path, data) {
  if (typeof require !== "undefined") { require("fs").appendFileSync(path,data); return undefined; }
  throw new Error("IO.append_file: not available in this environment");
}
function IO$read_line(u) {
  if (typeof require !== "undefined") {
    const buf = Buffer.alloc(1);
    let line = "";
    const fd = require("fs").openSync("/dev/stdin", "rs");
    while (true) {
      const n = require("fs").readSync(fd, buf, 0, 1);
      if (n === 0 || buf[0] === 10) break;
      line += String.fromCharCode(buf[0]);
    }
    return line;
  }
  return "";
}
function IO$file_exists(path) {
  if (typeof require !== "undefined") return require("fs").existsSync(path);
  return false;
}
// Sys module
function Sys$args(u) {
  if (globalThis._jsSysArgs) {
    const a = globalThis._jsSysArgs;
    let r = null;
    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};
    return r;
  }
  if (typeof process !== "undefined") {
    const a = process.argv.slice(1);
    let r = null;
    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};
    return r;
  }
  return null;
}
function Sys$getenv(name) {
  if (typeof process !== "undefined") {
    const v = process.env[name];
    return v === undefined ? {_tag:0,_name:"None"} : {_tag:1,_name:"Some",_val:v};
  }
  return {_tag:0,_name:"None"};
}
function Sys$exit(code) { __sys_exit(code); }
function Sys$time(u) { return __sys_time(); }
// Runtime module (stubs â€” eval not supported in compiled JS)
function Runtime$eval(s) { throw new Error("Runtime.eval: not supported in compiled JS"); }
function Runtime$eval_file(s) { throw new Error("Runtime.eval_file: not supported in compiled JS"); }
// --- Typeclass primitive externs ---
function __num_add_int(a, b) { return a + b; }
function __num_sub_int(a, b) { return a - b; }
function __num_mul_int(a, b) { return a * b; }
function __num_div_int(a, b) { if (b === 0) throw new Error("division by zero"); return (a / b) | 0; }
function __num_neg_int(a) { return -a; }
function __num_add_float(a, b) { return a + b; }
function __num_sub_float(a, b) { return a - b; }
function __num_mul_float(a, b) { return a * b; }
function __num_div_float(a, b) { return a / b; }
function __num_neg_float(a) { return -a; }
function __eq_int(a, b) { return a === b; }
function __neq_int(a, b) { return a !== b; }
function __eq_float(a, b) { return a === b; }
function __neq_float(a, b) { return a !== b; }
function __eq_string(a, b) { return a === b; }
function __neq_string(a, b) { return a !== b; }
function __eq_bool(a, b) { return a === b; }
function __neq_bool(a, b) { return a !== b; }
function __eq_byte(a, b) { return a === b; }
function __neq_byte(a, b) { return a !== b; }
function __eq_rune(a, b) { return a === b; }
function __neq_rune(a, b) { return a !== b; }
function __lt_int(a, b) { return a < b; }
function __gt_int(a, b) { return a > b; }
function __le_int(a, b) { return a <= b; }
function __ge_int(a, b) { return a >= b; }
function __lt_float(a, b) { return a < b; }
function __gt_float(a, b) { return a > b; }
function __le_float(a, b) { return a <= b; }
function __ge_float(a, b) { return a >= b; }
function __lt_string(a, b) { return a < b; }
function __gt_string(a, b) { return a > b; }
function __le_string(a, b) { return a <= b; }
function __ge_string(a, b) { return a >= b; }
function __lt_byte(a, b) { return a < b; }
function __gt_byte(a, b) { return a > b; }
function __le_byte(a, b) { return a <= b; }
function __ge_byte(a, b) { return a >= b; }
function __lt_rune(a, b) { return a < b; }
function __gt_rune(a, b) { return a > b; }
function __le_rune(a, b) { return a <= b; }
function __ge_rune(a, b) { return a >= b; }
function __band_int(a, b) { return a & b; }
function __bor_int(a, b) { return a | b; }
function __bxor_int(a, b) { return a ^ b; }
function __bshl_int(a, b) { return a << b; }
function __bshr_int(a, b) { return a >> b; }
function __bnot_int(a) { return ~a; }
function __show_int(a) { return String(a); }
function __show_float(a) { return string_of_float(a); }
function __show_bool(a) { return String(a); }
function __show_string(a) { return a; }
function __show_unit(_) { return "()"; }
function __show_byte(a) { return "#" + a.toString(16).padStart(2, "0"); }
function __show_rune(a) { return String.fromCodePoint(a); }
function __index_at_array(i, arr) { if (i < 0 || i >= arr.length) throw new Error("array index out of bounds: " + i + " (length " + arr.length + ")"); return arr[i]; }
function __index_at_string(i, s) { if (i < 0 || i >= s.length) throw new Error("string index out of bounds: " + i + " (length " + s.length + ")"); return s.charCodeAt(i); }
// --- Canvas builtins (browser only) ---
function Canvas$init(w, h) {
  if (typeof globalThis._canvasInit === "function") globalThis._canvasInit(w, h);
  return undefined;
}
function Canvas$clear(color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height); }
  return undefined;
}
function Canvas$fill_rect(x, y, w, h, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.fillRect(x, y, w, h); }
  return undefined;
}
function Canvas$stroke_rect(x, y, w, h, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.strokeStyle = color; ctx.lineWidth = 1; ctx.strokeRect(x, y, w, h); }
  return undefined;
}
function Canvas$fill_circle(x, y, r, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x, y, r, 0, 2*Math.PI); ctx.fill(); }
  return undefined;
}
function Canvas$draw_text(text, x, y, color) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.fillStyle = color; ctx.textBaseline = "top"; ctx.fillText(text, x, y); }
  return undefined;
}
function Canvas$set_font(font) {
  const ctx = globalThis._canvasCtx;
  if (ctx) { ctx.font = font; }
  return undefined;
}
function Canvas$mouse_x(_) { return globalThis._canvasMouseX || 0; }
function Canvas$mouse_y(_) { return globalThis._canvasMouseY || 0; }
function Canvas$mouse_down(_) { return !!globalThis._canvasMouseDown; }
function Canvas$mouse_clicked(_) { return !!globalThis._canvasMouseClicked; }
function Canvas$key_down(key) { return !!(globalThis._canvasKeysDown && globalThis._canvasKeysDown[key]); }
function Canvas$key_pressed(key) { return !!(globalThis._canvasKeysPressed && globalThis._canvasKeysPressed[key]); }
function Canvas$start_app(init_fn, frame_fn) {
  globalThis._canvasApp = { initFn: init_fn, frameFn: frame_fn, jsMode: true, call: _call };
  return undefined;
}
// --- Stdlib ---
if (typeof __num_add_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_add_int"]) var __num_add_int = globalThis._mmlExterns["__num_add_int"]; else throw new Error("extern " + "__num_add_int" + " not provided"); }
if (typeof __num_sub_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_sub_int"]) var __num_sub_int = globalThis._mmlExterns["__num_sub_int"]; else throw new Error("extern " + "__num_sub_int" + " not provided"); }
if (typeof __num_mul_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_mul_int"]) var __num_mul_int = globalThis._mmlExterns["__num_mul_int"]; else throw new Error("extern " + "__num_mul_int" + " not provided"); }
if (typeof __num_div_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_div_int"]) var __num_div_int = globalThis._mmlExterns["__num_div_int"]; else throw new Error("extern " + "__num_div_int" + " not provided"); }
if (typeof __num_neg_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_neg_int"]) var __num_neg_int = globalThis._mmlExterns["__num_neg_int"]; else throw new Error("extern " + "__num_neg_int" + " not provided"); }
if (typeof __num_add_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_add_float"]) var __num_add_float = globalThis._mmlExterns["__num_add_float"]; else throw new Error("extern " + "__num_add_float" + " not provided"); }
if (typeof __num_sub_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_sub_float"]) var __num_sub_float = globalThis._mmlExterns["__num_sub_float"]; else throw new Error("extern " + "__num_sub_float" + " not provided"); }
if (typeof __num_mul_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_mul_float"]) var __num_mul_float = globalThis._mmlExterns["__num_mul_float"]; else throw new Error("extern " + "__num_mul_float" + " not provided"); }
if (typeof __num_div_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_div_float"]) var __num_div_float = globalThis._mmlExterns["__num_div_float"]; else throw new Error("extern " + "__num_div_float" + " not provided"); }
if (typeof __num_neg_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__num_neg_float"]) var __num_neg_float = globalThis._mmlExterns["__num_neg_float"]; else throw new Error("extern " + "__num_neg_float" + " not provided"); }
if (typeof __eq_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_int"]) var __eq_int = globalThis._mmlExterns["__eq_int"]; else throw new Error("extern " + "__eq_int" + " not provided"); }
if (typeof __neq_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_int"]) var __neq_int = globalThis._mmlExterns["__neq_int"]; else throw new Error("extern " + "__neq_int" + " not provided"); }
if (typeof __eq_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_float"]) var __eq_float = globalThis._mmlExterns["__eq_float"]; else throw new Error("extern " + "__eq_float" + " not provided"); }
if (typeof __neq_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_float"]) var __neq_float = globalThis._mmlExterns["__neq_float"]; else throw new Error("extern " + "__neq_float" + " not provided"); }
if (typeof __eq_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_string"]) var __eq_string = globalThis._mmlExterns["__eq_string"]; else throw new Error("extern " + "__eq_string" + " not provided"); }
if (typeof __neq_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_string"]) var __neq_string = globalThis._mmlExterns["__neq_string"]; else throw new Error("extern " + "__neq_string" + " not provided"); }
if (typeof __eq_bool === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_bool"]) var __eq_bool = globalThis._mmlExterns["__eq_bool"]; else throw new Error("extern " + "__eq_bool" + " not provided"); }
if (typeof __neq_bool === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_bool"]) var __neq_bool = globalThis._mmlExterns["__neq_bool"]; else throw new Error("extern " + "__neq_bool" + " not provided"); }
if (typeof __eq_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_byte"]) var __eq_byte = globalThis._mmlExterns["__eq_byte"]; else throw new Error("extern " + "__eq_byte" + " not provided"); }
if (typeof __neq_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_byte"]) var __neq_byte = globalThis._mmlExterns["__neq_byte"]; else throw new Error("extern " + "__neq_byte" + " not provided"); }
if (typeof __eq_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__eq_rune"]) var __eq_rune = globalThis._mmlExterns["__eq_rune"]; else throw new Error("extern " + "__eq_rune" + " not provided"); }
if (typeof __neq_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__neq_rune"]) var __neq_rune = globalThis._mmlExterns["__neq_rune"]; else throw new Error("extern " + "__neq_rune" + " not provided"); }
if (typeof __lt_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_int"]) var __lt_int = globalThis._mmlExterns["__lt_int"]; else throw new Error("extern " + "__lt_int" + " not provided"); }
if (typeof __gt_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_int"]) var __gt_int = globalThis._mmlExterns["__gt_int"]; else throw new Error("extern " + "__gt_int" + " not provided"); }
if (typeof __le_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_int"]) var __le_int = globalThis._mmlExterns["__le_int"]; else throw new Error("extern " + "__le_int" + " not provided"); }
if (typeof __ge_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_int"]) var __ge_int = globalThis._mmlExterns["__ge_int"]; else throw new Error("extern " + "__ge_int" + " not provided"); }
if (typeof __lt_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_float"]) var __lt_float = globalThis._mmlExterns["__lt_float"]; else throw new Error("extern " + "__lt_float" + " not provided"); }
if (typeof __gt_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_float"]) var __gt_float = globalThis._mmlExterns["__gt_float"]; else throw new Error("extern " + "__gt_float" + " not provided"); }
if (typeof __le_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_float"]) var __le_float = globalThis._mmlExterns["__le_float"]; else throw new Error("extern " + "__le_float" + " not provided"); }
if (typeof __ge_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_float"]) var __ge_float = globalThis._mmlExterns["__ge_float"]; else throw new Error("extern " + "__ge_float" + " not provided"); }
if (typeof __lt_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_string"]) var __lt_string = globalThis._mmlExterns["__lt_string"]; else throw new Error("extern " + "__lt_string" + " not provided"); }
if (typeof __gt_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_string"]) var __gt_string = globalThis._mmlExterns["__gt_string"]; else throw new Error("extern " + "__gt_string" + " not provided"); }
if (typeof __le_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_string"]) var __le_string = globalThis._mmlExterns["__le_string"]; else throw new Error("extern " + "__le_string" + " not provided"); }
if (typeof __ge_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_string"]) var __ge_string = globalThis._mmlExterns["__ge_string"]; else throw new Error("extern " + "__ge_string" + " not provided"); }
if (typeof __lt_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_byte"]) var __lt_byte = globalThis._mmlExterns["__lt_byte"]; else throw new Error("extern " + "__lt_byte" + " not provided"); }
if (typeof __gt_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_byte"]) var __gt_byte = globalThis._mmlExterns["__gt_byte"]; else throw new Error("extern " + "__gt_byte" + " not provided"); }
if (typeof __le_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_byte"]) var __le_byte = globalThis._mmlExterns["__le_byte"]; else throw new Error("extern " + "__le_byte" + " not provided"); }
if (typeof __ge_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_byte"]) var __ge_byte = globalThis._mmlExterns["__ge_byte"]; else throw new Error("extern " + "__ge_byte" + " not provided"); }
if (typeof __lt_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__lt_rune"]) var __lt_rune = globalThis._mmlExterns["__lt_rune"]; else throw new Error("extern " + "__lt_rune" + " not provided"); }
if (typeof __gt_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__gt_rune"]) var __gt_rune = globalThis._mmlExterns["__gt_rune"]; else throw new Error("extern " + "__gt_rune" + " not provided"); }
if (typeof __le_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__le_rune"]) var __le_rune = globalThis._mmlExterns["__le_rune"]; else throw new Error("extern " + "__le_rune" + " not provided"); }
if (typeof __ge_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__ge_rune"]) var __ge_rune = globalThis._mmlExterns["__ge_rune"]; else throw new Error("extern " + "__ge_rune" + " not provided"); }
if (typeof __band_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__band_int"]) var __band_int = globalThis._mmlExterns["__band_int"]; else throw new Error("extern " + "__band_int" + " not provided"); }
if (typeof __bor_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bor_int"]) var __bor_int = globalThis._mmlExterns["__bor_int"]; else throw new Error("extern " + "__bor_int" + " not provided"); }
if (typeof __bxor_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bxor_int"]) var __bxor_int = globalThis._mmlExterns["__bxor_int"]; else throw new Error("extern " + "__bxor_int" + " not provided"); }
if (typeof __bshl_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bshl_int"]) var __bshl_int = globalThis._mmlExterns["__bshl_int"]; else throw new Error("extern " + "__bshl_int" + " not provided"); }
if (typeof __bshr_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bshr_int"]) var __bshr_int = globalThis._mmlExterns["__bshr_int"]; else throw new Error("extern " + "__bshr_int" + " not provided"); }
if (typeof __bnot_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__bnot_int"]) var __bnot_int = globalThis._mmlExterns["__bnot_int"]; else throw new Error("extern " + "__bnot_int" + " not provided"); }
if (typeof __show_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_int"]) var __show_int = globalThis._mmlExterns["__show_int"]; else throw new Error("extern " + "__show_int" + " not provided"); }
if (typeof __show_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_float"]) var __show_float = globalThis._mmlExterns["__show_float"]; else throw new Error("extern " + "__show_float" + " not provided"); }
if (typeof __show_bool === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_bool"]) var __show_bool = globalThis._mmlExterns["__show_bool"]; else throw new Error("extern " + "__show_bool" + " not provided"); }
if (typeof __show_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_string"]) var __show_string = globalThis._mmlExterns["__show_string"]; else throw new Error("extern " + "__show_string" + " not provided"); }
if (typeof __show_unit === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_unit"]) var __show_unit = globalThis._mmlExterns["__show_unit"]; else throw new Error("extern " + "__show_unit" + " not provided"); }
if (typeof __show_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_byte"]) var __show_byte = globalThis._mmlExterns["__show_byte"]; else throw new Error("extern " + "__show_byte" + " not provided"); }
if (typeof __show_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__show_rune"]) var __show_rune = globalThis._mmlExterns["__show_rune"]; else throw new Error("extern " + "__show_rune" + " not provided"); }
if (typeof __index_at_array === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__index_at_array"]) var __index_at_array = globalThis._mmlExterns["__index_at_array"]; else throw new Error("extern " + "__index_at_array" + " not provided"); }
if (typeof __index_at_string === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["__index_at_string"]) var __index_at_string = globalThis._mmlExterns["__index_at_string"]; else throw new Error("extern " + "__index_at_string" + " not provided"); }
const __dict_Num_int = ({$star: __num_mul_int, $plus: __num_add_int, $minus: __num_sub_int, $slash: __num_div_int, neg: __num_neg_int});
const __dict_Num_float = ({$star: __num_mul_float, $plus: __num_add_float, $minus: __num_sub_float, $slash: __num_div_float, neg: __num_neg_float});
const __dict_Eq_int = ({$lt$gt: __neq_int, $eq: __eq_int});
const __dict_Eq_float = ({$lt$gt: __neq_float, $eq: __eq_float});
const __dict_Eq_string = ({$lt$gt: __neq_string, $eq: __eq_string});
const __dict_Eq_bool = ({$lt$gt: __neq_bool, $eq: __eq_bool});
const __dict_Eq_byte = ({$lt$gt: __neq_byte, $eq: __eq_byte});
const __dict_Eq_rune = ({$lt$gt: __neq_rune, $eq: __eq_rune});
const __dict_Ord_int = ({$lt: __lt_int, $lt$eq: __le_int, $gt: __gt_int, $gt$eq: __ge_int});
const __dict_Ord_float = ({$lt: __lt_float, $lt$eq: __le_float, $gt: __gt_float, $gt$eq: __ge_float});
const __dict_Ord_string = ({$lt: __lt_string, $lt$eq: __le_string, $gt: __gt_string, $gt$eq: __ge_string});
const __dict_Ord_byte = ({$lt: __lt_byte, $lt$eq: __le_byte, $gt: __gt_byte, $gt$eq: __ge_byte});
const __dict_Ord_rune = ({$lt: __lt_rune, $lt$eq: __le_rune, $gt: __gt_rune, $gt$eq: __ge_rune});
const __dict_Bitwise_int = ({land: __band_int, lnot: __bnot_int, lor: __bor_int, lsl: __bshl_int, lsr: __bshr_int, lxor: __bxor_int});
const __dict_Show_int = ({show: __show_int});
const __dict_Show_float = ({show: __show_float});
const __dict_Show_bool = ({show: __show_bool});
const __dict_Show_string = ({show: __show_string});
const __dict_Show_unit = ({show: __show_unit});
const __dict_Show_byte = ({show: __show_byte});
const __dict_Show_rune = ({show: __show_rune});
const __dict_Index_g0_array__int__g0 = ({at: __index_at_array});
const __dict_Index_string__int__byte = ({at: __index_at_string});
function _t0(f, acc, xs) {
  function go(a, l) {
    while (true) {
      let _t2;
      const _t1 = l;
      _t3: {
        if (_t1 === null) {
          _t2 = a;
          break _t3;
        }
        if (_t1 !== null) {
          const x = _t1._hd;
          const rest = _t1._tl;
          const _t4 = f(a, x);
          const _t5 = rest;
          a = _t4;
          l = _t5;
          continue;
          _t2 = undefined;
          break _t3;
        }
        _match_fail("line 14");
      }
      return _t2;
    }
  }
  const _t6 = go(acc, xs);
  return _t6;
}
const __dict_Iter_g0_list__g0 = ({fold: _t0});
function _t7(f, acc, arr) {
  function go(a, i) {
    while (true) {
      let _t8;
      if ((i === array_length(arr))) {
        _t8 = a;
      } else {
        const _t9 = f(a, array_get(arr, i));
        const _t10 = (i + 1);
        a = _t9;
        i = _t10;
        continue;
        _t8 = undefined;
      }
      return _t8;
    }
  }
  const _t11 = go(acc, 0);
  return _t11;
}
const __dict_Iter_g0_array__g0 = ({fold: _t7});
function __dict_Show_g0_list(__dict_Show_0) {
  function _t12(xs) {
    let _t14;
    const _t13 = xs;
    _t15: {
      if (_t13 === null) {
        _t14 = "[]";
        break _t15;
      }
      if (true) {
        function _t16(acc, x) {
          let _t17;
          if ((acc === "")) {
            _t17 = __dict_Show_0.show(x);
          } else {
            _t17 = ((acc + "; ") + __dict_Show_0.show(x));
          }
          return _t17;
        }
        _t14 = (("[" + __dict_Iter_g0_list__g0.fold(_t16, "", xs)) + "]");
        break _t15;
      }
      _match_fail("line 32");
    }
    return _t14;
  }
  return ({show: _t12});
}
function __dict_Show_g0_array(__dict_Show_0) {
  function _t18(arr) {
    let _t19;
    if ((array_length(arr) === 0)) {
      _t19 = "#[]";
    } else {
      function _t20(acc, x) {
        let _t21;
        if ((acc === "")) {
          _t21 = __dict_Show_0.show(x);
        } else {
          _t21 = ((acc + "; ") + __dict_Show_0.show(x));
        }
        return _t21;
      }
      _t19 = (("#[" + __dict_Iter_g0_array__g0.fold(_t20, "", arr)) + "]");
    }
    return _t19;
  }
  return ({show: _t18});
}
function __dict_Show_g0_option(__dict_Show_0) {
  function _t22(opt) {
    let _t24;
    const _t23 = opt;
    _t25: {
      if (_t23._tag === 0) {
        _t24 = "None";
        break _t25;
      }
      if (_t23._tag === 1) {
        const x = _t23._val;
        _t24 = ("Some " + __dict_Show_0.show(x));
        break _t25;
      }
      _match_fail("line 32");
    }
    return _t24;
  }
  return ({show: _t22});
}
function __dict_Show_g0_g1_tup(__dict_Show_0, __dict_Show_1) {
  function _t26(p) {
    let _t28;
    const _t27 = p;
    _t29: {
      if (true) {
        const a = _t27[0];
        const b = _t27[1];
        _t28 = (((("(" + __dict_Show_0.show(a)) + ", ") + __dict_Show_1.show(b)) + ")");
        break _t29;
      }
      _match_fail("line 32");
    }
    return _t28;
  }
  return ({show: _t26});
}
function __dict_Show_g0_g1_g2_tup(__dict_Show_0, __dict_Show_1, __dict_Show_2) {
  function _t30(p) {
    let _t32;
    const _t31 = p;
    _t33: {
      if (true) {
        const a = _t31[0];
        const b = _t31[1];
        const c = _t31[2];
        _t32 = (((((("(" + __dict_Show_0.show(a)) + ", ") + __dict_Show_1.show(b)) + ", ") + __dict_Show_2.show(c)) + ")");
        break _t33;
      }
      _match_fail("line 32");
    }
    return _t32;
  }
  return ({show: _t30});
}
if (typeof String$length === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.length"]) var String$length = globalThis._mmlExterns["String.length"]; else throw new Error("extern " + "String.length" + " not provided"); }
if (typeof String$sub === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.sub"]) var String$sub = globalThis._mmlExterns["String.sub"]; else throw new Error("extern " + "String.sub" + " not provided"); }
if (typeof String$split === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.split"]) var String$split = globalThis._mmlExterns["String.split"]; else throw new Error("extern " + "String.split" + " not provided"); }
if (typeof String$trim === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.trim"]) var String$trim = globalThis._mmlExterns["String.trim"]; else throw new Error("extern " + "String.trim" + " not provided"); }
if (typeof String$starts_with === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.starts_with"]) var String$starts_with = globalThis._mmlExterns["String.starts_with"]; else throw new Error("extern " + "String.starts_with" + " not provided"); }
if (typeof String$contains === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.contains"]) var String$contains = globalThis._mmlExterns["String.contains"]; else throw new Error("extern " + "String.contains" + " not provided"); }
if (typeof String$replace === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.replace"]) var String$replace = globalThis._mmlExterns["String.replace"]; else throw new Error("extern " + "String.replace" + " not provided"); }
if (typeof String$to_int === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_int"]) var String$to_int = globalThis._mmlExterns["String.to_int"]; else throw new Error("extern " + "String.to_int" + " not provided"); }
if (typeof String$to_float === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_float"]) var String$to_float = globalThis._mmlExterns["String.to_float"]; else throw new Error("extern " + "String.to_float" + " not provided"); }
if (typeof String$uppercase === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.uppercase"]) var String$uppercase = globalThis._mmlExterns["String.uppercase"]; else throw new Error("extern " + "String.uppercase" + " not provided"); }
if (typeof String$lowercase === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.lowercase"]) var String$lowercase = globalThis._mmlExterns["String.lowercase"]; else throw new Error("extern " + "String.lowercase" + " not provided"); }
if (typeof String$get === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.get"]) var String$get = globalThis._mmlExterns["String.get"]; else throw new Error("extern " + "String.get" + " not provided"); }
if (typeof String$to_bytes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_bytes"]) var String$to_bytes = globalThis._mmlExterns["String.to_bytes"]; else throw new Error("extern " + "String.to_bytes" + " not provided"); }
if (typeof String$of_bytes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_bytes"]) var String$of_bytes = globalThis._mmlExterns["String.of_bytes"]; else throw new Error("extern " + "String.of_bytes" + " not provided"); }
if (typeof String$to_byte_array === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_byte_array"]) var String$to_byte_array = globalThis._mmlExterns["String.to_byte_array"]; else throw new Error("extern " + "String.to_byte_array" + " not provided"); }
if (typeof String$of_byte_array === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_byte_array"]) var String$of_byte_array = globalThis._mmlExterns["String.of_byte_array"]; else throw new Error("extern " + "String.of_byte_array" + " not provided"); }
if (typeof String$to_runes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.to_runes"]) var String$to_runes = globalThis._mmlExterns["String.to_runes"]; else throw new Error("extern " + "String.to_runes" + " not provided"); }
if (typeof String$of_runes === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_runes"]) var String$of_runes = globalThis._mmlExterns["String.of_runes"]; else throw new Error("extern " + "String.of_runes" + " not provided"); }
if (typeof String$get_rune === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.get_rune"]) var String$get_rune = globalThis._mmlExterns["String.get_rune"]; else throw new Error("extern " + "String.get_rune" + " not provided"); }
if (typeof String$of_byte === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.of_byte"]) var String$of_byte = globalThis._mmlExterns["String.of_byte"]; else throw new Error("extern " + "String.of_byte" + " not provided"); }
if (typeof String$rune_length === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.rune_length"]) var String$rune_length = globalThis._mmlExterns["String.rune_length"]; else throw new Error("extern " + "String.rune_length" + " not provided"); }
if (typeof String$make === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.make"]) var String$make = globalThis._mmlExterns["String.make"]; else throw new Error("extern " + "String.make" + " not provided"); }
if (typeof String$index_opt === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.index_opt"]) var String$index_opt = globalThis._mmlExterns["String.index_opt"]; else throw new Error("extern " + "String.index_opt" + " not provided"); }
if (typeof String$rindex_opt === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.rindex_opt"]) var String$rindex_opt = globalThis._mmlExterns["String.rindex_opt"]; else throw new Error("extern " + "String.rindex_opt" + " not provided"); }
if (typeof String$concat === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.concat"]) var String$concat = globalThis._mmlExterns["String.concat"]; else throw new Error("extern " + "String.concat" + " not provided"); }
if (typeof String$compare === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["String.compare"]) var String$compare = globalThis._mmlExterns["String.compare"]; else throw new Error("extern " + "String.compare" + " not provided"); }
function String$iter(f, s) {
  const n_34 = String$length(s);
  function go(i) {
    while (true) {
      let _t36;
      if ((i >= n_34)) {
        _t36 = undefined;
      } else {
        f(String$get(s, i));
        const _t37 = (i + 1);
        i = _t37;
        continue;
        _t36 = undefined;
      }
      return _t36;
    }
  }
  const _t38 = go(0);
  const _t35 = _t38;
  return _t35;
}
function List$fold(f, acc, xs) {
  function go(a, l) {
    while (true) {
      let _t40;
      const _t39 = l;
      _t41: {
        if (_t39 === null) {
          _t40 = a;
          break _t41;
        }
        if (_t39 !== null) {
          const x = _t39._hd;
          const rest = _t39._tl;
          const _t42 = f(a, x);
          const _t43 = rest;
          a = _t42;
          l = _t43;
          continue;
          _t40 = undefined;
          break _t41;
        }
        _match_fail("line 259");
      }
      return _t40;
    }
  }
  const _t44 = go(acc, xs);
  return _t44;
}
function List$length(xs) {
  function _t45(acc, _) {
    return (acc + 1);
  }
  return List$fold(_t45, 0, xs);
}
function List$rev(xs) {
  function _t46(acc, x) {
    return ({_hd: x, _tl: acc});
  }
  return List$fold(_t46, null, xs);
}
function List$hd(xs) {
  let _t48;
  const _t47 = xs;
  _t49: {
    if (_t47 !== null) {
      const x = _t47._hd;
      _t48 = x;
      break _t49;
    }
    _match_fail("line 259");
  }
  return _t48;
}
function List$tl(xs) {
  let _t51;
  const _t50 = xs;
  _t52: {
    if (_t50 !== null) {
      const rest = _t50._tl;
      _t51 = rest;
      break _t52;
    }
    _match_fail("line 259");
  }
  return _t51;
}
function List$nth(xs, n) {
  function go(l, i) {
    while (true) {
      let _t54;
      const _t53 = l;
      _t55: {
        if (_t53 !== null) {
          const x = _t53._hd;
          const rest = _t53._tl;
          let _t56;
          if ((i === 0)) {
            _t56 = x;
          } else {
            const _t57 = rest;
            const _t58 = (i - 1);
            l = _t57;
            i = _t58;
            continue;
            _t56 = undefined;
          }
          _t54 = _t56;
          break _t55;
        }
        _match_fail("line 259");
      }
      return _t54;
    }
  }
  const _t59 = go(xs, n);
  return _t59;
}
function List$concat(a, b) {
  function _t60(acc, x) {
    return ({_hd: x, _tl: acc});
  }
  return List$fold(_t60, b, List$rev(a));
}
function List$is_empty(xs) {
  let _t62;
  const _t61 = xs;
  _t63: {
    if (_t61 === null) {
      _t62 = true;
      break _t63;
    }
    if (true) {
      _t62 = false;
      break _t63;
    }
    _match_fail("line 259");
  }
  return _t62;
}
function List$flatten(xss) {
  function _t64(acc, xs) {
    return List$concat(acc, xs);
  }
  return List$fold(_t64, null, xss);
}
function List$map(f, xs) {
  function go(acc, l) {
    while (true) {
      let _t66;
      const _t65 = l;
      _t67: {
        if (_t65 === null) {
          _t66 = List$rev(acc);
          break _t67;
        }
        if (_t65 !== null) {
          const x = _t65._hd;
          const rest = _t65._tl;
          const _t68 = ({_hd: f(x), _tl: acc});
          const _t69 = rest;
          acc = _t68;
          l = _t69;
          continue;
          _t66 = undefined;
          break _t67;
        }
        _match_fail("line 259");
      }
      return _t66;
    }
  }
  const _t70 = go(null, xs);
  return _t70;
}
function List$filter(f, xs) {
  function go(acc, l) {
    while (true) {
      let _t72;
      const _t71 = l;
      _t73: {
        if (_t71 === null) {
          _t72 = List$rev(acc);
          break _t73;
        }
        if (_t71 !== null) {
          const x = _t71._hd;
          const rest = _t71._tl;
          let _t74;
          if (f(x)) {
            const _t75 = ({_hd: x, _tl: acc});
            const _t76 = rest;
            acc = _t75;
            l = _t76;
            continue;
            _t74 = undefined;
          } else {
            const _t77 = acc;
            const _t78 = rest;
            acc = _t77;
            l = _t78;
            continue;
            _t74 = undefined;
          }
          _t72 = _t74;
          break _t73;
        }
        _match_fail("line 259");
      }
      return _t72;
    }
  }
  const _t79 = go(null, xs);
  return _t79;
}
function List$find(f, xs) {
  function go(l) {
    while (true) {
      let _t81;
      const _t80 = l;
      _t82: {
        if (_t80 === null) {
          _t81 = ({_tag: 0, _name: "None"});
          break _t82;
        }
        if (_t80 !== null) {
          const x = _t80._hd;
          const rest = _t80._tl;
          let _t83;
          if (f(x)) {
            _t83 = ({_tag: 1, _name: "Some", _val: x});
          } else {
            const _t84 = rest;
            l = _t84;
            continue;
            _t83 = undefined;
          }
          _t81 = _t83;
          break _t82;
        }
        _match_fail("line 259");
      }
      return _t81;
    }
  }
  const _t85 = go(xs);
  return _t85;
}
function List$exists(f, xs) {
  function go(l) {
    while (true) {
      let _t87;
      const _t86 = l;
      _t88: {
        if (_t86 === null) {
          _t87 = false;
          break _t88;
        }
        if (_t86 !== null) {
          const x = _t86._hd;
          const rest = _t86._tl;
          let _t89;
          if (f(x)) {
            _t89 = true;
          } else {
            const _t90 = rest;
            l = _t90;
            continue;
            _t89 = undefined;
          }
          _t87 = _t89;
          break _t88;
        }
        _match_fail("line 259");
      }
      return _t87;
    }
  }
  const _t91 = go(xs);
  return _t91;
}
function List$forall(f, xs) {
  function go(l) {
    while (true) {
      let _t93;
      const _t92 = l;
      _t94: {
        if (_t92 === null) {
          _t93 = true;
          break _t94;
        }
        if (_t92 !== null) {
          const x = _t92._hd;
          const rest = _t92._tl;
          let _t95;
          if (f(x)) {
            const _t96 = rest;
            l = _t96;
            continue;
            _t95 = undefined;
          } else {
            _t95 = false;
          }
          _t93 = _t95;
          break _t94;
        }
        _match_fail("line 259");
      }
      return _t93;
    }
  }
  const _t97 = go(xs);
  return _t97;
}
function List$zip(xs, ys) {
  function go(acc, a, b) {
    while (true) {
      let _t99;
      const _t98 = a;
      _t100: {
        if (_t98 === null) {
          _t99 = List$rev(acc);
          break _t100;
        }
        if (_t98 !== null) {
          const x = _t98._hd;
          const ra = _t98._tl;
          let _t102;
          const _t101 = b;
          _t103: {
            if (_t101 !== null) {
              const y = _t101._hd;
              const rb = _t101._tl;
              const _t104 = ({_hd: [x, y], _tl: acc});
              const _t105 = ra;
              const _t106 = rb;
              acc = _t104;
              a = _t105;
              b = _t106;
              continue;
              _t102 = undefined;
              break _t103;
            }
            _match_fail("line 259");
          }
          _t99 = _t102;
          break _t100;
        }
        _match_fail("line 259");
      }
      return _t99;
    }
  }
  const _t107 = go(null, xs, ys);
  return _t107;
}
function List$mapi(f, xs) {
  function go(i, acc, l) {
    while (true) {
      let _t109;
      const _t108 = l;
      _t110: {
        if (_t108 === null) {
          _t109 = List$rev(acc);
          break _t110;
        }
        if (_t108 !== null) {
          const x = _t108._hd;
          const rest = _t108._tl;
          const _t111 = (i + 1);
          const _t112 = ({_hd: f(i, x), _tl: acc});
          const _t113 = rest;
          i = _t111;
          acc = _t112;
          l = _t113;
          continue;
          _t109 = undefined;
          break _t110;
        }
        _match_fail("line 259");
      }
      return _t109;
    }
  }
  const _t114 = go(0, null, xs);
  return _t114;
}
function List$sort(cmp, xs) {
  function insert(x, sorted) {
    let _t116;
    const _t115 = sorted;
    _t117: {
      if (_t115 === null) {
        _t116 = ({_hd: x, _tl: null});
        break _t117;
      }
      if (_t115 !== null) {
        const y = _t115._hd;
        const rest = _t115._tl;
        let _t118;
        if ((cmp(x, y) < 1)) {
          _t118 = ({_hd: x, _tl: sorted});
        } else {
          _t118 = ({_hd: y, _tl: insert(x, rest)});
        }
        _t116 = _t118;
        break _t117;
      }
      _match_fail("line 259");
    }
    return _t116;
  }
  function _t120(acc, x) {
    return insert(x, acc);
  }
  const _t119 = List$fold(_t120, null, xs);
  return _t119;
}
function List$fold_right(f, xs, acc) {
  function go(l) {
    let _t122;
    const _t121 = l;
    _t123: {
      if (_t121 === null) {
        _t122 = acc;
        break _t123;
      }
      if (_t121 !== null) {
        const x = _t121._hd;
        const rest = _t121._tl;
        _t122 = f(x, go(rest));
        break _t123;
      }
      _match_fail("line 259");
    }
    return _t122;
  }
  const _t124 = go(xs);
  return _t124;
}
function List$find_map(f, xs) {
  function go(l) {
    while (true) {
      let _t126;
      const _t125 = l;
      _t127: {
        if (_t125 === null) {
          _t126 = ({_tag: 0, _name: "None"});
          break _t127;
        }
        if (_t125 !== null) {
          const x = _t125._hd;
          const rest = _t125._tl;
          let _t129;
          const _t128 = f(x);
          _t130: {
            if (_t128._tag === 1) {
              const result = _t128;
              _t129 = result;
              break _t130;
            }
            if (_t128._tag === 0) {
              const _t131 = rest;
              l = _t131;
              continue;
              _t129 = undefined;
              break _t130;
            }
            _match_fail("line 259");
          }
          _t126 = _t129;
          break _t127;
        }
        _match_fail("line 259");
      }
      return _t126;
    }
  }
  const _t132 = go(xs);
  return _t132;
}
function List$assoc_opt(key, xs) {
  function go(l) {
    while (true) {
      let _t134;
      const _t133 = l;
      _t135: {
        if (_t133 === null) {
          _t134 = ({_tag: 0, _name: "None"});
          break _t135;
        }
        if (_t133 !== null) {
          const k = _t133._hd[0];
          const v = _t133._hd[1];
          const rest = _t133._tl;
          let _t136;
          if (_eq(k, key)) {
            _t136 = ({_tag: 1, _name: "Some", _val: v});
          } else {
            const _t137 = rest;
            l = _t137;
            continue;
            _t136 = undefined;
          }
          _t134 = _t136;
          break _t135;
        }
        _match_fail("line 259");
      }
      return _t134;
    }
  }
  const _t138 = go(xs);
  return _t138;
}
function List$init(n, f) {
  function go(i, acc) {
    while (true) {
      let _t139;
      if ((i < 0)) {
        _t139 = acc;
      } else {
        const _t140 = (i - 1);
        const _t141 = ({_hd: f(i), _tl: acc});
        i = _t140;
        acc = _t141;
        continue;
        _t139 = undefined;
      }
      return _t139;
    }
  }
  const _t142 = go((n - 1), null);
  return _t142;
}
function List$concat_map(f, xs) {
  return List$flatten(List$map(f, xs));
}
function List$iter2(f, xs, ys) {
  function go(a, b) {
    while (true) {
      let _t144;
      const _t143 = a;
      _t145: {
        if (_t143 === null) {
          _t144 = undefined;
          break _t145;
        }
        if (_t143 !== null) {
          const x = _t143._hd;
          const ra = _t143._tl;
          let _t147;
          const _t146 = b;
          _t148: {
            if (_t146 !== null) {
              const y = _t146._hd;
              const rb = _t146._tl;
              f(x, y);
              const _t149 = ra;
              const _t150 = rb;
              a = _t149;
              b = _t150;
              continue;
              _t147 = undefined;
              break _t148;
            }
            _match_fail("line 259");
          }
          _t144 = _t147;
          break _t145;
        }
        _match_fail("line 259");
      }
      return _t144;
    }
  }
  const _t151 = go(xs, ys);
  return _t151;
}
function List$map2(f, xs, ys) {
  function go(acc, a, b) {
    while (true) {
      let _t153;
      const _t152 = a;
      _t154: {
        if (_t152 === null) {
          _t153 = List$rev(acc);
          break _t154;
        }
        if (_t152 !== null) {
          const x = _t152._hd;
          const ra = _t152._tl;
          let _t156;
          const _t155 = b;
          _t157: {
            if (_t155 !== null) {
              const y = _t155._hd;
              const rb = _t155._tl;
              const _t158 = ({_hd: f(x, y), _tl: acc});
              const _t159 = ra;
              const _t160 = rb;
              acc = _t158;
              a = _t159;
              b = _t160;
              continue;
              _t156 = undefined;
              break _t157;
            }
            _match_fail("line 259");
          }
          _t153 = _t156;
          break _t154;
        }
        _match_fail("line 259");
      }
      return _t153;
    }
  }
  const _t161 = go(null, xs, ys);
  return _t161;
}
function List$fold2(f, acc, xs, ys) {
  function go(a, l1, l2) {
    while (true) {
      let _t163;
      const _t162 = l1;
      _t164: {
        if (_t162 === null) {
          _t163 = a;
          break _t164;
        }
        if (_t162 !== null) {
          const x = _t162._hd;
          const r1 = _t162._tl;
          let _t166;
          const _t165 = l2;
          _t167: {
            if (_t165 !== null) {
              const y = _t165._hd;
              const r2 = _t165._tl;
              const _t168 = f(a, x, y);
              const _t169 = r1;
              const _t170 = r2;
              a = _t168;
              l1 = _t169;
              l2 = _t170;
              continue;
              _t166 = undefined;
              break _t167;
            }
            _match_fail("line 259");
          }
          _t163 = _t166;
          break _t164;
        }
        _match_fail("line 259");
      }
      return _t163;
    }
  }
  const _t171 = go(acc, xs, ys);
  return _t171;
}
function List$forall2(f, xs, ys) {
  function go(a, b) {
    while (true) {
      let _t173;
      const _t172 = a;
      _t174: {
        if (_t172 === null) {
          _t173 = true;
          break _t174;
        }
        if (_t172 !== null) {
          const x = _t172._hd;
          const ra = _t172._tl;
          let _t176;
          const _t175 = b;
          _t177: {
            if (_t175 !== null) {
              const y = _t175._hd;
              const rb = _t175._tl;
              let _t178;
              if (f(x, y)) {
                const _t179 = ra;
                const _t180 = rb;
                a = _t179;
                b = _t180;
                continue;
                _t178 = undefined;
              } else {
                _t178 = false;
              }
              _t176 = _t178;
              break _t177;
            }
            _match_fail("line 259");
          }
          _t173 = _t176;
          break _t174;
        }
        _match_fail("line 259");
      }
      return _t173;
    }
  }
  const _t181 = go(xs, ys);
  return _t181;
}
function List$iteri(f, xs) {
  function go(i, l) {
    while (true) {
      let _t183;
      const _t182 = l;
      _t184: {
        if (_t182 === null) {
          _t183 = undefined;
          break _t184;
        }
        if (_t182 !== null) {
          const x = _t182._hd;
          const rest = _t182._tl;
          f(i, x);
          const _t185 = (i + 1);
          const _t186 = rest;
          i = _t185;
          l = _t186;
          continue;
          _t183 = undefined;
          break _t184;
        }
        _match_fail("line 259");
      }
      return _t183;
    }
  }
  const _t187 = go(0, xs);
  return _t187;
}
function List$mem_assoc(key, xs) {
  function go(l) {
    while (true) {
      let _t189;
      const _t188 = l;
      _t190: {
        if (_t188 === null) {
          _t189 = false;
          break _t190;
        }
        if (_t188 !== null) {
          const k = _t188._hd[0];
          const rest = _t188._tl;
          let _t191;
          if (_eq(k, key)) {
            _t191 = true;
          } else {
            const _t192 = rest;
            l = _t192;
            continue;
            _t191 = undefined;
          }
          _t189 = _t191;
          break _t190;
        }
        _match_fail("line 259");
      }
      return _t189;
    }
  }
  const _t193 = go(xs);
  return _t193;
}
function List$assoc(key, xs) {
  let _t195;
  const _t194 = List$assoc_opt(key, xs);
  _t196: {
    if (_t194._tag === 1) {
      const v = _t194._val;
      _t195 = v;
      break _t196;
    }
    if (_t194._tag === 0) {
      _t195 = failwith("List.assoc: not found");
      break _t196;
    }
    _match_fail("line 259");
  }
  return _t195;
}
function List$iter(f, xs) {
  function go(xs) {
    while (true) {
      let _t198;
      const _t197 = xs;
      _t199: {
        if (_t197 === null) {
          _t198 = undefined;
          break _t199;
        }
        if (_t197 !== null) {
          const x = _t197._hd;
          const rest = _t197._tl;
          f(x);
          const _t200 = rest;
          xs = _t200;
          continue;
          _t198 = undefined;
          break _t199;
        }
        _match_fail("line 259");
      }
      return _t198;
    }
  }
  const _t201 = go(xs);
  return _t201;
}
function List$mem(x, xs) {
  function go(xs) {
    while (true) {
      let _t203;
      const _t202 = xs;
      _t204: {
        if (_t202 === null) {
          _t203 = false;
          break _t204;
        }
        if (_t202 !== null) {
          const y = _t202._hd;
          const rest = _t202._tl;
          let _t205;
          if (_eq(x, y)) {
            _t205 = true;
          } else {
            const _t206 = rest;
            xs = _t206;
            continue;
            _t205 = undefined;
          }
          _t203 = _t205;
          break _t204;
        }
        _match_fail("line 259");
      }
      return _t203;
    }
  }
  const _t207 = go(xs);
  return _t207;
}
function List$rev_append(xs, ys) {
  function go(xs, acc) {
    while (true) {
      let _t209;
      const _t208 = xs;
      _t210: {
        if (_t208 === null) {
          _t209 = acc;
          break _t210;
        }
        if (_t208 !== null) {
          const x = _t208._hd;
          const rest = _t208._tl;
          const _t211 = rest;
          const _t212 = ({_hd: x, _tl: acc});
          xs = _t211;
          acc = _t212;
          continue;
          _t209 = undefined;
          break _t210;
        }
        _match_fail("line 259");
      }
      return _t209;
    }
  }
  const _t213 = go(xs, ys);
  return _t213;
}
function List$nth_opt(xs, n) {
  function go(xs, i) {
    while (true) {
      let _t215;
      const _t214 = xs;
      _t216: {
        if (_t214 === null) {
          _t215 = ({_tag: 0, _name: "None"});
          break _t216;
        }
        if (_t214 !== null) {
          const x = _t214._hd;
          const rest = _t214._tl;
          let _t217;
          if ((i === 0)) {
            _t217 = ({_tag: 1, _name: "Some", _val: x});
          } else {
            const _t218 = rest;
            const _t219 = (i - 1);
            xs = _t218;
            i = _t219;
            continue;
            _t217 = undefined;
          }
          _t215 = _t217;
          break _t216;
        }
        _match_fail("line 259");
      }
      return _t215;
    }
  }
  const _t220 = go(xs, n);
  return _t220;
}
function List$find_index(f, xs) {
  function go(xs, i) {
    while (true) {
      let _t222;
      const _t221 = xs;
      _t223: {
        if (_t221 === null) {
          _t222 = ({_tag: 0, _name: "None"});
          break _t223;
        }
        if (_t221 !== null) {
          const x = _t221._hd;
          const rest = _t221._tl;
          let _t224;
          if (f(x)) {
            _t224 = ({_tag: 1, _name: "Some", _val: i});
          } else {
            const _t225 = rest;
            const _t226 = (i + 1);
            xs = _t225;
            i = _t226;
            continue;
            _t224 = undefined;
          }
          _t222 = _t224;
          break _t223;
        }
        _match_fail("line 259");
      }
      return _t222;
    }
  }
  const _t227 = go(xs, 0);
  return _t227;
}
function List$filteri(f, xs) {
  function go(xs, i, acc) {
    while (true) {
      let _t229;
      const _t228 = xs;
      _t230: {
        if (_t228 === null) {
          _t229 = List$rev(acc);
          break _t230;
        }
        if (_t228 !== null) {
          const x = _t228._hd;
          const rest = _t228._tl;
          let _t231;
          if (f(i, x)) {
            const _t232 = rest;
            const _t233 = (i + 1);
            const _t234 = ({_hd: x, _tl: acc});
            xs = _t232;
            i = _t233;
            acc = _t234;
            continue;
            _t231 = undefined;
          } else {
            const _t235 = rest;
            const _t236 = (i + 1);
            const _t237 = acc;
            xs = _t235;
            i = _t236;
            acc = _t237;
            continue;
            _t231 = undefined;
          }
          _t229 = _t231;
          break _t230;
        }
        _match_fail("line 259");
      }
      return _t229;
    }
  }
  const _t238 = go(xs, 0, null);
  return _t238;
}
function List$filter_map(f, xs) {
  function go(xs, acc) {
    while (true) {
      let _t240;
      const _t239 = xs;
      _t241: {
        if (_t239 === null) {
          _t240 = List$rev(acc);
          break _t241;
        }
        if (_t239 !== null) {
          const x = _t239._hd;
          const rest = _t239._tl;
          let _t243;
          const _t242 = f(x);
          _t244: {
            if (_t242._tag === 1) {
              const y = _t242._val;
              const _t245 = rest;
              const _t246 = ({_hd: y, _tl: acc});
              xs = _t245;
              acc = _t246;
              continue;
              _t243 = undefined;
              break _t244;
            }
            if (_t242._tag === 0) {
              const _t247 = rest;
              const _t248 = acc;
              xs = _t247;
              acc = _t248;
              continue;
              _t243 = undefined;
              break _t244;
            }
            _match_fail("line 259");
          }
          _t240 = _t243;
          break _t241;
        }
        _match_fail("line 259");
      }
      return _t240;
    }
  }
  const _t249 = go(xs, null);
  return _t249;
}
function List$sort_uniq(cmp, xs) {
  const sorted_250 = List$sort(cmp, xs);
  function dedup(xs) {
    while (true) {
      let _t253;
      const _t252 = xs;
      _t254: {
        if (_t252 === null) {
          _t253 = null;
          break _t254;
        }
        if (_t252 !== null && _t252._tl === null) {
          const x = _t252._hd;
          _t253 = ({_hd: x, _tl: null});
          break _t254;
        }
        if (_t252 !== null && _t252._tl !== null) {
          const x = _t252._hd;
          const y = _t252._tl._hd;
          const rest = _t252._tl._tl;
          let _t255;
          if ((cmp(x, y) === 0)) {
            const _t256 = ({_hd: y, _tl: rest});
            xs = _t256;
            continue;
            _t255 = undefined;
          } else {
            _t255 = ({_hd: x, _tl: dedup(({_hd: y, _tl: rest}))});
          }
          _t253 = _t255;
          break _t254;
        }
        _match_fail("line 259");
      }
      return _t253;
    }
  }
  const _t257 = dedup(sorted_250);
  const _t251 = _t257;
  return _t251;
}
if (typeof Array$make === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.make"]) var Array$make = globalThis._mmlExterns["Array.make"]; else throw new Error("extern " + "Array.make" + " not provided"); }
if (typeof Array$get === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.get"]) var Array$get = globalThis._mmlExterns["Array.get"]; else throw new Error("extern " + "Array.get" + " not provided"); }
if (typeof Array$set === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.set"]) var Array$set = globalThis._mmlExterns["Array.set"]; else throw new Error("extern " + "Array.set" + " not provided"); }
if (typeof Array$length === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.length"]) var Array$length = globalThis._mmlExterns["Array.length"]; else throw new Error("extern " + "Array.length" + " not provided"); }
if (typeof Array$to_list === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.to_list"]) var Array$to_list = globalThis._mmlExterns["Array.to_list"]; else throw new Error("extern " + "Array.to_list" + " not provided"); }
if (typeof Array$of_list === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.of_list"]) var Array$of_list = globalThis._mmlExterns["Array.of_list"]; else throw new Error("extern " + "Array.of_list" + " not provided"); }
if (typeof Array$copy === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.copy"]) var Array$copy = globalThis._mmlExterns["Array.copy"]; else throw new Error("extern " + "Array.copy" + " not provided"); }
if (typeof Array$sub === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Array.sub"]) var Array$sub = globalThis._mmlExterns["Array.sub"]; else throw new Error("extern " + "Array.sub" + " not provided"); }
function Array$init(n, f) {
  let _t258;
  if ((n <= 0)) {
    _t258 = {_arr: []};
  } else {
    const arr_259 = Array$make(n, f(0));
    function go(i) {
      while (true) {
        let _t261;
        if ((i >= n)) {
          _t261 = arr_259;
        } else {
          Array$set(arr_259, i, f(i));
          const _t262 = (i + 1);
          i = _t262;
          continue;
          _t261 = undefined;
        }
        return _t261;
      }
    }
    const _t263 = go(1);
    const _t260 = _t263;
    _t258 = _t260;
  }
  return _t258;
}
function Array$map(f, arr) {
  const n_264 = Array$length(arr);
  let _t266;
  if ((n_264 === 0)) {
    _t266 = {_arr: []};
  } else {
    const result_267 = Array$make(n_264, f(Array$get(arr, 0)));
    function go(i) {
      while (true) {
        let _t269;
        if ((i >= n_264)) {
          _t269 = result_267;
        } else {
          Array$set(result_267, i, f(Array$get(arr, i)));
          const _t270 = (i + 1);
          i = _t270;
          continue;
          _t269 = undefined;
        }
        return _t269;
      }
    }
    const _t271 = go(1);
    const _t268 = _t271;
    _t266 = _t268;
  }
  const _t265 = _t266;
  return _t265;
}
function Array$iter(f, arr) {
  const n_272 = Array$length(arr);
  function go(i) {
    while (true) {
      let _t274;
      if ((i >= n_272)) {
        _t274 = undefined;
      } else {
        f(Array$get(arr, i));
        const _t275 = (i + 1);
        i = _t275;
        continue;
        _t274 = undefined;
      }
      return _t274;
    }
  }
  const _t276 = go(0);
  const _t273 = _t276;
  return _t273;
}
function Array$iteri(f, arr) {
  const n_277 = Array$length(arr);
  function go(i) {
    while (true) {
      let _t279;
      if ((i >= n_277)) {
        _t279 = undefined;
      } else {
        f(i, Array$get(arr, i));
        const _t280 = (i + 1);
        i = _t280;
        continue;
        _t279 = undefined;
      }
      return _t279;
    }
  }
  const _t281 = go(0);
  const _t278 = _t281;
  return _t278;
}
function Array$forall(f, arr) {
  const n_282 = Array$length(arr);
  function go(i) {
    while (true) {
      let _t284;
      if ((i >= n_282)) {
        _t284 = true;
      } else {
        let _t285;
        if (f(Array$get(arr, i))) {
          const _t286 = (i + 1);
          i = _t286;
          continue;
          _t285 = undefined;
        } else {
          _t285 = false;
        }
        _t284 = _t285;
      }
      return _t284;
    }
  }
  const _t287 = go(0);
  const _t283 = _t287;
  return _t283;
}
function Array$fold(f, acc, arr) {
  const n_288 = Array$length(arr);
  function go(i, a) {
    while (true) {
      let _t290;
      if ((i >= n_288)) {
        _t290 = a;
      } else {
        const _t291 = (i + 1);
        const _t292 = f(a, Array$get(arr, i));
        i = _t291;
        a = _t292;
        continue;
        _t290 = undefined;
      }
      return _t290;
    }
  }
  const _t293 = go(0, acc);
  const _t289 = _t293;
  return _t289;
}
if (typeof IO$read_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.read_file"]) var IO$read_file = globalThis._mmlExterns["IO.read_file"]; else throw new Error("extern " + "IO.read_file" + " not provided"); }
if (typeof IO$write_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.write_file"]) var IO$write_file = globalThis._mmlExterns["IO.write_file"]; else throw new Error("extern " + "IO.write_file" + " not provided"); }
if (typeof IO$append_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.append_file"]) var IO$append_file = globalThis._mmlExterns["IO.append_file"]; else throw new Error("extern " + "IO.append_file" + " not provided"); }
if (typeof IO$read_line === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.read_line"]) var IO$read_line = globalThis._mmlExterns["IO.read_line"]; else throw new Error("extern " + "IO.read_line" + " not provided"); }
if (typeof IO$file_exists === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["IO.file_exists"]) var IO$file_exists = globalThis._mmlExterns["IO.file_exists"]; else throw new Error("extern " + "IO.file_exists" + " not provided"); }
if (typeof Sys$args === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.args"]) var Sys$args = globalThis._mmlExterns["Sys.args"]; else throw new Error("extern " + "Sys.args" + " not provided"); }
if (typeof Sys$getenv === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.getenv"]) var Sys$getenv = globalThis._mmlExterns["Sys.getenv"]; else throw new Error("extern " + "Sys.getenv" + " not provided"); }
if (typeof Sys$exit === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.exit"]) var Sys$exit = globalThis._mmlExterns["Sys.exit"]; else throw new Error("extern " + "Sys.exit" + " not provided"); }
if (typeof Sys$time === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Sys.time"]) var Sys$time = globalThis._mmlExterns["Sys.time"]; else throw new Error("extern " + "Sys.time" + " not provided"); }
function Math$abs(x) {
  let _t294;
  if ((x < 0)) {
    _t294 = (0 - x);
  } else {
    _t294 = x;
  }
  return _t294;
}
function Math$min(a, b) {
  let _t295;
  if ((a < b)) {
    _t295 = a;
  } else {
    _t295 = b;
  }
  return _t295;
}
function Math$max(a, b) {
  let _t296;
  if ((a > b)) {
    _t296 = a;
  } else {
    _t296 = b;
  }
  return _t296;
}
function Math$pow(a, b) {
  return __math_pow(a, b);
}
function Math$sqrt(x) {
  return __math_sqrt(x);
}
function Math$floor(x) {
  return __math_floor(x);
}
function Math$ceil(x) {
  return __math_ceil(x);
}
function Math$round(x) {
  return __math_round(x);
}
function Result$map(f, r) {
  let _t298;
  const _t297 = r;
  _t299: {
    if (_t297._tag === 0) {
      const v = _t297._val;
      _t298 = ({_tag: 0, _name: "Ok", _val: f(v)});
      break _t299;
    }
    if (_t297._tag === 1) {
      const e = _t297._val;
      _t298 = ({_tag: 1, _name: "Err", _val: e});
      break _t299;
    }
    _match_fail("line 14");
  }
  return _t298;
}
function Result$bind(f, r) {
  let _t301;
  const _t300 = r;
  _t302: {
    if (_t300._tag === 0) {
      const v = _t300._val;
      _t301 = f(v);
      break _t302;
    }
    if (_t300._tag === 1) {
      const e = _t300._val;
      _t301 = ({_tag: 1, _name: "Err", _val: e});
      break _t302;
    }
    _match_fail("line 14");
  }
  return _t301;
}
function Result$unwrap(r) {
  let _t304;
  const _t303 = r;
  _t305: {
    if (_t303._tag === 0) {
      const v = _t303._val;
      _t304 = v;
      break _t305;
    }
    _match_fail("line 14");
  }
  return _t304;
}
function Byte$to_int(b) {
  return __byte_to_int(b);
}
function Byte$of_int(n) {
  return __byte_of_int(n);
}
function Byte$to_string(b) {
  return __byte_to_string(b);
}
function Byte$is_alpha(b) {
  const n_306 = Byte$to_int(b);
  const _t307 = (((n_306 >= 65) && (n_306 <= 90)) || ((n_306 >= 97) && (n_306 <= 122)));
  return _t307;
}
function Byte$is_digit(b) {
  const n_308 = Byte$to_int(b);
  const _t309 = ((n_308 >= 48) && (n_308 <= 57));
  return _t309;
}
function Byte$is_space(b) {
  const n_310 = Byte$to_int(b);
  const _t311 = ((((n_310 === 32) || (n_310 === 9)) || (n_310 === 10)) || (n_310 === 13));
  return _t311;
}
function Byte$is_upper(b) {
  const n_312 = Byte$to_int(b);
  const _t313 = ((n_312 >= 65) && (n_312 <= 90));
  return _t313;
}
function Byte$is_lower(b) {
  const n_314 = Byte$to_int(b);
  const _t315 = ((n_314 >= 97) && (n_314 <= 122));
  return _t315;
}
function Byte$to_upper(b) {
  const n_316 = Byte$to_int(b);
  let _t318;
  if (((n_316 >= 97) && (n_316 <= 122))) {
    _t318 = Byte$of_int((n_316 - 32));
  } else {
    _t318 = b;
  }
  const _t317 = _t318;
  return _t317;
}
function Byte$to_lower(b) {
  const n_319 = Byte$to_int(b);
  let _t321;
  if (((n_319 >= 65) && (n_319 <= 90))) {
    _t321 = Byte$of_int((n_319 + 32));
  } else {
    _t321 = b;
  }
  const _t320 = _t321;
  return _t320;
}
function Rune$to_int(r) {
  return __rune_to_int(r);
}
function Rune$of_int(n) {
  return __rune_of_int(n);
}
function Rune$to_string(r) {
  return __rune_to_string(r);
}
function Rune$is_alpha(r) {
  const n_322 = Rune$to_int(r);
  const _t323 = (((n_322 >= 65) && (n_322 <= 90)) || ((n_322 >= 97) && (n_322 <= 122)));
  return _t323;
}
function Rune$is_digit(r) {
  const n_324 = Rune$to_int(r);
  const _t325 = ((n_324 >= 48) && (n_324 <= 57));
  return _t325;
}
function Rune$is_space(r) {
  const n_326 = Rune$to_int(r);
  const _t327 = ((((n_326 === 32) || (n_326 === 9)) || (n_326 === 10)) || (n_326 === 13));
  return _t327;
}
function Rune$is_upper(r) {
  const n_328 = Rune$to_int(r);
  const _t329 = ((n_328 >= 65) && (n_328 <= 90));
  return _t329;
}
function Rune$is_lower(r) {
  const n_330 = Rune$to_int(r);
  const _t331 = ((n_330 >= 97) && (n_330 <= 122));
  return _t331;
}
function Map$empty(_) {
  return null;
}
function Map$has(k, __p1) {
  while (true) {
    let _t333;
    const _t332 = __p1;
    _t334: {
      if (true) {
        const m = _t332;
        let _t336;
        const _t335 = m;
        _t337: {
          if (_t335 === null) {
            _t336 = false;
            break _t337;
          }
          if (_t335 !== null) {
            const k2 = _t335._hd[0];
            const rest = _t335._tl;
            let _t338;
            if (_eq(k, k2)) {
              _t338 = true;
            } else {
              const _t339 = k;
              const _t340 = rest;
              k = _t339;
              __p1 = _t340;
              continue;
              _t338 = undefined;
            }
            _t336 = _t338;
            break _t337;
          }
          _match_fail("line 76");
        }
        _t333 = _t336;
        break _t334;
      }
      _match_fail("line 76");
    }
    return _t333;
  }
}
function Map$get(k, __p2) {
  while (true) {
    let _t342;
    const _t341 = __p2;
    _t343: {
      if (true) {
        const m = _t341;
        let _t345;
        const _t344 = m;
        _t346: {
          if (_t344 === null) {
            _t345 = ({_tag: 0, _name: "None"});
            break _t346;
          }
          if (_t344 !== null) {
            const k2 = _t344._hd[0];
            const v = _t344._hd[1];
            const rest = _t344._tl;
            let _t347;
            if (_eq(k, k2)) {
              _t347 = ({_tag: 1, _name: "Some", _val: v});
            } else {
              const _t348 = k;
              const _t349 = rest;
              k = _t348;
              __p2 = _t349;
              continue;
              _t347 = undefined;
            }
            _t345 = _t347;
            break _t346;
          }
          _match_fail("line 76");
        }
        _t342 = _t345;
        break _t343;
      }
      _match_fail("line 76");
    }
    return _t342;
  }
}
function Map$set(k, v, __p3) {
  let _t351;
  const _t350 = __p3;
  _t352: {
    if (true) {
      const m = _t350;
      function go(acc, lst) {
        while (true) {
          let _t354;
          const _t353 = lst;
          _t355: {
            if (_t353 === null) {
              _t354 = List$rev(({_hd: [k, v], _tl: acc}));
              break _t355;
            }
            if (_t353 !== null) {
              const k2 = _t353._hd[0];
              const rest = _t353._tl;
              if (_eq(k, k2)) {
                _t354 = List$rev_append(({_hd: [k, v], _tl: acc}), rest);
                break _t355;
              }
            }
            if (_t353 !== null) {
              const entry = _t353._hd;
              const rest = _t353._tl;
              const _t356 = ({_hd: entry, _tl: acc});
              const _t357 = rest;
              acc = _t356;
              lst = _t357;
              continue;
              _t354 = undefined;
              break _t355;
            }
            _match_fail("line 76");
          }
          return _t354;
        }
      }
      const _t358 = go(null, m);
      _t351 = _t358;
      break _t352;
    }
    _match_fail("line 76");
  }
  return _t351;
}
function Map$remove(k, __p4) {
  let _t360;
  const _t359 = __p4;
  _t361: {
    if (true) {
      const m = _t359;
      let _t363;
      const _t362 = m;
      _t364: {
        if (_t362 === null) {
          _t363 = null;
          break _t364;
        }
        if (_t362 !== null) {
          const k2 = _t362._hd[0];
          const rest = _t362._tl;
          if (_eq(k, k2)) {
            _t363 = rest;
            break _t364;
          }
        }
        if (_t362 !== null) {
          const entry = _t362._hd;
          const rest = _t362._tl;
          let _t366;
          const _t365 = Map$remove(k, rest);
          _t367: {
            if (true) {
              const r = _t365;
              _t366 = ({_hd: entry, _tl: r});
              break _t367;
            }
            _match_fail("line 76");
          }
          _t363 = _t366;
          break _t364;
        }
        _match_fail("line 76");
      }
      _t360 = _t363;
      break _t361;
    }
    _match_fail("line 76");
  }
  return _t360;
}
function Map$size(__p5) {
  let _t369;
  const _t368 = __p5;
  _t370: {
    if (true) {
      const m = _t368;
      _t369 = List$length(m);
      break _t370;
    }
    _match_fail("line 76");
  }
  return _t369;
}
function Map$keys(__p6) {
  let _t372;
  const _t371 = __p6;
  _t373: {
    if (true) {
      const m = _t371;
      let _t375;
      const _t374 = m;
      _t376: {
        if (_t374 === null) {
          _t375 = null;
          break _t376;
        }
        if (_t374 !== null) {
          const k = _t374._hd[0];
          const rest = _t374._tl;
          _t375 = ({_hd: k, _tl: Map$keys(rest)});
          break _t376;
        }
        _match_fail("line 76");
      }
      _t372 = _t375;
      break _t373;
    }
    _match_fail("line 76");
  }
  return _t372;
}
function Map$values(__p7) {
  let _t378;
  const _t377 = __p7;
  _t379: {
    if (true) {
      const m = _t377;
      let _t381;
      const _t380 = m;
      _t382: {
        if (_t380 === null) {
          _t381 = null;
          break _t382;
        }
        if (_t380 !== null) {
          const v = _t380._hd[1];
          const rest = _t380._tl;
          _t381 = ({_hd: v, _tl: Map$values(rest)});
          break _t382;
        }
        _match_fail("line 76");
      }
      _t378 = _t381;
      break _t379;
    }
    _match_fail("line 76");
  }
  return _t378;
}
function Map$to_list(__p8) {
  let _t384;
  const _t383 = __p8;
  _t385: {
    if (true) {
      const m = _t383;
      _t384 = m;
      break _t385;
    }
    _match_fail("line 76");
  }
  return _t384;
}
function Map$of_list(pairs) {
  function _t386(acc, p) {
    let _t388;
    const _t387 = p;
    _t389: {
      if (true) {
        const k = _t387[0];
        const v = _t387[1];
        _t388 = Map$set(k, v, acc);
        break _t389;
      }
      _match_fail("line 76");
    }
    return _t388;
  }
  return List$fold(_t386, null, pairs);
}
const __dict_Map_g0_g1_map__g0__g1 = ({get: Map$get, has: Map$has, keys: Map$keys, of_list: Map$of_list, remove: Map$remove, set: Map$set, size: Map$size, to_list: Map$to_list, values: Map$values});
function _t390(f, acc, __p9) {
  let _t392;
  const _t391 = __p9;
  _t393: {
    if (true) {
      const m = _t391;
      function go(a, l) {
        while (true) {
          let _t395;
          const _t394 = l;
          _t396: {
            if (_t394 === null) {
              _t395 = a;
              break _t396;
            }
            if (_t394 !== null) {
              const x = _t394._hd;
              const rest = _t394._tl;
              const _t397 = f(a, x);
              const _t398 = rest;
              a = _t397;
              l = _t398;
              continue;
              _t395 = undefined;
              break _t396;
            }
            _match_fail("line 76");
          }
          return _t395;
        }
      }
      const _t399 = go(acc, m);
      _t392 = _t399;
      break _t393;
    }
    _match_fail("line 76");
  }
  return _t392;
}
const __dict_Iter_g0_g1_map__g0_g1_tup = ({fold: _t390});
function __dict_Show_g0_g1_map(__dict_Show_0, __dict_Show_1) {
  function _t400(__p10) {
    let _t402;
    const _t401 = __p10;
    _t403: {
      if (true) {
        const m = _t401;
        let _t405;
        const _t404 = m;
        _t406: {
          if (_t404 === null) {
            _t405 = "#{}";
            break _t406;
          }
          if (true) {
            function _t407(acc, kv) {
              let _t409;
              const _t408 = kv;
              _t410: {
                if (true) {
                  const k = _t408[0];
                  const v = _t408[1];
                  const entry_411 = ((__dict_Show_0.show(k) + ": ") + __dict_Show_1.show(v));
                  let _t413;
                  if ((acc === "")) {
                    _t413 = entry_411;
                  } else {
                    _t413 = ((acc + "; ") + entry_411);
                  }
                  const _t412 = _t413;
                  _t409 = _t412;
                  break _t410;
                }
                _match_fail("line 76");
              }
              return _t409;
            }
            const inner_414 = List$fold(_t407, "", m);
            const _t415 = (("#{" + inner_414) + "}");
            _t405 = _t415;
            break _t406;
          }
          _match_fail("line 76");
        }
        _t402 = _t405;
        break _t403;
      }
      _match_fail("line 76");
    }
    return _t402;
  }
  return ({show: _t400});
}
function _t416(k, m) {
  let _t418;
  const _t417 = Map$get(k, m);
  _t419: {
    if (_t417._tag === 1) {
      const v = _t417._val;
      _t418 = v;
      break _t419;
    }
    if (_t417._tag === 0) {
      _t418 = failwith("key not found in map");
      break _t419;
    }
    _match_fail("line 76");
  }
  return _t418;
}
const __dict_Index_g0_g1_map__g0__g1 = ({at: _t416});
function Set$empty(_) {
  return Map$empty(undefined);
}
function Set$singleton(x) {
  return Map$set(x, undefined, Map$empty(undefined));
}
function Set$of_list(xs) {
  function _t420(acc, x) {
    return Map$set(x, undefined, acc);
  }
  return List$fold(_t420, Map$empty(undefined), xs);
}
function Set$add(elem, __p11) {
  let _t422;
  const _t421 = __p11;
  _t423: {
    if (true) {
      const s = _t421;
      _t422 = Map$set(elem, undefined, s);
      break _t423;
    }
    _match_fail("line 55");
  }
  return _t422;
}
function Set$remove(elem, __p12) {
  let _t425;
  const _t424 = __p12;
  _t426: {
    if (true) {
      const s = _t424;
      _t425 = Map$remove(elem, s);
      break _t426;
    }
    _match_fail("line 55");
  }
  return _t425;
}
function Set$mem(elem, __p13) {
  let _t428;
  const _t427 = __p13;
  _t429: {
    if (true) {
      const s = _t427;
      _t428 = Map$has(elem, s);
      break _t429;
    }
    _match_fail("line 55");
  }
  return _t428;
}
function Set$size(__p14) {
  let _t431;
  const _t430 = __p14;
  _t432: {
    if (true) {
      const s = _t430;
      _t431 = Map$size(s);
      break _t432;
    }
    _match_fail("line 55");
  }
  return _t431;
}
function Set$to_list(__p15) {
  let _t434;
  const _t433 = __p15;
  _t435: {
    if (true) {
      const s = _t433;
      _t434 = Map$keys(s);
      break _t435;
    }
    _match_fail("line 55");
  }
  return _t434;
}
function Set$union(__p16, __p17) {
  let _t437;
  const _t436 = __p17;
  _t438: {
    if (true) {
      const s2 = _t436;
      let _t440;
      const _t439 = __p16;
      _t441: {
        if (true) {
          const s1 = _t439;
          function _t442(acc, x) {
            return Map$set(x, undefined, acc);
          }
          _t440 = List$fold(_t442, s2, Map$keys(s1));
          break _t441;
        }
        _match_fail("line 55");
      }
      _t437 = _t440;
      break _t438;
    }
    _match_fail("line 55");
  }
  return _t437;
}
function Set$inter(__p18, __p19) {
  let _t444;
  const _t443 = __p19;
  _t445: {
    if (true) {
      const s2 = _t443;
      let _t447;
      const _t446 = __p18;
      _t448: {
        if (true) {
          const s1 = _t446;
          function _t449(acc, x) {
            let _t450;
            if (Map$has(x, s2)) {
              _t450 = Map$set(x, undefined, acc);
            } else {
              _t450 = acc;
            }
            return _t450;
          }
          _t447 = List$fold(_t449, Map$empty(undefined), Map$keys(s1));
          break _t448;
        }
        _match_fail("line 55");
      }
      _t444 = _t447;
      break _t445;
    }
    _match_fail("line 55");
  }
  return _t444;
}
function Set$diff(__p20, __p21) {
  let _t452;
  const _t451 = __p21;
  _t453: {
    if (true) {
      const s2 = _t451;
      let _t455;
      const _t454 = __p20;
      _t456: {
        if (true) {
          const s1 = _t454;
          function _t457(acc, x) {
            let _t458;
            if ((!Map$has(x, s2))) {
              _t458 = Map$set(x, undefined, acc);
            } else {
              _t458 = acc;
            }
            return _t458;
          }
          _t455 = List$fold(_t457, Map$empty(undefined), Map$keys(s1));
          break _t456;
        }
        _match_fail("line 55");
      }
      _t452 = _t455;
      break _t453;
    }
    _match_fail("line 55");
  }
  return _t452;
}
function Set$is_empty(__p22) {
  let _t460;
  const _t459 = __p22;
  _t461: {
    if (true) {
      const s = _t459;
      _t460 = (Map$size(s) === 0);
      break _t461;
    }
    _match_fail("line 55");
  }
  return _t460;
}
function Set$is_subset(__p23, __p24) {
  let _t463;
  const _t462 = __p24;
  _t464: {
    if (true) {
      const s2 = _t462;
      let _t466;
      const _t465 = __p23;
      _t467: {
        if (true) {
          const s1 = _t465;
          function _t468(x) {
            return Map$has(x, s2);
          }
          _t466 = List$forall(_t468, Map$keys(s1));
          break _t467;
        }
        _match_fail("line 55");
      }
      _t463 = _t466;
      break _t464;
    }
    _match_fail("line 55");
  }
  return _t463;
}
function _t469(f, acc, __p25) {
  let _t471;
  const _t470 = __p25;
  _t472: {
    if (true) {
      const s = _t470;
      function go(a, l) {
        while (true) {
          let _t474;
          const _t473 = l;
          _t475: {
            if (_t473 === null) {
              _t474 = a;
              break _t475;
            }
            if (_t473 !== null) {
              const x = _t473._hd;
              const rest = _t473._tl;
              const _t476 = f(a, x);
              const _t477 = rest;
              a = _t476;
              l = _t477;
              continue;
              _t474 = undefined;
              break _t475;
            }
            _match_fail("line 55");
          }
          return _t474;
        }
      }
      const _t478 = go(acc, Map$keys(s));
      _t471 = _t478;
      break _t472;
    }
    _match_fail("line 55");
  }
  return _t471;
}
const __dict_Iter_g0_set__g0 = ({fold: _t469});
function __dict_Show_g0_set(__dict_Show_0) {
  function _t479(__p26) {
    let _t481;
    const _t480 = __p26;
    _t482: {
      if (true) {
        const s = _t480;
        let _t484;
        const _t483 = Map$keys(s);
        _t485: {
          if (_t483 === null) {
            _t484 = "#{}";
            break _t485;
          }
          if (true) {
            const ks = _t483;
            function _t486(acc, x) {
              let _t487;
              if ((acc === "")) {
                _t487 = __dict_Show_0.show(x);
              } else {
                _t487 = ((acc + "; ") + __dict_Show_0.show(x));
              }
              return _t487;
            }
            const inner_488 = List$fold(_t486, "", ks);
            const _t489 = (("#{" + inner_488) + "}");
            _t484 = _t489;
            break _t485;
          }
          _match_fail("line 55");
        }
        _t481 = _t484;
        break _t482;
      }
      _match_fail("line 55");
    }
    return _t481;
  }
  return ({show: _t479});
}
function Enum$reduce(f, xs) {
  let _t491;
  const _t490 = xs;
  _t492: {
    if (_t490 !== null) {
      const x = _t490._hd;
      const rest = _t490._tl;
      _t491 = List$fold(f, x, rest);
      break _t492;
    }
    _match_fail("line 118");
  }
  return _t491;
}
function Enum$sum(xs) {
  function _t493(a, b) {
    return (a + b);
  }
  return List$fold(_t493, 0, xs);
}
function Enum$count(f, xs) {
  function _t494(acc, x) {
    let _t495;
    if (f(x)) {
      _t495 = (acc + 1);
    } else {
      _t495 = acc;
    }
    return _t495;
  }
  return List$fold(_t494, 0, xs);
}
function Enum$take(n, xs) {
  function go(i, acc, l) {
    while (true) {
      let _t496;
      if ((i >= n)) {
        _t496 = List$rev(acc);
      } else {
        let _t498;
        const _t497 = l;
        _t499: {
          if (_t497 === null) {
            _t498 = List$rev(acc);
            break _t499;
          }
          if (_t497 !== null) {
            const x = _t497._hd;
            const rest = _t497._tl;
            const _t500 = (i + 1);
            const _t501 = ({_hd: x, _tl: acc});
            const _t502 = rest;
            i = _t500;
            acc = _t501;
            l = _t502;
            continue;
            _t498 = undefined;
            break _t499;
          }
          _match_fail("line 118");
        }
        _t496 = _t498;
      }
      return _t496;
    }
  }
  const _t503 = go(0, null, xs);
  return _t503;
}
function Enum$drop(n, xs) {
  function go(i, l) {
    while (true) {
      let _t504;
      if ((i >= n)) {
        _t504 = l;
      } else {
        let _t506;
        const _t505 = l;
        _t507: {
          if (_t505 === null) {
            _t506 = null;
            break _t507;
          }
          if (_t505 !== null) {
            const rest = _t505._tl;
            const _t508 = (i + 1);
            const _t509 = rest;
            i = _t508;
            l = _t509;
            continue;
            _t506 = undefined;
            break _t507;
          }
          _match_fail("line 118");
        }
        _t504 = _t506;
      }
      return _t504;
    }
  }
  const _t510 = go(0, xs);
  return _t510;
}
function Enum$take_while(f, xs) {
  function go(acc, l) {
    while (true) {
      let _t512;
      const _t511 = l;
      _t513: {
        if (_t511 === null) {
          _t512 = List$rev(acc);
          break _t513;
        }
        if (_t511 !== null) {
          const x = _t511._hd;
          const rest = _t511._tl;
          let _t514;
          if (f(x)) {
            const _t515 = ({_hd: x, _tl: acc});
            const _t516 = rest;
            acc = _t515;
            l = _t516;
            continue;
            _t514 = undefined;
          } else {
            _t514 = List$rev(acc);
          }
          _t512 = _t514;
          break _t513;
        }
        _match_fail("line 118");
      }
      return _t512;
    }
  }
  const _t517 = go(null, xs);
  return _t517;
}
function Enum$drop_while(f, xs) {
  function go(l) {
    while (true) {
      let _t519;
      const _t518 = l;
      _t520: {
        if (_t518 === null) {
          _t519 = null;
          break _t520;
        }
        if (_t518 !== null) {
          const x = _t518._hd;
          const rest = _t518._tl;
          let _t521;
          if (f(x)) {
            const _t522 = rest;
            l = _t522;
            continue;
            _t521 = undefined;
          } else {
            _t521 = l;
          }
          _t519 = _t521;
          break _t520;
        }
        _match_fail("line 118");
      }
      return _t519;
    }
  }
  const _t523 = go(xs);
  return _t523;
}
function Enum$flat_map(f, xs) {
  return List$flatten(List$map(f, xs));
}
function Enum$each(f, xs) {
  function _t524(_, x) {
    return f(x);
  }
  return List$fold(_t524, undefined, xs);
}
function Enum$reject(f, xs) {
  function _t525(x) {
    return (!f(x));
  }
  return List$filter(_t525, xs);
}
function Enum$enumerate(xs) {
  function _t526(i, x) {
    return [i, x];
  }
  return List$mapi(_t526, xs);
}
function Enum$join(sep, xs) {
  let _t528;
  const _t527 = xs;
  _t529: {
    if (_t527 === null) {
      _t528 = "";
      break _t529;
    }
    if (_t527 !== null) {
      const first = _t527._hd;
      const rest = _t527._tl;
      function _t530(acc, x) {
        return ((acc + sep) + x);
      }
      _t528 = List$fold(_t530, first, rest);
      break _t529;
    }
    _match_fail("line 118");
  }
  return _t528;
}
function Enum$chunk(n, xs) {
  function go(acc, l) {
    while (true) {
      let _t532;
      const _t531 = l;
      _t533: {
        if (_t531 === null) {
          _t532 = List$rev(acc);
          break _t533;
        }
        if (true) {
          const _t534 = ({_hd: Enum$take(n, l), _tl: acc});
          const _t535 = Enum$drop(n, l);
          acc = _t534;
          l = _t535;
          continue;
          _t532 = undefined;
          break _t533;
        }
        _match_fail("line 118");
      }
      return _t532;
    }
  }
  const _t536 = go(null, xs);
  return _t536;
}
function Enum$dedup(xs) {
  function go(prev, acc, l) {
    while (true) {
      let _t538;
      const _t537 = l;
      _t539: {
        if (_t537 === null) {
          _t538 = List$rev(acc);
          break _t539;
        }
        if (_t537 !== null) {
          const x = _t537._hd;
          const rest = _t537._tl;
          let _t540;
          if (_eq(x, prev)) {
            const _t541 = prev;
            const _t542 = acc;
            const _t543 = rest;
            prev = _t541;
            acc = _t542;
            l = _t543;
            continue;
            _t540 = undefined;
          } else {
            const _t544 = x;
            const _t545 = ({_hd: x, _tl: acc});
            const _t546 = rest;
            prev = _t544;
            acc = _t545;
            l = _t546;
            continue;
            _t540 = undefined;
          }
          _t538 = _t540;
          break _t539;
        }
        _match_fail("line 118");
      }
      return _t538;
    }
  }
  let _t549;
  const _t548 = xs;
  _t550: {
    if (_t548 === null) {
      _t549 = null;
      break _t550;
    }
    if (_t548 !== null) {
      const x = _t548._hd;
      const rest = _t548._tl;
      _t549 = go(x, ({_hd: x, _tl: null}), rest);
      break _t550;
    }
    _match_fail("line 118");
  }
  const _t547 = _t549;
  return _t547;
}
function Enum$uniq(xs) {
  function _t551(acc, x) {
    function _t552(y) {
      return _eq(y, x);
    }
    let _t553;
    if (List$exists(_t552, acc)) {
      _t553 = acc;
    } else {
      _t553 = ({_hd: x, _tl: acc});
    }
    return _t553;
  }
  return List$rev(List$fold(_t551, null, xs));
}
function Enum$scan(f, init, xs) {
  function _t554(acc, x) {
    let _t556;
    const _t555 = acc;
    _t557: {
      if (_t555 === null) {
        _t556 = ({_hd: f(init, x), _tl: null});
        break _t557;
      }
      if (_t555 !== null) {
        const prev = _t555._hd;
        _t556 = ({_hd: f(prev, x), _tl: acc});
        break _t557;
      }
      _match_fail("line 118");
    }
    return _t556;
  }
  return List$rev(List$fold(_t554, ({_hd: init, _tl: null}), xs));
}
function Enum$intersperse(sep, xs) {
  let _t559;
  const _t558 = xs;
  _t560: {
    if (_t558 === null) {
      _t559 = null;
      break _t560;
    }
    if (_t558 !== null) {
      const first = _t558._hd;
      const rest = _t558._tl;
      function _t561(acc, x) {
        return List$concat(acc, ({_hd: sep, _tl: ({_hd: x, _tl: null})}));
      }
      _t559 = List$fold(_t561, ({_hd: first, _tl: null}), rest);
      break _t560;
    }
    _match_fail("line 118");
  }
  return _t559;
}
function Enum$zip_with(f, xs, ys) {
  function _t562(p) {
    let _t564;
    const _t563 = p;
    _t565: {
      if (true) {
        const a = _t563[0];
        const b = _t563[1];
        _t564 = f(a, b);
        break _t565;
      }
      _match_fail("line 118");
    }
    return _t564;
  }
  return List$map(_t562, List$zip(xs, ys));
}
function Enum$min_by(f, xs) {
  let _t567;
  const _t566 = xs;
  _t568: {
    if (_t566 !== null) {
      const x = _t566._hd;
      const rest = _t566._tl;
      function _t569(best, y) {
        let _t570;
        if ((f(y) < f(best))) {
          _t570 = y;
        } else {
          _t570 = best;
        }
        return _t570;
      }
      _t567 = List$fold(_t569, x, rest);
      break _t568;
    }
    _match_fail("line 118");
  }
  return _t567;
}
function Enum$max_by(f, xs) {
  let _t572;
  const _t571 = xs;
  _t573: {
    if (_t571 !== null) {
      const x = _t571._hd;
      const rest = _t571._tl;
      function _t574(best, y) {
        let _t575;
        if ((f(y) > f(best))) {
          _t575 = y;
        } else {
          _t575 = best;
        }
        return _t575;
      }
      _t572 = List$fold(_t574, x, rest);
      break _t573;
    }
    _match_fail("line 118");
  }
  return _t572;
}
function Enum$group_by(__dict_Map_0, __dict_Map_0_2, f, xs) {
  function _t576(m, x) {
    const k_577 = f(x);
    let _t580;
    const _t579 = __dict_Map_0_2.get(k_577, m);
    _t581: {
      if (_t579._tag === 0) {
        _t580 = __dict_Map_0_2.set(k_577, ({_hd: x, _tl: null}), m);
        break _t581;
      }
      if (_t579._tag === 1) {
        const vs = _t579._val;
        _t580 = __dict_Map_0_2.set(k_577, List$concat(vs, ({_hd: x, _tl: null})), m);
        break _t581;
      }
      _match_fail("line 118");
    }
    const _t578 = _t580;
    return _t578;
  }
  return List$fold(_t576, Map$of_list(null), xs);
}
function Seq$range(start, stop, _mml$yield) {
  function go(i) {
    while (true) {
      let _t582;
      if ((i >= stop)) {
        _t582 = undefined;
      } else {
        _mml$yield(i);
        const _t583 = (i + 1);
        i = _t583;
        continue;
        _t582 = undefined;
      }
      return _t582;
    }
  }
  const _t584 = go(start);
  return _t584;
}
function Seq$of_list(xs, _mml$yield) {
  function go(l) {
    while (true) {
      let _t586;
      const _t585 = l;
      _t587: {
        if (_t585 === null) {
          _t586 = undefined;
          break _t587;
        }
        if (_t585 !== null) {
          const x = _t585._hd;
          const rest = _t585._tl;
          _mml$yield(x);
          const _t588 = rest;
          l = _t588;
          continue;
          _t586 = undefined;
          break _t587;
        }
        _match_fail("line 134");
      }
      return _t586;
    }
  }
  const _t589 = go(xs);
  return _t589;
}
function Seq$repeat(x, _mml$yield) {
  function go(u) {
    while (true) {
      _mml$yield(x);
      const _t590 = u;
      u = _t590;
      continue;
      return undefined;
    }
  }
  const _t591 = go(0);
  return _t591;
}
function Seq$iterate(seed, step, _mml$yield) {
  function go(x) {
    while (true) {
      _mml$yield(x);
      const _t592 = step(x);
      x = _t592;
      continue;
      return undefined;
    }
  }
  const _t593 = go(seed);
  return _t593;
}
function Seq$map(f, s, _mml$yield) {
  function _t594(x) {
    return _mml$yield(f(x));
  }
  return s(_t594);
}
function Seq$filter(f, s, _mml$yield) {
  function _t595(x) {
    let _t596;
    if (f(x)) {
      _t596 = _mml$yield(x);
    } else {
      _t596 = undefined;
    }
    return _t596;
  }
  return s(_t595);
}
function Seq$take(n, s, _mml$yield) {
  return _trampoline(function() {
    let i_597 = _resolve(0);
    const _t598 = (function() {
      const _t599 = _h;
      _h = Object.assign({}, _t599, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t600(x) {
          return _trampoline(function() {
            if ((i_597 >= n)) {
              return _h["__seq_stop"](undefined, function(_t601) {
                return _bounce(function() {
                  return _t601;
                });
              });
            } else {
              _mml$yield(x);
              return (i_597 = (i_597 + 1), undefined);
            }
          });
        }
        const __x_602 = s(_t600);
        return __x_602;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t599; }
    })();
    return _t598;
  }, Seq$take);
}
function Seq$take_while(f, s, _mml$yield) {
  return _trampoline(function() {
    const _t603 = (function() {
      const _t604 = _h;
      _h = Object.assign({}, _t604, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t605(x) {
          return _trampoline(function() {
            if (f(x)) {
              return _mml$yield(x);
            } else {
              return _h["__seq_stop"](undefined, function(_t606) {
                return _bounce(function() {
                  return _t606;
                });
              });
            }
          });
        }
        const __x_607 = s(_t605);
        return __x_607;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t604; }
    })();
    return _t603;
  }, Seq$take_while);
}
function Seq$drop(n, s, _mml$yield) {
  let i_608 = 0;
  function _t610(x) {
    let _t611;
    if ((i_608 >= n)) {
      _t611 = _mml$yield(x);
    } else {
      _t611 = (i_608 = (i_608 + 1), undefined);
    }
    return _t611;
  }
  const _t609 = s(_t610);
  return _t609;
}
function Seq$drop_while(f, s, _mml$yield) {
  let dropping_612 = true;
  function _t614(x) {
    let _t615;
    if (dropping_612) {
      let _t616;
      if (f(x)) {
        _t616 = undefined;
      } else {
        (dropping_612 = false, undefined);
        _t616 = _mml$yield(x);
      }
      _t615 = _t616;
    } else {
      _t615 = _mml$yield(x);
    }
    return _t615;
  }
  const _t613 = s(_t614);
  return _t613;
}
function Seq$flat_map(f, s, _mml$yield) {
  function _t617(x) {
    return f(x, _mml$yield);
  }
  return s(_t617);
}
function Seq$enumerate(s, _mml$yield) {
  let i_618 = 0;
  function _t620(x) {
    _mml$yield([i_618, x]);
    return (i_618 = (i_618 + 1), undefined);
  }
  const _t619 = s(_t620);
  return _t619;
}
function Seq$chunk(n, s, _mml$yield) {
  let buf_621 = null;
  let count_623 = 0;
  function _t625(x) {
    (buf_621 = List$concat(buf_621, ({_hd: x, _tl: null})), undefined);
    (count_623 = (count_623 + 1), undefined);
    let _t626;
    if ((count_623 >= n)) {
      _mml$yield(buf_621);
      (buf_621 = null, undefined);
      _t626 = (count_623 = 0, undefined);
    } else {
      _t626 = undefined;
    }
    return _t626;
  }
  s(_t625);
  let _t627;
  if ((count_623 > 0)) {
    _t627 = _mml$yield(buf_621);
  } else {
    _t627 = undefined;
  }
  const _t624 = _t627;
  const _t622 = _t624;
  return _t622;
}
function Seq$to_list(s) {
  let acc_628 = null;
  function _t630(x) {
    return (acc_628 = ({_hd: x, _tl: acc_628}), undefined);
  }
  s(_t630);
  const _t629 = List$rev(acc_628);
  return _t629;
}
function Seq$fold(f, init, s) {
  let acc_631 = init;
  function _t633(x) {
    return (acc_631 = f(acc_631, x), undefined);
  }
  s(_t633);
  const _t632 = acc_631;
  return _t632;
}
function Seq$each(f, s) {
  return s(f);
}
function Seq$count(s) {
  let n_634 = 0;
  function _t636(_) {
    return (n_634 = (n_634 + 1), undefined);
  }
  s(_t636);
  const _t635 = n_634;
  return _t635;
}
function Seq$sum(s) {
  let total_637 = 0;
  function _t639(x) {
    return (total_637 = (total_637 + x), undefined);
  }
  s(_t639);
  const _t638 = total_637;
  return _t638;
}
function Seq$find(f, s) {
  return _trampoline(function() {
    let result_640 = _resolve(({_tag: 0, _name: "None"}));
    const _t641 = (function() {
      const _t642 = _h;
      _h = Object.assign({}, _t642, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t643(x) {
          return _trampoline(function() {
            if (f(x)) {
              _resolve((result_640 = ({_tag: 1, _name: "Some", _val: x}), undefined));
              return _h["__seq_stop"](undefined, function(_t644) {
                return _bounce(function() {
                  return _t644;
                });
              });
            } else {
              return undefined;
            }
          });
        }
        const __x_645 = s(_t643);
        return __x_645;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t642; }
    })();
    const _t646 = _resolve(_t641);
    return result_640;
  }, Seq$find);
}
function Seq$any(f, s) {
  return _trampoline(function() {
    let result_647 = _resolve(false);
    const _t648 = (function() {
      const _t649 = _h;
      _h = Object.assign({}, _t649, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t650(x) {
          return _trampoline(function() {
            if (f(x)) {
              _resolve((result_647 = true, undefined));
              return _h["__seq_stop"](undefined, function(_t651) {
                return _bounce(function() {
                  return _t651;
                });
              });
            } else {
              return undefined;
            }
          });
        }
        const __x_652 = s(_t650);
        return __x_652;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t649; }
    })();
    const _t653 = _resolve(_t648);
    return result_647;
  }, Seq$any);
}
function Seq$all(f, s) {
  return _trampoline(function() {
    let result_654 = _resolve(true);
    const _t655 = (function() {
      const _t656 = _h;
      _h = Object.assign({}, _t656, {
        "__seq_stop": function(_, __k_try) { throw {_e: "__seq_stop", _v: _}; },
      });
      try {
        function _t657(x) {
          return _trampoline(function() {
            if (f(x)) {
              return undefined;
            } else {
              _resolve((result_654 = false, undefined));
              return _h["__seq_stop"](undefined, function(_t658) {
                return _bounce(function() {
                  return _t658;
                });
              });
            }
          });
        }
        const __x_659 = s(_t657);
        return __x_659;
      } catch (_exc) {
        if (_exc && _exc._e === "__seq_stop") {
          const _ = _exc._v;
          return undefined;
        } else { throw _exc; }
      } finally { _h = _t656; }
    })();
    const _t660 = _resolve(_t655);
    return result_654;
  }, Seq$all);
}
function Option$map(f, opt) {
  let _t662;
  const _t661 = opt;
  _t663: {
    if (_t661._tag === 1) {
      const x = _t661._val;
      _t662 = ({_tag: 1, _name: "Some", _val: f(x)});
      break _t663;
    }
    if (_t661._tag === 0) {
      _t662 = ({_tag: 0, _name: "None"});
      break _t663;
    }
    _match_fail("line 37");
  }
  return _t662;
}
function Option$bind(f, opt) {
  let _t665;
  const _t664 = opt;
  _t666: {
    if (_t664._tag === 1) {
      const x = _t664._val;
      _t665 = f(x);
      break _t666;
    }
    if (_t664._tag === 0) {
      _t665 = ({_tag: 0, _name: "None"});
      break _t666;
    }
    _match_fail("line 37");
  }
  return _t665;
}
function Option$unwrap(opt) {
  let _t668;
  const _t667 = opt;
  _t669: {
    if (_t667._tag === 1) {
      const x = _t667._val;
      _t668 = x;
      break _t669;
    }
    _match_fail("line 37");
  }
  return _t668;
}
function Option$unwrap_or(_mml$default, opt) {
  let _t671;
  const _t670 = opt;
  _t672: {
    if (_t670._tag === 1) {
      const x = _t670._val;
      _t671 = x;
      break _t672;
    }
    if (_t670._tag === 0) {
      _t671 = _mml$default;
      break _t672;
    }
    _match_fail("line 37");
  }
  return _t671;
}
function Option$is_some(opt) {
  let _t674;
  const _t673 = opt;
  _t675: {
    if (_t673._tag === 1) {
      _t674 = true;
      break _t675;
    }
    if (_t673._tag === 0) {
      _t674 = false;
      break _t675;
    }
    _match_fail("line 37");
  }
  return _t674;
}
function Option$is_none(opt) {
  let _t677;
  const _t676 = opt;
  _t678: {
    if (_t676._tag === 1) {
      _t677 = false;
      break _t678;
    }
    if (_t676._tag === 0) {
      _t677 = true;
      break _t678;
    }
    _match_fail("line 37");
  }
  return _t677;
}
function Option$to_list(opt) {
  let _t680;
  const _t679 = opt;
  _t681: {
    if (_t679._tag === 1) {
      const x = _t679._val;
      _t680 = ({_hd: x, _tl: null});
      break _t681;
    }
    if (_t679._tag === 0) {
      _t680 = null;
      break _t681;
    }
    _match_fail("line 37");
  }
  return _t680;
}
function Option$iter(f, opt) {
  let _t683;
  const _t682 = opt;
  _t684: {
    if (_t682._tag === 1) {
      const x = _t682._val;
      _t683 = f(x);
      break _t684;
    }
    if (_t682._tag === 0) {
      _t683 = undefined;
      break _t684;
    }
    _match_fail("line 37");
  }
  return _t683;
}
function Option$flat_map(f, opt) {
  let _t686;
  const _t685 = opt;
  _t687: {
    if (_t685._tag === 1) {
      const x = _t685._val;
      _t686 = f(x);
      break _t687;
    }
    if (_t685._tag === 0) {
      _t686 = ({_tag: 0, _name: "None"});
      break _t687;
    }
    _match_fail("line 37");
  }
  return _t686;
}
function Buffer$create(n) {
  let _t688;
  if ((n < 16)) {
    _t688 = 16;
  } else {
    _t688 = n;
  }
  return ({data: Array$make(_t688, 0), len: 0});
}
function Buffer$length(buf) {
  return buf.len;
}
function Buffer$clear(buf) {
  return (buf.len = 0, undefined);
}
function Buffer$grow(buf, needed) {
  const cap_689 = Array$length(buf.data);
  let _t691;
  if (((buf.len + needed) > cap_689)) {
    const new_cap_692 = Math$max((cap_689 * 2), (buf.len + needed));
    const new_data_694 = Array$make(new_cap_692, 0);
    function copy(i) {
      while (true) {
        let _t696;
        if ((i < buf.len)) {
          Array$set(new_data_694, i, Array$get(buf.data, i));
          const _t697 = (i + 1);
          i = _t697;
          continue;
          _t696 = undefined;
        } else {
          _t696 = undefined;
        }
        return _t696;
      }
    }
    copy(0);
    const _t698 = (buf.data = new_data_694, undefined);
    const _t695 = _t698;
    const _t693 = _t695;
    _t691 = _t693;
  } else {
    _t691 = undefined;
  }
  const _t690 = _t691;
  return _t690;
}
function Buffer$add_byte(buf, b) {
  Buffer$grow(buf, 1);
  Array$set(buf.data, buf.len, b);
  return (buf.len = (buf.len + 1), undefined);
}
function Buffer$add_string(buf, s) {
  const bytes_699 = String$to_byte_array(s);
  const n_701 = Array$length(bytes_699);
  Buffer$grow(buf, n_701);
  function copy(i) {
    while (true) {
      let _t703;
      if ((i < n_701)) {
        Array$set(buf.data, (buf.len + i), Array$get(bytes_699, i));
        const _t704 = (i + 1);
        i = _t704;
        continue;
        _t703 = undefined;
      } else {
        _t703 = undefined;
      }
      return _t703;
    }
  }
  copy(0);
  const _t705 = (buf.len = (buf.len + n_701), undefined);
  const _t702 = _t705;
  const _t700 = _t702;
  return _t700;
}
function Buffer$sub(buf, pos, len) {
  return String$of_byte_array(Array$sub(buf.data, pos, len));
}
function Buffer$truncate(buf, n) {
  return (buf.len = n, undefined);
}
function Buffer$contents(buf) {
  return String$of_byte_array(Array$sub(buf.data, 0, buf.len));
}
function Buffer$add_buffer(dst, src) {
  const n_706 = src.len;
  Buffer$grow(dst, n_706);
  function copy(i) {
    while (true) {
      let _t708;
      if ((i < n_706)) {
        Array$set(dst.data, (dst.len + i), Array$get(src.data, i));
        const _t709 = (i + 1);
        i = _t709;
        continue;
        _t708 = undefined;
      } else {
        _t708 = undefined;
      }
      return _t708;
    }
  }
  copy(0);
  const _t710 = (dst.len = (dst.len + n_706), undefined);
  const _t707 = _t710;
  return _t707;
}
function Fmt$pad_left(n, c, s) {
  const len_711 = String$length(s);
  let _t713;
  if ((len_711 >= n)) {
    _t713 = s;
  } else {
    function pad(acc, remaining) {
      while (true) {
        let _t714;
        if ((remaining <= 0)) {
          _t714 = (acc + s);
        } else {
          const _t715 = (acc + c);
          const _t716 = (remaining - 1);
          acc = _t715;
          remaining = _t716;
          continue;
          _t714 = undefined;
        }
        return _t714;
      }
    }
    const _t717 = pad("", (n - len_711));
    _t713 = _t717;
  }
  const _t712 = _t713;
  return _t712;
}
function Fmt$pad_right(n, c, s) {
  const len_718 = String$length(s);
  let _t720;
  if ((len_718 >= n)) {
    _t720 = s;
  } else {
    function pad(acc, remaining) {
      while (true) {
        let _t721;
        if ((remaining <= 0)) {
          _t721 = (s + acc);
        } else {
          const _t722 = (acc + c);
          const _t723 = (remaining - 1);
          acc = _t722;
          remaining = _t723;
          continue;
          _t721 = undefined;
        }
        return _t721;
      }
    }
    const _t724 = pad("", (n - len_718));
    _t720 = _t724;
  }
  const _t719 = _t720;
  return _t719;
}
function Fmt$int_to_hex(n) {
  const digits_725 = "0123456789abcdef";
  let _t727;
  if ((n === 0)) {
    _t727 = "0";
  } else {
    function go(num, acc) {
      while (true) {
        let _t728;
        if ((num === 0)) {
          _t728 = acc;
        } else {
          const d_729 = (num % 16);
          let _t731;
          if ((d_729 < 0)) {
            _t731 = (d_729 + 16);
          } else {
            _t731 = d_729;
          }
          const d_732 = _t731;
          const ch_734 = String$sub(digits_725, d_732, 1);
          const _t736 = ((num / 16) | 0);
          const _t737 = (ch_734 + acc);
          num = _t736;
          acc = _t737;
          continue;
          const _t735 = undefined;
          const _t733 = _t735;
          const _t730 = _t733;
          _t728 = _t730;
        }
        return _t728;
      }
    }
    let _t739;
    if ((n < 0)) {
      _t739 = (0 - n);
    } else {
      _t739 = n;
    }
    const abs_n_740 = _t739;
    const hex_742 = go(abs_n_740, "");
    let _t744;
    if ((n < 0)) {
      _t744 = ("-" + hex_742);
    } else {
      _t744 = hex_742;
    }
    const _t743 = _t744;
    const _t741 = _t743;
    const _t738 = _t741;
    _t727 = _t738;
  }
  const _t726 = _t727;
  return _t726;
}
function Fmt$int_to_bin(n) {
  let _t745;
  if ((n === 0)) {
    _t745 = "0";
  } else {
    function go(num, acc) {
      while (true) {
        let _t746;
        if ((num === 0)) {
          _t746 = acc;
        } else {
          let _t747;
          if (((num % 2) === 0)) {
            _t747 = "0";
          } else {
            _t747 = "1";
          }
          const bit_748 = _t747;
          const _t750 = ((num / 2) | 0);
          const _t751 = (bit_748 + acc);
          num = _t750;
          acc = _t751;
          continue;
          const _t749 = undefined;
          _t746 = _t749;
        }
        return _t746;
      }
    }
    let _t753;
    if ((n < 0)) {
      _t753 = (0 - n);
    } else {
      _t753 = n;
    }
    const abs_n_754 = _t753;
    const bin_756 = go(abs_n_754, "");
    let _t758;
    if ((n < 0)) {
      _t758 = ("-" + bin_756);
    } else {
      _t758 = bin_756;
    }
    const _t757 = _t758;
    const _t755 = _t757;
    const _t752 = _t755;
    _t745 = _t752;
  }
  return _t745;
}
function Fmt$int_to_oct(n) {
  let _t759;
  if ((n === 0)) {
    _t759 = "0";
  } else {
    function go(num, acc) {
      while (true) {
        let _t760;
        if ((num === 0)) {
          _t760 = acc;
        } else {
          const d_761 = (num % 8);
          let _t763;
          if ((d_761 < 0)) {
            _t763 = (d_761 + 8);
          } else {
            _t763 = d_761;
          }
          const d_764 = _t763;
          const _t766 = ((num / 8) | 0);
          const _t767 = (__dict_Show_int.show(d_764) + acc);
          num = _t766;
          acc = _t767;
          continue;
          const _t765 = undefined;
          const _t762 = _t765;
          _t760 = _t762;
        }
        return _t760;
      }
    }
    let _t769;
    if ((n < 0)) {
      _t769 = (0 - n);
    } else {
      _t769 = n;
    }
    const abs_n_770 = _t769;
    const oct_772 = go(abs_n_770, "");
    let _t774;
    if ((n < 0)) {
      _t774 = ("-" + oct_772);
    } else {
      _t774 = oct_772;
    }
    const _t773 = _t774;
    const _t771 = _t773;
    const _t768 = _t771;
    _t759 = _t768;
  }
  return _t759;
}
function Fmt$zero_pad(width, s) {
  return Fmt$pad_left(width, "0", s);
}
function _t775(n) {
  return n;
}
const __dict_Hash_int = ({hash: _t775});
function _t776(s) {
  const bytes_777 = String$to_byte_array(s);
  function _t779(h, b) {
    return ((h * 31) + Byte$to_int(b));
  }
  const _t778 = __dict_Iter_g0_array__g0.fold(_t779, 5381, bytes_777);
  return _t778;
}
const __dict_Hash_string = ({hash: _t776});
function _t780(b) {
  let _t781;
  if (b) {
    _t781 = 1;
  } else {
    _t781 = 0;
  }
  return _t781;
}
const __dict_Hash_bool = ({hash: _t780});
function _t782(b) {
  return Byte$to_int(b);
}
const __dict_Hash_byte = ({hash: _t782});
function _t783(r) {
  return Rune$to_int(r);
}
const __dict_Hash_rune = ({hash: _t783});
function Hashtbl$create(n) {
  let _t784;
  if ((n < 16)) {
    _t784 = 16;
  } else {
    _t784 = n;
  }
  const cap_785 = _t784;
  const _t786 = ({buckets: Array$make(cap_785, null), size: 0});
  return _t786;
}
function Hashtbl$clear(tbl) {
  const cap_787 = Array$length(tbl.buckets);
  (tbl.buckets = Array$make(cap_787, null), undefined);
  const _t788 = (tbl.size = 0, undefined);
  return _t788;
}
function Hashtbl$length(tbl) {
  return tbl.size;
}
function Hashtbl$bucket_index(__dict_Hash_0, tbl, key) {
  const h_789 = __dict_Hash_0.hash(key);
  let _t791;
  if ((h_789 < 0)) {
    _t791 = (0 - h_789);
  } else {
    _t791 = h_789;
  }
  const h_792 = _t791;
  const _t793 = (h_792 % Array$length(tbl.buckets));
  const _t790 = _t793;
  return _t790;
}
function Hashtbl$to_list(tbl) {
  const cap_794 = Array$length(tbl.buckets);
  function collect(i, acc) {
    while (true) {
      let _t796;
      if ((i >= cap_794)) {
        _t796 = acc;
      } else {
        const bucket_797 = Array$get(tbl.buckets, i);
        const _t799 = (i + 1);
        const _t800 = List$concat(bucket_797, acc);
        i = _t799;
        acc = _t800;
        continue;
        const _t798 = undefined;
        _t796 = _t798;
      }
      return _t796;
    }
  }
  const _t801 = collect(0, null);
  const _t795 = _t801;
  return _t795;
}
function Hashtbl$rehash(tbl, hash_fn) {
  const entries_802 = Hashtbl$to_list(tbl);
  const new_cap_804 = (Array$length(tbl.buckets) * 2);
  (tbl.buckets = Array$make(new_cap_804, null), undefined);
  (tbl.size = 0, undefined);
  function _t806(_, __p27) {
    let _t808;
    const _t807 = __p27;
    _t809: {
      if (true) {
        const k = _t807[0];
        const v = _t807[1];
        const h_810 = hash_fn(k);
        let _t812;
        if ((h_810 < 0)) {
          _t812 = (0 - h_810);
        } else {
          _t812 = h_810;
        }
        const h_813 = _t812;
        const idx_815 = (h_813 % new_cap_804);
        const bucket_817 = Array$get(tbl.buckets, idx_815);
        Array$set(tbl.buckets, idx_815, ({_hd: [k, v], _tl: bucket_817}));
        const _t818 = (tbl.size = (tbl.size + 1), undefined);
        const _t816 = _t818;
        const _t814 = _t816;
        const _t811 = _t814;
        _t808 = _t811;
        break _t809;
      }
      _match_fail("line 106");
    }
    return _t808;
  }
  const _t805 = List$fold(_t806, undefined, entries_802);
  const _t803 = _t805;
  return _t803;
}
function Hashtbl$set(__dict_Hash_1, __dict_Eq_1, tbl, key, value) {
  const idx_819 = _call(Hashtbl$bucket_index, [__dict_Hash_1, tbl, key]);
  const bucket_821 = Array$get(tbl.buckets, idx_819);
  function replace(__x) {
    let _t824;
    const _t823 = __x;
    _t825: {
      if (_t823 === null) {
        _t824 = ({_hd: [key, value], _tl: null});
        break _t825;
      }
      if (_t823 !== null) {
        const k = _t823._hd[0];
        const v = _t823._hd[1];
        const rest = _t823._tl;
        let _t826;
        if (_call(__dict_Eq_1.$eq, [k, key])) {
          _t826 = ({_hd: [key, value], _tl: rest});
        } else {
          _t826 = ({_hd: [k, v], _tl: replace(rest)});
        }
        _t824 = _t826;
        break _t825;
      }
      _match_fail("line 106");
    }
    return _t824;
  }
  const new_bucket_828 = replace(bucket_821);
  const grew_830 = (List$length(new_bucket_828) > List$length(bucket_821));
  Array$set(tbl.buckets, idx_819, new_bucket_828);
  let _t832;
  if (grew_830) {
    (tbl.size = (tbl.size + 1), undefined);
    let _t833;
    if ((tbl.size > (Array$length(tbl.buckets) * 2))) {
      _t833 = Hashtbl$rehash(tbl, __dict_Hash_1.hash);
    } else {
      _t833 = undefined;
    }
    _t832 = _t833;
  } else {
    _t832 = undefined;
  }
  const _t831 = _t832;
  const _t829 = _t831;
  const _t827 = _t829;
  const _t822 = _t827;
  const _t820 = _t822;
  return _t820;
}
function Hashtbl$get(__dict_Hash_1, __dict_Eq_1, tbl, key) {
  const idx_834 = _call(Hashtbl$bucket_index, [__dict_Hash_1, tbl, key]);
  const bucket_836 = Array$get(tbl.buckets, idx_834);
  function find(__x) {
    while (true) {
      let _t839;
      const _t838 = __x;
      _t840: {
        if (_t838 === null) {
          _t839 = ({_tag: 0, _name: "None"});
          break _t840;
        }
        if (_t838 !== null) {
          const k = _t838._hd[0];
          const v = _t838._hd[1];
          const rest = _t838._tl;
          let _t841;
          if (_call(__dict_Eq_1.$eq, [k, key])) {
            _t841 = ({_tag: 1, _name: "Some", _val: v});
          } else {
            const _t842 = rest;
            __x = _t842;
            continue;
            _t841 = undefined;
          }
          _t839 = _t841;
          break _t840;
        }
        _match_fail("line 106");
      }
      return _t839;
    }
  }
  const _t843 = find(bucket_836);
  const _t837 = _t843;
  const _t835 = _t837;
  return _t835;
}
function Hashtbl$has(__dict_Hash_0, __dict_Eq_0, tbl, key) {
  let _t845;
  const _t844 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, tbl, key]);
  _t846: {
    if (_t844._tag === 1) {
      _t845 = true;
      break _t846;
    }
    if (_t844._tag === 0) {
      _t845 = false;
      break _t846;
    }
    _match_fail("line 106");
  }
  return _t845;
}
function Hashtbl$remove(__dict_Hash_0, __dict_Eq_0, tbl, key) {
  const idx_847 = _call(Hashtbl$bucket_index, [__dict_Hash_0, tbl, key]);
  const bucket_849 = Array$get(tbl.buckets, idx_847);
  function _t851(__p28) {
    let _t853;
    const _t852 = __p28;
    _t854: {
      if (true) {
        const k = _t852[0];
        _t853 = _call(__dict_Eq_0.$lt$gt, [k, key]);
        break _t854;
      }
      _match_fail("line 106");
    }
    return _t853;
  }
  const new_bucket_855 = List$filter(_t851, bucket_849);
  let _t857;
  if ((List$length(new_bucket_855) < List$length(bucket_849))) {
    _t857 = (tbl.size = (tbl.size - 1), undefined);
  } else {
    _t857 = undefined;
  }
  _t857;
  const _t856 = Array$set(tbl.buckets, idx_847, new_bucket_855);
  const _t850 = _t856;
  const _t848 = _t850;
  return _t848;
}
function Hashtbl$find(__dict_Hash_1, __dict_Eq_1, tbl, key) {
  let _t859;
  const _t858 = _call(Hashtbl$get, [__dict_Hash_1, __dict_Eq_1, tbl, key]);
  _t860: {
    if (_t858._tag === 1) {
      const v = _t858._val;
      _t859 = v;
      break _t860;
    }
    if (_t858._tag === 0) {
      _t859 = failwith("Hashtbl.find: key not found");
      break _t860;
    }
    _match_fail("line 106");
  }
  return _t859;
}
function Hashtbl$fold(f, tbl, acc) {
  const entries_861 = Hashtbl$to_list(tbl);
  function _t863(a, __p29) {
    let _t865;
    const _t864 = __p29;
    _t866: {
      if (true) {
        const k = _t864[0];
        const v = _t864[1];
        _t865 = f(k, v, a);
        break _t866;
      }
      _match_fail("line 106");
    }
    return _t865;
  }
  const _t862 = List$fold(_t863, acc, entries_861);
  return _t862;
}
function Hashtbl$iter(f, tbl) {
  const entries_867 = Hashtbl$to_list(tbl);
  function _t869(__p30) {
    let _t871;
    const _t870 = __p30;
    _t872: {
      if (true) {
        const k = _t870[0];
        const v = _t870[1];
        _t871 = f(k, v);
        break _t872;
      }
      _match_fail("line 106");
    }
    return _t871;
  }
  const _t868 = List$iter(_t869, entries_867);
  return _t868;
}
function Hashtbl$keys(tbl) {
  function _t873(__p31) {
    let _t875;
    const _t874 = __p31;
    _t876: {
      if (true) {
        const k = _t874[0];
        _t875 = k;
        break _t876;
      }
      _match_fail("line 106");
    }
    return _t875;
  }
  return List$map(_t873, Hashtbl$to_list(tbl));
}
function Hashtbl$values(tbl) {
  function _t877(__p32) {
    let _t879;
    const _t878 = __p32;
    _t880: {
      if (true) {
        const v = _t878[1];
        _t879 = v;
        break _t880;
      }
      _match_fail("line 106");
    }
    return _t879;
  }
  return List$map(_t877, Hashtbl$to_list(tbl));
}
function Ref$create(v) {
  return ({contents: v});
}
function Ref$get(r) {
  return r.contents;
}
function Ref$set(r, v) {
  return (r.contents = v, undefined);
}
function Dynarray$create(n, _mml$default) {
  let _t881;
  if ((n < 16)) {
    _t881 = 16;
  } else {
    _t881 = n;
  }
  return ({arr: Array$make(_t881, _mml$default), count: 0});
}
function Dynarray$length(d) {
  return d.count;
}
function Dynarray$get(d, i) {
  let _t882;
  if (((i < 0) || (i >= d.count))) {
    _t882 = failwith("Dynarray.get: index out of bounds");
  } else {
    _t882 = Array$get(d.arr, i);
  }
  return _t882;
}
function Dynarray$set(d, i, v) {
  let _t883;
  if (((i < 0) || (i >= d.count))) {
    _t883 = failwith("Dynarray.set: index out of bounds");
  } else {
    _t883 = Array$set(d.arr, i, v);
  }
  return _t883;
}
function Dynarray$grow(d, needed, _mml$default) {
  const cap_884 = Array$length(d.arr);
  let _t886;
  if (((d.count + needed) > cap_884)) {
    const new_cap_887 = Math$max((cap_884 * 2), (d.count + needed));
    const new_arr_889 = Array$make(new_cap_887, _mml$default);
    function copy(i) {
      while (true) {
        let _t891;
        if ((i < d.count)) {
          Array$set(new_arr_889, i, Array$get(d.arr, i));
          const _t892 = (i + 1);
          i = _t892;
          continue;
          _t891 = undefined;
        } else {
          _t891 = undefined;
        }
        return _t891;
      }
    }
    copy(0);
    const _t893 = (d.arr = new_arr_889, undefined);
    const _t890 = _t893;
    const _t888 = _t890;
    _t886 = _t888;
  } else {
    _t886 = undefined;
  }
  const _t885 = _t886;
  return _t885;
}
function Dynarray$empty(_) {
  return ({arr: {_arr: []}, count: 0});
}
function Dynarray$push(d, v) {
  Dynarray$grow(d, 1, v);
  Array$set(d.arr, d.count, v);
  return (d.count = (d.count + 1), undefined);
}
function Dynarray$pop(d) {
  let _t894;
  if ((d.count === 0)) {
    _t894 = failwith("Dynarray.pop: empty");
  } else {
    _t894 = (d.count = (d.count - 1), undefined);
  }
  _t894;
  return Array$get(d.arr, d.count);
}
function Dynarray$clear(d) {
  return (d.count = 0, undefined);
}
function Dynarray$to_list(d) {
  function collect(i, acc) {
    while (true) {
      let _t895;
      if ((i < 0)) {
        _t895 = acc;
      } else {
        const _t896 = (i - 1);
        const _t897 = ({_hd: Dynarray$get(d, i), _tl: acc});
        i = _t896;
        acc = _t897;
        continue;
        _t895 = undefined;
      }
      return _t895;
    }
  }
  const _t898 = collect((d.count - 1), null);
  return _t898;
}
function Dynarray$to_array(d) {
  return Array$sub(d.arr, 0, d.count);
}
function compare(a, b) {
  let _t899;
  if ((a < b)) {
    _t899 = (-1);
  } else {
    let _t900;
    if ((a > b)) {
      _t900 = 1;
    } else {
      _t900 = 0;
    }
    _t899 = _t900;
  }
  return _t899;
}
function int_of_string(s) {
  let _t902;
  const _t901 = String$to_int(s);
  _t903: {
    if (_t901._tag === 1) {
      const n = _t901._val;
      _t902 = n;
      break _t903;
    }
    if (_t901._tag === 0) {
      _t902 = failwith((("int_of_string: invalid argument \"" + __dict_Show_string.show(s)) + "\""));
      break _t903;
    }
    _match_fail("line 27");
  }
  return _t902;
}
function float_of_string(s) {
  let _t905;
  const _t904 = String$to_float(s);
  _t906: {
    if (_t904._tag === 1) {
      const f = _t904._val;
      _t905 = f;
      break _t906;
    }
    if (_t904._tag === 0) {
      _t905 = failwith((("float_of_string: invalid argument \"" + __dict_Show_string.show(s)) + "\""));
      break _t906;
    }
    _match_fail("line 27");
  }
  return _t905;
}
function max(a, b) {
  let _t907;
  if ((a > b)) {
    _t907 = a;
  } else {
    _t907 = b;
  }
  return _t907;
}
function min(a, b) {
  let _t908;
  if ((a < b)) {
    _t908 = a;
  } else {
    _t908 = b;
  }
  return _t908;
}
function fst(__p33) {
  let _t910;
  const _t909 = __p33;
  _t911: {
    if (true) {
      const a = _t909[0];
      _t910 = a;
      break _t911;
    }
    _match_fail("line 27");
  }
  return _t910;
}
function snd(__p34) {
  let _t913;
  const _t912 = __p34;
  _t914: {
    if (true) {
      const b = _t912[1];
      _t913 = b;
      break _t914;
    }
    _match_fail("line 27");
  }
  return _t913;
}
function list_find(f, xs) {
  let _t916;
  const _t915 = List$find(f, xs);
  _t917: {
    if (_t915._tag === 1) {
      const x = _t915._val;
      _t916 = x;
      break _t917;
    }
    if (_t915._tag === 0) {
      _t916 = failwith("list_find: not found");
      break _t917;
    }
    _match_fail("line 27");
  }
  return _t916;
}
if (typeof Runtime$eval === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Runtime.eval"]) var Runtime$eval = globalThis._mmlExterns["Runtime.eval"]; else throw new Error("extern " + "Runtime.eval" + " not provided"); }
if (typeof Runtime$eval_file === "undefined") { if (globalThis._mmlExterns && globalThis._mmlExterns["Runtime.eval_file"]) var Runtime$eval_file = globalThis._mmlExterns["Runtime.eval_file"]; else throw new Error("extern " + "Runtime.eval_file" + " not provided"); }
// --- Compiled MiniML ---
let _last_val;
const Token$dummy_loc = ({col: 0, line: 0, offset: 0});
function Token$pp_token_kind(__x) {
  let _t919;
  const _t918 = __x;
  _t920: {
    if (_t918._tag === 0) {
      const n = _t918._val;
      _t919 = (("INT(" + __dict_Show_int.show(n)) + ")");
      break _t920;
    }
    if (_t918._tag === 1) {
      const f = _t918._val;
      _t919 = (("FLOAT(" + __dict_Show_float.show(f)) + ")");
      break _t920;
    }
    if (_t918._tag === 2) {
      const s = _t918._val;
      _t919 = (("STRING(" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 3) {
      _t919 = "INTERP_STRING";
      break _t920;
    }
    if (_t918._tag === 4) {
      const n = _t918._val;
      _t919 = (("BYTE(#" + __fmt_zero_pad(2, __fmt_hex(n))) + ")");
      break _t920;
    }
    if (_t918._tag === 5) {
      const n = _t918._val;
      _t919 = (("RUNE(" + __dict_Show_int.show(n)) + ")");
      break _t920;
    }
    if (_t918._tag === 6) {
      _t919 = "TRUE";
      break _t920;
    }
    if (_t918._tag === 7) {
      _t919 = "FALSE";
      break _t920;
    }
    if (_t918._tag === 8) {
      const s = _t918._val;
      _t919 = (("IDENT(" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 9) {
      const s = _t918._val;
      _t919 = (("UIDENT(" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 10) {
      const s = _t918._val;
      _t919 = (("TYVAR('" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 11) {
      _t919 = "LET";
      break _t920;
    }
    if (_t918._tag === 12) {
      _t919 = "REC";
      break _t920;
    }
    if (_t918._tag === 13) {
      _t919 = "IN";
      break _t920;
    }
    if (_t918._tag === 14) {
      _t919 = "IF";
      break _t920;
    }
    if (_t918._tag === 15) {
      _t919 = "ELSE";
      break _t920;
    }
    if (_t918._tag === 16) {
      _t919 = "FN";
      break _t920;
    }
    if (_t918._tag === 17) {
      _t919 = "MATCH";
      break _t920;
    }
    if (_t918._tag === 18) {
      _t919 = "WITH";
      break _t920;
    }
    if (_t918._tag === 19) {
      _t919 = "TYPE";
      break _t920;
    }
    if (_t918._tag === 20) {
      _t919 = "NEWTYPE";
      break _t920;
    }
    if (_t918._tag === 21) {
      _t919 = "OF";
      break _t920;
    }
    if (_t918._tag === 22) {
      _t919 = "CLASS";
      break _t920;
    }
    if (_t918._tag === 23) {
      _t919 = "INSTANCE";
      break _t920;
    }
    if (_t918._tag === 24) {
      _t919 = "EFFECT";
      break _t920;
    }
    if (_t918._tag === 25) {
      _t919 = "EXTERN";
      break _t920;
    }
    if (_t918._tag === 65) {
      _t919 = "PERFORM";
      break _t920;
    }
    if (_t918._tag === 66) {
      _t919 = "HANDLE";
      break _t920;
    }
    if (_t918._tag === 28) {
      _t919 = "TRY";
      break _t920;
    }
    if (_t918._tag === 29) {
      _t919 = "PROVIDE";
      break _t920;
    }
    if (_t918._tag === 30) {
      _t919 = "CONTINUE";
      break _t920;
    }
    if (_t918._tag === 67) {
      _t919 = "RESUME";
      break _t920;
    }
    if (_t918._tag === 44) {
      _t919 = "RETURN";
      break _t920;
    }
    if (_t918._tag === 33) {
      _t919 = "MUT";
      break _t920;
    }
    if (_t918._tag === 34) {
      _t919 = "FOR";
      break _t920;
    }
    if (_t918._tag === 35) {
      _t919 = "DO";
      break _t920;
    }
    if (_t918._tag === 36) {
      _t919 = "BREAK";
      break _t920;
    }
    if (_t918._tag === 37) {
      _t919 = "WHEN";
      break _t920;
    }
    if (_t918._tag === 38) {
      _t919 = "WHERE";
      break _t920;
    }
    if (_t918._tag === 39) {
      _t919 = "PARTIAL";
      break _t920;
    }
    if (_t918._tag === 30) {
      _t919 = "NOT";
      break _t920;
    }
    if (_t918._tag === 41) {
      _t919 = "HASH";
      break _t920;
    }
    if (_t918._tag === 42) {
      _t919 = "FATARROW";
      break _t920;
    }
    if (_t918._tag === 17) {
      _t919 = "MOD";
      break _t920;
    }
    if (_t918._tag === 44) {
      _t919 = "MODULE";
      break _t920;
    }
    if (_t918._tag === 45) {
      _t919 = "PUB";
      break _t920;
    }
    if (_t918._tag === 46) {
      _t919 = "OPEN";
      break _t920;
    }
    if (_t918._tag === 47) {
      _t919 = "END";
      break _t920;
    }
    if (_t918._tag === 48) {
      _t919 = "OPAQUE";
      break _t920;
    }
    if (_t918._tag === 49) {
      _t919 = "WHILE";
      break _t920;
    }
    if (_t918._tag === 50) {
      _t919 = "AND";
      break _t920;
    }
    if (_t918._tag === 51) {
      _t919 = "DERIVING";
      break _t920;
    }
    if (_t918._tag === 52) {
      _t919 = "LPAREN";
      break _t920;
    }
    if (_t918._tag === 53) {
      _t919 = "RPAREN";
      break _t920;
    }
    if (_t918._tag === 54) {
      _t919 = "LBRACE";
      break _t920;
    }
    if (_t918._tag === 55) {
      _t919 = "RBRACE";
      break _t920;
    }
    if (_t918._tag === 56) {
      _t919 = "LBRACKET";
      break _t920;
    }
    if (_t918._tag === 57) {
      _t919 = "RBRACKET";
      break _t920;
    }
    if (_t918._tag === 58) {
      _t919 = "ARROW";
      break _t920;
    }
    if (_t918._tag === 59) {
      _t919 = "COMMA";
      break _t920;
    }
    if (_t918._tag === 60) {
      _t919 = "SEMICOLON";
      break _t920;
    }
    if (_t918._tag === 61) {
      _t919 = "DOUBLE_SEMICOLON";
      break _t920;
    }
    if (_t918._tag === 62) {
      _t919 = "COLON";
      break _t920;
    }
    if (_t918._tag === 63) {
      _t919 = "DOT";
      break _t920;
    }
    if (_t918._tag === 64) {
      _t919 = "DOTDOT";
      break _t920;
    }
    if (_t918._tag === 65) {
      _t919 = "PIPE";
      break _t920;
    }
    if (_t918._tag === 66) {
      _t919 = "PIPEARROW";
      break _t920;
    }
    if (_t918._tag === 67) {
      _t919 = "UNDERSCORE";
      break _t920;
    }
    if (_t918._tag === 68) {
      _t919 = "PLUS";
      break _t920;
    }
    if (_t918._tag === 69) {
      _t919 = "MINUS";
      break _t920;
    }
    if (_t918._tag === 70) {
      _t919 = "STAR";
      break _t920;
    }
    if (_t918._tag === 71) {
      _t919 = "SLASH";
      break _t920;
    }
    if (_t918._tag === 72) {
      _t919 = "CARET";
      break _t920;
    }
    if (_t918._tag === 73) {
      _t919 = "COLONCOLON";
      break _t920;
    }
    if (_t918._tag === 74) {
      _t919 = "COLONEQUAL";
      break _t920;
    }
    if (_t918._tag === 24) {
      _t919 = "EQ";
      break _t920;
    }
    if (_t918._tag === 25) {
      _t919 = "NEQ";
      break _t920;
    }
    if (_t918._tag === 26) {
      _t919 = "LT";
      break _t920;
    }
    if (_t918._tag === 27) {
      _t919 = "GT";
      break _t920;
    }
    if (_t918._tag === 28) {
      _t919 = "LE";
      break _t920;
    }
    if (_t918._tag === 29) {
      _t919 = "GE";
      break _t920;
    }
    if (_t918._tag === 81) {
      _t919 = "AMPAMP";
      break _t920;
    }
    if (_t918._tag === 82) {
      _t919 = "PIPEPIPE";
      break _t920;
    }
    if (_t918._tag === 83) {
      _t919 = "LAND";
      break _t920;
    }
    if (_t918._tag === 84) {
      _t919 = "LOR";
      break _t920;
    }
    if (_t918._tag === 85) {
      _t919 = "LXOR";
      break _t920;
    }
    if (_t918._tag === 86) {
      _t919 = "LNOT";
      break _t920;
    }
    if (_t918._tag === 87) {
      _t919 = "LSL";
      break _t920;
    }
    if (_t918._tag === 88) {
      _t919 = "LSR";
      break _t920;
    }
    if (_t918._tag === 89) {
      const s = _t918._val;
      _t919 = (("POLYTAG(`" + __dict_Show_string.show(s)) + ")");
      break _t920;
    }
    if (_t918._tag === 90) {
      const s = _t918._val;
      _t919 = (("BACKTICK_INFIX(`" + __dict_Show_string.show(s)) + "`)");
      break _t920;
    }
    if (_t918._tag === 91) {
      _t919 = "COLONGT";
      break _t920;
    }
    if (_t918._tag === 92) {
      _t919 = "EOF";
      break _t920;
    }
    _match_fail("line 16933");
  }
  return _t919;
}
function Token$pp_token(t) {
  return ((((__dict_Show_string.show(Token$pp_token_kind(t.kind)) + "@") + __dict_Show_int.show(t.loc.line)) + ":") + __dict_Show_int.show(t.loc.col));
}
function Bytecode$make_record_shape(field_names) {
  const fields_921 = Array$of_list(field_names);
  const index_923 = Hashtbl$create(Array$length(fields_921));
  function _t925(i, name) {
    return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, index_923, name, i]);
  }
  Array$iteri(_t925, fields_921);
  const _t924 = ({rs_fields: fields_921, rs_index: index_923});
  const _t922 = _t924;
  return _t922;
}
function Bytecode$make_record(field_names, values) {
  const shape_926 = Bytecode$make_record_shape(field_names);
  const _t927 = ({_tag: 9, _name: "VRecord", _val: [shape_926, values]});
  return _t927;
}
function Bytecode$pp_value(__x) {
  let _t929;
  const _t928 = __x;
  _t930: {
    if (_t928._tag === 0) {
      const n = _t928._val;
      _t929 = string_of_int(n);
      break _t930;
    }
    if (_t928._tag === 1) {
      const f = _t928._val;
      const s_931 = __dict_Show_float.show(f);
      let _t933;
      if ((String$contains(".", s_931) || String$contains("e", s_931))) {
        _t933 = s_931;
      } else {
        _t933 = (s_931 + ".");
      }
      const _t932 = _t933;
      _t929 = _t932;
      break _t930;
    }
    if (_t928._tag === 2 && _t928._val) {
      _t929 = "true";
      break _t930;
    }
    if (_t928._tag === 2 && !_t928._val) {
      _t929 = "false";
      break _t930;
    }
    if (_t928._tag === 3) {
      const s = _t928._val;
      _t929 = s;
      break _t930;
    }
    if (_t928._tag === 4) {
      const n = _t928._val;
      _t929 = ("#" + __fmt_zero_pad(2, __fmt_hex(n)));
      break _t930;
    }
    if (_t928._tag === 5) {
      const cp = _t928._val;
      let _t934;
      if ((cp < 128)) {
        _t934 = (("'" + __dict_Show_byte.show(Byte$of_int(cp))) + "'");
      } else {
        const buf_935 = Buffer$create(6);
        Buffer$add_byte(buf_935, 39);
        let _t937;
        if ((cp < 2048)) {
          Buffer$add_byte(buf_935, Byte$of_int((192 | (cp >> 6))));
          _t937 = Buffer$add_byte(buf_935, Byte$of_int((128 | (cp & 63))));
        } else {
          let _t938;
          if ((cp < 65536)) {
            Buffer$add_byte(buf_935, Byte$of_int((224 | (cp >> 12))));
            Buffer$add_byte(buf_935, Byte$of_int((128 | ((cp >> 6) & 63))));
            _t938 = Buffer$add_byte(buf_935, Byte$of_int((128 | (cp & 63))));
          } else {
            Buffer$add_byte(buf_935, Byte$of_int((240 | (cp >> 18))));
            Buffer$add_byte(buf_935, Byte$of_int((128 | ((cp >> 12) & 63))));
            Buffer$add_byte(buf_935, Byte$of_int((128 | ((cp >> 6) & 63))));
            _t938 = Buffer$add_byte(buf_935, Byte$of_int((128 | (cp & 63))));
          }
          _t937 = _t938;
        }
        _t937;
        Buffer$add_byte(buf_935, 39);
        const _t936 = Buffer$contents(buf_935);
        _t934 = _t936;
      }
      _t929 = _t934;
      break _t930;
    }
    if (_t928._tag === 6) {
      _t929 = "()";
      break _t930;
    }
    if (_t928._tag === 7) {
      const vs = _t928._val;
      _t929 = ("(" + (String$concat(", ", Array$to_list(Array$map(Bytecode$pp_value, vs))) + ")"));
      break _t930;
    }
    if (_t928._tag === 8) {
      const vs = _t928._val;
      _t929 = ("[" + (String$concat("; ", List$map(Bytecode$pp_value, vs)) + "]"));
      break _t930;
    }
    if (_t928._tag === 9) {
      const shape = _t928._val[0];
      const values = _t928._val[1];
      function _t939(i) {
        return (Array$get(shape.rs_fields, i) + (" = " + Bytecode$pp_value(Array$get(values, i))));
      }
      _t929 = ("{ " + (String$concat("; ", List$init(Array$length(shape.rs_fields), _t939)) + " }"));
      break _t930;
    }
    if (_t928._tag === 10 && _t928._val[2]._tag === 0) {
      const name = _t928._val[1];
      _t929 = name;
      break _t930;
    }
    if (_t928._tag === 10 && _t928._val[2]._tag === 1) {
      const name = _t928._val[1];
      const v = _t928._val[2]._val;
      let _t941;
      const _t940 = v;
      _t942: {
        if ((_t940._tag === 7 || _t940._tag === 10 && _t940._val[2]._tag === 1)) {
          _t941 = ("(" + (Bytecode$pp_value(v) + ")"));
          break _t942;
        }
        if (true) {
          _t941 = Bytecode$pp_value(v);
          break _t942;
        }
        _match_fail("line 16933");
      }
      _t929 = (name + (" " + _t941));
      break _t930;
    }
    if (_t928._tag === 11) {
      _t929 = "<fun>";
      break _t930;
    }
    if (_t928._tag === 12) {
      _t929 = "<fun>";
      break _t930;
    }
    if (_t928._tag === 14) {
      const ext = _t928._val;
      let _t943;
      if (_eq(ext.ext_args, null)) {
        _t943 = (("<external:" + __dict_Show_string.show(ext.ext_name)) + ">");
      } else {
        _t943 = "<fun>";
      }
      _t929 = _t943;
      break _t930;
    }
    if (_t928._tag === 13) {
      const p = _t928._val;
      _t929 = (("<proto:" + __dict_Show_string.show(p.name)) + ">");
      break _t930;
    }
    if (_t928._tag === 15) {
      _t929 = "<continuation>";
      break _t930;
    }
    if (_t928._tag === 16) {
      const r = _t928._val;
      _t929 = (("ref(" + __dict_Show_string.show(Bytecode$pp_value(Ref$get(r)))) + ")");
      break _t930;
    }
    if (_t928._tag === 17) {
      const arr = _t928._val;
      _t929 = ("#[" + (String$concat("; ", Array$to_list(Array$map(Bytecode$pp_value, arr))) + "]"));
      break _t930;
    }
    _match_fail("line 16933");
  }
  return _t929;
}
function Bytecode$pp_capture(__x) {
  let _t945;
  const _t944 = __x;
  _t946: {
    if (_t944._tag === 0) {
      const i = _t944._val;
      _t945 = (("local(" + __dict_Show_int.show(i)) + ")");
      break _t946;
    }
    if (_t944._tag === 1) {
      const i = _t944._val;
      _t945 = (("upvalue(" + __dict_Show_int.show(i)) + ")");
      break _t946;
    }
    _match_fail("line 16933");
  }
  return _t945;
}
function Bytecode$pp_opcode(__x) {
  let _t948;
  const _t947 = __x;
  _t949: {
    if (_t947._tag === 0) {
      const i = _t947._val;
      _t948 = ("CONST " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 1) {
      _t948 = "POP";
      break _t949;
    }
    if (_t947._tag === 2) {
      _t948 = "DUP";
      break _t949;
    }
    if (_t947._tag === 3) {
      const i = _t947._val;
      _t948 = ("GET_LOCAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 4) {
      const i = _t947._val;
      _t948 = ("SET_LOCAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 5) {
      const i = _t947._val;
      _t948 = ("GET_UPVALUE " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 6) {
      const i = _t947._val;
      _t948 = ("SET_UPVALUE " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 7) {
      _t948 = "MAKE_REF";
      break _t949;
    }
    if (_t947._tag === 8) {
      _t948 = "DEREF";
      break _t949;
    }
    if (_t947._tag === 9) {
      _t948 = "SET_REF";
      break _t949;
    }
    if (_t947._tag === 10) {
      const i = _t947._val;
      _t948 = ("GET_GLOBAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 11) {
      const i = _t947._val;
      _t948 = ("SET_GLOBAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 12) {
      const i = _t947._val;
      _t948 = ("DEF_GLOBAL " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 13) {
      _t948 = "ADD";
      break _t949;
    }
    if (_t947._tag === 14) {
      _t948 = "SUB";
      break _t949;
    }
    if (_t947._tag === 15) {
      _t948 = "MUL";
      break _t949;
    }
    if (_t947._tag === 16) {
      _t948 = "DIV";
      break _t949;
    }
    if (_t947._tag === 17) {
      _t948 = "MOD";
      break _t949;
    }
    if (_t947._tag === 18) {
      _t948 = "NEG";
      break _t949;
    }
    if (_t947._tag === 19) {
      _t948 = "FADD";
      break _t949;
    }
    if (_t947._tag === 20) {
      _t948 = "FSUB";
      break _t949;
    }
    if (_t947._tag === 21) {
      _t948 = "FMUL";
      break _t949;
    }
    if (_t947._tag === 22) {
      _t948 = "FDIV";
      break _t949;
    }
    if (_t947._tag === 23) {
      _t948 = "FNEG";
      break _t949;
    }
    if (_t947._tag === 24) {
      _t948 = "EQ";
      break _t949;
    }
    if (_t947._tag === 25) {
      _t948 = "NEQ";
      break _t949;
    }
    if (_t947._tag === 26) {
      _t948 = "LT";
      break _t949;
    }
    if (_t947._tag === 27) {
      _t948 = "GT";
      break _t949;
    }
    if (_t947._tag === 28) {
      _t948 = "LE";
      break _t949;
    }
    if (_t947._tag === 29) {
      _t948 = "GE";
      break _t949;
    }
    if (_t947._tag === 30) {
      _t948 = "NOT";
      break _t949;
    }
    if (_t947._tag === 31) {
      _t948 = "BAND";
      break _t949;
    }
    if (_t947._tag === 32) {
      _t948 = "BOR";
      break _t949;
    }
    if (_t947._tag === 33) {
      _t948 = "BXOR";
      break _t949;
    }
    if (_t947._tag === 34) {
      _t948 = "BNOT";
      break _t949;
    }
    if (_t947._tag === 35) {
      _t948 = "BSHL";
      break _t949;
    }
    if (_t947._tag === 36) {
      _t948 = "BSHR";
      break _t949;
    }
    if (_t947._tag === 37) {
      const off = _t947._val;
      _t948 = ("JUMP " + __dict_Show_int.show(off));
      break _t949;
    }
    if (_t947._tag === 38) {
      const off = _t947._val;
      _t948 = ("JUMP_IF_FALSE " + __dict_Show_int.show(off));
      break _t949;
    }
    if (_t947._tag === 39) {
      const off = _t947._val;
      _t948 = ("JUMP_IF_TRUE " + __dict_Show_int.show(off));
      break _t949;
    }
    if (_t947._tag === 40) {
      const i = _t947._val[0];
      const caps = _t947._val[1];
      _t948 = (((("CLOSURE " + __dict_Show_int.show(i)) + " [") + __dict_Show_string.show(String$concat(", ", List$map(Bytecode$pp_capture, caps)))) + "]");
      break _t949;
    }
    if (_t947._tag === 41) {
      const i = _t947._val[0];
      const caps = _t947._val[1];
      const self = _t947._val[2];
      _t948 = ((((("CLOSURE_REC " + __dict_Show_int.show(i)) + " [") + __dict_Show_string.show(String$concat(", ", List$map(Bytecode$pp_capture, caps)))) + "] self=") + __dict_Show_int.show(self));
      break _t949;
    }
    if (_t947._tag === 42) {
      const n = _t947._val;
      _t948 = ("CALL " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 43) {
      const n = _t947._val;
      _t948 = ("TAIL_CALL " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 44) {
      _t948 = "RETURN";
      break _t949;
    }
    if (_t947._tag === 45) {
      _t948 = "FUNC_RETURN";
      break _t949;
    }
    if (_t947._tag === 46) {
      _t948 = "ENTER_FUNC";
      break _t949;
    }
    if (_t947._tag === 47) {
      _t948 = "EXIT_FUNC";
      break _t949;
    }
    if (_t947._tag === 48) {
      const n = _t947._val;
      _t948 = ("MAKE_TUPLE " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 49) {
      const i = _t947._val;
      _t948 = ("TUPLE_GET " + __dict_Show_int.show(i));
      break _t949;
    }
    if (_t947._tag === 50) {
      const fields = _t947._val;
      _t948 = (("MAKE_RECORD [" + __dict_Show_string.show(String$concat(", ", fields))) + "]");
      break _t949;
    }
    if (_t947._tag === 51) {
      const name = _t947._val;
      _t948 = ("FIELD " + __dict_Show_string.show(name));
      break _t949;
    }
    if (_t947._tag === 52) {
      const name = _t947._val;
      _t948 = ("SET_FIELD " + __dict_Show_string.show(name));
      break _t949;
    }
    if (_t947._tag === 53) {
      const fields = _t947._val;
      _t948 = (("RECORD_UPDATE [" + __dict_Show_string.show(String$concat(", ", fields))) + "]");
      break _t949;
    }
    if (_t947._tag === 54) {
      const n = _t947._val;
      _t948 = ("RECORD_UPDATE_DYN " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 55) {
      const tag = _t947._val[0];
      const name = _t947._val[1];
      const has_payload = _t947._val[2];
      _t948 = ((((("MAKE_VARIANT " + __dict_Show_int.show(tag)) + " ") + __dict_Show_string.show(name)) + " ") + __dict_Show_bool.show(has_payload));
      break _t949;
    }
    if (_t947._tag === 56) {
      _t948 = "CONS";
      break _t949;
    }
    if (_t947._tag === 57) {
      _t948 = "NIL";
      break _t949;
    }
    if (_t947._tag === 58) {
      const tag = _t947._val;
      _t948 = ("TAG_EQ " + __dict_Show_int.show(tag));
      break _t949;
    }
    if (_t947._tag === 59) {
      _t948 = "IS_NIL";
      break _t949;
    }
    if (_t947._tag === 60) {
      _t948 = "IS_CONS";
      break _t949;
    }
    if (_t947._tag === 61) {
      _t948 = "HEAD";
      break _t949;
    }
    if (_t947._tag === 62) {
      _t948 = "TAIL";
      break _t949;
    }
    if (_t947._tag === 63) {
      _t948 = "VARIANT_PAYLOAD";
      break _t949;
    }
    if (_t947._tag === 64) {
      const loc = _t947._val;
      _t948 = ("MATCH_FAIL " + __dict_Show_string.show(loc));
      break _t949;
    }
    if (_t947._tag === 65) {
      const op = _t947._val;
      _t948 = ("PERFORM " + __dict_Show_string.show(op));
      break _t949;
    }
    if (_t947._tag === 66) {
      const n = _t947._val;
      _t948 = ("HANDLE " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 67) {
      _t948 = "RESUME";
      break _t949;
    }
    if (_t947._tag === 68) {
      const n = _t947._val;
      _t948 = ("ENTER_LOOP " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 69) {
      _t948 = "EXIT_LOOP";
      break _t949;
    }
    if (_t947._tag === 70) {
      _t948 = "LOOP_BREAK";
      break _t949;
    }
    if (_t947._tag === 71) {
      const n = _t947._val;
      _t948 = ("LOOP_CONTINUE " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 72) {
      const n = _t947._val;
      _t948 = ("FOLD_CONTINUE " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 73) {
      const n = _t947._val;
      _t948 = ("MAKE_ARRAY " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 74) {
      _t948 = "INDEX";
      break _t949;
    }
    if (_t947._tag === 75) {
      _t948 = "HALT";
      break _t949;
    }
    if (_t947._tag === 76) {
      const slot = _t947._val[0];
      const arity = _t947._val[1];
      _t948 = ((("GET_LOCAL_CALL " + __dict_Show_int.show(slot)) + " ") + __dict_Show_int.show(arity));
      break _t949;
    }
    if (_t947._tag === 77) {
      const slot = _t947._val[0];
      const idx = _t947._val[1];
      _t948 = ((("GET_LOCAL_TUPLE_GET " + __dict_Show_int.show(slot)) + " ") + __dict_Show_int.show(idx));
      break _t949;
    }
    if (_t947._tag === 78) {
      const slot = _t947._val[0];
      const name = _t947._val[1];
      _t948 = ((("GET_LOCAL_FIELD " + __dict_Show_int.show(slot)) + " ") + __dict_Show_string.show(name));
      break _t949;
    }
    if (_t947._tag === 79) {
      const idx = _t947._val[0];
      const arity = _t947._val[1];
      _t948 = ((("GET_GLOBAL_CALL " + __dict_Show_int.show(idx)) + " ") + __dict_Show_int.show(arity));
      break _t949;
    }
    if (_t947._tag === 80) {
      const idx = _t947._val[0];
      const name = _t947._val[1];
      _t948 = ((("GET_GLOBAL_FIELD " + __dict_Show_int.show(idx)) + " ") + __dict_Show_string.show(name));
      break _t949;
    }
    if (_t947._tag === 81) {
      const min_tag = _t947._val[0];
      const targets = _t947._val[1];
      const _mml$default = _t947._val[2];
      _t948 = ((((("JUMP_TABLE min=" + __dict_Show_int.show(min_tag)) + " [") + __dict_Show_string.show(String$concat(",", Array$to_list(Array$map(string_of_int, targets))))) + "] default=") + __dict_Show_int.show(_mml$default));
      break _t949;
    }
    if (_t947._tag === 82) {
      const n = _t947._val;
      _t948 = ("CALL_N " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 83) {
      const n = _t947._val;
      _t948 = ("TAIL_CALL_N " + __dict_Show_int.show(n));
      break _t949;
    }
    if (_t947._tag === 84) {
      _t948 = "UPDATE_REC";
      break _t949;
    }
    _match_fail("line 16933");
  }
  return _t948;
}
function Bytecode$disassemble(__dict_Show_2, __dict_Show_1, __dict_Show_0, __ev_arity_r0, __ev_code_r0, __ev_line_table_r0, __ev_name_r0, __ev_num_locals_r0, proto) {
  const buf_950 = Buffer$create(256);
  Buffer$add_string(buf_950, (((((("=== " + __dict_Show_2.show(proto.name)) + " (arity=") + __dict_Show_1.show(proto.arity)) + ", locals=") + __dict_Show_0.show(proto.num_locals)) + ") ===\n"));
  const prev_line_952 = Ref$create(0);
  function _t954(i, op) {
    let _t955;
    if ((i < Array$length(proto.line_table))) {
      _t955 = Array$get(proto.line_table, i);
    } else {
      _t955 = 0;
    }
    const line_956 = _t955;
    let _t958;
    if (((line_956 > 0) && (line_956 !== Ref$get(prev_line_952)))) {
      Ref$set(prev_line_952, line_956);
      _t958 = __dict_Show_int.show(line_956);
    } else {
      _t958 = "   |";
    }
    const line_str_959 = _t958;
    const _t960 = Buffer$add_string(buf_950, (((((__dict_Show_string.show(line_str_959) + " ") + __fmt_zero_pad(4, __dict_Show_int.show(i))) + "  ") + __dict_Show_string.show(Bytecode$pp_opcode(op))) + "\n"));
    const _t957 = _t960;
    return _t957;
  }
  Array$iteri(_t954, proto.code);
  const _t953 = Buffer$contents(buf_950);
  const _t951 = _t953;
  return _t951;
}
function Types$mono(ty) {
  return ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: 0, record_evidences: null, rquant: 0});
}
const Types$next_id = Ref$create(0);
function Types$fresh_id(_) {
  const id_961 = Ref$get(Types$next_id);
  Ref$set(Types$next_id, (id_961 + 1));
  const _t962 = id_961;
  return _t962;
}
function Types$new_tvar(level) {
  return ({_tag: 15, _name: "TVar", _val: Ref$create(({_tag: 0, _name: "Unbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$new_effvar(level) {
  return ({_tag: 0, _name: "EffVar", _val: Ref$create(({_tag: 0, _name: "EffUnbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$new_pvvar(level) {
  return ({_tag: 1, _name: "PVVar", _val: Ref$create(({_tag: 0, _name: "PVUnbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$new_rvar(level) {
  return ({_tag: 1, _name: "RVar", _val: Ref$create(({_tag: 0, _name: "RUnbound", _val: [Types$fresh_id(undefined), level]}))});
}
function Types$repr(__x) {
  let _t964;
  const _t963 = __x;
  _t965: {
    if (_t963._tag === 15 && _t963._val.contents._tag === 1) {
      const ty = _t963._val.contents._val;
      const r = _t963._val;
      const ty_966 = Types$repr(ty);
      Ref$set(r, ({_tag: 1, _name: "Link", _val: ty_966}));
      const _t967 = ty_966;
      _t964 = _t967;
      break _t965;
    }
    if (true) {
      const ty = _t963;
      _t964 = ty;
      break _t965;
    }
    _match_fail("line 16933");
  }
  return _t964;
}
function Types$is_concrete(ty) {
  while (true) {
    let _t969;
    const _t968 = Types$repr(ty);
    _t970: {
      if (_t968._tag === 15 && _t968._val.contents._tag === 0) {
        _t969 = false;
        break _t970;
      }
      if (_t968._tag === 15 && _t968._val.contents._tag === 1) {
        _t969 = failwith("assert false");
        break _t970;
      }
      if ((_t968._tag === 7 || _t968._tag === 8)) {
        const a = _t968._val[0];
        const eff = _t968._val[1];
        const r = _t968._val[2];
        _t969 = (Types$is_concrete(a) && (Types$is_concrete_eff(eff) && Types$is_concrete(r)));
        break _t970;
      }
      if (_t968._tag === 9) {
        const ts = _t968._val;
        _t969 = List$forall(Types$is_concrete, ts);
        break _t970;
      }
      if ((_t968._tag === 10 || _t968._tag === 13)) {
        const t = _t968._val;
        const _t971 = t;
        ty = _t971;
        continue;
        _t969 = undefined;
        break _t970;
      }
      if (_t968._tag === 12) {
        const args = _t968._val[1];
        _t969 = List$forall(Types$is_concrete, args);
        break _t970;
      }
      if ((((((((_t968._tag === 0 || _t968._tag === 1) || _t968._tag === 2) || _t968._tag === 3) || _t968._tag === 4) || _t968._tag === 5) || _t968._tag === 6) || _t968._tag === 16)) {
        _t969 = true;
        break _t970;
      }
      if (_t968._tag === 11) {
        const row = _t968._val;
        _t969 = Types$is_concrete_rrow(row);
        break _t970;
      }
      if (_t968._tag === 14) {
        const row = _t968._val;
        _t969 = Types$is_concrete_pv(row);
        break _t970;
      }
      _match_fail("line 16933");
    }
    return _t969;
  }
}
function Types$is_concrete_eff(__x) {
  while (true) {
    let _t973;
    const _t972 = __x;
    _t974: {
      if (_t972._tag === 0 && _t972._val.contents._tag === 1) {
        const eff = _t972._val.contents._val;
        const _t975 = eff;
        __x = _t975;
        continue;
        _t973 = undefined;
        break _t974;
      }
      if (_t972._tag === 0 && _t972._val.contents._tag === 0) {
        _t973 = false;
        break _t974;
      }
      if (_t972._tag === 2) {
        const tys = _t972._val[1];
        const tail = _t972._val[2];
        _t973 = (List$forall(Types$is_concrete, tys) && Types$is_concrete_eff(tail));
        break _t974;
      }
      if (_t972._tag === 1) {
        _t973 = true;
        break _t974;
      }
      if (_t972._tag === 3) {
        _t973 = true;
        break _t974;
      }
      _match_fail("line 16933");
    }
    return _t973;
  }
}
function Types$is_concrete_rrow(__x) {
  while (true) {
    let _t977;
    const _t976 = __x;
    _t978: {
      if (_t976._tag === 0) {
        const ty = _t976._val[1];
        const tail = _t976._val[2];
        _t977 = (Types$is_concrete(ty) && Types$is_concrete_rrow(tail));
        break _t978;
      }
      if (_t976._tag === 1 && _t976._val.contents._tag === 1) {
        const row = _t976._val.contents._val;
        const _t979 = row;
        __x = _t979;
        continue;
        _t977 = undefined;
        break _t978;
      }
      if (_t976._tag === 1 && _t976._val.contents._tag === 0) {
        _t977 = false;
        break _t978;
      }
      if (_t976._tag === 2) {
        _t977 = true;
        break _t978;
      }
      if ((_t976._tag === 3 || _t976._tag === 4)) {
        _t977 = true;
        break _t978;
      }
      _match_fail("line 16933");
    }
    return _t977;
  }
}
function Types$is_concrete_pv(__x) {
  while (true) {
    let _t981;
    const _t980 = __x;
    _t982: {
      if (_t980._tag === 0 && _t980._val[1]._tag === 1) {
        const ty = _t980._val[1]._val;
        const tail = _t980._val[2];
        _t981 = (Types$is_concrete(ty) && Types$is_concrete_pv(tail));
        break _t982;
      }
      if (_t980._tag === 0 && _t980._val[1]._tag === 0) {
        const tail = _t980._val[2];
        const _t983 = tail;
        __x = _t983;
        continue;
        _t981 = undefined;
        break _t982;
      }
      if (_t980._tag === 1 && _t980._val.contents._tag === 1) {
        const row = _t980._val.contents._val;
        const _t984 = row;
        __x = _t984;
        continue;
        _t981 = undefined;
        break _t982;
      }
      if (_t980._tag === 1 && _t980._val.contents._tag === 0) {
        _t981 = false;
        break _t982;
      }
      if (_t980._tag === 2) {
        _t981 = true;
        break _t982;
      }
      if (_t980._tag === 3) {
        _t981 = true;
        break _t982;
      }
      _match_fail("line 16933");
    }
    return _t981;
  }
}
function Types$eff_repr(__x) {
  let _t986;
  const _t985 = __x;
  _t987: {
    if (_t985._tag === 0 && _t985._val.contents._tag === 1) {
      const eff = _t985._val.contents._val;
      const r = _t985._val;
      const eff_988 = Types$eff_repr(eff);
      Ref$set(r, ({_tag: 1, _name: "EffLink", _val: eff_988}));
      const _t989 = eff_988;
      _t986 = _t989;
      break _t987;
    }
    if (true) {
      const eff = _t985;
      _t986 = eff;
      break _t987;
    }
    _match_fail("line 16933");
  }
  return _t986;
}
function Types$pv_repr(__x) {
  let _t991;
  const _t990 = __x;
  _t992: {
    if (_t990._tag === 1 && _t990._val.contents._tag === 1) {
      const row = _t990._val.contents._val;
      const r = _t990._val;
      const row_993 = Types$pv_repr(row);
      Ref$set(r, ({_tag: 1, _name: "PVLink", _val: row_993}));
      const _t994 = row_993;
      _t991 = _t994;
      break _t992;
    }
    if (true) {
      const row = _t990;
      _t991 = row;
      break _t992;
    }
    _match_fail("line 16933");
  }
  return _t991;
}
function Types$rrow_repr(__x) {
  let _t996;
  const _t995 = __x;
  _t997: {
    if (_t995._tag === 1 && _t995._val.contents._tag === 1) {
      const row = _t995._val.contents._val;
      const r = _t995._val;
      const row_998 = Types$rrow_repr(row);
      Ref$set(r, ({_tag: 1, _name: "RLink", _val: row_998}));
      const _t999 = row_998;
      _t996 = _t999;
      break _t997;
    }
    if (true) {
      const row = _t995;
      _t996 = row;
      break _t997;
    }
    _match_fail("line 16933");
  }
  return _t996;
}
function Types$fields_to_closed_row(fields) {
  function _t1000(__p35, acc) {
    let _t1002;
    const _t1001 = __p35;
    _t1003: {
      if (true) {
        const n = _t1001[0];
        const t = _t1001[1];
        _t1002 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
        break _t1003;
      }
      _match_fail("line 16933");
    }
    return _t1002;
  }
  return List$fold_right(_t1000, fields, ({_tag: 2, _name: "REmpty"}));
}
function Types$record_row_to_fields(row) {
  function collect(r) {
    let _t1005;
    const _t1004 = Types$rrow_repr(r);
    _t1006: {
      if (_t1004._tag === 0) {
        const n = _t1004._val[0];
        const t = _t1004._val[1];
        const tail = _t1004._val[2];
        _t1005 = ({_hd: [n, t], _tl: collect(tail)});
        break _t1006;
      }
      if (true) {
        _t1005 = null;
        break _t1006;
      }
      _match_fail("line 16933");
    }
    return _t1005;
  }
  const _t1007 = collect(row);
  return _t1007;
}
const Types$empty_type_env = ({classes: null, constructors: null, effects: null, hidden_ctor_types: null, hidden_types: null, instances: null, modules: null, mutable_fields: null, newtypes: null, records: null, type_aliases: null, type_synonyms: null, variants: null});
function Types$find_effect_op(type_env, op_name) {
  function _t1008(edef) {
    function _t1009(__p36) {
      let _t1011;
      const _t1010 = __p36;
      _t1012: {
        if (true) {
          const name = _t1010[0];
          const ty = _t1010[1];
          let _t1013;
          if ((name === op_name)) {
            _t1013 = ({_tag: 1, _name: "Some", _val: [edef.effect_name, ty]});
          } else {
            _t1013 = ({_tag: 0, _name: "None"});
          }
          _t1011 = _t1013;
          break _t1012;
        }
        _match_fail("line 16933");
      }
      return _t1011;
    }
    return List$find_map(_t1009, edef.effect_ops);
  }
  return List$find_map(_t1008, type_env.effects);
}
function Types$ty_to_str(__x) {
  let _t1015;
  const _t1014 = __x;
  _t1016: {
    if (_t1014._tag === 0) {
      _t1015 = "int";
      break _t1016;
    }
    if (_t1014._tag === 1) {
      _t1015 = "float";
      break _t1016;
    }
    if (_t1014._tag === 2) {
      _t1015 = "bool";
      break _t1016;
    }
    if (_t1014._tag === 3) {
      _t1015 = "string";
      break _t1016;
    }
    if (_t1014._tag === 4) {
      _t1015 = "byte";
      break _t1016;
    }
    if (_t1014._tag === 5) {
      _t1015 = "rune";
      break _t1016;
    }
    if (_t1014._tag === 6) {
      _t1015 = "unit";
      break _t1016;
    }
    if (_t1014._tag === 12 && _t1014._val[1] === null) {
      const name = _t1014._val[0];
      _t1015 = name;
      break _t1016;
    }
    if (_t1014._tag === 12) {
      const name = _t1014._val[0];
      const args = _t1014._val[1];
      _t1015 = (String$concat("_", List$map(Types$ty_to_str, args)) + ("_" + name));
      break _t1016;
    }
    if (_t1014._tag === 10) {
      const t = _t1014._val;
      _t1015 = (Types$ty_to_str(t) + "_list");
      break _t1016;
    }
    if (_t1014._tag === 13) {
      const t = _t1014._val;
      _t1015 = (Types$ty_to_str(t) + "_array");
      break _t1016;
    }
    if (_t1014._tag === 9) {
      const ts = _t1014._val;
      _t1015 = (String$concat("_", List$map(Types$ty_to_str, ts)) + "_tup");
      break _t1016;
    }
    if (_t1014._tag === 14) {
      _t1015 = "polyvar";
      break _t1016;
    }
    if (_t1014._tag === 16) {
      const i = _t1014._val;
      _t1015 = ("g" + __dict_Show_int.show(i));
      break _t1016;
    }
    if ((_t1014._tag === 7 || _t1014._tag === 8)) {
      _t1015 = "arrow";
      break _t1016;
    }
    if (_t1014._tag === 15) {
      _t1015 = "tvar";
      break _t1016;
    }
    if (true) {
      _t1015 = "ty_other";
      break _t1016;
    }
    _match_fail("line 16933");
  }
  return _t1015;
}
function Types$dict_name(__dict_Show_0, class_name, tys) {
  const ty_strs_1017 = List$map(Types$ty_to_str, tys);
  const _t1018 = ((("__dict_" + __dict_Show_0.show(class_name)) + "_") + __dict_Show_string.show(String$concat("__", ty_strs_1017)));
  return _t1018;
}
function Types$find_method_class(classes, method_name) {
  function _t1019(cls) {
    function _t1020(__p37) {
      let _t1022;
      const _t1021 = __p37;
      _t1023: {
        if (true) {
          const m = _t1021[0];
          _t1022 = (m === method_name);
          break _t1023;
        }
        _match_fail("line 16933");
      }
      return _t1022;
    }
    return List$exists(_t1020, cls.class_methods);
  }
  return List$find(_t1019, classes);
}
function Types$occurs_check(id, level, ty) {
  return _trampoline(function() {
    const _t1024 = Types$repr(ty);
    let _t1025 = false;
    if (!_t1025 && _t1024._tag === 15 && _t1024._val.contents._tag === 0) {
      const id2 = _t1024._val.contents._val[0];
      if ((id === id2)) {
        _t1025 = true;
        return _h["unify_error"]("occurs check: infinite type", function(_t1026) {
          return _bounce(function() {
            return _t1026;
          });
        });
      }
    }
    if (!_t1025 && _t1024._tag === 15 && _t1024._val.contents._tag === 0) {
      const id2 = _t1024._val.contents._val[0];
      const level2 = _t1024._val.contents._val[1];
      const r = _t1024._val;
      _t1025 = true;
      let _t1027;
      if ((level2 > level)) {
        _t1027 = Ref$set(r, ({_tag: 0, _name: "Unbound", _val: [id2, level]}));
      } else {
        _t1027 = undefined;
      }
      return _t1027;
    }
    if (!_t1025 && _t1024._tag === 15 && _t1024._val.contents._tag === 1) {
      _t1025 = true;
      return failwith("assert false");
    }
    if (!_t1025 && (_t1024._tag === 7 || _t1024._tag === 8)) {
      const a = _t1024._val[0];
      const eff = _t1024._val[1];
      const b = _t1024._val[2];
      _t1025 = true;
      Types$occurs_check(id, level, a);
      Types$occurs_check_eff_for_ty(id, level, eff);
      return Types$occurs_check(id, level, b);
    }
    if (!_t1025 && _t1024._tag === 9) {
      const ts = _t1024._val;
      _t1025 = true;
      return List$iter(_call(Types$occurs_check, [id, level]), ts);
    }
    if (!_t1025 && _t1024._tag === 10) {
      const t = _t1024._val;
      _t1025 = true;
      return Types$occurs_check(id, level, t);
    }
    if (!_t1025 && _t1024._tag === 13) {
      const t = _t1024._val;
      _t1025 = true;
      return Types$occurs_check(id, level, t);
    }
    if (!_t1025 && _t1024._tag === 11) {
      const row = _t1024._val;
      _t1025 = true;
      return Types$occurs_check_rrow_for_ty(id, level, row);
    }
    if (!_t1025 && _t1024._tag === 12) {
      const args = _t1024._val[1];
      _t1025 = true;
      return List$iter(_call(Types$occurs_check, [id, level]), args);
    }
    if (!_t1025 && _t1024._tag === 14) {
      const row = _t1024._val;
      _t1025 = true;
      return Types$occurs_check_pv_for_ty(id, level, row);
    }
    if (!_t1025 && (((((((_t1024._tag === 0 || _t1024._tag === 1) || _t1024._tag === 2) || _t1024._tag === 3) || _t1024._tag === 4) || _t1024._tag === 5) || _t1024._tag === 6) || _t1024._tag === 16)) {
      _t1025 = true;
      return undefined;
    }
    if (!_t1025) _match_fail("line 16933");
  }, Types$occurs_check);
}
function Types$occurs_check_pv_for_ty(id, level, row) {
  while (true) {
    let _t1029;
    const _t1028 = Types$pv_repr(row);
    _t1030: {
      if (_t1028._tag === 0) {
        const ty_opt = _t1028._val[1];
        const tail = _t1028._val[2];
        let _t1032;
        const _t1031 = ty_opt;
        _t1033: {
          if (_t1031._tag === 1) {
            const t = _t1031._val;
            _t1032 = Types$occurs_check(id, level, t);
            break _t1033;
          }
          if (_t1031._tag === 0) {
            _t1032 = undefined;
            break _t1033;
          }
          _match_fail("line 16933");
        }
        _t1032;
        const _t1034 = id;
        const _t1035 = level;
        const _t1036 = tail;
        id = _t1034;
        level = _t1035;
        row = _t1036;
        continue;
        _t1029 = undefined;
        break _t1030;
      }
      if (true) {
        _t1029 = undefined;
        break _t1030;
      }
      _match_fail("line 16933");
    }
    return _t1029;
  }
}
function Types$occurs_check_rrow_for_ty(id, level, row) {
  while (true) {
    let _t1038;
    const _t1037 = Types$rrow_repr(row);
    _t1039: {
      if (_t1037._tag === 0) {
        const ty = _t1037._val[1];
        const tail = _t1037._val[2];
        Types$occurs_check(id, level, ty);
        const _t1040 = id;
        const _t1041 = level;
        const _t1042 = tail;
        id = _t1040;
        level = _t1041;
        row = _t1042;
        continue;
        _t1038 = undefined;
        break _t1039;
      }
      if (true) {
        _t1038 = undefined;
        break _t1039;
      }
      _match_fail("line 16933");
    }
    return _t1038;
  }
}
function Types$occurs_check_eff_for_ty(id, level, eff) {
  while (true) {
    let _t1044;
    const _t1043 = Types$eff_repr(eff);
    _t1045: {
      if (_t1043._tag === 2) {
        const params = _t1043._val[1];
        const tail = _t1043._val[2];
        List$iter(_call(Types$occurs_check, [id, level]), params);
        const _t1046 = id;
        const _t1047 = level;
        const _t1048 = tail;
        id = _t1046;
        level = _t1047;
        eff = _t1048;
        continue;
        _t1044 = undefined;
        break _t1045;
      }
      if (true) {
        _t1044 = undefined;
        break _t1045;
      }
      _match_fail("line 16933");
    }
    return _t1044;
  }
}
function Types$occurs_check_eff(id, level, eff) {
  return _trampoline(function() {
    const _t1049 = Types$eff_repr(eff);
    let _t1050 = false;
    if (!_t1050 && _t1049._tag === 0 && _t1049._val.contents._tag === 0) {
      const id2 = _t1049._val.contents._val[0];
      if ((id === id2)) {
        _t1050 = true;
        return _h["unify_error"]("occurs check: infinite effect row", function(_t1051) {
          return _bounce(function() {
            return _t1051;
          });
        });
      }
    }
    if (!_t1050 && _t1049._tag === 0 && _t1049._val.contents._tag === 0) {
      const id2 = _t1049._val.contents._val[0];
      const level2 = _t1049._val.contents._val[1];
      const r = _t1049._val;
      _t1050 = true;
      let _t1052;
      if ((level2 > level)) {
        _t1052 = Ref$set(r, ({_tag: 0, _name: "EffUnbound", _val: [id2, level]}));
      } else {
        _t1052 = undefined;
      }
      return _t1052;
    }
    if (!_t1050 && _t1049._tag === 0 && _t1049._val.contents._tag === 1) {
      _t1050 = true;
      return failwith("assert false");
    }
    if (!_t1050 && _t1049._tag === 2) {
      const _params = _t1049._val[1];
      const tail = _t1049._val[2];
      _t1050 = true;
      return Types$occurs_check_eff(id, level, tail);
    }
    if (!_t1050 && (_t1049._tag === 1 || _t1049._tag === 3)) {
      _t1050 = true;
      return undefined;
    }
    if (!_t1050) _match_fail("line 16933");
  }, Types$occurs_check_eff);
}
function Types$occurs_check_pv(id, level, row) {
  return _trampoline(function() {
    const _t1053 = Types$pv_repr(row);
    let _t1054 = false;
    if (!_t1054 && _t1053._tag === 1 && _t1053._val.contents._tag === 0) {
      const id2 = _t1053._val.contents._val[0];
      if ((id === id2)) {
        _t1054 = true;
        return _h["unify_error"]("occurs check: infinite polymorphic variant row", function(_t1055) {
          return _bounce(function() {
            return _t1055;
          });
        });
      }
    }
    if (!_t1054 && _t1053._tag === 1 && _t1053._val.contents._tag === 0) {
      const id2 = _t1053._val.contents._val[0];
      const level2 = _t1053._val.contents._val[1];
      const r = _t1053._val;
      _t1054 = true;
      let _t1056;
      if ((level2 > level)) {
        _t1056 = Ref$set(r, ({_tag: 0, _name: "PVUnbound", _val: [id2, level]}));
      } else {
        _t1056 = undefined;
      }
      return _t1056;
    }
    if (!_t1054 && _t1053._tag === 1 && _t1053._val.contents._tag === 1) {
      _t1054 = true;
      return failwith("assert false");
    }
    if (!_t1054 && _t1053._tag === 0) {
      const ty_opt = _t1053._val[1];
      const tail = _t1053._val[2];
      _t1054 = true;
      let _t1058;
      const _t1057 = ty_opt;
      _t1059: {
        if (_t1057._tag === 1) {
          const t = _t1057._val;
          _t1058 = Types$occurs_check(id, level, t);
          break _t1059;
        }
        if (_t1057._tag === 0) {
          _t1058 = undefined;
          break _t1059;
        }
        _match_fail("line 16933");
      }
      _t1058;
      return Types$occurs_check_pv(id, level, tail);
    }
    if (!_t1054 && (_t1053._tag === 2 || _t1053._tag === 3)) {
      _t1054 = true;
      return undefined;
    }
    if (!_t1054) _match_fail("line 16933");
  }, Types$occurs_check_pv);
}
function Types$occurs_check_rrow(id, level, row) {
  return _trampoline(function() {
    const _t1060 = Types$rrow_repr(row);
    let _t1061 = false;
    if (!_t1061 && _t1060._tag === 1 && _t1060._val.contents._tag === 0) {
      const id2 = _t1060._val.contents._val[0];
      if ((id === id2)) {
        _t1061 = true;
        return _h["unify_error"]("occurs check: infinite record row", function(_t1062) {
          return _bounce(function() {
            return _t1062;
          });
        });
      }
    }
    if (!_t1061 && _t1060._tag === 1 && _t1060._val.contents._tag === 0) {
      const id2 = _t1060._val.contents._val[0];
      const level2 = _t1060._val.contents._val[1];
      const r = _t1060._val;
      _t1061 = true;
      let _t1063;
      if ((level2 > level)) {
        _t1063 = Ref$set(r, ({_tag: 0, _name: "RUnbound", _val: [id2, level]}));
      } else {
        _t1063 = undefined;
      }
      return _t1063;
    }
    if (!_t1061 && _t1060._tag === 1 && _t1060._val.contents._tag === 1) {
      _t1061 = true;
      return failwith("assert false");
    }
    if (!_t1061 && _t1060._tag === 0) {
      const ty = _t1060._val[1];
      const tail = _t1060._val[2];
      _t1061 = true;
      Types$occurs_check(id, level, ty);
      return Types$occurs_check_rrow(id, level, tail);
    }
    if (!_t1061 && ((_t1060._tag === 2 || _t1060._tag === 3) || _t1060._tag === 4)) {
      _t1061 = true;
      return undefined;
    }
    if (!_t1061) _match_fail("line 16933");
  }, Types$occurs_check_rrow);
}
const Types$pp_synonyms = Ref$create(null);
function _t1064(_) {
  return "?";
}
const Types$pp_ty_arg_ref = Ref$create(_t1064);
function Types$try_match_synonym(ty) {
  const synonyms_1065 = Ref$get(Types$pp_synonyms);
  let _t1067;
  if (_eq(synonyms_1065, null)) {
    _t1067 = ({_tag: 0, _name: "None"});
  } else {
    function _t1068(__p38) {
      let _t1070;
      const _t1069 = __p38;
      _t1071: {
        if (true) {
          const name = _t1069[0];
          const num_params = _t1069[1];
          const pattern = _t1069[2];
          const bindings_1072 = Array$make(num_params, ({_tag: 0, _name: "None"}));
          function go(pat, actual) {
            while (true) {
              const actual_1074 = Types$repr(actual);
              let _t1077;
              const _t1076 = [pat, actual_1074];
              _t1078: {
                if (_t1076[0]._tag === 16) {
                  const i = _t1076[0]._val;
                  if ((i < num_params)) {
                    let _t1080;
                    const _t1079 = Array$get(bindings_1072, i);
                    _t1081: {
                      if (_t1079._tag === 0) {
                        Array$set(bindings_1072, i, ({_tag: 1, _name: "Some", _val: actual_1074}));
                        _t1080 = true;
                        break _t1081;
                      }
                      if (_t1079._tag === 1) {
                        const prev = _t1079._val;
                        _t1080 = _eq(prev, actual_1074);
                        break _t1081;
                      }
                      _match_fail("line 16933");
                    }
                    _t1077 = _t1080;
                    break _t1078;
                  }
                }
                if (((((((_t1076[0]._tag === 0 && _t1076[1]._tag === 0 || _t1076[0]._tag === 1 && _t1076[1]._tag === 1) || _t1076[0]._tag === 2 && _t1076[1]._tag === 2) || _t1076[0]._tag === 3 && _t1076[1]._tag === 3) || _t1076[0]._tag === 6 && _t1076[1]._tag === 6) || _t1076[0]._tag === 4 && _t1076[1]._tag === 4) || _t1076[0]._tag === 5 && _t1076[1]._tag === 5)) {
                  _t1077 = true;
                  break _t1078;
                }
                if ((_t1076[0]._tag === 7 && _t1076[1]._tag === 7 || _t1076[0]._tag === 8 && _t1076[1]._tag === 8)) {
                  const p1 = _t1076[0]._val[0];
                  const _pe = _t1076[0]._val[1];
                  const p2 = _t1076[0]._val[2];
                  const a1 = _t1076[1]._val[0];
                  const _ae = _t1076[1]._val[1];
                  const a2 = _t1076[1]._val[2];
                  _t1077 = (go(p1, a1) && go(p2, a2));
                  break _t1078;
                }
                if (_t1076[0]._tag === 10 && _t1076[1]._tag === 10) {
                  const p1 = _t1076[0]._val;
                  const a1 = _t1076[1]._val;
                  const _t1082 = p1;
                  const _t1083 = a1;
                  pat = _t1082;
                  actual = _t1083;
                  continue;
                  _t1077 = undefined;
                  break _t1078;
                }
                if (_t1076[0]._tag === 13 && _t1076[1]._tag === 13) {
                  const p1 = _t1076[0]._val;
                  const a1 = _t1076[1]._val;
                  const _t1084 = p1;
                  const _t1085 = a1;
                  pat = _t1084;
                  actual = _t1085;
                  continue;
                  _t1077 = undefined;
                  break _t1078;
                }
                if (_t1076[0]._tag === 9 && _t1076[1]._tag === 9) {
                  const ps = _t1076[0]._val;
                  const acts = _t1076[1]._val;
                  if ((List$length(ps) === List$length(acts))) {
                    _t1077 = List$forall2(go, ps, acts);
                    break _t1078;
                  }
                }
                if (_t1076[0]._tag === 12 && _t1076[1]._tag === 12) {
                  const pn = _t1076[0]._val[0];
                  const ps = _t1076[0]._val[1];
                  const an = _t1076[1]._val[0];
                  const acts = _t1076[1]._val[1];
                  if (((pn === an) && (List$length(ps) === List$length(acts)))) {
                    _t1077 = List$forall2(go, ps, acts);
                    break _t1078;
                  }
                }
                if (_t1076[0]._tag === 15 && _t1076[1]._tag === 15) {
                  const r1 = _t1076[0]._val;
                  const r2 = _t1076[1]._val;
                  if (_eq(r1, r2)) {
                    _t1077 = true;
                    break _t1078;
                  }
                }
                if (_t1076[0]._tag === 16 && _t1076[1]._tag === 16) {
                  const i = _t1076[0]._val;
                  const j = _t1076[1]._val;
                  if ((i === j)) {
                    _t1077 = true;
                    break _t1078;
                  }
                }
                if (true) {
                  _t1077 = false;
                  break _t1078;
                }
                _match_fail("line 16933");
              }
              const _t1075 = _t1077;
              return _t1075;
            }
          }
          let _t1088;
          if (go(pattern, ty)) {
          function _t1087(x) {
            return !_eq(x, ({_tag: 0, _name: "None"}));
          }
            _t1088 = Array$forall(_t1087, bindings_1072);
          } else {
            _t1088 = false;
          }
          let _t1089;
          if (_t1088) {
            function _t1090(x) {
              return Option$unwrap(x);
            }
            _t1089 = ({_tag: 1, _name: "Some", _val: [name, Array$to_list(Array$map(_t1090, bindings_1072))]});
          } else {
            _t1089 = ({_tag: 0, _name: "None"});
          }
          const _t1086 = _t1089;
          const _t1073 = _t1086;
          _t1070 = _t1073;
          break _t1071;
        }
        _match_fail("line 16933");
      }
      return _t1070;
    }
    _t1067 = List$find_map(_t1068, synonyms_1065);
  }
  const _t1066 = _t1067;
  return _t1066;
}
function Types$pp_eff(eff) {
  let _t1092;
  const _t1091 = Types$eff_repr(eff);
  _t1093: {
    if (_t1091._tag === 1) {
      _t1092 = "";
      break _t1093;
    }
    if (_t1091._tag === 0 && _t1091._val.contents._tag === 0) {
      const id = _t1091._val.contents._val[0];
      _t1092 = ("'" + String$make(1, Byte$of_int((Byte$to_int(101) + (id % 22)))));
      break _t1093;
    }
    if (_t1091._tag === 2) {
      const label = _t1091._val[0];
      const params = _t1091._val[1];
      const tail = _t1091._val[2];
      let _t1095;
      const _t1094 = params;
      _t1096: {
        if (_t1094 === null) {
          _t1095 = "";
          break _t1096;
        }
        if (true) {
          const ps = _t1094;
          _t1095 = (" " + String$concat(" ", List$map(_call(Ref$get, [Types$pp_ty_arg_ref]), ps)));
          break _t1096;
        }
        _match_fail("line 16933");
      }
      const param_str_1097 = _t1095;
      let _t1100;
      const _t1099 = Types$eff_repr(tail);
      _t1101: {
        if (_t1099._tag === 1) {
          _t1100 = "";
          break _t1101;
        }
        if (_t1099._tag === 0 && _t1099._val.contents._tag === 0) {
          _t1100 = (", " + Types$pp_eff(tail));
          break _t1101;
        }
        if (_t1099._tag === 2) {
          _t1100 = (", " + Types$pp_eff(tail));
          break _t1101;
        }
        if (true) {
          _t1100 = "";
          break _t1101;
        }
        _match_fail("line 16933");
      }
      const tail_str_1102 = _t1100;
      const _t1103 = (label + (param_str_1097 + tail_str_1102));
      const _t1098 = _t1103;
      _t1092 = _t1098;
      break _t1093;
    }
    if (_t1091._tag === 3) {
      const id = _t1091._val;
      _t1092 = ("'" + String$make(1, Byte$of_int((Byte$to_int(101) + (id % 22)))));
      break _t1093;
    }
    if (_t1091._tag === 0 && _t1091._val.contents._tag === 1) {
      _t1092 = failwith("assert false");
      break _t1093;
    }
    _match_fail("line 16933");
  }
  return _t1092;
}
function Types$eff_is_trivial(eff) {
  let _t1105;
  const _t1104 = Types$eff_repr(eff);
  _t1106: {
    if (_t1104._tag === 1) {
      _t1105 = true;
      break _t1106;
    }
    if (_t1104._tag === 0 && _t1104._val.contents._tag === 0) {
      _t1105 = true;
      break _t1106;
    }
    if (_t1104._tag === 3) {
      _t1105 = true;
      break _t1106;
    }
    if (true) {
      _t1105 = false;
      break _t1106;
    }
    _match_fail("line 16933");
  }
  return _t1105;
}
function Types$pp_ty(ty) {
  const ty_1107 = Types$repr(ty);
  let _t1110;
  const _t1109 = Types$try_match_synonym(ty_1107);
  _t1111: {
    if (_t1109._tag === 1) {
      const name = _t1109._val[0];
      const args = _t1109._val[1];
      let _t1113;
      const _t1112 = ty_1107;
      _t1114: {
        if ((_t1112._tag === 7 || _t1112._tag === 8)) {
          const a = _t1112._val[0];
          if (!_eq(Types$try_match_synonym(Types$repr(a)), ({_tag: 0, _name: "None"}))) {
            _t1113 = Types$pp_ty_raw(ty_1107);
            break _t1114;
          }
        }
        if (true) {
          _t1113 = Types$pp_type_con(name, args);
          break _t1114;
        }
        _match_fail("line 16933");
      }
      _t1110 = _t1113;
      break _t1111;
    }
    if (_t1109._tag === 0) {
      _t1110 = Types$pp_ty_raw(ty_1107);
      break _t1111;
    }
    _match_fail("line 16933");
  }
  const _t1108 = _t1110;
  return _t1108;
}
function Types$pp_type_con(name, __x) {
  let _t1116;
  const _t1115 = __x;
  _t1117: {
    if (_t1115 === null) {
      _t1116 = name;
      break _t1117;
    }
    if (_t1115 !== null && _t1115._tl === null) {
      const arg = _t1115._hd;
      let _t1119;
      const _t1118 = Types$repr(arg);
      _t1120: {
        if (((_t1118._tag === 7 || _t1118._tag === 8) || _t1118._tag === 9)) {
          _t1119 = ("(" + (Types$pp_ty(arg) + ")"));
          break _t1120;
        }
        if (true) {
          _t1119 = Types$pp_ty(arg);
          break _t1120;
        }
        _match_fail("line 16933");
      }
      _t1116 = (_t1119 + (" " + name));
      break _t1117;
    }
    if (true) {
      const args = _t1115;
      _t1116 = ("(" + (String$concat(", ", List$map(Types$pp_ty, args)) + (") " + name)));
      break _t1117;
    }
    _match_fail("line 16933");
  }
  return _t1116;
}
function Types$needs_parens(ty) {
  const ty_1121 = Types$repr(ty);
  let _t1124;
  const _t1123 = Types$try_match_synonym(ty_1121);
  _t1125: {
    if (_t1123._tag === 1) {
      _t1124 = false;
      break _t1125;
    }
    if (_t1123._tag === 0) {
      let _t1127;
      const _t1126 = ty_1121;
      _t1128: {
        if (((_t1126._tag === 7 || _t1126._tag === 8) || _t1126._tag === 9)) {
          _t1127 = true;
          break _t1128;
        }
        if (true) {
          _t1127 = false;
          break _t1128;
        }
        _match_fail("line 16933");
      }
      _t1124 = _t1127;
      break _t1125;
    }
    _match_fail("line 16933");
  }
  const _t1122 = _t1124;
  return _t1122;
}
function Types$pp_ty_arg(ty) {
  let _t1129;
  if (Types$needs_parens(ty)) {
    _t1129 = ("(" + (Types$pp_ty(ty) + ")"));
  } else {
    _t1129 = Types$pp_ty(ty);
  }
  return _t1129;
}
function Types$pp_ty_raw(ty) {
  let _t1131;
  const _t1130 = ty;
  _t1132: {
    if (_t1130._tag === 0) {
      _t1131 = "int";
      break _t1132;
    }
    if (_t1130._tag === 1) {
      _t1131 = "float";
      break _t1132;
    }
    if (_t1130._tag === 2) {
      _t1131 = "bool";
      break _t1132;
    }
    if (_t1130._tag === 3) {
      _t1131 = "string";
      break _t1132;
    }
    if (_t1130._tag === 4) {
      _t1131 = "byte";
      break _t1132;
    }
    if (_t1130._tag === 5) {
      _t1131 = "rune";
      break _t1132;
    }
    if (_t1130._tag === 6) {
      _t1131 = "unit";
      break _t1132;
    }
    if (_t1130._tag === 7) {
      const a = _t1130._val[0];
      const eff = _t1130._val[1];
      const r = _t1130._val[2];
      let _t1134;
      const _t1133 = Types$repr(a);
      _t1135: {
        if (_t1133._tag === 7) {
          if (_eq(Types$try_match_synonym(Types$repr(a)), ({_tag: 0, _name: "None"}))) {
            _t1134 = ("(" + (Types$pp_ty(a) + ")"));
            break _t1135;
          }
        }
        if (true) {
          _t1134 = Types$pp_ty(a);
          break _t1135;
        }
        _match_fail("line 16933");
      }
      const a_str_1136 = _t1134;
      let _t1138;
      if (Types$eff_is_trivial(eff)) {
        _t1138 = (a_str_1136 + (" -> " + Types$pp_ty(r)));
      } else {
        _t1138 = (a_str_1136 + (" -> " + (Types$pp_ty(r) + (" / " + Types$pp_eff(eff)))));
      }
      const _t1137 = _t1138;
      _t1131 = _t1137;
      break _t1132;
    }
    if (_t1130._tag === 8) {
      const a = _t1130._val[0];
      const eff = _t1130._val[1];
      const r = _t1130._val[2];
      let _t1140;
      const _t1139 = Types$repr(a);
      _t1141: {
        if ((_t1139._tag === 7 || _t1139._tag === 8)) {
          if (_eq(Types$try_match_synonym(Types$repr(a)), ({_tag: 0, _name: "None"}))) {
            _t1140 = ("(" + (Types$pp_ty(a) + ")"));
            break _t1141;
          }
        }
        if (true) {
          _t1140 = Types$pp_ty(a);
          break _t1141;
        }
        _match_fail("line 16933");
      }
      const a_str_1142 = _t1140;
      let _t1144;
      if (Types$eff_is_trivial(eff)) {
        _t1144 = (a_str_1142 + (" -> " + Types$pp_ty(r)));
      } else {
        _t1144 = (a_str_1142 + (" -> " + (Types$pp_ty(r) + (" / " + Types$pp_eff(eff)))));
      }
      const _t1143 = _t1144;
      const inner_1145 = _t1143;
      const _t1146 = ("continuation(" + (inner_1145 + ")"));
      _t1131 = _t1146;
      break _t1132;
    }
    if (_t1130._tag === 9) {
      const ts = _t1130._val;
      function _t1147(t) {
        let _t1149;
        const _t1148 = Types$repr(t);
        _t1150: {
          if ((_t1148._tag === 7 || _t1148._tag === 8)) {
            if (_eq(Types$try_match_synonym(Types$repr(t)), ({_tag: 0, _name: "None"}))) {
              _t1149 = ("(" + (Types$pp_ty(t) + ")"));
              break _t1150;
            }
          }
          if (true) {
            _t1149 = Types$pp_ty(t);
            break _t1150;
          }
          _match_fail("line 16933");
        }
        return _t1149;
      }
      _t1131 = String$concat(" * ", List$map(_t1147, ts));
      break _t1132;
    }
    if (_t1130._tag === 10) {
      const t = _t1130._val;
      _t1131 = (Types$pp_ty_arg(t) + " list");
      break _t1132;
    }
    if (_t1130._tag === 13) {
      const t = _t1130._val;
      _t1131 = (Types$pp_ty_arg(t) + " array");
      break _t1132;
    }
    if (_t1130._tag === 11) {
      const row = _t1130._val;
      function collect(r) {
        let _t1152;
        const _t1151 = Types$rrow_repr(r);
        _t1153: {
          if (_t1151._tag === 0) {
            const name = _t1151._val[0];
            const ty = _t1151._val[1];
            const tail = _t1151._val[2];
            _t1152 = ({_hd: [name, ty], _tl: collect(tail)});
            break _t1153;
          }
          if (true) {
            _t1152 = null;
            break _t1153;
          }
          _match_fail("line 16933");
        }
        return _t1152;
      }
      function is_open(r) {
        while (true) {
          let _t1156;
          const _t1155 = Types$rrow_repr(r);
          _t1157: {
            if (_t1155._tag === 0) {
              const tail = _t1155._val[2];
              const _t1158 = tail;
              r = _t1158;
              continue;
              _t1156 = undefined;
              break _t1157;
            }
            if (((_t1155._tag === 1 && _t1155._val.contents._tag === 0 || _t1155._tag === 3) || _t1155._tag === 4)) {
              _t1156 = true;
              break _t1157;
            }
            if (true) {
              _t1156 = false;
              break _t1157;
            }
            _match_fail("line 16933");
          }
          return _t1156;
        }
      }
      function _t1160(__p39) {
        let _t1162;
        const _t1161 = __p39;
        _t1163: {
          if (true) {
            const n = _t1161[0];
            const t = _t1161[1];
            _t1162 = (n + (": " + Types$pp_ty(t)));
            break _t1163;
          }
          _match_fail("line 16933");
        }
        return _t1162;
      }
      const fields_str_1164 = String$concat("; ", List$map(_t1160, collect(row)));
      let _t1166;
      if (is_open(row)) {
        let _t1167;
        if ((fields_str_1164 === "")) {
          _t1167 = "..";
        } else {
          _t1167 = "; ..";
        }
        _t1166 = ("{ " + (fields_str_1164 + (_t1167 + " }")));
      } else {
        _t1166 = ("{ " + (fields_str_1164 + " }"));
      }
      const _t1165 = _t1166;
      const _t1159 = _t1165;
      const _t1154 = _t1159;
      _t1131 = _t1154;
      break _t1132;
    }
    if (_t1130._tag === 12 && _t1130._val[1] === null) {
      const name = _t1130._val[0];
      _t1131 = name;
      break _t1132;
    }
    if (_t1130._tag === 12 && _t1130._val[1] !== null && _t1130._val[1]._tl === null) {
      const name = _t1130._val[0];
      const arg = _t1130._val[1]._hd;
      _t1131 = (Types$pp_ty_arg(arg) + (" " + name));
      break _t1132;
    }
    if (_t1130._tag === 12) {
      const name = _t1130._val[0];
      const args = _t1130._val[1];
      _t1131 = ("(" + (String$concat(", ", List$map(Types$pp_ty, args)) + (") " + name)));
      break _t1132;
    }
    if (_t1130._tag === 14) {
      const row = _t1130._val;
      function collect_tags(r) {
        let _t1169;
        const _t1168 = Types$pv_repr(r);
        _t1170: {
          if (_t1168._tag === 0) {
            const tag = _t1168._val[0];
            const ty_opt = _t1168._val[1];
            const tail = _t1168._val[2];
            _t1169 = ({_hd: [tag, ty_opt], _tl: collect_tags(tail)});
            break _t1170;
          }
          if (true) {
            _t1169 = null;
            break _t1170;
          }
          _match_fail("line 16933");
        }
        return _t1169;
      }
      let _t1173;
      const _t1172 = Types$pv_repr(row);
      _t1174: {
        if (_t1172._tag === 1) {
          _t1173 = true;
          break _t1174;
        }
        if (_t1172._tag === 0) {
          function check(r) {
            while (true) {
              let _t1176;
              const _t1175 = Types$pv_repr(r);
              _t1177: {
                if (_t1175._tag === 0) {
                  const tail = _t1175._val[2];
                  const _t1178 = tail;
                  r = _t1178;
                  continue;
                  _t1176 = undefined;
                  break _t1177;
                }
                if (_t1175._tag === 1) {
                  _t1176 = true;
                  break _t1177;
                }
                if (true) {
                  _t1176 = false;
                  break _t1177;
                }
                _match_fail("line 16933");
              }
              return _t1176;
            }
          }
          const _t1179 = check(row);
          _t1173 = _t1179;
          break _t1174;
        }
        if (true) {
          _t1173 = false;
          break _t1174;
        }
        _match_fail("line 16933");
      }
      const is_open_1180 = _t1173;
      const tags_1182 = collect_tags(row);
      function _t1184(__p40) {
        let _t1186;
        const _t1185 = __p40;
        _t1187: {
          if (true) {
            const tag = _t1185[0];
            const ty_opt = _t1185[1];
            let _t1189;
            const _t1188 = ty_opt;
            _t1190: {
              if (_t1188._tag === 0) {
                _t1189 = ("`" + tag);
                break _t1190;
              }
              if (_t1188._tag === 1) {
                const t = _t1188._val;
                _t1189 = ("`" + (tag + (" of " + Types$pp_ty(t))));
                break _t1190;
              }
              _match_fail("line 16933");
            }
            _t1186 = _t1189;
            break _t1187;
          }
          _match_fail("line 16933");
        }
        return _t1186;
      }
      const tag_strs_1191 = List$map(_t1184, tags_1182);
      let _t1193;
      if (is_open_1180) {
        _t1193 = "> ";
      } else {
        _t1193 = "";
      }
      const marker_1194 = _t1193;
      const _t1195 = ("[" + (marker_1194 + (String$concat(" | ", tag_strs_1191) + "]")));
      const _t1192 = _t1195;
      const _t1183 = _t1192;
      const _t1181 = _t1183;
      const _t1171 = _t1181;
      _t1131 = _t1171;
      break _t1132;
    }
    if (_t1130._tag === 15 && _t1130._val.contents._tag === 0) {
      const id = _t1130._val.contents._val[0];
      _t1131 = ("'" + String$make(1, Byte$of_int((Byte$to_int(97) + (id % 26)))));
      break _t1132;
    }
    if (_t1130._tag === 15 && _t1130._val.contents._tag === 1) {
      _t1131 = failwith("assert false");
      break _t1132;
    }
    if (_t1130._tag === 16) {
      const id = _t1130._val;
      _t1131 = ("'" + String$make(1, Byte$of_int((Byte$to_int(97) + (id % 26)))));
      break _t1132;
    }
    _match_fail("line 16933");
  }
  return _t1131;
}
const Types$__destruct = Ref$set(Types$pp_ty_arg_ref, Types$pp_ty_arg);
function Types$unify_error(t1, t2) {
  return _trampoline(function() {
    return _h["unify_error"](((("cannot unify " + __dict_Show_string.show(Types$pp_ty(t1))) + " with ") + __dict_Show_string.show(Types$pp_ty(t2))), function(_t1196) {
      return _bounce(function() {
        return _t1196;
      });
    });
  }, Types$unify_error);
}
function Types$collect_eff_row(eff) {
  let _t1198;
  const _t1197 = Types$eff_repr(eff);
  _t1199: {
    if (_t1197._tag === 2) {
      const l = _t1197._val[0];
      const p = _t1197._val[1];
      const tail = _t1197._val[2];
      let _t1201;
      const _t1200 = Types$collect_eff_row(tail);
      _t1202: {
        if (true) {
          const rest = _t1200[0];
          const ft = _t1200[1];
          _t1201 = [({_hd: [l, p], _tl: rest}), ft];
          break _t1202;
        }
        _match_fail("line 16933");
      }
      _t1198 = _t1201;
      break _t1199;
    }
    if (true) {
      const other = _t1197;
      _t1198 = [null, other];
      break _t1199;
    }
    _match_fail("line 16933");
  }
  return _t1198;
}
function Types$collect_pv_row(row) {
  let _t1204;
  const _t1203 = Types$pv_repr(row);
  _t1205: {
    if (_t1203._tag === 0) {
      const t = _t1203._val[0];
      const ty = _t1203._val[1];
      const tail = _t1203._val[2];
      let _t1207;
      const _t1206 = Types$collect_pv_row(tail);
      _t1208: {
        if (true) {
          const rest = _t1206[0];
          const ft = _t1206[1];
          _t1207 = [({_hd: [t, ty], _tl: rest}), ft];
          break _t1208;
        }
        _match_fail("line 16933");
      }
      _t1204 = _t1207;
      break _t1205;
    }
    if (true) {
      const other = _t1203;
      _t1204 = [null, other];
      break _t1205;
    }
    _match_fail("line 16933");
  }
  return _t1204;
}
function Types$collect_rrow(row) {
  let _t1210;
  const _t1209 = Types$rrow_repr(row);
  _t1211: {
    if (_t1209._tag === 0) {
      const f = _t1209._val[0];
      const ty = _t1209._val[1];
      const tail = _t1209._val[2];
      let _t1213;
      const _t1212 = Types$collect_rrow(tail);
      _t1214: {
        if (true) {
          const rest = _t1212[0];
          const ft = _t1212[1];
          _t1213 = [({_hd: [f, ty], _tl: rest}), ft];
          break _t1214;
        }
        _match_fail("line 16933");
      }
      _t1210 = _t1213;
      break _t1211;
    }
    if (true) {
      const other = _t1209;
      _t1210 = [null, other];
      break _t1211;
    }
    _match_fail("line 16933");
  }
  return _t1210;
}
function Types$unify_eff(e1, e2) {
  return _trampoline(function() {
    const e1_1215 = _resolve(Types$eff_repr(e1));
    const e2_1216 = _resolve(Types$eff_repr(e2));
    if (_eq(e1_1215, e2_1216)) {
      return undefined;
    } else {
      const _t1217 = [e1_1215, e2_1216];
      let _t1218 = false;
      if (!_t1218 && (_t1217[0]._tag === 0 && _t1217[0]._val.contents._tag === 0 || _t1217[1]._tag === 0 && _t1217[1]._val.contents._tag === 0)) {
        const id = (_t1217[0]._tag === 0 && _t1217[0]._val.contents._tag === 0 ? _t1217[0]._val.contents._val[0] : _t1217[1]._val.contents._val[0]);
        const level = (_t1217[0]._tag === 0 && _t1217[0]._val.contents._tag === 0 ? _t1217[0]._val.contents._val[1] : _t1217[1]._val.contents._val[1]);
        const r = (_t1217[0]._tag === 0 && _t1217[0]._val.contents._tag === 0 ? _t1217[0]._val : _t1217[1]._val);
        const eff = (_t1217[0]._tag === 0 && _t1217[0]._val.contents._tag === 0 ? _t1217[1] : _t1217[0]);
        _t1218 = true;
        Types$occurs_check_eff(id, level, eff);
        return Ref$set(r, ({_tag: 1, _name: "EffLink", _val: eff}));
      }
      if (!_t1218 && _t1217[0]._tag === 1 && _t1217[1]._tag === 1) {
        _t1218 = true;
        return undefined;
      }
      if (!_t1218 && _t1217[0]._tag === 2 && _t1217[1]._tag === 2) {
        const label1 = _t1217[0]._val[0];
        const params1 = _t1217[0]._val[1];
        const tail1 = _t1217[0]._val[2];
        const label2 = _t1217[1]._val[0];
        const params2 = _t1217[1]._val[1];
        const tail2 = _t1217[1]._val[2];
        if (((label1 === label2) && (List$length(params1) === List$length(params2)))) {
          _t1218 = true;
          List$iter2(Types$unify, params1, params2);
          return Types$unify_eff(tail1, tail2);
        }
      }
      if (!_t1218 && _t1217[0]._tag === 2) {
        const _label1 = _t1217[0]._val[0];
        const _params1 = _t1217[0]._val[1];
        const _tail1 = _t1217[0]._val[2];
        _t1218 = true;
        let _t1220;
        const _t1219 = Types$collect_eff_row(e1_1215);
        _t1221: {
          if (true) {
            const ft1 = _t1219[1];
            let _t1223;
            const _t1222 = Types$collect_eff_row(e2_1216);
            _t1224: {
              if (true) {
                const ft2 = _t1222[1];
                let _t1226;
                const _t1225 = [ft1, ft2];
                _t1227: {
                  if (_t1225[0]._tag === 0 && _t1225[1]._tag === 0) {
                    const r1 = _t1225[0]._val;
                    const r2 = _t1225[1]._val;
                    _t1226 = _eq(r1, r2);
                    break _t1227;
                  }
                  if (true) {
                    _t1226 = false;
                    break _t1227;
                  }
                  _match_fail("line 16933");
                }
                const shared_1228 = _t1226;
                let _t1230;
                if (shared_1228) {
                  _t1230 = Types$unify_eff_shared_tail(e1_1215, e2_1216);
                } else {
                  let _t1232;
                  const _t1231 = e1_1215;
                  _t1233: {
                    if (_t1231._tag === 2) {
                      const l = _t1231._val[0];
                      const p = _t1231._val[1];
                      const t = _t1231._val[2];
                      _t1232 = [l, p, t];
                      break _t1233;
                    }
                    if (true) {
                      _t1232 = failwith("assert false");
                      break _t1233;
                    }
                    _match_fail("line 16933");
                  }
                  let _t1235;
                  const _t1234 = _t1232;
                  _t1236: {
                    if (true) {
                      const label1 = _t1234[0];
                      const params1 = _t1234[1];
                      const tail1 = _t1234[2];
                      const tail2_1237 = Types$rewrite_row(label1, params1, e2_1216);
                      const _t1238 = Types$unify_eff(tail1, tail2_1237);
                      _t1235 = _t1238;
                      break _t1236;
                    }
                    _match_fail("line 16933");
                  }
                  _t1230 = _t1235;
                }
                const _t1229 = _t1230;
                _t1223 = _t1229;
                break _t1224;
              }
              _match_fail("line 16933");
            }
            _t1220 = _t1223;
            break _t1221;
          }
          _match_fail("line 16933");
        }
        return _t1220;
      }
      if (!_t1218 && _t1217[1]._tag === 2) {
        _t1218 = true;
        return Types$unify_eff(e2_1216, e1_1215);
      }
      if (!_t1218 && _t1217[0]._tag === 3 && _t1217[1]._tag === 3) {
        const i = _t1217[0]._val;
        const j = _t1217[1]._val;
        if ((i === j)) {
          _t1218 = true;
          return undefined;
        }
      }
      if (!_t1218 && true) {
        _t1218 = true;
        return _h["unify_error"](((("cannot unify effects " + __dict_Show_string.show(Types$pp_eff(e1_1215))) + " and ") + __dict_Show_string.show(Types$pp_eff(e2_1216))), function(_t1239) {
          return _bounce(function() {
            return _t1239;
          });
        });
      }
      if (!_t1218) _match_fail("line 16933");
    }
  }, Types$unify_eff);
}
function Types$rewrite_row(label, params_to_unify, eff) {
  return _trampoline(function() {
    const _t1240 = Types$eff_repr(eff);
    let _t1241 = false;
    if (!_t1241 && _t1240._tag === 2) {
      const l = _t1240._val[0];
      const found_params = _t1240._val[1];
      const tail = _t1240._val[2];
      if ((l === label)) {
        _t1241 = true;
        let _t1242;
        if ((List$length(params_to_unify) === List$length(found_params))) {
          _t1242 = List$iter2(Types$unify, params_to_unify, found_params);
        } else {
          _t1242 = undefined;
        }
        _t1242;
        return tail;
      }
    }
    if (!_t1241 && _t1240._tag === 2) {
      const l = _t1240._val[0];
      const params = _t1240._val[1];
      const tail = _t1240._val[2];
      _t1241 = true;
      return ({_tag: 2, _name: "EffRow", _val: [l, params, Types$rewrite_row(label, params_to_unify, tail)]});
    }
    if (!_t1241 && _t1240._tag === 0 && _t1240._val.contents._tag === 0) {
      const id = _t1240._val.contents._val[0];
      const level = _t1240._val.contents._val[1];
      const r = _t1240._val;
      _t1241 = true;
      const new_tail_1243 = Types$new_effvar(level);
      const new_row_1245 = ({_tag: 2, _name: "EffRow", _val: [label, params_to_unify, new_tail_1243]});
      Types$occurs_check_eff(id, level, new_row_1245);
      Ref$set(r, ({_tag: 1, _name: "EffLink", _val: new_row_1245}));
      const _t1246 = new_tail_1243;
      const _t1244 = _t1246;
      return _t1244;
    }
    if (!_t1241 && _t1240._tag === 1) {
      _t1241 = true;
      return _h["unify_error"]((("effect " + __dict_Show_string.show(label)) + " not handled"), function(_t1247) {
        return _bounce(function() {
          return _t1247;
        });
      });
    }
    if (!_t1241 && true) {
      _t1241 = true;
      return _h["unify_error"](("cannot rewrite effect row for " + __dict_Show_string.show(label)), function(_t1248) {
        return _bounce(function() {
          return _t1248;
        });
      });
    }
    if (!_t1241) _match_fail("line 16933");
  }, Types$rewrite_row);
}
function Types$unify_eff_shared_tail(e1, e2) {
  return _trampoline(function() {
    const _t1249 = Types$collect_eff_row(e1);
    let _t1250 = false;
    if (!_t1250 && true) {
      const labels1 = _t1249[0];
      const _mml$final = _t1249[1];
      _t1250 = true;
      const _t1251 = Types$collect_eff_row(e2);
      let _t1252 = false;
      if (!_t1252 && true) {
        const labels2 = _t1251[0];
        _t1252 = true;
        let _t1254;
        const _t1253 = Types$eff_repr(_mml$final);
        _t1255: {
          if (_t1253._tag === 0 && _t1253._val.contents._tag === 0) {
            const l = _t1253._val.contents._val[1];
            _t1254 = l;
            break _t1255;
          }
          if (true) {
            _t1254 = failwith("assert false");
            break _t1255;
          }
          _match_fail("line 16933");
        }
        const level_1256 = _resolve(_t1254);
        const fresh_1257 = _resolve(Types$new_effvar(level_1256));
        const remaining2_1258 = _resolve(Ref$create(labels2));
        const only1_1259 = _resolve(Ref$create(null));
        function _t1260(__p41) {
          return _trampoline(function() {
            const _t1261 = __p41;
            let _t1262 = false;
            if (!_t1262 && true) {
              const l1 = _t1261[0];
              const p1 = _t1261[1];
              _t1262 = true;
              function find_and_remove(__x) {
                let _t1264;
                const _t1263 = __x;
                _t1265: {
                  if (_t1263 === null) {
                    _t1264 = [({_tag: 0, _name: "None"}), null];
                    break _t1265;
                  }
                  if (_t1263 !== null) {
                    const l2 = _t1263._hd[0];
                    const p2 = _t1263._hd[1];
                    const rest = _t1263._tl;
                    if ((l1 === l2)) {
                      _t1264 = [({_tag: 1, _name: "Some", _val: p2}), rest];
                      break _t1265;
                    }
                  }
                  if (_t1263 !== null) {
                    const x = _t1263._hd;
                    const rest = _t1263._tl;
                    let _t1267;
                    const _t1266 = find_and_remove(rest);
                    _t1268: {
                      if (true) {
                        const found = _t1266[0];
                        const remaining = _t1266[1];
                        _t1267 = [found, ({_hd: x, _tl: remaining})];
                        break _t1268;
                      }
                      _match_fail("line 16933");
                    }
                    _t1264 = _t1267;
                    break _t1265;
                  }
                  _match_fail("line 16933");
                }
                return _t1264;
              }
              const _t1269 = find_and_remove(Ref$get(remaining2_1258));
              let _t1270 = false;
              if (!_t1270 && true) {
                const found = _t1269[0];
                const rest = _t1269[1];
                _t1270 = true;
                _resolve(Ref$set(remaining2_1258, rest));
                const _t1271 = found;
                let _t1272 = false;
                if (!_t1272 && _t1271._tag === 1) {
                  const p2 = _t1271._val;
                  _t1272 = true;
                  if ((List$length(p1) === List$length(p2))) {
                    return List$iter2(Types$unify, p1, p2);
                  } else {
                    return _h["unify_error"](((("cannot unify effects " + __dict_Show_string.show(Types$pp_eff(e1))) + " and ") + __dict_Show_string.show(Types$pp_eff(e2))), function(_t1273) {
                      return _bounce(function() {
                        return _t1273;
                      });
                    });
                  }
                }
                if (!_t1272 && _t1271._tag === 0) {
                  _t1272 = true;
                  return Ref$set(only1_1259, ({_hd: [l1, p1], _tl: Ref$get(only1_1259)}));
                }
                if (!_t1272) _match_fail("line 16933");
              }
              if (!_t1270) _match_fail("line 16933");
            }
            if (!_t1262) _match_fail("line 16933");
          });
        }
        const _t1274 = _resolve(List$iter(_t1260, labels1));
        _resolve(_t1274);
        function _t1275(__p42, acc) {
          let _t1277;
          const _t1276 = __p42;
          _t1278: {
            if (true) {
              const l = _t1276[0];
              const p = _t1276[1];
              _t1277 = ({_tag: 2, _name: "EffRow", _val: [l, p, acc]});
              break _t1278;
            }
            _match_fail("line 16933");
          }
          return _t1277;
        }
        const new_tail_1279 = List$fold_right(_t1275, List$concat(List$rev(Ref$get(only1_1259)), Ref$get(remaining2_1258)), fresh_1257);
        let _t1282;
        const _t1281 = Types$eff_repr(_mml$final);
        _t1283: {
          if (_t1281._tag === 0 && _t1281._val.contents._tag === 0) {
            const id = _t1281._val.contents._val[0];
            const r = _t1281._val;
            Types$occurs_check_eff(id, level_1256, new_tail_1279);
            _t1282 = Ref$set(r, ({_tag: 1, _name: "EffLink", _val: new_tail_1279}));
            break _t1283;
          }
          if (true) {
            _t1282 = failwith("assert false");
            break _t1283;
          }
          _match_fail("line 16933");
        }
        const _t1280 = _t1282;
        return _t1280;
      }
      if (!_t1252) _match_fail("line 16933");
    }
    if (!_t1250) _match_fail("line 16933");
  }, Types$unify_eff_shared_tail);
}
function Types$subeffect(source, target) {
  while (true) {
    const source_1284 = Types$eff_repr(source);
    const target_1286 = Types$eff_repr(target);
    let _t1288;
    if (_eq(source_1284, target_1286)) {
      _t1288 = undefined;
    } else {
      let _t1290;
      const _t1289 = source_1284;
      _t1291: {
        if (_t1289._tag === 1) {
          _t1290 = undefined;
          break _t1291;
        }
        if (_t1289._tag === 0 && _t1289._val.contents._tag === 0) {
          _t1290 = Types$unify_eff(source_1284, target_1286);
          break _t1291;
        }
        if (_t1289._tag === 2) {
          const _label = _t1289._val[0];
          const _params = _t1289._val[1];
          const _tail = _t1289._val[2];
          let _t1293;
          const _t1292 = Types$collect_eff_row(source_1284);
          _t1294: {
            if (true) {
              const ft_source = _t1292[1];
              let _t1296;
              const _t1295 = Types$collect_eff_row(target_1286);
              _t1297: {
                if (true) {
                  const ft_target = _t1295[1];
                  let _t1299;
                  const _t1298 = [ft_source, ft_target];
                  _t1300: {
                    if (_t1298[0]._tag === 0 && _t1298[1]._tag === 0) {
                      const r1 = _t1298[0]._val;
                      const r2 = _t1298[1]._val;
                      _t1299 = _eq(r1, r2);
                      break _t1300;
                    }
                    if (true) {
                      _t1299 = false;
                      break _t1300;
                    }
                    _match_fail("line 16933");
                  }
                  const shared_1301 = _t1299;
                  let _t1303;
                  if (shared_1301) {
                    _t1303 = Types$unify_eff_shared_tail(source_1284, target_1286);
                  } else {
                    let _t1305;
                    const _t1304 = source_1284;
                    _t1306: {
                      if (_t1304._tag === 2) {
                        const l = _t1304._val[0];
                        const p = _t1304._val[1];
                        const t = _t1304._val[2];
                        _t1305 = [l, p, t];
                        break _t1306;
                      }
                      if (true) {
                        _t1305 = failwith("assert false");
                        break _t1306;
                      }
                      _match_fail("line 16933");
                    }
                    let _t1308;
                    const _t1307 = _t1305;
                    _t1309: {
                      if (true) {
                        const label = _t1307[0];
                        const params = _t1307[1];
                        const tail = _t1307[2];
                        const target_tail_1310 = Types$rewrite_row(label, params, target_1286);
                        const _t1312 = Types$eff_repr(tail);
                        const _t1313 = target_tail_1310;
                        source = _t1312;
                        target = _t1313;
                        continue;
                        const _t1311 = undefined;
                        _t1308 = _t1311;
                        break _t1309;
                      }
                      _match_fail("line 16933");
                    }
                    _t1303 = _t1308;
                  }
                  const _t1302 = _t1303;
                  _t1296 = _t1302;
                  break _t1297;
                }
                _match_fail("line 16933");
              }
              _t1293 = _t1296;
              break _t1294;
            }
            _match_fail("line 16933");
          }
          _t1290 = _t1293;
          break _t1291;
        }
        if (_t1289._tag === 3) {
          _t1290 = undefined;
          break _t1291;
        }
        if (true) {
          _t1290 = Types$unify_eff(source_1284, target_1286);
          break _t1291;
        }
        _match_fail("line 16933");
      }
      _t1288 = _t1290;
    }
    const _t1287 = _t1288;
    const _t1285 = _t1287;
    return _t1285;
  }
}
function Types$unify_pv_row(r1, r2) {
  return _trampoline(function() {
    const r1_1314 = _resolve(Types$pv_repr(r1));
    const r2_1315 = _resolve(Types$pv_repr(r2));
    if (_eq(r1_1314, r2_1315)) {
      return undefined;
    } else {
      const _t1316 = [r1_1314, r2_1315];
      let _t1317 = false;
      if (!_t1317 && (_t1316[0]._tag === 1 && _t1316[0]._val.contents._tag === 0 || _t1316[1]._tag === 1 && _t1316[1]._val.contents._tag === 0)) {
        const id = (_t1316[0]._tag === 1 && _t1316[0]._val.contents._tag === 0 ? _t1316[0]._val.contents._val[0] : _t1316[1]._val.contents._val[0]);
        const level = (_t1316[0]._tag === 1 && _t1316[0]._val.contents._tag === 0 ? _t1316[0]._val.contents._val[1] : _t1316[1]._val.contents._val[1]);
        const r = (_t1316[0]._tag === 1 && _t1316[0]._val.contents._tag === 0 ? _t1316[0]._val : _t1316[1]._val);
        const row = (_t1316[0]._tag === 1 && _t1316[0]._val.contents._tag === 0 ? _t1316[1] : _t1316[0]);
        _t1317 = true;
        Types$occurs_check_pv(id, level, row);
        return Ref$set(r, ({_tag: 1, _name: "PVLink", _val: row}));
      }
      if (!_t1317 && _t1316[0]._tag === 2 && _t1316[1]._tag === 2) {
        _t1317 = true;
        return undefined;
      }
      if (!_t1317 && _t1316[0]._tag === 0 && _t1316[1]._tag === 0) {
        const tag1 = _t1316[0]._val[0];
        const ty1 = _t1316[0]._val[1];
        const tail1 = _t1316[0]._val[2];
        const tag2 = _t1316[1]._val[0];
        const ty2 = _t1316[1]._val[1];
        const tail2 = _t1316[1]._val[2];
        if ((tag1 === tag2)) {
          _t1317 = true;
          Types$unify_pv_payload(ty1, ty2);
          return Types$unify_pv_row(tail1, tail2);
        }
      }
      if (!_t1317 && _t1316[0]._tag === 0) {
        const _tag1 = _t1316[0]._val[0];
        const _ty1 = _t1316[0]._val[1];
        const _tail1 = _t1316[0]._val[2];
        _t1317 = true;
        let _t1319;
        const _t1318 = Types$collect_pv_row(r1_1314);
        _t1320: {
          if (true) {
            const ft1 = _t1318[1];
            let _t1322;
            const _t1321 = Types$collect_pv_row(r2_1315);
            _t1323: {
              if (true) {
                const ft2 = _t1321[1];
                let _t1325;
                const _t1324 = [ft1, ft2];
                _t1326: {
                  if (_t1324[0]._tag === 1 && _t1324[1]._tag === 1) {
                    const rv1 = _t1324[0]._val;
                    const rv2 = _t1324[1]._val;
                    _t1325 = _eq(rv1, rv2);
                    break _t1326;
                  }
                  if (true) {
                    _t1325 = false;
                    break _t1326;
                  }
                  _match_fail("line 16933");
                }
                const shared_1327 = _t1325;
                let _t1329;
                if (shared_1327) {
                  _t1329 = Types$unify_pv_shared_tail(r1_1314, r2_1315);
                } else {
                  let _t1331;
                  const _t1330 = r1_1314;
                  _t1332: {
                    if (_t1330._tag === 0) {
                      const t = _t1330._val[0];
                      const ty = _t1330._val[1];
                      const tl = _t1330._val[2];
                      _t1331 = [t, ty, tl];
                      break _t1332;
                    }
                    if (true) {
                      _t1331 = failwith("assert false");
                      break _t1332;
                    }
                    _match_fail("line 16933");
                  }
                  let _t1334;
                  const _t1333 = _t1331;
                  _t1335: {
                    if (true) {
                      const tag1 = _t1333[0];
                      const ty1 = _t1333[1];
                      const tail1 = _t1333[2];
                      let _t1337;
                      const _t1336 = Types$rewrite_pv_row(tag1, ty1, r2_1315);
                      _t1338: {
                        if (true) {
                          const ty2 = _t1336[0];
                          const tail2 = _t1336[1];
                          Types$unify_pv_payload(ty1, ty2);
                          _t1337 = Types$unify_pv_row(tail1, tail2);
                          break _t1338;
                        }
                        _match_fail("line 16933");
                      }
                      _t1334 = _t1337;
                      break _t1335;
                    }
                    _match_fail("line 16933");
                  }
                  _t1329 = _t1334;
                }
                const _t1328 = _t1329;
                _t1322 = _t1328;
                break _t1323;
              }
              _match_fail("line 16933");
            }
            _t1319 = _t1322;
            break _t1320;
          }
          _match_fail("line 16933");
        }
        return _t1319;
      }
      if (!_t1317 && _t1316[1]._tag === 0) {
        _t1317 = true;
        return Types$unify_pv_row(r2_1315, r1_1314);
      }
      if (!_t1317 && _t1316[0]._tag === 3 && _t1316[1]._tag === 3) {
        const i = _t1316[0]._val;
        const j = _t1316[1]._val;
        if ((i === j)) {
          _t1317 = true;
          return undefined;
        }
      }
      if (!_t1317 && true) {
        _t1317 = true;
        return _h["unify_error"]("cannot unify polymorphic variant types", function(_t1339) {
          return _bounce(function() {
            return _t1339;
          });
        });
      }
      if (!_t1317) _match_fail("line 16933");
    }
  }, Types$unify_pv_row);
}
function Types$unify_pv_payload(ty1, ty2) {
  return _trampoline(function() {
    const _t1340 = [ty1, ty2];
    let _t1341 = false;
    if (!_t1341 && _t1340[0]._tag === 0 && _t1340[1]._tag === 0) {
      _t1341 = true;
      return undefined;
    }
    if (!_t1341 && _t1340[0]._tag === 1 && _t1340[1]._tag === 1) {
      const t1 = _t1340[0]._val;
      const t2 = _t1340[1]._val;
      _t1341 = true;
      return Types$unify(t1, t2);
    }
    if (!_t1341 && true) {
      _t1341 = true;
      return _h["unify_error"]("polymorphic variant payload mismatch", function(_t1342) {
        return _bounce(function() {
          return _t1342;
        });
      });
    }
    if (!_t1341) _match_fail("line 16933");
  }, Types$unify_pv_payload);
}
function Types$rewrite_pv_row(tag, default_payload, row) {
  return _trampoline(function() {
    const _t1343 = Types$pv_repr(row);
    let _t1344 = false;
    if (!_t1344 && _t1343._tag === 0) {
      const t = _t1343._val[0];
      const ty_opt = _t1343._val[1];
      const tail = _t1343._val[2];
      if ((t === tag)) {
        _t1344 = true;
        return [ty_opt, tail];
      }
    }
    if (!_t1344 && _t1343._tag === 0) {
      const t = _t1343._val[0];
      const ty_opt = _t1343._val[1];
      const tail = _t1343._val[2];
      _t1344 = true;
      let _t1346;
      const _t1345 = Types$rewrite_pv_row(tag, default_payload, tail);
      _t1347: {
        if (true) {
          const found = _t1345[0];
          const rest = _t1345[1];
          _t1346 = [found, ({_tag: 0, _name: "PVRow", _val: [t, ty_opt, rest]})];
          break _t1347;
        }
        _match_fail("line 16933");
      }
      return _t1346;
    }
    if (!_t1344 && _t1343._tag === 1 && _t1343._val.contents._tag === 0) {
      const id = _t1343._val.contents._val[0];
      const level = _t1343._val.contents._val[1];
      const r = _t1343._val;
      _t1344 = true;
      const new_tail_1348 = Types$new_pvvar(level);
      const new_row_1350 = ({_tag: 0, _name: "PVRow", _val: [tag, default_payload, new_tail_1348]});
      Types$occurs_check_pv(id, level, new_row_1350);
      Ref$set(r, ({_tag: 1, _name: "PVLink", _val: new_row_1350}));
      const _t1351 = [default_payload, new_tail_1348];
      const _t1349 = _t1351;
      return _t1349;
    }
    if (!_t1344 && _t1343._tag === 2) {
      _t1344 = true;
      return _h["unify_error"]((("tag `" + __dict_Show_string.show(tag)) + " not in closed polymorphic variant type"), function(_t1352) {
        return _bounce(function() {
          return _t1352;
        });
      });
    }
    if (!_t1344 && true) {
      _t1344 = true;
      return _h["unify_error"](("cannot rewrite polymorphic variant row for `" + __dict_Show_string.show(tag)), function(_t1353) {
        return _bounce(function() {
          return _t1353;
        });
      });
    }
    if (!_t1344) _match_fail("line 16933");
  }, Types$rewrite_pv_row);
}
function Types$unify_pv_shared_tail(r1, r2) {
  let _t1355;
  const _t1354 = Types$collect_pv_row(r1);
  _t1356: {
    if (true) {
      const labels1 = _t1354[0];
      const _mml$final = _t1354[1];
      let _t1358;
      const _t1357 = Types$collect_pv_row(r2);
      _t1359: {
        if (true) {
          const labels2 = _t1357[0];
          let _t1361;
          const _t1360 = Types$pv_repr(_mml$final);
          _t1362: {
            if (_t1360._tag === 1 && _t1360._val.contents._tag === 0) {
              const l = _t1360._val.contents._val[1];
              _t1361 = l;
              break _t1362;
            }
            if (true) {
              _t1361 = failwith("assert false");
              break _t1362;
            }
            _match_fail("line 16933");
          }
          const level_1363 = _t1361;
          const fresh_1365 = Types$new_pvvar(level_1363);
          const remaining2_1367 = Ref$create(labels2);
          const only1_1369 = Ref$create(null);
          function _t1371(__p43) {
            let _t1373;
            const _t1372 = __p43;
            _t1374: {
              if (true) {
                const t1 = _t1372[0];
                const ty1 = _t1372[1];
                function find_and_remove(__x) {
                  let _t1376;
                  const _t1375 = __x;
                  _t1377: {
                    if (_t1375 === null) {
                      _t1376 = [({_tag: 0, _name: "None"}), null];
                      break _t1377;
                    }
                    if (_t1375 !== null) {
                      const t2 = _t1375._hd[0];
                      const ty2 = _t1375._hd[1];
                      const rest = _t1375._tl;
                      if ((t1 === t2)) {
                        _t1376 = [({_tag: 1, _name: "Some", _val: ty2}), rest];
                        break _t1377;
                      }
                    }
                    if (_t1375 !== null) {
                      const x = _t1375._hd;
                      const rest = _t1375._tl;
                      let _t1379;
                      const _t1378 = find_and_remove(rest);
                      _t1380: {
                        if (true) {
                          const f = _t1378[0];
                          const r = _t1378[1];
                          _t1379 = [f, ({_hd: x, _tl: r})];
                          break _t1380;
                        }
                        _match_fail("line 16933");
                      }
                      _t1376 = _t1379;
                      break _t1377;
                    }
                    _match_fail("line 16933");
                  }
                  return _t1376;
                }
                let _t1383;
                const _t1382 = find_and_remove(Ref$get(remaining2_1367));
                _t1384: {
                  if (true) {
                    const found = _t1382[0];
                    const rest = _t1382[1];
                    Ref$set(remaining2_1367, rest);
                    let _t1386;
                    const _t1385 = found;
                    _t1387: {
                      if (_t1385._tag === 1) {
                        const ty2 = _t1385._val;
                        _t1386 = Types$unify_pv_payload(ty1, ty2);
                        break _t1387;
                      }
                      if (_t1385._tag === 0) {
                        _t1386 = Ref$set(only1_1369, ({_hd: [t1, ty1], _tl: Ref$get(only1_1369)}));
                        break _t1387;
                      }
                      _match_fail("line 16933");
                    }
                    _t1383 = _t1386;
                    break _t1384;
                  }
                  _match_fail("line 16933");
                }
                const _t1381 = _t1383;
                _t1373 = _t1381;
                break _t1374;
              }
              _match_fail("line 16933");
            }
            return _t1373;
          }
          List$iter(_t1371, labels1);
          function _t1388(__p44, acc) {
            let _t1390;
            const _t1389 = __p44;
            _t1391: {
              if (true) {
                const t = _t1389[0];
                const ty = _t1389[1];
                _t1390 = ({_tag: 0, _name: "PVRow", _val: [t, ty, acc]});
                break _t1391;
              }
              _match_fail("line 16933");
            }
            return _t1390;
          }
          const new_tail_1392 = List$fold_right(_t1388, List$concat(List$rev(Ref$get(only1_1369)), Ref$get(remaining2_1367)), fresh_1365);
          let _t1395;
          const _t1394 = Types$pv_repr(_mml$final);
          _t1396: {
            if (_t1394._tag === 1 && _t1394._val.contents._tag === 0) {
              const id = _t1394._val.contents._val[0];
              const r = _t1394._val;
              Types$occurs_check_pv(id, level_1363, new_tail_1392);
              _t1395 = Ref$set(r, ({_tag: 1, _name: "PVLink", _val: new_tail_1392}));
              break _t1396;
            }
            if (true) {
              _t1395 = failwith("assert false");
              break _t1396;
            }
            _match_fail("line 16933");
          }
          const _t1393 = _t1395;
          const _t1370 = _t1393;
          const _t1368 = _t1370;
          const _t1366 = _t1368;
          const _t1364 = _t1366;
          _t1358 = _t1364;
          break _t1359;
        }
        _match_fail("line 16933");
      }
      _t1355 = _t1358;
      break _t1356;
    }
    _match_fail("line 16933");
  }
  return _t1355;
}
function Types$unify_record_row(r1, r2) {
  return _trampoline(function() {
    const r1_1397 = _resolve(Types$rrow_repr(r1));
    const r2_1398 = _resolve(Types$rrow_repr(r2));
    if (_eq(r1_1397, r2_1398)) {
      return undefined;
    } else {
      const _t1399 = [r1_1397, r2_1398];
      let _t1400 = false;
      if (!_t1400 && (_t1399[0]._tag === 1 && _t1399[0]._val.contents._tag === 0 || _t1399[1]._tag === 1 && _t1399[1]._val.contents._tag === 0)) {
        const id = (_t1399[0]._tag === 1 && _t1399[0]._val.contents._tag === 0 ? _t1399[0]._val.contents._val[0] : _t1399[1]._val.contents._val[0]);
        const level = (_t1399[0]._tag === 1 && _t1399[0]._val.contents._tag === 0 ? _t1399[0]._val.contents._val[1] : _t1399[1]._val.contents._val[1]);
        const r = (_t1399[0]._tag === 1 && _t1399[0]._val.contents._tag === 0 ? _t1399[0]._val : _t1399[1]._val);
        const row = (_t1399[0]._tag === 1 && _t1399[0]._val.contents._tag === 0 ? _t1399[1] : _t1399[0]);
        _t1400 = true;
        Types$occurs_check_rrow(id, level, row);
        return Ref$set(r, ({_tag: 1, _name: "RLink", _val: row}));
      }
      if (!_t1400 && (_t1399[0]._tag === 4 || _t1399[1]._tag === 4)) {
        _t1400 = true;
        return undefined;
      }
      if (!_t1400 && _t1399[0]._tag === 2 && _t1399[1]._tag === 2) {
        _t1400 = true;
        return undefined;
      }
      if (!_t1400 && _t1399[0]._tag === 0 && _t1399[1]._tag === 0) {
        const f1 = _t1399[0]._val[0];
        const ty1 = _t1399[0]._val[1];
        const tail1 = _t1399[0]._val[2];
        const f2 = _t1399[1]._val[0];
        const ty2 = _t1399[1]._val[1];
        const tail2 = _t1399[1]._val[2];
        if ((f1 === f2)) {
          _t1400 = true;
          Types$unify(ty1, ty2);
          return Types$unify_record_row(tail1, tail2);
        }
      }
      if (!_t1400 && _t1399[0]._tag === 0) {
        const _f1 = _t1399[0]._val[0];
        const _ty1 = _t1399[0]._val[1];
        const _tail1 = _t1399[0]._val[2];
        _t1400 = true;
        let _t1402;
        const _t1401 = Types$collect_rrow(r1_1397);
        _t1403: {
          if (true) {
            const ft1 = _t1401[1];
            let _t1405;
            const _t1404 = Types$collect_rrow(r2_1398);
            _t1406: {
              if (true) {
                const ft2 = _t1404[1];
                let _t1408;
                const _t1407 = [ft1, ft2];
                _t1409: {
                  if (_t1407[0]._tag === 1 && _t1407[1]._tag === 1) {
                    const rv1 = _t1407[0]._val;
                    const rv2 = _t1407[1]._val;
                    _t1408 = _eq(rv1, rv2);
                    break _t1409;
                  }
                  if (true) {
                    _t1408 = false;
                    break _t1409;
                  }
                  _match_fail("line 16933");
                }
                const shared_1410 = _t1408;
                let _t1412;
                if (shared_1410) {
                  _t1412 = Types$unify_rrow_shared_tail(r1_1397, r2_1398);
                } else {
                  let _t1414;
                  const _t1413 = r1_1397;
                  _t1415: {
                    if (_t1413._tag === 0) {
                      const f = _t1413._val[0];
                      const t = _t1413._val[1];
                      const tl = _t1413._val[2];
                      _t1414 = [f, t, tl];
                      break _t1415;
                    }
                    if (true) {
                      _t1414 = failwith("assert false");
                      break _t1415;
                    }
                    _match_fail("line 16933");
                  }
                  let _t1417;
                  const _t1416 = _t1414;
                  _t1418: {
                    if (true) {
                      const f1 = _t1416[0];
                      const ty1 = _t1416[1];
                      const tail1 = _t1416[2];
                      let _t1420;
                      const _t1419 = Types$rewrite_record_row(f1, r2_1398);
                      _t1421: {
                        if (true) {
                          const ty2 = _t1419[0];
                          const tail2 = _t1419[1];
                          Types$unify(ty1, ty2);
                          _t1420 = Types$unify_record_row(tail1, tail2);
                          break _t1421;
                        }
                        _match_fail("line 16933");
                      }
                      _t1417 = _t1420;
                      break _t1418;
                    }
                    _match_fail("line 16933");
                  }
                  _t1412 = _t1417;
                }
                const _t1411 = _t1412;
                _t1405 = _t1411;
                break _t1406;
              }
              _match_fail("line 16933");
            }
            _t1402 = _t1405;
            break _t1403;
          }
          _match_fail("line 16933");
        }
        return _t1402;
      }
      if (!_t1400 && _t1399[1]._tag === 0) {
        _t1400 = true;
        return Types$unify_record_row(r2_1398, r1_1397);
      }
      if (!_t1400 && _t1399[0]._tag === 3 && _t1399[1]._tag === 3) {
        const i = _t1399[0]._val;
        const j = _t1399[1]._val;
        if ((i === j)) {
          _t1400 = true;
          return undefined;
        }
      }
      if (!_t1400 && true) {
        _t1400 = true;
        return _h["unify_error"]("cannot unify record types", function(_t1422) {
          return _bounce(function() {
            return _t1422;
          });
        });
      }
      if (!_t1400) _match_fail("line 16933");
    }
  }, Types$unify_record_row);
}
function Types$rewrite_record_row(field, row) {
  return _trampoline(function() {
    const _t1423 = Types$rrow_repr(row);
    let _t1424 = false;
    if (!_t1424 && _t1423._tag === 0) {
      const f = _t1423._val[0];
      const ty = _t1423._val[1];
      const tail = _t1423._val[2];
      if ((f === field)) {
        _t1424 = true;
        return [ty, tail];
      }
    }
    if (!_t1424 && _t1423._tag === 0) {
      const f = _t1423._val[0];
      const ty = _t1423._val[1];
      const tail = _t1423._val[2];
      _t1424 = true;
      let _t1426;
      const _t1425 = Types$rewrite_record_row(field, tail);
      _t1427: {
        if (true) {
          const found = _t1425[0];
          const rest = _t1425[1];
          _t1426 = [found, ({_tag: 0, _name: "RRow", _val: [f, ty, rest]})];
          break _t1427;
        }
        _match_fail("line 16933");
      }
      return _t1426;
    }
    if (!_t1424 && _t1423._tag === 1 && _t1423._val.contents._tag === 0) {
      const id = _t1423._val.contents._val[0];
      const level = _t1423._val.contents._val[1];
      const r = _t1423._val;
      _t1424 = true;
      const new_tail_1428 = Types$new_rvar(level);
      const field_ty_1430 = Types$new_tvar(level);
      const new_row_1432 = ({_tag: 0, _name: "RRow", _val: [field, field_ty_1430, new_tail_1428]});
      Types$occurs_check_rrow(id, level, new_row_1432);
      Ref$set(r, ({_tag: 1, _name: "RLink", _val: new_row_1432}));
      const _t1433 = [field_ty_1430, new_tail_1428];
      const _t1431 = _t1433;
      const _t1429 = _t1431;
      return _t1429;
    }
    if (!_t1424 && _t1423._tag === 4) {
      _t1424 = true;
      const field_ty_1434 = Types$new_tvar(0);
      const _t1435 = [field_ty_1434, ({_tag: 4, _name: "RWild"})];
      return _t1435;
    }
    if (!_t1424 && _t1423._tag === 2) {
      _t1424 = true;
      return _h["unify_error"](("record has no field " + __dict_Show_string.show(field)), function(_t1436) {
        return _bounce(function() {
          return _t1436;
        });
      });
    }
    if (!_t1424 && true) {
      _t1424 = true;
      return _h["unify_error"](("cannot rewrite record row for " + __dict_Show_string.show(field)), function(_t1437) {
        return _bounce(function() {
          return _t1437;
        });
      });
    }
    if (!_t1424) _match_fail("line 16933");
  }, Types$rewrite_record_row);
}
function Types$unify_rrow_shared_tail(r1, r2) {
  let _t1439;
  const _t1438 = Types$collect_rrow(r1);
  _t1440: {
    if (true) {
      const labels1 = _t1438[0];
      const _mml$final = _t1438[1];
      let _t1442;
      const _t1441 = Types$collect_rrow(r2);
      _t1443: {
        if (true) {
          const labels2 = _t1441[0];
          let _t1445;
          const _t1444 = Types$rrow_repr(_mml$final);
          _t1446: {
            if (_t1444._tag === 1 && _t1444._val.contents._tag === 0) {
              const l = _t1444._val.contents._val[1];
              _t1445 = l;
              break _t1446;
            }
            if (true) {
              _t1445 = failwith("assert false");
              break _t1446;
            }
            _match_fail("line 16933");
          }
          const level_1447 = _t1445;
          const fresh_1449 = Types$new_rvar(level_1447);
          const remaining2_1451 = Ref$create(labels2);
          const only1_1453 = Ref$create(null);
          function _t1455(__p45) {
            let _t1457;
            const _t1456 = __p45;
            _t1458: {
              if (true) {
                const f1 = _t1456[0];
                const ty1 = _t1456[1];
                function find_and_remove(__x) {
                  let _t1460;
                  const _t1459 = __x;
                  _t1461: {
                    if (_t1459 === null) {
                      _t1460 = [({_tag: 0, _name: "None"}), null];
                      break _t1461;
                    }
                    if (_t1459 !== null) {
                      const f2 = _t1459._hd[0];
                      const ty2 = _t1459._hd[1];
                      const rest = _t1459._tl;
                      if ((f1 === f2)) {
                        _t1460 = [({_tag: 1, _name: "Some", _val: ty2}), rest];
                        break _t1461;
                      }
                    }
                    if (_t1459 !== null) {
                      const x = _t1459._hd;
                      const rest = _t1459._tl;
                      let _t1463;
                      const _t1462 = find_and_remove(rest);
                      _t1464: {
                        if (true) {
                          const f = _t1462[0];
                          const r = _t1462[1];
                          _t1463 = [f, ({_hd: x, _tl: r})];
                          break _t1464;
                        }
                        _match_fail("line 16933");
                      }
                      _t1460 = _t1463;
                      break _t1461;
                    }
                    _match_fail("line 16933");
                  }
                  return _t1460;
                }
                let _t1467;
                const _t1466 = find_and_remove(Ref$get(remaining2_1451));
                _t1468: {
                  if (true) {
                    const found = _t1466[0];
                    const rest = _t1466[1];
                    Ref$set(remaining2_1451, rest);
                    let _t1470;
                    const _t1469 = found;
                    _t1471: {
                      if (_t1469._tag === 1) {
                        const ty2 = _t1469._val;
                        _t1470 = Types$unify(ty1, ty2);
                        break _t1471;
                      }
                      if (_t1469._tag === 0) {
                        _t1470 = Ref$set(only1_1453, ({_hd: [f1, ty1], _tl: Ref$get(only1_1453)}));
                        break _t1471;
                      }
                      _match_fail("line 16933");
                    }
                    _t1467 = _t1470;
                    break _t1468;
                  }
                  _match_fail("line 16933");
                }
                const _t1465 = _t1467;
                _t1457 = _t1465;
                break _t1458;
              }
              _match_fail("line 16933");
            }
            return _t1457;
          }
          List$iter(_t1455, labels1);
          function _t1472(__p46, acc) {
            let _t1474;
            const _t1473 = __p46;
            _t1475: {
              if (true) {
                const f = _t1473[0];
                const ty = _t1473[1];
                _t1474 = ({_tag: 0, _name: "RRow", _val: [f, ty, acc]});
                break _t1475;
              }
              _match_fail("line 16933");
            }
            return _t1474;
          }
          const new_tail_1476 = List$fold_right(_t1472, List$concat(List$rev(Ref$get(only1_1453)), Ref$get(remaining2_1451)), fresh_1449);
          let _t1479;
          const _t1478 = Types$rrow_repr(_mml$final);
          _t1480: {
            if (_t1478._tag === 1 && _t1478._val.contents._tag === 0) {
              const id = _t1478._val.contents._val[0];
              const r = _t1478._val;
              Types$occurs_check_rrow(id, level_1447, new_tail_1476);
              _t1479 = Ref$set(r, ({_tag: 1, _name: "RLink", _val: new_tail_1476}));
              break _t1480;
            }
            if (true) {
              _t1479 = failwith("assert false");
              break _t1480;
            }
            _match_fail("line 16933");
          }
          const _t1477 = _t1479;
          const _t1454 = _t1477;
          const _t1452 = _t1454;
          const _t1450 = _t1452;
          const _t1448 = _t1450;
          _t1442 = _t1448;
          break _t1443;
        }
        _match_fail("line 16933");
      }
      _t1439 = _t1442;
      break _t1440;
    }
    _match_fail("line 16933");
  }
  return _t1439;
}
function Types$unify(t1, t2) {
  while (true) {
    const t1_1481 = Types$repr(t1);
    const t2_1483 = Types$repr(t2);
    let _t1485;
    if (_eq(t1_1481, t2_1483)) {
      _t1485 = undefined;
    } else {
      let _t1487;
      const _t1486 = [t1_1481, t2_1483];
      _t1488: {
        if ((_t1486[0]._tag === 15 && _t1486[0]._val.contents._tag === 0 || _t1486[1]._tag === 15 && _t1486[1]._val.contents._tag === 0)) {
          const id = (_t1486[0]._tag === 15 && _t1486[0]._val.contents._tag === 0 ? _t1486[0]._val.contents._val[0] : _t1486[1]._val.contents._val[0]);
          const level = (_t1486[0]._tag === 15 && _t1486[0]._val.contents._tag === 0 ? _t1486[0]._val.contents._val[1] : _t1486[1]._val.contents._val[1]);
          const r = (_t1486[0]._tag === 15 && _t1486[0]._val.contents._tag === 0 ? _t1486[0]._val : _t1486[1]._val);
          const ty = (_t1486[0]._tag === 15 && _t1486[0]._val.contents._tag === 0 ? _t1486[1] : _t1486[0]);
          Types$occurs_check(id, level, ty);
          _t1487 = Ref$set(r, ({_tag: 1, _name: "Link", _val: ty}));
          break _t1488;
        }
        if ((_t1486[0]._tag === 7 && _t1486[1]._tag === 7 || _t1486[0]._tag === 8 && _t1486[1]._tag === 8)) {
          const a1 = _t1486[0]._val[0];
          const e1 = _t1486[0]._val[1];
          const r1 = _t1486[0]._val[2];
          const a2 = _t1486[1]._val[0];
          const e2 = _t1486[1]._val[1];
          const r2 = _t1486[1]._val[2];
          Types$unify(a1, a2);
          Types$unify_eff(e1, e2);
          const _t1489 = r1;
          const _t1490 = r2;
          t1 = _t1489;
          t2 = _t1490;
          continue;
          _t1487 = undefined;
          break _t1488;
        }
        if (_t1486[0]._tag === 9 && _t1486[1]._tag === 9) {
          const ts1 = _t1486[0]._val;
          const ts2 = _t1486[1]._val;
          let _t1491;
          if ((List$length(ts1) !== List$length(ts2))) {
            _t1491 = Types$unify_error(t1_1481, t2_1483);
          } else {
            _t1491 = undefined;
          }
          _t1491;
          _t1487 = List$iter2(Types$unify, ts1, ts2);
          break _t1488;
        }
        if (_t1486[0]._tag === 10 && _t1486[1]._tag === 10) {
          const t1$p = _t1486[0]._val;
          const t2$p = _t1486[1]._val;
          const _t1492 = t1$p;
          const _t1493 = t2$p;
          t1 = _t1492;
          t2 = _t1493;
          continue;
          _t1487 = undefined;
          break _t1488;
        }
        if (_t1486[0]._tag === 13 && _t1486[1]._tag === 13) {
          const t1$p = _t1486[0]._val;
          const t2$p = _t1486[1]._val;
          const _t1494 = t1$p;
          const _t1495 = t2$p;
          t1 = _t1494;
          t2 = _t1495;
          continue;
          _t1487 = undefined;
          break _t1488;
        }
        if (_t1486[0]._tag === 11 && _t1486[1]._tag === 11) {
          const r1 = _t1486[0]._val;
          const r2 = _t1486[1]._val;
          _t1487 = Types$unify_record_row(r1, r2);
          break _t1488;
        }
        if (((((((_t1486[0]._tag === 0 && _t1486[1]._tag === 0 || _t1486[0]._tag === 1 && _t1486[1]._tag === 1) || _t1486[0]._tag === 2 && _t1486[1]._tag === 2) || _t1486[0]._tag === 3 && _t1486[1]._tag === 3) || _t1486[0]._tag === 4 && _t1486[1]._tag === 4) || _t1486[0]._tag === 5 && _t1486[1]._tag === 5) || _t1486[0]._tag === 6 && _t1486[1]._tag === 6)) {
          _t1487 = undefined;
          break _t1488;
        }
        if (_t1486[0]._tag === 12 && _t1486[1]._tag === 12) {
          const a = _t1486[0]._val[0];
          const args_a = _t1486[0]._val[1];
          const b = _t1486[1]._val[0];
          const args_b = _t1486[1]._val[1];
          if ((a === b)) {
            let _t1496;
            if ((List$length(args_a) !== List$length(args_b))) {
              _t1496 = Types$unify_error(t1_1481, t2_1483);
            } else {
              _t1496 = undefined;
            }
            _t1496;
            _t1487 = List$iter2(Types$unify, args_a, args_b);
            break _t1488;
          }
        }
        if (_t1486[0]._tag === 14 && _t1486[1]._tag === 14) {
          const r1 = _t1486[0]._val;
          const r2 = _t1486[1]._val;
          _t1487 = Types$unify_pv_row(r1, r2);
          break _t1488;
        }
        if (true) {
          _t1487 = Types$unify_error(t1_1481, t2_1483);
          break _t1488;
        }
        _match_fail("line 16933");
      }
      _t1485 = _t1487;
    }
    const _t1484 = _t1485;
    const _t1482 = _t1484;
    return _t1482;
  }
}
function Types$generalize(level, ty) {
  let _t1498;
  const _t1497 = Hashtbl$create(8);
  _t1499: {
    if (true) {
      const id_map = _t1497;
      const counter_1500 = Ref$create(0);
      let _t1503;
      const _t1502 = Hashtbl$create(4);
      _t1504: {
        if (true) {
          const eff_id_map = _t1502;
          const ecounter_1505 = Ref$create(0);
          let _t1508;
          const _t1507 = Hashtbl$create(4);
          _t1509: {
            if (true) {
              const pv_id_map = _t1507;
              const pvcounter_1510 = Ref$create(0);
              let _t1513;
              const _t1512 = Hashtbl$create(4);
              _t1514: {
                if (true) {
                  const r_id_map = _t1512;
                  const rcounter_1515 = Ref$create(0);
                  function go(ty) {
                    let _t1518;
                    const _t1517 = Types$repr(ty);
                    _t1519: {
                      if (_t1517._tag === 15 && _t1517._val.contents._tag === 0) {
                        const id = _t1517._val.contents._val[0];
                        const level$p = _t1517._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1521;
                          const _t1520 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, id]);
                          _t1522: {
                            if (_t1520._tag === 1) {
                              const gen_id = _t1520._val;
                              _t1521 = ({_tag: 16, _name: "TGen", _val: gen_id});
                              break _t1522;
                            }
                            if (_t1520._tag === 0) {
                              const gen_id_1523 = Ref$get(counter_1500);
                              Ref$set(counter_1500, (gen_id_1523 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, id_map, id, gen_id_1523]);
                              const _t1524 = ({_tag: 16, _name: "TGen", _val: gen_id_1523});
                              _t1521 = _t1524;
                              break _t1522;
                            }
                            _match_fail("line 16933");
                          }
                          _t1518 = _t1521;
                          break _t1519;
                        }
                      }
                      if (_t1517._tag === 15 && _t1517._val.contents._tag === 0) {
                        const t = _t1517;
                        _t1518 = t;
                        break _t1519;
                      }
                      if (_t1517._tag === 15 && _t1517._val.contents._tag === 1) {
                        _t1518 = failwith("assert false");
                        break _t1519;
                      }
                      if (_t1517._tag === 7) {
                        const a = _t1517._val[0];
                        const eff = _t1517._val[1];
                        const r = _t1517._val[2];
                        _t1518 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1519;
                      }
                      if (_t1517._tag === 8) {
                        const a = _t1517._val[0];
                        const eff = _t1517._val[1];
                        const r = _t1517._val[2];
                        _t1518 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1519;
                      }
                      if (_t1517._tag === 9) {
                        const ts = _t1517._val;
                        _t1518 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
                        break _t1519;
                      }
                      if (_t1517._tag === 10) {
                        const t = _t1517._val;
                        _t1518 = ({_tag: 10, _name: "TList", _val: go(t)});
                        break _t1519;
                      }
                      if (_t1517._tag === 13) {
                        const t = _t1517._val;
                        _t1518 = ({_tag: 13, _name: "TArray", _val: go(t)});
                        break _t1519;
                      }
                      if (_t1517._tag === 11) {
                        const row = _t1517._val;
                        _t1518 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
                        break _t1519;
                      }
                      if (_t1517._tag === 12) {
                        const name = _t1517._val[0];
                        const args = _t1517._val[1];
                        _t1518 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
                        break _t1519;
                      }
                      if (_t1517._tag === 14) {
                        const row = _t1517._val;
                        _t1518 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
                        break _t1519;
                      }
                      if (true) {
                        const t = _t1517;
                        _t1518 = t;
                        break _t1519;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1518;
                  }
                  function go_eff(eff) {
                    let _t1526;
                    const _t1525 = Types$eff_repr(eff);
                    _t1527: {
                      if (_t1525._tag === 0 && _t1525._val.contents._tag === 0) {
                        const id = _t1525._val.contents._val[0];
                        const level$p = _t1525._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1529;
                          const _t1528 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id]);
                          _t1530: {
                            if (_t1528._tag === 1) {
                              const gen_id = _t1528._val;
                              _t1529 = ({_tag: 3, _name: "EffGen", _val: gen_id});
                              break _t1530;
                            }
                            if (_t1528._tag === 0) {
                              const gen_id_1531 = Ref$get(ecounter_1505);
                              Ref$set(ecounter_1505, (gen_id_1531 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id, gen_id_1531]);
                              const _t1532 = ({_tag: 3, _name: "EffGen", _val: gen_id_1531});
                              _t1529 = _t1532;
                              break _t1530;
                            }
                            _match_fail("line 16933");
                          }
                          _t1526 = _t1529;
                          break _t1527;
                        }
                      }
                      if (_t1525._tag === 0 && _t1525._val.contents._tag === 0) {
                        const e = _t1525;
                        _t1526 = e;
                        break _t1527;
                      }
                      if (_t1525._tag === 0 && _t1525._val.contents._tag === 1) {
                        _t1526 = failwith("assert false");
                        break _t1527;
                      }
                      if (_t1525._tag === 2) {
                        const label = _t1525._val[0];
                        const params = _t1525._val[1];
                        const tail = _t1525._val[2];
                        _t1526 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
                        break _t1527;
                      }
                      if (_t1525._tag === 1) {
                        _t1526 = ({_tag: 1, _name: "EffEmpty"});
                        break _t1527;
                      }
                      if (_t1525._tag === 3) {
                        const e = _t1525;
                        _t1526 = e;
                        break _t1527;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1526;
                  }
                  function go_pv(row) {
                    let _t1534;
                    const _t1533 = Types$pv_repr(row);
                    _t1535: {
                      if (_t1533._tag === 1 && _t1533._val.contents._tag === 0) {
                        const id = _t1533._val.contents._val[0];
                        const level$p = _t1533._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1537;
                          const _t1536 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id]);
                          _t1538: {
                            if (_t1536._tag === 1) {
                              const gen_id = _t1536._val;
                              _t1537 = ({_tag: 3, _name: "PVGen", _val: gen_id});
                              break _t1538;
                            }
                            if (_t1536._tag === 0) {
                              const gen_id_1539 = Ref$get(pvcounter_1510);
                              Ref$set(pvcounter_1510, (gen_id_1539 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id, gen_id_1539]);
                              const _t1540 = ({_tag: 3, _name: "PVGen", _val: gen_id_1539});
                              _t1537 = _t1540;
                              break _t1538;
                            }
                            _match_fail("line 16933");
                          }
                          _t1534 = _t1537;
                          break _t1535;
                        }
                      }
                      if (_t1533._tag === 1 && _t1533._val.contents._tag === 0) {
                        const r = _t1533;
                        _t1534 = r;
                        break _t1535;
                      }
                      if (_t1533._tag === 1 && _t1533._val.contents._tag === 1) {
                        _t1534 = failwith("assert false");
                        break _t1535;
                      }
                      if (_t1533._tag === 0) {
                        const tag = _t1533._val[0];
                        const ty_opt = _t1533._val[1];
                        const tail = _t1533._val[2];
                        _t1534 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
                        break _t1535;
                      }
                      if (_t1533._tag === 2) {
                        _t1534 = ({_tag: 2, _name: "PVEmpty"});
                        break _t1535;
                      }
                      if (_t1533._tag === 3) {
                        const r = _t1533;
                        _t1534 = r;
                        break _t1535;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1534;
                  }
                  function go_rrow(row) {
                    let _t1542;
                    const _t1541 = Types$rrow_repr(row);
                    _t1543: {
                      if (_t1541._tag === 1 && _t1541._val.contents._tag === 0) {
                        const id = _t1541._val.contents._val[0];
                        const level$p = _t1541._val.contents._val[1];
                        if ((level$p > level)) {
                          let _t1545;
                          const _t1544 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, r_id_map, id]);
                          _t1546: {
                            if (_t1544._tag === 1) {
                              const gen_id = _t1544._val;
                              _t1545 = ({_tag: 3, _name: "RGen", _val: gen_id});
                              break _t1546;
                            }
                            if (_t1544._tag === 0) {
                              const gen_id_1547 = Ref$get(rcounter_1515);
                              Ref$set(rcounter_1515, (gen_id_1547 + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, r_id_map, id, gen_id_1547]);
                              const _t1548 = ({_tag: 3, _name: "RGen", _val: gen_id_1547});
                              _t1545 = _t1548;
                              break _t1546;
                            }
                            _match_fail("line 16933");
                          }
                          _t1542 = _t1545;
                          break _t1543;
                        }
                      }
                      if (_t1541._tag === 1 && _t1541._val.contents._tag === 0) {
                        const r = _t1541;
                        _t1542 = r;
                        break _t1543;
                      }
                      if (_t1541._tag === 1 && _t1541._val.contents._tag === 1) {
                        _t1542 = failwith("assert false");
                        break _t1543;
                      }
                      if (_t1541._tag === 0) {
                        const name = _t1541._val[0];
                        const ty = _t1541._val[1];
                        const tail = _t1541._val[2];
                        _t1542 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
                        break _t1543;
                      }
                      if (_t1541._tag === 2) {
                        _t1542 = ({_tag: 2, _name: "REmpty"});
                        break _t1543;
                      }
                      if (_t1541._tag === 3) {
                        const r = _t1541;
                        _t1542 = r;
                        break _t1543;
                      }
                      if (_t1541._tag === 4) {
                        _t1542 = ({_tag: 4, _name: "RWild"});
                        break _t1543;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1542;
                  }
                  const body_1550 = go(ty);
                  const _t1551 = ({body: body_1550, constraints: null, equant: Ref$get(ecounter_1505), pvquant: Ref$get(pvcounter_1510), quant: Ref$get(counter_1500), record_evidences: null, rquant: Ref$get(rcounter_1515)});
                  const _t1549 = _t1551;
                  const _t1516 = _t1549;
                  _t1513 = _t1516;
                  break _t1514;
                }
                _match_fail("line 16933");
              }
              const _t1511 = _t1513;
              _t1508 = _t1511;
              break _t1509;
            }
            _match_fail("line 16933");
          }
          const _t1506 = _t1508;
          _t1503 = _t1506;
          break _t1504;
        }
        _match_fail("line 16933");
      }
      const _t1501 = _t1503;
      _t1498 = _t1501;
      break _t1499;
    }
    _match_fail("line 16933");
  }
  return _t1498;
}
function Types$generalize_with_map(level, ty) {
  const counter_1552 = Ref$create(0);
  let _t1555;
  const _t1554 = Hashtbl$create(8);
  _t1556: {
    if (true) {
      const id_map = _t1554;
      const ecounter_1557 = Ref$create(0);
      let _t1560;
      const _t1559 = Hashtbl$create(4);
      _t1561: {
        if (true) {
          const eff_id_map = _t1559;
          const pvcounter_1562 = Ref$create(0);
          let _t1565;
          const _t1564 = Hashtbl$create(4);
          _t1566: {
            if (true) {
              const pv_id_map = _t1564;
              const rcounter_1567 = Ref$create(0);
              let _t1570;
              const _t1569 = Hashtbl$create(4);
              _t1571: {
                if (true) {
                  const r_id_map = _t1569;
                  function go(ty) {
                    let _t1573;
                    const _t1572 = Types$repr(ty);
                    _t1574: {
                      if (_t1572._tag === 15 && _t1572._val.contents._tag === 0) {
                        const id = _t1572._val.contents._val[0];
                        const l = _t1572._val.contents._val[1];
                        if ((l > level)) {
                          let _t1576;
                          const _t1575 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, id]);
                          _t1577: {
                            if (_t1575._tag === 1) {
                              const gen = _t1575._val;
                              _t1576 = gen;
                              break _t1577;
                            }
                            if (_t1575._tag === 0) {
                              const gen_1578 = ({_tag: 16, _name: "TGen", _val: Ref$get(counter_1552)});
                              Ref$set(counter_1552, (Ref$get(counter_1552) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, id_map, id, gen_1578]);
                              const _t1579 = gen_1578;
                              _t1576 = _t1579;
                              break _t1577;
                            }
                            _match_fail("line 16933");
                          }
                          _t1573 = _t1576;
                          break _t1574;
                        }
                      }
                      if ((_t1572._tag === 15 && _t1572._val.contents._tag === 0 || _t1572._tag === 15 && _t1572._val.contents._tag === 1)) {
                        _t1573 = ty;
                        break _t1574;
                      }
                      if (_t1572._tag === 7) {
                        const a = _t1572._val[0];
                        const eff = _t1572._val[1];
                        const r = _t1572._val[2];
                        _t1573 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1574;
                      }
                      if (_t1572._tag === 8) {
                        const a = _t1572._val[0];
                        const eff = _t1572._val[1];
                        const r = _t1572._val[2];
                        _t1573 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
                        break _t1574;
                      }
                      if (_t1572._tag === 9) {
                        const ts = _t1572._val;
                        _t1573 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
                        break _t1574;
                      }
                      if (_t1572._tag === 10) {
                        const t = _t1572._val;
                        _t1573 = ({_tag: 10, _name: "TList", _val: go(t)});
                        break _t1574;
                      }
                      if (_t1572._tag === 13) {
                        const t = _t1572._val;
                        _t1573 = ({_tag: 13, _name: "TArray", _val: go(t)});
                        break _t1574;
                      }
                      if (_t1572._tag === 11) {
                        const row = _t1572._val;
                        _t1573 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
                        break _t1574;
                      }
                      if (_t1572._tag === 12) {
                        const name = _t1572._val[0];
                        const args = _t1572._val[1];
                        _t1573 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
                        break _t1574;
                      }
                      if (_t1572._tag === 14) {
                        const row = _t1572._val;
                        _t1573 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
                        break _t1574;
                      }
                      if (true) {
                        const t = _t1572;
                        _t1573 = t;
                        break _t1574;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1573;
                  }
                  function go_eff(eff) {
                    let _t1581;
                    const _t1580 = Types$eff_repr(eff);
                    _t1582: {
                      if (_t1580._tag === 0 && _t1580._val.contents._tag === 0) {
                        const id = _t1580._val.contents._val[0];
                        const l = _t1580._val.contents._val[1];
                        if ((l > level)) {
                          let _t1584;
                          const _t1583 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id]);
                          _t1585: {
                            if (_t1583._tag === 1) {
                              const gen = _t1583._val;
                              _t1584 = gen;
                              break _t1585;
                            }
                            if (_t1583._tag === 0) {
                              const gen_1586 = ({_tag: 3, _name: "EffGen", _val: Ref$get(ecounter_1557)});
                              Ref$set(ecounter_1557, (Ref$get(ecounter_1557) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, eff_id_map, id, gen_1586]);
                              const _t1587 = gen_1586;
                              _t1584 = _t1587;
                              break _t1585;
                            }
                            _match_fail("line 16933");
                          }
                          _t1581 = _t1584;
                          break _t1582;
                        }
                      }
                      if ((_t1580._tag === 0 && _t1580._val.contents._tag === 0 || _t1580._tag === 0 && _t1580._val.contents._tag === 1)) {
                        _t1581 = eff;
                        break _t1582;
                      }
                      if (_t1580._tag === 2) {
                        const label = _t1580._val[0];
                        const params = _t1580._val[1];
                        const tail = _t1580._val[2];
                        _t1581 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
                        break _t1582;
                      }
                      if (_t1580._tag === 1) {
                        _t1581 = ({_tag: 1, _name: "EffEmpty"});
                        break _t1582;
                      }
                      if (_t1580._tag === 3) {
                        const e = _t1580;
                        _t1581 = e;
                        break _t1582;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1581;
                  }
                  function go_pv(row) {
                    let _t1589;
                    const _t1588 = Types$pv_repr(row);
                    _t1590: {
                      if (_t1588._tag === 1 && _t1588._val.contents._tag === 0) {
                        const id = _t1588._val.contents._val[0];
                        const l = _t1588._val.contents._val[1];
                        if ((l > level)) {
                          let _t1592;
                          const _t1591 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id]);
                          _t1593: {
                            if (_t1591._tag === 1) {
                              const gen = _t1591._val;
                              _t1592 = gen;
                              break _t1593;
                            }
                            if (_t1591._tag === 0) {
                              const gen_1594 = ({_tag: 3, _name: "PVGen", _val: Ref$get(pvcounter_1562)});
                              Ref$set(pvcounter_1562, (Ref$get(pvcounter_1562) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, pv_id_map, id, gen_1594]);
                              const _t1595 = gen_1594;
                              _t1592 = _t1595;
                              break _t1593;
                            }
                            _match_fail("line 16933");
                          }
                          _t1589 = _t1592;
                          break _t1590;
                        }
                      }
                      if ((_t1588._tag === 1 && _t1588._val.contents._tag === 0 || _t1588._tag === 1 && _t1588._val.contents._tag === 1)) {
                        _t1589 = row;
                        break _t1590;
                      }
                      if (_t1588._tag === 0) {
                        const tag = _t1588._val[0];
                        const ty_opt = _t1588._val[1];
                        const tail = _t1588._val[2];
                        _t1589 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
                        break _t1590;
                      }
                      if (_t1588._tag === 2) {
                        _t1589 = ({_tag: 2, _name: "PVEmpty"});
                        break _t1590;
                      }
                      if (_t1588._tag === 3) {
                        const r = _t1588;
                        _t1589 = r;
                        break _t1590;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1589;
                  }
                  function go_rrow(row) {
                    let _t1597;
                    const _t1596 = Types$rrow_repr(row);
                    _t1598: {
                      if (_t1596._tag === 1 && _t1596._val.contents._tag === 0) {
                        const id = _t1596._val.contents._val[0];
                        const l = _t1596._val.contents._val[1];
                        if ((l > level)) {
                          let _t1600;
                          const _t1599 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, r_id_map, id]);
                          _t1601: {
                            if (_t1599._tag === 1) {
                              const gen = _t1599._val;
                              _t1600 = gen;
                              break _t1601;
                            }
                            if (_t1599._tag === 0) {
                              const gen_1602 = ({_tag: 3, _name: "RGen", _val: Ref$get(rcounter_1567)});
                              Ref$set(rcounter_1567, (Ref$get(rcounter_1567) + 1));
                              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, r_id_map, id, gen_1602]);
                              const _t1603 = gen_1602;
                              _t1600 = _t1603;
                              break _t1601;
                            }
                            _match_fail("line 16933");
                          }
                          _t1597 = _t1600;
                          break _t1598;
                        }
                      }
                      if ((_t1596._tag === 1 && _t1596._val.contents._tag === 0 || _t1596._tag === 1 && _t1596._val.contents._tag === 1)) {
                        _t1597 = row;
                        break _t1598;
                      }
                      if (_t1596._tag === 0) {
                        const name = _t1596._val[0];
                        const ty = _t1596._val[1];
                        const tail = _t1596._val[2];
                        _t1597 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
                        break _t1598;
                      }
                      if (_t1596._tag === 2) {
                        _t1597 = ({_tag: 2, _name: "REmpty"});
                        break _t1598;
                      }
                      if (_t1596._tag === 3) {
                        const r = _t1596;
                        _t1597 = r;
                        break _t1598;
                      }
                      if (_t1596._tag === 4) {
                        _t1597 = ({_tag: 4, _name: "RWild"});
                        break _t1598;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1597;
                  }
                  const body_1605 = go(ty);
                  const _t1606 = [({body: body_1605, constraints: null, equant: Ref$get(ecounter_1557), pvquant: Ref$get(pvcounter_1562), quant: Ref$get(counter_1552), record_evidences: null, rquant: Ref$get(rcounter_1567)}), id_map];
                  const _t1604 = _t1606;
                  _t1570 = _t1604;
                  break _t1571;
                }
                _match_fail("line 16933");
              }
              const _t1568 = _t1570;
              _t1565 = _t1568;
              break _t1566;
            }
            _match_fail("line 16933");
          }
          const _t1563 = _t1565;
          _t1560 = _t1563;
          break _t1561;
        }
        _match_fail("line 16933");
      }
      const _t1558 = _t1560;
      _t1555 = _t1558;
      break _t1556;
    }
    _match_fail("line 16933");
  }
  const _t1553 = _t1555;
  return _t1553;
}
function Types$instantiate_with_mapping(level, s) {
  let _t1607;
  if (((s.quant === 0) && ((s.equant === 0) && ((s.pvquant === 0) && (s.rquant === 0))))) {
    _t1607 = [s.body, null];
  } else {
    function _t1608(_) {
      return Types$new_tvar(level);
    }
    const vars_1609 = Array$init(s.quant, _t1608);
    function _t1611(_) {
      return Types$new_effvar(level);
    }
    const evars_1612 = Array$init(s.equant, _t1611);
    function _t1614(_) {
      return Types$new_pvvar(level);
    }
    const pvvars_1615 = Array$init(s.pvquant, _t1614);
    function _t1617(_) {
      return Types$new_rvar(level);
    }
    const rvars_1618 = Array$init(s.rquant, _t1617);
    function _t1620(_) {
      return Types$new_effvar(level);
    }
    const shared_eff_1621 = _t1620;
    function _t1623(i) {
      return [i, Array$get(vars_1609, i)];
    }
    const mapping_1624 = List$init(s.quant, _t1623);
    function go(__x) {
      let _t1627;
      const _t1626 = __x;
      _t1628: {
        if (_t1626._tag === 16) {
          const id = _t1626._val;
          if ((id < s.quant)) {
            _t1627 = Array$get(vars_1609, id);
            break _t1628;
          }
        }
        if (_t1626._tag === 7) {
          const a = _t1626._val[0];
          const eff = _t1626._val[1];
          const r = _t1626._val[2];
          _t1627 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
          break _t1628;
        }
        if (_t1626._tag === 8) {
          const a = _t1626._val[0];
          const eff = _t1626._val[1];
          const r = _t1626._val[2];
          _t1627 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
          break _t1628;
        }
        if (_t1626._tag === 9) {
          const ts = _t1626._val;
          _t1627 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t1628;
        }
        if (_t1626._tag === 10) {
          const t = _t1626._val;
          _t1627 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t1628;
        }
        if (_t1626._tag === 13) {
          const t = _t1626._val;
          _t1627 = ({_tag: 13, _name: "TArray", _val: go(t)});
          break _t1628;
        }
        if (_t1626._tag === 11) {
          const row = _t1626._val;
          _t1627 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
          break _t1628;
        }
        if (_t1626._tag === 12) {
          const name = _t1626._val[0];
          const args = _t1626._val[1];
          _t1627 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
          break _t1628;
        }
        if (_t1626._tag === 14) {
          const row = _t1626._val;
          _t1627 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
          break _t1628;
        }
        if (true) {
          const t = _t1626;
          _t1627 = t;
          break _t1628;
        }
        _match_fail("line 16933");
      }
      return _t1627;
    }
    function go_eff(__x) {
      let _t1630;
      const _t1629 = __x;
      _t1631: {
        if (_t1629._tag === 3) {
          const id = _t1629._val;
          if ((id < s.equant)) {
            _t1630 = Array$get(evars_1612, id);
            break _t1631;
          }
        }
        if (_t1629._tag === 2) {
          const label = _t1629._val[0];
          const params = _t1629._val[1];
          const tail = _t1629._val[2];
          _t1630 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
          break _t1631;
        }
        if (_t1629._tag === 1) {
          _t1630 = shared_eff_1621(undefined);
          break _t1631;
        }
        if (true) {
          const e = _t1629;
          _t1630 = e;
          break _t1631;
        }
        _match_fail("line 16933");
      }
      return _t1630;
    }
    function go_pv(__x) {
      let _t1633;
      const _t1632 = __x;
      _t1634: {
        if (_t1632._tag === 3) {
          const id = _t1632._val;
          if ((id < s.pvquant)) {
            _t1633 = Array$get(pvvars_1615, id);
            break _t1634;
          }
        }
        if (_t1632._tag === 0) {
          const tag = _t1632._val[0];
          const ty_opt = _t1632._val[1];
          const tail = _t1632._val[2];
          _t1633 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
          break _t1634;
        }
        if (true) {
          const r = _t1632;
          _t1633 = r;
          break _t1634;
        }
        _match_fail("line 16933");
      }
      return _t1633;
    }
    function go_rrow(__x) {
      let _t1636;
      const _t1635 = __x;
      _t1637: {
        if (_t1635._tag === 3) {
          const id = _t1635._val;
          if ((id < s.rquant)) {
            _t1636 = Array$get(rvars_1618, id);
            break _t1637;
          }
        }
        if (_t1635._tag === 0) {
          const name = _t1635._val[0];
          const ty = _t1635._val[1];
          const tail = _t1635._val[2];
          _t1636 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
          break _t1637;
        }
        if (true) {
          const r = _t1635;
          _t1636 = r;
          break _t1637;
        }
        _match_fail("line 16933");
      }
      return _t1636;
    }
    const _t1638 = [go(s.body), mapping_1624];
    const _t1625 = _t1638;
    const _t1622 = _t1625;
    const _t1619 = _t1622;
    const _t1616 = _t1619;
    const _t1613 = _t1616;
    const _t1610 = _t1613;
    _t1607 = _t1610;
  }
  return _t1607;
}
function Types$instantiate(level, s) {
  let _t1639;
  if (((s.quant === 0) && ((s.equant === 0) && ((s.pvquant === 0) && (s.rquant === 0))))) {
    _t1639 = s.body;
  } else {
    function _t1640(_) {
      return Types$new_tvar(level);
    }
    const vars_1641 = Array$init(s.quant, _t1640);
    function _t1643(_) {
      return Types$new_effvar(level);
    }
    const evars_1644 = Array$init(s.equant, _t1643);
    function _t1646(_) {
      return Types$new_pvvar(level);
    }
    const pvvars_1647 = Array$init(s.pvquant, _t1646);
    function _t1649(_) {
      return Types$new_rvar(level);
    }
    const rvars_1650 = Array$init(s.rquant, _t1649);
    function _t1652(_) {
      return Types$new_effvar(level);
    }
    const shared_eff_1653 = _t1652;
    function go(__x) {
      while (true) {
        let _t1656;
        const _t1655 = __x;
        _t1657: {
          if (_t1655._tag === 16) {
            const id = _t1655._val;
            if ((id < s.quant)) {
              _t1656 = Array$get(vars_1641, id);
              break _t1657;
            }
          }
          if (_t1655._tag === 7) {
            const a = _t1655._val[0];
            const eff = _t1655._val[1];
            const r = _t1655._val[2];
            _t1656 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
            break _t1657;
          }
          if (_t1655._tag === 8) {
            const a = _t1655._val[0];
            const eff = _t1655._val[1];
            const r = _t1655._val[2];
            _t1656 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
            break _t1657;
          }
          if (_t1655._tag === 9) {
            const ts = _t1655._val;
            _t1656 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
            break _t1657;
          }
          if (_t1655._tag === 10) {
            const t = _t1655._val;
            _t1656 = ({_tag: 10, _name: "TList", _val: go(t)});
            break _t1657;
          }
          if (_t1655._tag === 13) {
            const t = _t1655._val;
            _t1656 = ({_tag: 13, _name: "TArray", _val: go(t)});
            break _t1657;
          }
          if (_t1655._tag === 11) {
            const row = _t1655._val;
            _t1656 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
            break _t1657;
          }
          if (_t1655._tag === 12) {
            const name = _t1655._val[0];
            const args = _t1655._val[1];
            _t1656 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
            break _t1657;
          }
          if (_t1655._tag === 14) {
            const row = _t1655._val;
            _t1656 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
            break _t1657;
          }
          if (_t1655._tag === 15 && _t1655._val.contents._tag === 1) {
            const ty = _t1655._val.contents._val;
            const _t1658 = ty;
            __x = _t1658;
            continue;
            _t1656 = undefined;
            break _t1657;
          }
          if (true) {
            const t = _t1655;
            _t1656 = t;
            break _t1657;
          }
          _match_fail("line 16933");
        }
        return _t1656;
      }
    }
    function go_eff(__x) {
      let _t1660;
      const _t1659 = __x;
      _t1661: {
        if (_t1659._tag === 3) {
          const id = _t1659._val;
          if ((id < s.equant)) {
            _t1660 = Array$get(evars_1644, id);
            break _t1661;
          }
        }
        if (_t1659._tag === 2) {
          const label = _t1659._val[0];
          const params = _t1659._val[1];
          const tail = _t1659._val[2];
          _t1660 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
          break _t1661;
        }
        if (_t1659._tag === 1) {
          _t1660 = shared_eff_1653(undefined);
          break _t1661;
        }
        if (true) {
          const e = _t1659;
          _t1660 = e;
          break _t1661;
        }
        _match_fail("line 16933");
      }
      return _t1660;
    }
    function go_pv(__x) {
      let _t1663;
      const _t1662 = __x;
      _t1664: {
        if (_t1662._tag === 3) {
          const id = _t1662._val;
          if ((id < s.pvquant)) {
            _t1663 = Array$get(pvvars_1647, id);
            break _t1664;
          }
        }
        if (_t1662._tag === 0) {
          const tag = _t1662._val[0];
          const ty_opt = _t1662._val[1];
          const tail = _t1662._val[2];
          _t1663 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
          break _t1664;
        }
        if (true) {
          const r = _t1662;
          _t1663 = r;
          break _t1664;
        }
        _match_fail("line 16933");
      }
      return _t1663;
    }
    function go_rrow(__x) {
      let _t1666;
      const _t1665 = __x;
      _t1667: {
        if (_t1665._tag === 3) {
          const id = _t1665._val;
          if ((id < s.rquant)) {
            _t1666 = Array$get(rvars_1650, id);
            break _t1667;
          }
        }
        if (_t1665._tag === 0) {
          const name = _t1665._val[0];
          const ty = _t1665._val[1];
          const tail = _t1665._val[2];
          _t1666 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
          break _t1667;
        }
        if (true) {
          const r = _t1665;
          _t1666 = r;
          break _t1667;
        }
        _match_fail("line 16933");
      }
      return _t1666;
    }
    const _t1668 = go(s.body);
    const _t1654 = _t1668;
    const _t1651 = _t1654;
    const _t1648 = _t1651;
    const _t1645 = _t1648;
    const _t1642 = _t1645;
    _t1639 = _t1642;
  }
  return _t1639;
}
function Types$deep_repr(ty) {
  let _t1670;
  const _t1669 = Types$repr(ty);
  _t1671: {
    if (_t1669._tag === 7) {
      const a = _t1669._val[0];
      const eff = _t1669._val[1];
      const b = _t1669._val[2];
      _t1670 = ({_tag: 7, _name: "TArrow", _val: [Types$deep_repr(a), Types$deep_repr_eff(eff), Types$deep_repr(b)]});
      break _t1671;
    }
    if (_t1669._tag === 8) {
      const a = _t1669._val[0];
      const eff = _t1669._val[1];
      const b = _t1669._val[2];
      _t1670 = ({_tag: 8, _name: "TCont", _val: [Types$deep_repr(a), Types$deep_repr_eff(eff), Types$deep_repr(b)]});
      break _t1671;
    }
    if (_t1669._tag === 9) {
      const ts = _t1669._val;
      _t1670 = ({_tag: 9, _name: "TTuple", _val: List$map(Types$deep_repr, ts)});
      break _t1671;
    }
    if (_t1669._tag === 10) {
      const t = _t1669._val;
      _t1670 = ({_tag: 10, _name: "TList", _val: Types$deep_repr(t)});
      break _t1671;
    }
    if (_t1669._tag === 13) {
      const t = _t1669._val;
      _t1670 = ({_tag: 13, _name: "TArray", _val: Types$deep_repr(t)});
      break _t1671;
    }
    if (_t1669._tag === 11) {
      const row = _t1669._val;
      _t1670 = ({_tag: 11, _name: "TRecord", _val: Types$deep_repr_rrow(row)});
      break _t1671;
    }
    if (_t1669._tag === 12) {
      const name = _t1669._val[0];
      const args = _t1669._val[1];
      _t1670 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(Types$deep_repr, args)]});
      break _t1671;
    }
    if (_t1669._tag === 14) {
      const row = _t1669._val;
      _t1670 = ({_tag: 14, _name: "TPolyVariant", _val: Types$deep_repr_pv(row)});
      break _t1671;
    }
    if (true) {
      const t = _t1669;
      _t1670 = t;
      break _t1671;
    }
    _match_fail("line 16933");
  }
  return _t1670;
}
function Types$deep_repr_eff(eff) {
  let _t1673;
  const _t1672 = Types$eff_repr(eff);
  _t1674: {
    if (_t1672._tag === 2) {
      const label = _t1672._val[0];
      const params = _t1672._val[1];
      const tail = _t1672._val[2];
      _t1673 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(Types$deep_repr, params), Types$deep_repr_eff(tail)]});
      break _t1674;
    }
    if (true) {
      const e = _t1672;
      _t1673 = e;
      break _t1674;
    }
    _match_fail("line 16933");
  }
  return _t1673;
}
function Types$deep_repr_pv(row) {
  let _t1676;
  const _t1675 = Types$pv_repr(row);
  _t1677: {
    if (_t1675._tag === 0) {
      const tag = _t1675._val[0];
      const ty_opt = _t1675._val[1];
      const tail = _t1675._val[2];
      _t1676 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(Types$deep_repr, ty_opt), Types$deep_repr_pv(tail)]});
      break _t1677;
    }
    if (true) {
      const r = _t1675;
      _t1676 = r;
      break _t1677;
    }
    _match_fail("line 16933");
  }
  return _t1676;
}
function Types$deep_repr_rrow(row) {
  let _t1679;
  const _t1678 = Types$rrow_repr(row);
  _t1680: {
    if (_t1678._tag === 0) {
      const name = _t1678._val[0];
      const ty = _t1678._val[1];
      const tail = _t1678._val[2];
      _t1679 = ({_tag: 0, _name: "RRow", _val: [name, Types$deep_repr(ty), Types$deep_repr_rrow(tail)]});
      break _t1680;
    }
    if (true) {
      const r = _t1678;
      _t1679 = r;
      break _t1680;
    }
    _match_fail("line 16933");
  }
  return _t1679;
}
function Types$types_compatible(t1, t2) {
  while (true) {
    const t1_1681 = Types$repr(t1);
    const t2_1683 = Types$repr(t2);
    let _t1686;
    const _t1685 = [t1_1681, t2_1683];
    _t1687: {
      if ((_t1685[0]._tag === 15 || _t1685[1]._tag === 15)) {
        _t1686 = true;
        break _t1687;
      }
      if (((((((_t1685[0]._tag === 0 && _t1685[1]._tag === 0 || _t1685[0]._tag === 1 && _t1685[1]._tag === 1) || _t1685[0]._tag === 2 && _t1685[1]._tag === 2) || _t1685[0]._tag === 3 && _t1685[1]._tag === 3) || _t1685[0]._tag === 4 && _t1685[1]._tag === 4) || _t1685[0]._tag === 5 && _t1685[1]._tag === 5) || _t1685[0]._tag === 6 && _t1685[1]._tag === 6)) {
        _t1686 = true;
        break _t1687;
      }
      if ((_t1685[0]._tag === 7 && _t1685[1]._tag === 7 || _t1685[0]._tag === 8 && _t1685[1]._tag === 8)) {
        const a1 = _t1685[0]._val[0];
        const r1 = _t1685[0]._val[2];
        const a2 = _t1685[1]._val[0];
        const r2 = _t1685[1]._val[2];
        _t1686 = (Types$types_compatible(a1, a2) && Types$types_compatible(r1, r2));
        break _t1687;
      }
      if (_t1685[0]._tag === 9 && _t1685[1]._tag === 9) {
        const ts1 = _t1685[0]._val;
        const ts2 = _t1685[1]._val;
        _t1686 = ((List$length(ts1) === List$length(ts2)) && List$forall2(Types$types_compatible, ts1, ts2));
        break _t1687;
      }
      if (_t1685[0]._tag === 10 && _t1685[1]._tag === 10) {
        const t1 = _t1685[0]._val;
        const t2 = _t1685[1]._val;
        const _t1688 = t1;
        const _t1689 = t2;
        t1 = _t1688;
        t2 = _t1689;
        continue;
        _t1686 = undefined;
        break _t1687;
      }
      if (_t1685[0]._tag === 13 && _t1685[1]._tag === 13) {
        const t1 = _t1685[0]._val;
        const t2 = _t1685[1]._val;
        const _t1690 = t1;
        const _t1691 = t2;
        t1 = _t1690;
        t2 = _t1691;
        continue;
        _t1686 = undefined;
        break _t1687;
      }
      if (_t1685[0]._tag === 11 && _t1685[1]._tag === 11) {
        const r1 = _t1685[0]._val;
        const r2 = _t1685[1]._val;
        const f1_1692 = Types$record_row_to_fields(r1);
        const f2_1694 = Types$record_row_to_fields(r2);
        let _t1703;
        if ((List$length(f1_1692) === List$length(f2_1694))) {
        function _t1696(__p47, __p48) {
          let _t1698;
          const _t1697 = __p47;
          _t1699: {
            if (true) {
              const n1 = _t1697[0];
              const t1 = _t1697[1];
              let _t1701;
              const _t1700 = __p48;
              _t1702: {
                if (true) {
                  const n2 = _t1700[0];
                  const t2 = _t1700[1];
                  _t1701 = ((n1 === n2) && Types$types_compatible(t1, t2));
                  break _t1702;
                }
                _match_fail("line 16933");
              }
              _t1698 = _t1701;
              break _t1699;
            }
            _match_fail("line 16933");
          }
          return _t1698;
        }
          _t1703 = List$forall2(_t1696, f1_1692, f2_1694);
        } else {
          _t1703 = false;
        }
        const _t1695 = _t1703;
        const _t1693 = _t1695;
        _t1686 = _t1693;
        break _t1687;
      }
      if (_t1685[0]._tag === 12 && _t1685[1]._tag === 12) {
        const a = _t1685[0]._val[0];
        const args_a = _t1685[0]._val[1];
        const b = _t1685[1]._val[0];
        const args_b = _t1685[1]._val[1];
        _t1686 = ((a === b) && ((List$length(args_a) === List$length(args_b)) && List$forall2(Types$types_compatible, args_a, args_b)));
        break _t1687;
      }
      if (_t1685[0]._tag === 14 && _t1685[1]._tag === 14) {
        const r1 = _t1685[0]._val;
        const r2 = _t1685[1]._val;
        _t1686 = Types$pvrows_compatible(r1, r2);
        break _t1687;
      }
      if (true) {
        _t1686 = false;
        break _t1687;
      }
      _match_fail("line 16933");
    }
    const _t1684 = _t1686;
    const _t1682 = _t1684;
    return _t1682;
  }
}
function Types$pvrows_compatible(r1, r2) {
  function collect(r) {
    let _t1705;
    const _t1704 = Types$pv_repr(r);
    _t1706: {
      if (_t1704._tag === 0) {
        const tag = _t1704._val[0];
        const ty_opt = _t1704._val[1];
        const tail = _t1704._val[2];
        _t1705 = ({_hd: [tag, ty_opt], _tl: collect(tail)});
        break _t1706;
      }
      if (true) {
        _t1705 = null;
        break _t1706;
      }
      _match_fail("line 16933");
    }
    return _t1705;
  }
  const tags1_1708 = collect(r1);
  const tags2_1710 = collect(r2);
  let _t1723;
  if ((List$length(tags1_1708) === List$length(tags2_1710))) {
  function _t1712(__p49, __p50) {
    let _t1714;
    const _t1713 = __p49;
    _t1715: {
      if (true) {
        const t1 = _t1713[0];
        const ty1 = _t1713[1];
        let _t1717;
        const _t1716 = __p50;
        _t1718: {
          if (true) {
            const t2 = _t1716[0];
            const ty2 = _t1716[1];
            let _t1722;
            if ((t1 === t2)) {
            let _t1720;
            const _t1719 = [ty1, ty2];
            _t1721: {
              if (_t1719[0]._tag === 0 && _t1719[1]._tag === 0) {
                _t1720 = true;
                break _t1721;
              }
              if (_t1719[0]._tag === 1 && _t1719[1]._tag === 1) {
                const a = _t1719[0]._val;
                const b = _t1719[1]._val;
                _t1720 = Types$types_compatible(a, b);
                break _t1721;
              }
              if (true) {
                _t1720 = false;
                break _t1721;
              }
              _match_fail("line 16933");
            }
              _t1722 = _t1720;
            } else {
              _t1722 = false;
            }
            _t1717 = _t1722;
            break _t1718;
          }
          _match_fail("line 16933");
        }
        _t1714 = _t1717;
        break _t1715;
      }
      _match_fail("line 16933");
    }
    return _t1714;
  }
    _t1723 = List$forall2(_t1712, tags1_1708, tags2_1710);
  } else {
    _t1723 = false;
  }
  const _t1711 = _t1723;
  const _t1709 = _t1711;
  const _t1707 = _t1709;
  return _t1707;
}
function Types$subtype(t1, t2) {
  while (true) {
    const t1_1724 = Types$repr(t1);
    const t2_1726 = Types$repr(t2);
    let _t1729;
    const _t1728 = [t1_1724, t2_1726];
    _t1730: {
      if (((((((_t1728[0]._tag === 0 && _t1728[1]._tag === 0 || _t1728[0]._tag === 1 && _t1728[1]._tag === 1) || _t1728[0]._tag === 2 && _t1728[1]._tag === 2) || _t1728[0]._tag === 3 && _t1728[1]._tag === 3) || _t1728[0]._tag === 4 && _t1728[1]._tag === 4) || _t1728[0]._tag === 5 && _t1728[1]._tag === 5) || _t1728[0]._tag === 6 && _t1728[1]._tag === 6)) {
        _t1729 = true;
        break _t1730;
      }
      if (_t1728[0]._tag === 12 && _t1728[1]._tag === 12) {
        const a = _t1728[0]._val[0];
        const args_a = _t1728[0]._val[1];
        const b = _t1728[1]._val[0];
        const args_b = _t1728[1]._val[1];
        _t1729 = ((a === b) && ((List$length(args_a) === List$length(args_b)) && List$forall2(Types$subtype, args_a, args_b)));
        break _t1730;
      }
      if ((_t1728[0]._tag === 7 && _t1728[1]._tag === 7 || _t1728[0]._tag === 8 && _t1728[1]._tag === 8)) {
        const a1 = _t1728[0]._val[0];
        const _e1 = _t1728[0]._val[1];
        const r1 = _t1728[0]._val[2];
        const a2 = _t1728[1]._val[0];
        const _e2 = _t1728[1]._val[1];
        const r2 = _t1728[1]._val[2];
        _t1729 = (Types$subtype(a2, a1) && Types$subtype(r1, r2));
        break _t1730;
      }
      if (_t1728[0]._tag === 11 && _t1728[1]._tag === 11) {
        const r1 = _t1728[0]._val;
        const r2 = _t1728[1]._val;
        const f1_1731 = Types$record_row_to_fields(r1);
        const f2_1733 = Types$record_row_to_fields(r2);
        function _t1735(__p51) {
          let _t1737;
          const _t1736 = __p51;
          _t1738: {
            if (true) {
              const f = _t1736[0];
              const t2$p = _t1736[1];
              let _t1740;
              const _t1739 = List$assoc_opt(f, f1_1731);
              _t1741: {
                if (_t1739._tag === 1) {
                  const t1$p = _t1739._val;
                  _t1740 = Types$subtype(t1$p, t2$p);
                  break _t1741;
                }
                if (_t1739._tag === 0) {
                  _t1740 = false;
                  break _t1741;
                }
                _match_fail("line 16933");
              }
              _t1737 = _t1740;
              break _t1738;
            }
            _match_fail("line 16933");
          }
          return _t1737;
        }
        const _t1734 = List$forall(_t1735, f2_1733);
        const _t1732 = _t1734;
        _t1729 = _t1732;
        break _t1730;
      }
      if (_t1728[0]._tag === 10 && _t1728[1]._tag === 10) {
        const t1$p = _t1728[0]._val;
        const t2$p = _t1728[1]._val;
        const _t1742 = t1$p;
        const _t1743 = t2$p;
        t1 = _t1742;
        t2 = _t1743;
        continue;
        _t1729 = undefined;
        break _t1730;
      }
      if (_t1728[0]._tag === 13 && _t1728[1]._tag === 13) {
        const t1$p = _t1728[0]._val;
        const t2$p = _t1728[1]._val;
        const _t1744 = t1$p;
        const _t1745 = t2$p;
        t1 = _t1744;
        t2 = _t1745;
        continue;
        _t1729 = undefined;
        break _t1730;
      }
      if (_t1728[0]._tag === 9 && _t1728[1]._tag === 9) {
        const ts1 = _t1728[0]._val;
        const ts2 = _t1728[1]._val;
        _t1729 = ((List$length(ts1) === List$length(ts2)) && List$forall2(Types$subtype, ts1, ts2));
        break _t1730;
      }
      if (_t1728[0]._tag === 15 && _t1728[1]._tag === 15) {
        const r1 = _t1728[0]._val;
        const r2 = _t1728[1]._val;
        if (_eq(r1, r2)) {
          _t1729 = true;
          break _t1730;
        }
      }
      if (true) {
        _t1729 = false;
        break _t1730;
      }
      _match_fail("line 16933");
    }
    const _t1727 = _t1729;
    const _t1725 = _t1727;
    return _t1725;
  }
}
function Types$equal_ty(t1, t2) {
  while (true) {
    const t1_1746 = Types$repr(t1);
    const t2_1748 = Types$repr(t2);
    let _t1751;
    const _t1750 = [t1_1746, t2_1748];
    _t1752: {
      if (((((((_t1750[0]._tag === 0 && _t1750[1]._tag === 0 || _t1750[0]._tag === 1 && _t1750[1]._tag === 1) || _t1750[0]._tag === 2 && _t1750[1]._tag === 2) || _t1750[0]._tag === 3 && _t1750[1]._tag === 3) || _t1750[0]._tag === 4 && _t1750[1]._tag === 4) || _t1750[0]._tag === 5 && _t1750[1]._tag === 5) || _t1750[0]._tag === 6 && _t1750[1]._tag === 6)) {
        _t1751 = true;
        break _t1752;
      }
      if (_t1750[0]._tag === 12 && _t1750[1]._tag === 12) {
        const a = _t1750[0]._val[0];
        const args_a = _t1750[0]._val[1];
        const b = _t1750[1]._val[0];
        const args_b = _t1750[1]._val[1];
        _t1751 = ((a === b) && ((List$length(args_a) === List$length(args_b)) && List$forall2(Types$equal_ty, args_a, args_b)));
        break _t1752;
      }
      if ((_t1750[0]._tag === 7 && _t1750[1]._tag === 7 || _t1750[0]._tag === 8 && _t1750[1]._tag === 8)) {
        const a1 = _t1750[0]._val[0];
        const _e1 = _t1750[0]._val[1];
        const r1 = _t1750[0]._val[2];
        const a2 = _t1750[1]._val[0];
        const _e2 = _t1750[1]._val[1];
        const r2 = _t1750[1]._val[2];
        _t1751 = (Types$equal_ty(a1, a2) && Types$equal_ty(r1, r2));
        break _t1752;
      }
      if (_t1750[0]._tag === 11 && _t1750[1]._tag === 11) {
        const r1 = _t1750[0]._val;
        const r2 = _t1750[1]._val;
        const f1_1753 = Types$record_row_to_fields(r1);
        const f2_1755 = Types$record_row_to_fields(r2);
        let _t1764;
        if ((List$length(f1_1753) === List$length(f2_1755))) {
        function _t1757(__p52, __p53) {
          let _t1759;
          const _t1758 = __p52;
          _t1760: {
            if (true) {
              const n1 = _t1758[0];
              const t1 = _t1758[1];
              let _t1762;
              const _t1761 = __p53;
              _t1763: {
                if (true) {
                  const n2 = _t1761[0];
                  const t2 = _t1761[1];
                  _t1762 = ((n1 === n2) && Types$equal_ty(t1, t2));
                  break _t1763;
                }
                _match_fail("line 16933");
              }
              _t1759 = _t1762;
              break _t1760;
            }
            _match_fail("line 16933");
          }
          return _t1759;
        }
          _t1764 = List$forall2(_t1757, f1_1753, f2_1755);
        } else {
          _t1764 = false;
        }
        const _t1756 = _t1764;
        const _t1754 = _t1756;
        _t1751 = _t1754;
        break _t1752;
      }
      if (_t1750[0]._tag === 10 && _t1750[1]._tag === 10) {
        const t1$p = _t1750[0]._val;
        const t2$p = _t1750[1]._val;
        const _t1765 = t1$p;
        const _t1766 = t2$p;
        t1 = _t1765;
        t2 = _t1766;
        continue;
        _t1751 = undefined;
        break _t1752;
      }
      if (_t1750[0]._tag === 13 && _t1750[1]._tag === 13) {
        const t1$p = _t1750[0]._val;
        const t2$p = _t1750[1]._val;
        const _t1767 = t1$p;
        const _t1768 = t2$p;
        t1 = _t1767;
        t2 = _t1768;
        continue;
        _t1751 = undefined;
        break _t1752;
      }
      if (_t1750[0]._tag === 9 && _t1750[1]._tag === 9) {
        const ts1 = _t1750[0]._val;
        const ts2 = _t1750[1]._val;
        _t1751 = ((List$length(ts1) === List$length(ts2)) && List$forall2(Types$equal_ty, ts1, ts2));
        break _t1752;
      }
      if (_t1750[0]._tag === 15 && _t1750[1]._tag === 15) {
        const r1 = _t1750[0]._val;
        const r2 = _t1750[1]._val;
        _t1751 = _eq(r1, r2);
        break _t1752;
      }
      if (true) {
        _t1751 = false;
        break _t1752;
      }
      _match_fail("line 16933");
    }
    const _t1749 = _t1751;
    const _t1747 = _t1749;
    return _t1747;
  }
}
function Types$freshen_unbound(ty) {
  const tbl_1769 = Hashtbl$create(4);
  function go(ty) {
    let _t1772;
    const _t1771 = Types$repr(ty);
    _t1773: {
      if (_t1771._tag === 15 && _t1771._val.contents._tag === 0) {
        const id = _t1771._val.contents._val[0];
        const level = _t1771._val.contents._val[1];
        let _t1775;
        const _t1774 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tbl_1769, id]);
        _t1776: {
          if (_t1774._tag === 1) {
            const tv = _t1774._val;
            _t1775 = tv;
            break _t1776;
          }
          if (_t1774._tag === 0) {
            const tv_1777 = Types$new_tvar(level);
            _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tbl_1769, id, tv_1777]);
            const _t1778 = tv_1777;
            _t1775 = _t1778;
            break _t1776;
          }
          _match_fail("line 16933");
        }
        _t1772 = _t1775;
        break _t1773;
      }
      if (_t1771._tag === 7) {
        const a = _t1771._val[0];
        const eff = _t1771._val[1];
        const r = _t1771._val[2];
        _t1772 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(r)]});
        break _t1773;
      }
      if (_t1771._tag === 8) {
        const a = _t1771._val[0];
        const eff = _t1771._val[1];
        const r = _t1771._val[2];
        _t1772 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(r)]});
        break _t1773;
      }
      if (_t1771._tag === 9) {
        const ts = _t1771._val;
        _t1772 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
        break _t1773;
      }
      if (_t1771._tag === 10) {
        const t = _t1771._val;
        _t1772 = ({_tag: 10, _name: "TList", _val: go(t)});
        break _t1773;
      }
      if (_t1771._tag === 13) {
        const t = _t1771._val;
        _t1772 = ({_tag: 13, _name: "TArray", _val: go(t)});
        break _t1773;
      }
      if (_t1771._tag === 11) {
        const row = _t1771._val;
        _t1772 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
        break _t1773;
      }
      if (_t1771._tag === 14) {
        const row = _t1771._val;
        _t1772 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
        break _t1773;
      }
      if (_t1771._tag === 12) {
        const name = _t1771._val[0];
        const args = _t1771._val[1];
        _t1772 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
        break _t1773;
      }
      if (true) {
        const t = _t1771;
        _t1772 = t;
        break _t1773;
      }
      _match_fail("line 16933");
    }
    return _t1772;
  }
  function go_eff(eff) {
    let _t1780;
    const _t1779 = Types$eff_repr(eff);
    _t1781: {
      if (_t1779._tag === 2) {
        const label = _t1779._val[0];
        const tys = _t1779._val[1];
        const tail = _t1779._val[2];
        _t1780 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, tys), go_eff(tail)]});
        break _t1781;
      }
      if (true) {
        const e = _t1779;
        _t1780 = e;
        break _t1781;
      }
      _match_fail("line 16933");
    }
    return _t1780;
  }
  function go_rrow(__x) {
    let _t1783;
    const _t1782 = __x;
    _t1784: {
      if (_t1782._tag === 0) {
        const name = _t1782._val[0];
        const ty = _t1782._val[1];
        const tail = _t1782._val[2];
        _t1783 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
        break _t1784;
      }
      if (true) {
        const r = _t1782;
        _t1783 = r;
        break _t1784;
      }
      _match_fail("line 16933");
    }
    return _t1783;
  }
  function go_pv(__x) {
    let _t1786;
    const _t1785 = __x;
    _t1787: {
      if (_t1785._tag === 0) {
        const tag = _t1785._val[0];
        const payload = _t1785._val[1];
        const tail = _t1785._val[2];
        _t1786 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload), go_pv(tail)]});
        break _t1787;
      }
      if (true) {
        const p = _t1785;
        _t1786 = p;
        break _t1787;
      }
      _match_fail("line 16933");
    }
    return _t1786;
  }
  const _t1788 = go(ty);
  const _t1770 = _t1788;
  return _t1770;
}
function Types$match_partial_inst(inst_tys, partial) {
  let _t1790;
  const _t1789 = Hashtbl$create(4);
  _t1791: {
    if (true) {
      const bindings = _t1789;
      function match_one(inst, conc) {
        while (true) {
          let _t1793;
          const _t1792 = inst;
          _t1794: {
            if (_t1792._tag === 16) {
              const i = _t1792._val;
              let _t1796;
              const _t1795 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, bindings, i]);
              _t1797: {
                if (_t1795._tag === 1) {
                  const prev = _t1795._val;
                  let _t1798;
                  if (Types$equal_ty(prev, conc)) {
                    _t1798 = true;
                  } else {
                    const _t1799 = (function() {
                      const _t1800 = _h;
                      _h = Object.assign({}, _t1800, {
                        "unify_error": function(_, __k_try) { throw {_e: "unify_error", _v: _}; },
                      });
                      try {
                        Types$unify(prev, conc);
                        const __x_1801 = true;
                        return __x_1801;
                      } catch (_exc) {
                        if (_exc && _exc._e === "unify_error") {
                          const _ = _exc._v;
                          return false;
                        } else { throw _exc; }
                      } finally { _h = _t1800; }
                    })();
                    _t1798 = _t1799;
                  }
                  _t1796 = _t1798;
                  break _t1797;
                }
                if (_t1795._tag === 0) {
                  _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, bindings, i, conc]);
                  _t1796 = true;
                  break _t1797;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1796;
              break _t1794;
            }
            if (_t1792._tag === 0) {
              let _t1803;
              const _t1802 = Types$repr(conc);
              _t1804: {
                if (_t1802._tag === 0) {
                  _t1803 = true;
                  break _t1804;
                }
                if (true) {
                  _t1803 = false;
                  break _t1804;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1803;
              break _t1794;
            }
            if (_t1792._tag === 1) {
              let _t1806;
              const _t1805 = Types$repr(conc);
              _t1807: {
                if (_t1805._tag === 1) {
                  _t1806 = true;
                  break _t1807;
                }
                if (true) {
                  _t1806 = false;
                  break _t1807;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1806;
              break _t1794;
            }
            if (_t1792._tag === 2) {
              let _t1809;
              const _t1808 = Types$repr(conc);
              _t1810: {
                if (_t1808._tag === 2) {
                  _t1809 = true;
                  break _t1810;
                }
                if (true) {
                  _t1809 = false;
                  break _t1810;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1809;
              break _t1794;
            }
            if (_t1792._tag === 3) {
              let _t1812;
              const _t1811 = Types$repr(conc);
              _t1813: {
                if (_t1811._tag === 3) {
                  _t1812 = true;
                  break _t1813;
                }
                if (true) {
                  _t1812 = false;
                  break _t1813;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1812;
              break _t1794;
            }
            if (_t1792._tag === 6) {
              let _t1815;
              const _t1814 = Types$repr(conc);
              _t1816: {
                if (_t1814._tag === 6) {
                  _t1815 = true;
                  break _t1816;
                }
                if (true) {
                  _t1815 = false;
                  break _t1816;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1815;
              break _t1794;
            }
            if (_t1792._tag === 10) {
              const a = _t1792._val;
              let _t1818;
              const _t1817 = Types$repr(conc);
              _t1819: {
                if (_t1817._tag === 10) {
                  const b = _t1817._val;
                  const _t1820 = a;
                  const _t1821 = b;
                  inst = _t1820;
                  conc = _t1821;
                  continue;
                  _t1818 = undefined;
                  break _t1819;
                }
                if (true) {
                  _t1818 = false;
                  break _t1819;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1818;
              break _t1794;
            }
            if (_t1792._tag === 13) {
              const a = _t1792._val;
              let _t1823;
              const _t1822 = Types$repr(conc);
              _t1824: {
                if (_t1822._tag === 13) {
                  const b = _t1822._val;
                  const _t1825 = a;
                  const _t1826 = b;
                  inst = _t1825;
                  conc = _t1826;
                  continue;
                  _t1823 = undefined;
                  break _t1824;
                }
                if (true) {
                  _t1823 = false;
                  break _t1824;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1823;
              break _t1794;
            }
            if (_t1792._tag === 9) {
              const ts1 = _t1792._val;
              let _t1828;
              const _t1827 = Types$repr(conc);
              _t1829: {
                if (_t1827._tag === 9) {
                  const ts2 = _t1827._val;
                  if ((List$length(ts1) === List$length(ts2))) {
                    _t1828 = List$forall2(match_one, ts1, ts2);
                    break _t1829;
                  }
                }
                if (true) {
                  _t1828 = false;
                  break _t1829;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1828;
              break _t1794;
            }
            if (_t1792._tag === 7) {
              const a1 = _t1792._val[0];
              const _e1 = _t1792._val[1];
              const a2 = _t1792._val[2];
              let _t1831;
              const _t1830 = Types$repr(conc);
              _t1832: {
                if (_t1830._tag === 7) {
                  const b1 = _t1830._val[0];
                  const _e2 = _t1830._val[1];
                  const b2 = _t1830._val[2];
                  _t1831 = (match_one(a1, b1) && match_one(a2, b2));
                  break _t1832;
                }
                if (true) {
                  _t1831 = false;
                  break _t1832;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1831;
              break _t1794;
            }
            if (_t1792._tag === 8) {
              const a1 = _t1792._val[0];
              const _e1 = _t1792._val[1];
              const a2 = _t1792._val[2];
              let _t1834;
              const _t1833 = Types$repr(conc);
              _t1835: {
                if (_t1833._tag === 8) {
                  const b1 = _t1833._val[0];
                  const _e2 = _t1833._val[1];
                  const b2 = _t1833._val[2];
                  _t1834 = (match_one(a1, b1) && match_one(a2, b2));
                  break _t1835;
                }
                if (true) {
                  _t1834 = false;
                  break _t1835;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1834;
              break _t1794;
            }
            if (_t1792._tag === 11) {
              const r1 = _t1792._val;
              let _t1837;
              const _t1836 = Types$repr(conc);
              _t1838: {
                if (_t1836._tag === 11) {
                  const r2 = _t1836._val;
                  const f1_1839 = Types$record_row_to_fields(r1);
                  const f2_1841 = Types$record_row_to_fields(r2);
                  let _t1850;
                  if ((List$length(f1_1839) === List$length(f2_1841))) {
                  function _t1843(__p54, __p55) {
                    let _t1845;
                    const _t1844 = __p54;
                    _t1846: {
                      if (true) {
                        const n1 = _t1844[0];
                        const t1 = _t1844[1];
                        let _t1848;
                        const _t1847 = __p55;
                        _t1849: {
                          if (true) {
                            const n2 = _t1847[0];
                            const t2 = _t1847[1];
                            _t1848 = ((n1 === n2) && match_one(t1, t2));
                            break _t1849;
                          }
                          _match_fail("line 16933");
                        }
                        _t1845 = _t1848;
                        break _t1846;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1845;
                  }
                    _t1850 = List$forall2(_t1843, f1_1839, f2_1841);
                  } else {
                    _t1850 = false;
                  }
                  const _t1842 = _t1850;
                  const _t1840 = _t1842;
                  _t1837 = _t1840;
                  break _t1838;
                }
                if (true) {
                  _t1837 = false;
                  break _t1838;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1837;
              break _t1794;
            }
            if (_t1792._tag === 12) {
              const a = _t1792._val[0];
              const args_inst = _t1792._val[1];
              let _t1852;
              const _t1851 = Types$repr(conc);
              _t1853: {
                if (_t1851._tag === 12) {
                  const b = _t1851._val[0];
                  const args_conc = _t1851._val[1];
                  if (((a === b) && (List$length(args_inst) === List$length(args_conc)))) {
                    _t1852 = List$forall2(match_one, args_inst, args_conc);
                    break _t1853;
                  }
                }
                if (true) {
                  _t1852 = false;
                  break _t1853;
                }
                _match_fail("line 16933");
              }
              _t1793 = _t1852;
              break _t1794;
            }
            if (true) {
              _t1793 = Types$equal_ty(inst, conc);
              break _t1794;
            }
            _match_fail("line 16933");
          }
          return _t1793;
        }
      }
      let _t1859;
      if ((List$length(inst_tys) === List$length(partial))) {
      function _t1855(inst_ty, found_opt) {
        let _t1857;
        const _t1856 = found_opt;
        _t1858: {
          if (_t1856._tag === 0) {
            _t1857 = true;
            break _t1858;
          }
          if (_t1856._tag === 1) {
            const conc_ty = _t1856._val;
            _t1857 = match_one(inst_ty, conc_ty);
            break _t1858;
          }
          _match_fail("line 16933");
        }
        return _t1857;
      }
        _t1859 = List$forall2(_t1855, inst_tys, partial);
      } else {
        _t1859 = false;
      }
      const _t1854 = _t1859;
      _t1790 = _t1854;
      break _t1791;
    }
    _match_fail("line 16933");
  }
  return _t1790;
}
function Types$inst_specificity(inst) {
  function count(__x) {
    while (true) {
      let _t1861;
      const _t1860 = __x;
      _t1862: {
        if (_t1860._tag === 16) {
          _t1861 = 0;
          break _t1862;
        }
        if (((((((_t1860._tag === 0 || _t1860._tag === 1) || _t1860._tag === 2) || _t1860._tag === 3) || _t1860._tag === 4) || _t1860._tag === 5) || _t1860._tag === 6)) {
          _t1861 = 1;
          break _t1862;
        }
        if ((_t1860._tag === 7 || _t1860._tag === 8)) {
          const a = _t1860._val[0];
          const b = _t1860._val[2];
          _t1861 = (count(a) + count(b));
          break _t1862;
        }
        if (_t1860._tag === 9) {
          const ts = _t1860._val;
          function _t1863(acc, t) {
            return (acc + count(t));
          }
          _t1861 = List$fold(_t1863, 0, ts);
          break _t1862;
        }
        if ((_t1860._tag === 10 || _t1860._tag === 13)) {
          const a = _t1860._val;
          const _t1864 = a;
          __x = _t1864;
          continue;
          _t1861 = undefined;
          break _t1862;
        }
        if (_t1860._tag === 11) {
          const row = _t1860._val;
          function _t1865(acc, __p56) {
            let _t1867;
            const _t1866 = __p56;
            _t1868: {
              if (true) {
                const t = _t1866[1];
                _t1867 = (acc + count(t));
                break _t1868;
              }
              _match_fail("line 16933");
            }
            return _t1867;
          }
          _t1861 = List$fold(_t1865, 0, Types$record_row_to_fields(row));
          break _t1862;
        }
        if (_t1860._tag === 12) {
          const ts = _t1860._val[1];
          function _t1869(acc, t) {
            return (acc + count(t));
          }
          _t1861 = List$fold(_t1869, 0, ts);
          break _t1862;
        }
        if (_t1860._tag === 14) {
          _t1861 = 0;
          break _t1862;
        }
        if (_t1860._tag === 15 && _t1860._val.contents._tag === 1) {
          const t = _t1860._val.contents._val;
          const _t1870 = t;
          __x = _t1870;
          continue;
          _t1861 = undefined;
          break _t1862;
        }
        if (_t1860._tag === 15 && _t1860._val.contents._tag === 0) {
          _t1861 = 0;
          break _t1862;
        }
        _match_fail("line 16933");
      }
      return _t1861;
    }
  }
  function _t1872(acc, ty) {
    return (acc + count(ty));
  }
  const _t1871 = List$fold(_t1872, 0, inst.inst_tys);
  return _t1871;
}
function Types$most_specific_inst(insts) {
  let _t1874;
  const _t1873 = insts;
  _t1875: {
    if (_t1873 === null) {
      _t1874 = ({_tag: 0, _name: "None"});
      break _t1875;
    }
    if (_t1873 !== null && _t1873._tl === null) {
      const x = _t1873._hd;
      _t1874 = ({_tag: 1, _name: "Some", _val: x});
      break _t1875;
    }
    if (true) {
      function _t1876(i) {
        return [Types$inst_specificity(i), i];
      }
      const scored_1877 = List$map(_t1876, insts);
      function _t1879(__p57, __p58) {
        let _t1881;
        const _t1880 = __p57;
        _t1882: {
          if (true) {
            const a = _t1880[0];
            let _t1884;
            const _t1883 = __p58;
            _t1885: {
              if (true) {
                const b = _t1883[0];
                _t1884 = compare(b, a);
                break _t1885;
              }
              _match_fail("line 16933");
            }
            _t1881 = _t1884;
            break _t1882;
          }
          _match_fail("line 16933");
        }
        return _t1881;
      }
      const sorted_1886 = List$sort(_t1879, scored_1877);
      let _t1889;
      const _t1888 = sorted_1886;
      _t1890: {
        if (_t1888 !== null && _t1888._tl !== null) {
          const s1 = _t1888._hd[0];
          const i1 = _t1888._hd[1];
          const s2 = _t1888._tl._hd[0];
          if ((s1 > s2)) {
            _t1889 = ({_tag: 1, _name: "Some", _val: i1});
            break _t1890;
          }
        }
        if (true) {
          _t1889 = ({_tag: 0, _name: "None"});
          break _t1890;
        }
        _match_fail("line 16933");
      }
      const _t1887 = _t1889;
      const _t1878 = _t1887;
      _t1874 = _t1878;
      break _t1875;
    }
    _match_fail("line 16933");
  }
  return _t1874;
}
function Types$find_instance(instances, class_name, tys) {
  function _t1891(inst) {
    let _t1893;
    if ((inst.inst_class === class_name)) {
    function _t1892(t) {
      return ({_tag: 1, _name: "Some", _val: t});
    }
      _t1893 = Types$match_partial_inst(inst.inst_tys, List$map(_t1892, tys));
    } else {
      _t1893 = false;
    }
    return _t1893;
  }
  return List$find(_t1891, instances);
}
function Types$check_fundep_consistency(class_def, new_inst, existing_instances) {
  return _trampoline(function() {
    function _t1894(fd) {
      return _trampoline(function() {
        function _t1895(existing) {
          return _trampoline(function() {
            if ((!(existing.inst_class === new_inst.inst_class))) {
              return undefined;
            } else {
              if ((List$length(existing.inst_tys) !== List$length(new_inst.inst_tys))) {
                return undefined;
              } else {
                function _t1896(i) {
                  const ex_ty_1897 = List$nth(existing.inst_tys, i);
                  const new_ty_1899 = List$nth(new_inst.inst_tys, i);
                  const _t1900 = Types$equal_ty(ex_ty_1897, new_ty_1899);
                  const _t1898 = _t1900;
                  return _t1898;
                }
                const from_match_1901 = _resolve(List$forall(_t1896, fd.fd_from));
                if (from_match_1901) {
                  function _t1902(i) {
                    const ex_ty_1903 = List$nth(existing.inst_tys, i);
                    const new_ty_1905 = List$nth(new_inst.inst_tys, i);
                    const _t1906 = Types$equal_ty(ex_ty_1903, new_ty_1905);
                    const _t1904 = _t1906;
                    return _t1904;
                  }
                  const to_match_1907 = _resolve(List$forall(_t1902, fd.fd_to));
                  if ((!to_match_1907)) {
                    function _t1908(i) {
                      return Types$pp_ty(List$nth(new_inst.inst_tys, i));
                    }
                    const from_strs_1909 = _resolve(List$map(_t1908, fd.fd_from));
                    function _t1910(i) {
                      return Types$pp_ty(List$nth(new_inst.inst_tys, i));
                    }
                    const to_strs_new_1911 = _resolve(List$map(_t1910, fd.fd_to));
                    function _t1912(i) {
                      return Types$pp_ty(List$nth(existing.inst_tys, i));
                    }
                    const to_strs_ex_1913 = _resolve(List$map(_t1912, fd.fd_to));
                    return _h["unify_error"](((((((("functional dependency violation in class " + __dict_Show_string.show(class_def.class_name)) + ": type(s) ") + __dict_Show_string.show(String$concat(", ", from_strs_1909))) + " determine ") + __dict_Show_string.show(String$concat(", ", to_strs_new_1911))) + ", but existing instance has ") + __dict_Show_string.show(String$concat(", ", to_strs_ex_1913))), function(_t1914) {
                      return _bounce(function() {
                        return _t1914;
                      });
                    });
                  } else {
                    return undefined;
                  }
                } else {
                  return undefined;
                }
              }
            }
          });
        }
        const _t1915 = _resolve(List$iter(_t1895, existing_instances));
        return _t1915;
      });
    }
    const _t1916 = _resolve(List$iter(_t1894, class_def.class_fundeps));
    return _t1916;
  }, Types$check_fundep_consistency);
}
function Types$improve_with_fundeps(instances, class_def, partial) {
  function _t1917(partial, fd) {
    function _t1918(i) {
      return ((i < List$length(partial)) && !_eq(List$nth(partial, i), ({_tag: 0, _name: "None"})));
    }
    const from_known_1919 = List$forall(_t1918, fd.fd_from);
    let _t1921;
    if ((!from_known_1919)) {
      _t1921 = partial;
    } else {
      function _t1922(i, opt) {
        let _t1923;
        if (List$mem(i, fd.fd_from)) {
          _t1923 = opt;
        } else {
          _t1923 = ({_tag: 0, _name: "None"});
        }
        return _t1923;
      }
      const from_partial_1924 = List$mapi(_t1922, partial);
      function _t1926(inst) {
        return ((inst.inst_class === class_def.class_name) && ((List$length(inst.inst_tys) === List$length(partial)) && Types$match_partial_inst(inst.inst_tys, from_partial_1924)));
      }
      const matching_1927 = List$filter(_t1926, instances);
      let _t1930;
      const _t1929 = matching_1927;
      _t1931: {
        if (_t1929 !== null && _t1929._tl === null) {
          const inst = _t1929._hd;
          let _t1933;
          const _t1932 = Hashtbl$create(4);
          _t1934: {
            if (true) {
              const subst = _t1932;
              function _t1935(i) {
                const inst_ty_1936 = List$nth(inst.inst_tys, i);
                const conc_ty_1938 = Option$unwrap(List$nth(partial, i));
                function extract_bindings(pat, conc) {
                  while (true) {
                    let _t1941;
                    const _t1940 = [pat, Types$repr(conc)];
                    _t1942: {
                      if (_t1940[0]._tag === 16) {
                        const g = _t1940[0]._val;
                        const ty = _t1940[1];
                        _t1941 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, subst, g, ty]);
                        break _t1942;
                      }
                      if (_t1940[0]._tag === 10 && _t1940[1]._tag === 10) {
                        const a = _t1940[0]._val;
                        const b = _t1940[1]._val;
                        const _t1943 = a;
                        const _t1944 = b;
                        pat = _t1943;
                        conc = _t1944;
                        continue;
                        _t1941 = undefined;
                        break _t1942;
                      }
                      if (_t1940[0]._tag === 13 && _t1940[1]._tag === 13) {
                        const a = _t1940[0]._val;
                        const b = _t1940[1]._val;
                        const _t1945 = a;
                        const _t1946 = b;
                        pat = _t1945;
                        conc = _t1946;
                        continue;
                        _t1941 = undefined;
                        break _t1942;
                      }
                      if (_t1940[0]._tag === 9 && _t1940[1]._tag === 9) {
                        const ts1 = _t1940[0]._val;
                        const ts2 = _t1940[1]._val;
                        if ((List$length(ts1) === List$length(ts2))) {
                          _t1941 = List$iter2(extract_bindings, ts1, ts2);
                          break _t1942;
                        }
                      }
                      if (_t1940[0]._tag === 12 && _t1940[1]._tag === 12) {
                        const args1 = _t1940[0]._val[1];
                        const args2 = _t1940[1]._val[1];
                        if ((List$length(args1) === List$length(args2))) {
                          _t1941 = List$iter2(extract_bindings, args1, args2);
                          break _t1942;
                        }
                      }
                      if ((_t1940[0]._tag === 7 && _t1940[1]._tag === 7 || _t1940[0]._tag === 8 && _t1940[1]._tag === 8)) {
                        const a1 = _t1940[0]._val[0];
                        const r1 = _t1940[0]._val[2];
                        const a2 = _t1940[1]._val[0];
                        const r2 = _t1940[1]._val[2];
                        extract_bindings(a1, a2);
                        const _t1947 = r1;
                        const _t1948 = r2;
                        pat = _t1947;
                        conc = _t1948;
                        continue;
                        _t1941 = undefined;
                        break _t1942;
                      }
                      if (true) {
                        _t1941 = undefined;
                        break _t1942;
                      }
                      _match_fail("line 16933");
                    }
                    return _t1941;
                  }
                }
                const _t1949 = extract_bindings(inst_ty_1936, conc_ty_1938);
                const _t1939 = _t1949;
                const _t1937 = _t1939;
                return _t1937;
              }
              List$iter(_t1935, fd.fd_from);
              function apply_subst(ty) {
                let _t1951;
                const _t1950 = ty;
                _t1952: {
                  if (_t1950._tag === 16) {
                    const g = _t1950._val;
                    let _t1954;
                    const _t1953 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, subst, g]);
                    _t1955: {
                      if (_t1953._tag === 1) {
                        const t = _t1953._val;
                        _t1954 = t;
                        break _t1955;
                      }
                      if (_t1953._tag === 0) {
                        _t1954 = ty;
                        break _t1955;
                      }
                      _match_fail("line 16933");
                    }
                    _t1951 = _t1954;
                    break _t1952;
                  }
                  if (_t1950._tag === 10) {
                    const a = _t1950._val;
                    _t1951 = ({_tag: 10, _name: "TList", _val: apply_subst(a)});
                    break _t1952;
                  }
                  if (_t1950._tag === 13) {
                    const a = _t1950._val;
                    _t1951 = ({_tag: 13, _name: "TArray", _val: apply_subst(a)});
                    break _t1952;
                  }
                  if (_t1950._tag === 9) {
                    const ts = _t1950._val;
                    _t1951 = ({_tag: 9, _name: "TTuple", _val: List$map(apply_subst, ts)});
                    break _t1952;
                  }
                  if (_t1950._tag === 12) {
                    const n = _t1950._val[0];
                    const args = _t1950._val[1];
                    _t1951 = ({_tag: 12, _name: "TVariant", _val: [n, List$map(apply_subst, args)]});
                    break _t1952;
                  }
                  if (_t1950._tag === 7) {
                    const a = _t1950._val[0];
                    const e = _t1950._val[1];
                    const r = _t1950._val[2];
                    _t1951 = ({_tag: 7, _name: "TArrow", _val: [apply_subst(a), e, apply_subst(r)]});
                    break _t1952;
                  }
                  if (_t1950._tag === 8) {
                    const a = _t1950._val[0];
                    const e = _t1950._val[1];
                    const r = _t1950._val[2];
                    _t1951 = ({_tag: 8, _name: "TCont", _val: [apply_subst(a), e, apply_subst(r)]});
                    break _t1952;
                  }
                  if (true) {
                    _t1951 = ty;
                    break _t1952;
                  }
                  _match_fail("line 16933");
                }
                return _t1951;
              }
              function _t1957(i, opt) {
                let _t1958;
                if (!_eq(opt, ({_tag: 0, _name: "None"}))) {
                  _t1958 = opt;
                } else {
                  let _t1959;
                  if (List$mem(i, fd.fd_to)) {
                    _t1959 = ({_tag: 1, _name: "Some", _val: apply_subst(List$nth(inst.inst_tys, i))});
                  } else {
                    _t1959 = opt;
                  }
                  _t1958 = _t1959;
                }
                return _t1958;
              }
              const _t1956 = List$mapi(_t1957, partial);
              _t1933 = _t1956;
              break _t1934;
            }
            _match_fail("line 16933");
          }
          _t1930 = _t1933;
          break _t1931;
        }
        if (true) {
          _t1930 = partial;
          break _t1931;
        }
        _match_fail("line 16933");
      }
      const _t1928 = _t1930;
      const _t1925 = _t1928;
      _t1921 = _t1925;
    }
    const _t1920 = _t1921;
    return _t1920;
  }
  return List$fold(_t1917, partial, class_def.class_fundeps);
}
function Lexer$create(source) {
  return ({col: 1, cursor: 0, len: String$length(source), line: 1, source: source});
}
function Lexer$current_loc(l) {
  return ({col: l.col, line: l.line, offset: l.cursor});
}
function Lexer$make_token(l, kind, loc) {
  return ({end_offset: l.cursor, kind: kind, loc: loc});
}
function Lexer$at_end(l) {
  return (l.cursor >= l.len);
}
function Lexer$peek(l) {
  let _t1960;
  if (Lexer$at_end(l)) {
    _t1960 = 0;
  } else {
    _t1960 = String$get(l.source, l.cursor);
  }
  return _t1960;
}
function Lexer$peek2(l) {
  let _t1961;
  if (((l.cursor + 1) >= l.len)) {
    _t1961 = 0;
  } else {
    _t1961 = String$get(l.source, (l.cursor + 1));
  }
  return _t1961;
}
function Lexer$peek3(l) {
  let _t1962;
  if (((l.cursor + 2) >= l.len)) {
    _t1962 = 0;
  } else {
    _t1962 = String$get(l.source, (l.cursor + 2));
  }
  return _t1962;
}
function Lexer$advance(l) {
  const c_1963 = String$get(l.source, l.cursor);
  (l.cursor = (l.cursor + 1), undefined);
  let _t1965;
  if ((c_1963 === 10)) {
    (l.line = (l.line + 1), undefined);
    _t1965 = (l.col = 1, undefined);
  } else {
    _t1965 = (l.col = (l.col + 1), undefined);
  }
  _t1965;
  const _t1964 = c_1963;
  return _t1964;
}
function Lexer$error(l, msg) {
  return _trampoline(function() {
    return _h["lex_error"]([msg, Lexer$current_loc(l)], function(_t1966) {
      return _bounce(function() {
        return _t1966;
      });
    });
  }, Lexer$error);
}
function Lexer$skip_whitespace(l) {
  let _t1967 = undefined;
  let _t1968 = false, _t1969;
  while (true) {
    if (!(((!Lexer$at_end(l)) && ((Lexer$peek(l) === 32) || ((Lexer$peek(l) === 9) || ((Lexer$peek(l) === 10) || (Lexer$peek(l) === 13))))))) break;
    Lexer$advance(l);
    undefined;
    if (_t1968) break;
  }
  _t1967 = _t1968 ? _t1969 : undefined;
  return _t1967;
}
function Lexer$skip_comment(l) {
  const depth_1970 = Ref$create(1);
  let _t1972 = undefined;
  let _t1973 = false, _t1974;
  while (true) {
    if (!((Ref$get(depth_1970) > 0))) break;
    let _t1975;
    if (Lexer$at_end(l)) {
      _t1975 = Lexer$error(l, "unterminated comment");
    } else {
      _t1975 = undefined;
    }
    _t1975;
    let _t1976;
    if (((Lexer$peek(l) === 40) && (Lexer$peek2(l) === 42))) {
      Lexer$advance(l);
      undefined;
      Lexer$advance(l);
      undefined;
      _t1976 = Ref$set(depth_1970, (Ref$get(depth_1970) + 1));
    } else {
      let _t1977;
      if (((Lexer$peek(l) === 42) && (Lexer$peek2(l) === 41))) {
        Lexer$advance(l);
        undefined;
        Lexer$advance(l);
        undefined;
        _t1977 = Ref$set(depth_1970, (Ref$get(depth_1970) - 1));
      } else {
        Lexer$advance(l);
        _t1977 = undefined;
      }
      _t1976 = _t1977;
    }
    _t1976;
    if (_t1973) break;
  }
  _t1972 = _t1973 ? _t1974 : undefined;
  const _t1971 = _t1972;
  return _t1971;
}
function Lexer$skip_whitespace_and_comments(l) {
  const changed_1978 = Ref$create(true);
  let _t1980 = undefined;
  let _t1981 = false, _t1982;
  while (true) {
    if (!(Ref$get(changed_1978))) break;
    Ref$set(changed_1978, false);
    const p_1983 = l.cursor;
    Lexer$skip_whitespace(l);
    let _t1985;
    if (((!Lexer$at_end(l)) && ((Lexer$peek(l) === 40) && ((Lexer$peek2(l) === 42) && (Lexer$peek3(l) !== 41))))) {
      Lexer$advance(l);
      undefined;
      Lexer$advance(l);
      undefined;
      Lexer$skip_comment(l);
      _t1985 = Ref$set(changed_1978, true);
    } else {
      _t1985 = undefined;
    }
    _t1985;
    let _t1986;
    if ((l.cursor !== p_1983)) {
      _t1986 = Ref$set(changed_1978, true);
    } else {
      _t1986 = undefined;
    }
    const _t1984 = _t1986;
    _t1984;
    if (_t1981) break;
  }
  _t1980 = _t1981 ? _t1982 : undefined;
  const _t1979 = _t1980;
  return _t1979;
}
function Lexer$is_digit(c) {
  return ((c >= 48) && (c <= 57));
}
function Lexer$is_hex_digit(c) {
  return (Lexer$is_digit(c) || (((c >= 97) && (c <= 102)) || ((c >= 65) && (c <= 70))));
}
function Lexer$hex_val(c) {
  let _t1987;
  if (((c >= 48) && (c <= 57))) {
    _t1987 = (Byte$to_int(c) - Byte$to_int(48));
  } else {
    let _t1988;
    if (((c >= 97) && (c <= 102))) {
      _t1988 = ((Byte$to_int(c) - Byte$to_int(97)) + 10);
    } else {
      _t1988 = ((Byte$to_int(c) - Byte$to_int(65)) + 10);
    }
    _t1987 = _t1988;
  }
  return _t1987;
}
function Lexer$is_alpha(c) {
  return (((c >= 97) && (c <= 122)) || ((c >= 65) && (c <= 90)));
}
function Lexer$is_ident_start(c) {
  return (Lexer$is_alpha(c) || (c === 95));
}
function Lexer$is_ident_char(c) {
  return (Lexer$is_alpha(c) || (Lexer$is_digit(c) || ((c === 95) || (c === 39))));
}
const Lexer$keywords = ({_hd: ["let", ({_tag: 11, _name: "LET"})], _tl: ({_hd: ["rec", ({_tag: 12, _name: "REC"})], _tl: ({_hd: ["in", ({_tag: 13, _name: "IN"})], _tl: ({_hd: ["if", ({_tag: 14, _name: "IF"})], _tl: ({_hd: ["else", ({_tag: 15, _name: "ELSE"})], _tl: ({_hd: ["fn", ({_tag: 16, _name: "FN"})], _tl: ({_hd: ["match", ({_tag: 17, _name: "MATCH"})], _tl: ({_hd: ["with", ({_tag: 18, _name: "WITH"})], _tl: ({_hd: ["type", ({_tag: 19, _name: "TYPE"})], _tl: ({_hd: ["newtype", ({_tag: 20, _name: "NEWTYPE"})], _tl: ({_hd: ["of", ({_tag: 21, _name: "OF"})], _tl: ({_hd: ["not", ({_tag: 40, _name: "NOT"})], _tl: ({_hd: ["mod", ({_tag: 43, _name: "MOD"})], _tl: ({_hd: ["true", ({_tag: 6, _name: "TRUE"})], _tl: ({_hd: ["false", ({_tag: 7, _name: "FALSE"})], _tl: ({_hd: ["class", ({_tag: 22, _name: "CLASS"})], _tl: ({_hd: ["instance", ({_tag: 23, _name: "INSTANCE"})], _tl: ({_hd: ["effect", ({_tag: 24, _name: "EFFECT"})], _tl: ({_hd: ["extern", ({_tag: 25, _name: "EXTERN"})], _tl: ({_hd: ["perform", ({_tag: 26, _name: "PERFORM"})], _tl: ({_hd: ["handle", ({_tag: 27, _name: "HANDLE"})], _tl: ({_hd: ["try", ({_tag: 28, _name: "TRY"})], _tl: ({_hd: ["provide", ({_tag: 29, _name: "PROVIDE"})], _tl: ({_hd: ["resume", ({_tag: 31, _name: "RESUME"})], _tl: ({_hd: ["return", ({_tag: 32, _name: "RETURN"})], _tl: ({_hd: ["continue", ({_tag: 30, _name: "CONTINUE"})], _tl: ({_hd: ["mut", ({_tag: 33, _name: "MUT"})], _tl: ({_hd: ["for", ({_tag: 34, _name: "FOR"})], _tl: ({_hd: ["do", ({_tag: 35, _name: "DO"})], _tl: ({_hd: ["break", ({_tag: 36, _name: "BREAK"})], _tl: ({_hd: ["when", ({_tag: 37, _name: "WHEN"})], _tl: ({_hd: ["where", ({_tag: 38, _name: "WHERE"})], _tl: ({_hd: ["module", ({_tag: 44, _name: "MODULE"})], _tl: ({_hd: ["pub", ({_tag: 45, _name: "PUB"})], _tl: ({_hd: ["open", ({_tag: 46, _name: "OPEN"})], _tl: ({_hd: ["end", ({_tag: 47, _name: "END"})], _tl: ({_hd: ["opaque", ({_tag: 48, _name: "OPAQUE"})], _tl: ({_hd: ["and", ({_tag: 50, _name: "AND"})], _tl: ({_hd: ["deriving", ({_tag: 51, _name: "DERIVING"})], _tl: ({_hd: ["land", ({_tag: 83, _name: "LAND"})], _tl: ({_hd: ["lor", ({_tag: 84, _name: "LOR"})], _tl: ({_hd: ["lxor", ({_tag: 85, _name: "LXOR"})], _tl: ({_hd: ["lnot", ({_tag: 86, _name: "LNOT"})], _tl: ({_hd: ["lsl", ({_tag: 87, _name: "LSL"})], _tl: ({_hd: ["lsr", ({_tag: 88, _name: "LSR"})], _tl: null})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})});
function Lexer$read_number(l) {
  const loc_1989 = Lexer$current_loc(l);
  const buf_1991 = Buffer$create(16);
  const c_1993 = Lexer$advance(l);
  Buffer$add_byte(buf_1991, c_1993);
  let _t1995;
  if (((c_1993 === 48) && ((!Lexer$at_end(l)) && ((Lexer$peek(l) === 120) || (Lexer$peek(l) === 88))))) {
    Buffer$add_byte(buf_1991, Lexer$advance(l));
    let _t1996 = undefined;
    let _t1997 = false, _t1998;
    while (true) {
      if (!(((!Lexer$at_end(l)) && Lexer$is_hex_digit(Lexer$peek(l))))) break;
      Buffer$add_byte(buf_1991, Lexer$advance(l));
      if (_t1997) break;
    }
    _t1996 = _t1997 ? _t1998 : undefined;
    _t1996;
    const n_1999 = int_of_string(Buffer$contents(buf_1991));
    const _t2000 = Lexer$make_token(l, ({_tag: 0, _name: "INT", _val: n_1999}), loc_1989);
    _t1995 = _t2000;
  } else {
    let _t2001;
    if (((c_1993 === 48) && ((!Lexer$at_end(l)) && ((Lexer$peek(l) === 98) || (Lexer$peek(l) === 66))))) {
      Buffer$add_byte(buf_1991, Lexer$advance(l));
      let _t2002 = undefined;
      let _t2003 = false, _t2004;
      while (true) {
        if (!(((!Lexer$at_end(l)) && ((Lexer$peek(l) === 48) || (Lexer$peek(l) === 49))))) break;
        Buffer$add_byte(buf_1991, Lexer$advance(l));
        if (_t2003) break;
      }
      _t2002 = _t2003 ? _t2004 : undefined;
      _t2002;
      const n_2005 = int_of_string(Buffer$contents(buf_1991));
      const _t2006 = Lexer$make_token(l, ({_tag: 0, _name: "INT", _val: n_2005}), loc_1989);
      _t2001 = _t2006;
    } else {
      let _t2007 = undefined;
      let _t2008 = false, _t2009;
      while (true) {
        if (!(((!Lexer$at_end(l)) && Lexer$is_digit(Lexer$peek(l))))) break;
        Buffer$add_byte(buf_1991, Lexer$advance(l));
        if (_t2008) break;
      }
      _t2007 = _t2008 ? _t2009 : undefined;
      _t2007;
      let _t2010;
      if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 46))) {
        Buffer$add_byte(buf_1991, Lexer$advance(l));
        let _t2011 = undefined;
        let _t2012 = false, _t2013;
        while (true) {
          if (!(((!Lexer$at_end(l)) && Lexer$is_digit(Lexer$peek(l))))) break;
          Buffer$add_byte(buf_1991, Lexer$advance(l));
          if (_t2012) break;
        }
        _t2011 = _t2012 ? _t2013 : undefined;
        _t2011;
        const f_2014 = float_of_string(Buffer$contents(buf_1991));
        const _t2015 = Lexer$make_token(l, ({_tag: 1, _name: "FLOAT", _val: f_2014}), loc_1989);
        _t2010 = _t2015;
      } else {
        const n_2016 = int_of_string(Buffer$contents(buf_1991));
        const _t2017 = Lexer$make_token(l, ({_tag: 0, _name: "INT", _val: n_2016}), loc_1989);
        _t2010 = _t2017;
      }
      _t2001 = _t2010;
    }
    _t1995 = _t2001;
  }
  const _t1994 = _t1995;
  const _t1992 = _t1994;
  const _t1990 = _t1992;
  return _t1990;
}
function Lexer$read_string(l) {
  const loc_2018 = Lexer$current_loc(l);
  Lexer$advance(l);
  undefined;
  const buf_2020 = Buffer$create(64);
  let _t2022 = undefined;
  let _t2023 = false, _t2024;
  while (true) {
    if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 34)))) break;
    let _t2025;
    if ((Lexer$peek(l) === 92)) {
      Lexer$advance(l);
      undefined;
      let _t2026;
      if (Lexer$at_end(l)) {
        _t2026 = Lexer$error(l, "unterminated string");
      } else {
        _t2026 = undefined;
      }
      _t2026;
      const c_2027 = Lexer$advance(l);
      let _t2030;
      const _t2029 = c_2027;
      _t2031: {
        if (true) {
          const _c = _t2029;
          if ((_c === 110)) {
            _t2030 = Buffer$add_byte(buf_2020, 10);
            break _t2031;
          }
        }
        if (true) {
          const _c = _t2029;
          if ((_c === 116)) {
            _t2030 = Buffer$add_byte(buf_2020, 9);
            break _t2031;
          }
        }
        if (true) {
          const _c = _t2029;
          if ((_c === 92)) {
            _t2030 = Buffer$add_byte(buf_2020, 92);
            break _t2031;
          }
        }
        if (true) {
          const _c = _t2029;
          if ((_c === 34)) {
            _t2030 = Buffer$add_byte(buf_2020, 34);
            break _t2031;
          }
        }
        if (true) {
          _t2030 = Lexer$error(l, ("unknown escape: \\" + __dict_Show_byte.show(c_2027)));
          break _t2031;
        }
        _match_fail("line 16933");
      }
      const _t2028 = _t2030;
      _t2025 = _t2028;
    } else {
      _t2025 = Buffer$add_byte(buf_2020, Lexer$advance(l));
    }
    _t2025;
    if (_t2023) break;
  }
  _t2022 = _t2023 ? _t2024 : undefined;
  _t2022;
  let _t2032;
  if (Lexer$at_end(l)) {
    _t2032 = Lexer$error(l, "unterminated string");
  } else {
    _t2032 = undefined;
  }
  _t2032;
  Lexer$advance(l);
  undefined;
  const _t2021 = Lexer$make_token(l, ({_tag: 2, _name: "STRING", _val: Buffer$contents(buf_2020)}), loc_2018);
  const _t2019 = _t2021;
  return _t2019;
}
function Lexer$dedent_raw(s) {
  const lines_2033 = String$split("\n", s);
  let _t2036;
  const _t2035 = lines_2033;
  _t2037: {
    if (_t2035 !== null) {
      const first = _t2035._hd;
      const rest = _t2035._tl;
      if ((String$trim(first) === "")) {
        _t2036 = rest;
        break _t2037;
      }
    }
    if (true) {
      _t2036 = lines_2033;
      break _t2037;
    }
    _match_fail("line 16933");
  }
  const lines_2038 = _t2036;
  let _t2041;
  const _t2040 = List$rev(lines_2038);
  _t2042: {
    if (_t2040 !== null) {
      const last = _t2040._hd;
      const rest = _t2040._tl;
      if ((String$trim(last) === "")) {
        _t2041 = List$rev(rest);
        break _t2042;
      }
    }
    if (true) {
      _t2041 = lines_2038;
      break _t2042;
    }
    _match_fail("line 16933");
  }
  const lines_2043 = _t2041;
  function _t2045(acc, line) {
    let _t2046;
    if ((String$trim(line) === "")) {
      _t2046 = acc;
    } else {
      const len_2047 = String$length(line);
      const i_2049 = Ref$create(0);
      let _t2051 = undefined;
      let _t2052 = false, _t2053;
      while (true) {
        if (!(((Ref$get(i_2049) < len_2047) && ((String$get(line, Ref$get(i_2049)) === 32) || (String$get(line, Ref$get(i_2049)) === 9))))) break;
        Ref$set(i_2049, (Ref$get(i_2049) + 1));
        if (_t2052) break;
      }
      _t2051 = _t2052 ? _t2053 : undefined;
      _t2051;
      let _t2055;
      const _t2054 = acc;
      _t2056: {
        if (_t2054._tag === 0) {
          _t2055 = ({_tag: 1, _name: "Some", _val: Ref$get(i_2049)});
          break _t2056;
        }
        if (_t2054._tag === 1) {
          const prev = _t2054._val;
          _t2055 = ({_tag: 1, _name: "Some", _val: min(prev, Ref$get(i_2049))});
          break _t2056;
        }
        _match_fail("line 16933");
      }
      const _t2050 = _t2055;
      const _t2048 = _t2050;
      _t2046 = _t2048;
    }
    return _t2046;
  }
  const indent_2057 = List$fold(_t2045, ({_tag: 0, _name: "None"}), lines_2043);
  let _t2060;
  const _t2059 = indent_2057;
  _t2061: {
    if (_t2059._tag === 1) {
      const n = _t2059._val;
      _t2060 = n;
      break _t2061;
    }
    if (_t2059._tag === 0) {
      _t2060 = 0;
      break _t2061;
    }
    _match_fail("line 16933");
  }
  const indent_2062 = _t2060;
  function _t2064(line) {
    const len_2065 = String$length(line);
    let _t2067;
    if ((len_2065 >= indent_2062)) {
      _t2067 = String$sub(line, indent_2062, (len_2065 - indent_2062));
    } else {
      _t2067 = line;
    }
    const _t2066 = _t2067;
    return _t2066;
  }
  const lines_2068 = List$map(_t2064, lines_2043);
  const _t2069 = String$concat("\n", lines_2068);
  const _t2063 = _t2069;
  const _t2058 = _t2063;
  const _t2044 = _t2058;
  const _t2039 = _t2044;
  const _t2034 = _t2039;
  return _t2034;
}
function Lexer$read_raw_string(l) {
  const loc_2070 = Lexer$current_loc(l);
  Lexer$advance(l);
  undefined;
  Lexer$advance(l);
  undefined;
  const buf_2072 = Buffer$create(256);
  let _t2074 = undefined;
  let _t2075 = false, _t2076;
  while (true) {
    if (!(((!Lexer$at_end(l)) && (!((Lexer$peek(l) === 124) && (Lexer$peek2(l) === 125)))))) break;
    Buffer$add_byte(buf_2072, Lexer$advance(l));
    if (_t2075) break;
  }
  _t2074 = _t2075 ? _t2076 : undefined;
  _t2074;
  let _t2077;
  if (Lexer$at_end(l)) {
    _t2077 = Lexer$error(l, "unterminated raw string");
  } else {
    _t2077 = undefined;
  }
  _t2077;
  Lexer$advance(l);
  undefined;
  Lexer$advance(l);
  undefined;
  const raw_2078 = Buffer$contents(buf_2072);
  const _t2079 = Lexer$make_token(l, ({_tag: 2, _name: "STRING", _val: Lexer$dedent_raw(raw_2078)}), loc_2070);
  const _t2073 = _t2079;
  const _t2071 = _t2073;
  return _t2071;
}
function Lexer$read_interp_string(l) {
  const loc_2080 = Lexer$current_loc(l);
  Lexer$advance(l);
  undefined;
  Lexer$advance(l);
  undefined;
  const parts_2082 = Ref$create(null);
  const buf_2084 = Buffer$create(64);
  function _t2086(_) {
    let _t2087;
    if ((Buffer$length(buf_2084) > 0)) {
      Ref$set(parts_2082, ({_hd: ({_tag: 0, _name: "IPLit", _val: Buffer$contents(buf_2084)}), _tl: Ref$get(parts_2082)}));
      _t2087 = Buffer$clear(buf_2084);
    } else {
      _t2087 = undefined;
    }
    return _t2087;
  }
  const flush_lit_2088 = _t2086;
  let _t2090 = undefined;
  let _t2091 = false, _t2092;
  while (true) {
    if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 34)))) break;
    let _t2093;
    if ((Lexer$peek(l) === 92)) {
      Lexer$advance(l);
      undefined;
      let _t2094;
      if (Lexer$at_end(l)) {
        _t2094 = Lexer$error(l, "unterminated interpolated string");
      } else {
        _t2094 = undefined;
      }
      _t2094;
      const c_2095 = Lexer$advance(l);
      let _t2098;
      const _t2097 = c_2095;
      _t2099: {
        if (true) {
          const _c = _t2097;
          if ((_c === 110)) {
            _t2098 = Buffer$add_byte(buf_2084, 10);
            break _t2099;
          }
        }
        if (true) {
          const _c = _t2097;
          if ((_c === 116)) {
            _t2098 = Buffer$add_byte(buf_2084, 9);
            break _t2099;
          }
        }
        if (true) {
          const _c = _t2097;
          if ((_c === 92)) {
            _t2098 = Buffer$add_byte(buf_2084, 92);
            break _t2099;
          }
        }
        if (true) {
          const _c = _t2097;
          if ((_c === 34)) {
            _t2098 = Buffer$add_byte(buf_2084, 34);
            break _t2099;
          }
        }
        if (true) {
          const _c = _t2097;
          if ((_c === 123)) {
            _t2098 = Buffer$add_byte(buf_2084, 123);
            break _t2099;
          }
        }
        if (true) {
          const _c = _t2097;
          if ((_c === 125)) {
            _t2098 = Buffer$add_byte(buf_2084, 125);
            break _t2099;
          }
        }
        if (true) {
          _t2098 = Lexer$error(l, ("unknown escape: \\" + __dict_Show_byte.show(c_2095)));
          break _t2099;
        }
        _match_fail("line 16933");
      }
      const _t2096 = _t2098;
      _t2093 = _t2096;
    } else {
      let _t2100;
      if ((Lexer$peek(l) === 123)) {
        flush_lit_2088(undefined);
        Lexer$advance(l);
        undefined;
        const expr_buf_2101 = Buffer$create(64);
        const fmt_buf_2103 = Buffer$create(16);
        const depth_2105 = Ref$create(1);
        const paren_depth_2107 = Ref$create(0);
        const in_fmt_2109 = Ref$create(false);
        let _t2111 = undefined;
        let _t2112 = false, _t2113;
        while (true) {
          if (!((Ref$get(depth_2105) > 0))) break;
          let _t2114;
          if (Lexer$at_end(l)) {
            _t2114 = Lexer$error(l, "unterminated interpolation expression");
          } else {
            _t2114 = undefined;
          }
          _t2114;
          const c_2115 = Lexer$peek(l);
          let _t2117;
          if ((c_2115 === 123)) {
            Ref$set(depth_2105, (Ref$get(depth_2105) + 1));
            let _t2118;
            if (Ref$get(in_fmt_2109)) {
              _t2118 = fmt_buf_2103;
            } else {
              _t2118 = expr_buf_2101;
            }
            _t2117 = Buffer$add_byte(_t2118, Lexer$advance(l));
          } else {
            let _t2119;
            if ((c_2115 === 125)) {
              Ref$set(depth_2105, (Ref$get(depth_2105) - 1));
              let _t2120;
              if ((Ref$get(depth_2105) > 0)) {
                let _t2121;
                if (Ref$get(in_fmt_2109)) {
                  _t2121 = fmt_buf_2103;
                } else {
                  _t2121 = expr_buf_2101;
                }
                _t2120 = Buffer$add_byte(_t2121, Lexer$advance(l));
              } else {
                Lexer$advance(l);
                _t2120 = undefined;
              }
              _t2119 = _t2120;
            } else {
              let _t2122;
              if ((c_2115 === 40)) {
                Ref$set(paren_depth_2107, (Ref$get(paren_depth_2107) + 1));
                let _t2123;
                if (Ref$get(in_fmt_2109)) {
                  _t2123 = fmt_buf_2103;
                } else {
                  _t2123 = expr_buf_2101;
                }
                _t2122 = Buffer$add_byte(_t2123, Lexer$advance(l));
              } else {
                let _t2124;
                if ((c_2115 === 41)) {
                  let _t2125;
                  if ((Ref$get(paren_depth_2107) > 0)) {
                    _t2125 = Ref$set(paren_depth_2107, (Ref$get(paren_depth_2107) - 1));
                  } else {
                    _t2125 = undefined;
                  }
                  _t2125;
                  let _t2126;
                  if (Ref$get(in_fmt_2109)) {
                    _t2126 = fmt_buf_2103;
                  } else {
                    _t2126 = expr_buf_2101;
                  }
                  _t2124 = Buffer$add_byte(_t2126, Lexer$advance(l));
                } else {
                  let _t2127;
                  if (((c_2115 === 58) && ((Ref$get(depth_2105) === 1) && ((Ref$get(paren_depth_2107) === 0) && (!Ref$get(in_fmt_2109)))))) {
                    Lexer$advance(l);
                    undefined;
                    _t2127 = Ref$set(in_fmt_2109, true);
                  } else {
                    let _t2128;
                    if ((c_2115 === 34)) {
                      let _t2129;
                      if (Ref$get(in_fmt_2109)) {
                        _t2129 = fmt_buf_2103;
                      } else {
                        _t2129 = expr_buf_2101;
                      }
                      const buf_2130 = _t2129;
                      Buffer$add_byte(buf_2130, Lexer$advance(l));
                      let _t2132 = undefined;
                      let _t2133 = false, _t2134;
                      while (true) {
                        if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 34)))) break;
                        let _t2135;
                        if ((Lexer$peek(l) === 92)) {
                          Buffer$add_byte(buf_2130, Lexer$advance(l));
                          let _t2136;
                          if ((!Lexer$at_end(l))) {
                            _t2136 = Buffer$add_byte(buf_2130, Lexer$advance(l));
                          } else {
                            _t2136 = undefined;
                          }
                          _t2135 = _t2136;
                        } else {
                          _t2135 = Buffer$add_byte(buf_2130, Lexer$advance(l));
                        }
                        _t2135;
                        if (_t2133) break;
                      }
                      _t2132 = _t2133 ? _t2134 : undefined;
                      _t2132;
                      let _t2137;
                      if ((!Lexer$at_end(l))) {
                        _t2137 = Buffer$add_byte(buf_2130, Lexer$advance(l));
                      } else {
                        _t2137 = undefined;
                      }
                      const _t2131 = _t2137;
                      _t2128 = _t2131;
                    } else {
                      let _t2138;
                      if (Ref$get(in_fmt_2109)) {
                        _t2138 = fmt_buf_2103;
                      } else {
                        _t2138 = expr_buf_2101;
                      }
                      _t2128 = Buffer$add_byte(_t2138, Lexer$advance(l));
                    }
                    _t2127 = _t2128;
                  }
                  _t2124 = _t2127;
                }
                _t2122 = _t2124;
              }
              _t2119 = _t2122;
            }
            _t2117 = _t2119;
          }
          const _t2116 = _t2117;
          _t2116;
          if (_t2112) break;
        }
        _t2111 = _t2112 ? _t2113 : undefined;
        _t2111;
        let _t2139;
        if (Ref$get(in_fmt_2109)) {
          _t2139 = ({_tag: 1, _name: "Some", _val: Buffer$contents(fmt_buf_2103)});
        } else {
          _t2139 = ({_tag: 0, _name: "None"});
        }
        const fmt_2140 = _t2139;
        const _t2141 = Ref$set(parts_2082, ({_hd: ({_tag: 1, _name: "IPExpr", _val: [Buffer$contents(expr_buf_2101), fmt_2140]}), _tl: Ref$get(parts_2082)}));
        const _t2110 = _t2141;
        const _t2108 = _t2110;
        const _t2106 = _t2108;
        const _t2104 = _t2106;
        const _t2102 = _t2104;
        _t2100 = _t2102;
      } else {
        _t2100 = Buffer$add_byte(buf_2084, Lexer$advance(l));
      }
      _t2093 = _t2100;
    }
    _t2093;
    if (_t2091) break;
  }
  _t2090 = _t2091 ? _t2092 : undefined;
  _t2090;
  let _t2142;
  if (Lexer$at_end(l)) {
    _t2142 = Lexer$error(l, "unterminated interpolated string");
  } else {
    _t2142 = undefined;
  }
  _t2142;
  Lexer$advance(l);
  undefined;
  flush_lit_2088(undefined);
  const _t2089 = Lexer$make_token(l, ({_tag: 3, _name: "INTERP_STRING", _val: List$rev(Ref$get(parts_2082))}), loc_2080);
  const _t2085 = _t2089;
  const _t2083 = _t2085;
  const _t2081 = _t2083;
  return _t2081;
}
function Lexer$read_ident_or_keyword(l) {
  const loc_2143 = Lexer$current_loc(l);
  const buf_2145 = Buffer$create(32);
  let _t2147 = undefined;
  let _t2148 = false, _t2149;
  while (true) {
    if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
    Buffer$add_byte(buf_2145, Lexer$advance(l));
    if (_t2148) break;
  }
  _t2147 = _t2148 ? _t2149 : undefined;
  _t2147;
  const s_2150 = Buffer$contents(buf_2145);
  let _t2153;
  const _t2152 = List$assoc_opt(s_2150, Lexer$keywords);
  _t2154: {
    if (_t2152._tag === 1) {
      const kw = _t2152._val;
      _t2153 = kw;
      break _t2154;
    }
    if (_t2152._tag === 0) {
      let _t2155;
      if ((s_2150 === "_")) {
        _t2155 = ({_tag: 67, _name: "UNDERSCORE"});
      } else {
        let _t2156;
        if (((Byte$to_upper(String$get(s_2150, 0)) === String$get(s_2150, 0)) && (String$get(s_2150, 0) !== 95))) {
          _t2156 = ({_tag: 9, _name: "UIDENT", _val: s_2150});
        } else {
          _t2156 = ({_tag: 8, _name: "IDENT", _val: s_2150});
        }
        _t2155 = _t2156;
      }
      _t2153 = _t2155;
      break _t2154;
    }
    _match_fail("line 16933");
  }
  const kind_2157 = _t2153;
  const _t2158 = Lexer$make_token(l, kind_2157, loc_2143);
  const _t2151 = _t2158;
  const _t2146 = _t2151;
  const _t2144 = _t2146;
  return _t2144;
}
function Lexer$next_token(l) {
  while (true) {
    Lexer$skip_whitespace_and_comments(l);
    let _t2159;
    if (Lexer$at_end(l)) {
      _t2159 = Lexer$make_token(l, ({_tag: 92, _name: "EOF"}), Lexer$current_loc(l));
    } else {
      const loc_2160 = Lexer$current_loc(l);
      const c_2162 = Lexer$peek(l);
      let _t2165;
      const _t2164 = c_2162;
      _t2166: {
        if (true) {
          const _c = _t2164;
          if (((_c >= 48) && (_c <= 57))) {
            _t2165 = Lexer$read_number(l);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((((_c === 36) && (!Lexer$at_end(l))) && (Lexer$peek2(l) === 34))) {
            _t2165 = Lexer$read_interp_string(l);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 34)) {
            _t2165 = Lexer$read_string(l);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((((_c === 39) && (Lexer$peek2(l) >= 97)) && ((Lexer$peek2(l) <= 122) && (Lexer$peek3(l) !== 39)))) {
            const loc_2167 = Lexer$current_loc(l);
            Lexer$advance(l);
            undefined;
            const buf_2169 = Buffer$create(8);
            let _t2171 = undefined;
            let _t2172 = false, _t2173;
            while (true) {
              if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
              Buffer$add_byte(buf_2169, Lexer$advance(l));
              if (_t2172) break;
            }
            _t2171 = _t2172 ? _t2173 : undefined;
            _t2171;
            const _t2170 = Lexer$make_token(l, ({_tag: 10, _name: "TYVAR", _val: Buffer$contents(buf_2169)}), loc_2167);
            const _t2168 = _t2170;
            _t2165 = _t2168;
            break _t2166;
          }
        }
        if (true) {
          if (Lexer$is_ident_start(c_2162)) {
            _t2165 = Lexer$read_ident_or_keyword(l);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 39)) {
            const loc_2174 = Lexer$current_loc(l);
            Lexer$advance(l);
            undefined;
            let _t2176;
            if (Lexer$at_end(l)) {
              _t2176 = Lexer$error(l, "unterminated rune literal");
            } else {
              _t2176 = undefined;
            }
            _t2176;
            let _t2177;
            if ((Lexer$peek(l) === 92)) {
              Lexer$advance(l);
              undefined;
              let _t2178;
              if (Lexer$at_end(l)) {
                _t2178 = Lexer$error(l, "unterminated rune escape");
              } else {
                _t2178 = undefined;
              }
              _t2178;
              const c_2179 = Lexer$advance(l);
              let _t2182;
              const _t2181 = c_2179;
              _t2183: {
                if (true) {
                  const _c = _t2181;
                  if ((_c === 110)) {
                    _t2182 = 10;
                    break _t2183;
                  }
                }
                if (true) {
                  const _c = _t2181;
                  if ((_c === 116)) {
                    _t2182 = 9;
                    break _t2183;
                  }
                }
                if (true) {
                  const _c = _t2181;
                  if ((_c === 92)) {
                    _t2182 = 92;
                    break _t2183;
                  }
                }
                if (true) {
                  const _c = _t2181;
                  if ((_c === 39)) {
                    _t2182 = 39;
                    break _t2183;
                  }
                }
                if (true) {
                  const _c = _t2181;
                  if ((_c === 48)) {
                    _t2182 = 0;
                    break _t2183;
                  }
                }
                if (true) {
                  _t2182 = Lexer$error(l, ("unknown rune escape: \\" + __dict_Show_byte.show(c_2179)));
                  break _t2183;
                }
                _match_fail("line 16933");
              }
              const _t2180 = _t2182;
              _t2177 = _t2180;
            } else {
              const b_2184 = Byte$to_int(Lexer$advance(l));
              let _t2186;
              if ((b_2184 < 128)) {
                _t2186 = b_2184;
              } else {
                let _t2187;
                if (((b_2184 & 224) === 192)) {
                  _t2187 = 2;
                } else {
                  let _t2188;
                  if (((b_2184 & 240) === 224)) {
                    _t2188 = 3;
                  } else {
                    let _t2189;
                    if (((b_2184 & 248) === 240)) {
                      _t2189 = 4;
                    } else {
                      _t2189 = Lexer$error(l, "invalid UTF-8 leading byte in rune literal");
                    }
                    _t2188 = _t2189;
                  }
                  _t2187 = _t2188;
                }
                const nbytes_2190 = _t2187;
                const cp_2192 = Ref$create((b_2184 & (255 >> (nbytes_2190 + 1))));
                let _loop_var_2194 = 2;
                let _t2196 = undefined;
                let _t2197 = false, _t2198;
                while (true) {
                  if (!((_loop_var_2194 <= nbytes_2190))) break;
                  let _t2199;
                  if (Lexer$at_end(l)) {
                    _t2199 = Lexer$error(l, "unterminated UTF-8 rune literal");
                  } else {
                    _t2199 = undefined;
                  }
                  _t2199;
                  const cont_2200 = Byte$to_int(Lexer$advance(l));
                  let _t2202;
                  if (((cont_2200 & 192) !== 128)) {
                    _t2202 = Lexer$error(l, "invalid UTF-8 continuation byte");
                  } else {
                    _t2202 = undefined;
                  }
                  _t2202;
                  Ref$set(cp_2192, ((Ref$get(cp_2192) << 6) | (cont_2200 & 63)));
                  const _t2201 = (_loop_var_2194 = (_loop_var_2194 + 1), undefined);
                  _t2201;
                  if (_t2197) break;
                }
                _t2196 = _t2197 ? _t2198 : undefined;
                _t2196;
                const _t2195 = Ref$get(cp_2192);
                const _t2193 = _t2195;
                const _t2191 = _t2193;
                _t2186 = _t2191;
              }
              const _t2185 = _t2186;
              _t2177 = _t2185;
            }
            const cp_2203 = _t2177;
            let _t2205;
            if ((Lexer$at_end(l) || (Lexer$peek(l) !== 39))) {
              _t2205 = Lexer$error(l, "unterminated rune literal");
            } else {
              _t2205 = undefined;
            }
            _t2205;
            Lexer$advance(l);
            undefined;
            const _t2204 = Lexer$make_token(l, ({_tag: 5, _name: "RUNE", _val: cp_2203}), loc_2174);
            const _t2175 = _t2204;
            _t2165 = _t2175;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 40)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 52, _name: "LPAREN"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 41)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 53, _name: "RPAREN"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 35)) {
            Lexer$advance(l);
            undefined;
            let _t2206;
            if (((!Lexer$at_end(l)) && (Lexer$is_hex_digit(Lexer$peek(l)) && (((l.cursor + 1) < l.len) && Lexer$is_hex_digit(Lexer$peek2(l)))))) {
              const c1_2207 = Lexer$peek(l);
              Lexer$advance(l);
              undefined;
              const c2_2209 = Lexer$advance(l);
              const v_2211 = ((Lexer$hex_val(c1_2207) * 16) + Lexer$hex_val(c2_2209));
              const _t2212 = Lexer$make_token(l, ({_tag: 4, _name: "BYTE", _val: v_2211}), loc_2160);
              const _t2210 = _t2212;
              const _t2208 = _t2210;
              _t2206 = _t2208;
            } else {
              _t2206 = Lexer$make_token(l, ({_tag: 41, _name: "HASH"}), loc_2160);
            }
            _t2165 = _t2206;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 123)) {
            let _t2213;
            if ((Lexer$peek2(l) === 124)) {
              _t2213 = Lexer$read_raw_string(l);
            } else {
              Lexer$advance(l);
              undefined;
              _t2213 = Lexer$make_token(l, ({_tag: 54, _name: "LBRACE"}), loc_2160);
            }
            _t2165 = _t2213;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 125)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 55, _name: "RBRACE"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 91)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 56, _name: "LBRACKET"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 93)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 57, _name: "RBRACKET"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 44)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 59, _name: "COMMA"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 46)) {
            Lexer$advance(l);
            undefined;
            let _t2214;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 46))) {
              Lexer$advance(l);
              undefined;
              _t2214 = Lexer$make_token(l, ({_tag: 64, _name: "DOTDOT"}), loc_2160);
            } else {
              _t2214 = Lexer$make_token(l, ({_tag: 63, _name: "DOT"}), loc_2160);
            }
            _t2165 = _t2214;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 94)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 72, _name: "CARET"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 64)) {
            Lexer$advance(l);
            undefined;
            const buf_2215 = Buffer$create(16);
            let _t2217 = undefined;
            let _t2218 = false, _t2219;
            while (true) {
              let _t2222;
              if ((!Lexer$at_end(l))) {
              const c_2220 = Lexer$peek(l);
              const _t2221 = (((c_2220 >= 97) && (c_2220 <= 122)) || (c_2220 === 95));
                _t2222 = _t2221;
              } else {
                _t2222 = false;
              }
              if (!(_t2222)) break;
              Buffer$add_byte(buf_2215, Lexer$advance(l));
              if (_t2218) break;
            }
            _t2217 = _t2218 ? _t2219 : undefined;
            _t2217;
            const name_2223 = Buffer$contents(buf_2215);
            let _t2225;
            if ((name_2223 === "partial")) {
              _t2225 = Lexer$make_token(l, ({_tag: 39, _name: "PARTIAL"}), loc_2160);
            } else {
              _t2225 = Lexer$error(l, ("unknown annotation @" + __dict_Show_string.show(name_2223)));
            }
            const _t2224 = _t2225;
            const _t2216 = _t2224;
            _t2165 = _t2216;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 43)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 68, _name: "PLUS"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 42)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 70, _name: "STAR"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 47)) {
            Lexer$advance(l);
            undefined;
            _t2165 = Lexer$make_token(l, ({_tag: 71, _name: "SLASH"}), loc_2160);
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 45)) {
            Lexer$advance(l);
            undefined;
            let _t2226;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 45))) {
              Lexer$advance(l);
              undefined;
              let _t2227 = undefined;
              let _t2228 = false, _t2229;
              while (true) {
                if (!(((!Lexer$at_end(l)) && (Lexer$peek(l) !== 10)))) break;
                Lexer$advance(l);
                undefined;
                if (_t2228) break;
              }
              _t2227 = _t2228 ? _t2229 : undefined;
              _t2227;
              const _t2230 = l;
              l = _t2230;
              continue;
              _t2226 = undefined;
            } else {
              let _t2231;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                Lexer$advance(l);
                undefined;
                _t2231 = Lexer$make_token(l, ({_tag: 58, _name: "ARROW"}), loc_2160);
              } else {
                _t2231 = Lexer$make_token(l, ({_tag: 69, _name: "MINUS"}), loc_2160);
              }
              _t2226 = _t2231;
            }
            _t2165 = _t2226;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 59)) {
            Lexer$advance(l);
            undefined;
            let _t2232;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 59))) {
              Lexer$advance(l);
              undefined;
              _t2232 = Lexer$make_token(l, ({_tag: 61, _name: "DOUBLE_SEMICOLON"}), loc_2160);
            } else {
              _t2232 = Lexer$make_token(l, ({_tag: 60, _name: "SEMICOLON"}), loc_2160);
            }
            _t2165 = _t2232;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 58)) {
            Lexer$advance(l);
            undefined;
            let _t2233;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 61))) {
              Lexer$advance(l);
              undefined;
              _t2233 = Lexer$make_token(l, ({_tag: 74, _name: "COLONEQUAL"}), loc_2160);
            } else {
              let _t2234;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 58))) {
                Lexer$advance(l);
                undefined;
                _t2234 = Lexer$make_token(l, ({_tag: 73, _name: "COLONCOLON"}), loc_2160);
              } else {
                let _t2235;
                if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                  Lexer$advance(l);
                  undefined;
                  _t2235 = Lexer$make_token(l, ({_tag: 91, _name: "COLONGT"}), loc_2160);
                } else {
                  _t2235 = Lexer$make_token(l, ({_tag: 62, _name: "COLON"}), loc_2160);
                }
                _t2234 = _t2235;
              }
              _t2233 = _t2234;
            }
            _t2165 = _t2233;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 61)) {
            Lexer$advance(l);
            undefined;
            let _t2236;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
              Lexer$advance(l);
              undefined;
              _t2236 = Lexer$make_token(l, ({_tag: 42, _name: "FATARROW"}), loc_2160);
            } else {
              _t2236 = Lexer$make_token(l, ({_tag: 75, _name: "EQ"}), loc_2160);
            }
            _t2165 = _t2236;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 60)) {
            Lexer$advance(l);
            undefined;
            let _t2237;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 61))) {
              Lexer$advance(l);
              undefined;
              _t2237 = Lexer$make_token(l, ({_tag: 79, _name: "LE"}), loc_2160);
            } else {
              let _t2238;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                Lexer$advance(l);
                undefined;
                _t2238 = Lexer$make_token(l, ({_tag: 76, _name: "NEQ"}), loc_2160);
              } else {
                _t2238 = Lexer$make_token(l, ({_tag: 77, _name: "LT"}), loc_2160);
              }
              _t2237 = _t2238;
            }
            _t2165 = _t2237;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 62)) {
            Lexer$advance(l);
            undefined;
            let _t2239;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 61))) {
              Lexer$advance(l);
              undefined;
              _t2239 = Lexer$make_token(l, ({_tag: 80, _name: "GE"}), loc_2160);
            } else {
              _t2239 = Lexer$make_token(l, ({_tag: 78, _name: "GT"}), loc_2160);
            }
            _t2165 = _t2239;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 38)) {
            Lexer$advance(l);
            undefined;
            let _t2240;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 38))) {
              Lexer$advance(l);
              undefined;
              _t2240 = Lexer$make_token(l, ({_tag: 81, _name: "AMPAMP"}), loc_2160);
            } else {
              _t2240 = Lexer$error(l, "unexpected '&', did you mean '&&'?");
            }
            _t2165 = _t2240;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 124)) {
            Lexer$advance(l);
            undefined;
            let _t2241;
            if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 124))) {
              Lexer$advance(l);
              undefined;
              _t2241 = Lexer$make_token(l, ({_tag: 82, _name: "PIPEPIPE"}), loc_2160);
            } else {
              let _t2242;
              if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 62))) {
                Lexer$advance(l);
                undefined;
                _t2242 = Lexer$make_token(l, ({_tag: 66, _name: "PIPEARROW"}), loc_2160);
              } else {
                _t2242 = Lexer$make_token(l, ({_tag: 65, _name: "PIPE"}), loc_2160);
              }
              _t2241 = _t2242;
            }
            _t2165 = _t2241;
            break _t2166;
          }
        }
        if (true) {
          const _c = _t2164;
          if ((_c === 96)) {
            Lexer$advance(l);
            undefined;
            let _t2243;
            if (((!Lexer$at_end(l)) && ((Lexer$peek(l) >= 65) && (Lexer$peek(l) <= 90)))) {
              const buf_2244 = Buffer$create(16);
              let _t2246 = undefined;
              let _t2247 = false, _t2248;
              while (true) {
                if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
                Buffer$add_byte(buf_2244, Lexer$advance(l));
                if (_t2247) break;
              }
              _t2246 = _t2247 ? _t2248 : undefined;
              _t2246;
              const _t2245 = Lexer$make_token(l, ({_tag: 89, _name: "POLYTAG", _val: Buffer$contents(buf_2244)}), loc_2160);
              _t2243 = _t2245;
            } else {
              let _t2249;
              if (((!Lexer$at_end(l)) && (((Lexer$peek(l) >= 97) && (Lexer$peek(l) <= 122)) || (Lexer$peek(l) === 95)))) {
                const buf_2250 = Buffer$create(16);
                let _t2252 = undefined;
                let _t2253 = false, _t2254;
                while (true) {
                  if (!(((!Lexer$at_end(l)) && Lexer$is_ident_char(Lexer$peek(l))))) break;
                  Buffer$add_byte(buf_2250, Lexer$advance(l));
                  if (_t2253) break;
                }
                _t2252 = _t2253 ? _t2254 : undefined;
                _t2252;
                let _t2255;
                if (((!Lexer$at_end(l)) && (Lexer$peek(l) === 96))) {
                  Lexer$advance(l);
                  _t2255 = undefined;
                } else {
                  _t2255 = Lexer$error(l, "expected closing backtick for infix operator");
                }
                _t2255;
                const _t2251 = Lexer$make_token(l, ({_tag: 90, _name: "BACKTICK_INFIX", _val: Buffer$contents(buf_2250)}), loc_2160);
                _t2249 = _t2251;
              } else {
                _t2249 = Lexer$error(l, "expected identifier after backtick");
              }
              _t2243 = _t2249;
            }
            _t2165 = _t2243;
            break _t2166;
          }
        }
        if (true) {
          _t2165 = Lexer$error(l, ("unexpected character: " + __dict_Show_byte.show(c_2162)));
          break _t2166;
        }
        _match_fail("line 16933");
      }
      const _t2163 = _t2165;
      const _t2161 = _t2163;
      _t2159 = _t2161;
    }
    return _t2159;
  }
}
function Lexer$tokenize(source) {
  const l_2256 = Lexer$create(source);
  const tokens_2258 = Ref$create(null);
  const stop_2260 = Ref$create(false);
  let _t2262 = undefined;
  let _t2263 = false, _t2264;
  while (true) {
    if (!((!Ref$get(stop_2260)))) break;
    const tok_2265 = Lexer$next_token(l_2256);
    Ref$set(tokens_2258, ({_hd: tok_2265, _tl: Ref$get(tokens_2258)}));
    let _t2267;
    if (_eq(tok_2265.kind, ({_tag: 92, _name: "EOF"}))) {
      _t2267 = Ref$set(stop_2260, true);
    } else {
      _t2267 = undefined;
    }
    const _t2266 = _t2267;
    _t2266;
    if (_t2263) break;
  }
  _t2262 = _t2263 ? _t2264 : undefined;
  _t2262;
  const _t2261 = List$rev(Ref$get(tokens_2258));
  const _t2259 = _t2261;
  const _t2257 = _t2259;
  return _t2257;
}
function Parser$create(tokens) {
  return ({pos: 0, tokens: Array$of_list(tokens)});
}
function Parser$peek(p) {
  return Array$get(p.tokens, p.pos);
}
function Parser$peek_kind(p) {
  return Parser$peek(p).kind;
}
function Parser$peek_kind_at(p, offset) {
  const idx_2268 = (p.pos + offset);
  let _t2270;
  if ((idx_2268 < Array$length(p.tokens))) {
    _t2270 = Array$get(p.tokens, idx_2268).kind;
  } else {
    _t2270 = ({_tag: 92, _name: "EOF"});
  }
  const _t2269 = _t2270;
  return _t2269;
}
function Parser$advance(p) {
  const tok_2271 = Array$get(p.tokens, p.pos);
  let _t2273;
  if (!_eq(tok_2271.kind, ({_tag: 92, _name: "EOF"}))) {
    _t2273 = (p.pos = (p.pos + 1), undefined);
  } else {
    _t2273 = undefined;
  }
  _t2273;
  const _t2272 = tok_2271;
  return _t2272;
}
function Parser$error(p, msg) {
  return _trampoline(function() {
    const tok_2274 = _resolve(Parser$peek(p));
    return _h["parse_error"]([msg, tok_2274.loc], function(_t2275) {
      return _bounce(function() {
        return _t2275;
      });
    });
  }, Parser$error);
}
function Parser$expect(p, kind) {
  const tok_2276 = Parser$peek(p);
  let _t2278;
  if (_eq(tok_2276.kind, kind)) {
    Parser$advance(p);
    _t2278 = undefined;
  } else {
    _t2278 = Parser$error(p, ((("expected " + __dict_Show_string.show(Token$pp_token_kind(kind))) + ", got ") + __dict_Show_string.show(Token$pp_token_kind(tok_2276.kind))));
  }
  const _t2277 = _t2278;
  return _t2277;
}
function Parser$expect_ident(p) {
  let _t2280;
  const _t2279 = Parser$peek(p).kind;
  _t2281: {
    if (_t2279._tag === 8) {
      const s = _t2279._val;
      Parser$advance(p);
      undefined;
      _t2280 = s;
      break _t2281;
    }
    if (_t2279._tag === 67) {
      Parser$advance(p);
      undefined;
      _t2280 = "_";
      break _t2281;
    }
    if (true) {
      _t2280 = Parser$error(p, "expected identifier");
      break _t2281;
    }
    _match_fail("line 16933");
  }
  return _t2280;
}
function Parser$expect_uident(p) {
  let _t2283;
  const _t2282 = Parser$peek(p).kind;
  _t2284: {
    if (_t2282._tag === 9) {
      const s = _t2282._val;
      Parser$advance(p);
      undefined;
      _t2283 = s;
      break _t2284;
    }
    if (true) {
      _t2283 = Parser$error(p, "expected constructor name");
      break _t2284;
    }
    _match_fail("line 16933");
  }
  return _t2283;
}
function Parser$keyword_as_ident(__x) {
  let _t2286;
  const _t2285 = __x;
  _t2287: {
    if (_t2285._tag === 43) {
      _t2286 = ({_tag: 1, _name: "Some", _val: "mod"});
      break _t2287;
    }
    if (_t2285._tag === 40) {
      _t2286 = ({_tag: 1, _name: "Some", _val: "not"});
      break _t2287;
    }
    if (_t2285._tag === 83) {
      _t2286 = ({_tag: 1, _name: "Some", _val: "land"});
      break _t2287;
    }
    if (_t2285._tag === 84) {
      _t2286 = ({_tag: 1, _name: "Some", _val: "lor"});
      break _t2287;
    }
    if (_t2285._tag === 85) {
      _t2286 = ({_tag: 1, _name: "Some", _val: "lxor"});
      break _t2287;
    }
    if (_t2285._tag === 86) {
      _t2286 = ({_tag: 1, _name: "Some", _val: "lnot"});
      break _t2287;
    }
    if (_t2285._tag === 87) {
      _t2286 = ({_tag: 1, _name: "Some", _val: "lsl"});
      break _t2287;
    }
    if (_t2285._tag === 88) {
      _t2286 = ({_tag: 1, _name: "Some", _val: "lsr"});
      break _t2287;
    }
    if (true) {
      _t2286 = ({_tag: 0, _name: "None"});
      break _t2287;
    }
    _match_fail("line 16933");
  }
  return _t2286;
}
function Parser$token_to_op_name(__x) {
  let _t2289;
  const _t2288 = __x;
  _t2290: {
    if (_t2288._tag === 68) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "+"});
      break _t2290;
    }
    if (_t2288._tag === 69) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "-"});
      break _t2290;
    }
    if (_t2288._tag === 70) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "*"});
      break _t2290;
    }
    if (_t2288._tag === 71) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "/"});
      break _t2290;
    }
    if (_t2288._tag === 43) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "mod"});
      break _t2290;
    }
    if (_t2288._tag === 72) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "^"});
      break _t2290;
    }
    if (_t2288._tag === 81) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "&&"});
      break _t2290;
    }
    if (_t2288._tag === 82) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "||"});
      break _t2290;
    }
    if (_t2288._tag === 40) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "not"});
      break _t2290;
    }
    if (_t2288._tag === 77) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "<"});
      break _t2290;
    }
    if (_t2288._tag === 78) {
      _t2289 = ({_tag: 1, _name: "Some", _val: ">"});
      break _t2290;
    }
    if (_t2288._tag === 79) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "<="});
      break _t2290;
    }
    if (_t2288._tag === 80) {
      _t2289 = ({_tag: 1, _name: "Some", _val: ">="});
      break _t2290;
    }
    if (_t2288._tag === 75) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "="});
      break _t2290;
    }
    if (_t2288._tag === 76) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "<>"});
      break _t2290;
    }
    if (_t2288._tag === 83) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "land"});
      break _t2290;
    }
    if (_t2288._tag === 84) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "lor"});
      break _t2290;
    }
    if (_t2288._tag === 85) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "lxor"});
      break _t2290;
    }
    if (_t2288._tag === 86) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "lnot"});
      break _t2290;
    }
    if (_t2288._tag === 87) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "lsl"});
      break _t2290;
    }
    if (_t2288._tag === 88) {
      _t2289 = ({_tag: 1, _name: "Some", _val: "lsr"});
      break _t2290;
    }
    if (true) {
      _t2289 = ({_tag: 0, _name: "None"});
      break _t2290;
    }
    _match_fail("line 16933");
  }
  return _t2289;
}
function Parser$read_qualified_path(p, first_uident) {
  const path_2291 = Ref$create(({_hd: first_uident, _tl: null}));
  const result_2293 = Ref$create(({_tag: 0, _name: "None"}));
  const continue__2295 = Ref$create(true);
  let _t2297 = undefined;
  let _t2298 = false, _t2299;
  while (true) {
    if (!(Ref$get(continue__2295))) break;
    let _t2300;
    if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
      const next_2301 = Parser$peek_kind_at(p, 1);
      let _t2304;
      const _t2303 = next_2301;
      _t2305: {
        if (_t2303._tag === 8) {
          const s = _t2303._val;
          Parser$advance(p);
          undefined;
          Parser$advance(p);
          undefined;
          const qualified_2306 = (String$concat(".", List$rev(Ref$get(path_2291))) + ("." + s));
          Ref$set(result_2293, ({_tag: 1, _name: "Some", _val: ({_tag: 958595272, _name: "`Var", _val: qualified_2306})}));
          const _t2307 = Ref$set(continue__2295, false);
          _t2304 = _t2307;
          break _t2305;
        }
        if (_t2303._tag === 9) {
          const s = _t2303._val;
          Parser$advance(p);
          undefined;
          Parser$advance(p);
          undefined;
          _t2304 = Ref$set(path_2291, ({_hd: s, _tl: Ref$get(path_2291)}));
          break _t2305;
        }
        if (_t2303._tag === 52) {
          let _t2309;
          const _t2308 = Parser$token_to_op_name(Parser$peek_kind_at(p, 2));
          _t2310: {
            if (_t2308._tag === 1) {
              const op = _t2308._val;
              if (_eq(Parser$peek_kind_at(p, 3), ({_tag: 53, _name: "RPAREN"}))) {
                Parser$advance(p);
                undefined;
                Parser$advance(p);
                undefined;
                Parser$advance(p);
                undefined;
                Parser$advance(p);
                undefined;
                const qualified_2311 = (String$concat(".", List$rev(Ref$get(path_2291))) + ("." + op));
                Ref$set(result_2293, ({_tag: 1, _name: "Some", _val: ({_tag: 958595272, _name: "`Var", _val: qualified_2311})}));
                const _t2312 = Ref$set(continue__2295, false);
                _t2309 = _t2312;
                break _t2310;
              }
            }
            if (true) {
              Parser$advance(p);
              undefined;
              const mod_path_2313 = String$concat(".", List$rev(Ref$get(path_2291)));
              Ref$set(result_2293, ({_tag: 1, _name: "Some", _val: ({_tag: 982234060, _name: "`LocalOpen", _val: mod_path_2313})}));
              const _t2314 = Ref$set(continue__2295, false);
              _t2309 = _t2314;
              break _t2310;
            }
            _match_fail("line 16933");
          }
          _t2304 = _t2309;
          break _t2305;
        }
        if (true) {
          const kw = _t2303;
          let _t2316;
          const _t2315 = Parser$keyword_as_ident(kw);
          _t2317: {
            if (_t2315._tag === 1) {
              const s = _t2315._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              const qualified_2318 = (String$concat(".", List$rev(Ref$get(path_2291))) + ("." + s));
              Ref$set(result_2293, ({_tag: 1, _name: "Some", _val: ({_tag: 958595272, _name: "`Var", _val: qualified_2318})}));
              const _t2319 = Ref$set(continue__2295, false);
              _t2316 = _t2319;
              break _t2317;
            }
            if (_t2315._tag === 0) {
              _t2316 = Ref$set(continue__2295, false);
              break _t2317;
            }
            _match_fail("line 16933");
          }
          _t2304 = _t2316;
          break _t2305;
        }
        _match_fail("line 16933");
      }
      const _t2302 = _t2304;
      _t2300 = _t2302;
    } else {
      _t2300 = Ref$set(continue__2295, false);
    }
    _t2300;
    if (_t2298) break;
  }
  _t2297 = _t2298 ? _t2299 : undefined;
  _t2297;
  let _t2321;
  const _t2320 = Ref$get(result_2293);
  _t2322: {
    if (_t2320._tag === 1) {
      const r = _t2320._val;
      _t2321 = r;
      break _t2322;
    }
    if (_t2320._tag === 0) {
      let _t2324;
      const _t2323 = Ref$get(path_2291);
      _t2325: {
        if (_t2323 !== null && _t2323._tl === null) {
          const single = _t2323._hd;
          _t2324 = ({_tag: 1067578635, _name: "`Constructor", _val: single});
          break _t2325;
        }
        if (true) {
          const rev_2326 = List$rev(Ref$get(path_2291));
          const last_2328 = List$hd(List$rev(rev_2326));
          const prefix_2330 = List$rev(List$tl(List$rev(rev_2326)));
          const qualified_2332 = (String$concat(".", prefix_2330) + ("." + last_2328));
          const _t2333 = ({_tag: 1067578635, _name: "`Constructor", _val: qualified_2332});
          const _t2331 = _t2333;
          const _t2329 = _t2331;
          const _t2327 = _t2329;
          _t2324 = _t2327;
          break _t2325;
        }
        _match_fail("line 16933");
      }
      _t2321 = _t2324;
      break _t2322;
    }
    _match_fail("line 16933");
  }
  const _t2296 = _t2321;
  const _t2294 = _t2296;
  const _t2292 = _t2294;
  return _t2292;
}
function Parser$at_expr_start(p) {
  let _t2335;
  const _t2334 = Parser$peek_kind(p);
  _t2336: {
    if ((((((((((((((((((((((((((((((((_t2334._tag === 0 || _t2334._tag === 1) || _t2334._tag === 2) || _t2334._tag === 3) || _t2334._tag === 4) || _t2334._tag === 5) || _t2334._tag === 6) || _t2334._tag === 7) || _t2334._tag === 8) || _t2334._tag === 9) || _t2334._tag === 52) || _t2334._tag === 54) || _t2334._tag === 56) || _t2334._tag === 16) || _t2334._tag === 14) || _t2334._tag === 11) || _t2334._tag === 17) || _t2334._tag === 69) || _t2334._tag === 40) || _t2334._tag === 86) || _t2334._tag === 26) || _t2334._tag === 27) || _t2334._tag === 28) || _t2334._tag === 29) || _t2334._tag === 31) || _t2334._tag === 34) || _t2334._tag === 36) || _t2334._tag === 30) || _t2334._tag === 32) || _t2334._tag === 41) || _t2334._tag === 35) || _t2334._tag === 89)) {
      _t2335 = true;
      break _t2336;
    }
    if (true) {
      _t2335 = false;
      break _t2336;
    }
    _match_fail("line 16933");
  }
  return _t2335;
}
function Parser$parse_ty_atom(p) {
  let _t2338;
  const _t2337 = Parser$peek_kind(p);
  _t2339: {
    if (_t2337._tag === 8 && _t2337._val === "int") {
      Parser$advance(p);
      undefined;
      _t2338 = ({_tag: 0, _name: "TyName", _val: "int"});
      break _t2339;
    }
    if (_t2337._tag === 8 && _t2337._val === "bool") {
      Parser$advance(p);
      undefined;
      _t2338 = ({_tag: 0, _name: "TyName", _val: "bool"});
      break _t2339;
    }
    if (_t2337._tag === 8 && _t2337._val === "string") {
      Parser$advance(p);
      undefined;
      _t2338 = ({_tag: 0, _name: "TyName", _val: "string"});
      break _t2339;
    }
    if (_t2337._tag === 8 && _t2337._val === "unit") {
      Parser$advance(p);
      undefined;
      _t2338 = ({_tag: 0, _name: "TyName", _val: "unit"});
      break _t2339;
    }
    if (_t2337._tag === 8) {
      const s = _t2337._val;
      Parser$advance(p);
      undefined;
      _t2338 = ({_tag: 0, _name: "TyName", _val: s});
      break _t2339;
    }
    if (_t2337._tag === 9) {
      const s = _t2337._val;
      Parser$advance(p);
      undefined;
      const mod_parts_2340 = Ref$create(({_hd: s, _tl: null}));
      const final_name_2342 = Ref$create(({_tag: 0, _name: "None"}));
      const continue_reading_2344 = Ref$create(true);
      let _t2346 = undefined;
      let _t2347 = false, _t2348;
      while (true) {
        if (!(Ref$get(continue_reading_2344))) break;
        let _t2349;
        if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
          let _t2351;
          const _t2350 = Parser$peek_kind_at(p, 1);
          _t2352: {
            if (_t2350._tag === 9) {
              const s2 = _t2350._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2351 = Ref$set(mod_parts_2340, ({_hd: s2, _tl: Ref$get(mod_parts_2340)}));
              break _t2352;
            }
            if (_t2350._tag === 8) {
              const s2 = _t2350._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              Ref$set(final_name_2342, ({_tag: 1, _name: "Some", _val: s2}));
              _t2351 = Ref$set(continue_reading_2344, false);
              break _t2352;
            }
            if (true) {
              _t2351 = Ref$set(continue_reading_2344, false);
              break _t2352;
            }
            _match_fail("line 16933");
          }
          _t2349 = _t2351;
        } else {
          _t2349 = Ref$set(continue_reading_2344, false);
        }
        _t2349;
        if (_t2347) break;
      }
      _t2346 = _t2347 ? _t2348 : undefined;
      _t2346;
      let _t2354;
      const _t2353 = Ref$get(final_name_2342);
      _t2355: {
        if (_t2353._tag === 1) {
          const name = _t2353._val;
          _t2354 = ({_tag: 8, _name: "TyQualified", _val: [List$rev(Ref$get(mod_parts_2340)), name]});
          break _t2355;
        }
        if (_t2353._tag === 0) {
          _t2354 = ({_tag: 0, _name: "TyName", _val: s});
          break _t2355;
        }
        _match_fail("line 16933");
      }
      const _t2345 = _t2354;
      const _t2343 = _t2345;
      const _t2341 = _t2343;
      _t2338 = _t2341;
      break _t2339;
    }
    if (_t2337._tag === 10) {
      const s = _t2337._val;
      Parser$advance(p);
      undefined;
      _t2338 = ({_tag: 1, _name: "TyVar", _val: s});
      break _t2339;
    }
    if (_t2337._tag === 52) {
      Parser$advance(p);
      undefined;
      const ty_2356 = Parser$parse_ty(p);
      let _t2358;
      if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
        const parts_2359 = Ref$create(({_hd: ty_2356, _tl: null}));
        let _t2361 = undefined;
        let _t2362 = false, _t2363;
        while (true) {
          if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"})))) break;
          Parser$advance(p);
          undefined;
          Ref$set(parts_2359, ({_hd: Parser$parse_ty(p), _tl: Ref$get(parts_2359)}));
          if (_t2362) break;
        }
        _t2361 = _t2362 ? _t2363 : undefined;
        _t2361;
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        const _t2360 = ({_tag: 6, _name: "TyTuple", _val: List$rev(Ref$get(parts_2359))});
        _t2358 = _t2360;
      } else {
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        _t2358 = ty_2356;
      }
      const _t2357 = _t2358;
      _t2338 = _t2357;
      break _t2339;
    }
    if (_t2337._tag === 54) {
      Parser$advance(p);
      undefined;
      let _t2365;
      const _t2364 = Parser$parse_ty_record_fields(p);
      _t2366: {
        if (true) {
          const fields = _t2364[0];
          const is_open = _t2364[1];
          Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
          function _t2367(__p59) {
            let _t2369;
            const _t2368 = __p59;
            _t2370: {
              if (true) {
                const n = _t2368[1];
                const t = _t2368[2];
                _t2369 = [n, t];
                break _t2370;
              }
              _match_fail("line 16933");
            }
            return _t2369;
          }
          _t2365 = ({_tag: 3, _name: "TyRecord", _val: [List$map(_t2367, fields), is_open]});
          break _t2366;
        }
        _match_fail("line 16933");
      }
      _t2338 = _t2365;
      break _t2339;
    }
    if (_t2337._tag === 56) {
      Parser$advance(p);
      undefined;
      let _t2372;
      const _t2371 = Parser$peek_kind(p);
      _t2373: {
        if (_t2371._tag === 78) {
          Parser$advance(p);
          undefined;
          _t2372 = ({_tag: 1, _name: "PVLower"});
          break _t2373;
        }
        if (_t2371._tag === 77) {
          Parser$advance(p);
          undefined;
          _t2372 = ({_tag: 2, _name: "PVUpper"});
          break _t2373;
        }
        if (true) {
          _t2372 = ({_tag: 0, _name: "PVExact"});
          break _t2373;
        }
        _match_fail("line 16933");
      }
      const kind_2374 = _t2372;
      let _t2376;
      if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
        Parser$advance(p);
        _t2376 = undefined;
      } else {
        _t2376 = undefined;
      }
      _t2376;
      const tags_2377 = Ref$create(null);
      let _t2379 = undefined;
      let _t2380 = false, _t2381;
      while (true) {
        let _t2383;
        const _t2382 = Parser$peek_kind(p);
        _t2384: {
          if (_t2382._tag === 89) {
            _t2383 = true;
            break _t2384;
          }
          if (true) {
            _t2383 = false;
            break _t2384;
          }
          _match_fail("line 16933");
        }
        if (!(_t2383)) break;
        let _t2386;
        const _t2385 = Parser$advance(p).kind;
        _t2387: {
          if (_t2385._tag === 89) {
            const s = _t2385._val;
            _t2386 = s;
            break _t2387;
          }
          if (true) {
            _t2386 = failwith("assert false");
            break _t2387;
          }
          _match_fail("line 16933");
        }
        const tag_2388 = _t2386;
        let _t2390;
        if (_eq(Parser$peek_kind(p), ({_tag: 21, _name: "OF"}))) {
          Parser$advance(p);
          undefined;
          _t2390 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
        } else {
          _t2390 = ({_tag: 0, _name: "None"});
        }
        const payload_2391 = _t2390;
        Ref$set(tags_2377, ({_hd: [tag_2388, payload_2391], _tl: Ref$get(tags_2377)}));
        let _t2393;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t2393 = undefined;
        } else {
          _t2393 = undefined;
        }
        const _t2392 = _t2393;
        const _t2389 = _t2392;
        _t2389;
        if (_t2380) break;
      }
      _t2379 = _t2380 ? _t2381 : undefined;
      _t2379;
      Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
      const _t2378 = ({_tag: 9, _name: "TyPolyVariant", _val: [kind_2374, List$rev(Ref$get(tags_2377))]});
      const _t2375 = _t2378;
      _t2338 = _t2375;
      break _t2339;
    }
    if (true) {
      _t2338 = Parser$error(p, "expected type");
      break _t2339;
    }
    _match_fail("line 16933");
  }
  return _t2338;
}
function Parser$parse_ty_postfix(p) {
  const ty_2394 = Parser$parse_ty_atom(p);
  function loop(ty) {
    while (true) {
      let _t2397;
      const _t2396 = Parser$peek_kind(p);
      _t2398: {
        if (_t2396._tag === 8 && _t2396._val === "list") {
          Parser$advance(p);
          undefined;
          const _t2399 = ({_tag: 4, _name: "TyList", _val: ty});
          ty = _t2399;
          continue;
          _t2397 = undefined;
          break _t2398;
        }
        if (_t2396._tag === 8 && _t2396._val === "array") {
          Parser$advance(p);
          undefined;
          const _t2400 = ({_tag: 5, _name: "TyArray", _val: ty});
          ty = _t2400;
          continue;
          _t2397 = undefined;
          break _t2398;
        }
        if (_t2396._tag === 8) {
          const name = _t2396._val;
          if (!_eq(Parser$peek_kind_at(p, 1), ({_tag: 62, _name: "COLON"}))) {
            Parser$advance(p);
            undefined;
            let _t2402;
            const _t2401 = ty;
            _t2403: {
              if (_t2401._tag === 6) {
                const parts = _t2401._val;
                _t2402 = parts;
                break _t2403;
              }
              if (true) {
                _t2402 = ({_hd: ty, _tl: null});
                break _t2403;
              }
              _match_fail("line 16933");
            }
            const args_2404 = _t2402;
            const _t2406 = ({_tag: 7, _name: "TyApp", _val: [args_2404, name]});
            ty = _t2406;
            continue;
            const _t2405 = undefined;
            _t2397 = _t2405;
            break _t2398;
          }
        }
        if (_t2396._tag === 9) {
          if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 63, _name: "DOT"}))) {
            const mod_parts_2407 = Ref$create(null);
            let _t2410;
            const _t2409 = Parser$advance(p).kind;
            _t2411: {
              if (_t2409._tag === 9) {
                const s = _t2409._val;
                _t2410 = s;
                break _t2411;
              }
              if (true) {
                _t2410 = failwith("assert false");
                break _t2411;
              }
              _match_fail("line 16933");
            }
            const first_mod_2412 = _t2410;
            Ref$set(mod_parts_2407, ({_hd: first_mod_2412, _tl: null}));
            const final_name_2414 = Ref$create("");
            const continue_reading_2416 = Ref$create(true);
            let _t2418 = undefined;
            let _t2419 = false, _t2420;
            while (true) {
              if (!(Ref$get(continue_reading_2416))) break;
              let _t2421;
              if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
                let _t2423;
                const _t2422 = Parser$peek_kind_at(p, 1);
                _t2424: {
                  if (_t2422._tag === 9) {
                    const s2 = _t2422._val;
                    Parser$advance(p);
                    undefined;
                    Parser$advance(p);
                    undefined;
                    _t2423 = Ref$set(mod_parts_2407, ({_hd: s2, _tl: Ref$get(mod_parts_2407)}));
                    break _t2424;
                  }
                  if (_t2422._tag === 8) {
                    const s2 = _t2422._val;
                    Parser$advance(p);
                    undefined;
                    Parser$advance(p);
                    undefined;
                    Ref$set(final_name_2414, s2);
                    _t2423 = Ref$set(continue_reading_2416, false);
                    break _t2424;
                  }
                  if (true) {
                    _t2423 = Ref$set(continue_reading_2416, false);
                    break _t2424;
                  }
                  _match_fail("line 16933");
                }
                _t2421 = _t2423;
              } else {
                _t2421 = Ref$set(continue_reading_2416, false);
              }
              _t2421;
              if (_t2419) break;
            }
            _t2418 = _t2419 ? _t2420 : undefined;
            _t2418;
            let _t2425;
            if ((Ref$get(final_name_2414) === "")) {
              _t2425 = Parser$error(p, "expected Module.typename in type annotation");
            } else {
              const qualified_2426 = (String$concat(".", List$rev(Ref$get(mod_parts_2407))) + ("." + Ref$get(final_name_2414)));
              let _t2429;
              const _t2428 = ty;
              _t2430: {
                if (_t2428._tag === 6) {
                  const parts = _t2428._val;
                  _t2429 = parts;
                  break _t2430;
                }
                if (true) {
                  _t2429 = ({_hd: ty, _tl: null});
                  break _t2430;
                }
                _match_fail("line 16933");
              }
              const args_2431 = _t2429;
              const _t2433 = ({_tag: 7, _name: "TyApp", _val: [args_2431, qualified_2426]});
              ty = _t2433;
              continue;
              const _t2432 = undefined;
              const _t2427 = _t2432;
              _t2425 = _t2427;
            }
            const _t2417 = _t2425;
            const _t2415 = _t2417;
            const _t2413 = _t2415;
            const _t2408 = _t2413;
            _t2397 = _t2408;
            break _t2398;
          }
        }
        if (true) {
          _t2397 = ty;
          break _t2398;
        }
        _match_fail("line 16933");
      }
      return _t2397;
    }
  }
  const _t2434 = loop(ty_2394);
  const _t2395 = _t2434;
  return _t2395;
}
function Parser$parse_ty_tuple(p) {
  const first_2435 = Parser$parse_ty_postfix(p);
  let _t2438;
  const _t2437 = Parser$peek_kind(p);
  _t2439: {
    if (_t2437._tag === 70) {
      const parts_2440 = Ref$create(({_hd: first_2435, _tl: null}));
      let _t2442 = undefined;
      let _t2443 = false, _t2444;
      while (true) {
        if (!(_eq(Parser$peek_kind(p), ({_tag: 70, _name: "STAR"})))) break;
        Parser$advance(p);
        undefined;
        Ref$set(parts_2440, ({_hd: Parser$parse_ty_postfix(p), _tl: Ref$get(parts_2440)}));
        if (_t2443) break;
      }
      _t2442 = _t2443 ? _t2444 : undefined;
      _t2442;
      const _t2441 = ({_tag: 6, _name: "TyTuple", _val: List$rev(Ref$get(parts_2440))});
      _t2438 = _t2441;
      break _t2439;
    }
    if (true) {
      _t2438 = first_2435;
      break _t2439;
    }
    _match_fail("line 16933");
  }
  const _t2436 = _t2438;
  return _t2436;
}
function Parser$parse_ty(p) {
  const left_2445 = Parser$parse_ty_tuple(p);
  let _t2448;
  const _t2447 = Parser$peek_kind(p);
  _t2449: {
    if (_t2447._tag === 58) {
      Parser$advance(p);
      undefined;
      const right_2450 = Parser$parse_ty(p);
      let _t2452;
      if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
        Parser$advance(p);
        undefined;
        let _t2453;
        if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
          Parser$advance(p);
          undefined;
          _t2453 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "EffAnnotPure"})});
        } else {
          _t2453 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)})});
        }
        _t2452 = _t2453;
      } else {
        _t2452 = ({_tag: 0, _name: "None"});
      }
      const eff_2454 = _t2452;
      const _t2455 = ({_tag: 2, _name: "TyArrow", _val: [left_2445, right_2450, eff_2454]});
      const _t2451 = _t2455;
      _t2448 = _t2451;
      break _t2449;
    }
    if (true) {
      _t2448 = left_2445;
      break _t2449;
    }
    _match_fail("line 16933");
  }
  const _t2446 = _t2448;
  return _t2446;
}
function Parser$is_eff_param_start(__x) {
  let _t2457;
  const _t2456 = __x;
  _t2458: {
    if ((((_t2456._tag === 8 || _t2456._tag === 10) || _t2456._tag === 52) || _t2456._tag === 54)) {
      _t2457 = true;
      break _t2458;
    }
    if (true) {
      _t2457 = false;
      break _t2458;
    }
    _match_fail("line 16933");
  }
  return _t2457;
}
function Parser$parse_eff_type_params(p) {
  const params_2459 = Ref$create(null);
  let _t2461 = undefined;
  let _t2462 = false, _t2463;
  while (true) {
    if (!(Parser$is_eff_param_start(Parser$peek_kind(p)))) break;
    Ref$set(params_2459, ({_hd: Parser$parse_ty_atom(p), _tl: Ref$get(params_2459)}));
    if (_t2462) break;
  }
  _t2461 = _t2462 ? _t2463 : undefined;
  _t2461;
  const _t2460 = List$rev(Ref$get(params_2459));
  return _t2460;
}
function Parser$parse_eff_items(p) {
  const items_2464 = Ref$create(null);
  const continue_parsing_2466 = Ref$create(true);
  let _t2468 = undefined;
  let _t2469 = false, _t2470;
  while (true) {
    if (!(Ref$get(continue_parsing_2466))) break;
    let _t2472;
    const _t2471 = Parser$peek_kind(p);
    _t2473: {
      if (_t2471._tag === 9) {
        const name_2474 = Parser$expect_uident(p);
        const params_2476 = Parser$parse_eff_type_params(p);
        Ref$set(items_2464, ({_hd: ({_tag: 0, _name: "EffLabel", _val: [name_2474, params_2476]}), _tl: Ref$get(items_2464)}));
        let _t2478;
        if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
          Parser$advance(p);
          _t2478 = undefined;
        } else {
          _t2478 = Ref$set(continue_parsing_2466, false);
        }
        const _t2477 = _t2478;
        const _t2475 = _t2477;
        _t2472 = _t2475;
        break _t2473;
      }
      if (_t2471._tag === 10) {
        const s = _t2471._val;
        Parser$advance(p);
        undefined;
        Ref$set(items_2464, ({_hd: ({_tag: 1, _name: "EffVar", _val: s}), _tl: Ref$get(items_2464)}));
        let _t2479;
        if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
          Parser$advance(p);
          _t2479 = undefined;
        } else {
          _t2479 = Ref$set(continue_parsing_2466, false);
        }
        _t2472 = _t2479;
        break _t2473;
      }
      if (true) {
        _t2472 = Ref$set(continue_parsing_2466, false);
        break _t2473;
      }
      _match_fail("line 16933");
    }
    _t2472;
    if (_t2469) break;
  }
  _t2468 = _t2469 ? _t2470 : undefined;
  _t2468;
  const _t2467 = List$rev(Ref$get(items_2464));
  const _t2465 = _t2467;
  return _t2465;
}
function Parser$parse_ty_record_fields(p) {
  const fields_2480 = Ref$create(null);
  const is_open_2482 = Ref$create(false);
  const first_2484 = Ref$create(true);
  let _t2486 = undefined;
  let _t2487 = false, _t2488;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
    let _t2489;
    if ((!Ref$get(first_2484))) {
      _t2489 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
    } else {
      _t2489 = undefined;
    }
    _t2489;
    let _t2490;
    if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
      _t2490 = undefined;
    } else {
      let _t2491;
      if (_eq(Parser$peek_kind(p), ({_tag: 64, _name: "DOTDOT"}))) {
        Parser$advance(p);
        undefined;
        _t2491 = Ref$set(is_open_2482, true);
      } else {
        Ref$set(first_2484, false);
        const is_mut_2492 = _eq(Parser$peek_kind(p), ({_tag: 33, _name: "MUT"}));
        let _t2494;
        if (is_mut_2492) {
          Parser$advance(p);
          _t2494 = undefined;
        } else {
          _t2494 = undefined;
        }
        _t2494;
        const name_2495 = Parser$expect_ident(p);
        Parser$expect(p, ({_tag: 62, _name: "COLON"}));
        const ty_2497 = Parser$parse_ty(p);
        const _t2498 = Ref$set(fields_2480, ({_hd: [is_mut_2492, name_2495, ty_2497], _tl: Ref$get(fields_2480)}));
        const _t2496 = _t2498;
        const _t2493 = _t2496;
        _t2491 = _t2493;
      }
      _t2490 = _t2491;
    }
    _t2490;
    if (_t2487) break;
  }
  _t2486 = _t2487 ? _t2488 : undefined;
  _t2486;
  const _t2485 = [List$rev(Ref$get(fields_2480)), Ref$get(is_open_2482)];
  const _t2483 = _t2485;
  const _t2481 = _t2483;
  return _t2481;
}
function Parser$parse_pattern_atom(p) {
  let _t2500;
  const _t2499 = Parser$peek_kind(p);
  _t2501: {
    if (_t2499._tag === 67) {
      Parser$advance(p);
      undefined;
      _t2500 = ({_tag: 0, _name: "PatWild"});
      break _t2501;
    }
    if (_t2499._tag === 0) {
      const n = _t2499._val;
      Parser$advance(p);
      undefined;
      _t2500 = ({_tag: 2, _name: "PatInt", _val: n});
      break _t2501;
    }
    if (_t2499._tag === 1) {
      const f = _t2499._val;
      Parser$advance(p);
      undefined;
      _t2500 = ({_tag: 3, _name: "PatFloat", _val: f});
      break _t2501;
    }
    if (_t2499._tag === 6) {
      Parser$advance(p);
      undefined;
      _t2500 = ({_tag: 4, _name: "PatBool", _val: true});
      break _t2501;
    }
    if (_t2499._tag === 7) {
      Parser$advance(p);
      undefined;
      _t2500 = ({_tag: 4, _name: "PatBool", _val: false});
      break _t2501;
    }
    if (_t2499._tag === 2) {
      const s = _t2499._val;
      Parser$advance(p);
      undefined;
      _t2500 = ({_tag: 5, _name: "PatString", _val: s});
      break _t2501;
    }
    if (_t2499._tag === 8) {
      const s = _t2499._val;
      Parser$advance(p);
      undefined;
      _t2500 = ({_tag: 1, _name: "PatVar", _val: s});
      break _t2501;
    }
    if (_t2499._tag === 9) {
      const s = _t2499._val;
      Parser$advance(p);
      undefined;
      const path_2502 = Ref$create(({_hd: s, _tl: null}));
      const continue_reading_2504 = Ref$create(true);
      let _t2506 = undefined;
      let _t2507 = false, _t2508;
      while (true) {
        if (!(Ref$get(continue_reading_2504))) break;
        let _t2509;
        if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
          let _t2511;
          const _t2510 = Parser$peek_kind_at(p, 1);
          _t2512: {
            if (_t2510._tag === 9) {
              const s2 = _t2510._val;
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t2511 = Ref$set(path_2502, ({_hd: s2, _tl: Ref$get(path_2502)}));
              break _t2512;
            }
            if (true) {
              _t2511 = Ref$set(continue_reading_2504, false);
              break _t2512;
            }
            _match_fail("line 16933");
          }
          _t2509 = _t2511;
        } else {
          _t2509 = Ref$set(continue_reading_2504, false);
        }
        _t2509;
        if (_t2507) break;
      }
      _t2506 = _t2507 ? _t2508 : undefined;
      _t2506;
      let _t2514;
      const _t2513 = Ref$get(path_2502);
      _t2515: {
        if (_t2513 !== null && _t2513._tl === null) {
          const single = _t2513._hd;
          _t2514 = single;
          break _t2515;
        }
        if (true) {
          const rev_path = _t2513;
          const parts_2516 = List$rev(rev_path);
          const _t2517 = String$concat(".", parts_2516);
          _t2514 = _t2517;
          break _t2515;
        }
        _match_fail("line 16933");
      }
      const _t2505 = _t2514;
      const _t2503 = _t2505;
      const ctor_name_2518 = _t2503;
      let _t2520;
      if (Parser$at_pattern_arg_start(p)) {
        _t2520 = ({_tag: 1, _name: "Some", _val: Parser$parse_pattern_atom(p)});
      } else {
        _t2520 = ({_tag: 0, _name: "None"});
      }
      const arg_2521 = _t2520;
      const _t2522 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name_2518, arg_2521]});
      const _t2519 = _t2522;
      _t2500 = _t2519;
      break _t2501;
    }
    if (_t2499._tag === 56) {
      Parser$advance(p);
      undefined;
      let _t2523;
      if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
        Parser$advance(p);
        undefined;
        _t2523 = ({_tag: 9, _name: "PatNil"});
      } else {
        const pats_2524 = Parser$parse_pattern_list_elems(p);
        Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
        function _t2526(pat, acc) {
          return ({_tag: 8, _name: "PatCons", _val: [pat, acc]});
        }
        const _t2525 = List$fold_right(_t2526, pats_2524, ({_tag: 9, _name: "PatNil"}));
        _t2523 = _t2525;
      }
      _t2500 = _t2523;
      break _t2501;
    }
    if (_t2499._tag === 52) {
      Parser$advance(p);
      undefined;
      let _t2527;
      if (_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"}))) {
        Parser$advance(p);
        undefined;
        _t2527 = ({_tag: 6, _name: "PatUnit"});
      } else {
        const pat_2528 = Parser$parse_pattern(p);
        let _t2531;
        const _t2530 = Parser$peek_kind(p);
        _t2532: {
          if (_t2530._tag === 59) {
            const pats_2533 = Ref$create(({_hd: pat_2528, _tl: null}));
            let _t2535 = undefined;
            let _t2536 = false, _t2537;
            while (true) {
              if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"})))) break;
              Parser$advance(p);
              undefined;
              Ref$set(pats_2533, ({_hd: Parser$parse_pattern(p), _tl: Ref$get(pats_2533)}));
              if (_t2536) break;
            }
            _t2535 = _t2536 ? _t2537 : undefined;
            _t2535;
            Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
            const _t2534 = ({_tag: 7, _name: "PatTuple", _val: List$rev(Ref$get(pats_2533))});
            _t2531 = _t2534;
            break _t2532;
          }
          if (_t2530._tag === 62) {
            Parser$advance(p);
            undefined;
            const ty_2538 = Parser$parse_ty(p);
            Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
            const _t2539 = ({_tag: 18, _name: "PatAnnot", _val: [pat_2528, ty_2538]});
            _t2531 = _t2539;
            break _t2532;
          }
          if (true) {
            Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
            _t2531 = pat_2528;
            break _t2532;
          }
          _match_fail("line 16933");
        }
        const _t2529 = _t2531;
        _t2527 = _t2529;
      }
      _t2500 = _t2527;
      break _t2501;
    }
    if (_t2499._tag === 54) {
      Parser$advance(p);
      undefined;
      const fields_2540 = Parser$parse_pattern_record_fields(p);
      Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
      const _t2541 = ({_tag: 11, _name: "PatRecord", _val: fields_2540});
      _t2500 = _t2541;
      break _t2501;
    }
    if (_t2499._tag === 89) {
      const tag = _t2499._val;
      Parser$advance(p);
      undefined;
      let _t2542;
      if (Parser$at_pattern_arg_start(p)) {
        _t2542 = ({_tag: 16, _name: "PatPolyVariant", _val: [tag, ({_tag: 1, _name: "Some", _val: Parser$parse_pattern_atom(p)})]});
      } else {
        _t2542 = ({_tag: 16, _name: "PatPolyVariant", _val: [tag, ({_tag: 0, _name: "None"})]});
      }
      _t2500 = _t2542;
      break _t2501;
    }
    if (_t2499._tag === 72) {
      Parser$advance(p);
      undefined;
      const name_2543 = Parser$expect_ident(p);
      const _t2544 = ({_tag: 17, _name: "PatPin", _val: name_2543});
      _t2500 = _t2544;
      break _t2501;
    }
    if (_t2499._tag === 41) {
      Parser$advance(p);
      undefined;
      let _t2546;
      const _t2545 = Parser$peek_kind(p);
      _t2547: {
        if (_t2545._tag === 56) {
          Parser$advance(p);
          undefined;
          let _t2548;
          if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
            Parser$advance(p);
            undefined;
            _t2548 = ({_tag: 14, _name: "PatArray", _val: null});
          } else {
            const pats_2549 = Parser$parse_pattern_list_elems(p);
            Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
            const _t2550 = ({_tag: 14, _name: "PatArray", _val: pats_2549});
            _t2548 = _t2550;
          }
          _t2546 = _t2548;
          break _t2547;
        }
        if (_t2545._tag === 54) {
          Parser$advance(p);
          undefined;
          let _t2551;
          if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
            Parser$advance(p);
            undefined;
            _t2551 = ({_tag: 15, _name: "PatMap", _val: null});
          } else {
            const entries_2552 = Parser$parse_pattern_map_entries(p);
            Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
            const _t2553 = ({_tag: 15, _name: "PatMap", _val: entries_2552});
            _t2551 = _t2553;
          }
          _t2546 = _t2551;
          break _t2547;
        }
        if (true) {
          _t2546 = Parser$error(p, "expected '[' or '{' after '#' in pattern");
          break _t2547;
        }
        _match_fail("line 16933");
      }
      _t2500 = _t2546;
      break _t2501;
    }
    if (true) {
      _t2500 = Parser$error(p, "expected pattern");
      break _t2501;
    }
    _match_fail("line 16933");
  }
  return _t2500;
}
function Parser$parse_pattern_cons(p) {
  const pat_2554 = Parser$parse_pattern_atom(p);
  let _t2557;
  const _t2556 = Parser$peek_kind(p);
  _t2558: {
    if (_t2556._tag === 73) {
      Parser$advance(p);
      undefined;
      const rest_2559 = Parser$parse_pattern_cons(p);
      const _t2560 = ({_tag: 8, _name: "PatCons", _val: [pat_2554, rest_2559]});
      _t2557 = _t2560;
      break _t2558;
    }
    if (true) {
      _t2557 = pat_2554;
      break _t2558;
    }
    _match_fail("line 16933");
  }
  const _t2555 = _t2557;
  return _t2555;
}
function Parser$parse_pattern_as(p) {
  const pat_2561 = Parser$parse_pattern_cons(p);
  let _t2564;
  const _t2563 = Parser$peek_kind(p);
  _t2565: {
    if (_t2563._tag === 8 && _t2563._val === "as") {
      Parser$advance(p);
      undefined;
      const name_2566 = Parser$expect_ident(p);
      const _t2567 = ({_tag: 12, _name: "PatAs", _val: [pat_2561, name_2566]});
      _t2564 = _t2567;
      break _t2565;
    }
    if (true) {
      _t2564 = pat_2561;
      break _t2565;
    }
    _match_fail("line 16933");
  }
  const _t2562 = _t2564;
  return _t2562;
}
function Parser$parse_pattern(p) {
  const pat_2568 = Ref$create(Parser$parse_pattern_as(p));
  let _t2570 = undefined;
  let _t2571 = false, _t2572;
  while (true) {
    if (!(_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"})))) break;
    Parser$advance(p);
    undefined;
    const next_pat_2573 = Parser$parse_pattern_as(p);
    const _t2574 = Ref$set(pat_2568, ({_tag: 13, _name: "PatOr", _val: [Ref$get(pat_2568), next_pat_2573]}));
    _t2574;
    if (_t2571) break;
  }
  _t2570 = _t2571 ? _t2572 : undefined;
  _t2570;
  const _t2569 = Ref$get(pat_2568);
  return _t2569;
}
function Parser$at_pattern_arg_start(p) {
  let _t2576;
  const _t2575 = Parser$peek_kind(p);
  _t2577: {
    if (_t2575._tag === 8 && _t2575._val === "as") {
      _t2576 = false;
      break _t2577;
    }
    if (((((((((((((_t2575._tag === 0 || _t2575._tag === 6) || _t2575._tag === 7) || _t2575._tag === 2) || _t2575._tag === 8) || _t2575._tag === 9) || _t2575._tag === 52) || _t2575._tag === 56) || _t2575._tag === 54) || _t2575._tag === 67) || _t2575._tag === 41) || _t2575._tag === 89) || _t2575._tag === 72)) {
      _t2576 = true;
      break _t2577;
    }
    if (true) {
      _t2576 = false;
      break _t2577;
    }
    _match_fail("line 16933");
  }
  return _t2576;
}
function Parser$parse_pattern_list_elems(p) {
  const first_2578 = Parser$parse_pattern(p);
  const pats_2580 = Ref$create(({_hd: first_2578, _tl: null}));
  let _t2582 = undefined;
  let _t2583 = false, _t2584;
  while (true) {
    if (!(_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"})))) break;
    Parser$advance(p);
    undefined;
    let _t2585;
    if (!_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
      _t2585 = Ref$set(pats_2580, ({_hd: Parser$parse_pattern(p), _tl: Ref$get(pats_2580)}));
    } else {
      _t2585 = undefined;
    }
    _t2585;
    if (_t2583) break;
  }
  _t2582 = _t2583 ? _t2584 : undefined;
  _t2582;
  const _t2581 = List$rev(Ref$get(pats_2580));
  const _t2579 = _t2581;
  return _t2579;
}
function Parser$parse_pattern_record_fields(p) {
  const fields_2586 = Ref$create(null);
  const first_2588 = Ref$create(true);
  let _t2590 = undefined;
  let _t2591 = false, _t2592;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
    let _t2593;
    if ((!Ref$get(first_2588))) {
      _t2593 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
    } else {
      _t2593 = undefined;
    }
    _t2593;
    let _t2594;
    if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
      _t2594 = undefined;
    } else {
      Ref$set(first_2588, false);
      let _t2595;
      if (_eq(Parser$peek_kind(p), ({_tag: 67, _name: "UNDERSCORE"}))) {
        Parser$advance(p);
        _t2595 = undefined;
      } else {
        const name_2596 = Parser$expect_ident(p);
        let _t2598;
        if (_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"}))) {
          Parser$advance(p);
          undefined;
          _t2598 = Parser$parse_pattern(p);
        } else {
          _t2598 = ({_tag: 1, _name: "PatVar", _val: name_2596});
        }
        const pat_2599 = _t2598;
        const _t2600 = Ref$set(fields_2586, ({_hd: [name_2596, pat_2599], _tl: Ref$get(fields_2586)}));
        const _t2597 = _t2600;
        _t2595 = _t2597;
      }
      _t2594 = _t2595;
    }
    _t2594;
    if (_t2591) break;
  }
  _t2590 = _t2591 ? _t2592 : undefined;
  _t2590;
  const _t2589 = List$rev(Ref$get(fields_2586));
  const _t2587 = _t2589;
  return _t2587;
}
function Parser$parse_pattern_map_entries(p) {
  const entries_2601 = Ref$create(null);
  const first_2603 = Ref$create(true);
  let _t2605 = undefined;
  let _t2606 = false, _t2607;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
    let _t2608;
    if ((!Ref$get(first_2603))) {
      _t2608 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
    } else {
      _t2608 = undefined;
    }
    _t2608;
    let _t2609;
    if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
      _t2609 = undefined;
    } else {
      Ref$set(first_2603, false);
      const key_2610 = Parser$parse_pattern_atom(p);
      Parser$expect(p, ({_tag: 62, _name: "COLON"}));
      const value_2612 = Parser$parse_pattern(p);
      const _t2613 = Ref$set(entries_2601, ({_hd: [key_2610, value_2612], _tl: Ref$get(entries_2601)}));
      const _t2611 = _t2613;
      _t2609 = _t2611;
    }
    _t2609;
    if (_t2606) break;
  }
  _t2605 = _t2606 ? _t2607 : undefined;
  _t2605;
  const _t2604 = List$rev(Ref$get(entries_2601));
  const _t2602 = _t2604;
  return _t2602;
}
function Parser$bp_of_binop(__x) {
  let _t2615;
  const _t2614 = __x;
  _t2616: {
    if (_t2614._tag === 66) {
      _t2615 = [1, 2];
      break _t2616;
    }
    if (_t2614._tag === 82) {
      _t2615 = [2, 3];
      break _t2616;
    }
    if (_t2614._tag === 81) {
      _t2615 = [4, 5];
      break _t2616;
    }
    if ((((((_t2614._tag === 75 || _t2614._tag === 76) || _t2614._tag === 77) || _t2614._tag === 78) || _t2614._tag === 79) || _t2614._tag === 80)) {
      _t2615 = [6, 7];
      break _t2616;
    }
    if (_t2614._tag === 73) {
      _t2615 = [9, 8];
      break _t2616;
    }
    if ((_t2614._tag === 68 || _t2614._tag === 69)) {
      _t2615 = [10, 11];
      break _t2616;
    }
    if (_t2614._tag === 72) {
      _t2615 = [10, 11];
      break _t2616;
    }
    if (((_t2614._tag === 70 || _t2614._tag === 71) || _t2614._tag === 43)) {
      _t2615 = [12, 13];
      break _t2616;
    }
    if ((_t2614._tag === 84 || _t2614._tag === 85)) {
      _t2615 = [10, 11];
      break _t2616;
    }
    if (((_t2614._tag === 83 || _t2614._tag === 87) || _t2614._tag === 88)) {
      _t2615 = [12, 13];
      break _t2616;
    }
    if (_t2614._tag === 90) {
      _t2615 = [8, 9];
      break _t2616;
    }
    if (true) {
      _t2615 = [(-1), (-1)];
      break _t2616;
    }
    _match_fail("line 16933");
  }
  return _t2615;
}
function Parser$is_binop(__x) {
  let _t2618;
  const _t2617 = __x;
  _t2619: {
    if ((((((((((((((((((((((_t2617._tag === 68 || _t2617._tag === 69) || _t2617._tag === 70) || _t2617._tag === 71) || _t2617._tag === 43) || _t2617._tag === 75) || _t2617._tag === 76) || _t2617._tag === 77) || _t2617._tag === 78) || _t2617._tag === 79) || _t2617._tag === 80) || _t2617._tag === 81) || _t2617._tag === 82) || _t2617._tag === 72) || _t2617._tag === 73) || _t2617._tag === 83) || _t2617._tag === 84) || _t2617._tag === 85) || _t2617._tag === 87) || _t2617._tag === 88) || _t2617._tag === 66) || _t2617._tag === 90)) {
      _t2618 = true;
      break _t2619;
    }
    if (true) {
      _t2618 = false;
      break _t2619;
    }
    _match_fail("line 16933");
  }
  return _t2618;
}
function Parser$binop_of_token(__x) {
  let _t2621;
  const _t2620 = __x;
  _t2622: {
    if (_t2620._tag === 68) {
      _t2621 = ({_tag: 0, _name: "Add"});
      break _t2622;
    }
    if (_t2620._tag === 69) {
      _t2621 = ({_tag: 1, _name: "Sub"});
      break _t2622;
    }
    if (_t2620._tag === 70) {
      _t2621 = ({_tag: 2, _name: "Mul"});
      break _t2622;
    }
    if (_t2620._tag === 71) {
      _t2621 = ({_tag: 3, _name: "Div"});
      break _t2622;
    }
    if (_t2620._tag === 43) {
      _t2621 = ({_tag: 4, _name: "Mod"});
      break _t2622;
    }
    if (_t2620._tag === 75) {
      _t2621 = ({_tag: 5, _name: "Eq"});
      break _t2622;
    }
    if (_t2620._tag === 76) {
      _t2621 = ({_tag: 6, _name: "Neq"});
      break _t2622;
    }
    if (_t2620._tag === 77) {
      _t2621 = ({_tag: 7, _name: "Lt"});
      break _t2622;
    }
    if (_t2620._tag === 78) {
      _t2621 = ({_tag: 8, _name: "Gt"});
      break _t2622;
    }
    if (_t2620._tag === 79) {
      _t2621 = ({_tag: 9, _name: "Le"});
      break _t2622;
    }
    if (_t2620._tag === 80) {
      _t2621 = ({_tag: 10, _name: "Ge"});
      break _t2622;
    }
    if (_t2620._tag === 81) {
      _t2621 = ({_tag: 11, _name: "And"});
      break _t2622;
    }
    if (_t2620._tag === 82) {
      _t2621 = ({_tag: 12, _name: "Or"});
      break _t2622;
    }
    if (_t2620._tag === 72) {
      _t2621 = ({_tag: 13, _name: "Concat"});
      break _t2622;
    }
    if (_t2620._tag === 83) {
      _t2621 = ({_tag: 14, _name: "Land"});
      break _t2622;
    }
    if (_t2620._tag === 84) {
      _t2621 = ({_tag: 15, _name: "Lor"});
      break _t2622;
    }
    if (_t2620._tag === 85) {
      _t2621 = ({_tag: 16, _name: "Lxor"});
      break _t2622;
    }
    if (_t2620._tag === 87) {
      _t2621 = ({_tag: 17, _name: "Lsl"});
      break _t2622;
    }
    if (_t2620._tag === 88) {
      _t2621 = ({_tag: 18, _name: "Lsr"});
      break _t2622;
    }
    if (_t2620._tag === 66) {
      _t2621 = ({_tag: 19, _name: "Pipe"});
      break _t2622;
    }
    if (true) {
      _t2621 = failwith("assert false");
      break _t2622;
    }
    _match_fail("line 16933");
  }
  return _t2621;
}
function Parser$resolve_fun_params(fun_params, body) {
  function _t2623(body, fp) {
    let _t2625;
    const _t2624 = fp;
    _t2626: {
      if (_t2624._tag === 0) {
        _t2625 = body;
        break _t2626;
      }
      if (_t2624._tag === 1) {
        const name = _t2624._val[0];
        const pat = _t2624._val[1];
        _t2625 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
        break _t2626;
      }
      _match_fail("line 16933");
    }
    return _t2625;
  }
  const body_2627 = List$fold(_t2623, body, fun_params);
  function _t2629(fp) {
    let _t2631;
    const _t2630 = fp;
    _t2632: {
      if (_t2630._tag === 0) {
        const param = _t2630._val;
        _t2631 = param;
        break _t2632;
      }
      if (_t2630._tag === 1) {
        const name = _t2630._val[0];
        const annot = _t2630._val[2];
        _t2631 = ({annot: annot, is_generated: true, name: name});
        break _t2632;
      }
      _match_fail("line 16933");
    }
    return _t2631;
  }
  const params_2633 = List$map(_t2629, fun_params);
  const _t2634 = [params_2633, body_2627];
  const _t2628 = _t2634;
  return _t2628;
}
const Parser$fresh_param_counter = Ref$create(0);
function Parser$fresh_param_name(_) {
  Ref$set(Parser$fresh_param_counter, (Ref$get(Parser$fresh_param_counter) + 1));
  return ("__p" + __dict_Show_int.show(Ref$get(Parser$fresh_param_counter)));
}
function Parser$parse_format_spec(spec, expr) {
  const len_2635 = String$length(spec);
  const i_2637 = Ref$create(0);
  let _t2639;
  if (((Ref$get(i_2637) < len_2635) && ((String$get(spec, Ref$get(i_2637)) === 60) || (String$get(spec, Ref$get(i_2637)) === 62)))) {
    const a_2640 = String$get(spec, Ref$get(i_2637));
    Ref$set(i_2637, (Ref$get(i_2637) + 1));
    const _t2641 = ({_tag: 1, _name: "Some", _val: a_2640});
    _t2639 = _t2641;
  } else {
    _t2639 = ({_tag: 0, _name: "None"});
  }
  const align_2642 = _t2639;
  let _t2644;
  if (((Ref$get(i_2637) < len_2635) && ((String$get(spec, Ref$get(i_2637)) === 48) && (((Ref$get(i_2637) + 1) < len_2635) && ((String$get(spec, (Ref$get(i_2637) + 1)) >= 49) && (String$get(spec, (Ref$get(i_2637) + 1)) <= 57)))))) {
    Ref$set(i_2637, (Ref$get(i_2637) + 1));
    _t2644 = true;
  } else {
    _t2644 = false;
  }
  const zero_pad_2645 = _t2644;
  const width_start_2647 = Ref$get(i_2637);
  let _t2649 = undefined;
  let _t2650 = false, _t2651;
  while (true) {
    if (!(((Ref$get(i_2637) < len_2635) && ((String$get(spec, Ref$get(i_2637)) >= 48) && (String$get(spec, Ref$get(i_2637)) <= 57))))) break;
    Ref$set(i_2637, (Ref$get(i_2637) + 1));
    if (_t2650) break;
  }
  _t2649 = _t2650 ? _t2651 : undefined;
  _t2649;
  let _t2652;
  if ((Ref$get(i_2637) > width_start_2647)) {
    _t2652 = ({_tag: 1, _name: "Some", _val: int_of_string(String$sub(spec, width_start_2647, (Ref$get(i_2637) - width_start_2647)))});
  } else {
    _t2652 = ({_tag: 0, _name: "None"});
  }
  const width_2653 = _t2652;
  let _t2655;
  if (((Ref$get(i_2637) < len_2635) && (String$get(spec, Ref$get(i_2637)) === 46))) {
    Ref$set(i_2637, (Ref$get(i_2637) + 1));
    const ps_2656 = Ref$get(i_2637);
    let _t2658 = undefined;
    let _t2659 = false, _t2660;
    while (true) {
      if (!(((Ref$get(i_2637) < len_2635) && ((String$get(spec, Ref$get(i_2637)) >= 48) && (String$get(spec, Ref$get(i_2637)) <= 57))))) break;
      Ref$set(i_2637, (Ref$get(i_2637) + 1));
      if (_t2659) break;
    }
    _t2658 = _t2659 ? _t2660 : undefined;
    _t2658;
    let _t2661;
    if ((Ref$get(i_2637) > ps_2656)) {
      _t2661 = int_of_string(String$sub(spec, ps_2656, (Ref$get(i_2637) - ps_2656)));
    } else {
      _t2661 = 0;
    }
    const n_2662 = _t2661;
    let _t2664;
    if (((Ref$get(i_2637) < len_2635) && (String$get(spec, Ref$get(i_2637)) === 102))) {
      Ref$set(i_2637, (Ref$get(i_2637) + 1));
      _t2664 = ({_tag: 1, _name: "Some", _val: n_2662});
    } else {
      _t2664 = ({_tag: 0, _name: "None"});
    }
    const _t2663 = _t2664;
    const _t2657 = _t2663;
    _t2655 = _t2657;
  } else {
    _t2655 = ({_tag: 0, _name: "None"});
  }
  const float_prec_2665 = _t2655;
  let _t2667;
  if ((Ref$get(i_2637) < len_2635)) {
    let _t2669;
    const _t2668 = String$get(spec, Ref$get(i_2637));
    _t2670: {
      if (true) {
        const _c = _t2668;
        if ((_c === 120)) {
          Ref$set(i_2637, (Ref$get(i_2637) + 1));
          _t2669 = ({_tag: 1, _name: "Some", _val: 120});
          break _t2670;
        }
      }
      if (true) {
        const _c = _t2668;
        if ((_c === 88)) {
          Ref$set(i_2637, (Ref$get(i_2637) + 1));
          _t2669 = ({_tag: 1, _name: "Some", _val: 88});
          break _t2670;
        }
      }
      if (true) {
        const _c = _t2668;
        if ((_c === 111)) {
          Ref$set(i_2637, (Ref$get(i_2637) + 1));
          _t2669 = ({_tag: 1, _name: "Some", _val: 111});
          break _t2670;
        }
      }
      if (true) {
        const _c = _t2668;
        if ((_c === 98)) {
          Ref$set(i_2637, (Ref$get(i_2637) + 1));
          _t2669 = ({_tag: 1, _name: "Some", _val: 98});
          break _t2670;
        }
      }
      if (true) {
        _t2669 = ({_tag: 0, _name: "None"});
        break _t2670;
      }
      _match_fail("line 16933");
    }
    _t2667 = _t2669;
  } else {
    _t2667 = ({_tag: 0, _name: "None"});
  }
  const type_spec_2671 = _t2667;
  let _t2674;
  const _t2673 = float_prec_2665;
  _t2675: {
    if (_t2673._tag === 1) {
      const n = _t2673._val;
      _t2674 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_float"}), ({_tag: 0, _name: "EInt", _val: n})]}), expr]});
      break _t2675;
    }
    if (_t2673._tag === 0) {
      let _t2677;
      const _t2676 = type_spec_2671;
      _t2678: {
        if (_t2676._tag === 1) {
          const _c = _t2676._val;
          if ((_c === 120)) {
            _t2677 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_hex"}), expr]});
            break _t2678;
          }
        }
        if (_t2676._tag === 1) {
          const _c = _t2676._val;
          if ((_c === 88)) {
            _t2677 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_hex_upper"}), expr]});
            break _t2678;
          }
        }
        if (_t2676._tag === 1) {
          const _c = _t2676._val;
          if ((_c === 111)) {
            _t2677 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_oct"}), expr]});
            break _t2678;
          }
        }
        if (_t2676._tag === 1) {
          const _c = _t2676._val;
          if ((_c === 98)) {
            _t2677 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_bin"}), expr]});
            break _t2678;
          }
        }
        if (true) {
          _t2677 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), expr]});
          break _t2678;
        }
        _match_fail("line 16933");
      }
      _t2674 = _t2677;
      break _t2675;
    }
    _match_fail("line 16933");
  }
  const inner_2679 = _t2674;
  let _t2681;
  if (zero_pad_2645) {
    let _t2683;
    const _t2682 = width_2653;
    _t2684: {
      if (_t2682._tag === 1) {
        const w = _t2682._val;
        _t2683 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_zero_pad"}), ({_tag: 0, _name: "EInt", _val: w})]}), inner_2679]});
        break _t2684;
      }
      if (_t2682._tag === 0) {
        _t2683 = inner_2679;
        break _t2684;
      }
      _match_fail("line 16933");
    }
    _t2681 = _t2683;
  } else {
    _t2681 = inner_2679;
  }
  const inner_2685 = _t2681;
  let _t2687;
  if ((!zero_pad_2645)) {
    let _t2689;
    const _t2688 = [align_2642, width_2653];
    _t2690: {
      if (_t2688[0]._tag === 1 && _t2688[1]._tag === 1) {
        const _c = _t2688[0]._val;
        const w = _t2688[1]._val;
        if ((_c === 62)) {
          _t2689 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_pad_left"}), ({_tag: 0, _name: "EInt", _val: w})]}), inner_2685]});
          break _t2690;
        }
      }
      if (_t2688[0]._tag === 1 && _t2688[1]._tag === 1) {
        const _c = _t2688[0]._val;
        const w = _t2688[1]._val;
        if ((_c === 60)) {
          _t2689 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "__fmt_pad_right"}), ({_tag: 0, _name: "EInt", _val: w})]}), inner_2685]});
          break _t2690;
        }
      }
      if (true) {
        _t2689 = inner_2685;
        break _t2690;
      }
      _match_fail("line 16933");
    }
    _t2687 = _t2689;
  } else {
    _t2687 = inner_2685;
  }
  const inner_2691 = _t2687;
  const _t2692 = inner_2691;
  const _t2686 = _t2692;
  const _t2680 = _t2686;
  const _t2672 = _t2680;
  const _t2666 = _t2672;
  const _t2654 = _t2666;
  const _t2648 = _t2654;
  const _t2646 = _t2648;
  const _t2643 = _t2646;
  const _t2638 = _t2643;
  const _t2636 = _t2638;
  return _t2636;
}
function Parser$parse_atom(p) {
  const loc_2693 = Parser$peek(p).loc;
  const expr_2695 = Parser$parse_atom_inner(p);
  const _t2696 = ({_tag: 49, _name: "ELoc", _val: [loc_2693, expr_2695]});
  const _t2694 = _t2696;
  return _t2694;
}
function Parser$parse_atom_inner(p) {
  let _t2698;
  const _t2697 = Parser$peek_kind(p);
  _t2699: {
    if (_t2697._tag === 0) {
      const n = _t2697._val;
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 0, _name: "EInt", _val: n});
      break _t2699;
    }
    if (_t2697._tag === 1) {
      const f = _t2697._val;
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 1, _name: "EFloat", _val: f});
      break _t2699;
    }
    if (_t2697._tag === 2) {
      const s = _t2697._val;
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 3, _name: "EString", _val: s});
      break _t2699;
    }
    if (_t2697._tag === 3) {
      const parts = _t2697._val;
      Parser$advance(p);
      undefined;
      function _t2700(part) {
        let _t2702;
        const _t2701 = part;
        _t2703: {
          if (_t2701._tag === 0) {
            const s = _t2701._val;
            _t2702 = ({_tag: 3, _name: "EString", _val: s});
            break _t2703;
          }
          if (_t2701._tag === 1) {
            const src = _t2701._val[0];
            const fmt = _t2701._val[1];
            const tokens_2704 = Lexer$tokenize(src);
            const inner_p_2706 = Parser$create(tokens_2704);
            const inner_expr_2708 = Parser$parse_expr(inner_p_2706);
            let _t2711;
            const _t2710 = fmt;
            _t2712: {
              if (_t2710._tag === 0) {
                _t2711 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), inner_expr_2708]});
                break _t2712;
              }
              if (_t2710._tag === 1) {
                const spec = _t2710._val;
                _t2711 = Parser$parse_format_spec(spec, inner_expr_2708);
                break _t2712;
              }
              _match_fail("line 16933");
            }
            const _t2709 = _t2711;
            const _t2707 = _t2709;
            const _t2705 = _t2707;
            _t2702 = _t2705;
            break _t2703;
          }
          _match_fail("line 16933");
        }
        return _t2702;
      }
      const exprs_2713 = List$map(_t2700, parts);
      let _t2716;
      const _t2715 = exprs_2713;
      _t2717: {
        if (_t2715 === null) {
          _t2716 = ({_tag: 3, _name: "EString", _val: ""});
          break _t2717;
        }
        if (_t2715 !== null && _t2715._tl === null) {
          const e = _t2715._hd;
          _t2716 = e;
          break _t2717;
        }
        if (_t2715 !== null) {
          const first = _t2715._hd;
          const rest = _t2715._tl;
          function _t2718(acc, e) {
            return ({_tag: 13, _name: "EBinop", _val: [({_tag: 13, _name: "Concat"}), acc, e]});
          }
          _t2716 = List$fold(_t2718, first, rest);
          break _t2717;
        }
        _match_fail("line 16933");
      }
      const _t2714 = _t2716;
      _t2698 = _t2714;
      break _t2699;
    }
    if (_t2697._tag === 6) {
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 2, _name: "EBool", _val: true});
      break _t2699;
    }
    if (_t2697._tag === 7) {
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 2, _name: "EBool", _val: false});
      break _t2699;
    }
    if (_t2697._tag === 4) {
      const n = _t2697._val;
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 4, _name: "EByte", _val: n});
      break _t2699;
    }
    if (_t2697._tag === 5) {
      const n = _t2697._val;
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 5, _name: "ERune", _val: n});
      break _t2699;
    }
    if (_t2697._tag === 8) {
      const s = _t2697._val;
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 7, _name: "EVar", _val: s});
      break _t2699;
    }
    if (_t2697._tag === 9) {
      const s = _t2697._val;
      Parser$advance(p);
      undefined;
      let _t2720;
      const _t2719 = Parser$read_qualified_path(p, s);
      _t2721: {
        if (_t2719._tag === 958595272) {
          const qualified = _t2719._val;
          _t2720 = ({_tag: 7, _name: "EVar", _val: qualified});
          break _t2721;
        }
        if (_t2719._tag === 1067578635) {
          const qualified = _t2719._val;
          _t2720 = ({_tag: 24, _name: "EConstruct", _val: [qualified, ({_tag: 0, _name: "None"})]});
          break _t2721;
        }
        if (_t2719._tag === 982234060) {
          const mod_path = _t2719._val;
          Parser$advance(p);
          undefined;
          const inner_2722 = Parser$parse_expr(p);
          Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
          const _t2723 = ({_tag: 48, _name: "ELocalOpen", _val: [mod_path, inner_2722]});
          _t2720 = _t2723;
          break _t2721;
        }
        _match_fail("line 16933");
      }
      _t2698 = _t2720;
      break _t2699;
    }
    if (_t2697._tag === 52) {
      Parser$advance(p);
      undefined;
      const op_name_2724 = Parser$token_to_op_name(Parser$peek_kind(p));
      let _t2727;
      const _t2726 = op_name_2724;
      _t2728: {
        if (_t2726._tag === 1) {
          const name = _t2726._val;
          if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 53, _name: "RPAREN"}))) {
            Parser$advance(p);
            undefined;
            Parser$advance(p);
            undefined;
            _t2727 = ({_tag: 7, _name: "EVar", _val: name});
            break _t2728;
          }
        }
        if (true) {
          let _t2729;
          if (_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"}))) {
            Parser$advance(p);
            undefined;
            _t2729 = ({_tag: 6, _name: "EUnit"});
          } else {
            const expr_2730 = Parser$parse_expr(p);
            let _t2733;
            const _t2732 = Parser$peek_kind(p);
            _t2734: {
              if (_t2732._tag === 59) {
                const exprs_2735 = Ref$create(({_hd: expr_2730, _tl: null}));
                let _t2737 = undefined;
                let _t2738 = false, _t2739;
                while (true) {
                  if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"})))) break;
                  Parser$advance(p);
                  undefined;
                  Ref$set(exprs_2735, ({_hd: Parser$parse_expr(p), _tl: Ref$get(exprs_2735)}));
                  if (_t2738) break;
                }
                _t2737 = _t2738 ? _t2739 : undefined;
                _t2737;
                Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
                const _t2736 = ({_tag: 15, _name: "ETuple", _val: List$rev(Ref$get(exprs_2735))});
                _t2733 = _t2736;
                break _t2734;
              }
              if (_t2732._tag === 62) {
                Parser$advance(p);
                undefined;
                const ty_2740 = Parser$parse_ty(p);
                Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
                const _t2741 = ({_tag: 30, _name: "EAnnot", _val: [expr_2730, ty_2740]});
                _t2733 = _t2741;
                break _t2734;
              }
              if (_t2732._tag === 91) {
                Parser$advance(p);
                undefined;
                const ty_2742 = Parser$parse_ty(p);
                Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
                const _t2743 = ({_tag: 47, _name: "ECoerce", _val: [expr_2730, ty_2742]});
                _t2733 = _t2743;
                break _t2734;
              }
              if (true) {
                Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
                _t2733 = expr_2730;
                break _t2734;
              }
              _match_fail("line 16933");
            }
            const _t2731 = _t2733;
            _t2729 = _t2731;
          }
          _t2727 = _t2729;
          break _t2728;
        }
        _match_fail("line 16933");
      }
      const _t2725 = _t2727;
      _t2698 = _t2725;
      break _t2699;
    }
    if (_t2697._tag === 54) {
      Parser$advance(p);
      undefined;
      let _t2744;
      if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
        Parser$advance(p);
        undefined;
        _t2744 = ({_tag: 16, _name: "ERecord", _val: null});
      } else {
        let _t2746;
        const _t2745 = Parser$peek_kind(p);
        _t2747: {
          if (_t2745._tag === 8) {
            const next_2748 = Parser$peek_kind_at(p, 1);
            const _t2749 = (_eq(next_2748, ({_tag: 75, _name: "EQ"})) || (_eq(next_2748, ({_tag: 60, _name: "SEMICOLON"})) || _eq(next_2748, ({_tag: 55, _name: "RBRACE"}))));
            _t2746 = _t2749;
            break _t2747;
          }
          if (true) {
            _t2746 = false;
            break _t2747;
          }
          _match_fail("line 16933");
        }
        let _t2750;
        if (_t2746) {
          const fields_2751 = Parser$parse_record_fields(p);
          Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
          const _t2752 = ({_tag: 16, _name: "ERecord", _val: fields_2751});
          _t2750 = _t2752;
        } else {
          const base_2753 = Parser$parse_expr(p);
          Parser$expect(p, ({_tag: 18, _name: "WITH"}));
          const fields_2755 = Parser$parse_record_fields(p);
          Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
          const _t2756 = ({_tag: 17, _name: "ERecordUpdate", _val: [base_2753, fields_2755]});
          const _t2754 = _t2756;
          _t2750 = _t2754;
        }
        _t2744 = _t2750;
      }
      _t2698 = _t2744;
      break _t2699;
    }
    if (_t2697._tag === 56) {
      Parser$advance(p);
      undefined;
      let _t2757;
      if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
        Parser$advance(p);
        undefined;
        _t2757 = ({_tag: 21, _name: "ENil"});
      } else {
        const elems_2758 = Parser$parse_list_elems(p);
        Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
        const _t2759 = ({_tag: 22, _name: "EList", _val: elems_2758});
        _t2757 = _t2759;
      }
      _t2698 = _t2757;
      break _t2699;
    }
    if (_t2697._tag === 41) {
      Parser$advance(p);
      undefined;
      let _t2761;
      const _t2760 = Parser$peek_kind(p);
      _t2762: {
        if (_t2760._tag === 54) {
          Parser$advance(p);
          undefined;
          let _t2764;
          const _t2763 = Parser$parse_set_or_map(p);
          _t2765: {
            if (_t2763._tag === 887353506) {
              const pairs = _t2763._val;
              Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
              _t2764 = ({_tag: 42, _name: "EMap", _val: pairs});
              break _t2765;
            }
            if (_t2763._tag === 98602162) {
              const elems = _t2763._val;
              Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
              _t2764 = ({_tag: 44, _name: "ESet", _val: elems});
              break _t2765;
            }
            if (_t2763._tag === 533146490) {
              const expr = _t2763._val;
              Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
              _t2764 = expr;
              break _t2765;
            }
            _match_fail("line 16933");
          }
          _t2761 = _t2764;
          break _t2762;
        }
        if (_t2760._tag === 56) {
          Parser$advance(p);
          undefined;
          let _t2766;
          if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
            Parser$advance(p);
            undefined;
            _t2766 = ({_tag: 23, _name: "EArray", _val: null});
          } else {
            const elems_2767 = Parser$parse_list_elems(p);
            Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
            const _t2768 = ({_tag: 23, _name: "EArray", _val: elems_2767});
            _t2766 = _t2768;
          }
          _t2761 = _t2766;
          break _t2762;
        }
        if ((_t2760._tag === 9 || _t2760._tag === 8)) {
          const name = _t2760._val;
          Parser$advance(p);
          undefined;
          let _t2770;
          const _t2769 = Parser$peek_kind(p);
          _t2771: {
            if (_t2769._tag === 54) {
              Parser$advance(p);
              undefined;
              let _t2773;
              const _t2772 = Parser$parse_set_or_map(p);
              _t2774: {
                if (_t2772._tag === 887353506) {
                  const pairs = _t2772._val;
                  Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
                  _t2773 = ({_tag: 43, _name: "EMapTyped", _val: [name, pairs]});
                  break _t2774;
                }
                if (_t2772._tag === 98602162) {
                  const elems = _t2772._val;
                  Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
                  _t2773 = ({_tag: 45, _name: "ECollTyped", _val: [name, elems]});
                  break _t2774;
                }
                if (_t2772._tag === 533146490) {
                  const expr = _t2772._val;
                  Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
                  _t2773 = expr;
                  break _t2774;
                }
                _match_fail("line 16933");
              }
              _t2770 = _t2773;
              break _t2771;
            }
            if (_t2769._tag === 56) {
              Parser$advance(p);
              undefined;
              let _t2775;
              if (_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
                Parser$advance(p);
                undefined;
                _t2775 = ({_tag: 45, _name: "ECollTyped", _val: [name, null]});
              } else {
                const elems_2776 = Parser$parse_list_elems(p);
                Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
                const _t2777 = ({_tag: 45, _name: "ECollTyped", _val: [name, elems_2776]});
                _t2775 = _t2777;
              }
              _t2770 = _t2775;
              break _t2771;
            }
            if (true) {
              _t2770 = Parser$error(p, "expected '{' or '[' after type name");
              break _t2771;
            }
            _match_fail("line 16933");
          }
          _t2761 = _t2770;
          break _t2762;
        }
        if (true) {
          _t2761 = Parser$error(p, "expected '{', '[', or type name after '#'");
          break _t2762;
        }
        _match_fail("line 16933");
      }
      _t2698 = _t2761;
      break _t2699;
    }
    if (_t2697._tag === 89) {
      const tag = _t2697._val;
      Parser$advance(p);
      undefined;
      let _t2778;
      if ((Parser$at_atom_start(p) && (!Parser$is_keyword_expr_start(p)))) {
        _t2778 = ({_tag: 46, _name: "EPolyVariant", _val: [tag, ({_tag: 1, _name: "Some", _val: Parser$parse_postfix(p)})]});
      } else {
        _t2778 = ({_tag: 46, _name: "EPolyVariant", _val: [tag, ({_tag: 0, _name: "None"})]});
      }
      _t2698 = _t2778;
      break _t2699;
    }
    if (_t2697._tag === 35) {
      Parser$advance(p);
      undefined;
      const e_2779 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t2780 = e_2779;
      _t2698 = _t2780;
      break _t2699;
    }
    if (_t2697._tag === 16) {
      _t2698 = Parser$parse_fun(p);
      break _t2699;
    }
    if (_t2697._tag === 14) {
      _t2698 = Parser$parse_if(p);
      break _t2699;
    }
    if (_t2697._tag === 11) {
      _t2698 = Parser$parse_let_expr(p);
      break _t2699;
    }
    if (_t2697._tag === 17) {
      _t2698 = Parser$parse_match(p, false);
      break _t2699;
    }
    if (_t2697._tag === 39) {
      Parser$advance(p);
      undefined;
      _t2698 = Parser$parse_match(p, true);
      break _t2699;
    }
    if (_t2697._tag === 69) {
      Parser$advance(p);
      undefined;
      const expr_2781 = Parser$parse_postfix(p);
      const _t2782 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 0, _name: "Neg"}), expr_2781]});
      _t2698 = _t2782;
      break _t2699;
    }
    if (_t2697._tag === 40) {
      Parser$advance(p);
      undefined;
      const expr_2783 = Parser$parse_postfix(p);
      const _t2784 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 1, _name: "Not"}), expr_2783]});
      _t2698 = _t2784;
      break _t2699;
    }
    if (_t2697._tag === 86) {
      Parser$advance(p);
      undefined;
      const expr_2785 = Parser$parse_postfix(p);
      const _t2786 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 2, _name: "Lnot"}), expr_2785]});
      _t2698 = _t2786;
      break _t2699;
    }
    if (_t2697._tag === 26) {
      Parser$advance(p);
      undefined;
      const op_name_2787 = Parser$expect_ident(p);
      let _t2789;
      if (Parser$at_atom_start(p)) {
        _t2789 = Parser$parse_postfix(p);
      } else {
        _t2789 = ({_tag: 6, _name: "EUnit"});
      }
      const arg_2790 = _t2789;
      const _t2791 = ({_tag: 39, _name: "EPerform", _val: [op_name_2787, arg_2790]});
      const _t2788 = _t2791;
      _t2698 = _t2788;
      break _t2699;
    }
    if (_t2697._tag === 27) {
      _t2698 = Parser$parse_handle_expr(p);
      break _t2699;
    }
    if (_t2697._tag === 28) {
      _t2698 = Parser$parse_try_expr(p);
      break _t2699;
    }
    if (_t2697._tag === 29) {
      _t2698 = Parser$parse_provide_expr(p);
      break _t2699;
    }
    if (_t2697._tag === 31) {
      Parser$advance(p);
      undefined;
      const k_2792 = Parser$parse_atom(p);
      const v_2794 = Parser$parse_atom(p);
      const _t2795 = ({_tag: 41, _name: "EResume", _val: [k_2792, v_2794]});
      const _t2793 = _t2795;
      _t2698 = _t2793;
      break _t2699;
    }
    if (_t2697._tag === 34) {
      _t2698 = Parser$parse_for_expr(p);
      break _t2699;
    }
    if (_t2697._tag === 36) {
      Parser$advance(p);
      undefined;
      let _t2796;
      if (Parser$at_atom_start(p)) {
        _t2796 = ({_tag: 35, _name: "EBreak", _val: ({_tag: 1, _name: "Some", _val: Parser$parse_atom(p)})});
      } else {
        _t2796 = ({_tag: 35, _name: "EBreak", _val: ({_tag: 0, _name: "None"})});
      }
      _t2698 = _t2796;
      break _t2699;
    }
    if (_t2697._tag === 30) {
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 36, _name: "EContinueLoop"});
      break _t2699;
    }
    if (_t2697._tag === 32) {
      Parser$advance(p);
      undefined;
      _t2698 = ({_tag: 37, _name: "EReturn", _val: Parser$parse_expr_bp(p, 0)});
      break _t2699;
    }
    if (_t2697._tag === 63) {
      Parser$advance(p);
      undefined;
      const field_2797 = Parser$expect_ident(p);
      const r_2799 = ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__r"});
      const _t2800 = ({_tag: 10, _name: "EFun", _val: [r_2799, ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__r"}), field_2797]})]});
      const _t2798 = _t2800;
      _t2698 = _t2798;
      break _t2699;
    }
    if (true) {
      _t2698 = Parser$error(p, "expected expression");
      break _t2699;
    }
    _match_fail("line 16933");
  }
  return _t2698;
}
function Parser$at_atom_start(p) {
  let _t2802;
  const _t2801 = Parser$peek_kind(p);
  _t2803: {
    if ((((((((((((((((_t2801._tag === 0 || _t2801._tag === 1) || _t2801._tag === 2) || _t2801._tag === 3) || _t2801._tag === 4) || _t2801._tag === 5) || _t2801._tag === 6) || _t2801._tag === 7) || _t2801._tag === 8) || _t2801._tag === 9) || _t2801._tag === 52) || _t2801._tag === 54) || _t2801._tag === 56) || _t2801._tag === 41) || _t2801._tag === 63) || _t2801._tag === 89)) {
      _t2802 = true;
      break _t2803;
    }
    if (true) {
      _t2802 = false;
      break _t2803;
    }
    _match_fail("line 16933");
  }
  return _t2802;
}
function Parser$is_adjacent(p) {
  let _t2808;
  if ((p.pos > 0)) {
  const prev_2804 = Array$get(p.tokens, (p.pos - 1));
  const cur_2806 = Parser$peek(p);
  const _t2807 = (prev_2804.end_offset === cur_2806.loc.offset);
  const _t2805 = _t2807;
    _t2808 = _t2805;
  } else {
    _t2808 = false;
  }
  return _t2808;
}
function Parser$parse_postfix(p) {
  const expr_2809 = Parser$parse_atom(p);
  function loop(expr) {
    while (true) {
      let _t2812;
      const _t2811 = Parser$peek_kind(p);
      _t2813: {
        if (_t2811._tag === 63) {
          if (Parser$is_adjacent(p)) {
            Parser$advance(p);
            undefined;
            let _t2814;
            if (_eq(Parser$peek_kind(p), ({_tag: 56, _name: "LBRACKET"}))) {
              Parser$advance(p);
              undefined;
              const idx_2815 = Parser$parse_expr(p);
              Parser$expect(p, ({_tag: 57, _name: "RBRACKET"}));
              const _t2817 = ({_tag: 19, _name: "EIndex", _val: [expr, idx_2815]});
              expr = _t2817;
              continue;
              const _t2816 = undefined;
              _t2814 = _t2816;
            } else {
              const field_2818 = Parser$expect_ident(p);
              const _t2820 = ({_tag: 18, _name: "EField", _val: [expr, field_2818]});
              expr = _t2820;
              continue;
              const _t2819 = undefined;
              _t2814 = _t2819;
            }
            _t2812 = _t2814;
            break _t2813;
          }
        }
        if (true) {
          _t2812 = expr;
          break _t2813;
        }
        _match_fail("line 16933");
      }
      return _t2812;
    }
  }
  const _t2821 = loop(expr_2809);
  const _t2810 = _t2821;
  return _t2810;
}
function Parser$parse_app(p) {
  const fn__2822 = Parser$parse_postfix(p);
  function loop(expr) {
    while (true) {
      let _t2825;
      const _t2824 = Parser$peek_kind(p);
      _t2826: {
        if (true) {
          if ((Parser$at_atom_start(p) && (!Parser$is_keyword_expr_start(p)))) {
            const arg_2827 = Parser$parse_postfix(p);
            let _t2830;
            const _t2829 = expr;
            _t2831: {
              if ((_t2829._tag === 24 && _t2829._val[1]._tag === 0 || _t2829._tag === 49 && _t2829._val[1]._tag === 24 && _t2829._val[1]._val[1]._tag === 0)) {
                const name = (_t2829._tag === 24 && _t2829._val[1]._tag === 0 ? _t2829._val[0] : _t2829._val[1]._val[0]);
                const _t2832 = ({_tag: 24, _name: "EConstruct", _val: [name, ({_tag: 1, _name: "Some", _val: arg_2827})]});
                expr = _t2832;
                continue;
                _t2830 = undefined;
                break _t2831;
              }
              if (true) {
                const _t2833 = ({_tag: 11, _name: "EApp", _val: [expr, arg_2827]});
                expr = _t2833;
                continue;
                _t2830 = undefined;
                break _t2831;
              }
              _match_fail("line 16933");
            }
            const _t2828 = _t2830;
            _t2825 = _t2828;
            break _t2826;
          }
        }
        if (true) {
          _t2825 = expr;
          break _t2826;
        }
        _match_fail("line 16933");
      }
      return _t2825;
    }
  }
  const _t2834 = loop(fn__2822);
  const _t2823 = _t2834;
  return _t2823;
}
function Parser$is_keyword_expr_start(p) {
  let _t2836;
  const _t2835 = Parser$peek_kind(p);
  _t2837: {
    if (((((((((((((_t2835._tag === 16 || _t2835._tag === 14) || _t2835._tag === 11) || _t2835._tag === 17) || _t2835._tag === 26) || _t2835._tag === 27) || _t2835._tag === 28) || _t2835._tag === 29) || _t2835._tag === 31) || _t2835._tag === 34) || _t2835._tag === 36) || _t2835._tag === 30) || _t2835._tag === 32)) {
      _t2836 = true;
      break _t2837;
    }
    if (true) {
      _t2836 = false;
      break _t2837;
    }
    _match_fail("line 16933");
  }
  return _t2836;
}
function Parser$parse_expr_bp(p, min_bp) {
  const lhs_2838 = Parser$parse_app(p);
  function loop(lhs) {
    while (true) {
      const kind_2840 = Parser$peek_kind(p);
      let _t2842;
      if (Parser$is_binop(kind_2840)) {
        let _t2844;
        const _t2843 = Parser$bp_of_binop(kind_2840);
        _t2845: {
          if (true) {
            const l_bp = _t2843[0];
            const r_bp = _t2843[1];
            let _t2846;
            if ((l_bp < min_bp)) {
              _t2846 = lhs;
            } else {
              Parser$advance(p);
              undefined;
              let _t2847;
              if (_eq(kind_2840, ({_tag: 73, _name: "COLONCOLON"}))) {
                const rhs_2848 = Parser$parse_expr_bp(p, r_bp);
                const _t2850 = ({_tag: 20, _name: "ECons", _val: [lhs, rhs_2848]});
                lhs = _t2850;
                continue;
                const _t2849 = undefined;
                _t2847 = _t2849;
              } else {
                let _t2852;
                const _t2851 = kind_2840;
                _t2853: {
                  if (_t2851._tag === 90) {
                    const name = _t2851._val;
                    const rhs_2854 = Parser$parse_expr_bp(p, r_bp);
                    const _t2856 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: name}), lhs]}), rhs_2854]});
                    lhs = _t2856;
                    continue;
                    const _t2855 = undefined;
                    _t2852 = _t2855;
                    break _t2853;
                  }
                  if (true) {
                    const rhs_2857 = Parser$parse_expr_bp(p, r_bp);
                    const _t2859 = ({_tag: 13, _name: "EBinop", _val: [Parser$binop_of_token(kind_2840), lhs, rhs_2857]});
                    lhs = _t2859;
                    continue;
                    const _t2858 = undefined;
                    _t2852 = _t2858;
                    break _t2853;
                  }
                  _match_fail("line 16933");
                }
                _t2847 = _t2852;
              }
              _t2846 = _t2847;
            }
            _t2844 = _t2846;
            break _t2845;
          }
          _match_fail("line 16933");
        }
        _t2842 = _t2844;
      } else {
        _t2842 = lhs;
      }
      const _t2841 = _t2842;
      return _t2841;
    }
  }
  const _t2860 = loop(lhs_2838);
  const _t2839 = _t2860;
  return _t2839;
}
function Parser$parse_expr_no_seq(p) {
  const e_2861 = Parser$parse_expr_bp(p, 0);
  let _t2864;
  const _t2863 = Parser$peek_kind(p);
  _t2865: {
    if (_t2863._tag === 74) {
      Parser$advance(p);
      undefined;
      const rhs_2866 = Parser$parse_expr_bp(p, 0);
      let _t2869;
      const _t2868 = e_2861;
      _t2870: {
        if (_t2868._tag === 49) {
          const inner = _t2868._val[1];
          _t2869 = inner;
          break _t2870;
        }
        if (true) {
          const e = _t2868;
          _t2869 = e;
          break _t2870;
        }
        _match_fail("line 16933");
      }
      const e_inner_2871 = _t2869;
      let _t2874;
      const _t2873 = e_inner_2871;
      _t2875: {
        if (_t2873._tag === 7) {
          const name = _t2873._val;
          _t2874 = ({_tag: 27, _name: "EAssign", _val: [name, rhs_2866]});
          break _t2875;
        }
        if (_t2873._tag === 18) {
          const obj = _t2873._val[0];
          const field = _t2873._val[1];
          _t2874 = ({_tag: 28, _name: "EFieldAssign", _val: [obj, field, rhs_2866]});
          break _t2875;
        }
        if (true) {
          _t2874 = Parser$error(p, "left side of := must be a variable or field access");
          break _t2875;
        }
        _match_fail("line 16933");
      }
      const _t2872 = _t2874;
      const _t2867 = _t2872;
      _t2864 = _t2867;
      break _t2865;
    }
    if (true) {
      _t2864 = e_2861;
      break _t2865;
    }
    _match_fail("line 16933");
  }
  const _t2862 = _t2864;
  return _t2862;
}
function Parser$parse_expr(p) {
  const e_2876 = Parser$parse_expr_bp(p, 0);
  let _t2879;
  const _t2878 = Parser$peek_kind(p);
  _t2880: {
    if (_t2878._tag === 74) {
      Parser$advance(p);
      undefined;
      const rhs_2881 = Parser$parse_expr_bp(p, 0);
      let _t2884;
      const _t2883 = e_2876;
      _t2885: {
        if (_t2883._tag === 49) {
          const inner = _t2883._val[1];
          _t2884 = inner;
          break _t2885;
        }
        if (true) {
          const e = _t2883;
          _t2884 = e;
          break _t2885;
        }
        _match_fail("line 16933");
      }
      const e_inner_2886 = _t2884;
      let _t2889;
      const _t2888 = e_inner_2886;
      _t2890: {
        if (_t2888._tag === 7) {
          const name = _t2888._val;
          _t2889 = ({_tag: 27, _name: "EAssign", _val: [name, rhs_2881]});
          break _t2890;
        }
        if (_t2888._tag === 18) {
          const obj = _t2888._val[0];
          const field = _t2888._val[1];
          _t2889 = ({_tag: 28, _name: "EFieldAssign", _val: [obj, field, rhs_2881]});
          break _t2890;
        }
        if (true) {
          _t2889 = Parser$error(p, "left side of := must be a variable or field access");
          break _t2890;
        }
        _match_fail("line 16933");
      }
      const assign_2891 = _t2889;
      let _t2894;
      const _t2893 = Parser$peek_kind(p);
      _t2895: {
        if (_t2893._tag === 60) {
          if (!_eq(Parser$peek_next_kind(p), ({_tag: 1, _name: "Some", _val: ({_tag: 60, _name: "SEMICOLON"})}))) {
            Parser$advance(p);
            undefined;
            let _t2896;
            if (Parser$at_expr_start(p)) {
              _t2896 = ({_tag: 29, _name: "ESeq", _val: [assign_2891, Parser$parse_expr(p)]});
            } else {
              _t2896 = assign_2891;
            }
            _t2894 = _t2896;
            break _t2895;
          }
        }
        if (true) {
          _t2894 = assign_2891;
          break _t2895;
        }
        _match_fail("line 16933");
      }
      const _t2892 = _t2894;
      const _t2887 = _t2892;
      const _t2882 = _t2887;
      _t2879 = _t2882;
      break _t2880;
    }
    if (_t2878._tag === 60) {
      if (!_eq(Parser$peek_next_kind(p), ({_tag: 1, _name: "Some", _val: ({_tag: 60, _name: "SEMICOLON"})}))) {
        Parser$advance(p);
        undefined;
        let _t2897;
        if (Parser$at_expr_start(p)) {
          const e2_2898 = Parser$parse_expr(p);
          const _t2899 = ({_tag: 29, _name: "ESeq", _val: [e_2876, e2_2898]});
          _t2897 = _t2899;
        } else {
          _t2897 = e_2876;
        }
        _t2879 = _t2897;
        break _t2880;
      }
    }
    if (true) {
      _t2879 = e_2876;
      break _t2880;
    }
    _match_fail("line 16933");
  }
  const _t2877 = _t2879;
  return _t2877;
}
function Parser$peek_next_kind(p) {
  let _t2900;
  if (((p.pos + 1) < Array$length(p.tokens))) {
    _t2900 = ({_tag: 1, _name: "Some", _val: Array$get(p.tokens, (p.pos + 1)).kind});
  } else {
    _t2900 = ({_tag: 0, _name: "None"});
  }
  return _t2900;
}
function Parser$parse_fun_param(p) {
  let _t2902;
  const _t2901 = Parser$peek_kind(p);
  _t2903: {
    if (_t2901._tag === 52) {
      Parser$advance(p);
      undefined;
      let _t2904;
      if (_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"}))) {
        Parser$advance(p);
        undefined;
        _t2904 = ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "TyName", _val: "unit"})}), is_generated: false, name: "_"})});
      } else {
        const pat_2905 = Parser$parse_pattern(p);
        let _t2907;
        if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
          const pats_2908 = Ref$create(({_hd: pat_2905, _tl: null}));
          let _t2910 = undefined;
          let _t2911 = false, _t2912;
          while (true) {
            if (!(_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"})))) break;
            Parser$advance(p);
            undefined;
            Ref$set(pats_2908, ({_hd: Parser$parse_pattern(p), _tl: Ref$get(pats_2908)}));
            if (_t2911) break;
          }
          _t2910 = _t2911 ? _t2912 : undefined;
          _t2910;
          const _t2909 = ({_tag: 7, _name: "PatTuple", _val: List$rev(Ref$get(pats_2908))});
          _t2907 = _t2909;
        } else {
          _t2907 = pat_2905;
        }
        const pat_2913 = _t2907;
        let _t2915;
        if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
          Parser$advance(p);
          undefined;
          _t2915 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
        } else {
          _t2915 = ({_tag: 0, _name: "None"});
        }
        const annot_2916 = _t2915;
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        let _t2919;
        const _t2918 = [pat_2913, annot_2916];
        _t2920: {
          if (_t2918[0]._tag === 1) {
            const name = _t2918[0]._val;
            _t2919 = ({_tag: 0, _name: "FPParam", _val: ({annot: annot_2916, is_generated: false, name: name})});
            break _t2920;
          }
          if (true) {
            const pname_2921 = Parser$fresh_param_name(undefined);
            const _t2922 = ({_tag: 1, _name: "FPPat", _val: [pname_2921, pat_2913, annot_2916]});
            _t2919 = _t2922;
            break _t2920;
          }
          _match_fail("line 16933");
        }
        const _t2917 = _t2919;
        const _t2914 = _t2917;
        const _t2906 = _t2914;
        _t2904 = _t2906;
      }
      _t2902 = _t2904;
      break _t2903;
    }
    if (_t2901._tag === 54) {
      const pat_2923 = Parser$parse_pattern_atom(p);
      const pname_2925 = Parser$fresh_param_name(undefined);
      const _t2926 = ({_tag: 1, _name: "FPPat", _val: [pname_2925, pat_2923, ({_tag: 0, _name: "None"})]});
      const _t2924 = _t2926;
      _t2902 = _t2924;
      break _t2903;
    }
    if (_t2901._tag === 8) {
      const s = _t2901._val;
      Parser$advance(p);
      undefined;
      _t2902 = ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: s})});
      break _t2903;
    }
    if (_t2901._tag === 67) {
      Parser$advance(p);
      undefined;
      _t2902 = ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "_"})});
      break _t2903;
    }
    if (true) {
      _t2902 = Parser$error(p, "expected parameter");
      break _t2903;
    }
    _match_fail("line 16933");
  }
  return _t2902;
}
function Parser$parse_fun(p) {
  Parser$expect(p, ({_tag: 16, _name: "FN"}));
  let _t2927;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    undefined;
    const arms_2928 = Ref$create(null);
    const continue__2930 = Ref$create(true);
    let _t2932 = undefined;
    let _t2933 = false, _t2934;
    while (true) {
      if (!(Ref$get(continue__2930))) break;
      const pat_2935 = Parser$parse_pattern(p);
      let _t2937;
      if (_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHEN"}))) {
        Parser$advance(p);
        undefined;
        _t2937 = ({_tag: 1, _name: "Some", _val: Parser$parse_expr(p)});
      } else {
        _t2937 = ({_tag: 0, _name: "None"});
      }
      const guard_2938 = _t2937;
      Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
      const body_2940 = Parser$parse_expr(p);
      Ref$set(arms_2928, ({_hd: [pat_2935, guard_2938, body_2940], _tl: Ref$get(arms_2928)}));
      let _t2942;
      if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
        Parser$advance(p);
        _t2942 = undefined;
      } else {
        _t2942 = Ref$set(continue__2930, false);
      }
      const _t2941 = _t2942;
      const _t2939 = _t2941;
      const _t2936 = _t2939;
      _t2936;
      if (_t2933) break;
    }
    _t2932 = _t2933 ? _t2934 : undefined;
    _t2932;
    const param_2943 = ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__x"});
    const _t2944 = ({_tag: 10, _name: "EFun", _val: [param_2943, ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: "__x"}), List$rev(Ref$get(arms_2928)), false]})]});
    const _t2931 = _t2944;
    const _t2929 = _t2931;
    _t2927 = _t2929;
  } else {
    const fun_params_2945 = Ref$create(null);
    let _t2947 = undefined;
    let _t2948 = false, _t2949;
    while (true) {
      if (!(!_eq(Parser$peek_kind(p), ({_tag: 58, _name: "ARROW"})))) break;
      Ref$set(fun_params_2945, ({_hd: Parser$parse_fun_param(p), _tl: Ref$get(fun_params_2945)}));
      if (_t2948) break;
    }
    _t2947 = _t2948 ? _t2949 : undefined;
    _t2947;
    let _t2950;
    if (_eq(Ref$get(fun_params_2945), null)) {
      _t2950 = Ref$set(fun_params_2945, ({_hd: ({_tag: 0, _name: "FPParam", _val: ({annot: ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "TyName", _val: "unit"})}), is_generated: false, name: "_"})}), _tl: null}));
    } else {
      _t2950 = undefined;
    }
    _t2950;
    Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
    const body_2951 = Parser$parse_expr(p);
    function _t2953(body, fp) {
      let _t2955;
      const _t2954 = fp;
      _t2956: {
        if (_t2954._tag === 0) {
          _t2955 = body;
          break _t2956;
        }
        if (_t2954._tag === 1) {
          const name = _t2954._val[0];
          const pat = _t2954._val[1];
          _t2955 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
          break _t2956;
        }
        _match_fail("line 16933");
      }
      return _t2955;
    }
    const body_2957 = List$fold(_t2953, body_2951, Ref$get(fun_params_2945));
    function _t2959(fp) {
      let _t2961;
      const _t2960 = fp;
      _t2962: {
        if (_t2960._tag === 0) {
          const param = _t2960._val;
          _t2961 = param;
          break _t2962;
        }
        if (_t2960._tag === 1) {
          const name = _t2960._val[0];
          const annot = _t2960._val[2];
          _t2961 = ({annot: annot, is_generated: false, name: name});
          break _t2962;
        }
        _match_fail("line 16933");
      }
      return _t2961;
    }
    const params_2963 = List$map(_t2959, Ref$get(fun_params_2945));
    function _t2965(body, param) {
      return ({_tag: 10, _name: "EFun", _val: [param, body]});
    }
    const _t2964 = List$fold(_t2965, body_2957, params_2963);
    const _t2958 = _t2964;
    const _t2952 = _t2958;
    const _t2946 = _t2952;
    _t2927 = _t2946;
  }
  return _t2927;
}
function Parser$parse_param(p) {
  return Parser$parse_fun_param(p);
}
function Parser$parse_if(p) {
  Parser$expect(p, ({_tag: 14, _name: "IF"}));
  const cond_2966 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 35, _name: "DO"}));
  const then_e_2968 = Parser$parse_expr(p);
  let _t2971;
  const _t2970 = Parser$peek_kind(p);
  _t2972: {
    if (_t2970._tag === 15) {
      Parser$advance(p);
      undefined;
      const else_e_2973 = Parser$parse_expr_no_seq(p);
      const _t2974 = ({_tag: 12, _name: "EIf", _val: [cond_2966, then_e_2968, else_e_2973]});
      _t2971 = _t2974;
      break _t2972;
    }
    if (_t2970._tag === 47) {
      Parser$advance(p);
      undefined;
      _t2971 = ({_tag: 12, _name: "EIf", _val: [cond_2966, then_e_2968, ({_tag: 6, _name: "EUnit"})]});
      break _t2972;
    }
    if (true) {
      _t2971 = Parser$error(p, "expected 'else' or 'end' after if body");
      break _t2972;
    }
    _match_fail("line 16933");
  }
  const _t2969 = _t2971;
  const _t2967 = _t2969;
  return _t2967;
}
function Parser$parse_type_params(p) {
  let _t2975;
  if ((_eq(Parser$peek_kind(p), ({_tag: 52, _name: "LPAREN"})) && _eq(Parser$peek_kind_at(p, 1), ({_tag: 19, _name: "TYPE"})))) {
    Parser$advance(p);
    undefined;
    Parser$advance(p);
    undefined;
    const tyvars_2976 = Ref$create(null);
    let _t2978 = undefined;
    let _t2979 = false, _t2980;
    while (true) {
      let _t2982;
      const _t2981 = Parser$peek_kind(p);
      _t2983: {
        if (_t2981._tag === 10) {
          _t2982 = true;
          break _t2983;
        }
        if (true) {
          _t2982 = false;
          break _t2983;
        }
        _match_fail("line 16933");
      }
      if (!(_t2982)) break;
      let _t2985;
      const _t2984 = Parser$advance(p);
      _t2986: {
        if (_t2984.kind._tag === 10) {
          const s = _t2984.kind._val;
          _t2985 = Ref$set(tyvars_2976, ({_hd: s, _tl: Ref$get(tyvars_2976)}));
          break _t2986;
        }
        if (true) {
          _t2985 = undefined;
          break _t2986;
        }
        _match_fail("line 16933");
      }
      _t2985;
      if (_t2979) break;
    }
    _t2978 = _t2979 ? _t2980 : undefined;
    _t2978;
    let _t2987;
    if (_eq(Ref$get(tyvars_2976), null)) {
      _t2987 = Parser$error(p, "expected type variable after 'type'");
    } else {
      _t2987 = undefined;
    }
    _t2987;
    Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
    const _t2977 = List$rev(Ref$get(tyvars_2976));
    _t2975 = _t2977;
  } else {
    _t2975 = null;
  }
  return _t2975;
}
function Parser$parse_let_expr(p) {
  Parser$expect(p, ({_tag: 11, _name: "LET"}));
  const is_rec_2988 = _eq(Parser$peek_kind(p), ({_tag: 12, _name: "REC"}));
  let _t2990;
  if (is_rec_2988) {
    Parser$advance(p);
    _t2990 = undefined;
  } else {
    _t2990 = undefined;
  }
  _t2990;
  const is_mut_2991 = _eq(Parser$peek_kind(p), ({_tag: 33, _name: "MUT"}));
  let _t2993;
  if (is_mut_2991) {
    Parser$advance(p);
    _t2993 = undefined;
  } else {
    _t2993 = undefined;
  }
  _t2993;
  let _t2994;
  if ((is_rec_2988 && is_mut_2991)) {
    _t2994 = Parser$error(p, "let rec mut is not supported");
  } else {
    _t2994 = undefined;
  }
  _t2994;
  let _t2995;
  if (((!is_rec_2988) && ((!is_mut_2991) && Parser$is_destruct_start(p)))) {
    const pat_2996 = Parser$parse_pattern(p);
    Parser$expect(p, ({_tag: 75, _name: "EQ"}));
    const e1_2998 = Parser$parse_expr(p);
    Parser$expect(p, ({_tag: 13, _name: "IN"}));
    const e2_3000 = Parser$parse_expr(p);
    const _t3001 = ({_tag: 25, _name: "EMatch", _val: [e1_2998, ({_hd: [pat_2996, ({_tag: 0, _name: "None"}), e2_3000], _tl: null}), true]});
    const _t2999 = _t3001;
    const _t2997 = _t2999;
    _t2995 = _t2997;
  } else {
    let _t3002;
    if (is_rec_2988) {
      _t3002 = Parser$parse_type_params(p);
    } else {
      _t3002 = null;
    }
    const type_params_3003 = _t3002;
    const name_3005 = Parser$expect_ident(p);
    let _t3007;
    if (is_mut_2991) {
      let _t3008;
      if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        _t3008 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
      } else {
        _t3008 = ({_tag: 0, _name: "None"});
      }
      const annot_3009 = _t3008;
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const body_3011 = Parser$parse_expr(p);
      let _t3014;
      const _t3013 = annot_3009;
      _t3015: {
        if (_t3013._tag === 1) {
          const ty = _t3013._val;
          _t3014 = ({_tag: 30, _name: "EAnnot", _val: [body_3011, ty]});
          break _t3015;
        }
        if (_t3013._tag === 0) {
          _t3014 = body_3011;
          break _t3015;
        }
        _match_fail("line 16933");
      }
      const body_3016 = _t3014;
      Parser$expect(p, ({_tag: 13, _name: "IN"}));
      const rest_3018 = Parser$parse_expr(p);
      const _t3019 = ({_tag: 26, _name: "ELetMut", _val: [name_3005, body_3016, rest_3018]});
      const _t3017 = _t3019;
      const _t3012 = _t3017;
      const _t3010 = _t3012;
      _t3007 = _t3010;
    } else {
      const params_3020 = Ref$create(null);
      let _t3022 = undefined;
      let _t3023 = false, _t3024;
      while (true) {
        if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && !_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))))) break;
        Ref$set(params_3020, ({_hd: Parser$parse_param(p), _tl: Ref$get(params_3020)}));
        if (_t3023) break;
      }
      _t3022 = _t3023 ? _t3024 : undefined;
      _t3022;
      let _t3025;
      if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        const ty_3026 = Parser$parse_ty(p);
        let _t3028;
        if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
          Parser$advance(p);
          undefined;
          let _t3029;
          if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
            Parser$advance(p);
            undefined;
            _t3029 = ({_tag: 0, _name: "EffAnnotPure"});
          } else {
            _t3029 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
          }
          const eff_3030 = _t3029;
          const _t3031 = ({_tag: 1, _name: "Some", _val: ({_tag: 10, _name: "TyWithEffect", _val: [ty_3026, eff_3030]})});
          _t3028 = _t3031;
        } else {
          _t3028 = ({_tag: 1, _name: "Some", _val: ty_3026});
        }
        const _t3027 = _t3028;
        _t3025 = _t3027;
      } else {
        _t3025 = ({_tag: 0, _name: "None"});
      }
      const ret_annot_3032 = _t3025;
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const body_3034 = Parser$parse_expr(p);
      const full_body_3036 = Parser$wrap_params_expr(List$rev(Ref$get(params_3020)), ret_annot_3032, body_3034);
      let _t3038;
      if ((is_rec_2988 && _eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) {
        const bindings_3039 = Ref$create(({_hd: [name_3005, type_params_3003, full_body_3036], _tl: null}));
        let _t3041 = undefined;
        let _t3042 = false, _t3043;
        while (true) {
          if (!(_eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) break;
          Parser$advance(p);
          undefined;
          const and_name_3044 = Parser$expect_ident(p);
          const and_type_params_3046 = Parser$parse_type_params(p);
          const and_params_3048 = Ref$create(null);
          let _t3050 = undefined;
          let _t3051 = false, _t3052;
          while (true) {
            if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && !_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))))) break;
            Ref$set(and_params_3048, ({_hd: Parser$parse_param(p), _tl: Ref$get(and_params_3048)}));
            if (_t3051) break;
          }
          _t3050 = _t3051 ? _t3052 : undefined;
          _t3050;
          let _t3053;
          if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
            Parser$advance(p);
            undefined;
            const ty_3054 = Parser$parse_ty(p);
            let _t3056;
            if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
              Parser$advance(p);
              undefined;
              let _t3057;
              if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
                Parser$advance(p);
                undefined;
                _t3057 = ({_tag: 0, _name: "EffAnnotPure"});
              } else {
                _t3057 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
              }
              const eff_3058 = _t3057;
              const _t3059 = ({_tag: 1, _name: "Some", _val: ({_tag: 10, _name: "TyWithEffect", _val: [ty_3054, eff_3058]})});
              _t3056 = _t3059;
            } else {
              _t3056 = ({_tag: 1, _name: "Some", _val: ty_3054});
            }
            const _t3055 = _t3056;
            _t3053 = _t3055;
          } else {
            _t3053 = ({_tag: 0, _name: "None"});
          }
          const and_ret_annot_3060 = _t3053;
          Parser$expect(p, ({_tag: 75, _name: "EQ"}));
          const and_body_3062 = Parser$parse_expr(p);
          const and_full_body_3064 = Parser$wrap_params_expr(List$rev(Ref$get(and_params_3048)), and_ret_annot_3060, and_body_3062);
          const _t3065 = Ref$set(bindings_3039, ({_hd: [and_name_3044, and_type_params_3046, and_full_body_3064], _tl: Ref$get(bindings_3039)}));
          const _t3063 = _t3065;
          const _t3061 = _t3063;
          const _t3049 = _t3061;
          const _t3047 = _t3049;
          const _t3045 = _t3047;
          _t3045;
          if (_t3042) break;
        }
        _t3041 = _t3042 ? _t3043 : undefined;
        _t3041;
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const rest_3066 = Parser$parse_expr(p);
        const _t3067 = ({_tag: 38, _name: "ELetRecAnd", _val: [List$rev(Ref$get(bindings_3039)), rest_3066]});
        const _t3040 = _t3067;
        _t3038 = _t3040;
      } else {
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const rest_3068 = Parser$parse_expr(p);
        let _t3070;
        if (is_rec_2988) {
          _t3070 = ({_tag: 9, _name: "ELetRec", _val: [name_3005, type_params_3003, full_body_3036, rest_3068]});
        } else {
          _t3070 = ({_tag: 8, _name: "ELet", _val: [name_3005, full_body_3036, rest_3068]});
        }
        const _t3069 = _t3070;
        _t3038 = _t3069;
      }
      const _t3037 = _t3038;
      const _t3035 = _t3037;
      const _t3033 = _t3035;
      const _t3021 = _t3033;
      _t3007 = _t3021;
    }
    const _t3006 = _t3007;
    const _t3004 = _t3006;
    _t2995 = _t3004;
  }
  const _t2992 = _t2995;
  const _t2989 = _t2992;
  return _t2989;
}
function Parser$is_destruct_start(p) {
  let _t3072;
  const _t3071 = Parser$peek_kind(p);
  _t3073: {
    if ((((_t3071._tag === 52 || _t3071._tag === 54) || _t3071._tag === 56) || _t3071._tag === 9)) {
      _t3072 = true;
      break _t3073;
    }
    if (_t3071._tag === 8) {
      if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 73, _name: "COLONCOLON"}))) {
        _t3072 = true;
        break _t3073;
      }
    }
    if (true) {
      _t3072 = false;
      break _t3073;
    }
    _match_fail("line 16933");
  }
  return _t3072;
}
function Parser$wrap_params_expr(fun_params, ret_annot, body) {
  function _t3074(body, fp) {
    let _t3076;
    const _t3075 = fp;
    _t3077: {
      if (_t3075._tag === 0) {
        _t3076 = body;
        break _t3077;
      }
      if (_t3075._tag === 1) {
        const name = _t3075._val[0];
        const pat = _t3075._val[1];
        _t3076 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
        break _t3077;
      }
      _match_fail("line 16933");
    }
    return _t3076;
  }
  const body_3078 = List$fold(_t3074, body, fun_params);
  function _t3080(fp) {
    let _t3082;
    const _t3081 = fp;
    _t3083: {
      if (_t3081._tag === 0) {
        const param = _t3081._val;
        _t3082 = param;
        break _t3083;
      }
      if (_t3081._tag === 1) {
        const name = _t3081._val[0];
        const annot = _t3081._val[2];
        _t3082 = ({annot: annot, is_generated: true, name: name});
        break _t3083;
      }
      _match_fail("line 16933");
    }
    return _t3082;
  }
  const params_3084 = List$map(_t3080, fun_params);
  let _t3087;
  const _t3086 = ret_annot;
  _t3088: {
    if (_t3086._tag === 1 && _t3086._val._tag === 10) {
      const ret_ty = _t3086._val._val[0];
      const eff_annot = _t3086._val._val[1];
      if (!_eq(params_3084, null)) {
        const body_3089 = ({_tag: 30, _name: "EAnnot", _val: [body_3078, ret_ty]});
        function _t3091(param, body) {
          return ({_tag: 10, _name: "EFun", _val: [param, body]});
        }
        const full_fun_3092 = List$fold_right(_t3091, params_3084, body_3089);
        function build_arrow(__x) {
          let _t3095;
          const _t3094 = __x;
          _t3096: {
            if (_t3094 === null) {
              _t3095 = ret_ty;
              break _t3096;
            }
            if (_t3094 !== null && _t3094._tl === null) {
              const p = _t3094._hd;
              let _t3098;
              const _t3097 = p.annot;
              _t3099: {
                if (_t3097._tag === 1) {
                  const t = _t3097._val;
                  _t3098 = t;
                  break _t3099;
                }
                if (_t3097._tag === 0) {
                  _t3098 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t3099;
                }
                _match_fail("line 16933");
              }
              const pty_3100 = _t3098;
              const _t3101 = ({_tag: 2, _name: "TyArrow", _val: [pty_3100, ret_ty, ({_tag: 1, _name: "Some", _val: eff_annot})]});
              _t3095 = _t3101;
              break _t3096;
            }
            if (_t3094 !== null) {
              const p = _t3094._hd;
              const rest = _t3094._tl;
              let _t3103;
              const _t3102 = p.annot;
              _t3104: {
                if (_t3102._tag === 1) {
                  const t = _t3102._val;
                  _t3103 = t;
                  break _t3104;
                }
                if (_t3102._tag === 0) {
                  _t3103 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t3104;
                }
                _match_fail("line 16933");
              }
              const pty_3105 = _t3103;
              const _t3106 = ({_tag: 2, _name: "TyArrow", _val: [pty_3105, build_arrow(rest), ({_tag: 0, _name: "None"})]});
              _t3095 = _t3106;
              break _t3096;
            }
            _match_fail("line 16933");
          }
          return _t3095;
        }
        const _t3107 = ({_tag: 30, _name: "EAnnot", _val: [full_fun_3092, build_arrow(params_3084)]});
        const _t3093 = _t3107;
        const _t3090 = _t3093;
        _t3087 = _t3090;
        break _t3088;
      }
    }
    if (true) {
      let _t3109;
      const _t3108 = ret_annot;
      _t3110: {
        if (_t3108._tag === 1) {
          const ty = _t3108._val;
          _t3109 = ({_tag: 30, _name: "EAnnot", _val: [body_3078, ty]});
          break _t3110;
        }
        if (_t3108._tag === 0) {
          _t3109 = body_3078;
          break _t3110;
        }
        _match_fail("line 16933");
      }
      const body_3111 = _t3109;
      function _t3113(param, body) {
        return ({_tag: 10, _name: "EFun", _val: [param, body]});
      }
      const _t3112 = List$fold_right(_t3113, params_3084, body_3111);
      _t3087 = _t3112;
      break _t3088;
    }
    _match_fail("line 16933");
  }
  const _t3085 = _t3087;
  const _t3079 = _t3085;
  return _t3079;
}
function Parser$parse_match(p, partial) {
  Parser$expect(p, ({_tag: 17, _name: "MATCH"}));
  const scrut_3114 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t3116;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    _t3116 = undefined;
  } else {
    _t3116 = undefined;
  }
  _t3116;
  const arms_3117 = Ref$create(null);
  const continue__3119 = Ref$create(true);
  let _t3121 = undefined;
  let _t3122 = false, _t3123;
  while (true) {
    if (!(Ref$get(continue__3119))) break;
    const pat_3124 = Parser$parse_pattern(p);
    let _t3126;
    if (_eq(Parser$peek_kind(p), ({_tag: 37, _name: "WHEN"}))) {
      Parser$advance(p);
      undefined;
      _t3126 = ({_tag: 1, _name: "Some", _val: Parser$parse_expr(p)});
    } else {
      _t3126 = ({_tag: 0, _name: "None"});
    }
    const guard_3127 = _t3126;
    Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
    const body_3129 = Parser$parse_expr(p);
    Ref$set(arms_3117, ({_hd: [pat_3124, guard_3127, body_3129], _tl: Ref$get(arms_3117)}));
    let _t3131;
    if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
      Parser$advance(p);
      _t3131 = undefined;
    } else {
      _t3131 = Ref$set(continue__3119, false);
    }
    const _t3130 = _t3131;
    const _t3128 = _t3130;
    const _t3125 = _t3128;
    _t3125;
    if (_t3122) break;
  }
  _t3121 = _t3122 ? _t3123 : undefined;
  _t3121;
  const _t3120 = ({_tag: 25, _name: "EMatch", _val: [scrut_3114, List$rev(Ref$get(arms_3117)), partial]});
  const _t3118 = _t3120;
  const _t3115 = _t3118;
  return _t3115;
}
function Parser$parse_handle_expr(p) {
  Parser$expect(p, ({_tag: 27, _name: "HANDLE"}));
  const body_3132 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t3134;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    _t3134 = undefined;
  } else {
    _t3134 = undefined;
  }
  _t3134;
  const arms_3135 = Ref$create(null);
  const continue_parsing_3137 = Ref$create(true);
  let _t3139 = undefined;
  let _t3140 = false, _t3141;
  while (true) {
    if (!(Ref$get(continue_parsing_3137))) break;
    let _t3143;
    const _t3142 = Parser$peek_kind(p);
    _t3144: {
      if (_t3142._tag === 32) {
        Parser$advance(p);
        undefined;
        const name_3145 = Parser$expect_ident(p);
        Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
        const handler_body_3147 = Parser$parse_expr(p);
        Ref$set(arms_3135, ({_hd: ({_tag: 0, _name: "HReturn", _val: [name_3145, handler_body_3147]}), _tl: Ref$get(arms_3135)}));
        let _t3149;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t3149 = undefined;
        } else {
          _t3149 = Ref$set(continue_parsing_3137, false);
        }
        const _t3148 = _t3149;
        const _t3146 = _t3148;
        _t3143 = _t3146;
        break _t3144;
      }
      if (_t3142._tag === 8) {
        const s = _t3142._val;
        Parser$advance(p);
        undefined;
        let _t3151;
        const _t3150 = Parser$peek_kind(p);
        _t3152: {
          if (_t3150._tag === 58) {
            _t3151 = ["_", "__k"];
            break _t3152;
          }
          if (_t3150._tag === 52) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 53, _name: "RPAREN"}))) {
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              let _t3153;
              if (_eq(Parser$peek_kind(p), ({_tag: 58, _name: "ARROW"}))) {
                _t3153 = ["_", "__k"];
              } else {
                _t3153 = ["_", Parser$expect_ident(p)];
              }
              _t3151 = _t3153;
              break _t3152;
            }
          }
          if (_t3150._tag === 8) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 58, _name: "ARROW"}))) {
              _t3151 = ["_", Parser$expect_ident(p)];
              break _t3152;
            }
          }
          if (true) {
            const arg_3154 = Parser$expect_ident(p);
            const k_3156 = Parser$expect_ident(p);
            const _t3157 = [arg_3154, k_3156];
            const _t3155 = _t3157;
            _t3151 = _t3155;
            break _t3152;
          }
          _match_fail("line 16933");
        }
        let _t3159;
        const _t3158 = _t3151;
        _t3160: {
          if (true) {
            const arg_name = _t3158[0];
            const k_name = _t3158[1];
            Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
            const handler_body_3161 = Parser$parse_expr(p);
            Ref$set(arms_3135, ({_hd: ({_tag: 1, _name: "HOp", _val: [s, arg_name, k_name, handler_body_3161]}), _tl: Ref$get(arms_3135)}));
            let _t3163;
            if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
              Parser$advance(p);
              _t3163 = undefined;
            } else {
              _t3163 = Ref$set(continue_parsing_3137, false);
            }
            const _t3162 = _t3163;
            _t3159 = _t3162;
            break _t3160;
          }
          _match_fail("line 16933");
        }
        _t3143 = _t3159;
        break _t3144;
      }
      if (true) {
        _t3143 = Ref$set(continue_parsing_3137, false);
        break _t3144;
      }
      _match_fail("line 16933");
    }
    _t3143;
    if (_t3140) break;
  }
  _t3139 = _t3140 ? _t3141 : undefined;
  _t3139;
  const _t3138 = ({_tag: 40, _name: "EHandle", _val: [body_3132, List$rev(Ref$get(arms_3135))]});
  const _t3136 = _t3138;
  const _t3133 = _t3136;
  return _t3133;
}
function Parser$parse_try_expr(p) {
  Parser$expect(p, ({_tag: 28, _name: "TRY"}));
  const body_3164 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t3166;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    _t3166 = undefined;
  } else {
    _t3166 = undefined;
  }
  _t3166;
  const arms_3167 = Ref$create(({_hd: ({_tag: 0, _name: "HReturn", _val: ["__x", ({_tag: 7, _name: "EVar", _val: "__x"})]}), _tl: null}));
  const continue_parsing_3169 = Ref$create(true);
  let _t3171 = undefined;
  let _t3172 = false, _t3173;
  while (true) {
    if (!(Ref$get(continue_parsing_3169))) break;
    let _t3175;
    const _t3174 = Parser$peek_kind(p);
    _t3176: {
      if (_t3174._tag === 8) {
        const s = _t3174._val;
        Parser$advance(p);
        undefined;
        let _t3178;
        const _t3177 = Parser$peek_kind(p);
        _t3179: {
          if (_t3177._tag === 58) {
            _t3178 = "_";
            break _t3179;
          }
          if (_t3177._tag === 52) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 53, _name: "RPAREN"}))) {
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t3178 = "_";
              break _t3179;
            }
          }
          if (true) {
            _t3178 = Parser$expect_ident(p);
            break _t3179;
          }
          _match_fail("line 16933");
        }
        const arg_name_3180 = _t3178;
        Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
        const handler_body_3182 = Parser$parse_expr(p);
        Ref$set(arms_3167, ({_hd: ({_tag: 1, _name: "HOp", _val: [s, arg_name_3180, "__k", handler_body_3182]}), _tl: Ref$get(arms_3167)}));
        let _t3184;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t3184 = undefined;
        } else {
          _t3184 = Ref$set(continue_parsing_3169, false);
        }
        const _t3183 = _t3184;
        const _t3181 = _t3183;
        _t3175 = _t3181;
        break _t3176;
      }
      if (true) {
        _t3175 = Ref$set(continue_parsing_3169, false);
        break _t3176;
      }
      _match_fail("line 16933");
    }
    _t3175;
    if (_t3172) break;
  }
  _t3171 = _t3172 ? _t3173 : undefined;
  _t3171;
  const _t3170 = ({_tag: 40, _name: "EHandle", _val: [body_3164, List$rev(Ref$get(arms_3167))]});
  const _t3168 = _t3170;
  const _t3165 = _t3168;
  return _t3165;
}
function Parser$parse_provide_expr(p) {
  Parser$expect(p, ({_tag: 29, _name: "PROVIDE"}));
  const body_3185 = Parser$parse_expr(p);
  Parser$expect(p, ({_tag: 18, _name: "WITH"}));
  let _t3187;
  if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
    Parser$advance(p);
    _t3187 = undefined;
  } else {
    _t3187 = undefined;
  }
  _t3187;
  const arms_3188 = Ref$create(({_hd: ({_tag: 0, _name: "HReturn", _val: ["__x", ({_tag: 7, _name: "EVar", _val: "__x"})]}), _tl: null}));
  const continue_parsing_3190 = Ref$create(true);
  let _t3192 = undefined;
  let _t3193 = false, _t3194;
  while (true) {
    if (!(Ref$get(continue_parsing_3190))) break;
    let _t3196;
    const _t3195 = Parser$peek_kind(p);
    _t3197: {
      if (_t3195._tag === 8) {
        const s = _t3195._val;
        Parser$advance(p);
        undefined;
        let _t3199;
        const _t3198 = Parser$peek_kind(p);
        _t3200: {
          if (_t3198._tag === 58) {
            _t3199 = "_";
            break _t3200;
          }
          if (_t3198._tag === 52) {
            if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 53, _name: "RPAREN"}))) {
              Parser$advance(p);
              undefined;
              Parser$advance(p);
              undefined;
              _t3199 = "_";
              break _t3200;
            }
          }
          if (true) {
            _t3199 = Parser$expect_ident(p);
            break _t3200;
          }
          _match_fail("line 16933");
        }
        const arg_name_3201 = _t3199;
        Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
        const handler_body_3203 = Parser$parse_expr(p);
        const resume_expr_3205 = ({_tag: 41, _name: "EResume", _val: [({_tag: 7, _name: "EVar", _val: "__k"}), handler_body_3203]});
        Ref$set(arms_3188, ({_hd: ({_tag: 1, _name: "HOp", _val: [s, arg_name_3201, "__k", resume_expr_3205]}), _tl: Ref$get(arms_3188)}));
        let _t3207;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t3207 = undefined;
        } else {
          _t3207 = Ref$set(continue_parsing_3190, false);
        }
        const _t3206 = _t3207;
        const _t3204 = _t3206;
        const _t3202 = _t3204;
        _t3196 = _t3202;
        break _t3197;
      }
      if (true) {
        _t3196 = Ref$set(continue_parsing_3190, false);
        break _t3197;
      }
      _match_fail("line 16933");
    }
    _t3196;
    if (_t3193) break;
  }
  _t3192 = _t3193 ? _t3194 : undefined;
  _t3192;
  const _t3191 = ({_tag: 40, _name: "EHandle", _val: [body_3185, List$rev(Ref$get(arms_3188))]});
  const _t3189 = _t3191;
  const _t3186 = _t3189;
  return _t3186;
}
function Parser$lookahead_in_after_balanced(p) {
  const depth_3208 = Ref$create(1);
  const i_3210 = Ref$create(1);
  const hit_eof_3212 = Ref$create(false);
  let _t3214 = undefined;
  let _t3215 = false, _t3216;
  while (true) {
    if (!(((Ref$get(depth_3208) > 0) && (!Ref$get(hit_eof_3212))))) break;
    let _t3218;
    const _t3217 = Parser$peek_kind_at(p, Ref$get(i_3210));
    _t3219: {
      if (((_t3217._tag === 52 || _t3217._tag === 54) || _t3217._tag === 56)) {
        _t3218 = Ref$set(depth_3208, (Ref$get(depth_3208) + 1));
        break _t3219;
      }
      if (((_t3217._tag === 53 || _t3217._tag === 55) || _t3217._tag === 57)) {
        _t3218 = Ref$set(depth_3208, (Ref$get(depth_3208) - 1));
        break _t3219;
      }
      if (_t3217._tag === 92) {
        _t3218 = Ref$set(hit_eof_3212, true);
        break _t3219;
      }
      if (true) {
        _t3218 = undefined;
        break _t3219;
      }
      _match_fail("line 16933");
    }
    _t3218;
    Ref$set(i_3210, (Ref$get(i_3210) + 1));
    if (_t3215) break;
  }
  _t3214 = _t3215 ? _t3216 : undefined;
  _t3214;
  const _t3213 = ((!Ref$get(hit_eof_3212)) && ((Ref$get(depth_3208) === 0) && _eq(Parser$peek_kind_at(p, Ref$get(i_3210)), ({_tag: 13, _name: "IN"}))));
  const _t3211 = _t3213;
  const _t3209 = _t3211;
  return _t3209;
}
function Parser$pat_to_name_and_wrap(pat) {
  let _t3221;
  const _t3220 = pat;
  _t3222: {
    if (_t3220._tag === 1) {
      const name = _t3220._val;
      function _t3223(body) {
        return body;
      }
      _t3221 = [name, _t3223];
      break _t3222;
    }
    if (_t3220._tag === 0) {
      function _t3224(body) {
        return body;
      }
      _t3221 = ["_", _t3224];
      break _t3222;
    }
    if (true) {
      const pname_3225 = Parser$fresh_param_name(undefined);
      function _t3227(body) {
        return ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: pname_3225}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
      }
      const _t3226 = [pname_3225, _t3227];
      _t3221 = _t3226;
      break _t3222;
    }
    _match_fail("line 16933");
  }
  return _t3221;
}
function Parser$parse_for_in_rest(p, elem_name, elem_wrap, coll) {
  let _t3229;
  const _t3228 = Parser$peek_kind(p);
  _t3230: {
    if (_t3228._tag === 18) {
      Parser$advance(p);
      undefined;
      let _t3232;
      const _t3231 = Parser$peek_kind(p);
      _t3233: {
        if (((_t3231._tag === 52 || _t3231._tag === 54) || _t3231._tag === 56)) {
          _t3232 = Parser$parse_pattern_atom(p);
          break _t3233;
        }
        if (true) {
          const name_3234 = Parser$expect_ident(p);
          const _t3235 = ({_tag: 1, _name: "PatVar", _val: name_3234});
          _t3232 = _t3235;
          break _t3233;
        }
        _match_fail("line 16933");
      }
      const acc_pat_3236 = _t3232;
      let _t3239;
      const _t3238 = Parser$pat_to_name_and_wrap(acc_pat_3236);
      _t3240: {
        if (true) {
          const acc_name = _t3238[0];
          const acc_wrap = _t3238[1];
          Parser$expect(p, ({_tag: 75, _name: "EQ"}));
          const init_3241 = Parser$parse_expr_bp(p, 0);
          Parser$expect(p, ({_tag: 35, _name: "DO"}));
          const body_3243 = Parser$parse_expr(p);
          Parser$expect(p, ({_tag: 47, _name: "END"}));
          const _t3244 = ({_tag: 33, _name: "EForFold", _val: [elem_name, coll, acc_name, init_3241, elem_wrap(acc_wrap(body_3243))]});
          const _t3242 = _t3244;
          _t3239 = _t3242;
          break _t3240;
        }
        _match_fail("line 16933");
      }
      const _t3237 = _t3239;
      _t3229 = _t3237;
      break _t3230;
    }
    if (_t3228._tag === 35) {
      Parser$advance(p);
      undefined;
      const body_3245 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t3246 = ({_tag: 32, _name: "EFor", _val: [elem_name, coll, elem_wrap(body_3245)]});
      _t3229 = _t3246;
      break _t3230;
    }
    if (true) {
      _t3229 = Parser$error(p, "expected 'do' or 'with' after for collection");
      break _t3230;
    }
    _match_fail("line 16933");
  }
  return _t3229;
}
function Parser$parse_for_expr(p) {
  Parser$expect(p, ({_tag: 34, _name: "FOR"}));
  let _t3248;
  const _t3247 = Parser$peek_kind(p);
  _t3249: {
    if (_t3247._tag === 35) {
      Parser$advance(p);
      undefined;
      const body_3250 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t3251 = ({_tag: 31, _name: "EWhile", _val: [({_tag: 2, _name: "EBool", _val: true}), body_3250]});
      _t3248 = _t3251;
      break _t3249;
    }
    if (_t3247._tag === 11) {
      Parser$advance(p);
      undefined;
      const pat_3252 = Parser$parse_pattern(p);
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const scrutinee_3254 = Parser$parse_expr_bp(p, 0);
      Parser$expect(p, ({_tag: 35, _name: "DO"}));
      const body_3256 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t3257 = ({_tag: 34, _name: "EWhileLet", _val: [pat_3252, scrutinee_3254, body_3256]});
      const _t3255 = _t3257;
      const _t3253 = _t3255;
      _t3248 = _t3253;
      break _t3249;
    }
    if ((_t3247._tag === 8 || _t3247._tag === 67)) {
      if (_eq(Parser$peek_kind_at(p, 1), ({_tag: 13, _name: "IN"}))) {
        let _t3258;
        if (_eq(Parser$peek_kind(p), ({_tag: 67, _name: "UNDERSCORE"}))) {
          Parser$advance(p);
          undefined;
          _t3258 = "_";
        } else {
          _t3258 = Parser$expect_ident(p);
        }
        const var_name_3259 = _t3258;
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const coll_3261 = Parser$parse_expr_bp(p, 0);
        function _t3263(body) {
          return body;
        }
        const _t3262 = Parser$parse_for_in_rest(p, var_name_3259, _t3263, coll_3261);
        const _t3260 = _t3262;
        _t3248 = _t3260;
        break _t3249;
      }
    }
    if (((_t3247._tag === 52 || _t3247._tag === 54) || _t3247._tag === 56)) {
      if (Parser$lookahead_in_after_balanced(p)) {
        const pat_3264 = Parser$parse_pattern_atom(p);
        Parser$expect(p, ({_tag: 13, _name: "IN"}));
        const coll_3266 = Parser$parse_expr_bp(p, 0);
        let _t3269;
        const _t3268 = Parser$pat_to_name_and_wrap(pat_3264);
        _t3270: {
          if (true) {
            const elem_name = _t3268[0];
            const elem_wrap = _t3268[1];
            _t3269 = Parser$parse_for_in_rest(p, elem_name, elem_wrap, coll_3266);
            break _t3270;
          }
          _match_fail("line 16933");
        }
        const _t3267 = _t3269;
        const _t3265 = _t3267;
        _t3248 = _t3265;
        break _t3249;
      }
    }
    if (true) {
      const cond_3271 = Parser$parse_expr_bp(p, 0);
      Parser$expect(p, ({_tag: 35, _name: "DO"}));
      const body_3273 = Parser$parse_expr(p);
      Parser$expect(p, ({_tag: 47, _name: "END"}));
      const _t3274 = ({_tag: 31, _name: "EWhile", _val: [cond_3271, body_3273]});
      const _t3272 = _t3274;
      _t3248 = _t3272;
      break _t3249;
    }
    _match_fail("line 16933");
  }
  return _t3248;
}
function Parser$parse_record_fields(p) {
  const fields_3275 = Ref$create(null);
  const first_3277 = Ref$create(true);
  let _t3279 = undefined;
  let _t3280 = false, _t3281;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
    let _t3282;
    if ((!Ref$get(first_3277))) {
      _t3282 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
    } else {
      _t3282 = undefined;
    }
    _t3282;
    let _t3283;
    if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
      _t3283 = undefined;
    } else {
      Ref$set(first_3277, false);
      const name_3284 = Parser$expect_ident(p);
      let _t3286;
      if (_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"}))) {
        Parser$advance(p);
        undefined;
        _t3286 = Parser$parse_expr_bp(p, 0);
      } else {
        _t3286 = ({_tag: 7, _name: "EVar", _val: name_3284});
      }
      const expr_3287 = _t3286;
      const _t3288 = Ref$set(fields_3275, ({_hd: [name_3284, expr_3287], _tl: Ref$get(fields_3275)}));
      const _t3285 = _t3288;
      _t3283 = _t3285;
    }
    _t3283;
    if (_t3280) break;
  }
  _t3279 = _t3280 ? _t3281 : undefined;
  _t3279;
  const _t3278 = List$rev(Ref$get(fields_3275));
  const _t3276 = _t3278;
  return _t3276;
}
function Parser$parse_map_pairs(p) {
  let _t3289;
  if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
    _t3289 = null;
  } else {
    const pairs_3290 = Ref$create(null);
    const first_3292 = Ref$create(true);
    let _t3294 = undefined;
    let _t3295 = false, _t3296;
    while (true) {
      if (!(!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"})))) break;
      let _t3297;
      if ((!Ref$get(first_3292))) {
        _t3297 = Parser$expect(p, ({_tag: 60, _name: "SEMICOLON"}));
      } else {
        _t3297 = undefined;
      }
      _t3297;
      Ref$set(first_3292, false);
      const key_3298 = Parser$parse_expr_bp(p, 0);
      Parser$expect(p, ({_tag: 62, _name: "COLON"}));
      const value_3300 = Parser$parse_expr_bp(p, 0);
      const _t3301 = Ref$set(pairs_3290, ({_hd: [key_3298, value_3300], _tl: Ref$get(pairs_3290)}));
      const _t3299 = _t3301;
      _t3299;
      if (_t3295) break;
    }
    _t3294 = _t3295 ? _t3296 : undefined;
    _t3294;
    const _t3293 = List$rev(Ref$get(pairs_3290));
    const _t3291 = _t3293;
    _t3289 = _t3291;
  }
  return _t3289;
}
function Parser$parse_set_or_map(p) {
  let _t3302;
  if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
    _t3302 = ({_tag: 887353506, _name: "`Map", _val: null});
  } else {
    const first_expr_3303 = Parser$parse_expr_bp(p, 0);
    let _t3305;
    if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
      Parser$advance(p);
      undefined;
      const first_val_3306 = Parser$parse_expr_bp(p, 0);
      const pairs_3308 = Ref$create(({_hd: [first_expr_3303, first_val_3306], _tl: null}));
      let _t3310 = undefined;
      let _t3311 = false, _t3312;
      while (true) {
        if (!(_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"})))) break;
        Parser$advance(p);
        undefined;
        let _t3313;
        if (!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
          const key_3314 = Parser$parse_expr_bp(p, 0);
          Parser$expect(p, ({_tag: 62, _name: "COLON"}));
          const value_3316 = Parser$parse_expr_bp(p, 0);
          const _t3317 = Ref$set(pairs_3308, ({_hd: [key_3314, value_3316], _tl: Ref$get(pairs_3308)}));
          const _t3315 = _t3317;
          _t3313 = _t3315;
        } else {
          _t3313 = undefined;
        }
        _t3313;
        if (_t3311) break;
      }
      _t3310 = _t3311 ? _t3312 : undefined;
      _t3310;
      const _t3309 = ({_tag: 887353506, _name: "`Map", _val: List$rev(Ref$get(pairs_3308))});
      const _t3307 = _t3309;
      _t3305 = _t3307;
    } else {
      let _t3318;
      if (_eq(Parser$peek_kind(p), ({_tag: 18, _name: "WITH"}))) {
        Parser$advance(p);
        undefined;
        const pairs_3319 = Ref$create(null);
        const continue__3321 = Ref$create(true);
        let _t3323 = undefined;
        let _t3324 = false, _t3325;
        while (true) {
          if (!(Ref$get(continue__3321))) break;
          const key_3326 = Parser$parse_expr_bp(p, 0);
          Parser$expect(p, ({_tag: 62, _name: "COLON"}));
          const value_3328 = Parser$parse_expr_bp(p, 0);
          Ref$set(pairs_3319, ({_hd: [key_3326, value_3328], _tl: Ref$get(pairs_3319)}));
          let _t3330;
          if (_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"}))) {
            Parser$advance(p);
            undefined;
            let _t3331;
            if (_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
              _t3331 = Ref$set(continue__3321, false);
            } else {
              _t3331 = undefined;
            }
            _t3330 = _t3331;
          } else {
            _t3330 = Ref$set(continue__3321, false);
          }
          const _t3329 = _t3330;
          const _t3327 = _t3329;
          _t3327;
          if (_t3324) break;
        }
        _t3323 = _t3324 ? _t3325 : undefined;
        _t3323;
        function _t3332(acc, __p60) {
          let _t3334;
          const _t3333 = __p60;
          _t3335: {
            if (true) {
              const k = _t3333[0];
              const v = _t3333[1];
              _t3334 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "set"}), k]}), v]}), acc]});
              break _t3335;
            }
            _match_fail("line 16933");
          }
          return _t3334;
        }
        const result_3336 = List$fold(_t3332, first_expr_3303, List$rev(Ref$get(pairs_3319)));
        const _t3337 = ({_tag: 533146490, _name: "`Update", _val: result_3336});
        const _t3322 = _t3337;
        const _t3320 = _t3322;
        _t3318 = _t3320;
      } else {
        const elems_3338 = Ref$create(({_hd: first_expr_3303, _tl: null}));
        let _t3340 = undefined;
        let _t3341 = false, _t3342;
        while (true) {
          if (!(_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"})))) break;
          Parser$advance(p);
          undefined;
          let _t3343;
          if (!_eq(Parser$peek_kind(p), ({_tag: 55, _name: "RBRACE"}))) {
            _t3343 = Ref$set(elems_3338, ({_hd: Parser$parse_expr_bp(p, 0), _tl: Ref$get(elems_3338)}));
          } else {
            _t3343 = undefined;
          }
          _t3343;
          if (_t3341) break;
        }
        _t3340 = _t3341 ? _t3342 : undefined;
        _t3340;
        const _t3339 = ({_tag: 98602162, _name: "`Set", _val: List$rev(Ref$get(elems_3338))});
        _t3318 = _t3339;
      }
      _t3305 = _t3318;
    }
    const _t3304 = _t3305;
    _t3302 = _t3304;
  }
  return _t3302;
}
function Parser$parse_list_elems(p) {
  const first_3344 = Parser$parse_expr_bp(p, 0);
  const elems_3346 = Ref$create(({_hd: first_3344, _tl: null}));
  let _t3348 = undefined;
  let _t3349 = false, _t3350;
  while (true) {
    if (!(_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"})))) break;
    Parser$advance(p);
    undefined;
    let _t3351;
    if (!_eq(Parser$peek_kind(p), ({_tag: 57, _name: "RBRACKET"}))) {
      _t3351 = Ref$set(elems_3346, ({_hd: Parser$parse_expr_bp(p, 0), _tl: Ref$get(elems_3346)}));
    } else {
      _t3351 = undefined;
    }
    _t3351;
    if (_t3349) break;
  }
  _t3348 = _t3349 ? _t3350 : undefined;
  _t3348;
  const _t3347 = List$rev(Ref$get(elems_3346));
  const _t3345 = _t3347;
  return _t3345;
}
function Parser$is_tyvar_token(__x) {
  let _t3353;
  const _t3352 = __x;
  _t3354: {
    if (_t3352._tag === 10) {
      _t3353 = true;
      break _t3354;
    }
    if (true) {
      _t3353 = false;
      break _t3354;
    }
    _match_fail("line 16933");
  }
  return _t3353;
}
function Parser$decompose_gadt_sig(ty) {
  function collect_args(__x) {
    let _t3356;
    const _t3355 = __x;
    _t3357: {
      if (_t3355._tag === 2) {
        const arg = _t3355._val[0];
        const rest = _t3355._val[1];
        let _t3359;
        const _t3358 = collect_args(rest);
        _t3360: {
          if (true) {
            const more_args = _t3358[0];
            const ret = _t3358[1];
            _t3359 = [({_hd: arg, _tl: more_args}), ret];
            break _t3360;
          }
          _match_fail("line 16933");
        }
        _t3356 = _t3359;
        break _t3357;
      }
      if (true) {
        const other = _t3355;
        _t3356 = [null, other];
        break _t3357;
      }
      _match_fail("line 16933");
    }
    return _t3356;
  }
  let _t3363;
  const _t3362 = collect_args(ty);
  _t3364: {
    if (_t3362[0] === null) {
      const ret = _t3362[1];
      _t3363 = [({_tag: 0, _name: "None"}), ret];
      break _t3364;
    }
    if (_t3362[0] !== null && _t3362[0]._tl === null) {
      const arg = _t3362[0]._hd;
      const ret = _t3362[1];
      _t3363 = [({_tag: 1, _name: "Some", _val: arg}), ret];
      break _t3364;
    }
    if (true) {
      const args = _t3362[0];
      const ret = _t3362[1];
      _t3363 = [({_tag: 1, _name: "Some", _val: ({_tag: 6, _name: "TyTuple", _val: args})}), ret];
      break _t3364;
    }
    _match_fail("line 16933");
  }
  const _t3361 = _t3363;
  return _t3361;
}
function Parser$parse_type_decl(p) {
  Parser$expect(p, ({_tag: 19, _name: "TYPE"}));
  let _t3366;
  const _t3365 = Parser$peek_kind(p);
  _t3367: {
    if (_t3365._tag === 10) {
      const s = _t3365._val;
      Parser$advance(p);
      undefined;
      _t3366 = ({_hd: s, _tl: null});
      break _t3367;
    }
    if (_t3365._tag === 52) {
      if (Parser$is_tyvar_token(Parser$peek_kind_at(p, 1))) {
        Parser$advance(p);
        undefined;
        const params_3368 = Ref$create(null);
        const first_3370 = Ref$create(true);
        let _t3372 = undefined;
        let _t3373 = false, _t3374;
        while (true) {
          if (!(!_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"})))) break;
          let _t3375;
          if ((!Ref$get(first_3370))) {
            _t3375 = Parser$expect(p, ({_tag: 59, _name: "COMMA"}));
          } else {
            _t3375 = undefined;
          }
          _t3375;
          Ref$set(first_3370, false);
          let _t3377;
          const _t3376 = Parser$peek_kind(p);
          _t3378: {
            if (_t3376._tag === 10) {
              const s = _t3376._val;
              Parser$advance(p);
              undefined;
              _t3377 = Ref$set(params_3368, ({_hd: s, _tl: Ref$get(params_3368)}));
              break _t3378;
            }
            if (true) {
              _t3377 = Parser$error(p, "expected type variable in type parameter list");
              break _t3378;
            }
            _match_fail("line 16933");
          }
          _t3377;
          if (_t3373) break;
        }
        _t3372 = _t3373 ? _t3374 : undefined;
        _t3372;
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        const _t3371 = List$rev(Ref$get(params_3368));
        const _t3369 = _t3371;
        _t3366 = _t3369;
        break _t3367;
      }
    }
    if (true) {
      _t3366 = null;
      break _t3367;
    }
    _match_fail("line 16933");
  }
  const type_params_3379 = _t3366;
  const name_3381 = Parser$expect_ident(p);
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  let _t3384;
  const _t3383 = Parser$peek_kind(p);
  _t3385: {
    if (_t3383._tag === 54) {
      Parser$advance(p);
      undefined;
      let _t3387;
      const _t3386 = Parser$parse_ty_record_fields(p);
      _t3388: {
        if (true) {
          const fields = _t3386[0];
          const _is_open = _t3386[1];
          Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
          _t3387 = ({_tag: 1, _name: "TDRecord", _val: fields});
          break _t3388;
        }
        _match_fail("line 16933");
      }
      _t3384 = _t3387;
      break _t3385;
    }
    if ((_t3383._tag === 65 || _t3383._tag === 9)) {
      let _t3389;
      if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
        Parser$advance(p);
        _t3389 = undefined;
      } else {
        _t3389 = undefined;
      }
      _t3389;
      const ctors_3390 = Ref$create(null);
      const continue__3392 = Ref$create(true);
      let _t3394 = undefined;
      let _t3395 = false, _t3396;
      while (true) {
        if (!(Ref$get(continue__3392))) break;
        const ctor_name_3397 = Parser$expect_uident(p);
        let _t3399;
        if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
          Parser$advance(p);
          undefined;
          const full_sig_3400 = Parser$parse_ty(p);
          let _t3403;
          const _t3402 = Parser$decompose_gadt_sig(full_sig_3400);
          _t3404: {
            if (true) {
              const arg_ty = _t3402[0];
              const ret_ty = _t3402[1];
              _t3403 = Ref$set(ctors_3390, ({_hd: [ctor_name_3397, arg_ty, ({_tag: 1, _name: "Some", _val: ret_ty})], _tl: Ref$get(ctors_3390)}));
              break _t3404;
            }
            _match_fail("line 16933");
          }
          const _t3401 = _t3403;
          _t3399 = _t3401;
        } else {
          let _t3405;
          if (_eq(Parser$peek_kind(p), ({_tag: 21, _name: "OF"}))) {
            Parser$advance(p);
            undefined;
            _t3405 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
          } else {
            _t3405 = ({_tag: 0, _name: "None"});
          }
          const arg_3406 = _t3405;
          const _t3407 = Ref$set(ctors_3390, ({_hd: [ctor_name_3397, arg_3406, ({_tag: 0, _name: "None"})], _tl: Ref$get(ctors_3390)}));
          _t3399 = _t3407;
        }
        _t3399;
        let _t3408;
        if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
          Parser$advance(p);
          _t3408 = undefined;
        } else {
          _t3408 = Ref$set(continue__3392, false);
        }
        const _t3398 = _t3408;
        _t3398;
        if (_t3395) break;
      }
      _t3394 = _t3395 ? _t3396 : undefined;
      _t3394;
      const _t3393 = ({_tag: 0, _name: "TDVariant", _val: List$rev(Ref$get(ctors_3390))});
      const _t3391 = _t3393;
      _t3384 = _t3391;
      break _t3385;
    }
    if (true) {
      const rhs_3409 = Parser$parse_ty(p);
      const _t3410 = ({_tag: 2, _name: "TDAlias", _val: rhs_3409});
      _t3384 = _t3410;
      break _t3385;
    }
    _match_fail("line 16933");
  }
  const def_3411 = _t3384;
  let _t3413;
  if (_eq(Parser$peek_kind(p), ({_tag: 51, _name: "DERIVING"}))) {
    Parser$advance(p);
    undefined;
    const classes_3414 = Ref$create(null);
    const continue__3416 = Ref$create(true);
    let _t3418 = undefined;
    let _t3419 = false, _t3420;
    while (true) {
      let _t3424;
      if (Ref$get(continue__3416)) {
      let _t3422;
      const _t3421 = Parser$peek_kind(p);
      _t3423: {
        if (_t3421._tag === 9) {
          _t3422 = true;
          break _t3423;
        }
        if (true) {
          _t3422 = false;
          break _t3423;
        }
        _match_fail("line 16933");
      }
        _t3424 = _t3422;
      } else {
        _t3424 = false;
      }
      if (!(_t3424)) break;
      const cls_3425 = Parser$expect_uident(p);
      Ref$set(classes_3414, ({_hd: cls_3425, _tl: Ref$get(classes_3414)}));
      let _t3427;
      if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
        Parser$advance(p);
        _t3427 = undefined;
      } else {
        _t3427 = Ref$set(continue__3416, false);
      }
      const _t3426 = _t3427;
      _t3426;
      if (_t3419) break;
    }
    _t3418 = _t3419 ? _t3420 : undefined;
    _t3418;
    const _t3417 = List$rev(Ref$get(classes_3414));
    const _t3415 = _t3417;
    _t3413 = _t3415;
  } else {
    _t3413 = null;
  }
  const deriving__3428 = _t3413;
  let _t3430;
  if (!_eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"}))) {
    _t3430 = ({_tag: 4, _name: "DType", _val: [type_params_3379, name_3381, def_3411, deriving__3428]});
  } else {
    const defs_3431 = Ref$create(({_hd: [type_params_3379, name_3381, def_3411, deriving__3428], _tl: null}));
    let _t3433 = undefined;
    let _t3434 = false, _t3435;
    while (true) {
      if (!(_eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) break;
      Parser$advance(p);
      undefined;
      let _t3437;
      const _t3436 = Parser$peek_kind(p);
      _t3438: {
        if (_t3436._tag === 10) {
          const s = _t3436._val;
          Parser$advance(p);
          undefined;
          _t3437 = ({_hd: s, _tl: null});
          break _t3438;
        }
        if (_t3436._tag === 52) {
          if (Parser$is_tyvar_token(Parser$peek_kind_at(p, 1))) {
            Parser$advance(p);
            undefined;
            const params_3439 = Ref$create(null);
            const first_3441 = Ref$create(true);
            let _t3443 = undefined;
            let _t3444 = false, _t3445;
            while (true) {
              if (!(!_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"})))) break;
              let _t3446;
              if ((!Ref$get(first_3441))) {
                _t3446 = Parser$expect(p, ({_tag: 59, _name: "COMMA"}));
              } else {
                _t3446 = undefined;
              }
              _t3446;
              Ref$set(first_3441, false);
              let _t3448;
              const _t3447 = Parser$peek_kind(p);
              _t3449: {
                if (_t3447._tag === 10) {
                  const s = _t3447._val;
                  Parser$advance(p);
                  undefined;
                  _t3448 = Ref$set(params_3439, ({_hd: s, _tl: Ref$get(params_3439)}));
                  break _t3449;
                }
                if (true) {
                  _t3448 = Parser$error(p, "expected type variable in type parameter list");
                  break _t3449;
                }
                _match_fail("line 16933");
              }
              _t3448;
              if (_t3444) break;
            }
            _t3443 = _t3444 ? _t3445 : undefined;
            _t3443;
            Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
            const _t3442 = List$rev(Ref$get(params_3439));
            const _t3440 = _t3442;
            _t3437 = _t3440;
            break _t3438;
          }
        }
        if (true) {
          _t3437 = null;
          break _t3438;
        }
        _match_fail("line 16933");
      }
      const and_type_params_3450 = _t3437;
      const and_name_3452 = Parser$expect_ident(p);
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      let _t3455;
      const _t3454 = Parser$peek_kind(p);
      _t3456: {
        if (_t3454._tag === 54) {
          Parser$advance(p);
          undefined;
          let _t3458;
          const _t3457 = Parser$parse_ty_record_fields(p);
          _t3459: {
            if (true) {
              const fields = _t3457[0];
              const _is_open = _t3457[1];
              Parser$expect(p, ({_tag: 55, _name: "RBRACE"}));
              _t3458 = ({_tag: 1, _name: "TDRecord", _val: fields});
              break _t3459;
            }
            _match_fail("line 16933");
          }
          _t3455 = _t3458;
          break _t3456;
        }
        if ((_t3454._tag === 65 || _t3454._tag === 9)) {
          let _t3460;
          if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
            Parser$advance(p);
            _t3460 = undefined;
          } else {
            _t3460 = undefined;
          }
          _t3460;
          const ctors_3461 = Ref$create(null);
          const cont_3463 = Ref$create(true);
          let _t3465 = undefined;
          let _t3466 = false, _t3467;
          while (true) {
            if (!(Ref$get(cont_3463))) break;
            const ctor_name_3468 = Parser$expect_uident(p);
            let _t3470;
            if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
              Parser$advance(p);
              undefined;
              const full_sig_3471 = Parser$parse_ty(p);
              let _t3474;
              const _t3473 = Parser$decompose_gadt_sig(full_sig_3471);
              _t3475: {
                if (true) {
                  const arg_ty = _t3473[0];
                  const ret_ty = _t3473[1];
                  _t3474 = Ref$set(ctors_3461, ({_hd: [ctor_name_3468, arg_ty, ({_tag: 1, _name: "Some", _val: ret_ty})], _tl: Ref$get(ctors_3461)}));
                  break _t3475;
                }
                _match_fail("line 16933");
              }
              const _t3472 = _t3474;
              _t3470 = _t3472;
            } else {
              let _t3476;
              if (_eq(Parser$peek_kind(p), ({_tag: 21, _name: "OF"}))) {
                Parser$advance(p);
                undefined;
                _t3476 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
              } else {
                _t3476 = ({_tag: 0, _name: "None"});
              }
              const arg_3477 = _t3476;
              const _t3478 = Ref$set(ctors_3461, ({_hd: [ctor_name_3468, arg_3477, ({_tag: 0, _name: "None"})], _tl: Ref$get(ctors_3461)}));
              _t3470 = _t3478;
            }
            _t3470;
            let _t3479;
            if (_eq(Parser$peek_kind(p), ({_tag: 65, _name: "PIPE"}))) {
              Parser$advance(p);
              _t3479 = undefined;
            } else {
              _t3479 = Ref$set(cont_3463, false);
            }
            const _t3469 = _t3479;
            _t3469;
            if (_t3466) break;
          }
          _t3465 = _t3466 ? _t3467 : undefined;
          _t3465;
          const _t3464 = ({_tag: 0, _name: "TDVariant", _val: List$rev(Ref$get(ctors_3461))});
          const _t3462 = _t3464;
          _t3455 = _t3462;
          break _t3456;
        }
        if (true) {
          const rhs_3480 = Parser$parse_ty(p);
          const _t3481 = ({_tag: 2, _name: "TDAlias", _val: rhs_3480});
          _t3455 = _t3481;
          break _t3456;
        }
        _match_fail("line 16933");
      }
      const and_def_3482 = _t3455;
      let _t3484;
      if (_eq(Parser$peek_kind(p), ({_tag: 51, _name: "DERIVING"}))) {
        Parser$advance(p);
        undefined;
        const classes_3485 = Ref$create(null);
        const cont_3487 = Ref$create(true);
        let _t3489 = undefined;
        let _t3490 = false, _t3491;
        while (true) {
          let _t3495;
          if (Ref$get(cont_3487)) {
          let _t3493;
          const _t3492 = Parser$peek_kind(p);
          _t3494: {
            if (_t3492._tag === 9) {
              _t3493 = true;
              break _t3494;
            }
            if (true) {
              _t3493 = false;
              break _t3494;
            }
            _match_fail("line 16933");
          }
            _t3495 = _t3493;
          } else {
            _t3495 = false;
          }
          if (!(_t3495)) break;
          const cls_3496 = Parser$expect_uident(p);
          Ref$set(classes_3485, ({_hd: cls_3496, _tl: Ref$get(classes_3485)}));
          let _t3498;
          if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
            Parser$advance(p);
            _t3498 = undefined;
          } else {
            _t3498 = Ref$set(cont_3487, false);
          }
          const _t3497 = _t3498;
          _t3497;
          if (_t3490) break;
        }
        _t3489 = _t3490 ? _t3491 : undefined;
        _t3489;
        const _t3488 = List$rev(Ref$get(classes_3485));
        const _t3486 = _t3488;
        _t3484 = _t3486;
      } else {
        _t3484 = null;
      }
      const and_deriving_3499 = _t3484;
      const _t3500 = Ref$set(defs_3431, ({_hd: [and_type_params_3450, and_name_3452, and_def_3482, and_deriving_3499], _tl: Ref$get(defs_3431)}));
      const _t3483 = _t3500;
      const _t3453 = _t3483;
      const _t3451 = _t3453;
      _t3451;
      if (_t3434) break;
    }
    _t3433 = _t3434 ? _t3435 : undefined;
    _t3433;
    const _t3432 = ({_tag: 5, _name: "DTypeAnd", _val: List$rev(Ref$get(defs_3431))});
    _t3430 = _t3432;
  }
  const _t3429 = _t3430;
  const _t3412 = _t3429;
  const _t3382 = _t3412;
  const _t3380 = _t3382;
  return _t3380;
}
function Parser$parse_newtype_decl(p) {
  Parser$expect(p, ({_tag: 20, _name: "NEWTYPE"}));
  let _t3502;
  const _t3501 = Parser$peek_kind(p);
  _t3503: {
    if (_t3501._tag === 10) {
      const s = _t3501._val;
      Parser$advance(p);
      undefined;
      _t3502 = ({_hd: s, _tl: null});
      break _t3503;
    }
    if (_t3501._tag === 52) {
      if (Parser$is_tyvar_token(Parser$peek_kind_at(p, 1))) {
        Parser$advance(p);
        undefined;
        const params_3504 = Ref$create(null);
        const first_3506 = Ref$create(true);
        let _t3508 = undefined;
        let _t3509 = false, _t3510;
        while (true) {
          if (!(!_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"})))) break;
          let _t3511;
          if ((!Ref$get(first_3506))) {
            _t3511 = Parser$expect(p, ({_tag: 59, _name: "COMMA"}));
          } else {
            _t3511 = undefined;
          }
          _t3511;
          Ref$set(first_3506, false);
          let _t3513;
          const _t3512 = Parser$peek_kind(p);
          _t3514: {
            if (_t3512._tag === 10) {
              const s = _t3512._val;
              Parser$advance(p);
              undefined;
              _t3513 = Ref$set(params_3504, ({_hd: s, _tl: Ref$get(params_3504)}));
              break _t3514;
            }
            if (true) {
              _t3513 = Parser$error(p, "expected type variable in type parameter list");
              break _t3514;
            }
            _match_fail("line 16933");
          }
          _t3513;
          if (_t3509) break;
        }
        _t3508 = _t3509 ? _t3510 : undefined;
        _t3508;
        Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
        const _t3507 = List$rev(Ref$get(params_3504));
        const _t3505 = _t3507;
        _t3502 = _t3505;
        break _t3503;
      }
    }
    if (true) {
      _t3502 = null;
      break _t3503;
    }
    _match_fail("line 16933");
  }
  const type_params_3515 = _t3502;
  const name_3517 = Parser$expect_ident(p);
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const ctor_name_3519 = Parser$expect_uident(p);
  Parser$expect(p, ({_tag: 21, _name: "OF"}));
  const underlying_3521 = Parser$parse_ty(p);
  let _t3523;
  if (_eq(Parser$peek_kind(p), ({_tag: 51, _name: "DERIVING"}))) {
    Parser$advance(p);
    undefined;
    const classes_3524 = Ref$create(null);
    const continue__3526 = Ref$create(true);
    let _t3528 = undefined;
    let _t3529 = false, _t3530;
    while (true) {
      let _t3534;
      if (Ref$get(continue__3526)) {
      let _t3532;
      const _t3531 = Parser$peek_kind(p);
      _t3533: {
        if (_t3531._tag === 9) {
          _t3532 = true;
          break _t3533;
        }
        if (true) {
          _t3532 = false;
          break _t3533;
        }
        _match_fail("line 16933");
      }
        _t3534 = _t3532;
      } else {
        _t3534 = false;
      }
      if (!(_t3534)) break;
      const cls_3535 = Parser$expect_uident(p);
      Ref$set(classes_3524, ({_hd: cls_3535, _tl: Ref$get(classes_3524)}));
      let _t3537;
      if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
        Parser$advance(p);
        _t3537 = undefined;
      } else {
        _t3537 = Ref$set(continue__3526, false);
      }
      const _t3536 = _t3537;
      _t3536;
      if (_t3529) break;
    }
    _t3528 = _t3529 ? _t3530 : undefined;
    _t3528;
    const _t3527 = List$rev(Ref$get(classes_3524));
    const _t3525 = _t3527;
    _t3523 = _t3525;
  } else {
    _t3523 = null;
  }
  const deriving__3538 = _t3523;
  const _t3539 = ({_tag: 4, _name: "DType", _val: [type_params_3515, name_3517, ({_tag: 3, _name: "TDNewtype", _val: [ctor_name_3519, underlying_3521]}), deriving__3538]});
  const _t3522 = _t3539;
  const _t3520 = _t3522;
  const _t3518 = _t3520;
  const _t3516 = _t3518;
  return _t3516;
}
function Parser$extract_pat_vars(__x) {
  while (true) {
    let _t3541;
    const _t3540 = __x;
    _t3542: {
      if (_t3540._tag === 1) {
        const name = _t3540._val;
        _t3541 = ({_hd: name, _tl: null});
        break _t3542;
      }
      if (((((((_t3540._tag === 0 || _t3540._tag === 2) || _t3540._tag === 3) || _t3540._tag === 4) || _t3540._tag === 5) || _t3540._tag === 6) || _t3540._tag === 9)) {
        _t3541 = null;
        break _t3542;
      }
      if (_t3540._tag === 7) {
        const pats = _t3540._val;
        _t3541 = List$concat_map(Parser$extract_pat_vars, pats);
        break _t3542;
      }
      if (_t3540._tag === 8) {
        const hd = _t3540._val[0];
        const tl = _t3540._val[1];
        _t3541 = List$concat(Parser$extract_pat_vars(hd), Parser$extract_pat_vars(tl));
        break _t3542;
      }
      if (_t3540._tag === 10 && _t3540._val[1]._tag === 0) {
        _t3541 = null;
        break _t3542;
      }
      if (_t3540._tag === 10 && _t3540._val[1]._tag === 1) {
        const p = _t3540._val[1]._val;
        const _t3543 = p;
        __x = _t3543;
        continue;
        _t3541 = undefined;
        break _t3542;
      }
      if (_t3540._tag === 11) {
        const fields = _t3540._val;
        function _t3544(__p61) {
          let _t3546;
          const _t3545 = __p61;
          _t3547: {
            if (true) {
              const p = _t3545[1];
              _t3546 = Parser$extract_pat_vars(p);
              break _t3547;
            }
            _match_fail("line 16933");
          }
          return _t3546;
        }
        _t3541 = List$concat_map(_t3544, fields);
        break _t3542;
      }
      if (_t3540._tag === 12) {
        const inner = _t3540._val[0];
        const name = _t3540._val[1];
        _t3541 = ({_hd: name, _tl: Parser$extract_pat_vars(inner)});
        break _t3542;
      }
      if (_t3540._tag === 13) {
        const p1 = _t3540._val[0];
        const _t3548 = p1;
        __x = _t3548;
        continue;
        _t3541 = undefined;
        break _t3542;
      }
      if (_t3540._tag === 14) {
        const pats = _t3540._val;
        _t3541 = List$concat_map(Parser$extract_pat_vars, pats);
        break _t3542;
      }
      if (_t3540._tag === 15) {
        const entries = _t3540._val;
        function _t3549(__p62) {
          let _t3551;
          const _t3550 = __p62;
          _t3552: {
            if (true) {
              const k = _t3550[0];
              const v = _t3550[1];
              _t3551 = List$concat(Parser$extract_pat_vars(k), Parser$extract_pat_vars(v));
              break _t3552;
            }
            _match_fail("line 16933");
          }
          return _t3551;
        }
        _t3541 = List$concat_map(_t3549, entries);
        break _t3542;
      }
      if (_t3540._tag === 16 && _t3540._val[1]._tag === 0) {
        _t3541 = null;
        break _t3542;
      }
      if (_t3540._tag === 16 && _t3540._val[1]._tag === 1) {
        const p = _t3540._val[1]._val;
        const _t3553 = p;
        __x = _t3553;
        continue;
        _t3541 = undefined;
        break _t3542;
      }
      if (_t3540._tag === 17) {
        _t3541 = null;
        break _t3542;
      }
      if (_t3540._tag === 18) {
        const p = _t3540._val[0];
        const _t3554 = p;
        __x = _t3554;
        continue;
        _t3541 = undefined;
        break _t3542;
      }
      _match_fail("line 16933");
    }
    return _t3541;
  }
}
function Parser$parse_constraints(p) {
  let _t3555;
  if (!_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"}))) {
    _t3555 = null;
  } else {
    Parser$advance(p);
    undefined;
    const constraints_3556 = Ref$create(null);
    const continue__3558 = Ref$create(true);
    let _t3560 = undefined;
    let _t3561 = false, _t3562;
    while (true) {
      if (!(Ref$get(continue__3558))) break;
      let _t3564;
      const _t3563 = Parser$peek_kind(p);
      _t3565: {
        if (_t3563._tag === 9) {
          const class_name_start = _t3563._val;
          Parser$advance(p);
          undefined;
          let _t3566;
          if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
            Parser$advance(p);
            undefined;
            let _t3568;
            const _t3567 = Parser$peek_kind(p);
            _t3569: {
              if (_t3567._tag === 9) {
                const s2 = _t3567._val;
                Parser$advance(p);
                undefined;
                _t3568 = (class_name_start + ("." + s2));
                break _t3569;
              }
              if (true) {
                _t3568 = Parser$error(p, "expected class name after dot");
                break _t3569;
              }
              _match_fail("line 16933");
            }
            _t3566 = _t3568;
          } else {
            _t3566 = class_name_start;
          }
          const class_name_3570 = _t3566;
          const tyvars_3572 = Ref$create(null);
          let _t3574 = undefined;
          let _t3575 = false, _t3576;
          while (true) {
            let _t3578;
            const _t3577 = Parser$peek_kind(p);
            _t3579: {
              if (_t3577._tag === 10) {
                _t3578 = true;
                break _t3579;
              }
              if (true) {
                _t3578 = false;
                break _t3579;
              }
              _match_fail("line 16933");
            }
            if (!(_t3578)) break;
            let _t3581;
            const _t3580 = Parser$advance(p).kind;
            _t3582: {
              if (_t3580._tag === 10) {
                const s = _t3580._val;
                _t3581 = Ref$set(tyvars_3572, ({_hd: s, _tl: Ref$get(tyvars_3572)}));
                break _t3582;
              }
              if (true) {
                _t3581 = undefined;
                break _t3582;
              }
              _match_fail("line 16933");
            }
            _t3581;
            if (_t3575) break;
          }
          _t3574 = _t3575 ? _t3576 : undefined;
          _t3574;
          let _t3583;
          if (_eq(Ref$get(tyvars_3572), null)) {
            _t3583 = Parser$error(p, "constraint requires at least one type variable");
          } else {
            _t3583 = undefined;
          }
          _t3583;
          Ref$set(constraints_3556, ({_hd: [class_name_3570, List$rev(Ref$get(tyvars_3572))], _tl: Ref$get(constraints_3556)}));
          let _t3584;
          if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
            Parser$advance(p);
            _t3584 = undefined;
          } else {
            _t3584 = Ref$set(continue__3558, false);
          }
          const _t3573 = _t3584;
          const _t3571 = _t3573;
          _t3564 = _t3571;
          break _t3565;
        }
        if (true) {
          _t3564 = Ref$set(continue__3558, false);
          break _t3565;
        }
        _match_fail("line 16933");
      }
      _t3564;
      if (_t3561) break;
    }
    _t3560 = _t3561 ? _t3562 : undefined;
    _t3560;
    const _t3559 = List$rev(Ref$get(constraints_3556));
    const _t3557 = _t3559;
    _t3555 = _t3557;
  }
  return _t3555;
}
function Parser$parse_let_decl(p) {
  Parser$expect(p, ({_tag: 11, _name: "LET"}));
  const is_rec_3585 = _eq(Parser$peek_kind(p), ({_tag: 12, _name: "REC"}));
  let _t3587;
  if (is_rec_3585) {
    Parser$advance(p);
    _t3587 = undefined;
  } else {
    _t3587 = undefined;
  }
  _t3587;
  const is_mut_3588 = _eq(Parser$peek_kind(p), ({_tag: 33, _name: "MUT"}));
  let _t3590;
  if (is_mut_3588) {
    Parser$advance(p);
    _t3590 = undefined;
  } else {
    _t3590 = undefined;
  }
  _t3590;
  let _t3591;
  if ((is_rec_3585 && is_mut_3588)) {
    _t3591 = Parser$error(p, "let rec mut is not supported");
  } else {
    _t3591 = undefined;
  }
  _t3591;
  let _t3592;
  if (((!is_rec_3585) && ((!is_mut_3588) && Parser$is_destruct_start(p)))) {
    const pat_3593 = Parser$parse_pattern(p);
    Parser$expect(p, ({_tag: 75, _name: "EQ"}));
    const body_3595 = Parser$parse_expr(p);
    let _t3597;
    if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
      Parser$advance(p);
      undefined;
      const rest_3598 = Parser$parse_expr(p);
      const _t3599 = ({_hd: ({_tag: 6, _name: "DExpr", _val: ({_tag: 25, _name: "EMatch", _val: [body_3595, ({_hd: [pat_3593, ({_tag: 0, _name: "None"}), rest_3598], _tl: null}), true]})}), _tl: null});
      _t3597 = _t3599;
    } else {
      const tmp_3600 = "__destruct";
      const vars_3602 = Parser$extract_pat_vars(pat_3593);
      const decls_3604 = ({_hd: ({_tag: 0, _name: "DLet", _val: [tmp_3600, null, ({_tag: 0, _name: "None"}), null, body_3595]}), _tl: null});
      function _t3606(v) {
        return ({_tag: 0, _name: "DLet", _val: [v, null, ({_tag: 0, _name: "None"}), null, ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: tmp_3600}), ({_hd: [pat_3593, ({_tag: 0, _name: "None"}), ({_tag: 7, _name: "EVar", _val: v})], _tl: null}), true]})]});
      }
      const _t3605 = List$concat(decls_3604, List$map(_t3606, vars_3602));
      const _t3603 = _t3605;
      const _t3601 = _t3603;
      _t3597 = _t3601;
    }
    const _t3596 = _t3597;
    const _t3594 = _t3596;
    _t3592 = _t3594;
  } else {
    let _t3607;
    if (is_mut_3588) {
      const name_3608 = Parser$expect_ident(p);
      let _t3610;
      if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        _t3610 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
      } else {
        _t3610 = ({_tag: 0, _name: "None"});
      }
      const annot_3611 = _t3610;
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const body_3613 = Parser$parse_expr(p);
      let _t3616;
      const _t3615 = annot_3611;
      _t3617: {
        if (_t3615._tag === 1) {
          const ty = _t3615._val;
          _t3616 = ({_tag: 30, _name: "EAnnot", _val: [body_3613, ty]});
          break _t3617;
        }
        if (_t3615._tag === 0) {
          _t3616 = body_3613;
          break _t3617;
        }
        _match_fail("line 16933");
      }
      const body_3618 = _t3616;
      let _t3620;
      if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
        Parser$advance(p);
        undefined;
        const rest_3621 = Parser$parse_expr(p);
        const _t3622 = ({_hd: ({_tag: 6, _name: "DExpr", _val: ({_tag: 26, _name: "ELetMut", _val: [name_3608, body_3618, rest_3621]})}), _tl: null});
        _t3620 = _t3622;
      } else {
        _t3620 = ({_hd: ({_tag: 1, _name: "DLetMut", _val: [name_3608, body_3618]}), _tl: null});
      }
      const _t3619 = _t3620;
      const _t3614 = _t3619;
      const _t3612 = _t3614;
      const _t3609 = _t3612;
      _t3607 = _t3609;
    } else {
      let _t3623;
      if (is_rec_3585) {
        _t3623 = Parser$parse_type_params(p);
      } else {
        _t3623 = null;
      }
      const type_params_3624 = _t3623;
      const name_3626 = Parser$expect_ident(p);
      const fun_params_3628 = Ref$create(null);
      let _t3630 = undefined;
      let _t3631 = false, _t3632;
      while (true) {
        if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && (!_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"})) && !_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"})))))) break;
        Ref$set(fun_params_3628, ({_hd: Parser$parse_param(p), _tl: Ref$get(fun_params_3628)}));
        if (_t3631) break;
      }
      _t3630 = _t3631 ? _t3632 : undefined;
      _t3630;
      let _t3633;
      if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
        Parser$advance(p);
        undefined;
        const ty_3634 = Parser$parse_ty(p);
        let _t3636;
        if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
          Parser$advance(p);
          undefined;
          let _t3637;
          if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
            Parser$advance(p);
            undefined;
            _t3637 = ({_tag: 0, _name: "EffAnnotPure"});
          } else {
            _t3637 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
          }
          const eff_3638 = _t3637;
          const _t3639 = ({_tag: 1, _name: "Some", _val: ({_tag: 10, _name: "TyWithEffect", _val: [ty_3634, eff_3638]})});
          _t3636 = _t3639;
        } else {
          _t3636 = ({_tag: 1, _name: "Some", _val: ty_3634});
        }
        const _t3635 = _t3636;
        _t3633 = _t3635;
      } else {
        _t3633 = ({_tag: 0, _name: "None"});
      }
      const ret_annot_3640 = _t3633;
      const constraints_3642 = Parser$parse_constraints(p);
      Parser$expect(p, ({_tag: 75, _name: "EQ"}));
      const body_3644 = Parser$parse_expr(p);
      const fun_params_3646 = List$rev(Ref$get(fun_params_3628));
      let _t3649;
      const _t3648 = Parser$resolve_fun_params(fun_params_3646, body_3644);
      _t3650: {
        if (true) {
          const params = _t3648[0];
          const body = _t3648[1];
          let _t3651;
          if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
            Parser$advance(p);
            undefined;
            const rest_3652 = Parser$parse_expr(p);
            const full_body_3654 = Parser$wrap_params_expr(fun_params_3646, ret_annot_3640, body);
            let _t3656;
            if (is_rec_3585) {
              _t3656 = ({_tag: 9, _name: "ELetRec", _val: [name_3626, type_params_3624, full_body_3654, rest_3652]});
            } else {
              _t3656 = ({_tag: 8, _name: "ELet", _val: [name_3626, full_body_3654, rest_3652]});
            }
            const expr_3657 = _t3656;
            const _t3658 = ({_hd: ({_tag: 6, _name: "DExpr", _val: expr_3657}), _tl: null});
            const _t3655 = _t3658;
            const _t3653 = _t3655;
            _t3651 = _t3653;
          } else {
            let _t3659;
            if ((is_rec_3585 && _eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) {
              const bindings_3660 = Ref$create(({_hd: [name_3626, type_params_3624, params, ret_annot_3640, constraints_3642, body], _tl: null}));
              let _t3662 = undefined;
              let _t3663 = false, _t3664;
              while (true) {
                if (!(_eq(Parser$peek_kind(p), ({_tag: 50, _name: "AND"})))) break;
                Parser$advance(p);
                undefined;
                const and_name_3665 = Parser$expect_ident(p);
                const and_type_params_3667 = Parser$parse_type_params(p);
                const and_fun_params_3669 = Ref$create(null);
                let _t3671 = undefined;
                let _t3672 = false, _t3673;
                while (true) {
                  if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && (!_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"})) && !_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"})))))) break;
                  Ref$set(and_fun_params_3669, ({_hd: Parser$parse_param(p), _tl: Ref$get(and_fun_params_3669)}));
                  if (_t3672) break;
                }
                _t3671 = _t3672 ? _t3673 : undefined;
                _t3671;
                let _t3674;
                if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
                  Parser$advance(p);
                  undefined;
                  const ty_3675 = Parser$parse_ty(p);
                  let _t3677;
                  if (_eq(Parser$peek_kind(p), ({_tag: 71, _name: "SLASH"}))) {
                    Parser$advance(p);
                    undefined;
                    let _t3678;
                    if (_eq(Parser$peek_kind(p), ({_tag: 8, _name: "IDENT", _val: "pure"}))) {
                      Parser$advance(p);
                      undefined;
                      _t3678 = ({_tag: 0, _name: "EffAnnotPure"});
                    } else {
                      _t3678 = ({_tag: 1, _name: "EffAnnotRow", _val: Parser$parse_eff_items(p)});
                    }
                    const eff_3679 = _t3678;
                    const _t3680 = ({_tag: 1, _name: "Some", _val: ({_tag: 10, _name: "TyWithEffect", _val: [ty_3675, eff_3679]})});
                    _t3677 = _t3680;
                  } else {
                    _t3677 = ({_tag: 1, _name: "Some", _val: ty_3675});
                  }
                  const _t3676 = _t3677;
                  _t3674 = _t3676;
                } else {
                  _t3674 = ({_tag: 0, _name: "None"});
                }
                const and_ret_annot_3681 = _t3674;
                const and_constraints_3683 = Parser$parse_constraints(p);
                Parser$expect(p, ({_tag: 75, _name: "EQ"}));
                const and_body_3685 = Parser$parse_expr(p);
                const and_fun_params_3687 = List$rev(Ref$get(and_fun_params_3669));
                let _t3690;
                const _t3689 = Parser$resolve_fun_params(and_fun_params_3687, and_body_3685);
                _t3691: {
                  if (true) {
                    const and_params = _t3689[0];
                    const and_body = _t3689[1];
                    _t3690 = Ref$set(bindings_3660, ({_hd: [and_name_3665, and_type_params_3667, and_params, and_ret_annot_3681, and_constraints_3683, and_body], _tl: Ref$get(bindings_3660)}));
                    break _t3691;
                  }
                  _match_fail("line 16933");
                }
                const _t3688 = _t3690;
                const _t3686 = _t3688;
                const _t3684 = _t3686;
                const _t3682 = _t3684;
                const _t3670 = _t3682;
                const _t3668 = _t3670;
                const _t3666 = _t3668;
                _t3666;
                if (_t3663) break;
              }
              _t3662 = _t3663 ? _t3664 : undefined;
              _t3662;
              let _t3692;
              if (_eq(Parser$peek_kind(p), ({_tag: 13, _name: "IN"}))) {
                Parser$advance(p);
                undefined;
                const rest_3693 = Parser$parse_expr(p);
                function _t3695(__p63) {
                  let _t3697;
                  const _t3696 = __p63;
                  _t3698: {
                    if (true) {
                      const n = _t3696[0];
                      const tp = _t3696[1];
                      const ps = _t3696[2];
                      const ra = _t3696[3];
                      const _cs = _t3696[4];
                      const b = _t3696[5];
                      function _t3699(p) {
                        return ({_tag: 0, _name: "FPParam", _val: p});
                      }
                      const full_3700 = Parser$wrap_params_expr(List$map(_t3699, ps), ra, b);
                      const _t3701 = [n, tp, full_3700];
                      _t3697 = _t3701;
                      break _t3698;
                    }
                    _match_fail("line 16933");
                  }
                  return _t3697;
                }
                const expr_bindings_3702 = List$map(_t3695, List$rev(Ref$get(bindings_3660)));
                const _t3703 = ({_hd: ({_tag: 6, _name: "DExpr", _val: ({_tag: 38, _name: "ELetRecAnd", _val: [expr_bindings_3702, rest_3693]})}), _tl: null});
                const _t3694 = _t3703;
                _t3692 = _t3694;
              } else {
                _t3692 = ({_hd: ({_tag: 3, _name: "DLetRecAnd", _val: List$rev(Ref$get(bindings_3660))}), _tl: null});
              }
              const _t3661 = _t3692;
              _t3659 = _t3661;
            } else {
              let _t3704;
              if (is_rec_3585) {
                _t3704 = ({_hd: ({_tag: 2, _name: "DLetRec", _val: [name_3626, type_params_3624, params, ret_annot_3640, constraints_3642, body]}), _tl: null});
              } else {
                _t3704 = ({_hd: ({_tag: 0, _name: "DLet", _val: [name_3626, params, ret_annot_3640, constraints_3642, body]}), _tl: null});
              }
              _t3659 = _t3704;
            }
            _t3651 = _t3659;
          }
          _t3649 = _t3651;
          break _t3650;
        }
        _match_fail("line 16933");
      }
      const _t3647 = _t3649;
      const _t3645 = _t3647;
      const _t3643 = _t3645;
      const _t3641 = _t3643;
      const _t3629 = _t3641;
      const _t3627 = _t3629;
      const _t3625 = _t3627;
      _t3607 = _t3625;
    }
    _t3592 = _t3607;
  }
  const _t3589 = _t3592;
  const _t3586 = _t3589;
  return _t3586;
}
function Parser$parse_class_name(p) {
  let _t3706;
  const _t3705 = Parser$peek_kind(p);
  _t3707: {
    if (_t3705._tag === 9) {
      const s = _t3705._val;
      Parser$advance(p);
      undefined;
      let _t3708;
      if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
        Parser$advance(p);
        undefined;
        let _t3710;
        const _t3709 = Parser$peek_kind(p);
        _t3711: {
          if (_t3709._tag === 9) {
            const s2 = _t3709._val;
            Parser$advance(p);
            undefined;
            _t3710 = (s + ("." + s2));
            break _t3711;
          }
          if (true) {
            _t3710 = Parser$error(p, "expected class name after dot");
            break _t3711;
          }
          _match_fail("line 16933");
        }
        _t3708 = _t3710;
      } else {
        _t3708 = s;
      }
      _t3706 = _t3708;
      break _t3707;
    }
    if (true) {
      _t3706 = Parser$error(p, "expected class name");
      break _t3707;
    }
    _match_fail("line 16933");
  }
  return _t3706;
}
function Parser$parse_class_decl(p) {
  Parser$expect(p, ({_tag: 22, _name: "CLASS"}));
  const class_name_3712 = Parser$expect_uident(p);
  let _t3714;
  if (_eq(Parser$peek_kind(p), ({_tag: 63, _name: "DOT"}))) {
    _t3714 = Parser$error(p, "class declarations cannot use qualified names; define the class inside a module instead");
  } else {
    _t3714 = undefined;
  }
  _t3714;
  const tyvars_3715 = Ref$create(null);
  const continue_tyvars_3717 = Ref$create(true);
  let _t3719 = undefined;
  let _t3720 = false, _t3721;
  while (true) {
    if (!(Ref$get(continue_tyvars_3717))) break;
    let _t3723;
    const _t3722 = Parser$peek_kind(p);
    _t3724: {
      if (_t3722._tag === 10) {
        const s = _t3722._val;
        Parser$advance(p);
        undefined;
        _t3723 = Ref$set(tyvars_3715, ({_hd: s, _tl: Ref$get(tyvars_3715)}));
        break _t3724;
      }
      if (true) {
        _t3723 = Ref$set(continue_tyvars_3717, false);
        break _t3724;
      }
      _match_fail("line 16933");
    }
    _t3723;
    if (_t3720) break;
  }
  _t3719 = _t3720 ? _t3721 : undefined;
  _t3719;
  const tyvars_3725 = List$rev(Ref$get(tyvars_3715));
  let _t3727;
  if (_eq(tyvars_3725, null)) {
    _t3727 = Parser$error(p, "expected at least one type variable");
  } else {
    _t3727 = undefined;
  }
  _t3727;
  let _t3728;
  if (_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"}))) {
    Parser$advance(p);
    undefined;
    const deps_3729 = Ref$create(null);
    const continue__3731 = Ref$create(true);
    let _t3733 = undefined;
    let _t3734 = false, _t3735;
    while (true) {
      if (!(Ref$get(continue__3731))) break;
      const from_vars_3736 = Ref$create(null);
      let _t3738 = undefined;
      let _t3739 = false, _t3740;
      while (true) {
        let _t3742;
        const _t3741 = Parser$peek_kind(p);
        _t3743: {
          if (_t3741._tag === 10) {
            _t3742 = true;
            break _t3743;
          }
          if (true) {
            _t3742 = false;
            break _t3743;
          }
          _match_fail("line 16933");
        }
        if (!(_t3742)) break;
        let _t3745;
        const _t3744 = Parser$advance(p).kind;
        _t3746: {
          if (_t3744._tag === 10) {
            const s = _t3744._val;
            let _t3747;
            if ((!List$mem(s, tyvars_3725))) {
              _t3747 = Parser$error(p, (("functional dependency type variable '" + __dict_Show_string.show(s)) + " not in class parameters"));
            } else {
              _t3747 = undefined;
            }
            _t3747;
            _t3745 = Ref$set(from_vars_3736, ({_hd: s, _tl: Ref$get(from_vars_3736)}));
            break _t3746;
          }
          if (true) {
            _t3745 = undefined;
            break _t3746;
          }
          _match_fail("line 16933");
        }
        _t3745;
        if (_t3739) break;
      }
      _t3738 = _t3739 ? _t3740 : undefined;
      _t3738;
      let _t3748;
      if (_eq(Ref$get(from_vars_3736), null)) {
        _t3748 = Parser$error(p, "expected type variable(s) before '->'");
      } else {
        _t3748 = undefined;
      }
      _t3748;
      Parser$expect(p, ({_tag: 58, _name: "ARROW"}));
      const to_vars_3749 = Ref$create(null);
      let _t3751 = undefined;
      let _t3752 = false, _t3753;
      while (true) {
        let _t3755;
        const _t3754 = Parser$peek_kind(p);
        _t3756: {
          if (_t3754._tag === 10) {
            _t3755 = true;
            break _t3756;
          }
          if (true) {
            _t3755 = false;
            break _t3756;
          }
          _match_fail("line 16933");
        }
        if (!(_t3755)) break;
        let _t3758;
        const _t3757 = Parser$advance(p).kind;
        _t3759: {
          if (_t3757._tag === 10) {
            const s = _t3757._val;
            let _t3760;
            if ((!List$mem(s, tyvars_3725))) {
              _t3760 = Parser$error(p, (("functional dependency type variable '" + __dict_Show_string.show(s)) + " not in class parameters"));
            } else {
              _t3760 = undefined;
            }
            _t3760;
            _t3758 = Ref$set(to_vars_3749, ({_hd: s, _tl: Ref$get(to_vars_3749)}));
            break _t3759;
          }
          if (true) {
            _t3758 = undefined;
            break _t3759;
          }
          _match_fail("line 16933");
        }
        _t3758;
        if (_t3752) break;
      }
      _t3751 = _t3752 ? _t3753 : undefined;
      _t3751;
      let _t3761;
      if (_eq(Ref$get(to_vars_3749), null)) {
        _t3761 = Parser$error(p, "expected type variable(s) after '->'");
      } else {
        _t3761 = undefined;
      }
      _t3761;
      Ref$set(deps_3729, ({_hd: [List$rev(Ref$get(from_vars_3736)), List$rev(Ref$get(to_vars_3749))], _tl: Ref$get(deps_3729)}));
      let _t3762;
      if (_eq(Parser$peek_kind(p), ({_tag: 59, _name: "COMMA"}))) {
        Parser$advance(p);
        _t3762 = undefined;
      } else {
        _t3762 = Ref$set(continue__3731, false);
      }
      const _t3750 = _t3762;
      const _t3737 = _t3750;
      _t3737;
      if (_t3734) break;
    }
    _t3733 = _t3734 ? _t3735 : undefined;
    _t3733;
    const _t3732 = List$rev(Ref$get(deps_3729));
    const _t3730 = _t3732;
    _t3728 = _t3730;
  } else {
    _t3728 = null;
  }
  const fundeps_3763 = _t3728;
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const methods_3765 = Ref$create(null);
  let _t3767 = undefined;
  let _t3768 = false, _t3769;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 47, _name: "END"})))) break;
    let _t3770;
    if (_eq(Parser$peek_kind(p), ({_tag: 52, _name: "LPAREN"}))) {
      Parser$advance(p);
      undefined;
      let _t3772;
      const _t3771 = Parser$peek_kind(p);
      _t3773: {
        if (_t3771._tag === 68) {
          _t3772 = "+";
          break _t3773;
        }
        if (_t3771._tag === 69) {
          _t3772 = "-";
          break _t3773;
        }
        if (_t3771._tag === 70) {
          _t3772 = "*";
          break _t3773;
        }
        if (_t3771._tag === 71) {
          _t3772 = "/";
          break _t3773;
        }
        if (_t3771._tag === 77) {
          _t3772 = "<";
          break _t3773;
        }
        if (_t3771._tag === 78) {
          _t3772 = ">";
          break _t3773;
        }
        if (_t3771._tag === 79) {
          _t3772 = "<=";
          break _t3773;
        }
        if (_t3771._tag === 80) {
          _t3772 = ">=";
          break _t3773;
        }
        if (_t3771._tag === 75) {
          _t3772 = "=";
          break _t3773;
        }
        if (_t3771._tag === 76) {
          _t3772 = "<>";
          break _t3773;
        }
        if (_t3771._tag === 83) {
          _t3772 = "land";
          break _t3773;
        }
        if (_t3771._tag === 84) {
          _t3772 = "lor";
          break _t3773;
        }
        if (_t3771._tag === 85) {
          _t3772 = "lxor";
          break _t3773;
        }
        if (_t3771._tag === 86) {
          _t3772 = "lnot";
          break _t3773;
        }
        if (_t3771._tag === 87) {
          _t3772 = "lsl";
          break _t3773;
        }
        if (_t3771._tag === 88) {
          _t3772 = "lsr";
          break _t3773;
        }
        if (true) {
          _t3772 = Parser$error(p, "expected operator");
          break _t3773;
        }
        _match_fail("line 16933");
      }
      const name_3774 = _t3772;
      Parser$advance(p);
      undefined;
      Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
      const _t3775 = name_3774;
      _t3770 = _t3775;
    } else {
      _t3770 = Parser$expect_ident(p);
    }
    const s_3776 = _t3770;
    Parser$expect(p, ({_tag: 62, _name: "COLON"}));
    const ty_3778 = Parser$parse_ty(p);
    Ref$set(methods_3765, ({_hd: [s_3776, ty_3778], _tl: Ref$get(methods_3765)}));
    let _t3780;
    if (_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"}))) {
      Parser$advance(p);
      _t3780 = undefined;
    } else {
      _t3780 = undefined;
    }
    const _t3779 = _t3780;
    const _t3777 = _t3779;
    _t3777;
    if (_t3768) break;
  }
  _t3767 = _t3768 ? _t3769 : undefined;
  _t3767;
  Parser$expect(p, ({_tag: 47, _name: "END"}));
  let _t3781;
  if (_eq(Ref$get(methods_3765), null)) {
    _t3781 = Parser$error(p, "class must have at least one method");
  } else {
    _t3781 = undefined;
  }
  _t3781;
  const _t3766 = ({_tag: 7, _name: "DClass", _val: [class_name_3712, tyvars_3725, fundeps_3763, List$rev(Ref$get(methods_3765))]});
  const _t3764 = _t3766;
  const _t3726 = _t3764;
  const _t3718 = _t3726;
  const _t3716 = _t3718;
  const _t3713 = _t3716;
  return _t3713;
}
function Parser$parse_instance_decl(p) {
  Parser$expect(p, ({_tag: 23, _name: "INSTANCE"}));
  const class_name_3782 = Parser$parse_class_name(p);
  const inst_tys_3784 = Ref$create(null);
  let _t3786 = undefined;
  let _t3787 = false, _t3788;
  while (true) {
    if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && !_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"}))))) break;
    Ref$set(inst_tys_3784, ({_hd: Parser$parse_ty_atom(p), _tl: Ref$get(inst_tys_3784)}));
    if (_t3787) break;
  }
  _t3786 = _t3787 ? _t3788 : undefined;
  _t3786;
  const inst_tys_3789 = List$rev(Ref$get(inst_tys_3784));
  let _t3791;
  if (_eq(inst_tys_3789, null)) {
    _t3791 = Parser$error(p, "expected at least one instance type");
  } else {
    _t3791 = undefined;
  }
  _t3791;
  const constraints_3792 = Parser$parse_constraints(p);
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const methods_3794 = Ref$create(null);
  let _t3796 = undefined;
  let _t3797 = false, _t3798;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 47, _name: "END"})))) break;
    Parser$expect(p, ({_tag: 11, _name: "LET"}));
    let _t3799;
    if (_eq(Parser$peek_kind(p), ({_tag: 52, _name: "LPAREN"}))) {
      Parser$advance(p);
      undefined;
      let _t3801;
      const _t3800 = Parser$peek_kind(p);
      _t3802: {
        if (_t3800._tag === 68) {
          _t3801 = "+";
          break _t3802;
        }
        if (_t3800._tag === 69) {
          _t3801 = "-";
          break _t3802;
        }
        if (_t3800._tag === 70) {
          _t3801 = "*";
          break _t3802;
        }
        if (_t3800._tag === 71) {
          _t3801 = "/";
          break _t3802;
        }
        if (_t3800._tag === 77) {
          _t3801 = "<";
          break _t3802;
        }
        if (_t3800._tag === 78) {
          _t3801 = ">";
          break _t3802;
        }
        if (_t3800._tag === 79) {
          _t3801 = "<=";
          break _t3802;
        }
        if (_t3800._tag === 80) {
          _t3801 = ">=";
          break _t3802;
        }
        if (_t3800._tag === 75) {
          _t3801 = "=";
          break _t3802;
        }
        if (_t3800._tag === 76) {
          _t3801 = "<>";
          break _t3802;
        }
        if (_t3800._tag === 83) {
          _t3801 = "land";
          break _t3802;
        }
        if (_t3800._tag === 84) {
          _t3801 = "lor";
          break _t3802;
        }
        if (_t3800._tag === 85) {
          _t3801 = "lxor";
          break _t3802;
        }
        if (_t3800._tag === 86) {
          _t3801 = "lnot";
          break _t3802;
        }
        if (_t3800._tag === 87) {
          _t3801 = "lsl";
          break _t3802;
        }
        if (_t3800._tag === 88) {
          _t3801 = "lsr";
          break _t3802;
        }
        if (true) {
          _t3801 = Parser$error(p, "expected operator");
          break _t3802;
        }
        _match_fail("line 16933");
      }
      const name_3803 = _t3801;
      Parser$advance(p);
      undefined;
      Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
      const _t3804 = name_3803;
      _t3799 = _t3804;
    } else {
      _t3799 = Parser$expect_ident(p);
    }
    const method_name_3805 = _t3799;
    const params_3807 = Ref$create(null);
    let _t3809 = undefined;
    let _t3810 = false, _t3811;
    while (true) {
      if (!((!_eq(Parser$peek_kind(p), ({_tag: 75, _name: "EQ"})) && (!_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"})) && !_eq(Parser$peek_kind(p), ({_tag: 38, _name: "WHERE"})))))) break;
      Ref$set(params_3807, ({_hd: Parser$parse_param(p), _tl: Ref$get(params_3807)}));
      if (_t3810) break;
    }
    _t3809 = _t3810 ? _t3811 : undefined;
    _t3809;
    let _t3812;
    if (_eq(Parser$peek_kind(p), ({_tag: 62, _name: "COLON"}))) {
      Parser$advance(p);
      undefined;
      _t3812 = ({_tag: 1, _name: "Some", _val: Parser$parse_ty(p)});
    } else {
      _t3812 = ({_tag: 0, _name: "None"});
    }
    const ret_annot_3813 = _t3812;
    const _constraints_3815 = Parser$parse_constraints(p);
    Parser$expect(p, ({_tag: 75, _name: "EQ"}));
    const body_3817 = Parser$parse_expr(p);
    const fun_params_3819 = List$rev(Ref$get(params_3807));
    function _t3821(body, fp) {
      let _t3823;
      const _t3822 = fp;
      _t3824: {
        if (_t3822._tag === 0) {
          _t3823 = body;
          break _t3824;
        }
        if (_t3822._tag === 1) {
          const name = _t3822._val[0];
          const pat = _t3822._val[1];
          _t3823 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: name}), ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: null}), true]});
          break _t3824;
        }
        _match_fail("line 16933");
      }
      return _t3823;
    }
    const body_3825 = List$fold(_t3821, body_3817, fun_params_3819);
    let _t3828;
    const _t3827 = ret_annot_3813;
    _t3829: {
      if (_t3827._tag === 1) {
        const ty = _t3827._val;
        _t3828 = ({_tag: 30, _name: "EAnnot", _val: [body_3825, ty]});
        break _t3829;
      }
      if (_t3827._tag === 0) {
        _t3828 = body_3825;
        break _t3829;
      }
      _match_fail("line 16933");
    }
    const body_3830 = _t3828;
    function _t3832(fp) {
      let _t3834;
      const _t3833 = fp;
      _t3835: {
        if (_t3833._tag === 0) {
          const param = _t3833._val;
          _t3834 = param;
          break _t3835;
        }
        if (_t3833._tag === 1) {
          const name = _t3833._val[0];
          const annot = _t3833._val[2];
          _t3834 = ({annot: annot, is_generated: true, name: name});
          break _t3835;
        }
        _match_fail("line 16933");
      }
      return _t3834;
    }
    const plain_params_3836 = List$map(_t3832, fun_params_3819);
    const _t3837 = Ref$set(methods_3794, ({_hd: [method_name_3805, plain_params_3836, body_3830], _tl: Ref$get(methods_3794)}));
    const _t3831 = _t3837;
    const _t3826 = _t3831;
    const _t3820 = _t3826;
    const _t3818 = _t3820;
    const _t3816 = _t3818;
    const _t3814 = _t3816;
    const _t3808 = _t3814;
    const _t3806 = _t3808;
    _t3806;
    if (_t3797) break;
  }
  _t3796 = _t3797 ? _t3798 : undefined;
  _t3796;
  Parser$expect(p, ({_tag: 47, _name: "END"}));
  let _t3838;
  if (_eq(Ref$get(methods_3794), null)) {
    _t3838 = Parser$error(p, "instance must implement at least one method");
  } else {
    _t3838 = undefined;
  }
  _t3838;
  const _t3795 = ({_tag: 8, _name: "DInstance", _val: [class_name_3782, inst_tys_3789, constraints_3792, List$rev(Ref$get(methods_3794))]});
  const _t3793 = _t3795;
  const _t3790 = _t3793;
  const _t3785 = _t3790;
  const _t3783 = _t3785;
  return _t3783;
}
function Parser$parse_effect_decl(p) {
  Parser$expect(p, ({_tag: 24, _name: "EFFECT"}));
  const name_3839 = Parser$parse_class_name(p);
  const type_params_3841 = Ref$create(null);
  let _t3843 = undefined;
  let _t3844 = false, _t3845;
  while (true) {
    let _t3847;
    const _t3846 = Parser$peek_kind(p);
    _t3848: {
      if (_t3846._tag === 10) {
        _t3847 = true;
        break _t3848;
      }
      if (true) {
        _t3847 = false;
        break _t3848;
      }
      _match_fail("line 16933");
    }
    if (!(_t3847)) break;
    let _t3850;
    const _t3849 = Parser$advance(p).kind;
    _t3851: {
      if (_t3849._tag === 10) {
        const s = _t3849._val;
        _t3850 = Ref$set(type_params_3841, ({_hd: s, _tl: Ref$get(type_params_3841)}));
        break _t3851;
      }
      if (true) {
        _t3850 = undefined;
        break _t3851;
      }
      _match_fail("line 16933");
    }
    _t3850;
    if (_t3844) break;
  }
  _t3843 = _t3844 ? _t3845 : undefined;
  _t3843;
  const type_params_3852 = List$rev(Ref$get(type_params_3841));
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const ops_3854 = Ref$create(null);
  let _t3856 = undefined;
  let _t3857 = false, _t3858;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 47, _name: "END"})))) break;
    const s_3859 = Parser$expect_ident(p);
    Parser$expect(p, ({_tag: 62, _name: "COLON"}));
    const ty_3861 = Parser$parse_ty(p);
    Ref$set(ops_3854, ({_hd: [s_3859, ty_3861], _tl: Ref$get(ops_3854)}));
    let _t3863;
    if (_eq(Parser$peek_kind(p), ({_tag: 60, _name: "SEMICOLON"}))) {
      Parser$advance(p);
      _t3863 = undefined;
    } else {
      _t3863 = undefined;
    }
    const _t3862 = _t3863;
    const _t3860 = _t3862;
    _t3860;
    if (_t3857) break;
  }
  _t3856 = _t3857 ? _t3858 : undefined;
  _t3856;
  Parser$expect(p, ({_tag: 47, _name: "END"}));
  let _t3864;
  if (_eq(Ref$get(ops_3854), null)) {
    _t3864 = Parser$error(p, "effect must have at least one operation");
  } else {
    _t3864 = undefined;
  }
  _t3864;
  const _t3855 = ({_tag: 9, _name: "DEffect", _val: [name_3839, type_params_3852, List$rev(Ref$get(ops_3854))]});
  const _t3853 = _t3855;
  const _t3842 = _t3853;
  const _t3840 = _t3842;
  return _t3840;
}
function Parser$parse_extern_decl(p) {
  Parser$expect(p, ({_tag: 25, _name: "EXTERN"}));
  let _t3866;
  const _t3865 = Parser$peek_kind(p);
  _t3867: {
    if (_t3865._tag === 9) {
      const mod_name = _t3865._val;
      Parser$advance(p);
      undefined;
      Parser$expect(p, ({_tag: 63, _name: "DOT"}));
      const field_3868 = Parser$expect_ident(p);
      const _t3869 = (mod_name + ("." + field_3868));
      _t3866 = _t3869;
      break _t3867;
    }
    if (true) {
      _t3866 = Parser$expect_ident(p);
      break _t3867;
    }
    _match_fail("line 16933");
  }
  const name_3870 = _t3866;
  Parser$expect(p, ({_tag: 62, _name: "COLON"}));
  const ty_3872 = Parser$parse_ty(p);
  const _t3873 = ({_tag: 10, _name: "DExtern", _val: [name_3870, ty_3872]});
  const _t3871 = _t3873;
  return _t3871;
}
function Parser$parse_module_body_item(p) {
  let _t3875;
  const _t3874 = Parser$peek_kind(p);
  _t3876: {
    if (_t3874._tag === 45) {
      Parser$advance(p);
      undefined;
      const decls_3877 = Parser$parse_inner_decl(p);
      function _t3879(d) {
        return ({decl: d, vis: ({_tag: 0, _name: "Public"})});
      }
      const _t3878 = List$map(_t3879, decls_3877);
      _t3875 = _t3878;
      break _t3876;
    }
    if (_t3874._tag === 48) {
      Parser$advance(p);
      undefined;
      let _t3880;
      if (_eq(Parser$peek_kind(p), ({_tag: 20, _name: "NEWTYPE"}))) {
        _t3880 = Parser$parse_newtype_decl(p);
      } else {
        _t3880 = Parser$parse_type_decl(p);
      }
      const decl_3881 = _t3880;
      const _t3882 = ({_hd: ({decl: decl_3881, vis: ({_tag: 2, _name: "Opaque"})}), _tl: null});
      _t3875 = _t3882;
      break _t3876;
    }
    if (true) {
      const decls_3883 = Parser$parse_inner_decl(p);
      function _t3885(d) {
        return ({decl: d, vis: ({_tag: 1, _name: "Private"})});
      }
      const _t3884 = List$map(_t3885, decls_3883);
      _t3875 = _t3884;
      break _t3876;
    }
    _match_fail("line 16933");
  }
  return _t3875;
}
function Parser$parse_inner_decl(p) {
  let _t3887;
  const _t3886 = Parser$peek_kind(p);
  _t3888: {
    if (_t3886._tag === 19) {
      _t3887 = ({_hd: Parser$parse_type_decl(p), _tl: null});
      break _t3888;
    }
    if (_t3886._tag === 20) {
      _t3887 = ({_hd: Parser$parse_newtype_decl(p), _tl: null});
      break _t3888;
    }
    if (_t3886._tag === 11) {
      _t3887 = Parser$parse_let_decl(p);
      break _t3888;
    }
    if (_t3886._tag === 22) {
      _t3887 = ({_hd: Parser$parse_class_decl(p), _tl: null});
      break _t3888;
    }
    if (_t3886._tag === 23) {
      _t3887 = ({_hd: Parser$parse_instance_decl(p), _tl: null});
      break _t3888;
    }
    if (_t3886._tag === 24) {
      _t3887 = ({_hd: Parser$parse_effect_decl(p), _tl: null});
      break _t3888;
    }
    if (_t3886._tag === 25) {
      _t3887 = ({_hd: Parser$parse_extern_decl(p), _tl: null});
      break _t3888;
    }
    if (_t3886._tag === 44) {
      _t3887 = ({_hd: Parser$parse_module_decl(p), _tl: null});
      break _t3888;
    }
    if (_t3886._tag === 46) {
      _t3887 = ({_hd: Parser$parse_open_decl(p), _tl: null});
      break _t3888;
    }
    if (true) {
      _t3887 = Parser$error(p, "expected declaration inside module");
      break _t3888;
    }
    _match_fail("line 16933");
  }
  return _t3887;
}
function Parser$parse_module_decl(p) {
  Parser$expect(p, ({_tag: 44, _name: "MODULE"}));
  const name_3889 = Parser$expect_uident(p);
  Parser$expect(p, ({_tag: 75, _name: "EQ"}));
  const items_3891 = Ref$create(null);
  let _t3893 = undefined;
  let _t3894 = false, _t3895;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p), ({_tag: 47, _name: "END"})))) break;
    const module_items_3896 = Parser$parse_module_body_item(p);
    Ref$set(items_3891, List$rev_append(module_items_3896, Ref$get(items_3891)));
    let _t3898;
    if (_eq(Parser$peek_kind(p), ({_tag: 61, _name: "DOUBLE_SEMICOLON"}))) {
      Parser$advance(p);
      _t3898 = undefined;
    } else {
      _t3898 = undefined;
    }
    const _t3897 = _t3898;
    _t3897;
    if (_t3894) break;
  }
  _t3893 = _t3894 ? _t3895 : undefined;
  _t3893;
  Parser$expect(p, ({_tag: 47, _name: "END"}));
  const _t3892 = ({_tag: 11, _name: "DModule", _val: [name_3889, List$rev(Ref$get(items_3891))]});
  const _t3890 = _t3892;
  return _t3890;
}
function Parser$parse_open_decl(p) {
  Parser$expect(p, ({_tag: 46, _name: "OPEN"}));
  const name_3899 = Parser$expect_uident(p);
  let _t3901;
  if (_eq(Parser$peek_kind(p), ({_tag: 52, _name: "LPAREN"}))) {
    Parser$advance(p);
    undefined;
    const names_3902 = Ref$create(null);
    const first_3904 = Ref$create(true);
    let _t3906 = undefined;
    let _t3907 = false, _t3908;
    while (true) {
      if (!(!_eq(Parser$peek_kind(p), ({_tag: 53, _name: "RPAREN"})))) break;
      let _t3909;
      if ((!Ref$get(first_3904))) {
        _t3909 = Parser$expect(p, ({_tag: 59, _name: "COMMA"}));
      } else {
        _t3909 = undefined;
      }
      _t3909;
      Ref$set(first_3904, false);
      const n_3910 = Parser$expect_ident(p);
      const _t3911 = Ref$set(names_3902, ({_hd: n_3910, _tl: Ref$get(names_3902)}));
      _t3911;
      if (_t3907) break;
    }
    _t3906 = _t3907 ? _t3908 : undefined;
    _t3906;
    Parser$expect(p, ({_tag: 53, _name: "RPAREN"}));
    const _t3905 = ({_tag: 12, _name: "DOpen", _val: [name_3899, ({_tag: 1, _name: "Some", _val: List$rev(Ref$get(names_3902))})]});
    const _t3903 = _t3905;
    _t3901 = _t3903;
  } else {
    _t3901 = ({_tag: 12, _name: "DOpen", _val: [name_3899, ({_tag: 0, _name: "None"})]});
  }
  const _t3900 = _t3901;
  return _t3900;
}
function Parser$parse_decl(p) {
  let _t3913;
  const _t3912 = Parser$peek_kind(p);
  _t3914: {
    if (_t3912._tag === 19) {
      _t3913 = ({_hd: Parser$parse_type_decl(p), _tl: null});
      break _t3914;
    }
    if (_t3912._tag === 20) {
      _t3913 = ({_hd: Parser$parse_newtype_decl(p), _tl: null});
      break _t3914;
    }
    if (_t3912._tag === 11) {
      _t3913 = Parser$parse_let_decl(p);
      break _t3914;
    }
    if (_t3912._tag === 22) {
      _t3913 = ({_hd: Parser$parse_class_decl(p), _tl: null});
      break _t3914;
    }
    if (_t3912._tag === 23) {
      _t3913 = ({_hd: Parser$parse_instance_decl(p), _tl: null});
      break _t3914;
    }
    if (_t3912._tag === 24) {
      _t3913 = ({_hd: Parser$parse_effect_decl(p), _tl: null});
      break _t3914;
    }
    if (_t3912._tag === 25) {
      _t3913 = ({_hd: Parser$parse_extern_decl(p), _tl: null});
      break _t3914;
    }
    if (_t3912._tag === 44) {
      _t3913 = ({_hd: Parser$parse_module_decl(p), _tl: null});
      break _t3914;
    }
    if (_t3912._tag === 46) {
      _t3913 = ({_hd: Parser$parse_open_decl(p), _tl: null});
      break _t3914;
    }
    if (true) {
      const expr_3915 = Parser$parse_expr(p);
      const _t3916 = ({_hd: ({_tag: 6, _name: "DExpr", _val: expr_3915}), _tl: null});
      _t3913 = _t3916;
      break _t3914;
    }
    _match_fail("line 16933");
  }
  return _t3913;
}
function Parser$parse_program(tokens) {
  const p_3917 = Parser$create(tokens);
  const decls_3919 = Ref$create(null);
  let _t3921 = undefined;
  let _t3922 = false, _t3923;
  while (true) {
    if (!(!_eq(Parser$peek_kind(p_3917), ({_tag: 92, _name: "EOF"})))) break;
    const ds_3924 = Parser$parse_decl(p_3917);
    Ref$set(decls_3919, List$rev_append(ds_3924, Ref$get(decls_3919)));
    let _t3926;
    if (_eq(Parser$peek_kind(p_3917), ({_tag: 61, _name: "DOUBLE_SEMICOLON"}))) {
      Parser$advance(p_3917);
      _t3926 = undefined;
    } else {
      _t3926 = undefined;
    }
    const _t3925 = _t3926;
    _t3925;
    if (_t3922) break;
  }
  _t3921 = _t3922 ? _t3923 : undefined;
  _t3921;
  const _t3920 = List$rev(Ref$get(decls_3919));
  const _t3918 = _t3920;
  return _t3918;
}
function Parser$parse_expr_string(tokens) {
  const p_3927 = Parser$create(tokens);
  const _t3928 = Parser$parse_expr(p_3927);
  return _t3928;
}
const Typechecker$current_loc = Ref$create(({col: 0, line: 0, offset: 0}));
function Typechecker$error(msg) {
  return _trampoline(function() {
    return _h["type_error"]([msg, Ref$get(Typechecker$current_loc)], function(_t3929) {
      return _bounce(function() {
        return _t3929;
      });
    });
  }, Typechecker$error);
}
function Typechecker$strip_loc(expr) {
  while (true) {
    let _t3931;
    const _t3930 = expr;
    _t3932: {
      if (_t3930._tag === 49) {
        const inner = _t3930._val[1];
        const _t3933 = inner;
        expr = _t3933;
        continue;
        _t3931 = undefined;
        break _t3932;
      }
      if (true) {
        const e = _t3930;
        _t3931 = e;
        break _t3932;
      }
      _match_fail("line 16933");
    }
    return _t3931;
  }
}
function Typechecker$is_constructive(expr) {
  while (true) {
    let _t3935;
    const _t3934 = Typechecker$strip_loc(expr);
    _t3936: {
      if ((((((((_t3934._tag === 0 || _t3934._tag === 1) || _t3934._tag === 2) || _t3934._tag === 3) || _t3934._tag === 4) || _t3934._tag === 5) || _t3934._tag === 6) || _t3934._tag === 21)) {
        _t3935 = true;
        break _t3936;
      }
      if (_t3934._tag === 7) {
        _t3935 = true;
        break _t3936;
      }
      if (_t3934._tag === 10) {
        _t3935 = true;
        break _t3936;
      }
      if (_t3934._tag === 20) {
        const hd = _t3934._val[0];
        const tl = _t3934._val[1];
        _t3935 = (Typechecker$is_constructive(hd) && Typechecker$is_constructive(tl));
        break _t3936;
      }
      if ((((_t3934._tag === 15 || _t3934._tag === 22) || _t3934._tag === 23) || _t3934._tag === 44)) {
        const es = _t3934._val;
        _t3935 = List$forall(Typechecker$is_constructive, es);
        break _t3936;
      }
      if (_t3934._tag === 16) {
        const fields = _t3934._val;
        function _t3937(__p64) {
          let _t3939;
          const _t3938 = __p64;
          _t3940: {
            if (true) {
              const e = _t3938[1];
              _t3939 = Typechecker$is_constructive(e);
              break _t3940;
            }
            _match_fail("line 16933");
          }
          return _t3939;
        }
        _t3935 = List$forall(_t3937, fields);
        break _t3936;
      }
      if ((_t3934._tag === 24 && _t3934._val[1]._tag === 0 || _t3934._tag === 46 && _t3934._val[1]._tag === 0)) {
        _t3935 = true;
        break _t3936;
      }
      if ((_t3934._tag === 24 && _t3934._val[1]._tag === 1 || _t3934._tag === 46 && _t3934._val[1]._tag === 1)) {
        const e = _t3934._val[1]._val;
        const _t3941 = e;
        expr = _t3941;
        continue;
        _t3935 = undefined;
        break _t3936;
      }
      if (_t3934._tag === 30) {
        const e = _t3934._val[0];
        const _t3942 = e;
        expr = _t3942;
        continue;
        _t3935 = undefined;
        break _t3936;
      }
      if (_t3934._tag === 8) {
        const e1 = _t3934._val[1];
        const e2 = _t3934._val[2];
        _t3935 = (Typechecker$is_constructive(e1) && Typechecker$is_constructive(e2));
        break _t3936;
      }
      if (_t3934._tag === 42) {
        const entries = _t3934._val;
        function _t3943(__p65) {
          let _t3945;
          const _t3944 = __p65;
          _t3946: {
            if (true) {
              const k = _t3944[0];
              const v = _t3944[1];
              _t3945 = (Typechecker$is_constructive(k) && Typechecker$is_constructive(v));
              break _t3946;
            }
            _match_fail("line 16933");
          }
          return _t3945;
        }
        _t3935 = List$forall(_t3943, entries);
        break _t3936;
      }
      if (_t3934._tag === 43) {
        const entries = _t3934._val[1];
        function _t3947(__p66) {
          let _t3949;
          const _t3948 = __p66;
          _t3950: {
            if (true) {
              const k = _t3948[0];
              const v = _t3948[1];
              _t3949 = (Typechecker$is_constructive(k) && Typechecker$is_constructive(v));
              break _t3950;
            }
            _match_fail("line 16933");
          }
          return _t3949;
        }
        _t3935 = List$forall(_t3947, entries);
        break _t3936;
      }
      if (_t3934._tag === 45) {
        const entries = _t3934._val[1];
        _t3935 = List$forall(Typechecker$is_constructive, entries);
        break _t3936;
      }
      if (_t3934._tag === 17) {
        const base = _t3934._val[0];
        const fields = _t3934._val[1];
        let _t3955;
        if (Typechecker$is_constructive(base)) {
        function _t3951(__p67) {
          let _t3953;
          const _t3952 = __p67;
          _t3954: {
            if (true) {
              const e = _t3952[1];
              _t3953 = Typechecker$is_constructive(e);
              break _t3954;
            }
            _match_fail("line 16933");
          }
          return _t3953;
        }
          _t3955 = List$forall(_t3951, fields);
        } else {
          _t3955 = false;
        }
        _t3935 = _t3955;
        break _t3936;
      }
      if (true) {
        _t3935 = false;
        break _t3936;
      }
      _match_fail("line 16933");
    }
    return _t3935;
  }
}
function Typechecker$is_immediately_linked(name, expr) {
  let _t3957;
  const _t3956 = Typechecker$strip_loc(expr);
  _t3958: {
    if (_t3956._tag === 7) {
      const n = _t3956._val;
      _t3957 = (n === name);
      break _t3958;
    }
    if (_t3956._tag === 30) {
      const e = _t3956._val[0];
      let _t3960;
      const _t3959 = Typechecker$strip_loc(e);
      _t3961: {
        if (_t3959._tag === 7) {
          const n = _t3959._val;
          _t3960 = (n === name);
          break _t3961;
        }
        if (true) {
          _t3960 = false;
          break _t3961;
        }
        _match_fail("line 16933");
      }
      _t3957 = _t3960;
      break _t3958;
    }
    if (true) {
      _t3957 = false;
      break _t3958;
    }
    _match_fail("line 16933");
  }
  return _t3957;
}
function Typechecker$try_unify(t1, t2) {
  const _t3962 = (function() {
    const _t3963 = _h;
    _h = Object.assign({}, _t3963, {
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const __x_3964 = Types$unify(t1, t2);
      return __x_3964;
    } catch (_exc) {
      if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return Typechecker$error(msg);
      } else { throw _exc; }
    } finally { _h = _t3963; }
  })();
  return _t3962;
}
function Typechecker$try_unify_eff(e1, e2) {
  const _t3965 = (function() {
    const _t3966 = _h;
    _h = Object.assign({}, _t3966, {
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const __x_3967 = Types$unify_eff(e1, e2);
      return __x_3967;
    } catch (_exc) {
      if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return Typechecker$error(msg);
      } else { throw _exc; }
    } finally { _h = _t3966; }
  })();
  return _t3965;
}
function Typechecker$try_subeffect(source, target) {
  const _t3968 = (function() {
    const _t3969 = _h;
    _h = Object.assign({}, _t3969, {
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const __x_3970 = Types$subeffect(source, target);
      return __x_3970;
    } catch (_exc) {
      if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return Typechecker$error(msg);
      } else { throw _exc; }
    } finally { _h = _t3969; }
  })();
  return _t3968;
}
function Typechecker$max_tgen_in_ty(__x) {
  while (true) {
    let _t3972;
    const _t3971 = __x;
    _t3973: {
      if (_t3971._tag === 16) {
        const i = _t3971._val;
        _t3972 = i;
        break _t3973;
      }
      if ((_t3971._tag === 7 || _t3971._tag === 8)) {
        const a = _t3971._val[0];
        const b = _t3971._val[2];
        _t3972 = max(Typechecker$max_tgen_in_ty(a), Typechecker$max_tgen_in_ty(b));
        break _t3973;
      }
      if (_t3971._tag === 9) {
        const ts = _t3971._val;
        function _t3974(acc, t) {
          return max(acc, Typechecker$max_tgen_in_ty(t));
        }
        _t3972 = List$fold(_t3974, (-1), ts);
        break _t3973;
      }
      if (_t3971._tag === 10) {
        const t = _t3971._val;
        const _t3975 = t;
        __x = _t3975;
        continue;
        _t3972 = undefined;
        break _t3973;
      }
      if (_t3971._tag === 11) {
        const row = _t3971._val;
        _t3972 = Typechecker$max_tgen_in_rrow(row);
        break _t3973;
      }
      if (_t3971._tag === 12) {
        const args = _t3971._val[1];
        function _t3976(acc, t) {
          return max(acc, Typechecker$max_tgen_in_ty(t));
        }
        _t3972 = List$fold(_t3976, (-1), args);
        break _t3973;
      }
      if (_t3971._tag === 13) {
        const t = _t3971._val;
        const _t3977 = t;
        __x = _t3977;
        continue;
        _t3972 = undefined;
        break _t3973;
      }
      if (true) {
        _t3972 = (-1);
        break _t3973;
      }
      _match_fail("line 16933");
    }
    return _t3972;
  }
}
function Typechecker$max_tgen_in_rrow(__x) {
  let _t3979;
  const _t3978 = __x;
  _t3980: {
    if (_t3978._tag === 0) {
      const ty = _t3978._val[1];
      const tail = _t3978._val[2];
      _t3979 = max(Typechecker$max_tgen_in_ty(ty), Typechecker$max_tgen_in_rrow(tail));
      break _t3980;
    }
    if (_t3978._tag === 3) {
      _t3979 = (-1);
      break _t3980;
    }
    if (true) {
      _t3979 = (-1);
      break _t3980;
    }
    _match_fail("line 16933");
  }
  return _t3979;
}
function Typechecker$max_effgen_in_eff(__x) {
  let _t3982;
  const _t3981 = __x;
  _t3983: {
    if (_t3981._tag === 3) {
      const i = _t3981._val;
      _t3982 = i;
      break _t3983;
    }
    if (_t3981._tag === 2) {
      const params = _t3981._val[1];
      const tail = _t3981._val[2];
      function _t3984(acc, t) {
        return max(acc, Typechecker$max_tgen_in_ty(t));
      }
      const ty_max_3985 = List$fold(_t3984, (-1), params);
      const _t3986 = max(ty_max_3985, Typechecker$max_effgen_in_eff(tail));
      _t3982 = _t3986;
      break _t3983;
    }
    if (true) {
      _t3982 = (-1);
      break _t3983;
    }
    _match_fail("line 16933");
  }
  return _t3982;
}
function Typechecker$max_effgen_in_ty(__x) {
  let _t3988;
  const _t3987 = __x;
  _t3989: {
    if ((_t3987._tag === 7 || _t3987._tag === 8)) {
      const a = _t3987._val[0];
      const eff = _t3987._val[1];
      const b = _t3987._val[2];
      _t3988 = max(max(Typechecker$max_tgen_in_ty(a), Typechecker$max_tgen_in_ty(b)), Typechecker$max_effgen_in_eff(eff));
      break _t3989;
    }
    if (true) {
      _t3988 = (-1);
      break _t3989;
    }
    _match_fail("line 16933");
  }
  return _t3988;
}
function Typechecker$lookup_var(ctx, level, name) {
  let _t3991;
  const _t3990 = List$assoc_opt(name, ctx.vars);
  _t3992: {
    if (_t3990._tag === 1) {
      const scheme = _t3990._val;
      _t3991 = Types$instantiate(level, scheme);
      break _t3992;
    }
    if (_t3990._tag === 0) {
      let _t3994;
      const _t3993 = String$rindex_opt(name, 46);
      _t3995: {
        if (_t3993._tag === 1) {
          const i = _t3993._val;
          const class_prefix_3996 = String$sub(name, 0, i);
          const method_name_3998 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
          function _t4000(cls) {
            let _t4005;
            if ((cls.class_name === class_prefix_3996)) {
            function _t4001(__p68) {
              let _t4003;
              const _t4002 = __p68;
              _t4004: {
                if (true) {
                  const m = _t4002[0];
                  _t4003 = (m === method_name_3998);
                  break _t4004;
                }
                _match_fail("line 16933");
              }
              return _t4003;
            }
              _t4005 = List$exists(_t4001, cls.class_methods);
            } else {
              _t4005 = false;
            }
            return _t4005;
          }
          let _t4007;
          const _t4006 = List$find(_t4000, ctx.type_env.classes);
          _t4008: {
            if (_t4006._tag === 1) {
              const class_def = _t4006._val;
              const method_ty_4009 = List$assoc(method_name_3998, class_def.class_methods);
              const num_class_params_4011 = List$length(class_def.class_params);
              const max_gen_4013 = Typechecker$max_tgen_in_ty(method_ty_4009);
              const quant_4015 = max((max_gen_4013 + 1), num_class_params_4011);
              const max_effgen_4017 = Typechecker$max_effgen_in_ty(method_ty_4009);
              let _t4019;
              if ((max_effgen_4017 >= 0)) {
                _t4019 = (max_effgen_4017 + 1);
              } else {
                _t4019 = 0;
              }
              const equant_4020 = _t4019;
              const scheme_4022 = ({body: method_ty_4009, constraints: null, equant: equant_4020, pvquant: 0, quant: quant_4015, record_evidences: null, rquant: 0});
              const _t4023 = Types$instantiate(level, scheme_4022);
              const _t4021 = _t4023;
              const _t4018 = _t4021;
              const _t4016 = _t4018;
              const _t4014 = _t4016;
              const _t4012 = _t4014;
              const _t4010 = _t4012;
              _t4007 = _t4010;
              break _t4008;
            }
            if (_t4006._tag === 0) {
              _t4007 = Typechecker$error(("unbound variable: " + __dict_Show_string.show(name)));
              break _t4008;
            }
            _match_fail("line 16933");
          }
          const _t3999 = _t4007;
          const _t3997 = _t3999;
          _t3994 = _t3997;
          break _t3995;
        }
        if (_t3993._tag === 0) {
          _t3994 = Typechecker$error(("unbound variable: " + __dict_Show_string.show(name)));
          break _t3995;
        }
        _match_fail("line 16933");
      }
      _t3991 = _t3994;
      break _t3992;
    }
    _match_fail("line 16933");
  }
  return _t3991;
}
function Typechecker$extend_var(ctx, name, scheme) {
  const __rec_upd_4024 = ctx;
  function _t4026(n) {
    return (n !== name);
  }
  const _t4025 = ({constraint_tvars: __rec_upd_4024.constraint_tvars, current_eff: __rec_upd_4024.current_eff, current_module: __rec_upd_4024.current_module, inside_handler: __rec_upd_4024.inside_handler, loop_info: __rec_upd_4024.loop_info, mutable_vars: List$filter(_t4026, ctx.mutable_vars), return_type: __rec_upd_4024.return_type, return_used: __rec_upd_4024.return_used, type_env: __rec_upd_4024.type_env, vars: ({_hd: [name, scheme], _tl: ctx.vars})});
  return _t4025;
}
function Typechecker$extend_var_mono(ctx, name, ty) {
  return Typechecker$extend_var(ctx, name, Types$mono(ty));
}
function Typechecker$extend_var_mutable(ctx, name, scheme) {
  const __rec_upd_4027 = ctx;
  function _t4029(n) {
    return (n !== name);
  }
  const _t4028 = ({constraint_tvars: __rec_upd_4027.constraint_tvars, current_eff: __rec_upd_4027.current_eff, current_module: __rec_upd_4027.current_module, inside_handler: __rec_upd_4027.inside_handler, loop_info: __rec_upd_4027.loop_info, mutable_vars: ({_hd: name, _tl: List$filter(_t4029, ctx.mutable_vars)}), return_type: __rec_upd_4027.return_type, return_used: __rec_upd_4027.return_used, type_env: __rec_upd_4027.type_env, vars: ({_hd: [name, scheme], _tl: ctx.vars})});
  return _t4028;
}
function Typechecker$resolve_type_alias(type_env, name) {
  let _t4031;
  const _t4030 = List$assoc_opt(name, type_env.type_aliases);
  _t4032: {
    if (_t4030._tag === 1) {
      const canonical = _t4030._val;
      _t4031 = canonical;
      break _t4032;
    }
    if (_t4030._tag === 0) {
      _t4031 = name;
      break _t4032;
    }
    _match_fail("line 16933");
  }
  return _t4031;
}
function Typechecker$find_variant_info(type_env, name) {
  const name_4033 = Typechecker$resolve_type_alias(type_env, name);
  function _t4035(__p69) {
    let _t4037;
    const _t4036 = __p69;
    _t4038: {
      if (true) {
        const n = _t4036[0];
        _t4037 = (n === name_4033);
        break _t4038;
      }
      _match_fail("line 16933");
    }
    return _t4037;
  }
  const _t4034 = List$find(_t4035, type_env.variants);
  return _t4034;
}
function Typechecker$subst_tgens(inst_tys, ty) {
  const arr_4039 = Array$of_list(inst_tys);
  function go(__x) {
    let _t4042;
    const _t4041 = __x;
    _t4043: {
      if (_t4041._tag === 16) {
        const i = _t4041._val;
        if ((i < Array$length(arr_4039))) {
          _t4042 = Array$get(arr_4039, i);
          break _t4043;
        }
      }
      if (_t4041._tag === 7) {
        const a = _t4041._val[0];
        const eff = _t4041._val[1];
        const b = _t4041._val[2];
        _t4042 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(b)]});
        break _t4043;
      }
      if (_t4041._tag === 8) {
        const a = _t4041._val[0];
        const eff = _t4041._val[1];
        const b = _t4041._val[2];
        _t4042 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(b)]});
        break _t4043;
      }
      if (_t4041._tag === 9) {
        const ts = _t4041._val;
        _t4042 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
        break _t4043;
      }
      if (_t4041._tag === 10) {
        const t = _t4041._val;
        _t4042 = ({_tag: 10, _name: "TList", _val: go(t)});
        break _t4043;
      }
      if (_t4041._tag === 13) {
        const t = _t4041._val;
        _t4042 = ({_tag: 13, _name: "TArray", _val: go(t)});
        break _t4043;
      }
      if (_t4041._tag === 11) {
        const row = _t4041._val;
        _t4042 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
        break _t4043;
      }
      if (_t4041._tag === 12) {
        const name = _t4041._val[0];
        const args = _t4041._val[1];
        _t4042 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
        break _t4043;
      }
      if (_t4041._tag === 14) {
        const row = _t4041._val;
        _t4042 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
        break _t4043;
      }
      if (true) {
        const t = _t4041;
        _t4042 = t;
        break _t4043;
      }
      _match_fail("line 16933");
    }
    return _t4042;
  }
  function go_eff(__x) {
    let _t4045;
    const _t4044 = __x;
    _t4046: {
      if (_t4044._tag === 2) {
        const label = _t4044._val[0];
        const params = _t4044._val[1];
        const tail = _t4044._val[2];
        _t4045 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
        break _t4046;
      }
      if (true) {
        const e = _t4044;
        _t4045 = e;
        break _t4046;
      }
      _match_fail("line 16933");
    }
    return _t4045;
  }
  function go_pv(__x) {
    let _t4048;
    const _t4047 = __x;
    _t4049: {
      if (_t4047._tag === 0) {
        const tag = _t4047._val[0];
        const ty_opt = _t4047._val[1];
        const tail = _t4047._val[2];
        _t4048 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
        break _t4049;
      }
      if (true) {
        const r = _t4047;
        _t4048 = r;
        break _t4049;
      }
      _match_fail("line 16933");
    }
    return _t4048;
  }
  function go_rrow(__x) {
    let _t4051;
    const _t4050 = __x;
    _t4052: {
      if (_t4050._tag === 0) {
        const name = _t4050._val[0];
        const ty = _t4050._val[1];
        const tail = _t4050._val[2];
        _t4051 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
        break _t4052;
      }
      if (true) {
        const r = _t4050;
        _t4051 = r;
        break _t4052;
      }
      _match_fail("line 16933");
    }
    return _t4051;
  }
  const _t4053 = go(ty);
  const _t4040 = _t4053;
  return _t4040;
}
function Typechecker$freshen_arrow_effects(level, ty) {
  function go(__x) {
    let _t4055;
    const _t4054 = __x;
    _t4056: {
      if (_t4054._tag === 7) {
        const a = _t4054._val[0];
        const eff = _t4054._val[1];
        const b = _t4054._val[2];
        let _t4058;
        const _t4057 = eff;
        _t4059: {
          if (_t4057._tag === 1) {
            _t4058 = Types$new_effvar(level);
            break _t4059;
          }
          if (true) {
            const e = _t4057;
            _t4058 = e;
            break _t4059;
          }
          _match_fail("line 16933");
        }
        const eff$p_4060 = _t4058;
        const _t4061 = ({_tag: 7, _name: "TArrow", _val: [go(a), eff$p_4060, go(b)]});
        _t4055 = _t4061;
        break _t4056;
      }
      if (_t4054._tag === 8) {
        const a = _t4054._val[0];
        const eff = _t4054._val[1];
        const b = _t4054._val[2];
        let _t4063;
        const _t4062 = eff;
        _t4064: {
          if (_t4062._tag === 1) {
            _t4063 = Types$new_effvar(level);
            break _t4064;
          }
          if (true) {
            const e = _t4062;
            _t4063 = e;
            break _t4064;
          }
          _match_fail("line 16933");
        }
        const eff$p_4065 = _t4063;
        const _t4066 = ({_tag: 8, _name: "TCont", _val: [go(a), eff$p_4065, go(b)]});
        _t4055 = _t4066;
        break _t4056;
      }
      if (_t4054._tag === 9) {
        const ts = _t4054._val;
        _t4055 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
        break _t4056;
      }
      if (_t4054._tag === 10) {
        const t = _t4054._val;
        _t4055 = ({_tag: 10, _name: "TList", _val: go(t)});
        break _t4056;
      }
      if (_t4054._tag === 13) {
        const t = _t4054._val;
        _t4055 = ({_tag: 13, _name: "TArray", _val: go(t)});
        break _t4056;
      }
      if (_t4054._tag === 11) {
        const row = _t4054._val;
        _t4055 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
        break _t4056;
      }
      if (_t4054._tag === 12) {
        const name = _t4054._val[0];
        const args = _t4054._val[1];
        _t4055 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
        break _t4056;
      }
      if (_t4054._tag === 14) {
        const row = _t4054._val;
        _t4055 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
        break _t4056;
      }
      if (true) {
        const t = _t4054;
        _t4055 = t;
        break _t4056;
      }
      _match_fail("line 16933");
    }
    return _t4055;
  }
  function go_pv(__x) {
    let _t4068;
    const _t4067 = __x;
    _t4069: {
      if (_t4067._tag === 0) {
        const tag = _t4067._val[0];
        const ty_opt = _t4067._val[1];
        const tail = _t4067._val[2];
        _t4068 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
        break _t4069;
      }
      if (true) {
        const r = _t4067;
        _t4068 = r;
        break _t4069;
      }
      _match_fail("line 16933");
    }
    return _t4068;
  }
  function go_rrow(__x) {
    let _t4071;
    const _t4070 = __x;
    _t4072: {
      if (_t4070._tag === 0) {
        const name = _t4070._val[0];
        const ty = _t4070._val[1];
        const tail = _t4070._val[2];
        _t4071 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
        break _t4072;
      }
      if (true) {
        const r = _t4070;
        _t4071 = r;
        break _t4072;
      }
      _match_fail("line 16933");
    }
    return _t4071;
  }
  const _t4073 = go(ty);
  return _t4073;
}
function Typechecker$freshen_tvars(level, ty) {
  const mapping_4074 = Hashtbl$create(4);
  function go(__x) {
    while (true) {
      let _t4077;
      const _t4076 = __x;
      _t4078: {
        if (_t4076._tag === 15 && _t4076._val.contents._tag === 0) {
          const id = _t4076._val.contents._val[0];
          let _t4080;
          const _t4079 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, mapping_4074, id]);
          _t4081: {
            if (_t4079._tag === 1) {
              const fresh = _t4079._val;
              _t4080 = fresh;
              break _t4081;
            }
            if (_t4079._tag === 0) {
              const fresh_4082 = Types$new_tvar(level);
              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, mapping_4074, id, fresh_4082]);
              const _t4083 = fresh_4082;
              _t4080 = _t4083;
              break _t4081;
            }
            _match_fail("line 16933");
          }
          _t4077 = _t4080;
          break _t4078;
        }
        if (_t4076._tag === 15 && _t4076._val.contents._tag === 1) {
          const t = _t4076._val.contents._val;
          const _t4084 = t;
          __x = _t4084;
          continue;
          _t4077 = undefined;
          break _t4078;
        }
        if (_t4076._tag === 7) {
          const a = _t4076._val[0];
          const eff = _t4076._val[1];
          const b = _t4076._val[2];
          _t4077 = ({_tag: 7, _name: "TArrow", _val: [go(a), go_eff(eff), go(b)]});
          break _t4078;
        }
        if (_t4076._tag === 8) {
          const a = _t4076._val[0];
          const eff = _t4076._val[1];
          const b = _t4076._val[2];
          _t4077 = ({_tag: 8, _name: "TCont", _val: [go(a), go_eff(eff), go(b)]});
          break _t4078;
        }
        if (_t4076._tag === 9) {
          const ts = _t4076._val;
          _t4077 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t4078;
        }
        if (_t4076._tag === 10) {
          const t = _t4076._val;
          _t4077 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t4078;
        }
        if (_t4076._tag === 13) {
          const t = _t4076._val;
          _t4077 = ({_tag: 13, _name: "TArray", _val: go(t)});
          break _t4078;
        }
        if (_t4076._tag === 11) {
          const row = _t4076._val;
          _t4077 = ({_tag: 11, _name: "TRecord", _val: go_rrow(row)});
          break _t4078;
        }
        if (_t4076._tag === 12) {
          const name = _t4076._val[0];
          const args = _t4076._val[1];
          _t4077 = ({_tag: 12, _name: "TVariant", _val: [name, List$map(go, args)]});
          break _t4078;
        }
        if (_t4076._tag === 14) {
          const row = _t4076._val;
          _t4077 = ({_tag: 14, _name: "TPolyVariant", _val: go_pv(row)});
          break _t4078;
        }
        if (true) {
          const t = _t4076;
          _t4077 = t;
          break _t4078;
        }
        _match_fail("line 16933");
      }
      return _t4077;
    }
  }
  function go_eff(__x) {
    while (true) {
      let _t4086;
      const _t4085 = __x;
      _t4087: {
        if (_t4085._tag === 0 && _t4085._val.contents._tag === 0) {
          const e = _t4085;
          _t4086 = e;
          break _t4087;
        }
        if (_t4085._tag === 0 && _t4085._val.contents._tag === 1) {
          const e = _t4085._val.contents._val;
          const _t4088 = e;
          __x = _t4088;
          continue;
          _t4086 = undefined;
          break _t4087;
        }
        if (_t4085._tag === 2) {
          const label = _t4085._val[0];
          const params = _t4085._val[1];
          const tail = _t4085._val[2];
          _t4086 = ({_tag: 2, _name: "EffRow", _val: [label, List$map(go, params), go_eff(tail)]});
          break _t4087;
        }
        if (true) {
          const e = _t4085;
          _t4086 = e;
          break _t4087;
        }
        _match_fail("line 16933");
      }
      return _t4086;
    }
  }
  function go_pv(__x) {
    let _t4090;
    const _t4089 = __x;
    _t4091: {
      if (_t4089._tag === 0) {
        const tag = _t4089._val[0];
        const ty_opt = _t4089._val[1];
        const tail = _t4089._val[2];
        _t4090 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, ty_opt), go_pv(tail)]});
        break _t4091;
      }
      if (true) {
        const r = _t4089;
        _t4090 = r;
        break _t4091;
      }
      _match_fail("line 16933");
    }
    return _t4090;
  }
  function go_rrow(__x) {
    while (true) {
      let _t4093;
      const _t4092 = __x;
      _t4094: {
        if (_t4092._tag === 0) {
          const name = _t4092._val[0];
          const ty = _t4092._val[1];
          const tail = _t4092._val[2];
          _t4093 = ({_tag: 0, _name: "RRow", _val: [name, go(ty), go_rrow(tail)]});
          break _t4094;
        }
        if (_t4092._tag === 1 && _t4092._val.contents._tag === 0) {
          _t4093 = Types$new_rvar(level);
          break _t4094;
        }
        if (_t4092._tag === 1 && _t4092._val.contents._tag === 1) {
          const r = _t4092._val.contents._val;
          const _t4095 = r;
          __x = _t4095;
          continue;
          _t4093 = undefined;
          break _t4094;
        }
        if (true) {
          const r = _t4092;
          _t4093 = r;
          break _t4094;
        }
        _match_fail("line 16933");
      }
      return _t4093;
    }
  }
  const _t4096 = go(ty);
  const _t4075 = _t4096;
  return _t4075;
}
function Typechecker$resolve_ty_annot_shared(ctx, level, tvars, annot) {
  function go(__x) {
    while (true) {
      let _t4098;
      const _t4097 = __x;
      _t4099: {
        if (_t4097._tag === 1) {
          const name = _t4097._val;
          let _t4101;
          const _t4100 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars, name]);
          _t4102: {
            if (_t4100._tag === 1) {
              const tv = _t4100._val;
              _t4101 = tv;
              break _t4102;
            }
            if (_t4100._tag === 0) {
              const tv_4103 = Types$new_tvar(level);
              _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars, name, tv_4103]);
              const _t4104 = tv_4103;
              _t4101 = _t4104;
              break _t4102;
            }
            _match_fail("line 16933");
          }
          _t4098 = _t4101;
          break _t4099;
        }
        if (_t4097._tag === 0 && _t4097._val === "int") {
          _t4098 = ({_tag: 0, _name: "TInt"});
          break _t4099;
        }
        if (_t4097._tag === 0 && _t4097._val === "float") {
          _t4098 = ({_tag: 1, _name: "TFloat"});
          break _t4099;
        }
        if (_t4097._tag === 0 && _t4097._val === "bool") {
          _t4098 = ({_tag: 2, _name: "TBool"});
          break _t4099;
        }
        if (_t4097._tag === 0 && _t4097._val === "string") {
          _t4098 = ({_tag: 3, _name: "TString"});
          break _t4099;
        }
        if (_t4097._tag === 0 && _t4097._val === "byte") {
          _t4098 = ({_tag: 4, _name: "TByte"});
          break _t4099;
        }
        if (_t4097._tag === 0 && _t4097._val === "rune") {
          _t4098 = ({_tag: 5, _name: "TRune"});
          break _t4099;
        }
        if (_t4097._tag === 0 && _t4097._val === "unit") {
          _t4098 = ({_tag: 6, _name: "TUnit"});
          break _t4099;
        }
        if (_t4097._tag === 0) {
          const name = _t4097._val;
          const canonical_4105 = Typechecker$resolve_type_alias(ctx.type_env, name);
          let _t4107;
          if (List$mem(canonical_4105, ctx.type_env.hidden_types)) {
            _t4107 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
          } else {
            _t4107 = undefined;
          }
          _t4107;
          function _t4108(__p70) {
            let _t4110;
            const _t4109 = __p70;
            _t4111: {
              if (true) {
                const n = _t4109[0];
                _t4110 = (n === canonical_4105);
                break _t4111;
              }
              _match_fail("line 16933");
            }
            return _t4110;
          }
          let _t4113;
          const _t4112 = List$find(_t4108, ctx.type_env.type_synonyms);
          _t4114: {
            if (_t4112._tag === 1 && _t4112._val[1] === 0) {
              const ty = _t4112._val[2];
              _t4113 = Typechecker$freshen_tvars(level, Typechecker$freshen_arrow_effects(level, ty));
              break _t4114;
            }
            if (_t4112._tag === 1) {
              const n = _t4112._val[1];
              _t4113 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
              break _t4114;
            }
            if (_t4112._tag === 0) {
              let _t4116;
              const _t4115 = Typechecker$find_variant_info(ctx.type_env, name);
              _t4117: {
                if (_t4115._tag === 1 && _t4115._val[1] === 0) {
                  _t4116 = ({_tag: 12, _name: "TVariant", _val: [canonical_4105, null]});
                  break _t4117;
                }
                if (_t4115._tag === 1) {
                  const n = _t4115._val[1];
                  _t4116 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                  break _t4117;
                }
                if (_t4115._tag === 0) {
                  let _t4118;
                  if (!_eq(List$assoc_opt(canonical_4105, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                    const fields_4119 = List$assoc(canonical_4105, ctx.type_env.records);
                    let _t4121;
                    if (_eq(fields_4119, null)) {
                      _t4121 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                    } else {
                      _t4121 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_4119)});
                    }
                    const _t4120 = _t4121;
                    _t4118 = _t4120;
                  } else {
                    _t4118 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                  }
                  _t4116 = _t4118;
                  break _t4117;
                }
                _match_fail("line 16933");
              }
              _t4113 = _t4116;
              break _t4114;
            }
            _match_fail("line 16933");
          }
          const _t4106 = _t4113;
          _t4098 = _t4106;
          break _t4099;
        }
        if (_t4097._tag === 2) {
          const a = _t4097._val[0];
          const b = _t4097._val[1];
          const eff_opt = _t4097._val[2];
          let _t4123;
          const _t4122 = eff_opt;
          _t4124: {
            if (_t4122._tag === 0) {
              _t4123 = Types$new_effvar(level);
              break _t4124;
            }
            if (_t4122._tag === 1 && _t4122._val._tag === 0) {
              _t4123 = ({_tag: 1, _name: "EffEmpty"});
              break _t4124;
            }
            if (_t4122._tag === 1 && _t4122._val._tag === 1) {
              const items = _t4122._val._val;
              _t4123 = Typechecker$resolve_eff_items(ctx, level, tvars, items);
              break _t4124;
            }
            _match_fail("line 16933");
          }
          const eff_4125 = _t4123;
          const _t4126 = ({_tag: 7, _name: "TArrow", _val: [go(a), eff_4125, go(b)]});
          _t4098 = _t4126;
          break _t4099;
        }
        if (_t4097._tag === 6) {
          const ts = _t4097._val;
          _t4098 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t4099;
        }
        if (_t4097._tag === 4) {
          const t = _t4097._val;
          _t4098 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t4099;
        }
        if (_t4097._tag === 5) {
          const t = _t4097._val;
          _t4098 = ({_tag: 13, _name: "TArray", _val: go(t)});
          break _t4099;
        }
        if (_t4097._tag === 7) {
          const args = _t4097._val[0];
          const name = _t4097._val[1];
          const canonical_4127 = Typechecker$resolve_type_alias(ctx.type_env, name);
          let _t4129;
          if (List$mem(canonical_4127, ctx.type_env.hidden_types)) {
            _t4129 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
          } else {
            _t4129 = undefined;
          }
          _t4129;
          const arg_tys_4130 = List$map(go, args);
          function _t4132(__p71) {
            let _t4134;
            const _t4133 = __p71;
            _t4135: {
              if (true) {
                const n = _t4133[0];
                _t4134 = (n === canonical_4127);
                break _t4135;
              }
              _match_fail("line 16933");
            }
            return _t4134;
          }
          let _t4137;
          const _t4136 = List$find(_t4132, ctx.type_env.type_synonyms);
          _t4138: {
            if (_t4136._tag === 1) {
              const np = _t4136._val[1];
              const ty = _t4136._val[2];
              let _t4139;
              if ((List$length(arg_tys_4130) !== np)) {
                _t4139 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_4130))));
              } else {
                _t4139 = undefined;
              }
              _t4139;
              _t4137 = Typechecker$freshen_tvars(level, Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(arg_tys_4130, ty)));
              break _t4138;
            }
            if (_t4136._tag === 0) {
              let _t4141;
              const _t4140 = Typechecker$find_variant_info(ctx.type_env, name);
              _t4142: {
                if (_t4140._tag === 1) {
                  const np = _t4140._val[1];
                  let _t4143;
                  if ((List$length(arg_tys_4130) !== np)) {
                    _t4143 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_4130))));
                  } else {
                    _t4143 = undefined;
                  }
                  _t4143;
                  _t4141 = ({_tag: 12, _name: "TVariant", _val: [canonical_4127, arg_tys_4130]});
                  break _t4142;
                }
                if (_t4140._tag === 0) {
                  _t4141 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
                  break _t4142;
                }
                _match_fail("line 16933");
              }
              _t4137 = _t4141;
              break _t4138;
            }
            _match_fail("line 16933");
          }
          const _t4131 = _t4137;
          const _t4128 = _t4131;
          _t4098 = _t4128;
          break _t4099;
        }
        if (_t4097._tag === 3) {
          const fields = _t4097._val[0];
          const is_open = _t4097._val[1];
          function _t4144(__p72) {
            let _t4146;
            const _t4145 = __p72;
            _t4147: {
              if (true) {
                const n = _t4145[0];
                const t = _t4145[1];
                _t4146 = [n, go(t)];
                break _t4147;
              }
              _match_fail("line 16933");
            }
            return _t4146;
          }
          const fields_4148 = List$map(_t4144, fields);
          function _t4150(__p73, __p74) {
            let _t4152;
            const _t4151 = __p73;
            _t4153: {
              if (true) {
                const a = _t4151[0];
                let _t4155;
                const _t4154 = __p74;
                _t4156: {
                  if (true) {
                    const b = _t4154[0];
                    _t4155 = String$compare(a, b);
                    break _t4156;
                  }
                  _match_fail("line 16933");
                }
                _t4152 = _t4155;
                break _t4153;
              }
              _match_fail("line 16933");
            }
            return _t4152;
          }
          const fields_4157 = List$sort(_t4150, fields_4148);
          let _t4159;
          if (is_open) {
            _t4159 = Types$new_rvar(level);
          } else {
            _t4159 = ({_tag: 2, _name: "REmpty"});
          }
          const tail_4160 = _t4159;
          function _t4162(__p75, acc) {
            let _t4164;
            const _t4163 = __p75;
            _t4165: {
              if (true) {
                const n = _t4163[0];
                const t = _t4163[1];
                _t4164 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                break _t4165;
              }
              _match_fail("line 16933");
            }
            return _t4164;
          }
          const _t4161 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t4162, fields_4157, tail_4160)});
          const _t4158 = _t4161;
          const _t4149 = _t4158;
          _t4098 = _t4149;
          break _t4099;
        }
        if (_t4097._tag === 8) {
          const path = _t4097._val[0];
          const name = _t4097._val[1];
          const qualified_4166 = (String$concat(".", path) + ("." + name));
          const _t4168 = ({_tag: 0, _name: "TyName", _val: qualified_4166});
          __x = _t4168;
          continue;
          const _t4167 = undefined;
          _t4098 = _t4167;
          break _t4099;
        }
        if (_t4097._tag === 9) {
          const kind = _t4097._val[0];
          const tags = _t4097._val[1];
          let _t4170;
          const _t4169 = kind;
          _t4171: {
            if ((_t4169._tag === 0 || _t4169._tag === 2)) {
              _t4170 = ({_tag: 2, _name: "PVEmpty"});
              break _t4171;
            }
            if (_t4169._tag === 1) {
              _t4170 = Types$new_pvvar(level);
              break _t4171;
            }
            _match_fail("line 16933");
          }
          const tail_4172 = _t4170;
          function _t4174(__p76, acc) {
            let _t4176;
            const _t4175 = __p76;
            _t4177: {
              if (true) {
                const tag = _t4175[0];
                const payload_annot = _t4175[1];
                _t4176 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload_annot), acc]});
                break _t4177;
              }
              _match_fail("line 16933");
            }
            return _t4176;
          }
          const row_4178 = List$fold_right(_t4174, tags, tail_4172);
          const _t4179 = ({_tag: 14, _name: "TPolyVariant", _val: row_4178});
          const _t4173 = _t4179;
          _t4098 = _t4173;
          break _t4099;
        }
        if (_t4097._tag === 10) {
          const ty = _t4097._val[0];
          const _eff = _t4097._val[1];
          const _t4180 = ty;
          __x = _t4180;
          continue;
          _t4098 = undefined;
          break _t4099;
        }
        _match_fail("line 16933");
      }
      return _t4098;
    }
  }
  const _t4181 = go(annot);
  return _t4181;
}
function Typechecker$resolve_eff_items(ctx, level, tvars, items) {
  const labels_4182 = Ref$create(null);
  const row_var_4184 = Ref$create(({_tag: 0, _name: "None"}));
  function _t4186(item) {
    let _t4188;
    const _t4187 = item;
    _t4189: {
      if (_t4187._tag === 0) {
        const name = _t4187._val[0];
        const param_annots = _t4187._val[1];
        let _t4190;
        if (!_eq(Ref$get(row_var_4184), ({_tag: 0, _name: "None"}))) {
          _t4190 = Typechecker$error("effect labels must come before row variable");
        } else {
          _t4190 = undefined;
        }
        _t4190;
        function _t4191(e) {
          return (e.effect_name === name);
        }
        let _t4193;
        const _t4192 = List$find(_t4191, ctx.type_env.effects);
        _t4194: {
          if (_t4192._tag === 1) {
            const e = _t4192._val;
            _t4193 = e;
            break _t4194;
          }
          if (_t4192._tag === 0) {
            _t4193 = Typechecker$error(("unknown effect: " + __dict_Show_string.show(name)));
            break _t4194;
          }
          _match_fail("line 16933");
        }
        const edef_4195 = _t4193;
        const expected_params_4197 = List$length(edef_4195.effect_params);
        const actual_params_4199 = List$length(param_annots);
        let _t4201;
        if ((expected_params_4197 !== actual_params_4199)) {
          _t4201 = Typechecker$error(((((("effect " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(expected_params_4197)) + " type parameter(s), got ") + __dict_Show_int.show(actual_params_4199)));
        } else {
          _t4201 = undefined;
        }
        _t4201;
        const _t4200 = Ref$set(labels_4182, ({_hd: [name, param_annots], _tl: Ref$get(labels_4182)}));
        const _t4198 = _t4200;
        const _t4196 = _t4198;
        _t4188 = _t4196;
        break _t4189;
      }
      if (_t4187._tag === 1) {
        const name = _t4187._val;
        let _t4202;
        if (!_eq(Ref$get(row_var_4184), ({_tag: 0, _name: "None"}))) {
          _t4202 = Typechecker$error("at most one effect row variable allowed");
        } else {
          _t4202 = undefined;
        }
        _t4202;
        _t4188 = Ref$set(row_var_4184, ({_tag: 1, _name: "Some", _val: name}));
        break _t4189;
      }
      _match_fail("line 16933");
    }
    return _t4188;
  }
  List$iter(_t4186, items);
  const labels_4203 = List$rev(Ref$get(labels_4182));
  let _t4206;
  const _t4205 = Ref$get(row_var_4184);
  _t4207: {
    if (_t4205._tag === 0) {
      _t4206 = Types$new_effvar(level);
      break _t4207;
    }
    if (_t4205._tag === 1) {
      const _name = _t4205._val;
      _t4206 = Types$new_effvar(level);
      break _t4207;
    }
    _match_fail("line 16933");
  }
  const tail_4208 = _t4206;
  function _t4210(__p77, acc) {
    let _t4212;
    const _t4211 = __p77;
    _t4213: {
      if (true) {
        const name = _t4211[0];
        const param_annots = _t4211[1];
        const resolved_params_4214 = List$map(_call(Typechecker$resolve_ty_annot_shared, [ctx, level, tvars]), param_annots);
        const _t4215 = ({_tag: 2, _name: "EffRow", _val: [name, resolved_params_4214, acc]});
        _t4212 = _t4215;
        break _t4213;
      }
      _match_fail("line 16933");
    }
    return _t4212;
  }
  const _t4209 = List$fold_right(_t4210, labels_4203, tail_4208);
  const _t4204 = _t4209;
  const _t4185 = _t4204;
  const _t4183 = _t4185;
  return _t4183;
}
function Typechecker$resolve_ty_annot(ctx, level, annot) {
  const tvars_4216 = Hashtbl$create(4);
  const _t4217 = Typechecker$resolve_ty_annot_shared(ctx, level, tvars_4216, annot);
  return _t4217;
}
function Typechecker$instantiate_record_fields(level, fields) {
  function _t4218(acc, __p78) {
    let _t4220;
    const _t4219 = __p78;
    _t4221: {
      if (true) {
        const ty = _t4219[1];
        _t4220 = max(acc, Typechecker$max_tgen_in_ty(ty));
        break _t4221;
      }
      _match_fail("line 16933");
    }
    return _t4220;
  }
  const max_gen_4222 = List$fold(_t4218, (-1), fields);
  let _t4224;
  if ((max_gen_4222 < 0)) {
    _t4224 = fields;
  } else {
    function _t4225(_) {
      return Types$new_tvar(level);
    }
    const fresh_4226 = List$init((max_gen_4222 + 1), _t4225);
    function _t4228(__p79) {
      let _t4230;
      const _t4229 = __p79;
      _t4231: {
        if (true) {
          const n = _t4229[0];
          const ty = _t4229[1];
          _t4230 = [n, Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(fresh_4226, ty))];
          break _t4231;
        }
        _match_fail("line 16933");
      }
      return _t4230;
    }
    const _t4227 = List$map(_t4228, fields);
    _t4224 = _t4227;
  }
  const _t4223 = _t4224;
  return _t4223;
}
function Typechecker$instantiate_record_row(level, fields) {
  const fields_4232 = Typechecker$instantiate_record_fields(level, fields);
  const _t4233 = Types$fields_to_closed_row(fields_4232);
  return _t4233;
}
function _t4234(_, __2) {
  return failwith("find_module_in_env not yet initialized");
}
const Typechecker$find_module_in_env_ref = Ref$create(_t4234);
function _t4235(_, __2, __3) {
  return failwith("open_module_into_ctx not yet initialized");
}
const Typechecker$open_module_into_ctx_ref = Ref$create(_t4235);
function _t4236(_, __2, __3) {
  return undefined;
}
const Typechecker$exhaustiveness_check_ref = Ref$create(_t4236);
function Typechecker$mk(te, ty) {
  return ({expr: te, loc: Ref$get(Typechecker$current_loc), ty: ty});
}
function Typechecker$extract_fn_info(expr) {
  while (true) {
    let _t4238;
    const _t4237 = expr;
    _t4239: {
      if (_t4237._tag === 49) {
        const inner = _t4237._val[1];
        const _t4240 = inner;
        expr = _t4240;
        continue;
        _t4238 = undefined;
        break _t4239;
      }
      if (_t4237._tag === 30) {
        const inner = _t4237._val[0];
        let _t4242;
        const _t4241 = inner;
        _t4243: {
          if ((_t4241._tag === 10 || _t4241._tag === 49 && _t4241._val[1]._tag === 10)) {
            _t4242 = true;
            break _t4243;
          }
          if (true) {
            _t4242 = false;
            break _t4243;
          }
          _match_fail("line 16933");
        }
        if (_t4242) {
          const _t4244 = inner;
          expr = _t4244;
          continue;
          _t4238 = undefined;
          break _t4239;
        }
      }
      if (_t4237._tag === 10) {
        const param = _t4237._val[0];
        const body = _t4237._val[1];
        let _t4246;
        const _t4245 = Typechecker$extract_fn_info(body);
        _t4247: {
          if (true) {
            const params = _t4245[0];
            const ret = _t4245[1];
            const inner = _t4245[2];
            _t4246 = [({_hd: param, _tl: params}), ret, inner];
            break _t4247;
          }
          _match_fail("line 16933");
        }
        _t4238 = _t4246;
        break _t4239;
      }
      if (_t4237._tag === 30) {
        const inner = _t4237._val[0];
        const annot = _t4237._val[1];
        _t4238 = [null, ({_tag: 1, _name: "Some", _val: annot}), inner];
        break _t4239;
      }
      if (true) {
        _t4238 = [null, ({_tag: 0, _name: "None"}), expr];
        break _t4239;
      }
      _match_fail("line 16933");
    }
    return _t4238;
  }
}
function Typechecker$resolve_module_name(ctx, name) {
  let _t4249;
  const _t4248 = ctx.current_module;
  _t4250: {
    if (_t4248._tag === 1) {
      const prefix = _t4248._val;
      function try_prefix(p) {
        while (true) {
          const qualified_4251 = (p + name);
          function _t4253(__p80) {
            let _t4255;
            const _t4254 = __p80;
            _t4256: {
              if (true) {
                const n = _t4254[0];
                _t4255 = (n === qualified_4251);
                break _t4256;
              }
              _match_fail("line 16933");
            }
            return _t4255;
          }
          let _t4257;
          if (List$exists(_t4253, ctx.vars)) {
            _t4257 = qualified_4251;
          } else {
            const p$p_4258 = String$sub(p, 0, max(0, (String$length(p) - 1)));
            let _t4261;
            const _t4260 = String$rindex_opt(p$p_4258, 46);
            _t4262: {
              if (_t4260._tag === 1) {
                const idx = _t4260._val;
                const _t4263 = String$sub(p$p_4258, 0, (idx + 1));
                p = _t4263;
                continue;
                _t4261 = undefined;
                break _t4262;
              }
              if (_t4260._tag === 0) {
                _t4261 = name;
                break _t4262;
              }
              _match_fail("line 16933");
            }
            const _t4259 = _t4261;
            _t4257 = _t4259;
          }
          const _t4252 = _t4257;
          return _t4252;
        }
      }
      const _t4264 = try_prefix(prefix);
      _t4249 = _t4264;
      break _t4250;
    }
    if (_t4248._tag === 0) {
      _t4249 = name;
      break _t4250;
    }
    _match_fail("line 16933");
  }
  return _t4249;
}
function Typechecker$find_var_type_in(target_name, te) {
  const result_4265 = Ref$create(({_tag: 0, _name: "None"}));
  function go(te) {
    while (true) {
      let _t4267;
      if (Option$is_some(Ref$get(result_4265))) {
        _t4267 = undefined;
      } else {
        let _t4269;
        const _t4268 = te.expr;
        _t4270: {
          if (_t4268._tag === 7) {
            const n = _t4268._val;
            if ((n === target_name)) {
              _t4269 = Ref$set(result_4265, ({_tag: 1, _name: "Some", _val: te.ty}));
              break _t4270;
            }
          }
          if ((((((((((_t4268._tag === 7 || _t4268._tag === 0) || _t4268._tag === 1) || _t4268._tag === 2) || _t4268._tag === 3) || _t4268._tag === 4) || _t4268._tag === 5) || _t4268._tag === 6) || _t4268._tag === 22) || _t4268._tag === 34)) {
            _t4269 = undefined;
            break _t4270;
          }
          if (_t4268._tag === 11) {
            const fn_ = _t4268._val[0];
            const arg = _t4268._val[1];
            go(fn_);
            const _t4271 = arg;
            te = _t4271;
            continue;
            _t4269 = undefined;
            break _t4270;
          }
          if (((((((((_t4268._tag === 10 || _t4268._tag === 14) || _t4268._tag === 19) || _t4268._tag === 33) || _t4268._tag === 35) || _t4268._tag === 36) || _t4268._tag === 39) || _t4268._tag === 26) || _t4268._tag === 29)) {
            const body = ((((((((_t4268._tag === 10 || _t4268._tag === 14) || _t4268._tag === 19) || _t4268._tag === 33) || _t4268._tag === 35) || _t4268._tag === 36) || _t4268._tag === 39) || _t4268._tag === 26) ? (((((((_t4268._tag === 10 || _t4268._tag === 14) || _t4268._tag === 19) || _t4268._tag === 33) || _t4268._tag === 35) || _t4268._tag === 36) || _t4268._tag === 39) ? ((((((_t4268._tag === 10 || _t4268._tag === 14) || _t4268._tag === 19) || _t4268._tag === 33) || _t4268._tag === 35) || _t4268._tag === 36) ? (((((_t4268._tag === 10 || _t4268._tag === 14) || _t4268._tag === 19) || _t4268._tag === 33) || _t4268._tag === 35) ? ((((_t4268._tag === 10 || _t4268._tag === 14) || _t4268._tag === 19) || _t4268._tag === 33) ? (((_t4268._tag === 10 || _t4268._tag === 14) || _t4268._tag === 19) ? ((_t4268._tag === 10 || _t4268._tag === 14) ? _t4268._val[1] : _t4268._val[0]) : _t4268._val) : _t4268._val) : _t4268._val) : _t4268._val) : _t4268._val[1]) : _t4268._val[1]);
            const _t4272 = body;
            te = _t4272;
            continue;
            _t4269 = undefined;
            break _t4270;
          }
          if ((((((((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) || _t4268._tag === 28) || _t4268._tag === 32) || _t4268._tag === 31) || _t4268._tag === 27) || _t4268._tag === 20)) {
            const e1 = (((((((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) || _t4268._tag === 28) || _t4268._tag === 32) || _t4268._tag === 31) || _t4268._tag === 27) ? ((((((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) || _t4268._tag === 28) || _t4268._tag === 32) || _t4268._tag === 31) ? (((((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) || _t4268._tag === 28) || _t4268._tag === 32) ? ((((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) || _t4268._tag === 28) ? (((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) ? ((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) ? (((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) ? ((_t4268._tag === 8 || _t4268._tag === 9) ? _t4268._val[2] : _t4268._val[1]) : _t4268._val[1]) : _t4268._val[0]) : _t4268._val[0]) : _t4268._val[0]) : _t4268._val[0]) : _t4268._val[0]) : _t4268._val[0]);
            const e2 = (((((((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) || _t4268._tag === 28) || _t4268._tag === 32) || _t4268._tag === 31) || _t4268._tag === 27) ? ((((((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) || _t4268._tag === 28) || _t4268._tag === 32) || _t4268._tag === 31) ? (((((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) || _t4268._tag === 28) || _t4268._tag === 32) ? ((((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) || _t4268._tag === 28) ? (((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) || _t4268._tag === 21) ? ((((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) || _t4268._tag === 13) ? (((_t4268._tag === 8 || _t4268._tag === 9) || _t4268._tag === 25) ? ((_t4268._tag === 8 || _t4268._tag === 9) ? _t4268._val[3] : _t4268._val[2]) : _t4268._val[2]) : _t4268._val[1]) : _t4268._val[1]) : _t4268._val[1]) : _t4268._val[1]) : _t4268._val[2]) : _t4268._val[1]);
            go(e1);
            const _t4273 = e2;
            te = _t4273;
            continue;
            _t4269 = undefined;
            break _t4270;
          }
          if (_t4268._tag === 12) {
            const c = _t4268._val[0];
            const t = _t4268._val[1];
            const e = _t4268._val[2];
            go(c);
            go(t);
            const _t4274 = e;
            te = _t4274;
            continue;
            _t4269 = undefined;
            break _t4270;
          }
          if ((_t4268._tag === 15 || _t4268._tag === 38)) {
            const es = _t4268._val;
            _t4269 = List$iter(go, es);
            break _t4270;
          }
          if (_t4268._tag === 16) {
            const fields = _t4268._val;
            function _t4275(__p81) {
              let _t4277;
              const _t4276 = __p81;
              _t4278: {
                if (true) {
                  const e = _t4276[1];
                  _t4277 = go(e);
                  break _t4278;
                }
                _match_fail("line 16933");
              }
              return _t4277;
            }
            _t4269 = List$iter(_t4275, fields);
            break _t4270;
          }
          if (_t4268._tag === 17) {
            const base = _t4268._val[0];
            const overrides = _t4268._val[1];
            go(base);
            function _t4279(__p82) {
              let _t4281;
              const _t4280 = __p82;
              _t4282: {
                if (true) {
                  const e = _t4280[1];
                  _t4281 = go(e);
                  break _t4282;
                }
                _match_fail("line 16933");
              }
              return _t4281;
            }
            _t4269 = List$iter(_t4279, overrides);
            break _t4270;
          }
          if (_t4268._tag === 18) {
            const base = _t4268._val[0];
            const pairs = _t4268._val[1];
            go(base);
            function _t4283(__p83) {
              let _t4285;
              const _t4284 = __p83;
              _t4286: {
                if (true) {
                  const i = _t4284[0];
                  const v = _t4284[1];
                  go(i);
                  _t4285 = go(v);
                  break _t4286;
                }
                _match_fail("line 16933");
              }
              return _t4285;
            }
            _t4269 = List$iter(_t4283, pairs);
            break _t4270;
          }
          if (_t4268._tag === 23) {
            const arg = _t4268._val[1];
            _t4269 = Option$iter(go, arg);
            break _t4270;
          }
          if (_t4268._tag === 24) {
            const scr = _t4268._val[0];
            const arms = _t4268._val[1];
            go(scr);
            function _t4287(__p84) {
              let _t4289;
              const _t4288 = __p84;
              _t4290: {
                if (true) {
                  const g = _t4288[1];
                  const body = _t4288[2];
                  Option$iter(go, g);
                  _t4289 = go(body);
                  break _t4290;
                }
                _match_fail("line 16933");
              }
              return _t4289;
            }
            _t4269 = List$iter(_t4287, arms);
            break _t4270;
          }
          if (_t4268._tag === 30) {
            const body = _t4268._val[0];
            const arms = _t4268._val[1];
            go(body);
            function _t4291(arm) {
              let _t4293;
              const _t4292 = arm;
              _t4294: {
                if ((((_t4292._tag === 0 || _t4292._tag === 1) || _t4292._tag === 2) || _t4292._tag === 3)) {
                  const e = (((_t4292._tag === 0 || _t4292._tag === 1) || _t4292._tag === 2) ? ((_t4292._tag === 0 || _t4292._tag === 1) ? (_t4292._tag === 0 ? _t4292._val[1] : _t4292._val[3]) : _t4292._val[2]) : _t4292._val[2]);
                  _t4293 = go(e);
                  break _t4294;
                }
                _match_fail("line 16933");
              }
              return _t4293;
            }
            _t4269 = List$iter(_t4291, arms);
            break _t4270;
          }
          if (_t4268._tag === 37) {
            const bindings = _t4268._val[0];
            const body = _t4268._val[1];
            function _t4295(__p85) {
              let _t4297;
              const _t4296 = __p85;
              _t4298: {
                if (true) {
                  const e = _t4296[1];
                  _t4297 = go(e);
                  break _t4298;
                }
                _match_fail("line 16933");
              }
              return _t4297;
            }
            List$iter(_t4295, bindings);
            const _t4299 = body;
            te = _t4299;
            continue;
            _t4269 = undefined;
            break _t4270;
          }
          _match_fail("line 16933");
        }
        _t4267 = _t4269;
      }
      return _t4267;
    }
  }
  go(te);
  const _t4300 = Ref$get(result_4265);
  const _t4266 = _t4300;
  return _t4266;
}
function Typechecker$infer_implicit_constraints(binding_name, type_env, vars, te, scheme) {
  let _t4301;
  if ((!_eq(scheme.constraints, null) || (scheme.quant === 0))) {
    _t4301 = scheme;
  } else {
    const id_map_4302 = Hashtbl$create(8);
    function build_map(s, a) {
      while (true) {
        const a_4304 = Types$repr(a);
        let _t4307;
        const _t4306 = s;
        _t4308: {
          if (_t4306._tag === 16) {
            const i = _t4306._val;
            let _t4310;
            const _t4309 = a_4304;
            _t4311: {
              if (_t4309._tag === 15 && _t4309._val.contents._tag === 0) {
                const id = _t4309._val.contents._val[0];
                _t4310 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, id_map_4302, id, ({_tag: 16, _name: "TGen", _val: i})]);
                break _t4311;
              }
              if (true) {
                _t4310 = undefined;
                break _t4311;
              }
              _match_fail("line 16933");
            }
            _t4307 = _t4310;
            break _t4308;
          }
          if (_t4306._tag === 7) {
            const s1 = _t4306._val[0];
            const s2 = _t4306._val[2];
            let _t4313;
            const _t4312 = a_4304;
            _t4314: {
              if (_t4312._tag === 7) {
                const a1 = _t4312._val[0];
                const a2 = _t4312._val[2];
                build_map(s1, a1);
                const _t4315 = s2;
                const _t4316 = a2;
                s = _t4315;
                a = _t4316;
                continue;
                _t4313 = undefined;
                break _t4314;
              }
              if (true) {
                _t4313 = undefined;
                break _t4314;
              }
              _match_fail("line 16933");
            }
            _t4307 = _t4313;
            break _t4308;
          }
          if (_t4306._tag === 8) {
            const s1 = _t4306._val[0];
            const s2 = _t4306._val[2];
            let _t4318;
            const _t4317 = a_4304;
            _t4319: {
              if (_t4317._tag === 8) {
                const a1 = _t4317._val[0];
                const a2 = _t4317._val[2];
                build_map(s1, a1);
                const _t4320 = s2;
                const _t4321 = a2;
                s = _t4320;
                a = _t4321;
                continue;
                _t4318 = undefined;
                break _t4319;
              }
              if (true) {
                _t4318 = undefined;
                break _t4319;
              }
              _match_fail("line 16933");
            }
            _t4307 = _t4318;
            break _t4308;
          }
          if (_t4306._tag === 9) {
            const ss = _t4306._val;
            let _t4323;
            const _t4322 = a_4304;
            _t4324: {
              if (_t4322._tag === 9) {
                const aa = _t4322._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t4323 = List$iter2(build_map, ss, aa);
                  break _t4324;
                }
              }
              if (true) {
                _t4323 = undefined;
                break _t4324;
              }
              _match_fail("line 16933");
            }
            _t4307 = _t4323;
            break _t4308;
          }
          if (_t4306._tag === 10) {
            const s1 = _t4306._val;
            let _t4326;
            const _t4325 = a_4304;
            _t4327: {
              if (_t4325._tag === 10) {
                const a1 = _t4325._val;
                const _t4328 = s1;
                const _t4329 = a1;
                s = _t4328;
                a = _t4329;
                continue;
                _t4326 = undefined;
                break _t4327;
              }
              if (true) {
                _t4326 = undefined;
                break _t4327;
              }
              _match_fail("line 16933");
            }
            _t4307 = _t4326;
            break _t4308;
          }
          if (_t4306._tag === 13) {
            const s1 = _t4306._val;
            let _t4331;
            const _t4330 = a_4304;
            _t4332: {
              if (_t4330._tag === 13) {
                const a1 = _t4330._val;
                const _t4333 = s1;
                const _t4334 = a1;
                s = _t4333;
                a = _t4334;
                continue;
                _t4331 = undefined;
                break _t4332;
              }
              if (true) {
                _t4331 = undefined;
                break _t4332;
              }
              _match_fail("line 16933");
            }
            _t4307 = _t4331;
            break _t4308;
          }
          if (_t4306._tag === 12) {
            const ss = _t4306._val[1];
            let _t4336;
            const _t4335 = a_4304;
            _t4337: {
              if (_t4335._tag === 12) {
                const aa = _t4335._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t4336 = List$iter2(build_map, ss, aa);
                  break _t4337;
                }
              }
              if (true) {
                _t4336 = undefined;
                break _t4337;
              }
              _match_fail("line 16933");
            }
            _t4307 = _t4336;
            break _t4308;
          }
          if (_t4306._tag === 14) {
            const srow = _t4306._val;
            let _t4339;
            const _t4338 = a_4304;
            _t4340: {
              if (_t4338._tag === 14) {
                const arow = _t4338._val;
                _t4339 = build_map_pvrows(srow, arow);
                break _t4340;
              }
              if (true) {
                _t4339 = undefined;
                break _t4340;
              }
              _match_fail("line 16933");
            }
            _t4307 = _t4339;
            break _t4308;
          }
          if (_t4306._tag === 11) {
            const srow = _t4306._val;
            let _t4342;
            const _t4341 = a_4304;
            _t4343: {
              if (_t4341._tag === 11) {
                const arow = _t4341._val;
                _t4342 = build_map_rrows(srow, arow);
                break _t4343;
              }
              if (true) {
                _t4342 = undefined;
                break _t4343;
              }
              _match_fail("line 16933");
            }
            _t4307 = _t4342;
            break _t4308;
          }
          if (true) {
            _t4307 = undefined;
            break _t4308;
          }
          _match_fail("line 16933");
        }
        const _t4305 = _t4307;
        return _t4305;
      }
    }
    function build_map_rrows(srow, arow) {
      const sf_4344 = Types$record_row_to_fields(srow);
      const af_4346 = Types$record_row_to_fields(arow);
      let _t4348;
      if ((List$length(sf_4344) === List$length(af_4346))) {
        function _t4349(__p86, __p87) {
          let _t4351;
          const _t4350 = __p86;
          _t4352: {
            if (true) {
              const st = _t4350[1];
              let _t4354;
              const _t4353 = __p87;
              _t4355: {
                if (true) {
                  const at_ = _t4353[1];
                  _t4354 = build_map(st, at_);
                  break _t4355;
                }
                _match_fail("line 16933");
              }
              _t4351 = _t4354;
              break _t4352;
            }
            _match_fail("line 16933");
          }
          return _t4351;
        }
        _t4348 = List$iter2(_t4349, sf_4344, af_4346);
      } else {
        _t4348 = undefined;
      }
      const _t4347 = _t4348;
      const _t4345 = _t4347;
      return _t4345;
    }
    function build_map_pvrows(srow, arow) {
      function collect_tags(row) {
        while (true) {
          let _t4357;
          const _t4356 = row;
          _t4358: {
            if (_t4356._tag === 0) {
              const tag = _t4356._val[0];
              const ty_opt = _t4356._val[1];
              const tail = _t4356._val[2];
              _t4357 = ({_hd: [tag, ty_opt], _tl: collect_tags(tail)});
              break _t4358;
            }
            if (_t4356._tag === 1 && _t4356._val.contents._tag === 1) {
              const r = _t4356._val.contents._val;
              const _t4359 = r;
              row = _t4359;
              continue;
              _t4357 = undefined;
              break _t4358;
            }
            if (true) {
              _t4357 = null;
              break _t4358;
            }
            _match_fail("line 16933");
          }
          return _t4357;
        }
      }
      const atags_4361 = collect_tags(arow);
      function go(row) {
        while (true) {
          let _t4364;
          const _t4363 = row;
          _t4365: {
            if (_t4363._tag === 0) {
              const stag = _t4363._val[0];
              const sty_opt = _t4363._val[1];
              const stail = _t4363._val[2];
              let _t4367;
              const _t4366 = List$assoc_opt(stag, atags_4361);
              _t4368: {
                if (_t4366._tag === 1) {
                  const aty_opt = _t4366._val;
                  let _t4370;
                  const _t4369 = [sty_opt, aty_opt];
                  _t4371: {
                    if (_t4369[0]._tag === 1 && _t4369[1]._tag === 1) {
                      const sty = _t4369[0]._val;
                      const aty = _t4369[1]._val;
                      _t4370 = build_map(sty, aty);
                      break _t4371;
                    }
                    if (true) {
                      _t4370 = undefined;
                      break _t4371;
                    }
                    _match_fail("line 16933");
                  }
                  _t4367 = _t4370;
                  break _t4368;
                }
                if (_t4366._tag === 0) {
                  _t4367 = undefined;
                  break _t4368;
                }
                _match_fail("line 16933");
              }
              _t4367;
              const _t4372 = stail;
              row = _t4372;
              continue;
              _t4364 = undefined;
              break _t4365;
            }
            if (_t4363._tag === 1 && _t4363._val.contents._tag === 1) {
              const r = _t4363._val.contents._val;
              const _t4373 = r;
              row = _t4373;
              continue;
              _t4364 = undefined;
              break _t4365;
            }
            if (true) {
              _t4364 = undefined;
              break _t4365;
            }
            _match_fail("line 16933");
          }
          return _t4364;
        }
      }
      const _t4374 = go(srow);
      const _t4362 = _t4374;
      const _t4360 = _t4362;
      return _t4360;
    }
    build_map(scheme.body, te.ty);
    const found_multi_4376 = Ref$create(null);
    const pending_caty_4378 = Ref$create(null);
    const phantom_counter_4380 = Ref$create(scheme.quant);
    const tvar_to_phantom_4382 = Hashtbl$create(4);
    function _t4384(tbl, key) {
      function _t4385(k) {
        return _eq(k, key);
      }
      let _t4386;
      if ((!List$exists(_t4385, Ref$get(tbl)))) {
        _t4386 = Ref$set(tbl, ({_hd: key, _tl: Ref$get(tbl)}));
      } else {
        _t4386 = undefined;
      }
      return _t4386;
    }
    const set_add_4387 = _t4384;
    function _t4389(local_sch, actual_ty) {
      const call_map_4390 = Hashtbl$create(4);
      const phantom_remap_4392 = Hashtbl$create(4);
      function map_tgens(s, a) {
        while (true) {
          const a_4394 = Types$repr(a);
          let _t4397;
          const _t4396 = s;
          _t4398: {
            if (_t4396._tag === 16) {
              const i = _t4396._val;
              let _t4399;
              if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, call_map_4390, i]))) {
                _t4399 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, call_map_4390, i, a_4394]);
              } else {
                _t4399 = undefined;
              }
              _t4397 = _t4399;
              break _t4398;
            }
            if (_t4396._tag === 7) {
              const s1 = _t4396._val[0];
              const s2 = _t4396._val[2];
              let _t4401;
              const _t4400 = a_4394;
              _t4402: {
                if (_t4400._tag === 7) {
                  const a1 = _t4400._val[0];
                  const a2 = _t4400._val[2];
                  map_tgens(s1, a1);
                  const _t4403 = s2;
                  const _t4404 = a2;
                  s = _t4403;
                  a = _t4404;
                  continue;
                  _t4401 = undefined;
                  break _t4402;
                }
                if (true) {
                  _t4401 = undefined;
                  break _t4402;
                }
                _match_fail("line 16933");
              }
              _t4397 = _t4401;
              break _t4398;
            }
            if (_t4396._tag === 8) {
              const s1 = _t4396._val[0];
              const s2 = _t4396._val[2];
              let _t4406;
              const _t4405 = a_4394;
              _t4407: {
                if (_t4405._tag === 8) {
                  const a1 = _t4405._val[0];
                  const a2 = _t4405._val[2];
                  map_tgens(s1, a1);
                  const _t4408 = s2;
                  const _t4409 = a2;
                  s = _t4408;
                  a = _t4409;
                  continue;
                  _t4406 = undefined;
                  break _t4407;
                }
                if (true) {
                  _t4406 = undefined;
                  break _t4407;
                }
                _match_fail("line 16933");
              }
              _t4397 = _t4406;
              break _t4398;
            }
            if (_t4396._tag === 9) {
              const ss = _t4396._val;
              let _t4411;
              const _t4410 = a_4394;
              _t4412: {
                if (_t4410._tag === 9) {
                  const aa = _t4410._val;
                  if ((List$length(ss) === List$length(aa))) {
                    _t4411 = List$iter2(map_tgens, ss, aa);
                    break _t4412;
                  }
                }
                if (true) {
                  _t4411 = undefined;
                  break _t4412;
                }
                _match_fail("line 16933");
              }
              _t4397 = _t4411;
              break _t4398;
            }
            if (_t4396._tag === 10) {
              const s1 = _t4396._val;
              let _t4414;
              const _t4413 = a_4394;
              _t4415: {
                if (_t4413._tag === 10) {
                  const a1 = _t4413._val;
                  const _t4416 = s1;
                  const _t4417 = a1;
                  s = _t4416;
                  a = _t4417;
                  continue;
                  _t4414 = undefined;
                  break _t4415;
                }
                if (true) {
                  _t4414 = undefined;
                  break _t4415;
                }
                _match_fail("line 16933");
              }
              _t4397 = _t4414;
              break _t4398;
            }
            if (_t4396._tag === 13) {
              const s1 = _t4396._val;
              let _t4419;
              const _t4418 = a_4394;
              _t4420: {
                if (_t4418._tag === 13) {
                  const a1 = _t4418._val;
                  const _t4421 = s1;
                  const _t4422 = a1;
                  s = _t4421;
                  a = _t4422;
                  continue;
                  _t4419 = undefined;
                  break _t4420;
                }
                if (true) {
                  _t4419 = undefined;
                  break _t4420;
                }
                _match_fail("line 16933");
              }
              _t4397 = _t4419;
              break _t4398;
            }
            if (_t4396._tag === 12) {
              const ss = _t4396._val[1];
              let _t4424;
              const _t4423 = a_4394;
              _t4425: {
                if (_t4423._tag === 12) {
                  const aa = _t4423._val[1];
                  if ((List$length(ss) === List$length(aa))) {
                    _t4424 = List$iter2(map_tgens, ss, aa);
                    break _t4425;
                  }
                }
                if (true) {
                  _t4424 = undefined;
                  break _t4425;
                }
                _match_fail("line 16933");
              }
              _t4397 = _t4424;
              break _t4398;
            }
            if (true) {
              _t4397 = undefined;
              break _t4398;
            }
            _match_fail("line 16933");
          }
          const _t4395 = _t4397;
          return _t4395;
        }
      }
      map_tgens(local_sch.body, actual_ty);
      function _t4427(cc) {
        function _t4428(ca) {
          let _t4430;
          const _t4429 = ca;
          _t4431: {
            if (_t4429._tag === 0) {
              const tgen_idx = _t4429._val;
              let _t4433;
              const _t4432 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, call_map_4390, tgen_idx]);
              _t4434: {
                if (_t4432._tag === 1 && _t4432._val._tag === 15 && _t4432._val._val.contents._tag === 0) {
                  const id = _t4432._val._val.contents._val[0];
                  const tv = _t4432._val;
                  let _t4436;
                  const _t4435 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map_4302, id]);
                  _t4437: {
                    if (_t4435._tag === 1 && _t4435._val._tag === 16) {
                      const outer_tgen = _t4435._val._val;
                      _t4436 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "CATGen", _val: outer_tgen})});
                      break _t4437;
                    }
                    if (true) {
                      _t4436 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "CATy", _val: tv})});
                      break _t4437;
                    }
                    _match_fail("line 16933");
                  }
                  _t4433 = _t4436;
                  break _t4434;
                }
                if (_t4432._tag === 1) {
                  _t4433 = ({_tag: 0, _name: "None"});
                  break _t4434;
                }
                if (_t4432._tag === 0) {
                  _t4433 = ({_tag: 0, _name: "None"});
                  break _t4434;
                }
                _match_fail("line 16933");
              }
              _t4430 = _t4433;
              break _t4431;
            }
            if (_t4429._tag === 1) {
              const ty = _t4429._val;
              let _t4439;
              const _t4438 = Types$repr(ty);
              _t4440: {
                if (_t4438._tag === 15 && _t4438._val.contents._tag === 0) {
                  const id = _t4438._val.contents._val[0];
                  let _t4442;
                  const _t4441 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map_4302, id]);
                  _t4443: {
                    if (_t4441._tag === 1 && _t4441._val._tag === 16) {
                      const outer_tgen = _t4441._val._val;
                      _t4442 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "CATGen", _val: outer_tgen})});
                      break _t4443;
                    }
                    if (true) {
                      _t4442 = ({_tag: 1, _name: "Some", _val: ca});
                      break _t4443;
                    }
                    _match_fail("line 16933");
                  }
                  _t4439 = _t4442;
                  break _t4440;
                }
                if (true) {
                  _t4439 = ({_tag: 1, _name: "Some", _val: ca});
                  break _t4440;
                }
                _match_fail("line 16933");
              }
              _t4430 = _t4439;
              break _t4431;
            }
            if (_t4429._tag === 2) {
              _t4430 = ({_tag: 1, _name: "Some", _val: ({_tag: 2, _name: "CAWild"})});
              break _t4431;
            }
            if (_t4429._tag === 3) {
              const inner_idx = _t4429._val[0];
              let _t4445;
              const _t4444 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, phantom_remap_4392, inner_idx]);
              _t4446: {
                if (_t4444._tag === 1) {
                  const pair = _t4444._val;
                  _t4445 = pair;
                  break _t4446;
                }
                if (_t4444._tag === 0) {
                  const idx_4447 = Ref$get(phantom_counter_4380);
                  Ref$set(phantom_counter_4380, (Ref$get(phantom_counter_4380) + 1));
                  const tv_4449 = Types$new_tvar(1);
                  _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, phantom_remap_4392, inner_idx, [idx_4447, tv_4449]]);
                  const _t4450 = [idx_4447, tv_4449];
                  const _t4448 = _t4450;
                  _t4445 = _t4448;
                  break _t4446;
                }
                _match_fail("line 16933");
              }
              let _t4452;
              const _t4451 = _t4445;
              _t4453: {
                if (true) {
                  const outer_idx = _t4451[0];
                  const outer_tv = _t4451[1];
                  _t4452 = ({_tag: 1, _name: "Some", _val: ({_tag: 3, _name: "CAPhantom", _val: [outer_idx, outer_tv]})});
                  break _t4453;
                }
                _match_fail("line 16933");
              }
              _t4430 = _t4452;
              break _t4431;
            }
            _match_fail("line 16933");
          }
          return _t4430;
        }
        const outer_tgens_4454 = List$filter_map(_t4428, cc.cc_args);
        let _t4456;
        if ((List$length(outer_tgens_4454) === List$length(cc.cc_args))) {
          _t4456 = set_add_4387(found_multi_4376, [cc.cc_class, outer_tgens_4454]);
        } else {
          _t4456 = undefined;
        }
        const _t4455 = _t4456;
        return _t4455;
      }
      const _t4426 = List$iter(_t4427, local_sch.constraints);
      const _t4393 = _t4426;
      const _t4391 = _t4393;
      return _t4391;
    }
    const propagate_constrained_ref_4457 = _t4389;
    function walk(locals, te) {
      let _t4460;
      const _t4459 = te.expr;
      _t4461: {
        if (_t4459._tag === 7) {
          const name = _t4459._val;
          let _t4463;
          const _t4462 = List$assoc_opt(name, locals);
          _t4464: {
            if (_t4462._tag === 1) {
              const local_sch = _t4462._val;
              if (!_eq(local_sch.constraints, null)) {
                _t4463 = propagate_constrained_ref_4457(local_sch, te.ty);
                break _t4464;
              }
            }
            if (true) {
              _t4463 = undefined;
              break _t4464;
            }
            _match_fail("line 16933");
          }
          _t4463;
          let _t4466;
          const _t4465 = List$assoc_opt(name, vars);
          _t4467: {
            if (_t4465._tag === 1) {
              const var_sch = _t4465._val;
              if (!_eq(var_sch.constraints, null)) {
                _t4466 = propagate_constrained_ref_4457(var_sch, te.ty);
                break _t4467;
              }
            }
            if (true) {
              _t4466 = undefined;
              break _t4467;
            }
            _match_fail("line 16933");
          }
          _t4466;
          let _t4469;
          const _t4468 = Types$find_method_class(type_env.classes, name);
          _t4470: {
            if (_t4468._tag === 1) {
              const class_def = _t4468._val;
              if ((!(name === binding_name))) {
                const method_ty_4471 = List$assoc(name, class_def.class_methods);
                let _t4474;
                const _t4473 = List$assoc_opt(name, vars);
                _t4475: {
                  if (_t4473._tag === 1) {
                    const s = _t4473._val;
                    let _t4476;
                    if (_eq(s.body, method_ty_4471)) {
                      _t4476 = [({_tag: 1, _name: "Some", _val: class_def}), name];
                    } else {
                      _t4476 = [({_tag: 0, _name: "None"}), name];
                    }
                    _t4474 = _t4476;
                    break _t4475;
                  }
                  if (_t4473._tag === 0) {
                    _t4474 = [({_tag: 0, _name: "None"}), name];
                    break _t4475;
                  }
                  _match_fail("line 16933");
                }
                const _t4472 = _t4474;
                _t4469 = _t4472;
                break _t4470;
              }
            }
            if (true) {
              let _t4478;
              const _t4477 = String$rindex_opt(name, 46);
              _t4479: {
                if (_t4477._tag === 0) {
                  _t4478 = [({_tag: 0, _name: "None"}), name];
                  break _t4479;
                }
                if (_t4477._tag === 1) {
                  const i = _t4477._val;
                  const _mml$short_4480 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                  const class_prefix_4482 = String$sub(name, 0, i);
                  const mod_prefix_4484 = String$sub(name, 0, (i + 1));
                  let _t4487;
                  const _t4486 = Types$find_method_class(type_env.classes, _mml$short_4480);
                  _t4488: {
                    if (_t4486._tag === 1) {
                      const class_def = _t4486._val;
                      if (((!(_mml$short_4480 === binding_name)) && ((class_def.class_name === class_prefix_4482) || ((String$length(class_def.class_name) > String$length(mod_prefix_4484)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_4484)) === mod_prefix_4484))))) {
                        const method_ty_4489 = List$assoc(_mml$short_4480, class_def.class_methods);
                        let _t4492;
                        const _t4491 = List$assoc_opt(name, vars);
                        _t4493: {
                          if (_t4491._tag === 1) {
                            const r = _t4491;
                            _t4492 = r;
                            break _t4493;
                          }
                          if (_t4491._tag === 0) {
                            _t4492 = List$assoc_opt(_mml$short_4480, vars);
                            break _t4493;
                          }
                          _match_fail("line 16933");
                        }
                        const var_sch_4494 = _t4492;
                        let _t4497;
                        const _t4496 = var_sch_4494;
                        _t4498: {
                          if (_t4496._tag === 1) {
                            const s = _t4496._val;
                            let _t4499;
                            if (_eq(s.body, method_ty_4489)) {
                              _t4499 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_4480];
                            } else {
                              _t4499 = [({_tag: 0, _name: "None"}), name];
                            }
                            _t4497 = _t4499;
                            break _t4498;
                          }
                          if (_t4496._tag === 0) {
                            _t4497 = [({_tag: 0, _name: "None"}), name];
                            break _t4498;
                          }
                          _match_fail("line 16933");
                        }
                        const _t4495 = _t4497;
                        const _t4490 = _t4495;
                        _t4487 = _t4490;
                        break _t4488;
                      }
                    }
                    if (true) {
                      _t4487 = [({_tag: 0, _name: "None"}), name];
                      break _t4488;
                    }
                    _match_fail("line 16933");
                  }
                  const _t4485 = _t4487;
                  const _t4483 = _t4485;
                  const _t4481 = _t4483;
                  _t4478 = _t4481;
                  break _t4479;
                }
                _match_fail("line 16933");
              }
              _t4469 = _t4478;
              break _t4470;
            }
            _match_fail("line 16933");
          }
          let _t4501;
          const _t4500 = _t4469;
          _t4502: {
            if (true) {
              const class_match = _t4500[0];
              const method_name = _t4500[1];
              let _t4504;
              const _t4503 = class_match;
              _t4505: {
                if (_t4503._tag === 1) {
                  const class_def = _t4503._val;
                  const method_schema_ty_4506 = List$assoc(method_name, class_def.class_methods);
                  const num_params_4508 = List$length(class_def.class_params);
                  const param_map_4510 = Hashtbl$create(num_params_4508);
                  function go(s, r) {
                    while (true) {
                      const r_4512 = Types$repr(r);
                      let _t4515;
                      const _t4514 = [s, r_4512];
                      _t4516: {
                        if (_t4514[0]._tag === 16) {
                          const i = _t4514[0]._val;
                          if ((i < num_params_4508)) {
                            let _t4517;
                            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, param_map_4510, i]))) {
                              _t4517 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, param_map_4510, i, r_4512]);
                            } else {
                              _t4517 = undefined;
                            }
                            _t4515 = _t4517;
                            break _t4516;
                          }
                        }
                        if ((_t4514[0]._tag === 7 && _t4514[1]._tag === 7 || _t4514[0]._tag === 8 && _t4514[1]._tag === 8)) {
                          const s1 = _t4514[0]._val[0];
                          const s2 = _t4514[0]._val[2];
                          const r1 = _t4514[1]._val[0];
                          const r2 = _t4514[1]._val[2];
                          go(s1, r1);
                          const _t4518 = s2;
                          const _t4519 = r2;
                          s = _t4518;
                          r = _t4519;
                          continue;
                          _t4515 = undefined;
                          break _t4516;
                        }
                        if (_t4514[0]._tag === 9 && _t4514[1]._tag === 9) {
                          const ss = _t4514[0]._val;
                          const rs = _t4514[1]._val;
                          if ((List$length(ss) === List$length(rs))) {
                            _t4515 = List$iter2(go, ss, rs);
                            break _t4516;
                          }
                        }
                        if (_t4514[0]._tag === 10 && _t4514[1]._tag === 10) {
                          const s1 = _t4514[0]._val;
                          const r1 = _t4514[1]._val;
                          const _t4520 = s1;
                          const _t4521 = r1;
                          s = _t4520;
                          r = _t4521;
                          continue;
                          _t4515 = undefined;
                          break _t4516;
                        }
                        if (_t4514[0]._tag === 13 && _t4514[1]._tag === 13) {
                          const s1 = _t4514[0]._val;
                          const r1 = _t4514[1]._val;
                          const _t4522 = s1;
                          const _t4523 = r1;
                          s = _t4522;
                          r = _t4523;
                          continue;
                          _t4515 = undefined;
                          break _t4516;
                        }
                        if (_t4514[0]._tag === 12 && _t4514[1]._tag === 12) {
                          const ss = _t4514[0]._val[1];
                          const rs = _t4514[1]._val[1];
                          if ((List$length(ss) === List$length(rs))) {
                            _t4515 = List$iter2(go, ss, rs);
                            break _t4516;
                          }
                        }
                        if (true) {
                          _t4515 = undefined;
                          break _t4516;
                        }
                        _match_fail("line 16933");
                      }
                      const _t4513 = _t4515;
                      return _t4513;
                    }
                  }
                  go(method_schema_ty_4506, te.ty);
                  function _t4525(i) {
                    let _t4527;
                    const _t4526 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, param_map_4510, i]);
                    _t4528: {
                      if (_t4526._tag === 1 && _t4526._val._tag === 15 && _t4526._val._val.contents._tag === 0) {
                        const id = _t4526._val._val.contents._val[0];
                        const tv = _t4526._val;
                        let _t4530;
                        const _t4529 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map_4302, id]);
                        _t4531: {
                          if (_t4529._tag === 1 && _t4529._val._tag === 16) {
                            const tgen_idx = _t4529._val._val;
                            _t4530 = ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "CATGen", _val: tgen_idx})});
                            break _t4531;
                          }
                          if (true) {
                            function _t4532(fd) {
                              return List$mem(i, fd.fd_to);
                            }
                            const is_fundep_target_4533 = List$exists(_t4532, class_def.class_fundeps);
                            let _t4535;
                            if (is_fundep_target_4533) {
                              let _t4537;
                              const _t4536 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tvar_to_phantom_4382, id]);
                              _t4538: {
                                if (_t4536._tag === 1) {
                                  const idx = _t4536._val;
                                  _t4537 = idx;
                                  break _t4538;
                                }
                                if (_t4536._tag === 0) {
                                  const idx_4539 = Ref$get(phantom_counter_4380);
                                  Ref$set(phantom_counter_4380, (Ref$get(phantom_counter_4380) + 1));
                                  _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tvar_to_phantom_4382, id, idx_4539]);
                                  const _t4540 = idx_4539;
                                  _t4537 = _t4540;
                                  break _t4538;
                                }
                                _match_fail("line 16933");
                              }
                              const phantom_idx_4541 = _t4537;
                              const _t4542 = ({_tag: 1, _name: "Some", _val: ({_tag: 3, _name: "CAPhantom", _val: [phantom_idx_4541, tv]})});
                              _t4535 = _t4542;
                            } else {
                              _t4535 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "CATy", _val: tv})});
                            }
                            const _t4534 = _t4535;
                            _t4530 = _t4534;
                            break _t4531;
                          }
                          _match_fail("line 16933");
                        }
                        _t4527 = _t4530;
                        break _t4528;
                      }
                      if (_t4526._tag === 1) {
                        const ty = _t4526._val;
                        _t4527 = ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "CATy", _val: ty})});
                        break _t4528;
                      }
                      if (_t4526._tag === 0) {
                        function _t4543(fd) {
                          return List$mem(i, fd.fd_to);
                        }
                        const is_fundep_target_4544 = List$exists(_t4543, class_def.class_fundeps);
                        let _t4546;
                        if (is_fundep_target_4544) {
                          _t4546 = ({_tag: 1, _name: "Some", _val: ({_tag: 2, _name: "CAWild"})});
                        } else {
                          _t4546 = ({_tag: 0, _name: "None"});
                        }
                        const _t4545 = _t4546;
                        _t4527 = _t4545;
                        break _t4528;
                      }
                      _match_fail("line 16933");
                    }
                    return _t4527;
                  }
                  const cc_args_4547 = List$init(num_params_4508, _t4525);
                  function _t4549(opt) {
                    let _t4551;
                    const _t4550 = opt;
                    _t4552: {
                      if (_t4550._tag === 1 && _t4550._val._tag === 1) {
                        const ty = _t4550._val._val;
                        _t4551 = (!Types$is_concrete(ty));
                        break _t4552;
                      }
                      if (true) {
                        _t4551 = false;
                        break _t4552;
                      }
                      _match_fail("line 16933");
                    }
                    return _t4551;
                  }
                  const has_nonconc_caty_4553 = List$exists(_t4549, cc_args_4547);
                  function _t4555(opt) {
                    let _t4557;
                    const _t4556 = opt;
                    _t4558: {
                      if (_t4556._tag === 1 && _t4556._val._tag === 1) {
                        _t4557 = true;
                        break _t4558;
                      }
                      if (true) {
                        _t4557 = false;
                        break _t4558;
                      }
                      _match_fail("line 16933");
                    }
                    return _t4557;
                  }
                  const has_any_caty_4559 = List$exists(_t4555, cc_args_4547);
                  let _t4561;
                  if (has_nonconc_caty_4553) {
                    function _t4562(opt) {
                      let _t4564;
                      const _t4563 = opt;
                      _t4565: {
                        if (_t4563._tag === 1 && _t4563._val._tag === 2) {
                          _t4564 = ({_tag: 0, _name: "None"});
                          break _t4565;
                        }
                        if (_t4563._tag === 1 && _t4563._val._tag === 3) {
                          _t4564 = ({_tag: 0, _name: "None"});
                          break _t4565;
                        }
                        if (true) {
                          _t4564 = opt;
                          break _t4565;
                        }
                        _match_fail("line 16933");
                      }
                      return _t4564;
                    }
                    _t4561 = List$map(_t4562, cc_args_4547);
                  } else {
                    _t4561 = cc_args_4547;
                  }
                  const cc_args_4566 = _t4561;
                  function _t4568(opt) {
                    let _t4570;
                    const _t4569 = opt;
                    _t4571: {
                      if (_t4569._tag === 1 && _t4569._val._tag === 0) {
                        _t4570 = true;
                        break _t4571;
                      }
                      if (true) {
                        _t4570 = false;
                        break _t4571;
                      }
                      _match_fail("line 16933");
                    }
                    return _t4570;
                  }
                  const has_tgen_4572 = List$exists(_t4568, cc_args_4566);
                  const has_caty_4574 = has_any_caty_4559;
                  function _t4576(opt) {
                    return !_eq(opt, ({_tag: 0, _name: "None"}));
                  }
                  const all_resolved_4577 = List$forall(_t4576, cc_args_4566);
                  let _t4584;
                  if (has_tgen_4572) {
                  let _t4583;
                  if (all_resolved_4577) {
                  let _t4582;
                  if ((!has_caty_4574)) {
                    _t4582 = true;
                  } else {
                  let _t4580;
                  const _t4579 = scheme.body;
                  _t4581: {
                    if ((_t4579._tag === 7 || _t4579._tag === 8)) {
                      _t4580 = true;
                      break _t4581;
                    }
                    if (true) {
                      _t4580 = false;
                      break _t4581;
                    }
                    _match_fail("line 16933");
                  }
                    _t4582 = _t4580;
                  }
                    _t4583 = _t4582;
                  } else {
                    _t4583 = false;
                  }
                    _t4584 = _t4583;
                  } else {
                    _t4584 = false;
                  }
                  const allow_4585 = _t4584;
                  let _t4587;
                  if (allow_4585) {
                    function _t4588(x) {
                      return x;
                    }
                    const cc_args_4589 = List$filter_map(_t4588, cc_args_4566);
                    const _t4590 = set_add_4387(found_multi_4376, [class_def.class_name, cc_args_4589]);
                    _t4587 = _t4590;
                  } else {
                    let _t4591;
                    if (((!has_tgen_4572) && all_resolved_4577)) {
                      function _t4592(opt) {
                        let _t4594;
                        const _t4593 = opt;
                        _t4595: {
                          if (_t4593._tag === 1 && _t4593._val._tag === 1 && _t4593._val._val._tag === 15 && _t4593._val._val._val.contents._tag === 0) {
                            _t4594 = true;
                            break _t4595;
                          }
                          if (true) {
                            _t4594 = false;
                            break _t4595;
                          }
                          _match_fail("line 16933");
                        }
                        return _t4594;
                      }
                      const has_unbound_caty_4596 = List$exists(_t4592, cc_args_4566);
                      let _t4599;
                      const _t4598 = scheme.body;
                      _t4600: {
                        if ((_t4598._tag === 7 || _t4598._tag === 8)) {
                          _t4599 = true;
                          break _t4600;
                        }
                        if (true) {
                          _t4599 = false;
                          break _t4600;
                        }
                        _match_fail("line 16933");
                      }
                      const is_arrow_4601 = _t4599;
                      let _t4603;
                      if ((has_unbound_caty_4596 && is_arrow_4601)) {
                        function _t4604(x) {
                          return x;
                        }
                        const cc_args_4605 = List$filter_map(_t4604, cc_args_4566);
                        const _t4606 = set_add_4387(pending_caty_4378, [class_def.class_name, cc_args_4605]);
                        _t4603 = _t4606;
                      } else {
                        _t4603 = undefined;
                      }
                      const _t4602 = _t4603;
                      const _t4597 = _t4602;
                      _t4591 = _t4597;
                    } else {
                      _t4591 = undefined;
                    }
                    _t4587 = _t4591;
                  }
                  const _t4586 = _t4587;
                  const _t4578 = _t4586;
                  const _t4575 = _t4578;
                  const _t4573 = _t4575;
                  const _t4567 = _t4573;
                  const _t4560 = _t4567;
                  const _t4554 = _t4560;
                  const _t4548 = _t4554;
                  const _t4524 = _t4548;
                  const _t4511 = _t4524;
                  const _t4509 = _t4511;
                  const _t4507 = _t4509;
                  _t4504 = _t4507;
                  break _t4505;
                }
                if (_t4503._tag === 0) {
                  _t4504 = undefined;
                  break _t4505;
                }
                _match_fail("line 16933");
              }
              _t4501 = _t4504;
              break _t4502;
            }
            _match_fail("line 16933");
          }
          _t4460 = _t4501;
          break _t4461;
        }
        if (true) {
          _t4460 = undefined;
          break _t4461;
        }
        _match_fail("line 16933");
      }
      _t4460;
      return walk_children(locals, te);
    }
    function walk_children(locals, te) {
      let _t4608;
      const _t4607 = te.expr;
      _t4609: {
        if ((((((((((_t4607._tag === 0 || _t4607._tag === 1) || _t4607._tag === 2) || _t4607._tag === 3) || _t4607._tag === 4) || _t4607._tag === 5) || _t4607._tag === 6) || _t4607._tag === 7) || _t4607._tag === 22) || _t4607._tag === 34)) {
          _t4608 = undefined;
          break _t4609;
        }
        if ((_t4607._tag === 8 && _t4607._val[1]._tag === 1 || _t4607._tag === 9 && _t4607._val[1]._tag === 1)) {
          const name = _t4607._val[0];
          const sch = _t4607._val[1]._val;
          const _e1 = _t4607._val[2];
          const e2 = _t4607._val[3];
          _t4608 = walk(({_hd: [name, sch], _tl: locals}), e2);
          break _t4609;
        }
        if ((_t4607._tag === 8 && _t4607._val[1]._tag === 0 || _t4607._tag === 9 && _t4607._val[1]._tag === 0)) {
          const name = _t4607._val[0];
          const e1 = _t4607._val[2];
          const e2 = _t4607._val[3];
          let _t4611;
          const _t4610 = Types$repr(e1.ty);
          _t4612: {
            if (_t4610._tag === 15 && _t4610._val.contents._tag === 0) {
              let _t4614;
              const _t4613 = Typechecker$find_var_type_in(name, e2);
              _t4615: {
                if (_t4613._tag === 1) {
                  const inst_ty = _t4613._val;
                  let _t4617;
                  const _t4616 = Types$repr(inst_ty);
                  _t4618: {
                    if (_t4616._tag === 15 && _t4616._val.contents._tag === 0) {
                      _t4617 = Types$unify(e1.ty, inst_ty);
                      break _t4618;
                    }
                    if (true) {
                      _t4617 = undefined;
                      break _t4618;
                    }
                    _match_fail("line 16933");
                  }
                  _t4614 = _t4617;
                  break _t4615;
                }
                if (_t4613._tag === 0) {
                  _t4614 = undefined;
                  break _t4615;
                }
                _match_fail("line 16933");
              }
              _t4611 = _t4614;
              break _t4612;
            }
            if (true) {
              _t4611 = undefined;
              break _t4612;
            }
            _match_fail("line 16933");
          }
          _t4611;
          walk(locals, e1);
          _t4608 = walk(locals, e2);
          break _t4609;
        }
        if ((((((((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) || _t4607._tag === 28) || _t4607._tag === 32) || _t4607._tag === 31) || _t4607._tag === 27) || _t4607._tag === 20)) {
          const e1 = (((((((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) || _t4607._tag === 28) || _t4607._tag === 32) || _t4607._tag === 31) || _t4607._tag === 27) ? ((((((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) || _t4607._tag === 28) || _t4607._tag === 32) || _t4607._tag === 31) ? (((((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) || _t4607._tag === 28) || _t4607._tag === 32) ? ((((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) || _t4607._tag === 28) ? (((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) ? ((_t4607._tag === 25 || _t4607._tag === 13) ? _t4607._val[1] : _t4607._val[0]) : _t4607._val[0]) : _t4607._val[0]) : _t4607._val[0]) : _t4607._val[0]) : _t4607._val[0]);
          const e2 = (((((((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) || _t4607._tag === 28) || _t4607._tag === 32) || _t4607._tag === 31) || _t4607._tag === 27) ? ((((((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) || _t4607._tag === 28) || _t4607._tag === 32) || _t4607._tag === 31) ? (((((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) || _t4607._tag === 28) || _t4607._tag === 32) ? ((((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) || _t4607._tag === 28) ? (((_t4607._tag === 25 || _t4607._tag === 13) || _t4607._tag === 21) ? ((_t4607._tag === 25 || _t4607._tag === 13) ? _t4607._val[2] : _t4607._val[1]) : _t4607._val[1]) : _t4607._val[1]) : _t4607._val[1]) : _t4607._val[2]) : _t4607._val[1]);
          walk(locals, e1);
          _t4608 = walk(locals, e2);
          break _t4609;
        }
        if (_t4607._tag === 11) {
          const fn_ = _t4607._val[0];
          const arg = _t4607._val[1];
          walk(locals, fn_);
          _t4608 = walk(locals, arg);
          break _t4609;
        }
        if (((((((((_t4607._tag === 29 || _t4607._tag === 14) || _t4607._tag === 10) || _t4607._tag === 19) || _t4607._tag === 33) || _t4607._tag === 35) || _t4607._tag === 36) || _t4607._tag === 39) || _t4607._tag === 26)) {
          const e = ((((((((_t4607._tag === 29 || _t4607._tag === 14) || _t4607._tag === 10) || _t4607._tag === 19) || _t4607._tag === 33) || _t4607._tag === 35) || _t4607._tag === 36) || _t4607._tag === 39) ? (((((((_t4607._tag === 29 || _t4607._tag === 14) || _t4607._tag === 10) || _t4607._tag === 19) || _t4607._tag === 33) || _t4607._tag === 35) || _t4607._tag === 36) ? ((((((_t4607._tag === 29 || _t4607._tag === 14) || _t4607._tag === 10) || _t4607._tag === 19) || _t4607._tag === 33) || _t4607._tag === 35) ? (((((_t4607._tag === 29 || _t4607._tag === 14) || _t4607._tag === 10) || _t4607._tag === 19) || _t4607._tag === 33) ? ((((_t4607._tag === 29 || _t4607._tag === 14) || _t4607._tag === 10) || _t4607._tag === 19) ? (((_t4607._tag === 29 || _t4607._tag === 14) || _t4607._tag === 10) ? _t4607._val[1] : _t4607._val[0]) : _t4607._val) : _t4607._val) : _t4607._val) : _t4607._val) : _t4607._val[1]);
          _t4608 = walk(locals, e);
          break _t4609;
        }
        if (_t4607._tag === 12) {
          const c = _t4607._val[0];
          const t = _t4607._val[1];
          const e = _t4607._val[2];
          walk(locals, c);
          walk(locals, t);
          _t4608 = walk(locals, e);
          break _t4609;
        }
        if ((_t4607._tag === 15 || _t4607._tag === 38)) {
          const es = _t4607._val;
          _t4608 = List$iter(_call(walk, [locals]), es);
          break _t4609;
        }
        if (_t4607._tag === 16) {
          const fields = _t4607._val;
          function _t4619(__p88) {
            let _t4621;
            const _t4620 = __p88;
            _t4622: {
              if (true) {
                const e = _t4620[1];
                _t4621 = walk(locals, e);
                break _t4622;
              }
              _match_fail("line 16933");
            }
            return _t4621;
          }
          _t4608 = List$iter(_t4619, fields);
          break _t4609;
        }
        if (_t4607._tag === 17) {
          const base = _t4607._val[0];
          const overrides = _t4607._val[1];
          walk(locals, base);
          function _t4623(__p89) {
            let _t4625;
            const _t4624 = __p89;
            _t4626: {
              if (true) {
                const e = _t4624[1];
                _t4625 = walk(locals, e);
                break _t4626;
              }
              _match_fail("line 16933");
            }
            return _t4625;
          }
          _t4608 = List$iter(_t4623, overrides);
          break _t4609;
        }
        if (_t4607._tag === 18) {
          const base = _t4607._val[0];
          const pairs = _t4607._val[1];
          walk(locals, base);
          function _t4627(__p90) {
            let _t4629;
            const _t4628 = __p90;
            _t4630: {
              if (true) {
                const i = _t4628[0];
                const v = _t4628[1];
                walk(locals, i);
                _t4629 = walk(locals, v);
                break _t4630;
              }
              _match_fail("line 16933");
            }
            return _t4629;
          }
          _t4608 = List$iter(_t4627, pairs);
          break _t4609;
        }
        if (_t4607._tag === 23) {
          const arg = _t4607._val[1];
          _t4608 = Option$iter(_call(walk, [locals]), arg);
          break _t4609;
        }
        if (_t4607._tag === 24) {
          const scrutinee = _t4607._val[0];
          const arms = _t4607._val[1];
          walk(locals, scrutinee);
          function _t4631(__p91) {
            let _t4633;
            const _t4632 = __p91;
            _t4634: {
              if (true) {
                const guard = _t4632[1];
                const body = _t4632[2];
                Option$iter(_call(walk, [locals]), guard);
                _t4633 = walk(locals, body);
                break _t4634;
              }
              _match_fail("line 16933");
            }
            return _t4633;
          }
          _t4608 = List$iter(_t4631, arms);
          break _t4609;
        }
        if (_t4607._tag === 30) {
          const body = _t4607._val[0];
          const arms = _t4607._val[1];
          walk(locals, body);
          function _t4635(arm) {
            let _t4637;
            const _t4636 = arm;
            _t4638: {
              if ((((_t4636._tag === 0 || _t4636._tag === 1) || _t4636._tag === 2) || _t4636._tag === 3)) {
                const e = (((_t4636._tag === 0 || _t4636._tag === 1) || _t4636._tag === 2) ? ((_t4636._tag === 0 || _t4636._tag === 1) ? (_t4636._tag === 0 ? _t4636._val[1] : _t4636._val[3]) : _t4636._val[2]) : _t4636._val[2]);
                _t4637 = walk(locals, e);
                break _t4638;
              }
              _match_fail("line 16933");
            }
            return _t4637;
          }
          _t4608 = List$iter(_t4635, arms);
          break _t4609;
        }
        if (_t4607._tag === 37) {
          const bindings = _t4607._val[0];
          const body = _t4607._val[1];
          function _t4639(__p92) {
            let _t4641;
            const _t4640 = __p92;
            _t4642: {
              if (true) {
                const e = _t4640[1];
                _t4641 = walk(locals, e);
                break _t4642;
              }
              _match_fail("line 16933");
            }
            return _t4641;
          }
          List$iter(_t4639, bindings);
          _t4608 = walk(locals, body);
          break _t4609;
        }
        _match_fail("line 16933");
      }
      return _t4608;
    }
    walk(null, te);
    const changed_4644 = Ref$create(true);
    let _t4646 = undefined;
    let _t4647 = false, _t4648;
    while (true) {
      if (!(Ref$get(changed_4644))) break;
      Ref$set(changed_4644, false);
      function _t4649(acc, __p93) {
        let _t4651;
        const _t4650 = __p93;
        _t4652: {
          if (true) {
            const cls = _t4650[0];
            const args = _t4650[1];
            function _t4653(ca) {
              let _t4655;
              const _t4654 = ca;
              _t4656: {
                if (_t4654._tag === 1 && _t4654._val._tag === 15 && _t4654._val._val.contents._tag === 0) {
                  const id = _t4654._val._val.contents._val[0];
                  function _t4657(__p94) {
                    let _t4659;
                    const _t4658 = __p94;
                    _t4660: {
                      if (true) {
                        const _c = _t4658[0];
                        const fargs = _t4658[1];
                        function _t4661(fa) {
                          let _t4663;
                          const _t4662 = fa;
                          _t4664: {
                            if (_t4662._tag === 1 && _t4662._val._tag === 15 && _t4662._val._val.contents._tag === 0) {
                              const fid = _t4662._val._val.contents._val[0];
                              _t4663 = (fid === id);
                              break _t4664;
                            }
                            if (_t4662._tag === 3 && _t4662._val[1]._tag === 15 && _t4662._val[1]._val.contents._tag === 0) {
                              const fid = _t4662._val[1]._val.contents._val[0];
                              _t4663 = (fid === id);
                              break _t4664;
                            }
                            if (true) {
                              _t4663 = false;
                              break _t4664;
                            }
                            _match_fail("line 16933");
                          }
                          return _t4663;
                        }
                        _t4659 = List$exists(_t4661, fargs);
                        break _t4660;
                      }
                      _match_fail("line 16933");
                    }
                    return _t4659;
                  }
                  _t4655 = List$exists(_t4657, Ref$get(found_multi_4376));
                  break _t4656;
                }
                if (true) {
                  _t4655 = false;
                  break _t4656;
                }
                _match_fail("line 16933");
              }
              return _t4655;
            }
            const dominated_4665 = List$exists(_t4653, args);
            let _t4667;
            if (dominated_4665) {
              _t4667 = ({_hd: [cls, args], _tl: acc});
            } else {
              _t4667 = acc;
            }
            const _t4666 = _t4667;
            _t4651 = _t4666;
            break _t4652;
          }
          _match_fail("line 16933");
        }
        return _t4651;
      }
      const to_promote_4668 = List$fold(_t4649, null, Ref$get(pending_caty_4378));
      function _t4670(__p95) {
        let _t4672;
        const _t4671 = __p95;
        _t4673: {
          if (true) {
            const cls = _t4671[0];
            const args = _t4671[1];
            function _t4674(ca) {
              let _t4676;
              const _t4675 = ca;
              _t4677: {
                if (_t4675._tag === 1 && _t4675._val._tag === 15 && _t4675._val._val.contents._tag === 0) {
                  const id = _t4675._val._val.contents._val[0];
                  const tv = _t4675._val;
                  const phantom_idx_4678 = Ref$create(({_tag: 0, _name: "None"}));
                  function _t4680(__p96) {
                    let _t4682;
                    const _t4681 = __p96;
                    _t4683: {
                      if (true) {
                        const _c = _t4681[0];
                        const fargs = _t4681[1];
                        function _t4684(fa) {
                          let _t4686;
                          const _t4685 = fa;
                          _t4687: {
                            if (_t4685._tag === 3 && _t4685._val[1]._tag === 15 && _t4685._val[1]._val.contents._tag === 0) {
                              const idx = _t4685._val[0];
                              const fid = _t4685._val[1]._val.contents._val[0];
                              if ((fid === id)) {
                                _t4686 = Ref$set(phantom_idx_4678, ({_tag: 1, _name: "Some", _val: idx}));
                                break _t4687;
                              }
                            }
                            if (true) {
                              _t4686 = undefined;
                              break _t4687;
                            }
                            _match_fail("line 16933");
                          }
                          return _t4686;
                        }
                        _t4682 = List$iter(_t4684, fargs);
                        break _t4683;
                      }
                      _match_fail("line 16933");
                    }
                    return _t4682;
                  }
                  List$iter(_t4680, Ref$get(found_multi_4376));
                  let _t4689;
                  const _t4688 = Ref$get(phantom_idx_4678);
                  _t4690: {
                    if (_t4688._tag === 1) {
                      const idx = _t4688._val;
                      _t4689 = ({_tag: 3, _name: "CAPhantom", _val: [idx, tv]});
                      break _t4690;
                    }
                    if (_t4688._tag === 0) {
                      _t4689 = ca;
                      break _t4690;
                    }
                    _match_fail("line 16933");
                  }
                  const _t4679 = _t4689;
                  _t4676 = _t4679;
                  break _t4677;
                }
                if (true) {
                  _t4676 = ca;
                  break _t4677;
                }
                _match_fail("line 16933");
              }
              return _t4676;
            }
            const promoted_args_4691 = List$map(_t4674, args);
            function _t4693(k) {
              return !_eq(k, [cls, args]);
            }
            Ref$set(pending_caty_4378, List$filter(_t4693, Ref$get(pending_caty_4378)));
            set_add_4387(found_multi_4376, [cls, promoted_args_4691]);
            const _t4692 = Ref$set(changed_4644, true);
            _t4672 = _t4692;
            break _t4673;
          }
          _match_fail("line 16933");
        }
        return _t4672;
      }
      const _t4669 = List$iter(_t4670, to_promote_4668);
      _t4669;
      if (_t4647) break;
    }
    _t4646 = _t4647 ? _t4648 : undefined;
    _t4646;
    function _t4694(acc, __p97) {
      let _t4696;
      const _t4695 = __p97;
      _t4697: {
        if (true) {
          const class_name = _t4695[0];
          const cc_args = _t4695[1];
          function _t4698(cc) {
            return ((cc.cc_class === class_name) && _eq(cc.cc_args, cc_args));
          }
          const exists_4699 = List$exists(_t4698, acc);
          let _t4701;
          if (exists_4699) {
            _t4701 = acc;
          } else {
            _t4701 = ({_hd: ({cc_args: cc_args, cc_class: class_name}), _tl: acc});
          }
          const _t4700 = _t4701;
          _t4696 = _t4700;
          break _t4697;
        }
        _match_fail("line 16933");
      }
      return _t4696;
    }
    const cc_list_4702 = List$fold(_t4694, null, Ref$get(found_multi_4376));
    let _t4704;
    if (_eq(cc_list_4702, null)) {
      _t4704 = scheme;
    } else {
      function _t4705(a, b) {
        function _t4706(args) {
          function _t4707(ca) {
            let _t4709;
            const _t4708 = ca;
            _t4710: {
              if (_t4708._tag === 0) {
                _t4709 = true;
                break _t4710;
              }
              if (true) {
                _t4709 = false;
                break _t4710;
              }
              _match_fail("line 16933");
            }
            return _t4709;
          }
          return List$length(List$filter(_t4707, args));
        }
        const count_catgen_4711 = _t4706;
        const _t4712 = compare(count_catgen_4711(b.cc_args), count_catgen_4711(a.cc_args));
        return _t4712;
      }
      const cc_list_4713 = List$sort(_t4705, cc_list_4702);
      const __rec_upd_4715 = scheme;
      const _t4716 = ({body: __rec_upd_4715.body, constraints: cc_list_4713, equant: __rec_upd_4715.equant, pvquant: __rec_upd_4715.pvquant, quant: __rec_upd_4715.quant, record_evidences: __rec_upd_4715.record_evidences, rquant: __rec_upd_4715.rquant});
      const _t4714 = _t4716;
      _t4704 = _t4714;
    }
    const _t4703 = _t4704;
    const _t4645 = _t4703;
    const _t4643 = _t4645;
    const _t4458 = _t4643;
    const _t4388 = _t4458;
    const _t4383 = _t4388;
    const _t4381 = _t4383;
    const _t4379 = _t4381;
    const _t4377 = _t4379;
    const _t4375 = _t4377;
    const _t4303 = _t4375;
    _t4301 = _t4303;
  }
  return _t4301;
}
function Typechecker$build_rgen_map(schema_ty, actual_ty) {
  const map_4717 = Hashtbl$create(4);
  function walk(s, a) {
    while (true) {
      const a_4719 = Types$repr(a);
      let _t4722;
      const _t4721 = s;
      _t4723: {
        if (_t4721._tag === 7) {
          const s1 = _t4721._val[0];
          const s2 = _t4721._val[2];
          let _t4725;
          const _t4724 = a_4719;
          _t4726: {
            if (_t4724._tag === 7) {
              const a1 = _t4724._val[0];
              const a2 = _t4724._val[2];
              walk(s1, a1);
              const _t4727 = s2;
              const _t4728 = a2;
              s = _t4727;
              a = _t4728;
              continue;
              _t4725 = undefined;
              break _t4726;
            }
            if (true) {
              _t4725 = undefined;
              break _t4726;
            }
            _match_fail("line 16933");
          }
          _t4722 = _t4725;
          break _t4723;
        }
        if (_t4721._tag === 8) {
          const s1 = _t4721._val[0];
          const s2 = _t4721._val[2];
          let _t4730;
          const _t4729 = a_4719;
          _t4731: {
            if (_t4729._tag === 8) {
              const a1 = _t4729._val[0];
              const a2 = _t4729._val[2];
              walk(s1, a1);
              const _t4732 = s2;
              const _t4733 = a2;
              s = _t4732;
              a = _t4733;
              continue;
              _t4730 = undefined;
              break _t4731;
            }
            if (true) {
              _t4730 = undefined;
              break _t4731;
            }
            _match_fail("line 16933");
          }
          _t4722 = _t4730;
          break _t4723;
        }
        if (_t4721._tag === 9) {
          const ss = _t4721._val;
          let _t4735;
          const _t4734 = a_4719;
          _t4736: {
            if (_t4734._tag === 9) {
              const aa = _t4734._val;
              if ((List$length(ss) === List$length(aa))) {
                _t4735 = List$iter2(walk, ss, aa);
                break _t4736;
              }
            }
            if (true) {
              _t4735 = undefined;
              break _t4736;
            }
            _match_fail("line 16933");
          }
          _t4722 = _t4735;
          break _t4723;
        }
        if (_t4721._tag === 10) {
          const s1 = _t4721._val;
          let _t4738;
          const _t4737 = a_4719;
          _t4739: {
            if (_t4737._tag === 10) {
              const a1 = _t4737._val;
              const _t4740 = s1;
              const _t4741 = a1;
              s = _t4740;
              a = _t4741;
              continue;
              _t4738 = undefined;
              break _t4739;
            }
            if (true) {
              _t4738 = undefined;
              break _t4739;
            }
            _match_fail("line 16933");
          }
          _t4722 = _t4738;
          break _t4723;
        }
        if (_t4721._tag === 13) {
          const s1 = _t4721._val;
          let _t4743;
          const _t4742 = a_4719;
          _t4744: {
            if (_t4742._tag === 13) {
              const a1 = _t4742._val;
              const _t4745 = s1;
              const _t4746 = a1;
              s = _t4745;
              a = _t4746;
              continue;
              _t4743 = undefined;
              break _t4744;
            }
            if (true) {
              _t4743 = undefined;
              break _t4744;
            }
            _match_fail("line 16933");
          }
          _t4722 = _t4743;
          break _t4723;
        }
        if (_t4721._tag === 12) {
          const ss = _t4721._val[1];
          let _t4748;
          const _t4747 = a_4719;
          _t4749: {
            if (_t4747._tag === 12) {
              const aa = _t4747._val[1];
              if ((List$length(ss) === List$length(aa))) {
                _t4748 = List$iter2(walk, ss, aa);
                break _t4749;
              }
            }
            if (true) {
              _t4748 = undefined;
              break _t4749;
            }
            _match_fail("line 16933");
          }
          _t4722 = _t4748;
          break _t4723;
        }
        if (_t4721._tag === 11) {
          const srow = _t4721._val;
          let _t4751;
          const _t4750 = a_4719;
          _t4752: {
            if (_t4750._tag === 11) {
              const arow = _t4750._val;
              walk_rrows(srow, arow);
              const sf_4753 = Types$record_row_to_fields(srow);
              const af_4755 = Types$record_row_to_fields(arow);
              function _t4757(__p98) {
                let _t4759;
                const _t4758 = __p98;
                _t4760: {
                  if (true) {
                    const name = _t4758[0];
                    const sty = _t4758[1];
                    let _t4762;
                    const _t4761 = List$assoc_opt(name, af_4755);
                    _t4763: {
                      if (_t4761._tag === 1) {
                        const aty = _t4761._val;
                        _t4762 = walk(sty, aty);
                        break _t4763;
                      }
                      if (_t4761._tag === 0) {
                        _t4762 = undefined;
                        break _t4763;
                      }
                      _match_fail("line 16933");
                    }
                    _t4759 = _t4762;
                    break _t4760;
                  }
                  _match_fail("line 16933");
                }
                return _t4759;
              }
              const _t4756 = List$iter(_t4757, sf_4753);
              const _t4754 = _t4756;
              _t4751 = _t4754;
              break _t4752;
            }
            if (true) {
              _t4751 = undefined;
              break _t4752;
            }
            _match_fail("line 16933");
          }
          _t4722 = _t4751;
          break _t4723;
        }
        if (true) {
          _t4722 = undefined;
          break _t4723;
        }
        _match_fail("line 16933");
      }
      const _t4720 = _t4722;
      return _t4720;
    }
  }
  function walk_rrows(srow, arow) {
    while (true) {
      let _t4765;
      const _t4764 = srow;
      _t4766: {
        if (_t4764._tag === 3) {
          const i = _t4764._val;
          let _t4767;
          if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, map_4717, i]))) {
            _t4767 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, map_4717, i, arow]);
          } else {
            _t4767 = undefined;
          }
          _t4765 = _t4767;
          break _t4766;
        }
        if (_t4764._tag === 0) {
          const stail = _t4764._val[2];
          const _t4768 = stail;
          const _t4769 = arow;
          srow = _t4768;
          arow = _t4769;
          continue;
          _t4765 = undefined;
          break _t4766;
        }
        if (true) {
          _t4765 = undefined;
          break _t4766;
        }
        _match_fail("line 16933");
      }
      return _t4765;
    }
  }
  walk(schema_ty, actual_ty);
  const _t4770 = map_4717;
  const _t4718 = _t4770;
  return _t4718;
}
function Typechecker$infer_record_evidence(vars, te, scheme) {
  let _t4771;
  if ((scheme.rquant === 0)) {
    _t4771 = scheme;
  } else {
    const rvar_to_rgen_4772 = Hashtbl$create(4);
    function walk_rmap(s, a) {
      while (true) {
        const a_4774 = Types$repr(a);
        let _t4777;
        const _t4776 = s;
        _t4778: {
          if (_t4776._tag === 7) {
            const s1 = _t4776._val[0];
            const s2 = _t4776._val[2];
            let _t4780;
            const _t4779 = a_4774;
            _t4781: {
              if (_t4779._tag === 7) {
                const a1 = _t4779._val[0];
                const a2 = _t4779._val[2];
                walk_rmap(s1, a1);
                const _t4782 = s2;
                const _t4783 = a2;
                s = _t4782;
                a = _t4783;
                continue;
                _t4780 = undefined;
                break _t4781;
              }
              if (true) {
                _t4780 = undefined;
                break _t4781;
              }
              _match_fail("line 16933");
            }
            _t4777 = _t4780;
            break _t4778;
          }
          if (_t4776._tag === 8) {
            const s1 = _t4776._val[0];
            const s2 = _t4776._val[2];
            let _t4785;
            const _t4784 = a_4774;
            _t4786: {
              if (_t4784._tag === 8) {
                const a1 = _t4784._val[0];
                const a2 = _t4784._val[2];
                walk_rmap(s1, a1);
                const _t4787 = s2;
                const _t4788 = a2;
                s = _t4787;
                a = _t4788;
                continue;
                _t4785 = undefined;
                break _t4786;
              }
              if (true) {
                _t4785 = undefined;
                break _t4786;
              }
              _match_fail("line 16933");
            }
            _t4777 = _t4785;
            break _t4778;
          }
          if (_t4776._tag === 9) {
            const ss = _t4776._val;
            let _t4790;
            const _t4789 = a_4774;
            _t4791: {
              if (_t4789._tag === 9) {
                const aa = _t4789._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t4790 = List$iter2(walk_rmap, ss, aa);
                  break _t4791;
                }
              }
              if (true) {
                _t4790 = undefined;
                break _t4791;
              }
              _match_fail("line 16933");
            }
            _t4777 = _t4790;
            break _t4778;
          }
          if (_t4776._tag === 10) {
            const s1 = _t4776._val;
            let _t4793;
            const _t4792 = a_4774;
            _t4794: {
              if (_t4792._tag === 10) {
                const a1 = _t4792._val;
                const _t4795 = s1;
                const _t4796 = a1;
                s = _t4795;
                a = _t4796;
                continue;
                _t4793 = undefined;
                break _t4794;
              }
              if (true) {
                _t4793 = undefined;
                break _t4794;
              }
              _match_fail("line 16933");
            }
            _t4777 = _t4793;
            break _t4778;
          }
          if (_t4776._tag === 13) {
            const s1 = _t4776._val;
            let _t4798;
            const _t4797 = a_4774;
            _t4799: {
              if (_t4797._tag === 13) {
                const a1 = _t4797._val;
                const _t4800 = s1;
                const _t4801 = a1;
                s = _t4800;
                a = _t4801;
                continue;
                _t4798 = undefined;
                break _t4799;
              }
              if (true) {
                _t4798 = undefined;
                break _t4799;
              }
              _match_fail("line 16933");
            }
            _t4777 = _t4798;
            break _t4778;
          }
          if (_t4776._tag === 12) {
            const ss = _t4776._val[1];
            let _t4803;
            const _t4802 = a_4774;
            _t4804: {
              if (_t4802._tag === 12) {
                const aa = _t4802._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t4803 = List$iter2(walk_rmap, ss, aa);
                  break _t4804;
                }
              }
              if (true) {
                _t4803 = undefined;
                break _t4804;
              }
              _match_fail("line 16933");
            }
            _t4777 = _t4803;
            break _t4778;
          }
          if (_t4776._tag === 11) {
            const srow = _t4776._val;
            let _t4806;
            const _t4805 = a_4774;
            _t4807: {
              if (_t4805._tag === 11) {
                const arow = _t4805._val;
                _t4806 = walk_rmap_rrows(srow, arow);
                break _t4807;
              }
              if (true) {
                _t4806 = undefined;
                break _t4807;
              }
              _match_fail("line 16933");
            }
            _t4777 = _t4806;
            break _t4778;
          }
          if (true) {
            _t4777 = undefined;
            break _t4778;
          }
          _match_fail("line 16933");
        }
        const _t4775 = _t4777;
        return _t4775;
      }
    }
    function walk_rmap_rrows(srow, arow) {
      while (true) {
        let _t4809;
        const _t4808 = [srow, Types$rrow_repr(arow)];
        _t4810: {
          if (_t4808[0]._tag === 3 && _t4808[1]._tag === 1 && _t4808[1]._val.contents._tag === 0) {
            const i = _t4808[0]._val;
            const id = _t4808[1]._val.contents._val[0];
            _t4809 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4772, id, i]);
            break _t4810;
          }
          if (_t4808[0]._tag === 0 && _t4808[1]._tag === 0) {
            const sty = _t4808[0]._val[1];
            const stail = _t4808[0]._val[2];
            const aty = _t4808[1]._val[1];
            const atail = _t4808[1]._val[2];
            walk_rmap(sty, aty);
            const _t4811 = stail;
            const _t4812 = atail;
            srow = _t4811;
            arow = _t4812;
            continue;
            _t4809 = undefined;
            break _t4810;
          }
          if (true) {
            _t4809 = undefined;
            break _t4810;
          }
          _match_fail("line 16933");
        }
        return _t4809;
      }
    }
    walk_rmap(scheme.body, te.ty);
    const found_evidences_4814 = Hashtbl$create(4);
    function _t4816(__dict_Hash_resolved_0, __dict_Eq_resolved_1, rgen_idx, fields) {
      let _t4818;
      const _t4817 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_evidences_4814, rgen_idx]);
      _t4819: {
        if (_t4817._tag === 1) {
          const fs = _t4817._val;
          _t4818 = fs;
          break _t4819;
        }
        if (_t4817._tag === 0) {
          _t4818 = null;
          break _t4819;
        }
        _match_fail("line 16933");
      }
      const existing_4820 = _t4818;
      function _t4822(fs, f) {
        let _t4823;
        if (List$mem(f, fs)) {
          _t4823 = fs;
        } else {
          _t4823 = ({_hd: f, _tl: fs});
        }
        return _t4823;
      }
      const merged_4824 = List$fold(_t4822, existing_4820, fields);
      const _t4825 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_evidences_4814, rgen_idx, merged_4824]);
      const _t4821 = _t4825;
      return _t4821;
    }
    const add_evidence_4826 = _t4816;
    function get_row_tail(row) {
      while (true) {
        let _t4829;
        const _t4828 = Types$rrow_repr(row);
        _t4830: {
          if (_t4828._tag === 0) {
            const tail = _t4828._val[2];
            const _t4831 = tail;
            row = _t4831;
            continue;
            _t4829 = undefined;
            break _t4830;
          }
          if (true) {
            const tail = _t4828;
            _t4829 = tail;
            break _t4830;
          }
          _match_fail("line 16933");
        }
        return _t4829;
      }
    }
    function walk(te) {
      let _t4834;
      const _t4833 = te.expr;
      _t4835: {
        if (_t4833._tag === 17) {
          const _base = _t4833._val[0];
          const overrides = _t4833._val[1];
          let _t4837;
          const _t4836 = Types$repr(te.ty);
          _t4838: {
            if (_t4836._tag === 11) {
              const row = _t4836._val;
              let _t4840;
              const _t4839 = get_row_tail(row);
              _t4841: {
                if (_t4839._tag === 1 && _t4839._val.contents._tag === 0) {
                  const id = _t4839._val.contents._val[0];
                  let _t4843;
                  const _t4842 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4772, id]);
                  _t4844: {
                    if (_t4842._tag === 1) {
                      const rgen_idx = _t4842._val;
                      _t4843 = _call(add_evidence_4826, [__dict_Hash_int, __dict_Eq_int, rgen_idx, List$map(fst, overrides)]);
                      break _t4844;
                    }
                    if (_t4842._tag === 0) {
                      _t4843 = undefined;
                      break _t4844;
                    }
                    _match_fail("line 16933");
                  }
                  _t4840 = _t4843;
                  break _t4841;
                }
                if (true) {
                  _t4840 = undefined;
                  break _t4841;
                }
                _match_fail("line 16933");
              }
              _t4837 = _t4840;
              break _t4838;
            }
            if (true) {
              _t4837 = undefined;
              break _t4838;
            }
            _match_fail("line 16933");
          }
          _t4834 = _t4837;
          break _t4835;
        }
        if (_t4833._tag === 19) {
          const base_e = _t4833._val[0];
          const field_name = _t4833._val[1];
          let _t4846;
          const _t4845 = Types$repr(base_e.ty);
          _t4847: {
            if (_t4845._tag === 11) {
              const row = _t4845._val;
              let _t4849;
              const _t4848 = get_row_tail(row);
              _t4850: {
                if (_t4848._tag === 1 && _t4848._val.contents._tag === 0) {
                  const id = _t4848._val.contents._val[0];
                  let _t4852;
                  const _t4851 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4772, id]);
                  _t4853: {
                    if (_t4851._tag === 1) {
                      const rgen_idx = _t4851._val;
                      _t4852 = _call(add_evidence_4826, [__dict_Hash_int, __dict_Eq_int, rgen_idx, ({_hd: field_name, _tl: null})]);
                      break _t4853;
                    }
                    if (_t4851._tag === 0) {
                      _t4852 = undefined;
                      break _t4853;
                    }
                    _match_fail("line 16933");
                  }
                  _t4849 = _t4852;
                  break _t4850;
                }
                if (true) {
                  _t4849 = undefined;
                  break _t4850;
                }
                _match_fail("line 16933");
              }
              _t4846 = _t4849;
              break _t4847;
            }
            if (true) {
              _t4846 = undefined;
              break _t4847;
            }
            _match_fail("line 16933");
          }
          _t4834 = _t4846;
          break _t4835;
        }
        if (_t4833._tag === 27) {
          const base_e = _t4833._val[0];
          const field_name = _t4833._val[1];
          let _t4855;
          const _t4854 = Types$repr(base_e.ty);
          _t4856: {
            if (_t4854._tag === 11) {
              const row = _t4854._val;
              let _t4858;
              const _t4857 = get_row_tail(row);
              _t4859: {
                if (_t4857._tag === 1 && _t4857._val.contents._tag === 0) {
                  const id = _t4857._val.contents._val[0];
                  let _t4861;
                  const _t4860 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4772, id]);
                  _t4862: {
                    if (_t4860._tag === 1) {
                      const rgen_idx = _t4860._val;
                      _t4861 = _call(add_evidence_4826, [__dict_Hash_int, __dict_Eq_int, rgen_idx, ({_hd: field_name, _tl: null})]);
                      break _t4862;
                    }
                    if (_t4860._tag === 0) {
                      _t4861 = undefined;
                      break _t4862;
                    }
                    _match_fail("line 16933");
                  }
                  _t4858 = _t4861;
                  break _t4859;
                }
                if (true) {
                  _t4858 = undefined;
                  break _t4859;
                }
                _match_fail("line 16933");
              }
              _t4855 = _t4858;
              break _t4856;
            }
            if (true) {
              _t4855 = undefined;
              break _t4856;
            }
            _match_fail("line 16933");
          }
          _t4834 = _t4855;
          break _t4835;
        }
        if (_t4833._tag === 7) {
          const name = _t4833._val;
          let _t4864;
          const _t4863 = List$assoc_opt(name, vars);
          _t4865: {
            if (_t4863._tag === 1) {
              const callee_sch = _t4863._val;
              if (!_eq(callee_sch.record_evidences, null)) {
                const rgen_map_4866 = Typechecker$build_rgen_map(callee_sch.body, te.ty);
                function _t4868(re) {
                  let _t4870;
                  const _t4869 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rgen_map_4866, re.re_rgen]);
                  _t4871: {
                    if (_t4869._tag === 1) {
                      const arow = _t4869._val;
                      function is_open(r) {
                        while (true) {
                          let _t4873;
                          const _t4872 = Types$rrow_repr(r);
                          _t4874: {
                            if (_t4872._tag === 0) {
                              const tail = _t4872._val[2];
                              const _t4875 = tail;
                              r = _t4875;
                              continue;
                              _t4873 = undefined;
                              break _t4874;
                            }
                            if (_t4872._tag === 1 && _t4872._val.contents._tag === 0) {
                              _t4873 = true;
                              break _t4874;
                            }
                            if (true) {
                              _t4873 = false;
                              break _t4874;
                            }
                            _match_fail("line 16933");
                          }
                          return _t4873;
                        }
                      }
                      let _t4877;
                      if (is_open(arow)) {
                        let _t4879;
                        const _t4878 = get_row_tail(arow);
                        _t4880: {
                          if (_t4878._tag === 1 && _t4878._val.contents._tag === 0) {
                            const id = _t4878._val.contents._val[0];
                            let _t4882;
                            const _t4881 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rvar_to_rgen_4772, id]);
                            _t4883: {
                              if (_t4881._tag === 1) {
                                const caller_rgen = _t4881._val;
                                _t4882 = _call(add_evidence_4826, [__dict_Hash_int, __dict_Eq_int, caller_rgen, re.re_fields]);
                                break _t4883;
                              }
                              if (_t4881._tag === 0) {
                                _t4882 = undefined;
                                break _t4883;
                              }
                              _match_fail("line 16933");
                            }
                            _t4879 = _t4882;
                            break _t4880;
                          }
                          if (true) {
                            _t4879 = undefined;
                            break _t4880;
                          }
                          _match_fail("line 16933");
                        }
                        _t4877 = _t4879;
                      } else {
                        _t4877 = undefined;
                      }
                      const _t4876 = _t4877;
                      _t4870 = _t4876;
                      break _t4871;
                    }
                    if (_t4869._tag === 0) {
                      _t4870 = undefined;
                      break _t4871;
                    }
                    _match_fail("line 16933");
                  }
                  return _t4870;
                }
                const _t4867 = List$iter(_t4868, callee_sch.record_evidences);
                _t4864 = _t4867;
                break _t4865;
              }
            }
            if (true) {
              _t4864 = undefined;
              break _t4865;
            }
            _match_fail("line 16933");
          }
          _t4834 = _t4864;
          break _t4835;
        }
        if (true) {
          _t4834 = undefined;
          break _t4835;
        }
        _match_fail("line 16933");
      }
      _t4834;
      return walk_children(te);
    }
    function walk_children(te) {
      let _t4885;
      const _t4884 = te.expr;
      _t4886: {
        if ((((((((((_t4884._tag === 0 || _t4884._tag === 1) || _t4884._tag === 2) || _t4884._tag === 3) || _t4884._tag === 4) || _t4884._tag === 5) || _t4884._tag === 6) || _t4884._tag === 7) || _t4884._tag === 22) || _t4884._tag === 34)) {
          _t4885 = undefined;
          break _t4886;
        }
        if (((_t4884._tag === 8 || _t4884._tag === 9) || _t4884._tag === 25)) {
          const e1 = ((_t4884._tag === 8 || _t4884._tag === 9) ? _t4884._val[2] : _t4884._val[1]);
          const e2 = ((_t4884._tag === 8 || _t4884._tag === 9) ? _t4884._val[3] : _t4884._val[2]);
          walk(e1);
          _t4885 = walk(e2);
          break _t4886;
        }
        if (((((((_t4884._tag === 13 || _t4884._tag === 21) || _t4884._tag === 28) || _t4884._tag === 32) || _t4884._tag === 31) || _t4884._tag === 27) || _t4884._tag === 20)) {
          const e1 = ((((((_t4884._tag === 13 || _t4884._tag === 21) || _t4884._tag === 28) || _t4884._tag === 32) || _t4884._tag === 31) || _t4884._tag === 27) ? (((((_t4884._tag === 13 || _t4884._tag === 21) || _t4884._tag === 28) || _t4884._tag === 32) || _t4884._tag === 31) ? ((((_t4884._tag === 13 || _t4884._tag === 21) || _t4884._tag === 28) || _t4884._tag === 32) ? (((_t4884._tag === 13 || _t4884._tag === 21) || _t4884._tag === 28) ? ((_t4884._tag === 13 || _t4884._tag === 21) ? (_t4884._tag === 13 ? _t4884._val[1] : _t4884._val[0]) : _t4884._val[0]) : _t4884._val[0]) : _t4884._val[0]) : _t4884._val[0]) : _t4884._val[0]);
          const e2 = ((((((_t4884._tag === 13 || _t4884._tag === 21) || _t4884._tag === 28) || _t4884._tag === 32) || _t4884._tag === 31) || _t4884._tag === 27) ? (((((_t4884._tag === 13 || _t4884._tag === 21) || _t4884._tag === 28) || _t4884._tag === 32) || _t4884._tag === 31) ? ((((_t4884._tag === 13 || _t4884._tag === 21) || _t4884._tag === 28) || _t4884._tag === 32) ? (((_t4884._tag === 13 || _t4884._tag === 21) || _t4884._tag === 28) ? ((_t4884._tag === 13 || _t4884._tag === 21) ? (_t4884._tag === 13 ? _t4884._val[2] : _t4884._val[1]) : _t4884._val[1]) : _t4884._val[1]) : _t4884._val[1]) : _t4884._val[2]) : _t4884._val[1]);
          walk(e1);
          _t4885 = walk(e2);
          break _t4886;
        }
        if (_t4884._tag === 11) {
          const fn_ = _t4884._val[0];
          const arg = _t4884._val[1];
          walk(fn_);
          _t4885 = walk(arg);
          break _t4886;
        }
        if (((((((((_t4884._tag === 29 || _t4884._tag === 14) || _t4884._tag === 10) || _t4884._tag === 19) || _t4884._tag === 33) || _t4884._tag === 35) || _t4884._tag === 36) || _t4884._tag === 39) || _t4884._tag === 26)) {
          const e = ((((((((_t4884._tag === 29 || _t4884._tag === 14) || _t4884._tag === 10) || _t4884._tag === 19) || _t4884._tag === 33) || _t4884._tag === 35) || _t4884._tag === 36) || _t4884._tag === 39) ? (((((((_t4884._tag === 29 || _t4884._tag === 14) || _t4884._tag === 10) || _t4884._tag === 19) || _t4884._tag === 33) || _t4884._tag === 35) || _t4884._tag === 36) ? ((((((_t4884._tag === 29 || _t4884._tag === 14) || _t4884._tag === 10) || _t4884._tag === 19) || _t4884._tag === 33) || _t4884._tag === 35) ? (((((_t4884._tag === 29 || _t4884._tag === 14) || _t4884._tag === 10) || _t4884._tag === 19) || _t4884._tag === 33) ? ((((_t4884._tag === 29 || _t4884._tag === 14) || _t4884._tag === 10) || _t4884._tag === 19) ? (((_t4884._tag === 29 || _t4884._tag === 14) || _t4884._tag === 10) ? _t4884._val[1] : _t4884._val[0]) : _t4884._val) : _t4884._val) : _t4884._val) : _t4884._val) : _t4884._val[1]);
          _t4885 = walk(e);
          break _t4886;
        }
        if (_t4884._tag === 12) {
          const c = _t4884._val[0];
          const t = _t4884._val[1];
          const e = _t4884._val[2];
          walk(c);
          walk(t);
          _t4885 = walk(e);
          break _t4886;
        }
        if ((_t4884._tag === 15 || _t4884._tag === 38)) {
          const es = _t4884._val;
          _t4885 = List$iter(walk, es);
          break _t4886;
        }
        if (_t4884._tag === 16) {
          const fields = _t4884._val;
          function _t4887(__p99) {
            let _t4889;
            const _t4888 = __p99;
            _t4890: {
              if (true) {
                const e = _t4888[1];
                _t4889 = walk(e);
                break _t4890;
              }
              _match_fail("line 16933");
            }
            return _t4889;
          }
          _t4885 = List$iter(_t4887, fields);
          break _t4886;
        }
        if (_t4884._tag === 17) {
          const base = _t4884._val[0];
          const overrides = _t4884._val[1];
          walk(base);
          function _t4891(__p100) {
            let _t4893;
            const _t4892 = __p100;
            _t4894: {
              if (true) {
                const e = _t4892[1];
                _t4893 = walk(e);
                break _t4894;
              }
              _match_fail("line 16933");
            }
            return _t4893;
          }
          _t4885 = List$iter(_t4891, overrides);
          break _t4886;
        }
        if (_t4884._tag === 18) {
          const base = _t4884._val[0];
          const pairs = _t4884._val[1];
          walk(base);
          function _t4895(__p101) {
            let _t4897;
            const _t4896 = __p101;
            _t4898: {
              if (true) {
                const i = _t4896[0];
                const v = _t4896[1];
                walk(i);
                _t4897 = walk(v);
                break _t4898;
              }
              _match_fail("line 16933");
            }
            return _t4897;
          }
          _t4885 = List$iter(_t4895, pairs);
          break _t4886;
        }
        if (_t4884._tag === 23) {
          const arg = _t4884._val[1];
          _t4885 = Option$iter(walk, arg);
          break _t4886;
        }
        if (_t4884._tag === 24) {
          const scrutinee = _t4884._val[0];
          const arms = _t4884._val[1];
          walk(scrutinee);
          function _t4899(__p102) {
            let _t4901;
            const _t4900 = __p102;
            _t4902: {
              if (true) {
                const guard = _t4900[1];
                const body = _t4900[2];
                Option$iter(walk, guard);
                _t4901 = walk(body);
                break _t4902;
              }
              _match_fail("line 16933");
            }
            return _t4901;
          }
          _t4885 = List$iter(_t4899, arms);
          break _t4886;
        }
        if (_t4884._tag === 30) {
          const body = _t4884._val[0];
          const arms = _t4884._val[1];
          walk(body);
          function _t4903(arm) {
            let _t4905;
            const _t4904 = arm;
            _t4906: {
              if ((((_t4904._tag === 0 || _t4904._tag === 1) || _t4904._tag === 2) || _t4904._tag === 3)) {
                const e = (((_t4904._tag === 0 || _t4904._tag === 1) || _t4904._tag === 2) ? ((_t4904._tag === 0 || _t4904._tag === 1) ? (_t4904._tag === 0 ? _t4904._val[1] : _t4904._val[3]) : _t4904._val[2]) : _t4904._val[2]);
                _t4905 = walk(e);
                break _t4906;
              }
              _match_fail("line 16933");
            }
            return _t4905;
          }
          _t4885 = List$iter(_t4903, arms);
          break _t4886;
        }
        if (_t4884._tag === 37) {
          const bindings = _t4884._val[0];
          const body = _t4884._val[1];
          function _t4907(__p103) {
            let _t4909;
            const _t4908 = __p103;
            _t4910: {
              if (true) {
                const e = _t4908[1];
                _t4909 = walk(e);
                break _t4910;
              }
              _match_fail("line 16933");
            }
            return _t4909;
          }
          List$iter(_t4907, bindings);
          _t4885 = walk(body);
          break _t4886;
        }
        _match_fail("line 16933");
      }
      return _t4885;
    }
    walk(te);
    function _t4912(rgen_idx, fields, acc) {
      return ({_hd: ({re_fields: List$sort(String$compare, fields), re_rgen: rgen_idx}), _tl: acc});
    }
    const ev_list_4913 = Hashtbl$fold(_t4912, found_evidences_4814, null);
    let _t4915;
    if (_eq(ev_list_4913, null)) {
      _t4915 = scheme;
    } else {
      const __rec_upd_4916 = scheme;
      const _t4917 = ({body: __rec_upd_4916.body, constraints: __rec_upd_4916.constraints, equant: __rec_upd_4916.equant, pvquant: __rec_upd_4916.pvquant, quant: __rec_upd_4916.quant, record_evidences: ev_list_4913, rquant: __rec_upd_4916.rquant});
      _t4915 = _t4917;
    }
    const _t4914 = _t4915;
    const _t4911 = _t4914;
    const _t4832 = _t4911;
    const _t4827 = _t4832;
    const _t4815 = _t4827;
    const _t4813 = _t4815;
    const _t4773 = _t4813;
    _t4771 = _t4773;
  }
  return _t4771;
}
function Typechecker$scheme_needs_xform(scheme) {
  return (!_eq(scheme.constraints, null) || !_eq(scheme.record_evidences, null));
}
function Typechecker$improve_fundeps_in_expr(vars, type_env, te) {
  const classes_4918 = type_env.classes;
  const instances_4920 = type_env.instances;
  function _t4922(sch, ty) {
    const tgen_to_actual_4923 = Hashtbl$create(sch.quant);
    function map_tgens(s, a) {
      while (true) {
        const a_4925 = Types$repr(a);
        let _t4928;
        const _t4927 = s;
        _t4929: {
          if (_t4927._tag === 16) {
            const i = _t4927._val;
            let _t4930;
            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4923, i]))) {
              _t4930 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4923, i, a_4925]);
            } else {
              _t4930 = undefined;
            }
            _t4928 = _t4930;
            break _t4929;
          }
          if (_t4927._tag === 7) {
            const s1 = _t4927._val[0];
            const s2 = _t4927._val[2];
            let _t4932;
            const _t4931 = a_4925;
            _t4933: {
              if (_t4931._tag === 7) {
                const a1 = _t4931._val[0];
                const a2 = _t4931._val[2];
                map_tgens(s1, a1);
                const _t4934 = s2;
                const _t4935 = a2;
                s = _t4934;
                a = _t4935;
                continue;
                _t4932 = undefined;
                break _t4933;
              }
              if (true) {
                _t4932 = undefined;
                break _t4933;
              }
              _match_fail("line 16933");
            }
            _t4928 = _t4932;
            break _t4929;
          }
          if (_t4927._tag === 8) {
            const s1 = _t4927._val[0];
            const s2 = _t4927._val[2];
            let _t4937;
            const _t4936 = a_4925;
            _t4938: {
              if (_t4936._tag === 8) {
                const a1 = _t4936._val[0];
                const a2 = _t4936._val[2];
                map_tgens(s1, a1);
                const _t4939 = s2;
                const _t4940 = a2;
                s = _t4939;
                a = _t4940;
                continue;
                _t4937 = undefined;
                break _t4938;
              }
              if (true) {
                _t4937 = undefined;
                break _t4938;
              }
              _match_fail("line 16933");
            }
            _t4928 = _t4937;
            break _t4929;
          }
          if (_t4927._tag === 9) {
            const ss = _t4927._val;
            let _t4942;
            const _t4941 = a_4925;
            _t4943: {
              if (_t4941._tag === 9) {
                const aa = _t4941._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t4942 = List$iter2(map_tgens, ss, aa);
                  break _t4943;
                }
              }
              if (true) {
                _t4942 = undefined;
                break _t4943;
              }
              _match_fail("line 16933");
            }
            _t4928 = _t4942;
            break _t4929;
          }
          if (_t4927._tag === 10) {
            const s1 = _t4927._val;
            let _t4945;
            const _t4944 = a_4925;
            _t4946: {
              if (_t4944._tag === 10) {
                const a1 = _t4944._val;
                const _t4947 = s1;
                const _t4948 = a1;
                s = _t4947;
                a = _t4948;
                continue;
                _t4945 = undefined;
                break _t4946;
              }
              if (true) {
                _t4945 = undefined;
                break _t4946;
              }
              _match_fail("line 16933");
            }
            _t4928 = _t4945;
            break _t4929;
          }
          if (_t4927._tag === 13) {
            const s1 = _t4927._val;
            let _t4950;
            const _t4949 = a_4925;
            _t4951: {
              if (_t4949._tag === 13) {
                const a1 = _t4949._val;
                const _t4952 = s1;
                const _t4953 = a1;
                s = _t4952;
                a = _t4953;
                continue;
                _t4950 = undefined;
                break _t4951;
              }
              if (true) {
                _t4950 = undefined;
                break _t4951;
              }
              _match_fail("line 16933");
            }
            _t4928 = _t4950;
            break _t4929;
          }
          if (_t4927._tag === 12) {
            const ss = _t4927._val[1];
            let _t4955;
            const _t4954 = a_4925;
            _t4956: {
              if (_t4954._tag === 12) {
                const aa = _t4954._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t4955 = List$iter2(map_tgens, ss, aa);
                  break _t4956;
                }
              }
              if (true) {
                _t4955 = undefined;
                break _t4956;
              }
              _match_fail("line 16933");
            }
            _t4928 = _t4955;
            break _t4929;
          }
          if (true) {
            _t4928 = undefined;
            break _t4929;
          }
          _match_fail("line 16933");
        }
        const _t4926 = _t4928;
        return _t4926;
      }
    }
    map_tgens(sch.body, ty);
    function _t4958(cc) {
      function _t4959(cls) {
        return (cls.class_name === cc.cc_class);
      }
      let _t4961;
      const _t4960 = List$find(_t4959, classes_4918);
      _t4962: {
        if (_t4960._tag === 0) {
          _t4961 = undefined;
          break _t4962;
        }
        if (_t4960._tag === 1) {
          const class_def = _t4960._val;
          if (_eq(class_def.class_fundeps, null)) {
            _t4961 = undefined;
            break _t4962;
          }
        }
        if (_t4960._tag === 1) {
          const class_def = _t4960._val;
          const num_params_4963 = List$length(class_def.class_params);
          function _t4965(ca) {
            let _t4967;
            const _t4966 = ca;
            _t4968: {
              if (_t4966._tag === 0) {
                const tgen_idx = _t4966._val;
                let _t4970;
                const _t4969 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4923, tgen_idx]);
                _t4971: {
                  if (_t4969._tag === 1 && _t4969._val._tag === 15 && _t4969._val._val.contents._tag === 0) {
                    _t4970 = ({_tag: 0, _name: "None"});
                    break _t4971;
                  }
                  if (_t4969._tag === 1) {
                    const t = _t4969._val;
                    _t4970 = ({_tag: 1, _name: "Some", _val: t});
                    break _t4971;
                  }
                  if (_t4969._tag === 0) {
                    _t4970 = ({_tag: 0, _name: "None"});
                    break _t4971;
                  }
                  _match_fail("line 16933");
                }
                _t4967 = _t4970;
                break _t4968;
              }
              if (_t4966._tag === 1) {
                const ty = _t4966._val;
                let _t4973;
                const _t4972 = Types$repr(ty);
                _t4974: {
                  if (_t4972._tag === 15 && _t4972._val.contents._tag === 0) {
                    _t4973 = ({_tag: 0, _name: "None"});
                    break _t4974;
                  }
                  if (true) {
                    const t = _t4972;
                    _t4973 = ({_tag: 1, _name: "Some", _val: t});
                    break _t4974;
                  }
                  _match_fail("line 16933");
                }
                _t4967 = _t4973;
                break _t4968;
              }
              if (_t4966._tag === 2) {
                _t4967 = ({_tag: 0, _name: "None"});
                break _t4968;
              }
              if (_t4966._tag === 3) {
                _t4967 = ({_tag: 0, _name: "None"});
                break _t4968;
              }
              _match_fail("line 16933");
            }
            return _t4967;
          }
          const partial_4975 = List$map(_t4965, cc.cc_args);
          const improved_4977 = Types$improve_with_fundeps(instances_4920, class_def, partial_4975);
          function _t4979(i, opt) {
            let _t4980;
            if ((i < num_params_4963)) {
              let _t4982;
              const _t4981 = [opt, List$nth(partial_4975, i)];
              _t4983: {
                if (_t4981[0]._tag === 1 && _t4981[1]._tag === 0) {
                  const resolved_ty = _t4981[0]._val;
                  const ca_4984 = List$nth(cc.cc_args, i);
                  let _t4987;
                  const _t4986 = ca_4984;
                  _t4988: {
                    if (_t4986._tag === 0) {
                      const tgen_idx = _t4986._val;
                      _t4987 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_to_actual_4923, tgen_idx]);
                      break _t4988;
                    }
                    if (_t4986._tag === 1) {
                      const ty = _t4986._val;
                      _t4987 = ({_tag: 1, _name: "Some", _val: ty});
                      break _t4988;
                    }
                    if (_t4986._tag === 2) {
                      _t4987 = ({_tag: 0, _name: "None"});
                      break _t4988;
                    }
                    if (_t4986._tag === 3) {
                      _t4987 = ({_tag: 0, _name: "None"});
                      break _t4988;
                    }
                    _match_fail("line 16933");
                  }
                  const tvar_opt_4989 = _t4987;
                  let _t4992;
                  const _t4991 = tvar_opt_4989;
                  _t4993: {
                    if (_t4991._tag === 1 && _t4991._val._tag === 15 && _t4991._val._val.contents._tag === 0) {
                      const r = _t4991._val._val;
                      _t4992 = Types$unify(({_tag: 15, _name: "TVar", _val: r}), resolved_ty);
                      break _t4993;
                    }
                    if (true) {
                      _t4992 = undefined;
                      break _t4993;
                    }
                    _match_fail("line 16933");
                  }
                  const _t4990 = _t4992;
                  const _t4985 = _t4990;
                  _t4982 = _t4985;
                  break _t4983;
                }
                if (true) {
                  _t4982 = undefined;
                  break _t4983;
                }
                _match_fail("line 16933");
              }
              _t4980 = _t4982;
            } else {
              _t4980 = undefined;
            }
            return _t4980;
          }
          const _t4978 = List$iteri(_t4979, improved_4977);
          const _t4976 = _t4978;
          const _t4964 = _t4976;
          _t4961 = _t4964;
          break _t4962;
        }
        _match_fail("line 16933");
      }
      return _t4961;
    }
    const _t4957 = List$iter(_t4958, sch.constraints);
    const _t4924 = _t4957;
    return _t4924;
  }
  const improve_constrained_call_with_scheme_4994 = _t4922;
  function _t4996(name, ty) {
    let _t4998;
    const _t4997 = Types$find_method_class(classes_4918, name);
    _t4999: {
      if (_t4997._tag === 1) {
        const result = _t4997;
        _t4998 = [result, name];
        break _t4999;
      }
      if (_t4997._tag === 0) {
        let _t5001;
        const _t5000 = String$rindex_opt(name, 46);
        _t5002: {
          if (_t5000._tag === 0) {
            _t5001 = [({_tag: 0, _name: "None"}), name];
            break _t5002;
          }
          if (_t5000._tag === 1) {
            const i = _t5000._val;
            const mod_prefix_5003 = String$sub(name, 0, (i + 1));
            const _mml$short_5005 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
            const class_prefix_5007 = String$sub(name, 0, i);
            let _t5010;
            const _t5009 = Types$find_method_class(classes_4918, _mml$short_5005);
            _t5011: {
              if (_t5009._tag === 1) {
                const class_def = _t5009._val;
                if ((class_def.class_name === class_prefix_5007)) {
                  _t5010 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_5005];
                  break _t5011;
                }
              }
              if (_t5009._tag === 1) {
                const class_def = _t5009._val;
                if (((String$length(class_def.class_name) > String$length(mod_prefix_5003)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_5003)) === mod_prefix_5003))) {
                  _t5010 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_5005];
                  break _t5011;
                }
              }
              if (true) {
                _t5010 = [({_tag: 0, _name: "None"}), name];
                break _t5011;
              }
              _match_fail("line 16933");
            }
            const _t5008 = _t5010;
            const _t5006 = _t5008;
            const _t5004 = _t5006;
            _t5001 = _t5004;
            break _t5002;
          }
          _match_fail("line 16933");
        }
        _t4998 = _t5001;
        break _t4999;
      }
      _match_fail("line 16933");
    }
    let _t5013;
    const _t5012 = _t4998;
    _t5014: {
      if (true) {
        const class_opt = _t5012[0];
        const method_name = _t5012[1];
        let _t5016;
        const _t5015 = class_opt;
        _t5017: {
          if (_t5015._tag === 1) {
            const class_def = _t5015._val;
            if (!_eq(class_def.class_fundeps, null)) {
              const method_schema_ty_5018 = List$assoc(method_name, class_def.class_methods);
              const num_params_5020 = List$length(class_def.class_params);
              const found_5022 = Hashtbl$create(num_params_5020);
              function go(s, r) {
                while (true) {
                  const r_5024 = Types$repr(r);
                  let _t5027;
                  const _t5026 = [s, r_5024];
                  _t5028: {
                    if (_t5026[0]._tag === 16) {
                      const i = _t5026[0]._val;
                      if ((i < num_params_5020)) {
                        let _t5029;
                        if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, found_5022, i]))) {
                          _t5029 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_5022, i, r_5024]);
                        } else {
                          _t5029 = undefined;
                        }
                        _t5027 = _t5029;
                        break _t5028;
                      }
                    }
                    if ((_t5026[0]._tag === 7 && _t5026[1]._tag === 7 || _t5026[0]._tag === 8 && _t5026[1]._tag === 8)) {
                      const s1 = _t5026[0]._val[0];
                      const s2 = _t5026[0]._val[2];
                      const r1 = _t5026[1]._val[0];
                      const r2 = _t5026[1]._val[2];
                      go(s1, r1);
                      const _t5030 = s2;
                      const _t5031 = r2;
                      s = _t5030;
                      r = _t5031;
                      continue;
                      _t5027 = undefined;
                      break _t5028;
                    }
                    if (_t5026[0]._tag === 9 && _t5026[1]._tag === 9) {
                      const ss = _t5026[0]._val;
                      const rs = _t5026[1]._val;
                      if ((List$length(ss) === List$length(rs))) {
                        _t5027 = List$iter2(go, ss, rs);
                        break _t5028;
                      }
                    }
                    if (_t5026[0]._tag === 10 && _t5026[1]._tag === 10) {
                      const s1 = _t5026[0]._val;
                      const r1 = _t5026[1]._val;
                      const _t5032 = s1;
                      const _t5033 = r1;
                      s = _t5032;
                      r = _t5033;
                      continue;
                      _t5027 = undefined;
                      break _t5028;
                    }
                    if (_t5026[0]._tag === 13 && _t5026[1]._tag === 13) {
                      const s1 = _t5026[0]._val;
                      const r1 = _t5026[1]._val;
                      const _t5034 = s1;
                      const _t5035 = r1;
                      s = _t5034;
                      r = _t5035;
                      continue;
                      _t5027 = undefined;
                      break _t5028;
                    }
                    if (_t5026[0]._tag === 12 && _t5026[1]._tag === 12) {
                      const ss = _t5026[0]._val[1];
                      const rs = _t5026[1]._val[1];
                      if ((List$length(ss) === List$length(rs))) {
                        _t5027 = List$iter2(go, ss, rs);
                        break _t5028;
                      }
                    }
                    if (true) {
                      _t5027 = undefined;
                      break _t5028;
                    }
                    _match_fail("line 16933");
                  }
                  const _t5025 = _t5027;
                  return _t5025;
                }
              }
              go(method_schema_ty_5018, ty);
              function _t5037(i) {
                let _t5039;
                const _t5038 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_5022, i]);
                _t5040: {
                  if (_t5038._tag === 1 && _t5038._val._tag === 15 && _t5038._val._val.contents._tag === 0) {
                    _t5039 = ({_tag: 0, _name: "None"});
                    break _t5040;
                  }
                  if (_t5038._tag === 1) {
                    const t = _t5038._val;
                    _t5039 = ({_tag: 1, _name: "Some", _val: t});
                    break _t5040;
                  }
                  if (_t5038._tag === 0) {
                    _t5039 = ({_tag: 0, _name: "None"});
                    break _t5040;
                  }
                  _match_fail("line 16933");
                }
                return _t5039;
              }
              const partial_5041 = List$init(num_params_5020, _t5037);
              const improved_5043 = Types$improve_with_fundeps(instances_4920, class_def, partial_5041);
              function _t5045(i, opt) {
                let _t5047;
                const _t5046 = [opt, List$nth(partial_5041, i)];
                _t5048: {
                  if (_t5046[0]._tag === 1 && _t5046[1]._tag === 0) {
                    const resolved_ty = _t5046[0]._val;
                    let _t5050;
                    const _t5049 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_5022, i]);
                    _t5051: {
                      if (_t5049._tag === 1 && _t5049._val._tag === 15 && _t5049._val._val.contents._tag === 0) {
                        const r = _t5049._val._val;
                        _t5050 = Types$unify(({_tag: 15, _name: "TVar", _val: r}), resolved_ty);
                        break _t5051;
                      }
                      if (true) {
                        _t5050 = undefined;
                        break _t5051;
                      }
                      _match_fail("line 16933");
                    }
                    _t5047 = _t5050;
                    break _t5048;
                  }
                  if (true) {
                    _t5047 = undefined;
                    break _t5048;
                  }
                  _match_fail("line 16933");
                }
                return _t5047;
              }
              const _t5044 = List$iteri(_t5045, improved_5043);
              const _t5042 = _t5044;
              const _t5036 = _t5042;
              const _t5023 = _t5036;
              const _t5021 = _t5023;
              const _t5019 = _t5021;
              _t5016 = _t5019;
              break _t5017;
            }
          }
          if (true) {
            _t5016 = undefined;
            break _t5017;
          }
          _match_fail("line 16933");
        }
        _t5013 = _t5016;
        break _t5014;
      }
      _match_fail("line 16933");
    }
    return _t5013;
  }
  const improve_method_call_5052 = _t4996;
  function walk(locals, te) {
    let _t5055;
    const _t5054 = te.expr;
    _t5056: {
      if (_t5054._tag === 7) {
        const name = _t5054._val;
        improve_method_call_5052(name, te.ty);
        _t5055 = improve_constrained_call_local(locals, name, te.ty);
        break _t5056;
      }
      if (true) {
        _t5055 = undefined;
        break _t5056;
      }
      _match_fail("line 16933");
    }
    _t5055;
    return walk_children(locals, te);
  }
  function improve_constrained_call_local(locals, name, ty) {
    let _t5058;
    const _t5057 = List$assoc_opt(name, locals);
    _t5059: {
      if (_t5057._tag === 1) {
        const s = _t5057;
        _t5058 = s;
        break _t5059;
      }
      if (_t5057._tag === 0) {
        let _t5061;
        const _t5060 = List$assoc_opt(name, vars);
        _t5062: {
          if (_t5060._tag === 1) {
            const s = _t5060._val;
            if (!_eq(s.constraints, null)) {
              _t5061 = ({_tag: 1, _name: "Some", _val: s});
              break _t5062;
            }
          }
          if (true) {
            _t5061 = ({_tag: 0, _name: "None"});
            break _t5062;
          }
          _match_fail("line 16933");
        }
        _t5058 = _t5061;
        break _t5059;
      }
      _match_fail("line 16933");
    }
    const scheme_5063 = _t5058;
    let _t5066;
    const _t5065 = scheme_5063;
    _t5067: {
      if (_t5065._tag === 0) {
        _t5066 = undefined;
        break _t5067;
      }
      if (_t5065._tag === 1) {
        const sch = _t5065._val;
        _t5066 = improve_constrained_call_with_scheme_4994(sch, ty);
        break _t5067;
      }
      _match_fail("line 16933");
    }
    const _t5064 = _t5066;
    return _t5064;
  }
  function walk_children(locals, te) {
    let _t5069;
    const _t5068 = te.expr;
    _t5070: {
      if (((((((((_t5068._tag === 0 || _t5068._tag === 1) || _t5068._tag === 2) || _t5068._tag === 3) || _t5068._tag === 4) || _t5068._tag === 5) || _t5068._tag === 6) || _t5068._tag === 7) || _t5068._tag === 22)) {
        _t5069 = undefined;
        break _t5070;
      }
      if (_t5068._tag === 8) {
        const name = _t5068._val[0];
        const sch_opt = _t5068._val[1];
        const e1 = _t5068._val[2];
        const e2 = _t5068._val[3];
        walk(locals, e1);
        let _t5072;
        const _t5071 = sch_opt;
        _t5073: {
          if (_t5071._tag === 1) {
            const sch = _t5071._val;
            if (!_eq(sch.constraints, null)) {
              _t5072 = ({_hd: [name, sch], _tl: locals});
              break _t5073;
            }
          }
          if (true) {
            _t5072 = locals;
            break _t5073;
          }
          _match_fail("line 16933");
        }
        const locals$p_5074 = _t5072;
        const _t5075 = walk(locals$p_5074, e2);
        _t5069 = _t5075;
        break _t5070;
      }
      if (_t5068._tag === 9) {
        const name = _t5068._val[0];
        const sch_opt = _t5068._val[1];
        const e1 = _t5068._val[2];
        const e2 = _t5068._val[3];
        let _t5077;
        const _t5076 = sch_opt;
        _t5078: {
          if (_t5076._tag === 1) {
            const sch = _t5076._val;
            if (!_eq(sch.constraints, null)) {
              _t5077 = ({_hd: [name, sch], _tl: locals});
              break _t5078;
            }
          }
          if (true) {
            _t5077 = locals;
            break _t5078;
          }
          _match_fail("line 16933");
        }
        const locals$p_5079 = _t5077;
        walk(locals$p_5079, e1);
        const _t5080 = walk(locals$p_5079, e2);
        _t5069 = _t5080;
        break _t5070;
      }
      if (_t5068._tag === 25) {
        const e1 = _t5068._val[1];
        const e2 = _t5068._val[2];
        walk(locals, e1);
        _t5069 = walk(locals, e2);
        break _t5070;
      }
      if (_t5068._tag === 10) {
        const body = _t5068._val[1];
        _t5069 = walk(locals, body);
        break _t5070;
      }
      if (_t5068._tag === 11) {
        const f = _t5068._val[0];
        const a = _t5068._val[1];
        walk(locals, f);
        _t5069 = walk(locals, a);
        break _t5070;
      }
      if (_t5068._tag === 12) {
        const c = _t5068._val[0];
        const t = _t5068._val[1];
        const e = _t5068._val[2];
        walk(locals, c);
        walk(locals, t);
        _t5069 = walk(locals, e);
        break _t5070;
      }
      if (_t5068._tag === 13) {
        const l = _t5068._val[1];
        const r = _t5068._val[2];
        walk(locals, l);
        _t5069 = walk(locals, r);
        break _t5070;
      }
      if (_t5068._tag === 14) {
        const e = _t5068._val[1];
        _t5069 = walk(locals, e);
        break _t5070;
      }
      if (_t5068._tag === 15) {
        const es = _t5068._val;
        _t5069 = List$iter(_call(walk, [locals]), es);
        break _t5070;
      }
      if (_t5068._tag === 16) {
        const fs = _t5068._val;
        function _t5081(__p104) {
          let _t5083;
          const _t5082 = __p104;
          _t5084: {
            if (true) {
              const e = _t5082[1];
              _t5083 = walk(locals, e);
              break _t5084;
            }
            _match_fail("line 16933");
          }
          return _t5083;
        }
        _t5069 = List$iter(_t5081, fs);
        break _t5070;
      }
      if (_t5068._tag === 17) {
        const base = _t5068._val[0];
        const overrides = _t5068._val[1];
        walk(locals, base);
        function _t5085(__p105) {
          let _t5087;
          const _t5086 = __p105;
          _t5088: {
            if (true) {
              const e = _t5086[1];
              _t5087 = walk(locals, e);
              break _t5088;
            }
            _match_fail("line 16933");
          }
          return _t5087;
        }
        _t5069 = List$iter(_t5085, overrides);
        break _t5070;
      }
      if (_t5068._tag === 18) {
        const base = _t5068._val[0];
        const pairs = _t5068._val[1];
        walk(locals, base);
        function _t5089(__p106) {
          let _t5091;
          const _t5090 = __p106;
          _t5092: {
            if (true) {
              const i = _t5090[0];
              const v = _t5090[1];
              walk(locals, i);
              _t5091 = walk(locals, v);
              break _t5092;
            }
            _match_fail("line 16933");
          }
          return _t5091;
        }
        _t5069 = List$iter(_t5089, pairs);
        break _t5070;
      }
      if (_t5068._tag === 19) {
        const e = _t5068._val[0];
        _t5069 = walk(locals, e);
        break _t5070;
      }
      if (_t5068._tag === 20) {
        const e = _t5068._val[0];
        const i = _t5068._val[1];
        walk(locals, e);
        _t5069 = walk(locals, i);
        break _t5070;
      }
      if (_t5068._tag === 21) {
        const h = _t5068._val[0];
        const t = _t5068._val[1];
        walk(locals, h);
        _t5069 = walk(locals, t);
        break _t5070;
      }
      if (_t5068._tag === 23) {
        const arg = _t5068._val[1];
        _t5069 = Option$iter(_call(walk, [locals]), arg);
        break _t5070;
      }
      if (_t5068._tag === 24) {
        const s = _t5068._val[0];
        const arms = _t5068._val[1];
        walk(locals, s);
        function _t5093(__p107) {
          let _t5095;
          const _t5094 = __p107;
          _t5096: {
            if (true) {
              const g = _t5094[1];
              const b = _t5094[2];
              Option$iter(_call(walk, [locals]), g);
              _t5095 = walk(locals, b);
              break _t5096;
            }
            _match_fail("line 16933");
          }
          return _t5095;
        }
        _t5069 = List$iter(_t5093, arms);
        break _t5070;
      }
      if (_t5068._tag === 26) {
        const e = _t5068._val[1];
        _t5069 = walk(locals, e);
        break _t5070;
      }
      if (_t5068._tag === 27) {
        const e = _t5068._val[0];
        const v = _t5068._val[2];
        walk(locals, e);
        _t5069 = walk(locals, v);
        break _t5070;
      }
      if (_t5068._tag === 28) {
        const e1 = _t5068._val[0];
        const e2 = _t5068._val[1];
        walk(locals, e1);
        _t5069 = walk(locals, e2);
        break _t5070;
      }
      if (_t5068._tag === 38) {
        const es = _t5068._val;
        _t5069 = List$iter(_call(walk, [locals]), es);
        break _t5070;
      }
      if (_t5068._tag === 32) {
        const c = _t5068._val[0];
        const b = _t5068._val[1];
        walk(locals, c);
        _t5069 = walk(locals, b);
        break _t5070;
      }
      if (_t5068._tag === 36) {
        const e = _t5068._val;
        _t5069 = walk(locals, e);
        break _t5070;
      }
      if (_t5068._tag === 39) {
        const e = _t5068._val;
        _t5069 = walk(locals, e);
        break _t5070;
      }
      if (_t5068._tag === 33) {
        const e = _t5068._val;
        _t5069 = walk(locals, e);
        break _t5070;
      }
      if ((_t5068._tag === 34 || _t5068._tag === 35)) {
        _t5069 = undefined;
        break _t5070;
      }
      if (_t5068._tag === 29) {
        const e = _t5068._val[1];
        _t5069 = walk(locals, e);
        break _t5070;
      }
      if (_t5068._tag === 30) {
        const e = _t5068._val[0];
        const arms = _t5068._val[1];
        walk(locals, e);
        function _t5097(arm) {
          let _t5099;
          const _t5098 = arm;
          _t5100: {
            if ((((_t5098._tag === 0 || _t5098._tag === 1) || _t5098._tag === 2) || _t5098._tag === 3)) {
              const body = (((_t5098._tag === 0 || _t5098._tag === 1) || _t5098._tag === 2) ? ((_t5098._tag === 0 || _t5098._tag === 1) ? (_t5098._tag === 0 ? _t5098._val[1] : _t5098._val[3]) : _t5098._val[2]) : _t5098._val[2]);
              _t5099 = walk(locals, body);
              break _t5100;
            }
            _match_fail("line 16933");
          }
          return _t5099;
        }
        _t5069 = List$iter(_t5097, arms);
        break _t5070;
      }
      if (_t5068._tag === 31) {
        const e1 = _t5068._val[0];
        const e2 = _t5068._val[1];
        walk(locals, e1);
        _t5069 = walk(locals, e2);
        break _t5070;
      }
      if (_t5068._tag === 37) {
        const bindings = _t5068._val[0];
        const body = _t5068._val[1];
        function _t5101(__p108) {
          let _t5103;
          const _t5102 = __p108;
          _t5104: {
            if (true) {
              const e = _t5102[1];
              _t5103 = walk(locals, e);
              break _t5104;
            }
            _match_fail("line 16933");
          }
          return _t5103;
        }
        List$iter(_t5101, bindings);
        _t5069 = walk(locals, body);
        break _t5070;
      }
      _match_fail("line 16933");
    }
    return _t5069;
  }
  const _t5105 = walk(null, te);
  const _t5053 = _t5105;
  const _t4995 = _t5053;
  const _t4921 = _t4995;
  const _t4919 = _t4921;
  return _t4919;
}
function Typechecker$is_syntactic_value(expr) {
  while (true) {
    let _t5107;
    const _t5106 = expr;
    _t5108: {
      if (((((((_t5106._tag === 0 || _t5106._tag === 1) || _t5106._tag === 2) || _t5106._tag === 3) || _t5106._tag === 4) || _t5106._tag === 5) || _t5106._tag === 6)) {
        _t5107 = true;
        break _t5108;
      }
      if (_t5106._tag === 7) {
        _t5107 = true;
        break _t5108;
      }
      if (_t5106._tag === 10) {
        _t5107 = true;
        break _t5108;
      }
      if (_t5106._tag === 21) {
        _t5107 = true;
        break _t5108;
      }
      if (_t5106._tag === 24 && _t5106._val[1]._tag === 0) {
        _t5107 = true;
        break _t5108;
      }
      if (_t5106._tag === 24 && _t5106._val[1]._tag === 1) {
        const e = _t5106._val[1]._val;
        const _t5109 = e;
        expr = _t5109;
        continue;
        _t5107 = undefined;
        break _t5108;
      }
      if ((_t5106._tag === 15 || _t5106._tag === 22)) {
        const es = _t5106._val;
        _t5107 = List$forall(Typechecker$is_syntactic_value, es);
        break _t5108;
      }
      if (_t5106._tag === 16) {
        const fields = _t5106._val;
        function _t5110(__p109) {
          let _t5112;
          const _t5111 = __p109;
          _t5113: {
            if (true) {
              const e = _t5111[1];
              _t5112 = Typechecker$is_syntactic_value(e);
              break _t5113;
            }
            _match_fail("line 16933");
          }
          return _t5112;
        }
        _t5107 = List$forall(_t5110, fields);
        break _t5108;
      }
      if (_t5106._tag === 20) {
        const a = _t5106._val[0];
        const b = _t5106._val[1];
        _t5107 = (Typechecker$is_syntactic_value(a) && Typechecker$is_syntactic_value(b));
        break _t5108;
      }
      if (_t5106._tag === 46 && _t5106._val[1]._tag === 0) {
        _t5107 = true;
        break _t5108;
      }
      if (_t5106._tag === 46 && _t5106._val[1]._tag === 1) {
        const e = _t5106._val[1]._val;
        const _t5114 = e;
        expr = _t5114;
        continue;
        _t5107 = undefined;
        break _t5108;
      }
      if (((_t5106._tag === 30 || _t5106._tag === 47) || _t5106._tag === 49)) {
        const e = ((_t5106._tag === 30 || _t5106._tag === 47) ? _t5106._val[0] : _t5106._val[1]);
        const _t5115 = e;
        expr = _t5115;
        continue;
        _t5107 = undefined;
        break _t5108;
      }
      if (true) {
        _t5107 = false;
        break _t5108;
      }
      _match_fail("line 16933");
    }
    return _t5107;
  }
}
function Typechecker$mono_scheme(ty) {
  return ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: 0, record_evidences: null, rquant: 0});
}
function Typechecker$synth(ctx, level, expr) {
  while (true) {
    let _t5117;
    const _t5116 = expr;
    _t5118: {
      if (_t5116._tag === 49) {
        const loc = _t5116._val[0];
        const inner = _t5116._val[1];
        Ref$set(Typechecker$current_loc, loc);
        const _t5119 = ctx;
        const _t5120 = level;
        const _t5121 = inner;
        ctx = _t5119;
        level = _t5120;
        expr = _t5121;
        continue;
        _t5117 = undefined;
        break _t5118;
      }
      if (_t5116._tag === 0) {
        const n = _t5116._val;
        _t5117 = Typechecker$mk(({_tag: 0, _name: "TEInt", _val: n}), ({_tag: 0, _name: "TInt"}));
        break _t5118;
      }
      if (_t5116._tag === 1) {
        const f = _t5116._val;
        _t5117 = Typechecker$mk(({_tag: 1, _name: "TEFloat", _val: f}), ({_tag: 1, _name: "TFloat"}));
        break _t5118;
      }
      if (_t5116._tag === 2) {
        const b = _t5116._val;
        _t5117 = Typechecker$mk(({_tag: 2, _name: "TEBool", _val: b}), ({_tag: 2, _name: "TBool"}));
        break _t5118;
      }
      if (_t5116._tag === 3) {
        const s = _t5116._val;
        _t5117 = Typechecker$mk(({_tag: 3, _name: "TEString", _val: s}), ({_tag: 3, _name: "TString"}));
        break _t5118;
      }
      if (_t5116._tag === 4) {
        const n = _t5116._val;
        _t5117 = Typechecker$mk(({_tag: 4, _name: "TEByte", _val: n}), ({_tag: 4, _name: "TByte"}));
        break _t5118;
      }
      if (_t5116._tag === 5) {
        const n = _t5116._val;
        _t5117 = Typechecker$mk(({_tag: 5, _name: "TERune", _val: n}), ({_tag: 5, _name: "TRune"}));
        break _t5118;
      }
      if (_t5116._tag === 6) {
        _t5117 = Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}));
        break _t5118;
      }
      if (_t5116._tag === 21) {
        _t5117 = Typechecker$mk(({_tag: 22, _name: "TENil"}), ({_tag: 10, _name: "TList", _val: Types$new_tvar(level)}));
        break _t5118;
      }
      if (_t5116._tag === 7) {
        const name = _t5116._val;
        const ty_5122 = Typechecker$lookup_var(ctx, level, name);
        const resolved_name_5124 = Typechecker$resolve_module_name(ctx, name);
        const _t5125 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: resolved_name_5124}), ty_5122);
        const _t5123 = _t5125;
        _t5117 = _t5123;
        break _t5118;
      }
      if (_t5116._tag === 13) {
        const op = _t5116._val[0];
        const e1 = _t5116._val[1];
        const e2 = _t5116._val[2];
        _t5117 = Typechecker$synth_binop(ctx, level, op, e1, e2);
        break _t5118;
      }
      if (_t5116._tag === 14) {
        const op = _t5116._val[0];
        const e = _t5116._val[1];
        _t5117 = Typechecker$synth_unop(ctx, level, op, e);
        break _t5118;
      }
      if (_t5116._tag === 11) {
        const fn_ = _t5116._val[0];
        const arg = _t5116._val[1];
        const fn_te_5126 = Typechecker$synth(ctx, level, fn_);
        const arg_te_5128 = Typechecker$synth(ctx, level, arg);
        const ret_ty_5130 = Types$new_tvar(level);
        const call_eff_5132 = Types$new_effvar(level);
        Typechecker$try_unify(fn_te_5126.ty, ({_tag: 7, _name: "TArrow", _val: [arg_te_5128.ty, call_eff_5132, ret_ty_5130]}));
        Typechecker$try_subeffect(call_eff_5132, ctx.current_eff);
        const _t5133 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_te_5126, arg_te_5128]}), ret_ty_5130);
        const _t5131 = _t5133;
        const _t5129 = _t5131;
        const _t5127 = _t5129;
        _t5117 = _t5127;
        break _t5118;
      }
      if (_t5116._tag === 10) {
        const param = _t5116._val[0];
        const body = _t5116._val[1];
        let _t5135;
        const _t5134 = param.annot;
        _t5136: {
          if (_t5134._tag === 1) {
            const annot = _t5134._val;
            _t5135 = Typechecker$resolve_ty_annot(ctx, level, annot);
            break _t5136;
          }
          if (_t5134._tag === 0) {
            _t5135 = Types$new_tvar(level);
            break _t5136;
          }
          _match_fail("line 16933");
        }
        const param_ty_5137 = _t5135;
        const body_eff_5139 = Types$new_effvar(level);
        const ret_ty_5141 = Types$new_tvar(level);
        let _t5143;
        if (param.is_generated) {
          const __rec_upd_5144 = ctx;
          const _t5145 = ({constraint_tvars: __rec_upd_5144.constraint_tvars, current_eff: body_eff_5139, current_module: __rec_upd_5144.current_module, inside_handler: __rec_upd_5144.inside_handler, loop_info: __rec_upd_5144.loop_info, mutable_vars: __rec_upd_5144.mutable_vars, return_type: __rec_upd_5144.return_type, return_used: __rec_upd_5144.return_used, type_env: __rec_upd_5144.type_env, vars: __rec_upd_5144.vars});
          _t5143 = _t5145;
        } else {
          const return_used_5146 = Ref$create(false);
          const __rec_upd_5148 = ctx;
          const _t5149 = ({constraint_tvars: __rec_upd_5148.constraint_tvars, current_eff: body_eff_5139, current_module: __rec_upd_5148.current_module, inside_handler: false, loop_info: __rec_upd_5148.loop_info, mutable_vars: __rec_upd_5148.mutable_vars, return_type: ({_tag: 1, _name: "Some", _val: ret_ty_5141}), return_used: return_used_5146, type_env: __rec_upd_5148.type_env, vars: __rec_upd_5148.vars});
          const _t5147 = _t5149;
          _t5143 = _t5147;
        }
        const ctx$p_5150 = _t5143;
        const ctx$p_5152 = Typechecker$extend_var_mono(ctx$p_5150, param.name, param_ty_5137);
        const body_te_5154 = Typechecker$synth(ctx$p_5152, level, body);
        Typechecker$try_unify(body_te_5154.ty, ret_ty_5141);
        let _t5156;
        if (param.is_generated) {
          _t5156 = false;
        } else {
          _t5156 = Ref$get(ctx$p_5152.return_used);
        }
        const has_return_5157 = _t5156;
        const _t5158 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param.name, body_te_5154, has_return_5157]}), ({_tag: 7, _name: "TArrow", _val: [param_ty_5137, body_eff_5139, ret_ty_5141]}));
        const _t5155 = _t5158;
        const _t5153 = _t5155;
        const _t5151 = _t5153;
        const _t5142 = _t5151;
        const _t5140 = _t5142;
        const _t5138 = _t5140;
        _t5117 = _t5138;
        break _t5118;
      }
      if (_t5116._tag === 8) {
        const name = _t5116._val[0];
        const e1 = _t5116._val[1];
        const e2 = _t5116._val[2];
        const e1_te_5159 = Typechecker$synth(ctx, (level + 1), e1);
        Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, e1_te_5159);
        let _t5161;
        if (Typechecker$is_syntactic_value(e1)) {
          _t5161 = Types$generalize(level, e1_te_5159.ty);
        } else {
          _t5161 = Typechecker$mono_scheme(e1_te_5159.ty);
        }
        const scheme_5162 = _t5161;
        const scheme_5164 = Typechecker$infer_implicit_constraints("", ctx.type_env, ctx.vars, e1_te_5159, scheme_5162);
        const scheme_5166 = Typechecker$infer_record_evidence(ctx.vars, e1_te_5159, scheme_5164);
        let _t5168;
        if (Typechecker$scheme_needs_xform(scheme_5166)) {
          _t5168 = ({_tag: 1, _name: "Some", _val: scheme_5166});
        } else {
          _t5168 = ({_tag: 0, _name: "None"});
        }
        const stored_scheme_5169 = _t5168;
        const ctx$p_5171 = Typechecker$extend_var(ctx, name, scheme_5166);
        const e2_te_5173 = Typechecker$synth(ctx$p_5171, level, e2);
        const _t5174 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [name, stored_scheme_5169, e1_te_5159, e2_te_5173]}), e2_te_5173.ty);
        const _t5172 = _t5174;
        const _t5170 = _t5172;
        const _t5167 = _t5170;
        const _t5165 = _t5167;
        const _t5163 = _t5165;
        const _t5160 = _t5163;
        _t5117 = _t5160;
        break _t5118;
      }
      if (_t5116._tag === 26) {
        const name = _t5116._val[0];
        const e1 = _t5116._val[1];
        const e2 = _t5116._val[2];
        const e1_te_5175 = Typechecker$synth(ctx, (level + 1), e1);
        const scheme_5177 = ({body: e1_te_5175.ty, constraints: null, equant: 0, pvquant: 0, quant: 0, record_evidences: null, rquant: 0});
        const ctx$p_5179 = Typechecker$extend_var_mutable(ctx, name, scheme_5177);
        const e2_te_5181 = Typechecker$synth(ctx$p_5179, level, e2);
        const _t5182 = Typechecker$mk(({_tag: 25, _name: "TELetMut", _val: [name, e1_te_5175, e2_te_5181]}), e2_te_5181.ty);
        const _t5180 = _t5182;
        const _t5178 = _t5180;
        const _t5176 = _t5178;
        _t5117 = _t5176;
        break _t5118;
      }
      if (_t5116._tag === 27) {
        const name = _t5116._val[0];
        const e = _t5116._val[1];
        let _t5183;
        if ((!List$mem(name, ctx.mutable_vars))) {
          _t5183 = Typechecker$error((("variable " + __dict_Show_string.show(name)) + " is not mutable"));
        } else {
          _t5183 = undefined;
        }
        _t5183;
        const var_ty_5184 = Typechecker$lookup_var(ctx, level, name);
        const e_te_5186 = Typechecker$check(ctx, level, e, var_ty_5184);
        const resolved_name_5188 = Typechecker$resolve_module_name(ctx, name);
        const _t5189 = Typechecker$mk(({_tag: 26, _name: "TEAssign", _val: [resolved_name_5188, e_te_5186]}), ({_tag: 6, _name: "TUnit"}));
        const _t5187 = _t5189;
        const _t5185 = _t5187;
        _t5117 = _t5185;
        break _t5118;
      }
      if (_t5116._tag === 28) {
        const record_expr = _t5116._val[0];
        const field = _t5116._val[1];
        const value_expr = _t5116._val[2];
        const r_te_5190 = Typechecker$synth(ctx, level, record_expr);
        const field_ty_5192 = Types$new_tvar(level);
        const row_tail_5194 = Types$new_rvar(level);
        let _t5197;
        const _t5196 = Types$repr(r_te_5190.ty);
        _t5198: {
          if (_t5196._tag === 15) {
            function _t5199(__p110) {
              let _t5201;
              const _t5200 = __p110;
              _t5202: {
                if (true) {
                  const _name = _t5200[0];
                  const fields = _t5200[1];
                  _t5201 = List$mem_assoc(field, fields);
                  break _t5202;
                }
                _match_fail("line 16933");
              }
              return _t5201;
            }
            const candidates_5203 = List$filter(_t5199, ctx.type_env.records);
            let _t5206;
            const _t5205 = candidates_5203;
            _t5207: {
              if (_t5205 !== null && _t5205._tl === null) {
                const _name = _t5205._hd[0];
                const fields = _t5205._hd[1];
                const row_5208 = Typechecker$instantiate_record_row(level, fields);
                const _t5209 = Typechecker$try_unify(r_te_5190.ty, ({_tag: 11, _name: "TRecord", _val: row_5208}));
                _t5206 = _t5209;
                break _t5207;
              }
              if (true) {
                _t5206 = Typechecker$try_unify(r_te_5190.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_5192, row_tail_5194]})}));
                break _t5207;
              }
              _match_fail("line 16933");
            }
            const _t5204 = _t5206;
            _t5197 = _t5204;
            break _t5198;
          }
          if (true) {
            _t5197 = Typechecker$try_unify(r_te_5190.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_5192, row_tail_5194]})}));
            break _t5198;
          }
          _match_fail("line 16933");
        }
        _t5197;
        let _t5211;
        const _t5210 = Types$repr(r_te_5190.ty);
        _t5212: {
          if (_t5210._tag === 11) {
            const row = _t5210._val;
            const fields_5213 = Types$record_row_to_fields(row);
            let _t5216;
            const _t5215 = List$assoc_opt(field, fields_5213);
            _t5217: {
              if (_t5215._tag === 1) {
                const ty = _t5215._val;
                _t5216 = ty;
                break _t5217;
              }
              if (_t5215._tag === 0) {
                _t5216 = Typechecker$error(("record has no field " + __dict_Show_string.show(field)));
                break _t5217;
              }
              _match_fail("line 16933");
            }
            const _t5214 = _t5216;
            _t5211 = _t5214;
            break _t5212;
          }
          if (true) {
            _t5211 = Typechecker$error("field assignment on non-record type");
            break _t5212;
          }
          _match_fail("line 16933");
        }
        const actual_field_ty_5218 = _t5211;
        let _t5220;
        if ((!List$mem(field, ctx.type_env.mutable_fields))) {
          _t5220 = Typechecker$error((("field " + __dict_Show_string.show(field)) + " is not mutable"));
        } else {
          _t5220 = undefined;
        }
        _t5220;
        const v_te_5221 = Typechecker$check(ctx, level, value_expr, actual_field_ty_5218);
        const _t5222 = Typechecker$mk(({_tag: 27, _name: "TEFieldAssign", _val: [r_te_5190, field, v_te_5221]}), ({_tag: 6, _name: "TUnit"}));
        const _t5219 = _t5222;
        const _t5195 = _t5219;
        const _t5193 = _t5195;
        const _t5191 = _t5193;
        _t5117 = _t5191;
        break _t5118;
      }
      if (_t5116._tag === 9) {
        const name = _t5116._val[0];
        const type_params = _t5116._val[1];
        const e1 = _t5116._val[2];
        const e2 = _t5116._val[3];
        let _t5224;
        const _t5223 = Typechecker$strip_loc(e1);
        _t5225: {
          if ((_t5223._tag === 10 || _t5223._tag === 30 && _t5223._val[0]._tag === 10)) {
            let _t5226;
            if (!_eq(type_params, null)) {
              let _t5228;
              const _t5227 = Typechecker$extract_fn_info(e1);
              _t5229: {
                if (true) {
                  const params = _t5227[0];
                  const ret_annot = _t5227[1];
                  const body = _t5227[2];
                  let _t5231;
                  const _t5230 = Typechecker$synth_poly_rec_fn(ctx, level, name, "", type_params, params, ret_annot, body);
                  _t5232: {
                    if (true) {
                      const e1_te = _t5230[0];
                      const scheme = _t5230[1];
                      const ctx$p_5233 = Typechecker$extend_var(ctx, name, scheme);
                      const e2_te_5235 = Typechecker$synth(ctx$p_5233, level, e2);
                      const _t5236 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 0, _name: "None"}), e1_te, e2_te_5235]}), e2_te_5235.ty);
                      const _t5234 = _t5236;
                      _t5231 = _t5234;
                      break _t5232;
                    }
                    _match_fail("line 16933");
                  }
                  _t5228 = _t5231;
                  break _t5229;
                }
                _match_fail("line 16933");
              }
              _t5226 = _t5228;
            } else {
              const fn_var_5237 = Types$new_tvar((level + 1));
              const ctx$p_5239 = Typechecker$extend_var_mono(ctx, name, fn_var_5237);
              const e1_te_5241 = Typechecker$synth(ctx$p_5239, (level + 1), e1);
              Typechecker$try_unify(fn_var_5237, e1_te_5241.ty);
              Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, e1_te_5241);
              const scheme_5243 = Types$generalize(level, e1_te_5241.ty);
              const scheme_5245 = Typechecker$infer_implicit_constraints(name, ctx.type_env, ctx.vars, e1_te_5241, scheme_5243);
              const scheme_5247 = Typechecker$infer_record_evidence(ctx.vars, e1_te_5241, scheme_5245);
              let _t5249;
              if (Typechecker$scheme_needs_xform(scheme_5247)) {
                _t5249 = ({_tag: 1, _name: "Some", _val: scheme_5247});
              } else {
                _t5249 = ({_tag: 0, _name: "None"});
              }
              const stored_scheme_5250 = _t5249;
              const ctx$p$p_5252 = Typechecker$extend_var(ctx, name, scheme_5247);
              const e2_te_5254 = Typechecker$synth(ctx$p$p_5252, level, e2);
              const _t5255 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, stored_scheme_5250, e1_te_5241, e2_te_5254]}), e2_te_5254.ty);
              const _t5253 = _t5255;
              const _t5251 = _t5253;
              const _t5248 = _t5251;
              const _t5246 = _t5248;
              const _t5244 = _t5246;
              const _t5242 = _t5244;
              const _t5240 = _t5242;
              const _t5238 = _t5240;
              _t5226 = _t5238;
            }
            _t5224 = _t5226;
            break _t5225;
          }
          if (true) {
            if ((Typechecker$is_constructive(e1) && (!Typechecker$is_immediately_linked(name, e1)))) {
              let _t5256;
              if (!_eq(type_params, null)) {
                _t5256 = Typechecker$error("recursive value binding does not support polymorphic type parameters");
              } else {
                _t5256 = undefined;
              }
              _t5256;
              const val_var_5257 = Types$new_tvar((level + 1));
              const ctx$p_5259 = Typechecker$extend_var_mono(ctx, name, val_var_5257);
              const e1_te_5261 = Typechecker$synth(ctx$p_5259, (level + 1), e1);
              Typechecker$try_unify(val_var_5257, e1_te_5261.ty);
              const scheme_5263 = Types$generalize(level, e1_te_5261.ty);
              const ctx$p$p_5265 = Typechecker$extend_var(ctx, name, scheme_5263);
              const e2_te_5267 = Typechecker$synth(ctx$p$p_5265, level, e2);
              const _t5268 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 0, _name: "None"}), e1_te_5261, e2_te_5267]}), e2_te_5267.ty);
              const _t5266 = _t5268;
              const _t5264 = _t5266;
              const _t5262 = _t5264;
              const _t5260 = _t5262;
              const _t5258 = _t5260;
              _t5224 = _t5258;
              break _t5225;
            }
          }
          if (true) {
            _t5224 = Typechecker$error("let rec binding must be a function or constructive expression");
            break _t5225;
          }
          _match_fail("line 16933");
        }
        _t5117 = _t5224;
        break _t5118;
      }
      if (_t5116._tag === 12) {
        const cond = _t5116._val[0];
        const then_e = _t5116._val[1];
        const else_e = _t5116._val[2];
        const cond_te_5269 = Typechecker$check(ctx, level, cond, ({_tag: 2, _name: "TBool"}));
        const then_te_5271 = Typechecker$synth(ctx, level, then_e);
        const else_te_5273 = Typechecker$check(ctx, level, else_e, then_te_5271.ty);
        const _t5274 = Typechecker$mk(({_tag: 12, _name: "TEIf", _val: [cond_te_5269, then_te_5271, else_te_5273]}), then_te_5271.ty);
        const _t5272 = _t5274;
        const _t5270 = _t5272;
        _t5117 = _t5270;
        break _t5118;
      }
      if (_t5116._tag === 15) {
        const exprs = _t5116._val;
        const tes_5275 = List$map(_call(Typechecker$synth, [ctx, level]), exprs);
        function _t5277(te) {
          return te.ty;
        }
        const tys_5278 = List$map(_t5277, tes_5275);
        const _t5279 = Typechecker$mk(({_tag: 15, _name: "TETuple", _val: tes_5275}), ({_tag: 9, _name: "TTuple", _val: tys_5278}));
        const _t5276 = _t5279;
        _t5117 = _t5276;
        break _t5118;
      }
      if (_t5116._tag === 16) {
        const fields = _t5116._val;
        function _t5280(__p111) {
          let _t5282;
          const _t5281 = __p111;
          _t5283: {
            if (true) {
              const n = _t5281[0];
              const e = _t5281[1];
              const te_5284 = Typechecker$synth(ctx, level, e);
              const _t5285 = [n, te_5284];
              _t5282 = _t5285;
              break _t5283;
            }
            _match_fail("line 16933");
          }
          return _t5282;
        }
        const typed_fields_5286 = List$map(_t5280, fields);
        function _t5288(__p112) {
          let _t5290;
          const _t5289 = __p112;
          _t5291: {
            if (true) {
              const n = _t5289[0];
              const te = _t5289[1];
              _t5290 = [n, te.ty];
              break _t5291;
            }
            _match_fail("line 16933");
          }
          return _t5290;
        }
        const field_tys_5292 = List$map(_t5288, typed_fields_5286);
        function _t5294(__p113, __p114) {
          let _t5296;
          const _t5295 = __p113;
          _t5297: {
            if (true) {
              const a = _t5295[0];
              let _t5299;
              const _t5298 = __p114;
              _t5300: {
                if (true) {
                  const b = _t5298[0];
                  _t5299 = String$compare(a, b);
                  break _t5300;
                }
                _match_fail("line 16933");
              }
              _t5296 = _t5299;
              break _t5297;
            }
            _match_fail("line 16933");
          }
          return _t5296;
        }
        const field_tys_5301 = List$sort(_t5294, field_tys_5292);
        const row_5303 = Types$fields_to_closed_row(field_tys_5301);
        const _t5304 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: typed_fields_5286}), ({_tag: 11, _name: "TRecord", _val: row_5303}));
        const _t5302 = _t5304;
        const _t5293 = _t5302;
        const _t5287 = _t5293;
        _t5117 = _t5287;
        break _t5118;
      }
      if (_t5116._tag === 17) {
        const base = _t5116._val[0];
        const overrides = _t5116._val[1];
        const base_te_5305 = Typechecker$synth(ctx, level, base);
        let _t5308;
        const _t5307 = Types$repr(base_te_5305.ty);
        _t5309: {
          if (_t5307._tag === 15) {
            const override_names_5310 = List$map(fst, overrides);
            function _t5312(__p115) {
              let _t5314;
              const _t5313 = __p115;
              _t5315: {
                if (true) {
                  const _name = _t5313[0];
                  const rfields = _t5313[1];
                  function _t5316(f) {
                    return List$mem_assoc(f, rfields);
                  }
                  _t5314 = List$forall(_t5316, override_names_5310);
                  break _t5315;
                }
                _match_fail("line 16933");
              }
              return _t5314;
            }
            const candidates_5317 = List$filter(_t5312, ctx.type_env.records);
            let _t5320;
            const _t5319 = candidates_5317;
            _t5321: {
              if (_t5319 !== null && _t5319._tl === null) {
                const rfields = _t5319._hd[1];
                const row_5322 = Typechecker$instantiate_record_row(level, rfields);
                const _t5323 = Typechecker$try_unify(base_te_5305.ty, ({_tag: 11, _name: "TRecord", _val: row_5322}));
                _t5320 = _t5323;
                break _t5321;
              }
              if (true) {
                const row_tail_5324 = Types$new_rvar(level);
                function _t5326(name, acc) {
                  return ({_tag: 0, _name: "RRow", _val: [name, Types$new_tvar(level), acc]});
                }
                const row_5327 = List$fold_right(_t5326, override_names_5310, row_tail_5324);
                const _t5328 = Typechecker$try_unify(base_te_5305.ty, ({_tag: 11, _name: "TRecord", _val: row_5327}));
                const _t5325 = _t5328;
                _t5320 = _t5325;
                break _t5321;
              }
              _match_fail("line 16933");
            }
            const _t5318 = _t5320;
            const _t5311 = _t5318;
            _t5308 = _t5311;
            break _t5309;
          }
          if (_t5307._tag === 11) {
            _t5308 = undefined;
            break _t5309;
          }
          if (true) {
            _t5308 = Typechecker$error("record update on non-record type");
            break _t5309;
          }
          _match_fail("line 16933");
        }
        _t5308;
        function _t5329(__p116) {
          let _t5331;
          const _t5330 = __p116;
          _t5332: {
            if (true) {
              const name = _t5330[0];
              const field_ty_5333 = Types$new_tvar(level);
              const row_tail_5335 = Types$new_rvar(level);
              Typechecker$try_unify(base_te_5305.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [name, field_ty_5333, row_tail_5335]})}));
              let _t5338;
              const _t5337 = Types$repr(base_te_5305.ty);
              _t5339: {
                if (_t5337._tag === 11) {
                  const row = _t5337._val;
                  const fields_5340 = Types$record_row_to_fields(row);
                  let _t5343;
                  const _t5342 = List$assoc_opt(name, fields_5340);
                  _t5344: {
                    if (_t5342._tag === 1) {
                      const ty = _t5342._val;
                      _t5343 = ty;
                      break _t5344;
                    }
                    if (_t5342._tag === 0) {
                      _t5343 = field_ty_5333;
                      break _t5344;
                    }
                    _match_fail("line 16933");
                  }
                  const _t5341 = _t5343;
                  _t5338 = _t5341;
                  break _t5339;
                }
                if (true) {
                  _t5338 = field_ty_5333;
                  break _t5339;
                }
                _match_fail("line 16933");
              }
              const actual_ty_5345 = _t5338;
              const _t5346 = [name, actual_ty_5345];
              const _t5336 = _t5346;
              const _t5334 = _t5336;
              _t5331 = _t5334;
              break _t5332;
            }
            _match_fail("line 16933");
          }
          return _t5331;
        }
        const override_field_tys_5347 = List$map(_t5329, overrides);
        function _t5349(__p117, __p118) {
          let _t5351;
          const _t5350 = __p117;
          _t5352: {
            if (true) {
              const name = _t5350[0];
              const e = _t5350[1];
              let _t5354;
              const _t5353 = __p118;
              _t5355: {
                if (true) {
                  const expected_ty = _t5353[1];
                  const te_5356 = Typechecker$check(ctx, level, e, expected_ty);
                  const _t5357 = [name, te_5356];
                  _t5354 = _t5357;
                  break _t5355;
                }
                _match_fail("line 16933");
              }
              _t5351 = _t5354;
              break _t5352;
            }
            _match_fail("line 16933");
          }
          return _t5351;
        }
        const typed_overrides_5358 = List$map2(_t5349, overrides, override_field_tys_5347);
        function has_open_tail(row) {
          while (true) {
            let _t5361;
            const _t5360 = Types$rrow_repr(row);
            _t5362: {
              if (_t5360._tag === 0) {
                const tail = _t5360._val[2];
                const _t5363 = tail;
                row = _t5363;
                continue;
                _t5361 = undefined;
                break _t5362;
              }
              if (_t5360._tag === 1 && _t5360._val.contents._tag === 0) {
                _t5361 = true;
                break _t5362;
              }
              if (true) {
                _t5361 = false;
                break _t5362;
              }
              _match_fail("line 16933");
            }
            return _t5361;
          }
        }
        let _t5366;
        const _t5365 = Types$repr(base_te_5305.ty);
        _t5367: {
          if (_t5365._tag === 11) {
            const row = _t5365._val;
            _t5366 = has_open_tail(row);
            break _t5367;
          }
          if (true) {
            _t5366 = false;
            break _t5367;
          }
          _match_fail("line 16933");
        }
        const is_open_5368 = _t5366;
        let _t5370;
        if (is_open_5368) {
          _t5370 = Typechecker$mk(({_tag: 17, _name: "TERecordUpdate", _val: [base_te_5305, typed_overrides_5358]}), base_te_5305.ty);
        } else {
          let _t5372;
          const _t5371 = Types$repr(base_te_5305.ty);
          _t5373: {
            if (_t5371._tag === 11) {
              const row = _t5371._val;
              _t5372 = Types$record_row_to_fields(row);
              break _t5373;
            }
            if (true) {
              _t5372 = Typechecker$error("record update on non-record type");
              break _t5373;
            }
            _match_fail("line 16933");
          }
          const field_tys_5374 = _t5372;
          const tmp_5376 = "__rec_upd";
          const tmp_ty_5378 = base_te_5305.ty;
          function _t5380(__p119) {
            let _t5382;
            const _t5381 = __p119;
            _t5383: {
              if (true) {
                const name = _t5381[0];
                const ty = _t5381[1];
                let _t5385;
                const _t5384 = List$assoc_opt(name, typed_overrides_5358);
                _t5386: {
                  if (_t5384._tag === 1) {
                    const te = _t5384._val;
                    _t5385 = [name, te];
                    break _t5386;
                  }
                  if (_t5384._tag === 0) {
                    _t5385 = [name, Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: tmp_5376}), tmp_ty_5378), name]}), ty)];
                    break _t5386;
                  }
                  _match_fail("line 16933");
                }
                _t5382 = _t5385;
                break _t5383;
              }
              _match_fail("line 16933");
            }
            return _t5382;
          }
          const all_fields_5387 = List$map(_t5380, field_tys_5374);
          const record_row_5389 = Types$fields_to_closed_row(field_tys_5374);
          const record_expr_5391 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: all_fields_5387}), ({_tag: 11, _name: "TRecord", _val: record_row_5389}));
          const _t5392 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [tmp_5376, ({_tag: 0, _name: "None"}), base_te_5305, record_expr_5391]}), ({_tag: 11, _name: "TRecord", _val: record_row_5389}));
          const _t5390 = _t5392;
          const _t5388 = _t5390;
          const _t5379 = _t5388;
          const _t5377 = _t5379;
          const _t5375 = _t5377;
          _t5370 = _t5375;
        }
        const _t5369 = _t5370;
        const _t5364 = _t5369;
        const _t5359 = _t5364;
        const _t5348 = _t5359;
        const _t5306 = _t5348;
        _t5117 = _t5306;
        break _t5118;
      }
      if (_t5116._tag === 18) {
        const e = _t5116._val[0];
        const field = _t5116._val[1];
        const te_5393 = Typechecker$synth(ctx, level, e);
        const field_ty_5395 = Types$new_tvar(level);
        const row_tail_5397 = Types$new_rvar(level);
        let _t5400;
        const _t5399 = Types$repr(te_5393.ty);
        _t5401: {
          if (_t5399._tag === 15) {
            function _t5402(__p120) {
              let _t5404;
              const _t5403 = __p120;
              _t5405: {
                if (true) {
                  const _name = _t5403[0];
                  const fields = _t5403[1];
                  _t5404 = List$mem_assoc(field, fields);
                  break _t5405;
                }
                _match_fail("line 16933");
              }
              return _t5404;
            }
            const candidates_5406 = List$filter(_t5402, ctx.type_env.records);
            let _t5409;
            const _t5408 = candidates_5406;
            _t5410: {
              if (_t5408 !== null && _t5408._tl === null) {
                const _name = _t5408._hd[0];
                const fields = _t5408._hd[1];
                const row_5411 = Typechecker$instantiate_record_row(level, fields);
                const _t5412 = Typechecker$try_unify(te_5393.ty, ({_tag: 11, _name: "TRecord", _val: row_5411}));
                _t5409 = _t5412;
                break _t5410;
              }
              if (true) {
                _t5409 = Typechecker$try_unify(te_5393.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_5395, row_tail_5397]})}));
                break _t5410;
              }
              _match_fail("line 16933");
            }
            const _t5407 = _t5409;
            _t5400 = _t5407;
            break _t5401;
          }
          if (true) {
            _t5400 = Typechecker$try_unify(te_5393.ty, ({_tag: 11, _name: "TRecord", _val: ({_tag: 0, _name: "RRow", _val: [field, field_ty_5395, row_tail_5397]})}));
            break _t5401;
          }
          _match_fail("line 16933");
        }
        _t5400;
        let _t5414;
        const _t5413 = Types$repr(te_5393.ty);
        _t5415: {
          if (_t5413._tag === 11) {
            const row = _t5413._val;
            const fields_5416 = Types$record_row_to_fields(row);
            let _t5419;
            const _t5418 = List$assoc_opt(field, fields_5416);
            _t5420: {
              if (_t5418._tag === 1) {
                const ty = _t5418._val;
                _t5419 = ty;
                break _t5420;
              }
              if (_t5418._tag === 0) {
                _t5419 = field_ty_5395;
                break _t5420;
              }
              _match_fail("line 16933");
            }
            const _t5417 = _t5419;
            _t5414 = _t5417;
            break _t5415;
          }
          if (true) {
            _t5414 = field_ty_5395;
            break _t5415;
          }
          _match_fail("line 16933");
        }
        const actual_field_ty_5421 = _t5414;
        const _t5422 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [te_5393, field]}), actual_field_ty_5421);
        const _t5398 = _t5422;
        const _t5396 = _t5398;
        const _t5394 = _t5396;
        _t5117 = _t5394;
        break _t5118;
      }
      if (_t5116._tag === 19) {
        const base = _t5116._val[0];
        const idx = _t5116._val[1];
        const te_base_5423 = Typechecker$synth(ctx, level, base);
        let _t5426;
        const _t5425 = Types$repr(te_base_5423.ty);
        _t5427: {
          if (_t5425._tag === 3) {
            const te_idx_5428 = Typechecker$check(ctx, level, idx, ({_tag: 0, _name: "TInt"}));
            const _t5429 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [te_base_5423, te_idx_5428]}), ({_tag: 4, _name: "TByte"}));
            _t5426 = _t5429;
            break _t5427;
          }
          if (_t5425._tag === 13) {
            const t = _t5425._val;
            const te_idx_5430 = Typechecker$check(ctx, level, idx, ({_tag: 0, _name: "TInt"}));
            const _t5431 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [te_base_5423, te_idx_5430]}), t);
            _t5426 = _t5431;
            break _t5427;
          }
          if (true) {
            const te_5432 = Typechecker$synth(ctx, level, ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "at"}), idx]}), base]}));
            function _t5434(c) {
              return (c.class_name === "Index");
            }
            let _t5436;
            const _t5435 = List$find(_t5434, ctx.type_env.classes);
            _t5437: {
              if (_t5435._tag === 1) {
                const class_def = _t5435._val;
                if (!_eq(class_def.class_fundeps, null)) {
                  const container_ty_5438 = Types$repr(te_base_5423.ty);
                  const partial_5440 = ({_hd: ({_tag: 1, _name: "Some", _val: container_ty_5438}), _tl: ({_hd: ({_tag: 0, _name: "None"}), _tl: ({_hd: ({_tag: 0, _name: "None"}), _tl: null})})});
                  const improved_5442 = Types$improve_with_fundeps(ctx.type_env.instances, class_def, partial_5440);
                  let _t5445;
                  const _t5444 = List$nth_opt(improved_5442, 2);
                  _t5446: {
                    if (_t5444._tag === 1 && _t5444._val._tag === 1) {
                      const val_ty = _t5444._val._val;
                      _t5445 = Typechecker$try_unify(te_5432.ty, val_ty);
                      break _t5446;
                    }
                    if (true) {
                      _t5445 = undefined;
                      break _t5446;
                    }
                    _match_fail("line 16933");
                  }
                  const _t5443 = _t5445;
                  const _t5441 = _t5443;
                  const _t5439 = _t5441;
                  _t5436 = _t5439;
                  break _t5437;
                }
              }
              if (true) {
                _t5436 = undefined;
                break _t5437;
              }
              _match_fail("line 16933");
            }
            _t5436;
            const _t5433 = te_5432;
            _t5426 = _t5433;
            break _t5427;
          }
          _match_fail("line 16933");
        }
        const _t5424 = _t5426;
        _t5117 = _t5424;
        break _t5118;
      }
      if (_t5116._tag === 20) {
        const hd = _t5116._val[0];
        const tl = _t5116._val[1];
        const hd_te_5447 = Typechecker$synth(ctx, level, hd);
        const list_ty_5449 = ({_tag: 10, _name: "TList", _val: hd_te_5447.ty});
        const tl_te_5451 = Typechecker$check(ctx, level, tl, list_ty_5449);
        const _t5452 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [hd_te_5447, tl_te_5451]}), list_ty_5449);
        const _t5450 = _t5452;
        const _t5448 = _t5450;
        _t5117 = _t5448;
        break _t5118;
      }
      if (_t5116._tag === 22 && _t5116._val !== null) {
        const first = _t5116._val._hd;
        const rest = _t5116._val._tl;
        const first_te_5453 = Typechecker$synth(ctx, level, first);
        function _t5455(e) {
          return Typechecker$check(ctx, level, e, first_te_5453.ty);
        }
        const rest_tes_5456 = List$map(_t5455, rest);
        const list_ty_5458 = ({_tag: 10, _name: "TList", _val: first_te_5453.ty});
        function _t5460(te, acc) {
          return Typechecker$mk(({_tag: 21, _name: "TECons", _val: [te, acc]}), list_ty_5458);
        }
        const _t5459 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [first_te_5453, List$fold_right(_t5460, rest_tes_5456, Typechecker$mk(({_tag: 22, _name: "TENil"}), list_ty_5458))]}), list_ty_5458);
        const _t5457 = _t5459;
        const _t5454 = _t5457;
        _t5117 = _t5454;
        break _t5118;
      }
      if (_t5116._tag === 22 && _t5116._val === null) {
        _t5117 = Typechecker$mk(({_tag: 22, _name: "TENil"}), ({_tag: 10, _name: "TList", _val: Types$new_tvar(level)}));
        break _t5118;
      }
      if (_t5116._tag === 23 && _t5116._val !== null) {
        const first = _t5116._val._hd;
        const rest = _t5116._val._tl;
        const first_te_5461 = Typechecker$synth(ctx, level, first);
        function _t5463(e) {
          return Typechecker$check(ctx, level, e, first_te_5461.ty);
        }
        const rest_tes_5464 = List$map(_t5463, rest);
        const _t5465 = Typechecker$mk(({_tag: 38, _name: "TEArray", _val: ({_hd: first_te_5461, _tl: rest_tes_5464})}), ({_tag: 13, _name: "TArray", _val: first_te_5461.ty}));
        const _t5462 = _t5465;
        _t5117 = _t5462;
        break _t5118;
      }
      if (_t5116._tag === 23 && _t5116._val === null) {
        _t5117 = Typechecker$mk(({_tag: 38, _name: "TEArray", _val: null}), ({_tag: 13, _name: "TArray", _val: Types$new_tvar(level)}));
        break _t5118;
      }
      if (_t5116._tag === 24) {
        const name = _t5116._val[0];
        const arg = _t5116._val[1];
        _t5117 = Typechecker$synth_construct(ctx, level, name, arg);
        break _t5118;
      }
      if (_t5116._tag === 25) {
        const scrut = _t5116._val[0];
        const arms = _t5116._val[1];
        const partial = _t5116._val[2];
        _t5117 = Typechecker$synth_match(({_tag: 0, _name: "None"}), ctx, level, scrut, arms, partial);
        break _t5118;
      }
      if (_t5116._tag === 29) {
        const e1 = _t5116._val[0];
        const e2 = _t5116._val[1];
        const e1_te_5466 = Typechecker$synth(ctx, level, e1);
        const e2_te_5468 = Typechecker$synth(ctx, level, e2);
        const _t5469 = Typechecker$mk(({_tag: 28, _name: "TESeq", _val: [e1_te_5466, e2_te_5468]}), e2_te_5468.ty);
        const _t5467 = _t5469;
        _t5117 = _t5467;
        break _t5118;
      }
      if (_t5116._tag === 30) {
        const e = _t5116._val[0];
        const annot = _t5116._val[1];
        const ty_5470 = Typechecker$resolve_ty_annot(ctx, level, annot);
        const te_5472 = Typechecker$check(ctx, level, e, ty_5470);
        const _t5473 = te_5472;
        const _t5471 = _t5473;
        _t5117 = _t5471;
        break _t5118;
      }
      if (_t5116._tag === 46 && _t5116._val[1]._tag === 0) {
        const tag = _t5116._val[0];
        const tail_5474 = Types$new_pvvar(level);
        const row_5476 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 0, _name: "None"}), tail_5474]});
        const _t5477 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [("`" + tag), ({_tag: 0, _name: "None"})]}), ({_tag: 14, _name: "TPolyVariant", _val: row_5476}));
        const _t5475 = _t5477;
        _t5117 = _t5475;
        break _t5118;
      }
      if (_t5116._tag === 46 && _t5116._val[1]._tag === 1) {
        const tag = _t5116._val[0];
        const arg = _t5116._val[1]._val;
        const arg_te_5478 = Typechecker$synth(ctx, level, arg);
        const tail_5480 = Types$new_pvvar(level);
        const row_5482 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 1, _name: "Some", _val: arg_te_5478.ty}), tail_5480]});
        const _t5483 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [("`" + tag), ({_tag: 1, _name: "Some", _val: arg_te_5478})]}), ({_tag: 14, _name: "TPolyVariant", _val: row_5482}));
        const _t5481 = _t5483;
        const _t5479 = _t5481;
        _t5117 = _t5479;
        break _t5118;
      }
      if (_t5116._tag === 47) {
        const inner = _t5116._val[0];
        const target_annot = _t5116._val[1];
        const inner_te_5484 = Typechecker$synth(ctx, level, inner);
        const target_ty_5486 = Typechecker$resolve_ty_annot(ctx, level, target_annot);
        Typechecker$try_unify(inner_te_5484.ty, target_ty_5486);
        const __rec_upd_5488 = inner_te_5484;
        const _t5489 = ({expr: __rec_upd_5488.expr, loc: __rec_upd_5488.loc, ty: target_ty_5486});
        const _t5487 = _t5489;
        const _t5485 = _t5487;
        _t5117 = _t5485;
        break _t5118;
      }
      if (_t5116._tag === 39) {
        const op_name = _t5116._val[0];
        const arg = _t5116._val[1];
        _t5117 = Typechecker$synth_perform(ctx, level, op_name, arg);
        break _t5118;
      }
      if (_t5116._tag === 40) {
        const body = _t5116._val[0];
        const arms = _t5116._val[1];
        _t5117 = Typechecker$synth_handle(ctx, level, body, arms);
        break _t5118;
      }
      if (_t5116._tag === 31) {
        const cond = _t5116._val[0];
        const body = _t5116._val[1];
        const __rec_upd_5490 = ctx;
        const _t5491 = ({constraint_tvars: __rec_upd_5490.constraint_tvars, current_eff: __rec_upd_5490.current_eff, current_module: __rec_upd_5490.current_module, inside_handler: __rec_upd_5490.inside_handler, loop_info: ({_tag: 1, _name: "Some", _val: ({_tag: 0, _name: "WhileLoop"})}), mutable_vars: __rec_upd_5490.mutable_vars, return_type: __rec_upd_5490.return_type, return_used: __rec_upd_5490.return_used, type_env: __rec_upd_5490.type_env, vars: __rec_upd_5490.vars});
        const ctx$p_5492 = _t5491;
        const cond_te_5494 = Typechecker$check(ctx$p_5492, level, cond, ({_tag: 2, _name: "TBool"}));
        const body_te_5496 = Typechecker$check(ctx$p_5492, level, body, ({_tag: 6, _name: "TUnit"}));
        const _t5497 = Typechecker$mk(({_tag: 32, _name: "TEWhile", _val: [cond_te_5494, body_te_5496]}), ({_tag: 6, _name: "TUnit"}));
        const _t5495 = _t5497;
        const _t5493 = _t5495;
        _t5117 = _t5493;
        break _t5118;
      }
      if (_t5116._tag === 32) {
        const var_name = _t5116._val[0];
        const coll_expr = _t5116._val[1];
        const body_expr = _t5116._val[2];
        const __rec_upd_5498 = ctx;
        const _t5499 = ({constraint_tvars: __rec_upd_5498.constraint_tvars, current_eff: __rec_upd_5498.current_eff, current_module: __rec_upd_5498.current_module, inside_handler: __rec_upd_5498.inside_handler, loop_info: ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "UnitLoop"})}), mutable_vars: __rec_upd_5498.mutable_vars, return_type: __rec_upd_5498.return_type, return_used: __rec_upd_5498.return_used, type_env: __rec_upd_5498.type_env, vars: __rec_upd_5498.vars});
        const ctx$p_5500 = _t5499;
        const desugared_5502 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "fold"}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: "_"}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: var_name}), ({_tag: 29, _name: "ESeq", _val: [body_expr, ({_tag: 6, _name: "EUnit"})]})]})]})]}), ({_tag: 6, _name: "EUnit"})]}), coll_expr]});
        const fold_te_5504 = Typechecker$synth(ctx$p_5500, level, desugared_5502);
        const _t5505 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: fold_te_5504}), ({_tag: 6, _name: "TUnit"}));
        const _t5503 = _t5505;
        const _t5501 = _t5503;
        _t5117 = _t5501;
        break _t5118;
      }
      if (_t5116._tag === 33) {
        const var_name = _t5116._val[0];
        const coll_expr = _t5116._val[1];
        const acc_name = _t5116._val[2];
        const init_expr = _t5116._val[3];
        const body_expr = _t5116._val[4];
        const __rec_upd_5506 = ctx;
        const _t5507 = ({constraint_tvars: __rec_upd_5506.constraint_tvars, current_eff: __rec_upd_5506.current_eff, current_module: __rec_upd_5506.current_module, inside_handler: __rec_upd_5506.inside_handler, loop_info: ({_tag: 1, _name: "Some", _val: ({_tag: 2, _name: "FoldLoop", _val: acc_name})}), mutable_vars: __rec_upd_5506.mutable_vars, return_type: __rec_upd_5506.return_type, return_used: __rec_upd_5506.return_used, type_env: __rec_upd_5506.type_env, vars: __rec_upd_5506.vars});
        const ctx$p_5508 = _t5507;
        const desugared_5510 = ({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "fold"}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: acc_name}), ({_tag: 10, _name: "EFun", _val: [({annot: ({_tag: 0, _name: "None"}), is_generated: true, name: var_name}), body_expr]})]})]}), init_expr]}), coll_expr]});
        const fold_te_5512 = Typechecker$synth(ctx$p_5508, level, desugared_5510);
        const _t5513 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: fold_te_5512}), fold_te_5512.ty);
        const _t5511 = _t5513;
        const _t5509 = _t5511;
        _t5117 = _t5509;
        break _t5118;
      }
      if (_t5116._tag === 35) {
        const value_opt = _t5116._val;
        let _t5515;
        const _t5514 = ctx.loop_info;
        _t5516: {
          if (_t5514._tag === 0) {
            _t5515 = Typechecker$error("break outside of loop");
            break _t5516;
          }
          if (_t5514._tag === 1 && _t5514._val._tag === 0) {
            let _t5517;
            if (!_eq(value_opt, ({_tag: 0, _name: "None"}))) {
              _t5517 = Typechecker$error("break with value only allowed in fold loops");
            } else {
              _t5517 = undefined;
            }
            _t5517;
            _t5515 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}))}), ({_tag: 6, _name: "TUnit"}));
            break _t5516;
          }
          if (_t5514._tag === 1 && _t5514._val._tag === 1) {
            let _t5518;
            if (!_eq(value_opt, ({_tag: 0, _name: "None"}))) {
              _t5518 = Typechecker$error("break with value only allowed in fold loops");
            } else {
              _t5518 = undefined;
            }
            _t5518;
            _t5515 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}))}), ({_tag: 6, _name: "TUnit"}));
            break _t5516;
          }
          if (_t5514._tag === 1 && _t5514._val._tag === 2) {
            const acc_name = _t5514._val._val;
            let _t5520;
            const _t5519 = value_opt;
            _t5521: {
              if (_t5519._tag === 1) {
                const e = _t5519._val;
                _t5520 = Typechecker$synth(ctx, level, e);
                break _t5521;
              }
              if (_t5519._tag === 0) {
                _t5520 = Typechecker$synth(ctx, level, ({_tag: 7, _name: "EVar", _val: acc_name}));
                break _t5521;
              }
              _match_fail("line 16933");
            }
            const v_te_5522 = _t5520;
            const _t5523 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: v_te_5522}), Types$new_tvar(level));
            _t5515 = _t5523;
            break _t5516;
          }
          _match_fail("line 16933");
        }
        _t5117 = _t5515;
        break _t5118;
      }
      if (_t5116._tag === 36) {
        let _t5525;
        const _t5524 = ctx.loop_info;
        _t5526: {
          if (_t5524._tag === 0) {
            _t5525 = Typechecker$error("continue outside of loop");
            break _t5526;
          }
          if (_t5524._tag === 1 && _t5524._val._tag === 0) {
            _t5525 = Typechecker$mk(({_tag: 34, _name: "TEContinueLoop"}), ({_tag: 6, _name: "TUnit"}));
            break _t5526;
          }
          if (_t5524._tag === 1 && _t5524._val._tag === 1) {
            _t5525 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$mk(({_tag: 6, _name: "TEUnit"}), ({_tag: 6, _name: "TUnit"}))}), ({_tag: 6, _name: "TUnit"}));
            break _t5526;
          }
          if (_t5524._tag === 1 && _t5524._val._tag === 2) {
            const acc_name = _t5524._val._val;
            const acc_te_5527 = Typechecker$synth(ctx, level, ({_tag: 7, _name: "EVar", _val: acc_name}));
            const _t5528 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: acc_te_5527}), Types$new_tvar(level));
            _t5525 = _t5528;
            break _t5526;
          }
          _match_fail("line 16933");
        }
        _t5117 = _t5525;
        break _t5118;
      }
      if (_t5116._tag === 37) {
        const e = _t5116._val;
        let _t5530;
        const _t5529 = ctx.return_type;
        _t5531: {
          if (_t5529._tag === 0) {
            _t5530 = Typechecker$error("return outside of function");
            break _t5531;
          }
          if (_t5529._tag === 1) {
            const ret_ty = _t5529._val;
            let _t5532;
            if (ctx.inside_handler) {
              _t5532 = Typechecker$error("Type error: return inside try/with is not supported");
            } else {
              _t5532 = undefined;
            }
            _t5532;
            Ref$set(ctx.return_used, true);
            const e_te_5533 = Typechecker$synth(ctx, level, e);
            Typechecker$try_unify(e_te_5533.ty, ret_ty);
            const _t5534 = Typechecker$mk(({_tag: 39, _name: "TEReturn", _val: e_te_5533}), Types$new_tvar(level));
            _t5530 = _t5534;
            break _t5531;
          }
          _match_fail("line 16933");
        }
        _t5117 = _t5530;
        break _t5118;
      }
      if (_t5116._tag === 34) {
        const pat = _t5116._val[0];
        const scrutinee = _t5116._val[1];
        const body = _t5116._val[2];
        const desugared_5535 = ({_tag: 31, _name: "EWhile", _val: [({_tag: 2, _name: "EBool", _val: true}), ({_tag: 25, _name: "EMatch", _val: [scrutinee, ({_hd: [pat, ({_tag: 0, _name: "None"}), body], _tl: ({_hd: [({_tag: 0, _name: "PatWild"}), ({_tag: 0, _name: "None"}), ({_tag: 35, _name: "EBreak", _val: ({_tag: 0, _name: "None"})})], _tl: null})}), false]})]});
        const _t5536 = Typechecker$synth(ctx, level, desugared_5535);
        _t5117 = _t5536;
        break _t5118;
      }
      if (_t5116._tag === 41) {
        const k_expr = _t5116._val[0];
        const v_expr = _t5116._val[1];
        const k_te_5537 = Typechecker$synth(ctx, level, k_expr);
        const v_te_5539 = Typechecker$synth(ctx, level, v_expr);
        const ret_ty_5541 = Types$new_tvar(level);
        const call_eff_5543 = Types$new_effvar(level);
        Typechecker$try_unify(k_te_5537.ty, ({_tag: 8, _name: "TCont", _val: [v_te_5539.ty, call_eff_5543, ret_ty_5541]}));
        Typechecker$try_subeffect(call_eff_5543, ctx.current_eff);
        const _t5544 = Typechecker$mk(({_tag: 31, _name: "TEResume", _val: [k_te_5537, v_te_5539]}), ret_ty_5541);
        const _t5542 = _t5544;
        const _t5540 = _t5542;
        const _t5538 = _t5540;
        _t5117 = _t5538;
        break _t5118;
      }
      if (_t5116._tag === 42) {
        const pairs = _t5116._val;
        function _t5545(__p121) {
          let _t5547;
          const _t5546 = __p121;
          _t5548: {
            if (true) {
              const k = _t5546[0];
              const v = _t5546[1];
              _t5547 = ({_tag: 15, _name: "ETuple", _val: ({_hd: k, _tl: ({_hd: v, _tl: null})})});
              break _t5548;
            }
            _match_fail("line 16933");
          }
          return _t5547;
        }
        const pair_list_5549 = ({_tag: 22, _name: "EList", _val: List$map(_t5545, pairs)});
        const desugared_5551 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "Map.of_list"}), pair_list_5549]});
        const _t5552 = Typechecker$synth(ctx, level, desugared_5551);
        const _t5550 = _t5552;
        _t5117 = _t5550;
        break _t5118;
      }
      if (_t5116._tag === 43) {
        const mod_name = _t5116._val[0];
        const pairs = _t5116._val[1];
        function _t5553(__p122) {
          let _t5555;
          const _t5554 = __p122;
          _t5556: {
            if (true) {
              const k = _t5554[0];
              const v = _t5554[1];
              _t5555 = ({_tag: 15, _name: "ETuple", _val: ({_hd: k, _tl: ({_hd: v, _tl: null})})});
              break _t5556;
            }
            _match_fail("line 16933");
          }
          return _t5555;
        }
        const pair_list_5557 = ({_tag: 22, _name: "EList", _val: List$map(_t5553, pairs)});
        const desugared_5559 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: (mod_name + ".of_list")}), pair_list_5557]});
        const _t5560 = Typechecker$synth(ctx, level, desugared_5559);
        const _t5558 = _t5560;
        _t5117 = _t5558;
        break _t5118;
      }
      if (_t5116._tag === 44) {
        const elems = _t5116._val;
        const list_expr_5561 = ({_tag: 22, _name: "EList", _val: elems});
        const desugared_5563 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "Set.of_list"}), list_expr_5561]});
        const _t5564 = Typechecker$synth(ctx, level, desugared_5563);
        const _t5562 = _t5564;
        _t5117 = _t5562;
        break _t5118;
      }
      if (_t5116._tag === 45) {
        const mod_name = _t5116._val[0];
        const elems = _t5116._val[1];
        const list_expr_5565 = ({_tag: 22, _name: "EList", _val: elems});
        const desugared_5567 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: (mod_name + ".of_list")}), list_expr_5565]});
        const _t5568 = Typechecker$synth(ctx, level, desugared_5567);
        const _t5566 = _t5568;
        _t5117 = _t5566;
        break _t5118;
      }
      if (_t5116._tag === 48) {
        const mod_name = _t5116._val[0];
        const inner_expr = _t5116._val[1];
        let _t5570;
        const _t5569 = Ref$get(Typechecker$find_module_in_env_ref, ctx.type_env, mod_name);
        _t5571: {
          if (_t5569._tag === 1) {
            const m = _t5569._val;
            _t5570 = m;
            break _t5571;
          }
          if (_t5569._tag === 0) {
            _t5570 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
            break _t5571;
          }
          _match_fail("line 16933");
        }
        const minfo_5572 = _t5570;
        function _t5574(body, __p123) {
          let _t5576;
          const _t5575 = __p123;
          _t5577: {
            if (true) {
              const _mml$short = _t5575[0];
              const _scheme = _t5575[1];
              const qualified_5578 = (mod_name + ("." + _mml$short));
              const _t5579 = ({_tag: 8, _name: "ELet", _val: [_mml$short, ({_tag: 7, _name: "EVar", _val: qualified_5578}), body]});
              _t5576 = _t5579;
              break _t5577;
            }
            _match_fail("line 16933");
          }
          return _t5576;
        }
        const desugared_5580 = List$fold(_t5574, inner_expr, minfo_5572.mod_pub_vars);
        const _t5581 = Typechecker$synth(ctx, level, desugared_5580);
        const _t5573 = _t5581;
        _t5117 = _t5573;
        break _t5118;
      }
      if (_t5116._tag === 38) {
        const bindings = _t5116._val[0];
        const body = _t5116._val[1];
        function _t5582(__p124) {
          let _t5584;
          const _t5583 = __p124;
          _t5585: {
            if (true) {
              const tp = _t5583[1];
              _t5584 = !_eq(tp, null);
              break _t5585;
            }
            _match_fail("line 16933");
          }
          return _t5584;
        }
        const has_poly_5586 = List$exists(_t5582, bindings);
        let _t5588;
        if (has_poly_5586) {
          function _t5589(__p125) {
            let _t5591;
            const _t5590 = __p125;
            _t5592: {
              if (true) {
                const name = _t5590[0];
                const type_params = _t5590[1];
                const fn_expr = _t5590[2];
                let _t5594;
                const _t5593 = Typechecker$extract_fn_info(fn_expr);
                _t5595: {
                  if (true) {
                    const params = _t5593[0];
                    const ret_annot = _t5593[1];
                    const inner_body = _t5593[2];
                    _t5594 = [name, type_params, params, ret_annot, inner_body];
                    break _t5595;
                  }
                  _match_fail("line 16933");
                }
                _t5591 = _t5594;
                break _t5592;
              }
              _match_fail("line 16933");
            }
            return _t5591;
          }
          const infos_5596 = List$map(_t5589, bindings);
          function _t5598(__p126) {
            let _t5600;
            const _t5599 = __p126;
            _t5601: {
              if (true) {
                const type_params = _t5599[1];
                const params = _t5599[2];
                const ret_annot = _t5599[3];
                const shared_tvars_5602 = Hashtbl$create(4);
                function _t5604(tp) {
                  return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_5602, tp, Types$new_tvar((level + 1))]);
                }
                List$iter(_t5604, type_params);
                function _t5605(p) {
                  let _t5607;
                  const _t5606 = p.annot;
                  _t5608: {
                    if (_t5606._tag === 1) {
                      const annot = _t5606._val;
                      _t5607 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5602, annot);
                      break _t5608;
                    }
                    if (_t5606._tag === 0) {
                      _t5607 = Types$new_tvar((level + 1));
                      break _t5608;
                    }
                    _match_fail("line 16933");
                  }
                  return _t5607;
                }
                const param_tys_5609 = List$map(_t5605, params);
                let _t5612;
                const _t5611 = ret_annot;
                _t5613: {
                  if (_t5611._tag === 1 && _t5611._val._tag === 10) {
                    const ty = _t5611._val._val[0];
                    const eff_annot = _t5611._val._val[1];
                    const ty$p_5614 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5602, ty);
                    let _t5617;
                    const _t5616 = eff_annot;
                    _t5618: {
                      if (_t5616._tag === 0) {
                        _t5617 = ({_tag: 1, _name: "EffEmpty"});
                        break _t5618;
                      }
                      if (_t5616._tag === 1) {
                        const items = _t5616._val;
                        _t5617 = Typechecker$resolve_eff_items(ctx, (level + 1), shared_tvars_5602, items);
                        break _t5618;
                      }
                      _match_fail("line 16933");
                    }
                    const eff_5619 = _t5617;
                    const _t5620 = [ty$p_5614, eff_5619];
                    const _t5615 = _t5620;
                    _t5612 = _t5615;
                    break _t5613;
                  }
                  if (_t5611._tag === 1) {
                    const annot = _t5611._val;
                    _t5612 = [Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_5602, annot), Types$new_effvar((level + 1))];
                    break _t5613;
                  }
                  if (_t5611._tag === 0) {
                    _t5612 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
                    break _t5613;
                  }
                  _match_fail("line 16933");
                }
                let _t5622;
                const _t5621 = _t5612;
                _t5623: {
                  if (true) {
                    const ret_ty = _t5621[0];
                    const body_eff = _t5621[1];
                    let _t5625;
                    const _t5624 = List$rev(param_tys_5609);
                    _t5626: {
                      if (_t5624 === null) {
                        _t5625 = ret_ty;
                        break _t5626;
                      }
                      if (_t5624 !== null) {
                        const last = _t5624._hd;
                        const rest = _t5624._tl;
                        const inner_5627 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
                        function _t5629(acc, pty) {
                          return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
                        }
                        const _t5628 = List$fold(_t5629, inner_5627, rest);
                        _t5625 = _t5628;
                        break _t5626;
                      }
                      _match_fail("line 16933");
                    }
                    const fn_ty_5630 = _t5625;
                    const _t5631 = [param_tys_5609, ret_ty, body_eff, fn_ty_5630];
                    _t5622 = _t5631;
                    break _t5623;
                  }
                  _match_fail("line 16933");
                }
                const _t5610 = _t5622;
                const _t5603 = _t5610;
                _t5600 = _t5603;
                break _t5601;
              }
              _match_fail("line 16933");
            }
            return _t5600;
          }
          const tvars_list_5632 = List$map(_t5598, infos_5596);
          function _t5634(__p127) {
            let _t5636;
            const _t5635 = __p127;
            _t5637: {
              if (true) {
                const fn_ty = _t5635[3];
                _t5636 = Types$generalize(level, fn_ty);
                break _t5637;
              }
              _match_fail("line 16933");
            }
            return _t5636;
          }
          const schemes_5638 = List$map(_t5634, tvars_list_5632);
          function _t5640(ctx, __p128, scheme) {
            let _t5642;
            const _t5641 = __p128;
            _t5643: {
              if (true) {
                const name = _t5641[0];
                _t5642 = Typechecker$extend_var(ctx, name, scheme);
                break _t5643;
              }
              _match_fail("line 16933");
            }
            return _t5642;
          }
          const ctx$p_5644 = List$fold2(_t5640, ctx, infos_5596, schemes_5638);
          function _t5646(__p129, __p130) {
            let _t5648;
            const _t5647 = __p129;
            _t5649: {
              if (true) {
                const params = _t5647[2];
                const inner_body = _t5647[4];
                let _t5651;
                const _t5650 = __p130;
                _t5652: {
                  if (true) {
                    const param_tys = _t5650[0];
                    const ret_ty = _t5650[1];
                    const body_eff = _t5650[2];
                    function _t5653(c, p, ty) {
                      return Typechecker$extend_var_mono(c, p.name, ty);
                    }
                    const __rec_upd_5654 = ctx$p_5644;
                    const _t5655 = ({constraint_tvars: __rec_upd_5654.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_5654.current_module, inside_handler: __rec_upd_5654.inside_handler, loop_info: __rec_upd_5654.loop_info, mutable_vars: __rec_upd_5654.mutable_vars, return_type: __rec_upd_5654.return_type, return_used: __rec_upd_5654.return_used, type_env: __rec_upd_5654.type_env, vars: __rec_upd_5654.vars});
                    const inner_ctx_5656 = List$fold2(_t5653, _t5655, params, param_tys);
                    const body_te_5658 = Typechecker$check(inner_ctx_5656, (level + 1), inner_body, ret_ty);
                    let _t5661;
                    const _t5660 = [List$rev(params), List$rev(param_tys)];
                    _t5662: {
                      if (_t5660[0] === null && _t5660[1] === null) {
                        _t5661 = body_te_5658;
                        break _t5662;
                      }
                      if (_t5660[0] !== null && _t5660[1] !== null) {
                        const last_p = _t5660[0]._hd;
                        const rest_ps = _t5660[0]._tl;
                        const last_pty = _t5660[1]._hd;
                        const rest_ptys = _t5660[1]._tl;
                        const inner_5663 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_5658, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_5658.ty]}));
                        function _t5665(acc, p, pty) {
                          return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
                        }
                        const _t5664 = List$fold2(_t5665, inner_5663, rest_ps, rest_ptys);
                        _t5661 = _t5664;
                        break _t5662;
                      }
                      if (true) {
                        _t5661 = failwith("assert false");
                        break _t5662;
                      }
                      _match_fail("line 16933");
                    }
                    const _t5659 = _t5661;
                    const _t5657 = _t5659;
                    _t5651 = _t5657;
                    break _t5652;
                  }
                  _match_fail("line 16933");
                }
                _t5648 = _t5651;
                break _t5649;
              }
              _match_fail("line 16933");
            }
            return _t5648;
          }
          const body_tes_5666 = List$map2(_t5646, infos_5596, tvars_list_5632);
          function _t5668(ctx, __p131, scheme) {
            let _t5670;
            const _t5669 = __p131;
            _t5671: {
              if (true) {
                const name = _t5669[0];
                _t5670 = Typechecker$extend_var(ctx, name, scheme);
                break _t5671;
              }
              _match_fail("line 16933");
            }
            return _t5670;
          }
          const ctx$p$p_5672 = List$fold2(_t5668, ctx, infos_5596, schemes_5638);
          const body_te_5674 = Typechecker$synth(ctx$p$p_5672, level, body);
          function _t5676(__p132, te) {
            let _t5678;
            const _t5677 = __p132;
            _t5679: {
              if (true) {
                const name = _t5677[0];
                _t5678 = [name, te];
                break _t5679;
              }
              _match_fail("line 16933");
            }
            return _t5678;
          }
          const typed_bindings_5680 = List$map2(_t5676, infos_5596, body_tes_5666);
          const _t5681 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [typed_bindings_5680, body_te_5674]}), body_te_5674.ty);
          const _t5675 = _t5681;
          const _t5673 = _t5675;
          const _t5667 = _t5673;
          const _t5645 = _t5667;
          const _t5639 = _t5645;
          const _t5633 = _t5639;
          const _t5597 = _t5633;
          _t5588 = _t5597;
        } else {
          function _t5682(__p133) {
            let _t5684;
            const _t5683 = __p133;
            _t5685: {
              if (true) {
                const name = _t5683[0];
                _t5684 = name;
                break _t5685;
              }
              _match_fail("line 16933");
            }
            return _t5684;
          }
          const all_names_5686 = List$map(_t5682, bindings);
          function _t5688(__p134) {
            let _t5690;
            const _t5689 = __p134;
            _t5691: {
              if (true) {
                const name = _t5689[0];
                const fn_expr = _t5689[2];
                let _t5693;
                const _t5692 = Typechecker$strip_loc(fn_expr);
                _t5694: {
                  if ((_t5692._tag === 10 || _t5692._tag === 30 && _t5692._val[0]._tag === 10)) {
                    _t5693 = undefined;
                    break _t5694;
                  }
                  if (true) {
                    if ((Typechecker$is_constructive(fn_expr) && (!Typechecker$is_immediately_linked(name, fn_expr)))) {
                      _t5693 = undefined;
                      break _t5694;
                    }
                  }
                  if (true) {
                    _t5693 = Typechecker$error((("let rec binding for '" + __dict_Show_string.show(name)) + "' must be a function or constructive expression"));
                    break _t5694;
                  }
                  _match_fail("line 16933");
                }
                _t5690 = _t5693;
                break _t5691;
              }
              _match_fail("line 16933");
            }
            return _t5690;
          }
          List$iter(_t5688, bindings);
          all_names_5686;
          undefined;
          function _t5695(__p135) {
            let _t5697;
            const _t5696 = __p135;
            _t5698: {
              if (true) {
                const name = _t5696[0];
                _t5697 = [name, Types$new_tvar((level + 1))];
                break _t5698;
              }
              _match_fail("line 16933");
            }
            return _t5697;
          }
          const fn_vars_5699 = List$map(_t5695, bindings);
          function _t5701(ctx, __p136) {
            let _t5703;
            const _t5702 = __p136;
            _t5704: {
              if (true) {
                const name = _t5702[0];
                const tv = _t5702[1];
                _t5703 = Typechecker$extend_var_mono(ctx, name, tv);
                break _t5704;
              }
              _match_fail("line 16933");
            }
            return _t5703;
          }
          const ctx$p_5705 = List$fold(_t5701, ctx, fn_vars_5699);
          function _t5707(__p137, __p138) {
            let _t5709;
            const _t5708 = __p137;
            _t5710: {
              if (true) {
                const fn_expr = _t5708[2];
                let _t5712;
                const _t5711 = __p138;
                _t5713: {
                  if (true) {
                    const tv = _t5711[1];
                    const te_5714 = Typechecker$synth(ctx$p_5705, (level + 1), fn_expr);
                    Typechecker$try_unify(tv, te_5714.ty);
                    const _t5715 = te_5714;
                    _t5712 = _t5715;
                    break _t5713;
                  }
                  _match_fail("line 16933");
                }
                _t5709 = _t5712;
                break _t5710;
              }
              _match_fail("line 16933");
            }
            return _t5709;
          }
          const body_tes_5716 = List$map2(_t5707, bindings, fn_vars_5699);
          function _t5718(ctx, __p139, __p140) {
            let _t5720;
            const _t5719 = __p139;
            _t5721: {
              if (true) {
                const name = _t5719[0];
                let _t5723;
                const _t5722 = __p140;
                _t5724: {
                  if (true) {
                    const tv = _t5722[1];
                    const scheme_5725 = Types$generalize(level, tv);
                    const _t5726 = Typechecker$extend_var(ctx, name, scheme_5725);
                    _t5723 = _t5726;
                    break _t5724;
                  }
                  _match_fail("line 16933");
                }
                _t5720 = _t5723;
                break _t5721;
              }
              _match_fail("line 16933");
            }
            return _t5720;
          }
          const ctx$p$p_5727 = List$fold2(_t5718, ctx, bindings, fn_vars_5699);
          const body_te_5729 = Typechecker$synth(ctx$p$p_5727, level, body);
          function _t5731(__p141, te) {
            let _t5733;
            const _t5732 = __p141;
            _t5734: {
              if (true) {
                const name = _t5732[0];
                _t5733 = [name, te];
                break _t5734;
              }
              _match_fail("line 16933");
            }
            return _t5733;
          }
          const typed_bindings_5735 = List$map2(_t5731, bindings, body_tes_5716);
          const _t5736 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [typed_bindings_5735, body_te_5729]}), body_te_5729.ty);
          const _t5730 = _t5736;
          const _t5728 = _t5730;
          const _t5717 = _t5728;
          const _t5706 = _t5717;
          const _t5700 = _t5706;
          const _t5687 = _t5700;
          _t5588 = _t5687;
        }
        const _t5587 = _t5588;
        _t5117 = _t5587;
        break _t5118;
      }
      _match_fail("line 16933");
    }
    return _t5117;
  }
}
function Typechecker$synth_perform(ctx, level, op_name, arg) {
  let _t5738;
  const _t5737 = Types$find_effect_op(ctx.type_env, op_name);
  _t5739: {
    if (_t5737._tag === 0) {
      _t5738 = Typechecker$error(("unknown effect operation: " + __dict_Show_string.show(op_name)));
      break _t5739;
    }
    if (_t5737._tag === 1) {
      const effect_name = _t5737._val[0];
      const op_ty = _t5737._val[1];
      function _t5740(e) {
        return (e.effect_name === effect_name);
      }
      const edef_5741 = list_find(_t5740, ctx.type_env.effects);
      function _t5743(_) {
        return Types$new_tvar(level);
      }
      const fresh_params_5744 = List$map(_t5743, edef_5741.effect_params);
      const concrete_op_ty_5746 = Typechecker$freshen_tvars(level, op_ty);
      let _t5748;
      if (_eq(fresh_params_5744, null)) {
        _t5748 = concrete_op_ty_5746;
      } else {
        _t5748 = Typechecker$subst_tgens(fresh_params_5744, concrete_op_ty_5746);
      }
      const concrete_op_ty_5749 = _t5748;
      let _t5752;
      const _t5751 = Types$repr(concrete_op_ty_5749);
      _t5753: {
        if (_t5751._tag === 7) {
          const param_ty = _t5751._val[0];
          const ret_ty = _t5751._val[2];
          const arg_te_5754 = Typechecker$check(ctx, level, arg, param_ty);
          const fresh_tail_5756 = Types$new_effvar(level);
          Typechecker$try_unify_eff(ctx.current_eff, ({_tag: 2, _name: "EffRow", _val: [effect_name, fresh_params_5744, fresh_tail_5756]}));
          const _t5757 = Typechecker$mk(({_tag: 29, _name: "TEPerform", _val: [op_name, arg_te_5754]}), ret_ty);
          const _t5755 = _t5757;
          _t5752 = _t5755;
          break _t5753;
        }
        if (true) {
          _t5752 = Typechecker$error((("effect operation " + __dict_Show_string.show(op_name)) + " must have function type"));
          break _t5753;
        }
        _match_fail("line 16933");
      }
      const _t5750 = _t5752;
      const _t5747 = _t5750;
      const _t5745 = _t5747;
      const _t5742 = _t5745;
      _t5738 = _t5742;
      break _t5739;
    }
    _match_fail("line 16933");
  }
  return _t5738;
}
function Typechecker$synth_handle(ctx, level, body, arms) {
  const body_eff_5758 = Types$new_effvar(level);
  const __rec_upd_5760 = ctx;
  const _t5761 = ({constraint_tvars: __rec_upd_5760.constraint_tvars, current_eff: body_eff_5758, current_module: __rec_upd_5760.current_module, inside_handler: true, loop_info: __rec_upd_5760.loop_info, mutable_vars: __rec_upd_5760.mutable_vars, return_type: __rec_upd_5760.return_type, return_used: __rec_upd_5760.return_used, type_env: __rec_upd_5760.type_env, vars: __rec_upd_5760.vars});
  const body_ctx_5762 = _t5761;
  const body_te_5764 = Typechecker$synth(body_ctx_5762, level, body);
  const result_ty_5766 = Types$new_tvar(level);
  function _t5768(arm) {
    let _t5770;
    const _t5769 = arm;
    _t5771: {
      if (_t5769._tag === 1) {
        const op_name = _t5769._val[0];
        let _t5773;
        const _t5772 = Types$find_effect_op(ctx.type_env, op_name);
        _t5774: {
          if (_t5772._tag === 1) {
            const effect_name = _t5772._val[0];
            _t5773 = ({_tag: 1, _name: "Some", _val: effect_name});
            break _t5774;
          }
          if (_t5772._tag === 0) {
            _t5773 = Typechecker$error(("unknown effect operation in handler: " + __dict_Show_string.show(op_name)));
            break _t5774;
          }
          _match_fail("line 16933");
        }
        _t5770 = _t5773;
        break _t5771;
      }
      if (true) {
        _t5770 = ({_tag: 0, _name: "None"});
        break _t5771;
      }
      _match_fail("line 16933");
    }
    return _t5770;
  }
  const handled_effects_5775 = List$filter_map(_t5768, arms);
  const unique_effects_5777 = List$sort_uniq(String$compare, handled_effects_5775);
  function _t5779(effect_name) {
    function _t5780(e) {
      return (e.effect_name === effect_name);
    }
    const edef_5781 = list_find(_t5780, ctx.type_env.effects);
    function _t5783(_) {
      return Types$new_tvar(level);
    }
    const fresh_params_5784 = List$map(_t5783, edef_5781.effect_params);
    const _t5785 = [effect_name, fresh_params_5784];
    const _t5782 = _t5785;
    return _t5782;
  }
  const effect_fresh_params_5786 = List$map(_t5779, unique_effects_5777);
  function _t5788(eff, __p142) {
    let _t5790;
    const _t5789 = __p142;
    _t5791: {
      if (true) {
        const effect_name = _t5789[0];
        const fresh_params = _t5789[1];
        const _t5792 = (function() {
          const _t5793 = _h;
          _h = Object.assign({}, _t5793, {
            "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
          });
          try {
            const __x_5794 = Types$rewrite_row(effect_name, fresh_params, eff);
            return __x_5794;
          } catch (_exc) {
            if (_exc && _exc._e === "unify_error") {
              const msg = _exc._v;
              return Typechecker$error(msg);
            } else { throw _exc; }
          } finally { _h = _t5793; }
        })();
        _t5790 = _t5792;
        break _t5791;
      }
      _match_fail("line 16933");
    }
    return _t5790;
  }
  const remaining_eff_5795 = List$fold(_t5788, Types$eff_repr(body_eff_5758), effect_fresh_params_5786);
  Typechecker$try_unify_eff(remaining_eff_5795, ctx.current_eff);
  function _t5797(arm) {
    let _t5799;
    const _t5798 = arm;
    _t5800: {
      if (_t5798._tag === 0) {
        const name = _t5798._val[0];
        const handler_body = _t5798._val[1];
        const ctx$p_5801 = Typechecker$extend_var_mono(ctx, name, body_te_5764.ty);
        const handler_te_5803 = Typechecker$check(ctx$p_5801, level, handler_body, result_ty_5766);
        const _t5804 = ({_tag: 0, _name: "THReturn", _val: [name, handler_te_5803]});
        const _t5802 = _t5804;
        _t5799 = _t5802;
        break _t5800;
      }
      if (_t5798._tag === 1) {
        const op_name = _t5798._val[0];
        const arg_name = _t5798._val[1];
        const k_name = _t5798._val[2];
        const handler_body = _t5798._val[3];
        let _t5806;
        const _t5805 = Types$find_effect_op(ctx.type_env, op_name);
        _t5807: {
          if (_t5805._tag === 0) {
            _t5806 = Typechecker$error(("unknown effect operation in handler: " + __dict_Show_string.show(op_name)));
            break _t5807;
          }
          if (_t5805._tag === 1) {
            const effect_name = _t5805._val[0];
            const op_ty = _t5805._val[1];
            let _t5809;
            const _t5808 = List$assoc_opt(effect_name, effect_fresh_params_5786);
            _t5810: {
              if (_t5808._tag === 1) {
                const p = _t5808._val;
                _t5809 = p;
                break _t5810;
              }
              if (_t5808._tag === 0) {
                _t5809 = null;
                break _t5810;
              }
              _match_fail("line 16933");
            }
            const fresh_params_5811 = _t5809;
            let _t5813;
            if (_eq(fresh_params_5811, null)) {
              _t5813 = op_ty;
            } else {
              _t5813 = Typechecker$subst_tgens(fresh_params_5811, op_ty);
            }
            const concrete_op_ty_5814 = _t5813;
            let _t5817;
            const _t5816 = Types$repr(concrete_op_ty_5814);
            _t5818: {
              if (_t5816._tag === 7) {
                const a = _t5816._val[0];
                const b = _t5816._val[2];
                _t5817 = [a, b];
                break _t5818;
              }
              if (true) {
                _t5817 = Typechecker$error((("effect operation " + __dict_Show_string.show(op_name)) + " must have function type"));
                break _t5818;
              }
              _match_fail("line 16933");
            }
            let _t5820;
            const _t5819 = _t5817;
            _t5821: {
              if (true) {
                const param_ty = _t5819[0];
                const ret_ty_op = _t5819[1];
                const k_ty_5822 = ({_tag: 8, _name: "TCont", _val: [ret_ty_op, ctx.current_eff, result_ty_5766]});
                const ctx$p_5824 = Typechecker$extend_var_mono(ctx, arg_name, param_ty);
                const ctx$p_5826 = Typechecker$extend_var_mono(ctx$p_5824, k_name, k_ty_5822);
                const handler_te_5828 = Typechecker$check(ctx$p_5826, level, handler_body, result_ty_5766);
                const _t5829 = ({_tag: 1, _name: "THOp", _val: [op_name, arg_name, k_name, handler_te_5828]});
                const _t5827 = _t5829;
                const _t5825 = _t5827;
                const _t5823 = _t5825;
                _t5820 = _t5823;
                break _t5821;
              }
              _match_fail("line 16933");
            }
            const _t5815 = _t5820;
            const _t5812 = _t5815;
            _t5806 = _t5812;
            break _t5807;
          }
          _match_fail("line 16933");
        }
        _t5799 = _t5806;
        break _t5800;
      }
      _match_fail("line 16933");
    }
    return _t5799;
  }
  const typed_arms_5830 = List$map(_t5797, arms);
  const _t5831 = Typechecker$mk(({_tag: 30, _name: "TEHandle", _val: [body_te_5764, typed_arms_5830]}), result_ty_5766);
  const _t5796 = _t5831;
  const _t5787 = _t5796;
  const _t5778 = _t5787;
  const _t5776 = _t5778;
  const _t5767 = _t5776;
  const _t5765 = _t5767;
  const _t5763 = _t5765;
  const _t5759 = _t5763;
  return _t5759;
}
function Typechecker$synth_binop(ctx, level, op, e1, e2) {
  let _t5833;
  const _t5832 = op;
  _t5834: {
    if ((((_t5832._tag === 0 || _t5832._tag === 1) || _t5832._tag === 2) || _t5832._tag === 3)) {
      const te1_5835 = Typechecker$synth(ctx, level, e1);
      const te2_5837 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5835.ty, te2_5837.ty);
      const resolved_5839 = Types$repr(te1_5835.ty);
      let _t5842;
      const _t5841 = resolved_5839;
      _t5843: {
        if (_t5841._tag === 1) {
          _t5842 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5835, te2_5837]}), ({_tag: 1, _name: "TFloat"}));
          break _t5843;
        }
        if (_t5841._tag === 15 && _t5841._val.contents._tag === 0) {
          const id = _t5841._val.contents._val[0];
          let _t5844;
          if (List$mem(id, ctx.constraint_tvars)) {
            _t5844 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5835, te2_5837]}), Types$repr(te1_5835.ty));
          } else {
            Typechecker$try_unify(te1_5835.ty, ({_tag: 0, _name: "TInt"}));
            _t5844 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5835, te2_5837]}), ({_tag: 0, _name: "TInt"}));
          }
          _t5842 = _t5844;
          break _t5843;
        }
        if (_t5841._tag === 0) {
          _t5842 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5835, te2_5837]}), ({_tag: 0, _name: "TInt"}));
          break _t5843;
        }
        if (true) {
          _t5842 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5835, te2_5837]}), Types$repr(te1_5835.ty));
          break _t5843;
        }
        _match_fail("line 16933");
      }
      const _t5840 = _t5842;
      const _t5838 = _t5840;
      const _t5836 = _t5838;
      _t5833 = _t5836;
      break _t5834;
    }
    if (_t5832._tag === 4) {
      const te1_5845 = Typechecker$check(ctx, level, e1, ({_tag: 0, _name: "TInt"}));
      const te2_5847 = Typechecker$check(ctx, level, e2, ({_tag: 0, _name: "TInt"}));
      const _t5848 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5845, te2_5847]}), ({_tag: 0, _name: "TInt"}));
      const _t5846 = _t5848;
      _t5833 = _t5846;
      break _t5834;
    }
    if ((((_t5832._tag === 7 || _t5832._tag === 8) || _t5832._tag === 9) || _t5832._tag === 10)) {
      const te1_5849 = Typechecker$synth(ctx, level, e1);
      const te2_5851 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5849.ty, te2_5851.ty);
      const _t5852 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5849, te2_5851]}), ({_tag: 2, _name: "TBool"}));
      const _t5850 = _t5852;
      _t5833 = _t5850;
      break _t5834;
    }
    if ((_t5832._tag === 5 || _t5832._tag === 6)) {
      const te1_5853 = Typechecker$synth(ctx, level, e1);
      const te2_5855 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5853.ty, te2_5855.ty);
      const _t5856 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5853, te2_5855]}), ({_tag: 2, _name: "TBool"}));
      const _t5854 = _t5856;
      _t5833 = _t5854;
      break _t5834;
    }
    if ((_t5832._tag === 11 || _t5832._tag === 12)) {
      const te1_5857 = Typechecker$check(ctx, level, e1, ({_tag: 2, _name: "TBool"}));
      const te2_5859 = Typechecker$check(ctx, level, e2, ({_tag: 2, _name: "TBool"}));
      const _t5860 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5857, te2_5859]}), ({_tag: 2, _name: "TBool"}));
      const _t5858 = _t5860;
      _t5833 = _t5858;
      break _t5834;
    }
    if (_t5832._tag === 13) {
      const te1_5861 = Typechecker$check(ctx, level, e1, ({_tag: 3, _name: "TString"}));
      const te2_5863 = Typechecker$check(ctx, level, e2, ({_tag: 3, _name: "TString"}));
      const _t5864 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5861, te2_5863]}), ({_tag: 3, _name: "TString"}));
      const _t5862 = _t5864;
      _t5833 = _t5862;
      break _t5834;
    }
    if (((((_t5832._tag === 14 || _t5832._tag === 15) || _t5832._tag === 16) || _t5832._tag === 17) || _t5832._tag === 18)) {
      const te1_5865 = Typechecker$synth(ctx, level, e1);
      const te2_5867 = Typechecker$synth(ctx, level, e2);
      Typechecker$try_unify(te1_5865.ty, te2_5867.ty);
      const resolved_5869 = Types$repr(te1_5865.ty);
      let _t5872;
      const _t5871 = resolved_5869;
      _t5873: {
        if (_t5871._tag === 0) {
          _t5872 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5865, te2_5867]}), ({_tag: 0, _name: "TInt"}));
          break _t5873;
        }
        if (_t5871._tag === 15 && _t5871._val.contents._tag === 0) {
          const id = _t5871._val.contents._val[0];
          let _t5874;
          if (List$mem(id, ctx.constraint_tvars)) {
            _t5874 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5865, te2_5867]}), Types$repr(te1_5865.ty));
          } else {
            Typechecker$try_unify(te1_5865.ty, ({_tag: 0, _name: "TInt"}));
            _t5874 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5865, te2_5867]}), ({_tag: 0, _name: "TInt"}));
          }
          _t5872 = _t5874;
          break _t5873;
        }
        if (true) {
          _t5872 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5865, te2_5867]}), Types$repr(te1_5865.ty));
          break _t5873;
        }
        _match_fail("line 16933");
      }
      const _t5870 = _t5872;
      const _t5868 = _t5870;
      const _t5866 = _t5868;
      _t5833 = _t5866;
      break _t5834;
    }
    if (_t5832._tag === 19) {
      const te1_5875 = Typechecker$synth(ctx, level, e1);
      const te2_5877 = Typechecker$synth(ctx, level, e2);
      const ret_ty_5879 = Types$new_tvar(level);
      const call_eff_5881 = Types$new_effvar(level);
      Typechecker$try_unify(te2_5877.ty, ({_tag: 7, _name: "TArrow", _val: [te1_5875.ty, call_eff_5881, ret_ty_5879]}));
      Typechecker$try_subeffect(call_eff_5881, ctx.current_eff);
      const _t5882 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, te1_5875, te2_5877]}), ret_ty_5879);
      const _t5880 = _t5882;
      const _t5878 = _t5880;
      const _t5876 = _t5878;
      _t5833 = _t5876;
      break _t5834;
    }
    _match_fail("line 16933");
  }
  return _t5833;
}
function Typechecker$synth_unop(ctx, level, op, e) {
  let _t5884;
  const _t5883 = op;
  _t5885: {
    if (_t5883._tag === 0) {
      const te_5886 = Typechecker$synth(ctx, level, e);
      const resolved_5888 = Types$repr(te_5886.ty);
      let _t5891;
      const _t5890 = resolved_5888;
      _t5892: {
        if (_t5890._tag === 1) {
          _t5891 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5886]}), ({_tag: 1, _name: "TFloat"}));
          break _t5892;
        }
        if (_t5890._tag === 15 && _t5890._val.contents._tag === 0) {
          const id = _t5890._val.contents._val[0];
          let _t5893;
          if (List$mem(id, ctx.constraint_tvars)) {
            _t5893 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5886]}), Types$repr(te_5886.ty));
          } else {
            Typechecker$try_unify(te_5886.ty, ({_tag: 0, _name: "TInt"}));
            _t5893 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5886]}), ({_tag: 0, _name: "TInt"}));
          }
          _t5891 = _t5893;
          break _t5892;
        }
        if (_t5890._tag === 0) {
          _t5891 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5886]}), ({_tag: 0, _name: "TInt"}));
          break _t5892;
        }
        if (true) {
          _t5891 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5886]}), te_5886.ty);
          break _t5892;
        }
        _match_fail("line 16933");
      }
      const _t5889 = _t5891;
      const _t5887 = _t5889;
      _t5884 = _t5887;
      break _t5885;
    }
    if (_t5883._tag === 1) {
      const te_5894 = Typechecker$check(ctx, level, e, ({_tag: 2, _name: "TBool"}));
      const _t5895 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5894]}), ({_tag: 2, _name: "TBool"}));
      _t5884 = _t5895;
      break _t5885;
    }
    if (_t5883._tag === 2) {
      const te_5896 = Typechecker$synth(ctx, level, e);
      const resolved_5898 = Types$repr(te_5896.ty);
      let _t5901;
      const _t5900 = resolved_5898;
      _t5902: {
        if (_t5900._tag === 0) {
          _t5901 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5896]}), ({_tag: 0, _name: "TInt"}));
          break _t5902;
        }
        if (_t5900._tag === 15 && _t5900._val.contents._tag === 0) {
          Typechecker$try_unify(te_5896.ty, ({_tag: 0, _name: "TInt"}));
          _t5901 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5896]}), ({_tag: 0, _name: "TInt"}));
          break _t5902;
        }
        if (true) {
          _t5901 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, te_5896]}), te_5896.ty);
          break _t5902;
        }
        _match_fail("line 16933");
      }
      const _t5899 = _t5901;
      const _t5897 = _t5899;
      _t5884 = _t5897;
      break _t5885;
    }
    _match_fail("line 16933");
  }
  return _t5884;
}
function Typechecker$qualify_ctor_name(type_env, name, info) {
  let _t5903;
  if (String$contains(".", name)) {
    _t5903 = name;
  } else {
    let _t5905;
    const _t5904 = String$rindex_opt(info.ctor_type_name, 46);
    _t5906: {
      if (_t5904._tag === 1) {
        const i = _t5904._val;
        const qualified_5907 = (String$sub(info.ctor_type_name, 0, (i + 1)) + name);
        let _t5909;
        if (!_eq(List$assoc_opt(qualified_5907, type_env.constructors), ({_tag: 0, _name: "None"}))) {
          _t5909 = qualified_5907;
        } else {
          _t5909 = name;
        }
        const _t5908 = _t5909;
        _t5905 = _t5908;
        break _t5906;
      }
      if (_t5904._tag === 0) {
        _t5905 = name;
        break _t5906;
      }
      _match_fail("line 16933");
    }
    _t5903 = _t5905;
  }
  return _t5903;
}
function Typechecker$qualify_pattern(type_env, pat) {
  function go(pat) {
    let _t5911;
    const _t5910 = pat;
    _t5912: {
      if (_t5910._tag === 10) {
        const name = _t5910._val[0];
        const arg = _t5910._val[1];
        let _t5914;
        const _t5913 = List$assoc_opt(name, type_env.constructors);
        _t5915: {
          if (_t5913._tag === 1) {
            const info = _t5913._val;
            _t5914 = Typechecker$qualify_ctor_name(type_env, name, info);
            break _t5915;
          }
          if (_t5913._tag === 0) {
            _t5914 = name;
            break _t5915;
          }
          _match_fail("line 16933");
        }
        const qname_5916 = _t5914;
        const _t5917 = ({_tag: 10, _name: "PatConstruct", _val: [qname_5916, Option$map(go, arg)]});
        _t5911 = _t5917;
        break _t5912;
      }
      if (_t5910._tag === 7) {
        const ps = _t5910._val;
        _t5911 = ({_tag: 7, _name: "PatTuple", _val: List$map(go, ps)});
        break _t5912;
      }
      if (_t5910._tag === 8) {
        const hd = _t5910._val[0];
        const tl = _t5910._val[1];
        _t5911 = ({_tag: 8, _name: "PatCons", _val: [go(hd), go(tl)]});
        break _t5912;
      }
      if (_t5910._tag === 13) {
        const p1 = _t5910._val[0];
        const p2 = _t5910._val[1];
        _t5911 = ({_tag: 13, _name: "PatOr", _val: [go(p1), go(p2)]});
        break _t5912;
      }
      if (_t5910._tag === 12) {
        const p = _t5910._val[0];
        const n = _t5910._val[1];
        _t5911 = ({_tag: 12, _name: "PatAs", _val: [go(p), n]});
        break _t5912;
      }
      if (_t5910._tag === 11) {
        const fields = _t5910._val;
        function _t5918(__p143) {
          let _t5920;
          const _t5919 = __p143;
          _t5921: {
            if (true) {
              const f = _t5919[0];
              const p = _t5919[1];
              _t5920 = [f, go(p)];
              break _t5921;
            }
            _match_fail("line 16933");
          }
          return _t5920;
        }
        _t5911 = ({_tag: 11, _name: "PatRecord", _val: List$map(_t5918, fields)});
        break _t5912;
      }
      if (_t5910._tag === 14) {
        const ps = _t5910._val;
        _t5911 = ({_tag: 14, _name: "PatArray", _val: List$map(go, ps)});
        break _t5912;
      }
      if (_t5910._tag === 15) {
        const kvs = _t5910._val;
        function _t5922(__p144) {
          let _t5924;
          const _t5923 = __p144;
          _t5925: {
            if (true) {
              const k = _t5923[0];
              const v = _t5923[1];
              _t5924 = [go(k), go(v)];
              break _t5925;
            }
            _match_fail("line 16933");
          }
          return _t5924;
        }
        _t5911 = ({_tag: 15, _name: "PatMap", _val: List$map(_t5922, kvs)});
        break _t5912;
      }
      if (_t5910._tag === 18) {
        const p = _t5910._val[0];
        const a = _t5910._val[1];
        _t5911 = ({_tag: 18, _name: "PatAnnot", _val: [go(p), a]});
        break _t5912;
      }
      if (true) {
        _t5911 = pat;
        break _t5912;
      }
      _match_fail("line 16933");
    }
    return _t5911;
  }
  const _t5926 = go(pat);
  return _t5926;
}
function Typechecker$synth_construct(ctx, level, name, arg) {
  let _t5928;
  const _t5927 = List$assoc_opt(name, ctx.type_env.constructors);
  _t5929: {
    if (_t5927._tag === 0) {
      _t5928 = Typechecker$error(("unknown constructor: " + __dict_Show_string.show(name)));
      break _t5929;
    }
    if (_t5927._tag === 1) {
      const info = _t5927._val;
      let _t5930;
      if (List$mem(info.ctor_type_name, ctx.type_env.hidden_ctor_types)) {
        _t5930 = Typechecker$error(("unknown constructor: " + __dict_Show_string.show(name)));
      } else {
        _t5930 = undefined;
      }
      _t5930;
      const qname_5931 = Typechecker$qualify_ctor_name(ctx.type_env, name, info);
      const num_fresh_5933 = (info.ctor_num_params + info.ctor_existentials);
      function _t5935(_) {
        return Types$new_tvar(level);
      }
      const all_fresh_5936 = List$init(num_fresh_5933, _t5935);
      function _t5938(i, _) {
        return (i < info.ctor_num_params);
      }
      const fresh_universals_5939 = List$filteri(_t5938, all_fresh_5936);
      let _t5942;
      const _t5941 = info.ctor_return_ty_params;
      _t5943: {
        if (_t5941._tag === 0) {
          _t5942 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, fresh_universals_5939]});
          break _t5943;
        }
        if (_t5941._tag === 1) {
          const params = _t5941._val;
          _t5942 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, List$map(_call(Typechecker$subst_tgens, [all_fresh_5936]), params)]});
          break _t5943;
        }
        _match_fail("line 16933");
      }
      const result_ty_5944 = _t5942;
      let _t5947;
      const _t5946 = [info.ctor_arg_ty, arg];
      _t5948: {
        if (_t5946[0]._tag === 0 && _t5946[1]._tag === 0) {
          _t5947 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [qname_5931, ({_tag: 0, _name: "None"})]}), result_ty_5944);
          break _t5948;
        }
        if (_t5946[0]._tag === 1 && _t5946[1]._tag === 1) {
          const expected_ty = _t5946[0]._val;
          const arg_expr = _t5946[1]._val;
          const concrete_ty_5949 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(all_fresh_5936, expected_ty));
          const arg_te_5951 = Typechecker$check(ctx, level, arg_expr, concrete_ty_5949);
          const _t5952 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [qname_5931, ({_tag: 1, _name: "Some", _val: arg_te_5951})]}), result_ty_5944);
          const _t5950 = _t5952;
          _t5947 = _t5950;
          break _t5948;
        }
        if (_t5946[0]._tag === 0 && _t5946[1]._tag === 1) {
          _t5947 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " takes no arguments"));
          break _t5948;
        }
        if (_t5946[0]._tag === 1 && _t5946[1]._tag === 0) {
          const expected_ty = _t5946[0]._val;
          const concrete_ty_5953 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(all_fresh_5936, expected_ty));
          const param_5955 = "__x";
          const param_var_5957 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: param_5955}), concrete_ty_5953);
          const body_5959 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [qname_5931, ({_tag: 1, _name: "Some", _val: param_var_5957})]}), result_ty_5944);
          const _t5960 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param_5955, body_5959, false]}), ({_tag: 7, _name: "TArrow", _val: [concrete_ty_5953, ({_tag: 1, _name: "EffEmpty"}), result_ty_5944]}));
          const _t5958 = _t5960;
          const _t5956 = _t5958;
          const _t5954 = _t5956;
          _t5947 = _t5954;
          break _t5948;
        }
        _match_fail("line 16933");
      }
      const _t5945 = _t5947;
      const _t5940 = _t5945;
      const _t5937 = _t5940;
      const _t5934 = _t5937;
      const _t5932 = _t5934;
      _t5928 = _t5932;
      break _t5929;
    }
    _match_fail("line 16933");
  }
  return _t5928;
}
function Typechecker$freeze_texpr(te) {
  const ft_5961 = Types$deep_repr(te.ty);
  let _t5964;
  const _t5963 = te.expr;
  _t5965: {
    if (((((((((_t5963._tag === 0 || _t5963._tag === 1) || _t5963._tag === 2) || _t5963._tag === 3) || _t5963._tag === 4) || _t5963._tag === 5) || _t5963._tag === 6) || _t5963._tag === 7) || _t5963._tag === 22)) {
      _t5964 = te.expr;
      break _t5965;
    }
    if (_t5963._tag === 8) {
      const n = _t5963._val[0];
      const s = _t5963._val[1];
      const e1 = _t5963._val[2];
      const e2 = _t5963._val[3];
      _t5964 = ({_tag: 8, _name: "TELet", _val: [n, s, Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5965;
    }
    if (_t5963._tag === 9) {
      const n = _t5963._val[0];
      const s = _t5963._val[1];
      const e1 = _t5963._val[2];
      const e2 = _t5963._val[3];
      _t5964 = ({_tag: 9, _name: "TELetRec", _val: [n, s, Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5965;
    }
    if (_t5963._tag === 10) {
      const p = _t5963._val[0];
      const body = _t5963._val[1];
      const hr = _t5963._val[2];
      _t5964 = ({_tag: 10, _name: "TEFun", _val: [p, Typechecker$freeze_texpr(body), hr]});
      break _t5965;
    }
    if (_t5963._tag === 11) {
      const f = _t5963._val[0];
      const a = _t5963._val[1];
      _t5964 = ({_tag: 11, _name: "TEApp", _val: [Typechecker$freeze_texpr(f), Typechecker$freeze_texpr(a)]});
      break _t5965;
    }
    if (_t5963._tag === 12) {
      const c = _t5963._val[0];
      const t = _t5963._val[1];
      const e = _t5963._val[2];
      _t5964 = ({_tag: 12, _name: "TEIf", _val: [Typechecker$freeze_texpr(c), Typechecker$freeze_texpr(t), Typechecker$freeze_texpr(e)]});
      break _t5965;
    }
    if (_t5963._tag === 13) {
      const op = _t5963._val[0];
      const l = _t5963._val[1];
      const r = _t5963._val[2];
      _t5964 = ({_tag: 13, _name: "TEBinop", _val: [op, Typechecker$freeze_texpr(l), Typechecker$freeze_texpr(r)]});
      break _t5965;
    }
    if (_t5963._tag === 14) {
      const op = _t5963._val[0];
      const e = _t5963._val[1];
      _t5964 = ({_tag: 14, _name: "TEUnop", _val: [op, Typechecker$freeze_texpr(e)]});
      break _t5965;
    }
    if (_t5963._tag === 15) {
      const es = _t5963._val;
      _t5964 = ({_tag: 15, _name: "TETuple", _val: List$map(Typechecker$freeze_texpr, es)});
      break _t5965;
    }
    if (_t5963._tag === 16) {
      const fs = _t5963._val;
      function _t5966(__p145) {
        let _t5968;
        const _t5967 = __p145;
        _t5969: {
          if (true) {
            const n = _t5967[0];
            const e = _t5967[1];
            _t5968 = [n, Typechecker$freeze_texpr(e)];
            break _t5969;
          }
          _match_fail("line 16933");
        }
        return _t5968;
      }
      _t5964 = ({_tag: 16, _name: "TERecord", _val: List$map(_t5966, fs)});
      break _t5965;
    }
    if (_t5963._tag === 17) {
      const base = _t5963._val[0];
      const overrides = _t5963._val[1];
      function _t5970(__p146) {
        let _t5972;
        const _t5971 = __p146;
        _t5973: {
          if (true) {
            const n = _t5971[0];
            const e = _t5971[1];
            _t5972 = [n, Typechecker$freeze_texpr(e)];
            break _t5973;
          }
          _match_fail("line 16933");
        }
        return _t5972;
      }
      _t5964 = ({_tag: 17, _name: "TERecordUpdate", _val: [Typechecker$freeze_texpr(base), List$map(_t5970, overrides)]});
      break _t5965;
    }
    if (_t5963._tag === 18) {
      const base = _t5963._val[0];
      const pairs = _t5963._val[1];
      function _t5974(__p147) {
        let _t5976;
        const _t5975 = __p147;
        _t5977: {
          if (true) {
            const i = _t5975[0];
            const v = _t5975[1];
            _t5976 = [Typechecker$freeze_texpr(i), Typechecker$freeze_texpr(v)];
            break _t5977;
          }
          _match_fail("line 16933");
        }
        return _t5976;
      }
      _t5964 = ({_tag: 18, _name: "TERecordUpdateIdx", _val: [Typechecker$freeze_texpr(base), List$map(_t5974, pairs)]});
      break _t5965;
    }
    if (_t5963._tag === 19) {
      const e = _t5963._val[0];
      const f = _t5963._val[1];
      _t5964 = ({_tag: 19, _name: "TEField", _val: [Typechecker$freeze_texpr(e), f]});
      break _t5965;
    }
    if (_t5963._tag === 20) {
      const e = _t5963._val[0];
      const i = _t5963._val[1];
      _t5964 = ({_tag: 20, _name: "TEIndex", _val: [Typechecker$freeze_texpr(e), Typechecker$freeze_texpr(i)]});
      break _t5965;
    }
    if (_t5963._tag === 21) {
      const h = _t5963._val[0];
      const t = _t5963._val[1];
      _t5964 = ({_tag: 21, _name: "TECons", _val: [Typechecker$freeze_texpr(h), Typechecker$freeze_texpr(t)]});
      break _t5965;
    }
    if (_t5963._tag === 23) {
      const n = _t5963._val[0];
      const arg = _t5963._val[1];
      _t5964 = ({_tag: 23, _name: "TEConstruct", _val: [n, Option$map(Typechecker$freeze_texpr, arg)]});
      break _t5965;
    }
    if (_t5963._tag === 24) {
      const s = _t5963._val[0];
      const arms = _t5963._val[1];
      const p = _t5963._val[2];
      function _t5978(__p148) {
        let _t5980;
        const _t5979 = __p148;
        _t5981: {
          if (true) {
            const pat = _t5979[0];
            const g = _t5979[1];
            const b = _t5979[2];
            _t5980 = [pat, Option$map(Typechecker$freeze_texpr, g), Typechecker$freeze_texpr(b)];
            break _t5981;
          }
          _match_fail("line 16933");
        }
        return _t5980;
      }
      _t5964 = ({_tag: 24, _name: "TEMatch", _val: [Typechecker$freeze_texpr(s), List$map(_t5978, arms), p]});
      break _t5965;
    }
    if (_t5963._tag === 25) {
      const n = _t5963._val[0];
      const e1 = _t5963._val[1];
      const e2 = _t5963._val[2];
      _t5964 = ({_tag: 25, _name: "TELetMut", _val: [n, Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5965;
    }
    if (_t5963._tag === 26) {
      const n = _t5963._val[0];
      const e = _t5963._val[1];
      _t5964 = ({_tag: 26, _name: "TEAssign", _val: [n, Typechecker$freeze_texpr(e)]});
      break _t5965;
    }
    if (_t5963._tag === 27) {
      const e = _t5963._val[0];
      const f = _t5963._val[1];
      const v = _t5963._val[2];
      _t5964 = ({_tag: 27, _name: "TEFieldAssign", _val: [Typechecker$freeze_texpr(e), f, Typechecker$freeze_texpr(v)]});
      break _t5965;
    }
    if (_t5963._tag === 28) {
      const e1 = _t5963._val[0];
      const e2 = _t5963._val[1];
      _t5964 = ({_tag: 28, _name: "TESeq", _val: [Typechecker$freeze_texpr(e1), Typechecker$freeze_texpr(e2)]});
      break _t5965;
    }
    if (_t5963._tag === 29) {
      const name = _t5963._val[0];
      const e = _t5963._val[1];
      _t5964 = ({_tag: 29, _name: "TEPerform", _val: [name, Typechecker$freeze_texpr(e)]});
      break _t5965;
    }
    if (_t5963._tag === 30) {
      const e = _t5963._val[0];
      const arms = _t5963._val[1];
      function _t5982(arm) {
        let _t5984;
        const _t5983 = arm;
        _t5985: {
          if (_t5983._tag === 0) {
            const n = _t5983._val[0];
            const b = _t5983._val[1];
            _t5984 = ({_tag: 0, _name: "THReturn", _val: [n, Typechecker$freeze_texpr(b)]});
            break _t5985;
          }
          if (_t5983._tag === 1) {
            const eff = _t5983._val[0];
            const x = _t5983._val[1];
            const k = _t5983._val[2];
            const b = _t5983._val[3];
            _t5984 = ({_tag: 1, _name: "THOp", _val: [eff, x, k, Typechecker$freeze_texpr(b)]});
            break _t5985;
          }
          if (_t5983._tag === 2) {
            const eff = _t5983._val[0];
            const x = _t5983._val[1];
            const b = _t5983._val[2];
            _t5984 = ({_tag: 2, _name: "THOpProvide", _val: [eff, x, Typechecker$freeze_texpr(b)]});
            break _t5985;
          }
          if (_t5983._tag === 3) {
            const eff = _t5983._val[0];
            const x = _t5983._val[1];
            const b = _t5983._val[2];
            _t5984 = ({_tag: 3, _name: "THOpTry", _val: [eff, x, Typechecker$freeze_texpr(b)]});
            break _t5985;
          }
          _match_fail("line 16933");
        }
        return _t5984;
      }
      _t5964 = ({_tag: 30, _name: "TEHandle", _val: [Typechecker$freeze_texpr(e), List$map(_t5982, arms)]});
      break _t5965;
    }
    if (_t5963._tag === 31) {
      const k = _t5963._val[0];
      const v = _t5963._val[1];
      _t5964 = ({_tag: 31, _name: "TEResume", _val: [Typechecker$freeze_texpr(k), Typechecker$freeze_texpr(v)]});
      break _t5965;
    }
    if (_t5963._tag === 32) {
      const c = _t5963._val[0];
      const b = _t5963._val[1];
      _t5964 = ({_tag: 32, _name: "TEWhile", _val: [Typechecker$freeze_texpr(c), Typechecker$freeze_texpr(b)]});
      break _t5965;
    }
    if (_t5963._tag === 33) {
      const e = _t5963._val;
      _t5964 = ({_tag: 33, _name: "TEBreak", _val: Typechecker$freeze_texpr(e)});
      break _t5965;
    }
    if (_t5963._tag === 34) {
      _t5964 = ({_tag: 34, _name: "TEContinueLoop"});
      break _t5965;
    }
    if (_t5963._tag === 35) {
      const e = _t5963._val;
      _t5964 = ({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$freeze_texpr(e)});
      break _t5965;
    }
    if (_t5963._tag === 36) {
      const e = _t5963._val;
      _t5964 = ({_tag: 36, _name: "TEForLoop", _val: Typechecker$freeze_texpr(e)});
      break _t5965;
    }
    if (_t5963._tag === 37) {
      const binds = _t5963._val[0];
      const body = _t5963._val[1];
      function _t5986(__p149) {
        let _t5988;
        const _t5987 = __p149;
        _t5989: {
          if (true) {
            const n = _t5987[0];
            const e = _t5987[1];
            _t5988 = [n, Typechecker$freeze_texpr(e)];
            break _t5989;
          }
          _match_fail("line 16933");
        }
        return _t5988;
      }
      _t5964 = ({_tag: 37, _name: "TELetRecAnd", _val: [List$map(_t5986, binds), Typechecker$freeze_texpr(body)]});
      break _t5965;
    }
    if (_t5963._tag === 38) {
      const es = _t5963._val;
      _t5964 = ({_tag: 38, _name: "TEArray", _val: List$map(Typechecker$freeze_texpr, es)});
      break _t5965;
    }
    if (_t5963._tag === 39) {
      const e = _t5963._val;
      _t5964 = ({_tag: 39, _name: "TEReturn", _val: Typechecker$freeze_texpr(e)});
      break _t5965;
    }
    _match_fail("line 16933");
  }
  const fe_5990 = _t5964;
  const _t5991 = ({expr: fe_5990, loc: te.loc, ty: ft_5961});
  const _t5962 = _t5991;
  return _t5962;
}
function Typechecker$check_pattern_gadt(ctx, level, pat, scrut_ty) {
  let _t5993;
  const _t5992 = pat;
  _t5994: {
    if (_t5992._tag === 10) {
      const name = _t5992._val[0];
      const arg_pat = _t5992._val[1];
      let _t5996;
      const _t5995 = List$assoc_opt(name, ctx.type_env.constructors);
      _t5997: {
        if (_t5995._tag === 0) {
          _t5996 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
          break _t5997;
        }
        if (_t5995._tag === 1) {
          const info = _t5995._val;
          let _t5998;
          if (List$mem(info.ctor_type_name, ctx.type_env.hidden_ctor_types)) {
            _t5998 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
          } else {
            _t5998 = undefined;
          }
          _t5998;
          const num_fresh_5999 = (info.ctor_num_params + info.ctor_existentials);
          function _t6001(_) {
            return Types$new_tvar(level);
          }
          const all_fresh_6002 = List$init(num_fresh_5999, _t6001);
          function _t6004(i) {
            let _t6005;
            if ((i >= info.ctor_num_params)) {
              let _t6007;
              const _t6006 = List$nth(all_fresh_6002, i);
              _t6008: {
                if (_t6006._tag === 15) {
                  const r = _t6006._val;
                  _t6007 = ({_tag: 1, _name: "Some", _val: r});
                  break _t6008;
                }
                if (true) {
                  _t6007 = ({_tag: 0, _name: "None"});
                  break _t6008;
                }
                _match_fail("line 16933");
              }
              _t6005 = _t6007;
            } else {
              _t6005 = ({_tag: 0, _name: "None"});
            }
            return _t6005;
          }
          function _t6009(x) {
            return x;
          }
          const existential_refs_6010 = List$filter_map(_t6004, List$init(num_fresh_5999, _t6009));
          let _t6013;
          const _t6012 = info.ctor_return_ty_params;
          _t6014: {
            if (_t6012._tag === 1) {
              const params = _t6012._val;
              _t6013 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, List$map(_call(Typechecker$subst_tgens, [all_fresh_6002]), params)]});
              break _t6014;
            }
            if (_t6012._tag === 0) {
              function _t6015(i, _) {
                return (i < info.ctor_num_params);
              }
              const fresh_universals_6016 = List$filteri(_t6015, all_fresh_6002);
              const _t6017 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, fresh_universals_6016]});
              _t6013 = _t6017;
              break _t6014;
            }
            _match_fail("line 16933");
          }
          const return_ty_6018 = _t6013;
          Typechecker$try_unify(scrut_ty, return_ty_6018);
          let _t6021;
          const _t6020 = [info.ctor_arg_ty, arg_pat];
          _t6022: {
            if (_t6020[0]._tag === 0 && _t6020[1]._tag === 0) {
              _t6021 = null;
              break _t6022;
            }
            if (_t6020[0]._tag === 1 && _t6020[1]._tag === 1) {
              const arg_ty = _t6020[0]._val;
              const p = _t6020[1]._val;
              const concrete_ty_6023 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(all_fresh_6002, arg_ty));
              const _t6024 = Typechecker$check_pattern(ctx, level, p, concrete_ty_6023);
              _t6021 = _t6024;
              break _t6022;
            }
            if (_t6020[0]._tag === 0 && _t6020[1]._tag === 1) {
              _t6021 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " takes no arguments"));
              break _t6022;
            }
            if (_t6020[0]._tag === 1 && _t6020[1]._tag === 0) {
              _t6021 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " requires an argument"));
              break _t6022;
            }
            _match_fail("line 16933");
          }
          const bindings_6025 = _t6021;
          const _t6026 = [bindings_6025, existential_refs_6010];
          const _t6019 = _t6026;
          const _t6011 = _t6019;
          const _t6003 = _t6011;
          const _t6000 = _t6003;
          _t5996 = _t6000;
          break _t5997;
        }
        _match_fail("line 16933");
      }
      _t5993 = _t5996;
      break _t5994;
    }
    if (true) {
      _t5993 = [Typechecker$check_pattern(ctx, level, pat, scrut_ty), null];
      break _t5994;
    }
    _match_fail("line 16933");
  }
  return _t5993;
}
function Typechecker$check_existential_escape(existential_refs, result_ty) {
  function collect_tvar_refs(acc, ty) {
    while (true) {
      let _t6028;
      const _t6027 = Types$repr(ty);
      _t6029: {
        if (_t6027._tag === 15 && _t6027._val.contents._tag === 0) {
          const r = _t6027._val;
          function _t6030(x) {
            return _eq(x, r);
          }
          let _t6031;
          if (List$exists(_t6030, acc)) {
            _t6031 = acc;
          } else {
            _t6031 = ({_hd: r, _tl: acc});
          }
          _t6028 = _t6031;
          break _t6029;
        }
        if ((_t6027._tag === 7 || _t6027._tag === 8)) {
          const a = _t6027._val[0];
          const b = _t6027._val[2];
          const _t6032 = collect_tvar_refs(acc, a);
          const _t6033 = b;
          acc = _t6032;
          ty = _t6033;
          continue;
          _t6028 = undefined;
          break _t6029;
        }
        if (_t6027._tag === 9) {
          const ts = _t6027._val;
          _t6028 = List$fold(collect_tvar_refs, acc, ts);
          break _t6029;
        }
        if (_t6027._tag === 10) {
          const t = _t6027._val;
          const _t6034 = acc;
          const _t6035 = t;
          acc = _t6034;
          ty = _t6035;
          continue;
          _t6028 = undefined;
          break _t6029;
        }
        if (_t6027._tag === 13) {
          const t = _t6027._val;
          const _t6036 = acc;
          const _t6037 = t;
          acc = _t6036;
          ty = _t6037;
          continue;
          _t6028 = undefined;
          break _t6029;
        }
        if (_t6027._tag === 11) {
          const row = _t6027._val;
          function _t6038(a, __p150) {
            let _t6040;
            const _t6039 = __p150;
            _t6041: {
              if (true) {
                const t = _t6039[1];
                _t6040 = collect_tvar_refs(a, t);
                break _t6041;
              }
              _match_fail("line 16933");
            }
            return _t6040;
          }
          _t6028 = List$fold(_t6038, acc, Types$record_row_to_fields(row));
          break _t6029;
        }
        if (_t6027._tag === 12) {
          const args = _t6027._val[1];
          _t6028 = List$fold(collect_tvar_refs, acc, args);
          break _t6029;
        }
        if (_t6027._tag === 14) {
          const row = _t6027._val;
          function collect_pv(a, __x) {
            while (true) {
              let _t6043;
              const _t6042 = __x;
              _t6044: {
                if (_t6042._tag === 0 && _t6042._val[1]._tag === 1) {
                  const t = _t6042._val[1]._val;
                  const tail = _t6042._val[2];
                  const _t6045 = collect_tvar_refs(a, t);
                  const _t6046 = tail;
                  a = _t6045;
                  __x = _t6046;
                  continue;
                  _t6043 = undefined;
                  break _t6044;
                }
                if (_t6042._tag === 0 && _t6042._val[1]._tag === 0) {
                  const tail = _t6042._val[2];
                  const _t6047 = a;
                  const _t6048 = tail;
                  a = _t6047;
                  __x = _t6048;
                  continue;
                  _t6043 = undefined;
                  break _t6044;
                }
                if (true) {
                  _t6043 = a;
                  break _t6044;
                }
                _match_fail("line 16933");
              }
              return _t6043;
            }
          }
          const _t6049 = collect_pv(acc, row);
          _t6028 = _t6049;
          break _t6029;
        }
        if (true) {
          _t6028 = acc;
          break _t6029;
        }
        _match_fail("line 16933");
      }
      return _t6028;
    }
  }
  const result_refs_6051 = collect_tvar_refs(null, Types$deep_repr(result_ty));
  function _t6053(exist_ref) {
    let _t6055;
    const _t6054 = Types$repr(({_tag: 15, _name: "TVar", _val: exist_ref}));
    _t6056: {
      if (_t6054._tag === 15 && _t6054._val.contents._tag === 0) {
        const resolved_ref = _t6054._val;
        function _t6057(r) {
          return _eq(r, resolved_ref);
        }
        _t6055 = List$exists(_t6057, result_refs_6051);
        break _t6056;
      }
      if (true) {
        const resolved = _t6054;
        const exist_refs_6058 = collect_tvar_refs(null, resolved);
        function _t6060(er) {
          function _t6061(rr) {
            return _eq(er, rr);
          }
          return List$exists(_t6061, result_refs_6051);
        }
        const _t6059 = List$exists(_t6060, exist_refs_6058);
        _t6055 = _t6059;
        break _t6056;
      }
      _match_fail("line 16933");
    }
    return _t6055;
  }
  const has_escape_6062 = List$exists(_t6053, existential_refs);
  let _t6064;
  if (has_escape_6062) {
    _t6064 = Typechecker$error("existential type variable would escape the scope of its GADT match arm");
  } else {
    _t6064 = undefined;
  }
  const _t6063 = _t6064;
  const _t6052 = _t6063;
  const _t6050 = _t6052;
  return _t6050;
}
function Typechecker$synth_match(expected_ty, ctx, level, scrut, arms, partial) {
  const scrut_te_6065 = Typechecker$synth(ctx, level, scrut);
  let _t6068;
  const _t6067 = Types$repr(scrut_te_6065.ty);
  _t6069: {
    if (_t6067._tag === 12) {
      const name = _t6067._val[0];
      const params = _t6067._val[1];
      let _t6071;
      const _t6070 = Typechecker$find_variant_info(ctx.type_env, name);
      _t6072: {
        if (_t6070._tag === 1 && _t6070._val[3]) {
          _t6071 = ({_tag: 1, _name: "Some", _val: [name, params]});
          break _t6072;
        }
        if (true) {
          _t6071 = ({_tag: 0, _name: "None"});
          break _t6072;
        }
        _match_fail("line 16933");
      }
      _t6068 = _t6071;
      break _t6069;
    }
    if (true) {
      _t6068 = ({_tag: 0, _name: "None"});
      break _t6069;
    }
    _match_fail("line 16933");
  }
  const gadt_info_6073 = _t6068;
  let _t6076;
  const _t6075 = gadt_info_6073;
  _t6077: {
    if (_t6075._tag === 1) {
      const _gadt_name = _t6075._val[0];
      const scrut_params = _t6075._val[1];
      let _t6079;
      const _t6078 = expected_ty;
      _t6080: {
        if (_t6078._tag === 1) {
          const ty = _t6078._val;
          _t6079 = ty;
          break _t6080;
        }
        if (_t6078._tag === 0) {
          _t6079 = Types$new_tvar(level);
          break _t6080;
        }
        _match_fail("line 16933");
      }
      const result_ty_6081 = _t6079;
      function _t6083(ty) {
        let _t6085;
        const _t6084 = Types$repr(ty);
        _t6086: {
          if (_t6084._tag === 15) {
            const r = _t6084._val;
            _t6085 = ({_tag: 1, _name: "Some", _val: r});
            break _t6086;
          }
          if (true) {
            _t6085 = ({_tag: 0, _name: "None"});
            break _t6086;
          }
          _match_fail("line 16933");
        }
        return _t6085;
      }
      const get_tvar_ref_6087 = _t6083;
      function _t6089(p) {
        let _t6091;
        const _t6090 = get_tvar_ref_6087(p);
        _t6092: {
          if (_t6090._tag === 1) {
            const r = _t6090._val;
            _t6091 = ({_tag: 1, _name: "Some", _val: [r, Ref$get(r)]});
            break _t6092;
          }
          if (_t6090._tag === 0) {
            _t6091 = ({_tag: 0, _name: "None"});
            break _t6092;
          }
          _match_fail("line 16933");
        }
        return _t6091;
      }
      const param_refs_6093 = List$filter_map(_t6089, scrut_params);
      function _t6095(_) {
        function _t6096(__p151) {
          let _t6098;
          const _t6097 = __p151;
          _t6099: {
            if (true) {
              const r = _t6097[0];
              _t6098 = [r, Ref$get(r)];
              break _t6099;
            }
            _match_fail("line 16933");
          }
          return _t6098;
        }
        return List$map(_t6096, param_refs_6093);
      }
      const save_snapshot_6100 = _t6095;
      function _t6102(saved) {
        function _t6103(__p152) {
          let _t6105;
          const _t6104 = __p152;
          _t6106: {
            if (true) {
              const r = _t6104[0];
              const v = _t6104[1];
              _t6105 = Ref$set(r, v);
              break _t6106;
            }
            _match_fail("line 16933");
          }
          return _t6105;
        }
        return List$iter(_t6103, saved);
      }
      const restore_snapshot_6107 = _t6102;
      function _t6109(__p153) {
        let _t6111;
        const _t6110 = __p153;
        _t6112: {
          if (true) {
            const pat = _t6110[0];
            const guard = _t6110[1];
            const body = _t6110[2];
            const snapshot_6113 = save_snapshot_6100(undefined);
            let _t6116;
            const _t6115 = pat;
            _t6117: {
              if (_t6115._tag === 10) {
                const name = _t6115._val[0];
                _t6116 = ({_tag: 1, _name: "Some", _val: name});
                break _t6117;
              }
              if (true) {
                _t6116 = ({_tag: 0, _name: "None"});
                break _t6117;
              }
              _match_fail("line 16933");
            }
            const ctor_name_6118 = _t6116;
            let _t6121;
            const _t6120 = ctor_name_6118;
            _t6122: {
              if (_t6120._tag === 1) {
                const name = _t6120._val;
                let _t6124;
                const _t6123 = List$assoc_opt(name, ctx.type_env.constructors);
                _t6125: {
                  if (_t6123._tag === 1) {
                    const info = _t6123._val;
                    _t6124 = !_eq(info.ctor_return_ty_params, ({_tag: 0, _name: "None"}));
                    break _t6125;
                  }
                  if (_t6123._tag === 0) {
                    _t6124 = false;
                    break _t6125;
                  }
                  _match_fail("line 16933");
                }
                _t6121 = _t6124;
                break _t6122;
              }
              if (_t6120._tag === 0) {
                _t6121 = false;
                break _t6122;
              }
              _match_fail("line 16933");
            }
            const is_gadt_ctor_6126 = _t6121;
            let _t6128;
            if (is_gadt_ctor_6126) {
              _t6128 = Typechecker$check_pattern_gadt(ctx, level, pat, scrut_te_6065.ty);
            } else {
              _t6128 = [Typechecker$check_pattern(ctx, level, pat, scrut_te_6065.ty), null];
            }
            let _t6130;
            const _t6129 = _t6128;
            _t6131: {
              if (true) {
                const bindings = _t6129[0];
                const existential_refs = _t6129[1];
                function _t6132(c, __p154) {
                  let _t6134;
                  const _t6133 = __p154;
                  _t6135: {
                    if (true) {
                      const n = _t6133[0];
                      const t = _t6133[1];
                      _t6134 = Typechecker$extend_var_mono(c, n, t);
                      break _t6135;
                    }
                    _match_fail("line 16933");
                  }
                  return _t6134;
                }
                const ctx$p_6136 = List$fold(_t6132, ctx, bindings);
                let _t6139;
                const _t6138 = guard;
                _t6140: {
                  if (_t6138._tag === 1) {
                    const g = _t6138._val;
                    _t6139 = ({_tag: 1, _name: "Some", _val: Typechecker$check(ctx$p_6136, level, g, ({_tag: 2, _name: "TBool"}))});
                    break _t6140;
                  }
                  if (_t6138._tag === 0) {
                    _t6139 = ({_tag: 0, _name: "None"});
                    break _t6140;
                  }
                  _match_fail("line 16933");
                }
                const guard_te_6141 = _t6139;
                const body_te_6143 = Typechecker$check(ctx$p_6136, level, body, result_ty_6081);
                const guard_te_6145 = Option$map(Typechecker$freeze_texpr, guard_te_6141);
                const body_te_6147 = Typechecker$freeze_texpr(body_te_6143);
                let _t6149;
                if (!_eq(existential_refs, null)) {
                  _t6149 = Typechecker$check_existential_escape(existential_refs, result_ty_6081);
                } else {
                  _t6149 = undefined;
                }
                _t6149;
                restore_snapshot_6107(snapshot_6113);
                const _t6148 = [Typechecker$qualify_pattern(ctx.type_env, pat), guard_te_6145, body_te_6147];
                const _t6146 = _t6148;
                const _t6144 = _t6146;
                const _t6142 = _t6144;
                const _t6137 = _t6142;
                _t6130 = _t6137;
                break _t6131;
              }
              _match_fail("line 16933");
            }
            const _t6127 = _t6130;
            const _t6119 = _t6127;
            const _t6114 = _t6119;
            _t6111 = _t6114;
            break _t6112;
          }
          _match_fail("line 16933");
        }
        return _t6111;
      }
      const check_gadt_arm_6150 = _t6109;
      let _t6153;
      const _t6152 = arms;
      _t6154: {
        if (_t6152 === null) {
          _t6153 = Typechecker$error("match expression has no arms");
          break _t6154;
        }
        if (_t6152 !== null) {
          const first = _t6152._hd;
          const rest = _t6152._tl;
          const first_arm_6155 = check_gadt_arm_6150(first);
          const rest_arms_6157 = List$map(check_gadt_arm_6150, rest);
          const all_arms_6159 = ({_hd: first_arm_6155, _tl: rest_arms_6157});
          let _t6161;
          if ((!partial)) {
            _t6161 = Ref$get(Typechecker$exhaustiveness_check_ref, ctx, Types$repr(scrut_te_6065.ty), all_arms_6159);
          } else {
            _t6161 = undefined;
          }
          _t6161;
          const _t6160 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [scrut_te_6065, all_arms_6159, partial]}), result_ty_6081);
          const _t6158 = _t6160;
          const _t6156 = _t6158;
          _t6153 = _t6156;
          break _t6154;
        }
        _match_fail("line 16933");
      }
      const _t6151 = _t6153;
      const _t6108 = _t6151;
      const _t6101 = _t6108;
      const _t6094 = _t6101;
      const _t6088 = _t6094;
      const _t6082 = _t6088;
      _t6076 = _t6082;
      break _t6077;
    }
    if (_t6075._tag === 0) {
      function _t6162(ctx, __p155) {
        let _t6164;
        const _t6163 = __p155;
        _t6165: {
          if (true) {
            const pat = _t6163[0];
            const guard = _t6163[1];
            const body = _t6163[2];
            const bindings_6166 = Typechecker$check_pattern(ctx, level, pat, scrut_te_6065.ty);
            function _t6168(c, __p156) {
              let _t6170;
              const _t6169 = __p156;
              _t6171: {
                if (true) {
                  const n = _t6169[0];
                  const t = _t6169[1];
                  _t6170 = Typechecker$extend_var_mono(c, n, t);
                  break _t6171;
                }
                _match_fail("line 16933");
              }
              return _t6170;
            }
            const ctx$p_6172 = List$fold(_t6168, ctx, bindings_6166);
            let _t6175;
            const _t6174 = guard;
            _t6176: {
              if (_t6174._tag === 1) {
                const g = _t6174._val;
                const gte_6177 = Typechecker$check(ctx$p_6172, level, g, ({_tag: 2, _name: "TBool"}));
                const _t6178 = ({_tag: 1, _name: "Some", _val: gte_6177});
                _t6175 = _t6178;
                break _t6176;
              }
              if (_t6174._tag === 0) {
                _t6175 = ({_tag: 0, _name: "None"});
                break _t6176;
              }
              _match_fail("line 16933");
            }
            const guard_te_6179 = _t6175;
            const body_te_6181 = Typechecker$synth(ctx$p_6172, level, body);
            const _t6182 = [Typechecker$qualify_pattern(ctx.type_env, pat), guard_te_6179, body_te_6181];
            const _t6180 = _t6182;
            const _t6173 = _t6180;
            const _t6167 = _t6173;
            _t6164 = _t6167;
            break _t6165;
          }
          _match_fail("line 16933");
        }
        return _t6164;
      }
      const check_arm_6183 = _t6162;
      let _t6186;
      const _t6185 = arms;
      _t6187: {
        if (_t6185 === null) {
          _t6186 = Typechecker$error("match expression has no arms");
          break _t6187;
        }
        if (_t6185 !== null) {
          const first = _t6185._hd;
          const rest = _t6185._tl;
          let _t6189;
          const _t6188 = check_arm_6183(ctx, first);
          _t6190: {
            if (true) {
              const fp = _t6188[0];
              const fg = _t6188[1];
              const fb = _t6188[2];
              const result_ty_6191 = fb.ty;
              function _t6193(arm) {
                let _t6195;
                const _t6194 = check_arm_6183(ctx, arm);
                _t6196: {
                  if (true) {
                    const p = _t6194[0];
                    const g = _t6194[1];
                    const b = _t6194[2];
                    Typechecker$try_unify(b.ty, result_ty_6191);
                    _t6195 = [p, g, b];
                    break _t6196;
                  }
                  _match_fail("line 16933");
                }
                return _t6195;
              }
              const all_arms_6197 = ({_hd: [fp, fg, fb], _tl: List$map(_t6193, rest)});
              let _t6199;
              if ((!partial)) {
                _t6199 = Ref$get(Typechecker$exhaustiveness_check_ref, ctx, Types$repr(scrut_te_6065.ty), all_arms_6197);
              } else {
                _t6199 = undefined;
              }
              _t6199;
              const _t6198 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [scrut_te_6065, all_arms_6197, partial]}), result_ty_6191);
              const _t6192 = _t6198;
              _t6189 = _t6192;
              break _t6190;
            }
            _match_fail("line 16933");
          }
          _t6186 = _t6189;
          break _t6187;
        }
        _match_fail("line 16933");
      }
      const _t6184 = _t6186;
      _t6076 = _t6184;
      break _t6077;
    }
    _match_fail("line 16933");
  }
  const _t6074 = _t6076;
  const _t6066 = _t6074;
  return _t6066;
}
function Typechecker$check(ctx, level, expr, expected) {
  while (true) {
    let _t6201;
    const _t6200 = expr;
    _t6202: {
      if (_t6200._tag === 49) {
        const loc = _t6200._val[0];
        const inner = _t6200._val[1];
        Ref$set(Typechecker$current_loc, loc);
        const _t6203 = ctx;
        const _t6204 = level;
        const _t6205 = inner;
        const _t6206 = expected;
        ctx = _t6203;
        level = _t6204;
        expr = _t6205;
        expected = _t6206;
        continue;
        _t6201 = undefined;
        break _t6202;
      }
      if (_t6200._tag === 10) {
        const param = _t6200._val[0];
        const body = _t6200._val[1];
        if (_eq(param.annot, ({_tag: 0, _name: "None"}))) {
          const arg_ty_6207 = Types$new_tvar(level);
          const ret_ty_6209 = Types$new_tvar(level);
          const fn_eff_6211 = Types$new_effvar(level);
          Typechecker$try_unify(expected, ({_tag: 7, _name: "TArrow", _val: [arg_ty_6207, fn_eff_6211, ret_ty_6209]}));
          const return_used_6213 = Ref$create(false);
          const __rec_upd_6215 = ctx;
          const _t6216 = ({constraint_tvars: __rec_upd_6215.constraint_tvars, current_eff: fn_eff_6211, current_module: __rec_upd_6215.current_module, inside_handler: false, loop_info: __rec_upd_6215.loop_info, mutable_vars: __rec_upd_6215.mutable_vars, return_type: ({_tag: 1, _name: "Some", _val: ret_ty_6209}), return_used: return_used_6213, type_env: __rec_upd_6215.type_env, vars: __rec_upd_6215.vars});
          const ctx$p_6217 = Typechecker$extend_var_mono(_t6216, param.name, Types$repr(arg_ty_6207));
          const body_te_6219 = Typechecker$check(ctx$p_6217, level, body, ret_ty_6209);
          let _t6221;
          if (param.is_generated) {
            _t6221 = false;
          } else {
            _t6221 = Ref$get(return_used_6213);
          }
          const has_return_6222 = _t6221;
          const _t6223 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param.name, body_te_6219, has_return_6222]}), ({_tag: 7, _name: "TArrow", _val: [arg_ty_6207, fn_eff_6211, body_te_6219.ty]}));
          const _t6220 = _t6223;
          const _t6218 = _t6220;
          const _t6214 = _t6218;
          const _t6212 = _t6214;
          const _t6210 = _t6212;
          const _t6208 = _t6210;
          _t6201 = _t6208;
          break _t6202;
        }
      }
      if (_t6200._tag === 25) {
        const scrut = _t6200._val[0];
        const arms = _t6200._val[1];
        const partial = _t6200._val[2];
        _t6201 = Typechecker$synth_match(({_tag: 1, _name: "Some", _val: expected}), ctx, level, scrut, arms, partial);
        break _t6202;
      }
      if (true) {
        const te_6224 = Typechecker$synth(ctx, level, expr);
        Typechecker$try_unify(te_6224.ty, expected);
        const __rec_upd_6226 = te_6224;
        const _t6227 = ({expr: __rec_upd_6226.expr, loc: __rec_upd_6226.loc, ty: expected});
        const _t6225 = _t6227;
        _t6201 = _t6225;
        break _t6202;
      }
      _match_fail("line 16933");
    }
    return _t6201;
  }
}
function Typechecker$check_pattern(ctx, level, pat, ty) {
  while (true) {
    let _t6229;
    const _t6228 = pat;
    _t6230: {
      if (_t6228._tag === 0) {
        _t6229 = null;
        break _t6230;
      }
      if (_t6228._tag === 1) {
        const name = _t6228._val;
        _t6229 = ({_hd: [name, ty], _tl: null});
        break _t6230;
      }
      if (_t6228._tag === 2) {
        Typechecker$try_unify(ty, ({_tag: 0, _name: "TInt"}));
        _t6229 = null;
        break _t6230;
      }
      if (_t6228._tag === 3) {
        Typechecker$try_unify(ty, ({_tag: 1, _name: "TFloat"}));
        _t6229 = null;
        break _t6230;
      }
      if (_t6228._tag === 4) {
        Typechecker$try_unify(ty, ({_tag: 2, _name: "TBool"}));
        _t6229 = null;
        break _t6230;
      }
      if (_t6228._tag === 5) {
        Typechecker$try_unify(ty, ({_tag: 3, _name: "TString"}));
        _t6229 = null;
        break _t6230;
      }
      if (_t6228._tag === 6) {
        Typechecker$try_unify(ty, ({_tag: 6, _name: "TUnit"}));
        _t6229 = null;
        break _t6230;
      }
      if (_t6228._tag === 7) {
        const pats = _t6228._val;
        function _t6231(_) {
          return Types$new_tvar(level);
        }
        const tys_6232 = List$map(_t6231, pats);
        Typechecker$try_unify(ty, ({_tag: 9, _name: "TTuple", _val: tys_6232}));
        const _t6233 = List$flatten(List$map2(_call(Typechecker$check_pattern, [ctx, level]), pats, tys_6232));
        _t6229 = _t6233;
        break _t6230;
      }
      if (_t6228._tag === 8) {
        const hd_pat = _t6228._val[0];
        const tl_pat = _t6228._val[1];
        const elem_ty_6234 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 10, _name: "TList", _val: elem_ty_6234}));
        const hd_bindings_6236 = Typechecker$check_pattern(ctx, level, hd_pat, elem_ty_6234);
        const tl_bindings_6238 = Typechecker$check_pattern(ctx, level, tl_pat, ty);
        const _t6239 = List$concat(hd_bindings_6236, tl_bindings_6238);
        const _t6237 = _t6239;
        const _t6235 = _t6237;
        _t6229 = _t6235;
        break _t6230;
      }
      if (_t6228._tag === 9) {
        const elem_ty_6240 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 10, _name: "TList", _val: elem_ty_6240}));
        const _t6241 = null;
        _t6229 = _t6241;
        break _t6230;
      }
      if (_t6228._tag === 10) {
        const name = _t6228._val[0];
        const arg_pat = _t6228._val[1];
        let _t6243;
        const _t6242 = List$assoc_opt(name, ctx.type_env.constructors);
        _t6244: {
          if (_t6242._tag === 0) {
            _t6243 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
            break _t6244;
          }
          if (_t6242._tag === 1) {
            const info = _t6242._val;
            let _t6245;
            if (List$mem(info.ctor_type_name, ctx.type_env.hidden_ctor_types)) {
              _t6245 = Typechecker$error(("unknown constructor in pattern: " + __dict_Show_string.show(name)));
            } else {
              _t6245 = undefined;
            }
            _t6245;
            function _t6246(_) {
              return Types$new_tvar(level);
            }
            const fresh_args_6247 = List$init(info.ctor_num_params, _t6246);
            const expected_variant_6249 = ({_tag: 12, _name: "TVariant", _val: [info.ctor_type_name, fresh_args_6247]});
            Typechecker$try_unify(ty, expected_variant_6249);
            let _t6252;
            const _t6251 = [info.ctor_arg_ty, arg_pat];
            _t6253: {
              if (_t6251[0]._tag === 0 && _t6251[1]._tag === 0) {
                _t6252 = null;
                break _t6253;
              }
              if (_t6251[0]._tag === 1 && _t6251[1]._tag === 1) {
                const arg_ty = _t6251[0]._val;
                const p = _t6251[1]._val;
                const concrete_ty_6254 = Typechecker$freshen_arrow_effects(level, Typechecker$subst_tgens(fresh_args_6247, arg_ty));
                const _t6256 = ctx;
                const _t6257 = level;
                const _t6258 = p;
                const _t6259 = concrete_ty_6254;
                ctx = _t6256;
                level = _t6257;
                pat = _t6258;
                ty = _t6259;
                continue;
                const _t6255 = undefined;
                _t6252 = _t6255;
                break _t6253;
              }
              if (_t6251[0]._tag === 0 && _t6251[1]._tag === 1) {
                _t6252 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " takes no arguments"));
                break _t6253;
              }
              if (_t6251[0]._tag === 1 && _t6251[1]._tag === 0) {
                _t6252 = Typechecker$error((("constructor " + __dict_Show_string.show(name)) + " requires an argument"));
                break _t6253;
              }
              _match_fail("line 16933");
            }
            const _t6250 = _t6252;
            const _t6248 = _t6250;
            _t6243 = _t6248;
            break _t6244;
          }
          _match_fail("line 16933");
        }
        _t6229 = _t6243;
        break _t6230;
      }
      if (_t6228._tag === 11) {
        const field_pats = _t6228._val;
        let _t6261;
        const _t6260 = Types$repr(ty);
        _t6262: {
          if (_t6260._tag === 11) {
            const row = _t6260._val;
            _t6261 = Types$record_row_to_fields(row);
            break _t6262;
          }
          if (true) {
            const pat_field_names_6263 = List$map(fst, field_pats);
            function _t6265(__p157) {
              let _t6267;
              const _t6266 = __p157;
              _t6268: {
                if (true) {
                  const _name = _t6266[0];
                  const fields = _t6266[1];
                  function _t6269(fn_) {
                    return List$mem_assoc(fn_, fields);
                  }
                  _t6267 = List$forall(_t6269, pat_field_names_6263);
                  break _t6268;
                }
                _match_fail("line 16933");
              }
              return _t6267;
            }
            const candidates_6270 = List$filter(_t6265, ctx.type_env.records);
            let _t6273;
            const _t6272 = candidates_6270;
            _t6274: {
              if (_t6272 !== null && _t6272._tl === null) {
                const _name = _t6272._hd[0];
                const fields = _t6272._hd[1];
                const row_6275 = Typechecker$instantiate_record_row(level, fields);
                Typechecker$try_unify(ty, ({_tag: 11, _name: "TRecord", _val: row_6275}));
                const _t6276 = Typechecker$instantiate_record_fields(level, fields);
                _t6273 = _t6276;
                break _t6274;
              }
              if (_t6272 === null) {
                let _t6278;
                const _t6277 = Types$repr(ty);
                _t6279: {
                  if (_t6277._tag === 15) {
                    function _t6280(fname, rest) {
                      return ({_tag: 0, _name: "RRow", _val: [fname, Types$new_tvar(level), rest]});
                    }
                    const row_6281 = List$fold_right(_t6280, pat_field_names_6263, Types$new_rvar(level));
                    Typechecker$try_unify(ty, ({_tag: 11, _name: "TRecord", _val: row_6281}));
                    let _t6284;
                    const _t6283 = Types$repr(ty);
                    _t6285: {
                      if (_t6283._tag === 11) {
                        const r = _t6283._val;
                        _t6284 = r;
                        break _t6285;
                      }
                      if (true) {
                        _t6284 = Typechecker$error("record pattern used with non-record type");
                        break _t6285;
                      }
                      _match_fail("line 16933");
                    }
                    const _t6282 = Types$record_row_to_fields(_t6284);
                    _t6278 = _t6282;
                    break _t6279;
                  }
                  if (true) {
                    _t6278 = Typechecker$error("record pattern used with non-record type");
                    break _t6279;
                  }
                  _match_fail("line 16933");
                }
                _t6273 = _t6278;
                break _t6274;
              }
              if (true) {
                _t6273 = Typechecker$error("ambiguous record pattern â€” annotate the type");
                break _t6274;
              }
              _match_fail("line 16933");
            }
            const _t6271 = _t6273;
            const _t6264 = _t6271;
            _t6261 = _t6264;
            break _t6262;
          }
          _match_fail("line 16933");
        }
        const field_tys_6286 = _t6261;
        function _t6288(__p158) {
          let _t6290;
          const _t6289 = __p158;
          _t6291: {
            if (true) {
              const name = _t6289[0];
              const pat = _t6289[1];
              let _t6293;
              const _t6292 = List$assoc_opt(name, field_tys_6286);
              _t6294: {
                if (_t6292._tag === 1) {
                  const fty = _t6292._val;
                  _t6293 = Typechecker$check_pattern(ctx, level, pat, fty);
                  break _t6294;
                }
                if (_t6292._tag === 0) {
                  _t6293 = Typechecker$error(("record type has no field " + __dict_Show_string.show(name)));
                  break _t6294;
                }
                _match_fail("line 16933");
              }
              _t6290 = _t6293;
              break _t6291;
            }
            _match_fail("line 16933");
          }
          return _t6290;
        }
        const _t6287 = List$flatten(List$map(_t6288, field_pats));
        _t6229 = _t6287;
        break _t6230;
      }
      if (_t6228._tag === 12) {
        const inner_pat = _t6228._val[0];
        const name = _t6228._val[1];
        const bindings_6295 = Typechecker$check_pattern(ctx, level, inner_pat, ty);
        const _t6296 = ({_hd: [name, ty], _tl: bindings_6295});
        _t6229 = _t6296;
        break _t6230;
      }
      if (_t6228._tag === 13) {
        const p1 = _t6228._val[0];
        const p2 = _t6228._val[1];
        const bindings1_6297 = Typechecker$check_pattern(ctx, level, p1, ty);
        const bindings2_6299 = Typechecker$check_pattern(ctx, level, p2, ty);
        const names1_6301 = _call(_call(List$sort, [String$compare]), [List$map(fst, bindings1_6297)]);
        const names2_6303 = _call(_call(List$sort, [String$compare]), [List$map(fst, bindings2_6299)]);
        let _t6305;
        if (!_eq(names1_6301, names2_6303)) {
          _t6305 = Typechecker$error("or-pattern branches must bind the same variables");
        } else {
          _t6305 = undefined;
        }
        _t6305;
        function _t6306(__p159) {
          let _t6308;
          const _t6307 = __p159;
          _t6309: {
            if (true) {
              const name = _t6307[0];
              const ty1 = _t6307[1];
              let _t6311;
              const _t6310 = List$assoc_opt(name, bindings2_6299);
              _t6312: {
                if (_t6310._tag === 1) {
                  const ty2 = _t6310._val;
                  _t6311 = Typechecker$try_unify(ty1, ty2);
                  break _t6312;
                }
                if (_t6310._tag === 0) {
                  _t6311 = undefined;
                  break _t6312;
                }
                _match_fail("line 16933");
              }
              _t6308 = _t6311;
              break _t6309;
            }
            _match_fail("line 16933");
          }
          return _t6308;
        }
        List$iter(_t6306, bindings1_6297);
        const _t6304 = bindings1_6297;
        const _t6302 = _t6304;
        const _t6300 = _t6302;
        const _t6298 = _t6300;
        _t6229 = _t6298;
        break _t6230;
      }
      if (_t6228._tag === 14) {
        const pats = _t6228._val;
        const elem_ty_6313 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 13, _name: "TArray", _val: elem_ty_6313}));
        function _t6315(p) {
          return Typechecker$check_pattern(ctx, level, p, elem_ty_6313);
        }
        const _t6314 = List$concat_map(_t6315, pats);
        _t6229 = _t6314;
        break _t6230;
      }
      if (_t6228._tag === 15) {
        const entries = _t6228._val;
        const key_ty_6316 = Types$new_tvar(level);
        const val_ty_6318 = Types$new_tvar(level);
        Typechecker$try_unify(ty, ({_tag: 12, _name: "TVariant", _val: ["map", ({_hd: key_ty_6316, _tl: ({_hd: val_ty_6318, _tl: null})})]}));
        function _t6320(__p160) {
          let _t6322;
          const _t6321 = __p160;
          _t6323: {
            if (true) {
              const kpat = _t6321[0];
              const vpat = _t6321[1];
              _t6322 = List$concat(Typechecker$check_pattern(ctx, level, kpat, key_ty_6316), Typechecker$check_pattern(ctx, level, vpat, val_ty_6318));
              break _t6323;
            }
            _match_fail("line 16933");
          }
          return _t6322;
        }
        const _t6319 = List$concat_map(_t6320, entries);
        const _t6317 = _t6319;
        _t6229 = _t6317;
        break _t6230;
      }
      if (_t6228._tag === 16 && _t6228._val[1]._tag === 0) {
        const tag = _t6228._val[0];
        const tail_6324 = Types$new_pvvar(level);
        const row_6326 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 0, _name: "None"}), tail_6324]});
        Typechecker$try_unify(ty, ({_tag: 14, _name: "TPolyVariant", _val: row_6326}));
        const _t6327 = null;
        const _t6325 = _t6327;
        _t6229 = _t6325;
        break _t6230;
      }
      if (_t6228._tag === 16 && _t6228._val[1]._tag === 1) {
        const tag = _t6228._val[0];
        const sub_pat = _t6228._val[1]._val;
        const payload_ty_6328 = Types$new_tvar(level);
        const tail_6330 = Types$new_pvvar(level);
        const row_6332 = ({_tag: 0, _name: "PVRow", _val: [tag, ({_tag: 1, _name: "Some", _val: payload_ty_6328}), tail_6330]});
        Typechecker$try_unify(ty, ({_tag: 14, _name: "TPolyVariant", _val: row_6332}));
        const _t6334 = ctx;
        const _t6335 = level;
        const _t6336 = sub_pat;
        const _t6337 = payload_ty_6328;
        ctx = _t6334;
        level = _t6335;
        pat = _t6336;
        ty = _t6337;
        continue;
        const _t6333 = undefined;
        const _t6331 = _t6333;
        const _t6329 = _t6331;
        _t6229 = _t6329;
        break _t6230;
      }
      if (_t6228._tag === 17) {
        const name = _t6228._val;
        let _t6339;
        const _t6338 = List$assoc_opt(name, ctx.vars);
        _t6340: {
          if (_t6338._tag === 1) {
            const scheme = _t6338._val;
            const var_ty_6341 = Types$instantiate(level, scheme);
            Typechecker$try_unify(ty, var_ty_6341);
            const _t6342 = null;
            _t6339 = _t6342;
            break _t6340;
          }
          if (_t6338._tag === 0) {
            _t6339 = Typechecker$error(("unbound variable in pin pattern: " + __dict_Show_string.show(name)));
            break _t6340;
          }
          _match_fail("line 16933");
        }
        _t6229 = _t6339;
        break _t6230;
      }
      if (_t6228._tag === 18) {
        const inner_pat = _t6228._val[0];
        const annot = _t6228._val[1];
        const annot_ty_6343 = Typechecker$resolve_ty_annot(ctx, level, annot);
        Typechecker$try_unify(ty, annot_ty_6343);
        const _t6345 = ctx;
        const _t6346 = level;
        const _t6347 = inner_pat;
        const _t6348 = ty;
        ctx = _t6345;
        level = _t6346;
        pat = _t6347;
        ty = _t6348;
        continue;
        const _t6344 = undefined;
        _t6229 = _t6344;
        break _t6230;
      }
      _match_fail("line 16933");
    }
    return _t6229;
  }
}
function Typechecker$synth_poly_rec_fn(ctx, level, name, qualified_name, type_params, params, ret_annot, body) {
  const shared_tvars_6349 = Hashtbl$create(4);
  function _t6351(tp) {
    return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_6349, tp, Types$new_tvar((level + 1))]);
  }
  List$iter(_t6351, type_params);
  function _t6352(p) {
    let _t6354;
    const _t6353 = p.annot;
    _t6355: {
      if (_t6353._tag === 1) {
        const annot = _t6353._val;
        _t6354 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_6349, annot);
        break _t6355;
      }
      if (_t6353._tag === 0) {
        _t6354 = Types$new_tvar((level + 1));
        break _t6355;
      }
      _match_fail("line 16933");
    }
    return _t6354;
  }
  const param_tys_6356 = List$map(_t6352, params);
  let _t6359;
  const _t6358 = ret_annot;
  _t6360: {
    if (_t6358._tag === 1 && _t6358._val._tag === 10) {
      const ty = _t6358._val._val[0];
      const eff_annot = _t6358._val._val[1];
      const ty$p_6361 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_6349, ty);
      let _t6364;
      const _t6363 = eff_annot;
      _t6365: {
        if (_t6363._tag === 0) {
          _t6364 = ({_tag: 1, _name: "EffEmpty"});
          break _t6365;
        }
        if (_t6363._tag === 1) {
          const items = _t6363._val;
          _t6364 = Typechecker$resolve_eff_items(ctx, (level + 1), shared_tvars_6349, items);
          break _t6365;
        }
        _match_fail("line 16933");
      }
      const eff_6366 = _t6364;
      const _t6367 = [ty$p_6361, eff_6366];
      const _t6362 = _t6367;
      _t6359 = _t6362;
      break _t6360;
    }
    if (_t6358._tag === 1) {
      const annot = _t6358._val;
      _t6359 = [Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_6349, annot), Types$new_effvar((level + 1))];
      break _t6360;
    }
    if (_t6358._tag === 0) {
      _t6359 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
      break _t6360;
    }
    _match_fail("line 16933");
  }
  let _t6369;
  const _t6368 = _t6359;
  _t6370: {
    if (true) {
      const ret_ty = _t6368[0];
      const body_eff = _t6368[1];
      let _t6372;
      const _t6371 = List$rev(param_tys_6356);
      _t6373: {
        if (_t6371 === null) {
          _t6372 = ret_ty;
          break _t6373;
        }
        if (_t6371 !== null) {
          const last = _t6371._hd;
          const rest = _t6371._tl;
          const inner_6374 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
          function _t6376(acc, pty) {
            return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
          }
          const _t6375 = List$fold(_t6376, inner_6374, rest);
          _t6372 = _t6375;
          break _t6373;
        }
        _match_fail("line 16933");
      }
      const fn_ty_6377 = _t6372;
      const scheme_6379 = Types$generalize(level, fn_ty_6377);
      const ctx_with_self_6381 = Typechecker$extend_var(ctx, name, scheme_6379);
      let _t6383;
      if ((qualified_name !== "")) {
        _t6383 = Typechecker$extend_var(ctx_with_self_6381, qualified_name, scheme_6379);
      } else {
        _t6383 = ctx_with_self_6381;
      }
      const ctx_with_self_6384 = _t6383;
      function _t6386(c, p, ty) {
        return Typechecker$extend_var_mono(c, p.name, ty);
      }
      const __rec_upd_6387 = ctx_with_self_6384;
      const _t6388 = ({constraint_tvars: __rec_upd_6387.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_6387.current_module, inside_handler: __rec_upd_6387.inside_handler, loop_info: __rec_upd_6387.loop_info, mutable_vars: __rec_upd_6387.mutable_vars, return_type: __rec_upd_6387.return_type, return_used: __rec_upd_6387.return_used, type_env: __rec_upd_6387.type_env, vars: __rec_upd_6387.vars});
      const inner_ctx_6389 = List$fold2(_t6386, _t6388, params, param_tys_6356);
      const body_te_6391 = Typechecker$check(inner_ctx_6389, (level + 1), body, ret_ty);
      let _t6394;
      const _t6393 = [List$rev(params), List$rev(param_tys_6356)];
      _t6395: {
        if (_t6393[0] === null && _t6393[1] === null) {
          _t6394 = body_te_6391;
          break _t6395;
        }
        if (_t6393[0] !== null && _t6393[1] !== null) {
          const last_p = _t6393[0]._hd;
          const rest_ps = _t6393[0]._tl;
          const last_pty = _t6393[1]._hd;
          const rest_ptys = _t6393[1]._tl;
          const inner_6396 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_6391, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_6391.ty]}));
          function _t6398(acc, p, pty) {
            return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
          }
          const _t6397 = List$fold2(_t6398, inner_6396, rest_ps, rest_ptys);
          _t6394 = _t6397;
          break _t6395;
        }
        if (true) {
          _t6394 = failwith("assert false");
          break _t6395;
        }
        _match_fail("line 16933");
      }
      const te_6399 = _t6394;
      const _t6400 = [te_6399, scheme_6379];
      const _t6392 = _t6400;
      const _t6390 = _t6392;
      const _t6385 = _t6390;
      const _t6382 = _t6385;
      const _t6380 = _t6382;
      const _t6378 = _t6380;
      _t6369 = _t6378;
      break _t6370;
    }
    _match_fail("line 16933");
  }
  const _t6357 = _t6369;
  const _t6350 = _t6357;
  return _t6350;
}
function Typechecker$normalize_pattern(pat) {
  while (true) {
    let _t6402;
    const _t6401 = pat;
    _t6403: {
      if (_t6401._tag === 12) {
        const inner = _t6401._val[0];
        const _t6404 = inner;
        pat = _t6404;
        continue;
        _t6402 = undefined;
        break _t6403;
      }
      if (_t6401._tag === 13) {
        const p1 = _t6401._val[0];
        const p2 = _t6401._val[1];
        _t6402 = List$concat(Typechecker$normalize_pattern(p1), Typechecker$normalize_pattern(p2));
        break _t6403;
      }
      if (true) {
        const p = _t6401;
        _t6402 = ({_hd: p, _tl: null});
        break _t6403;
      }
      _match_fail("line 16933");
    }
    return _t6402;
  }
}
function Typechecker$ctor_short_name(name) {
  let _t6406;
  const _t6405 = String$rindex_opt(name, 46);
  _t6407: {
    if (_t6405._tag === 1) {
      const i = _t6405._val;
      _t6406 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
      break _t6407;
    }
    if (_t6405._tag === 0) {
      _t6406 = name;
      break _t6407;
    }
    _match_fail("line 16933");
  }
  return _t6406;
}
function Typechecker$specialize_variant(pats, ctor_name) {
  function _t6408(pat) {
    let _t6410;
    const _t6409 = pat;
    _t6411: {
      if (_t6409._tag === 10) {
        const name = _t6409._val[0];
        const sub = _t6409._val[1];
        if ((Typechecker$ctor_short_name(name) === ctor_name)) {
          let _t6413;
          const _t6412 = sub;
          _t6414: {
            if (_t6412._tag === 1) {
              const p = _t6412._val;
              _t6413 = Typechecker$normalize_pattern(p);
              break _t6414;
            }
            if (_t6412._tag === 0) {
              _t6413 = ({_hd: ({_tag: 0, _name: "PatWild"}), _tl: null});
              break _t6414;
            }
            _match_fail("line 16933");
          }
          _t6410 = _t6413;
          break _t6411;
        }
      }
      if (_t6409._tag === 10) {
        _t6410 = null;
        break _t6411;
      }
      if ((_t6409._tag === 0 || _t6409._tag === 1)) {
        _t6410 = ({_hd: ({_tag: 0, _name: "PatWild"}), _tl: null});
        break _t6411;
      }
      if (_t6409._tag === 12) {
        const inner = _t6409._val[0];
        _t6410 = Typechecker$specialize_variant(Typechecker$normalize_pattern(inner), ctor_name);
        break _t6411;
      }
      if (_t6409._tag === 13) {
        const p1 = _t6409._val[0];
        const p2 = _t6409._val[1];
        _t6410 = List$concat(Typechecker$specialize_variant(Typechecker$normalize_pattern(p1), ctor_name), Typechecker$specialize_variant(Typechecker$normalize_pattern(p2), ctor_name));
        break _t6411;
      }
      if (true) {
        _t6410 = null;
        break _t6411;
      }
      _match_fail("line 16933");
    }
    return _t6410;
  }
  return List$concat_map(_t6408, pats);
}
function Typechecker$has_wildcard(pats) {
  function _t6415(p) {
    let _t6417;
    const _t6416 = p;
    _t6418: {
      if ((_t6416._tag === 0 || _t6416._tag === 1)) {
        _t6417 = true;
        break _t6418;
      }
      if (true) {
        _t6417 = false;
        break _t6418;
      }
      _match_fail("line 16933");
    }
    return _t6417;
  }
  return List$exists(_t6415, pats);
}
function Typechecker$uncovered_patterns(type_env, ty, pats) {
  const pats_6419 = List$concat_map(Typechecker$normalize_pattern, pats);
  let _t6421;
  if (Typechecker$has_wildcard(pats_6419)) {
    _t6421 = null;
  } else {
    let _t6423;
    const _t6422 = Types$repr(ty);
    _t6424: {
      if (_t6422._tag === 12) {
        const name = _t6422._val[0];
        const args = _t6422._val[1];
        let _t6426;
        const _t6425 = Typechecker$find_variant_info(type_env, name);
        _t6427: {
          if (_t6425._tag === 0) {
            _t6426 = null;
            break _t6427;
          }
          if (_t6425._tag === 1) {
            const ctors = _t6425._val[2];
            const is_gadt = _t6425._val[3];
            let _t6428;
            if (is_gadt) {
              function _t6429(__p161) {
                let _t6431;
                const _t6430 = __p161;
                _t6432: {
                  if (true) {
                    const ctor_name = _t6430[0];
                    let _t6434;
                    const _t6433 = List$assoc_opt(ctor_name, type_env.constructors);
                    _t6435: {
                      if (_t6433._tag === 1) {
                        const info = _t6433._val;
                        let _t6437;
                        const _t6436 = info.ctor_return_ty_params;
                        _t6438: {
                          if (_t6436._tag === 0) {
                            _t6437 = true;
                            break _t6438;
                          }
                          if (_t6436._tag === 1) {
                            const ret_params = _t6436._val;
                            let _t6440;
                            if ((List$length(ret_params) === List$length(args))) {
                            function _t6439(p) {
                              return Typechecker$subst_tgens(args, p);
                            }
                              _t6440 = List$forall2(Types$types_compatible, List$map(_t6439, ret_params), args);
                            } else {
                              _t6440 = false;
                            }
                            _t6437 = _t6440;
                            break _t6438;
                          }
                          _match_fail("line 16933");
                        }
                        _t6434 = _t6437;
                        break _t6435;
                      }
                      if (_t6433._tag === 0) {
                        _t6434 = true;
                        break _t6435;
                      }
                      _match_fail("line 16933");
                    }
                    _t6431 = _t6434;
                    break _t6432;
                  }
                  _match_fail("line 16933");
                }
                return _t6431;
              }
              _t6428 = List$filter(_t6429, ctors);
            } else {
              _t6428 = ctors;
            }
            const reachable_ctors_6441 = _t6428;
            function _t6443(__p162) {
              let _t6445;
              const _t6444 = __p162;
              _t6446: {
                if (true) {
                  const ctor_name = _t6444[0];
                  const ctor_arg_ty = _t6444[1];
                  const sub_pats_6447 = Typechecker$specialize_variant(pats_6419, ctor_name);
                  let _t6450;
                  const _t6449 = ctor_arg_ty;
                  _t6451: {
                    if (_t6449._tag === 0) {
                      let _t6452;
                      if ((List$length(sub_pats_6447) === 0)) {
                        _t6452 = ({_hd: ctor_name, _tl: null});
                      } else {
                        _t6452 = null;
                      }
                      _t6450 = _t6452;
                      break _t6451;
                    }
                    if (_t6449._tag === 1) {
                      const arg_ty = _t6449._val;
                      let _t6453;
                      if ((List$length(sub_pats_6447) === 0)) {
                        _t6453 = ({_hd: (ctor_name + " _"), _tl: null});
                      } else {
                        const sub_missing_6454 = Typechecker$uncovered_patterns(type_env, arg_ty, sub_pats_6447);
                        function _t6456(m) {
                          return (ctor_name + (" (" + (m + ")")));
                        }
                        const _t6455 = List$map(_t6456, sub_missing_6454);
                        _t6453 = _t6455;
                      }
                      _t6450 = _t6453;
                      break _t6451;
                    }
                    _match_fail("line 16933");
                  }
                  const _t6448 = _t6450;
                  _t6445 = _t6448;
                  break _t6446;
                }
                _match_fail("line 16933");
              }
              return _t6445;
            }
            const _t6442 = List$concat_map(_t6443, reachable_ctors_6441);
            _t6426 = _t6442;
            break _t6427;
          }
          _match_fail("line 16933");
        }
        _t6423 = _t6426;
        break _t6424;
      }
      if (_t6422._tag === 2) {
        function _t6457(p) {
          let _t6459;
          const _t6458 = p;
          _t6460: {
            if (_t6458._tag === 4 && _t6458._val) {
              _t6459 = true;
              break _t6460;
            }
            if (true) {
              _t6459 = false;
              break _t6460;
            }
            _match_fail("line 16933");
          }
          return _t6459;
        }
        const has_true_6461 = List$exists(_t6457, pats_6419);
        function _t6463(p) {
          let _t6465;
          const _t6464 = p;
          _t6466: {
            if (_t6464._tag === 4 && !_t6464._val) {
              _t6465 = true;
              break _t6466;
            }
            if (true) {
              _t6465 = false;
              break _t6466;
            }
            _match_fail("line 16933");
          }
          return _t6465;
        }
        const has_false_6467 = List$exists(_t6463, pats_6419);
        const missing_6469 = Ref$create(null);
        let _t6471;
        if ((!has_true_6461)) {
          _t6471 = Ref$set(missing_6469, ({_hd: "true", _tl: Ref$get(missing_6469)}));
        } else {
          _t6471 = undefined;
        }
        _t6471;
        let _t6472;
        if ((!has_false_6467)) {
          _t6472 = Ref$set(missing_6469, ({_hd: "false", _tl: Ref$get(missing_6469)}));
        } else {
          _t6472 = undefined;
        }
        _t6472;
        const _t6470 = Ref$get(missing_6469);
        const _t6468 = _t6470;
        const _t6462 = _t6468;
        _t6423 = _t6462;
        break _t6424;
      }
      if (_t6422._tag === 10) {
        function _t6473(p) {
          let _t6475;
          const _t6474 = p;
          _t6476: {
            if (_t6474._tag === 9) {
              _t6475 = true;
              break _t6476;
            }
            if (true) {
              _t6475 = false;
              break _t6476;
            }
            _match_fail("line 16933");
          }
          return _t6475;
        }
        const has_nil_6477 = List$exists(_t6473, pats_6419);
        function _t6479(p) {
          let _t6481;
          const _t6480 = p;
          _t6482: {
            if (_t6480._tag === 8) {
              _t6481 = true;
              break _t6482;
            }
            if (true) {
              _t6481 = false;
              break _t6482;
            }
            _match_fail("line 16933");
          }
          return _t6481;
        }
        const has_cons_6483 = List$exists(_t6479, pats_6419);
        const missing_6485 = Ref$create(null);
        let _t6487;
        if ((!has_nil_6477)) {
          _t6487 = Ref$set(missing_6485, ({_hd: "[]", _tl: Ref$get(missing_6485)}));
        } else {
          _t6487 = undefined;
        }
        _t6487;
        let _t6488;
        if ((!has_cons_6483)) {
          _t6488 = Ref$set(missing_6485, ({_hd: "_ :: _", _tl: Ref$get(missing_6485)}));
        } else {
          _t6488 = undefined;
        }
        _t6488;
        const _t6486 = Ref$get(missing_6485);
        const _t6484 = _t6486;
        const _t6478 = _t6484;
        _t6423 = _t6478;
        break _t6424;
      }
      if (_t6422._tag === 13) {
        function _t6489(p) {
          let _t6491;
          const _t6490 = p;
          _t6492: {
            if (_t6490._tag === 14) {
              const elems = _t6490._val;
              _t6491 = ({_tag: 1, _name: "Some", _val: List$length(elems)});
              break _t6492;
            }
            if (true) {
              _t6491 = ({_tag: 0, _name: "None"});
              break _t6492;
            }
            _match_fail("line 16933");
          }
          return _t6491;
        }
        const lengths_6493 = List$filter_map(_t6489, pats_6419);
        const lengths_set_6495 = List$sort_uniq(compare, lengths_6493);
        function find_missing(n) {
          while (true) {
            let _t6497;
            if (List$mem(n, lengths_set_6495)) {
              const _t6498 = (n + 1);
              n = _t6498;
              continue;
              _t6497 = undefined;
            } else {
              _t6497 = n;
            }
            return _t6497;
          }
        }
        const missing_len_6500 = find_missing(0);
        let _t6502;
        if ((missing_len_6500 === 0)) {
          _t6502 = "#[]";
        } else {
          function _t6503(_) {
            return "_";
          }
          _t6502 = ("#[" + (String$concat("; ", List$init(missing_len_6500, _t6503)) + "]"));
        }
        const missing_pat_6504 = _t6502;
        const _t6505 = ({_hd: missing_pat_6504, _tl: null});
        const _t6501 = _t6505;
        const _t6499 = _t6501;
        const _t6496 = _t6499;
        const _t6494 = _t6496;
        _t6423 = _t6494;
        break _t6424;
      }
      if (((_t6422._tag === 0 || _t6422._tag === 1) || _t6422._tag === 3)) {
        _t6423 = ({_hd: "_", _tl: null});
        break _t6424;
      }
      if (_t6422._tag === 6) {
        function _t6506(p) {
          let _t6508;
          const _t6507 = p;
          _t6509: {
            if (_t6507._tag === 6) {
              _t6508 = true;
              break _t6509;
            }
            if (true) {
              _t6508 = false;
              break _t6509;
            }
            _match_fail("line 16933");
          }
          return _t6508;
        }
        const has_unit_6510 = List$exists(_t6506, pats_6419);
        let _t6512;
        if (has_unit_6510) {
          _t6512 = null;
        } else {
          _t6512 = ({_hd: "()", _tl: null});
        }
        const _t6511 = _t6512;
        _t6423 = _t6511;
        break _t6424;
      }
      if (_t6422._tag === 9) {
        const ts = _t6422._val;
        function _t6513(p) {
          let _t6515;
          const _t6514 = p;
          _t6516: {
            if (_t6514._tag === 7) {
              const ps = _t6514._val;
              if ((List$length(ps) === List$length(ts))) {
                _t6515 = ({_tag: 1, _name: "Some", _val: ps});
                break _t6516;
              }
            }
            if (true) {
              _t6515 = ({_tag: 0, _name: "None"});
              break _t6516;
            }
            _match_fail("line 16933");
          }
          return _t6515;
        }
        const tuple_pats_6517 = List$filter_map(_t6513, pats_6419);
        let _t6519;
        if (_eq(tuple_pats_6517, null)) {
          function _t6520(_) {
            return "_";
          }
          _t6519 = ({_hd: ("(" + (String$concat(", ", List$init(List$length(ts), _t6520)) + ")")), _tl: null});
        } else {
          function check_positions(i, __x) {
            while (true) {
              let _t6522;
              const _t6521 = __x;
              _t6523: {
                if (_t6521 === null) {
                  _t6522 = null;
                  break _t6523;
                }
                if (_t6521 !== null) {
                  const elem_ty = _t6521._hd;
                  const rest_tys = _t6521._tl;
                  function _t6524(ps) {
                    return List$nth(ps, i);
                  }
                  const position_pats_6525 = List$map(_t6524, tuple_pats_6517);
                  const sub_missing_6527 = Typechecker$uncovered_patterns(type_env, elem_ty, position_pats_6525);
                  let _t6529;
                  if (!_eq(sub_missing_6527, null)) {
                    function _t6530(j) {
                      let _t6531;
                      if ((j === i)) {
                        _t6531 = List$hd(sub_missing_6527);
                      } else {
                        _t6531 = "_";
                      }
                      return _t6531;
                    }
                    const template_6532 = List$init(List$length(ts), _t6530);
                    const _t6533 = ({_hd: ("(" + (String$concat(", ", template_6532) + ")")), _tl: null});
                    _t6529 = _t6533;
                  } else {
                    const _t6534 = (i + 1);
                    const _t6535 = rest_tys;
                    i = _t6534;
                    __x = _t6535;
                    continue;
                    _t6529 = undefined;
                  }
                  const _t6528 = _t6529;
                  const _t6526 = _t6528;
                  _t6522 = _t6526;
                  break _t6523;
                }
                _match_fail("line 16933");
              }
              return _t6522;
            }
          }
          const _t6536 = check_positions(0, ts);
          _t6519 = _t6536;
        }
        const _t6518 = _t6519;
        _t6423 = _t6518;
        break _t6424;
      }
      if (true) {
        _t6423 = null;
        break _t6424;
      }
      _match_fail("line 16933");
    }
    _t6421 = _t6423;
  }
  const _t6420 = _t6421;
  return _t6420;
}
function Typechecker$exhaustiveness_check(ctx, ty, arms) {
  function _t6537(__p163) {
    let _t6539;
    const _t6538 = __p163;
    _t6540: {
      if (true) {
        const pat = _t6538[0];
        const guard = _t6538[1];
        const _body = _t6538[2];
        let _t6542;
        const _t6541 = guard;
        _t6543: {
          if (_t6541._tag === 0) {
            _t6542 = ({_tag: 1, _name: "Some", _val: pat});
            break _t6543;
          }
          if (_t6541._tag === 1) {
            _t6542 = ({_tag: 0, _name: "None"});
            break _t6543;
          }
          _match_fail("line 16933");
        }
        _t6539 = _t6542;
        break _t6540;
      }
      _match_fail("line 16933");
    }
    return _t6539;
  }
  const unguarded_pats_6544 = List$filter_map(_t6537, arms);
  const missing_6546 = Typechecker$uncovered_patterns(ctx.type_env, ty, unguarded_pats_6544);
  let _t6548;
  if (!_eq(missing_6546, null)) {
    _t6548 = Typechecker$error(("non-exhaustive match, missing: " + __dict_Show_string.show(String$concat(", ", missing_6546))));
  } else {
    _t6548 = undefined;
  }
  const _t6547 = _t6548;
  const _t6545 = _t6547;
  return _t6545;
}
const Typechecker$__destruct = Ref$set(Typechecker$exhaustiveness_check_ref, Typechecker$exhaustiveness_check);
function Typechecker$process_type_def(ctx, type_params, type_name, def) {
  const num_params_6549 = List$length(type_params);
  let _t6552;
  const _t6551 = def;
  _t6553: {
    if (_t6551._tag === 0) {
      const ctors = _t6551._val;
      const __rec_upd_6554 = ctx;
      const __rec_upd_6556 = ctx.type_env;
      const _t6557 = ({classes: __rec_upd_6556.classes, constructors: __rec_upd_6556.constructors, effects: __rec_upd_6556.effects, hidden_ctor_types: __rec_upd_6556.hidden_ctor_types, hidden_types: __rec_upd_6556.hidden_types, instances: __rec_upd_6556.instances, modules: __rec_upd_6556.modules, mutable_fields: __rec_upd_6556.mutable_fields, newtypes: __rec_upd_6556.newtypes, records: __rec_upd_6556.records, type_aliases: __rec_upd_6556.type_aliases, type_synonyms: __rec_upd_6556.type_synonyms, variants: ({_hd: [type_name, num_params_6549, null, false], _tl: ctx.type_env.variants})});
      const _t6555 = ({constraint_tvars: __rec_upd_6554.constraint_tvars, current_eff: __rec_upd_6554.current_eff, current_module: __rec_upd_6554.current_module, inside_handler: __rec_upd_6554.inside_handler, loop_info: __rec_upd_6554.loop_info, mutable_vars: __rec_upd_6554.mutable_vars, return_type: __rec_upd_6554.return_type, return_used: __rec_upd_6554.return_used, type_env: _t6557, vars: __rec_upd_6554.vars});
      const pre_ctx_6558 = _t6555;
      const param_tbl_6560 = Hashtbl$create(4);
      function _t6562(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6560, name, i]);
      }
      List$iteri(_t6562, type_params);
      function _t6563(annot) {
        const tvars_6564 = Hashtbl$create(4);
        function go(__x) {
          while (true) {
            let _t6567;
            const _t6566 = __x;
            _t6568: {
              if (_t6566._tag === 1) {
                const name = _t6566._val;
                let _t6570;
                const _t6569 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6560, name]);
                _t6571: {
                  if (_t6569._tag === 1) {
                    const idx = _t6569._val;
                    _t6570 = ({_tag: 16, _name: "TGen", _val: idx});
                    break _t6571;
                  }
                  if (_t6569._tag === 0) {
                    let _t6573;
                    const _t6572 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6564, name]);
                    _t6574: {
                      if (_t6572._tag === 1) {
                        const tv = _t6572._val;
                        _t6573 = tv;
                        break _t6574;
                      }
                      if (_t6572._tag === 0) {
                        const tv_6575 = Types$new_tvar(0);
                        _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6564, name, tv_6575]);
                        const _t6576 = tv_6575;
                        _t6573 = _t6576;
                        break _t6574;
                      }
                      _match_fail("line 16933");
                    }
                    _t6570 = _t6573;
                    break _t6571;
                  }
                  _match_fail("line 16933");
                }
                _t6567 = _t6570;
                break _t6568;
              }
              if (_t6566._tag === 0 && _t6566._val === "int") {
                _t6567 = ({_tag: 0, _name: "TInt"});
                break _t6568;
              }
              if (_t6566._tag === 0 && _t6566._val === "float") {
                _t6567 = ({_tag: 1, _name: "TFloat"});
                break _t6568;
              }
              if (_t6566._tag === 0 && _t6566._val === "bool") {
                _t6567 = ({_tag: 2, _name: "TBool"});
                break _t6568;
              }
              if (_t6566._tag === 0 && _t6566._val === "string") {
                _t6567 = ({_tag: 3, _name: "TString"});
                break _t6568;
              }
              if (_t6566._tag === 0 && _t6566._val === "unit") {
                _t6567 = ({_tag: 6, _name: "TUnit"});
                break _t6568;
              }
              if (_t6566._tag === 0) {
                const name = _t6566._val;
                const canonical_6577 = Typechecker$resolve_type_alias(pre_ctx_6558.type_env, name);
                function _t6579(__p164) {
                  let _t6581;
                  const _t6580 = __p164;
                  _t6582: {
                    if (true) {
                      const n = _t6580[0];
                      _t6581 = (n === canonical_6577);
                      break _t6582;
                    }
                    _match_fail("line 16933");
                  }
                  return _t6581;
                }
                let _t6584;
                const _t6583 = List$find(_t6579, pre_ctx_6558.type_env.type_synonyms);
                _t6585: {
                  if (_t6583._tag === 1 && _t6583._val[1] === 0) {
                    const ty = _t6583._val[2];
                    _t6584 = ty;
                    break _t6585;
                  }
                  if (_t6583._tag === 1) {
                    const n = _t6583._val[1];
                    _t6584 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                    break _t6585;
                  }
                  if (_t6583._tag === 0) {
                    let _t6587;
                    const _t6586 = Typechecker$find_variant_info(pre_ctx_6558.type_env, name);
                    _t6588: {
                      if (_t6586._tag === 1 && _t6586._val[1] === 0) {
                        _t6587 = ({_tag: 12, _name: "TVariant", _val: [canonical_6577, null]});
                        break _t6588;
                      }
                      if (_t6586._tag === 1) {
                        const n = _t6586._val[1];
                        _t6587 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                        break _t6588;
                      }
                      if (_t6586._tag === 0) {
                        let _t6589;
                        if (!_eq(List$assoc_opt(canonical_6577, pre_ctx_6558.type_env.records), ({_tag: 0, _name: "None"}))) {
                          const fields_6590 = List$assoc(canonical_6577, pre_ctx_6558.type_env.records);
                          const _t6591 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6590)});
                          _t6589 = _t6591;
                        } else {
                          _t6589 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                        }
                        _t6587 = _t6589;
                        break _t6588;
                      }
                      _match_fail("line 16933");
                    }
                    _t6584 = _t6587;
                    break _t6585;
                  }
                  _match_fail("line 16933");
                }
                const _t6578 = _t6584;
                _t6567 = _t6578;
                break _t6568;
              }
              if (_t6566._tag === 2) {
                const a = _t6566._val[0];
                const b = _t6566._val[1];
                _t6567 = ({_tag: 7, _name: "TArrow", _val: [go(a), ({_tag: 1, _name: "EffEmpty"}), go(b)]});
                break _t6568;
              }
              if (_t6566._tag === 6) {
                const ts = _t6566._val;
                _t6567 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
                break _t6568;
              }
              if (_t6566._tag === 4) {
                const t = _t6566._val;
                _t6567 = ({_tag: 10, _name: "TList", _val: go(t)});
                break _t6568;
              }
              if (_t6566._tag === 5) {
                const t = _t6566._val;
                _t6567 = ({_tag: 13, _name: "TArray", _val: go(t)});
                break _t6568;
              }
              if (_t6566._tag === 7) {
                const args = _t6566._val[0];
                const tname = _t6566._val[1];
                const canonical_6592 = Typechecker$resolve_type_alias(pre_ctx_6558.type_env, tname);
                const arg_tys_6594 = List$map(go, args);
                function _t6596(__p165) {
                  let _t6598;
                  const _t6597 = __p165;
                  _t6599: {
                    if (true) {
                      const n = _t6597[0];
                      _t6598 = (n === canonical_6592);
                      break _t6599;
                    }
                    _match_fail("line 16933");
                  }
                  return _t6598;
                }
                let _t6601;
                const _t6600 = List$find(_t6596, pre_ctx_6558.type_env.type_synonyms);
                _t6602: {
                  if (_t6600._tag === 1) {
                    const np = _t6600._val[1];
                    const ty = _t6600._val[2];
                    let _t6603;
                    if ((List$length(arg_tys_6594) !== np)) {
                      _t6603 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6594))));
                    } else {
                      _t6603 = undefined;
                    }
                    _t6603;
                    _t6601 = Typechecker$subst_tgens(arg_tys_6594, ty);
                    break _t6602;
                  }
                  if (_t6600._tag === 0) {
                    let _t6605;
                    const _t6604 = Typechecker$find_variant_info(pre_ctx_6558.type_env, tname);
                    _t6606: {
                      if (_t6604._tag === 1) {
                        const np = _t6604._val[1];
                        let _t6607;
                        if ((List$length(arg_tys_6594) !== np)) {
                          _t6607 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6594))));
                        } else {
                          _t6607 = undefined;
                        }
                        _t6607;
                        _t6605 = ({_tag: 12, _name: "TVariant", _val: [canonical_6592, arg_tys_6594]});
                        break _t6606;
                      }
                      if (_t6604._tag === 0) {
                        _t6605 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                        break _t6606;
                      }
                      _match_fail("line 16933");
                    }
                    _t6601 = _t6605;
                    break _t6602;
                  }
                  _match_fail("line 16933");
                }
                const _t6595 = _t6601;
                const _t6593 = _t6595;
                _t6567 = _t6593;
                break _t6568;
              }
              if (_t6566._tag === 3) {
                const fields = _t6566._val[0];
                const is_open = _t6566._val[1];
                function _t6608(__p166) {
                  let _t6610;
                  const _t6609 = __p166;
                  _t6611: {
                    if (true) {
                      const n = _t6609[0];
                      const t = _t6609[1];
                      _t6610 = [n, go(t)];
                      break _t6611;
                    }
                    _match_fail("line 16933");
                  }
                  return _t6610;
                }
                const fields_6612 = List$map(_t6608, fields);
                function _t6614(__p167, __p168) {
                  let _t6616;
                  const _t6615 = __p167;
                  _t6617: {
                    if (true) {
                      const a = _t6615[0];
                      let _t6619;
                      const _t6618 = __p168;
                      _t6620: {
                        if (true) {
                          const b = _t6618[0];
                          _t6619 = String$compare(a, b);
                          break _t6620;
                        }
                        _match_fail("line 16933");
                      }
                      _t6616 = _t6619;
                      break _t6617;
                    }
                    _match_fail("line 16933");
                  }
                  return _t6616;
                }
                const fields_6621 = List$sort(_t6614, fields_6612);
                let _t6623;
                if (is_open) {
                  _t6623 = Types$new_rvar(0);
                } else {
                  _t6623 = ({_tag: 2, _name: "REmpty"});
                }
                const tail_6624 = _t6623;
                function _t6626(__p169, acc) {
                  let _t6628;
                  const _t6627 = __p169;
                  _t6629: {
                    if (true) {
                      const n = _t6627[0];
                      const t = _t6627[1];
                      _t6628 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                      break _t6629;
                    }
                    _match_fail("line 16933");
                  }
                  return _t6628;
                }
                const _t6625 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6626, fields_6621, tail_6624)});
                const _t6622 = _t6625;
                const _t6613 = _t6622;
                _t6567 = _t6613;
                break _t6568;
              }
              if (_t6566._tag === 8) {
                const path = _t6566._val[0];
                const name = _t6566._val[1];
                const qualified_6630 = (String$concat(".", path) + ("." + name));
                const _t6632 = ({_tag: 0, _name: "TyName", _val: qualified_6630});
                __x = _t6632;
                continue;
                const _t6631 = undefined;
                _t6567 = _t6631;
                break _t6568;
              }
              if (_t6566._tag === 9) {
                const _kind = _t6566._val[0];
                const tags = _t6566._val[1];
                function _t6633(__p170, acc) {
                  let _t6635;
                  const _t6634 = __p170;
                  _t6636: {
                    if (true) {
                      const tag = _t6634[0];
                      const payload_annot = _t6634[1];
                      _t6635 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload_annot), acc]});
                      break _t6636;
                    }
                    _match_fail("line 16933");
                  }
                  return _t6635;
                }
                const row_6637 = List$fold_right(_t6633, tags, ({_tag: 2, _name: "PVEmpty"}));
                const _t6638 = ({_tag: 14, _name: "TPolyVariant", _val: row_6637});
                _t6567 = _t6638;
                break _t6568;
              }
              if (_t6566._tag === 10) {
                const ty = _t6566._val[0];
                const _t6639 = ty;
                __x = _t6639;
                continue;
                _t6567 = undefined;
                break _t6568;
              }
              _match_fail("line 16933");
            }
            return _t6567;
          }
        }
        const _t6640 = go(annot);
        const _t6565 = _t6640;
        return _t6565;
      }
      const resolve_with_params_6641 = _t6563;
      function _t6643(__p171) {
        let _t6645;
        const _t6644 = __p171;
        _t6646: {
          if (true) {
            const ret = _t6644[2];
            _t6645 = !_eq(ret, ({_tag: 0, _name: "None"}));
            break _t6646;
          }
          _match_fail("line 16933");
        }
        return _t6645;
      }
      const is_gadt_6647 = List$exists(_t6643, ctors);
      function collect_annot_vars(acc, __x) {
        while (true) {
          let _t6650;
          const _t6649 = __x;
          _t6651: {
            if (_t6649._tag === 1) {
              const name = _t6649._val;
              let _t6652;
              if (List$mem(name, acc)) {
                _t6652 = acc;
              } else {
                _t6652 = ({_hd: name, _tl: acc});
              }
              _t6650 = _t6652;
              break _t6651;
            }
            if (_t6649._tag === 2) {
              const a = _t6649._val[0];
              const b = _t6649._val[1];
              const _t6653 = collect_annot_vars(acc, a);
              const _t6654 = b;
              acc = _t6653;
              __x = _t6654;
              continue;
              _t6650 = undefined;
              break _t6651;
            }
            if (_t6649._tag === 6) {
              const ts = _t6649._val;
              _t6650 = List$fold(collect_annot_vars, acc, ts);
              break _t6651;
            }
            if ((_t6649._tag === 4 || _t6649._tag === 5)) {
              const t = _t6649._val;
              const _t6655 = acc;
              const _t6656 = t;
              acc = _t6655;
              __x = _t6656;
              continue;
              _t6650 = undefined;
              break _t6651;
            }
            if (_t6649._tag === 7) {
              const args = _t6649._val[0];
              _t6650 = List$fold(collect_annot_vars, acc, args);
              break _t6651;
            }
            if (_t6649._tag === 3) {
              const fs = _t6649._val[0];
              function _t6657(a, __p172) {
                let _t6659;
                const _t6658 = __p172;
                _t6660: {
                  if (true) {
                    const t = _t6658[1];
                    _t6659 = collect_annot_vars(a, t);
                    break _t6660;
                  }
                  _match_fail("line 16933");
                }
                return _t6659;
              }
              _t6650 = List$fold(_t6657, acc, fs);
              break _t6651;
            }
            if ((_t6649._tag === 8 || _t6649._tag === 0)) {
              _t6650 = acc;
              break _t6651;
            }
            if (_t6649._tag === 9) {
              const tags = _t6649._val[1];
              function _t6661(a, __p173) {
                let _t6663;
                const _t6662 = __p173;
                _t6664: {
                  if (true) {
                    const ty_opt = _t6662[1];
                    let _t6666;
                    const _t6665 = ty_opt;
                    _t6667: {
                      if (_t6665._tag === 1) {
                        const t = _t6665._val;
                        _t6666 = collect_annot_vars(a, t);
                        break _t6667;
                      }
                      if (_t6665._tag === 0) {
                        _t6666 = a;
                        break _t6667;
                      }
                      _match_fail("line 16933");
                    }
                    _t6663 = _t6666;
                    break _t6664;
                  }
                  _match_fail("line 16933");
                }
                return _t6663;
              }
              _t6650 = List$fold(_t6661, acc, tags);
              break _t6651;
            }
            if (_t6649._tag === 10) {
              const ty = _t6649._val[0];
              const _t6668 = acc;
              const _t6669 = ty;
              acc = _t6668;
              __x = _t6669;
              continue;
              _t6650 = undefined;
              break _t6651;
            }
            _match_fail("line 16933");
          }
          return _t6650;
        }
      }
      function _t6671(__dict_Show_0, __p174) {
        let _t6673;
        const _t6672 = __p174;
        _t6674: {
          if (true) {
            const name = _t6672[0];
            const arg_annot = _t6672[1];
            const ret_annot = _t6672[2];
            let _t6676;
            const _t6675 = ret_annot;
            _t6677: {
              if (_t6675._tag === 0) {
                const arg_ty_6678 = Option$map(resolve_with_params_6641, arg_annot);
                const info_6680 = ({ctor_arg_ty: arg_ty_6678, ctor_existentials: 0, ctor_num_params: num_params_6549, ctor_return_ty_params: ({_tag: 0, _name: "None"}), ctor_type_name: type_name});
                const _t6681 = [[name, arg_ty_6678], [name, info_6680]];
                const _t6679 = _t6681;
                _t6676 = _t6679;
                break _t6677;
              }
              if (_t6675._tag === 1) {
                const ret = _t6675._val;
                let _t6683;
                const _t6682 = ret;
                _t6684: {
                  if (_t6682._tag === 0) {
                    const n = _t6682._val;
                    _t6683 = [n, null];
                    break _t6684;
                  }
                  if (_t6682._tag === 7) {
                    const args = _t6682._val[0];
                    const n = _t6682._val[1];
                    _t6683 = [n, args];
                    break _t6684;
                  }
                  if (true) {
                    _t6683 = Typechecker$error(((("GADT constructor " + __dict_Show_0.show(name)) + ": return type must be ") + __dict_Show_string.show(type_name)));
                    break _t6684;
                  }
                  _match_fail("line 16933");
                }
                let _t6686;
                const _t6685 = _t6683;
                _t6687: {
                  if (true) {
                    const ret_type_name = _t6685[0];
                    const ret_type_args = _t6685[1];
                    const canonical_ret_6688 = Typechecker$resolve_type_alias(pre_ctx_6558.type_env, ret_type_name);
                    let _t6695;
                    if ((canonical_ret_6688 === type_name)) {
                      _t6695 = true;
                    } else {
                    let _t6691;
                    const _t6690 = String$rindex_opt(type_name, 46);
                    _t6692: {
                      if (_t6690._tag === 1) {
                        const i = _t6690._val;
                        const _mml$short_6693 = String$sub(type_name, (i + 1), ((String$length(type_name) - i) - 1));
                        const _t6694 = (ret_type_name === _mml$short_6693);
                        _t6691 = _t6694;
                        break _t6692;
                      }
                      if (_t6690._tag === 0) {
                        _t6691 = false;
                        break _t6692;
                      }
                      _match_fail("line 16933");
                    }
                      _t6695 = _t6691;
                    }
                    const name_matches_6696 = _t6695;
                    let _t6698;
                    if ((!name_matches_6696)) {
                      _t6698 = Typechecker$error(((((("GADT constructor " + __dict_Show_0.show(name)) + ": return type must be ") + __dict_Show_string.show(type_name)) + ", got ") + __dict_Show_string.show(ret_type_name)));
                    } else {
                      _t6698 = undefined;
                    }
                    _t6698;
                    let _t6699;
                    if ((List$length(ret_type_args) !== num_params_6549)) {
                      _t6699 = Typechecker$error(((((("GADT constructor " + __dict_Show_0.show(name)) + ": return type has ") + __dict_Show_int.show(List$length(ret_type_args))) + " type arg(s), expected ") + __dict_Show_int.show(num_params_6549)));
                    } else {
                      _t6699 = undefined;
                    }
                    _t6699;
                    const ret_vars_6700 = List$fold(collect_annot_vars, null, ret_type_args);
                    let _t6703;
                    const _t6702 = arg_annot;
                    _t6704: {
                      if (_t6702._tag === 0) {
                        _t6703 = null;
                        break _t6704;
                      }
                      if (_t6702._tag === 1) {
                        const a = _t6702._val;
                        _t6703 = collect_annot_vars(null, a);
                        break _t6704;
                      }
                      _match_fail("line 16933");
                    }
                    const arg_vars_6705 = _t6703;
                    function _t6707(v) {
                      return ((!List$mem(v, ret_vars_6700)) && (!List$mem(v, type_params)));
                    }
                    const existentials_6708 = List$filter(_t6707, arg_vars_6705);
                    const num_exist_6710 = List$length(existentials_6708);
                    const gadt_tbl_6712 = Hashtbl$create(8);
                    function _t6714(i, p) {
                      return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, gadt_tbl_6712, p, i]);
                    }
                    List$iteri(_t6714, type_params);
                    function _t6715(i, e) {
                      return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, gadt_tbl_6712, e, (num_params_6549 + i)]);
                    }
                    List$iteri(_t6715, existentials_6708);
                    const gadt_tvars_6716 = Hashtbl$create(4);
                    function gadt_resolve(__x) {
                      while (true) {
                        let _t6719;
                        const _t6718 = __x;
                        _t6720: {
                          if (_t6718._tag === 1) {
                            const vname = _t6718._val;
                            let _t6722;
                            const _t6721 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, gadt_tbl_6712, vname]);
                            _t6723: {
                              if (_t6721._tag === 1) {
                                const idx = _t6721._val;
                                _t6722 = ({_tag: 16, _name: "TGen", _val: idx});
                                break _t6723;
                              }
                              if (_t6721._tag === 0) {
                                let _t6725;
                                const _t6724 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, gadt_tvars_6716, vname]);
                                _t6726: {
                                  if (_t6724._tag === 1) {
                                    const tv = _t6724._val;
                                    _t6725 = tv;
                                    break _t6726;
                                  }
                                  if (_t6724._tag === 0) {
                                    const tv_6727 = Types$new_tvar(0);
                                    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, gadt_tvars_6716, vname, tv_6727]);
                                    const _t6728 = tv_6727;
                                    _t6725 = _t6728;
                                    break _t6726;
                                  }
                                  _match_fail("line 16933");
                                }
                                _t6722 = _t6725;
                                break _t6723;
                              }
                              _match_fail("line 16933");
                            }
                            _t6719 = _t6722;
                            break _t6720;
                          }
                          if (_t6718._tag === 0 && _t6718._val === "int") {
                            _t6719 = ({_tag: 0, _name: "TInt"});
                            break _t6720;
                          }
                          if (_t6718._tag === 0 && _t6718._val === "float") {
                            _t6719 = ({_tag: 1, _name: "TFloat"});
                            break _t6720;
                          }
                          if (_t6718._tag === 0 && _t6718._val === "bool") {
                            _t6719 = ({_tag: 2, _name: "TBool"});
                            break _t6720;
                          }
                          if (_t6718._tag === 0 && _t6718._val === "string") {
                            _t6719 = ({_tag: 3, _name: "TString"});
                            break _t6720;
                          }
                          if (_t6718._tag === 0 && _t6718._val === "unit") {
                            _t6719 = ({_tag: 6, _name: "TUnit"});
                            break _t6720;
                          }
                          if (_t6718._tag === 0) {
                            const n = _t6718._val;
                            const canonical_6729 = Typechecker$resolve_type_alias(pre_ctx_6558.type_env, n);
                            function _t6731(__p175) {
                              let _t6733;
                              const _t6732 = __p175;
                              _t6734: {
                                if (true) {
                                  const tn = _t6732[0];
                                  _t6733 = (tn === canonical_6729);
                                  break _t6734;
                                }
                                _match_fail("line 16933");
                              }
                              return _t6733;
                            }
                            let _t6736;
                            const _t6735 = List$find(_t6731, pre_ctx_6558.type_env.type_synonyms);
                            _t6737: {
                              if (_t6735._tag === 1 && _t6735._val[1] === 0) {
                                const ty = _t6735._val[2];
                                _t6736 = ty;
                                break _t6737;
                              }
                              if (_t6735._tag === 1) {
                                const np = _t6735._val[1];
                                _t6736 = Typechecker$error((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s)"));
                                break _t6737;
                              }
                              if (_t6735._tag === 0) {
                                let _t6739;
                                const _t6738 = Typechecker$find_variant_info(pre_ctx_6558.type_env, n);
                                _t6740: {
                                  if (_t6738._tag === 1 && _t6738._val[1] === 0) {
                                    _t6739 = ({_tag: 12, _name: "TVariant", _val: [canonical_6729, null]});
                                    break _t6740;
                                  }
                                  if (_t6738._tag === 1) {
                                    const np = _t6738._val[1];
                                    _t6739 = Typechecker$error((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s)"));
                                    break _t6740;
                                  }
                                  if (_t6738._tag === 0) {
                                    let _t6741;
                                    if (!_eq(List$assoc_opt(canonical_6729, pre_ctx_6558.type_env.records), ({_tag: 0, _name: "None"}))) {
                                      const fields_6742 = List$assoc(canonical_6729, pre_ctx_6558.type_env.records);
                                      let _t6744;
                                      if (_eq(fields_6742, null)) {
                                        _t6744 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                                      } else {
                                        _t6744 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6742)});
                                      }
                                      const _t6743 = _t6744;
                                      _t6741 = _t6743;
                                    } else {
                                      _t6741 = Typechecker$error(("unknown type: " + __dict_Show_string.show(n)));
                                    }
                                    _t6739 = _t6741;
                                    break _t6740;
                                  }
                                  _match_fail("line 16933");
                                }
                                _t6736 = _t6739;
                                break _t6737;
                              }
                              _match_fail("line 16933");
                            }
                            const _t6730 = _t6736;
                            _t6719 = _t6730;
                            break _t6720;
                          }
                          if (_t6718._tag === 2) {
                            const a = _t6718._val[0];
                            const b = _t6718._val[1];
                            _t6719 = ({_tag: 7, _name: "TArrow", _val: [gadt_resolve(a), ({_tag: 1, _name: "EffEmpty"}), gadt_resolve(b)]});
                            break _t6720;
                          }
                          if (_t6718._tag === 6) {
                            const ts = _t6718._val;
                            _t6719 = ({_tag: 9, _name: "TTuple", _val: List$map(gadt_resolve, ts)});
                            break _t6720;
                          }
                          if (_t6718._tag === 4) {
                            const t = _t6718._val;
                            _t6719 = ({_tag: 10, _name: "TList", _val: gadt_resolve(t)});
                            break _t6720;
                          }
                          if (_t6718._tag === 5) {
                            const t = _t6718._val;
                            _t6719 = ({_tag: 13, _name: "TArray", _val: gadt_resolve(t)});
                            break _t6720;
                          }
                          if (_t6718._tag === 7) {
                            const args = _t6718._val[0];
                            const tname = _t6718._val[1];
                            const canonical_6745 = Typechecker$resolve_type_alias(pre_ctx_6558.type_env, tname);
                            const arg_tys_6747 = List$map(gadt_resolve, args);
                            function _t6749(__p176) {
                              let _t6751;
                              const _t6750 = __p176;
                              _t6752: {
                                if (true) {
                                  const tn = _t6750[0];
                                  _t6751 = (tn === canonical_6745);
                                  break _t6752;
                                }
                                _match_fail("line 16933");
                              }
                              return _t6751;
                            }
                            let _t6754;
                            const _t6753 = List$find(_t6749, pre_ctx_6558.type_env.type_synonyms);
                            _t6755: {
                              if (_t6753._tag === 1) {
                                const np = _t6753._val[1];
                                const ty = _t6753._val[2];
                                let _t6756;
                                if ((List$length(arg_tys_6747) !== np)) {
                                  _t6756 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6747))));
                                } else {
                                  _t6756 = undefined;
                                }
                                _t6756;
                                _t6754 = Typechecker$subst_tgens(arg_tys_6747, ty);
                                break _t6755;
                              }
                              if (_t6753._tag === 0) {
                                let _t6758;
                                const _t6757 = Typechecker$find_variant_info(pre_ctx_6558.type_env, tname);
                                _t6759: {
                                  if (_t6757._tag === 1) {
                                    const np = _t6757._val[1];
                                    let _t6760;
                                    if ((List$length(arg_tys_6747) !== np)) {
                                      _t6760 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6747))));
                                    } else {
                                      _t6760 = undefined;
                                    }
                                    _t6760;
                                    _t6758 = ({_tag: 12, _name: "TVariant", _val: [canonical_6745, arg_tys_6747]});
                                    break _t6759;
                                  }
                                  if (_t6757._tag === 0) {
                                    _t6758 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                                    break _t6759;
                                  }
                                  _match_fail("line 16933");
                                }
                                _t6754 = _t6758;
                                break _t6755;
                              }
                              _match_fail("line 16933");
                            }
                            const _t6748 = _t6754;
                            const _t6746 = _t6748;
                            _t6719 = _t6746;
                            break _t6720;
                          }
                          if (_t6718._tag === 3) {
                            const fields = _t6718._val[0];
                            const is_open = _t6718._val[1];
                            function _t6761(__p177, __p178) {
                              let _t6763;
                              const _t6762 = __p177;
                              _t6764: {
                                if (true) {
                                  const a = _t6762[0];
                                  let _t6766;
                                  const _t6765 = __p178;
                                  _t6767: {
                                    if (true) {
                                      const b = _t6765[0];
                                      _t6766 = String$compare(a, b);
                                      break _t6767;
                                    }
                                    _match_fail("line 16933");
                                  }
                                  _t6763 = _t6766;
                                  break _t6764;
                                }
                                _match_fail("line 16933");
                              }
                              return _t6763;
                            }
                            function _t6768(__p179) {
                              let _t6770;
                              const _t6769 = __p179;
                              _t6771: {
                                if (true) {
                                  const fn_ = _t6769[0];
                                  const ft = _t6769[1];
                                  _t6770 = [fn_, gadt_resolve(ft)];
                                  break _t6771;
                                }
                                _match_fail("line 16933");
                              }
                              return _t6770;
                            }
                            const fields_6772 = List$sort(_t6761, List$map(_t6768, fields));
                            let _t6774;
                            if (is_open) {
                              _t6774 = Types$new_rvar(0);
                            } else {
                              _t6774 = ({_tag: 2, _name: "REmpty"});
                            }
                            const tail_6775 = _t6774;
                            function _t6777(__p180, acc) {
                              let _t6779;
                              const _t6778 = __p180;
                              _t6780: {
                                if (true) {
                                  const n = _t6778[0];
                                  const t = _t6778[1];
                                  _t6779 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                                  break _t6780;
                                }
                                _match_fail("line 16933");
                              }
                              return _t6779;
                            }
                            const _t6776 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6777, fields_6772, tail_6775)});
                            const _t6773 = _t6776;
                            _t6719 = _t6773;
                            break _t6720;
                          }
                          if (_t6718._tag === 8) {
                            const path = _t6718._val[0];
                            const n = _t6718._val[1];
                            const qualified_6781 = (String$concat(".", path) + ("." + n));
                            const _t6783 = ({_tag: 0, _name: "TyName", _val: qualified_6781});
                            __x = _t6783;
                            continue;
                            const _t6782 = undefined;
                            _t6719 = _t6782;
                            break _t6720;
                          }
                          if (_t6718._tag === 9) {
                            const _kind = _t6718._val[0];
                            const tags = _t6718._val[1];
                            function _t6784(__p181, acc) {
                              let _t6786;
                              const _t6785 = __p181;
                              _t6787: {
                                if (true) {
                                  const tag = _t6785[0];
                                  const payload_annot = _t6785[1];
                                  _t6786 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(gadt_resolve, payload_annot), acc]});
                                  break _t6787;
                                }
                                _match_fail("line 16933");
                              }
                              return _t6786;
                            }
                            const row_6788 = List$fold_right(_t6784, tags, ({_tag: 2, _name: "PVEmpty"}));
                            const _t6789 = ({_tag: 14, _name: "TPolyVariant", _val: row_6788});
                            _t6719 = _t6789;
                            break _t6720;
                          }
                          if (_t6718._tag === 10) {
                            const ty = _t6718._val[0];
                            const _t6790 = ty;
                            __x = _t6790;
                            continue;
                            _t6719 = undefined;
                            break _t6720;
                          }
                          _match_fail("line 16933");
                        }
                        return _t6719;
                      }
                    }
                    const arg_ty_6792 = Option$map(gadt_resolve, arg_annot);
                    const ret_params_6794 = List$map(gadt_resolve, ret_type_args);
                    const info_6796 = ({ctor_arg_ty: arg_ty_6792, ctor_existentials: num_exist_6710, ctor_num_params: num_params_6549, ctor_return_ty_params: ({_tag: 1, _name: "Some", _val: ret_params_6794}), ctor_type_name: type_name});
                    const _t6797 = [[name, arg_ty_6792], [name, info_6796]];
                    const _t6795 = _t6797;
                    const _t6793 = _t6795;
                    const _t6791 = _t6793;
                    const _t6717 = _t6791;
                    const _t6713 = _t6717;
                    const _t6711 = _t6713;
                    const _t6709 = _t6711;
                    const _t6706 = _t6709;
                    const _t6701 = _t6706;
                    const _t6697 = _t6701;
                    const _t6689 = _t6697;
                    _t6686 = _t6689;
                    break _t6687;
                  }
                  _match_fail("line 16933");
                }
                _t6676 = _t6686;
                break _t6677;
              }
              _match_fail("line 16933");
            }
            _t6673 = _t6676;
            break _t6674;
          }
          _match_fail("line 16933");
        }
        return _t6673;
      }
      const process_ctor_6798 = _t6671;
      const results_6800 = List$map(_call(process_ctor_6798, [__dict_Show_string]), ctors);
      const variant_def_6802 = List$map(fst, results_6800);
      const ctor_infos_6804 = List$map(snd, results_6800);
      const __rec_upd_6806 = ctx.type_env;
      const _t6807 = ({classes: __rec_upd_6806.classes, constructors: List$concat(ctor_infos_6804, ctx.type_env.constructors), effects: __rec_upd_6806.effects, hidden_ctor_types: __rec_upd_6806.hidden_ctor_types, hidden_types: __rec_upd_6806.hidden_types, instances: __rec_upd_6806.instances, modules: __rec_upd_6806.modules, mutable_fields: __rec_upd_6806.mutable_fields, newtypes: __rec_upd_6806.newtypes, records: __rec_upd_6806.records, type_aliases: __rec_upd_6806.type_aliases, type_synonyms: __rec_upd_6806.type_synonyms, variants: ({_hd: [type_name, num_params_6549, variant_def_6802, is_gadt_6647], _tl: ctx.type_env.variants})});
      const type_env_6808 = _t6807;
      const __rec_upd_6810 = ctx;
      const _t6811 = ({constraint_tvars: __rec_upd_6810.constraint_tvars, current_eff: __rec_upd_6810.current_eff, current_module: __rec_upd_6810.current_module, inside_handler: __rec_upd_6810.inside_handler, loop_info: __rec_upd_6810.loop_info, mutable_vars: __rec_upd_6810.mutable_vars, return_type: __rec_upd_6810.return_type, return_used: __rec_upd_6810.return_used, type_env: type_env_6808, vars: __rec_upd_6810.vars});
      const _t6809 = _t6811;
      const _t6805 = _t6809;
      const _t6803 = _t6805;
      const _t6801 = _t6803;
      const _t6799 = _t6801;
      const _t6670 = _t6799;
      const _t6648 = _t6670;
      const _t6642 = _t6648;
      const _t6561 = _t6642;
      const _t6559 = _t6561;
      _t6552 = _t6559;
      break _t6553;
    }
    if (_t6551._tag === 1) {
      const fields = _t6551._val;
      const __rec_upd_6812 = ctx;
      const __rec_upd_6814 = ctx.type_env;
      const _t6815 = ({classes: __rec_upd_6814.classes, constructors: __rec_upd_6814.constructors, effects: __rec_upd_6814.effects, hidden_ctor_types: __rec_upd_6814.hidden_ctor_types, hidden_types: __rec_upd_6814.hidden_types, instances: __rec_upd_6814.instances, modules: __rec_upd_6814.modules, mutable_fields: __rec_upd_6814.mutable_fields, newtypes: __rec_upd_6814.newtypes, records: ({_hd: [type_name, null], _tl: ctx.type_env.records}), type_aliases: __rec_upd_6814.type_aliases, type_synonyms: __rec_upd_6814.type_synonyms, variants: __rec_upd_6814.variants});
      const _t6813 = ({constraint_tvars: __rec_upd_6812.constraint_tvars, current_eff: __rec_upd_6812.current_eff, current_module: __rec_upd_6812.current_module, inside_handler: __rec_upd_6812.inside_handler, loop_info: __rec_upd_6812.loop_info, mutable_vars: __rec_upd_6812.mutable_vars, return_type: __rec_upd_6812.return_type, return_used: __rec_upd_6812.return_used, type_env: _t6815, vars: __rec_upd_6812.vars});
      const pre_ctx_6816 = _t6813;
      const param_tbl_6818 = Hashtbl$create(4);
      function _t6820(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6818, name, i]);
      }
      List$iteri(_t6820, type_params);
      function _t6821(__p182) {
        let _t6823;
        const _t6822 = __p182;
        _t6824: {
          if (true) {
            const _is_mut = _t6822[0];
            const name = _t6822[1];
            const annot = _t6822[2];
            const tvars_6825 = Hashtbl$create(4);
            function resolve_field(__x) {
              while (true) {
                let _t6828;
                const _t6827 = __x;
                _t6829: {
                  if (_t6827._tag === 1) {
                    const vname = _t6827._val;
                    let _t6831;
                    const _t6830 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6818, vname]);
                    _t6832: {
                      if (_t6830._tag === 1) {
                        const idx = _t6830._val;
                        _t6831 = ({_tag: 16, _name: "TGen", _val: idx});
                        break _t6832;
                      }
                      if (_t6830._tag === 0) {
                        let _t6834;
                        const _t6833 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6825, vname]);
                        _t6835: {
                          if (_t6833._tag === 1) {
                            const tv = _t6833._val;
                            _t6834 = tv;
                            break _t6835;
                          }
                          if (_t6833._tag === 0) {
                            const tv_6836 = Types$new_tvar(0);
                            _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6825, vname, tv_6836]);
                            const _t6837 = tv_6836;
                            _t6834 = _t6837;
                            break _t6835;
                          }
                          _match_fail("line 16933");
                        }
                        _t6831 = _t6834;
                        break _t6832;
                      }
                      _match_fail("line 16933");
                    }
                    _t6828 = _t6831;
                    break _t6829;
                  }
                  if (_t6827._tag === 0 && _t6827._val === "int") {
                    _t6828 = ({_tag: 0, _name: "TInt"});
                    break _t6829;
                  }
                  if (_t6827._tag === 0 && _t6827._val === "float") {
                    _t6828 = ({_tag: 1, _name: "TFloat"});
                    break _t6829;
                  }
                  if (_t6827._tag === 0 && _t6827._val === "bool") {
                    _t6828 = ({_tag: 2, _name: "TBool"});
                    break _t6829;
                  }
                  if (_t6827._tag === 0 && _t6827._val === "string") {
                    _t6828 = ({_tag: 3, _name: "TString"});
                    break _t6829;
                  }
                  if (_t6827._tag === 0 && _t6827._val === "unit") {
                    _t6828 = ({_tag: 6, _name: "TUnit"});
                    break _t6829;
                  }
                  if (_t6827._tag === 0) {
                    const n = _t6827._val;
                    _t6828 = Typechecker$resolve_ty_annot(pre_ctx_6816, 0, ({_tag: 0, _name: "TyName", _val: n}));
                    break _t6829;
                  }
                  if (_t6827._tag === 2) {
                    const a = _t6827._val[0];
                    const b = _t6827._val[1];
                    _t6828 = ({_tag: 7, _name: "TArrow", _val: [resolve_field(a), ({_tag: 1, _name: "EffEmpty"}), resolve_field(b)]});
                    break _t6829;
                  }
                  if (_t6827._tag === 6) {
                    const ts = _t6827._val;
                    _t6828 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve_field, ts)});
                    break _t6829;
                  }
                  if (_t6827._tag === 4) {
                    const t = _t6827._val;
                    _t6828 = ({_tag: 10, _name: "TList", _val: resolve_field(t)});
                    break _t6829;
                  }
                  if (_t6827._tag === 5) {
                    const t = _t6827._val;
                    _t6828 = ({_tag: 13, _name: "TArray", _val: resolve_field(t)});
                    break _t6829;
                  }
                  if (_t6827._tag === 7) {
                    const args = _t6827._val[0];
                    const n = _t6827._val[1];
                    const arg_tys_6838 = List$map(resolve_field, args);
                    function _t6840(__p183) {
                      let _t6842;
                      const _t6841 = __p183;
                      _t6843: {
                        if (true) {
                          const tn = _t6841[0];
                          _t6842 = (tn === n);
                          break _t6843;
                        }
                        _match_fail("line 16933");
                      }
                      return _t6842;
                    }
                    let _t6845;
                    const _t6844 = List$find(_t6840, pre_ctx_6816.type_env.type_synonyms);
                    _t6846: {
                      if (_t6844._tag === 1) {
                        const np = _t6844._val[1];
                        const ty = _t6844._val[2];
                        let _t6847;
                        if ((List$length(arg_tys_6838) !== np)) {
                          _t6847 = Typechecker$error(((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " arg(s), got ") + __dict_Show_int.show(List$length(arg_tys_6838))));
                        } else {
                          _t6847 = undefined;
                        }
                        _t6847;
                        _t6845 = Typechecker$subst_tgens(arg_tys_6838, ty);
                        break _t6846;
                      }
                      if (_t6844._tag === 0) {
                        let _t6849;
                        const _t6848 = Typechecker$find_variant_info(pre_ctx_6816.type_env, n);
                        _t6850: {
                          if (_t6848._tag === 1) {
                            const np = _t6848._val[1];
                            let _t6851;
                            if ((List$length(arg_tys_6838) !== np)) {
                              _t6851 = Typechecker$error(((((("type " + __dict_Show_string.show(n)) + " expects ") + __dict_Show_int.show(np)) + " arg(s), got ") + __dict_Show_int.show(List$length(arg_tys_6838))));
                            } else {
                              _t6851 = undefined;
                            }
                            _t6851;
                            const canonical_6852 = Typechecker$resolve_type_alias(pre_ctx_6816.type_env, n);
                            const _t6853 = ({_tag: 12, _name: "TVariant", _val: [canonical_6852, arg_tys_6838]});
                            _t6849 = _t6853;
                            break _t6850;
                          }
                          if (_t6848._tag === 0) {
                            _t6849 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(n)));
                            break _t6850;
                          }
                          _match_fail("line 16933");
                        }
                        _t6845 = _t6849;
                        break _t6846;
                      }
                      _match_fail("line 16933");
                    }
                    const _t6839 = _t6845;
                    _t6828 = _t6839;
                    break _t6829;
                  }
                  if (_t6827._tag === 3) {
                    const fs = _t6827._val[0];
                    const is_open = _t6827._val[1];
                    function _t6854(__p184, __p185) {
                      let _t6856;
                      const _t6855 = __p184;
                      _t6857: {
                        if (true) {
                          const a = _t6855[0];
                          let _t6859;
                          const _t6858 = __p185;
                          _t6860: {
                            if (true) {
                              const b = _t6858[0];
                              _t6859 = String$compare(a, b);
                              break _t6860;
                            }
                            _match_fail("line 16933");
                          }
                          _t6856 = _t6859;
                          break _t6857;
                        }
                        _match_fail("line 16933");
                      }
                      return _t6856;
                    }
                    function _t6861(__p186) {
                      let _t6863;
                      const _t6862 = __p186;
                      _t6864: {
                        if (true) {
                          const fn_ = _t6862[0];
                          const ft = _t6862[1];
                          _t6863 = [fn_, resolve_field(ft)];
                          break _t6864;
                        }
                        _match_fail("line 16933");
                      }
                      return _t6863;
                    }
                    const fields_6865 = List$sort(_t6854, List$map(_t6861, fs));
                    let _t6867;
                    if (is_open) {
                      _t6867 = Types$new_rvar(0);
                    } else {
                      _t6867 = ({_tag: 2, _name: "REmpty"});
                    }
                    const tail_6868 = _t6867;
                    function _t6870(__p187, acc) {
                      let _t6872;
                      const _t6871 = __p187;
                      _t6873: {
                        if (true) {
                          const n = _t6871[0];
                          const t = _t6871[1];
                          _t6872 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                          break _t6873;
                        }
                        _match_fail("line 16933");
                      }
                      return _t6872;
                    }
                    const _t6869 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6870, fields_6865, tail_6868)});
                    const _t6866 = _t6869;
                    _t6828 = _t6866;
                    break _t6829;
                  }
                  if (_t6827._tag === 8) {
                    const path = _t6827._val[0];
                    const n = _t6827._val[1];
                    const qualified_6874 = (String$concat(".", path) + ("." + n));
                    const _t6876 = ({_tag: 0, _name: "TyName", _val: qualified_6874});
                    __x = _t6876;
                    continue;
                    const _t6875 = undefined;
                    _t6828 = _t6875;
                    break _t6829;
                  }
                  if (_t6827._tag === 9) {
                    const _kind = _t6827._val[0];
                    const tags = _t6827._val[1];
                    function _t6877(__p188, acc) {
                      let _t6879;
                      const _t6878 = __p188;
                      _t6880: {
                        if (true) {
                          const tag = _t6878[0];
                          const payload_annot = _t6878[1];
                          _t6879 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve_field, payload_annot), acc]});
                          break _t6880;
                        }
                        _match_fail("line 16933");
                      }
                      return _t6879;
                    }
                    const row_6881 = List$fold_right(_t6877, tags, ({_tag: 2, _name: "PVEmpty"}));
                    const _t6882 = ({_tag: 14, _name: "TPolyVariant", _val: row_6881});
                    _t6828 = _t6882;
                    break _t6829;
                  }
                  if (_t6827._tag === 10) {
                    const ty = _t6827._val[0];
                    const _t6883 = ty;
                    __x = _t6883;
                    continue;
                    _t6828 = undefined;
                    break _t6829;
                  }
                  _match_fail("line 16933");
                }
                return _t6828;
              }
            }
            const _t6884 = [name, resolve_field(annot)];
            const _t6826 = _t6884;
            _t6823 = _t6826;
            break _t6824;
          }
          _match_fail("line 16933");
        }
        return _t6823;
      }
      const typed_fields_6885 = List$map(_t6821, fields);
      function _t6887(__p189) {
        let _t6889;
        const _t6888 = __p189;
        _t6890: {
          if (true) {
            const is_mut = _t6888[0];
            const name = _t6888[1];
            let _t6891;
            if (is_mut) {
              _t6891 = ({_tag: 1, _name: "Some", _val: name});
            } else {
              _t6891 = ({_tag: 0, _name: "None"});
            }
            _t6889 = _t6891;
            break _t6890;
          }
          _match_fail("line 16933");
        }
        return _t6889;
      }
      const mut_fields_6892 = List$filter_map(_t6887, fields);
      function _t6894(__p190, __p191) {
        let _t6896;
        const _t6895 = __p190;
        _t6897: {
          if (true) {
            const a = _t6895[0];
            let _t6899;
            const _t6898 = __p191;
            _t6900: {
              if (true) {
                const b = _t6898[0];
                _t6899 = String$compare(a, b);
                break _t6900;
              }
              _match_fail("line 16933");
            }
            _t6896 = _t6899;
            break _t6897;
          }
          _match_fail("line 16933");
        }
        return _t6896;
      }
      const sorted_fields_6901 = List$sort(_t6894, typed_fields_6885);
      const __rec_upd_6903 = ctx.type_env;
      const _t6904 = ({classes: __rec_upd_6903.classes, constructors: __rec_upd_6903.constructors, effects: __rec_upd_6903.effects, hidden_ctor_types: __rec_upd_6903.hidden_ctor_types, hidden_types: __rec_upd_6903.hidden_types, instances: __rec_upd_6903.instances, modules: __rec_upd_6903.modules, mutable_fields: List$concat(mut_fields_6892, ctx.type_env.mutable_fields), newtypes: __rec_upd_6903.newtypes, records: ({_hd: [type_name, sorted_fields_6901], _tl: ctx.type_env.records}), type_aliases: __rec_upd_6903.type_aliases, type_synonyms: ({_hd: [type_name, num_params_6549, ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(sorted_fields_6901)})], _tl: ctx.type_env.type_synonyms}), variants: __rec_upd_6903.variants});
      const type_env_6905 = _t6904;
      const __rec_upd_6907 = ctx;
      const _t6908 = ({constraint_tvars: __rec_upd_6907.constraint_tvars, current_eff: __rec_upd_6907.current_eff, current_module: __rec_upd_6907.current_module, inside_handler: __rec_upd_6907.inside_handler, loop_info: __rec_upd_6907.loop_info, mutable_vars: __rec_upd_6907.mutable_vars, return_type: __rec_upd_6907.return_type, return_used: __rec_upd_6907.return_used, type_env: type_env_6905, vars: __rec_upd_6907.vars});
      const _t6906 = _t6908;
      const _t6902 = _t6906;
      const _t6893 = _t6902;
      const _t6886 = _t6893;
      const _t6819 = _t6886;
      const _t6817 = _t6819;
      _t6552 = _t6817;
      break _t6553;
    }
    if (_t6551._tag === 2) {
      const annot = _t6551._val;
      const param_tbl_6909 = Hashtbl$create(4);
      function _t6911(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6909, name, i]);
      }
      List$iteri(_t6911, type_params);
      const tvars_6912 = Hashtbl$create(4);
      function resolve_alias(__x) {
        while (true) {
          let _t6915;
          const _t6914 = __x;
          _t6916: {
            if (_t6914._tag === 1) {
              const name = _t6914._val;
              let _t6918;
              const _t6917 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6909, name]);
              _t6919: {
                if (_t6917._tag === 1) {
                  const idx = _t6917._val;
                  _t6918 = ({_tag: 16, _name: "TGen", _val: idx});
                  break _t6919;
                }
                if (_t6917._tag === 0) {
                  let _t6921;
                  const _t6920 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_6912, name]);
                  _t6922: {
                    if (_t6920._tag === 1) {
                      const tv = _t6920._val;
                      _t6921 = tv;
                      break _t6922;
                    }
                    if (_t6920._tag === 0) {
                      const tv_6923 = Types$new_tvar(0);
                      _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_6912, name, tv_6923]);
                      const _t6924 = tv_6923;
                      _t6921 = _t6924;
                      break _t6922;
                    }
                    _match_fail("line 16933");
                  }
                  _t6918 = _t6921;
                  break _t6919;
                }
                _match_fail("line 16933");
              }
              _t6915 = _t6918;
              break _t6916;
            }
            if (_t6914._tag === 0 && _t6914._val === "int") {
              _t6915 = ({_tag: 0, _name: "TInt"});
              break _t6916;
            }
            if (_t6914._tag === 0 && _t6914._val === "float") {
              _t6915 = ({_tag: 1, _name: "TFloat"});
              break _t6916;
            }
            if (_t6914._tag === 0 && _t6914._val === "bool") {
              _t6915 = ({_tag: 2, _name: "TBool"});
              break _t6916;
            }
            if (_t6914._tag === 0 && _t6914._val === "string") {
              _t6915 = ({_tag: 3, _name: "TString"});
              break _t6916;
            }
            if (_t6914._tag === 0 && _t6914._val === "unit") {
              _t6915 = ({_tag: 6, _name: "TUnit"});
              break _t6916;
            }
            if (_t6914._tag === 0) {
              const name = _t6914._val;
              const canonical_6925 = Typechecker$resolve_type_alias(ctx.type_env, name);
              function _t6927(__p192) {
                let _t6929;
                const _t6928 = __p192;
                _t6930: {
                  if (true) {
                    const n = _t6928[0];
                    _t6929 = (n === canonical_6925);
                    break _t6930;
                  }
                  _match_fail("line 16933");
                }
                return _t6929;
              }
              let _t6932;
              const _t6931 = List$find(_t6927, ctx.type_env.type_synonyms);
              _t6933: {
                if (_t6931._tag === 1 && _t6931._val[1] === 0) {
                  const ty = _t6931._val[2];
                  _t6932 = ty;
                  break _t6933;
                }
                if (_t6931._tag === 1) {
                  const n = _t6931._val[1];
                  _t6932 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                  break _t6933;
                }
                if (_t6931._tag === 0) {
                  let _t6935;
                  const _t6934 = Typechecker$find_variant_info(ctx.type_env, name);
                  _t6936: {
                    if (_t6934._tag === 1 && _t6934._val[1] === 0) {
                      _t6935 = ({_tag: 12, _name: "TVariant", _val: [canonical_6925, null]});
                      break _t6936;
                    }
                    if (_t6934._tag === 1) {
                      const n = _t6934._val[1];
                      _t6935 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                      break _t6936;
                    }
                    if (_t6934._tag === 0) {
                      let _t6937;
                      if (!_eq(List$assoc_opt(canonical_6925, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                        const fields_6938 = List$assoc(canonical_6925, ctx.type_env.records);
                        let _t6940;
                        if (_eq(fields_6938, null)) {
                          _t6940 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                        } else {
                          _t6940 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_6938)});
                        }
                        const _t6939 = _t6940;
                        _t6937 = _t6939;
                      } else {
                        _t6937 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                      }
                      _t6935 = _t6937;
                      break _t6936;
                    }
                    _match_fail("line 16933");
                  }
                  _t6932 = _t6935;
                  break _t6933;
                }
                _match_fail("line 16933");
              }
              const _t6926 = _t6932;
              _t6915 = _t6926;
              break _t6916;
            }
            if (_t6914._tag === 2) {
              const a = _t6914._val[0];
              const b = _t6914._val[1];
              _t6915 = ({_tag: 7, _name: "TArrow", _val: [resolve_alias(a), ({_tag: 1, _name: "EffEmpty"}), resolve_alias(b)]});
              break _t6916;
            }
            if (_t6914._tag === 6) {
              const ts = _t6914._val;
              _t6915 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve_alias, ts)});
              break _t6916;
            }
            if (_t6914._tag === 4) {
              const t = _t6914._val;
              _t6915 = ({_tag: 10, _name: "TList", _val: resolve_alias(t)});
              break _t6916;
            }
            if (_t6914._tag === 5) {
              const t = _t6914._val;
              _t6915 = ({_tag: 13, _name: "TArray", _val: resolve_alias(t)});
              break _t6916;
            }
            if (_t6914._tag === 7) {
              const args = _t6914._val[0];
              const tname = _t6914._val[1];
              const canonical_6941 = Typechecker$resolve_type_alias(ctx.type_env, tname);
              const arg_tys_6943 = List$map(resolve_alias, args);
              function _t6945(__p193) {
                let _t6947;
                const _t6946 = __p193;
                _t6948: {
                  if (true) {
                    const n = _t6946[0];
                    _t6947 = (n === canonical_6941);
                    break _t6948;
                  }
                  _match_fail("line 16933");
                }
                return _t6947;
              }
              let _t6950;
              const _t6949 = List$find(_t6945, ctx.type_env.type_synonyms);
              _t6951: {
                if (_t6949._tag === 1) {
                  const np = _t6949._val[1];
                  const ty = _t6949._val[2];
                  let _t6952;
                  if ((List$length(arg_tys_6943) !== np)) {
                    _t6952 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6943))));
                  } else {
                    _t6952 = undefined;
                  }
                  _t6952;
                  _t6950 = Typechecker$subst_tgens(arg_tys_6943, ty);
                  break _t6951;
                }
                if (_t6949._tag === 0) {
                  let _t6954;
                  const _t6953 = Typechecker$find_variant_info(ctx.type_env, tname);
                  _t6955: {
                    if (_t6953._tag === 1) {
                      const np = _t6953._val[1];
                      let _t6956;
                      if ((List$length(arg_tys_6943) !== np)) {
                        _t6956 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_6943))));
                      } else {
                        _t6956 = undefined;
                      }
                      _t6956;
                      _t6954 = ({_tag: 12, _name: "TVariant", _val: [canonical_6941, arg_tys_6943]});
                      break _t6955;
                    }
                    if (_t6953._tag === 0) {
                      _t6954 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                      break _t6955;
                    }
                    _match_fail("line 16933");
                  }
                  _t6950 = _t6954;
                  break _t6951;
                }
                _match_fail("line 16933");
              }
              const _t6944 = _t6950;
              const _t6942 = _t6944;
              _t6915 = _t6942;
              break _t6916;
            }
            if (_t6914._tag === 3) {
              const fields = _t6914._val[0];
              const is_open = _t6914._val[1];
              function _t6957(__p194) {
                let _t6959;
                const _t6958 = __p194;
                _t6960: {
                  if (true) {
                    const n = _t6958[0];
                    const t = _t6958[1];
                    _t6959 = [n, resolve_alias(t)];
                    break _t6960;
                  }
                  _match_fail("line 16933");
                }
                return _t6959;
              }
              const fields_6961 = List$map(_t6957, fields);
              function _t6963(__p195, __p196) {
                let _t6965;
                const _t6964 = __p195;
                _t6966: {
                  if (true) {
                    const a = _t6964[0];
                    let _t6968;
                    const _t6967 = __p196;
                    _t6969: {
                      if (true) {
                        const b = _t6967[0];
                        _t6968 = String$compare(a, b);
                        break _t6969;
                      }
                      _match_fail("line 16933");
                    }
                    _t6965 = _t6968;
                    break _t6966;
                  }
                  _match_fail("line 16933");
                }
                return _t6965;
              }
              const fields_6970 = List$sort(_t6963, fields_6961);
              let _t6972;
              if (is_open) {
                _t6972 = Types$new_rvar(0);
              } else {
                _t6972 = ({_tag: 2, _name: "REmpty"});
              }
              const tail_6973 = _t6972;
              function _t6975(__p197, acc) {
                let _t6977;
                const _t6976 = __p197;
                _t6978: {
                  if (true) {
                    const n = _t6976[0];
                    const t = _t6976[1];
                    _t6977 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                    break _t6978;
                  }
                  _match_fail("line 16933");
                }
                return _t6977;
              }
              const _t6974 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t6975, fields_6970, tail_6973)});
              const _t6971 = _t6974;
              const _t6962 = _t6971;
              _t6915 = _t6962;
              break _t6916;
            }
            if (_t6914._tag === 8) {
              const path = _t6914._val[0];
              const name = _t6914._val[1];
              const qualified_6979 = (String$concat(".", path) + ("." + name));
              const _t6981 = ({_tag: 0, _name: "TyName", _val: qualified_6979});
              __x = _t6981;
              continue;
              const _t6980 = undefined;
              _t6915 = _t6980;
              break _t6916;
            }
            if (_t6914._tag === 9) {
              const _kind = _t6914._val[0];
              const tags = _t6914._val[1];
              function _t6982(__p198, acc) {
                let _t6984;
                const _t6983 = __p198;
                _t6985: {
                  if (true) {
                    const tag = _t6983[0];
                    const payload_annot = _t6983[1];
                    _t6984 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve_alias, payload_annot), acc]});
                    break _t6985;
                  }
                  _match_fail("line 16933");
                }
                return _t6984;
              }
              const row_6986 = List$fold_right(_t6982, tags, ({_tag: 2, _name: "PVEmpty"}));
              const _t6987 = ({_tag: 14, _name: "TPolyVariant", _val: row_6986});
              _t6915 = _t6987;
              break _t6916;
            }
            if (_t6914._tag === 10) {
              const ty = _t6914._val[0];
              const _t6988 = ty;
              __x = _t6988;
              continue;
              _t6915 = undefined;
              break _t6916;
            }
            _match_fail("line 16933");
          }
          return _t6915;
        }
      }
      const resolved_ty_6990 = resolve_alias(annot);
      const __rec_upd_6992 = ctx.type_env;
      const _t6993 = ({classes: __rec_upd_6992.classes, constructors: __rec_upd_6992.constructors, effects: __rec_upd_6992.effects, hidden_ctor_types: __rec_upd_6992.hidden_ctor_types, hidden_types: __rec_upd_6992.hidden_types, instances: __rec_upd_6992.instances, modules: __rec_upd_6992.modules, mutable_fields: __rec_upd_6992.mutable_fields, newtypes: __rec_upd_6992.newtypes, records: __rec_upd_6992.records, type_aliases: __rec_upd_6992.type_aliases, type_synonyms: ({_hd: [type_name, num_params_6549, resolved_ty_6990], _tl: ctx.type_env.type_synonyms}), variants: __rec_upd_6992.variants});
      const type_env_6994 = _t6993;
      const __rec_upd_6996 = ctx;
      const _t6997 = ({constraint_tvars: __rec_upd_6996.constraint_tvars, current_eff: __rec_upd_6996.current_eff, current_module: __rec_upd_6996.current_module, inside_handler: __rec_upd_6996.inside_handler, loop_info: __rec_upd_6996.loop_info, mutable_vars: __rec_upd_6996.mutable_vars, return_type: __rec_upd_6996.return_type, return_used: __rec_upd_6996.return_used, type_env: type_env_6994, vars: __rec_upd_6996.vars});
      const _t6995 = _t6997;
      const _t6991 = _t6995;
      const _t6989 = _t6991;
      const _t6913 = _t6989;
      const _t6910 = _t6913;
      _t6552 = _t6910;
      break _t6553;
    }
    if (_t6551._tag === 3) {
      const ctor_name = _t6551._val[0];
      const underlying_annot = _t6551._val[1];
      const param_tbl_6998 = Hashtbl$create(4);
      function _t7000(i, name) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, param_tbl_6998, name, i]);
      }
      List$iteri(_t7000, type_params);
      const tvars_7001 = Hashtbl$create(4);
      function resolve_nt(__x) {
        while (true) {
          let _t7004;
          const _t7003 = __x;
          _t7005: {
            if (_t7003._tag === 1) {
              const name = _t7003._val;
              let _t7007;
              const _t7006 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, param_tbl_6998, name]);
              _t7008: {
                if (_t7006._tag === 1) {
                  const idx = _t7006._val;
                  _t7007 = ({_tag: 16, _name: "TGen", _val: idx});
                  break _t7008;
                }
                if (_t7006._tag === 0) {
                  let _t7010;
                  const _t7009 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_7001, name]);
                  _t7011: {
                    if (_t7009._tag === 1) {
                      const tv = _t7009._val;
                      _t7010 = tv;
                      break _t7011;
                    }
                    if (_t7009._tag === 0) {
                      const tv_7012 = Types$new_tvar(0);
                      _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_7001, name, tv_7012]);
                      const _t7013 = tv_7012;
                      _t7010 = _t7013;
                      break _t7011;
                    }
                    _match_fail("line 16933");
                  }
                  _t7007 = _t7010;
                  break _t7008;
                }
                _match_fail("line 16933");
              }
              _t7004 = _t7007;
              break _t7005;
            }
            if (_t7003._tag === 0 && _t7003._val === "int") {
              _t7004 = ({_tag: 0, _name: "TInt"});
              break _t7005;
            }
            if (_t7003._tag === 0 && _t7003._val === "float") {
              _t7004 = ({_tag: 1, _name: "TFloat"});
              break _t7005;
            }
            if (_t7003._tag === 0 && _t7003._val === "bool") {
              _t7004 = ({_tag: 2, _name: "TBool"});
              break _t7005;
            }
            if (_t7003._tag === 0 && _t7003._val === "string") {
              _t7004 = ({_tag: 3, _name: "TString"});
              break _t7005;
            }
            if (_t7003._tag === 0 && _t7003._val === "unit") {
              _t7004 = ({_tag: 6, _name: "TUnit"});
              break _t7005;
            }
            if (_t7003._tag === 0) {
              const name = _t7003._val;
              const canonical_7014 = Typechecker$resolve_type_alias(ctx.type_env, name);
              function _t7016(__p199) {
                let _t7018;
                const _t7017 = __p199;
                _t7019: {
                  if (true) {
                    const n = _t7017[0];
                    _t7018 = (n === canonical_7014);
                    break _t7019;
                  }
                  _match_fail("line 16933");
                }
                return _t7018;
              }
              let _t7021;
              const _t7020 = List$find(_t7016, ctx.type_env.type_synonyms);
              _t7022: {
                if (_t7020._tag === 1 && _t7020._val[1] === 0) {
                  const ty = _t7020._val[2];
                  _t7021 = ty;
                  break _t7022;
                }
                if (_t7020._tag === 1) {
                  const n = _t7020._val[1];
                  _t7021 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                  break _t7022;
                }
                if (_t7020._tag === 0) {
                  let _t7024;
                  const _t7023 = Typechecker$find_variant_info(ctx.type_env, name);
                  _t7025: {
                    if (_t7023._tag === 1 && _t7023._val[1] === 0) {
                      _t7024 = ({_tag: 12, _name: "TVariant", _val: [canonical_7014, null]});
                      break _t7025;
                    }
                    if (_t7023._tag === 1) {
                      const n = _t7023._val[1];
                      _t7024 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                      break _t7025;
                    }
                    if (_t7023._tag === 0) {
                      let _t7026;
                      if (!_eq(List$assoc_opt(canonical_7014, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                        const fields_7027 = List$assoc(canonical_7014, ctx.type_env.records);
                        let _t7029;
                        if (_eq(fields_7027, null)) {
                          _t7029 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                        } else {
                          _t7029 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_7027)});
                        }
                        const _t7028 = _t7029;
                        _t7026 = _t7028;
                      } else {
                        _t7026 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                      }
                      _t7024 = _t7026;
                      break _t7025;
                    }
                    _match_fail("line 16933");
                  }
                  _t7021 = _t7024;
                  break _t7022;
                }
                _match_fail("line 16933");
              }
              const _t7015 = _t7021;
              _t7004 = _t7015;
              break _t7005;
            }
            if (_t7003._tag === 2) {
              const a = _t7003._val[0];
              const b = _t7003._val[1];
              _t7004 = ({_tag: 7, _name: "TArrow", _val: [resolve_nt(a), ({_tag: 1, _name: "EffEmpty"}), resolve_nt(b)]});
              break _t7005;
            }
            if (_t7003._tag === 6) {
              const ts = _t7003._val;
              _t7004 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve_nt, ts)});
              break _t7005;
            }
            if (_t7003._tag === 4) {
              const t = _t7003._val;
              _t7004 = ({_tag: 10, _name: "TList", _val: resolve_nt(t)});
              break _t7005;
            }
            if (_t7003._tag === 5) {
              const t = _t7003._val;
              _t7004 = ({_tag: 13, _name: "TArray", _val: resolve_nt(t)});
              break _t7005;
            }
            if (_t7003._tag === 7) {
              const args = _t7003._val[0];
              const tname = _t7003._val[1];
              const canonical_7030 = Typechecker$resolve_type_alias(ctx.type_env, tname);
              const arg_tys_7032 = List$map(resolve_nt, args);
              function _t7034(__p200) {
                let _t7036;
                const _t7035 = __p200;
                _t7037: {
                  if (true) {
                    const n = _t7035[0];
                    _t7036 = (n === canonical_7030);
                    break _t7037;
                  }
                  _match_fail("line 16933");
                }
                return _t7036;
              }
              let _t7039;
              const _t7038 = List$find(_t7034, ctx.type_env.type_synonyms);
              _t7040: {
                if (_t7038._tag === 1) {
                  const np = _t7038._val[1];
                  const ty = _t7038._val[2];
                  let _t7041;
                  if ((List$length(arg_tys_7032) !== np)) {
                    _t7041 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_7032))));
                  } else {
                    _t7041 = undefined;
                  }
                  _t7041;
                  _t7039 = Typechecker$subst_tgens(arg_tys_7032, ty);
                  break _t7040;
                }
                if (_t7038._tag === 0) {
                  let _t7043;
                  const _t7042 = Typechecker$find_variant_info(ctx.type_env, tname);
                  _t7044: {
                    if (_t7042._tag === 1) {
                      const np = _t7042._val[1];
                      let _t7045;
                      if ((List$length(arg_tys_7032) !== np)) {
                        _t7045 = Typechecker$error(((((("type " + __dict_Show_string.show(tname)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_7032))));
                      } else {
                        _t7045 = undefined;
                      }
                      _t7045;
                      _t7043 = ({_tag: 12, _name: "TVariant", _val: [canonical_7030, arg_tys_7032]});
                      break _t7044;
                    }
                    if (_t7042._tag === 0) {
                      _t7043 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(tname)));
                      break _t7044;
                    }
                    _match_fail("line 16933");
                  }
                  _t7039 = _t7043;
                  break _t7040;
                }
                _match_fail("line 16933");
              }
              const _t7033 = _t7039;
              const _t7031 = _t7033;
              _t7004 = _t7031;
              break _t7005;
            }
            if (_t7003._tag === 3) {
              const fields = _t7003._val[0];
              const is_open = _t7003._val[1];
              function _t7046(__p201) {
                let _t7048;
                const _t7047 = __p201;
                _t7049: {
                  if (true) {
                    const n = _t7047[0];
                    const t = _t7047[1];
                    _t7048 = [n, resolve_nt(t)];
                    break _t7049;
                  }
                  _match_fail("line 16933");
                }
                return _t7048;
              }
              const fields_7050 = List$map(_t7046, fields);
              function _t7052(__p202, __p203) {
                let _t7054;
                const _t7053 = __p202;
                _t7055: {
                  if (true) {
                    const a = _t7053[0];
                    let _t7057;
                    const _t7056 = __p203;
                    _t7058: {
                      if (true) {
                        const b = _t7056[0];
                        _t7057 = String$compare(a, b);
                        break _t7058;
                      }
                      _match_fail("line 16933");
                    }
                    _t7054 = _t7057;
                    break _t7055;
                  }
                  _match_fail("line 16933");
                }
                return _t7054;
              }
              const fields_7059 = List$sort(_t7052, fields_7050);
              let _t7061;
              if (is_open) {
                _t7061 = Types$new_rvar(0);
              } else {
                _t7061 = ({_tag: 2, _name: "REmpty"});
              }
              const tail_7062 = _t7061;
              function _t7064(__p204, acc) {
                let _t7066;
                const _t7065 = __p204;
                _t7067: {
                  if (true) {
                    const n = _t7065[0];
                    const t = _t7065[1];
                    _t7066 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                    break _t7067;
                  }
                  _match_fail("line 16933");
                }
                return _t7066;
              }
              const _t7063 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t7064, fields_7059, tail_7062)});
              const _t7060 = _t7063;
              const _t7051 = _t7060;
              _t7004 = _t7051;
              break _t7005;
            }
            if (_t7003._tag === 8) {
              const path = _t7003._val[0];
              const name = _t7003._val[1];
              const qualified_7068 = (String$concat(".", path) + ("." + name));
              const _t7070 = ({_tag: 0, _name: "TyName", _val: qualified_7068});
              __x = _t7070;
              continue;
              const _t7069 = undefined;
              _t7004 = _t7069;
              break _t7005;
            }
            if (_t7003._tag === 9) {
              const _kind = _t7003._val[0];
              const tags = _t7003._val[1];
              function _t7071(__p205, acc) {
                let _t7073;
                const _t7072 = __p205;
                _t7074: {
                  if (true) {
                    const tag = _t7072[0];
                    const payload_annot = _t7072[1];
                    _t7073 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve_nt, payload_annot), acc]});
                    break _t7074;
                  }
                  _match_fail("line 16933");
                }
                return _t7073;
              }
              const row_7075 = List$fold_right(_t7071, tags, ({_tag: 2, _name: "PVEmpty"}));
              const _t7076 = ({_tag: 14, _name: "TPolyVariant", _val: row_7075});
              _t7004 = _t7076;
              break _t7005;
            }
            if (_t7003._tag === 10) {
              const ty = _t7003._val[0];
              const _t7077 = ty;
              __x = _t7077;
              continue;
              _t7004 = undefined;
              break _t7005;
            }
            _match_fail("line 16933");
          }
          return _t7004;
        }
      }
      const underlying_ty_7079 = resolve_nt(underlying_annot);
      const variant_def_7081 = ({_hd: [ctor_name, ({_tag: 1, _name: "Some", _val: underlying_ty_7079})], _tl: null});
      const ctor_info_7083 = ({ctor_arg_ty: ({_tag: 1, _name: "Some", _val: underlying_ty_7079}), ctor_existentials: 0, ctor_num_params: num_params_6549, ctor_return_ty_params: ({_tag: 0, _name: "None"}), ctor_type_name: type_name});
      const __rec_upd_7085 = ctx.type_env;
      const _t7086 = ({classes: __rec_upd_7085.classes, constructors: ({_hd: [ctor_name, ctor_info_7083], _tl: ctx.type_env.constructors}), effects: __rec_upd_7085.effects, hidden_ctor_types: __rec_upd_7085.hidden_ctor_types, hidden_types: __rec_upd_7085.hidden_types, instances: __rec_upd_7085.instances, modules: __rec_upd_7085.modules, mutable_fields: __rec_upd_7085.mutable_fields, newtypes: ({_hd: type_name, _tl: ctx.type_env.newtypes}), records: __rec_upd_7085.records, type_aliases: __rec_upd_7085.type_aliases, type_synonyms: __rec_upd_7085.type_synonyms, variants: ({_hd: [type_name, num_params_6549, variant_def_7081, false], _tl: ctx.type_env.variants})});
      const type_env_7087 = _t7086;
      const __rec_upd_7089 = ctx;
      const _t7090 = ({constraint_tvars: __rec_upd_7089.constraint_tvars, current_eff: __rec_upd_7089.current_eff, current_module: __rec_upd_7089.current_module, inside_handler: __rec_upd_7089.inside_handler, loop_info: __rec_upd_7089.loop_info, mutable_vars: __rec_upd_7089.mutable_vars, return_type: __rec_upd_7089.return_type, return_used: __rec_upd_7089.return_used, type_env: type_env_7087, vars: __rec_upd_7089.vars});
      const _t7088 = _t7090;
      const _t7084 = _t7088;
      const _t7082 = _t7084;
      const _t7080 = _t7082;
      const _t7078 = _t7080;
      const _t7002 = _t7078;
      const _t6999 = _t7002;
      _t6552 = _t6999;
      break _t6553;
    }
    _match_fail("line 16933");
  }
  const _t6550 = _t6552;
  return _t6550;
}
function Typechecker$wrap_params_decl(params, ret_annot, body) {
  let _t7092;
  const _t7091 = ret_annot;
  _t7093: {
    if (_t7091._tag === 1 && _t7091._val._tag === 10) {
      const ret_ty = _t7091._val._val[0];
      const eff_annot = _t7091._val._val[1];
      if (!_eq(params, null)) {
        const body_7094 = ({_tag: 30, _name: "EAnnot", _val: [body, ret_ty]});
        function _t7096(param, body) {
          return ({_tag: 10, _name: "EFun", _val: [param, body]});
        }
        const full_fun_7097 = List$fold_right(_t7096, params, body_7094);
        function build_arrow(__x) {
          let _t7100;
          const _t7099 = __x;
          _t7101: {
            if (_t7099 === null) {
              _t7100 = ret_ty;
              break _t7101;
            }
            if (_t7099 !== null && _t7099._tl === null) {
              const p = _t7099._hd;
              let _t7103;
              const _t7102 = p.annot;
              _t7104: {
                if (_t7102._tag === 1) {
                  const t = _t7102._val;
                  _t7103 = t;
                  break _t7104;
                }
                if (_t7102._tag === 0) {
                  _t7103 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t7104;
                }
                _match_fail("line 16933");
              }
              const pty_7105 = _t7103;
              const _t7106 = ({_tag: 2, _name: "TyArrow", _val: [pty_7105, ret_ty, ({_tag: 1, _name: "Some", _val: eff_annot})]});
              _t7100 = _t7106;
              break _t7101;
            }
            if (_t7099 !== null) {
              const p = _t7099._hd;
              const rest = _t7099._tl;
              let _t7108;
              const _t7107 = p.annot;
              _t7109: {
                if (_t7107._tag === 1) {
                  const t = _t7107._val;
                  _t7108 = t;
                  break _t7109;
                }
                if (_t7107._tag === 0) {
                  _t7108 = ({_tag: 1, _name: "TyVar", _val: ("'_eff_p_" + p.name)});
                  break _t7109;
                }
                _match_fail("line 16933");
              }
              const pty_7110 = _t7108;
              const _t7111 = ({_tag: 2, _name: "TyArrow", _val: [pty_7110, build_arrow(rest), ({_tag: 0, _name: "None"})]});
              _t7100 = _t7111;
              break _t7101;
            }
            _match_fail("line 16933");
          }
          return _t7100;
        }
        const _t7112 = ({_tag: 30, _name: "EAnnot", _val: [full_fun_7097, build_arrow(params)]});
        const _t7098 = _t7112;
        const _t7095 = _t7098;
        _t7092 = _t7095;
        break _t7093;
      }
    }
    if (true) {
      let _t7114;
      const _t7113 = ret_annot;
      _t7115: {
        if (_t7113._tag === 1) {
          const ty = _t7113._val;
          _t7114 = ({_tag: 30, _name: "EAnnot", _val: [body, ty]});
          break _t7115;
        }
        if (_t7113._tag === 0) {
          _t7114 = body;
          break _t7115;
        }
        _match_fail("line 16933");
      }
      const body_7116 = _t7114;
      function _t7118(param, body) {
        return ({_tag: 10, _name: "EFun", _val: [param, body]});
      }
      const _t7117 = List$fold_right(_t7118, params, body_7116);
      _t7092 = _t7117;
      break _t7093;
    }
    _match_fail("line 16933");
  }
  return _t7092;
}
function Typechecker$process_class_def(ctx, class_name, tyvar_names, fundep_annots, methods) {
  function _t7119(c) {
    return (c.class_name === class_name);
  }
  let _t7120;
  if (List$exists(_t7119, ctx.type_env.classes)) {
    _t7120 = Typechecker$error(("duplicate class definition: " + __dict_Show_string.show(class_name)));
  } else {
    _t7120 = undefined;
  }
  _t7120;
  const num_class_params_7121 = List$length(tyvar_names);
  function _t7123(__p206) {
    let _t7125;
    const _t7124 = __p206;
    _t7126: {
      if (true) {
        const mname = _t7124[0];
        const annot = _t7124[1];
        const tvars_7127 = Hashtbl$create(4);
        function _t7129(i, name) {
          return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_7127, name, ({_tag: 16, _name: "TGen", _val: i})]);
        }
        List$iteri(_t7129, tyvar_names);
        const next_gen_7130 = Ref$create(num_class_params_7121);
        const eff_tvars_7132 = Hashtbl$create(2);
        const next_effgen_7134 = Ref$create(0);
        function _t7136(__dict_Hash_0, __dict_Eq_0, name) {
          let _t7138;
          const _t7137 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, eff_tvars_7132, name]);
          _t7139: {
            if (_t7137._tag === 1) {
              const eg = _t7137._val;
              _t7138 = eg;
              break _t7139;
            }
            if (_t7137._tag === 0) {
              const idx_7140 = Ref$get(next_effgen_7134);
              Ref$set(next_effgen_7134, (idx_7140 + 1));
              const eg_7142 = ({_tag: 3, _name: "EffGen", _val: idx_7140});
              _call(Hashtbl$set, [__dict_Hash_0, __dict_Eq_0, eff_tvars_7132, name, eg_7142]);
              const _t7143 = eg_7142;
              const _t7141 = _t7143;
              _t7138 = _t7141;
              break _t7139;
            }
            _match_fail("line 16933");
          }
          return _t7138;
        }
        const resolve_eff_var_7144 = _t7136;
        function resolve(__x) {
          while (true) {
            let _t7147;
            const _t7146 = __x;
            _t7148: {
              if (_t7146._tag === 1) {
                const name = _t7146._val;
                let _t7150;
                const _t7149 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_7127, name]);
                _t7151: {
                  if (_t7149._tag === 1) {
                    const tv = _t7149._val;
                    _t7150 = tv;
                    break _t7151;
                  }
                  if (_t7149._tag === 0) {
                    const idx_7152 = Ref$get(next_gen_7130);
                    Ref$set(next_gen_7130, (idx_7152 + 1));
                    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_7127, name, ({_tag: 16, _name: "TGen", _val: idx_7152})]);
                    const _t7153 = ({_tag: 16, _name: "TGen", _val: idx_7152});
                    _t7150 = _t7153;
                    break _t7151;
                  }
                  _match_fail("line 16933");
                }
                _t7147 = _t7150;
                break _t7148;
              }
              if (_t7146._tag === 0 && _t7146._val === "int") {
                _t7147 = ({_tag: 0, _name: "TInt"});
                break _t7148;
              }
              if (_t7146._tag === 0 && _t7146._val === "float") {
                _t7147 = ({_tag: 1, _name: "TFloat"});
                break _t7148;
              }
              if (_t7146._tag === 0 && _t7146._val === "bool") {
                _t7147 = ({_tag: 2, _name: "TBool"});
                break _t7148;
              }
              if (_t7146._tag === 0 && _t7146._val === "string") {
                _t7147 = ({_tag: 3, _name: "TString"});
                break _t7148;
              }
              if (_t7146._tag === 0 && _t7146._val === "unit") {
                _t7147 = ({_tag: 6, _name: "TUnit"});
                break _t7148;
              }
              if (_t7146._tag === 0) {
                const name = _t7146._val;
                const canonical_7154 = Typechecker$resolve_type_alias(ctx.type_env, name);
                let _t7157;
                const _t7156 = Typechecker$find_variant_info(ctx.type_env, name);
                _t7158: {
                  if (_t7156._tag === 1 && _t7156._val[1] === 0) {
                    _t7157 = ({_tag: 12, _name: "TVariant", _val: [canonical_7154, null]});
                    break _t7158;
                  }
                  if (_t7156._tag === 1) {
                    const n = _t7156._val[1];
                    _t7157 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
                    break _t7158;
                  }
                  if (_t7156._tag === 0) {
                    _t7157 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
                    break _t7158;
                  }
                  _match_fail("line 16933");
                }
                const _t7155 = _t7157;
                _t7147 = _t7155;
                break _t7148;
              }
              if (_t7146._tag === 2) {
                const a = _t7146._val[0];
                const b = _t7146._val[1];
                const eff_opt = _t7146._val[2];
                let _t7160;
                const _t7159 = eff_opt;
                _t7161: {
                  if (_t7159._tag === 0) {
                    _t7160 = ({_tag: 1, _name: "EffEmpty"});
                    break _t7161;
                  }
                  if (_t7159._tag === 1 && _t7159._val._tag === 0) {
                    _t7160 = ({_tag: 1, _name: "EffEmpty"});
                    break _t7161;
                  }
                  if (_t7159._tag === 1 && _t7159._val._tag === 1) {
                    const items = _t7159._val._val;
                    _t7160 = resolve_class_eff_items(items);
                    break _t7161;
                  }
                  _match_fail("line 16933");
                }
                const eff_7162 = _t7160;
                const _t7163 = ({_tag: 7, _name: "TArrow", _val: [resolve(a), eff_7162, resolve(b)]});
                _t7147 = _t7163;
                break _t7148;
              }
              if (_t7146._tag === 6) {
                const ts = _t7146._val;
                _t7147 = ({_tag: 9, _name: "TTuple", _val: List$map(resolve, ts)});
                break _t7148;
              }
              if (_t7146._tag === 4) {
                const t = _t7146._val;
                _t7147 = ({_tag: 10, _name: "TList", _val: resolve(t)});
                break _t7148;
              }
              if (_t7146._tag === 5) {
                const t = _t7146._val;
                _t7147 = ({_tag: 13, _name: "TArray", _val: resolve(t)});
                break _t7148;
              }
              if (_t7146._tag === 7) {
                const args = _t7146._val[0];
                const name = _t7146._val[1];
                const canonical_7164 = Typechecker$resolve_type_alias(ctx.type_env, name);
                const arg_tys_7166 = List$map(resolve, args);
                let _t7169;
                const _t7168 = Typechecker$find_variant_info(ctx.type_env, name);
                _t7170: {
                  if (_t7168._tag === 1) {
                    const np = _t7168._val[1];
                    let _t7171;
                    if ((List$length(arg_tys_7166) !== np)) {
                      _t7171 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_7166))));
                    } else {
                      _t7171 = undefined;
                    }
                    _t7171;
                    _t7169 = ({_tag: 12, _name: "TVariant", _val: [canonical_7164, arg_tys_7166]});
                    break _t7170;
                  }
                  if (_t7168._tag === 0) {
                    _t7169 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
                    break _t7170;
                  }
                  _match_fail("line 16933");
                }
                const _t7167 = _t7169;
                const _t7165 = _t7167;
                _t7147 = _t7165;
                break _t7148;
              }
              if (_t7146._tag === 3) {
                const fields = _t7146._val[0];
                const is_open = _t7146._val[1];
                function _t7172(__p207, __p208) {
                  let _t7174;
                  const _t7173 = __p207;
                  _t7175: {
                    if (true) {
                      const a = _t7173[0];
                      let _t7177;
                      const _t7176 = __p208;
                      _t7178: {
                        if (true) {
                          const b = _t7176[0];
                          _t7177 = String$compare(a, b);
                          break _t7178;
                        }
                        _match_fail("line 16933");
                      }
                      _t7174 = _t7177;
                      break _t7175;
                    }
                    _match_fail("line 16933");
                  }
                  return _t7174;
                }
                function _t7179(__p209) {
                  let _t7181;
                  const _t7180 = __p209;
                  _t7182: {
                    if (true) {
                      const n = _t7180[0];
                      const t = _t7180[1];
                      _t7181 = [n, resolve(t)];
                      break _t7182;
                    }
                    _match_fail("line 16933");
                  }
                  return _t7181;
                }
                const fields_7183 = List$sort(_t7172, List$map(_t7179, fields));
                let _t7185;
                if (is_open) {
                  _t7185 = Types$new_rvar(0);
                } else {
                  _t7185 = ({_tag: 2, _name: "REmpty"});
                }
                const tail_7186 = _t7185;
                function _t7188(__p210, acc) {
                  let _t7190;
                  const _t7189 = __p210;
                  _t7191: {
                    if (true) {
                      const n = _t7189[0];
                      const t = _t7189[1];
                      _t7190 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                      break _t7191;
                    }
                    _match_fail("line 16933");
                  }
                  return _t7190;
                }
                const _t7187 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t7188, fields_7183, tail_7186)});
                const _t7184 = _t7187;
                _t7147 = _t7184;
                break _t7148;
              }
              if (_t7146._tag === 8) {
                const path = _t7146._val[0];
                const name = _t7146._val[1];
                const qualified_7192 = (String$concat(".", path) + ("." + name));
                const _t7194 = ({_tag: 0, _name: "TyName", _val: qualified_7192});
                __x = _t7194;
                continue;
                const _t7193 = undefined;
                _t7147 = _t7193;
                break _t7148;
              }
              if (_t7146._tag === 9) {
                const _kind = _t7146._val[0];
                const tags = _t7146._val[1];
                function _t7195(__p211, acc) {
                  let _t7197;
                  const _t7196 = __p211;
                  _t7198: {
                    if (true) {
                      const tag = _t7196[0];
                      const payload_annot = _t7196[1];
                      _t7197 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(resolve, payload_annot), acc]});
                      break _t7198;
                    }
                    _match_fail("line 16933");
                  }
                  return _t7197;
                }
                const row_7199 = List$fold_right(_t7195, tags, ({_tag: 2, _name: "PVEmpty"}));
                const _t7200 = ({_tag: 14, _name: "TPolyVariant", _val: row_7199});
                _t7147 = _t7200;
                break _t7148;
              }
              if (_t7146._tag === 10) {
                const ty = _t7146._val[0];
                const _t7201 = ty;
                __x = _t7201;
                continue;
                _t7147 = undefined;
                break _t7148;
              }
              _match_fail("line 16933");
            }
            return _t7147;
          }
        }
        function resolve_class_eff_items(items) {
          const labels_7202 = Ref$create(null);
          const tail_7204 = Ref$create(({_tag: 1, _name: "EffEmpty"}));
          function _t7206(item) {
            let _t7208;
            const _t7207 = item;
            _t7209: {
              if (_t7207._tag === 0) {
                const name = _t7207._val[0];
                const param_annots = _t7207._val[1];
                const resolved_params_7210 = List$map(resolve, param_annots);
                const _t7211 = Ref$set(labels_7202, ({_hd: [name, resolved_params_7210], _tl: Ref$get(labels_7202)}));
                _t7208 = _t7211;
                break _t7209;
              }
              if (_t7207._tag === 1) {
                const name = _t7207._val;
                _t7208 = Ref$set(tail_7204, _call(resolve_eff_var_7144, [__dict_Hash_string, __dict_Eq_string, name]));
                break _t7209;
              }
              _match_fail("line 16933");
            }
            return _t7208;
          }
          List$iter(_t7206, items);
          function _t7212(__p212, acc) {
            let _t7214;
            const _t7213 = __p212;
            _t7215: {
              if (true) {
                const name = _t7213[0];
                const params = _t7213[1];
                _t7214 = ({_tag: 2, _name: "EffRow", _val: [name, params, acc]});
                break _t7215;
              }
              _match_fail("line 16933");
            }
            return _t7214;
          }
          const _t7205 = List$fold_right(_t7212, List$rev(Ref$get(labels_7202)), Ref$get(tail_7204));
          const _t7203 = _t7205;
          return _t7203;
        }
        const ty_7217 = resolve(annot);
        const method_quant_7219 = Ref$get(next_gen_7130);
        const method_equant_7221 = Ref$get(next_effgen_7134);
        const _t7222 = [mname, ty_7217, method_quant_7219, method_equant_7221];
        const _t7220 = _t7222;
        const _t7218 = _t7220;
        const _t7216 = _t7218;
        const _t7145 = _t7216;
        const _t7135 = _t7145;
        const _t7133 = _t7135;
        const _t7131 = _t7133;
        const _t7128 = _t7131;
        _t7125 = _t7128;
        break _t7126;
      }
      _match_fail("line 16933");
    }
    return _t7125;
  }
  const method_tys_7223 = List$map(_t7123, methods);
  function _t7225(__p213) {
    let _t7227;
    const _t7226 = __p213;
    _t7228: {
      if (true) {
        const from_names = _t7226[0];
        const to_names = _t7226[1];
        function _t7229(name) {
          function _t7230(n) {
            return (n === name);
          }
          let _t7232;
          const _t7231 = List$find_index(_t7230, tyvar_names);
          _t7233: {
            if (_t7231._tag === 1) {
              const i = _t7231._val;
              _t7232 = i;
              break _t7233;
            }
            if (_t7231._tag === 0) {
              _t7232 = Typechecker$error((("functional dependency type variable '" + __dict_Show_string.show(name)) + " not in class parameters"));
              break _t7233;
            }
            _match_fail("line 16933");
          }
          return _t7232;
        }
        const resolve_idx_7234 = _t7229;
        const _t7235 = ({fd_from: List$map(resolve_idx_7234, from_names), fd_to: List$map(resolve_idx_7234, to_names)});
        _t7227 = _t7235;
        break _t7228;
      }
      _match_fail("line 16933");
    }
    return _t7227;
  }
  const class_fundeps_7236 = List$map(_t7225, fundep_annots);
  function _t7238(__p214) {
    let _t7240;
    const _t7239 = __p214;
    _t7241: {
      if (true) {
        const m = _t7239[0];
        const t = _t7239[1];
        _t7240 = [m, t];
        break _t7241;
      }
      _match_fail("line 16933");
    }
    return _t7240;
  }
  const class_def_7242 = ({class_fundeps: class_fundeps_7236, class_methods: List$map(_t7238, method_tys_7223), class_name: class_name, class_params: tyvar_names});
  function _t7244(ctx, __p215) {
    let _t7246;
    const _t7245 = __p215;
    _t7247: {
      if (true) {
        const mname = _t7245[0];
        const mty = _t7245[1];
        const mquant = _t7245[2];
        const mequant = _t7245[3];
        const scheme_7248 = ({body: mty, constraints: null, equant: mequant, pvquant: 0, quant: mquant, record_evidences: null, rquant: 0});
        const _t7249 = Typechecker$extend_var(ctx, mname, scheme_7248);
        _t7246 = _t7249;
        break _t7247;
      }
      _match_fail("line 16933");
    }
    return _t7246;
  }
  const ctx_7250 = List$fold(_t7244, ctx, method_tys_7223);
  const __rec_upd_7252 = ctx_7250.type_env;
  const _t7253 = ({classes: ({_hd: class_def_7242, _tl: ctx_7250.type_env.classes}), constructors: __rec_upd_7252.constructors, effects: __rec_upd_7252.effects, hidden_ctor_types: __rec_upd_7252.hidden_ctor_types, hidden_types: __rec_upd_7252.hidden_types, instances: __rec_upd_7252.instances, modules: __rec_upd_7252.modules, mutable_fields: __rec_upd_7252.mutable_fields, newtypes: __rec_upd_7252.newtypes, records: __rec_upd_7252.records, type_aliases: __rec_upd_7252.type_aliases, type_synonyms: __rec_upd_7252.type_synonyms, variants: __rec_upd_7252.variants});
  const type_env_7254 = _t7253;
  const __rec_upd_7256 = ctx_7250;
  const _t7257 = ({constraint_tvars: __rec_upd_7256.constraint_tvars, current_eff: __rec_upd_7256.current_eff, current_module: __rec_upd_7256.current_module, inside_handler: __rec_upd_7256.inside_handler, loop_info: __rec_upd_7256.loop_info, mutable_vars: __rec_upd_7256.mutable_vars, return_type: __rec_upd_7256.return_type, return_used: __rec_upd_7256.return_used, type_env: type_env_7254, vars: __rec_upd_7256.vars});
  const ctx_7258 = _t7257;
  const _t7259 = [ctx_7258, ({_tag: 6, _name: "TDClass", _val: class_name})];
  const _t7255 = _t7259;
  const _t7251 = _t7255;
  const _t7243 = _t7251;
  const _t7237 = _t7243;
  const _t7224 = _t7237;
  const _t7122 = _t7224;
  return _t7122;
}
function Typechecker$resolve_inst_tys(ctx, annots) {
  const tvars_7260 = Hashtbl$create(4);
  const next_idx_7262 = Ref$create(0);
  function go(__x) {
    while (true) {
      let _t7265;
      const _t7264 = __x;
      _t7266: {
        if (_t7264._tag === 1) {
          const name = _t7264._val;
          let _t7268;
          const _t7267 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tvars_7260, name]);
          _t7269: {
            if (_t7267._tag === 1) {
              const idx = _t7267._val;
              _t7268 = ({_tag: 16, _name: "TGen", _val: idx});
              break _t7269;
            }
            if (_t7267._tag === 0) {
              const idx_7270 = Ref$get(next_idx_7262);
              Ref$set(next_idx_7262, (idx_7270 + 1));
              _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_7260, name, idx_7270]);
              const _t7271 = ({_tag: 16, _name: "TGen", _val: idx_7270});
              _t7268 = _t7271;
              break _t7269;
            }
            _match_fail("line 16933");
          }
          _t7265 = _t7268;
          break _t7266;
        }
        if (_t7264._tag === 0 && _t7264._val === "int") {
          _t7265 = ({_tag: 0, _name: "TInt"});
          break _t7266;
        }
        if (_t7264._tag === 0 && _t7264._val === "float") {
          _t7265 = ({_tag: 1, _name: "TFloat"});
          break _t7266;
        }
        if (_t7264._tag === 0 && _t7264._val === "bool") {
          _t7265 = ({_tag: 2, _name: "TBool"});
          break _t7266;
        }
        if (_t7264._tag === 0 && _t7264._val === "string") {
          _t7265 = ({_tag: 3, _name: "TString"});
          break _t7266;
        }
        if (_t7264._tag === 0 && _t7264._val === "byte") {
          _t7265 = ({_tag: 4, _name: "TByte"});
          break _t7266;
        }
        if (_t7264._tag === 0 && _t7264._val === "rune") {
          _t7265 = ({_tag: 5, _name: "TRune"});
          break _t7266;
        }
        if (_t7264._tag === 0 && _t7264._val === "unit") {
          _t7265 = ({_tag: 6, _name: "TUnit"});
          break _t7266;
        }
        if (_t7264._tag === 0) {
          const name = _t7264._val;
          const canonical_7272 = Typechecker$resolve_type_alias(ctx.type_env, name);
          let _t7275;
          const _t7274 = Typechecker$find_variant_info(ctx.type_env, name);
          _t7276: {
            if (_t7274._tag === 1 && _t7274._val[1] === 0) {
              _t7275 = ({_tag: 12, _name: "TVariant", _val: [canonical_7272, null]});
              break _t7276;
            }
            if (_t7274._tag === 1) {
              const n = _t7274._val[1];
              _t7275 = Typechecker$error((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(n)) + " type argument(s)"));
              break _t7276;
            }
            if (_t7274._tag === 0) {
              let _t7277;
              if (!_eq(List$assoc_opt(name, ctx.type_env.records), ({_tag: 0, _name: "None"}))) {
                const fields_7278 = List$assoc(name, ctx.type_env.records);
                let _t7280;
                if (_eq(fields_7278, null)) {
                  _t7280 = ({_tag: 11, _name: "TRecord", _val: ({_tag: 4, _name: "RWild"})});
                } else {
                  _t7280 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(fields_7278)});
                }
                const _t7279 = _t7280;
                _t7277 = _t7279;
              } else {
                _t7277 = Typechecker$error(("unknown type: " + __dict_Show_string.show(name)));
              }
              _t7275 = _t7277;
              break _t7276;
            }
            _match_fail("line 16933");
          }
          const _t7273 = _t7275;
          _t7265 = _t7273;
          break _t7266;
        }
        if (_t7264._tag === 2) {
          const a = _t7264._val[0];
          const b = _t7264._val[1];
          _t7265 = ({_tag: 7, _name: "TArrow", _val: [go(a), ({_tag: 1, _name: "EffEmpty"}), go(b)]});
          break _t7266;
        }
        if (_t7264._tag === 6) {
          const ts = _t7264._val;
          _t7265 = ({_tag: 9, _name: "TTuple", _val: List$map(go, ts)});
          break _t7266;
        }
        if (_t7264._tag === 4) {
          const t = _t7264._val;
          _t7265 = ({_tag: 10, _name: "TList", _val: go(t)});
          break _t7266;
        }
        if (_t7264._tag === 5) {
          const t = _t7264._val;
          _t7265 = ({_tag: 13, _name: "TArray", _val: go(t)});
          break _t7266;
        }
        if (_t7264._tag === 7) {
          const args = _t7264._val[0];
          const name = _t7264._val[1];
          const canonical_7281 = Typechecker$resolve_type_alias(ctx.type_env, name);
          const arg_tys_7283 = List$map(go, args);
          let _t7286;
          const _t7285 = Typechecker$find_variant_info(ctx.type_env, name);
          _t7287: {
            if (_t7285._tag === 1) {
              const np = _t7285._val[1];
              let _t7288;
              if ((List$length(arg_tys_7283) !== np)) {
                _t7288 = Typechecker$error(((((("type " + __dict_Show_string.show(name)) + " expects ") + __dict_Show_int.show(np)) + " type argument(s), got ") + __dict_Show_int.show(List$length(arg_tys_7283))));
              } else {
                _t7288 = undefined;
              }
              _t7288;
              _t7286 = ({_tag: 12, _name: "TVariant", _val: [canonical_7281, arg_tys_7283]});
              break _t7287;
            }
            if (_t7285._tag === 0) {
              _t7286 = Typechecker$error(("unknown type constructor: " + __dict_Show_string.show(name)));
              break _t7287;
            }
            _match_fail("line 16933");
          }
          const _t7284 = _t7286;
          const _t7282 = _t7284;
          _t7265 = _t7282;
          break _t7266;
        }
        if (_t7264._tag === 3) {
          const fields = _t7264._val[0];
          const is_open = _t7264._val[1];
          function _t7289(__p216) {
            let _t7291;
            const _t7290 = __p216;
            _t7292: {
              if (true) {
                const n = _t7290[0];
                const t = _t7290[1];
                _t7291 = [n, go(t)];
                break _t7292;
              }
              _match_fail("line 16933");
            }
            return _t7291;
          }
          const fields_7293 = List$map(_t7289, fields);
          function _t7295(__p217, __p218) {
            let _t7297;
            const _t7296 = __p217;
            _t7298: {
              if (true) {
                const a = _t7296[0];
                let _t7300;
                const _t7299 = __p218;
                _t7301: {
                  if (true) {
                    const b = _t7299[0];
                    _t7300 = String$compare(a, b);
                    break _t7301;
                  }
                  _match_fail("line 16933");
                }
                _t7297 = _t7300;
                break _t7298;
              }
              _match_fail("line 16933");
            }
            return _t7297;
          }
          const fields_7302 = List$sort(_t7295, fields_7293);
          let _t7304;
          if (is_open) {
            _t7304 = Types$new_rvar(0);
          } else {
            _t7304 = ({_tag: 2, _name: "REmpty"});
          }
          const tail_7305 = _t7304;
          function _t7307(__p219, acc) {
            let _t7309;
            const _t7308 = __p219;
            _t7310: {
              if (true) {
                const n = _t7308[0];
                const t = _t7308[1];
                _t7309 = ({_tag: 0, _name: "RRow", _val: [n, t, acc]});
                break _t7310;
              }
              _match_fail("line 16933");
            }
            return _t7309;
          }
          const _t7306 = ({_tag: 11, _name: "TRecord", _val: List$fold_right(_t7307, fields_7302, tail_7305)});
          const _t7303 = _t7306;
          const _t7294 = _t7303;
          _t7265 = _t7294;
          break _t7266;
        }
        if (_t7264._tag === 8) {
          const path = _t7264._val[0];
          const name = _t7264._val[1];
          const qualified_7311 = (String$concat(".", path) + ("." + name));
          const _t7313 = ({_tag: 0, _name: "TyName", _val: qualified_7311});
          __x = _t7313;
          continue;
          const _t7312 = undefined;
          _t7265 = _t7312;
          break _t7266;
        }
        if (_t7264._tag === 9) {
          const _kind = _t7264._val[0];
          const tags = _t7264._val[1];
          function _t7314(__p220, acc) {
            let _t7316;
            const _t7315 = __p220;
            _t7317: {
              if (true) {
                const tag = _t7315[0];
                const payload_annot = _t7315[1];
                _t7316 = ({_tag: 0, _name: "PVRow", _val: [tag, Option$map(go, payload_annot), acc]});
                break _t7317;
              }
              _match_fail("line 16933");
            }
            return _t7316;
          }
          const row_7318 = List$fold_right(_t7314, tags, ({_tag: 2, _name: "PVEmpty"}));
          const _t7319 = ({_tag: 14, _name: "TPolyVariant", _val: row_7318});
          _t7265 = _t7319;
          break _t7266;
        }
        if (_t7264._tag === 10) {
          const ty = _t7264._val[0];
          const _t7320 = ty;
          __x = _t7320;
          continue;
          _t7265 = undefined;
          break _t7266;
        }
        _match_fail("line 16933");
      }
      return _t7265;
    }
  }
  const tys_7322 = List$map(go, annots);
  const _t7323 = [tys_7322, Ref$get(next_idx_7262), tvars_7260];
  const _t7321 = _t7323;
  const _t7263 = _t7321;
  const _t7261 = _t7263;
  return _t7261;
}
function Typechecker$process_instance_def(ctx, level, class_name, inst_ty_annots, constraints, methods) {
  const class_name_7324 = Typechecker$resolve_type_alias(ctx.type_env, class_name);
  function _t7326(c) {
    return (c.class_name === class_name_7324);
  }
  let _t7328;
  const _t7327 = List$find(_t7326, ctx.type_env.classes);
  _t7329: {
    if (_t7327._tag === 1) {
      const c = _t7327._val;
      _t7328 = c;
      break _t7329;
    }
    if (_t7327._tag === 0) {
      _t7328 = Typechecker$error(("unknown class: " + __dict_Show_string.show(class_name_7324)));
      break _t7329;
    }
    _match_fail("line 16933");
  }
  const class_def_7330 = _t7328;
  const num_class_params_7332 = List$length(class_def_7330.class_params);
  let _t7335;
  const _t7334 = Typechecker$resolve_inst_tys(ctx, inst_ty_annots);
  _t7336: {
    if (true) {
      const stored_tys = _t7334[0];
      const num_inst_vars = _t7334[1];
      const inst_tvars = _t7334[2];
      let _t7337;
      if ((List$length(stored_tys) !== num_class_params_7332)) {
        _t7337 = Typechecker$error(((((("class " + __dict_Show_string.show(class_name_7324)) + " expects ") + __dict_Show_int.show(num_class_params_7332)) + " type parameters, got ") + __dict_Show_int.show(List$length(stored_tys))));
      } else {
        _t7337 = undefined;
      }
      _t7337;
      const dname_7338 = _call(Types$dict_name, [__dict_Show_string, class_name_7324, stored_tys]);
      function _t7340(_) {
        return Types$new_tvar((level + 1));
      }
      const check_tvar_list_7341 = List$init(num_inst_vars, _t7340);
      function _t7343(t) {
        return Typechecker$subst_tgens(check_tvar_list_7341, t);
      }
      const check_tys_7344 = List$map(_t7343, stored_tys);
      function _t7346(i) {
        let _t7349;
        if ((i.inst_class === class_name_7324)) {
        let _t7348;
        if ((List$length(i.inst_tys) === List$length(stored_tys))) {
        function _t7347(t) {
          return ({_tag: 1, _name: "Some", _val: t});
        }
          _t7348 = Types$match_partial_inst(i.inst_tys, List$map(_t7347, stored_tys));
        } else {
          _t7348 = false;
        }
          _t7349 = _t7348;
        } else {
          _t7349 = false;
        }
        return _t7349;
      }
      let _t7350;
      if (List$exists(_t7346, ctx.type_env.instances)) {
        _t7350 = Typechecker$error(((("duplicate instance " + __dict_Show_string.show(class_name_7324)) + " for types ") + __dict_Show_string.show(String$concat(", ", List$map(Types$pp_ty, stored_tys)))));
      } else {
        _t7350 = undefined;
      }
      _t7350;
      function _t7351(__p221) {
        let _t7353;
        const _t7352 = __p221;
        _t7354: {
          if (true) {
            const mname = _t7352[0];
            function _t7355(__p222) {
              let _t7357;
              const _t7356 = __p222;
              _t7358: {
                if (true) {
                  const n = _t7356[0];
                  _t7357 = (n === mname);
                  break _t7358;
                }
                _match_fail("line 16933");
              }
              return _t7357;
            }
            let _t7359;
            if ((!List$exists(_t7355, methods))) {
              _t7359 = Typechecker$error(((((("instance " + __dict_Show_string.show(class_name_7324)) + " ") + __dict_Show_string.show(String$concat(" ", List$map(Types$pp_ty, stored_tys)))) + " missing method: ") + __dict_Show_string.show(mname)));
            } else {
              _t7359 = undefined;
            }
            _t7353 = _t7359;
            break _t7354;
          }
          _match_fail("line 16933");
        }
        return _t7353;
      }
      List$iter(_t7351, class_def_7330.class_methods);
      function _t7360(__p223) {
        let _t7362;
        const _t7361 = __p223;
        _t7363: {
          if (true) {
            const mname = _t7361[0];
            const params = _t7361[1];
            const body = _t7361[2];
            let _t7365;
            const _t7364 = List$assoc_opt(mname, class_def_7330.class_methods);
            _t7366: {
              if (_t7364._tag === 1) {
                const ty = _t7364._val;
                _t7365 = ty;
                break _t7366;
              }
              if (_t7364._tag === 0) {
                _t7365 = Typechecker$error(((__dict_Show_string.show(mname) + " is not a method of class ") + __dict_Show_string.show(class_name_7324)));
                break _t7366;
              }
              _match_fail("line 16933");
            }
            const method_schema_ty_7367 = _t7365;
            const concrete_method_ty_7369 = Typechecker$subst_tgens(check_tys_7344, method_schema_ty_7367);
            const max_tgen_7371 = Typechecker$max_tgen_in_ty(concrete_method_ty_7369);
            const max_effgen_7373 = Typechecker$max_effgen_in_ty(concrete_method_ty_7369);
            let _t7375;
            if ((max_tgen_7371 >= 0)) {
              _t7375 = (max_tgen_7371 + 1);
            } else {
              _t7375 = 0;
            }
            const quant_7376 = _t7375;
            let _t7378;
            if ((max_effgen_7373 >= 0)) {
              _t7378 = (max_effgen_7373 + 1);
            } else {
              _t7378 = 0;
            }
            const equant_7379 = _t7378;
            let _t7381;
            if (((quant_7376 > 0) || (equant_7379 > 0))) {
              _t7381 = Types$instantiate((level + 1), ({body: concrete_method_ty_7369, constraints: null, equant: equant_7379, pvquant: 0, quant: quant_7376, record_evidences: null, rquant: 0}));
            } else {
              _t7381 = concrete_method_ty_7369;
            }
            const concrete_method_ty_7382 = _t7381;
            const full_body_7384 = Typechecker$wrap_params_decl(params, ({_tag: 0, _name: "None"}), body);
            const te_7386 = Typechecker$check(ctx, (level + 1), full_body_7384, concrete_method_ty_7382);
            const _t7387 = [mname, te_7386];
            const _t7385 = _t7387;
            const _t7383 = _t7385;
            const _t7380 = _t7383;
            const _t7377 = _t7380;
            const _t7374 = _t7377;
            const _t7372 = _t7374;
            const _t7370 = _t7372;
            const _t7368 = _t7370;
            _t7362 = _t7368;
            break _t7363;
          }
          _match_fail("line 16933");
        }
        return _t7362;
      }
      const typed_methods_7388 = List$map(_t7360, methods);
      function _t7390(__p224, __p225) {
        let _t7392;
        const _t7391 = __p224;
        _t7393: {
          if (true) {
            const a = _t7391[0];
            let _t7395;
            const _t7394 = __p225;
            _t7396: {
              if (true) {
                const b = _t7394[0];
                _t7395 = String$compare(a, b);
                break _t7396;
              }
              _match_fail("line 16933");
            }
            _t7392 = _t7395;
            break _t7393;
          }
          _match_fail("line 16933");
        }
        return _t7392;
      }
      const sorted_methods_7397 = List$sort(_t7390, typed_methods_7388);
      function _t7399(__p226) {
        let _t7401;
        const _t7400 = __p226;
        _t7402: {
          if (true) {
            const n = _t7400[0];
            const te = _t7400[1];
            _t7401 = [n, te.ty];
            break _t7402;
          }
          _match_fail("line 16933");
        }
        return _t7401;
      }
      const record_ty_7403 = ({_tag: 11, _name: "TRecord", _val: Types$fields_to_closed_row(List$map(_t7399, sorted_methods_7397))});
      const dict_expr_7405 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: sorted_methods_7397}), record_ty_7403);
      function _t7407(__p227) {
        let _t7409;
        const _t7408 = __p227;
        _t7410: {
          if (true) {
            const cclass = _t7408[0];
            const tyvar_names = _t7408[1];
            const cclass_7411 = Typechecker$resolve_type_alias(ctx.type_env, cclass);
            function _t7413(tvname) {
              let _t7415;
              const _t7414 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, inst_tvars, tvname]);
              _t7416: {
                if (_t7414._tag === 1) {
                  const idx = _t7414._val;
                  _t7415 = ({_tag: 0, _name: "CATGen", _val: idx});
                  break _t7416;
                }
                if (_t7414._tag === 0) {
                  _t7415 = Typechecker$error((("constraint type variable '" + __dict_Show_string.show(tvname)) + " not found in instance type parameters"));
                  break _t7416;
                }
                _match_fail("line 16933");
              }
              return _t7415;
            }
            const cc_args_7417 = List$map(_t7413, tyvar_names);
            const _t7418 = ({cc_args: cc_args_7417, cc_class: cclass_7411});
            const _t7412 = _t7418;
            _t7409 = _t7412;
            break _t7410;
          }
          _match_fail("line 16933");
        }
        return _t7409;
      }
      const inst_constraints_7419 = List$map(_t7407, constraints);
      const inst_def_7421 = ({inst_class: class_name_7324, inst_constraints: inst_constraints_7419, inst_dict_name: dname_7338, inst_tys: stored_tys});
      const _t7423 = (function() {
        const _t7424 = _h;
        _h = Object.assign({}, _t7424, {
          "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
        });
        try {
          const __x_7425 = Types$check_fundep_consistency(class_def_7330, inst_def_7421, ctx.type_env.instances);
          return __x_7425;
        } catch (_exc) {
          if (_exc && _exc._e === "unify_error") {
            const msg = _exc._v;
            return Typechecker$error(msg);
          } else { throw _exc; }
        } finally { _h = _t7424; }
      })();
      _t7423;
      const __rec_upd_7426 = ctx.type_env;
      const _t7427 = ({classes: __rec_upd_7426.classes, constructors: __rec_upd_7426.constructors, effects: __rec_upd_7426.effects, hidden_ctor_types: __rec_upd_7426.hidden_ctor_types, hidden_types: __rec_upd_7426.hidden_types, instances: ({_hd: inst_def_7421, _tl: ctx.type_env.instances}), modules: __rec_upd_7426.modules, mutable_fields: __rec_upd_7426.mutable_fields, newtypes: __rec_upd_7426.newtypes, records: __rec_upd_7426.records, type_aliases: __rec_upd_7426.type_aliases, type_synonyms: __rec_upd_7426.type_synonyms, variants: __rec_upd_7426.variants});
      const type_env_7428 = _t7427;
      const __rec_upd_7430 = ctx;
      const _t7431 = ({constraint_tvars: __rec_upd_7430.constraint_tvars, current_eff: __rec_upd_7430.current_eff, current_module: __rec_upd_7430.current_module, inside_handler: __rec_upd_7430.inside_handler, loop_info: __rec_upd_7430.loop_info, mutable_vars: __rec_upd_7430.mutable_vars, return_type: __rec_upd_7430.return_type, return_used: __rec_upd_7430.return_used, type_env: type_env_7428, vars: __rec_upd_7430.vars});
      const ctx_7432 = _t7431;
      const _t7433 = [ctx_7432, ({_tag: 0, _name: "TDLet", _val: [dname_7338, dict_expr_7405]})];
      const _t7429 = _t7433;
      const _t7422 = _t7429;
      const _t7420 = _t7422;
      const _t7406 = _t7420;
      const _t7404 = _t7406;
      const _t7398 = _t7404;
      const _t7389 = _t7398;
      const _t7345 = _t7389;
      const _t7342 = _t7345;
      const _t7339 = _t7342;
      _t7335 = _t7339;
      break _t7336;
    }
    _match_fail("line 16933");
  }
  const _t7333 = _t7335;
  const _t7331 = _t7333;
  const _t7325 = _t7331;
  return _t7325;
}
function Typechecker$extract_tyvar_ids(annot, ty) {
  let _t7435;
  const _t7434 = Hashtbl$create(4);
  _t7436: {
    if (true) {
      const mapping = _t7434;
      function walk(annot, ty) {
        while (true) {
          let _t7438;
          const _t7437 = [annot, Types$repr(ty)];
          _t7439: {
            if (_t7437[0]._tag === 1 && _t7437[1]._tag === 15 && _t7437[1]._val.contents._tag === 0) {
              const name = _t7437[0]._val;
              const id = _t7437[1]._val.contents._val[0];
              let _t7440;
              if ((!_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, mapping, name]))) {
                _t7440 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, mapping, name, id]);
              } else {
                _t7440 = undefined;
              }
              _t7438 = _t7440;
              break _t7439;
            }
            if (_t7437[0]._tag === 2 && (_t7437[1]._tag === 7 || _t7437[1]._tag === 8)) {
              const a1 = _t7437[0]._val[0];
              const a2 = _t7437[0]._val[1];
              const t1 = _t7437[1]._val[0];
              const t2 = _t7437[1]._val[2];
              walk(a1, t1);
              const _t7441 = a2;
              const _t7442 = t2;
              annot = _t7441;
              ty = _t7442;
              continue;
              _t7438 = undefined;
              break _t7439;
            }
            if (_t7437[0]._tag === 6 && _t7437[1]._tag === 9) {
              const anns = _t7437[0]._val;
              const tys = _t7437[1]._val;
              if ((List$length(anns) === List$length(tys))) {
                _t7438 = List$iter2(walk, anns, tys);
                break _t7439;
              }
            }
            if (_t7437[0]._tag === 4 && _t7437[1]._tag === 10) {
              const a = _t7437[0]._val;
              const t = _t7437[1]._val;
              const _t7443 = a;
              const _t7444 = t;
              annot = _t7443;
              ty = _t7444;
              continue;
              _t7438 = undefined;
              break _t7439;
            }
            if (_t7437[0]._tag === 5 && _t7437[1]._tag === 13) {
              const a = _t7437[0]._val;
              const t = _t7437[1]._val;
              const _t7445 = a;
              const _t7446 = t;
              annot = _t7445;
              ty = _t7446;
              continue;
              _t7438 = undefined;
              break _t7439;
            }
            if (_t7437[0]._tag === 7 && _t7437[1]._tag === 12) {
              const args = _t7437[0]._val[0];
              const tys = _t7437[1]._val[1];
              if ((List$length(args) === List$length(tys))) {
                _t7438 = List$iter2(walk, args, tys);
                break _t7439;
              }
            }
            if (_t7437[0]._tag === 10) {
              const a = _t7437[0]._val[0];
              const _t7447 = a;
              const _t7448 = ty;
              annot = _t7447;
              ty = _t7448;
              continue;
              _t7438 = undefined;
              break _t7439;
            }
            if (true) {
              _t7438 = undefined;
              break _t7439;
            }
            _match_fail("line 16933");
          }
          return _t7438;
        }
      }
      walk(annot, ty);
      const _t7449 = mapping;
      _t7435 = _t7449;
      break _t7436;
    }
    _match_fail("line 16933");
  }
  return _t7435;
}
function Typechecker$resolve_let_constraints(type_env, level, constraints, params, ret_annot, te_ty, shared_tvars) {
  let _t7450;
  if (_eq(constraints, null)) {
    _t7450 = Types$generalize(level, te_ty);
  } else {
    let _t7452;
    const _t7451 = Hashtbl$create(4);
    _t7453: {
      if (true) {
        const name_to_tvar = _t7451;
        function _t7454(tbl) {
          function _t7455(k, v) {
            let _t7456;
            if ((!_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, name_to_tvar, k]))) {
              _t7456 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, name_to_tvar, k, v]);
            } else {
              _t7456 = undefined;
            }
            return _t7456;
          }
          return Hashtbl$iter(_t7455, tbl);
        }
        const merge_into_7457 = _t7454;
        function walk_params(params, ty) {
          while (true) {
            let _t7460;
            const _t7459 = [params, Types$repr(ty)];
            _t7461: {
              if (_t7459[0] !== null && (_t7459[1]._tag === 7 || _t7459[1]._tag === 8)) {
                const p = _t7459[0]._hd;
                const rest = _t7459[0]._tl;
                const param_ty = _t7459[1]._val[0];
                const ret_ty = _t7459[1]._val[2];
                let _t7463;
                const _t7462 = p.annot;
                _t7464: {
                  if (_t7462._tag === 1) {
                    const annot = _t7462._val;
                    _t7463 = merge_into_7457(Typechecker$extract_tyvar_ids(annot, param_ty));
                    break _t7464;
                  }
                  if (_t7462._tag === 0) {
                    _t7463 = undefined;
                    break _t7464;
                  }
                  _match_fail("line 16933");
                }
                _t7463;
                const _t7465 = rest;
                const _t7466 = ret_ty;
                params = _t7465;
                ty = _t7466;
                continue;
                _t7460 = undefined;
                break _t7461;
              }
              if (true) {
                _t7460 = undefined;
                break _t7461;
              }
              _match_fail("line 16933");
            }
            return _t7460;
          }
        }
        walk_params(params, te_ty);
        let _t7469;
        const _t7468 = ret_annot;
        _t7470: {
          if (_t7468._tag === 1) {
            const annot = _t7468._val;
            function skip_arrows(ty, n) {
              while (true) {
                let _t7471;
                if ((n === 0)) {
                  _t7471 = ty;
                } else {
                  let _t7473;
                  const _t7472 = Types$repr(ty);
                  _t7474: {
                    if ((_t7472._tag === 7 || _t7472._tag === 8)) {
                      const rest = _t7472._val[2];
                      const _t7475 = rest;
                      const _t7476 = (n - 1);
                      ty = _t7475;
                      n = _t7476;
                      continue;
                      _t7473 = undefined;
                      break _t7474;
                    }
                    if (true) {
                      _t7473 = ty;
                      break _t7474;
                    }
                    _match_fail("line 16933");
                  }
                  _t7471 = _t7473;
                }
                return _t7471;
              }
            }
            const ret_ty_7478 = skip_arrows(te_ty, List$length(params));
            const _t7479 = merge_into_7457(Typechecker$extract_tyvar_ids(annot, ret_ty_7478));
            const _t7477 = _t7479;
            _t7469 = _t7477;
            break _t7470;
          }
          if (_t7468._tag === 0) {
            _t7469 = undefined;
            break _t7470;
          }
          _match_fail("line 16933");
        }
        _t7469;
        let _t7481;
        const _t7480 = Types$generalize_with_map(level, te_ty);
        _t7482: {
          if (true) {
            const scheme = _t7480[0];
            const id_map = _t7480[1];
            const phantom_counter_7483 = Ref$create(scheme.quant);
            const phantom_map_7485 = Hashtbl$create(4);
            function _t7487(__p228) {
              let _t7489;
              const _t7488 = __p228;
              _t7490: {
                if (true) {
                  const cclass = _t7488[0];
                  const tyvar_names = _t7488[1];
                  const cclass_7491 = Typechecker$resolve_type_alias(type_env, cclass);
                  function _t7493(tvname) {
                    let _t7495;
                    const _t7494 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, name_to_tvar, tvname]);
                    _t7496: {
                      if (_t7494._tag === 1) {
                        const tvar_id = _t7494._val;
                        let _t7498;
                        const _t7497 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, tvar_id]);
                        _t7499: {
                          if (_t7497._tag === 1 && _t7497._val._tag === 16) {
                            const idx = _t7497._val._val;
                            _t7498 = ({_tag: 0, _name: "CATGen", _val: idx});
                            break _t7499;
                          }
                          if (true) {
                            _t7498 = Typechecker$error((("constraint type variable '" + __dict_Show_string.show(tvname)) + " is not polymorphic"));
                            break _t7499;
                          }
                          _match_fail("line 16933");
                        }
                        _t7495 = _t7498;
                        break _t7496;
                      }
                      if (_t7494._tag === 0) {
                        let _t7501;
                        const _t7500 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, shared_tvars, tvname]);
                        _t7502: {
                          if (_t7500._tag === 1) {
                            const tv = _t7500._val;
                            let _t7504;
                            const _t7503 = Types$repr(tv);
                            _t7505: {
                              if (_t7503._tag === 15 && _t7503._val.contents._tag === 0) {
                                const id = _t7503._val.contents._val[0];
                                _t7504 = ({_tag: 1, _name: "Some", _val: id});
                                break _t7505;
                              }
                              if (true) {
                                _t7504 = ({_tag: 0, _name: "None"});
                                break _t7505;
                              }
                              _match_fail("line 16933");
                            }
                            const tv_id_7506 = _t7504;
                            let _t7509;
                            const _t7508 = tv_id_7506;
                            _t7510: {
                              if (_t7508._tag === 1) {
                                const id = _t7508._val;
                                _t7509 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, id_map, id]);
                                break _t7510;
                              }
                              if (_t7508._tag === 0) {
                                _t7509 = ({_tag: 0, _name: "None"});
                                break _t7510;
                              }
                              _match_fail("line 16933");
                            }
                            const tgen_from_map_7511 = _t7509;
                            let _t7514;
                            const _t7513 = tgen_from_map_7511;
                            _t7515: {
                              if (_t7513._tag === 1 && _t7513._val._tag === 16) {
                                const idx = _t7513._val._val;
                                _t7514 = ({_tag: 0, _name: "CATGen", _val: idx});
                                break _t7515;
                              }
                              if (true) {
                                let _t7517;
                                const _t7516 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, phantom_map_7485, tvname]);
                                _t7518: {
                                  if (_t7516._tag === 1) {
                                    const idx = _t7516._val;
                                    _t7517 = idx;
                                    break _t7518;
                                  }
                                  if (_t7516._tag === 0) {
                                    const idx_7519 = Ref$get(phantom_counter_7483);
                                    Ref$set(phantom_counter_7483, (Ref$get(phantom_counter_7483) + 1));
                                    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, phantom_map_7485, tvname, idx_7519]);
                                    const _t7520 = idx_7519;
                                    _t7517 = _t7520;
                                    break _t7518;
                                  }
                                  _match_fail("line 16933");
                                }
                                const idx_7521 = _t7517;
                                const _t7522 = ({_tag: 3, _name: "CAPhantom", _val: [idx_7521, tv]});
                                _t7514 = _t7522;
                                break _t7515;
                              }
                              _match_fail("line 16933");
                            }
                            const _t7512 = _t7514;
                            const _t7507 = _t7512;
                            _t7501 = _t7507;
                            break _t7502;
                          }
                          if (_t7500._tag === 0) {
                            _t7501 = Typechecker$error((("constraint type variable '" + __dict_Show_string.show(tvname)) + " not found in function signature"));
                            break _t7502;
                          }
                          _match_fail("line 16933");
                        }
                        _t7495 = _t7501;
                        break _t7496;
                      }
                      _match_fail("line 16933");
                    }
                    return _t7495;
                  }
                  const cc_args_7523 = List$map(_t7493, tyvar_names);
                  const _t7524 = ({cc_args: cc_args_7523, cc_class: cclass_7491});
                  const _t7492 = _t7524;
                  _t7489 = _t7492;
                  break _t7490;
                }
                _match_fail("line 16933");
              }
              return _t7489;
            }
            const cc_list_7525 = List$map(_t7487, constraints);
            const __rec_upd_7527 = scheme;
            const _t7528 = ({body: __rec_upd_7527.body, constraints: cc_list_7525, equant: __rec_upd_7527.equant, pvquant: __rec_upd_7527.pvquant, quant: __rec_upd_7527.quant, record_evidences: __rec_upd_7527.record_evidences, rquant: __rec_upd_7527.rquant});
            const _t7526 = _t7528;
            const _t7486 = _t7526;
            const _t7484 = _t7486;
            _t7481 = _t7484;
            break _t7482;
          }
          _match_fail("line 16933");
        }
        const _t7467 = _t7481;
        const _t7458 = _t7467;
        _t7452 = _t7458;
        break _t7453;
      }
      _match_fail("line 16933");
    }
    _t7450 = _t7452;
  }
  return _t7450;
}
function Typechecker$unify_constraint_tvars(__dict_Hash_0, __dict_Eq_0, type_env, constraints, shared_tvars, body_te) {
  const classes_7529 = type_env.classes;
  function walk(te) {
    let _t7532;
    const _t7531 = te.expr;
    _t7533: {
      if (_t7531._tag === 7) {
        const name = _t7531._val;
        let _t7535;
        const _t7534 = Types$find_method_class(classes_7529, name);
        _t7536: {
          if (_t7534._tag === 1) {
            const r = _t7534;
            _t7535 = r;
            break _t7536;
          }
          if (_t7534._tag === 0) {
            let _t7538;
            const _t7537 = String$rindex_opt(name, 46);
            _t7539: {
              if (_t7537._tag === 0) {
                _t7538 = ({_tag: 0, _name: "None"});
                break _t7539;
              }
              if (_t7537._tag === 1) {
                const i = _t7537._val;
                const _mml$short_7540 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                const _t7541 = Types$find_method_class(classes_7529, _mml$short_7540);
                _t7538 = _t7541;
                break _t7539;
              }
              _match_fail("line 16933");
            }
            _t7535 = _t7538;
            break _t7536;
          }
          _match_fail("line 16933");
        }
        const class_opt_7542 = _t7535;
        let _t7545;
        const _t7544 = class_opt_7542;
        _t7546: {
          if (_t7544._tag === 1) {
            const class_def = _t7544._val;
            let _t7548;
            const _t7547 = String$rindex_opt(name, 46);
            _t7549: {
              if (_t7547._tag === 1) {
                const i = _t7547._val;
                _t7548 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                break _t7549;
              }
              if (_t7547._tag === 0) {
                _t7548 = name;
                break _t7549;
              }
              _match_fail("line 16933");
            }
            const method_name_7550 = _t7548;
            let _t7553;
            const _t7552 = List$assoc_opt(method_name_7550, class_def.class_methods);
            _t7554: {
              if (_t7552._tag === 1) {
                const method_schema_ty = _t7552._val;
                const num_params_7555 = List$length(class_def.class_params);
                const param_map_7557 = Hashtbl$create(num_params_7555);
                function go(s, r) {
                  while (true) {
                    const r_7559 = Types$repr(r);
                    let _t7562;
                    const _t7561 = [s, r_7559];
                    _t7563: {
                      if (_t7561[0]._tag === 16) {
                        const i = _t7561[0]._val;
                        if ((i < num_params_7555)) {
                          let _t7564;
                          if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, param_map_7557, i]))) {
                            _t7564 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, param_map_7557, i, r_7559]);
                          } else {
                            _t7564 = undefined;
                          }
                          _t7562 = _t7564;
                          break _t7563;
                        }
                      }
                      if ((_t7561[0]._tag === 7 && _t7561[1]._tag === 7 || _t7561[0]._tag === 8 && _t7561[1]._tag === 8)) {
                        const s1 = _t7561[0]._val[0];
                        const s2 = _t7561[0]._val[2];
                        const r1 = _t7561[1]._val[0];
                        const r2 = _t7561[1]._val[2];
                        go(s1, r1);
                        const _t7565 = s2;
                        const _t7566 = r2;
                        s = _t7565;
                        r = _t7566;
                        continue;
                        _t7562 = undefined;
                        break _t7563;
                      }
                      if (_t7561[0]._tag === 9 && _t7561[1]._tag === 9) {
                        const ss = _t7561[0]._val;
                        const rs = _t7561[1]._val;
                        if ((List$length(ss) === List$length(rs))) {
                          _t7562 = List$iter2(go, ss, rs);
                          break _t7563;
                        }
                      }
                      if (_t7561[0]._tag === 10 && _t7561[1]._tag === 10) {
                        const s1 = _t7561[0]._val;
                        const r1 = _t7561[1]._val;
                        const _t7567 = s1;
                        const _t7568 = r1;
                        s = _t7567;
                        r = _t7568;
                        continue;
                        _t7562 = undefined;
                        break _t7563;
                      }
                      if (_t7561[0]._tag === 13 && _t7561[1]._tag === 13) {
                        const s1 = _t7561[0]._val;
                        const r1 = _t7561[1]._val;
                        const _t7569 = s1;
                        const _t7570 = r1;
                        s = _t7569;
                        r = _t7570;
                        continue;
                        _t7562 = undefined;
                        break _t7563;
                      }
                      if (_t7561[0]._tag === 12 && _t7561[1]._tag === 12) {
                        const ss = _t7561[0]._val[1];
                        const rs = _t7561[1]._val[1];
                        if ((List$length(ss) === List$length(rs))) {
                          _t7562 = List$iter2(go, ss, rs);
                          break _t7563;
                        }
                      }
                      if (true) {
                        _t7562 = undefined;
                        break _t7563;
                      }
                      _match_fail("line 16933");
                    }
                    const _t7560 = _t7562;
                    return _t7560;
                  }
                }
                go(method_schema_ty, te.ty);
                function _t7572(__p229) {
                  let _t7574;
                  const _t7573 = __p229;
                  _t7575: {
                    if (true) {
                      const cclass = _t7573[0];
                      const tyvar_names = _t7573[1];
                      let _t7576;
                      if (((cclass === class_def.class_name) && (List$length(tyvar_names) === num_params_7555))) {
                        function _t7577(fd) {
                          function _t7578(fi) {
                            let _t7580;
                            const _t7579 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, param_map_7557, fi]);
                            _t7581: {
                              if (_t7579._tag === 1) {
                                const body_tv = _t7579._val;
                                const tvname_7582 = List$nth(tyvar_names, fi);
                                let _t7585;
                                const _t7584 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, shared_tvars, tvname_7582]);
                                _t7586: {
                                  if (_t7584._tag === 1) {
                                    const constraint_tv = _t7584._val;
                                    _t7585 = _eq(Types$repr(body_tv), Types$repr(constraint_tv));
                                    break _t7586;
                                  }
                                  if (_t7584._tag === 0) {
                                    _t7585 = true;
                                    break _t7586;
                                  }
                                  _match_fail("line 16933");
                                }
                                const _t7583 = _t7585;
                                _t7580 = _t7583;
                                break _t7581;
                              }
                              if (_t7579._tag === 0) {
                                _t7580 = true;
                                break _t7581;
                              }
                              _match_fail("line 16933");
                            }
                            return _t7580;
                          }
                          return List$forall(_t7578, fd.fd_from);
                        }
                        const from_match_7587 = List$forall(_t7577, class_def.class_fundeps);
                        let _t7589;
                        if (from_match_7587) {
                          function _t7590(fd) {
                            function _t7591(ti) {
                              let _t7593;
                              const _t7592 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, param_map_7557, ti]);
                              _t7594: {
                                if (_t7592._tag === 1) {
                                  const body_tv = _t7592._val;
                                  const tvname_7595 = List$nth(tyvar_names, ti);
                                  let _t7598;
                                  const _t7597 = _call(Hashtbl$get, [__dict_Hash_0, __dict_Eq_0, shared_tvars, tvname_7595]);
                                  _t7599: {
                                    if (_t7597._tag === 1) {
                                      const constraint_tv = _t7597._val;
                                      _t7598 = Types$unify(body_tv, constraint_tv);
                                      break _t7599;
                                    }
                                    if (_t7597._tag === 0) {
                                      _t7598 = undefined;
                                      break _t7599;
                                    }
                                    _match_fail("line 16933");
                                  }
                                  const _t7596 = _t7598;
                                  _t7593 = _t7596;
                                  break _t7594;
                                }
                                if (_t7592._tag === 0) {
                                  _t7593 = undefined;
                                  break _t7594;
                                }
                                _match_fail("line 16933");
                              }
                              return _t7593;
                            }
                            return List$iter(_t7591, fd.fd_to);
                          }
                          _t7589 = List$iter(_t7590, class_def.class_fundeps);
                        } else {
                          _t7589 = undefined;
                        }
                        const _t7588 = _t7589;
                        _t7576 = _t7588;
                      } else {
                        _t7576 = undefined;
                      }
                      _t7574 = _t7576;
                      break _t7575;
                    }
                    _match_fail("line 16933");
                  }
                  return _t7574;
                }
                const _t7571 = List$iter(_t7572, constraints);
                const _t7558 = _t7571;
                const _t7556 = _t7558;
                _t7553 = _t7556;
                break _t7554;
              }
              if (_t7552._tag === 0) {
                _t7553 = undefined;
                break _t7554;
              }
              _match_fail("line 16933");
            }
            const _t7551 = _t7553;
            _t7545 = _t7551;
            break _t7546;
          }
          if (_t7544._tag === 0) {
            _t7545 = undefined;
            break _t7546;
          }
          _match_fail("line 16933");
        }
        const _t7543 = _t7545;
        _t7532 = _t7543;
        break _t7533;
      }
      if (_t7531._tag === 11) {
        const f = _t7531._val[0];
        const x = _t7531._val[1];
        walk(f);
        _t7532 = walk(x);
        break _t7533;
      }
      if (_t7531._tag === 10) {
        const body = _t7531._val[1];
        _t7532 = walk(body);
        break _t7533;
      }
      if (_t7531._tag === 8) {
        const e1 = _t7531._val[2];
        const e2 = _t7531._val[3];
        walk(e1);
        _t7532 = walk(e2);
        break _t7533;
      }
      if (_t7531._tag === 9) {
        const e1 = _t7531._val[2];
        const e2 = _t7531._val[3];
        walk(e1);
        _t7532 = walk(e2);
        break _t7533;
      }
      if (_t7531._tag === 12) {
        const c = _t7531._val[0];
        const t = _t7531._val[1];
        const e = _t7531._val[2];
        walk(c);
        walk(t);
        _t7532 = walk(e);
        break _t7533;
      }
      if (_t7531._tag === 13) {
        const a = _t7531._val[1];
        const b = _t7531._val[2];
        walk(a);
        _t7532 = walk(b);
        break _t7533;
      }
      if (_t7531._tag === 14) {
        const a = _t7531._val[1];
        _t7532 = walk(a);
        break _t7533;
      }
      if (_t7531._tag === 15) {
        const es = _t7531._val;
        _t7532 = List$iter(walk, es);
        break _t7533;
      }
      if (_t7531._tag === 16) {
        const fields = _t7531._val;
        function _t7600(__p230) {
          let _t7602;
          const _t7601 = __p230;
          _t7603: {
            if (true) {
              const e = _t7601[1];
              _t7602 = walk(e);
              break _t7603;
            }
            _match_fail("line 16933");
          }
          return _t7602;
        }
        _t7532 = List$iter(_t7600, fields);
        break _t7533;
      }
      if (_t7531._tag === 17) {
        const e = _t7531._val[0];
        const fields = _t7531._val[1];
        walk(e);
        function _t7604(__p231) {
          let _t7606;
          const _t7605 = __p231;
          _t7607: {
            if (true) {
              const e = _t7605[1];
              _t7606 = walk(e);
              break _t7607;
            }
            _match_fail("line 16933");
          }
          return _t7606;
        }
        _t7532 = List$iter(_t7604, fields);
        break _t7533;
      }
      if (_t7531._tag === 18) {
        const e = _t7531._val[0];
        const pairs = _t7531._val[1];
        walk(e);
        function _t7608(__p232) {
          let _t7610;
          const _t7609 = __p232;
          _t7611: {
            if (true) {
              const i = _t7609[0];
              const v = _t7609[1];
              walk(i);
              _t7610 = walk(v);
              break _t7611;
            }
            _match_fail("line 16933");
          }
          return _t7610;
        }
        _t7532 = List$iter(_t7608, pairs);
        break _t7533;
      }
      if (_t7531._tag === 19) {
        const e = _t7531._val[0];
        _t7532 = walk(e);
        break _t7533;
      }
      if (_t7531._tag === 20) {
        const e1 = _t7531._val[0];
        const e2 = _t7531._val[1];
        walk(e1);
        _t7532 = walk(e2);
        break _t7533;
      }
      if (_t7531._tag === 21) {
        const hd = _t7531._val[0];
        const tl = _t7531._val[1];
        walk(hd);
        _t7532 = walk(tl);
        break _t7533;
      }
      if (_t7531._tag === 24) {
        const scrut = _t7531._val[0];
        const branches = _t7531._val[1];
        walk(scrut);
        function _t7612(__p233) {
          let _t7614;
          const _t7613 = __p233;
          _t7615: {
            if (true) {
              const guard = _t7613[1];
              const body = _t7613[2];
              let _t7617;
              const _t7616 = guard;
              _t7618: {
                if (_t7616._tag === 1) {
                  const g = _t7616._val;
                  _t7617 = walk(g);
                  break _t7618;
                }
                if (_t7616._tag === 0) {
                  _t7617 = undefined;
                  break _t7618;
                }
                _match_fail("line 16933");
              }
              _t7617;
              _t7614 = walk(body);
              break _t7615;
            }
            _match_fail("line 16933");
          }
          return _t7614;
        }
        _t7532 = List$iter(_t7612, branches);
        break _t7533;
      }
      if (_t7531._tag === 28) {
        const e1 = _t7531._val[0];
        const e2 = _t7531._val[1];
        walk(e1);
        _t7532 = walk(e2);
        break _t7533;
      }
      if (_t7531._tag === 25) {
        const e1 = _t7531._val[1];
        const e2 = _t7531._val[2];
        walk(e1);
        _t7532 = walk(e2);
        break _t7533;
      }
      if (_t7531._tag === 26) {
        const e = _t7531._val[1];
        _t7532 = walk(e);
        break _t7533;
      }
      if (_t7531._tag === 27) {
        const e1 = _t7531._val[0];
        const e2 = _t7531._val[2];
        walk(e1);
        _t7532 = walk(e2);
        break _t7533;
      }
      if (_t7531._tag === 23 && _t7531._val[1]._tag === 1) {
        const e = _t7531._val[1]._val;
        _t7532 = walk(e);
        break _t7533;
      }
      if (_t7531._tag === 29) {
        const e = _t7531._val[1];
        _t7532 = walk(e);
        break _t7533;
      }
      if (_t7531._tag === 30) {
        const body = _t7531._val[0];
        _t7532 = walk(body);
        break _t7533;
      }
      if (_t7531._tag === 31) {
        const e1 = _t7531._val[0];
        const e2 = _t7531._val[1];
        walk(e1);
        _t7532 = walk(e2);
        break _t7533;
      }
      if (_t7531._tag === 32) {
        const cond = _t7531._val[0];
        const body = _t7531._val[1];
        walk(cond);
        _t7532 = walk(body);
        break _t7533;
      }
      if (_t7531._tag === 36) {
        const body = _t7531._val;
        _t7532 = walk(body);
        break _t7533;
      }
      if (_t7531._tag === 38) {
        const es = _t7531._val;
        _t7532 = List$iter(walk, es);
        break _t7533;
      }
      if (_t7531._tag === 39) {
        const e = _t7531._val;
        _t7532 = walk(e);
        break _t7533;
      }
      if (_t7531._tag === 33) {
        const e = _t7531._val;
        _t7532 = walk(e);
        break _t7533;
      }
      if (_t7531._tag === 35) {
        const e = _t7531._val;
        _t7532 = walk(e);
        break _t7533;
      }
      if (_t7531._tag === 37) {
        const bindings = _t7531._val[0];
        const body = _t7531._val[1];
        function _t7619(__p234) {
          let _t7621;
          const _t7620 = __p234;
          _t7622: {
            if (true) {
              const e = _t7620[1];
              _t7621 = walk(e);
              break _t7622;
            }
            _match_fail("line 16933");
          }
          return _t7621;
        }
        List$iter(_t7619, bindings);
        _t7532 = walk(body);
        break _t7533;
      }
      if (true) {
        _t7532 = undefined;
        break _t7533;
      }
      _match_fail("line 16933");
    }
    return _t7532;
  }
  const _t7623 = walk(body_te);
  const _t7530 = _t7623;
  return _t7530;
}
function Typechecker$synth_constrained_fn(ctx, level, constraints, params, ret_annot, body) {
  const shared_tvars_7624 = Hashtbl$create(4);
  function _t7626(__p235) {
    let _t7628;
    const _t7627 = __p235;
    _t7629: {
      if (true) {
        const names = _t7627[1];
        _t7628 = names;
        break _t7629;
      }
      _match_fail("line 16933");
    }
    return _t7628;
  }
  const constraint_tyvar_names_7630 = _call(_call(List$sort_uniq, [String$compare]), [List$flatten(List$map(_t7626, constraints))]);
  function _t7632(tvname) {
    return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_7624, tvname, Types$new_tvar((level + 1))]);
  }
  List$iter(_t7632, constraint_tyvar_names_7630);
  function _t7633(tvname) {
    let _t7635;
    const _t7634 = Types$repr(_call(Hashtbl$find, [__dict_Hash_string, __dict_Eq_string, shared_tvars_7624, tvname]));
    _t7636: {
      if (_t7634._tag === 15 && _t7634._val.contents._tag === 0) {
        const id = _t7634._val.contents._val[0];
        _t7635 = ({_tag: 1, _name: "Some", _val: id});
        break _t7636;
      }
      if (true) {
        _t7635 = ({_tag: 0, _name: "None"});
        break _t7636;
      }
      _match_fail("line 16933");
    }
    return _t7635;
  }
  const constraint_tvar_ids_7637 = List$filter_map(_t7633, constraint_tyvar_names_7630);
  function _t7639(p) {
    let _t7641;
    const _t7640 = p.annot;
    _t7642: {
      if (_t7640._tag === 1) {
        const annot = _t7640._val;
        _t7641 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_7624, annot);
        break _t7642;
      }
      if (_t7640._tag === 0) {
        _t7641 = Types$new_tvar((level + 1));
        break _t7642;
      }
      _match_fail("line 16933");
    }
    return _t7641;
  }
  const param_tys_7643 = List$map(_t7639, params);
  let _t7646;
  const _t7645 = ret_annot;
  _t7647: {
    if (_t7645._tag === 1) {
      const annot = _t7645._val;
      _t7646 = ({_tag: 1, _name: "Some", _val: Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_7624, annot)});
      break _t7647;
    }
    if (_t7645._tag === 0) {
      _t7646 = ({_tag: 0, _name: "None"});
      break _t7647;
    }
    _match_fail("line 16933");
  }
  const ret_ty_opt_7648 = _t7646;
  const body_eff_7650 = Types$new_effvar((level + 1));
  function _t7652(c, p, ty) {
    return Typechecker$extend_var_mono(c, p.name, ty);
  }
  const __rec_upd_7653 = ctx;
  const _t7654 = ({constraint_tvars: List$concat(constraint_tvar_ids_7637, ctx.constraint_tvars), current_eff: body_eff_7650, current_module: __rec_upd_7653.current_module, inside_handler: __rec_upd_7653.inside_handler, loop_info: __rec_upd_7653.loop_info, mutable_vars: __rec_upd_7653.mutable_vars, return_type: __rec_upd_7653.return_type, return_used: __rec_upd_7653.return_used, type_env: __rec_upd_7653.type_env, vars: __rec_upd_7653.vars});
  const inner_ctx_7655 = List$fold2(_t7652, _t7654, params, param_tys_7643);
  let _t7658;
  const _t7657 = ret_ty_opt_7648;
  _t7659: {
    if (_t7657._tag === 1) {
      const ret_ty = _t7657._val;
      _t7658 = Typechecker$check(inner_ctx_7655, (level + 1), body, ret_ty);
      break _t7659;
    }
    if (_t7657._tag === 0) {
      _t7658 = Typechecker$synth(inner_ctx_7655, (level + 1), body);
      break _t7659;
    }
    _match_fail("line 16933");
  }
  const body_te_7660 = _t7658;
  _call(Typechecker$unify_constraint_tvars, [__dict_Hash_string, __dict_Eq_string, ctx.type_env, constraints, shared_tvars_7624, body_te_7660]);
  let _t7663;
  const _t7662 = [List$rev(params), List$rev(param_tys_7643)];
  _t7664: {
    if (_t7662[0] === null && _t7662[1] === null) {
      _t7663 = body_te_7660;
      break _t7664;
    }
    if (_t7662[0] !== null && _t7662[1] !== null) {
      const last_p = _t7662[0]._hd;
      const rest_ps = _t7662[0]._tl;
      const last_pty = _t7662[1]._hd;
      const rest_ptys = _t7662[1]._tl;
      const inner_7665 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_7660, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff_7650, body_te_7660.ty]}));
      function _t7667(acc, p, pty) {
        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
      }
      const _t7666 = List$fold2(_t7667, inner_7665, rest_ps, rest_ptys);
      _t7663 = _t7666;
      break _t7664;
    }
    if (true) {
      _t7663 = failwith("assert false");
      break _t7664;
    }
    _match_fail("line 16933");
  }
  const te_7668 = _t7663;
  const scheme_7670 = Typechecker$resolve_let_constraints(ctx.type_env, level, constraints, params, ret_annot, te_7668.ty, shared_tvars_7624);
  const _t7671 = [te_7668, scheme_7670];
  const _t7669 = _t7671;
  const _t7661 = _t7669;
  const _t7656 = _t7661;
  const _t7651 = _t7656;
  const _t7649 = _t7651;
  const _t7644 = _t7649;
  const _t7638 = _t7644;
  const _t7631 = _t7638;
  const _t7625 = _t7631;
  return _t7625;
}
function Typechecker$find_module_in_env(type_env, mod_name) {
  let _t7673;
  const _t7672 = String$split(".", mod_name);
  _t7674: {
    if (_t7672 === null) {
      _t7673 = ({_tag: 0, _name: "None"});
      break _t7674;
    }
    if (_t7672 !== null && _t7672._tl === null) {
      const name = _t7672._hd;
      _t7673 = List$assoc_opt(name, type_env.modules);
      break _t7674;
    }
    if (_t7672 !== null) {
      const first = _t7672._hd;
      const rest = _t7672._tl;
      let _t7676;
      const _t7675 = List$assoc_opt(first, type_env.modules);
      _t7677: {
        if (_t7675._tag === 0) {
          _t7676 = ({_tag: 0, _name: "None"});
          break _t7677;
        }
        if (_t7675._tag === 1) {
          const minfo = _t7675._val;
          function drill(mi, __x) {
            while (true) {
              let _t7679;
              const _t7678 = __x;
              _t7680: {
                if (_t7678 === null) {
                  _t7679 = ({_tag: 1, _name: "Some", _val: mi});
                  break _t7680;
                }
                if (_t7678 !== null) {
                  const seg = _t7678._hd;
                  const rest = _t7678._tl;
                  let _t7682;
                  const _t7681 = List$assoc_opt(seg, mi.mod_submodules);
                  _t7683: {
                    if (_t7681._tag === 0) {
                      _t7682 = ({_tag: 0, _name: "None"});
                      break _t7683;
                    }
                    if (_t7681._tag === 1) {
                      const sub = _t7681._val;
                      const _t7684 = sub;
                      const _t7685 = rest;
                      mi = _t7684;
                      __x = _t7685;
                      continue;
                      _t7682 = undefined;
                      break _t7683;
                    }
                    _match_fail("line 16933");
                  }
                  _t7679 = _t7682;
                  break _t7680;
                }
                _match_fail("line 16933");
              }
              return _t7679;
            }
          }
          const _t7686 = drill(minfo, rest);
          _t7676 = _t7686;
          break _t7677;
        }
        _match_fail("line 16933");
      }
      _t7673 = _t7676;
      break _t7674;
    }
    _match_fail("line 16933");
  }
  return _t7673;
}
function Typechecker$open_module_into_ctx(ctx, mod_name, names_opt) {
  let _t7688;
  const _t7687 = Typechecker$find_module_in_env(ctx.type_env, mod_name);
  _t7689: {
    if (_t7687._tag === 0) {
      _t7688 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
      break _t7689;
    }
    if (_t7687._tag === 1) {
      const minfo = _t7687._val;
      function _t7690(name) {
        let _t7692;
        const _t7691 = names_opt;
        _t7693: {
          if (_t7691._tag === 0) {
            _t7692 = true;
            break _t7693;
          }
          if (_t7691._tag === 1) {
            const names = _t7691._val;
            _t7692 = List$mem(name, names);
            break _t7693;
          }
          _match_fail("line 16933");
        }
        return _t7692;
      }
      const filter_7694 = _t7690;
      function _t7696(ctx, __p236) {
        let _t7698;
        const _t7697 = __p236;
        _t7699: {
          if (true) {
            const _mml$short = _t7697[0];
            const scheme = _t7697[1];
            let _t7700;
            if (filter_7694(_mml$short)) {
              let _t7701;
              if (List$mem(_mml$short, minfo.mod_pub_mutable_vars)) {
                _t7701 = Typechecker$extend_var_mutable(ctx, _mml$short, scheme);
              } else {
                _t7701 = Typechecker$extend_var(ctx, _mml$short, scheme);
              }
              _t7700 = _t7701;
            } else {
              _t7700 = ctx;
            }
            _t7698 = _t7700;
            break _t7699;
          }
          _match_fail("line 16933");
        }
        return _t7698;
      }
      const ctx_7702 = List$fold(_t7696, ctx, minfo.mod_pub_vars);
      function _t7704(te, __p237) {
        let _t7706;
        const _t7705 = __p237;
        _t7707: {
          if (true) {
            const _mml$short = _t7705[0];
            const info = _t7705[1];
            let _t7708;
            if (filter_7694(_mml$short)) {
              const __rec_upd_7709 = te;
              const _t7710 = ({classes: __rec_upd_7709.classes, constructors: ({_hd: [_mml$short, info], _tl: te.constructors}), effects: __rec_upd_7709.effects, hidden_ctor_types: __rec_upd_7709.hidden_ctor_types, hidden_types: __rec_upd_7709.hidden_types, instances: __rec_upd_7709.instances, modules: __rec_upd_7709.modules, mutable_fields: __rec_upd_7709.mutable_fields, newtypes: __rec_upd_7709.newtypes, records: __rec_upd_7709.records, type_aliases: __rec_upd_7709.type_aliases, type_synonyms: __rec_upd_7709.type_synonyms, variants: __rec_upd_7709.variants});
              _t7708 = _t7710;
            } else {
              _t7708 = te;
            }
            _t7706 = _t7708;
            break _t7707;
          }
          _match_fail("line 16933");
        }
        return _t7706;
      }
      const type_env_7711 = List$fold(_t7704, ctx_7702.type_env, minfo.mod_pub_constructors);
      function _t7713(te, qname) {
        let _t7715;
        const _t7714 = String$rindex_opt(qname, 46);
        _t7716: {
          if (_t7714._tag === 1) {
            const i = _t7714._val;
            _t7715 = String$sub(qname, (i + 1), ((String$length(qname) - i) - 1));
            break _t7716;
          }
          if (_t7714._tag === 0) {
            _t7715 = qname;
            break _t7716;
          }
          _match_fail("line 16933");
        }
        const _mml$short_7717 = _t7715;
        let _t7719;
        if (filter_7694(_mml$short_7717)) {
          function _t7720(__p238) {
            let _t7722;
            const _t7721 = __p238;
            _t7723: {
              if (true) {
                const n = _t7721[0];
                _t7722 = (n === qname);
                break _t7723;
              }
              _match_fail("line 16933");
            }
            return _t7722;
          }
          let _t7725;
          const _t7724 = List$find(_t7720, te.variants);
          _t7726: {
            if (_t7724._tag === 1) {
              const np = _t7724._val[1];
              const vdef = _t7724._val[2];
              const is_gadt = _t7724._val[3];
              function _t7727(__p239) {
                let _t7729;
                const _t7728 = __p239;
                _t7730: {
                  if (true) {
                    const n = _t7728[0];
                    _t7729 = (n === _mml$short_7717);
                    break _t7730;
                  }
                  _match_fail("line 16933");
                }
                return _t7729;
              }
              let _t7731;
              if (List$exists(_t7727, te.variants)) {
                _t7731 = te;
              } else {
                const __rec_upd_7732 = te;
                const _t7733 = ({classes: __rec_upd_7732.classes, constructors: __rec_upd_7732.constructors, effects: __rec_upd_7732.effects, hidden_ctor_types: __rec_upd_7732.hidden_ctor_types, hidden_types: __rec_upd_7732.hidden_types, instances: __rec_upd_7732.instances, modules: __rec_upd_7732.modules, mutable_fields: __rec_upd_7732.mutable_fields, newtypes: __rec_upd_7732.newtypes, records: __rec_upd_7732.records, type_aliases: __rec_upd_7732.type_aliases, type_synonyms: __rec_upd_7732.type_synonyms, variants: ({_hd: [_mml$short_7717, np, vdef, is_gadt], _tl: te.variants})});
                _t7731 = _t7733;
              }
              _t7725 = _t7731;
              break _t7726;
            }
            if (_t7724._tag === 0) {
              _t7725 = te;
              break _t7726;
            }
            _match_fail("line 16933");
          }
          const te_7734 = _t7725;
          let _t7737;
          const _t7736 = List$assoc_opt(qname, te_7734.records);
          _t7738: {
            if (_t7736._tag === 1) {
              const fields = _t7736._val;
              let _t7739;
              if (!_eq(List$assoc_opt(_mml$short_7717, te_7734.records), ({_tag: 0, _name: "None"}))) {
                _t7739 = te_7734;
              } else {
                const __rec_upd_7740 = te_7734;
                const _t7741 = ({classes: __rec_upd_7740.classes, constructors: __rec_upd_7740.constructors, effects: __rec_upd_7740.effects, hidden_ctor_types: __rec_upd_7740.hidden_ctor_types, hidden_types: __rec_upd_7740.hidden_types, instances: __rec_upd_7740.instances, modules: __rec_upd_7740.modules, mutable_fields: __rec_upd_7740.mutable_fields, newtypes: __rec_upd_7740.newtypes, records: ({_hd: [_mml$short_7717, fields], _tl: te_7734.records}), type_aliases: __rec_upd_7740.type_aliases, type_synonyms: __rec_upd_7740.type_synonyms, variants: __rec_upd_7740.variants});
                _t7739 = _t7741;
              }
              _t7737 = _t7739;
              break _t7738;
            }
            if (_t7736._tag === 0) {
              _t7737 = te_7734;
              break _t7738;
            }
            _match_fail("line 16933");
          }
          const te_7742 = _t7737;
          function _t7744(__p240) {
            let _t7746;
            const _t7745 = __p240;
            _t7747: {
              if (true) {
                const n = _t7745[0];
                _t7746 = (n === qname);
                break _t7747;
              }
              _match_fail("line 16933");
            }
            return _t7746;
          }
          let _t7749;
          const _t7748 = List$find(_t7744, te_7742.type_synonyms);
          _t7750: {
            if (_t7748._tag === 1) {
              const np = _t7748._val[1];
              const expanded = _t7748._val[2];
              function _t7751(__p241) {
                let _t7753;
                const _t7752 = __p241;
                _t7754: {
                  if (true) {
                    const n = _t7752[0];
                    _t7753 = (n === _mml$short_7717);
                    break _t7754;
                  }
                  _match_fail("line 16933");
                }
                return _t7753;
              }
              let _t7755;
              if (List$exists(_t7751, te_7742.type_synonyms)) {
                _t7755 = te_7742;
              } else {
                const __rec_upd_7756 = te_7742;
                const _t7757 = ({classes: __rec_upd_7756.classes, constructors: __rec_upd_7756.constructors, effects: __rec_upd_7756.effects, hidden_ctor_types: __rec_upd_7756.hidden_ctor_types, hidden_types: __rec_upd_7756.hidden_types, instances: __rec_upd_7756.instances, modules: __rec_upd_7756.modules, mutable_fields: __rec_upd_7756.mutable_fields, newtypes: __rec_upd_7756.newtypes, records: __rec_upd_7756.records, type_aliases: __rec_upd_7756.type_aliases, type_synonyms: ({_hd: [_mml$short_7717, np, expanded], _tl: te_7742.type_synonyms}), variants: __rec_upd_7756.variants});
                _t7755 = _t7757;
              }
              _t7749 = _t7755;
              break _t7750;
            }
            if (_t7748._tag === 0) {
              _t7749 = te_7742;
              break _t7750;
            }
            _match_fail("line 16933");
          }
          const te_7758 = _t7749;
          let _t7760;
          if ((_mml$short_7717 === qname)) {
            _t7760 = te_7758;
          } else {
            const __rec_upd_7761 = te_7758;
            const _t7762 = ({classes: __rec_upd_7761.classes, constructors: __rec_upd_7761.constructors, effects: __rec_upd_7761.effects, hidden_ctor_types: __rec_upd_7761.hidden_ctor_types, hidden_types: __rec_upd_7761.hidden_types, instances: __rec_upd_7761.instances, modules: __rec_upd_7761.modules, mutable_fields: __rec_upd_7761.mutable_fields, newtypes: __rec_upd_7761.newtypes, records: __rec_upd_7761.records, type_aliases: ({_hd: [_mml$short_7717, qname], _tl: te_7758.type_aliases}), type_synonyms: __rec_upd_7761.type_synonyms, variants: __rec_upd_7761.variants});
            _t7760 = _t7762;
          }
          const te_7763 = _t7760;
          const _t7764 = te_7763;
          const _t7759 = _t7764;
          const _t7743 = _t7759;
          const _t7735 = _t7743;
          _t7719 = _t7735;
        } else {
          _t7719 = te;
        }
        const _t7718 = _t7719;
        return _t7718;
      }
      const type_env_7765 = List$fold(_t7713, type_env_7711, minfo.mod_pub_types);
      function _t7767(te, qname) {
        let _t7768;
        if (List$mem(qname, te.newtypes)) {
          _t7768 = te;
        } else {
          const __rec_upd_7769 = te;
          const _t7770 = ({classes: __rec_upd_7769.classes, constructors: __rec_upd_7769.constructors, effects: __rec_upd_7769.effects, hidden_ctor_types: __rec_upd_7769.hidden_ctor_types, hidden_types: __rec_upd_7769.hidden_types, instances: __rec_upd_7769.instances, modules: __rec_upd_7769.modules, mutable_fields: __rec_upd_7769.mutable_fields, newtypes: ({_hd: qname, _tl: te.newtypes}), records: __rec_upd_7769.records, type_aliases: __rec_upd_7769.type_aliases, type_synonyms: __rec_upd_7769.type_synonyms, variants: __rec_upd_7769.variants});
          _t7768 = _t7770;
        }
        return _t7768;
      }
      const type_env_7771 = List$fold(_t7767, type_env_7765, minfo.mod_newtypes);
      function _t7773(te, __p242) {
        let _t7775;
        const _t7774 = __p242;
        _t7776: {
          if (true) {
            const sub_name = _t7774[0];
            const sub_info = _t7774[1];
            let _t7777;
            if (filter_7694(sub_name)) {
              const __rec_upd_7778 = te;
              const _t7779 = ({classes: __rec_upd_7778.classes, constructors: __rec_upd_7778.constructors, effects: __rec_upd_7778.effects, hidden_ctor_types: __rec_upd_7778.hidden_ctor_types, hidden_types: __rec_upd_7778.hidden_types, instances: __rec_upd_7778.instances, modules: ({_hd: [sub_name, sub_info], _tl: te.modules}), mutable_fields: __rec_upd_7778.mutable_fields, newtypes: __rec_upd_7778.newtypes, records: __rec_upd_7778.records, type_aliases: __rec_upd_7778.type_aliases, type_synonyms: __rec_upd_7778.type_synonyms, variants: __rec_upd_7778.variants});
              _t7777 = _t7779;
            } else {
              _t7777 = te;
            }
            _t7775 = _t7777;
            break _t7776;
          }
          _match_fail("line 16933");
        }
        return _t7775;
      }
      const type_env_7780 = List$fold(_t7773, type_env_7771, minfo.mod_submodules);
      function _t7782(te, qname) {
        let _t7784;
        const _t7783 = String$rindex_opt(qname, 46);
        _t7785: {
          if (_t7783._tag === 1) {
            const i = _t7783._val;
            _t7784 = String$sub(qname, (i + 1), ((String$length(qname) - i) - 1));
            break _t7785;
          }
          if (_t7783._tag === 0) {
            _t7784 = qname;
            break _t7785;
          }
          _match_fail("line 16933");
        }
        const _mml$short_7786 = _t7784;
        let _t7788;
        if (filter_7694(_mml$short_7786)) {
          const __rec_upd_7789 = te;
          const _t7790 = ({classes: __rec_upd_7789.classes, constructors: __rec_upd_7789.constructors, effects: __rec_upd_7789.effects, hidden_ctor_types: __rec_upd_7789.hidden_ctor_types, hidden_types: __rec_upd_7789.hidden_types, instances: __rec_upd_7789.instances, modules: __rec_upd_7789.modules, mutable_fields: __rec_upd_7789.mutable_fields, newtypes: __rec_upd_7789.newtypes, records: __rec_upd_7789.records, type_aliases: ({_hd: [_mml$short_7786, qname], _tl: te.type_aliases}), type_synonyms: __rec_upd_7789.type_synonyms, variants: __rec_upd_7789.variants});
          _t7788 = _t7790;
        } else {
          _t7788 = te;
        }
        const _t7787 = _t7788;
        return _t7787;
      }
      const type_env_7791 = List$fold(_t7782, type_env_7780, minfo.mod_pub_classes);
      const __rec_upd_7793 = ctx_7702;
      const _t7794 = ({constraint_tvars: __rec_upd_7793.constraint_tvars, current_eff: __rec_upd_7793.current_eff, current_module: __rec_upd_7793.current_module, inside_handler: __rec_upd_7793.inside_handler, loop_info: __rec_upd_7793.loop_info, mutable_vars: __rec_upd_7793.mutable_vars, return_type: __rec_upd_7793.return_type, return_used: __rec_upd_7793.return_used, type_env: type_env_7791, vars: __rec_upd_7793.vars});
      const _t7792 = _t7794;
      const _t7781 = _t7792;
      const _t7772 = _t7781;
      const _t7766 = _t7772;
      const _t7712 = _t7766;
      const _t7703 = _t7712;
      const _t7695 = _t7703;
      _t7688 = _t7695;
      break _t7689;
    }
    _match_fail("line 16933");
  }
  return _t7688;
}
const _t7795_Typechecker$__destruct = Ref$set(Typechecker$find_module_in_env_ref, Typechecker$find_module_in_env);
const _t7796_Typechecker$__destruct = Ref$set(Typechecker$open_module_into_ctx_ref, Typechecker$open_module_into_ctx);
function Typechecker$collect_tyvars_annot(__x) {
  while (true) {
    let _t7798;
    const _t7797 = __x;
    _t7799: {
      if (_t7797._tag === 1) {
        const s = _t7797._val;
        _t7798 = ({_hd: s, _tl: null});
        break _t7799;
      }
      if (_t7797._tag === 2) {
        const a = _t7797._val[0];
        const b = _t7797._val[1];
        _t7798 = List$concat(Typechecker$collect_tyvars_annot(a), Typechecker$collect_tyvars_annot(b));
        break _t7799;
      }
      if (_t7797._tag === 6) {
        const ts = _t7797._val;
        _t7798 = List$concat_map(Typechecker$collect_tyvars_annot, ts);
        break _t7799;
      }
      if ((_t7797._tag === 4 || _t7797._tag === 5)) {
        const t = _t7797._val;
        const _t7800 = t;
        __x = _t7800;
        continue;
        _t7798 = undefined;
        break _t7799;
      }
      if (_t7797._tag === 7) {
        const args = _t7797._val[0];
        _t7798 = List$concat_map(Typechecker$collect_tyvars_annot, args);
        break _t7799;
      }
      if (_t7797._tag === 3) {
        const fs = _t7797._val[0];
        function _t7801(__p243) {
          let _t7803;
          const _t7802 = __p243;
          _t7804: {
            if (true) {
              const t = _t7802[1];
              _t7803 = Typechecker$collect_tyvars_annot(t);
              break _t7804;
            }
            _match_fail("line 16933");
          }
          return _t7803;
        }
        _t7798 = List$concat_map(_t7801, fs);
        break _t7799;
      }
      if ((_t7797._tag === 0 || _t7797._tag === 8)) {
        _t7798 = null;
        break _t7799;
      }
      if (_t7797._tag === 9) {
        const tags = _t7797._val[1];
        function _t7805(__p244) {
          let _t7807;
          const _t7806 = __p244;
          _t7808: {
            if (true) {
              const ty_opt = _t7806[1];
              let _t7810;
              const _t7809 = ty_opt;
              _t7811: {
                if (_t7809._tag === 1) {
                  const t = _t7809._val;
                  _t7810 = Typechecker$collect_tyvars_annot(t);
                  break _t7811;
                }
                if (_t7809._tag === 0) {
                  _t7810 = null;
                  break _t7811;
                }
                _match_fail("line 16933");
              }
              _t7807 = _t7810;
              break _t7808;
            }
            _match_fail("line 16933");
          }
          return _t7807;
        }
        _t7798 = List$concat_map(_t7805, tags);
        break _t7799;
      }
      if (_t7797._tag === 10) {
        const ty = _t7797._val[0];
        const _t7812 = ty;
        __x = _t7812;
        continue;
        _t7798 = undefined;
        break _t7799;
      }
      _match_fail("line 16933");
    }
    return _t7798;
  }
}
function Typechecker$concat_str_exprs(__x) {
  let _t7814;
  const _t7813 = __x;
  _t7815: {
    if (_t7813 === null) {
      _t7814 = ({_tag: 3, _name: "EString", _val: ""});
      break _t7815;
    }
    if (_t7813 !== null && _t7813._tl === null) {
      const e = _t7813._hd;
      _t7814 = e;
      break _t7815;
    }
    if (_t7813 !== null) {
      const first = _t7813._hd;
      const rest = _t7813._tl;
      function _t7816(acc, e) {
        return ({_tag: 13, _name: "EBinop", _val: [({_tag: 13, _name: "Concat"}), acc, e]});
      }
      _t7814 = List$fold(_t7816, first, rest);
      break _t7815;
    }
    _match_fail("line 16933");
  }
  return _t7814;
}
function Typechecker$make_inst_ty(type_params, name) {
  let _t7817;
  if (_eq(type_params, null)) {
    _t7817 = ({_tag: 0, _name: "TyName", _val: name});
  } else {
    function _t7818(p) {
      return ({_tag: 1, _name: "TyVar", _val: p});
    }
    _t7817 = ({_tag: 7, _name: "TyApp", _val: [List$map(_t7818, type_params), name]});
  }
  return _t7817;
}
function Typechecker$make_constraints(class_name, type_params, annots) {
  function _t7819(ann) {
    return Typechecker$collect_tyvars_annot(ann);
  }
  const all_vars_7820 = List$concat_map(_t7819, annots);
  const unique_vars_7822 = List$sort_uniq(String$compare, all_vars_7820);
  function _t7824(v) {
    return List$mem(v, type_params);
  }
  const param_vars_7825 = List$filter(_t7824, unique_vars_7822);
  function _t7827(v) {
    return [class_name, ({_hd: v, _tl: null})];
  }
  const _t7826 = List$map(_t7827, param_vars_7825);
  const _t7823 = _t7826;
  const _t7821 = _t7823;
  return _t7821;
}
function Typechecker$gen_show_variant(type_params, name, ctors) {
  const inst_ty_7828 = Typechecker$make_inst_ty(type_params, name);
  function _t7830(__p245) {
    let _t7832;
    const _t7831 = __p245;
    _t7833: {
      if (true) {
        const a = _t7831[1];
        _t7832 = a;
        break _t7833;
      }
      _match_fail("line 16933");
    }
    return _t7832;
  }
  const annots_7834 = List$filter_map(_t7830, ctors);
  const constraints_7836 = Typechecker$make_constraints("Show", type_params, annots_7834);
  function _t7838(__p246) {
    let _t7840;
    const _t7839 = __p246;
    _t7841: {
      if (true) {
        const ctor_name = _t7839[0];
        const arg_annot = _t7839[1];
        let _t7843;
        const _t7842 = arg_annot;
        _t7844: {
          if (_t7842._tag === 0) {
            _t7843 = [({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 0, _name: "None"})]}), ({_tag: 0, _name: "None"}), ({_tag: 3, _name: "EString", _val: ctor_name})];
            break _t7844;
          }
          if (_t7842._tag === 1 && _t7842._val._tag === 6) {
            const tys = _t7842._val._val;
            const n_7845 = List$length(tys);
            function _t7847(i) {
              return ("__v" + __dict_Show_int.show(i));
            }
            const vars_7848 = List$init(n_7845, _t7847);
            function _t7850(v) {
              return ({_tag: 1, _name: "PatVar", _val: v});
            }
            const pat_7851 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 7, _name: "PatTuple", _val: List$map(_t7850, vars_7848)})})]});
            function _t7853(i, v) {
              const sv_7854 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), ({_tag: 7, _name: "EVar", _val: v})]});
              let _t7856;
              if ((i === 0)) {
                _t7856 = ({_hd: sv_7854, _tl: null});
              } else {
                _t7856 = ({_hd: ({_tag: 3, _name: "EString", _val: ", "}), _tl: ({_hd: sv_7854, _tl: null})});
              }
              const _t7855 = _t7856;
              return _t7855;
            }
            const parts_7857 = List$concat(({_hd: ({_tag: 3, _name: "EString", _val: (ctor_name + "(")}), _tl: null}), List$concat(List$flatten(List$mapi(_t7853, vars_7848)), ({_hd: ({_tag: 3, _name: "EString", _val: ")"}), _tl: null})));
            const _t7858 = [pat_7851, ({_tag: 0, _name: "None"}), Typechecker$concat_str_exprs(parts_7857)];
            const _t7852 = _t7858;
            const _t7849 = _t7852;
            const _t7846 = _t7849;
            _t7843 = _t7846;
            break _t7844;
          }
          if (_t7842._tag === 1) {
            const pat_7859 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "PatVar", _val: "__v0"})})]});
            const body_7861 = Typechecker$concat_str_exprs(({_hd: ({_tag: 3, _name: "EString", _val: (ctor_name + "(")}), _tl: ({_hd: ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), ({_tag: 7, _name: "EVar", _val: "__v0"})]}), _tl: ({_hd: ({_tag: 3, _name: "EString", _val: ")"}), _tl: null})})}));
            const _t7862 = [pat_7859, ({_tag: 0, _name: "None"}), body_7861];
            const _t7860 = _t7862;
            _t7843 = _t7860;
            break _t7844;
          }
          _match_fail("line 16933");
        }
        _t7840 = _t7843;
        break _t7841;
      }
      _match_fail("line 16933");
    }
    return _t7840;
  }
  const arms_7863 = List$map(_t7838, ctors);
  const body_7865 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 7, _name: "EVar", _val: "__x"}), arms_7863, false]});
  const _t7866 = ["Show", ({_hd: inst_ty_7828, _tl: null}), constraints_7836, ({_hd: ["show", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__x"}), _tl: null}), body_7865], _tl: null})];
  const _t7864 = _t7866;
  const _t7837 = _t7864;
  const _t7835 = _t7837;
  const _t7829 = _t7835;
  return _t7829;
}
function Typechecker$gen_show_record(type_params, name, fields) {
  const inst_ty_7867 = Typechecker$make_inst_ty(type_params, name);
  function _t7869(__p247) {
    let _t7871;
    const _t7870 = __p247;
    _t7872: {
      if (true) {
        const a = _t7870[2];
        _t7871 = a;
        break _t7872;
      }
      _match_fail("line 16933");
    }
    return _t7871;
  }
  const annots_7873 = List$map(_t7869, fields);
  const constraints_7875 = Typechecker$make_constraints("Show", type_params, annots_7873);
  function _t7877(i, __p248) {
    let _t7879;
    const _t7878 = __p248;
    _t7880: {
      if (true) {
        const fname = _t7878[1];
        const sf_7881 = ({_tag: 11, _name: "EApp", _val: [({_tag: 7, _name: "EVar", _val: "show"}), ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__x"}), fname]})]});
        let _t7883;
        if ((i === 0)) {
          _t7883 = ({_hd: ({_tag: 3, _name: "EString", _val: (fname + " = ")}), _tl: ({_hd: sf_7881, _tl: null})});
        } else {
          _t7883 = ({_hd: ({_tag: 3, _name: "EString", _val: ("; " + (fname + " = "))}), _tl: ({_hd: sf_7881, _tl: null})});
        }
        const _t7882 = _t7883;
        _t7879 = _t7882;
        break _t7880;
      }
      _match_fail("line 16933");
    }
    return _t7879;
  }
  const parts_7884 = List$concat(({_hd: ({_tag: 3, _name: "EString", _val: "{ "}), _tl: null}), List$concat(List$flatten(List$mapi(_t7877, fields)), ({_hd: ({_tag: 3, _name: "EString", _val: " }"}), _tl: null})));
  const body_7886 = Typechecker$concat_str_exprs(parts_7884);
  const _t7887 = ["Show", ({_hd: inst_ty_7867, _tl: null}), constraints_7875, ({_hd: ["show", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__x"}), _tl: null}), body_7886], _tl: null})];
  const _t7885 = _t7887;
  const _t7876 = _t7885;
  const _t7874 = _t7876;
  const _t7868 = _t7874;
  return _t7868;
}
function Typechecker$gen_eq_variant(type_params, name, ctors) {
  const inst_ty_7888 = Typechecker$make_inst_ty(type_params, name);
  function _t7890(__p249) {
    let _t7892;
    const _t7891 = __p249;
    _t7893: {
      if (true) {
        const a = _t7891[1];
        _t7892 = a;
        break _t7893;
      }
      _match_fail("line 16933");
    }
    return _t7892;
  }
  const annots_7894 = List$filter_map(_t7890, ctors);
  const constraints_7896 = Typechecker$make_constraints("Eq", type_params, annots_7894);
  function _t7898(__x) {
    let _t7900;
    const _t7899 = __x;
    _t7901: {
      if (_t7899 === null) {
        _t7900 = ({_tag: 2, _name: "EBool", _val: true});
        break _t7901;
      }
      if (_t7899 !== null && _t7899._tl === null) {
        const e = _t7899._hd;
        _t7900 = e;
        break _t7901;
      }
      if (_t7899 !== null) {
        const first = _t7899._hd;
        const rest = _t7899._tl;
        function _t7902(a, e) {
          return ({_tag: 13, _name: "EBinop", _val: [({_tag: 11, _name: "And"}), a, e]});
        }
        _t7900 = List$fold(_t7902, first, rest);
        break _t7901;
      }
      _match_fail("line 16933");
    }
    return _t7900;
  }
  const and_exprs_7903 = _t7898;
  function _t7905(__p250) {
    let _t7907;
    const _t7906 = __p250;
    _t7908: {
      if (true) {
        const ctor_name = _t7906[0];
        const arg_annot = _t7906[1];
        let _t7910;
        const _t7909 = arg_annot;
        _t7911: {
          if (_t7909._tag === 0) {
            const pat_7912 = ({_tag: 7, _name: "PatTuple", _val: ({_hd: ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 0, _name: "None"})]}), _tl: ({_hd: ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 0, _name: "None"})]}), _tl: null})})});
            const _t7913 = [pat_7912, ({_tag: 0, _name: "None"}), ({_tag: 2, _name: "EBool", _val: true})];
            _t7910 = _t7913;
            break _t7911;
          }
          if (_t7909._tag === 1 && _t7909._val._tag === 6) {
            const tys = _t7909._val._val;
            const n_7914 = List$length(tys);
            function _t7916(i) {
              return ("__v" + __dict_Show_int.show(i));
            }
            const vs_7917 = List$init(n_7914, _t7916);
            function _t7919(i) {
              return ("__w" + __dict_Show_int.show(i));
            }
            const ws_7920 = List$init(n_7914, _t7919);
            function _t7922(v) {
              return ({_tag: 1, _name: "PatVar", _val: v});
            }
            const lp_7923 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 7, _name: "PatTuple", _val: List$map(_t7922, vs_7917)})})]});
            function _t7925(v) {
              return ({_tag: 1, _name: "PatVar", _val: v});
            }
            const rp_7926 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 7, _name: "PatTuple", _val: List$map(_t7925, ws_7920)})})]});
            function _t7928(v, w) {
              return ({_tag: 13, _name: "EBinop", _val: [({_tag: 5, _name: "Eq"}), ({_tag: 7, _name: "EVar", _val: v}), ({_tag: 7, _name: "EVar", _val: w})]});
            }
            const eqs_7929 = List$map2(_t7928, vs_7917, ws_7920);
            const _t7930 = [({_tag: 7, _name: "PatTuple", _val: ({_hd: lp_7923, _tl: ({_hd: rp_7926, _tl: null})})}), ({_tag: 0, _name: "None"}), and_exprs_7903(eqs_7929)];
            const _t7927 = _t7930;
            const _t7924 = _t7927;
            const _t7921 = _t7924;
            const _t7918 = _t7921;
            const _t7915 = _t7918;
            _t7910 = _t7915;
            break _t7911;
          }
          if (_t7909._tag === 1) {
            const lp_7931 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "PatVar", _val: "__v0"})})]});
            const rp_7933 = ({_tag: 10, _name: "PatConstruct", _val: [ctor_name, ({_tag: 1, _name: "Some", _val: ({_tag: 1, _name: "PatVar", _val: "__w0"})})]});
            const _t7934 = [({_tag: 7, _name: "PatTuple", _val: ({_hd: lp_7931, _tl: ({_hd: rp_7933, _tl: null})})}), ({_tag: 0, _name: "None"}), ({_tag: 13, _name: "EBinop", _val: [({_tag: 5, _name: "Eq"}), ({_tag: 7, _name: "EVar", _val: "__v0"}), ({_tag: 7, _name: "EVar", _val: "__w0"})]})];
            const _t7932 = _t7934;
            _t7910 = _t7932;
            break _t7911;
          }
          _match_fail("line 16933");
        }
        _t7907 = _t7910;
        break _t7908;
      }
      _match_fail("line 16933");
    }
    return _t7907;
  }
  const arms_7935 = List$map(_t7905, ctors);
  const arms_7937 = List$concat(arms_7935, ({_hd: [({_tag: 0, _name: "PatWild"}), ({_tag: 0, _name: "None"}), ({_tag: 2, _name: "EBool", _val: false})], _tl: null}));
  const eq_body_7939 = ({_tag: 25, _name: "EMatch", _val: [({_tag: 15, _name: "ETuple", _val: ({_hd: ({_tag: 7, _name: "EVar", _val: "__a"}), _tl: ({_hd: ({_tag: 7, _name: "EVar", _val: "__b"}), _tl: null})})}), arms_7937, false]});
  function _t7941(__p251) {
    let _t7943;
    const _t7942 = __p251;
    _t7944: {
      if (true) {
        const p = _t7942[0];
        const g = _t7942[1];
        const e = _t7942[2];
        _t7943 = [p, g, e];
        break _t7944;
      }
      _match_fail("line 16933");
    }
    return _t7943;
  }
  const neq_body_7945 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 1, _name: "Not"}), ({_tag: 25, _name: "EMatch", _val: [({_tag: 15, _name: "ETuple", _val: ({_hd: ({_tag: 7, _name: "EVar", _val: "__a"}), _tl: ({_hd: ({_tag: 7, _name: "EVar", _val: "__b"}), _tl: null})})}), List$map(_t7941, arms_7937), false]})]});
  const _t7946 = ["Eq", ({_hd: inst_ty_7888, _tl: null}), constraints_7896, ({_hd: ["=", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), eq_body_7939], _tl: ({_hd: ["<>", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), neq_body_7945], _tl: null})})];
  const _t7940 = _t7946;
  const _t7938 = _t7940;
  const _t7936 = _t7938;
  const _t7904 = _t7936;
  const _t7897 = _t7904;
  const _t7895 = _t7897;
  const _t7889 = _t7895;
  return _t7889;
}
function Typechecker$gen_eq_record(type_params, name, fields) {
  const inst_ty_7947 = Typechecker$make_inst_ty(type_params, name);
  function _t7949(__p252) {
    let _t7951;
    const _t7950 = __p252;
    _t7952: {
      if (true) {
        const a = _t7950[2];
        _t7951 = a;
        break _t7952;
      }
      _match_fail("line 16933");
    }
    return _t7951;
  }
  const annots_7953 = List$map(_t7949, fields);
  const constraints_7955 = Typechecker$make_constraints("Eq", type_params, annots_7953);
  function _t7957(__p253) {
    let _t7959;
    const _t7958 = __p253;
    _t7960: {
      if (true) {
        const fname = _t7958[1];
        _t7959 = ({_tag: 13, _name: "EBinop", _val: [({_tag: 5, _name: "Eq"}), ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__a"}), fname]}), ({_tag: 18, _name: "EField", _val: [({_tag: 7, _name: "EVar", _val: "__b"}), fname]})]});
        break _t7960;
      }
      _match_fail("line 16933");
    }
    return _t7959;
  }
  const eqs_7961 = List$map(_t7957, fields);
  let _t7964;
  const _t7963 = eqs_7961;
  _t7965: {
    if (_t7963 === null) {
      _t7964 = ({_tag: 2, _name: "EBool", _val: true});
      break _t7965;
    }
    if (_t7963 !== null && _t7963._tl === null) {
      const e = _t7963._hd;
      _t7964 = e;
      break _t7965;
    }
    if (_t7963 !== null) {
      const first = _t7963._hd;
      const rest = _t7963._tl;
      function _t7966(a, e) {
        return ({_tag: 13, _name: "EBinop", _val: [({_tag: 11, _name: "And"}), a, e]});
      }
      _t7964 = List$fold(_t7966, first, rest);
      break _t7965;
    }
    _match_fail("line 16933");
  }
  const eq_body_7967 = _t7964;
  const neq_body_7969 = ({_tag: 14, _name: "EUnop", _val: [({_tag: 1, _name: "Not"}), eq_body_7967]});
  const _t7970 = ["Eq", ({_hd: inst_ty_7947, _tl: null}), constraints_7955, ({_hd: ["=", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), eq_body_7967], _tl: ({_hd: ["<>", ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__a"}), _tl: ({_hd: ({annot: ({_tag: 0, _name: "None"}), is_generated: false, name: "__b"}), _tl: null})}), neq_body_7969], _tl: null})})];
  const _t7968 = _t7970;
  const _t7962 = _t7968;
  const _t7956 = _t7962;
  const _t7954 = _t7956;
  const _t7948 = _t7954;
  return _t7948;
}
function Typechecker$generate_derived_instance(type_params, name, def, class_name) {
  let _t7972;
  const _t7971 = [class_name, def];
  _t7973: {
    if (_t7971[1]._tag === 0) {
      const ctors = _t7971[1]._val;
      function _t7974(__p254) {
        let _t7976;
        const _t7975 = __p254;
        _t7977: {
          if (true) {
            const ret = _t7975[2];
            _t7976 = !_eq(ret, ({_tag: 0, _name: "None"}));
            break _t7977;
          }
          _match_fail("line 16933");
        }
        return _t7976;
      }
      if (List$exists(_t7974, ctors)) {
        _t7972 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(class_name)) + " for GADT type ") + __dict_Show_string.show(name)));
        break _t7973;
      }
    }
    if (_t7971[0] === "Show" && _t7971[1]._tag === 0) {
      const ctors = _t7971[1]._val;
      _t7972 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_show_variant(type_params, name, ctors)});
      break _t7973;
    }
    if (_t7971[0] === "Show" && _t7971[1]._tag === 1) {
      const fields = _t7971[1]._val;
      _t7972 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_show_record(type_params, name, fields)});
      break _t7973;
    }
    if (_t7971[0] === "Show" && _t7971[1]._tag === 3) {
      const ctor_name = _t7971[1]._val[0];
      const underlying = _t7971[1]._val[1];
      _t7972 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_show_variant(type_params, name, ({_hd: [ctor_name, ({_tag: 1, _name: "Some", _val: underlying}), ({_tag: 0, _name: "None"})], _tl: null}))});
      break _t7973;
    }
    if (_t7971[0] === "Eq" && _t7971[1]._tag === 0) {
      const ctors = _t7971[1]._val;
      _t7972 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_eq_variant(type_params, name, ctors)});
      break _t7973;
    }
    if (_t7971[0] === "Eq" && _t7971[1]._tag === 1) {
      const fields = _t7971[1]._val;
      _t7972 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_eq_record(type_params, name, fields)});
      break _t7973;
    }
    if (_t7971[0] === "Eq" && _t7971[1]._tag === 3) {
      const ctor_name = _t7971[1]._val[0];
      const underlying = _t7971[1]._val[1];
      _t7972 = ({_tag: 1, _name: "Some", _val: Typechecker$gen_eq_variant(type_params, name, ({_hd: [ctor_name, ({_tag: 1, _name: "Some", _val: underlying}), ({_tag: 0, _name: "None"})], _tl: null}))});
      break _t7973;
    }
    if (true) {
      _t7972 = ({_tag: 0, _name: "None"});
      break _t7973;
    }
    _match_fail("line 16933");
  }
  return _t7972;
}
function Typechecker$process_module_def(ctx, level, mod_name, items) {
  let _t7979;
  const _t7978 = ctx.current_module;
  _t7980: {
    if (_t7978._tag === 0) {
      _t7979 = (mod_name + ".");
      break _t7980;
    }
    if (_t7978._tag === 1) {
      const parent = _t7978._val;
      _t7979 = (parent + (mod_name + "."));
      break _t7980;
    }
    _match_fail("line 16933");
  }
  const prefix_7981 = _t7979;
  const __rec_upd_7983 = ctx;
  const _t7984 = ({constraint_tvars: __rec_upd_7983.constraint_tvars, current_eff: __rec_upd_7983.current_eff, current_module: ({_tag: 1, _name: "Some", _val: prefix_7981}), inside_handler: __rec_upd_7983.inside_handler, loop_info: __rec_upd_7983.loop_info, mutable_vars: __rec_upd_7983.mutable_vars, return_type: __rec_upd_7983.return_type, return_used: __rec_upd_7983.return_used, type_env: __rec_upd_7983.type_env, vars: __rec_upd_7983.vars});
  const sub_ctx_7985 = _t7984;
  const pub_vars_7987 = Ref$create(null);
  const pub_mutable_vars_7989 = Ref$create(null);
  const pub_types_7991 = Ref$create(null);
  const opaque_types_7993 = Ref$create(null);
  const newtypes_7995 = Ref$create(null);
  const pub_constructors_7997 = Ref$create(null);
  const all_instances_7999 = Ref$create(null);
  const submodules_8001 = Ref$create(null);
  const pub_classes_8003 = Ref$create(null);
  const typed_decls_8005 = Ref$create(null);
  function _t8007(sub_ctx, item) {
    let _t8009;
    const _t8008 = Typechecker$check_module_item(sub_ctx, level, prefix_7981, item, pub_vars_7987, pub_mutable_vars_7989, pub_types_7991, opaque_types_7993, newtypes_7995, pub_constructors_7997, all_instances_7999, submodules_8001, pub_classes_8003, typed_decls_8005);
    _t8010: {
      if (true) {
        const sub_ctx$p = _t8008[0];
        const tdecl = _t8008[1];
        Ref$set(typed_decls_8005, ({_hd: tdecl, _tl: Ref$get(typed_decls_8005)}));
        _t8009 = sub_ctx$p;
        break _t8010;
      }
      _match_fail("line 16933");
    }
    return _t8009;
  }
  const sub_ctx_8011 = List$fold(_t8007, sub_ctx_7985, items);
  const minfo_8013 = ({mod_instances: Ref$get(all_instances_7999), mod_name: mod_name, mod_newtypes: Ref$get(newtypes_7995), mod_opaque_types: Ref$get(opaque_types_7993), mod_pub_classes: Ref$get(pub_classes_8003), mod_pub_constructors: Ref$get(pub_constructors_7997), mod_pub_mutable_vars: Ref$get(pub_mutable_vars_7989), mod_pub_types: Ref$get(pub_types_7991), mod_pub_vars: Ref$get(pub_vars_7987), mod_submodules: Ref$get(submodules_8001)});
  const __rec_upd_8015 = sub_ctx_8011.type_env;
  const _t8016 = ({classes: __rec_upd_8015.classes, constructors: __rec_upd_8015.constructors, effects: __rec_upd_8015.effects, hidden_ctor_types: __rec_upd_8015.hidden_ctor_types, hidden_types: __rec_upd_8015.hidden_types, instances: __rec_upd_8015.instances, modules: ({_hd: [mod_name, minfo_8013], _tl: ctx.type_env.modules}), mutable_fields: __rec_upd_8015.mutable_fields, newtypes: __rec_upd_8015.newtypes, records: __rec_upd_8015.records, type_aliases: __rec_upd_8015.type_aliases, type_synonyms: __rec_upd_8015.type_synonyms, variants: __rec_upd_8015.variants});
  const outer_type_env_8017 = _t8016;
  const __rec_upd_8019 = outer_type_env_8017;
  const _t8020 = ({classes: __rec_upd_8019.classes, constructors: __rec_upd_8019.constructors, effects: __rec_upd_8019.effects, hidden_ctor_types: __rec_upd_8019.hidden_ctor_types, hidden_types: __rec_upd_8019.hidden_types, instances: __rec_upd_8019.instances, modules: __rec_upd_8019.modules, mutable_fields: __rec_upd_8019.mutable_fields, newtypes: __rec_upd_8019.newtypes, records: __rec_upd_8019.records, type_aliases: ctx.type_env.type_aliases, type_synonyms: __rec_upd_8019.type_synonyms, variants: __rec_upd_8019.variants});
  const outer_type_env_8021 = _t8020;
  function _t8023(__p255) {
    let _t8025;
    const _t8024 = __p255;
    _t8026: {
      if (true) {
        const name = _t8024[0];
        function _t8027(__p256) {
          let _t8029;
          const _t8028 = __p256;
          _t8030: {
            if (true) {
              const n = _t8028[0];
              _t8029 = (n === name);
              break _t8030;
            }
            _match_fail("line 16933");
          }
          return _t8029;
        }
        _t8025 = (!List$exists(_t8027, ctx.type_env.variants));
        break _t8026;
      }
      _match_fail("line 16933");
    }
    return _t8025;
  }
  const new_variants_8031 = List$filter(_t8023, sub_ctx_8011.type_env.variants);
  function _t8033(__p257) {
    let _t8035;
    const _t8034 = __p257;
    _t8036: {
      if (true) {
        const name = _t8034[0];
        function _t8037(__p258) {
          let _t8039;
          const _t8038 = __p258;
          _t8040: {
            if (true) {
              const n = _t8038[0];
              _t8039 = (n === name);
              break _t8040;
            }
            _match_fail("line 16933");
          }
          return _t8039;
        }
        _t8035 = (!List$exists(_t8037, ctx.type_env.records));
        break _t8036;
      }
      _match_fail("line 16933");
    }
    return _t8035;
  }
  const new_records_8041 = List$filter(_t8033, sub_ctx_8011.type_env.records);
  function _t8043(__p259) {
    let _t8045;
    const _t8044 = __p259;
    _t8046: {
      if (true) {
        const name = _t8044[0];
        function _t8047(__p260) {
          let _t8049;
          const _t8048 = __p260;
          _t8050: {
            if (true) {
              const n = _t8048[0];
              _t8049 = (n === name);
              break _t8050;
            }
            _match_fail("line 16933");
          }
          return _t8049;
        }
        _t8045 = (!List$exists(_t8047, ctx.type_env.type_synonyms));
        break _t8046;
      }
      _match_fail("line 16933");
    }
    return _t8045;
  }
  const new_synonyms_8051 = List$filter(_t8043, sub_ctx_8011.type_env.type_synonyms);
  function submodule_types(info) {
    function _t8053(__p261) {
      let _t8055;
      const _t8054 = __p261;
      _t8056: {
        if (true) {
          const sub = _t8054[1];
          _t8055 = submodule_types(sub);
          break _t8056;
        }
        _match_fail("line 16933");
      }
      return _t8055;
    }
    return List$concat(info.mod_pub_types, List$concat_map(_t8053, info.mod_submodules));
  }
  function _t8058(__p262) {
    let _t8060;
    const _t8059 = __p262;
    _t8061: {
      if (true) {
        const info = _t8059[1];
        _t8060 = submodule_types(info);
        break _t8061;
      }
      _match_fail("line 16933");
    }
    return _t8060;
  }
  const submod_type_names_8062 = List$concat_map(_t8058, Ref$get(submodules_8001));
  function _t8064(name) {
    return (List$mem(name, Ref$get(pub_types_7991)) || List$mem(name, submod_type_names_8062));
  }
  const is_exported_8065 = _t8064;
  function _t8067(__p263) {
    let _t8069;
    const _t8068 = __p263;
    _t8070: {
      if (true) {
        const name = _t8068[0];
        let _t8071;
        if (is_exported_8065(name)) {
          _t8071 = ({_tag: 0, _name: "None"});
        } else {
          _t8071 = ({_tag: 1, _name: "Some", _val: name});
        }
        _t8069 = _t8071;
        break _t8070;
      }
      _match_fail("line 16933");
    }
    return _t8069;
  }
  function _t8072(__p264) {
    let _t8074;
    const _t8073 = __p264;
    _t8075: {
      if (true) {
        const name = _t8073[0];
        let _t8076;
        if (is_exported_8065(name)) {
          _t8076 = ({_tag: 0, _name: "None"});
        } else {
          _t8076 = ({_tag: 1, _name: "Some", _val: name});
        }
        _t8074 = _t8076;
        break _t8075;
      }
      _match_fail("line 16933");
    }
    return _t8074;
  }
  function _t8077(__p265) {
    let _t8079;
    const _t8078 = __p265;
    _t8080: {
      if (true) {
        const name = _t8078[0];
        let _t8081;
        if (is_exported_8065(name)) {
          _t8081 = ({_tag: 0, _name: "None"});
        } else {
          _t8081 = ({_tag: 1, _name: "Some", _val: name});
        }
        _t8079 = _t8081;
        break _t8080;
      }
      _match_fail("line 16933");
    }
    return _t8079;
  }
  const private_type_names_8082 = List$concat(List$filter_map(_t8067, new_variants_8031), List$concat(List$filter_map(_t8072, new_records_8041), List$filter_map(_t8077, new_synonyms_8051)));
  const __rec_upd_8084 = outer_type_env_8021;
  const _t8085 = ({classes: __rec_upd_8084.classes, constructors: __rec_upd_8084.constructors, effects: __rec_upd_8084.effects, hidden_ctor_types: __rec_upd_8084.hidden_ctor_types, hidden_types: List$concat(private_type_names_8082, outer_type_env_8021.hidden_types), instances: __rec_upd_8084.instances, modules: __rec_upd_8084.modules, mutable_fields: __rec_upd_8084.mutable_fields, newtypes: __rec_upd_8084.newtypes, records: __rec_upd_8084.records, type_aliases: __rec_upd_8084.type_aliases, type_synonyms: __rec_upd_8084.type_synonyms, variants: __rec_upd_8084.variants});
  const outer_type_env_8086 = _t8085;
  const hidden_ctor_type_names_8088 = List$concat(private_type_names_8082, Ref$get(opaque_types_7993));
  const __rec_upd_8090 = outer_type_env_8086;
  const _t8091 = ({classes: __rec_upd_8090.classes, constructors: __rec_upd_8090.constructors, effects: __rec_upd_8090.effects, hidden_ctor_types: List$concat(hidden_ctor_type_names_8088, outer_type_env_8086.hidden_ctor_types), hidden_types: __rec_upd_8090.hidden_types, instances: __rec_upd_8090.instances, modules: __rec_upd_8090.modules, mutable_fields: __rec_upd_8090.mutable_fields, newtypes: __rec_upd_8090.newtypes, records: __rec_upd_8090.records, type_aliases: __rec_upd_8090.type_aliases, type_synonyms: __rec_upd_8090.type_synonyms, variants: __rec_upd_8090.variants});
  const outer_type_env_8092 = _t8091;
  function collect_type_names(acc, ty) {
    while (true) {
      let _t8095;
      const _t8094 = Types$repr(ty);
      _t8096: {
        if (_t8094._tag === 12) {
          const name = _t8094._val[0];
          const args = _t8094._val[1];
          _t8095 = List$fold(collect_type_names, ({_hd: name, _tl: acc}), args);
          break _t8096;
        }
        if (_t8094._tag === 7) {
          const a = _t8094._val[0];
          const b = _t8094._val[2];
          const _t8097 = collect_type_names(acc, a);
          const _t8098 = b;
          acc = _t8097;
          ty = _t8098;
          continue;
          _t8095 = undefined;
          break _t8096;
        }
        if (_t8094._tag === 9) {
          const ts = _t8094._val;
          _t8095 = List$fold(collect_type_names, acc, ts);
          break _t8096;
        }
        if ((_t8094._tag === 10 || _t8094._tag === 13)) {
          const t = _t8094._val;
          const _t8099 = acc;
          const _t8100 = t;
          acc = _t8099;
          ty = _t8100;
          continue;
          _t8095 = undefined;
          break _t8096;
        }
        if (_t8094._tag === 11) {
          const row = _t8094._val;
          _t8095 = collect_row_names(acc, row);
          break _t8096;
        }
        if (true) {
          _t8095 = acc;
          break _t8096;
        }
        _match_fail("line 16933");
      }
      return _t8095;
    }
  }
  function collect_row_names(acc, __x) {
    while (true) {
      let _t8102;
      const _t8101 = __x;
      _t8103: {
        if (_t8101._tag === 0) {
          const ty = _t8101._val[1];
          const rest = _t8101._val[2];
          const _t8104 = collect_type_names(acc, ty);
          const _t8105 = rest;
          acc = _t8104;
          __x = _t8105;
          continue;
          _t8102 = undefined;
          break _t8103;
        }
        if (true) {
          _t8102 = acc;
          break _t8103;
        }
        _match_fail("line 16933");
      }
      return _t8102;
    }
  }
  let _t8107;
  if (!_eq(private_type_names_8082, null)) {
    function _t8108(__p266) {
      let _t8110;
      const _t8109 = __p266;
      _t8111: {
        if (true) {
          const _mml$short = _t8109[0];
          const scheme = _t8109[1];
          const type_names_8112 = collect_type_names(null, scheme.body);
          function _t8114(tname) {
            let _t8115;
            if (List$mem(tname, private_type_names_8082)) {
              let _t8117;
              const _t8116 = String$rindex_opt(tname, 46);
              _t8118: {
                if (_t8116._tag === 1) {
                  const i = _t8116._val;
                  _t8117 = String$sub(tname, (i + 1), ((String$length(tname) - i) - 1));
                  break _t8118;
                }
                if (_t8116._tag === 0) {
                  _t8117 = tname;
                  break _t8118;
                }
                _match_fail("line 16933");
              }
              const short_tname_8119 = _t8117;
              const _t8120 = Typechecker$error((((("public binding '" + __dict_Show_string.show(_mml$short)) + "' exposes private type '") + __dict_Show_string.show(short_tname_8119)) + "'. Use 'pub type' or 'opaque type' to export it"));
              _t8115 = _t8120;
            } else {
              _t8115 = undefined;
            }
            return _t8115;
          }
          const _t8113 = List$iter(_t8114, type_names_8112);
          _t8110 = _t8113;
          break _t8111;
        }
        _match_fail("line 16933");
      }
      return _t8110;
    }
    _t8107 = List$iter(_t8108, Ref$get(pub_vars_7987));
  } else {
    _t8107 = undefined;
  }
  _t8107;
  function _t8121(vars, __p267) {
    let _t8123;
    const _t8122 = __p267;
    _t8124: {
      if (true) {
        const _mml$short = _t8122[0];
        const scheme = _t8122[1];
        const qualified_8125 = (prefix_7981 + _mml$short);
        const _t8126 = ({_hd: [qualified_8125, scheme], _tl: vars});
        _t8123 = _t8126;
        break _t8124;
      }
      _match_fail("line 16933");
    }
    return _t8123;
  }
  const outer_vars_8127 = List$fold(_t8121, ctx.vars, Ref$get(pub_vars_7987));
  function _t8129(te, __p268) {
    let _t8131;
    const _t8130 = __p268;
    _t8132: {
      if (true) {
        const _mml$short = _t8130[0];
        const info = _t8130[1];
        const qualified_8133 = (prefix_7981 + _mml$short);
        const __rec_upd_8135 = te;
        const _t8136 = ({classes: __rec_upd_8135.classes, constructors: ({_hd: [qualified_8133, info], _tl: te.constructors}), effects: __rec_upd_8135.effects, hidden_ctor_types: __rec_upd_8135.hidden_ctor_types, hidden_types: __rec_upd_8135.hidden_types, instances: __rec_upd_8135.instances, modules: __rec_upd_8135.modules, mutable_fields: __rec_upd_8135.mutable_fields, newtypes: __rec_upd_8135.newtypes, records: __rec_upd_8135.records, type_aliases: __rec_upd_8135.type_aliases, type_synonyms: __rec_upd_8135.type_synonyms, variants: __rec_upd_8135.variants});
        const _t8134 = _t8136;
        _t8131 = _t8134;
        break _t8132;
      }
      _match_fail("line 16933");
    }
    return _t8131;
  }
  const outer_type_env_8137 = List$fold(_t8129, outer_type_env_8092, Ref$get(pub_constructors_7997));
  function _t8139(i) {
    return i.inst_dict_name;
  }
  const existing_dict_names_8140 = List$map(_t8139, outer_type_env_8137.instances);
  function _t8142(inst) {
    return (!List$mem(inst.inst_dict_name, existing_dict_names_8140));
  }
  const new_insts_8143 = List$filter(_t8142, Ref$get(all_instances_7999));
  const __rec_upd_8145 = outer_type_env_8137;
  const _t8146 = ({classes: __rec_upd_8145.classes, constructors: __rec_upd_8145.constructors, effects: __rec_upd_8145.effects, hidden_ctor_types: __rec_upd_8145.hidden_ctor_types, hidden_types: __rec_upd_8145.hidden_types, instances: List$concat(new_insts_8143, outer_type_env_8137.instances), modules: __rec_upd_8145.modules, mutable_fields: __rec_upd_8145.mutable_fields, newtypes: __rec_upd_8145.newtypes, records: __rec_upd_8145.records, type_aliases: __rec_upd_8145.type_aliases, type_synonyms: __rec_upd_8145.type_synonyms, variants: __rec_upd_8145.variants});
  const outer_type_env_8147 = _t8146;
  function _t8149(mvs, _mml$short) {
    const qualified_8150 = (prefix_7981 + _mml$short);
    const _t8151 = ({_hd: qualified_8150, _tl: mvs});
    return _t8151;
  }
  const outer_mutable_vars_8152 = List$fold(_t8149, ctx.mutable_vars, Ref$get(pub_mutable_vars_7989));
  const __rec_upd_8154 = ctx;
  const _t8155 = ({constraint_tvars: __rec_upd_8154.constraint_tvars, current_eff: __rec_upd_8154.current_eff, current_module: __rec_upd_8154.current_module, inside_handler: __rec_upd_8154.inside_handler, loop_info: __rec_upd_8154.loop_info, mutable_vars: outer_mutable_vars_8152, return_type: __rec_upd_8154.return_type, return_used: __rec_upd_8154.return_used, type_env: outer_type_env_8147, vars: outer_vars_8127});
  const outer_ctx_8156 = _t8155;
  const _t8157 = [outer_ctx_8156, ({_tag: 9, _name: "TDModule", _val: [mod_name, List$rev(Ref$get(typed_decls_8005))]})];
  const _t8153 = _t8157;
  const _t8148 = _t8153;
  const _t8144 = _t8148;
  const _t8141 = _t8144;
  const _t8138 = _t8141;
  const _t8128 = _t8138;
  const _t8106 = _t8128;
  const _t8093 = _t8106;
  const _t8089 = _t8093;
  const _t8087 = _t8089;
  const _t8083 = _t8087;
  const _t8066 = _t8083;
  const _t8063 = _t8066;
  const _t8057 = _t8063;
  const _t8052 = _t8057;
  const _t8042 = _t8052;
  const _t8032 = _t8042;
  const _t8022 = _t8032;
  const _t8018 = _t8022;
  const _t8014 = _t8018;
  const _t8012 = _t8014;
  const _t8006 = _t8012;
  const _t8004 = _t8006;
  const _t8002 = _t8004;
  const _t8000 = _t8002;
  const _t7998 = _t8000;
  const _t7996 = _t7998;
  const _t7994 = _t7996;
  const _t7992 = _t7994;
  const _t7990 = _t7992;
  const _t7988 = _t7990;
  const _t7986 = _t7988;
  const _t7982 = _t7986;
  return _t7982;
}
function Typechecker$check_module_item(sub_ctx, level, prefix, item, pub_vars, pub_mutable_vars, pub_types, opaque_types, newtypes, pub_constructors, all_instances, submodules, pub_classes, typed_decls) {
  const decl_8158 = item.decl;
  let _t8161;
  const _t8160 = decl_8158;
  _t8162: {
    if (_t8160._tag === 11) {
      const inner_name = _t8160._val[0];
      const inner_items = _t8160._val[1];
      let _t8164;
      const _t8163 = Typechecker$process_module_def(sub_ctx, level, inner_name, inner_items);
      _t8165: {
        if (true) {
          const sub_ctx$p = _t8163[0];
          const tdecl = _t8163[1];
          let _t8167;
          const _t8166 = item.vis;
          _t8168: {
            if (_t8166._tag === 0) {
              let _t8170;
              const _t8169 = Typechecker$find_module_in_env(sub_ctx$p.type_env, inner_name);
              _t8171: {
                if (_t8169._tag === 1) {
                  const inner_info = _t8169._val;
                  Ref$set(submodules, ({_hd: [inner_name, inner_info], _tl: Ref$get(submodules)}));
                  function _t8172(__p269) {
                    let _t8174;
                    const _t8173 = __p269;
                    _t8175: {
                      if (true) {
                        const _mml$short = _t8173[0];
                        const scheme = _t8173[1];
                        _t8174 = Ref$set(pub_vars, ({_hd: [(inner_name + ("." + _mml$short)), scheme], _tl: Ref$get(pub_vars)}));
                        break _t8175;
                      }
                      _match_fail("line 16933");
                    }
                    return _t8174;
                  }
                  List$iter(_t8172, inner_info.mod_pub_vars);
                  function _t8176(__p270) {
                    let _t8178;
                    const _t8177 = __p270;
                    _t8179: {
                      if (true) {
                        const _mml$short = _t8177[0];
                        const info = _t8177[1];
                        _t8178 = Ref$set(pub_constructors, ({_hd: [(inner_name + ("." + _mml$short)), info], _tl: Ref$get(pub_constructors)}));
                        break _t8179;
                      }
                      _match_fail("line 16933");
                    }
                    return _t8178;
                  }
                  _t8170 = List$iter(_t8176, inner_info.mod_pub_constructors);
                  break _t8171;
                }
                if (_t8169._tag === 0) {
                  _t8170 = undefined;
                  break _t8171;
                }
                _match_fail("line 16933");
              }
              _t8167 = _t8170;
              break _t8168;
            }
            if (true) {
              _t8167 = undefined;
              break _t8168;
            }
            _match_fail("line 16933");
          }
          _t8167;
          _t8164 = [sub_ctx$p, tdecl];
          break _t8165;
        }
        _match_fail("line 16933");
      }
      _t8161 = _t8164;
      break _t8162;
    }
    if (_t8160._tag === 4) {
      const type_params = _t8160._val[0];
      const name = _t8160._val[1];
      const def = _t8160._val[2];
      const deriving_ = _t8160._val[3];
      const qualified_name_8180 = (prefix + name);
      const __rec_upd_8182 = sub_ctx;
      const __rec_upd_8184 = sub_ctx.type_env;
      const _t8185 = ({classes: __rec_upd_8184.classes, constructors: __rec_upd_8184.constructors, effects: __rec_upd_8184.effects, hidden_ctor_types: __rec_upd_8184.hidden_ctor_types, hidden_types: __rec_upd_8184.hidden_types, instances: __rec_upd_8184.instances, modules: __rec_upd_8184.modules, mutable_fields: __rec_upd_8184.mutable_fields, newtypes: __rec_upd_8184.newtypes, records: __rec_upd_8184.records, type_aliases: ({_hd: [name, qualified_name_8180], _tl: sub_ctx.type_env.type_aliases}), type_synonyms: __rec_upd_8184.type_synonyms, variants: __rec_upd_8184.variants});
      const _t8183 = ({constraint_tvars: __rec_upd_8182.constraint_tvars, current_eff: __rec_upd_8182.current_eff, current_module: __rec_upd_8182.current_module, inside_handler: __rec_upd_8182.inside_handler, loop_info: __rec_upd_8182.loop_info, mutable_vars: __rec_upd_8182.mutable_vars, return_type: __rec_upd_8182.return_type, return_used: __rec_upd_8182.return_used, type_env: _t8185, vars: __rec_upd_8182.vars});
      const sub_ctx_with_alias_8186 = _t8183;
      const sub_ctx$p_8188 = Typechecker$process_type_def(sub_ctx_with_alias_8186, type_params, qualified_name_8180, def);
      let _t8191;
      const _t8190 = def;
      _t8192: {
        if (_t8190._tag === 3) {
          _t8191 = Ref$set(newtypes, ({_hd: qualified_name_8180, _tl: Ref$get(newtypes)}));
          break _t8192;
        }
        if (true) {
          _t8191 = undefined;
          break _t8192;
        }
        _match_fail("line 16933");
      }
      _t8191;
      let _t8194;
      const _t8193 = item.vis;
      _t8195: {
        if (_t8193._tag === 0) {
          Ref$set(pub_types, ({_hd: qualified_name_8180, _tl: Ref$get(pub_types)}));
          let _t8197;
          const _t8196 = def;
          _t8198: {
            if (_t8196._tag === 0) {
              const ctors = _t8196._val;
              function _t8199(__p271) {
                let _t8201;
                const _t8200 = __p271;
                _t8202: {
                  if (true) {
                    const ctor_name = _t8200[0];
                    let _t8204;
                    const _t8203 = List$assoc_opt(ctor_name, sub_ctx$p_8188.type_env.constructors);
                    _t8205: {
                      if (_t8203._tag === 1) {
                        const info = _t8203._val;
                        const __rec_upd_8206 = info;
                        const _t8207 = ({ctor_arg_ty: __rec_upd_8206.ctor_arg_ty, ctor_existentials: __rec_upd_8206.ctor_existentials, ctor_num_params: __rec_upd_8206.ctor_num_params, ctor_return_ty_params: __rec_upd_8206.ctor_return_ty_params, ctor_type_name: qualified_name_8180});
                        const qual_info_8208 = _t8207;
                        const _t8209 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_8208], _tl: Ref$get(pub_constructors)}));
                        _t8204 = _t8209;
                        break _t8205;
                      }
                      if (_t8203._tag === 0) {
                        _t8204 = undefined;
                        break _t8205;
                      }
                      _match_fail("line 16933");
                    }
                    _t8201 = _t8204;
                    break _t8202;
                  }
                  _match_fail("line 16933");
                }
                return _t8201;
              }
              _t8197 = List$iter(_t8199, ctors);
              break _t8198;
            }
            if (_t8196._tag === 3) {
              const ctor_name = _t8196._val[0];
              let _t8211;
              const _t8210 = List$assoc_opt(ctor_name, sub_ctx$p_8188.type_env.constructors);
              _t8212: {
                if (_t8210._tag === 1) {
                  const info = _t8210._val;
                  const __rec_upd_8213 = info;
                  const _t8214 = ({ctor_arg_ty: __rec_upd_8213.ctor_arg_ty, ctor_existentials: __rec_upd_8213.ctor_existentials, ctor_num_params: __rec_upd_8213.ctor_num_params, ctor_return_ty_params: __rec_upd_8213.ctor_return_ty_params, ctor_type_name: qualified_name_8180});
                  const qual_info_8215 = _t8214;
                  const _t8216 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_8215], _tl: Ref$get(pub_constructors)}));
                  _t8211 = _t8216;
                  break _t8212;
                }
                if (_t8210._tag === 0) {
                  _t8211 = undefined;
                  break _t8212;
                }
                _match_fail("line 16933");
              }
              _t8197 = _t8211;
              break _t8198;
            }
            if ((_t8196._tag === 1 || _t8196._tag === 2)) {
              _t8197 = undefined;
              break _t8198;
            }
            _match_fail("line 16933");
          }
          _t8194 = _t8197;
          break _t8195;
        }
        if (_t8193._tag === 2) {
          Ref$set(pub_types, ({_hd: qualified_name_8180, _tl: Ref$get(pub_types)}));
          _t8194 = Ref$set(opaque_types, ({_hd: qualified_name_8180, _tl: Ref$get(opaque_types)}));
          break _t8195;
        }
        if (_t8193._tag === 1) {
          _t8194 = undefined;
          break _t8195;
        }
        _match_fail("line 16933");
      }
      _t8194;
      function _t8217(ctx, cls) {
        let _t8219;
        const _t8218 = Typechecker$generate_derived_instance(type_params, name, def, cls);
        _t8220: {
          if (_t8218._tag === 1) {
            const class_name = _t8218._val[0];
            const inst_tys = _t8218._val[1];
            const constraints = _t8218._val[2];
            const methods = _t8218._val[3];
            let _t8222;
            const _t8221 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
            _t8223: {
              if (true) {
                const ctx$p = _t8221[0];
                const tdecl = _t8221[1];
                Ref$set(typed_decls, ({_hd: tdecl, _tl: Ref$get(typed_decls)}));
                Ref$set(all_instances, ctx$p.type_env.instances);
                _t8222 = ctx$p;
                break _t8223;
              }
              _match_fail("line 16933");
            }
            _t8219 = _t8222;
            break _t8220;
          }
          if (_t8218._tag === 0) {
            _t8219 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
            break _t8220;
          }
          _match_fail("line 16933");
        }
        return _t8219;
      }
      const sub_ctx$p_8224 = List$fold(_t8217, sub_ctx$p_8188, deriving_);
      const _t8225 = [sub_ctx$p_8224, ({_tag: 4, _name: "TDType", _val: [qualified_name_8180, def]})];
      const _t8189 = _t8225;
      const _t8187 = _t8189;
      const _t8181 = _t8187;
      _t8161 = _t8181;
      break _t8162;
    }
    if (_t8160._tag === 0) {
      const name = _t8160._val[0];
      const params = _t8160._val[1];
      const ret_annot = _t8160._val[2];
      const constraints = _t8160._val[3];
      const body = _t8160._val[4];
      const qualified_name_8226 = (prefix + name);
      let _t8228;
      if (!_eq(constraints, null)) {
        _t8228 = Typechecker$synth_constrained_fn(sub_ctx, level, constraints, params, ret_annot, body);
      } else {
        const full_body_8229 = Typechecker$wrap_params_decl(params, ret_annot, body);
        const te_8231 = Typechecker$synth(sub_ctx, (level + 1), full_body_8229);
        Typechecker$improve_fundeps_in_expr(sub_ctx.vars, sub_ctx.type_env, te_8231);
        let _t8233;
        if ((_eq(params, null) && (!Typechecker$is_syntactic_value(body)))) {
          _t8233 = Typechecker$mono_scheme(te_8231.ty);
        } else {
          _t8233 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, te_8231.ty, Hashtbl$create(0));
        }
        const scheme_8234 = _t8233;
        const scheme_8236 = Typechecker$infer_implicit_constraints("", sub_ctx.type_env, sub_ctx.vars, te_8231, scheme_8234);
        const scheme_8238 = Typechecker$infer_record_evidence(sub_ctx.vars, te_8231, scheme_8236);
        const _t8239 = [te_8231, scheme_8238];
        const _t8237 = _t8239;
        const _t8235 = _t8237;
        const _t8232 = _t8235;
        const _t8230 = _t8232;
        _t8228 = _t8230;
      }
      let _t8241;
      const _t8240 = _t8228;
      _t8242: {
        if (true) {
          const te = _t8240[0];
          const scheme = _t8240[1];
          const sub_ctx$p_8243 = Typechecker$extend_var(sub_ctx, name, scheme);
          const sub_ctx$p_8245 = Typechecker$extend_var(sub_ctx$p_8243, qualified_name_8226, scheme);
          let _t8248;
          const _t8247 = item.vis;
          _t8249: {
            if (_t8247._tag === 0) {
              _t8248 = Ref$set(pub_vars, ({_hd: [name, scheme], _tl: Ref$get(pub_vars)}));
              break _t8249;
            }
            if (true) {
              _t8248 = undefined;
              break _t8249;
            }
            _match_fail("line 16933");
          }
          _t8248;
          const _t8246 = [sub_ctx$p_8245, ({_tag: 0, _name: "TDLet", _val: [qualified_name_8226, te]})];
          const _t8244 = _t8246;
          _t8241 = _t8244;
          break _t8242;
        }
        _match_fail("line 16933");
      }
      const _t8227 = _t8241;
      _t8161 = _t8227;
      break _t8162;
    }
    if (_t8160._tag === 1) {
      const name = _t8160._val[0];
      const body = _t8160._val[1];
      const qualified_name_8250 = (prefix + name);
      const te_8252 = Typechecker$synth(sub_ctx, (level + 1), body);
      const scheme_8254 = Typechecker$mono_scheme(te_8252.ty);
      const sub_ctx$p_8256 = Typechecker$extend_var_mutable(sub_ctx, name, scheme_8254);
      const sub_ctx$p_8258 = Typechecker$extend_var_mutable(sub_ctx$p_8256, qualified_name_8250, scheme_8254);
      let _t8261;
      const _t8260 = item.vis;
      _t8262: {
        if (_t8260._tag === 0) {
          Ref$set(pub_vars, ({_hd: [name, scheme_8254], _tl: Ref$get(pub_vars)}));
          _t8261 = Ref$set(pub_mutable_vars, ({_hd: name, _tl: Ref$get(pub_mutable_vars)}));
          break _t8262;
        }
        if (true) {
          _t8261 = undefined;
          break _t8262;
        }
        _match_fail("line 16933");
      }
      _t8261;
      const _t8259 = [sub_ctx$p_8258, ({_tag: 1, _name: "TDLetMut", _val: [qualified_name_8250, te_8252]})];
      const _t8257 = _t8259;
      const _t8255 = _t8257;
      const _t8253 = _t8255;
      const _t8251 = _t8253;
      _t8161 = _t8251;
      break _t8162;
    }
    if (_t8160._tag === 2) {
      const name = _t8160._val[0];
      const type_params = _t8160._val[1];
      const params = _t8160._val[2];
      const ret_annot = _t8160._val[3];
      const constraints = _t8160._val[4];
      const body = _t8160._val[5];
      const qualified_name_8263 = (prefix + name);
      let _t8265;
      if (!_eq(type_params, null)) {
        _t8265 = Typechecker$synth_poly_rec_fn(sub_ctx, level, name, qualified_name_8263, type_params, params, ret_annot, body);
      } else {
        let _t8266;
        if (!_eq(constraints, null)) {
          const fn_var_8267 = Types$new_tvar((level + 1));
          const sub_ctx_self_8269 = Typechecker$extend_var_mono(sub_ctx, name, fn_var_8267);
          const sub_ctx_self_8271 = Typechecker$extend_var_mono(sub_ctx_self_8269, qualified_name_8263, fn_var_8267);
          let _t8274;
          const _t8273 = Typechecker$synth_constrained_fn(sub_ctx_self_8271, level, constraints, params, ret_annot, body);
          _t8275: {
            if (true) {
              const te = _t8273[0];
              const scheme = _t8273[1];
              Typechecker$try_unify(fn_var_8267, te.ty);
              _t8274 = [te, scheme];
              break _t8275;
            }
            _match_fail("line 16933");
          }
          const _t8272 = _t8274;
          const _t8270 = _t8272;
          const _t8268 = _t8270;
          _t8266 = _t8268;
        } else {
          const full_body_8276 = Typechecker$wrap_params_decl(params, ret_annot, body);
          const fn_var_8278 = Types$new_tvar((level + 1));
          const sub_ctx$p_8280 = Typechecker$extend_var_mono(sub_ctx, name, fn_var_8278);
          const sub_ctx$p_8282 = Typechecker$extend_var_mono(sub_ctx$p_8280, qualified_name_8263, fn_var_8278);
          const fn_te_8284 = Typechecker$synth(sub_ctx$p_8282, (level + 1), full_body_8276);
          Typechecker$try_unify(fn_var_8278, fn_te_8284.ty);
          Typechecker$improve_fundeps_in_expr(sub_ctx.vars, sub_ctx.type_env, fn_te_8284);
          const scheme_8286 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, fn_te_8284.ty, Hashtbl$create(0));
          const scheme_8288 = Typechecker$infer_implicit_constraints(name, sub_ctx.type_env, sub_ctx.vars, fn_te_8284, scheme_8286);
          const scheme_8290 = Typechecker$infer_record_evidence(sub_ctx.vars, fn_te_8284, scheme_8288);
          const _t8291 = [fn_te_8284, scheme_8290];
          const _t8289 = _t8291;
          const _t8287 = _t8289;
          const _t8285 = _t8287;
          const _t8283 = _t8285;
          const _t8281 = _t8283;
          const _t8279 = _t8281;
          const _t8277 = _t8279;
          _t8266 = _t8277;
        }
        _t8265 = _t8266;
      }
      let _t8293;
      const _t8292 = _t8265;
      _t8294: {
        if (true) {
          const fn_te = _t8292[0];
          const scheme = _t8292[1];
          const sub_ctx$p$p_8295 = Typechecker$extend_var(sub_ctx, name, scheme);
          const sub_ctx$p$p_8297 = Typechecker$extend_var(sub_ctx$p$p_8295, qualified_name_8263, scheme);
          let _t8300;
          const _t8299 = item.vis;
          _t8301: {
            if (_t8299._tag === 0) {
              _t8300 = Ref$set(pub_vars, ({_hd: [name, scheme], _tl: Ref$get(pub_vars)}));
              break _t8301;
            }
            if (true) {
              _t8300 = undefined;
              break _t8301;
            }
            _match_fail("line 16933");
          }
          _t8300;
          const _t8298 = [sub_ctx$p$p_8297, ({_tag: 2, _name: "TDLetRec", _val: [qualified_name_8263, fn_te]})];
          const _t8296 = _t8298;
          _t8293 = _t8296;
          break _t8294;
        }
        _match_fail("line 16933");
      }
      const _t8264 = _t8293;
      _t8161 = _t8264;
      break _t8162;
    }
    if (_t8160._tag === 7) {
      const name = _t8160._val[0];
      const tyvars = _t8160._val[1];
      const fundeps = _t8160._val[2];
      const methods = _t8160._val[3];
      const qualified_8302 = (prefix + name);
      let _t8305;
      const _t8304 = Typechecker$process_class_def(sub_ctx, qualified_8302, tyvars, fundeps, methods);
      _t8306: {
        if (true) {
          const sub_ctx$p = _t8304[0];
          const tdecl = _t8304[1];
          const __rec_upd_8307 = sub_ctx$p;
          const __rec_upd_8309 = sub_ctx$p.type_env;
          const _t8310 = ({classes: __rec_upd_8309.classes, constructors: __rec_upd_8309.constructors, effects: __rec_upd_8309.effects, hidden_ctor_types: __rec_upd_8309.hidden_ctor_types, hidden_types: __rec_upd_8309.hidden_types, instances: __rec_upd_8309.instances, modules: __rec_upd_8309.modules, mutable_fields: __rec_upd_8309.mutable_fields, newtypes: __rec_upd_8309.newtypes, records: __rec_upd_8309.records, type_aliases: ({_hd: [name, qualified_8302], _tl: sub_ctx$p.type_env.type_aliases}), type_synonyms: __rec_upd_8309.type_synonyms, variants: __rec_upd_8309.variants});
          const _t8308 = ({constraint_tvars: __rec_upd_8307.constraint_tvars, current_eff: __rec_upd_8307.current_eff, current_module: __rec_upd_8307.current_module, inside_handler: __rec_upd_8307.inside_handler, loop_info: __rec_upd_8307.loop_info, mutable_vars: __rec_upd_8307.mutable_vars, return_type: __rec_upd_8307.return_type, return_used: __rec_upd_8307.return_used, type_env: _t8310, vars: __rec_upd_8307.vars});
          const sub_ctx$p_8311 = _t8308;
          let _t8314;
          const _t8313 = item.vis;
          _t8315: {
            if (_t8313._tag === 0) {
              Ref$set(pub_classes, ({_hd: qualified_8302, _tl: Ref$get(pub_classes)}));
              function _t8316(__p272) {
                let _t8318;
                const _t8317 = __p272;
                _t8319: {
                  if (true) {
                    const mname = _t8317[0];
                    let _t8321;
                    const _t8320 = List$assoc_opt(mname, sub_ctx$p_8311.vars);
                    _t8322: {
                      if (_t8320._tag === 1) {
                        const scheme = _t8320._val;
                        _t8321 = Ref$set(pub_vars, ({_hd: [mname, scheme], _tl: Ref$get(pub_vars)}));
                        break _t8322;
                      }
                      if (_t8320._tag === 0) {
                        _t8321 = undefined;
                        break _t8322;
                      }
                      _match_fail("line 16933");
                    }
                    _t8318 = _t8321;
                    break _t8319;
                  }
                  _match_fail("line 16933");
                }
                return _t8318;
              }
              _t8314 = List$iter(_t8316, methods);
              break _t8315;
            }
            if (true) {
              _t8314 = undefined;
              break _t8315;
            }
            _match_fail("line 16933");
          }
          _t8314;
          const _t8312 = [sub_ctx$p_8311, tdecl];
          _t8305 = _t8312;
          break _t8306;
        }
        _match_fail("line 16933");
      }
      const _t8303 = _t8305;
      _t8161 = _t8303;
      break _t8162;
    }
    if (_t8160._tag === 8) {
      const class_name = _t8160._val[0];
      const inst_ty_annots = _t8160._val[1];
      const constraints = _t8160._val[2];
      const methods = _t8160._val[3];
      let _t8324;
      const _t8323 = Typechecker$process_instance_def(sub_ctx, level, class_name, inst_ty_annots, constraints, methods);
      _t8325: {
        if (true) {
          const sub_ctx$p = _t8323[0];
          const tdecl = _t8323[1];
          function _t8326(inst) {
            function _t8327(prev) {
              return (prev.inst_dict_name === inst.inst_dict_name);
            }
            return (!List$exists(_t8327, sub_ctx.type_env.instances));
          }
          const new_insts_8328 = List$filter(_t8326, sub_ctx$p.type_env.instances);
          Ref$set(all_instances, List$concat(new_insts_8328, Ref$get(all_instances)));
          const _t8329 = [sub_ctx$p, tdecl];
          _t8324 = _t8329;
          break _t8325;
        }
        _match_fail("line 16933");
      }
      _t8161 = _t8324;
      break _t8162;
    }
    if (_t8160._tag === 9) {
      const name = _t8160._val[0];
      const type_params = _t8160._val[1];
      const ops = _t8160._val[2];
      const tvars_8330 = Hashtbl$create(4);
      function _t8332(i, p) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_8330, p, ({_tag: 16, _name: "TGen", _val: i})]);
      }
      List$iteri(_t8332, type_params);
      function _t8333(__p273) {
        let _t8335;
        const _t8334 = __p273;
        _t8336: {
          if (true) {
            const op_name = _t8334[0];
            const annot = _t8334[1];
            const ty_8337 = Typechecker$resolve_ty_annot_shared(sub_ctx, 0, tvars_8330, annot);
            const _t8338 = [op_name, ty_8337];
            _t8335 = _t8338;
            break _t8336;
          }
          _match_fail("line 16933");
        }
        return _t8335;
      }
      const resolved_ops_8339 = List$map(_t8333, ops);
      const effect_def_8341 = ({effect_name: name, effect_ops: resolved_ops_8339, effect_params: type_params});
      const __rec_upd_8343 = sub_ctx.type_env;
      const _t8344 = ({classes: __rec_upd_8343.classes, constructors: __rec_upd_8343.constructors, effects: ({_hd: effect_def_8341, _tl: sub_ctx.type_env.effects}), hidden_ctor_types: __rec_upd_8343.hidden_ctor_types, hidden_types: __rec_upd_8343.hidden_types, instances: __rec_upd_8343.instances, modules: __rec_upd_8343.modules, mutable_fields: __rec_upd_8343.mutable_fields, newtypes: __rec_upd_8343.newtypes, records: __rec_upd_8343.records, type_aliases: __rec_upd_8343.type_aliases, type_synonyms: __rec_upd_8343.type_synonyms, variants: __rec_upd_8343.variants});
      const type_env_8345 = _t8344;
      const __rec_upd_8347 = sub_ctx;
      const _t8348 = ({constraint_tvars: __rec_upd_8347.constraint_tvars, current_eff: __rec_upd_8347.current_eff, current_module: __rec_upd_8347.current_module, inside_handler: __rec_upd_8347.inside_handler, loop_info: __rec_upd_8347.loop_info, mutable_vars: __rec_upd_8347.mutable_vars, return_type: __rec_upd_8347.return_type, return_used: __rec_upd_8347.return_used, type_env: type_env_8345, vars: __rec_upd_8347.vars});
      const sub_ctx$p_8349 = _t8348;
      const _t8350 = [sub_ctx$p_8349, ({_tag: 7, _name: "TDEffect", _val: name})];
      const _t8346 = _t8350;
      const _t8342 = _t8346;
      const _t8340 = _t8342;
      const _t8331 = _t8340;
      _t8161 = _t8331;
      break _t8162;
    }
    if (_t8160._tag === 10) {
      const name = _t8160._val[0];
      const ty_annot = _t8160._val[1];
      const qualified_name_8351 = (prefix + name);
      const tvars_8353 = Hashtbl$create(4);
      const ty_8355 = Typechecker$resolve_ty_annot_shared(sub_ctx, 1, tvars_8353, ty_annot);
      const scheme_8357 = Types$generalize(0, ty_8355);
      const sub_ctx$p_8359 = Typechecker$extend_var(sub_ctx, name, scheme_8357);
      const sub_ctx$p_8361 = Typechecker$extend_var(sub_ctx$p_8359, qualified_name_8351, scheme_8357);
      let _t8364;
      const _t8363 = item.vis;
      _t8365: {
        if (_t8363._tag === 0) {
          _t8364 = Ref$set(pub_vars, ({_hd: [name, scheme_8357], _tl: Ref$get(pub_vars)}));
          break _t8365;
        }
        if (true) {
          _t8364 = undefined;
          break _t8365;
        }
        _match_fail("line 16933");
      }
      _t8364;
      const _t8362 = [sub_ctx$p_8361, ({_tag: 8, _name: "TDExtern", _val: [qualified_name_8351, scheme_8357]})];
      const _t8360 = _t8362;
      const _t8358 = _t8360;
      const _t8356 = _t8358;
      const _t8354 = _t8356;
      const _t8352 = _t8354;
      _t8161 = _t8352;
      break _t8162;
    }
    if (_t8160._tag === 6) {
      const expr = _t8160._val;
      const te_8366 = Typechecker$synth(sub_ctx, level, expr);
      const _t8367 = [sub_ctx, ({_tag: 5, _name: "TDExpr", _val: te_8366})];
      _t8161 = _t8367;
      break _t8162;
    }
    if (_t8160._tag === 12) {
      const mod_name = _t8160._val[0];
      const names_opt = _t8160._val[1];
      const sub_ctx$p_8368 = Typechecker$open_module_into_ctx(sub_ctx, mod_name, names_opt);
      let _t8371;
      const _t8370 = Typechecker$find_module_in_env(sub_ctx.type_env, mod_name);
      _t8372: {
        if (_t8370._tag === 1) {
          const m = _t8370._val;
          _t8371 = m;
          break _t8372;
        }
        if (_t8370._tag === 0) {
          _t8371 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
          break _t8372;
        }
        _match_fail("line 16933");
      }
      const minfo_8373 = _t8371;
      function _t8375(qname) {
        function _t8376(c) {
          return (c.class_name === qname);
        }
        let _t8378;
        const _t8377 = List$find(_t8376, sub_ctx.type_env.classes);
        _t8379: {
          if (_t8377._tag === 1) {
            const cls = _t8377._val;
            _t8378 = List$map(fst, cls.class_methods);
            break _t8379;
          }
          if (_t8377._tag === 0) {
            _t8378 = null;
            break _t8379;
          }
          _match_fail("line 16933");
        }
        return _t8378;
      }
      const class_method_names_8380 = List$concat_map(_t8375, minfo_8373.mod_pub_classes);
      function _t8382(name) {
        let _t8384;
        const _t8383 = names_opt;
        _t8385: {
          if (_t8383._tag === 0) {
            _t8384 = true;
            break _t8385;
          }
          if (_t8383._tag === 1) {
            const names = _t8383._val;
            _t8384 = List$mem(name, names);
            break _t8385;
          }
          _match_fail("line 16933");
        }
        return _t8384;
      }
      const filter_8386 = _t8382;
      function _t8388(__p274) {
        let _t8390;
        const _t8389 = __p274;
        _t8391: {
          if (true) {
            const _mml$short = _t8389[0];
            const scheme = _t8389[1];
            let _t8392;
            if ((filter_8386(_mml$short) && (!List$mem(_mml$short, class_method_names_8380)))) {
              const qualified_dst_8393 = (prefix + _mml$short);
              const qualified_src_8395 = (mod_name + ("." + _mml$short));
              scheme;
              undefined;
              const _t8396 = ({_tag: 1, _name: "Some", _val: [qualified_dst_8393, qualified_src_8395]});
              const _t8394 = _t8396;
              _t8392 = _t8394;
            } else {
              _t8392 = ({_tag: 0, _name: "None"});
            }
            _t8390 = _t8392;
            break _t8391;
          }
          _match_fail("line 16933");
        }
        return _t8390;
      }
      const alias_pairs_8397 = List$filter_map(_t8388, minfo_8373.mod_pub_vars);
      function _t8399(ctx, __p275) {
        let _t8401;
        const _t8400 = __p275;
        _t8402: {
          if (true) {
            const _mml$short = _t8400[0];
            const scheme = _t8400[1];
            let _t8403;
            if ((filter_8386(_mml$short) && (!List$mem(_mml$short, class_method_names_8380)))) {
              _t8403 = Typechecker$extend_var(ctx, (prefix + _mml$short), scheme);
            } else {
              _t8403 = ctx;
            }
            _t8401 = _t8403;
            break _t8402;
          }
          _match_fail("line 16933");
        }
        return _t8401;
      }
      const sub_ctx$p_8404 = List$fold(_t8399, sub_ctx$p_8368, minfo_8373.mod_pub_vars);
      const _t8405 = [sub_ctx$p_8404, ({_tag: 10, _name: "TDOpen", _val: alias_pairs_8397})];
      const _t8398 = _t8405;
      const _t8387 = _t8398;
      const _t8381 = _t8387;
      const _t8374 = _t8381;
      const _t8369 = _t8374;
      _t8161 = _t8369;
      break _t8162;
    }
    if (_t8160._tag === 3) {
      const bindings = _t8160._val;
      function _t8406(__p276) {
        let _t8408;
        const _t8407 = __p276;
        _t8409: {
          if (true) {
            const tp = _t8407[1];
            _t8408 = !_eq(tp, null);
            break _t8409;
          }
          _match_fail("line 16933");
        }
        return _t8408;
      }
      const has_poly_8410 = List$exists(_t8406, bindings);
      let _t8412;
      if (has_poly_8410) {
        function _t8413(__p277) {
          let _t8415;
          const _t8414 = __p277;
          _t8416: {
            if (true) {
              const type_params = _t8414[1];
              const params = _t8414[2];
              const ret_annot = _t8414[3];
              const shared_tvars_8417 = Hashtbl$create(4);
              function _t8419(tp) {
                return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_8417, tp, Types$new_tvar((level + 1))]);
              }
              List$iter(_t8419, type_params);
              function _t8420(p) {
                let _t8422;
                const _t8421 = p.annot;
                _t8423: {
                  if (_t8421._tag === 1) {
                    const annot = _t8421._val;
                    _t8422 = Typechecker$resolve_ty_annot_shared(sub_ctx, (level + 1), shared_tvars_8417, annot);
                    break _t8423;
                  }
                  if (_t8421._tag === 0) {
                    _t8422 = Types$new_tvar((level + 1));
                    break _t8423;
                  }
                  _match_fail("line 16933");
                }
                return _t8422;
              }
              const param_tys_8424 = List$map(_t8420, params);
              let _t8427;
              const _t8426 = ret_annot;
              _t8428: {
                if (_t8426._tag === 1 && _t8426._val._tag === 10) {
                  const ty = _t8426._val._val[0];
                  const eff_annot = _t8426._val._val[1];
                  const ty$p_8429 = Typechecker$resolve_ty_annot_shared(sub_ctx, (level + 1), shared_tvars_8417, ty);
                  let _t8432;
                  const _t8431 = eff_annot;
                  _t8433: {
                    if (_t8431._tag === 0) {
                      _t8432 = ({_tag: 1, _name: "EffEmpty"});
                      break _t8433;
                    }
                    if (_t8431._tag === 1) {
                      const items = _t8431._val;
                      _t8432 = Typechecker$resolve_eff_items(sub_ctx, (level + 1), shared_tvars_8417, items);
                      break _t8433;
                    }
                    _match_fail("line 16933");
                  }
                  const eff_8434 = _t8432;
                  const _t8435 = [ty$p_8429, eff_8434];
                  const _t8430 = _t8435;
                  _t8427 = _t8430;
                  break _t8428;
                }
                if (_t8426._tag === 1) {
                  const annot = _t8426._val;
                  _t8427 = [Typechecker$resolve_ty_annot_shared(sub_ctx, (level + 1), shared_tvars_8417, annot), Types$new_effvar((level + 1))];
                  break _t8428;
                }
                if (_t8426._tag === 0) {
                  _t8427 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
                  break _t8428;
                }
                _match_fail("line 16933");
              }
              let _t8437;
              const _t8436 = _t8427;
              _t8438: {
                if (true) {
                  const ret_ty = _t8436[0];
                  const body_eff = _t8436[1];
                  let _t8440;
                  const _t8439 = List$rev(param_tys_8424);
                  _t8441: {
                    if (_t8439 === null) {
                      _t8440 = ret_ty;
                      break _t8441;
                    }
                    if (_t8439 !== null) {
                      const last = _t8439._hd;
                      const rest = _t8439._tl;
                      const inner_8442 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
                      function _t8444(acc, pty) {
                        return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
                      }
                      const _t8443 = List$fold(_t8444, inner_8442, rest);
                      _t8440 = _t8443;
                      break _t8441;
                    }
                    _match_fail("line 16933");
                  }
                  const fn_ty_8445 = _t8440;
                  const _t8446 = [shared_tvars_8417, param_tys_8424, ret_ty, body_eff, fn_ty_8445];
                  _t8437 = _t8446;
                  break _t8438;
                }
                _match_fail("line 16933");
              }
              const _t8425 = _t8437;
              const _t8418 = _t8425;
              _t8415 = _t8418;
              break _t8416;
            }
            _match_fail("line 16933");
          }
          return _t8415;
        }
        const shared_tvars_list_8447 = List$map(_t8413, bindings);
        function _t8449(__p278) {
          let _t8451;
          const _t8450 = __p278;
          _t8452: {
            if (true) {
              const fn_ty = _t8450[4];
              _t8451 = Types$generalize(level, fn_ty);
              break _t8452;
            }
            _match_fail("line 16933");
          }
          return _t8451;
        }
        const schemes_8453 = List$map(_t8449, shared_tvars_list_8447);
        function _t8455(ctx, __p279, scheme) {
          let _t8457;
          const _t8456 = __p279;
          _t8458: {
            if (true) {
              const name = _t8456[0];
              const qualified_name_8459 = (prefix + name);
              const ctx_8461 = Typechecker$extend_var(ctx, name, scheme);
              const _t8462 = Typechecker$extend_var(ctx_8461, qualified_name_8459, scheme);
              const _t8460 = _t8462;
              _t8457 = _t8460;
              break _t8458;
            }
            _match_fail("line 16933");
          }
          return _t8457;
        }
        const sub_ctx$p_8463 = List$fold2(_t8455, sub_ctx, bindings, schemes_8453);
        function _t8465(__p280, __p281) {
          let _t8467;
          const _t8466 = __p280;
          _t8468: {
            if (true) {
              const params = _t8466[2];
              const body = _t8466[5];
              let _t8470;
              const _t8469 = __p281;
              _t8471: {
                if (true) {
                  const param_tys = _t8469[1];
                  const ret_ty = _t8469[2];
                  const body_eff = _t8469[3];
                  function _t8472(c, p, ty) {
                    return Typechecker$extend_var_mono(c, p.name, ty);
                  }
                  const __rec_upd_8473 = sub_ctx$p_8463;
                  const _t8474 = ({constraint_tvars: __rec_upd_8473.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_8473.current_module, inside_handler: __rec_upd_8473.inside_handler, loop_info: __rec_upd_8473.loop_info, mutable_vars: __rec_upd_8473.mutable_vars, return_type: __rec_upd_8473.return_type, return_used: __rec_upd_8473.return_used, type_env: __rec_upd_8473.type_env, vars: __rec_upd_8473.vars});
                  const inner_ctx_8475 = List$fold2(_t8472, _t8474, params, param_tys);
                  const body_te_8477 = Typechecker$check(inner_ctx_8475, (level + 1), body, ret_ty);
                  let _t8480;
                  const _t8479 = [List$rev(params), List$rev(param_tys)];
                  _t8481: {
                    if (_t8479[0] === null && _t8479[1] === null) {
                      _t8480 = body_te_8477;
                      break _t8481;
                    }
                    if (_t8479[0] !== null && _t8479[1] !== null) {
                      const last_p = _t8479[0]._hd;
                      const rest_ps = _t8479[0]._tl;
                      const last_pty = _t8479[1]._hd;
                      const rest_ptys = _t8479[1]._tl;
                      const inner_8482 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_8477, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_8477.ty]}));
                      function _t8484(acc, p, pty) {
                        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
                      }
                      const _t8483 = List$fold2(_t8484, inner_8482, rest_ps, rest_ptys);
                      _t8480 = _t8483;
                      break _t8481;
                    }
                    if (true) {
                      _t8480 = failwith("assert false");
                      break _t8481;
                    }
                    _match_fail("line 16933");
                  }
                  const _t8478 = _t8480;
                  const _t8476 = _t8478;
                  _t8470 = _t8476;
                  break _t8471;
                }
                _match_fail("line 16933");
              }
              _t8467 = _t8470;
              break _t8468;
            }
            _match_fail("line 16933");
          }
          return _t8467;
        }
        const body_tes_8485 = List$map2(_t8465, bindings, shared_tvars_list_8447);
        function _t8487(ctx, __p282, scheme) {
          let _t8489;
          const _t8488 = __p282;
          _t8490: {
            if (true) {
              const name = _t8488[0];
              const qualified_name_8491 = (prefix + name);
              const ctx_8493 = Typechecker$extend_var(ctx, name, scheme);
              const _t8494 = Typechecker$extend_var(ctx_8493, qualified_name_8491, scheme);
              const _t8492 = _t8494;
              _t8489 = _t8492;
              break _t8490;
            }
            _match_fail("line 16933");
          }
          return _t8489;
        }
        const sub_ctx$p$p_8495 = List$fold2(_t8487, sub_ctx, bindings, schemes_8453);
        function _t8497(__p283, te) {
          let _t8499;
          const _t8498 = __p283;
          _t8500: {
            if (true) {
              const name = _t8498[0];
              const qualified_name_8501 = (prefix + name);
              const _t8502 = [qualified_name_8501, te];
              _t8499 = _t8502;
              break _t8500;
            }
            _match_fail("line 16933");
          }
          return _t8499;
        }
        const typed_bindings_8503 = List$map2(_t8497, bindings, body_tes_8485);
        function _t8505(__p284) {
          let _t8507;
          const _t8506 = __p284;
          _t8508: {
            if (true) {
              const name = _t8506[0];
              function _t8509(__p285, s) {
                let _t8511;
                const _t8510 = __p285;
                _t8512: {
                  if (true) {
                    const n = _t8510[0];
                    _t8511 = [n, s];
                    break _t8512;
                  }
                  _match_fail("line 16933");
                }
                return _t8511;
              }
              const scheme_8513 = List$assoc(name, List$map2(_t8509, bindings, schemes_8453));
              let _t8516;
              const _t8515 = item.vis;
              _t8517: {
                if (_t8515._tag === 0) {
                  _t8516 = Ref$set(pub_vars, ({_hd: [name, scheme_8513], _tl: Ref$get(pub_vars)}));
                  break _t8517;
                }
                if (true) {
                  _t8516 = undefined;
                  break _t8517;
                }
                _match_fail("line 16933");
              }
              const _t8514 = _t8516;
              _t8507 = _t8514;
              break _t8508;
            }
            _match_fail("line 16933");
          }
          return _t8507;
        }
        List$iter(_t8505, bindings);
        const _t8504 = [sub_ctx$p$p_8495, ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_8503})];
        const _t8496 = _t8504;
        const _t8486 = _t8496;
        const _t8464 = _t8486;
        const _t8454 = _t8464;
        const _t8448 = _t8454;
        _t8412 = _t8448;
      } else {
        function _t8518(__p286) {
          let _t8520;
          const _t8519 = __p286;
          _t8521: {
            if (true) {
              const name = _t8519[0];
              _t8520 = [name, Types$new_tvar((level + 1))];
              break _t8521;
            }
            _match_fail("line 16933");
          }
          return _t8520;
        }
        const fn_vars_8522 = List$map(_t8518, bindings);
        function _t8524(ctx, __p287) {
          let _t8526;
          const _t8525 = __p287;
          _t8527: {
            if (true) {
              const name = _t8525[0];
              const tv = _t8525[1];
              const qualified_name_8528 = (prefix + name);
              const ctx_8530 = Typechecker$extend_var_mono(ctx, name, tv);
              const _t8531 = Typechecker$extend_var_mono(ctx_8530, qualified_name_8528, tv);
              const _t8529 = _t8531;
              _t8526 = _t8529;
              break _t8527;
            }
            _match_fail("line 16933");
          }
          return _t8526;
        }
        const sub_ctx$p_8532 = List$fold(_t8524, sub_ctx, fn_vars_8522);
        function _t8534(__p288, __p289) {
          let _t8536;
          const _t8535 = __p288;
          _t8537: {
            if (true) {
              const name = _t8535[0];
              const params = _t8535[2];
              const ret_annot = _t8535[3];
              const constraints = _t8535[4];
              const body = _t8535[5];
              let _t8539;
              const _t8538 = __p289;
              _t8540: {
                if (true) {
                  const tv = _t8538[1];
                  name;
                  undefined;
                  let _t8541;
                  if (!_eq(constraints, null)) {
                    let _t8543;
                    const _t8542 = Typechecker$synth_constrained_fn(sub_ctx$p_8532, level, constraints, params, ret_annot, body);
                    _t8544: {
                      if (true) {
                        const te = _t8542[0];
                        const _scheme = _t8542[1];
                        Typechecker$try_unify(tv, te.ty);
                        _t8543 = te;
                        break _t8544;
                      }
                      _match_fail("line 16933");
                    }
                    _t8541 = _t8543;
                  } else {
                    const full_body_8545 = Typechecker$wrap_params_decl(params, ret_annot, body);
                    const te_8547 = Typechecker$synth(sub_ctx$p_8532, (level + 1), full_body_8545);
                    Typechecker$try_unify(tv, te_8547.ty);
                    const _t8548 = te_8547;
                    const _t8546 = _t8548;
                    _t8541 = _t8546;
                  }
                  _t8539 = _t8541;
                  break _t8540;
                }
                _match_fail("line 16933");
              }
              _t8536 = _t8539;
              break _t8537;
            }
            _match_fail("line 16933");
          }
          return _t8536;
        }
        const body_tes_8549 = List$map2(_t8534, bindings, fn_vars_8522);
        function _t8551(ctx, __p290, __p291) {
          let _t8553;
          const _t8552 = __p290;
          _t8554: {
            if (true) {
              const name = _t8552[0];
              let _t8556;
              const _t8555 = __p291;
              _t8557: {
                if (true) {
                  const tv = _t8555[1];
                  const qualified_name_8558 = (prefix + name);
                  const scheme_8560 = Types$generalize(level, tv);
                  const ctx_8562 = Typechecker$extend_var(ctx, name, scheme_8560);
                  const _t8563 = Typechecker$extend_var(ctx_8562, qualified_name_8558, scheme_8560);
                  const _t8561 = _t8563;
                  const _t8559 = _t8561;
                  _t8556 = _t8559;
                  break _t8557;
                }
                _match_fail("line 16933");
              }
              _t8553 = _t8556;
              break _t8554;
            }
            _match_fail("line 16933");
          }
          return _t8553;
        }
        const sub_ctx$p$p_8564 = List$fold2(_t8551, sub_ctx, bindings, fn_vars_8522);
        function _t8566(__p292, te) {
          let _t8568;
          const _t8567 = __p292;
          _t8569: {
            if (true) {
              const name = _t8567[0];
              const qualified_name_8570 = (prefix + name);
              const _t8571 = [qualified_name_8570, te];
              _t8568 = _t8571;
              break _t8569;
            }
            _match_fail("line 16933");
          }
          return _t8568;
        }
        const typed_bindings_8572 = List$map2(_t8566, bindings, body_tes_8549);
        function _t8574(__p293, __p294) {
          let _t8576;
          const _t8575 = __p293;
          _t8577: {
            if (true) {
              const name = _t8575[0];
              let _t8579;
              const _t8578 = __p294;
              _t8580: {
                if (true) {
                  const tv = _t8578[1];
                  const scheme_8581 = Types$generalize(level, tv);
                  let _t8584;
                  const _t8583 = item.vis;
                  _t8585: {
                    if (_t8583._tag === 0) {
                      _t8584 = Ref$set(pub_vars, ({_hd: [name, scheme_8581], _tl: Ref$get(pub_vars)}));
                      break _t8585;
                    }
                    if (true) {
                      _t8584 = undefined;
                      break _t8585;
                    }
                    _match_fail("line 16933");
                  }
                  const _t8582 = _t8584;
                  _t8579 = _t8582;
                  break _t8580;
                }
                _match_fail("line 16933");
              }
              _t8576 = _t8579;
              break _t8577;
            }
            _match_fail("line 16933");
          }
          return _t8576;
        }
        List$iter2(_t8574, bindings, fn_vars_8522);
        const _t8573 = [sub_ctx$p$p_8564, ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_8572})];
        const _t8565 = _t8573;
        const _t8550 = _t8565;
        const _t8533 = _t8550;
        const _t8523 = _t8533;
        _t8412 = _t8523;
      }
      const _t8411 = _t8412;
      _t8161 = _t8411;
      break _t8162;
    }
    if (_t8160._tag === 5) {
      const type_defs = _t8160._val;
      function _t8586(ctx, __p295) {
        let _t8588;
        const _t8587 = __p295;
        _t8589: {
          if (true) {
            const type_params = _t8587[0];
            const name = _t8587[1];
            const def = _t8587[2];
            const _deriving = _t8587[3];
            const qualified_name_8590 = (prefix + name);
            const num_params_8592 = List$length(type_params);
            const __rec_upd_8594 = ctx;
            const __rec_upd_8596 = ctx.type_env;
            const _t8597 = ({classes: __rec_upd_8596.classes, constructors: __rec_upd_8596.constructors, effects: __rec_upd_8596.effects, hidden_ctor_types: __rec_upd_8596.hidden_ctor_types, hidden_types: __rec_upd_8596.hidden_types, instances: __rec_upd_8596.instances, modules: __rec_upd_8596.modules, mutable_fields: __rec_upd_8596.mutable_fields, newtypes: __rec_upd_8596.newtypes, records: __rec_upd_8596.records, type_aliases: ({_hd: [name, qualified_name_8590], _tl: ctx.type_env.type_aliases}), type_synonyms: __rec_upd_8596.type_synonyms, variants: __rec_upd_8596.variants});
            const _t8595 = ({constraint_tvars: __rec_upd_8594.constraint_tvars, current_eff: __rec_upd_8594.current_eff, current_module: __rec_upd_8594.current_module, inside_handler: __rec_upd_8594.inside_handler, loop_info: __rec_upd_8594.loop_info, mutable_vars: __rec_upd_8594.mutable_vars, return_type: __rec_upd_8594.return_type, return_used: __rec_upd_8594.return_used, type_env: _t8597, vars: __rec_upd_8594.vars});
            const ctx_8598 = _t8595;
            let _t8601;
            const _t8600 = def;
            _t8602: {
              if (_t8600._tag === 0) {
                const __rec_upd_8603 = ctx_8598;
                const __rec_upd_8605 = ctx_8598.type_env;
                const _t8606 = ({classes: __rec_upd_8605.classes, constructors: __rec_upd_8605.constructors, effects: __rec_upd_8605.effects, hidden_ctor_types: __rec_upd_8605.hidden_ctor_types, hidden_types: __rec_upd_8605.hidden_types, instances: __rec_upd_8605.instances, modules: __rec_upd_8605.modules, mutable_fields: __rec_upd_8605.mutable_fields, newtypes: __rec_upd_8605.newtypes, records: __rec_upd_8605.records, type_aliases: __rec_upd_8605.type_aliases, type_synonyms: __rec_upd_8605.type_synonyms, variants: ({_hd: [qualified_name_8590, num_params_8592, null, false], _tl: ctx_8598.type_env.variants})});
                const _t8604 = ({constraint_tvars: __rec_upd_8603.constraint_tvars, current_eff: __rec_upd_8603.current_eff, current_module: __rec_upd_8603.current_module, inside_handler: __rec_upd_8603.inside_handler, loop_info: __rec_upd_8603.loop_info, mutable_vars: __rec_upd_8603.mutable_vars, return_type: __rec_upd_8603.return_type, return_used: __rec_upd_8603.return_used, type_env: _t8606, vars: __rec_upd_8603.vars});
                _t8601 = _t8604;
                break _t8602;
              }
              if (_t8600._tag === 1) {
                const __rec_upd_8607 = ctx_8598;
                const __rec_upd_8609 = ctx_8598.type_env;
                const _t8610 = ({classes: __rec_upd_8609.classes, constructors: __rec_upd_8609.constructors, effects: __rec_upd_8609.effects, hidden_ctor_types: __rec_upd_8609.hidden_ctor_types, hidden_types: __rec_upd_8609.hidden_types, instances: __rec_upd_8609.instances, modules: __rec_upd_8609.modules, mutable_fields: __rec_upd_8609.mutable_fields, newtypes: __rec_upd_8609.newtypes, records: ({_hd: [qualified_name_8590, null], _tl: ctx_8598.type_env.records}), type_aliases: __rec_upd_8609.type_aliases, type_synonyms: __rec_upd_8609.type_synonyms, variants: __rec_upd_8609.variants});
                const _t8608 = ({constraint_tvars: __rec_upd_8607.constraint_tvars, current_eff: __rec_upd_8607.current_eff, current_module: __rec_upd_8607.current_module, inside_handler: __rec_upd_8607.inside_handler, loop_info: __rec_upd_8607.loop_info, mutable_vars: __rec_upd_8607.mutable_vars, return_type: __rec_upd_8607.return_type, return_used: __rec_upd_8607.return_used, type_env: _t8610, vars: __rec_upd_8607.vars});
                _t8601 = _t8608;
                break _t8602;
              }
              if (_t8600._tag === 2) {
                _t8601 = ctx_8598;
                break _t8602;
              }
              if (_t8600._tag === 3) {
                const __rec_upd_8611 = ctx_8598;
                const __rec_upd_8613 = ctx_8598.type_env;
                const _t8614 = ({classes: __rec_upd_8613.classes, constructors: __rec_upd_8613.constructors, effects: __rec_upd_8613.effects, hidden_ctor_types: __rec_upd_8613.hidden_ctor_types, hidden_types: __rec_upd_8613.hidden_types, instances: __rec_upd_8613.instances, modules: __rec_upd_8613.modules, mutable_fields: __rec_upd_8613.mutable_fields, newtypes: __rec_upd_8613.newtypes, records: __rec_upd_8613.records, type_aliases: __rec_upd_8613.type_aliases, type_synonyms: __rec_upd_8613.type_synonyms, variants: ({_hd: [qualified_name_8590, num_params_8592, null, false], _tl: ctx_8598.type_env.variants})});
                const _t8612 = ({constraint_tvars: __rec_upd_8611.constraint_tvars, current_eff: __rec_upd_8611.current_eff, current_module: __rec_upd_8611.current_module, inside_handler: __rec_upd_8611.inside_handler, loop_info: __rec_upd_8611.loop_info, mutable_vars: __rec_upd_8611.mutable_vars, return_type: __rec_upd_8611.return_type, return_used: __rec_upd_8611.return_used, type_env: _t8614, vars: __rec_upd_8611.vars});
                _t8601 = _t8612;
                break _t8602;
              }
              _match_fail("line 16933");
            }
            const _t8599 = _t8601;
            const _t8593 = _t8599;
            const _t8591 = _t8593;
            _t8588 = _t8591;
            break _t8589;
          }
          _match_fail("line 16933");
        }
        return _t8588;
      }
      const sub_ctx$p_8615 = List$fold(_t8586, sub_ctx, type_defs);
      function _t8617(ctx, __p296) {
        let _t8619;
        const _t8618 = __p296;
        _t8620: {
          if (true) {
            const type_params = _t8618[0];
            const name = _t8618[1];
            const def = _t8618[2];
            const _deriving = _t8618[3];
            let _t8622;
            const _t8621 = def;
            _t8623: {
              if (_t8621._tag === 1) {
                const qualified_name_8624 = (prefix + name);
                const _t8625 = Typechecker$process_type_def(ctx, type_params, qualified_name_8624, def);
                _t8622 = _t8625;
                break _t8623;
              }
              if (true) {
                _t8622 = ctx;
                break _t8623;
              }
              _match_fail("line 16933");
            }
            _t8619 = _t8622;
            break _t8620;
          }
          _match_fail("line 16933");
        }
        return _t8619;
      }
      const sub_ctx$p_8626 = List$fold(_t8617, sub_ctx$p_8615, type_defs);
      function _t8628(ctx, __p297) {
        let _t8630;
        const _t8629 = __p297;
        _t8631: {
          if (true) {
            const type_params = _t8629[0];
            const name = _t8629[1];
            const def = _t8629[2];
            const _deriving = _t8629[3];
            let _t8633;
            const _t8632 = def;
            _t8634: {
              if (_t8632._tag === 1) {
                _t8633 = ctx;
                break _t8634;
              }
              if (true) {
                const qualified_name_8635 = (prefix + name);
                const _t8636 = Typechecker$process_type_def(ctx, type_params, qualified_name_8635, def);
                _t8633 = _t8636;
                break _t8634;
              }
              _match_fail("line 16933");
            }
            _t8630 = _t8633;
            break _t8631;
          }
          _match_fail("line 16933");
        }
        return _t8630;
      }
      const sub_ctx$p_8637 = List$fold(_t8628, sub_ctx$p_8626, type_defs);
      function _t8639(__p298) {
        let _t8641;
        const _t8640 = __p298;
        _t8642: {
          if (true) {
            const _type_params = _t8640[0];
            const name = _t8640[1];
            const def = _t8640[2];
            const _deriving = _t8640[3];
            const qualified_name_8643 = (prefix + name);
            let _t8646;
            const _t8645 = item.vis;
            _t8647: {
              if (_t8645._tag === 0) {
                Ref$set(pub_types, ({_hd: qualified_name_8643, _tl: Ref$get(pub_types)}));
                let _t8649;
                const _t8648 = def;
                _t8650: {
                  if (_t8648._tag === 0) {
                    const ctors = _t8648._val;
                    function _t8651(__p299) {
                      let _t8653;
                      const _t8652 = __p299;
                      _t8654: {
                        if (true) {
                          const ctor_name = _t8652[0];
                          let _t8656;
                          const _t8655 = List$assoc_opt(ctor_name, sub_ctx$p_8637.type_env.constructors);
                          _t8657: {
                            if (_t8655._tag === 1) {
                              const info = _t8655._val;
                              const __rec_upd_8658 = info;
                              const _t8659 = ({ctor_arg_ty: __rec_upd_8658.ctor_arg_ty, ctor_existentials: __rec_upd_8658.ctor_existentials, ctor_num_params: __rec_upd_8658.ctor_num_params, ctor_return_ty_params: __rec_upd_8658.ctor_return_ty_params, ctor_type_name: qualified_name_8643});
                              const qual_info_8660 = _t8659;
                              const _t8661 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_8660], _tl: Ref$get(pub_constructors)}));
                              _t8656 = _t8661;
                              break _t8657;
                            }
                            if (_t8655._tag === 0) {
                              _t8656 = undefined;
                              break _t8657;
                            }
                            _match_fail("line 16933");
                          }
                          _t8653 = _t8656;
                          break _t8654;
                        }
                        _match_fail("line 16933");
                      }
                      return _t8653;
                    }
                    _t8649 = List$iter(_t8651, ctors);
                    break _t8650;
                  }
                  if (_t8648._tag === 3) {
                    const ctor_name = _t8648._val[0];
                    Ref$set(newtypes, ({_hd: qualified_name_8643, _tl: Ref$get(newtypes)}));
                    let _t8663;
                    const _t8662 = List$assoc_opt(ctor_name, sub_ctx$p_8637.type_env.constructors);
                    _t8664: {
                      if (_t8662._tag === 1) {
                        const info = _t8662._val;
                        const __rec_upd_8665 = info;
                        const _t8666 = ({ctor_arg_ty: __rec_upd_8665.ctor_arg_ty, ctor_existentials: __rec_upd_8665.ctor_existentials, ctor_num_params: __rec_upd_8665.ctor_num_params, ctor_return_ty_params: __rec_upd_8665.ctor_return_ty_params, ctor_type_name: qualified_name_8643});
                        const qual_info_8667 = _t8666;
                        const _t8668 = Ref$set(pub_constructors, ({_hd: [ctor_name, qual_info_8667], _tl: Ref$get(pub_constructors)}));
                        _t8663 = _t8668;
                        break _t8664;
                      }
                      if (_t8662._tag === 0) {
                        _t8663 = undefined;
                        break _t8664;
                      }
                      _match_fail("line 16933");
                    }
                    _t8649 = _t8663;
                    break _t8650;
                  }
                  if ((_t8648._tag === 1 || _t8648._tag === 2)) {
                    _t8649 = undefined;
                    break _t8650;
                  }
                  _match_fail("line 16933");
                }
                _t8646 = _t8649;
                break _t8647;
              }
              if (_t8645._tag === 2) {
                Ref$set(pub_types, ({_hd: qualified_name_8643, _tl: Ref$get(pub_types)}));
                Ref$set(opaque_types, ({_hd: qualified_name_8643, _tl: Ref$get(opaque_types)}));
                let _t8670;
                const _t8669 = def;
                _t8671: {
                  if (_t8669._tag === 3) {
                    _t8670 = Ref$set(newtypes, ({_hd: qualified_name_8643, _tl: Ref$get(newtypes)}));
                    break _t8671;
                  }
                  if (true) {
                    _t8670 = undefined;
                    break _t8671;
                  }
                  _match_fail("line 16933");
                }
                _t8646 = _t8670;
                break _t8647;
              }
              if (_t8645._tag === 1) {
                let _t8673;
                const _t8672 = def;
                _t8674: {
                  if (_t8672._tag === 3) {
                    _t8673 = Ref$set(newtypes, ({_hd: qualified_name_8643, _tl: Ref$get(newtypes)}));
                    break _t8674;
                  }
                  if (true) {
                    _t8673 = undefined;
                    break _t8674;
                  }
                  _match_fail("line 16933");
                }
                _t8646 = _t8673;
                break _t8647;
              }
              _match_fail("line 16933");
            }
            const _t8644 = _t8646;
            _t8641 = _t8644;
            break _t8642;
          }
          _match_fail("line 16933");
        }
        return _t8641;
      }
      List$iter(_t8639, type_defs);
      function _t8675(ctx, __p300) {
        let _t8677;
        const _t8676 = __p300;
        _t8678: {
          if (true) {
            const type_params = _t8676[0];
            const name = _t8676[1];
            const def = _t8676[2];
            const deriving_ = _t8676[3];
            function _t8679(ctx, cls) {
              let _t8681;
              const _t8680 = Typechecker$generate_derived_instance(type_params, name, def, cls);
              _t8682: {
                if (_t8680._tag === 1) {
                  const class_name = _t8680._val[0];
                  const inst_tys = _t8680._val[1];
                  const constraints = _t8680._val[2];
                  const methods = _t8680._val[3];
                  let _t8684;
                  const _t8683 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
                  _t8685: {
                    if (true) {
                      const ctx$p = _t8683[0];
                      const tdecl = _t8683[1];
                      Ref$set(typed_decls, ({_hd: tdecl, _tl: Ref$get(typed_decls)}));
                      Ref$set(all_instances, ctx$p.type_env.instances);
                      _t8684 = ctx$p;
                      break _t8685;
                    }
                    _match_fail("line 16933");
                  }
                  _t8681 = _t8684;
                  break _t8682;
                }
                if (_t8680._tag === 0) {
                  _t8681 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
                  break _t8682;
                }
                _match_fail("line 16933");
              }
              return _t8681;
            }
            _t8677 = List$fold(_t8679, ctx, deriving_);
            break _t8678;
          }
          _match_fail("line 16933");
        }
        return _t8677;
      }
      const sub_ctx$p_8686 = List$fold(_t8675, sub_ctx$p_8637, type_defs);
      function _t8688(__p301) {
        let _t8690;
        const _t8689 = __p301;
        _t8691: {
          if (true) {
            const _tp = _t8689[0];
            const name = _t8689[1];
            const def = _t8689[2];
            const _d = _t8689[3];
            _t8690 = ({_tag: 4, _name: "TDType", _val: [(prefix + name), def]});
            break _t8691;
          }
          _match_fail("line 16933");
        }
        return _t8690;
      }
      const type_decls_8692 = List$map(_t8688, type_defs);
      function push_all_but_last(__x) {
        while (true) {
          let _t8695;
          const _t8694 = __x;
          _t8696: {
            if (_t8694 === null) {
              _t8695 = failwith("empty DTypeAnd");
              break _t8696;
            }
            if (_t8694 !== null && _t8694._tl === null) {
              const last = _t8694._hd;
              _t8695 = last;
              break _t8696;
            }
            if (_t8694 !== null) {
              const hd = _t8694._hd;
              const tl = _t8694._tl;
              Ref$set(typed_decls, ({_hd: hd, _tl: Ref$get(typed_decls)}));
              const _t8697 = tl;
              __x = _t8697;
              continue;
              _t8695 = undefined;
              break _t8696;
            }
            _match_fail("line 16933");
          }
          return _t8695;
        }
      }
      const last_tdecl_8699 = push_all_but_last(type_decls_8692);
      const _t8700 = [sub_ctx$p_8686, last_tdecl_8699];
      const _t8698 = _t8700;
      const _t8693 = _t8698;
      const _t8687 = _t8693;
      const _t8638 = _t8687;
      const _t8627 = _t8638;
      const _t8616 = _t8627;
      _t8161 = _t8616;
      break _t8162;
    }
    _match_fail("line 16933");
  }
  const _t8159 = _t8161;
  return _t8159;
}
function Typechecker$process_open(ctx, mod_name, names_opt) {
  let _t8702;
  const _t8701 = Typechecker$find_module_in_env(ctx.type_env, mod_name);
  _t8703: {
    if (_t8701._tag === 1) {
      const m = _t8701._val;
      _t8702 = m;
      break _t8703;
    }
    if (_t8701._tag === 0) {
      _t8702 = Typechecker$error(("unknown module: " + __dict_Show_string.show(mod_name)));
      break _t8703;
    }
    _match_fail("line 16933");
  }
  const minfo_8704 = _t8702;
  function _t8706(qname) {
    function _t8707(c) {
      return (c.class_name === qname);
    }
    let _t8709;
    const _t8708 = List$find(_t8707, ctx.type_env.classes);
    _t8710: {
      if (_t8708._tag === 1) {
        const cls = _t8708._val;
        _t8709 = List$map(fst, cls.class_methods);
        break _t8710;
      }
      if (_t8708._tag === 0) {
        _t8709 = null;
        break _t8710;
      }
      _match_fail("line 16933");
    }
    return _t8709;
  }
  const class_method_names_8711 = List$concat_map(_t8706, minfo_8704.mod_pub_classes);
  const alias_pairs_8713 = Ref$create(null);
  function _t8715(name) {
    let _t8717;
    const _t8716 = names_opt;
    _t8718: {
      if (_t8716._tag === 0) {
        _t8717 = true;
        break _t8718;
      }
      if (_t8716._tag === 1) {
        const names = _t8716._val;
        _t8717 = List$mem(name, names);
        break _t8718;
      }
      _match_fail("line 16933");
    }
    return _t8717;
  }
  const filter_8719 = _t8715;
  function _t8721(__p302) {
    let _t8723;
    const _t8722 = __p302;
    _t8724: {
      if (true) {
        const _mml$short = _t8722[0];
        const _scheme = _t8722[1];
        let _t8725;
        if ((filter_8719(_mml$short) && (!List$mem(_mml$short, class_method_names_8711)))) {
          const qualified_8726 = (mod_name + ("." + _mml$short));
          const _t8727 = Ref$set(alias_pairs_8713, ({_hd: [_mml$short, qualified_8726], _tl: Ref$get(alias_pairs_8713)}));
          _t8725 = _t8727;
        } else {
          _t8725 = undefined;
        }
        _t8723 = _t8725;
        break _t8724;
      }
      _match_fail("line 16933");
    }
    return _t8723;
  }
  List$iter(_t8721, minfo_8704.mod_pub_vars);
  const ctx$p_8728 = Typechecker$open_module_into_ctx(ctx, mod_name, names_opt);
  const _t8729 = [ctx$p_8728, ({_tag: 10, _name: "TDOpen", _val: Ref$get(alias_pairs_8713)})];
  const _t8720 = _t8729;
  const _t8714 = _t8720;
  const _t8712 = _t8714;
  const _t8705 = _t8712;
  return _t8705;
}
function Typechecker$check_decl(ctx, level, decl) {
  let _t8731;
  const _t8730 = decl;
  _t8732: {
    if (_t8730._tag === 4) {
      const type_params = _t8730._val[0];
      const name = _t8730._val[1];
      const def = _t8730._val[2];
      const deriving_ = _t8730._val[3];
      const ctx$p_8733 = Typechecker$process_type_def(ctx, type_params, name, def);
      function _t8735(__p303, cls) {
        let _t8737;
        const _t8736 = __p303;
        _t8738: {
          if (true) {
            const ctx = _t8736[0];
            const acc = _t8736[1];
            let _t8740;
            const _t8739 = Typechecker$generate_derived_instance(type_params, name, def, cls);
            _t8741: {
              if (_t8739._tag === 1) {
                const class_name = _t8739._val[0];
                const inst_tys = _t8739._val[1];
                const constraints = _t8739._val[2];
                const methods = _t8739._val[3];
                let _t8743;
                const _t8742 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
                _t8744: {
                  if (true) {
                    const ctx$p = _t8742[0];
                    const tdecl = _t8742[1];
                    _t8743 = [ctx$p, ({_hd: tdecl, _tl: acc})];
                    break _t8744;
                  }
                  _match_fail("line 16933");
                }
                _t8740 = _t8743;
                break _t8741;
              }
              if (_t8739._tag === 0) {
                _t8740 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
                break _t8741;
              }
              _match_fail("line 16933");
            }
            _t8737 = _t8740;
            break _t8738;
          }
          _match_fail("line 16933");
        }
        return _t8737;
      }
      let _t8746;
      const _t8745 = List$fold(_t8735, [ctx$p_8733, null], deriving_);
      _t8747: {
        if (true) {
          const ctx$p = _t8745[0];
          const derived_tdecls = _t8745[1];
          _t8746 = [ctx$p, ({_hd: ({_tag: 4, _name: "TDType", _val: [name, def]}), _tl: List$rev(derived_tdecls)})];
          break _t8747;
        }
        _match_fail("line 16933");
      }
      const _t8734 = _t8746;
      _t8731 = _t8734;
      break _t8732;
    }
    if (_t8730._tag === 0) {
      const name = _t8730._val[0];
      const params = _t8730._val[1];
      const ret_annot = _t8730._val[2];
      const constraints = _t8730._val[3];
      const body = _t8730._val[4];
      let _t8748;
      if (!_eq(constraints, null)) {
        let _t8750;
        const _t8749 = Typechecker$synth_constrained_fn(ctx, level, constraints, params, ret_annot, body);
        _t8751: {
          if (true) {
            const te = _t8749[0];
            const scheme = _t8749[1];
            const ctx$p_8752 = Typechecker$extend_var(ctx, name, scheme);
            const _t8753 = [ctx$p_8752, ({_hd: ({_tag: 0, _name: "TDLet", _val: [name, te]}), _tl: null})];
            _t8750 = _t8753;
            break _t8751;
          }
          _match_fail("line 16933");
        }
        _t8748 = _t8750;
      } else {
        const eff_8754 = Types$new_effvar(level);
        const __rec_upd_8756 = ctx;
        const _t8757 = ({constraint_tvars: __rec_upd_8756.constraint_tvars, current_eff: eff_8754, current_module: __rec_upd_8756.current_module, inside_handler: __rec_upd_8756.inside_handler, loop_info: __rec_upd_8756.loop_info, mutable_vars: __rec_upd_8756.mutable_vars, return_type: __rec_upd_8756.return_type, return_used: __rec_upd_8756.return_used, type_env: __rec_upd_8756.type_env, vars: __rec_upd_8756.vars});
        const eff_ctx_8758 = _t8757;
        const full_body_8760 = Typechecker$wrap_params_decl(params, ret_annot, body);
        const te_8762 = Typechecker$synth(eff_ctx_8758, (level + 1), full_body_8760);
        Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, te_8762);
        let _t8764;
        if ((_eq(params, null) && (!Typechecker$is_syntactic_value(body)))) {
          _t8764 = Typechecker$mono_scheme(te_8762.ty);
        } else {
          _t8764 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, te_8762.ty, Hashtbl$create(0));
        }
        const scheme_8765 = _t8764;
        const scheme_8767 = Typechecker$infer_implicit_constraints("", ctx.type_env, ctx.vars, te_8762, scheme_8765);
        const scheme_8769 = Typechecker$infer_record_evidence(ctx.vars, te_8762, scheme_8767);
        const ctx$p_8771 = Typechecker$extend_var(ctx, name, scheme_8769);
        const _t8772 = [ctx$p_8771, ({_hd: ({_tag: 0, _name: "TDLet", _val: [name, te_8762]}), _tl: null})];
        const _t8770 = _t8772;
        const _t8768 = _t8770;
        const _t8766 = _t8768;
        const _t8763 = _t8766;
        const _t8761 = _t8763;
        const _t8759 = _t8761;
        const _t8755 = _t8759;
        _t8748 = _t8755;
      }
      _t8731 = _t8748;
      break _t8732;
    }
    if (_t8730._tag === 1) {
      const name = _t8730._val[0];
      const body = _t8730._val[1];
      const eff_8773 = Types$new_effvar(level);
      const __rec_upd_8775 = ctx;
      const _t8776 = ({constraint_tvars: __rec_upd_8775.constraint_tvars, current_eff: eff_8773, current_module: __rec_upd_8775.current_module, inside_handler: __rec_upd_8775.inside_handler, loop_info: __rec_upd_8775.loop_info, mutable_vars: __rec_upd_8775.mutable_vars, return_type: __rec_upd_8775.return_type, return_used: __rec_upd_8775.return_used, type_env: __rec_upd_8775.type_env, vars: __rec_upd_8775.vars});
      const eff_ctx_8777 = _t8776;
      const te_8779 = Typechecker$synth(eff_ctx_8777, (level + 1), body);
      const scheme_8781 = Typechecker$mono_scheme(te_8779.ty);
      const ctx$p_8783 = Typechecker$extend_var_mutable(ctx, name, scheme_8781);
      const _t8784 = [ctx$p_8783, ({_hd: ({_tag: 1, _name: "TDLetMut", _val: [name, te_8779]}), _tl: null})];
      const _t8782 = _t8784;
      const _t8780 = _t8782;
      const _t8778 = _t8780;
      const _t8774 = _t8778;
      _t8731 = _t8774;
      break _t8732;
    }
    if (_t8730._tag === 2) {
      const name = _t8730._val[0];
      const type_params = _t8730._val[1];
      const params = _t8730._val[2];
      const ret_annot = _t8730._val[3];
      const constraints = _t8730._val[4];
      const body = _t8730._val[5];
      let _t8785;
      if (!_eq(type_params, null)) {
        let _t8787;
        const _t8786 = Typechecker$synth_poly_rec_fn(ctx, level, name, "", type_params, params, ret_annot, body);
        _t8788: {
          if (true) {
            const te = _t8786[0];
            const scheme = _t8786[1];
            const ctx$p_8789 = Typechecker$extend_var(ctx, name, scheme);
            const _t8790 = [ctx$p_8789, ({_hd: ({_tag: 2, _name: "TDLetRec", _val: [name, te]}), _tl: null})];
            _t8787 = _t8790;
            break _t8788;
          }
          _match_fail("line 16933");
        }
        _t8785 = _t8787;
      } else {
        let _t8791;
        if (!_eq(constraints, null)) {
          const fn_var_8792 = Types$new_tvar((level + 1));
          const ctx_with_self_8794 = Typechecker$extend_var_mono(ctx, name, fn_var_8792);
          let _t8797;
          const _t8796 = Typechecker$synth_constrained_fn(ctx_with_self_8794, level, constraints, params, ret_annot, body);
          _t8798: {
            if (true) {
              const te = _t8796[0];
              const scheme = _t8796[1];
              Typechecker$try_unify(fn_var_8792, te.ty);
              const ctx$p_8799 = Typechecker$extend_var(ctx, name, scheme);
              const _t8800 = [ctx$p_8799, ({_hd: ({_tag: 2, _name: "TDLetRec", _val: [name, te]}), _tl: null})];
              _t8797 = _t8800;
              break _t8798;
            }
            _match_fail("line 16933");
          }
          const _t8795 = _t8797;
          const _t8793 = _t8795;
          _t8791 = _t8793;
        } else {
          let _t8801;
          if (_eq(params, null)) {
            let _t8803;
            const _t8802 = Typechecker$strip_loc(body);
            _t8804: {
              if ((_t8802._tag === 10 || _t8802._tag === 30 && _t8802._val[0]._tag === 10)) {
                _t8803 = undefined;
                break _t8804;
              }
              if (true) {
                if ((Typechecker$is_constructive(body) && (!Typechecker$is_immediately_linked(name, body)))) {
                  _t8803 = undefined;
                  break _t8804;
                }
              }
              if (true) {
                _t8803 = Typechecker$error("let rec binding must be a function or constructive expression");
                break _t8804;
              }
              _match_fail("line 16933");
            }
            _t8801 = _t8803;
          } else {
            _t8801 = undefined;
          }
          _t8801;
          const eff_8805 = Types$new_effvar(level);
          const __rec_upd_8807 = ctx;
          const _t8808 = ({constraint_tvars: __rec_upd_8807.constraint_tvars, current_eff: eff_8805, current_module: __rec_upd_8807.current_module, inside_handler: __rec_upd_8807.inside_handler, loop_info: __rec_upd_8807.loop_info, mutable_vars: __rec_upd_8807.mutable_vars, return_type: __rec_upd_8807.return_type, return_used: __rec_upd_8807.return_used, type_env: __rec_upd_8807.type_env, vars: __rec_upd_8807.vars});
          const eff_ctx_8809 = _t8808;
          const full_body_8811 = Typechecker$wrap_params_decl(params, ret_annot, body);
          const fn_var_8813 = Types$new_tvar((level + 1));
          const ctx$p_8815 = Typechecker$extend_var_mono(eff_ctx_8809, name, fn_var_8813);
          const fn_te_8817 = Typechecker$synth(ctx$p_8815, (level + 1), full_body_8811);
          Typechecker$try_unify(fn_var_8813, fn_te_8817.ty);
          Typechecker$improve_fundeps_in_expr(ctx.vars, ctx.type_env, fn_te_8817);
          const scheme_8819 = Typechecker$resolve_let_constraints(Types$empty_type_env, level, null, params, ret_annot, fn_te_8817.ty, Hashtbl$create(0));
          const scheme_8821 = Typechecker$infer_implicit_constraints(name, ctx.type_env, ctx.vars, fn_te_8817, scheme_8819);
          const scheme_8823 = Typechecker$infer_record_evidence(ctx.vars, fn_te_8817, scheme_8821);
          const ctx$p$p_8825 = Typechecker$extend_var(ctx, name, scheme_8823);
          const _t8826 = [ctx$p$p_8825, ({_hd: ({_tag: 2, _name: "TDLetRec", _val: [name, fn_te_8817]}), _tl: null})];
          const _t8824 = _t8826;
          const _t8822 = _t8824;
          const _t8820 = _t8822;
          const _t8818 = _t8820;
          const _t8816 = _t8818;
          const _t8814 = _t8816;
          const _t8812 = _t8814;
          const _t8810 = _t8812;
          const _t8806 = _t8810;
          _t8791 = _t8806;
        }
        _t8785 = _t8791;
      }
      _t8731 = _t8785;
      break _t8732;
    }
    if (_t8730._tag === 6) {
      const expr = _t8730._val;
      const eff_8827 = Types$new_effvar(level);
      const __rec_upd_8829 = ctx;
      const _t8830 = ({constraint_tvars: __rec_upd_8829.constraint_tvars, current_eff: eff_8827, current_module: __rec_upd_8829.current_module, inside_handler: __rec_upd_8829.inside_handler, loop_info: __rec_upd_8829.loop_info, mutable_vars: __rec_upd_8829.mutable_vars, return_type: __rec_upd_8829.return_type, return_used: __rec_upd_8829.return_used, type_env: __rec_upd_8829.type_env, vars: __rec_upd_8829.vars});
      const ctx$p_8831 = _t8830;
      const te_8833 = Typechecker$synth(ctx$p_8831, level, expr);
      const _t8835 = (function() {
        const _t8836 = _h;
        _h = Object.assign({}, _t8836, {
          "unify_error": function(_, __k_try) { throw {_e: "unify_error", _v: _}; },
        });
        try {
          const __x_8837 = Types$unify_eff(Types$eff_repr(eff_8827), ({_tag: 1, _name: "EffEmpty"}));
          return __x_8837;
        } catch (_exc) {
          if (_exc && _exc._e === "unify_error") {
            const _ = _exc._v;
            return Typechecker$error(("expression has unhandled effects: " + __dict_Show_string.show(Types$pp_eff(eff_8827))));
          } else { throw _exc; }
        } finally { _h = _t8836; }
      })();
      _t8835;
      const _t8834 = [ctx, ({_hd: ({_tag: 5, _name: "TDExpr", _val: te_8833}), _tl: null})];
      const _t8832 = _t8834;
      const _t8828 = _t8832;
      _t8731 = _t8828;
      break _t8732;
    }
    if (_t8730._tag === 7) {
      const name = _t8730._val[0];
      const tyvars = _t8730._val[1];
      const fundeps = _t8730._val[2];
      const methods = _t8730._val[3];
      let _t8839;
      const _t8838 = Typechecker$process_class_def(ctx, name, tyvars, fundeps, methods);
      _t8840: {
        if (true) {
          const ctx$p = _t8838[0];
          const td = _t8838[1];
          _t8839 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8840;
        }
        _match_fail("line 16933");
      }
      _t8731 = _t8839;
      break _t8732;
    }
    if (_t8730._tag === 8) {
      const class_name = _t8730._val[0];
      const inst_ty_annots = _t8730._val[1];
      const constraints = _t8730._val[2];
      const methods = _t8730._val[3];
      let _t8842;
      const _t8841 = Typechecker$process_instance_def(ctx, level, class_name, inst_ty_annots, constraints, methods);
      _t8843: {
        if (true) {
          const ctx$p = _t8841[0];
          const td = _t8841[1];
          _t8842 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8843;
        }
        _match_fail("line 16933");
      }
      _t8731 = _t8842;
      break _t8732;
    }
    if (_t8730._tag === 9) {
      const name = _t8730._val[0];
      const type_params = _t8730._val[1];
      const ops = _t8730._val[2];
      const tvars_8844 = Hashtbl$create(4);
      function _t8846(i, p) {
        return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tvars_8844, p, ({_tag: 16, _name: "TGen", _val: i})]);
      }
      List$iteri(_t8846, type_params);
      function _t8847(__p304) {
        let _t8849;
        const _t8848 = __p304;
        _t8850: {
          if (true) {
            const op_name = _t8848[0];
            const annot = _t8848[1];
            const ty_8851 = Typechecker$resolve_ty_annot_shared(ctx, 0, tvars_8844, annot);
            const _t8852 = [op_name, ty_8851];
            _t8849 = _t8852;
            break _t8850;
          }
          _match_fail("line 16933");
        }
        return _t8849;
      }
      const resolved_ops_8853 = List$map(_t8847, ops);
      const effect_def_8855 = ({effect_name: name, effect_ops: resolved_ops_8853, effect_params: type_params});
      const __rec_upd_8857 = ctx.type_env;
      const _t8858 = ({classes: __rec_upd_8857.classes, constructors: __rec_upd_8857.constructors, effects: ({_hd: effect_def_8855, _tl: ctx.type_env.effects}), hidden_ctor_types: __rec_upd_8857.hidden_ctor_types, hidden_types: __rec_upd_8857.hidden_types, instances: __rec_upd_8857.instances, modules: __rec_upd_8857.modules, mutable_fields: __rec_upd_8857.mutable_fields, newtypes: __rec_upd_8857.newtypes, records: __rec_upd_8857.records, type_aliases: __rec_upd_8857.type_aliases, type_synonyms: __rec_upd_8857.type_synonyms, variants: __rec_upd_8857.variants});
      const type_env_8859 = _t8858;
      const __rec_upd_8861 = ctx;
      const _t8862 = ({constraint_tvars: __rec_upd_8861.constraint_tvars, current_eff: __rec_upd_8861.current_eff, current_module: __rec_upd_8861.current_module, inside_handler: __rec_upd_8861.inside_handler, loop_info: __rec_upd_8861.loop_info, mutable_vars: __rec_upd_8861.mutable_vars, return_type: __rec_upd_8861.return_type, return_used: __rec_upd_8861.return_used, type_env: type_env_8859, vars: __rec_upd_8861.vars});
      const ctx_8863 = _t8862;
      const _t8864 = [ctx_8863, ({_hd: ({_tag: 7, _name: "TDEffect", _val: name}), _tl: null})];
      const _t8860 = _t8864;
      const _t8856 = _t8860;
      const _t8854 = _t8856;
      const _t8845 = _t8854;
      _t8731 = _t8845;
      break _t8732;
    }
    if (_t8730._tag === 10) {
      const name = _t8730._val[0];
      const ty_annot = _t8730._val[1];
      const tvars_8865 = Hashtbl$create(4);
      const ty_8867 = Typechecker$resolve_ty_annot_shared(ctx, 1, tvars_8865, ty_annot);
      const scheme_8869 = Types$generalize(0, ty_8867);
      const ctx_8871 = Typechecker$extend_var(ctx, name, scheme_8869);
      const _t8872 = [ctx_8871, ({_hd: ({_tag: 8, _name: "TDExtern", _val: [name, scheme_8869]}), _tl: null})];
      const _t8870 = _t8872;
      const _t8868 = _t8870;
      const _t8866 = _t8868;
      _t8731 = _t8866;
      break _t8732;
    }
    if (_t8730._tag === 11) {
      const name = _t8730._val[0];
      const items = _t8730._val[1];
      let _t8874;
      const _t8873 = Typechecker$process_module_def(ctx, level, name, items);
      _t8875: {
        if (true) {
          const ctx$p = _t8873[0];
          const td = _t8873[1];
          _t8874 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8875;
        }
        _match_fail("line 16933");
      }
      _t8731 = _t8874;
      break _t8732;
    }
    if (_t8730._tag === 12) {
      const mod_name = _t8730._val[0];
      const names_opt = _t8730._val[1];
      let _t8877;
      const _t8876 = Typechecker$process_open(ctx, mod_name, names_opt);
      _t8878: {
        if (true) {
          const ctx$p = _t8876[0];
          const td = _t8876[1];
          _t8877 = [ctx$p, ({_hd: td, _tl: null})];
          break _t8878;
        }
        _match_fail("line 16933");
      }
      _t8731 = _t8877;
      break _t8732;
    }
    if (_t8730._tag === 3) {
      const bindings = _t8730._val;
      function _t8879(__p305) {
        let _t8881;
        const _t8880 = __p305;
        _t8882: {
          if (true) {
            const tp = _t8880[1];
            _t8881 = !_eq(tp, null);
            break _t8882;
          }
          _match_fail("line 16933");
        }
        return _t8881;
      }
      const has_poly_8883 = List$exists(_t8879, bindings);
      let _t8885;
      if (has_poly_8883) {
        function _t8886(__p306) {
          let _t8888;
          const _t8887 = __p306;
          _t8889: {
            if (true) {
              const type_params = _t8887[1];
              const params = _t8887[2];
              const ret_annot = _t8887[3];
              const shared_tvars_8890 = Hashtbl$create(4);
              function _t8892(tp) {
                return _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, shared_tvars_8890, tp, Types$new_tvar((level + 1))]);
              }
              List$iter(_t8892, type_params);
              function _t8893(p) {
                let _t8895;
                const _t8894 = p.annot;
                _t8896: {
                  if (_t8894._tag === 1) {
                    const annot = _t8894._val;
                    _t8895 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_8890, annot);
                    break _t8896;
                  }
                  if (_t8894._tag === 0) {
                    _t8895 = Types$new_tvar((level + 1));
                    break _t8896;
                  }
                  _match_fail("line 16933");
                }
                return _t8895;
              }
              const param_tys_8897 = List$map(_t8893, params);
              let _t8900;
              const _t8899 = ret_annot;
              _t8901: {
                if (_t8899._tag === 1 && _t8899._val._tag === 10) {
                  const ty = _t8899._val._val[0];
                  const eff_annot = _t8899._val._val[1];
                  const ty$p_8902 = Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_8890, ty);
                  let _t8905;
                  const _t8904 = eff_annot;
                  _t8906: {
                    if (_t8904._tag === 0) {
                      _t8905 = ({_tag: 1, _name: "EffEmpty"});
                      break _t8906;
                    }
                    if (_t8904._tag === 1) {
                      const items = _t8904._val;
                      _t8905 = Typechecker$resolve_eff_items(ctx, (level + 1), shared_tvars_8890, items);
                      break _t8906;
                    }
                    _match_fail("line 16933");
                  }
                  const eff_8907 = _t8905;
                  const _t8908 = [ty$p_8902, eff_8907];
                  const _t8903 = _t8908;
                  _t8900 = _t8903;
                  break _t8901;
                }
                if (_t8899._tag === 1) {
                  const annot = _t8899._val;
                  _t8900 = [Typechecker$resolve_ty_annot_shared(ctx, (level + 1), shared_tvars_8890, annot), Types$new_effvar((level + 1))];
                  break _t8901;
                }
                if (_t8899._tag === 0) {
                  _t8900 = [Types$new_tvar((level + 1)), Types$new_effvar((level + 1))];
                  break _t8901;
                }
                _match_fail("line 16933");
              }
              let _t8910;
              const _t8909 = _t8900;
              _t8911: {
                if (true) {
                  const ret_ty = _t8909[0];
                  const body_eff = _t8909[1];
                  let _t8913;
                  const _t8912 = List$rev(param_tys_8897);
                  _t8914: {
                    if (_t8912 === null) {
                      _t8913 = ret_ty;
                      break _t8914;
                    }
                    if (_t8912 !== null) {
                      const last = _t8912._hd;
                      const rest = _t8912._tl;
                      const inner_8915 = ({_tag: 7, _name: "TArrow", _val: [last, body_eff, ret_ty]});
                      function _t8917(acc, pty) {
                        return ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc]});
                      }
                      const _t8916 = List$fold(_t8917, inner_8915, rest);
                      _t8913 = _t8916;
                      break _t8914;
                    }
                    _match_fail("line 16933");
                  }
                  const fn_ty_8918 = _t8913;
                  const _t8919 = [shared_tvars_8890, param_tys_8897, ret_ty, body_eff, fn_ty_8918];
                  _t8910 = _t8919;
                  break _t8911;
                }
                _match_fail("line 16933");
              }
              const _t8898 = _t8910;
              const _t8891 = _t8898;
              _t8888 = _t8891;
              break _t8889;
            }
            _match_fail("line 16933");
          }
          return _t8888;
        }
        const shared_tvars_list_8920 = List$map(_t8886, bindings);
        function _t8922(__p307) {
          let _t8924;
          const _t8923 = __p307;
          _t8925: {
            if (true) {
              const fn_ty = _t8923[4];
              _t8924 = Types$generalize(level, fn_ty);
              break _t8925;
            }
            _match_fail("line 16933");
          }
          return _t8924;
        }
        const schemes_8926 = List$map(_t8922, shared_tvars_list_8920);
        function _t8928(ctx, __p308, scheme) {
          let _t8930;
          const _t8929 = __p308;
          _t8931: {
            if (true) {
              const name = _t8929[0];
              _t8930 = Typechecker$extend_var(ctx, name, scheme);
              break _t8931;
            }
            _match_fail("line 16933");
          }
          return _t8930;
        }
        const ctx$p_8932 = List$fold2(_t8928, ctx, bindings, schemes_8926);
        function _t8934(__p309, __p310) {
          let _t8936;
          const _t8935 = __p309;
          _t8937: {
            if (true) {
              const params = _t8935[2];
              const body = _t8935[5];
              let _t8939;
              const _t8938 = __p310;
              _t8940: {
                if (true) {
                  const param_tys = _t8938[1];
                  const ret_ty = _t8938[2];
                  const body_eff = _t8938[3];
                  function _t8941(c, p, ty) {
                    return Typechecker$extend_var_mono(c, p.name, ty);
                  }
                  const __rec_upd_8942 = ctx$p_8932;
                  const _t8943 = ({constraint_tvars: __rec_upd_8942.constraint_tvars, current_eff: body_eff, current_module: __rec_upd_8942.current_module, inside_handler: __rec_upd_8942.inside_handler, loop_info: __rec_upd_8942.loop_info, mutable_vars: __rec_upd_8942.mutable_vars, return_type: __rec_upd_8942.return_type, return_used: __rec_upd_8942.return_used, type_env: __rec_upd_8942.type_env, vars: __rec_upd_8942.vars});
                  const inner_ctx_8944 = List$fold2(_t8941, _t8943, params, param_tys);
                  const body_te_8946 = Typechecker$check(inner_ctx_8944, (level + 1), body, ret_ty);
                  let _t8949;
                  const _t8948 = [List$rev(params), List$rev(param_tys)];
                  _t8950: {
                    if (_t8948[0] === null && _t8948[1] === null) {
                      _t8949 = body_te_8946;
                      break _t8950;
                    }
                    if (_t8948[0] !== null && _t8948[1] !== null) {
                      const last_p = _t8948[0]._hd;
                      const rest_ps = _t8948[0]._tl;
                      const last_pty = _t8948[1]._hd;
                      const rest_ptys = _t8948[1]._tl;
                      const inner_8951 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [last_p.name, body_te_8946, false]}), ({_tag: 7, _name: "TArrow", _val: [last_pty, body_eff, body_te_8946.ty]}));
                      function _t8953(acc, p, pty) {
                        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p.name, acc, false]}), ({_tag: 7, _name: "TArrow", _val: [pty, ({_tag: 1, _name: "EffEmpty"}), acc.ty]}));
                      }
                      const _t8952 = List$fold2(_t8953, inner_8951, rest_ps, rest_ptys);
                      _t8949 = _t8952;
                      break _t8950;
                    }
                    if (true) {
                      _t8949 = failwith("assert false");
                      break _t8950;
                    }
                    _match_fail("line 16933");
                  }
                  const _t8947 = _t8949;
                  const _t8945 = _t8947;
                  _t8939 = _t8945;
                  break _t8940;
                }
                _match_fail("line 16933");
              }
              _t8936 = _t8939;
              break _t8937;
            }
            _match_fail("line 16933");
          }
          return _t8936;
        }
        const body_tes_8954 = List$map2(_t8934, bindings, shared_tvars_list_8920);
        function _t8956(ctx, __p311, scheme) {
          let _t8958;
          const _t8957 = __p311;
          _t8959: {
            if (true) {
              const name = _t8957[0];
              _t8958 = Typechecker$extend_var(ctx, name, scheme);
              break _t8959;
            }
            _match_fail("line 16933");
          }
          return _t8958;
        }
        const ctx$p$p_8960 = List$fold2(_t8956, ctx, bindings, schemes_8926);
        function _t8962(__p312, te) {
          let _t8964;
          const _t8963 = __p312;
          _t8965: {
            if (true) {
              const name = _t8963[0];
              _t8964 = [name, te];
              break _t8965;
            }
            _match_fail("line 16933");
          }
          return _t8964;
        }
        const typed_bindings_8966 = List$map2(_t8962, bindings, body_tes_8954);
        const _t8967 = [ctx$p$p_8960, ({_hd: ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_8966}), _tl: null})];
        const _t8961 = _t8967;
        const _t8955 = _t8961;
        const _t8933 = _t8955;
        const _t8927 = _t8933;
        const _t8921 = _t8927;
        _t8885 = _t8921;
      } else {
        function _t8968(__p313) {
          let _t8970;
          const _t8969 = __p313;
          _t8971: {
            if (true) {
              const name = _t8969[0];
              const params = _t8969[2];
              const body = _t8969[5];
              let _t8972;
              if (_eq(params, null)) {
                let _t8974;
                const _t8973 = Typechecker$strip_loc(body);
                _t8975: {
                  if ((_t8973._tag === 10 || _t8973._tag === 30 && _t8973._val[0]._tag === 10)) {
                    _t8974 = undefined;
                    break _t8975;
                  }
                  if (true) {
                    if ((Typechecker$is_constructive(body) && (!Typechecker$is_immediately_linked(name, body)))) {
                      _t8974 = undefined;
                      break _t8975;
                    }
                  }
                  if (true) {
                    _t8974 = Typechecker$error((("let rec binding for '" + __dict_Show_string.show(name)) + "' must be a function or constructive expression"));
                    break _t8975;
                  }
                  _match_fail("line 16933");
                }
                _t8972 = _t8974;
              } else {
                _t8972 = undefined;
              }
              _t8970 = _t8972;
              break _t8971;
            }
            _match_fail("line 16933");
          }
          return _t8970;
        }
        List$iter(_t8968, bindings);
        function _t8976(__p314) {
          let _t8978;
          const _t8977 = __p314;
          _t8979: {
            if (true) {
              const name = _t8977[0];
              _t8978 = [name, Types$new_tvar((level + 1))];
              break _t8979;
            }
            _match_fail("line 16933");
          }
          return _t8978;
        }
        const fn_vars_8980 = List$map(_t8976, bindings);
        function _t8982(ctx, __p315) {
          let _t8984;
          const _t8983 = __p315;
          _t8985: {
            if (true) {
              const name = _t8983[0];
              const tv = _t8983[1];
              _t8984 = Typechecker$extend_var_mono(ctx, name, tv);
              break _t8985;
            }
            _match_fail("line 16933");
          }
          return _t8984;
        }
        const ctx$p_8986 = List$fold(_t8982, ctx, fn_vars_8980);
        function _t8988(__p316, __p317) {
          let _t8990;
          const _t8989 = __p316;
          _t8991: {
            if (true) {
              const name = _t8989[0];
              const params = _t8989[2];
              const ret_annot = _t8989[3];
              const constraints = _t8989[4];
              const body = _t8989[5];
              let _t8993;
              const _t8992 = __p317;
              _t8994: {
                if (true) {
                  const tv = _t8992[1];
                  name;
                  undefined;
                  let _t8995;
                  if (!_eq(constraints, null)) {
                    let _t8997;
                    const _t8996 = Typechecker$synth_constrained_fn(ctx$p_8986, level, constraints, params, ret_annot, body);
                    _t8998: {
                      if (true) {
                        const te = _t8996[0];
                        const _scheme = _t8996[1];
                        Typechecker$try_unify(tv, te.ty);
                        _t8997 = te;
                        break _t8998;
                      }
                      _match_fail("line 16933");
                    }
                    _t8995 = _t8997;
                  } else {
                    const full_body_8999 = Typechecker$wrap_params_decl(params, ret_annot, body);
                    const te_9001 = Typechecker$synth(ctx$p_8986, (level + 1), full_body_8999);
                    Typechecker$try_unify(tv, te_9001.ty);
                    const _t9002 = te_9001;
                    const _t9000 = _t9002;
                    _t8995 = _t9000;
                  }
                  _t8993 = _t8995;
                  break _t8994;
                }
                _match_fail("line 16933");
              }
              _t8990 = _t8993;
              break _t8991;
            }
            _match_fail("line 16933");
          }
          return _t8990;
        }
        const body_tes_9003 = List$map2(_t8988, bindings, fn_vars_8980);
        function _t9005(ctx, __p318, __p319) {
          let _t9007;
          const _t9006 = __p318;
          _t9008: {
            if (true) {
              const name = _t9006[0];
              let _t9010;
              const _t9009 = __p319;
              _t9011: {
                if (true) {
                  const tv = _t9009[1];
                  const scheme_9012 = Types$generalize(level, tv);
                  const _t9013 = Typechecker$extend_var(ctx, name, scheme_9012);
                  _t9010 = _t9013;
                  break _t9011;
                }
                _match_fail("line 16933");
              }
              _t9007 = _t9010;
              break _t9008;
            }
            _match_fail("line 16933");
          }
          return _t9007;
        }
        const ctx$p$p_9014 = List$fold2(_t9005, ctx, bindings, fn_vars_8980);
        function _t9016(__p320, te) {
          let _t9018;
          const _t9017 = __p320;
          _t9019: {
            if (true) {
              const name = _t9017[0];
              _t9018 = [name, te];
              break _t9019;
            }
            _match_fail("line 16933");
          }
          return _t9018;
        }
        const typed_bindings_9020 = List$map2(_t9016, bindings, body_tes_9003);
        const _t9021 = [ctx$p$p_9014, ({_hd: ({_tag: 3, _name: "TDLetRecAnd", _val: typed_bindings_9020}), _tl: null})];
        const _t9015 = _t9021;
        const _t9004 = _t9015;
        const _t8987 = _t9004;
        const _t8981 = _t8987;
        _t8885 = _t8981;
      }
      const _t8884 = _t8885;
      _t8731 = _t8884;
      break _t8732;
    }
    if (_t8730._tag === 5) {
      const type_defs = _t8730._val;
      function _t9022(ctx, __p321) {
        let _t9024;
        const _t9023 = __p321;
        _t9025: {
          if (true) {
            const type_params = _t9023[0];
            const name = _t9023[1];
            const def = _t9023[2];
            const _deriving = _t9023[3];
            const num_params_9026 = List$length(type_params);
            let _t9029;
            const _t9028 = def;
            _t9030: {
              if (_t9028._tag === 0) {
                const __rec_upd_9031 = ctx.type_env;
                const _t9032 = ({classes: __rec_upd_9031.classes, constructors: __rec_upd_9031.constructors, effects: __rec_upd_9031.effects, hidden_ctor_types: __rec_upd_9031.hidden_ctor_types, hidden_types: __rec_upd_9031.hidden_types, instances: __rec_upd_9031.instances, modules: __rec_upd_9031.modules, mutable_fields: __rec_upd_9031.mutable_fields, newtypes: __rec_upd_9031.newtypes, records: __rec_upd_9031.records, type_aliases: __rec_upd_9031.type_aliases, type_synonyms: __rec_upd_9031.type_synonyms, variants: ({_hd: [name, num_params_9026, null, false], _tl: ctx.type_env.variants})});
                const type_env_9033 = _t9032;
                const __rec_upd_9035 = ctx;
                const _t9036 = ({constraint_tvars: __rec_upd_9035.constraint_tvars, current_eff: __rec_upd_9035.current_eff, current_module: __rec_upd_9035.current_module, inside_handler: __rec_upd_9035.inside_handler, loop_info: __rec_upd_9035.loop_info, mutable_vars: __rec_upd_9035.mutable_vars, return_type: __rec_upd_9035.return_type, return_used: __rec_upd_9035.return_used, type_env: type_env_9033, vars: __rec_upd_9035.vars});
                const _t9034 = _t9036;
                _t9029 = _t9034;
                break _t9030;
              }
              if (_t9028._tag === 1) {
                const __rec_upd_9037 = ctx.type_env;
                const _t9038 = ({classes: __rec_upd_9037.classes, constructors: __rec_upd_9037.constructors, effects: __rec_upd_9037.effects, hidden_ctor_types: __rec_upd_9037.hidden_ctor_types, hidden_types: __rec_upd_9037.hidden_types, instances: __rec_upd_9037.instances, modules: __rec_upd_9037.modules, mutable_fields: __rec_upd_9037.mutable_fields, newtypes: __rec_upd_9037.newtypes, records: ({_hd: [name, null], _tl: ctx.type_env.records}), type_aliases: __rec_upd_9037.type_aliases, type_synonyms: __rec_upd_9037.type_synonyms, variants: __rec_upd_9037.variants});
                const type_env_9039 = _t9038;
                const __rec_upd_9041 = ctx;
                const _t9042 = ({constraint_tvars: __rec_upd_9041.constraint_tvars, current_eff: __rec_upd_9041.current_eff, current_module: __rec_upd_9041.current_module, inside_handler: __rec_upd_9041.inside_handler, loop_info: __rec_upd_9041.loop_info, mutable_vars: __rec_upd_9041.mutable_vars, return_type: __rec_upd_9041.return_type, return_used: __rec_upd_9041.return_used, type_env: type_env_9039, vars: __rec_upd_9041.vars});
                const _t9040 = _t9042;
                _t9029 = _t9040;
                break _t9030;
              }
              if (_t9028._tag === 2) {
                _t9029 = ctx;
                break _t9030;
              }
              if (_t9028._tag === 3) {
                const __rec_upd_9043 = ctx.type_env;
                const _t9044 = ({classes: __rec_upd_9043.classes, constructors: __rec_upd_9043.constructors, effects: __rec_upd_9043.effects, hidden_ctor_types: __rec_upd_9043.hidden_ctor_types, hidden_types: __rec_upd_9043.hidden_types, instances: __rec_upd_9043.instances, modules: __rec_upd_9043.modules, mutable_fields: __rec_upd_9043.mutable_fields, newtypes: __rec_upd_9043.newtypes, records: __rec_upd_9043.records, type_aliases: __rec_upd_9043.type_aliases, type_synonyms: __rec_upd_9043.type_synonyms, variants: ({_hd: [name, num_params_9026, null, false], _tl: ctx.type_env.variants})});
                const type_env_9045 = _t9044;
                const __rec_upd_9047 = ctx;
                const _t9048 = ({constraint_tvars: __rec_upd_9047.constraint_tvars, current_eff: __rec_upd_9047.current_eff, current_module: __rec_upd_9047.current_module, inside_handler: __rec_upd_9047.inside_handler, loop_info: __rec_upd_9047.loop_info, mutable_vars: __rec_upd_9047.mutable_vars, return_type: __rec_upd_9047.return_type, return_used: __rec_upd_9047.return_used, type_env: type_env_9045, vars: __rec_upd_9047.vars});
                const _t9046 = _t9048;
                _t9029 = _t9046;
                break _t9030;
              }
              _match_fail("line 16933");
            }
            const _t9027 = _t9029;
            _t9024 = _t9027;
            break _t9025;
          }
          _match_fail("line 16933");
        }
        return _t9024;
      }
      const ctx$p_9049 = List$fold(_t9022, ctx, type_defs);
      function _t9051(ctx, __p322) {
        let _t9053;
        const _t9052 = __p322;
        _t9054: {
          if (true) {
            const type_params = _t9052[0];
            const name = _t9052[1];
            const def = _t9052[2];
            const _deriving = _t9052[3];
            let _t9056;
            const _t9055 = def;
            _t9057: {
              if (_t9055._tag === 1) {
                _t9056 = Typechecker$process_type_def(ctx, type_params, name, def);
                break _t9057;
              }
              if (true) {
                _t9056 = ctx;
                break _t9057;
              }
              _match_fail("line 16933");
            }
            _t9053 = _t9056;
            break _t9054;
          }
          _match_fail("line 16933");
        }
        return _t9053;
      }
      const ctx$p_9058 = List$fold(_t9051, ctx$p_9049, type_defs);
      function _t9060(ctx, __p323) {
        let _t9062;
        const _t9061 = __p323;
        _t9063: {
          if (true) {
            const type_params = _t9061[0];
            const name = _t9061[1];
            const def = _t9061[2];
            const _deriving = _t9061[3];
            let _t9065;
            const _t9064 = def;
            _t9066: {
              if (_t9064._tag === 1) {
                _t9065 = ctx;
                break _t9066;
              }
              if (true) {
                _t9065 = Typechecker$process_type_def(ctx, type_params, name, def);
                break _t9066;
              }
              _match_fail("line 16933");
            }
            _t9062 = _t9065;
            break _t9063;
          }
          _match_fail("line 16933");
        }
        return _t9062;
      }
      const ctx$p$p_9067 = List$fold(_t9060, ctx$p_9058, type_defs);
      function _t9069(__p324, __p325) {
        let _t9071;
        const _t9070 = __p324;
        _t9072: {
          if (true) {
            const ctx = _t9070[0];
            const acc = _t9070[1];
            let _t9074;
            const _t9073 = __p325;
            _t9075: {
              if (true) {
                const type_params = _t9073[0];
                const name = _t9073[1];
                const def = _t9073[2];
                const deriving_ = _t9073[3];
                function _t9076(__p326, cls) {
                  let _t9078;
                  const _t9077 = __p326;
                  _t9079: {
                    if (true) {
                      const ctx = _t9077[0];
                      const acc = _t9077[1];
                      let _t9081;
                      const _t9080 = Typechecker$generate_derived_instance(type_params, name, def, cls);
                      _t9082: {
                        if (_t9080._tag === 1) {
                          const class_name = _t9080._val[0];
                          const inst_tys = _t9080._val[1];
                          const constraints = _t9080._val[2];
                          const methods = _t9080._val[3];
                          let _t9084;
                          const _t9083 = Typechecker$process_instance_def(ctx, level, class_name, inst_tys, constraints, methods);
                          _t9085: {
                            if (true) {
                              const ctx$p = _t9083[0];
                              const tdecl = _t9083[1];
                              _t9084 = [ctx$p, ({_hd: tdecl, _tl: acc})];
                              break _t9085;
                            }
                            _match_fail("line 16933");
                          }
                          _t9081 = _t9084;
                          break _t9082;
                        }
                        if (_t9080._tag === 0) {
                          _t9081 = Typechecker$error(((("cannot derive " + __dict_Show_string.show(cls)) + " for type ") + __dict_Show_string.show(name)));
                          break _t9082;
                        }
                        _match_fail("line 16933");
                      }
                      _t9078 = _t9081;
                      break _t9079;
                    }
                    _match_fail("line 16933");
                  }
                  return _t9078;
                }
                let _t9087;
                const _t9086 = List$fold(_t9076, [ctx, null], deriving_);
                _t9088: {
                  if (true) {
                    const ctx$p = _t9086[0];
                    const new_decls = _t9086[1];
                    _t9087 = [ctx$p, List$concat(List$rev(new_decls), acc)];
                    break _t9088;
                  }
                  _match_fail("line 16933");
                }
                _t9074 = _t9087;
                break _t9075;
              }
              _match_fail("line 16933");
            }
            _t9071 = _t9074;
            break _t9072;
          }
          _match_fail("line 16933");
        }
        return _t9071;
      }
      let _t9090;
      const _t9089 = List$fold(_t9069, [ctx$p$p_9067, null], type_defs);
      _t9091: {
        if (true) {
          const ctx_final = _t9089[0];
          const derived_tdecls = _t9089[1];
          function _t9092(__p327) {
            let _t9094;
            const _t9093 = __p327;
            _t9095: {
              if (true) {
                const _tp = _t9093[0];
                const name = _t9093[1];
                const def = _t9093[2];
                const _d = _t9093[3];
                _t9094 = ({_tag: 4, _name: "TDType", _val: [name, def]});
                break _t9095;
              }
              _match_fail("line 16933");
            }
            return _t9094;
          }
          const type_decls_9096 = List$map(_t9092, type_defs);
          const _t9097 = [ctx_final, List$concat(type_decls_9096, List$rev(derived_tdecls))];
          _t9090 = _t9097;
          break _t9091;
        }
        _match_fail("line 16933");
      }
      const _t9068 = _t9090;
      const _t9059 = _t9068;
      const _t9050 = _t9059;
      _t8731 = _t9050;
      break _t8732;
    }
    _match_fail("line 16933");
  }
  return _t8731;
}
const Typechecker$empty_ctx = ({constraint_tvars: null, current_eff: ({_tag: 1, _name: "EffEmpty"}), current_module: ({_tag: 0, _name: "None"}), inside_handler: false, loop_info: ({_tag: 0, _name: "None"}), mutable_vars: null, return_type: ({_tag: 0, _name: "None"}), return_used: Ref$create(false), type_env: Types$empty_type_env, vars: null});
function Typechecker$build_tgen_map(schema_ty, actual_ty) {
  const map_9098 = Hashtbl$create(4);
  function walk(s, a) {
    while (true) {
      const a_9100 = Types$repr(a);
      let _t9103;
      const _t9102 = s;
      _t9104: {
        if (_t9102._tag === 16) {
          const i = _t9102._val;
          let _t9105;
          if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, map_9098, i]))) {
            _t9105 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, map_9098, i, a_9100]);
          } else {
            _t9105 = undefined;
          }
          _t9103 = _t9105;
          break _t9104;
        }
        if (_t9102._tag === 7) {
          const s1 = _t9102._val[0];
          const s2 = _t9102._val[2];
          let _t9107;
          const _t9106 = a_9100;
          _t9108: {
            if (_t9106._tag === 7) {
              const a1 = _t9106._val[0];
              const a2 = _t9106._val[2];
              walk(s1, a1);
              const _t9109 = s2;
              const _t9110 = a2;
              s = _t9109;
              a = _t9110;
              continue;
              _t9107 = undefined;
              break _t9108;
            }
            if (true) {
              _t9107 = undefined;
              break _t9108;
            }
            _match_fail("line 16933");
          }
          _t9103 = _t9107;
          break _t9104;
        }
        if (_t9102._tag === 8) {
          const s1 = _t9102._val[0];
          const s2 = _t9102._val[2];
          let _t9112;
          const _t9111 = a_9100;
          _t9113: {
            if (_t9111._tag === 8) {
              const a1 = _t9111._val[0];
              const a2 = _t9111._val[2];
              walk(s1, a1);
              const _t9114 = s2;
              const _t9115 = a2;
              s = _t9114;
              a = _t9115;
              continue;
              _t9112 = undefined;
              break _t9113;
            }
            if (true) {
              _t9112 = undefined;
              break _t9113;
            }
            _match_fail("line 16933");
          }
          _t9103 = _t9112;
          break _t9104;
        }
        if (_t9102._tag === 9) {
          const ss = _t9102._val;
          let _t9117;
          const _t9116 = a_9100;
          _t9118: {
            if (_t9116._tag === 9) {
              const aa = _t9116._val;
              if ((List$length(ss) === List$length(aa))) {
                _t9117 = List$iter2(walk, ss, aa);
                break _t9118;
              }
            }
            if (true) {
              _t9117 = undefined;
              break _t9118;
            }
            _match_fail("line 16933");
          }
          _t9103 = _t9117;
          break _t9104;
        }
        if (_t9102._tag === 10) {
          const s1 = _t9102._val;
          let _t9120;
          const _t9119 = a_9100;
          _t9121: {
            if (_t9119._tag === 10) {
              const a1 = _t9119._val;
              const _t9122 = s1;
              const _t9123 = a1;
              s = _t9122;
              a = _t9123;
              continue;
              _t9120 = undefined;
              break _t9121;
            }
            if (true) {
              _t9120 = undefined;
              break _t9121;
            }
            _match_fail("line 16933");
          }
          _t9103 = _t9120;
          break _t9104;
        }
        if (_t9102._tag === 13) {
          const s1 = _t9102._val;
          let _t9125;
          const _t9124 = a_9100;
          _t9126: {
            if (_t9124._tag === 13) {
              const a1 = _t9124._val;
              const _t9127 = s1;
              const _t9128 = a1;
              s = _t9127;
              a = _t9128;
              continue;
              _t9125 = undefined;
              break _t9126;
            }
            if (true) {
              _t9125 = undefined;
              break _t9126;
            }
            _match_fail("line 16933");
          }
          _t9103 = _t9125;
          break _t9104;
        }
        if (_t9102._tag === 12) {
          const ss = _t9102._val[1];
          let _t9130;
          const _t9129 = a_9100;
          _t9131: {
            if (_t9129._tag === 12) {
              const aa = _t9129._val[1];
              if ((List$length(ss) === List$length(aa))) {
                _t9130 = List$iter2(walk, ss, aa);
                break _t9131;
              }
            }
            if (true) {
              _t9130 = undefined;
              break _t9131;
            }
            _match_fail("line 16933");
          }
          _t9103 = _t9130;
          break _t9104;
        }
        if (_t9102._tag === 11) {
          const srow = _t9102._val;
          let _t9133;
          const _t9132 = a_9100;
          _t9134: {
            if (_t9132._tag === 11) {
              const arow = _t9132._val;
              const sf_9135 = Types$record_row_to_fields(srow);
              const af_9137 = Types$record_row_to_fields(arow);
              function _t9139(__p328) {
                let _t9141;
                const _t9140 = __p328;
                _t9142: {
                  if (true) {
                    const sname = _t9140[0];
                    const sty = _t9140[1];
                    let _t9144;
                    const _t9143 = List$assoc_opt(sname, af_9137);
                    _t9145: {
                      if (_t9143._tag === 1) {
                        const aty = _t9143._val;
                        _t9144 = walk(sty, aty);
                        break _t9145;
                      }
                      if (_t9143._tag === 0) {
                        _t9144 = undefined;
                        break _t9145;
                      }
                      _match_fail("line 16933");
                    }
                    _t9141 = _t9144;
                    break _t9142;
                  }
                  _match_fail("line 16933");
                }
                return _t9141;
              }
              const _t9138 = List$iter(_t9139, sf_9135);
              const _t9136 = _t9138;
              _t9133 = _t9136;
              break _t9134;
            }
            if (true) {
              _t9133 = undefined;
              break _t9134;
            }
            _match_fail("line 16933");
          }
          _t9103 = _t9133;
          break _t9104;
        }
        if (_t9102._tag === 14) {
          const srow = _t9102._val;
          let _t9147;
          const _t9146 = a_9100;
          _t9148: {
            if (_t9146._tag === 14) {
              const arow = _t9146._val;
              _t9147 = walk_pvrows(srow, arow);
              break _t9148;
            }
            if (true) {
              _t9147 = undefined;
              break _t9148;
            }
            _match_fail("line 16933");
          }
          _t9103 = _t9147;
          break _t9104;
        }
        if (true) {
          _t9103 = undefined;
          break _t9104;
        }
        _match_fail("line 16933");
      }
      const _t9101 = _t9103;
      return _t9101;
    }
  }
  function walk_pvrows(srow, arow) {
    function collect_tags(row) {
      while (true) {
        let _t9150;
        const _t9149 = row;
        _t9151: {
          if (_t9149._tag === 0) {
            const tag = _t9149._val[0];
            const ty_opt = _t9149._val[1];
            const tail = _t9149._val[2];
            _t9150 = ({_hd: [tag, ty_opt], _tl: collect_tags(tail)});
            break _t9151;
          }
          if (_t9149._tag === 1 && _t9149._val.contents._tag === 1) {
            const r = _t9149._val.contents._val;
            const _t9152 = r;
            row = _t9152;
            continue;
            _t9150 = undefined;
            break _t9151;
          }
          if (true) {
            _t9150 = null;
            break _t9151;
          }
          _match_fail("line 16933");
        }
        return _t9150;
      }
    }
    const atags_9154 = collect_tags(arow);
    function go(row) {
      while (true) {
        let _t9157;
        const _t9156 = row;
        _t9158: {
          if (_t9156._tag === 0) {
            const stag = _t9156._val[0];
            const sty_opt = _t9156._val[1];
            const stail = _t9156._val[2];
            let _t9160;
            const _t9159 = List$assoc_opt(stag, atags_9154);
            _t9161: {
              if (_t9159._tag === 1) {
                const aty_opt = _t9159._val;
                let _t9163;
                const _t9162 = [sty_opt, aty_opt];
                _t9164: {
                  if (_t9162[0]._tag === 1 && _t9162[1]._tag === 1) {
                    const sty = _t9162[0]._val;
                    const aty = _t9162[1]._val;
                    _t9163 = walk(sty, aty);
                    break _t9164;
                  }
                  if (true) {
                    _t9163 = undefined;
                    break _t9164;
                  }
                  _match_fail("line 16933");
                }
                _t9160 = _t9163;
                break _t9161;
              }
              if (_t9159._tag === 0) {
                _t9160 = undefined;
                break _t9161;
              }
              _match_fail("line 16933");
            }
            _t9160;
            const _t9165 = stail;
            row = _t9165;
            continue;
            _t9157 = undefined;
            break _t9158;
          }
          if (_t9156._tag === 1 && _t9156._val.contents._tag === 1) {
            const r = _t9156._val.contents._val;
            const _t9166 = r;
            row = _t9166;
            continue;
            _t9157 = undefined;
            break _t9158;
          }
          if (true) {
            _t9157 = undefined;
            break _t9158;
          }
          _match_fail("line 16933");
        }
        return _t9157;
      }
    }
    const _t9167 = go(srow);
    const _t9155 = _t9167;
    const _t9153 = _t9155;
    return _t9153;
  }
  walk(schema_ty, actual_ty);
  const _t9168 = map_9098;
  const _t9099 = _t9168;
  return _t9099;
}
function Typechecker$find_constrained_dict(xctx, tvar_id, class_name) {
  function _t9169(__p329) {
    let _t9171;
    const _t9170 = __p329;
    _t9172: {
      if (true) {
        const tid = _t9170[0];
        const dparam = _t9170[1];
        const cls = _t9170[2];
        let _t9173;
        if (((tid === tvar_id) && (cls === class_name))) {
          _t9173 = ({_tag: 1, _name: "Some", _val: dparam});
        } else {
          _t9173 = ({_tag: 0, _name: "None"});
        }
        _t9171 = _t9173;
        break _t9172;
      }
      _match_fail("line 16933");
    }
    return _t9171;
  }
  return List$find_map(_t9169, xctx.xf_constrained);
}
function Typechecker$resolve_dict_arg(xctx, cc, tgen_map) {
  function _t9174(ca) {
    let _t9176;
    const _t9175 = ca;
    _t9177: {
      if (_t9175._tag === 0) {
        const idx = _t9175._val;
        let _t9179;
        const _t9178 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_map, idx]);
        _t9180: {
          if (_t9178._tag === 1) {
            const ty = _t9178._val;
            _t9179 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t9180;
          }
          if (_t9178._tag === 0) {
            _t9179 = ({_tag: 0, _name: "None"});
            break _t9180;
          }
          _match_fail("line 16933");
        }
        _t9176 = _t9179;
        break _t9177;
      }
      if (_t9175._tag === 1) {
        const ty = _t9175._val;
        _t9176 = ({_tag: 1, _name: "Some", _val: Types$freshen_unbound(ty)});
        break _t9177;
      }
      if (_t9175._tag === 2) {
        _t9176 = ({_tag: 1, _name: "Some", _val: Types$new_tvar(1)});
        break _t9177;
      }
      if (_t9175._tag === 3) {
        const idx = _t9175._val[0];
        let _t9182;
        const _t9181 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_map, idx]);
        _t9183: {
          if (_t9181._tag === 1) {
            const ty = _t9181._val;
            _t9182 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t9183;
          }
          if (_t9181._tag === 0) {
            const tv_9184 = Types$new_tvar(1);
            _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, tgen_map, idx, tv_9184]);
            const _t9185 = ({_tag: 1, _name: "Some", _val: tv_9184});
            _t9182 = _t9185;
            break _t9183;
          }
          _match_fail("line 16933");
        }
        _t9176 = _t9182;
        break _t9177;
      }
      _match_fail("line 16933");
    }
    return _t9176;
  }
  const arg_types_9186 = List$map(_t9174, cc.cc_args);
  function _t9188(opt) {
    return _eq(opt, ({_tag: 0, _name: "None"}));
  }
  const has_unresolved_9189 = List$exists(_t9188, arg_types_9186);
  let _t9191;
  if (has_unresolved_9189) {
    let _t9192;
    if ((cc.cc_class === "Show")) {
      _t9192 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: ({_hd: ["show", Typechecker$mk(({_tag: 7, _name: "TEVar", _val: "__show_value"}), ({_tag: 6, _name: "TUnit"}))], _tl: null})}), ({_tag: 6, _name: "TUnit"}));
    } else {
      _t9192 = Typechecker$error(("could not resolve constraint type argument for " + __dict_Show_string.show(cc.cc_class)));
    }
    _t9191 = _t9192;
  } else {
    function _t9193(x) {
      return x;
    }
    const arg_types_9194 = List$filter_map(_t9193, arg_types_9186);
    function _t9196(ty) {
      let _t9198;
      const _t9197 = ty;
      _t9199: {
        if (_t9197._tag === 15 && _t9197._val.contents._tag === 0) {
          _t9198 = true;
          break _t9199;
        }
        if (true) {
          _t9198 = false;
          break _t9199;
        }
        _match_fail("line 16933");
      }
      return _t9198;
    }
    const has_unbound_9200 = List$exists(_t9196, arg_types_9194);
    let _t9202;
    if (has_unbound_9200) {
      function _t9203(cls) {
        return ((cls.class_name === cc.cc_class) && !_eq(cls.class_fundeps, null));
      }
      const class_opt_9204 = List$find(_t9203, xctx.xf_type_env.classes);
      let _t9207;
      const _t9206 = class_opt_9204;
      _t9208: {
        if (_t9206._tag === 1) {
          const class_def = _t9206._val;
          function _t9209(ty) {
            let _t9211;
            const _t9210 = Types$repr(ty);
            _t9212: {
              if (_t9210._tag === 15 && _t9210._val.contents._tag === 0) {
                _t9211 = ({_tag: 0, _name: "None"});
                break _t9212;
              }
              if (true) {
                const t = _t9210;
                _t9211 = ({_tag: 1, _name: "Some", _val: t});
                break _t9212;
              }
              _match_fail("line 16933");
            }
            return _t9211;
          }
          const partial_9213 = List$map(_t9209, arg_types_9194);
          const improved_9215 = Types$improve_with_fundeps(xctx.xf_type_env.instances, class_def, partial_9213);
          function _t9217(orig_ty, imp) {
            let _t9219;
            const _t9218 = [imp, Types$repr(orig_ty)];
            _t9220: {
              if (_t9218[0]._tag === 1 && _t9218[1]._tag === 15 && _t9218[1]._val.contents._tag === 0) {
                const resolved = _t9218[0]._val;
                const r = _t9218[1]._val;
                _t9219 = Types$unify(({_tag: 15, _name: "TVar", _val: r}), resolved);
                break _t9220;
              }
              if (true) {
                _t9219 = undefined;
                break _t9220;
              }
              _match_fail("line 16933");
            }
            return _t9219;
          }
          List$iter2(_t9217, arg_types_9194, improved_9215);
          const _t9216 = List$map(Types$repr, arg_types_9194);
          const _t9214 = _t9216;
          _t9207 = _t9214;
          break _t9208;
        }
        if (_t9206._tag === 0) {
          _t9207 = arg_types_9194;
          break _t9208;
        }
        _match_fail("line 16933");
      }
      const _t9205 = _t9207;
      _t9202 = _t9205;
    } else {
      _t9202 = arg_types_9194;
    }
    const _t9201 = _t9202;
    const arg_types_9221 = _t9201;
    function _t9223(ty) {
      let _t9225;
      const _t9224 = ty;
      _t9226: {
        if (_t9224._tag === 15 && _t9224._val.contents._tag === 0) {
          const id = _t9224._val.contents._val[0];
          _t9225 = Typechecker$find_constrained_dict(xctx, id, cc.cc_class);
          break _t9226;
        }
        if (true) {
          _t9225 = ({_tag: 0, _name: "None"});
          break _t9226;
        }
        _match_fail("line 16933");
      }
      return _t9225;
    }
    const constrained_match_9227 = List$find_map(_t9223, arg_types_9221);
    let _t9230;
    const _t9229 = constrained_match_9227;
    _t9231: {
      if (_t9229._tag === 1) {
        const dparam = _t9229._val;
        _t9230 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dparam}), ({_tag: 6, _name: "TUnit"}));
        break _t9231;
      }
      if (_t9229._tag === 0) {
        function _t9232(ty) {
          let _t9234;
          const _t9233 = ty;
          _t9235: {
            if (_t9233._tag === 15 && _t9233._val.contents._tag === 0) {
              _t9234 = true;
              break _t9235;
            }
            if (true) {
              _t9234 = false;
              break _t9235;
            }
            _match_fail("line 16933");
          }
          return _t9234;
        }
        const has_unbound_tvar_9236 = List$exists(_t9232, arg_types_9221);
        let _t9238;
        if (has_unbound_tvar_9236) {
          let _t9239;
          if ((cc.cc_class === "Show")) {
            _t9239 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: ({_hd: ["show", Typechecker$mk(({_tag: 7, _name: "TEVar", _val: "__show_value"}), ({_tag: 6, _name: "TUnit"}))], _tl: null})}), ({_tag: 6, _name: "TUnit"}));
          } else {
            _t9239 = Typechecker$error(((("no instance of " + __dict_Show_string.show(cc.cc_class)) + " for types ") + __dict_Show_string.show(String$concat(", ", List$map(Types$pp_ty, arg_types_9221)))));
          }
          _t9238 = _t9239;
        } else {
          function _t9240(ty) {
            return ({_tag: 1, _name: "Some", _val: ty});
          }
          const partial_9241 = List$map(_t9240, arg_types_9221);
          function _t9243(inst) {
            return ((inst.inst_class === cc.cc_class) && ((List$length(inst.inst_tys) === List$length(arg_types_9221)) && Types$match_partial_inst(inst.inst_tys, partial_9241)));
          }
          const matching_9244 = List$filter(_t9243, xctx.xf_type_env.instances);
          let _t9247;
          const _t9246 = matching_9244;
          _t9248: {
            if (_t9246 !== null && _t9246._tl === null) {
              const inst = _t9246._hd;
              let _t9249;
              if (!_eq(inst.inst_constraints, null)) {
                _t9249 = Typechecker$resolve_factory_dict(xctx, inst, arg_types_9221);
              } else {
                _t9249 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"}));
              }
              _t9247 = _t9249;
              break _t9248;
            }
            if (_t9246 === null) {
              function _t9250(ty) {
                let _t9252;
                const _t9251 = Types$repr(ty);
                _t9253: {
                  if ((_t9251._tag === 14 || _t9251._tag === 11)) {
                    _t9252 = true;
                    break _t9253;
                  }
                  if (true) {
                    _t9252 = false;
                    break _t9253;
                  }
                  _match_fail("line 16933");
                }
                return _t9252;
              }
              const is_structural_9254 = List$exists(_t9250, arg_types_9221);
              let _t9256;
              if ((is_structural_9254 && (cc.cc_class === "Show"))) {
                _t9256 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: ({_hd: ["show", Typechecker$mk(({_tag: 7, _name: "TEVar", _val: "__show_value"}), ({_tag: 6, _name: "TUnit"}))], _tl: null})}), ({_tag: 6, _name: "TUnit"}));
              } else {
                _t9256 = Typechecker$error(((("no instance of " + __dict_Show_string.show(cc.cc_class)) + " for types ") + __dict_Show_string.show(String$concat(", ", List$map(Types$pp_ty, arg_types_9221)))));
              }
              const _t9255 = _t9256;
              _t9247 = _t9255;
              break _t9248;
            }
            if (true) {
              let _t9258;
              const _t9257 = Types$most_specific_inst(matching_9244);
              _t9259: {
                if (_t9257._tag === 1) {
                  const inst = _t9257._val;
                  let _t9260;
                  if (!_eq(inst.inst_constraints, null)) {
                    _t9260 = Typechecker$resolve_factory_dict(xctx, inst, arg_types_9221);
                  } else {
                    _t9260 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"}));
                  }
                  _t9258 = _t9260;
                  break _t9259;
                }
                if (_t9257._tag === 0) {
                  _t9258 = Typechecker$error(("ambiguous instance for " + __dict_Show_string.show(cc.cc_class)));
                  break _t9259;
                }
                _match_fail("line 16933");
              }
              _t9247 = _t9258;
              break _t9248;
            }
            _match_fail("line 16933");
          }
          const _t9245 = _t9247;
          const _t9242 = _t9245;
          _t9238 = _t9242;
        }
        const _t9237 = _t9238;
        _t9230 = _t9237;
        break _t9231;
      }
      _match_fail("line 16933");
    }
    const _t9228 = _t9230;
    const _t9222 = _t9228;
    const _t9195 = _t9222;
    _t9191 = _t9195;
  }
  const _t9190 = _t9191;
  const _t9187 = _t9190;
  return _t9187;
}
function Typechecker$resolve_factory_dict(xctx, inst, arg_types) {
  const sub_map_9261 = Hashtbl$create(4);
  function _t9263(inst_ty, actual_ty) {
    function walk(s, a) {
      while (true) {
        const a_9264 = Types$repr(a);
        let _t9267;
        const _t9266 = s;
        _t9268: {
          if (_t9266._tag === 16) {
            const i = _t9266._val;
            let _t9269;
            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, sub_map_9261, i]))) {
              _t9269 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, sub_map_9261, i, a_9264]);
            } else {
              _t9269 = undefined;
            }
            _t9267 = _t9269;
            break _t9268;
          }
          if (_t9266._tag === 7) {
            const s1 = _t9266._val[0];
            const s2 = _t9266._val[2];
            let _t9271;
            const _t9270 = a_9264;
            _t9272: {
              if (_t9270._tag === 7) {
                const a1 = _t9270._val[0];
                const a2 = _t9270._val[2];
                walk(s1, a1);
                const _t9273 = s2;
                const _t9274 = a2;
                s = _t9273;
                a = _t9274;
                continue;
                _t9271 = undefined;
                break _t9272;
              }
              if (true) {
                _t9271 = undefined;
                break _t9272;
              }
              _match_fail("line 16933");
            }
            _t9267 = _t9271;
            break _t9268;
          }
          if (_t9266._tag === 8) {
            const s1 = _t9266._val[0];
            const s2 = _t9266._val[2];
            let _t9276;
            const _t9275 = a_9264;
            _t9277: {
              if (_t9275._tag === 8) {
                const a1 = _t9275._val[0];
                const a2 = _t9275._val[2];
                walk(s1, a1);
                const _t9278 = s2;
                const _t9279 = a2;
                s = _t9278;
                a = _t9279;
                continue;
                _t9276 = undefined;
                break _t9277;
              }
              if (true) {
                _t9276 = undefined;
                break _t9277;
              }
              _match_fail("line 16933");
            }
            _t9267 = _t9276;
            break _t9268;
          }
          if (_t9266._tag === 9) {
            const ss = _t9266._val;
            let _t9281;
            const _t9280 = a_9264;
            _t9282: {
              if (_t9280._tag === 9) {
                const aa = _t9280._val;
                if ((List$length(ss) === List$length(aa))) {
                  _t9281 = List$iter2(walk, ss, aa);
                  break _t9282;
                }
              }
              if (true) {
                _t9281 = undefined;
                break _t9282;
              }
              _match_fail("line 16933");
            }
            _t9267 = _t9281;
            break _t9268;
          }
          if (_t9266._tag === 10) {
            const s1 = _t9266._val;
            let _t9284;
            const _t9283 = a_9264;
            _t9285: {
              if (_t9283._tag === 10) {
                const a1 = _t9283._val;
                const _t9286 = s1;
                const _t9287 = a1;
                s = _t9286;
                a = _t9287;
                continue;
                _t9284 = undefined;
                break _t9285;
              }
              if (true) {
                _t9284 = undefined;
                break _t9285;
              }
              _match_fail("line 16933");
            }
            _t9267 = _t9284;
            break _t9268;
          }
          if (_t9266._tag === 13) {
            const s1 = _t9266._val;
            let _t9289;
            const _t9288 = a_9264;
            _t9290: {
              if (_t9288._tag === 13) {
                const a1 = _t9288._val;
                const _t9291 = s1;
                const _t9292 = a1;
                s = _t9291;
                a = _t9292;
                continue;
                _t9289 = undefined;
                break _t9290;
              }
              if (true) {
                _t9289 = undefined;
                break _t9290;
              }
              _match_fail("line 16933");
            }
            _t9267 = _t9289;
            break _t9268;
          }
          if (_t9266._tag === 12) {
            const ss = _t9266._val[1];
            let _t9294;
            const _t9293 = a_9264;
            _t9295: {
              if (_t9293._tag === 12) {
                const aa = _t9293._val[1];
                if ((List$length(ss) === List$length(aa))) {
                  _t9294 = List$iter2(walk, ss, aa);
                  break _t9295;
                }
              }
              if (true) {
                _t9294 = undefined;
                break _t9295;
              }
              _match_fail("line 16933");
            }
            _t9267 = _t9294;
            break _t9268;
          }
          if (true) {
            _t9267 = undefined;
            break _t9268;
          }
          _match_fail("line 16933");
        }
        const _t9265 = _t9267;
        return _t9265;
      }
    }
    const _t9296 = walk(inst_ty, actual_ty);
    return _t9296;
  }
  List$iter2(_t9263, inst.inst_tys, arg_types);
  const base_9297 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"}));
  function _t9299(fn_, sub_cc) {
    const sub_dict_9300 = Typechecker$resolve_dict_arg(xctx, sub_cc, sub_map_9261);
    const _t9301 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_, sub_dict_9300]}), ({_tag: 6, _name: "TUnit"}));
    return _t9301;
  }
  const _t9298 = List$fold(_t9299, base_9297, inst.inst_constraints);
  const _t9262 = _t9298;
  return _t9262;
}
function Typechecker$pat_bound_names(__x) {
  while (true) {
    let _t9303;
    const _t9302 = __x;
    _t9304: {
      if (_t9302._tag === 1) {
        const name = _t9302._val;
        _t9303 = ({_hd: name, _tl: null});
        break _t9304;
      }
      if ((_t9302._tag === 7 || _t9302._tag === 14)) {
        const pats = _t9302._val;
        _t9303 = List$concat_map(Typechecker$pat_bound_names, pats);
        break _t9304;
      }
      if (_t9302._tag === 8) {
        const p1 = _t9302._val[0];
        const p2 = _t9302._val[1];
        _t9303 = List$concat(Typechecker$pat_bound_names(p1), Typechecker$pat_bound_names(p2));
        break _t9304;
      }
      if ((_t9302._tag === 10 && _t9302._val[1]._tag === 1 || _t9302._tag === 16 && _t9302._val[1]._tag === 1)) {
        const p = _t9302._val[1]._val;
        const _t9305 = p;
        __x = _t9305;
        continue;
        _t9303 = undefined;
        break _t9304;
      }
      if (_t9302._tag === 11) {
        const fields = _t9302._val;
        function _t9306(__p330) {
          let _t9308;
          const _t9307 = __p330;
          _t9309: {
            if (true) {
              const p = _t9307[1];
              _t9308 = Typechecker$pat_bound_names(p);
              break _t9309;
            }
            _match_fail("line 16933");
          }
          return _t9308;
        }
        _t9303 = List$concat_map(_t9306, fields);
        break _t9304;
      }
      if (_t9302._tag === 12) {
        const p = _t9302._val[0];
        const name = _t9302._val[1];
        _t9303 = ({_hd: name, _tl: Typechecker$pat_bound_names(p)});
        break _t9304;
      }
      if (_t9302._tag === 13) {
        const p1 = _t9302._val[0];
        const _t9310 = p1;
        __x = _t9310;
        continue;
        _t9303 = undefined;
        break _t9304;
      }
      if (_t9302._tag === 15) {
        const pairs = _t9302._val;
        function _t9311(__p331) {
          let _t9313;
          const _t9312 = __p331;
          _t9314: {
            if (true) {
              const v = _t9312[1];
              _t9313 = Typechecker$pat_bound_names(v);
              break _t9314;
            }
            _match_fail("line 16933");
          }
          return _t9313;
        }
        _t9303 = List$concat_map(_t9311, pairs);
        break _t9304;
      }
      if (_t9302._tag === 18) {
        const p = _t9302._val[0];
        const _t9315 = p;
        __x = _t9315;
        continue;
        _t9303 = undefined;
        break _t9304;
      }
      if ((((((((((_t9302._tag === 0 || _t9302._tag === 2) || _t9302._tag === 3) || _t9302._tag === 4) || _t9302._tag === 5) || _t9302._tag === 6) || _t9302._tag === 9) || _t9302._tag === 17) || _t9302._tag === 10 && _t9302._val[1]._tag === 0) || _t9302._tag === 16 && _t9302._val[1]._tag === 0)) {
        _t9303 = null;
        break _t9304;
      }
      _match_fail("line 16933");
    }
    return _t9303;
  }
}
function Typechecker$xform_expr(xctx, te) {
  let _t9317;
  const _t9316 = te.expr;
  _t9318: {
    if (_t9316._tag === 7) {
      const name = _t9316._val;
      const te_9319 = Typechecker$xform_class_method(xctx, name, te);
      const _t9320 = Typechecker$xform_constrained_ref(xctx, name, te_9319);
      _t9317 = _t9320;
      break _t9318;
    }
    if (_t9316._tag === 13) {
      const op = _t9316._val[0];
      const e1 = _t9316._val[1];
      const e2 = _t9316._val[2];
      const e1$p_9321 = Typechecker$xform_expr(xctx, e1);
      const e2$p_9323 = Typechecker$xform_expr(xctx, e2);
      const _t9324 = Typechecker$xform_binop(xctx, op, e1$p_9321, e2$p_9323, te.ty);
      const _t9322 = _t9324;
      _t9317 = _t9322;
      break _t9318;
    }
    if (_t9316._tag === 14) {
      const op = _t9316._val[0];
      const e = _t9316._val[1];
      const e$p_9325 = Typechecker$xform_expr(xctx, e);
      const _t9326 = Typechecker$xform_unop(xctx, op, e$p_9325, te.ty);
      _t9317 = _t9326;
      break _t9318;
    }
    if (_t9316._tag === 11) {
      const fn_ = _t9316._val[0];
      const arg = _t9316._val[1];
      const fn$p_9327 = Typechecker$xform_expr(xctx, fn_);
      const arg$p_9329 = Typechecker$xform_expr(xctx, arg);
      const _t9330 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn$p_9327, arg$p_9329]}), te.ty);
      const _t9328 = _t9330;
      _t9317 = _t9328;
      break _t9318;
    }
    if (_t9316._tag === 10) {
      const param = _t9316._val[0];
      const body = _t9316._val[1];
      const hr = _t9316._val[2];
      const __rec_upd_9331 = xctx;
      const _t9332 = ({xf_constrained: __rec_upd_9331.xf_constrained, xf_locals: ({_hd: param, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9331.xf_record_evidence, xf_schemes: __rec_upd_9331.xf_schemes, xf_type_env: __rec_upd_9331.xf_type_env});
      const xctx$p_9333 = _t9332;
      const _t9334 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [param, Typechecker$xform_expr(xctx$p_9333, body), hr]}), te.ty);
      _t9317 = _t9334;
      break _t9318;
    }
    if (_t9316._tag === 8 && _t9316._val[1]._tag === 1) {
      const name = _t9316._val[0];
      const scheme = _t9316._val[1]._val;
      const e1 = _t9316._val[2];
      const e2 = _t9316._val[3];
      const e1$p_9335 = Typechecker$xform_constrained_def(xctx, scheme, e1);
      const __rec_upd_9337 = xctx;
      const _t9338 = ({xf_constrained: __rec_upd_9337.xf_constrained, xf_locals: __rec_upd_9337.xf_locals, xf_record_evidence: __rec_upd_9337.xf_record_evidence, xf_schemes: ({_hd: [name, scheme], _tl: xctx.xf_schemes}), xf_type_env: __rec_upd_9337.xf_type_env});
      const xctx$p_9339 = _t9338;
      const _t9340 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [name, ({_tag: 1, _name: "Some", _val: scheme}), e1$p_9335, Typechecker$xform_expr(xctx$p_9339, e2)]}), te.ty);
      const _t9336 = _t9340;
      _t9317 = _t9336;
      break _t9318;
    }
    if (_t9316._tag === 8 && _t9316._val[1]._tag === 0) {
      const name = _t9316._val[0];
      const e1 = _t9316._val[2];
      const e2 = _t9316._val[3];
      const __rec_upd_9341 = xctx;
      const _t9342 = ({xf_constrained: __rec_upd_9341.xf_constrained, xf_locals: ({_hd: name, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9341.xf_record_evidence, xf_schemes: __rec_upd_9341.xf_schemes, xf_type_env: __rec_upd_9341.xf_type_env});
      const xctx$p_9343 = _t9342;
      const _t9344 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [name, ({_tag: 0, _name: "None"}), Typechecker$xform_expr(xctx, e1), Typechecker$xform_expr(xctx$p_9343, e2)]}), te.ty);
      _t9317 = _t9344;
      break _t9318;
    }
    if (_t9316._tag === 9 && _t9316._val[1]._tag === 1) {
      const name = _t9316._val[0];
      const scheme = _t9316._val[1]._val;
      const e1 = _t9316._val[2];
      const e2 = _t9316._val[3];
      const __rec_upd_9345 = xctx;
      const _t9346 = ({xf_constrained: __rec_upd_9345.xf_constrained, xf_locals: __rec_upd_9345.xf_locals, xf_record_evidence: __rec_upd_9345.xf_record_evidence, xf_schemes: ({_hd: [name, scheme], _tl: xctx.xf_schemes}), xf_type_env: __rec_upd_9345.xf_type_env});
      const xctx$p_9347 = _t9346;
      const e1$p_9349 = Typechecker$xform_constrained_def(xctx$p_9347, scheme, e1);
      const _t9350 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 1, _name: "Some", _val: scheme}), e1$p_9349, Typechecker$xform_expr(xctx$p_9347, e2)]}), te.ty);
      const _t9348 = _t9350;
      _t9317 = _t9348;
      break _t9318;
    }
    if (_t9316._tag === 9 && _t9316._val[1]._tag === 0) {
      const name = _t9316._val[0];
      const e1 = _t9316._val[2];
      const e2 = _t9316._val[3];
      const __rec_upd_9351 = xctx;
      const _t9352 = ({xf_constrained: __rec_upd_9351.xf_constrained, xf_locals: ({_hd: name, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9351.xf_record_evidence, xf_schemes: __rec_upd_9351.xf_schemes, xf_type_env: __rec_upd_9351.xf_type_env});
      const xctx$p_9353 = _t9352;
      const _t9354 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [name, ({_tag: 0, _name: "None"}), Typechecker$xform_expr(xctx$p_9353, e1), Typechecker$xform_expr(xctx$p_9353, e2)]}), te.ty);
      _t9317 = _t9354;
      break _t9318;
    }
    if (_t9316._tag === 25) {
      const name = _t9316._val[0];
      const e1 = _t9316._val[1];
      const e2 = _t9316._val[2];
      const __rec_upd_9355 = xctx;
      const _t9356 = ({xf_constrained: __rec_upd_9355.xf_constrained, xf_locals: ({_hd: name, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9355.xf_record_evidence, xf_schemes: __rec_upd_9355.xf_schemes, xf_type_env: __rec_upd_9355.xf_type_env});
      const xctx$p_9357 = _t9356;
      const _t9358 = Typechecker$mk(({_tag: 25, _name: "TELetMut", _val: [name, Typechecker$xform_expr(xctx, e1), Typechecker$xform_expr(xctx$p_9357, e2)]}), te.ty);
      _t9317 = _t9358;
      break _t9318;
    }
    if (_t9316._tag === 32) {
      const cond = _t9316._val[0];
      const body = _t9316._val[1];
      _t9317 = Typechecker$mk(({_tag: 32, _name: "TEWhile", _val: [Typechecker$xform_expr(xctx, cond), Typechecker$xform_expr(xctx, body)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 37) {
      const bindings = _t9316._val[0];
      const body = _t9316._val[1];
      const names_9359 = List$map(fst, bindings);
      const __rec_upd_9361 = xctx;
      const _t9362 = ({xf_constrained: __rec_upd_9361.xf_constrained, xf_locals: List$concat(names_9359, xctx.xf_locals), xf_record_evidence: __rec_upd_9361.xf_record_evidence, xf_schemes: __rec_upd_9361.xf_schemes, xf_type_env: __rec_upd_9361.xf_type_env});
      const xctx$p_9363 = _t9362;
      function _t9365(__p332) {
        let _t9367;
        const _t9366 = __p332;
        _t9368: {
          if (true) {
            const n = _t9366[0];
            const e = _t9366[1];
            _t9367 = [n, Typechecker$xform_expr(xctx$p_9363, e)];
            break _t9368;
          }
          _match_fail("line 16933");
        }
        return _t9367;
      }
      const bindings$p_9369 = List$map(_t9365, bindings);
      const _t9370 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [bindings$p_9369, Typechecker$xform_expr(xctx$p_9363, body)]}), te.ty);
      const _t9364 = _t9370;
      const _t9360 = _t9364;
      _t9317 = _t9360;
      break _t9318;
    }
    if (_t9316._tag === 12) {
      const c = _t9316._val[0];
      const t = _t9316._val[1];
      const e = _t9316._val[2];
      _t9317 = Typechecker$mk(({_tag: 12, _name: "TEIf", _val: [Typechecker$xform_expr(xctx, c), Typechecker$xform_expr(xctx, t), Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 15) {
      const es = _t9316._val;
      _t9317 = Typechecker$mk(({_tag: 15, _name: "TETuple", _val: List$map(_call(Typechecker$xform_expr, [xctx]), es)}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 16) {
      const fields = _t9316._val;
      function _t9371(__p333) {
        let _t9373;
        const _t9372 = __p333;
        _t9374: {
          if (true) {
            const n = _t9372[0];
            const e = _t9372[1];
            _t9373 = [n, Typechecker$xform_expr(xctx, e)];
            break _t9374;
          }
          _match_fail("line 16933");
        }
        return _t9373;
      }
      _t9317 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: List$map(_t9371, fields)}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 17) {
      const base = _t9316._val[0];
      const overrides = _t9316._val[1];
      const base$p_9375 = Typechecker$xform_expr(xctx, base);
      function _t9377(__p334) {
        let _t9379;
        const _t9378 = __p334;
        _t9380: {
          if (true) {
            const n = _t9378[0];
            const e = _t9378[1];
            _t9379 = [n, Typechecker$xform_expr(xctx, e)];
            break _t9380;
          }
          _match_fail("line 16933");
        }
        return _t9379;
      }
      const overrides$p_9381 = List$map(_t9377, overrides);
      function get_row_tail(row) {
        while (true) {
          let _t9384;
          const _t9383 = Types$rrow_repr(row);
          _t9385: {
            if (_t9383._tag === 0) {
              const tail = _t9383._val[2];
              const _t9386 = tail;
              row = _t9386;
              continue;
              _t9384 = undefined;
              break _t9385;
            }
            if (true) {
              const tail = _t9383;
              _t9384 = tail;
              break _t9385;
            }
            _match_fail("line 16933");
          }
          return _t9384;
        }
      }
      let _t9389;
      const _t9388 = Types$repr(base$p_9375.ty);
      _t9390: {
        if (_t9388._tag === 11) {
          const row = _t9388._val;
          let _t9392;
          const _t9391 = get_row_tail(row);
          _t9393: {
            if (_t9391._tag === 1 && _t9391._val.contents._tag === 0) {
              const id = _t9391._val.contents._val[0];
              function _t9394(__p335) {
                let _t9396;
                const _t9395 = __p335;
                _t9397: {
                  if (true) {
                    const rid = _t9395[0];
                    _t9396 = (rid === id);
                    break _t9397;
                  }
                  _match_fail("line 16933");
                }
                return _t9396;
              }
              _t9392 = List$exists(_t9394, xctx.xf_record_evidence);
              break _t9393;
            }
            if (true) {
              _t9392 = false;
              break _t9393;
            }
            _match_fail("line 16933");
          }
          _t9389 = _t9392;
          break _t9390;
        }
        if (true) {
          _t9389 = false;
          break _t9390;
        }
        _match_fail("line 16933");
      }
      const has_evidence_9398 = _t9389;
      let _t9400;
      if (has_evidence_9398) {
        let _t9402;
        const _t9401 = Types$repr(base$p_9375.ty);
        _t9403: {
          if (_t9401._tag === 11) {
            const r = _t9401._val;
            _t9402 = r;
            break _t9403;
          }
          if (true) {
            _t9402 = failwith("assert false");
            break _t9403;
          }
          _match_fail("line 16933");
        }
        const row_9404 = _t9402;
        let _t9407;
        const _t9406 = get_row_tail(row_9404);
        _t9408: {
          if (_t9406._tag === 1 && _t9406._val.contents._tag === 0) {
            const id = _t9406._val.contents._val[0];
            _t9407 = id;
            break _t9408;
          }
          if (true) {
            _t9407 = failwith("assert false");
            break _t9408;
          }
          _match_fail("line 16933");
        }
        const rvar_id_9409 = _t9407;
        function _t9411(__p336) {
          let _t9413;
          const _t9412 = __p336;
          _t9414: {
            if (true) {
              const name = _t9412[0];
              const e = _t9412[1];
              function _t9415(__p337) {
                let _t9417;
                const _t9416 = __p337;
                _t9418: {
                  if (true) {
                    const rid = _t9416[0];
                    const fname = _t9416[1];
                    const pname = _t9416[2];
                    let _t9419;
                    if (((rid === rvar_id_9409) && (fname === name))) {
                      _t9419 = ({_tag: 1, _name: "Some", _val: pname});
                    } else {
                      _t9419 = ({_tag: 0, _name: "None"});
                    }
                    _t9417 = _t9419;
                    break _t9418;
                  }
                  _match_fail("line 16933");
                }
                return _t9417;
              }
              const ev_param_9420 = List$find_map(_t9415, xctx.xf_record_evidence);
              let _t9423;
              const _t9422 = ev_param_9420;
              _t9424: {
                if (_t9422._tag === 1) {
                  const pname = _t9422._val;
                  _t9423 = [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: pname}), ({_tag: 0, _name: "TInt"})), e];
                  break _t9424;
                }
                if (_t9422._tag === 0) {
                  _t9423 = Typechecker$error(("missing record evidence for field " + __dict_Show_string.show(name)));
                  break _t9424;
                }
                _match_fail("line 16933");
              }
              const _t9421 = _t9423;
              _t9413 = _t9421;
              break _t9414;
            }
            _match_fail("line 16933");
          }
          return _t9413;
        }
        const idx_val_pairs_9425 = List$map(_t9411, overrides$p_9381);
        const _t9426 = Typechecker$mk(({_tag: 18, _name: "TERecordUpdateIdx", _val: [base$p_9375, idx_val_pairs_9425]}), te.ty);
        const _t9410 = _t9426;
        const _t9405 = _t9410;
        _t9400 = _t9405;
      } else {
        _t9400 = Typechecker$mk(({_tag: 17, _name: "TERecordUpdate", _val: [base$p_9375, overrides$p_9381]}), te.ty);
      }
      const _t9399 = _t9400;
      const _t9387 = _t9399;
      const _t9382 = _t9387;
      const _t9376 = _t9382;
      _t9317 = _t9376;
      break _t9318;
    }
    if (_t9316._tag === 18) {
      const base = _t9316._val[0];
      const pairs = _t9316._val[1];
      function _t9427(__p338) {
        let _t9429;
        const _t9428 = __p338;
        _t9430: {
          if (true) {
            const i = _t9428[0];
            const v = _t9428[1];
            _t9429 = [Typechecker$xform_expr(xctx, i), Typechecker$xform_expr(xctx, v)];
            break _t9430;
          }
          _match_fail("line 16933");
        }
        return _t9429;
      }
      _t9317 = Typechecker$mk(({_tag: 18, _name: "TERecordUpdateIdx", _val: [Typechecker$xform_expr(xctx, base), List$map(_t9427, pairs)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 19) {
      const e = _t9316._val[0];
      const name = _t9316._val[1];
      _t9317 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$xform_expr(xctx, e), name]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 21) {
      const hd = _t9316._val[0];
      const tl = _t9316._val[1];
      _t9317 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [Typechecker$xform_expr(xctx, hd), Typechecker$xform_expr(xctx, tl)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 23) {
      const name = _t9316._val[0];
      const arg = _t9316._val[1];
      _t9317 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [name, Option$map(_call(Typechecker$xform_expr, [xctx]), arg)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 24) {
      const scrutinee = _t9316._val[0];
      const arms = _t9316._val[1];
      const partial = _t9316._val[2];
      function _t9431(__p339) {
        let _t9433;
        const _t9432 = __p339;
        _t9434: {
          if (true) {
            const pat = _t9432[0];
            const guard = _t9432[1];
            const body = _t9432[2];
            const pvars_9435 = Typechecker$pat_bound_names(pat);
            const __rec_upd_9437 = xctx;
            const _t9438 = ({xf_constrained: __rec_upd_9437.xf_constrained, xf_locals: List$concat(pvars_9435, xctx.xf_locals), xf_record_evidence: __rec_upd_9437.xf_record_evidence, xf_schemes: __rec_upd_9437.xf_schemes, xf_type_env: __rec_upd_9437.xf_type_env});
            const xctx$p_9439 = _t9438;
            const _t9440 = [pat, Option$map(_call(Typechecker$xform_expr, [xctx$p_9439]), guard), Typechecker$xform_expr(xctx$p_9439, body)];
            const _t9436 = _t9440;
            _t9433 = _t9436;
            break _t9434;
          }
          _match_fail("line 16933");
        }
        return _t9433;
      }
      const arms$p_9441 = List$map(_t9431, arms);
      const _t9442 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [Typechecker$xform_expr(xctx, scrutinee), arms$p_9441, partial]}), te.ty);
      _t9317 = _t9442;
      break _t9318;
    }
    if (_t9316._tag === 26) {
      const name = _t9316._val[0];
      const e = _t9316._val[1];
      _t9317 = Typechecker$mk(({_tag: 26, _name: "TEAssign", _val: [name, Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 27) {
      const r = _t9316._val[0];
      const f = _t9316._val[1];
      const e = _t9316._val[2];
      _t9317 = Typechecker$mk(({_tag: 27, _name: "TEFieldAssign", _val: [Typechecker$xform_expr(xctx, r), f, Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 28) {
      const e1 = _t9316._val[0];
      const e2 = _t9316._val[1];
      _t9317 = Typechecker$mk(({_tag: 28, _name: "TESeq", _val: [Typechecker$xform_expr(xctx, e1), Typechecker$xform_expr(xctx, e2)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 29) {
      const name = _t9316._val[0];
      const e = _t9316._val[1];
      _t9317 = Typechecker$mk(({_tag: 29, _name: "TEPerform", _val: [name, Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 30) {
      const body = _t9316._val[0];
      const arms = _t9316._val[1];
      function _t9443(arm) {
        let _t9445;
        const _t9444 = arm;
        _t9446: {
          if (_t9444._tag === 0) {
            const n = _t9444._val[0];
            const e = _t9444._val[1];
            const __rec_upd_9447 = xctx;
            const _t9448 = ({xf_constrained: __rec_upd_9447.xf_constrained, xf_locals: ({_hd: n, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9447.xf_record_evidence, xf_schemes: __rec_upd_9447.xf_schemes, xf_type_env: __rec_upd_9447.xf_type_env});
            const xctx$p_9449 = _t9448;
            const _t9450 = ({_tag: 0, _name: "THReturn", _val: [n, Typechecker$xform_expr(xctx$p_9449, e)]});
            _t9445 = _t9450;
            break _t9446;
          }
          if (_t9444._tag === 1) {
            const op = _t9444._val[0];
            const p = _t9444._val[1];
            const k = _t9444._val[2];
            const e = _t9444._val[3];
            const __rec_upd_9451 = xctx;
            const _t9452 = ({xf_constrained: __rec_upd_9451.xf_constrained, xf_locals: ({_hd: k, _tl: ({_hd: p, _tl: xctx.xf_locals})}), xf_record_evidence: __rec_upd_9451.xf_record_evidence, xf_schemes: __rec_upd_9451.xf_schemes, xf_type_env: __rec_upd_9451.xf_type_env});
            const xctx$p_9453 = _t9452;
            const _t9454 = ({_tag: 1, _name: "THOp", _val: [op, p, k, Typechecker$xform_expr(xctx$p_9453, e)]});
            _t9445 = _t9454;
            break _t9446;
          }
          if (_t9444._tag === 2) {
            const op = _t9444._val[0];
            const p = _t9444._val[1];
            const e = _t9444._val[2];
            const __rec_upd_9455 = xctx;
            const _t9456 = ({xf_constrained: __rec_upd_9455.xf_constrained, xf_locals: ({_hd: p, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9455.xf_record_evidence, xf_schemes: __rec_upd_9455.xf_schemes, xf_type_env: __rec_upd_9455.xf_type_env});
            const xctx$p_9457 = _t9456;
            const _t9458 = ({_tag: 2, _name: "THOpProvide", _val: [op, p, Typechecker$xform_expr(xctx$p_9457, e)]});
            _t9445 = _t9458;
            break _t9446;
          }
          if (_t9444._tag === 3) {
            const op = _t9444._val[0];
            const p = _t9444._val[1];
            const e = _t9444._val[2];
            const __rec_upd_9459 = xctx;
            const _t9460 = ({xf_constrained: __rec_upd_9459.xf_constrained, xf_locals: ({_hd: p, _tl: xctx.xf_locals}), xf_record_evidence: __rec_upd_9459.xf_record_evidence, xf_schemes: __rec_upd_9459.xf_schemes, xf_type_env: __rec_upd_9459.xf_type_env});
            const xctx$p_9461 = _t9460;
            const _t9462 = ({_tag: 3, _name: "THOpTry", _val: [op, p, Typechecker$xform_expr(xctx$p_9461, e)]});
            _t9445 = _t9462;
            break _t9446;
          }
          _match_fail("line 16933");
        }
        return _t9445;
      }
      const arms$p_9463 = List$map(_t9443, arms);
      const _t9464 = Typechecker$mk(({_tag: 30, _name: "TEHandle", _val: [Typechecker$xform_expr(xctx, body), arms$p_9463]}), te.ty);
      _t9317 = _t9464;
      break _t9318;
    }
    if (_t9316._tag === 31) {
      const k = _t9316._val[0];
      const e = _t9316._val[1];
      _t9317 = Typechecker$mk(({_tag: 31, _name: "TEResume", _val: [Typechecker$xform_expr(xctx, k), Typechecker$xform_expr(xctx, e)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 38) {
      const es = _t9316._val;
      _t9317 = Typechecker$mk(({_tag: 38, _name: "TEArray", _val: List$map(_call(Typechecker$xform_expr, [xctx]), es)}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 20) {
      const base = _t9316._val[0];
      const idx = _t9316._val[1];
      _t9317 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [Typechecker$xform_expr(xctx, base), Typechecker$xform_expr(xctx, idx)]}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 33) {
      const e = _t9316._val;
      _t9317 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 34) {
      _t9317 = te;
      break _t9318;
    }
    if (_t9316._tag === 35) {
      const e = _t9316._val;
      _t9317 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 36) {
      const e = _t9316._val;
      _t9317 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t9318;
    }
    if (_t9316._tag === 39) {
      const e = _t9316._val;
      _t9317 = Typechecker$mk(({_tag: 39, _name: "TEReturn", _val: Typechecker$xform_expr(xctx, e)}), te.ty);
      break _t9318;
    }
    if ((((((((_t9316._tag === 0 || _t9316._tag === 1) || _t9316._tag === 2) || _t9316._tag === 3) || _t9316._tag === 4) || _t9316._tag === 5) || _t9316._tag === 6) || _t9316._tag === 22)) {
      _t9317 = te;
      break _t9318;
    }
    _match_fail("line 16933");
  }
  return _t9317;
}
function Typechecker$xform_class_method(xctx, name, te) {
  let _t9465;
  if (List$mem(name, xctx.xf_locals)) {
    _t9465 = te;
  } else {
    let _t9467;
    const _t9466 = Types$find_method_class(xctx.xf_type_env.classes, name);
    _t9468: {
      if (_t9466._tag === 1) {
        const result = _t9466;
        _t9467 = [result, name];
        break _t9468;
      }
      if (_t9466._tag === 0) {
        let _t9470;
        const _t9469 = String$rindex_opt(name, 46);
        _t9471: {
          if (_t9469._tag === 0) {
            _t9470 = [({_tag: 0, _name: "None"}), name];
            break _t9471;
          }
          if (_t9469._tag === 1) {
            const i = _t9469._val;
            const mod_prefix_9472 = String$sub(name, 0, (i + 1));
            const _mml$short_9474 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
            const class_prefix_9476 = String$sub(name, 0, i);
            let _t9479;
            const _t9478 = Types$find_method_class(xctx.xf_type_env.classes, _mml$short_9474);
            _t9480: {
              if (_t9478._tag === 1) {
                const class_def = _t9478._val;
                if ((class_def.class_name === class_prefix_9476)) {
                  _t9479 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_9474];
                  break _t9480;
                }
              }
              if (_t9478._tag === 1) {
                const class_def = _t9478._val;
                if (((String$length(class_def.class_name) > String$length(mod_prefix_9472)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_9472)) === mod_prefix_9472))) {
                  _t9479 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_9474];
                  break _t9480;
                }
              }
              if (true) {
                _t9479 = [({_tag: 0, _name: "None"}), name];
                break _t9480;
              }
              _match_fail("line 16933");
            }
            const _t9477 = _t9479;
            const _t9475 = _t9477;
            const _t9473 = _t9475;
            _t9470 = _t9473;
            break _t9471;
          }
          _match_fail("line 16933");
        }
        _t9467 = _t9470;
        break _t9468;
      }
      _match_fail("line 16933");
    }
    let _t9482;
    const _t9481 = _t9467;
    _t9483: {
      if (true) {
        const class_opt = _t9481[0];
        const method_name = _t9481[1];
        let _t9485;
        const _t9484 = class_opt;
        _t9486: {
          if (_t9484._tag === 1) {
            const class_def = _t9484._val;
            const method_schema_ty_9487 = List$assoc(method_name, class_def.class_methods);
            let _t9490;
            const _t9489 = List$assoc_opt(name, xctx.xf_schemes);
            _t9491: {
              if (_t9489._tag === 1) {
                const s = _t9489._val;
                _t9490 = !_eq(s.body, method_schema_ty_9487);
                break _t9491;
              }
              if (_t9489._tag === 0) {
                _t9490 = false;
                break _t9491;
              }
              _match_fail("line 16933");
            }
            const is_overridden_9492 = _t9490;
            let _t9494;
            if (is_overridden_9492) {
              _t9494 = te;
            } else {
              const num_params_9495 = List$length(class_def.class_params);
              const found_9497 = Hashtbl$create(num_params_9495);
              function go(s, r) {
                while (true) {
                  const r_9499 = Types$repr(r);
                  let _t9502;
                  const _t9501 = [s, r_9499];
                  _t9503: {
                    if (_t9501[0]._tag === 16) {
                      const i = _t9501[0]._val;
                      if ((i < num_params_9495)) {
                        let _t9504;
                        if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, found_9497, i]))) {
                          _t9504 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_9497, i, r_9499]);
                        } else {
                          _t9504 = undefined;
                        }
                        _t9502 = _t9504;
                        break _t9503;
                      }
                    }
                    if ((_t9501[0]._tag === 7 && _t9501[1]._tag === 7 || _t9501[0]._tag === 8 && _t9501[1]._tag === 8)) {
                      const s1 = _t9501[0]._val[0];
                      const s2 = _t9501[0]._val[2];
                      const r1 = _t9501[1]._val[0];
                      const r2 = _t9501[1]._val[2];
                      go(s1, r1);
                      const _t9505 = s2;
                      const _t9506 = r2;
                      s = _t9505;
                      r = _t9506;
                      continue;
                      _t9502 = undefined;
                      break _t9503;
                    }
                    if (_t9501[0]._tag === 9 && _t9501[1]._tag === 9) {
                      const ss = _t9501[0]._val;
                      const rs = _t9501[1]._val;
                      if ((List$length(ss) === List$length(rs))) {
                        _t9502 = List$iter2(go, ss, rs);
                        break _t9503;
                      }
                    }
                    if (_t9501[0]._tag === 10 && _t9501[1]._tag === 10) {
                      const s1 = _t9501[0]._val;
                      const r1 = _t9501[1]._val;
                      const _t9507 = s1;
                      const _t9508 = r1;
                      s = _t9507;
                      r = _t9508;
                      continue;
                      _t9502 = undefined;
                      break _t9503;
                    }
                    if (_t9501[0]._tag === 13 && _t9501[1]._tag === 13) {
                      const s1 = _t9501[0]._val;
                      const r1 = _t9501[1]._val;
                      const _t9509 = s1;
                      const _t9510 = r1;
                      s = _t9509;
                      r = _t9510;
                      continue;
                      _t9502 = undefined;
                      break _t9503;
                    }
                    if (_t9501[0]._tag === 12 && _t9501[1]._tag === 12) {
                      const ss = _t9501[0]._val[1];
                      const rs = _t9501[1]._val[1];
                      if ((List$length(ss) === List$length(rs))) {
                        _t9502 = List$iter2(go, ss, rs);
                        break _t9503;
                      }
                    }
                    if (true) {
                      _t9502 = undefined;
                      break _t9503;
                    }
                    _match_fail("line 16933");
                  }
                  const _t9500 = _t9502;
                  return _t9500;
                }
              }
              go(method_schema_ty_9487, te.ty);
              let _t9512;
              if (!_eq(xctx.xf_constrained, null)) {
                function _t9513(i) {
                  let _t9515;
                  const _t9514 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_9497, i]);
                  _t9516: {
                    if (_t9514._tag === 1 && _t9514._val._tag === 15 && _t9514._val._val.contents._tag === 0) {
                      const id = _t9514._val._val.contents._val[0];
                      _t9515 = Typechecker$find_constrained_dict(xctx, id, class_def.class_name);
                      break _t9516;
                    }
                    if (true) {
                      _t9515 = ({_tag: 0, _name: "None"});
                      break _t9516;
                    }
                    _match_fail("line 16933");
                  }
                  return _t9515;
                }
                function _t9517(x) {
                  return x;
                }
                const exact_match_9518 = List$find_map(_t9513, List$init(num_params_9495, _t9517));
                let _t9521;
                const _t9520 = exact_match_9518;
                _t9522: {
                  if (_t9520._tag === 1) {
                    _t9521 = exact_match_9518;
                    break _t9522;
                  }
                  if (_t9520._tag === 0) {
                    function _t9523(i) {
                      let _t9525;
                      const _t9524 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_9497, i]);
                      _t9526: {
                        if (_t9524._tag === 1 && _t9524._val._tag === 15 && _t9524._val._val.contents._tag === 0) {
                          _t9525 = true;
                          break _t9526;
                        }
                        if (true) {
                          _t9525 = false;
                          break _t9526;
                        }
                        _match_fail("line 16933");
                      }
                      return _t9525;
                    }
                    function _t9527(x) {
                      return x;
                    }
                    const has_unbound_arg_9528 = List$exists(_t9523, List$init(num_params_9495, _t9527));
                    let _t9530;
                    if (has_unbound_arg_9528) {
                      function _t9531(__p340) {
                        let _t9533;
                        const _t9532 = __p340;
                        _t9534: {
                          if (true) {
                            const _tid = _t9532[0];
                            const _dp = _t9532[1];
                            const cls = _t9532[2];
                            _t9533 = (cls === class_def.class_name);
                            break _t9534;
                          }
                          _match_fail("line 16933");
                        }
                        return _t9533;
                      }
                      const matching_constraints_9535 = List$filter(_t9531, xctx.xf_constrained);
                      let _t9538;
                      const _t9537 = matching_constraints_9535;
                      _t9539: {
                        if (_t9537 !== null && _t9537._tl === null) {
                          const _tid = _t9537._hd[0];
                          const dp = _t9537._hd[1];
                          const _cls = _t9537._hd[2];
                          _t9538 = ({_tag: 1, _name: "Some", _val: dp});
                          break _t9539;
                        }
                        if (true) {
                          _t9538 = ({_tag: 0, _name: "None"});
                          break _t9539;
                        }
                        _match_fail("line 16933");
                      }
                      const _t9536 = _t9538;
                      _t9530 = _t9536;
                    } else {
                      _t9530 = ({_tag: 0, _name: "None"});
                    }
                    const _t9529 = _t9530;
                    _t9521 = _t9529;
                    break _t9522;
                  }
                  _match_fail("line 16933");
                }
                const _t9519 = _t9521;
                _t9512 = _t9519;
              } else {
                _t9512 = ({_tag: 0, _name: "None"});
              }
              const constrained_match_9540 = _t9512;
              let _t9543;
              const _t9542 = constrained_match_9540;
              _t9544: {
                if (_t9542._tag === 1) {
                  const dp = _t9542._val;
                  _t9543 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dp}), ({_tag: 6, _name: "TUnit"})), method_name]}), te.ty);
                  break _t9544;
                }
                if (_t9542._tag === 0) {
                  function _t9545(i) {
                    return _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_9497, i]);
                  }
                  const type_args_9546 = List$init(num_params_9495, _t9545);
                  function _t9548(opt) {
                    let _t9550;
                    const _t9549 = opt;
                    _t9551: {
                      if (_t9549._tag === 1) {
                        const ty = _t9549._val;
                        let _t9553;
                        const _t9552 = Types$repr(ty);
                        _t9554: {
                          if (_t9552._tag === 15 && _t9552._val.contents._tag === 0) {
                            _t9553 = ({_tag: 0, _name: "None"});
                            break _t9554;
                          }
                          if (true) {
                            _t9553 = ({_tag: 1, _name: "Some", _val: ty});
                            break _t9554;
                          }
                          _match_fail("line 16933");
                        }
                        _t9550 = _t9553;
                        break _t9551;
                      }
                      if (_t9549._tag === 0) {
                        _t9550 = ({_tag: 0, _name: "None"});
                        break _t9551;
                      }
                      _match_fail("line 16933");
                    }
                    return _t9550;
                  }
                  const partial_args_9555 = List$map(_t9548, type_args_9546);
                  function _t9557(opt) {
                    return !_eq(opt, ({_tag: 0, _name: "None"}));
                  }
                  const has_info_9558 = List$exists(_t9557, partial_args_9555);
                  let _t9560;
                  if (has_info_9558) {
                    function _t9561(inst) {
                      return ((inst.inst_class === class_def.class_name) && ((List$length(inst.inst_tys) === List$length(partial_args_9555)) && Types$match_partial_inst(inst.inst_tys, partial_args_9555)));
                    }
                    const matching_9562 = List$filter(_t9561, xctx.xf_type_env.instances);
                    function _t9564(opt) {
                      return !_eq(opt, ({_tag: 0, _name: "None"}));
                    }
                    const all_concrete_9565 = List$forall(_t9564, partial_args_9555);
                    let _t9568;
                    const _t9567 = matching_9562;
                    _t9569: {
                      if (_t9567 !== null && _t9567._tl === null) {
                        const inst = _t9567._hd;
                        _t9568 = ({_tag: 1, _name: "Some", _val: inst});
                        break _t9569;
                      }
                      if (_t9567 !== null) {
                        _t9568 = Types$most_specific_inst(matching_9562);
                        break _t9569;
                      }
                      if (_t9567 === null) {
                        _t9568 = ({_tag: 0, _name: "None"});
                        break _t9569;
                      }
                      _match_fail("line 16933");
                    }
                    const resolved_9570 = _t9568;
                    function _t9572(inst) {
                      function _t9573(__p341) {
                        let _t9575;
                        const _t9574 = __p341;
                        _t9576: {
                          if (true) {
                            const n = _t9574[0];
                            _t9575 = (n === method_name);
                            break _t9576;
                          }
                          _match_fail("line 16933");
                        }
                        return _t9575;
                      }
                      let _t9578;
                      const _t9577 = List$find(_t9573, class_def.class_methods);
                      _t9579: {
                        if (_t9577._tag === 1) {
                          const method_ty = _t9577._val[1];
                          function _t9580(ty, __p342) {
                            let _t9582;
                            const _t9581 = __p342;
                            _t9583: {
                              if (true) {
                                const i = _t9581[0];
                                const inst_ty = _t9581[1];
                                function subst(t) {
                                  let _t9585;
                                  const _t9584 = t;
                                  _t9586: {
                                    if (_t9584._tag === 16) {
                                      const j = _t9584._val;
                                      if ((j === i)) {
                                        _t9585 = inst_ty;
                                        break _t9586;
                                      }
                                    }
                                    if (_t9584._tag === 7) {
                                      const a = _t9584._val[0];
                                      const e = _t9584._val[1];
                                      const r = _t9584._val[2];
                                      _t9585 = ({_tag: 7, _name: "TArrow", _val: [subst(a), e, subst(r)]});
                                      break _t9586;
                                    }
                                    if (_t9584._tag === 9) {
                                      const ts = _t9584._val;
                                      _t9585 = ({_tag: 9, _name: "TTuple", _val: List$map(subst, ts)});
                                      break _t9586;
                                    }
                                    if (_t9584._tag === 10) {
                                      const t = _t9584._val;
                                      _t9585 = ({_tag: 10, _name: "TList", _val: subst(t)});
                                      break _t9586;
                                    }
                                    if (_t9584._tag === 13) {
                                      const t = _t9584._val;
                                      _t9585 = ({_tag: 13, _name: "TArray", _val: subst(t)});
                                      break _t9586;
                                    }
                                    if (true) {
                                      _t9585 = t;
                                      break _t9586;
                                    }
                                    _match_fail("line 16933");
                                  }
                                  return _t9585;
                                }
                                const _t9587 = subst(ty);
                                _t9582 = _t9587;
                                break _t9583;
                              }
                              _match_fail("line 16933");
                            }
                            return _t9582;
                          }
                          function _t9588(i, t) {
                            return [i, t];
                          }
                          const concrete_ty_9589 = List$fold(_t9580, method_ty, List$mapi(_t9588, inst.inst_tys));
                          const _t9590 = concrete_ty_9589;
                          _t9578 = _t9590;
                          break _t9579;
                        }
                        if (_t9577._tag === 0) {
                          _t9578 = te.ty;
                          break _t9579;
                        }
                        _match_fail("line 16933");
                      }
                      return _t9578;
                    }
                    const resolve_method_type_9591 = _t9572;
                    let _t9594;
                    const _t9593 = resolved_9570;
                    _t9595: {
                      if (_t9593._tag === 1) {
                        const inst = _t9593._val;
                        if ((!_eq(inst.inst_constraints, null) && all_concrete_9565)) {
                          function _t9596(x) {
                            return x;
                          }
                          const arg_types_9597 = List$filter_map(_t9596, type_args_9546);
                          const factory_9599 = Typechecker$resolve_factory_dict(xctx, inst, arg_types_9597);
                          const resolved_ty_9601 = resolve_method_type_9591(inst);
                          const _t9602 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [factory_9599, method_name]}), resolved_ty_9601);
                          const _t9600 = _t9602;
                          const _t9598 = _t9600;
                          _t9594 = _t9598;
                          break _t9595;
                        }
                      }
                      if (_t9593._tag === 1) {
                        const inst = _t9593._val;
                        if (_eq(inst.inst_constraints, null)) {
                          const resolved_ty_9603 = resolve_method_type_9591(inst);
                          const _t9604 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"})), method_name]}), resolved_ty_9603);
                          _t9594 = _t9604;
                          break _t9595;
                        }
                      }
                      if (true) {
                        _t9594 = te;
                        break _t9595;
                      }
                      _match_fail("line 16933");
                    }
                    const _t9592 = _t9594;
                    const _t9571 = _t9592;
                    const _t9566 = _t9571;
                    const _t9563 = _t9566;
                    _t9560 = _t9563;
                  } else {
                    function _t9605(inst) {
                      return ((inst.inst_class === class_def.class_name) && _eq(inst.inst_constraints, null));
                    }
                    let _t9607;
                    const _t9606 = List$filter(_t9605, xctx.xf_type_env.instances);
                    _t9608: {
                      if (_t9606 !== null && _t9606._tl === null) {
                        const inst = _t9606._hd;
                        _t9607 = ({_tag: 1, _name: "Some", _val: inst});
                        break _t9608;
                      }
                      if (true) {
                        _t9607 = ({_tag: 0, _name: "None"});
                        break _t9608;
                      }
                      _match_fail("line 16933");
                    }
                    const singleton_inst_9609 = _t9607;
                    let _t9612;
                    const _t9611 = singleton_inst_9609;
                    _t9613: {
                      if (_t9611._tag === 1) {
                        const inst = _t9611._val;
                        function _t9614(inst) {
                          function _t9615(__p343) {
                            let _t9617;
                            const _t9616 = __p343;
                            _t9618: {
                              if (true) {
                                const n = _t9616[0];
                                _t9617 = (n === method_name);
                                break _t9618;
                              }
                              _match_fail("line 16933");
                            }
                            return _t9617;
                          }
                          let _t9620;
                          const _t9619 = List$find(_t9615, class_def.class_methods);
                          _t9621: {
                            if (_t9619._tag === 1) {
                              const method_ty = _t9619._val[1];
                              function _t9622(ty, __p344) {
                                let _t9624;
                                const _t9623 = __p344;
                                _t9625: {
                                  if (true) {
                                    const i = _t9623[0];
                                    const inst_ty = _t9623[1];
                                    function subst(t) {
                                      let _t9627;
                                      const _t9626 = t;
                                      _t9628: {
                                        if (_t9626._tag === 16) {
                                          const j = _t9626._val;
                                          if ((j === i)) {
                                            _t9627 = inst_ty;
                                            break _t9628;
                                          }
                                        }
                                        if (_t9626._tag === 7) {
                                          const a = _t9626._val[0];
                                          const e = _t9626._val[1];
                                          const r = _t9626._val[2];
                                          _t9627 = ({_tag: 7, _name: "TArrow", _val: [subst(a), e, subst(r)]});
                                          break _t9628;
                                        }
                                        if (_t9626._tag === 9) {
                                          const ts = _t9626._val;
                                          _t9627 = ({_tag: 9, _name: "TTuple", _val: List$map(subst, ts)});
                                          break _t9628;
                                        }
                                        if (_t9626._tag === 10) {
                                          const t = _t9626._val;
                                          _t9627 = ({_tag: 10, _name: "TList", _val: subst(t)});
                                          break _t9628;
                                        }
                                        if (_t9626._tag === 13) {
                                          const t = _t9626._val;
                                          _t9627 = ({_tag: 13, _name: "TArray", _val: subst(t)});
                                          break _t9628;
                                        }
                                        if (true) {
                                          _t9627 = t;
                                          break _t9628;
                                        }
                                        _match_fail("line 16933");
                                      }
                                      return _t9627;
                                    }
                                    const _t9629 = subst(ty);
                                    _t9624 = _t9629;
                                    break _t9625;
                                  }
                                  _match_fail("line 16933");
                                }
                                return _t9624;
                              }
                              function _t9630(i, t) {
                                return [i, t];
                              }
                              const concrete_ty_9631 = List$fold(_t9622, method_ty, List$mapi(_t9630, inst.inst_tys));
                              const _t9632 = concrete_ty_9631;
                              _t9620 = _t9632;
                              break _t9621;
                            }
                            if (_t9619._tag === 0) {
                              _t9620 = te.ty;
                              break _t9621;
                            }
                            _match_fail("line 16933");
                          }
                          return _t9620;
                        }
                        const resolve_method_type_9633 = _t9614;
                        const resolved_ty_9635 = resolve_method_type_9633(inst);
                        const _t9636 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$mk(({_tag: 7, _name: "TEVar", _val: inst.inst_dict_name}), ({_tag: 6, _name: "TUnit"})), method_name]}), resolved_ty_9635);
                        const _t9634 = _t9636;
                        _t9612 = _t9634;
                        break _t9613;
                      }
                      if (_t9611._tag === 0) {
                        _t9612 = te;
                        break _t9613;
                      }
                      _match_fail("line 16933");
                    }
                    const _t9610 = _t9612;
                    _t9560 = _t9610;
                  }
                  const _t9559 = _t9560;
                  const _t9556 = _t9559;
                  const _t9547 = _t9556;
                  _t9543 = _t9547;
                  break _t9544;
                }
                _match_fail("line 16933");
              }
              const _t9541 = _t9543;
              const _t9511 = _t9541;
              const _t9498 = _t9511;
              const _t9496 = _t9498;
              _t9494 = _t9496;
            }
            const _t9493 = _t9494;
            const _t9488 = _t9493;
            _t9485 = _t9488;
            break _t9486;
          }
          if (_t9484._tag === 0) {
            _t9485 = te;
            break _t9486;
          }
          _match_fail("line 16933");
        }
        _t9482 = _t9485;
        break _t9483;
      }
      _match_fail("line 16933");
    }
    _t9465 = _t9482;
  }
  return _t9465;
}
function Typechecker$xform_constrained_ref(xctx, name, te) {
  let _t9638;
  const _t9637 = List$assoc_opt(name, xctx.xf_schemes);
  _t9639: {
    if (_t9637._tag === 1) {
      const scheme = _t9637._val;
      if (Typechecker$scheme_needs_xform(scheme)) {
        const result_9640 = Ref$create(te);
        let _t9642;
        if (!_eq(scheme.constraints, null)) {
          const tgen_map_9643 = Typechecker$build_tgen_map(scheme.body, te.ty);
          function _t9645(cc) {
            return Typechecker$resolve_dict_arg(xctx, cc, tgen_map_9643);
          }
          const dict_args_9646 = List$map(_t9645, scheme.constraints);
          function _t9648(fn_, dict_arg) {
            return Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_, dict_arg]}), ({_tag: 6, _name: "TUnit"}));
          }
          const _t9647 = Ref$set(result_9640, List$fold(_t9648, Ref$get(result_9640), dict_args_9646));
          const _t9644 = _t9647;
          _t9642 = _t9644;
        } else {
          _t9642 = undefined;
        }
        _t9642;
        let _t9649;
        if (!_eq(scheme.record_evidences, null)) {
          const rgen_map_9650 = Typechecker$build_rgen_map(scheme.body, te.ty);
          function _t9652(re) {
            return Typechecker$resolve_record_evidence_args(xctx, rgen_map_9650, re);
          }
          const ev_args_9653 = List$concat_map(_t9652, scheme.record_evidences);
          function _t9655(fn_, ev_arg) {
            return Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [fn_, ev_arg]}), ({_tag: 6, _name: "TUnit"}));
          }
          const _t9654 = Ref$set(result_9640, List$fold(_t9655, Ref$get(result_9640), ev_args_9653));
          const _t9651 = _t9654;
          _t9649 = _t9651;
        } else {
          _t9649 = undefined;
        }
        _t9649;
        const _t9641 = Ref$get(result_9640);
        _t9638 = _t9641;
        break _t9639;
      }
    }
    if (true) {
      _t9638 = te;
      break _t9639;
    }
    _match_fail("line 16933");
  }
  return _t9638;
}
function Typechecker$resolve_record_evidence_args(xctx, rgen_map, re) {
  let _t9657;
  const _t9656 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rgen_map, re.re_rgen]);
  _t9658: {
    if (_t9656._tag === 1) {
      const arow = _t9656._val;
      const fields_9659 = Types$record_row_to_fields(arow);
      function _t9661(__p345, __p346) {
        let _t9663;
        const _t9662 = __p345;
        _t9664: {
          if (true) {
            const a = _t9662[0];
            let _t9666;
            const _t9665 = __p346;
            _t9667: {
              if (true) {
                const b = _t9665[0];
                _t9666 = String$compare(a, b);
                break _t9667;
              }
              _match_fail("line 16933");
            }
            _t9663 = _t9666;
            break _t9664;
          }
          _match_fail("line 16933");
        }
        return _t9663;
      }
      const sorted_names_9668 = List$map(fst, List$sort(_t9661, fields_9659));
      function is_closed(r) {
        while (true) {
          let _t9671;
          const _t9670 = Types$rrow_repr(r);
          _t9672: {
            if (_t9670._tag === 0) {
              const tail = _t9670._val[2];
              const _t9673 = tail;
              r = _t9673;
              continue;
              _t9671 = undefined;
              break _t9672;
            }
            if (_t9670._tag === 2) {
              _t9671 = true;
              break _t9672;
            }
            if (true) {
              _t9671 = false;
              break _t9672;
            }
            _match_fail("line 16933");
          }
          return _t9671;
        }
      }
      let _t9675;
      if (is_closed(arow)) {
        function _t9676(field_name) {
          const idx_9677 = Ref$create((-1));
          function _t9679(i, n) {
            let _t9680;
            if ((n === field_name)) {
              _t9680 = Ref$set(idx_9677, i);
            } else {
              _t9680 = undefined;
            }
            return _t9680;
          }
          List$iteri(_t9679, sorted_names_9668);
          let _t9681;
          if ((Ref$get(idx_9677) >= 0)) {
            _t9681 = Typechecker$mk(({_tag: 0, _name: "TEInt", _val: Ref$get(idx_9677)}), ({_tag: 0, _name: "TInt"}));
          } else {
            _t9681 = Typechecker$error((("field " + __dict_Show_string.show(field_name)) + " not found in concrete record for evidence"));
          }
          const _t9678 = _t9681;
          return _t9678;
        }
        _t9675 = List$map(_t9676, re.re_fields);
      } else {
        function get_tail(r) {
          while (true) {
            let _t9683;
            const _t9682 = Types$rrow_repr(r);
            _t9684: {
              if (_t9682._tag === 0) {
                const tail = _t9682._val[2];
                const _t9685 = tail;
                r = _t9685;
                continue;
                _t9683 = undefined;
                break _t9684;
              }
              if (true) {
                const tail = _t9682;
                _t9683 = tail;
                break _t9684;
              }
              _match_fail("line 16933");
            }
            return _t9683;
          }
        }
        let _t9688;
        const _t9687 = get_tail(arow);
        _t9689: {
          if (_t9687._tag === 1 && _t9687._val.contents._tag === 0) {
            const id = _t9687._val.contents._val[0];
            function _t9690(field_name) {
              function _t9691(__p347) {
                let _t9693;
                const _t9692 = __p347;
                _t9694: {
                  if (true) {
                    const rid = _t9692[0];
                    const fname = _t9692[1];
                    const pname = _t9692[2];
                    let _t9695;
                    if (((rid === id) && (fname === field_name))) {
                      _t9695 = ({_tag: 1, _name: "Some", _val: pname});
                    } else {
                      _t9695 = ({_tag: 0, _name: "None"});
                    }
                    _t9693 = _t9695;
                    break _t9694;
                  }
                  _match_fail("line 16933");
                }
                return _t9693;
              }
              let _t9697;
              const _t9696 = List$find_map(_t9691, xctx.xf_record_evidence);
              _t9698: {
                if (_t9696._tag === 1) {
                  const pname = _t9696._val;
                  _t9697 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: pname}), ({_tag: 0, _name: "TInt"}));
                  break _t9698;
                }
                if (_t9696._tag === 0) {
                  _t9697 = Typechecker$error((("no evidence for field " + __dict_Show_string.show(field_name)) + " in polymorphic context"));
                  break _t9698;
                }
                _match_fail("line 16933");
              }
              return _t9697;
            }
            _t9688 = List$map(_t9690, re.re_fields);
            break _t9689;
          }
          if (true) {
            _t9688 = Typechecker$error("expected open row for evidence forwarding");
            break _t9689;
          }
          _match_fail("line 16933");
        }
        const _t9686 = _t9688;
        _t9675 = _t9686;
      }
      const _t9674 = _t9675;
      const _t9669 = _t9674;
      const _t9660 = _t9669;
      _t9657 = _t9660;
      break _t9658;
    }
    if (_t9656._tag === 0) {
      _t9657 = Typechecker$error((("internal error: no record evidence for fields [" + __dict_Show_string.show(String$concat(", ", re.re_fields))) + "]"));
      break _t9658;
    }
    _match_fail("line 16933");
  }
  return _t9657;
}
function Typechecker$xform_binop(xctx, op, e1, e2, result_ty) {
  let _t9700;
  const _t9699 = op;
  _t9701: {
    if (_t9699._tag === 0) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Num", "+"]});
      break _t9701;
    }
    if (_t9699._tag === 1) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Num", "-"]});
      break _t9701;
    }
    if (_t9699._tag === 2) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Num", "*"]});
      break _t9701;
    }
    if (_t9699._tag === 3) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Num", "/"]});
      break _t9701;
    }
    if (_t9699._tag === 5) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Eq", "="]});
      break _t9701;
    }
    if (_t9699._tag === 6) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Eq", "<>"]});
      break _t9701;
    }
    if (_t9699._tag === 7) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Ord", "<"]});
      break _t9701;
    }
    if (_t9699._tag === 8) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Ord", ">"]});
      break _t9701;
    }
    if (_t9699._tag === 9) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Ord", "<="]});
      break _t9701;
    }
    if (_t9699._tag === 10) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Ord", ">="]});
      break _t9701;
    }
    if (_t9699._tag === 14) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "land"]});
      break _t9701;
    }
    if (_t9699._tag === 15) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lor"]});
      break _t9701;
    }
    if (_t9699._tag === 16) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lxor"]});
      break _t9701;
    }
    if (_t9699._tag === 17) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lsl"]});
      break _t9701;
    }
    if (_t9699._tag === 18) {
      _t9700 = ({_tag: 1, _name: "Some", _val: ["Bitwise", "lsr"]});
      break _t9701;
    }
    if (true) {
      _t9700 = ({_tag: 0, _name: "None"});
      break _t9701;
    }
    _match_fail("line 16933");
  }
  const class_info_9702 = _t9700;
  let _t9705;
  const _t9704 = class_info_9702;
  _t9706: {
    if (_t9704._tag === 1) {
      const class_name = _t9704._val[0];
      const method_name = _t9704._val[1];
      if (!_eq(xctx.xf_constrained, null)) {
        let _t9708;
        const _t9707 = Types$repr(e1.ty);
        _t9709: {
          if (_t9707._tag === 15 && _t9707._val.contents._tag === 0) {
            const id = _t9707._val.contents._val[0];
            let _t9711;
            const _t9710 = Typechecker$find_constrained_dict(xctx, id, class_name);
            _t9712: {
              if (_t9710._tag === 1) {
                const dparam = _t9710._val;
                const dict_ref_9713 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dparam}), ({_tag: 6, _name: "TUnit"}));
                const method_ref_9715 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [dict_ref_9713, method_name]}), ({_tag: 6, _name: "TUnit"}));
                const app1_9717 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [method_ref_9715, e1]}), ({_tag: 6, _name: "TUnit"}));
                const _t9718 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [app1_9717, e2]}), result_ty);
                const _t9716 = _t9718;
                const _t9714 = _t9716;
                _t9711 = _t9714;
                break _t9712;
              }
              if (_t9710._tag === 0) {
                _t9711 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, e1, e2]}), result_ty);
                break _t9712;
              }
              _match_fail("line 16933");
            }
            _t9708 = _t9711;
            break _t9709;
          }
          if (true) {
            _t9708 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, e1, e2]}), result_ty);
            break _t9709;
          }
          _match_fail("line 16933");
        }
        _t9705 = _t9708;
        break _t9706;
      }
    }
    if (true) {
      _t9705 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, e1, e2]}), result_ty);
      break _t9706;
    }
    _match_fail("line 16933");
  }
  const _t9703 = _t9705;
  return _t9703;
}
function Typechecker$xform_unop(xctx, op, e, result_ty) {
  let _t9720;
  const _t9719 = op;
  _t9721: {
    if (_t9719._tag === 0) {
      _t9720 = ({_tag: 1, _name: "Some", _val: ["Num", "negate"]});
      break _t9721;
    }
    if (true) {
      _t9720 = ({_tag: 0, _name: "None"});
      break _t9721;
    }
    _match_fail("line 16933");
  }
  const class_info_9722 = _t9720;
  let _t9725;
  const _t9724 = class_info_9722;
  _t9726: {
    if (_t9724._tag === 1) {
      const class_name = _t9724._val[0];
      const method_name = _t9724._val[1];
      if (!_eq(xctx.xf_constrained, null)) {
        let _t9728;
        const _t9727 = Types$repr(e.ty);
        _t9729: {
          if (_t9727._tag === 15 && _t9727._val.contents._tag === 0) {
            const id = _t9727._val.contents._val[0];
            let _t9731;
            const _t9730 = Typechecker$find_constrained_dict(xctx, id, class_name);
            _t9732: {
              if (_t9730._tag === 1) {
                const dparam = _t9730._val;
                const dict_ref_9733 = Typechecker$mk(({_tag: 7, _name: "TEVar", _val: dparam}), ({_tag: 6, _name: "TUnit"}));
                const method_ref_9735 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [dict_ref_9733, method_name]}), ({_tag: 6, _name: "TUnit"}));
                const _t9736 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [method_ref_9735, e]}), result_ty);
                const _t9734 = _t9736;
                _t9731 = _t9734;
                break _t9732;
              }
              if (_t9730._tag === 0) {
                _t9731 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, e]}), result_ty);
                break _t9732;
              }
              _match_fail("line 16933");
            }
            _t9728 = _t9731;
            break _t9729;
          }
          if (true) {
            _t9728 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, e]}), result_ty);
            break _t9729;
          }
          _match_fail("line 16933");
        }
        _t9725 = _t9728;
        break _t9726;
      }
    }
    if (true) {
      _t9725 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, e]}), result_ty);
      break _t9726;
    }
    _match_fail("line 16933");
  }
  const _t9723 = _t9725;
  return _t9723;
}
function Typechecker$xform_constrained_def(xctx, scheme, te) {
  const tgen_map_9737 = Typechecker$build_tgen_map(scheme.body, te.ty);
  function _t9739(__p348, cc) {
    let _t9741;
    const _t9740 = __p348;
    _t9742: {
      if (true) {
        const entries = _t9740[0];
        const params = _t9740[1];
        function _t9743(ca) {
          let _t9745;
          const _t9744 = ca;
          _t9746: {
            if (_t9744._tag === 0) {
              const tgen_idx = _t9744._val;
              let _t9748;
              const _t9747 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, tgen_map_9737, tgen_idx]);
              _t9749: {
                if (_t9747._tag === 1 && _t9747._val._tag === 15 && _t9747._val._val.contents._tag === 0) {
                  const id = _t9747._val._val.contents._val[0];
                  _t9748 = ({_tag: 1, _name: "Some", _val: [id, tgen_idx]});
                  break _t9749;
                }
                if (true) {
                  _t9748 = ({_tag: 0, _name: "None"});
                  break _t9749;
                }
                _match_fail("line 16933");
              }
              _t9745 = _t9748;
              break _t9746;
            }
            if (_t9744._tag === 1) {
              const ty = _t9744._val;
              let _t9751;
              const _t9750 = Types$repr(ty);
              _t9752: {
                if (_t9750._tag === 15 && _t9750._val.contents._tag === 0) {
                  const id = _t9750._val.contents._val[0];
                  _t9751 = ({_tag: 1, _name: "Some", _val: [id, (1000 + id)]});
                  break _t9752;
                }
                if (true) {
                  _t9751 = ({_tag: 0, _name: "None"});
                  break _t9752;
                }
                _match_fail("line 16933");
              }
              _t9745 = _t9751;
              break _t9746;
            }
            if (_t9744._tag === 2) {
              _t9745 = ({_tag: 0, _name: "None"});
              break _t9746;
            }
            if (_t9744._tag === 3) {
              const tv = _t9744._val[1];
              let _t9754;
              const _t9753 = Types$repr(tv);
              _t9755: {
                if (_t9753._tag === 15 && _t9753._val.contents._tag === 0) {
                  const id = _t9753._val.contents._val[0];
                  _t9754 = ({_tag: 1, _name: "Some", _val: [id, (1000 + id)]});
                  break _t9755;
                }
                if (true) {
                  _t9754 = ({_tag: 0, _name: "None"});
                  break _t9755;
                }
                _match_fail("line 16933");
              }
              _t9745 = _t9754;
              break _t9746;
            }
            _match_fail("line 16933");
          }
          return _t9745;
        }
        const tvar_entries_9756 = List$filter_map(_t9743, cc.cc_args);
        let _t9759;
        const _t9758 = tvar_entries_9756;
        _t9760: {
          if (_t9758 === null) {
            const dparam_9761 = ((("__dict_" + __dict_Show_string.show(cc.cc_class)) + "_resolved_") + __dict_Show_int.show(List$length(params)));
            const _t9762 = [entries, ({_hd: dparam_9761, _tl: params})];
            _t9759 = _t9762;
            break _t9760;
          }
          if (true) {
            function _t9763(__p349) {
              let _t9765;
              const _t9764 = __p349;
              _t9766: {
                if (true) {
                  const idx = _t9764[1];
                  _t9765 = string_of_int(idx);
                  break _t9766;
                }
                _match_fail("line 16933");
              }
              return _t9765;
            }
            const dparam_9767 = ((("__dict_" + __dict_Show_string.show(cc.cc_class)) + "_") + __dict_Show_string.show(String$concat("_", List$map(_t9763, tvar_entries_9756))));
            function _t9769(__p350) {
              let _t9771;
              const _t9770 = __p350;
              _t9772: {
                if (true) {
                  const id = _t9770[0];
                  _t9771 = [id, dparam_9767, cc.cc_class];
                  break _t9772;
                }
                _match_fail("line 16933");
              }
              return _t9771;
            }
            const new_entries_9773 = List$map(_t9769, tvar_entries_9756);
            const _t9774 = [List$concat(new_entries_9773, entries), ({_hd: dparam_9767, _tl: params})];
            const _t9768 = _t9774;
            _t9759 = _t9768;
            break _t9760;
          }
          _match_fail("line 16933");
        }
        const _t9757 = _t9759;
        _t9741 = _t9757;
        break _t9742;
      }
      _match_fail("line 16933");
    }
    return _t9741;
  }
  let _t9776;
  const _t9775 = List$fold(_t9739, [null, null], scheme.constraints);
  _t9777: {
    if (true) {
      const all_constrained = _t9775[0];
      const dict_param_names = _t9775[1];
      const dict_param_names_9778 = List$rev(dict_param_names);
      const rgen_map_9780 = Typechecker$build_rgen_map(scheme.body, te.ty);
      function _t9782(__p351, re) {
        let _t9784;
        const _t9783 = __p351;
        _t9785: {
          if (true) {
            const entries = _t9783[0];
            const params = _t9783[1];
            function _t9786(__p352, field_name) {
              let _t9788;
              const _t9787 = __p352;
              _t9789: {
                if (true) {
                  const entries = _t9787[0];
                  const params = _t9787[1];
                  const pname_9790 = ((("__ev_" + __dict_Show_string.show(field_name)) + "_r") + __dict_Show_int.show(re.re_rgen));
                  let _t9793;
                  const _t9792 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, rgen_map_9780, re.re_rgen]);
                  _t9794: {
                    if (_t9792._tag === 1) {
                      const arow = _t9792._val;
                      function get_tail(r) {
                        while (true) {
                          let _t9796;
                          const _t9795 = Types$rrow_repr(r);
                          _t9797: {
                            if (_t9795._tag === 0) {
                              const tail = _t9795._val[2];
                              const _t9798 = tail;
                              r = _t9798;
                              continue;
                              _t9796 = undefined;
                              break _t9797;
                            }
                            if (true) {
                              const tail = _t9795;
                              _t9796 = tail;
                              break _t9797;
                            }
                            _match_fail("line 16933");
                          }
                          return _t9796;
                        }
                      }
                      let _t9801;
                      const _t9800 = get_tail(arow);
                      _t9802: {
                        if (_t9800._tag === 1 && _t9800._val.contents._tag === 0) {
                          const id = _t9800._val.contents._val[0];
                          _t9801 = ({_hd: [id, field_name, pname_9790], _tl: null});
                          break _t9802;
                        }
                        if (true) {
                          _t9801 = null;
                          break _t9802;
                        }
                        _match_fail("line 16933");
                      }
                      const _t9799 = _t9801;
                      _t9793 = _t9799;
                      break _t9794;
                    }
                    if (_t9792._tag === 0) {
                      _t9793 = null;
                      break _t9794;
                    }
                    _match_fail("line 16933");
                  }
                  const rvar_entries_9803 = _t9793;
                  const _t9804 = [List$concat(rvar_entries_9803, entries), ({_hd: pname_9790, _tl: params})];
                  const _t9791 = _t9804;
                  _t9788 = _t9791;
                  break _t9789;
                }
                _match_fail("line 16933");
              }
              return _t9788;
            }
            _t9784 = List$fold(_t9786, [entries, params], re.re_fields);
            break _t9785;
          }
          _match_fail("line 16933");
        }
        return _t9784;
      }
      let _t9806;
      const _t9805 = List$fold(_t9782, [null, null], scheme.record_evidences);
      _t9807: {
        if (true) {
          const all_record_ev = _t9805[0];
          const ev_param_names = _t9805[1];
          const ev_param_names_9808 = List$rev(ev_param_names);
          const __rec_upd_9810 = xctx;
          const _t9811 = ({xf_constrained: List$concat(all_constrained, xctx.xf_constrained), xf_locals: __rec_upd_9810.xf_locals, xf_record_evidence: List$concat(all_record_ev, xctx.xf_record_evidence), xf_schemes: __rec_upd_9810.xf_schemes, xf_type_env: __rec_upd_9810.xf_type_env});
          const xctx_9812 = _t9811;
          const rewritten_9814 = Typechecker$xform_expr(xctx_9812, te);
          const all_params_9816 = List$concat(dict_param_names_9778, ev_param_names_9808);
          function _t9818(dparam, body) {
            return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [dparam, body, false]}), ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), body.ty]}));
          }
          const _t9817 = List$fold_right(_t9818, all_params_9816, rewritten_9814);
          const _t9815 = _t9817;
          const _t9813 = _t9815;
          const _t9809 = _t9813;
          _t9806 = _t9809;
          break _t9807;
        }
        _match_fail("line 16933");
      }
      const _t9781 = _t9806;
      const _t9779 = _t9781;
      _t9776 = _t9779;
      break _t9777;
    }
    _match_fail("line 16933");
  }
  const _t9738 = _t9776;
  return _t9738;
}
function Typechecker$xform_constrained_inst(xctx, inst_def, dict_expr) {
  let _t9820;
  const _t9819 = dict_expr.expr;
  _t9821: {
    if (_t9819._tag === 16) {
      const fs = _t9819._val;
      _t9820 = fs;
      break _t9821;
    }
    if (true) {
      _t9820 = failwith("assert false");
      break _t9821;
    }
    _match_fail("line 16933");
  }
  let _t9823;
  const _t9822 = Types$find_method_class(xctx.xf_type_env.classes, fst(List$hd(_t9820)));
  _t9824: {
    if (_t9822._tag === 1) {
      const cd = _t9822._val;
      if ((cd.class_name === inst_def.inst_class)) {
        _t9823 = cd;
        break _t9824;
      }
    }
    if (true) {
      function _t9825(c) {
        return (c.class_name === inst_def.inst_class);
      }
      let _t9827;
      const _t9826 = List$find(_t9825, xctx.xf_type_env.classes);
      _t9828: {
        if (_t9826._tag === 1) {
          const cd = _t9826._val;
          _t9827 = cd;
          break _t9828;
        }
        if (_t9826._tag === 0) {
          _t9827 = Typechecker$error((("class " + __dict_Show_string.show(inst_def.inst_class)) + " not found"));
          break _t9828;
        }
        _match_fail("line 16933");
      }
      _t9823 = _t9827;
      break _t9824;
    }
    _match_fail("line 16933");
  }
  const class_def_9829 = _t9823;
  const class_param_map_9831 = Hashtbl$create(4);
  const inst_tvar_map_9833 = Hashtbl$create(4);
  let _t9836;
  const _t9835 = dict_expr.expr;
  _t9837: {
    if (_t9835._tag === 16) {
      const fields = _t9835._val;
      function _t9838(__p353) {
        let _t9840;
        const _t9839 = __p353;
        _t9841: {
          if (true) {
            const mname = _t9839[0];
            const mte = _t9839[1];
            let _t9843;
            const _t9842 = List$assoc_opt(mname, class_def_9829.class_methods);
            _t9844: {
              if (_t9842._tag === 1) {
                const class_method_ty = _t9842._val;
                function walk_class(s, a) {
                  while (true) {
                    const a_9845 = Types$repr(a);
                    let _t9848;
                    const _t9847 = s;
                    _t9849: {
                      if (_t9847._tag === 16) {
                        const i = _t9847._val;
                        let _t9850;
                        if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, class_param_map_9831, i]))) {
                          _t9850 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, class_param_map_9831, i, a_9845]);
                        } else {
                          _t9850 = undefined;
                        }
                        _t9848 = _t9850;
                        break _t9849;
                      }
                      if (_t9847._tag === 7) {
                        const s1 = _t9847._val[0];
                        const s2 = _t9847._val[2];
                        let _t9852;
                        const _t9851 = a_9845;
                        _t9853: {
                          if (_t9851._tag === 7) {
                            const a1 = _t9851._val[0];
                            const a2 = _t9851._val[2];
                            walk_class(s1, a1);
                            const _t9854 = s2;
                            const _t9855 = a2;
                            s = _t9854;
                            a = _t9855;
                            continue;
                            _t9852 = undefined;
                            break _t9853;
                          }
                          if (true) {
                            _t9852 = undefined;
                            break _t9853;
                          }
                          _match_fail("line 16933");
                        }
                        _t9848 = _t9852;
                        break _t9849;
                      }
                      if (_t9847._tag === 8) {
                        const s1 = _t9847._val[0];
                        const s2 = _t9847._val[2];
                        let _t9857;
                        const _t9856 = a_9845;
                        _t9858: {
                          if (_t9856._tag === 8) {
                            const a1 = _t9856._val[0];
                            const a2 = _t9856._val[2];
                            walk_class(s1, a1);
                            const _t9859 = s2;
                            const _t9860 = a2;
                            s = _t9859;
                            a = _t9860;
                            continue;
                            _t9857 = undefined;
                            break _t9858;
                          }
                          if (true) {
                            _t9857 = undefined;
                            break _t9858;
                          }
                          _match_fail("line 16933");
                        }
                        _t9848 = _t9857;
                        break _t9849;
                      }
                      if (_t9847._tag === 9) {
                        const ss = _t9847._val;
                        let _t9862;
                        const _t9861 = a_9845;
                        _t9863: {
                          if (_t9861._tag === 9) {
                            const aa = _t9861._val;
                            if ((List$length(ss) === List$length(aa))) {
                              _t9862 = List$iter2(walk_class, ss, aa);
                              break _t9863;
                            }
                          }
                          if (true) {
                            _t9862 = undefined;
                            break _t9863;
                          }
                          _match_fail("line 16933");
                        }
                        _t9848 = _t9862;
                        break _t9849;
                      }
                      if (_t9847._tag === 10) {
                        const s1 = _t9847._val;
                        let _t9865;
                        const _t9864 = a_9845;
                        _t9866: {
                          if (_t9864._tag === 10) {
                            const a1 = _t9864._val;
                            const _t9867 = s1;
                            const _t9868 = a1;
                            s = _t9867;
                            a = _t9868;
                            continue;
                            _t9865 = undefined;
                            break _t9866;
                          }
                          if (true) {
                            _t9865 = undefined;
                            break _t9866;
                          }
                          _match_fail("line 16933");
                        }
                        _t9848 = _t9865;
                        break _t9849;
                      }
                      if (_t9847._tag === 13) {
                        const s1 = _t9847._val;
                        let _t9870;
                        const _t9869 = a_9845;
                        _t9871: {
                          if (_t9869._tag === 13) {
                            const a1 = _t9869._val;
                            const _t9872 = s1;
                            const _t9873 = a1;
                            s = _t9872;
                            a = _t9873;
                            continue;
                            _t9870 = undefined;
                            break _t9871;
                          }
                          if (true) {
                            _t9870 = undefined;
                            break _t9871;
                          }
                          _match_fail("line 16933");
                        }
                        _t9848 = _t9870;
                        break _t9849;
                      }
                      if (_t9847._tag === 12) {
                        const ss = _t9847._val[1];
                        let _t9875;
                        const _t9874 = a_9845;
                        _t9876: {
                          if (_t9874._tag === 12) {
                            const aa = _t9874._val[1];
                            if ((List$length(ss) === List$length(aa))) {
                              _t9875 = List$iter2(walk_class, ss, aa);
                              break _t9876;
                            }
                          }
                          if (true) {
                            _t9875 = undefined;
                            break _t9876;
                          }
                          _match_fail("line 16933");
                        }
                        _t9848 = _t9875;
                        break _t9849;
                      }
                      if (true) {
                        _t9848 = undefined;
                        break _t9849;
                      }
                      _match_fail("line 16933");
                    }
                    const _t9846 = _t9848;
                    return _t9846;
                  }
                }
                const _t9877 = walk_class(class_method_ty, mte.ty);
                _t9843 = _t9877;
                break _t9844;
              }
              if (_t9842._tag === 0) {
                _t9843 = undefined;
                break _t9844;
              }
              _match_fail("line 16933");
            }
            _t9840 = _t9843;
            break _t9841;
          }
          _match_fail("line 16933");
        }
        return _t9840;
      }
      List$iter(_t9838, fields);
      function _t9878(class_idx, stored_ty) {
        let _t9880;
        const _t9879 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, class_param_map_9831, class_idx]);
        _t9881: {
          if (_t9879._tag === 1) {
            const actual_ty = _t9879._val;
            function walk_inst(s, a) {
              while (true) {
                const a_9882 = Types$repr(a);
                let _t9885;
                const _t9884 = s;
                _t9886: {
                  if (_t9884._tag === 16) {
                    const i = _t9884._val;
                    let _t9887;
                    if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, inst_tvar_map_9833, i]))) {
                      let _t9889;
                      const _t9888 = a_9882;
                      _t9890: {
                        if (_t9888._tag === 15 && _t9888._val.contents._tag === 0) {
                          const id = _t9888._val.contents._val[0];
                          _t9889 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, inst_tvar_map_9833, i, id]);
                          break _t9890;
                        }
                        if (true) {
                          _t9889 = undefined;
                          break _t9890;
                        }
                        _match_fail("line 16933");
                      }
                      _t9887 = _t9889;
                    } else {
                      _t9887 = undefined;
                    }
                    _t9885 = _t9887;
                    break _t9886;
                  }
                  if (_t9884._tag === 7) {
                    const s1 = _t9884._val[0];
                    const s2 = _t9884._val[2];
                    let _t9892;
                    const _t9891 = a_9882;
                    _t9893: {
                      if (_t9891._tag === 7) {
                        const a1 = _t9891._val[0];
                        const a2 = _t9891._val[2];
                        walk_inst(s1, a1);
                        const _t9894 = s2;
                        const _t9895 = a2;
                        s = _t9894;
                        a = _t9895;
                        continue;
                        _t9892 = undefined;
                        break _t9893;
                      }
                      if (true) {
                        _t9892 = undefined;
                        break _t9893;
                      }
                      _match_fail("line 16933");
                    }
                    _t9885 = _t9892;
                    break _t9886;
                  }
                  if (_t9884._tag === 8) {
                    const s1 = _t9884._val[0];
                    const s2 = _t9884._val[2];
                    let _t9897;
                    const _t9896 = a_9882;
                    _t9898: {
                      if (_t9896._tag === 8) {
                        const a1 = _t9896._val[0];
                        const a2 = _t9896._val[2];
                        walk_inst(s1, a1);
                        const _t9899 = s2;
                        const _t9900 = a2;
                        s = _t9899;
                        a = _t9900;
                        continue;
                        _t9897 = undefined;
                        break _t9898;
                      }
                      if (true) {
                        _t9897 = undefined;
                        break _t9898;
                      }
                      _match_fail("line 16933");
                    }
                    _t9885 = _t9897;
                    break _t9886;
                  }
                  if (_t9884._tag === 9) {
                    const ss = _t9884._val;
                    let _t9902;
                    const _t9901 = a_9882;
                    _t9903: {
                      if (_t9901._tag === 9) {
                        const aa = _t9901._val;
                        if ((List$length(ss) === List$length(aa))) {
                          _t9902 = List$iter2(walk_inst, ss, aa);
                          break _t9903;
                        }
                      }
                      if (true) {
                        _t9902 = undefined;
                        break _t9903;
                      }
                      _match_fail("line 16933");
                    }
                    _t9885 = _t9902;
                    break _t9886;
                  }
                  if (_t9884._tag === 10) {
                    const s1 = _t9884._val;
                    let _t9905;
                    const _t9904 = a_9882;
                    _t9906: {
                      if (_t9904._tag === 10) {
                        const a1 = _t9904._val;
                        const _t9907 = s1;
                        const _t9908 = a1;
                        s = _t9907;
                        a = _t9908;
                        continue;
                        _t9905 = undefined;
                        break _t9906;
                      }
                      if (true) {
                        _t9905 = undefined;
                        break _t9906;
                      }
                      _match_fail("line 16933");
                    }
                    _t9885 = _t9905;
                    break _t9886;
                  }
                  if (_t9884._tag === 13) {
                    const s1 = _t9884._val;
                    let _t9910;
                    const _t9909 = a_9882;
                    _t9911: {
                      if (_t9909._tag === 13) {
                        const a1 = _t9909._val;
                        const _t9912 = s1;
                        const _t9913 = a1;
                        s = _t9912;
                        a = _t9913;
                        continue;
                        _t9910 = undefined;
                        break _t9911;
                      }
                      if (true) {
                        _t9910 = undefined;
                        break _t9911;
                      }
                      _match_fail("line 16933");
                    }
                    _t9885 = _t9910;
                    break _t9886;
                  }
                  if (_t9884._tag === 12) {
                    const ss = _t9884._val[1];
                    let _t9915;
                    const _t9914 = a_9882;
                    _t9916: {
                      if (_t9914._tag === 12) {
                        const aa = _t9914._val[1];
                        if ((List$length(ss) === List$length(aa))) {
                          _t9915 = List$iter2(walk_inst, ss, aa);
                          break _t9916;
                        }
                      }
                      if (true) {
                        _t9915 = undefined;
                        break _t9916;
                      }
                      _match_fail("line 16933");
                    }
                    _t9885 = _t9915;
                    break _t9886;
                  }
                  if (true) {
                    _t9885 = undefined;
                    break _t9886;
                  }
                  _match_fail("line 16933");
                }
                const _t9883 = _t9885;
                return _t9883;
              }
            }
            const _t9917 = walk_inst(stored_ty, actual_ty);
            _t9880 = _t9917;
            break _t9881;
          }
          if (_t9879._tag === 0) {
            _t9880 = undefined;
            break _t9881;
          }
          _match_fail("line 16933");
        }
        return _t9880;
      }
      _t9836 = List$iteri(_t9878, inst_def.inst_tys);
      break _t9837;
    }
    if (true) {
      _t9836 = undefined;
      break _t9837;
    }
    _match_fail("line 16933");
  }
  _t9836;
  function _t9918(__p354, cc) {
    let _t9920;
    const _t9919 = __p354;
    _t9921: {
      if (true) {
        const entries = _t9919[0];
        const params = _t9919[1];
        function _t9922(ca) {
          let _t9924;
          const _t9923 = ca;
          _t9925: {
            if (_t9923._tag === 0) {
              const tgen_idx = _t9923._val;
              let _t9927;
              const _t9926 = _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, inst_tvar_map_9833, tgen_idx]);
              _t9928: {
                if (_t9926._tag === 1) {
                  const tvar_id = _t9926._val;
                  _t9927 = ({_tag: 1, _name: "Some", _val: [tvar_id, tgen_idx]});
                  break _t9928;
                }
                if (_t9926._tag === 0) {
                  _t9927 = ({_tag: 0, _name: "None"});
                  break _t9928;
                }
                _match_fail("line 16933");
              }
              _t9924 = _t9927;
              break _t9925;
            }
            if (_t9923._tag === 1) {
              _t9924 = ({_tag: 0, _name: "None"});
              break _t9925;
            }
            if (_t9923._tag === 2) {
              _t9924 = ({_tag: 0, _name: "None"});
              break _t9925;
            }
            if (_t9923._tag === 3) {
              _t9924 = ({_tag: 0, _name: "None"});
              break _t9925;
            }
            _match_fail("line 16933");
          }
          return _t9924;
        }
        const tvar_entries_9929 = List$filter_map(_t9922, cc.cc_args);
        let _t9932;
        const _t9931 = tvar_entries_9929;
        _t9933: {
          if (_t9931 === null) {
            _t9932 = [entries, params];
            break _t9933;
          }
          if (true) {
            function _t9934(__p355) {
              let _t9936;
              const _t9935 = __p355;
              _t9937: {
                if (true) {
                  const idx = _t9935[1];
                  _t9936 = string_of_int(idx);
                  break _t9937;
                }
                _match_fail("line 16933");
              }
              return _t9936;
            }
            const dparam_9938 = ((("__dict_" + __dict_Show_string.show(cc.cc_class)) + "_") + __dict_Show_string.show(String$concat("_", List$map(_t9934, tvar_entries_9929))));
            function _t9940(__p356) {
              let _t9942;
              const _t9941 = __p356;
              _t9943: {
                if (true) {
                  const id = _t9941[0];
                  _t9942 = [id, dparam_9938, cc.cc_class];
                  break _t9943;
                }
                _match_fail("line 16933");
              }
              return _t9942;
            }
            const new_entries_9944 = List$map(_t9940, tvar_entries_9929);
            const _t9945 = [List$concat(new_entries_9944, entries), ({_hd: dparam_9938, _tl: params})];
            const _t9939 = _t9945;
            _t9932 = _t9939;
            break _t9933;
          }
          _match_fail("line 16933");
        }
        const _t9930 = _t9932;
        _t9920 = _t9930;
        break _t9921;
      }
      _match_fail("line 16933");
    }
    return _t9920;
  }
  let _t9947;
  const _t9946 = List$fold(_t9918, [null, null], inst_def.inst_constraints);
  _t9948: {
    if (true) {
      const all_constrained = _t9946[0];
      const dict_param_names = _t9946[1];
      const dict_param_names_9949 = List$rev(dict_param_names);
      const __rec_upd_9951 = xctx;
      const _t9952 = ({xf_constrained: List$concat(all_constrained, xctx.xf_constrained), xf_locals: __rec_upd_9951.xf_locals, xf_record_evidence: __rec_upd_9951.xf_record_evidence, xf_schemes: __rec_upd_9951.xf_schemes, xf_type_env: __rec_upd_9951.xf_type_env});
      const xctx_9953 = _t9952;
      const rewritten_9955 = Typechecker$xform_expr(xctx_9953, dict_expr);
      function _t9957(dparam, body) {
        return Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [dparam, body, false]}), ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), body.ty]}));
      }
      const _t9956 = List$fold_right(_t9957, dict_param_names_9949, rewritten_9955);
      const _t9954 = _t9956;
      const _t9950 = _t9954;
      _t9947 = _t9950;
      break _t9948;
    }
    _match_fail("line 16933");
  }
  const _t9834 = _t9947;
  const _t9832 = _t9834;
  const _t9830 = _t9832;
  return _t9830;
}
function Typechecker$apply_fundep_improvement(type_env, vars, tprog) {
  function _t9958(tdecl) {
    let _t9960;
    const _t9959 = tdecl;
    _t9961: {
      if ((((_t9959._tag === 0 || _t9959._tag === 2) || _t9959._tag === 5) || _t9959._tag === 1)) {
        const te = (((_t9959._tag === 0 || _t9959._tag === 2) || _t9959._tag === 5) ? ((_t9959._tag === 0 || _t9959._tag === 2) ? _t9959._val[1] : _t9959._val) : _t9959._val[1]);
        _t9960 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
        break _t9961;
      }
      if (_t9959._tag === 3) {
        const bindings = _t9959._val;
        function _t9962(__p357) {
          let _t9964;
          const _t9963 = __p357;
          _t9965: {
            if (true) {
              const te = _t9963[1];
              _t9964 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
              break _t9965;
            }
            _match_fail("line 16933");
          }
          return _t9964;
        }
        _t9960 = List$iter(_t9962, bindings);
        break _t9961;
      }
      if (_t9959._tag === 9) {
        const decls = _t9959._val[1];
        function _t9966(d) {
          let _t9968;
          const _t9967 = d;
          _t9969: {
            if ((((_t9967._tag === 0 || _t9967._tag === 2) || _t9967._tag === 5) || _t9967._tag === 1)) {
              const te = (((_t9967._tag === 0 || _t9967._tag === 2) || _t9967._tag === 5) ? ((_t9967._tag === 0 || _t9967._tag === 2) ? _t9967._val[1] : _t9967._val) : _t9967._val[1]);
              _t9968 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
              break _t9969;
            }
            if (_t9967._tag === 3) {
              const bindings = _t9967._val;
              function _t9970(__p358) {
                let _t9972;
                const _t9971 = __p358;
                _t9973: {
                  if (true) {
                    const te = _t9971[1];
                    _t9972 = Typechecker$improve_fundeps_in_expr(vars, type_env, te);
                    break _t9973;
                  }
                  _match_fail("line 16933");
                }
                return _t9972;
              }
              _t9968 = List$iter(_t9970, bindings);
              break _t9969;
            }
            if (true) {
              _t9968 = undefined;
              break _t9969;
            }
            _match_fail("line 16933");
          }
          return _t9968;
        }
        _t9960 = List$iter(_t9966, decls);
        break _t9961;
      }
      if (true) {
        _t9960 = undefined;
        break _t9961;
      }
      _match_fail("line 16933");
    }
    return _t9960;
  }
  return List$iter(_t9958, tprog);
}
function Typechecker$transform_constraints(ctx, tprog) {
  Typechecker$apply_fundep_improvement(ctx.type_env, ctx.vars, tprog);
  const xctx_9974 = ({xf_constrained: null, xf_locals: null, xf_record_evidence: null, xf_schemes: ctx.vars, xf_type_env: ctx.type_env});
  function _t9976(xctx, tdecl) {
    let _t9978;
    const _t9977 = tdecl;
    _t9979: {
      if (_t9977._tag === 0) {
        const name = _t9977._val[0];
        const te = _t9977._val[1];
        let _t9981;
        const _t9980 = List$assoc_opt(name, xctx.xf_schemes);
        _t9982: {
          if (_t9980._tag === 1) {
            const scheme = _t9980._val;
            if (Typechecker$scheme_needs_xform(scheme)) {
              _t9981 = ({_tag: 0, _name: "TDLet", _val: [name, Typechecker$xform_constrained_def(xctx, scheme, te)]});
              break _t9982;
            }
          }
          if (true) {
            function _t9983(i) {
              return ((i.inst_dict_name === name) && !_eq(i.inst_constraints, null));
            }
            const inst_9984 = List$find(_t9983, xctx.xf_type_env.instances);
            let _t9987;
            const _t9986 = inst_9984;
            _t9988: {
              if (_t9986._tag === 1) {
                const inst_def = _t9986._val;
                _t9987 = ({_tag: 0, _name: "TDLet", _val: [name, Typechecker$xform_constrained_inst(xctx, inst_def, te)]});
                break _t9988;
              }
              if (_t9986._tag === 0) {
                _t9987 = ({_tag: 0, _name: "TDLet", _val: [name, Typechecker$xform_expr(xctx, te)]});
                break _t9988;
              }
              _match_fail("line 16933");
            }
            const _t9985 = _t9987;
            _t9981 = _t9985;
            break _t9982;
          }
          _match_fail("line 16933");
        }
        _t9978 = _t9981;
        break _t9979;
      }
      if (_t9977._tag === 2) {
        const name = _t9977._val[0];
        const te = _t9977._val[1];
        let _t9990;
        const _t9989 = List$assoc_opt(name, xctx.xf_schemes);
        _t9991: {
          if (_t9989._tag === 1) {
            const scheme = _t9989._val;
            if (Typechecker$scheme_needs_xform(scheme)) {
              _t9990 = ({_tag: 2, _name: "TDLetRec", _val: [name, Typechecker$xform_constrained_def(xctx, scheme, te)]});
              break _t9991;
            }
          }
          if (true) {
            _t9990 = ({_tag: 2, _name: "TDLetRec", _val: [name, Typechecker$xform_expr(xctx, te)]});
            break _t9991;
          }
          _match_fail("line 16933");
        }
        _t9978 = _t9990;
        break _t9979;
      }
      if (_t9977._tag === 3) {
        const bindings = _t9977._val;
        function _t9992(__p359) {
          let _t9994;
          const _t9993 = __p359;
          _t9995: {
            if (true) {
              const n = _t9993[0];
              const te = _t9993[1];
              let _t9997;
              const _t9996 = List$assoc_opt(n, xctx.xf_schemes);
              _t9998: {
                if (_t9996._tag === 1) {
                  const scheme = _t9996._val;
                  if (Typechecker$scheme_needs_xform(scheme)) {
                    _t9997 = [n, Typechecker$xform_constrained_def(xctx, scheme, te)];
                    break _t9998;
                  }
                }
                if (true) {
                  _t9997 = [n, Typechecker$xform_expr(xctx, te)];
                  break _t9998;
                }
                _match_fail("line 16933");
              }
              _t9994 = _t9997;
              break _t9995;
            }
            _match_fail("line 16933");
          }
          return _t9994;
        }
        _t9978 = ({_tag: 3, _name: "TDLetRecAnd", _val: List$map(_t9992, bindings)});
        break _t9979;
      }
      if (_t9977._tag === 5) {
        const te = _t9977._val;
        _t9978 = ({_tag: 5, _name: "TDExpr", _val: Typechecker$xform_expr(xctx, te)});
        break _t9979;
      }
      if (_t9977._tag === 1) {
        const name = _t9977._val[0];
        const te = _t9977._val[1];
        _t9978 = ({_tag: 1, _name: "TDLetMut", _val: [name, Typechecker$xform_expr(xctx, te)]});
        break _t9979;
      }
      if (true) {
        const other = _t9977;
        _t9978 = other;
        break _t9979;
      }
      _match_fail("line 16933");
    }
    return _t9978;
  }
  const xform_decl_9999 = _t9976;
  function _t10001(tdecl) {
    let _t10003;
    const _t10002 = tdecl;
    _t10004: {
      if (((_t10002._tag === 0 || _t10002._tag === 2) || _t10002._tag === 1)) {
        const name = _t10002._val[0];
        _t10003 = ({_hd: name, _tl: null});
        break _t10004;
      }
      if (_t10002._tag === 3) {
        const bindings = _t10002._val;
        _t10003 = List$map(fst, bindings);
        break _t10004;
      }
      if (true) {
        _t10003 = null;
        break _t10004;
      }
      _match_fail("line 16933");
    }
    return _t10003;
  }
  const decl_names_10005 = _t10001;
  function _t10007(xctx, tdecl) {
    let _t10009;
    const _t10008 = tdecl;
    _t10010: {
      if (_t10008._tag === 10) {
        const alias_pairs = _t10008._val;
        function _t10011(schemes, __p360) {
          let _t10013;
          const _t10012 = __p360;
          _t10014: {
            if (true) {
              const dst = _t10012[0];
              const src = _t10012[1];
              let _t10016;
              const _t10015 = List$assoc_opt(src, schemes);
              _t10017: {
                if (_t10015._tag === 1) {
                  const scheme = _t10015._val;
                  _t10016 = ({_hd: [dst, scheme], _tl: schemes});
                  break _t10017;
                }
                if (_t10015._tag === 0) {
                  _t10016 = schemes;
                  break _t10017;
                }
                _match_fail("line 16933");
              }
              _t10013 = _t10016;
              break _t10014;
            }
            _match_fail("line 16933");
          }
          return _t10013;
        }
        _t10009 = List$fold(_t10011, xctx.xf_schemes, alias_pairs);
        break _t10010;
      }
      if (true) {
        _t10009 = xctx.xf_schemes;
        break _t10010;
      }
      _match_fail("line 16933");
    }
    return _t10009;
  }
  const open_schemes_10018 = _t10007;
  function xform_decls(xctx, __x) {
    let _t10021;
    const _t10020 = __x;
    _t10022: {
      if (_t10020 === null) {
        _t10021 = null;
        break _t10022;
      }
      if (_t10020 !== null) {
        const tdecl = _t10020._hd;
        const rest = _t10020._tl;
        let _t10024;
        const _t10023 = tdecl;
        _t10025: {
          if (_t10023._tag === 9) {
            const name = _t10023._val[0];
            const decls = _t10023._val[1];
            _t10024 = ({_tag: 9, _name: "TDModule", _val: [name, xform_decls(xctx, decls)]});
            break _t10025;
          }
          if (true) {
            _t10024 = xform_decl_9999(xctx, tdecl);
            break _t10025;
          }
          _match_fail("line 16933");
        }
        const tdecl$p_10026 = _t10024;
        const names_10028 = decl_names_10005(tdecl);
        const __rec_upd_10030 = xctx;
        const _t10031 = ({xf_constrained: __rec_upd_10030.xf_constrained, xf_locals: List$concat(names_10028, xctx.xf_locals), xf_record_evidence: __rec_upd_10030.xf_record_evidence, xf_schemes: open_schemes_10018(xctx, tdecl$p_10026), xf_type_env: __rec_upd_10030.xf_type_env});
        const xctx$p_10032 = _t10031;
        const _t10033 = ({_hd: tdecl$p_10026, _tl: xform_decls(xctx$p_10032, rest)});
        const _t10029 = _t10033;
        const _t10027 = _t10029;
        _t10021 = _t10027;
        break _t10022;
      }
      _match_fail("line 16933");
    }
    return _t10021;
  }
  const _t10034 = xform_decls(xctx_9974, tprog);
  const _t10019 = _t10034;
  const _t10006 = _t10019;
  const _t10000 = _t10006;
  const _t9975 = _t10000;
  return _t9975;
}
function Typechecker$check_program(program) {
  function _t10035(__p361, decl) {
    let _t10037;
    const _t10036 = __p361;
    _t10038: {
      if (true) {
        const ctx = _t10036[0];
        const decls = _t10036[1];
        let _t10040;
        const _t10039 = Typechecker$check_decl(ctx, 0, decl);
        _t10041: {
          if (true) {
            const ctx$p = _t10039[0];
            const tdecls = _t10039[1];
            _t10040 = [ctx$p, List$rev_append(tdecls, decls)];
            break _t10041;
          }
          _match_fail("line 16933");
        }
        _t10037 = _t10040;
        break _t10038;
      }
      _match_fail("line 16933");
    }
    return _t10037;
  }
  let _t10043;
  const _t10042 = List$fold(_t10035, [Typechecker$empty_ctx, null], program);
  _t10044: {
    if (true) {
      const ctx = _t10042[0];
      const decls = _t10042[1];
      _t10043 = [List$rev(decls), ctx.type_env];
      break _t10044;
    }
    _match_fail("line 16933");
  }
  return _t10043;
}
function Typechecker$check_program_in_ctx(ctx, program) {
  function _t10045(__p362, decl) {
    let _t10047;
    const _t10046 = __p362;
    _t10048: {
      if (true) {
        const ctx = _t10046[0];
        const decls = _t10046[1];
        let _t10050;
        const _t10049 = Typechecker$check_decl(ctx, 0, decl);
        _t10051: {
          if (true) {
            const ctx$p = _t10049[0];
            const tdecls = _t10049[1];
            _t10050 = [ctx$p, List$rev_append(tdecls, decls)];
            break _t10051;
          }
          _match_fail("line 16933");
        }
        _t10047 = _t10050;
        break _t10048;
      }
      _match_fail("line 16933");
    }
    return _t10047;
  }
  let _t10053;
  const _t10052 = List$fold(_t10045, [ctx, null], program);
  _t10054: {
    if (true) {
      const ctx = _t10052[0];
      const decls = _t10052[1];
      _t10053 = [ctx, List$rev(decls)];
      break _t10054;
    }
    _match_fail("line 16933");
  }
  return _t10053;
}
function Typechecker$handler_body_has_resume(te) {
  while (true) {
    let _t10056;
    const _t10055 = te.expr;
    _t10057: {
      if (_t10055._tag === 31) {
        _t10056 = true;
        break _t10057;
      }
      if (((_t10055._tag === 8 || _t10055._tag === 28) || _t10055._tag === 25)) {
        const e1 = ((_t10055._tag === 8 || _t10055._tag === 28) ? (_t10055._tag === 8 ? _t10055._val[2] : _t10055._val[0]) : _t10055._val[1]);
        const e2 = ((_t10055._tag === 8 || _t10055._tag === 28) ? (_t10055._tag === 8 ? _t10055._val[3] : _t10055._val[1]) : _t10055._val[2]);
        _t10056 = (Typechecker$handler_body_has_resume(e1) || Typechecker$handler_body_has_resume(e2));
        break _t10057;
      }
      if (_t10055._tag === 12) {
        const e1 = _t10055._val[1];
        const e2 = _t10055._val[2];
        _t10056 = (Typechecker$handler_body_has_resume(e1) || Typechecker$handler_body_has_resume(e2));
        break _t10057;
      }
      if (_t10055._tag === 24) {
        const arms = _t10055._val[1];
        function _t10058(__p363) {
          let _t10060;
          const _t10059 = __p363;
          _t10061: {
            if (true) {
              const body = _t10059[2];
              _t10060 = Typechecker$handler_body_has_resume(body);
              break _t10061;
            }
            _match_fail("line 16933");
          }
          return _t10060;
        }
        _t10056 = List$exists(_t10058, arms);
        break _t10057;
      }
      if (_t10055._tag === 9) {
        const e2 = _t10055._val[3];
        const _t10062 = e2;
        te = _t10062;
        continue;
        _t10056 = undefined;
        break _t10057;
      }
      if (_t10055._tag === 37) {
        const e2 = _t10055._val[1];
        const _t10063 = e2;
        te = _t10063;
        continue;
        _t10056 = undefined;
        break _t10057;
      }
      if (true) {
        _t10056 = false;
        break _t10057;
      }
      _match_fail("line 16933");
    }
    return _t10056;
  }
}
function Typechecker$handler_body_has_perform(te) {
  while (true) {
    let _t10065;
    const _t10064 = te.expr;
    _t10066: {
      if (_t10064._tag === 29) {
        _t10065 = true;
        break _t10066;
      }
      if (_t10064._tag === 31) {
        _t10065 = true;
        break _t10066;
      }
      if (((_t10064._tag === 8 || _t10064._tag === 28) || _t10064._tag === 25)) {
        const e1 = ((_t10064._tag === 8 || _t10064._tag === 28) ? (_t10064._tag === 8 ? _t10064._val[2] : _t10064._val[0]) : _t10064._val[1]);
        const e2 = ((_t10064._tag === 8 || _t10064._tag === 28) ? (_t10064._tag === 8 ? _t10064._val[3] : _t10064._val[1]) : _t10064._val[2]);
        _t10065 = (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2));
        break _t10066;
      }
      if (_t10064._tag === 12) {
        const cond = _t10064._val[0];
        const e1 = _t10064._val[1];
        const e2 = _t10064._val[2];
        _t10065 = (Typechecker$handler_body_has_perform(cond) || (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2)));
        break _t10066;
      }
      if (_t10064._tag === 24) {
        const scrut = _t10064._val[0];
        const arms = _t10064._val[1];
        let _t10075;
        if (Typechecker$handler_body_has_perform(scrut)) {
          _t10075 = true;
        } else {
        function _t10067(__p364) {
          let _t10069;
          const _t10068 = __p364;
          _t10070: {
            if (true) {
              const g = _t10068[1];
              const body = _t10068[2];
              let _t10074;
              if (Typechecker$handler_body_has_perform(body)) {
                _t10074 = true;
              } else {
              let _t10072;
              const _t10071 = g;
              _t10073: {
                if (_t10071._tag === 1) {
                  const g = _t10071._val;
                  _t10072 = Typechecker$handler_body_has_perform(g);
                  break _t10073;
                }
                if (_t10071._tag === 0) {
                  _t10072 = false;
                  break _t10073;
                }
                _match_fail("line 16933");
              }
                _t10074 = _t10072;
              }
              _t10069 = _t10074;
              break _t10070;
            }
            _match_fail("line 16933");
          }
          return _t10069;
        }
          _t10075 = List$exists(_t10067, arms);
        }
        _t10065 = _t10075;
        break _t10066;
      }
      if (_t10064._tag === 9) {
        const e2 = _t10064._val[3];
        const _t10076 = e2;
        te = _t10076;
        continue;
        _t10065 = undefined;
        break _t10066;
      }
      if (_t10064._tag === 37) {
        const e2 = _t10064._val[1];
        const _t10077 = e2;
        te = _t10077;
        continue;
        _t10065 = undefined;
        break _t10066;
      }
      if (_t10064._tag === 11) {
        const fn_ = _t10064._val[0];
        const arg = _t10064._val[1];
        _t10065 = (Typechecker$handler_body_has_perform(fn_) || Typechecker$handler_body_has_perform(arg));
        break _t10066;
      }
      if (_t10064._tag === 13) {
        const e1 = _t10064._val[1];
        const e2 = _t10064._val[2];
        _t10065 = (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2));
        break _t10066;
      }
      if (_t10064._tag === 14) {
        const e = _t10064._val[1];
        const _t10078 = e;
        te = _t10078;
        continue;
        _t10065 = undefined;
        break _t10066;
      }
      if (_t10064._tag === 21) {
        const e1 = _t10064._val[0];
        const e2 = _t10064._val[1];
        _t10065 = (Typechecker$handler_body_has_perform(e1) || Typechecker$handler_body_has_perform(e2));
        break _t10066;
      }
      if (_t10064._tag === 15) {
        const es = _t10064._val;
        _t10065 = List$exists(Typechecker$handler_body_has_perform, es);
        break _t10066;
      }
      if (_t10064._tag === 16) {
        const fields = _t10064._val;
        function _t10079(__p365) {
          let _t10081;
          const _t10080 = __p365;
          _t10082: {
            if (true) {
              const e = _t10080[1];
              _t10081 = Typechecker$handler_body_has_perform(e);
              break _t10082;
            }
            _match_fail("line 16933");
          }
          return _t10081;
        }
        _t10065 = List$exists(_t10079, fields);
        break _t10066;
      }
      if (true) {
        _t10065 = false;
        break _t10066;
      }
      _match_fail("line 16933");
    }
    return _t10065;
  }
}
function Typechecker$classify_all_branches_resume(te) {
  while (true) {
    let _t10084;
    const _t10083 = te.expr;
    _t10085: {
      if (_t10083._tag === 31) {
        _t10084 = true;
        break _t10085;
      }
      if (((((_t10083._tag === 8 || _t10083._tag === 9) || _t10083._tag === 37) || _t10083._tag === 25) || _t10083._tag === 28)) {
        const e2 = ((((_t10083._tag === 8 || _t10083._tag === 9) || _t10083._tag === 37) || _t10083._tag === 25) ? (((_t10083._tag === 8 || _t10083._tag === 9) || _t10083._tag === 37) ? ((_t10083._tag === 8 || _t10083._tag === 9) ? _t10083._val[3] : _t10083._val[1]) : _t10083._val[2]) : _t10083._val[1]);
        const _t10086 = e2;
        te = _t10086;
        continue;
        _t10084 = undefined;
        break _t10085;
      }
      if (_t10083._tag === 12) {
        const then_e = _t10083._val[1];
        const else_e = _t10083._val[2];
        _t10084 = (Typechecker$classify_all_branches_resume(then_e) && Typechecker$classify_all_branches_resume(else_e));
        break _t10085;
      }
      if (_t10083._tag === 24) {
        const arms = _t10083._val[1];
        function _t10087(__p366) {
          let _t10089;
          const _t10088 = __p366;
          _t10090: {
            if (true) {
              const body = _t10088[2];
              _t10089 = Typechecker$classify_all_branches_resume(body);
              break _t10090;
            }
            _match_fail("line 16933");
          }
          return _t10089;
        }
        _t10084 = List$forall(_t10087, arms);
        break _t10085;
      }
      if (true) {
        _t10084 = false;
        break _t10085;
      }
      _match_fail("line 16933");
    }
    return _t10084;
  }
}
function Typechecker$classify_all_resumes_tail(te) {
  while (true) {
    let _t10092;
    const _t10091 = te.expr;
    _t10093: {
      if (_t10091._tag === 31) {
        _t10092 = true;
        break _t10093;
      }
      if (_t10091._tag === 28) {
        const e2 = _t10091._val[1];
        const _t10094 = e2;
        te = _t10094;
        continue;
        _t10092 = undefined;
        break _t10093;
      }
      if (_t10091._tag === 8) {
        const e1 = _t10091._val[2];
        const e2 = _t10091._val[3];
        _t10092 = ((!Typechecker$handler_body_has_perform(e1)) && Typechecker$classify_all_resumes_tail(e2));
        break _t10093;
      }
      if (_t10091._tag === 9) {
        const e2 = _t10091._val[3];
        const _t10095 = e2;
        te = _t10095;
        continue;
        _t10092 = undefined;
        break _t10093;
      }
      if (_t10091._tag === 25) {
        const e1 = _t10091._val[1];
        const e2 = _t10091._val[2];
        _t10092 = ((!Typechecker$handler_body_has_perform(e1)) && Typechecker$classify_all_resumes_tail(e2));
        break _t10093;
      }
      if (_t10091._tag === 12) {
        const then_e = _t10091._val[1];
        const else_e = _t10091._val[2];
        _t10092 = (Typechecker$classify_all_resumes_tail(then_e) && Typechecker$classify_all_resumes_tail(else_e));
        break _t10093;
      }
      if (_t10091._tag === 24) {
        const arms = _t10091._val[1];
        function _t10096(__p367) {
          let _t10098;
          const _t10097 = __p367;
          _t10099: {
            if (true) {
              const body = _t10097[2];
              _t10098 = Typechecker$classify_all_resumes_tail(body);
              break _t10099;
            }
            _match_fail("line 16933");
          }
          return _t10098;
        }
        _t10092 = List$forall(_t10096, arms);
        break _t10093;
      }
      if (true) {
        _t10092 = true;
        break _t10093;
      }
      _match_fail("line 16933");
    }
    return _t10092;
  }
}
function Typechecker$strip_tail_resume(te) {
  let _t10101;
  const _t10100 = te.expr;
  _t10102: {
    if (_t10100._tag === 31) {
      const value = _t10100._val[1];
      _t10101 = value;
      break _t10102;
    }
    if (_t10100._tag === 8) {
      const r = _t10100._val[0];
      const n = _t10100._val[1];
      const e1 = _t10100._val[2];
      const e2 = _t10100._val[3];
      const __rec_upd_10103 = te;
      const _t10104 = ({expr: ({_tag: 8, _name: "TELet", _val: [r, n, e1, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_10103.loc, ty: __rec_upd_10103.ty});
      _t10101 = _t10104;
      break _t10102;
    }
    if (_t10100._tag === 9) {
      const r = _t10100._val[0];
      const n = _t10100._val[1];
      const fn_e = _t10100._val[2];
      const e2 = _t10100._val[3];
      const __rec_upd_10105 = te;
      const _t10106 = ({expr: ({_tag: 9, _name: "TELetRec", _val: [r, n, fn_e, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_10105.loc, ty: __rec_upd_10105.ty});
      _t10101 = _t10106;
      break _t10102;
    }
    if (_t10100._tag === 37) {
      const binds = _t10100._val[0];
      const e2 = _t10100._val[1];
      const __rec_upd_10107 = te;
      const _t10108 = ({expr: ({_tag: 37, _name: "TELetRecAnd", _val: [binds, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_10107.loc, ty: __rec_upd_10107.ty});
      _t10101 = _t10108;
      break _t10102;
    }
    if (_t10100._tag === 25) {
      const n = _t10100._val[0];
      const e1 = _t10100._val[1];
      const e2 = _t10100._val[2];
      const __rec_upd_10109 = te;
      const _t10110 = ({expr: ({_tag: 25, _name: "TELetMut", _val: [n, e1, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_10109.loc, ty: __rec_upd_10109.ty});
      _t10101 = _t10110;
      break _t10102;
    }
    if (_t10100._tag === 28) {
      const e1 = _t10100._val[0];
      const e2 = _t10100._val[1];
      const __rec_upd_10111 = te;
      const _t10112 = ({expr: ({_tag: 28, _name: "TESeq", _val: [e1, Typechecker$strip_tail_resume(e2)]}), loc: __rec_upd_10111.loc, ty: __rec_upd_10111.ty});
      _t10101 = _t10112;
      break _t10102;
    }
    if (_t10100._tag === 12) {
      const c = _t10100._val[0];
      const t = _t10100._val[1];
      const f = _t10100._val[2];
      const __rec_upd_10113 = te;
      const _t10114 = ({expr: ({_tag: 12, _name: "TEIf", _val: [c, Typechecker$strip_tail_resume(t), Typechecker$strip_tail_resume(f)]}), loc: __rec_upd_10113.loc, ty: __rec_upd_10113.ty});
      _t10101 = _t10114;
      break _t10102;
    }
    if (_t10100._tag === 24) {
      const s = _t10100._val[0];
      const arms = _t10100._val[1];
      const p = _t10100._val[2];
      function _t10115(__p368) {
        let _t10117;
        const _t10116 = __p368;
        _t10118: {
          if (true) {
            const pat = _t10116[0];
            const g = _t10116[1];
            const body = _t10116[2];
            _t10117 = [pat, g, Typechecker$strip_tail_resume(body)];
            break _t10118;
          }
          _match_fail("line 16933");
        }
        return _t10117;
      }
      const arms$p_10119 = List$map(_t10115, arms);
      const __rec_upd_10121 = te;
      const _t10122 = ({expr: ({_tag: 24, _name: "TEMatch", _val: [s, arms$p_10119, p]}), loc: __rec_upd_10121.loc, ty: __rec_upd_10121.ty});
      const _t10120 = _t10122;
      _t10101 = _t10120;
      break _t10102;
    }
    if (true) {
      _t10101 = te;
      break _t10102;
    }
    _match_fail("line 16933");
  }
  return _t10101;
}
function Typechecker$classify_arm(arm) {
  let _t10124;
  const _t10123 = arm;
  _t10125: {
    if (_t10123._tag === 1) {
      const op = _t10123._val[0];
      const arg = _t10123._val[1];
      const _k = _t10123._val[2];
      const body = _t10123._val[3];
      let _t10126;
      if (((!Typechecker$handler_body_has_resume(body)) && (!Typechecker$handler_body_has_perform(body)))) {
        _t10126 = ({_tag: 3, _name: "THOpTry", _val: [op, arg, body]});
      } else {
        let _t10127;
        if ((Typechecker$handler_body_has_resume(body) && (Typechecker$classify_all_branches_resume(body) && Typechecker$classify_all_resumes_tail(body)))) {
          _t10127 = ({_tag: 2, _name: "THOpProvide", _val: [op, arg, Typechecker$strip_tail_resume(body)]});
        } else {
          _t10127 = arm;
        }
        _t10126 = _t10127;
      }
      _t10124 = _t10126;
      break _t10125;
    }
    if (true) {
      _t10124 = arm;
      break _t10125;
    }
    _match_fail("line 16933");
  }
  return _t10124;
}
function Typechecker$classify_texpr(te) {
  function _t10128(e) {
    const __rec_upd_10129 = te;
    const _t10130 = ({expr: e, loc: __rec_upd_10129.loc, ty: __rec_upd_10129.ty});
    return _t10130;
  }
  const mk_10131 = _t10128;
  let _t10134;
  const _t10133 = te.expr;
  _t10135: {
    if (_t10133._tag === 30) {
      const body = _t10133._val[0];
      const arms = _t10133._val[1];
      const body$p_10136 = Typechecker$classify_texpr(body);
      function _t10138(arm) {
        let _t10140;
        const _t10139 = arm;
        _t10141: {
          if (_t10139._tag === 0) {
            const n = _t10139._val[0];
            const e = _t10139._val[1];
            _t10140 = ({_tag: 0, _name: "THReturn", _val: [n, Typechecker$classify_texpr(e)]});
            break _t10141;
          }
          if (_t10139._tag === 1) {
            const op = _t10139._val[0];
            const arg = _t10139._val[1];
            const k = _t10139._val[2];
            const e = _t10139._val[3];
            _t10140 = Typechecker$classify_arm(({_tag: 1, _name: "THOp", _val: [op, arg, k, Typechecker$classify_texpr(e)]}));
            break _t10141;
          }
          if (_t10139._tag === 2) {
            const op = _t10139._val[0];
            const arg = _t10139._val[1];
            const e = _t10139._val[2];
            _t10140 = ({_tag: 2, _name: "THOpProvide", _val: [op, arg, Typechecker$classify_texpr(e)]});
            break _t10141;
          }
          if (_t10139._tag === 3) {
            const op = _t10139._val[0];
            const arg = _t10139._val[1];
            const e = _t10139._val[2];
            _t10140 = ({_tag: 3, _name: "THOpTry", _val: [op, arg, Typechecker$classify_texpr(e)]});
            break _t10141;
          }
          _match_fail("line 16933");
        }
        return _t10140;
      }
      const arms$p_10142 = List$map(_t10138, arms);
      const _t10143 = Typechecker$mk(({_tag: 30, _name: "TEHandle", _val: [body$p_10136, arms$p_10142]}));
      const _t10137 = _t10143;
      _t10134 = _t10137;
      break _t10135;
    }
    if (_t10133._tag === 8) {
      const r = _t10133._val[0];
      const n = _t10133._val[1];
      const e1 = _t10133._val[2];
      const e2 = _t10133._val[3];
      _t10134 = Typechecker$mk(({_tag: 8, _name: "TELet", _val: [r, n, Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t10135;
    }
    if (_t10133._tag === 9) {
      const r = _t10133._val[0];
      const n = _t10133._val[1];
      const fn_e = _t10133._val[2];
      const body = _t10133._val[3];
      _t10134 = Typechecker$mk(({_tag: 9, _name: "TELetRec", _val: [r, n, Typechecker$classify_texpr(fn_e), Typechecker$classify_texpr(body)]}));
      break _t10135;
    }
    if (_t10133._tag === 37) {
      const binds = _t10133._val[0];
      const body = _t10133._val[1];
      function _t10144(__p369) {
        let _t10146;
        const _t10145 = __p369;
        _t10147: {
          if (true) {
            const n = _t10145[0];
            const e = _t10145[1];
            _t10146 = [n, Typechecker$classify_texpr(e)];
            break _t10147;
          }
          _match_fail("line 16933");
        }
        return _t10146;
      }
      _t10134 = Typechecker$mk(({_tag: 37, _name: "TELetRecAnd", _val: [List$map(_t10144, binds), Typechecker$classify_texpr(body)]}));
      break _t10135;
    }
    if (_t10133._tag === 10) {
      const p = _t10133._val[0];
      const body = _t10133._val[1];
      const f = _t10133._val[2];
      _t10134 = Typechecker$mk(({_tag: 10, _name: "TEFun", _val: [p, Typechecker$classify_texpr(body), f]}));
      break _t10135;
    }
    if (_t10133._tag === 11) {
      const fn_ = _t10133._val[0];
      const arg = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 11, _name: "TEApp", _val: [Typechecker$classify_texpr(fn_), Typechecker$classify_texpr(arg)]}));
      break _t10135;
    }
    if (_t10133._tag === 12) {
      const c = _t10133._val[0];
      const t = _t10133._val[1];
      const f = _t10133._val[2];
      _t10134 = Typechecker$mk(({_tag: 12, _name: "TEIf", _val: [Typechecker$classify_texpr(c), Typechecker$classify_texpr(t), Typechecker$classify_texpr(f)]}));
      break _t10135;
    }
    if (_t10133._tag === 28) {
      const e1 = _t10133._val[0];
      const e2 = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 28, _name: "TESeq", _val: [Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t10135;
    }
    if (_t10133._tag === 25) {
      const n = _t10133._val[0];
      const e1 = _t10133._val[1];
      const e2 = _t10133._val[2];
      _t10134 = Typechecker$mk(({_tag: 25, _name: "TELetMut", _val: [n, Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t10135;
    }
    if (_t10133._tag === 24) {
      const scrut = _t10133._val[0];
      const arms = _t10133._val[1];
      const p = _t10133._val[2];
      function _t10148(__p370) {
        let _t10150;
        const _t10149 = __p370;
        _t10151: {
          if (true) {
            const pat = _t10149[0];
            const g = _t10149[1];
            const body = _t10149[2];
            _t10150 = [pat, Option$map(Typechecker$classify_texpr, g), Typechecker$classify_texpr(body)];
            break _t10151;
          }
          _match_fail("line 16933");
        }
        return _t10150;
      }
      _t10134 = Typechecker$mk(({_tag: 24, _name: "TEMatch", _val: [Typechecker$classify_texpr(scrut), List$map(_t10148, arms), p]}));
      break _t10135;
    }
    if (_t10133._tag === 13) {
      const op = _t10133._val[0];
      const e1 = _t10133._val[1];
      const e2 = _t10133._val[2];
      _t10134 = Typechecker$mk(({_tag: 13, _name: "TEBinop", _val: [op, Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t10135;
    }
    if (_t10133._tag === 14) {
      const op = _t10133._val[0];
      const e = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 14, _name: "TEUnop", _val: [op, Typechecker$classify_texpr(e)]}));
      break _t10135;
    }
    if (_t10133._tag === 15) {
      const es = _t10133._val;
      _t10134 = Typechecker$mk(({_tag: 15, _name: "TETuple", _val: List$map(Typechecker$classify_texpr, es)}));
      break _t10135;
    }
    if (_t10133._tag === 16) {
      const fields = _t10133._val;
      function _t10152(__p371) {
        let _t10154;
        const _t10153 = __p371;
        _t10155: {
          if (true) {
            const n = _t10153[0];
            const e = _t10153[1];
            _t10154 = [n, Typechecker$classify_texpr(e)];
            break _t10155;
          }
          _match_fail("line 16933");
        }
        return _t10154;
      }
      _t10134 = Typechecker$mk(({_tag: 16, _name: "TERecord", _val: List$map(_t10152, fields)}));
      break _t10135;
    }
    if (_t10133._tag === 17) {
      const base = _t10133._val[0];
      const fields = _t10133._val[1];
      function _t10156(__p372) {
        let _t10158;
        const _t10157 = __p372;
        _t10159: {
          if (true) {
            const n = _t10157[0];
            const e = _t10157[1];
            _t10158 = [n, Typechecker$classify_texpr(e)];
            break _t10159;
          }
          _match_fail("line 16933");
        }
        return _t10158;
      }
      _t10134 = Typechecker$mk(({_tag: 17, _name: "TERecordUpdate", _val: [Typechecker$classify_texpr(base), List$map(_t10156, fields)]}));
      break _t10135;
    }
    if (_t10133._tag === 18) {
      const base = _t10133._val[0];
      const pairs = _t10133._val[1];
      function _t10160(__p373) {
        let _t10162;
        const _t10161 = __p373;
        _t10163: {
          if (true) {
            const i = _t10161[0];
            const v = _t10161[1];
            _t10162 = [Typechecker$classify_texpr(i), Typechecker$classify_texpr(v)];
            break _t10163;
          }
          _match_fail("line 16933");
        }
        return _t10162;
      }
      _t10134 = Typechecker$mk(({_tag: 18, _name: "TERecordUpdateIdx", _val: [Typechecker$classify_texpr(base), List$map(_t10160, pairs)]}));
      break _t10135;
    }
    if (_t10133._tag === 19) {
      const e = _t10133._val[0];
      const f = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 19, _name: "TEField", _val: [Typechecker$classify_texpr(e), f]}));
      break _t10135;
    }
    if (_t10133._tag === 20) {
      const e1 = _t10133._val[0];
      const e2 = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 20, _name: "TEIndex", _val: [Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t10135;
    }
    if (_t10133._tag === 21) {
      const e1 = _t10133._val[0];
      const e2 = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 21, _name: "TECons", _val: [Typechecker$classify_texpr(e1), Typechecker$classify_texpr(e2)]}));
      break _t10135;
    }
    if (_t10133._tag === 23) {
      const name = _t10133._val[0];
      const arg = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 23, _name: "TEConstruct", _val: [name, Option$map(Typechecker$classify_texpr, arg)]}));
      break _t10135;
    }
    if (_t10133._tag === 26) {
      const n = _t10133._val[0];
      const e = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 26, _name: "TEAssign", _val: [n, Typechecker$classify_texpr(e)]}));
      break _t10135;
    }
    if (_t10133._tag === 27) {
      const e1 = _t10133._val[0];
      const f = _t10133._val[1];
      const e2 = _t10133._val[2];
      _t10134 = Typechecker$mk(({_tag: 27, _name: "TEFieldAssign", _val: [Typechecker$classify_texpr(e1), f, Typechecker$classify_texpr(e2)]}));
      break _t10135;
    }
    if (_t10133._tag === 29) {
      const name = _t10133._val[0];
      const e = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 29, _name: "TEPerform", _val: [name, Typechecker$classify_texpr(e)]}));
      break _t10135;
    }
    if (_t10133._tag === 31) {
      const k = _t10133._val[0];
      const v = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 31, _name: "TEResume", _val: [Typechecker$classify_texpr(k), Typechecker$classify_texpr(v)]}));
      break _t10135;
    }
    if (_t10133._tag === 32) {
      const c = _t10133._val[0];
      const b = _t10133._val[1];
      _t10134 = Typechecker$mk(({_tag: 32, _name: "TEWhile", _val: [Typechecker$classify_texpr(c), Typechecker$classify_texpr(b)]}));
      break _t10135;
    }
    if (_t10133._tag === 33) {
      const e = _t10133._val;
      _t10134 = Typechecker$mk(({_tag: 33, _name: "TEBreak", _val: Typechecker$classify_texpr(e)}));
      break _t10135;
    }
    if (_t10133._tag === 35) {
      const e = _t10133._val;
      _t10134 = Typechecker$mk(({_tag: 35, _name: "TEFoldContinue", _val: Typechecker$classify_texpr(e)}));
      break _t10135;
    }
    if (_t10133._tag === 36) {
      const e = _t10133._val;
      _t10134 = Typechecker$mk(({_tag: 36, _name: "TEForLoop", _val: Typechecker$classify_texpr(e)}));
      break _t10135;
    }
    if (_t10133._tag === 38) {
      const es = _t10133._val;
      _t10134 = Typechecker$mk(({_tag: 38, _name: "TEArray", _val: List$map(Typechecker$classify_texpr, es)}));
      break _t10135;
    }
    if (_t10133._tag === 39) {
      const e = _t10133._val;
      _t10134 = Typechecker$mk(({_tag: 39, _name: "TEReturn", _val: Typechecker$classify_texpr(e)}));
      break _t10135;
    }
    if ((((((((((_t10133._tag === 0 || _t10133._tag === 1) || _t10133._tag === 2) || _t10133._tag === 3) || _t10133._tag === 4) || _t10133._tag === 5) || _t10133._tag === 6) || _t10133._tag === 7) || _t10133._tag === 22) || _t10133._tag === 34)) {
      _t10134 = te;
      break _t10135;
    }
    _match_fail("line 16933");
  }
  const _t10132 = _t10134;
  return _t10132;
}
function Typechecker$classify_handlers(program) {
  function _t10164(decl) {
    let _t10166;
    const _t10165 = decl;
    _t10167: {
      if (_t10165._tag === 0) {
        const n = _t10165._val[0];
        const e = _t10165._val[1];
        _t10166 = ({_tag: 0, _name: "TDLet", _val: [n, Typechecker$classify_texpr(e)]});
        break _t10167;
      }
      if (_t10165._tag === 1) {
        const n = _t10165._val[0];
        const e = _t10165._val[1];
        _t10166 = ({_tag: 1, _name: "TDLetMut", _val: [n, Typechecker$classify_texpr(e)]});
        break _t10167;
      }
      if (_t10165._tag === 2) {
        const n = _t10165._val[0];
        const e = _t10165._val[1];
        _t10166 = ({_tag: 2, _name: "TDLetRec", _val: [n, Typechecker$classify_texpr(e)]});
        break _t10167;
      }
      if (_t10165._tag === 5) {
        const e = _t10165._val;
        _t10166 = ({_tag: 5, _name: "TDExpr", _val: Typechecker$classify_texpr(e)});
        break _t10167;
      }
      if (_t10165._tag === 3) {
        const binds = _t10165._val;
        function _t10168(__p374) {
          let _t10170;
          const _t10169 = __p374;
          _t10171: {
            if (true) {
              const n = _t10169[0];
              const e = _t10169[1];
              _t10170 = [n, Typechecker$classify_texpr(e)];
              break _t10171;
            }
            _match_fail("line 16933");
          }
          return _t10170;
        }
        _t10166 = ({_tag: 3, _name: "TDLetRecAnd", _val: List$map(_t10168, binds)});
        break _t10167;
      }
      if (_t10165._tag === 9) {
        const name = _t10165._val[0];
        const decls = _t10165._val[1];
        _t10166 = ({_tag: 9, _name: "TDModule", _val: [name, Typechecker$classify_handlers(decls)]});
        break _t10167;
      }
      if (((((_t10165._tag === 7 || _t10165._tag === 4) || _t10165._tag === 6) || _t10165._tag === 8) || _t10165._tag === 10)) {
        _t10166 = decl;
        break _t10167;
      }
      _match_fail("line 16933");
    }
    return _t10166;
  }
  return List$map(_t10164, program);
}
function Optimize$collect_jump_targets(code) {
  const targets_10172 = Hashtbl$create(64);
  function _t10174(op) {
    let _t10176;
    const _t10175 = op;
    _t10177: {
      if (((((_t10175._tag === 37 || _t10175._tag === 38) || _t10175._tag === 39) || _t10175._tag === 68) || _t10175._tag === 71)) {
        const t = _t10175._val;
        _t10176 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, targets_10172, t, undefined]);
        break _t10177;
      }
      if (true) {
        _t10176 = undefined;
        break _t10177;
      }
      _match_fail("line 16933");
    }
    return _t10176;
  }
  Array$iter(_t10174, code);
  const _t10173 = targets_10172;
  return _t10173;
}
function Optimize$is_jump_target(__dict_Hash_0, __dict_Eq_0, targets, offset) {
  return _call(Hashtbl$has, [__dict_Hash_0, __dict_Eq_0, targets, offset]);
}
function Optimize$mark_dead_after_tail_call(code, targets, actions) {
  const len_10178 = Array$length(code);
  const i_10180 = Ref$create(0);
  let _t10182 = undefined;
  let _t10183 = false, _t10184;
  while (true) {
    if (!((Ref$get(i_10180) < len_10178))) break;
    let _t10186;
    const _t10185 = Array$get(code, Ref$get(i_10180));
    _t10187: {
      if ((_t10185._tag === 43 || _t10185._tag === 83)) {
        const j_10188 = Ref$create((Ref$get(i_10180) + 1));
        let _t10190 = undefined;
        let _t10191 = false, _t10192;
        while (true) {
          if (!(((Ref$get(j_10188) < len_10178) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, Ref$get(j_10188)]))))) break;
          Array$set(actions, Ref$get(j_10188), ({_tag: 1, _name: "Remove"}));
          Ref$set(j_10188, (Ref$get(j_10188) + 1));
          if (_t10191) break;
        }
        _t10190 = _t10191 ? _t10192 : undefined;
        _t10190;
        const _t10189 = Ref$set(i_10180, Ref$get(j_10188));
        _t10186 = _t10189;
        break _t10187;
      }
      if (true) {
        _t10186 = Ref$set(i_10180, (Ref$get(i_10180) + 1));
        break _t10187;
      }
      _match_fail("line 16933");
    }
    _t10186;
    if (_t10183) break;
  }
  _t10182 = _t10183 ? _t10184 : undefined;
  const _t10181 = _t10182;
  const _t10179 = _t10181;
  return _t10179;
}
function Optimize$mark_jump_to_next(code, actions) {
  const len_10193 = Array$length(code);
  let i_10195 = 0;
  let _t10197 = undefined;
  let _t10198 = false, _t10199;
  while (true) {
    if (!((i_10195 <= (len_10193 - 1)))) break;
    let _t10201;
    const _t10200 = Array$get(code, i_10195);
    _t10202: {
      if (_t10200._tag === 37) {
        const target = _t10200._val;
        if ((target === (i_10195 + 1))) {
          _t10201 = Array$set(actions, i_10195, ({_tag: 1, _name: "Remove"}));
          break _t10202;
        }
      }
      if (true) {
        _t10201 = undefined;
        break _t10202;
      }
      _match_fail("line 16933");
    }
    _t10201;
    (i_10195 = (i_10195 + 1), undefined);
    if (_t10198) break;
  }
  _t10197 = _t10198 ? _t10199 : undefined;
  const _t10196 = _t10197;
  const _t10194 = _t10196;
  return _t10194;
}
function Optimize$reads_slot(op, n) {
  let _t10204;
  const _t10203 = op;
  _t10205: {
    if ((((_t10203._tag === 3 || _t10203._tag === 76) || _t10203._tag === 77) || _t10203._tag === 78)) {
      const s = (((_t10203._tag === 3 || _t10203._tag === 76) || _t10203._tag === 77) ? ((_t10203._tag === 3 || _t10203._tag === 76) ? (_t10203._tag === 3 ? _t10203._val : _t10203._val[0]) : _t10203._val[0]) : _t10203._val[0]);
      _t10204 = (s === n);
      break _t10205;
    }
    if ((_t10203._tag === 40 || _t10203._tag === 41)) {
      const caps = _t10203._val[1];
      function _t10206(c) {
        return _eq(c, ({_tag: 0, _name: "CaptureLocal", _val: n}));
      }
      _t10204 = List$exists(_t10206, caps);
      break _t10205;
    }
    if (true) {
      _t10204 = false;
      break _t10205;
    }
    _match_fail("line 16933");
  }
  return _t10204;
}
function Optimize$writes_slot(op, n) {
  let _t10208;
  const _t10207 = op;
  _t10209: {
    if (_t10207._tag === 4) {
      const s = _t10207._val;
      _t10208 = (s === n);
      break _t10209;
    }
    if (true) {
      _t10208 = false;
      break _t10209;
    }
    _match_fail("line 16933");
  }
  return _t10208;
}
function Optimize$is_slot_dead(code, actions, targets, n, start) {
  const len_10210 = Array$length(code);
  const i_10212 = Ref$create(start);
  const result_10214 = Ref$create(true);
  const done__10216 = Ref$create(false);
  let _t10218 = undefined;
  let _t10219 = false, _t10220;
  while (true) {
    if (!(((Ref$get(i_10212) < len_10210) && (!Ref$get(done__10216))))) break;
    let _t10221;
    if (_eq(Array$get(actions, Ref$get(i_10212)), ({_tag: 1, _name: "Remove"}))) {
      _t10221 = Ref$set(i_10212, (Ref$get(i_10212) + 1));
    } else {
      let _t10222;
      if (_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, Ref$get(i_10212)])) {
        Ref$set(result_10214, false);
        _t10222 = Ref$set(done__10216, true);
      } else {
        const op_10223 = Array$get(code, Ref$get(i_10212));
        let _t10225;
        if (Optimize$reads_slot(op_10223, n)) {
          Ref$set(result_10214, false);
          _t10225 = Ref$set(done__10216, true);
        } else {
          let _t10226;
          if (Optimize$writes_slot(op_10223, n)) {
            _t10226 = Ref$set(done__10216, true);
          } else {
            let _t10228;
            const _t10227 = op_10223;
            _t10229: {
              if ((((((_t10227._tag === 44 || _t10227._tag === 45) || _t10227._tag === 43) || _t10227._tag === 83) || _t10227._tag === 64) || _t10227._tag === 75)) {
                _t10228 = Ref$set(done__10216, true);
                break _t10229;
              }
              if ((((((((_t10227._tag === 37 || _t10227._tag === 38) || _t10227._tag === 39) || _t10227._tag === 70) || _t10227._tag === 71) || _t10227._tag === 72) || _t10227._tag === 68) || _t10227._tag === 81)) {
                Ref$set(result_10214, false);
                _t10228 = Ref$set(done__10216, true);
                break _t10229;
              }
              if (true) {
                _t10228 = Ref$set(i_10212, (Ref$get(i_10212) + 1));
                break _t10229;
              }
              _match_fail("line 16933");
            }
            _t10226 = _t10228;
          }
          _t10225 = _t10226;
        }
        const _t10224 = _t10225;
        _t10222 = _t10224;
      }
      _t10221 = _t10222;
    }
    _t10221;
    if (_t10219) break;
  }
  _t10218 = _t10219 ? _t10220 : undefined;
  _t10218;
  const _t10217 = Ref$get(result_10214);
  const _t10215 = _t10217;
  const _t10213 = _t10215;
  const _t10211 = _t10213;
  return _t10211;
}
function Optimize$mark_set_get_pairs(code, targets, actions) {
  const len_10230 = Array$length(code);
  const i_10232 = Ref$create(0);
  let _t10234 = undefined;
  let _t10235 = false, _t10236;
  while (true) {
    if (!((Ref$get(i_10232) < (len_10230 - 1)))) break;
    let _t10237;
    if ((_eq(Array$get(actions, Ref$get(i_10232)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_10232) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_10232) + 1)]))))) {
      let _t10239;
      const _t10238 = [Array$get(code, Ref$get(i_10232)), Array$get(code, (Ref$get(i_10232) + 1))];
      _t10240: {
        if (_t10238[0]._tag === 4 && _t10238[1]._tag === 3) {
          const n = _t10238[0]._val;
          const m = _t10238[1]._val;
          if ((n === m)) {
            let _t10241;
            if (Optimize$is_slot_dead(code, actions, targets, n, (Ref$get(i_10232) + 2))) {
              Array$set(actions, Ref$get(i_10232), ({_tag: 1, _name: "Remove"}));
              Array$set(actions, (Ref$get(i_10232) + 1), ({_tag: 1, _name: "Remove"}));
              _t10241 = Ref$set(i_10232, (Ref$get(i_10232) + 2));
            } else {
              Array$set(actions, Ref$get(i_10232), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 2, _name: "DUP"}), _tl: ({_hd: ({_tag: 4, _name: "SET_LOCAL", _val: n}), _tl: null})})}));
              Array$set(actions, (Ref$get(i_10232) + 1), ({_tag: 1, _name: "Remove"}));
              _t10241 = Ref$set(i_10232, (Ref$get(i_10232) + 2));
            }
            _t10239 = _t10241;
            break _t10240;
          }
        }
        if (true) {
          _t10239 = Ref$set(i_10232, (Ref$get(i_10232) + 1));
          break _t10240;
        }
        _match_fail("line 16933");
      }
      _t10237 = _t10239;
    } else {
      _t10237 = Ref$set(i_10232, (Ref$get(i_10232) + 1));
    }
    _t10237;
    if (_t10235) break;
  }
  _t10234 = _t10235 ? _t10236 : undefined;
  const _t10233 = _t10234;
  const _t10231 = _t10233;
  return _t10231;
}
function Optimize$mark_dead_stores(code, targets, actions) {
  const len_10242 = Array$length(code);
  const i_10244 = Ref$create(0);
  let _t10246 = undefined;
  let _t10247 = false, _t10248;
  while (true) {
    if (!((Ref$get(i_10244) < len_10242))) break;
    const handled_10249 = Ref$create(false);
    let _t10251;
    if ((((Ref$get(i_10244) + 1) < len_10242) && (_eq(Array$get(actions, Ref$get(i_10244)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_10244) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_10244) + 1)])))))) {
      let _t10253;
      const _t10252 = [Array$get(code, Ref$get(i_10244)), Array$get(code, (Ref$get(i_10244) + 1))];
      _t10254: {
        if (_t10252[0]._tag === 2 && _t10252[1]._tag === 4) {
          const n = _t10252[1]._val;
          if (Optimize$is_slot_dead(code, actions, targets, n, (Ref$get(i_10244) + 2))) {
            Array$set(actions, Ref$get(i_10244), ({_tag: 1, _name: "Remove"}));
            Array$set(actions, (Ref$get(i_10244) + 1), ({_tag: 1, _name: "Remove"}));
            Ref$set(i_10244, (Ref$get(i_10244) + 2));
            _t10253 = Ref$set(handled_10249, true);
            break _t10254;
          }
        }
        if (true) {
          _t10253 = undefined;
          break _t10254;
        }
        _match_fail("line 16933");
      }
      _t10251 = _t10253;
    } else {
      _t10251 = undefined;
    }
    _t10251;
    let _t10255;
    if ((!Ref$get(handled_10249))) {
      let _t10257;
      const _t10256 = Array$get(code, Ref$get(i_10244));
      _t10258: {
        if (_t10256._tag === 4) {
          const n = _t10256._val;
          if ((_eq(Array$get(actions, Ref$get(i_10244)), ({_tag: 0, _name: "Keep"})) && Optimize$is_slot_dead(code, actions, targets, n, (Ref$get(i_10244) + 1)))) {
            Array$set(actions, Ref$get(i_10244), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 1, _name: "POP"}), _tl: null})}));
            _t10257 = Ref$set(i_10244, (Ref$get(i_10244) + 1));
            break _t10258;
          }
        }
        if (true) {
          _t10257 = Ref$set(i_10244, (Ref$get(i_10244) + 1));
          break _t10258;
        }
        _match_fail("line 16933");
      }
      _t10255 = _t10257;
    } else {
      _t10255 = undefined;
    }
    const _t10250 = _t10255;
    _t10250;
    if (_t10247) break;
  }
  _t10246 = _t10247 ? _t10248 : undefined;
  const _t10245 = _t10246;
  const _t10243 = _t10245;
  return _t10243;
}
function Optimize$mark_superinstructions(code, targets, actions) {
  const len_10259 = Array$length(code);
  const i_10261 = Ref$create(0);
  let _t10263 = undefined;
  let _t10264 = false, _t10265;
  while (true) {
    if (!((Ref$get(i_10261) < len_10259))) break;
    let _t10266;
    if ((((Ref$get(i_10261) + 1) < len_10259) && (_eq(Array$get(actions, Ref$get(i_10261)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_10261) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_10261) + 1)])))))) {
      let _t10268;
      const _t10267 = [Array$get(code, Ref$get(i_10261)), Array$get(code, (Ref$get(i_10261) + 1))];
      _t10269: {
        if (_t10267[0]._tag === 3 && _t10267[1]._tag === 42) {
          const slot = _t10267[0]._val;
          const arity = _t10267[1]._val;
          Array$set(actions, Ref$get(i_10261), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 76, _name: "GET_LOCAL_CALL", _val: [slot, arity]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10261) + 1), ({_tag: 1, _name: "Remove"}));
          _t10268 = Ref$set(i_10261, (Ref$get(i_10261) + 2));
          break _t10269;
        }
        if (_t10267[0]._tag === 3 && _t10267[1]._tag === 49) {
          const slot = _t10267[0]._val;
          const idx = _t10267[1]._val;
          Array$set(actions, Ref$get(i_10261), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 77, _name: "GET_LOCAL_TUPLE_GET", _val: [slot, idx]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10261) + 1), ({_tag: 1, _name: "Remove"}));
          _t10268 = Ref$set(i_10261, (Ref$get(i_10261) + 2));
          break _t10269;
        }
        if (_t10267[0]._tag === 3 && _t10267[1]._tag === 51) {
          const slot = _t10267[0]._val;
          const name = _t10267[1]._val;
          Array$set(actions, Ref$get(i_10261), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 78, _name: "GET_LOCAL_FIELD", _val: [slot, name]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10261) + 1), ({_tag: 1, _name: "Remove"}));
          _t10268 = Ref$set(i_10261, (Ref$get(i_10261) + 2));
          break _t10269;
        }
        if (_t10267[0]._tag === 10 && _t10267[1]._tag === 42) {
          const idx = _t10267[0]._val;
          const arity = _t10267[1]._val;
          Array$set(actions, Ref$get(i_10261), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 79, _name: "GET_GLOBAL_CALL", _val: [idx, arity]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10261) + 1), ({_tag: 1, _name: "Remove"}));
          _t10268 = Ref$set(i_10261, (Ref$get(i_10261) + 2));
          break _t10269;
        }
        if (_t10267[0]._tag === 10 && _t10267[1]._tag === 51) {
          const idx = _t10267[0]._val;
          const name = _t10267[1]._val;
          Array$set(actions, Ref$get(i_10261), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 80, _name: "GET_GLOBAL_FIELD", _val: [idx, name]}), _tl: null})}));
          Array$set(actions, (Ref$get(i_10261) + 1), ({_tag: 1, _name: "Remove"}));
          _t10268 = Ref$set(i_10261, (Ref$get(i_10261) + 2));
          break _t10269;
        }
        if (true) {
          _t10268 = Ref$set(i_10261, (Ref$get(i_10261) + 1));
          break _t10269;
        }
        _match_fail("line 16933");
      }
      _t10266 = _t10268;
    } else {
      _t10266 = Ref$set(i_10261, (Ref$get(i_10261) + 1));
    }
    _t10266;
    if (_t10264) break;
  }
  _t10263 = _t10264 ? _t10265 : undefined;
  const _t10262 = _t10263;
  const _t10260 = _t10262;
  return _t10260;
}
function Optimize$detect_tag_chain(code, _targets, start_pos, scrut_slot) {
  const len_10270 = Array$length(code);
  const arms_10272 = Ref$create(null);
  const pos_10274 = Ref$create(start_pos);
  const continue__10276 = Ref$create(true);
  const default_target_10278 = Ref$create(0);
  const chain_positions_10280 = Hashtbl$create(16);
  let _t10282 = undefined;
  let _t10283 = false, _t10284;
  while (true) {
    if (!(Ref$get(continue__10276))) break;
    let _t10296;
    if (((Ref$get(pos_10274) + 2) < len_10270)) {
    let _t10286;
    const _t10285 = Array$get(code, Ref$get(pos_10274));
    _t10287: {
      if (_t10285._tag === 3) {
        const s = _t10285._val;
        if ((s === scrut_slot)) {
          _t10286 = true;
          break _t10287;
        }
      }
      if (true) {
        _t10286 = false;
        break _t10287;
      }
      _match_fail("line 16933");
    }
    let _t10295;
    if (_t10286) {
    let _t10289;
    const _t10288 = Array$get(code, (Ref$get(pos_10274) + 1));
    _t10290: {
      if (_t10288._tag === 58) {
        _t10289 = true;
        break _t10290;
      }
      if (true) {
        _t10289 = false;
        break _t10290;
      }
      _match_fail("line 16933");
    }
    let _t10294;
    if (_t10289) {
    let _t10292;
    const _t10291 = Array$get(code, (Ref$get(pos_10274) + 2));
    _t10293: {
      if (_t10291._tag === 38) {
        const t = _t10291._val;
        _t10292 = (t > Ref$get(pos_10274));
        break _t10293;
      }
      if (true) {
        _t10292 = false;
        break _t10293;
      }
      _match_fail("line 16933");
    }
      _t10294 = _t10292;
    } else {
      _t10294 = false;
    }
      _t10295 = _t10294;
    } else {
      _t10295 = false;
    }
      _t10296 = _t10295;
    } else {
      _t10296 = false;
    }
    let _t10297;
    if (_t10296) {
      let _t10299;
      const _t10298 = Array$get(code, (Ref$get(pos_10274) + 1));
      _t10300: {
        if (_t10298._tag === 58) {
          const t = _t10298._val;
          _t10299 = t;
          break _t10300;
        }
        if (true) {
          _t10299 = failwith("assert false");
          break _t10300;
        }
        _match_fail("line 16933");
      }
      const tag_10301 = _t10299;
      let _t10304;
      const _t10303 = Array$get(code, (Ref$get(pos_10274) + 2));
      _t10305: {
        if (_t10303._tag === 38) {
          const t = _t10303._val;
          _t10304 = t;
          break _t10305;
        }
        if (true) {
          _t10304 = failwith("assert false");
          break _t10305;
        }
        _match_fail("line 16933");
      }
      const next_10306 = _t10304;
      const arm_body_10308 = (Ref$get(pos_10274) + 3);
      Ref$set(arms_10272, ({_hd: [tag_10301, arm_body_10308], _tl: Ref$get(arms_10272)}));
      _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, chain_positions_10280, Ref$get(pos_10274), undefined]);
      _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, chain_positions_10280, (Ref$get(pos_10274) + 1), undefined]);
      _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, chain_positions_10280, (Ref$get(pos_10274) + 2), undefined]);
      const _t10309 = Ref$set(pos_10274, next_10306);
      const _t10307 = _t10309;
      const _t10302 = _t10307;
      _t10297 = _t10302;
    } else {
      Ref$set(default_target_10278, Ref$get(pos_10274));
      _t10297 = Ref$set(continue__10276, false);
    }
    _t10297;
    if (_t10283) break;
  }
  _t10282 = _t10283 ? _t10284 : undefined;
  _t10282;
  const arms_10310 = List$rev(Ref$get(arms_10272));
  const valid_10312 = (List$length(arms_10310) >= 2);
  let _t10325;
  if (valid_10312) {
  const ok_10314 = Ref$create(true);
  function _t10316(i, op) {
    let _t10317;
    if ((Ref$get(ok_10314) && (!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, chain_positions_10280, i])))) {
      function _t10318(t) {
        let _t10319;
        if (_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, chain_positions_10280, t])) {
          _t10319 = Ref$set(ok_10314, false);
        } else {
          _t10319 = undefined;
        }
        return _t10319;
      }
      const check_target_10320 = _t10318;
      let _t10323;
      const _t10322 = op;
      _t10324: {
        if (((((_t10322._tag === 37 || _t10322._tag === 38) || _t10322._tag === 39) || _t10322._tag === 68) || _t10322._tag === 71)) {
          const t = _t10322._val;
          _t10323 = check_target_10320(t);
          break _t10324;
        }
        if (true) {
          _t10323 = undefined;
          break _t10324;
        }
        _match_fail("line 16933");
      }
      const _t10321 = _t10323;
      _t10317 = _t10321;
    } else {
      _t10317 = undefined;
    }
    return _t10317;
  }
  Array$iteri(_t10316, code);
  const _t10315 = Ref$get(ok_10314);
    _t10325 = _t10315;
  } else {
    _t10325 = false;
  }
  const valid_10326 = _t10325;
  let _t10328;
  if ((valid_10326 && !_eq(arms_10310, null))) {
    const tags_10329 = List$map(fst, arms_10310);
    const unique_tags_10331 = List$sort_uniq(compare, tags_10329);
    let _t10333;
    if ((List$length(unique_tags_10331) !== List$length(tags_10329))) {
      _t10333 = ({_tag: 0, _name: "None"});
    } else {
      const min_tag_10334 = List$fold(min, List$hd(tags_10329), tags_10329);
      const max_tag_10336 = List$fold(max, List$hd(tags_10329), tags_10329);
      const range_10338 = ((max_tag_10336 - min_tag_10334) + 1);
      let _t10340;
      if ((range_10338 <= (2 * List$length(arms_10310)))) {
        _t10340 = ({_tag: 1, _name: "Some", _val: [arms_10310, min_tag_10334, max_tag_10336, Ref$get(default_target_10278)]});
      } else {
        _t10340 = ({_tag: 0, _name: "None"});
      }
      const _t10339 = _t10340;
      const _t10337 = _t10339;
      const _t10335 = _t10337;
      _t10333 = _t10335;
    }
    const _t10332 = _t10333;
    const _t10330 = _t10332;
    _t10328 = _t10330;
  } else {
    _t10328 = ({_tag: 0, _name: "None"});
  }
  const _t10327 = _t10328;
  const _t10313 = _t10327;
  const _t10311 = _t10313;
  const _t10281 = _t10311;
  const _t10279 = _t10281;
  const _t10277 = _t10279;
  const _t10275 = _t10277;
  const _t10273 = _t10275;
  const _t10271 = _t10273;
  return _t10271;
}
function Optimize$mark_jump_tables(code, targets, actions) {
  const len_10341 = Array$length(code);
  const i_10343 = Ref$create(0);
  let _t10345 = undefined;
  let _t10346 = false, _t10347;
  while (true) {
    if (!((Ref$get(i_10343) < len_10341))) break;
    let _t10348;
    if ((((Ref$get(i_10343) + 2) < len_10341) && _eq(Array$get(actions, Ref$get(i_10343)), ({_tag: 0, _name: "Keep"})))) {
      let _t10350;
      const _t10349 = [Array$get(code, Ref$get(i_10343)), Array$get(code, (Ref$get(i_10343) + 1)), Array$get(code, (Ref$get(i_10343) + 2))];
      _t10351: {
        if (_t10349[0]._tag === 3 && _t10349[1]._tag === 58 && _t10349[2]._tag === 38) {
          const scrut_slot = _t10349[0]._val;
          let _t10353;
          const _t10352 = Optimize$detect_tag_chain(code, targets, Ref$get(i_10343), scrut_slot);
          _t10354: {
            if (_t10352._tag === 1) {
              const arms = _t10352._val[0];
              const min_tag = _t10352._val[1];
              const max_tag = _t10352._val[2];
              const default_target = _t10352._val[3];
              const range_10355 = ((max_tag - min_tag) + 1);
              const table_10357 = Array$make(range_10355, default_target);
              function _t10359(__p375) {
                let _t10361;
                const _t10360 = __p375;
                _t10362: {
                  if (true) {
                    const tag = _t10360[0];
                    const arm_body = _t10360[1];
                    _t10361 = Array$set(table_10357, (tag - min_tag), arm_body);
                    break _t10362;
                  }
                  _match_fail("line 16933");
                }
                return _t10361;
              }
              List$iter(_t10359, arms);
              Array$set(actions, (Ref$get(i_10343) + 1), ({_tag: 2, _name: "ReplaceWith", _val: ({_hd: ({_tag: 81, _name: "JUMP_TABLE", _val: [min_tag, table_10357, default_target]}), _tl: null})}));
              Array$set(actions, (Ref$get(i_10343) + 2), ({_tag: 1, _name: "Remove"}));
              const remaining_10363 = List$tl(arms);
              function _t10365(__p376) {
                let _t10367;
                const _t10366 = __p376;
                _t10368: {
                  if (true) {
                    const arm_body = _t10366[1];
                    const chain_start_10369 = (arm_body - 3);
                    let _t10371;
                    if (((chain_start_10369 >= 0) && (chain_start_10369 < len_10341))) {
                      let _t10372;
                      if (_eq(Array$get(actions, chain_start_10369), ({_tag: 0, _name: "Keep"}))) {
                        _t10372 = Array$set(actions, chain_start_10369, ({_tag: 1, _name: "Remove"}));
                      } else {
                        _t10372 = undefined;
                      }
                      _t10372;
                      let _t10373;
                      if ((((chain_start_10369 + 1) < len_10341) && _eq(Array$get(actions, (chain_start_10369 + 1)), ({_tag: 0, _name: "Keep"})))) {
                        _t10373 = Array$set(actions, (chain_start_10369 + 1), ({_tag: 1, _name: "Remove"}));
                      } else {
                        _t10373 = undefined;
                      }
                      _t10373;
                      let _t10374;
                      if ((((chain_start_10369 + 2) < len_10341) && _eq(Array$get(actions, (chain_start_10369 + 2)), ({_tag: 0, _name: "Keep"})))) {
                        _t10374 = Array$set(actions, (chain_start_10369 + 2), ({_tag: 1, _name: "Remove"}));
                      } else {
                        _t10374 = undefined;
                      }
                      _t10371 = _t10374;
                    } else {
                      _t10371 = undefined;
                    }
                    const _t10370 = _t10371;
                    _t10367 = _t10370;
                    break _t10368;
                  }
                  _match_fail("line 16933");
                }
                return _t10367;
              }
              List$iter(_t10365, remaining_10363);
              const last_arm_10375 = List$nth(arms, (List$length(arms) - 1));
              const _t10376 = Ref$set(i_10343, snd(last_arm_10375));
              const _t10364 = _t10376;
              const _t10358 = _t10364;
              const _t10356 = _t10358;
              _t10353 = _t10356;
              break _t10354;
            }
            if (_t10352._tag === 0) {
              _t10353 = Ref$set(i_10343, (Ref$get(i_10343) + 1));
              break _t10354;
            }
            _match_fail("line 16933");
          }
          _t10350 = _t10353;
          break _t10351;
        }
        if (true) {
          _t10350 = Ref$set(i_10343, (Ref$get(i_10343) + 1));
          break _t10351;
        }
        _match_fail("line 16933");
      }
      _t10348 = _t10350;
    } else {
      _t10348 = Ref$set(i_10343, (Ref$get(i_10343) + 1));
    }
    _t10348;
    if (_t10346) break;
  }
  _t10345 = _t10346 ? _t10347 : undefined;
  const _t10344 = _t10345;
  const _t10342 = _t10344;
  return _t10342;
}
function Optimize$mark_push_pop(code, targets, actions) {
  const len_10377 = Array$length(code);
  const i_10379 = Ref$create(0);
  let _t10381 = undefined;
  let _t10382 = false, _t10383;
  while (true) {
    if (!((Ref$get(i_10379) < (len_10377 - 1)))) break;
    let _t10384;
    if ((_eq(Array$get(actions, Ref$get(i_10379)), ({_tag: 0, _name: "Keep"})) && (_eq(Array$get(actions, (Ref$get(i_10379) + 1)), ({_tag: 0, _name: "Keep"})) && (!_call(Optimize$is_jump_target, [__dict_Hash_int, __dict_Eq_int, targets, (Ref$get(i_10379) + 1)]))))) {
      let _t10386;
      const _t10385 = Array$get(code, Ref$get(i_10379));
      _t10387: {
        if ((((((_t10385._tag === 0 || _t10385._tag === 3) || _t10385._tag === 10) || _t10385._tag === 5) || _t10385._tag === 57) || _t10385._tag === 2)) {
          _t10386 = true;
          break _t10387;
        }
        if (true) {
          _t10386 = false;
          break _t10387;
        }
        _match_fail("line 16933");
      }
      const is_pure_push_10388 = _t10386;
      let _t10391;
      const _t10390 = Array$get(code, (Ref$get(i_10379) + 1));
      _t10392: {
        if (_t10390._tag === 1) {
          if (is_pure_push_10388) {
            Array$set(actions, Ref$get(i_10379), ({_tag: 1, _name: "Remove"}));
            Array$set(actions, (Ref$get(i_10379) + 1), ({_tag: 1, _name: "Remove"}));
            _t10391 = Ref$set(i_10379, (Ref$get(i_10379) + 2));
            break _t10392;
          }
        }
        if (true) {
          _t10391 = Ref$set(i_10379, (Ref$get(i_10379) + 1));
          break _t10392;
        }
        _match_fail("line 16933");
      }
      const _t10389 = _t10391;
      _t10384 = _t10389;
    } else {
      _t10384 = Ref$set(i_10379, (Ref$get(i_10379) + 1));
    }
    _t10384;
    if (_t10382) break;
  }
  _t10381 = _t10382 ? _t10383 : undefined;
  const _t10380 = _t10381;
  const _t10378 = _t10380;
  return _t10378;
}
function Optimize$rewrite(code, line_table, actions) {
  const len_10393 = Array$length(code);
  const new_code_10395 = Ref$create(null);
  const new_lines_10397 = Ref$create(null);
  const offset_map_10399 = Array$make((len_10393 + 1), 0);
  const new_offset_10401 = Ref$create(0);
  let i_10403 = 0;
  let _t10405 = undefined;
  let _t10406 = false, _t10407;
  while (true) {
    if (!((i_10403 <= (len_10393 - 1)))) break;
    Array$set(offset_map_10399, i_10403, Ref$get(new_offset_10401));
    let _t10408;
    if ((i_10403 < Array$length(line_table))) {
      _t10408 = Array$get(line_table, i_10403);
    } else {
      _t10408 = 0;
    }
    const line_10409 = _t10408;
    let _t10412;
    const _t10411 = Array$get(actions, i_10403);
    _t10413: {
      if (_t10411._tag === 0) {
        Ref$set(new_code_10395, ({_hd: Array$get(code, i_10403), _tl: Ref$get(new_code_10395)}));
        Ref$set(new_lines_10397, ({_hd: line_10409, _tl: Ref$get(new_lines_10397)}));
        _t10412 = Ref$set(new_offset_10401, (Ref$get(new_offset_10401) + 1));
        break _t10413;
      }
      if (_t10411._tag === 1) {
        _t10412 = undefined;
        break _t10413;
      }
      if (_t10411._tag === 2) {
        const ops = _t10411._val;
        function _t10414(op) {
          Ref$set(new_code_10395, ({_hd: op, _tl: Ref$get(new_code_10395)}));
          Ref$set(new_lines_10397, ({_hd: line_10409, _tl: Ref$get(new_lines_10397)}));
          return Ref$set(new_offset_10401, (Ref$get(new_offset_10401) + 1));
        }
        _t10412 = List$iter(_t10414, ops);
        break _t10413;
      }
      _match_fail("line 16933");
    }
    const _t10410 = _t10412;
    _t10410;
    (i_10403 = (i_10403 + 1), undefined);
    if (_t10406) break;
  }
  _t10405 = _t10406 ? _t10407 : undefined;
  _t10405;
  Array$set(offset_map_10399, len_10393, Ref$get(new_offset_10401));
  const new_code_10415 = Array$of_list(List$rev(Ref$get(new_code_10395)));
  const new_lines_10417 = Array$of_list(List$rev(Ref$get(new_lines_10397)));
  const _t10418 = [new_code_10415, new_lines_10417, offset_map_10399];
  const _t10416 = _t10418;
  const _t10404 = _t10416;
  const _t10402 = _t10404;
  const _t10400 = _t10402;
  const _t10398 = _t10400;
  const _t10396 = _t10398;
  const _t10394 = _t10396;
  return _t10394;
}
function Optimize$fixup_jumps(code, offset_map) {
  const map_len_10419 = Array$length(offset_map);
  function _t10421(t) {
    let _t10422;
    if (((t >= 0) && (t < map_len_10419))) {
      _t10422 = Array$get(offset_map, t);
    } else {
      _t10422 = t;
    }
    return _t10422;
  }
  const remap_10423 = _t10421;
  function _t10425(i, op) {
    let _t10427;
    const _t10426 = op;
    _t10428: {
      if (_t10426._tag === 37) {
        const t = _t10426._val;
        _t10427 = ({_tag: 37, _name: "JUMP", _val: remap_10423(t)});
        break _t10428;
      }
      if (_t10426._tag === 38) {
        const t = _t10426._val;
        _t10427 = ({_tag: 38, _name: "JUMP_IF_FALSE", _val: remap_10423(t)});
        break _t10428;
      }
      if (_t10426._tag === 39) {
        const t = _t10426._val;
        _t10427 = ({_tag: 39, _name: "JUMP_IF_TRUE", _val: remap_10423(t)});
        break _t10428;
      }
      if (_t10426._tag === 68) {
        const t = _t10426._val;
        _t10427 = ({_tag: 68, _name: "ENTER_LOOP", _val: remap_10423(t)});
        break _t10428;
      }
      if (_t10426._tag === 71) {
        const t = _t10426._val;
        _t10427 = ({_tag: 71, _name: "LOOP_CONTINUE", _val: remap_10423(t)});
        break _t10428;
      }
      if (_t10426._tag === 81) {
        const min_tag = _t10426._val[0];
        const targets = _t10426._val[1];
        const _mml$default = _t10426._val[2];
        function _t10429(t) {
          return remap_10423(t);
        }
        const new_targets_10430 = Array$map(_t10429, targets);
        const new_default_10432 = remap_10423(_mml$default);
        const _t10433 = ({_tag: 81, _name: "JUMP_TABLE", _val: [min_tag, new_targets_10430, new_default_10432]});
        const _t10431 = _t10433;
        _t10427 = _t10431;
        break _t10428;
      }
      if (true) {
        const other = _t10426;
        _t10427 = other;
        break _t10428;
      }
      _match_fail("line 16933");
    }
    const remapped_10434 = _t10427;
    const _t10435 = Array$set(code, i, remapped_10434);
    return _t10435;
  }
  const _t10424 = Array$iteri(_t10425, code);
  const _t10420 = _t10424;
  return _t10420;
}
function Optimize$thread_jumps(code) {
  const len_10436 = Array$length(code);
  let _t10438;
  if ((len_10436 === 0)) {
    _t10438 = undefined;
  } else {
    function _t10439(target) {
      const visited_10440 = Hashtbl$create(8);
      const t_10442 = Ref$create(target);
      const continue__10444 = Ref$create(true);
      let _t10446 = undefined;
      let _t10447 = false, _t10448;
      while (true) {
        if (!(Ref$get(continue__10444))) break;
        let _t10449;
        if (((Ref$get(t_10442) < 0) || ((Ref$get(t_10442) >= len_10436) || _call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, visited_10440, Ref$get(t_10442)])))) {
          _t10449 = Ref$set(continue__10444, false);
        } else {
          let _t10451;
          const _t10450 = Array$get(code, Ref$get(t_10442));
          _t10452: {
            if (_t10450._tag === 37) {
              const next = _t10450._val;
              _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, visited_10440, Ref$get(t_10442), undefined]);
              _t10451 = Ref$set(t_10442, next);
              break _t10452;
            }
            if (true) {
              _t10451 = Ref$set(continue__10444, false);
              break _t10452;
            }
            _match_fail("line 16933");
          }
          _t10449 = _t10451;
        }
        _t10449;
        if (_t10447) break;
      }
      _t10446 = _t10447 ? _t10448 : undefined;
      _t10446;
      const _t10445 = Ref$get(t_10442);
      const _t10443 = _t10445;
      const _t10441 = _t10443;
      return _t10441;
    }
    const resolve_target_10453 = _t10439;
    const control_depth_10455 = Array$make(len_10436, 0);
    const depth_10457 = Ref$create(0);
    let i_10459 = 0;
    let _t10461 = undefined;
    let _t10462 = false, _t10463;
    while (true) {
      if (!((i_10459 <= (len_10436 - 1)))) break;
      Array$set(control_depth_10455, i_10459, Ref$get(depth_10457));
      let _t10465;
      const _t10464 = Array$get(code, i_10459);
      _t10466: {
        if (_t10464._tag === 68) {
          _t10465 = Ref$set(depth_10457, (Ref$get(depth_10457) + 1));
          break _t10466;
        }
        if (_t10464._tag === 69) {
          let _t10467;
          if ((Ref$get(depth_10457) > 0)) {
            _t10467 = Ref$set(depth_10457, (Ref$get(depth_10457) - 1));
          } else {
            _t10467 = undefined;
          }
          _t10465 = _t10467;
          break _t10466;
        }
        if (true) {
          _t10465 = undefined;
          break _t10466;
        }
        _match_fail("line 16933");
      }
      _t10465;
      (i_10459 = (i_10459 + 1), undefined);
      if (_t10462) break;
    }
    _t10461 = _t10462 ? _t10463 : undefined;
    _t10461;
    let i_10468 = 0;
    let _t10470 = undefined;
    let _t10471 = false, _t10472;
    while (true) {
      if (!((i_10468 <= (len_10436 - 1)))) break;
      let _t10474;
      const _t10473 = Array$get(code, i_10468);
      _t10475: {
        if (_t10473._tag === 37) {
          const target = _t10473._val;
          const final_target_10476 = resolve_target_10453(target);
          let _t10478;
          if (((final_target_10476 >= 0) && ((final_target_10476 < len_10436) && (Array$get(control_depth_10455, i_10468) === 0)))) {
            let _t10480;
            const _t10479 = Array$get(code, final_target_10476);
            _t10481: {
              if (_t10479._tag === 44) {
                _t10480 = Array$set(code, i_10468, ({_tag: 44, _name: "RETURN"}));
                break _t10481;
              }
              if (true) {
                let _t10482;
                if ((final_target_10476 !== target)) {
                  _t10482 = Array$set(code, i_10468, ({_tag: 37, _name: "JUMP", _val: final_target_10476}));
                } else {
                  _t10482 = undefined;
                }
                _t10480 = _t10482;
                break _t10481;
              }
              _match_fail("line 16933");
            }
            _t10478 = _t10480;
          } else {
            let _t10483;
            if ((final_target_10476 !== target)) {
              _t10483 = Array$set(code, i_10468, ({_tag: 37, _name: "JUMP", _val: final_target_10476}));
            } else {
              _t10483 = undefined;
            }
            _t10478 = _t10483;
          }
          const _t10477 = _t10478;
          _t10474 = _t10477;
          break _t10475;
        }
        if (_t10473._tag === 38) {
          const target = _t10473._val;
          const final_target_10484 = resolve_target_10453(target);
          let _t10486;
          if ((final_target_10484 !== target)) {
            _t10486 = Array$set(code, i_10468, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: final_target_10484}));
          } else {
            _t10486 = undefined;
          }
          const _t10485 = _t10486;
          _t10474 = _t10485;
          break _t10475;
        }
        if (_t10473._tag === 39) {
          const target = _t10473._val;
          const final_target_10487 = resolve_target_10453(target);
          let _t10489;
          if ((final_target_10487 !== target)) {
            _t10489 = Array$set(code, i_10468, ({_tag: 39, _name: "JUMP_IF_TRUE", _val: final_target_10487}));
          } else {
            _t10489 = undefined;
          }
          const _t10488 = _t10489;
          _t10474 = _t10488;
          break _t10475;
        }
        if (_t10473._tag === 81) {
          const min_tag = _t10473._val[0];
          const targets = _t10473._val[1];
          const default_target = _t10473._val[2];
          const changed_10490 = Ref$create(false);
          function _t10492(t) {
            const final_t_10493 = resolve_target_10453(t);
            let _t10495;
            if ((final_t_10493 !== t)) {
              _t10495 = Ref$set(changed_10490, true);
            } else {
              _t10495 = undefined;
            }
            _t10495;
            const _t10494 = final_t_10493;
            return _t10494;
          }
          const new_targets_10496 = Array$map(_t10492, targets);
          const new_default_10498 = resolve_target_10453(default_target);
          let _t10500;
          if ((new_default_10498 !== default_target)) {
            _t10500 = Ref$set(changed_10490, true);
          } else {
            _t10500 = undefined;
          }
          _t10500;
          let _t10501;
          if (Ref$get(changed_10490)) {
            _t10501 = Array$set(code, i_10468, ({_tag: 81, _name: "JUMP_TABLE", _val: [min_tag, new_targets_10496, new_default_10498]}));
          } else {
            _t10501 = undefined;
          }
          const _t10499 = _t10501;
          const _t10497 = _t10499;
          const _t10491 = _t10497;
          _t10474 = _t10491;
          break _t10475;
        }
        if (true) {
          _t10474 = undefined;
          break _t10475;
        }
        _match_fail("line 16933");
      }
      _t10474;
      (i_10468 = (i_10468 + 1), undefined);
      if (_t10471) break;
    }
    _t10470 = _t10471 ? _t10472 : undefined;
    const _t10469 = _t10470;
    const _t10460 = _t10469;
    const _t10458 = _t10460;
    const _t10456 = _t10458;
    const _t10454 = _t10456;
    _t10438 = _t10454;
  }
  const _t10437 = _t10438;
  return _t10437;
}
function Optimize$optimize_code(_constants, code, line_table) {
  const len_10502 = Array$length(code);
  let _t10504;
  if ((len_10502 === 0)) {
    _t10504 = [code, line_table];
  } else {
    const targets_10505 = Optimize$collect_jump_targets(code);
    const actions_10507 = Array$make(len_10502, ({_tag: 0, _name: "Keep"}));
    Optimize$mark_dead_after_tail_call(code, targets_10505, actions_10507);
    Optimize$mark_jump_to_next(code, actions_10507);
    Optimize$mark_dead_stores(code, targets_10505, actions_10507);
    Optimize$mark_set_get_pairs(code, targets_10505, actions_10507);
    Optimize$mark_jump_tables(code, targets_10505, actions_10507);
    Optimize$mark_push_pop(code, targets_10505, actions_10507);
    Optimize$mark_superinstructions(code, targets_10505, actions_10507);
    const any_changes_10509 = Ref$create(false);
    function _t10511(a) {
      let _t10512;
      if (!_eq(a, ({_tag: 0, _name: "Keep"}))) {
        _t10512 = Ref$set(any_changes_10509, true);
      } else {
        _t10512 = undefined;
      }
      return _t10512;
    }
    Array$iter(_t10511, actions_10507);
    let _t10513;
    if ((!Ref$get(any_changes_10509))) {
      _t10513 = [code, line_table];
    } else {
      let _t10515;
      const _t10514 = Optimize$rewrite(code, line_table, actions_10507);
      _t10516: {
        if (true) {
          const new_code = _t10514[0];
          const new_lines = _t10514[1];
          const offset_map = _t10514[2];
          Optimize$fixup_jumps(new_code, offset_map);
          _t10515 = [new_code, new_lines];
          break _t10516;
        }
        _match_fail("line 16933");
      }
      _t10513 = _t10515;
    }
    let _t10518;
    const _t10517 = _t10513;
    _t10519: {
      if (true) {
        const final_code = _t10517[0];
        const final_lines = _t10517[1];
        Optimize$thread_jumps(final_code);
        _t10518 = [final_code, final_lines];
        break _t10519;
      }
      _match_fail("line 16933");
    }
    const _t10510 = _t10518;
    const _t10508 = _t10510;
    const _t10506 = _t10508;
    _t10504 = _t10506;
  }
  const _t10503 = _t10504;
  return _t10503;
}
function Optimize$optimize_proto(proto) {
  function _t10520(v) {
    let _t10522;
    const _t10521 = v;
    _t10523: {
      if (_t10521._tag === 13) {
        const p = _t10521._val;
        _t10522 = ({_tag: 13, _name: "VProto", _val: Optimize$optimize_proto(p)});
        break _t10523;
      }
      if (true) {
        const other = _t10521;
        _t10522 = other;
        break _t10523;
      }
      _match_fail("line 16933");
    }
    return _t10522;
  }
  const new_constants_10524 = Array$map(_t10520, proto.constants);
  let _t10527;
  const _t10526 = Optimize$optimize_code(new_constants_10524, proto.code, proto.line_table);
  _t10528: {
    if (true) {
      const new_code = _t10526[0];
      const new_lines = _t10526[1];
      const __rec_upd_10529 = proto;
      const _t10530 = ({arity: __rec_upd_10529.arity, code: new_code, constants: new_constants_10524, line_table: new_lines, name: __rec_upd_10529.name, num_locals: __rec_upd_10529.num_locals});
      _t10527 = _t10530;
      break _t10528;
    }
    _match_fail("line 16933");
  }
  const _t10525 = _t10527;
  return _t10525;
}
const Compiler$optimize_enabled = Ref$create(true);
function Compiler$error(msg) {
  return _trampoline(function() {
    return _h["compile_error"](msg, function(_t10531) {
      return _bounce(function() {
        return _t10531;
      });
    });
  }, Compiler$error);
}
function Compiler$create_state(enclosing, arity, global_names, mutable_globals, type_env, name) {
  return ({arity: arity, code: Dynarray$empty(undefined), constants: Dynarray$empty(undefined), current_line: 0, enclosing: enclosing, global_names: global_names, lines: Dynarray$empty(undefined), locals: null, loop_start: ({_tag: 0, _name: "None"}), max_locals: 0, mutable_globals: mutable_globals, mutable_locals: null, num_locals: 0, operand_depth: 0, proto_name: name, scope_depth: 0, type_env: type_env, upvalues: null});
}
function Compiler$emit(__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, op) {
  Dynarray$push(s.code, op);
  return Dynarray$push(s.lines, s.current_line);
}
function Compiler$emit_idx(__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, op) {
  const idx_10532 = Dynarray$length(s.code);
  Dynarray$push(s.code, op);
  Dynarray$push(s.lines, s.current_line);
  const _t10533 = idx_10532;
  return _t10533;
}
function Compiler$patch(__ev_code_r0, s, idx, op) {
  return Dynarray$set(s.code, idx, op);
}
function Compiler$current_offset(__ev_code_r0, s) {
  return Dynarray$length(s.code);
}
function Compiler$add_constant(__ev_constants_r0, s, v) {
  const len_10534 = Dynarray$length(s.constants);
  function find(i) {
    while (true) {
      let _t10536;
      if ((i >= len_10534)) {
        Dynarray$push(s.constants, v);
        _t10536 = len_10534;
      } else {
        let _t10537;
        if (_eq(Dynarray$get(s.constants, i), v)) {
          _t10537 = i;
        } else {
          const _t10538 = (i + 1);
          i = _t10538;
          continue;
          _t10537 = undefined;
        }
        _t10536 = _t10537;
      }
      return _t10536;
    }
  }
  const _t10539 = find(0);
  const _t10535 = _t10539;
  return _t10535;
}
function Compiler$emit_constant(__ev_code_r0, __ev_constants_r0, __ev_current_line_r0, __ev_lines_r0, s, v) {
  const idx_10540 = _call(Compiler$add_constant, [__ev_constants_r0, s, v]);
  const _t10541 = _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 0, _name: "CONST", _val: idx_10540})]);
  return _t10541;
}
function Compiler$allocate_local(__ev_locals_r0, __ev_max_locals_r0, __ev_num_locals_r0, __ev_scope_depth_r0, s, name) {
  const slot_10542 = s.num_locals;
  (s.locals = ({_hd: ({depth: s.scope_depth, name: name, slot: slot_10542}), _tl: s.locals}), undefined);
  (s.num_locals = (s.num_locals + 1), undefined);
  let _t10544;
  if ((s.num_locals > s.max_locals)) {
    _t10544 = (s.max_locals = s.num_locals, undefined);
  } else {
    _t10544 = undefined;
  }
  _t10544;
  const _t10543 = slot_10542;
  return _t10543;
}
function Compiler$free_local(s) {
  let _t10546;
  const _t10545 = s.locals;
  _t10547: {
    if (_t10545 === null) {
      _t10546 = Compiler$error("no locals to free");
      break _t10547;
    }
    if (_t10545 !== null) {
      const rest = _t10545._tl;
      (s.locals = rest, undefined);
      _t10546 = (s.num_locals = (s.num_locals - 1), undefined);
      break _t10547;
    }
    _match_fail("line 16933");
  }
  return _t10546;
}
function Compiler$find_local(s, name) {
  function search(__ev_name_r0, __ev_slot_r0, __x) {
    while (true) {
      let _t10549;
      const _t10548 = __x;
      _t10550: {
        if (_t10548 === null) {
          _t10549 = ({_tag: 0, _name: "None"});
          break _t10550;
        }
        if (_t10548 !== null) {
          const local = _t10548._hd;
          if ((local.name === name)) {
            _t10549 = ({_tag: 1, _name: "Some", _val: local.slot});
            break _t10550;
          }
        }
        if (_t10548 !== null) {
          const rest = _t10548._tl;
          const _t10551 = __ev_name_r0;
          const _t10552 = __ev_slot_r0;
          const _t10553 = rest;
          __ev_name_r0 = _t10551;
          __ev_slot_r0 = _t10552;
          __x = _t10553;
          continue;
          _t10549 = undefined;
          break _t10550;
        }
        _match_fail("line 16933");
      }
      return _t10549;
    }
  }
  const _t10554 = _call(search, [1, 2, s.locals]);
  return _t10554;
}
function Compiler$remove_first_occurrence(name, __x) {
  let _t10556;
  const _t10555 = __x;
  _t10557: {
    if (_t10555 === null) {
      _t10556 = null;
      break _t10557;
    }
    if (_t10555 !== null) {
      const x = _t10555._hd;
      const rest = _t10555._tl;
      if (_eq(x, name)) {
        _t10556 = rest;
        break _t10557;
      }
    }
    if (_t10555 !== null) {
      const x = _t10555._hd;
      const rest = _t10555._tl;
      _t10556 = ({_hd: x, _tl: Compiler$remove_first_occurrence(name, rest)});
      break _t10557;
    }
    _match_fail("line 16933");
  }
  return _t10556;
}
function Compiler$is_mutable_local(s, name) {
  while (true) {
    let _t10558;
    if (List$mem(name, s.mutable_locals)) {
      _t10558 = true;
    } else {
      let _t10560;
      const _t10559 = s.enclosing;
      _t10561: {
        if (_t10559._tag === 1) {
          const enc = _t10559._val;
          const _t10562 = enc;
          const _t10563 = name;
          s = _t10562;
          name = _t10563;
          continue;
          _t10560 = undefined;
          break _t10561;
        }
        if (_t10559._tag === 0) {
          _t10560 = false;
          break _t10561;
        }
        _match_fail("line 16933");
      }
      _t10558 = _t10560;
    }
    return _t10558;
  }
}
function Compiler$is_mutable_global(s, name) {
  return _call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
}
function Compiler$add_upvalue(__ev_upvalues_r0, s, capture, name) {
  function find(i, __x) {
    while (true) {
      let _t10565;
      const _t10564 = __x;
      _t10566: {
        if (_t10564 === null) {
          (s.upvalues = List$concat(s.upvalues, ({_hd: ({capture: capture, uv_name: name}), _tl: null})), undefined);
          _t10565 = (List$length(s.upvalues) - 1);
          break _t10566;
        }
        if (_t10564 !== null) {
          const uv = _t10564._hd;
          if (((uv.uv_name === name) && _eq(uv.capture, capture))) {
            _t10565 = i;
            break _t10566;
          }
        }
        if (_t10564 !== null) {
          const rest = _t10564._tl;
          const _t10567 = (i + 1);
          const _t10568 = rest;
          i = _t10567;
          __x = _t10568;
          continue;
          _t10565 = undefined;
          break _t10566;
        }
        _match_fail("line 16933");
      }
      return _t10565;
    }
  }
  const _t10569 = find(0, s.upvalues);
  return _t10569;
}
function Compiler$resolve_upvalue(s, name) {
  let _t10571;
  const _t10570 = s.enclosing;
  _t10572: {
    if (_t10570._tag === 0) {
      _t10571 = ({_tag: 0, _name: "None"});
      break _t10572;
    }
    if (_t10570._tag === 1) {
      const enc = _t10570._val;
      let _t10574;
      const _t10573 = Compiler$find_local(enc, name);
      _t10575: {
        if (_t10573._tag === 1) {
          const slot = _t10573._val;
          const idx_10576 = _call(Compiler$add_upvalue, [17, s, ({_tag: 0, _name: "CaptureLocal", _val: slot}), name]);
          const _t10577 = ({_tag: 1, _name: "Some", _val: idx_10576});
          _t10574 = _t10577;
          break _t10575;
        }
        if (_t10573._tag === 0) {
          let _t10579;
          const _t10578 = Compiler$resolve_upvalue(enc, name);
          _t10580: {
            if (_t10578._tag === 1) {
              const enc_uv_idx = _t10578._val;
              const idx_10581 = _call(Compiler$add_upvalue, [17, s, ({_tag: 1, _name: "CaptureUpvalue", _val: enc_uv_idx}), name]);
              const _t10582 = ({_tag: 1, _name: "Some", _val: idx_10581});
              _t10579 = _t10582;
              break _t10580;
            }
            if (_t10578._tag === 0) {
              _t10579 = ({_tag: 0, _name: "None"});
              break _t10580;
            }
            _match_fail("line 16933");
          }
          _t10574 = _t10579;
          break _t10575;
        }
        _match_fail("line 16933");
      }
      _t10571 = _t10574;
      break _t10572;
    }
    _match_fail("line 16933");
  }
  return _t10571;
}
function Compiler$find_global(__ev_global_names_r0, s, name) {
  const len_10583 = Dynarray$length(s.global_names);
  function find(i) {
    while (true) {
      let _t10585;
      if ((i >= len_10583)) {
        _t10585 = ({_tag: 0, _name: "None"});
      } else {
        let _t10586;
        if (_eq(Dynarray$get(s.global_names, i), name)) {
          _t10586 = ({_tag: 1, _name: "Some", _val: i});
        } else {
          const _t10587 = (i + 1);
          i = _t10587;
          continue;
          _t10586 = undefined;
        }
        _t10585 = _t10586;
      }
      return _t10585;
    }
  }
  const _t10588 = find(0);
  const _t10584 = _t10588;
  return _t10584;
}
function Compiler$find_or_add_global(__ev_global_names_r0, s, name) {
  let _t10590;
  const _t10589 = _call(Compiler$find_global, [__ev_global_names_r0, s, name]);
  _t10591: {
    if (_t10589._tag === 1) {
      const i = _t10589._val;
      _t10590 = i;
      break _t10591;
    }
    if (_t10589._tag === 0) {
      const len_10592 = Dynarray$length(s.global_names);
      Dynarray$push(s.global_names, name);
      const _t10593 = len_10592;
      _t10590 = _t10593;
      break _t10591;
    }
    _match_fail("line 16933");
  }
  return _t10590;
}
function Compiler$tag_for_constructor(type_env, name) {
  let _t10595;
  const _t10594 = List$assoc_opt(name, type_env.constructors);
  _t10596: {
    if (_t10594._tag === 0) {
      _t10595 = Compiler$error(("unknown constructor: " + __dict_Show_string.show(name)));
      break _t10596;
    }
    if (_t10594._tag === 1) {
      const info = _t10594._val;
      function _t10597(__p377) {
        let _t10599;
        const _t10598 = __p377;
        _t10600: {
          if (true) {
            const n = _t10598[0];
            _t10599 = (n === info.ctor_type_name);
            break _t10600;
          }
          _match_fail("line 16933");
        }
        return _t10599;
      }
      let _t10602;
      const _t10601 = list_find(_t10597, type_env.variants);
      _t10603: {
        if (true) {
          const variant_def = _t10601[2];
          let _t10605;
          const _t10604 = String$rindex_opt(name, 46);
          _t10606: {
            if (_t10604._tag === 1) {
              const i = _t10604._val;
              _t10605 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
              break _t10606;
            }
            if (_t10604._tag === 0) {
              _t10605 = name;
              break _t10606;
            }
            _match_fail("line 16933");
          }
          const short_name_10607 = _t10605;
          function find_tag(i, __x) {
            while (true) {
              let _t10610;
              const _t10609 = __x;
              _t10611: {
                if (_t10609 === null) {
                  _t10610 = Compiler$error((("constructor " + __dict_Show_string.show(name)) + " not found in type"));
                  break _t10611;
                }
                if (_t10609 !== null) {
                  const cname = _t10609._hd[0];
                  if ((cname === short_name_10607)) {
                    _t10610 = i;
                    break _t10611;
                  }
                }
                if (_t10609 !== null) {
                  const rest = _t10609._tl;
                  const _t10612 = (i + 1);
                  const _t10613 = rest;
                  i = _t10612;
                  __x = _t10613;
                  continue;
                  _t10610 = undefined;
                  break _t10611;
                }
                _match_fail("line 16933");
              }
              return _t10610;
            }
          }
          const _t10614 = find_tag(0, variant_def);
          const _t10608 = _t10614;
          _t10602 = _t10608;
          break _t10603;
        }
        _match_fail("line 16933");
      }
      _t10595 = _t10602;
      break _t10596;
    }
    _match_fail("line 16933");
  }
  return _t10595;
}
function Compiler$is_newtype_ctor(type_env, name) {
  let _t10616;
  const _t10615 = List$assoc_opt(name, type_env.constructors);
  _t10617: {
    if (_t10615._tag === 1) {
      const info = _t10615._val;
      _t10616 = List$mem(info.ctor_type_name, type_env.newtypes);
      break _t10617;
    }
    if (_t10615._tag === 0) {
      _t10616 = false;
      break _t10617;
    }
    _match_fail("line 16933");
  }
  return _t10616;
}
function Compiler$extract_class_ty_args(num_params, schema_ty, resolved_ty) {
  const found_10618 = Hashtbl$create(num_params);
  function go(schema_ty, resolved_ty) {
    while (true) {
      const resolved_ty_10620 = Types$repr(resolved_ty);
      let _t10623;
      const _t10622 = [schema_ty, resolved_ty_10620];
      _t10624: {
        if (_t10622[0]._tag === 16) {
          const i = _t10622[0]._val;
          const ty = _t10622[1];
          if ((i < num_params)) {
            let _t10625;
            if ((!_call(Hashtbl$has, [__dict_Hash_int, __dict_Eq_int, found_10618, i]))) {
              _t10625 = _call(Hashtbl$set, [__dict_Hash_int, __dict_Eq_int, found_10618, i, ty]);
            } else {
              _t10625 = undefined;
            }
            _t10623 = _t10625;
            break _t10624;
          }
        }
        if ((_t10622[0]._tag === 7 && _t10622[1]._tag === 7 || _t10622[0]._tag === 8 && _t10622[1]._tag === 8)) {
          const s_a = _t10622[0]._val[0];
          const s_r = _t10622[0]._val[2];
          const r_a = _t10622[1]._val[0];
          const r_r = _t10622[1]._val[2];
          go(s_a, r_a);
          const _t10626 = s_r;
          const _t10627 = r_r;
          schema_ty = _t10626;
          resolved_ty = _t10627;
          continue;
          _t10623 = undefined;
          break _t10624;
        }
        if (_t10622[0]._tag === 9 && _t10622[1]._tag === 9) {
          const ss = _t10622[0]._val;
          const rs = _t10622[1]._val;
          if ((List$length(ss) === List$length(rs))) {
            _t10623 = List$iter2(go, ss, rs);
            break _t10624;
          }
        }
        if (_t10622[0]._tag === 10 && _t10622[1]._tag === 10) {
          const s = _t10622[0]._val;
          const r = _t10622[1]._val;
          const _t10628 = s;
          const _t10629 = r;
          schema_ty = _t10628;
          resolved_ty = _t10629;
          continue;
          _t10623 = undefined;
          break _t10624;
        }
        if (true) {
          _t10623 = undefined;
          break _t10624;
        }
        _match_fail("line 16933");
      }
      const _t10621 = _t10623;
      return _t10621;
    }
  }
  go(schema_ty, resolved_ty);
  function _t10631(i) {
    return _call(Hashtbl$get, [__dict_Hash_int, __dict_Eq_int, found_10618, i]);
  }
  const _t10630 = List$init(num_params, _t10631);
  const _t10619 = _t10630;
  return _t10619;
}
function Compiler$emit_builtin_call1(__ev_code_r0, __ev_current_line_r0, __ev_global_names_r0, __ev_lines_r0, s, name) {
  const gidx_10632 = _call(Compiler$find_or_add_global, [__ev_global_names_r0, s, name]);
  _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10632})]);
  const _t10633 = _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 42, _name: "CALL", _val: 1})]);
  return _t10633;
}
function Compiler$emit_builtin_call2(__ev_code_r0, __ev_current_line_r0, __ev_global_names_r0, __ev_lines_r0, s, name) {
  const gidx_10634 = _call(Compiler$find_or_add_global, [__ev_global_names_r0, s, name]);
  const _t10635 = _call(Compiler$emit, [__ev_code_r0, __ev_current_line_r0, __ev_lines_r0, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10634})]);
  return _t10635;
}
function Compiler$compile_expr(tail, s, te) {
  let _t10636;
  if ((te.loc.line > 0)) {
    _t10636 = (s.current_line = te.loc.line, undefined);
  } else {
    _t10636 = undefined;
  }
  _t10636;
  let _t10638;
  const _t10637 = te.expr;
  _t10639: {
    if (_t10637._tag === 0) {
      const n = _t10637._val;
      _t10638 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: n})]);
      break _t10639;
    }
    if (_t10637._tag === 1) {
      const f = _t10637._val;
      _t10638 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 1, _name: "VFloat", _val: f})]);
      break _t10639;
    }
    if (_t10637._tag === 2) {
      const b = _t10637._val;
      _t10638 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 2, _name: "VBool", _val: b})]);
      break _t10639;
    }
    if (_t10637._tag === 3) {
      const str = _t10637._val;
      _t10638 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: str})]);
      break _t10639;
    }
    if (_t10637._tag === 4) {
      const n = _t10637._val;
      _t10638 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 4, _name: "VByte", _val: n})]);
      break _t10639;
    }
    if (_t10637._tag === 5) {
      const n = _t10637._val;
      _t10638 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 5, _name: "VRune", _val: n})]);
      break _t10639;
    }
    if (_t10637._tag === 6) {
      _t10638 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
      break _t10639;
    }
    if (_t10637._tag === 22) {
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 57, _name: "NIL"})]);
      break _t10639;
    }
    if (_t10637._tag === 7) {
      const name = _t10637._val;
      let _t10640;
      if ((_eq(Compiler$find_local(s, name), ({_tag: 0, _name: "None"})) && (_eq(Compiler$resolve_upvalue(s, name), ({_tag: 0, _name: "None"})) && _eq(_call(Compiler$find_global, [5, s, name]), ({_tag: 0, _name: "None"}))))) {
        let _t10642;
        const _t10641 = Types$find_method_class(s.type_env.classes, name);
        _t10643: {
          if (_t10641._tag === 1) {
            const result = _t10641;
            _t10642 = [result, name];
            break _t10643;
          }
          if (_t10641._tag === 0) {
            let _t10645;
            const _t10644 = String$rindex_opt(name, 46);
            _t10646: {
              if (_t10644._tag === 0) {
                _t10645 = [({_tag: 0, _name: "None"}), name];
                break _t10646;
              }
              if (_t10644._tag === 1) {
                const i = _t10644._val;
                const mod_prefix_10647 = String$sub(name, 0, (i + 1));
                const _mml$short_10649 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                const class_prefix_10651 = String$sub(name, 0, i);
                let _t10654;
                const _t10653 = Types$find_method_class(s.type_env.classes, _mml$short_10649);
                _t10655: {
                  if (_t10653._tag === 1) {
                    const class_def = _t10653._val;
                    if ((class_def.class_name === class_prefix_10651)) {
                      _t10654 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_10649];
                      break _t10655;
                    }
                  }
                  if (_t10653._tag === 1) {
                    const class_def = _t10653._val;
                    if (((String$length(class_def.class_name) > String$length(mod_prefix_10647)) && (String$sub(class_def.class_name, 0, String$length(mod_prefix_10647)) === mod_prefix_10647))) {
                      _t10654 = [({_tag: 1, _name: "Some", _val: class_def}), _mml$short_10649];
                      break _t10655;
                    }
                  }
                  if (true) {
                    _t10654 = [({_tag: 0, _name: "None"}), name];
                    break _t10655;
                  }
                  _match_fail("line 16933");
                }
                const _t10652 = _t10654;
                const _t10650 = _t10652;
                const _t10648 = _t10650;
                _t10645 = _t10648;
                break _t10646;
              }
              _match_fail("line 16933");
            }
            _t10642 = _t10645;
            break _t10643;
          }
          _match_fail("line 16933");
        }
        let _t10657;
        const _t10656 = _t10642;
        _t10658: {
          if (true) {
            const class_opt = _t10656[0];
            const method_name = _t10656[1];
            let _t10660;
            const _t10659 = class_opt;
            _t10661: {
              if (_t10659._tag === 1) {
                const class_def = _t10659._val;
                const method_schema_ty_10662 = List$assoc(method_name, class_def.class_methods);
                const num_params_10664 = List$length(class_def.class_params);
                const partial_10666 = Compiler$extract_class_ty_args(num_params_10664, method_schema_ty_10662, te.ty);
                function _t10668(opt) {
                  let _t10670;
                  const _t10669 = opt;
                  _t10671: {
                    if (_t10669._tag === 1) {
                      const ty = _t10669._val;
                      let _t10673;
                      const _t10672 = Types$repr(ty);
                      _t10674: {
                        if (_t10672._tag === 15 && _t10672._val.contents._tag === 0) {
                          _t10673 = ({_tag: 0, _name: "None"});
                          break _t10674;
                        }
                        if (true) {
                          _t10673 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
                          break _t10674;
                        }
                        _match_fail("line 16933");
                      }
                      _t10670 = _t10673;
                      break _t10671;
                    }
                    if (_t10669._tag === 0) {
                      _t10670 = ({_tag: 0, _name: "None"});
                      break _t10671;
                    }
                    _match_fail("line 16933");
                  }
                  return _t10670;
                }
                const concrete_partial_10675 = List$map(_t10668, partial_10666);
                let _t10677;
                if (!_eq(class_def.class_fundeps, null)) {
                  _t10677 = Types$improve_with_fundeps(s.type_env.instances, class_def, concrete_partial_10675);
                } else {
                  _t10677 = concrete_partial_10675;
                }
                const concrete_partial_10678 = _t10677;
                function _t10680(inst) {
                  return ((inst.inst_class === class_def.class_name) && ((List$length(inst.inst_tys) === num_params_10664) && Types$match_partial_inst(inst.inst_tys, concrete_partial_10678)));
                }
                const matching_10681 = List$filter(_t10680, s.type_env.instances);
                let _t10684;
                const _t10683 = matching_10681;
                _t10685: {
                  if (_t10683 !== null && _t10683._tl === null) {
                    const inst = _t10683._hd;
                    let _t10686;
                    if (_eq(inst.inst_constraints, null)) {
                      const method_gidx_10687 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
                      const _t10688 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10687})]);
                      _t10686 = _t10688;
                    } else {
                      const dict_gidx_10689 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
                      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10689})]);
                      const _t10690 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
                      _t10686 = _t10690;
                    }
                    _t10684 = _t10686;
                    break _t10685;
                  }
                  if (_t10683 === null) {
                    function _t10691(__x) {
                      let _t10693;
                      const _t10692 = __x;
                      _t10694: {
                        if (_t10692._tag === 1) {
                          const ty = _t10692._val;
                          let _t10696;
                          const _t10695 = Types$repr(ty);
                          _t10697: {
                            if ((_t10695._tag === 14 || _t10695._tag === 11)) {
                              _t10696 = true;
                              break _t10697;
                            }
                            if (true) {
                              _t10696 = false;
                              break _t10697;
                            }
                            _match_fail("line 16933");
                          }
                          _t10693 = _t10696;
                          break _t10694;
                        }
                        if (_t10692._tag === 0) {
                          _t10693 = false;
                          break _t10694;
                        }
                        _match_fail("line 16933");
                      }
                      return _t10693;
                    }
                    const is_structural_10698 = List$exists(_t10691, partial_10666);
                    let _t10700;
                    if ((is_structural_10698 && ((class_def.class_name === "Show") && (method_name === "show")))) {
                      const gidx_10701 = _call(Compiler$find_or_add_global, [5, s, "__show_value"]);
                      const _t10702 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10701})]);
                      _t10700 = _t10702;
                    } else {
                      function _t10703(__x) {
                        let _t10705;
                        const _t10704 = __x;
                        _t10706: {
                          if (_t10704._tag === 1) {
                            const ty = _t10704._val;
                            _t10705 = Types$pp_ty(ty);
                            break _t10706;
                          }
                          if (_t10704._tag === 0) {
                            _t10705 = "_";
                            break _t10706;
                          }
                          _match_fail("line 16933");
                        }
                        return _t10705;
                      }
                      const ty_strs_10707 = List$map(_t10703, partial_10666);
                      const _t10708 = Compiler$error(((("no instance of " + __dict_Show_string.show(class_def.class_name)) + " for types ") + __dict_Show_string.show(String$concat(", ", ty_strs_10707))));
                      _t10700 = _t10708;
                    }
                    const _t10699 = _t10700;
                    _t10684 = _t10699;
                    break _t10685;
                  }
                  if (true) {
                    let _t10710;
                    const _t10709 = Types$most_specific_inst(matching_10681);
                    _t10711: {
                      if (_t10709._tag === 1) {
                        const inst = _t10709._val;
                        let _t10712;
                        if (_eq(inst.inst_constraints, null)) {
                          const method_gidx_10713 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
                          const _t10714 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10713})]);
                          _t10712 = _t10714;
                        } else {
                          const dict_gidx_10715 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
                          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10715})]);
                          const _t10716 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
                          _t10712 = _t10716;
                        }
                        _t10710 = _t10712;
                        break _t10711;
                      }
                      if (_t10709._tag === 0) {
                        _t10710 = Compiler$error(((("ambiguous instance for " + __dict_Show_string.show(class_def.class_name)) + " method ") + __dict_Show_string.show(method_name)));
                        break _t10711;
                      }
                      _match_fail("line 16933");
                    }
                    _t10684 = _t10710;
                    break _t10685;
                  }
                  _match_fail("line 16933");
                }
                const _t10682 = _t10684;
                const _t10679 = _t10682;
                const _t10676 = _t10679;
                const _t10667 = _t10676;
                const _t10665 = _t10667;
                const _t10663 = _t10665;
                _t10660 = _t10663;
                break _t10661;
              }
              if (_t10659._tag === 0) {
                _t10660 = Compiler$compile_var_access(s, name);
                break _t10661;
              }
              _match_fail("line 16933");
            }
            _t10657 = _t10660;
            break _t10658;
          }
          _match_fail("line 16933");
        }
        _t10640 = _t10657;
      } else {
        _t10640 = Compiler$compile_var_access(s, name);
      }
      _t10638 = _t10640;
      break _t10639;
    }
    if (_t10637._tag === 13) {
      const op = _t10637._val[0];
      const e1 = _t10637._val[1];
      const e2 = _t10637._val[2];
      _t10638 = Compiler$compile_binop(s, op, e1, e2);
      break _t10639;
    }
    if (_t10637._tag === 14) {
      const op = _t10637._val[0];
      const e = _t10637._val[1];
      _t10638 = Compiler$compile_unop(s, op, e);
      break _t10639;
    }
    if (_t10637._tag === 11) {
      const fn_ = _t10637._val[0];
      const arg = _t10637._val[1];
      function collect_args(expr, acc) {
        while (true) {
          let _t10718;
          const _t10717 = expr.expr;
          _t10719: {
            if (_t10717._tag === 11) {
              const inner_fn = _t10717._val[0];
              const inner_arg = _t10717._val[1];
              const _t10720 = inner_fn;
              const _t10721 = ({_hd: inner_arg, _tl: acc});
              expr = _t10720;
              acc = _t10721;
              continue;
              _t10718 = undefined;
              break _t10719;
            }
            if (true) {
              _t10718 = [expr, acc];
              break _t10719;
            }
            _match_fail("line 16933");
          }
          return _t10718;
        }
      }
      let _t10724;
      const _t10723 = collect_args(fn_, ({_hd: arg, _tl: null}));
      _t10725: {
        if (true) {
          const base_fn = _t10723[0];
          const all_args = _t10723[1];
          const n_10726 = List$length(all_args);
          Compiler$compile_expr(false, s, base_fn);
          function _t10728(a) {
            return Compiler$compile_expr(false, s, a);
          }
          List$iter(_t10728, all_args);
          let _t10729;
          if ((n_10726 > 1)) {
            let _t10730;
            if (tail) {
              _t10730 = ({_tag: 83, _name: "TAIL_CALL_N", _val: n_10726});
            } else {
              _t10730 = ({_tag: 82, _name: "CALL_N", _val: n_10726});
            }
            _t10729 = _call(Compiler$emit, [1, 3, 6, s, _t10730]);
          } else {
            let _t10731;
            if (tail) {
              _t10731 = ({_tag: 43, _name: "TAIL_CALL", _val: 1});
            } else {
              _t10731 = ({_tag: 42, _name: "CALL", _val: 1});
            }
            _t10729 = _call(Compiler$emit, [1, 3, 6, s, _t10731]);
          }
          const _t10727 = _t10729;
          _t10724 = _t10727;
          break _t10725;
        }
        _match_fail("line 16933");
      }
      const _t10722 = _t10724;
      _t10638 = _t10722;
      break _t10639;
    }
    if (_t10637._tag === 10) {
      const param = _t10637._val[0];
      const body = _t10637._val[1];
      const has_return = _t10637._val[2];
      _t10638 = Compiler$compile_function(has_return, s, param, body, te.ty);
      break _t10639;
    }
    if (_t10637._tag === 8) {
      const name = _t10637._val[0];
      const _scheme = _t10637._val[1];
      const e1 = _t10637._val[2];
      const e2 = _t10637._val[3];
      Compiler$compile_expr(false, s, e1);
      const was_mutable_10732 = List$mem(name, s.mutable_locals);
      let _t10734;
      if (was_mutable_10732) {
        function _t10735(n) {
          return (n !== name);
        }
        _t10734 = (s.mutable_locals = List$filter(_t10735, s.mutable_locals), undefined);
      } else {
        _t10734 = undefined;
      }
      _t10734;
      const slot_10736 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10736})]);
      Compiler$compile_expr(tail, s, e2);
      let _t10738;
      if (was_mutable_10732) {
        _t10738 = (s.mutable_locals = ({_hd: name, _tl: s.mutable_locals}), undefined);
      } else {
        _t10738 = undefined;
      }
      _t10738;
      const _t10737 = Compiler$free_local(s);
      const _t10733 = _t10737;
      _t10638 = _t10733;
      break _t10639;
    }
    if (_t10637._tag === 25) {
      const name = _t10637._val[0];
      const e1 = _t10637._val[1];
      const e2 = _t10637._val[2];
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 7, _name: "MAKE_REF"})]);
      const slot_10739 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
      (s.mutable_locals = ({_hd: name, _tl: s.mutable_locals}), undefined);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10739})]);
      Compiler$compile_expr(tail, s, e2);
      (s.mutable_locals = Compiler$remove_first_occurrence(name, s.mutable_locals), undefined);
      const _t10740 = Compiler$free_local(s);
      _t10638 = _t10740;
      break _t10639;
    }
    if (_t10637._tag === 32) {
      const cond = _t10637._val[0];
      const body = _t10637._val[1];
      const enter_idx_10741 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 68, _name: "ENTER_LOOP", _val: 0})]);
      const prev_loop_start_10743 = s.loop_start;
      const loop_start_10745 = _call(Compiler$current_offset, [1, s]);
      (s.loop_start = ({_tag: 1, _name: "Some", _val: loop_start_10745}), undefined);
      Compiler$compile_expr(false, s, cond);
      const exit_jump_10747 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]);
      Compiler$compile_expr(false, s, body);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: loop_start_10745})]);
      const exit_normal_10749 = _call(Compiler$current_offset, [1, s]);
      _call(Compiler$patch, [1, s, exit_jump_10747, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: exit_normal_10749})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 69, _name: "EXIT_LOOP"})]);
      const unit_idx_10751 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10751})]);
      const end_jump_10753 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
      const break_target_10755 = _call(Compiler$current_offset, [1, s]);
      const end_target_10757 = _call(Compiler$current_offset, [1, s]);
      _call(Compiler$patch, [1, s, enter_idx_10741, ({_tag: 68, _name: "ENTER_LOOP", _val: break_target_10755})]);
      _call(Compiler$patch, [1, s, end_jump_10753, ({_tag: 37, _name: "JUMP", _val: end_target_10757})]);
      const _t10758 = (s.loop_start = prev_loop_start_10743, undefined);
      const _t10756 = _t10758;
      const _t10754 = _t10756;
      const _t10752 = _t10754;
      const _t10750 = _t10752;
      const _t10748 = _t10750;
      const _t10746 = _t10748;
      const _t10744 = _t10746;
      const _t10742 = _t10744;
      _t10638 = _t10742;
      break _t10639;
    }
    if (_t10637._tag === 26) {
      const name = _t10637._val[0];
      const e = _t10637._val[1];
      let _t10760;
      const _t10759 = Compiler$find_local(s, name);
      _t10761: {
        if (_t10759._tag === 1) {
          const slot = _t10759._val;
          Compiler$compile_expr(false, s, e);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
          _t10760 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
          break _t10761;
        }
        if (_t10759._tag === 0) {
          let _t10763;
          const _t10762 = Compiler$resolve_upvalue(s, name);
          _t10764: {
            if (_t10762._tag === 1) {
              const idx = _t10762._val;
              Compiler$compile_expr(false, s, e);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 5, _name: "GET_UPVALUE", _val: idx})]);
              _t10763 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
              break _t10764;
            }
            if (_t10762._tag === 0) {
              Compiler$compile_expr(false, s, e);
              const gidx_10765 = _call(Compiler$find_or_add_global, [5, s, name]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10765})]);
              const _t10766 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
              _t10763 = _t10766;
              break _t10764;
            }
            _match_fail("line 16933");
          }
          _t10760 = _t10763;
          break _t10761;
        }
        _match_fail("line 16933");
      }
      _t10760;
      _t10638 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
      break _t10639;
    }
    if (_t10637._tag === 27) {
      const record_e = _t10637._val[0];
      const field = _t10637._val[1];
      const value_e = _t10637._val[2];
      Compiler$compile_expr(false, s, record_e);
      Compiler$compile_expr(false, s, value_e);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 52, _name: "SET_FIELD", _val: field})]);
      _t10638 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
      break _t10639;
    }
    if (_t10637._tag === 9) {
      const name = _t10637._val[0];
      const _scheme = _t10637._val[1];
      const e1 = _t10637._val[2];
      const e2 = _t10637._val[3];
      Compiler$compile_let_rec(s, name, e1);
      Compiler$compile_expr(tail, s, e2);
      _t10638 = Compiler$free_local(s);
      break _t10639;
    }
    if (_t10637._tag === 12) {
      const cond = _t10637._val[0];
      const then_e = _t10637._val[1];
      const else_e = _t10637._val[2];
      _t10638 = Compiler$compile_if(tail, s, cond, then_e, else_e);
      break _t10639;
    }
    if (_t10637._tag === 15) {
      const exprs = _t10637._val;
      List$iter(_call(Compiler$compile_expr, [false, s]), exprs);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 48, _name: "MAKE_TUPLE", _val: List$length(exprs)})]);
      break _t10639;
    }
    if (_t10637._tag === 16) {
      const fields = _t10637._val;
      function _t10767(__p378, __p379) {
        let _t10769;
        const _t10768 = __p378;
        _t10770: {
          if (true) {
            const a = _t10768[0];
            let _t10772;
            const _t10771 = __p379;
            _t10773: {
              if (true) {
                const b = _t10771[0];
                _t10772 = String$compare(a, b);
                break _t10773;
              }
              _match_fail("line 16933");
            }
            _t10769 = _t10772;
            break _t10770;
          }
          _match_fail("line 16933");
        }
        return _t10769;
      }
      const sorted_10774 = List$sort(_t10767, fields);
      const names_10776 = List$map(fst, sorted_10774);
      function _t10778(__p380) {
        let _t10780;
        const _t10779 = __p380;
        _t10781: {
          if (true) {
            const e = _t10779[1];
            _t10780 = Compiler$compile_expr(false, s, e);
            break _t10781;
          }
          _match_fail("line 16933");
        }
        return _t10780;
      }
      List$iter(_t10778, sorted_10774);
      const _t10777 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 50, _name: "MAKE_RECORD", _val: names_10776})]);
      const _t10775 = _t10777;
      _t10638 = _t10775;
      break _t10639;
    }
    if (_t10637._tag === 17) {
      const base = _t10637._val[0];
      const overrides = _t10637._val[1];
      Compiler$compile_expr(false, s, base);
      function _t10782(__p381) {
        let _t10784;
        const _t10783 = __p381;
        _t10785: {
          if (true) {
            const e = _t10783[1];
            _t10784 = Compiler$compile_expr(false, s, e);
            break _t10785;
          }
          _match_fail("line 16933");
        }
        return _t10784;
      }
      List$iter(_t10782, overrides);
      const field_names_10786 = List$map(fst, overrides);
      const _t10787 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 53, _name: "RECORD_UPDATE", _val: field_names_10786})]);
      _t10638 = _t10787;
      break _t10639;
    }
    if (_t10637._tag === 18) {
      const base = _t10637._val[0];
      const pairs = _t10637._val[1];
      Compiler$compile_expr(false, s, base);
      function _t10788(__p382) {
        let _t10790;
        const _t10789 = __p382;
        _t10791: {
          if (true) {
            const idx_e = _t10789[0];
            const val_e = _t10789[1];
            Compiler$compile_expr(false, s, idx_e);
            _t10790 = Compiler$compile_expr(false, s, val_e);
            break _t10791;
          }
          _match_fail("line 16933");
        }
        return _t10790;
      }
      List$iter(_t10788, pairs);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 54, _name: "RECORD_UPDATE_DYN", _val: List$length(pairs)})]);
      break _t10639;
    }
    if (_t10637._tag === 19) {
      const e = _t10637._val[0];
      const field = _t10637._val[1];
      Compiler$compile_expr(false, s, e);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: field})]);
      break _t10639;
    }
    if (_t10637._tag === 20) {
      const base = _t10637._val[0];
      const idx = _t10637._val[1];
      Compiler$compile_expr(false, s, base);
      Compiler$compile_expr(false, s, idx);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 74, _name: "INDEX"})]);
      break _t10639;
    }
    if (_t10637._tag === 21) {
      const hd = _t10637._val[0];
      const tl = _t10637._val[1];
      Compiler$compile_expr(false, s, hd);
      Compiler$compile_expr(false, s, tl);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 56, _name: "CONS"})]);
      break _t10639;
    }
    if (_t10637._tag === 23) {
      const name = _t10637._val[0];
      const arg = _t10637._val[1];
      let _t10792;
      if (Compiler$is_newtype_ctor(s.type_env, name)) {
        let _t10794;
        const _t10793 = arg;
        _t10795: {
          if (_t10793._tag === 1) {
            const e = _t10793._val;
            _t10794 = Compiler$compile_expr(tail, s, e);
            break _t10795;
          }
          if (_t10793._tag === 0) {
            _t10794 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 6, _name: "VUnit"})]);
            break _t10795;
          }
          _match_fail("line 16933");
        }
        _t10792 = _t10794;
      } else {
        let _t10796;
        if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
          _t10796 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
        } else {
          _t10796 = Compiler$tag_for_constructor(s.type_env, name);
        }
        const tag_10797 = _t10796;
        let _t10800;
        const _t10799 = String$rindex_opt(name, 46);
        _t10801: {
          if (_t10799._tag === 1) {
            const i = _t10799._val;
            _t10800 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
            break _t10801;
          }
          if (_t10799._tag === 0) {
            _t10800 = name;
            break _t10801;
          }
          _match_fail("line 16933");
        }
        const short_name_10802 = _t10800;
        let _t10805;
        const _t10804 = arg;
        _t10806: {
          if (_t10804._tag === 1) {
            const e = _t10804._val;
            Compiler$compile_expr(false, s, e);
            _t10805 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_10797, short_name_10802, true]})]);
            break _t10806;
          }
          if (_t10804._tag === 0) {
            _t10805 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_10797, short_name_10802, false]})]);
            break _t10806;
          }
          _match_fail("line 16933");
        }
        const _t10803 = _t10805;
        const _t10798 = _t10803;
        _t10792 = _t10798;
      }
      _t10638 = _t10792;
      break _t10639;
    }
    if (_t10637._tag === 24) {
      const scrut = _t10637._val[0];
      const arms = _t10637._val[1];
      const _partial = _t10637._val[2];
      _t10638 = Compiler$compile_match(tail, s, scrut, arms);
      break _t10639;
    }
    if (_t10637._tag === 28) {
      const e1 = _t10637._val[0];
      const e2 = _t10637._val[1];
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      _t10638 = Compiler$compile_expr(tail, s, e2);
      break _t10639;
    }
    if (_t10637._tag === 29) {
      const op_name = _t10637._val[0];
      const arg_te = _t10637._val[1];
      Compiler$compile_expr(false, s, arg_te);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 65, _name: "PERFORM", _val: op_name})]);
      break _t10639;
    }
    if (_t10637._tag === 30) {
      const body_te = _t10637._val[0];
      const arms = _t10637._val[1];
      _t10638 = Compiler$compile_handle(s, body_te, arms);
      break _t10639;
    }
    if (_t10637._tag === 31) {
      const k_te = _t10637._val[0];
      const v_te = _t10637._val[1];
      Compiler$compile_expr(false, s, k_te);
      Compiler$compile_expr(false, s, v_te);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 67, _name: "RESUME"})]);
      break _t10639;
    }
    if (_t10637._tag === 33) {
      const value_te = _t10637._val;
      Compiler$compile_expr(false, s, value_te);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 70, _name: "LOOP_BREAK"})]);
      break _t10639;
    }
    if (_t10637._tag === 34) {
      let _t10808;
      const _t10807 = s.loop_start;
      _t10809: {
        if (_t10807._tag === 1) {
          const target = _t10807._val;
          _t10808 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 71, _name: "LOOP_CONTINUE", _val: target})]);
          break _t10809;
        }
        if (_t10807._tag === 0) {
          _t10808 = Compiler$error("continue outside of loop");
          break _t10809;
        }
        _match_fail("line 16933");
      }
      _t10638 = _t10808;
      break _t10639;
    }
    if (_t10637._tag === 35) {
      const value_te = _t10637._val;
      const depth_before_10810 = s.operand_depth;
      Compiler$compile_expr(false, s, value_te);
      const n_pops_10812 = depth_before_10810;
      const _t10813 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 72, _name: "FOLD_CONTINUE", _val: n_pops_10812})]);
      const _t10811 = _t10813;
      _t10638 = _t10811;
      break _t10639;
    }
    if (_t10637._tag === 36) {
      const fold_te = _t10637._val;
      const enter_idx_10814 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 68, _name: "ENTER_LOOP", _val: 0})]);
      const prev_loop_start_10816 = s.loop_start;
      (s.loop_start = ({_tag: 0, _name: "None"}), undefined);
      Compiler$compile_expr(false, s, fold_te);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 69, _name: "EXIT_LOOP"})]);
      const end_jump_10818 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
      const break_target_10820 = _call(Compiler$current_offset, [1, s]);
      const end_target_10822 = _call(Compiler$current_offset, [1, s]);
      _call(Compiler$patch, [1, s, enter_idx_10814, ({_tag: 68, _name: "ENTER_LOOP", _val: break_target_10820})]);
      _call(Compiler$patch, [1, s, end_jump_10818, ({_tag: 37, _name: "JUMP", _val: end_target_10822})]);
      const _t10823 = (s.loop_start = prev_loop_start_10816, undefined);
      const _t10821 = _t10823;
      const _t10819 = _t10821;
      const _t10817 = _t10819;
      const _t10815 = _t10817;
      _t10638 = _t10815;
      break _t10639;
    }
    if (_t10637._tag === 38) {
      const elems = _t10637._val;
      List$iter(_call(Compiler$compile_expr, [false, s]), elems);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 73, _name: "MAKE_ARRAY", _val: List$length(elems)})]);
      break _t10639;
    }
    if (_t10637._tag === 39) {
      const value_te = _t10637._val;
      Compiler$compile_expr(false, s, value_te);
      _t10638 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 45, _name: "FUNC_RETURN"})]);
      break _t10639;
    }
    if (_t10637._tag === 37) {
      const bindings = _t10637._val[0];
      const body = _t10637._val[1];
      function _t10824(__p383) {
        let _t10826;
        const _t10825 = __p383;
        _t10827: {
          if (true) {
            const name = _t10825[0];
            const te = _t10825[1];
            let _t10829;
            const _t10828 = te.expr;
            _t10830: {
              if (_t10828._tag === 10) {
                _t10829 = true;
                break _t10830;
              }
              if (true) {
                _t10829 = false;
                break _t10830;
              }
              _match_fail("line 16933");
            }
            const is_fun_10831 = _t10829;
            const slot_10833 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
            let _t10835;
            if (is_fun_10831) {
              const unit_idx_10836 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_10836})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 7, _name: "MAKE_REF"})]);
              (s.mutable_locals = ({_hd: name, _tl: s.mutable_locals}), undefined);
              const _t10837 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10833})]);
              _t10835 = _t10837;
            } else {
              Compiler$emit_rec_placeholder(s, te);
              _t10835 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_10833})]);
            }
            _t10835;
            const _t10834 = [name, te, slot_10833, is_fun_10831];
            const _t10832 = _t10834;
            _t10826 = _t10832;
            break _t10827;
          }
          _match_fail("line 16933");
        }
        return _t10826;
      }
      const binding_info_10838 = List$map(_t10824, bindings);
      function _t10840(__p384) {
        let _t10842;
        const _t10841 = __p384;
        _t10843: {
          if (true) {
            const te = _t10841[1];
            const slot = _t10841[2];
            const is_fun = _t10841[3];
            Compiler$compile_expr(false, s, te);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
            let _t10844;
            if (is_fun) {
              _t10844 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 9, _name: "SET_REF"})]);
            } else {
              _t10844 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 84, _name: "UPDATE_REC"})]);
            }
            _t10842 = _t10844;
            break _t10843;
          }
          _match_fail("line 16933");
        }
        return _t10842;
      }
      List$iter(_t10840, binding_info_10838);
      Compiler$compile_expr(tail, s, body);
      function _t10845(__p385) {
        let _t10847;
        const _t10846 = __p385;
        _t10848: {
          if (true) {
            const name = _t10846[0];
            const is_fun = _t10846[3];
            let _t10849;
            if (is_fun) {
              function _t10850(n) {
                return (n !== name);
              }
              _t10849 = (s.mutable_locals = List$filter(_t10850, s.mutable_locals), undefined);
            } else {
              _t10849 = undefined;
            }
            _t10847 = _t10849;
            break _t10848;
          }
          _match_fail("line 16933");
        }
        return _t10847;
      }
      List$iter(_t10845, binding_info_10838);
      function _t10851(_) {
        return Compiler$free_local(s);
      }
      const _t10839 = List$iter(_t10851, bindings);
      _t10638 = _t10839;
      break _t10639;
    }
    _match_fail("line 16933");
  }
  return _t10638;
}
function Compiler$compile_var_access(s, name) {
  let _t10853;
  const _t10852 = Compiler$find_local(s, name);
  _t10854: {
    if (_t10852._tag === 1) {
      const slot = _t10852._val;
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
      let _t10855;
      if (Compiler$is_mutable_local(s, name)) {
        _t10855 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 8, _name: "DEREF"})]);
      } else {
        _t10855 = undefined;
      }
      _t10853 = _t10855;
      break _t10854;
    }
    if (_t10852._tag === 0) {
      let _t10857;
      const _t10856 = Compiler$resolve_upvalue(s, name);
      _t10858: {
        if (_t10856._tag === 1) {
          const idx = _t10856._val;
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 5, _name: "GET_UPVALUE", _val: idx})]);
          let _t10859;
          if (Compiler$is_mutable_local(s, name)) {
            _t10859 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 8, _name: "DEREF"})]);
          } else {
            _t10859 = undefined;
          }
          _t10857 = _t10859;
          break _t10858;
        }
        if (_t10856._tag === 0) {
          const gidx_10860 = _call(Compiler$find_or_add_global, [5, s, name]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10860})]);
          let _t10862;
          if (Compiler$is_mutable_global(s, name)) {
            _t10862 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 8, _name: "DEREF"})]);
          } else {
            _t10862 = undefined;
          }
          const _t10861 = _t10862;
          _t10857 = _t10861;
          break _t10858;
        }
        _match_fail("line 16933");
      }
      _t10853 = _t10857;
      break _t10854;
    }
    _match_fail("line 16933");
  }
  return _t10853;
}
function Compiler$compile_binop(s, op, e1, e2) {
  let _t10864;
  const _t10863 = op;
  _t10865: {
    if (_t10863._tag === 11) {
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 2, _name: "DUP"})]);
      const jump_idx_10866 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      Compiler$compile_expr(false, s, e2);
      const target_10868 = _call(Compiler$current_offset, [1, s]);
      const _t10869 = _call(Compiler$patch, [1, s, jump_idx_10866, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: target_10868})]);
      const _t10867 = _t10869;
      _t10864 = _t10867;
      break _t10865;
    }
    if (_t10863._tag === 12) {
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 2, _name: "DUP"})]);
      const jump_idx_10870 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 39, _name: "JUMP_IF_TRUE", _val: 0})]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      Compiler$compile_expr(false, s, e2);
      const target_10872 = _call(Compiler$current_offset, [1, s]);
      const _t10873 = _call(Compiler$patch, [1, s, jump_idx_10870, ({_tag: 39, _name: "JUMP_IF_TRUE", _val: target_10872})]);
      const _t10871 = _t10873;
      _t10864 = _t10871;
      break _t10865;
    }
    if ((((_t10863._tag === 0 || _t10863._tag === 1) || _t10863._tag === 2) || _t10863._tag === 3)) {
      const resolved_10874 = Types$repr(e1.ty);
      let _t10877;
      const _t10876 = resolved_10874;
      _t10878: {
        if (_t10876._tag === 0) {
          Compiler$compile_expr(false, s, e1);
          Compiler$compile_expr(false, s, e2);
          let _t10880;
          const _t10879 = op;
          _t10881: {
            if (_t10879._tag === 0) {
              _t10880 = ({_tag: 13, _name: "ADD"});
              break _t10881;
            }
            if (_t10879._tag === 1) {
              _t10880 = ({_tag: 14, _name: "SUB"});
              break _t10881;
            }
            if (_t10879._tag === 2) {
              _t10880 = ({_tag: 15, _name: "MUL"});
              break _t10881;
            }
            if (_t10879._tag === 3) {
              _t10880 = ({_tag: 16, _name: "DIV"});
              break _t10881;
            }
            if (true) {
              _t10880 = failwith("assert false");
              break _t10881;
            }
            _match_fail("line 16933");
          }
          _t10877 = _call(Compiler$emit, [1, 3, 6, s, _t10880]);
          break _t10878;
        }
        if (_t10876._tag === 1) {
          Compiler$compile_expr(false, s, e1);
          Compiler$compile_expr(false, s, e2);
          let _t10883;
          const _t10882 = op;
          _t10884: {
            if (_t10882._tag === 0) {
              _t10883 = ({_tag: 19, _name: "FADD"});
              break _t10884;
            }
            if (_t10882._tag === 1) {
              _t10883 = ({_tag: 20, _name: "FSUB"});
              break _t10884;
            }
            if (_t10882._tag === 2) {
              _t10883 = ({_tag: 21, _name: "FMUL"});
              break _t10884;
            }
            if (_t10882._tag === 3) {
              _t10883 = ({_tag: 22, _name: "FDIV"});
              break _t10884;
            }
            if (true) {
              _t10883 = failwith("assert false");
              break _t10884;
            }
            _match_fail("line 16933");
          }
          _t10877 = _call(Compiler$emit, [1, 3, 6, s, _t10883]);
          break _t10878;
        }
        if (true) {
          let _t10886;
          const _t10885 = op;
          _t10887: {
            if (_t10885._tag === 0) {
              _t10886 = "+";
              break _t10887;
            }
            if (_t10885._tag === 1) {
              _t10886 = "-";
              break _t10887;
            }
            if (_t10885._tag === 2) {
              _t10886 = "*";
              break _t10887;
            }
            if (_t10885._tag === 3) {
              _t10886 = "/";
              break _t10887;
            }
            if (true) {
              _t10886 = failwith("assert false");
              break _t10887;
            }
            _match_fail("line 16933");
          }
          const method_name_10888 = _t10886;
          const _t10889 = Compiler$compile_class_binop(s, "Num", method_name_10888, e1.ty, e1, e2);
          _t10877 = _t10889;
          break _t10878;
        }
        _match_fail("line 16933");
      }
      const _t10875 = _t10877;
      _t10864 = _t10875;
      break _t10865;
    }
    if (_t10863._tag === 4) {
      Compiler$compile_expr(false, s, e1);
      Compiler$compile_expr(false, s, e2);
      _t10864 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 17, _name: "MOD"})]);
      break _t10865;
    }
    if ((_t10863._tag === 5 || _t10863._tag === 6)) {
      const resolved_10890 = Types$repr(e1.ty);
      function _t10892(class_name, ty) {
        function _t10893(inst) {
          return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === 1) && Types$match_partial_inst(inst.inst_tys, ({_hd: ({_tag: 1, _name: "Some", _val: ty}), _tl: null}))));
        }
        return List$exists(_t10893, s.type_env.instances);
      }
      const has_custom_instance_10894 = _t10892;
      let _t10897;
      const _t10896 = resolved_10890;
      _t10898: {
        if (((((((((((((_t10896._tag === 0 || _t10896._tag === 1) || _t10896._tag === 2) || _t10896._tag === 3) || _t10896._tag === 4) || _t10896._tag === 5) || _t10896._tag === 6) || _t10896._tag === 10) || _t10896._tag === 9) || _t10896._tag === 12) || _t10896._tag === 14) || _t10896._tag === 13) || _t10896._tag === 15 && _t10896._val.contents._tag === 0)) {
          _t10897 = true;
          break _t10898;
        }
        if (_t10896._tag === 11) {
          _t10897 = (!has_custom_instance_10894("Eq", resolved_10890));
          break _t10898;
        }
        if (true) {
          _t10897 = false;
          break _t10898;
        }
        _match_fail("line 16933");
      }
      const use_structural_10899 = _t10897;
      let _t10901;
      if (use_structural_10899) {
        Compiler$compile_expr(false, s, e1);
        Compiler$compile_expr(false, s, e2);
        let _t10902;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t10902 = ({_tag: 24, _name: "EQ"});
        } else {
          _t10902 = ({_tag: 25, _name: "NEQ"});
        }
        _t10901 = _call(Compiler$emit, [1, 3, 6, s, _t10902]);
      } else {
        let _t10903;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t10903 = "=";
        } else {
          _t10903 = "<>";
        }
        const method_name_10904 = _t10903;
        const _t10905 = Compiler$compile_class_binop(s, "Eq", method_name_10904, e1.ty, e1, e2);
        _t10901 = _t10905;
      }
      const _t10900 = _t10901;
      const _t10895 = _t10900;
      const _t10891 = _t10895;
      _t10864 = _t10891;
      break _t10865;
    }
    if ((((_t10863._tag === 7 || _t10863._tag === 8) || _t10863._tag === 9) || _t10863._tag === 10)) {
      const resolved_10906 = Types$repr(e1.ty);
      let _t10909;
      const _t10908 = resolved_10906;
      _t10910: {
        if ((((((_t10908._tag === 0 || _t10908._tag === 1) || _t10908._tag === 3) || _t10908._tag === 4) || _t10908._tag === 5) || _t10908._tag === 15 && _t10908._val.contents._tag === 0)) {
          _t10909 = true;
          break _t10910;
        }
        if (true) {
          _t10909 = false;
          break _t10910;
        }
        _match_fail("line 16933");
      }
      const is_builtin_10911 = _t10909;
      let _t10913;
      if (is_builtin_10911) {
        Compiler$compile_expr(false, s, e1);
        Compiler$compile_expr(false, s, e2);
        let _t10915;
        const _t10914 = op;
        _t10916: {
          if (_t10914._tag === 7) {
            _t10915 = ({_tag: 26, _name: "LT"});
            break _t10916;
          }
          if (_t10914._tag === 8) {
            _t10915 = ({_tag: 27, _name: "GT"});
            break _t10916;
          }
          if (_t10914._tag === 9) {
            _t10915 = ({_tag: 28, _name: "LE"});
            break _t10916;
          }
          if (_t10914._tag === 10) {
            _t10915 = ({_tag: 29, _name: "GE"});
            break _t10916;
          }
          if (true) {
            _t10915 = failwith("assert false");
            break _t10916;
          }
          _match_fail("line 16933");
        }
        _t10913 = _call(Compiler$emit, [1, 3, 6, s, _t10915]);
      } else {
        let _t10918;
        const _t10917 = op;
        _t10919: {
          if (_t10917._tag === 7) {
            _t10918 = "<";
            break _t10919;
          }
          if (_t10917._tag === 8) {
            _t10918 = ">";
            break _t10919;
          }
          if (_t10917._tag === 9) {
            _t10918 = "<=";
            break _t10919;
          }
          if (_t10917._tag === 10) {
            _t10918 = ">=";
            break _t10919;
          }
          if (true) {
            _t10918 = failwith("assert false");
            break _t10919;
          }
          _match_fail("line 16933");
        }
        const method_name_10920 = _t10918;
        const _t10921 = Compiler$compile_class_binop(s, "Ord", method_name_10920, e1.ty, e1, e2);
        _t10913 = _t10921;
      }
      const _t10912 = _t10913;
      const _t10907 = _t10912;
      _t10864 = _t10907;
      break _t10865;
    }
    if (_t10863._tag === 13) {
      const gidx_10922 = _call(Compiler$find_or_add_global, [5, s, "^"]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_10922})]);
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      Compiler$compile_expr(false, s, e2);
      const _t10923 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      _t10864 = _t10923;
      break _t10865;
    }
    if (((((_t10863._tag === 14 || _t10863._tag === 15) || _t10863._tag === 16) || _t10863._tag === 17) || _t10863._tag === 18)) {
      const resolved_10924 = Types$repr(e1.ty);
      let _t10927;
      const _t10926 = resolved_10924;
      _t10928: {
        if (_t10926._tag === 0) {
          Compiler$compile_expr(false, s, e1);
          Compiler$compile_expr(false, s, e2);
          let _t10930;
          const _t10929 = op;
          _t10931: {
            if (_t10929._tag === 14) {
              _t10930 = ({_tag: 31, _name: "BAND"});
              break _t10931;
            }
            if (_t10929._tag === 15) {
              _t10930 = ({_tag: 32, _name: "BOR"});
              break _t10931;
            }
            if (_t10929._tag === 16) {
              _t10930 = ({_tag: 33, _name: "BXOR"});
              break _t10931;
            }
            if (_t10929._tag === 17) {
              _t10930 = ({_tag: 35, _name: "BSHL"});
              break _t10931;
            }
            if (_t10929._tag === 18) {
              _t10930 = ({_tag: 36, _name: "BSHR"});
              break _t10931;
            }
            if (true) {
              _t10930 = failwith("assert false");
              break _t10931;
            }
            _match_fail("line 16933");
          }
          _t10927 = _call(Compiler$emit, [1, 3, 6, s, _t10930]);
          break _t10928;
        }
        if (true) {
          let _t10933;
          const _t10932 = op;
          _t10934: {
            if (_t10932._tag === 14) {
              _t10933 = "land";
              break _t10934;
            }
            if (_t10932._tag === 15) {
              _t10933 = "lor";
              break _t10934;
            }
            if (_t10932._tag === 16) {
              _t10933 = "lxor";
              break _t10934;
            }
            if (_t10932._tag === 17) {
              _t10933 = "lsl";
              break _t10934;
            }
            if (_t10932._tag === 18) {
              _t10933 = "lsr";
              break _t10934;
            }
            if (true) {
              _t10933 = failwith("assert false");
              break _t10934;
            }
            _match_fail("line 16933");
          }
          const method_name_10935 = _t10933;
          const _t10936 = Compiler$compile_class_binop(s, "Bitwise", method_name_10935, e1.ty, e1, e2);
          _t10927 = _t10936;
          break _t10928;
        }
        _match_fail("line 16933");
      }
      const _t10925 = _t10927;
      _t10864 = _t10925;
      break _t10865;
    }
    if (_t10863._tag === 19) {
      Compiler$compile_expr(false, s, e2);
      Compiler$compile_expr(false, s, e1);
      _t10864 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      break _t10865;
    }
    _match_fail("line 16933");
  }
  return _t10864;
}
function Compiler$compile_class_binop(s, class_name, method_name, operand_ty, e1, e2) {
  const conc_ty_10937 = Types$repr(operand_ty);
  function _t10939(c) {
    return (c.class_name === class_name);
  }
  let _t10941;
  const _t10940 = List$find(_t10939, s.type_env.classes);
  _t10942: {
    if (_t10940._tag === 1) {
      const cd = _t10940._val;
      _t10941 = cd;
      break _t10942;
    }
    if (_t10940._tag === 0) {
      _t10941 = Compiler$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t10942;
    }
    _match_fail("line 16933");
  }
  const class_def_10943 = _t10941;
  const num_params_10945 = List$length(class_def_10943.class_params);
  function _t10947(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_10937});
  }
  const partial_10948 = List$init(num_params_10945, _t10947);
  function _t10950(opt) {
    let _t10952;
    const _t10951 = opt;
    _t10953: {
      if (_t10951._tag === 1) {
        const ty = _t10951._val;
        let _t10955;
        const _t10954 = Types$repr(ty);
        _t10956: {
          if (_t10954._tag === 15 && _t10954._val.contents._tag === 0) {
            _t10955 = ({_tag: 0, _name: "None"});
            break _t10956;
          }
          if (true) {
            _t10955 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t10956;
          }
          _match_fail("line 16933");
        }
        _t10952 = _t10955;
        break _t10953;
      }
      if (_t10951._tag === 0) {
        _t10952 = ({_tag: 0, _name: "None"});
        break _t10953;
      }
      _match_fail("line 16933");
    }
    return _t10952;
  }
  const concrete_partial_10957 = List$map(_t10950, partial_10948);
  function _t10959(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_10945) && Types$match_partial_inst(inst.inst_tys, concrete_partial_10957)));
  }
  const matching_10960 = List$filter(_t10959, s.type_env.instances);
  let _t10963;
  const _t10962 = matching_10960;
  _t10964: {
    if (_t10962 !== null && _t10962._tl === null) {
      const inst = _t10962._hd;
      let _t10965;
      if (_eq(inst.inst_constraints, null)) {
        const method_gidx_10966 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
        const _t10967 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10966})]);
        _t10965 = _t10967;
      } else {
        const dict_gidx_10968 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_10968})]);
        const _t10969 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
        _t10965 = _t10969;
      }
      _t10965;
      Compiler$compile_expr(false, s, e1);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      Compiler$compile_expr(false, s, e2);
      _t10963 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      break _t10964;
    }
    if (_t10962 === null) {
      _t10963 = Compiler$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_10937))));
      break _t10964;
    }
    if (true) {
      _t10963 = Compiler$error(((("ambiguous instance for " + __dict_Show_string.show(class_name)) + " method ") + __dict_Show_string.show(method_name)));
      break _t10964;
    }
    _match_fail("line 16933");
  }
  const _t10961 = _t10963;
  const _t10958 = _t10961;
  const _t10949 = _t10958;
  const _t10946 = _t10949;
  const _t10944 = _t10946;
  const _t10938 = _t10944;
  return _t10938;
}
function Compiler$compile_class_unop(s, class_name, method_name, operand_ty, e) {
  const conc_ty_10970 = Types$repr(operand_ty);
  function _t10972(c) {
    return (c.class_name === class_name);
  }
  let _t10974;
  const _t10973 = List$find(_t10972, s.type_env.classes);
  _t10975: {
    if (_t10973._tag === 1) {
      const cd = _t10973._val;
      _t10974 = cd;
      break _t10975;
    }
    if (_t10973._tag === 0) {
      _t10974 = Compiler$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t10975;
    }
    _match_fail("line 16933");
  }
  const class_def_10976 = _t10974;
  const num_params_10978 = List$length(class_def_10976.class_params);
  function _t10980(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_10970});
  }
  const partial_10981 = List$init(num_params_10978, _t10980);
  function _t10983(opt) {
    let _t10985;
    const _t10984 = opt;
    _t10986: {
      if (_t10984._tag === 1) {
        const ty = _t10984._val;
        let _t10988;
        const _t10987 = Types$repr(ty);
        _t10989: {
          if (_t10987._tag === 15 && _t10987._val.contents._tag === 0) {
            _t10988 = ({_tag: 0, _name: "None"});
            break _t10989;
          }
          if (true) {
            _t10988 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t10989;
          }
          _match_fail("line 16933");
        }
        _t10985 = _t10988;
        break _t10986;
      }
      if (_t10984._tag === 0) {
        _t10985 = ({_tag: 0, _name: "None"});
        break _t10986;
      }
      _match_fail("line 16933");
    }
    return _t10985;
  }
  const concrete_partial_10990 = List$map(_t10983, partial_10981);
  function _t10992(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_10978) && Types$match_partial_inst(inst.inst_tys, concrete_partial_10990)));
  }
  const matching_10993 = List$filter(_t10992, s.type_env.instances);
  let _t10996;
  const _t10995 = matching_10993;
  _t10997: {
    if (_t10995 !== null && _t10995._tl === null) {
      const inst = _t10995._hd;
      let _t10998;
      if (_eq(inst.inst_constraints, null)) {
        const method_gidx_10999 = _call(Compiler$find_or_add_global, [5, s, (inst.inst_dict_name + ("$" + method_name))]);
        const _t11000 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: method_gidx_10999})]);
        _t10998 = _t11000;
      } else {
        const dict_gidx_11001 = _call(Compiler$find_or_add_global, [5, s, inst.inst_dict_name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: dict_gidx_11001})]);
        const _t11002 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
        _t10998 = _t11002;
      }
      _t10998;
      Compiler$compile_expr(false, s, e);
      _t10996 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
      break _t10997;
    }
    if (_t10995 === null) {
      _t10996 = Compiler$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_10970))));
      break _t10997;
    }
    if (true) {
      _t10996 = Compiler$error(((("ambiguous instance for " + __dict_Show_string.show(class_name)) + " method ") + __dict_Show_string.show(method_name)));
      break _t10997;
    }
    _match_fail("line 16933");
  }
  const _t10994 = _t10996;
  const _t10991 = _t10994;
  const _t10982 = _t10991;
  const _t10979 = _t10982;
  const _t10977 = _t10979;
  const _t10971 = _t10977;
  return _t10971;
}
function Compiler$compile_unop(s, op, e) {
  let _t11004;
  const _t11003 = op;
  _t11005: {
    if (_t11003._tag === 0) {
      const resolved_11006 = Types$repr(e.ty);
      let _t11009;
      const _t11008 = resolved_11006;
      _t11010: {
        if (_t11008._tag === 0) {
          Compiler$compile_expr(false, s, e);
          _t11009 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 18, _name: "NEG"})]);
          break _t11010;
        }
        if (_t11008._tag === 1) {
          Compiler$compile_expr(false, s, e);
          _t11009 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 23, _name: "FNEG"})]);
          break _t11010;
        }
        if (true) {
          _t11009 = Compiler$compile_class_unop(s, "Num", "neg", e.ty, e);
          break _t11010;
        }
        _match_fail("line 16933");
      }
      const _t11007 = _t11009;
      _t11004 = _t11007;
      break _t11005;
    }
    if (_t11003._tag === 1) {
      Compiler$compile_expr(false, s, e);
      _t11004 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 30, _name: "NOT"})]);
      break _t11005;
    }
    if (_t11003._tag === 2) {
      const resolved_11011 = Types$repr(e.ty);
      let _t11014;
      const _t11013 = resolved_11011;
      _t11015: {
        if (_t11013._tag === 0) {
          Compiler$compile_expr(false, s, e);
          _t11014 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 34, _name: "BNOT"})]);
          break _t11015;
        }
        if (true) {
          _t11014 = Compiler$compile_class_unop(s, "Bitwise", "lnot", e.ty, e);
          break _t11015;
        }
        _match_fail("line 16933");
      }
      const _t11012 = _t11014;
      _t11004 = _t11012;
      break _t11005;
    }
    _match_fail("line 16933");
  }
  return _t11004;
}
function Compiler$compile_if(tail, s, cond, then_e, else_e) {
  Compiler$compile_expr(false, s, cond);
  const else_jump_11016 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]);
  Compiler$compile_expr(tail, s, then_e);
  const end_jump_11018 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
  const else_target_11020 = _call(Compiler$current_offset, [1, s]);
  _call(Compiler$patch, [1, s, else_jump_11016, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: else_target_11020})]);
  Compiler$compile_expr(tail, s, else_e);
  const end_target_11022 = _call(Compiler$current_offset, [1, s]);
  const _t11023 = _call(Compiler$patch, [1, s, end_jump_11018, ({_tag: 37, _name: "JUMP", _val: end_target_11022})]);
  const _t11021 = _t11023;
  const _t11019 = _t11021;
  const _t11017 = _t11019;
  return _t11017;
}
function Compiler$compile_function(has_return, s, param_name, body, _fn_ty) {
  function collect_params(params, body_expr, hr) {
    while (true) {
      let _t11025;
      const _t11024 = body_expr.expr;
      _t11026: {
        if (_t11024._tag === 10) {
          const p = _t11024._val[0];
          const inner = _t11024._val[1];
          const inner_hr = _t11024._val[2];
          const _t11027 = ({_hd: p, _tl: params});
          const _t11028 = inner;
          const _t11029 = (hr || inner_hr);
          params = _t11027;
          body_expr = _t11028;
          hr = _t11029;
          continue;
          _t11025 = undefined;
          break _t11026;
        }
        if (true) {
          _t11025 = [List$rev(params), body_expr, hr];
          break _t11026;
        }
        _match_fail("line 16933");
      }
      return _t11025;
    }
  }
  let _t11032;
  const _t11031 = collect_params(null, body, has_return);
  _t11033: {
    if (true) {
      const extra_params = _t11031[0];
      const final_body = _t11031[1];
      const combined_hr = _t11031[2];
      const all_params_11034 = ({_hd: param_name, _tl: extra_params});
      const arity_11036 = List$length(all_params_11034);
      const sub_11038 = Compiler$create_state(({_tag: 1, _name: "Some", _val: s}), arity_11036, s.global_names, s.mutable_globals, s.type_env, param_name);
      function _t11040(p) {
        _call(Compiler$allocate_local, [7, 9, 12, 15, sub_11038, p]);
        return undefined;
      }
      List$iter(_t11040, all_params_11034);
      let _t11041;
      if (combined_hr) {
        _t11041 = _call(Compiler$emit, [1, 3, 6, sub_11038, ({_tag: 46, _name: "ENTER_FUNC"})]);
      } else {
        _t11041 = undefined;
      }
      _t11041;
      Compiler$compile_expr((!combined_hr), sub_11038, final_body);
      let _t11042;
      if (combined_hr) {
        _t11042 = _call(Compiler$emit, [1, 3, 6, sub_11038, ({_tag: 47, _name: "EXIT_FUNC"})]);
      } else {
        _t11042 = undefined;
      }
      _t11042;
      _call(Compiler$emit, [1, 3, 6, sub_11038, ({_tag: 44, _name: "RETURN"})]);
      const proto_11043 = Compiler$finalize_proto(sub_11038);
      const proto_idx_11045 = _call(Compiler$add_constant, [2, s, ({_tag: 13, _name: "VProto", _val: proto_11043})]);
      function _t11047(uv) {
        return uv.capture;
      }
      const captures_11048 = List$map(_t11047, sub_11038.upvalues);
      const _t11049 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 40, _name: "CLOSURE", _val: [proto_idx_11045, captures_11048]})]);
      const _t11046 = _t11049;
      const _t11044 = _t11046;
      const _t11039 = _t11044;
      const _t11037 = _t11039;
      const _t11035 = _t11037;
      _t11032 = _t11035;
      break _t11033;
    }
    _match_fail("line 16933");
  }
  const _t11030 = _t11032;
  return _t11030;
}
function Compiler$count_arrows(ty) {
  let _t11051;
  const _t11050 = Types$repr(ty);
  _t11052: {
    if ((_t11050._tag === 7 || _t11050._tag === 8)) {
      const r = _t11050._val[2];
      _t11051 = (1 + Compiler$count_arrows(r));
      break _t11052;
    }
    if (true) {
      _t11051 = 0;
      break _t11052;
    }
    _match_fail("line 16933");
  }
  return _t11051;
}
function Compiler$finalize_proto(s) {
  return ({arity: s.arity, code: Dynarray$to_array(s.code), constants: Dynarray$to_array(s.constants), line_table: Dynarray$to_array(s.lines), name: s.proto_name, num_locals: s.max_locals});
}
function Compiler$emit_rec_placeholder(s, te) {
  function go(te) {
    while (true) {
      let _t11054;
      const _t11053 = te.expr;
      _t11055: {
        if (_t11053._tag === 21) {
          const unit_idx_11056 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_11056})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 57, _name: "NIL"})]);
          const _t11057 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 56, _name: "CONS"})]);
          _t11054 = _t11057;
          break _t11055;
        }
        if (_t11053._tag === 15) {
          const es = _t11053._val;
          const unit_idx_11058 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
          function _t11060(_) {
            return _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_11058})]);
          }
          List$iter(_t11060, es);
          const _t11059 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 48, _name: "MAKE_TUPLE", _val: List$length(es)})]);
          _t11054 = _t11059;
          break _t11055;
        }
        if (_t11053._tag === 16) {
          const fields = _t11053._val;
          function _t11061(__p386, __p387) {
            let _t11063;
            const _t11062 = __p386;
            _t11064: {
              if (true) {
                const a = _t11062[0];
                let _t11066;
                const _t11065 = __p387;
                _t11067: {
                  if (true) {
                    const b = _t11065[0];
                    _t11066 = String$compare(a, b);
                    break _t11067;
                  }
                  _match_fail("line 16933");
                }
                _t11063 = _t11066;
                break _t11064;
              }
              _match_fail("line 16933");
            }
            return _t11063;
          }
          const sorted_11068 = List$sort(_t11061, fields);
          const names_11070 = List$map(fst, sorted_11068);
          const unit_idx_11072 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
          function _t11074(_) {
            return _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_11072})]);
          }
          List$iter(_t11074, names_11070);
          const _t11073 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 50, _name: "MAKE_RECORD", _val: names_11070})]);
          const _t11071 = _t11073;
          const _t11069 = _t11071;
          _t11054 = _t11069;
          break _t11055;
        }
        if (_t11053._tag === 23) {
          const name = _t11053._val[0];
          const payload_opt = _t11053._val[1];
          let _t11075;
          if (Compiler$is_newtype_ctor(s.type_env, name)) {
            let _t11077;
            const _t11076 = payload_opt;
            _t11078: {
              if (_t11076._tag === 1) {
                const inner = _t11076._val;
                const _t11079 = inner;
                te = _t11079;
                continue;
                _t11077 = undefined;
                break _t11078;
              }
              if (_t11076._tag === 0) {
                _t11077 = Compiler$error("cannot create placeholder for nullary newtype constructor");
                break _t11078;
              }
              _match_fail("line 16933");
            }
            _t11075 = _t11077;
          } else {
            let _t11080;
            if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
              _t11080 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
            } else {
              _t11080 = Compiler$tag_for_constructor(s.type_env, name);
            }
            const tag_11081 = _t11080;
            let _t11084;
            const _t11083 = String$rindex_opt(name, 46);
            _t11085: {
              if (_t11083._tag === 1) {
                const i = _t11083._val;
                _t11084 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
                break _t11085;
              }
              if (_t11083._tag === 0) {
                _t11084 = name;
                break _t11085;
              }
              _match_fail("line 16933");
            }
            const short_name_11086 = _t11084;
            let _t11089;
            const _t11088 = payload_opt;
            _t11090: {
              if (_t11088._tag === 1) {
                const unit_idx_11091 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_11091})]);
                const _t11092 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_11081, short_name_11086, true]})]);
                _t11089 = _t11092;
                break _t11090;
              }
              if (_t11088._tag === 0) {
                _t11089 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 55, _name: "MAKE_VARIANT", _val: [tag_11081, short_name_11086, false]})]);
                break _t11090;
              }
              _match_fail("line 16933");
            }
            const _t11087 = _t11089;
            const _t11082 = _t11087;
            _t11075 = _t11082;
          }
          _t11054 = _t11075;
          break _t11055;
        }
        if (_t11053._tag === 38) {
          const es = _t11053._val;
          const unit_idx_11093 = _call(Compiler$add_constant, [2, s, ({_tag: 6, _name: "VUnit"})]);
          function _t11095(_) {
            return _call(Compiler$emit, [1, 3, 6, s, ({_tag: 0, _name: "CONST", _val: unit_idx_11093})]);
          }
          List$iter(_t11095, es);
          const _t11094 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 73, _name: "MAKE_ARRAY", _val: List$length(es)})]);
          _t11054 = _t11094;
          break _t11055;
        }
        if (_t11053._tag === 8) {
          const body = _t11053._val[3];
          const _t11096 = body;
          te = _t11096;
          continue;
          _t11054 = undefined;
          break _t11055;
        }
        if (_t11053._tag === 28) {
          const body = _t11053._val[1];
          const _t11097 = body;
          te = _t11097;
          continue;
          _t11054 = undefined;
          break _t11055;
        }
        if (true) {
          _t11054 = Compiler$error("cannot create placeholder for recursive value binding");
          break _t11055;
        }
        _match_fail("line 16933");
      }
      return _t11054;
    }
  }
  const _t11098 = go(te);
  return _t11098;
}
function Compiler$compile_let_rec(s, name, fn_expr) {
  const slot_11099 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
  let _t11102;
  const _t11101 = fn_expr.expr;
  _t11103: {
    if (_t11101._tag === 10) {
      const param = _t11101._val[0];
      const body = _t11101._val[1];
      const has_return = _t11101._val[2];
      function collect_params(params, body_expr, hr) {
        while (true) {
          let _t11105;
          const _t11104 = body_expr.expr;
          _t11106: {
            if (_t11104._tag === 10) {
              const p = _t11104._val[0];
              const inner = _t11104._val[1];
              const inner_hr = _t11104._val[2];
              const _t11107 = ({_hd: p, _tl: params});
              const _t11108 = inner;
              const _t11109 = (hr || inner_hr);
              params = _t11107;
              body_expr = _t11108;
              hr = _t11109;
              continue;
              _t11105 = undefined;
              break _t11106;
            }
            if (true) {
              _t11105 = [List$rev(params), body_expr, hr];
              break _t11106;
            }
            _match_fail("line 16933");
          }
          return _t11105;
        }
      }
      let _t11112;
      const _t11111 = collect_params(null, body, has_return);
      _t11113: {
        if (true) {
          const extra_params = _t11111[0];
          const final_body = _t11111[1];
          const combined_hr = _t11111[2];
          const all_params_11114 = ({_hd: param, _tl: extra_params});
          const arity_11116 = List$length(all_params_11114);
          const sub_11118 = Compiler$create_state(({_tag: 1, _name: "Some", _val: s}), arity_11116, s.global_names, s.mutable_globals, s.type_env, name);
          function _t11120(p) {
            _call(Compiler$allocate_local, [7, 9, 12, 15, sub_11118, p]);
            return undefined;
          }
          List$iter(_t11120, all_params_11114);
          let _t11121;
          if (combined_hr) {
            _t11121 = _call(Compiler$emit, [1, 3, 6, sub_11118, ({_tag: 46, _name: "ENTER_FUNC"})]);
          } else {
            _t11121 = undefined;
          }
          _t11121;
          Compiler$compile_expr((!combined_hr), sub_11118, final_body);
          let _t11122;
          if (combined_hr) {
            _t11122 = _call(Compiler$emit, [1, 3, 6, sub_11118, ({_tag: 47, _name: "EXIT_FUNC"})]);
          } else {
            _t11122 = undefined;
          }
          _t11122;
          _call(Compiler$emit, [1, 3, 6, sub_11118, ({_tag: 44, _name: "RETURN"})]);
          const proto_11123 = Compiler$finalize_proto(sub_11118);
          const proto_idx_11125 = _call(Compiler$add_constant, [2, s, ({_tag: 13, _name: "VProto", _val: proto_11123})]);
          function _t11127(uv) {
            return uv.capture;
          }
          const captures_11128 = List$map(_t11127, sub_11118.upvalues);
          function _t11130(__p388) {
            let _t11132;
            const _t11131 = __p388;
            _t11133: {
              if (true) {
                const i = _t11131[0];
                const uv = _t11131[1];
                let _t11134;
                if ((uv.uv_name === name)) {
                  _t11134 = ({_tag: 1, _name: "Some", _val: i});
                } else {
                  _t11134 = ({_tag: 0, _name: "None"});
                }
                _t11132 = _t11134;
                break _t11133;
              }
              _match_fail("line 16933");
            }
            return _t11132;
          }
          function _t11135(i, uv) {
            return [i, uv];
          }
          const self_idx_11136 = List$find_map(_t11130, List$mapi(_t11135, sub_11118.upvalues));
          let _t11139;
          const _t11138 = self_idx_11136;
          _t11140: {
            if (_t11138._tag === 1) {
              const si = _t11138._val;
              _t11139 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 41, _name: "CLOSURE_REC", _val: [proto_idx_11125, captures_11128, si]})]);
              break _t11140;
            }
            if (_t11138._tag === 0) {
              _t11139 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 40, _name: "CLOSURE", _val: [proto_idx_11125, captures_11128]})]);
              break _t11140;
            }
            _match_fail("line 16933");
          }
          _t11139;
          const _t11137 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_11099})]);
          const _t11129 = _t11137;
          const _t11126 = _t11129;
          const _t11124 = _t11126;
          const _t11119 = _t11124;
          const _t11117 = _t11119;
          const _t11115 = _t11117;
          _t11112 = _t11115;
          break _t11113;
        }
        _match_fail("line 16933");
      }
      const _t11110 = _t11112;
      _t11102 = _t11110;
      break _t11103;
    }
    if (true) {
      Compiler$emit_rec_placeholder(s, fn_expr);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: slot_11099})]);
      Compiler$compile_expr(false, s, fn_expr);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot_11099})]);
      _t11102 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 84, _name: "UPDATE_REC"})]);
      break _t11103;
    }
    _match_fail("line 16933");
  }
  const _t11100 = _t11102;
  return _t11100;
}
function Compiler$compile_match(tail, s, scrut, arms) {
  Compiler$compile_expr(false, s, scrut);
  const scrut_slot_11141 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_match_scrut"]);
  _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: scrut_slot_11141})]);
  const end_jumps_11143 = Ref$create(null);
  function _t11145(__p389) {
    let _t11147;
    const _t11146 = __p389;
    _t11148: {
      if (true) {
        const pat = _t11146[0];
        const guard = _t11146[1];
        const body = _t11146[2];
        const saved_num_locals_11149 = s.num_locals;
        const saved_locals_11151 = s.locals;
        const fail_jumps_11153 = Ref$create(null);
        Compiler$compile_pattern(s, scrut_slot_11141, pat, fail_jumps_11153);
        let _t11156;
        const _t11155 = guard;
        _t11157: {
          if (_t11155._tag === 1) {
            const guard_te = _t11155._val;
            Compiler$compile_expr(false, s, guard_te);
            _t11156 = Ref$set(fail_jumps_11153, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps_11153)}));
            break _t11157;
          }
          if (_t11155._tag === 0) {
            _t11156 = undefined;
            break _t11157;
          }
          _match_fail("line 16933");
        }
        _t11156;
        Compiler$compile_expr(tail, s, body);
        (s.num_locals = saved_num_locals_11149, undefined);
        (s.locals = saved_locals_11151, undefined);
        Ref$set(end_jumps_11143, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]), _tl: Ref$get(end_jumps_11143)}));
        const target_11158 = _call(Compiler$current_offset, [1, s]);
        function _t11160(idx) {
          return _call(Compiler$patch, [1, s, idx, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: target_11158})]);
        }
        const _t11159 = List$iter(_t11160, Ref$get(fail_jumps_11153));
        const _t11154 = _t11159;
        const _t11152 = _t11154;
        const _t11150 = _t11152;
        _t11147 = _t11150;
        break _t11148;
      }
      _match_fail("line 16933");
    }
    return _t11147;
  }
  List$iter(_t11145, arms);
  const loc_str_11161 = ("line " + __dict_Show_int.show(scrut.loc.line));
  _call(Compiler$emit, [1, 3, 6, s, ({_tag: 64, _name: "MATCH_FAIL", _val: loc_str_11161})]);
  const end_target_11163 = _call(Compiler$current_offset, [1, s]);
  function _t11165(idx) {
    return _call(Compiler$patch, [1, s, idx, ({_tag: 37, _name: "JUMP", _val: end_target_11163})]);
  }
  List$iter(_t11165, Ref$get(end_jumps_11143));
  const _t11164 = Compiler$free_local(s);
  const _t11162 = _t11164;
  const _t11144 = _t11162;
  const _t11142 = _t11144;
  return _t11142;
}
function Compiler$compile_pattern(s, slot, pat, fail_jumps) {
  while (true) {
    let _t11167;
    const _t11166 = pat;
    _t11168: {
      if (_t11166._tag === 0) {
        _t11167 = undefined;
        break _t11168;
      }
      if (_t11166._tag === 1) {
        const name = _t11166._val;
        const var_slot_11169 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        const _t11170 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: var_slot_11169})]);
        _t11167 = _t11170;
        break _t11168;
      }
      if (_t11166._tag === 2) {
        const n = _t11166._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: n})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t11167 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t11168;
      }
      if (_t11166._tag === 3) {
        const f = _t11166._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 1, _name: "VFloat", _val: f})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t11167 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t11168;
      }
      if (_t11166._tag === 4) {
        const b = _t11166._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 2, _name: "VBool", _val: b})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t11167 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t11168;
      }
      if (_t11166._tag === 5) {
        const str = _t11166._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: str})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t11167 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t11168;
      }
      if (_t11166._tag === 6) {
        _t11167 = undefined;
        break _t11168;
      }
      if (_t11166._tag === 9) {
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 59, _name: "IS_NIL"})]);
        _t11167 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t11168;
      }
      if (_t11166._tag === 8) {
        const hd_pat = _t11166._val[0];
        const tl_pat = _t11166._val[1];
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 60, _name: "IS_CONS"})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        const hd_slot_11171 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_hd"]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 61, _name: "HEAD"})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: hd_slot_11171})]);
        const tl_slot_11173 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_tl"]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 62, _name: "TAIL"})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: tl_slot_11173})]);
        Compiler$compile_pattern(s, hd_slot_11171, hd_pat, fail_jumps);
        const _t11175 = s;
        const _t11176 = tl_slot_11173;
        const _t11177 = tl_pat;
        const _t11178 = fail_jumps;
        s = _t11175;
        slot = _t11176;
        pat = _t11177;
        fail_jumps = _t11178;
        continue;
        const _t11174 = undefined;
        const _t11172 = _t11174;
        _t11167 = _t11172;
        break _t11168;
      }
      if (_t11166._tag === 10) {
        const name = _t11166._val[0];
        const arg_pat = _t11166._val[1];
        if (Compiler$is_newtype_ctor(s.type_env, name)) {
          let _t11180;
          const _t11179 = arg_pat;
          _t11181: {
            if (_t11179._tag === 1) {
              const sub_pat = _t11179._val;
              const _t11182 = s;
              const _t11183 = slot;
              const _t11184 = sub_pat;
              const _t11185 = fail_jumps;
              s = _t11182;
              slot = _t11183;
              pat = _t11184;
              fail_jumps = _t11185;
              continue;
              _t11180 = undefined;
              break _t11181;
            }
            if (_t11179._tag === 0) {
              _t11180 = undefined;
              break _t11181;
            }
            _match_fail("line 16933");
          }
          _t11167 = _t11180;
          break _t11168;
        }
      }
      if (_t11166._tag === 10) {
        const name = _t11166._val[0];
        const arg_pat = _t11166._val[1];
        const tag_11186 = Compiler$tag_for_constructor(s.type_env, name);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 58, _name: "TAG_EQ", _val: tag_11186})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        let _t11189;
        const _t11188 = arg_pat;
        _t11190: {
          if (_t11188._tag === 1) {
            const sub_pat = _t11188._val;
            const payload_slot_11191 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_payload"]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 63, _name: "VARIANT_PAYLOAD"})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: payload_slot_11191})]);
            const _t11193 = s;
            const _t11194 = payload_slot_11191;
            const _t11195 = sub_pat;
            const _t11196 = fail_jumps;
            s = _t11193;
            slot = _t11194;
            pat = _t11195;
            fail_jumps = _t11196;
            continue;
            const _t11192 = undefined;
            _t11189 = _t11192;
            break _t11190;
          }
          if (_t11188._tag === 0) {
            _t11189 = undefined;
            break _t11190;
          }
          _match_fail("line 16933");
        }
        const _t11187 = _t11189;
        _t11167 = _t11187;
        break _t11168;
      }
      if (_t11166._tag === 7) {
        const pats = _t11166._val;
        function _t11197(i, sub_pat) {
          const elem_slot_11198 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_tup"]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 49, _name: "TUPLE_GET", _val: i})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: elem_slot_11198})]);
          const _t11199 = Compiler$compile_pattern(s, elem_slot_11198, sub_pat, fail_jumps);
          return _t11199;
        }
        _t11167 = List$iteri(_t11197, pats);
        break _t11168;
      }
      if (_t11166._tag === 11) {
        const field_pats = _t11166._val;
        function _t11200(__p390) {
          let _t11202;
          const _t11201 = __p390;
          _t11203: {
            if (true) {
              const fname = _t11201[0];
              const sub_pat = _t11201[1];
              const field_slot_11204 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_fld"]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: fname})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: field_slot_11204})]);
              const _t11205 = Compiler$compile_pattern(s, field_slot_11204, sub_pat, fail_jumps);
              _t11202 = _t11205;
              break _t11203;
            }
            _match_fail("line 16933");
          }
          return _t11202;
        }
        _t11167 = List$iter(_t11200, field_pats);
        break _t11168;
      }
      if (_t11166._tag === 12) {
        const inner_pat = _t11166._val[0];
        const name = _t11166._val[1];
        Compiler$compile_pattern(s, slot, inner_pat, fail_jumps);
        const var_slot_11206 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, name]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        const _t11207 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: var_slot_11206})]);
        _t11167 = _t11207;
        break _t11168;
      }
      if (_t11166._tag === 13) {
        const p1 = _t11166._val[0];
        const p2 = _t11166._val[1];
        const saved_locals_11208 = s.locals;
        const saved_num_locals_11210 = s.num_locals;
        const or_fail_jumps_11212 = Ref$create(null);
        Compiler$compile_pattern(s, slot, p1, or_fail_jumps_11212);
        function _t11214(l) {
          let _t11215;
          if (((l.slot >= saved_num_locals_11210) && ((l.name !== "") && (String$get(l.name, 0) !== 95)))) {
            _t11215 = ({_tag: 1, _name: "Some", _val: [l.name, l.slot]});
          } else {
            _t11215 = ({_tag: 0, _name: "None"});
          }
          return _t11215;
        }
        const p1_bindings_11216 = List$filter_map(_t11214, s.locals);
        const success_jump_11218 = _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 37, _name: "JUMP", _val: 0})]);
        const p2_target_11220 = _call(Compiler$current_offset, [1, s]);
        function _t11222(idx) {
          return _call(Compiler$patch, [1, s, idx, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: p2_target_11220})]);
        }
        List$iter(_t11222, Ref$get(or_fail_jumps_11212));
        (s.locals = saved_locals_11208, undefined);
        (s.num_locals = saved_num_locals_11210, undefined);
        Compiler$compile_pattern(s, slot, p2, fail_jumps);
        function _t11223(__p391) {
          let _t11225;
          const _t11224 = __p391;
          _t11226: {
            if (true) {
              const name = _t11224[0];
              const p1_slot = _t11224[1];
              function _t11227(l) {
                return ((l.name === name) && (l.slot >= saved_num_locals_11210));
              }
              let _t11229;
              const _t11228 = List$find(_t11227, s.locals);
              _t11230: {
                if (_t11228._tag === 1) {
                  const l = _t11228._val;
                  if ((l.slot !== p1_slot)) {
                    _t11229 = ({_tag: 1, _name: "Some", _val: [l.slot, p1_slot]});
                    break _t11230;
                  }
                }
                if (true) {
                  _t11229 = ({_tag: 0, _name: "None"});
                  break _t11230;
                }
                _match_fail("line 16933");
              }
              _t11225 = _t11229;
              break _t11226;
            }
            _match_fail("line 16933");
          }
          return _t11225;
        }
        const remaps_11231 = List$filter_map(_t11223, p1_bindings_11216);
        let _t11233;
        if (!_eq(remaps_11231, null)) {
          function _t11234(__p392) {
            let _t11236;
            const _t11235 = __p392;
            _t11237: {
              if (true) {
                const src = _t11235[0];
                const _dst = _t11235[1];
                const tmp_11238 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_or_tmp"]);
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: src})]);
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: tmp_11238})]);
                const _t11239 = tmp_11238;
                _t11236 = _t11239;
                break _t11237;
              }
              _match_fail("line 16933");
            }
            return _t11236;
          }
          const temps_11240 = List$map(_t11234, remaps_11231);
          function _t11242(tmp, __p393) {
            let _t11244;
            const _t11243 = __p393;
            _t11245: {
              if (true) {
                const _src = _t11243[0];
                const dst = _t11243[1];
                _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: tmp})]);
                _t11244 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: dst})]);
                break _t11245;
              }
              _match_fail("line 16933");
            }
            return _t11244;
          }
          const _t11241 = List$iter2(_t11242, temps_11240, remaps_11231);
          _t11233 = _t11241;
        } else {
          _t11233 = undefined;
        }
        _t11233;
        const success_target_11246 = _call(Compiler$current_offset, [1, s]);
        _call(Compiler$patch, [1, s, success_jump_11218, ({_tag: 37, _name: "JUMP", _val: success_target_11246})]);
        function _t11248(l) {
          let _t11253;
          if ((l.slot < saved_num_locals_11210)) {
            _t11253 = true;
          } else {
          function _t11249(__p394) {
            let _t11251;
            const _t11250 = __p394;
            _t11252: {
              if (true) {
                const n = _t11250[0];
                _t11251 = (n === l.name);
                break _t11252;
              }
              _match_fail("line 16933");
            }
            return _t11251;
          }
            _t11253 = List$exists(_t11249, p1_bindings_11216);
          }
          return _t11253;
        }
        const p2_only_locals_11254 = List$filter(_t11248, s.locals);
        function _t11256(l) {
          let _t11258;
          const _t11257 = List$assoc_opt(l.name, p1_bindings_11216);
          _t11259: {
            if (_t11257._tag === 1) {
              const p1_slot = _t11257._val;
              if ((l.slot >= saved_num_locals_11210)) {
                const __rec_upd_11260 = l;
                const _t11261 = ({depth: __rec_upd_11260.depth, name: __rec_upd_11260.name, slot: p1_slot});
                _t11258 = _t11261;
                break _t11259;
              }
            }
            if (true) {
              _t11258 = l;
              break _t11259;
            }
            _match_fail("line 16933");
          }
          return _t11258;
        }
        const remapped_11262 = List$map(_t11256, p2_only_locals_11254);
        const _t11263 = (s.locals = remapped_11262, undefined);
        const _t11255 = _t11263;
        const _t11247 = _t11255;
        const _t11232 = _t11247;
        const _t11221 = _t11232;
        const _t11219 = _t11221;
        const _t11217 = _t11219;
        const _t11213 = _t11217;
        const _t11211 = _t11213;
        const _t11209 = _t11211;
        _t11167 = _t11209;
        break _t11168;
      }
      if (_t11166._tag === 14) {
        const pats = _t11166._val;
        const al_gidx_11264 = _call(Compiler$find_or_add_global, [5, s, "array_length"]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: al_gidx_11264})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
        _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: List$length(pats)})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        function _t11266(i, sub_pat) {
          const elem_slot_11267 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_arr_elem"]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
          _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: i})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 74, _name: "INDEX"})]);
          _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: elem_slot_11267})]);
          const _t11268 = Compiler$compile_pattern(s, elem_slot_11267, sub_pat, fail_jumps);
          return _t11268;
        }
        const _t11265 = List$iteri(_t11266, pats);
        _t11167 = _t11265;
        break _t11168;
      }
      if (_t11166._tag === 15) {
        const entries = _t11166._val;
        const has_gidx_11269 = _call(Compiler$find_or_add_global, [5, s, "Map.has"]);
        const get_gidx_11271 = _call(Compiler$find_or_add_global, [5, s, "Map.get"]);
        function _t11273(key_pat) {
          let _t11275;
          const _t11274 = key_pat;
          _t11276: {
            if (_t11274._tag === 2) {
              const n = _t11274._val;
              _t11275 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 0, _name: "VInt", _val: n})]);
              break _t11276;
            }
            if (_t11274._tag === 5) {
              const str = _t11274._val;
              _t11275 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: str})]);
              break _t11276;
            }
            if (_t11274._tag === 4) {
              const b = _t11274._val;
              _t11275 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 2, _name: "VBool", _val: b})]);
              break _t11276;
            }
            if (_t11274._tag === 3) {
              const f = _t11274._val;
              _t11275 = _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 1, _name: "VFloat", _val: f})]);
              break _t11276;
            }
            if (_t11274._tag === 17) {
              const name = _t11274._val;
              _t11275 = Compiler$compile_var_access(s, name);
              break _t11276;
            }
            if (true) {
              _t11275 = Compiler$error("map pattern keys must be literals or pin patterns");
              break _t11276;
            }
            _match_fail("line 16933");
          }
          return _t11275;
        }
        const emit_map_key_11277 = _t11273;
        function _t11279(__p395) {
          let _t11281;
          const _t11280 = __p395;
          _t11282: {
            if (true) {
              const key_pat = _t11280[0];
              const val_pat = _t11280[1];
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: has_gidx_11269})]);
              emit_map_key_11277(key_pat);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
              const val_slot_11283 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_map_val"]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: get_gidx_11271})]);
              emit_map_key_11277(key_pat);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 42, _name: "CALL", _val: 1})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 63, _name: "VARIANT_PAYLOAD"})]);
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: val_slot_11283})]);
              const _t11284 = Compiler$compile_pattern(s, val_slot_11283, val_pat, fail_jumps);
              _t11281 = _t11284;
              break _t11282;
            }
            _match_fail("line 16933");
          }
          return _t11281;
        }
        const _t11278 = List$iter(_t11279, entries);
        const _t11272 = _t11278;
        const _t11270 = _t11272;
        _t11167 = _t11270;
        break _t11168;
      }
      if (_t11166._tag === 16) {
        const tag = _t11166._val[0];
        const arg_pat = _t11166._val[1];
        const num_tag_11285 = (__dict_Hash_string.hash(tag) & 1073741823);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 58, _name: "TAG_EQ", _val: num_tag_11285})]);
        Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        let _t11288;
        const _t11287 = arg_pat;
        _t11289: {
          if (_t11287._tag === 1) {
            const sub_pat = _t11287._val;
            const payload_slot_11290 = _call(Compiler$allocate_local, [7, 9, 12, 15, s, "_payload"]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 63, _name: "VARIANT_PAYLOAD"})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 4, _name: "SET_LOCAL", _val: payload_slot_11290})]);
            const _t11292 = s;
            const _t11293 = payload_slot_11290;
            const _t11294 = sub_pat;
            const _t11295 = fail_jumps;
            s = _t11292;
            slot = _t11293;
            pat = _t11294;
            fail_jumps = _t11295;
            continue;
            const _t11291 = undefined;
            _t11288 = _t11291;
            break _t11289;
          }
          if (_t11287._tag === 0) {
            _t11288 = undefined;
            break _t11289;
          }
          _match_fail("line 16933");
        }
        const _t11286 = _t11288;
        _t11167 = _t11286;
        break _t11168;
      }
      if (_t11166._tag === 17) {
        const name = _t11166._val;
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 3, _name: "GET_LOCAL", _val: slot})]);
        Compiler$compile_var_access(s, name);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 24, _name: "EQ"})]);
        _t11167 = Ref$set(fail_jumps, ({_hd: _call(Compiler$emit_idx, [1, 3, 6, s, ({_tag: 38, _name: "JUMP_IF_FALSE", _val: 0})]), _tl: Ref$get(fail_jumps)}));
        break _t11168;
      }
      if (_t11166._tag === 18) {
        const inner_pat = _t11166._val[0];
        const _t11296 = s;
        const _t11297 = slot;
        const _t11298 = inner_pat;
        const _t11299 = fail_jumps;
        s = _t11296;
        slot = _t11297;
        pat = _t11298;
        fail_jumps = _t11299;
        continue;
        _t11167 = undefined;
        break _t11168;
      }
      _match_fail("line 16933");
    }
    return _t11167;
  }
}
function Compiler$compile_handle(s, body_te, arms) {
  const return_arm_11300 = Ref$create(({_tag: 0, _name: "None"}));
  const op_arms_11302 = Ref$create(null);
  function _t11304(__x) {
    let _t11306;
    const _t11305 = __x;
    _t11307: {
      if (_t11305._tag === 0) {
        const name = _t11305._val[0];
        const handler_body = _t11305._val[1];
        _t11306 = Ref$set(return_arm_11300, ({_tag: 1, _name: "Some", _val: [name, handler_body]}));
        break _t11307;
      }
      if (_t11305._tag === 1) {
        const op_name = _t11305._val[0];
        const arg_name = _t11305._val[1];
        const k_name = _t11305._val[2];
        const handler_body = _t11305._val[3];
        _t11306 = Ref$set(op_arms_11302, ({_hd: [op_name, arg_name, k_name, handler_body], _tl: Ref$get(op_arms_11302)}));
        break _t11307;
      }
      if (_t11305._tag === 2) {
        const op_name = _t11305._val[0];
        const arg_name = _t11305._val[1];
        const value_expr = _t11305._val[2];
        const k_name_11308 = "__k_provide";
        const __rec_upd_11310 = value_expr;
        const _t11311 = ({expr: ({_tag: 7, _name: "TEVar", _val: k_name_11308}), loc: __rec_upd_11310.loc, ty: ({_tag: 6, _name: "TUnit"})});
        const k_var_11312 = _t11311;
        const __rec_upd_11314 = value_expr;
        const _t11315 = ({expr: ({_tag: 31, _name: "TEResume", _val: [k_var_11312, value_expr]}), loc: __rec_upd_11314.loc, ty: __rec_upd_11314.ty});
        const resume_expr_11316 = _t11315;
        const _t11317 = Ref$set(op_arms_11302, ({_hd: [op_name, arg_name, k_name_11308, resume_expr_11316], _tl: Ref$get(op_arms_11302)}));
        const _t11313 = _t11317;
        const _t11309 = _t11313;
        _t11306 = _t11309;
        break _t11307;
      }
      if (_t11305._tag === 3) {
        const op_name = _t11305._val[0];
        const arg_name = _t11305._val[1];
        const fallback_expr = _t11305._val[2];
        _t11306 = Ref$set(op_arms_11302, ({_hd: [op_name, arg_name, "__k_try", fallback_expr], _tl: Ref$get(op_arms_11302)}));
        break _t11307;
      }
      _match_fail("line 16933");
    }
    return _t11306;
  }
  List$iter(_t11304, arms);
  const op_arms_11318 = List$rev(Ref$get(op_arms_11302));
  let _t11321;
  const _t11320 = Ref$get(return_arm_11300);
  _t11322: {
    if (_t11320._tag === 1) {
      const arm = _t11320._val;
      _t11321 = arm;
      break _t11322;
    }
    if (_t11320._tag === 0) {
      _t11321 = Compiler$error("handle expression missing return arm");
      break _t11322;
    }
    _match_fail("line 16933");
  }
  let _t11324;
  const _t11323 = _t11321;
  _t11325: {
    if (true) {
      const ret_name = _t11323[0];
      const ret_body = _t11323[1];
      Compiler$compile_function(false, s, "_", body_te, ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), ({_tag: 6, _name: "TUnit"})]}));
      Compiler$compile_function(false, s, ret_name, ret_body, ({_tag: 7, _name: "TArrow", _val: [({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "EffEmpty"}), ({_tag: 6, _name: "TUnit"})]}));
      function _t11326(__p396) {
        let _t11328;
        const _t11327 = __p396;
        _t11329: {
          if (true) {
            const op_name = _t11327[0];
            const arg_name = _t11327[1];
            const k_name = _t11327[2];
            const handler_body = _t11327[3];
            _call(Compiler$emit_constant, [1, 2, 3, 6, s, ({_tag: 3, _name: "VString", _val: op_name})]);
            _t11328 = Compiler$compile_op_handler(s, arg_name, k_name, handler_body);
            break _t11329;
          }
          _match_fail("line 16933");
        }
        return _t11328;
      }
      List$iter(_t11326, op_arms_11318);
      _t11324 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 66, _name: "HANDLE", _val: List$length(op_arms_11318)})]);
      break _t11325;
    }
    _match_fail("line 16933");
  }
  const _t11319 = _t11324;
  const _t11303 = _t11319;
  const _t11301 = _t11303;
  return _t11301;
}
function Compiler$compile_op_handler(s, arg_name, k_name, handler_body) {
  const sub_11330 = Compiler$create_state(({_tag: 1, _name: "Some", _val: s}), 1, s.global_names, s.mutable_globals, s.type_env, "__handler");
  const pair_slot_11332 = _call(Compiler$allocate_local, [7, 9, 12, 15, sub_11330, "__pair"]);
  const arg_slot_11334 = _call(Compiler$allocate_local, [7, 9, 12, 15, sub_11330, arg_name]);
  _call(Compiler$emit, [1, 3, 6, sub_11330, ({_tag: 3, _name: "GET_LOCAL", _val: pair_slot_11332})]);
  _call(Compiler$emit, [1, 3, 6, sub_11330, ({_tag: 49, _name: "TUPLE_GET", _val: 0})]);
  _call(Compiler$emit, [1, 3, 6, sub_11330, ({_tag: 4, _name: "SET_LOCAL", _val: arg_slot_11334})]);
  const k_slot_11336 = _call(Compiler$allocate_local, [7, 9, 12, 15, sub_11330, k_name]);
  _call(Compiler$emit, [1, 3, 6, sub_11330, ({_tag: 3, _name: "GET_LOCAL", _val: pair_slot_11332})]);
  _call(Compiler$emit, [1, 3, 6, sub_11330, ({_tag: 49, _name: "TUPLE_GET", _val: 1})]);
  _call(Compiler$emit, [1, 3, 6, sub_11330, ({_tag: 4, _name: "SET_LOCAL", _val: k_slot_11336})]);
  [arg_slot_11334, k_slot_11336];
  undefined;
  Compiler$compile_expr(true, sub_11330, handler_body);
  _call(Compiler$emit, [1, 3, 6, sub_11330, ({_tag: 44, _name: "RETURN"})]);
  const proto_11338 = Compiler$finalize_proto(sub_11330);
  const proto_idx_11340 = _call(Compiler$add_constant, [2, s, ({_tag: 13, _name: "VProto", _val: proto_11338})]);
  function _t11342(uv) {
    return uv.capture;
  }
  const captures_11343 = List$map(_t11342, sub_11330.upvalues);
  const _t11344 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 40, _name: "CLOSURE", _val: [proto_idx_11340, captures_11343]})]);
  const _t11341 = _t11344;
  const _t11339 = _t11341;
  const _t11337 = _t11339;
  const _t11335 = _t11337;
  const _t11333 = _t11335;
  const _t11331 = _t11333;
  return _t11331;
}
function Compiler$compile_decl(s, decl) {
  let _t11346;
  const _t11345 = decl;
  _t11347: {
    if (((_t11345._tag === 4 || _t11345._tag === 6) || _t11345._tag === 7)) {
      _t11346 = undefined;
      break _t11347;
    }
    if (_t11345._tag === 8) {
      const name = _t11345._val[0];
      _call(Compiler$find_or_add_global, [5, s, name]);
      _t11346 = undefined;
      break _t11347;
    }
    if (_t11345._tag === 0) {
      const name = _t11345._val[0];
      const te = _t11345._val[1];
      Compiler$compile_expr(false, s, te);
      _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
      const gidx_11348 = _call(Compiler$find_or_add_global, [5, s, name]);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11348})]);
      let _t11350;
      if (((String$length(name) > 6) && (String$sub(name, 0, 6) === "__dict"))) {
        function _t11351(inst) {
          return (inst.inst_dict_name === name);
        }
        const inst_opt_11352 = List$find(_t11351, s.type_env.instances);
        let _t11355;
        const _t11354 = inst_opt_11352;
        _t11356: {
          if (_t11354._tag === 1) {
            const inst = _t11354._val;
            if (_eq(inst.inst_constraints, null)) {
              function _t11357(c) {
                return (c.class_name === inst.inst_class);
              }
              const class_opt_11358 = List$find(_t11357, s.type_env.classes);
              let _t11361;
              const _t11360 = class_opt_11358;
              _t11362: {
                if (_t11360._tag === 1) {
                  const class_def = _t11360._val;
                  function _t11363(__p397) {
                    let _t11365;
                    const _t11364 = __p397;
                    _t11366: {
                      if (true) {
                        const method_name = _t11364[0];
                        const mgidx_11367 = _call(Compiler$find_or_add_global, [5, s, (name + ("$" + method_name))]);
                        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_11348})]);
                        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 51, _name: "FIELD", _val: method_name})]);
                        const _t11368 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: mgidx_11367})]);
                        _t11365 = _t11368;
                        break _t11366;
                      }
                      _match_fail("line 16933");
                    }
                    return _t11365;
                  }
                  _t11361 = List$iter(_t11363, class_def.class_methods);
                  break _t11362;
                }
                if (_t11360._tag === 0) {
                  _t11361 = undefined;
                  break _t11362;
                }
                _match_fail("line 16933");
              }
              const _t11359 = _t11361;
              _t11355 = _t11359;
              break _t11356;
            }
          }
          if (true) {
            _t11355 = undefined;
            break _t11356;
          }
          _match_fail("line 16933");
        }
        const _t11353 = _t11355;
        _t11350 = _t11353;
      } else {
        _t11350 = undefined;
      }
      const _t11349 = _t11350;
      _t11346 = _t11349;
      break _t11347;
    }
    if (_t11345._tag === 1) {
      const name = _t11345._val[0];
      const te = _t11345._val[1];
      Compiler$compile_expr(false, s, te);
      _call(Compiler$emit, [1, 3, 6, s, ({_tag: 7, _name: "MAKE_REF"})]);
      _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name, undefined]);
      const gidx_11369 = _call(Compiler$find_or_add_global, [5, s, name]);
      const _t11370 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11369})]);
      _t11346 = _t11370;
      break _t11347;
    }
    if (_t11345._tag === 2) {
      const name = _t11345._val[0];
      const te = _t11345._val[1];
      _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
      const gidx_11371 = _call(Compiler$find_or_add_global, [5, s, name]);
      let _t11374;
      const _t11373 = te.expr;
      _t11375: {
        if (_t11373._tag === 10) {
          _t11374 = true;
          break _t11375;
        }
        if (true) {
          _t11374 = false;
          break _t11375;
        }
        _match_fail("line 16933");
      }
      const is_fun_11376 = _t11374;
      let _t11378;
      if (is_fun_11376) {
        Compiler$compile_expr(false, s, te);
        _t11378 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11371})]);
      } else {
        Compiler$emit_rec_placeholder(s, te);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11371})]);
        Compiler$compile_expr(false, s, te);
        _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx_11371})]);
        _t11378 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 84, _name: "UPDATE_REC"})]);
      }
      const _t11377 = _t11378;
      const _t11372 = _t11377;
      _t11346 = _t11372;
      break _t11347;
    }
    if (_t11345._tag === 3) {
      const bindings = _t11345._val;
      function _t11379(__p398) {
        let _t11381;
        const _t11380 = __p398;
        _t11382: {
          if (true) {
            const name = _t11380[0];
            _t11381 = _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, name]);
            break _t11382;
          }
          _match_fail("line 16933");
        }
        return _t11381;
      }
      List$iter(_t11379, bindings);
      function _t11383(__p399) {
        let _t11385;
        const _t11384 = __p399;
        _t11386: {
          if (true) {
            const name = _t11384[0];
            const te = _t11384[1];
            const gidx_11387 = _call(Compiler$find_or_add_global, [5, s, name]);
            let _t11390;
            const _t11389 = te.expr;
            _t11391: {
              if (_t11389._tag === 10) {
                _t11390 = true;
                break _t11391;
              }
              if (true) {
                _t11390 = false;
                break _t11391;
              }
              _match_fail("line 16933");
            }
            const is_fun_11392 = _t11390;
            let _t11394;
            if ((!is_fun_11392)) {
              Compiler$emit_rec_placeholder(s, te);
              _t11394 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx_11387})]);
            } else {
              _t11394 = undefined;
            }
            _t11394;
            const _t11393 = [name, te, gidx_11387, is_fun_11392];
            const _t11388 = _t11393;
            _t11385 = _t11388;
            break _t11386;
          }
          _match_fail("line 16933");
        }
        return _t11385;
      }
      const binding_info_11395 = List$map(_t11383, bindings);
      function _t11397(__p400) {
        let _t11399;
        const _t11398 = __p400;
        _t11400: {
          if (true) {
            const te = _t11398[1];
            const gidx = _t11398[2];
            const is_fun = _t11398[3];
            Compiler$compile_expr(false, s, te);
            let _t11401;
            if (is_fun) {
              _t11401 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: gidx})]);
            } else {
              _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: gidx})]);
              _t11401 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 84, _name: "UPDATE_REC"})]);
            }
            _t11399 = _t11401;
            break _t11400;
          }
          _match_fail("line 16933");
        }
        return _t11399;
      }
      const _t11396 = List$iter(_t11397, binding_info_11395);
      _t11346 = _t11396;
      break _t11347;
    }
    if (_t11345._tag === 5) {
      const te = _t11345._val;
      Compiler$compile_expr(false, s, te);
      _t11346 = _call(Compiler$emit, [1, 3, 6, s, ({_tag: 1, _name: "POP"})]);
      break _t11347;
    }
    if (_t11345._tag === 9) {
      const _name = _t11345._val[0];
      const inner_decls = _t11345._val[1];
      function _t11402(d) {
        return Compiler$compile_decl(s, d);
      }
      _t11346 = List$iter(_t11402, inner_decls);
      break _t11347;
    }
    if (_t11345._tag === 10) {
      const alias_pairs = _t11345._val;
      function _t11403(__p401) {
        let _t11405;
        const _t11404 = __p401;
        _t11406: {
          if (true) {
            const short_name = _t11404[0];
            const qualified_name = _t11404[1];
            const src_idx_11407 = _call(Compiler$find_or_add_global, [5, s, qualified_name]);
            const dst_idx_11409 = _call(Compiler$find_or_add_global, [5, s, short_name]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 10, _name: "GET_GLOBAL", _val: src_idx_11407})]);
            _call(Compiler$emit, [1, 3, 6, s, ({_tag: 12, _name: "DEF_GLOBAL", _val: dst_idx_11409})]);
            let _t11411;
            if (Compiler$is_mutable_global(s, qualified_name)) {
              _t11411 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, short_name, undefined]);
            } else {
              _t11411 = _call(Hashtbl$remove, [__dict_Hash_string, __dict_Eq_string, s.mutable_globals, short_name]);
            }
            const _t11410 = _t11411;
            const _t11408 = _t11410;
            _t11405 = _t11408;
            break _t11406;
          }
          _match_fail("line 16933");
        }
        return _t11405;
      }
      _t11346 = List$iter(_t11403, alias_pairs);
      break _t11347;
    }
    _match_fail("line 16933");
  }
  return _t11346;
}
function Compiler$compile_decl_last(s, decl) {
  let _t11413;
  const _t11412 = decl;
  _t11414: {
    if (_t11412._tag === 5) {
      const te = _t11412._val;
      _t11413 = Compiler$compile_expr(false, s, te);
      break _t11414;
    }
    if (true) {
      _t11413 = Compiler$compile_decl(s, decl);
      break _t11414;
    }
    _match_fail("line 16933");
  }
  return _t11413;
}
function Compiler$compile_program_with_globals(type_env, global_names, mutable_globals, program) {
  const s_11415 = Compiler$create_state(({_tag: 0, _name: "None"}), 0, global_names, mutable_globals, type_env, "<main>");
  function compile_all(__x) {
    while (true) {
      let _t11418;
      const _t11417 = __x;
      _t11419: {
        if (_t11417 === null) {
          _t11418 = undefined;
          break _t11419;
        }
        if (_t11417 !== null && _t11417._tl === null) {
          const last = _t11417._hd;
          _t11418 = Compiler$compile_decl_last(s_11415, last);
          break _t11419;
        }
        if (_t11417 !== null) {
          const decl = _t11417._hd;
          const rest = _t11417._tl;
          Compiler$compile_decl(s_11415, decl);
          const _t11420 = rest;
          __x = _t11420;
          continue;
          _t11418 = undefined;
          break _t11419;
        }
        _match_fail("line 16933");
      }
      return _t11418;
    }
  }
  compile_all(program);
  _call(Compiler$emit, [1, 3, 6, s_11415, ({_tag: 75, _name: "HALT"})]);
  const main_11422 = Compiler$finalize_proto(s_11415);
  let _t11424;
  if (Ref$get(Compiler$optimize_enabled)) {
    _t11424 = Optimize$optimize_proto(main_11422);
  } else {
    _t11424 = main_11422;
  }
  const main_11425 = _t11424;
  const gn_11427 = Dynarray$to_array(global_names);
  const _t11428 = ({global_names: gn_11427, main: main_11425});
  const _t11426 = _t11428;
  const _t11423 = _t11426;
  const _t11421 = _t11423;
  const _t11416 = _t11421;
  return _t11416;
}
function Compiler$compile_program(type_env, program) {
  return Compiler$compile_program_with_globals(type_env, Dynarray$empty(undefined), Hashtbl$create(8), program);
}
function Serialize$json_escape_string(s) {
  const buf_11429 = Buffer$create((String$length(s) + 8));
  Buffer$add_byte(buf_11429, 34);
  function _t11431(c) {
    let _t11433;
    const _t11432 = c;
    _t11434: {
      if (true) {
        const _c = _t11432;
        if ((_c === 34)) {
          _t11433 = Buffer$add_string(buf_11429, "\\\"");
          break _t11434;
        }
      }
      if (true) {
        const _c = _t11432;
        if ((_c === 92)) {
          _t11433 = Buffer$add_string(buf_11429, "\\\\");
          break _t11434;
        }
      }
      if (true) {
        const _c = _t11432;
        if ((_c === 10)) {
          _t11433 = Buffer$add_string(buf_11429, "\\n");
          break _t11434;
        }
      }
      if (true) {
        const _c = _t11432;
        if ((_c === 13)) {
          _t11433 = Buffer$add_string(buf_11429, "\\r");
          break _t11434;
        }
      }
      if (true) {
        const _c = _t11432;
        if ((_c === 9)) {
          _t11433 = Buffer$add_string(buf_11429, "\\t");
          break _t11434;
        }
      }
      if (true) {
        const c = _t11432;
        if ((Byte$to_int(c) < 32)) {
          _t11433 = Buffer$add_string(buf_11429, ("\\u" + __fmt_zero_pad(4, __fmt_hex(Byte$to_int(c)))));
          break _t11434;
        }
      }
      if (true) {
        const c = _t11432;
        _t11433 = Buffer$add_byte(buf_11429, c);
        break _t11434;
      }
      _match_fail("line 16933");
    }
    return _t11433;
  }
  String$iter(_t11431, s);
  Buffer$add_byte(buf_11429, 34);
  const _t11430 = Buffer$contents(buf_11429);
  return _t11430;
}
function Serialize$serialize_capture(__x) {
  let _t11436;
  const _t11435 = __x;
  _t11437: {
    if (_t11435._tag === 0) {
      const i = _t11435._val;
      _t11436 = (("[\"local\"," + __dict_Show_int.show(i)) + "]");
      break _t11437;
    }
    if (_t11435._tag === 1) {
      const i = _t11435._val;
      _t11436 = (("[\"upvalue\"," + __dict_Show_int.show(i)) + "]");
      break _t11437;
    }
    _match_fail("line 16933");
  }
  return _t11436;
}
function Serialize$serialize_captures(caps) {
  return ("[" + (String$concat(",", List$map(Serialize$serialize_capture, caps)) + "]"));
}
function Serialize$serialize_opcode(__x) {
  let _t11439;
  const _t11438 = __x;
  _t11440: {
    if (_t11438._tag === 0) {
      const i = _t11438._val;
      _t11439 = (("[\"CONST\"," + __dict_Show_int.show(i)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 1) {
      _t11439 = "[\"POP\"]";
      break _t11440;
    }
    if (_t11438._tag === 2) {
      _t11439 = "[\"DUP\"]";
      break _t11440;
    }
    if (_t11438._tag === 3) {
      const i = _t11438._val;
      _t11439 = (("[\"GET_LOCAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 4) {
      const i = _t11438._val;
      _t11439 = (("[\"SET_LOCAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 5) {
      const i = _t11438._val;
      _t11439 = (("[\"GET_UPVALUE\"," + __dict_Show_int.show(i)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 6) {
      const i = _t11438._val;
      _t11439 = (("[\"SET_UPVALUE\"," + __dict_Show_int.show(i)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 7) {
      _t11439 = "[\"MAKE_REF\"]";
      break _t11440;
    }
    if (_t11438._tag === 8) {
      _t11439 = "[\"DEREF\"]";
      break _t11440;
    }
    if (_t11438._tag === 9) {
      _t11439 = "[\"SET_REF\"]";
      break _t11440;
    }
    if (_t11438._tag === 10) {
      const i = _t11438._val;
      _t11439 = (("[\"GET_GLOBAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 11) {
      const i = _t11438._val;
      _t11439 = (("[\"SET_GLOBAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 12) {
      const i = _t11438._val;
      _t11439 = (("[\"DEF_GLOBAL\"," + __dict_Show_int.show(i)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 13) {
      _t11439 = "[\"ADD\"]";
      break _t11440;
    }
    if (_t11438._tag === 14) {
      _t11439 = "[\"SUB\"]";
      break _t11440;
    }
    if (_t11438._tag === 15) {
      _t11439 = "[\"MUL\"]";
      break _t11440;
    }
    if (_t11438._tag === 16) {
      _t11439 = "[\"DIV\"]";
      break _t11440;
    }
    if (_t11438._tag === 17) {
      _t11439 = "[\"MOD\"]";
      break _t11440;
    }
    if (_t11438._tag === 18) {
      _t11439 = "[\"NEG\"]";
      break _t11440;
    }
    if (_t11438._tag === 19) {
      _t11439 = "[\"FADD\"]";
      break _t11440;
    }
    if (_t11438._tag === 20) {
      _t11439 = "[\"FSUB\"]";
      break _t11440;
    }
    if (_t11438._tag === 21) {
      _t11439 = "[\"FMUL\"]";
      break _t11440;
    }
    if (_t11438._tag === 22) {
      _t11439 = "[\"FDIV\"]";
      break _t11440;
    }
    if (_t11438._tag === 23) {
      _t11439 = "[\"FNEG\"]";
      break _t11440;
    }
    if (_t11438._tag === 24) {
      _t11439 = "[\"EQ\"]";
      break _t11440;
    }
    if (_t11438._tag === 25) {
      _t11439 = "[\"NEQ\"]";
      break _t11440;
    }
    if (_t11438._tag === 26) {
      _t11439 = "[\"LT\"]";
      break _t11440;
    }
    if (_t11438._tag === 27) {
      _t11439 = "[\"GT\"]";
      break _t11440;
    }
    if (_t11438._tag === 28) {
      _t11439 = "[\"LE\"]";
      break _t11440;
    }
    if (_t11438._tag === 29) {
      _t11439 = "[\"GE\"]";
      break _t11440;
    }
    if (_t11438._tag === 30) {
      _t11439 = "[\"NOT\"]";
      break _t11440;
    }
    if (_t11438._tag === 31) {
      _t11439 = "[\"BAND\"]";
      break _t11440;
    }
    if (_t11438._tag === 32) {
      _t11439 = "[\"BOR\"]";
      break _t11440;
    }
    if (_t11438._tag === 33) {
      _t11439 = "[\"BXOR\"]";
      break _t11440;
    }
    if (_t11438._tag === 34) {
      _t11439 = "[\"BNOT\"]";
      break _t11440;
    }
    if (_t11438._tag === 35) {
      _t11439 = "[\"BSHL\"]";
      break _t11440;
    }
    if (_t11438._tag === 36) {
      _t11439 = "[\"BSHR\"]";
      break _t11440;
    }
    if (_t11438._tag === 37) {
      const off = _t11438._val;
      _t11439 = (("[\"JUMP\"," + __dict_Show_int.show(off)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 38) {
      const off = _t11438._val;
      _t11439 = (("[\"JUMP_IF_FALSE\"," + __dict_Show_int.show(off)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 39) {
      const off = _t11438._val;
      _t11439 = (("[\"JUMP_IF_TRUE\"," + __dict_Show_int.show(off)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 40) {
      const i = _t11438._val[0];
      const caps = _t11438._val[1];
      _t11439 = (((("[\"CLOSURE\"," + __dict_Show_int.show(i)) + ",") + __dict_Show_string.show(Serialize$serialize_captures(caps))) + "]");
      break _t11440;
    }
    if (_t11438._tag === 41) {
      const i = _t11438._val[0];
      const caps = _t11438._val[1];
      const self = _t11438._val[2];
      _t11439 = (((((("[\"CLOSURE_REC\"," + __dict_Show_int.show(i)) + ",") + __dict_Show_string.show(Serialize$serialize_captures(caps))) + ",") + __dict_Show_int.show(self)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 42) {
      const n = _t11438._val;
      _t11439 = (("[\"CALL\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 43) {
      const n = _t11438._val;
      _t11439 = (("[\"TAIL_CALL\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 44) {
      _t11439 = "[\"RETURN\"]";
      break _t11440;
    }
    if (_t11438._tag === 45) {
      _t11439 = "[\"FUNC_RETURN\"]";
      break _t11440;
    }
    if (_t11438._tag === 46) {
      _t11439 = "[\"ENTER_FUNC\"]";
      break _t11440;
    }
    if (_t11438._tag === 47) {
      _t11439 = "[\"EXIT_FUNC\"]";
      break _t11440;
    }
    if (_t11438._tag === 48) {
      const n = _t11438._val;
      _t11439 = (("[\"MAKE_TUPLE\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 49) {
      const i = _t11438._val;
      _t11439 = (("[\"TUPLE_GET\"," + __dict_Show_int.show(i)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 50) {
      const fields = _t11438._val;
      _t11439 = (("[\"MAKE_RECORD\",[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$json_escape_string, fields)))) + "]]");
      break _t11440;
    }
    if (_t11438._tag === 51) {
      const name = _t11438._val;
      _t11439 = (("[\"FIELD\"," + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t11440;
    }
    if (_t11438._tag === 52) {
      const name = _t11438._val;
      _t11439 = (("[\"SET_FIELD\"," + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t11440;
    }
    if (_t11438._tag === 53) {
      const fields = _t11438._val;
      _t11439 = (("[\"RECORD_UPDATE\",[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$json_escape_string, fields)))) + "]]");
      break _t11440;
    }
    if (_t11438._tag === 54) {
      const n = _t11438._val;
      _t11439 = (("[\"RECORD_UPDATE_DYN\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 55) {
      const tag = _t11438._val[0];
      const name = _t11438._val[1];
      const has_payload = _t11438._val[2];
      _t11439 = (((((("[\"MAKE_VARIANT\"," + __dict_Show_int.show(tag)) + ",") + __dict_Show_string.show(Serialize$json_escape_string(name))) + ",") + __dict_Show_bool.show(has_payload)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 56) {
      _t11439 = "[\"CONS\"]";
      break _t11440;
    }
    if (_t11438._tag === 57) {
      _t11439 = "[\"NIL\"]";
      break _t11440;
    }
    if (_t11438._tag === 58) {
      const tag = _t11438._val;
      _t11439 = (("[\"TAG_EQ\"," + __dict_Show_int.show(tag)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 59) {
      _t11439 = "[\"IS_NIL\"]";
      break _t11440;
    }
    if (_t11438._tag === 60) {
      _t11439 = "[\"IS_CONS\"]";
      break _t11440;
    }
    if (_t11438._tag === 61) {
      _t11439 = "[\"HEAD\"]";
      break _t11440;
    }
    if (_t11438._tag === 62) {
      _t11439 = "[\"TAIL\"]";
      break _t11440;
    }
    if (_t11438._tag === 63) {
      _t11439 = "[\"VARIANT_PAYLOAD\"]";
      break _t11440;
    }
    if (_t11438._tag === 64) {
      const loc = _t11438._val;
      _t11439 = (("[\"MATCH_FAIL\"," + __dict_Show_string.show(Serialize$json_escape_string(loc))) + "]");
      break _t11440;
    }
    if (_t11438._tag === 65) {
      const op = _t11438._val;
      _t11439 = (("[\"PERFORM\"," + __dict_Show_string.show(Serialize$json_escape_string(op))) + "]");
      break _t11440;
    }
    if (_t11438._tag === 66) {
      const n = _t11438._val;
      _t11439 = (("[\"HANDLE\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 67) {
      _t11439 = "[\"RESUME\"]";
      break _t11440;
    }
    if (_t11438._tag === 68) {
      const n = _t11438._val;
      _t11439 = (("[\"ENTER_LOOP\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 69) {
      _t11439 = "[\"EXIT_LOOP\"]";
      break _t11440;
    }
    if (_t11438._tag === 70) {
      _t11439 = "[\"LOOP_BREAK\"]";
      break _t11440;
    }
    if (_t11438._tag === 71) {
      const n = _t11438._val;
      _t11439 = (("[\"LOOP_CONTINUE\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 72) {
      const n = _t11438._val;
      _t11439 = (("[\"FOLD_CONTINUE\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 73) {
      const n = _t11438._val;
      _t11439 = (("[\"MAKE_ARRAY\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 74) {
      _t11439 = "[\"INDEX\"]";
      break _t11440;
    }
    if (_t11438._tag === 75) {
      _t11439 = "[\"HALT\"]";
      break _t11440;
    }
    if (_t11438._tag === 76) {
      const slot = _t11438._val[0];
      const arity = _t11438._val[1];
      _t11439 = (((("[\"GET_LOCAL_CALL\"," + __dict_Show_int.show(slot)) + ",") + __dict_Show_int.show(arity)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 77) {
      const slot = _t11438._val[0];
      const idx = _t11438._val[1];
      _t11439 = (((("[\"GET_LOCAL_TUPLE_GET\"," + __dict_Show_int.show(slot)) + ",") + __dict_Show_int.show(idx)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 78) {
      const slot = _t11438._val[0];
      const name = _t11438._val[1];
      _t11439 = (((("[\"GET_LOCAL_FIELD\"," + __dict_Show_int.show(slot)) + ",") + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t11440;
    }
    if (_t11438._tag === 79) {
      const idx = _t11438._val[0];
      const arity = _t11438._val[1];
      _t11439 = (((("[\"GET_GLOBAL_CALL\"," + __dict_Show_int.show(idx)) + ",") + __dict_Show_int.show(arity)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 80) {
      const idx = _t11438._val[0];
      const name = _t11438._val[1];
      _t11439 = (((("[\"GET_GLOBAL_FIELD\"," + __dict_Show_int.show(idx)) + ",") + __dict_Show_string.show(Serialize$json_escape_string(name))) + "]");
      break _t11440;
    }
    if (_t11438._tag === 81) {
      const min_tag = _t11438._val[0];
      const targets = _t11438._val[1];
      const _mml$default = _t11438._val[2];
      _t11439 = (((((("[\"JUMP_TABLE\"," + __dict_Show_int.show(min_tag)) + ",[") + __dict_Show_string.show(String$concat(",", Array$to_list(Array$map(string_of_int, targets))))) + "],") + __dict_Show_int.show(_mml$default)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 82) {
      const n = _t11438._val;
      _t11439 = (("[\"CALL_N\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 83) {
      const n = _t11438._val;
      _t11439 = (("[\"TAIL_CALL_N\"," + __dict_Show_int.show(n)) + "]");
      break _t11440;
    }
    if (_t11438._tag === 84) {
      _t11439 = "[\"UPDATE_REC\"]";
      break _t11440;
    }
    _match_fail("line 16933");
  }
  return _t11439;
}
function Serialize$serialize_value(__x) {
  let _t11442;
  const _t11441 = __x;
  _t11443: {
    if (_t11441._tag === 0) {
      const n = _t11441._val;
      _t11442 = (("{\"t\":\"i\",\"v\":" + __dict_Show_int.show(n)) + "}");
      break _t11443;
    }
    if (_t11441._tag === 1) {
      const f = _t11441._val;
      const s_11444 = __dict_Show_float.show(f);
      const len_11446 = String$length(s_11444);
      let _t11448;
      if (((len_11446 > 0) && (String$get(s_11444, (len_11446 - 1)) === 46))) {
        _t11448 = String$sub(s_11444, 0, (len_11446 - 1));
      } else {
        _t11448 = s_11444;
      }
      const s_11449 = _t11448;
      const _t11450 = (("{\"t\":\"f\",\"v\":" + __dict_Show_string.show(s_11449)) + "}");
      const _t11447 = _t11450;
      const _t11445 = _t11447;
      _t11442 = _t11445;
      break _t11443;
    }
    if (_t11441._tag === 2) {
      const b = _t11441._val;
      _t11442 = (("{\"t\":\"b\",\"v\":" + __dict_Show_bool.show(b)) + "}");
      break _t11443;
    }
    if (_t11441._tag === 3) {
      const s = _t11441._val;
      _t11442 = (("{\"t\":\"s\",\"v\":" + __dict_Show_string.show(Serialize$json_escape_string(s))) + "}");
      break _t11443;
    }
    if (_t11441._tag === 4) {
      const n = _t11441._val;
      _t11442 = (("{\"t\":\"y\",\"v\":" + __dict_Show_int.show(n)) + "}");
      break _t11443;
    }
    if (_t11441._tag === 5) {
      const n = _t11441._val;
      _t11442 = (("{\"t\":\"r\",\"v\":" + __dict_Show_int.show(n)) + "}");
      break _t11443;
    }
    if (_t11441._tag === 6) {
      _t11442 = "{\"t\":\"u\"}";
      break _t11443;
    }
    if (_t11441._tag === 13) {
      const p = _t11441._val;
      _t11442 = (("{\"t\":\"p\",\"v\":" + __dict_Show_string.show(Serialize$serialize_prototype(p))) + "}");
      break _t11443;
    }
    if (_t11441._tag === 7) {
      const vs = _t11441._val;
      _t11442 = (("{\"t\":\"T\",\"v\":[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$serialize_value, Array$to_list(vs))))) + "]}");
      break _t11443;
    }
    if (_t11441._tag === 8) {
      const vs = _t11441._val;
      _t11442 = (("{\"t\":\"L\",\"v\":[" + __dict_Show_string.show(String$concat(",", List$map(Serialize$serialize_value, vs)))) + "]}");
      break _t11443;
    }
    if (_t11441._tag === 10) {
      const tag = _t11441._val[0];
      const name = _t11441._val[1];
      const payload = _t11441._val[2];
      let _t11452;
      const _t11451 = payload;
      _t11453: {
        if (_t11451._tag === 0) {
          _t11452 = "null";
          break _t11453;
        }
        if (_t11451._tag === 1) {
          const v = _t11451._val;
          _t11452 = Serialize$serialize_value(v);
          break _t11453;
        }
        _match_fail("line 16933");
      }
      const payload_str_11454 = _t11452;
      const _t11455 = (((((("{\"t\":\"V\",\"tag\":" + __dict_Show_int.show(tag)) + ",\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(name))) + ",\"payload\":") + __dict_Show_string.show(payload_str_11454)) + "}");
      _t11442 = _t11455;
      break _t11443;
    }
    if (true) {
      _t11442 = failwith("serialize_value: unsupported value type in constants");
      break _t11443;
    }
    _match_fail("line 16933");
  }
  return _t11442;
}
function Serialize$serialize_prototype(proto) {
  const code_strs_11456 = Array$to_list(Array$map(Serialize$serialize_opcode, proto.code));
  const const_strs_11458 = Array$to_list(Array$map(Serialize$serialize_value, proto.constants));
  const line_strs_11460 = Array$to_list(Array$map(string_of_int, proto.line_table));
  const _t11461 = (((((((((((("{\"name\":" + __dict_Show_string.show(Serialize$json_escape_string(proto.name))) + ",\"arity\":") + __dict_Show_int.show(proto.arity)) + ",\"num_locals\":") + __dict_Show_int.show(proto.num_locals)) + ",\"code\":[") + __dict_Show_string.show(String$concat(",", code_strs_11456))) + "],\"constants\":[") + __dict_Show_string.show(String$concat(",", const_strs_11458))) + "],\"line_table\":[") + __dict_Show_string.show(String$concat(",", line_strs_11460))) + "]}");
  const _t11459 = _t11461;
  const _t11457 = _t11459;
  return _t11457;
}
function Serialize$serialize_native_global(idx, value) {
  let _t11463;
  const _t11462 = value;
  _t11464: {
    if (_t11462._tag === 14) {
      const ext = _t11462._val;
      _t11463 = ({_tag: 1, _name: "Some", _val: (((((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"external\",\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(ext.ext_name))) + ",\"arity\":") + __dict_Show_int.show(ext.ext_arity)) + "}")});
      break _t11464;
    }
    if (_t11462._tag === 9) {
      const shape = _t11462._val[0];
      const values = _t11462._val[1];
      function _t11465(v) {
        let _t11467;
        const _t11466 = v;
        _t11468: {
          if (_t11466._tag === 14) {
            _t11467 = true;
            break _t11468;
          }
          if (true) {
            _t11467 = false;
            break _t11468;
          }
          _match_fail("line 16933");
        }
        return _t11467;
      }
      const all_external_11469 = Array$forall(_t11465, values);
      let _t11471;
      if ((all_external_11469 && (Array$length(values) > 0))) {
        function _t11472(i) {
          const name_11473 = Array$get(shape.rs_fields, i);
          let _t11476;
          const _t11475 = Array$get(values, i);
          _t11477: {
            if (_t11475._tag === 14) {
              const ext = _t11475._val;
              _t11476 = (((((__dict_Show_string.show(Serialize$json_escape_string(name_11473)) + ":{\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(ext.ext_name))) + ",\"arity\":") + __dict_Show_int.show(ext.ext_arity)) + "}");
              break _t11477;
            }
            if (true) {
              _t11476 = failwith("assert false");
              break _t11477;
            }
            _match_fail("line 16933");
          }
          const _t11474 = _t11476;
          return _t11474;
        }
        const field_strs_11478 = List$init(Array$length(shape.rs_fields), _t11472);
        const _t11479 = ({_tag: 1, _name: "Some", _val: (((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"dict\",\"fields\":{") + __dict_Show_string.show(String$concat(",", field_strs_11478))) + "}}")});
        _t11471 = _t11479;
      } else {
        _t11471 = ({_tag: 0, _name: "None"});
      }
      const _t11470 = _t11471;
      _t11463 = _t11470;
      break _t11464;
    }
    if (true) {
      _t11463 = ({_tag: 0, _name: "None"});
      break _t11464;
    }
    _match_fail("line 16933");
  }
  return _t11463;
}
function Serialize$serialize_native_ext(__dict_Show_0, idx, name, arity) {
  return (((((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"external\",\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(name))) + ",\"arity\":") + __dict_Show_0.show(arity)) + "}");
}
function Serialize$serialize_native_dict(__dict_Show_0, idx, fields) {
  function _t11480(__p402) {
    let _t11482;
    const _t11481 = __p402;
    _t11483: {
      if (true) {
        const name = _t11481[0];
        const ext_name = _t11481[1];
        const arity = _t11481[2];
        _t11482 = (((((__dict_Show_string.show(Serialize$json_escape_string(name)) + ":{\"name\":") + __dict_Show_string.show(Serialize$json_escape_string(ext_name))) + ",\"arity\":") + __dict_Show_0.show(arity)) + "}");
        break _t11483;
      }
      _match_fail("line 16933");
    }
    return _t11482;
  }
  const field_strs_11484 = List$map(_t11480, fields);
  const _t11485 = (((__dict_Show_string.show(Serialize$json_escape_string(string_of_int(idx))) + ":{\"type\":\"dict\",\"fields\":{") + __dict_Show_string.show(String$concat(",", field_strs_11484))) + "}}");
  return _t11485;
}
function Serialize$build_native_globals_json(globals) {
  const parts_11486 = Ref$create(null);
  function _t11488(idx, value) {
    let _t11490;
    const _t11489 = Serialize$serialize_native_global(idx, value);
    _t11491: {
      if (_t11489._tag === 1) {
        const s = _t11489._val;
        _t11490 = Ref$set(parts_11486, ({_hd: s, _tl: Ref$get(parts_11486)}));
        break _t11491;
      }
      if (_t11489._tag === 0) {
        _t11490 = undefined;
        break _t11491;
      }
      _match_fail("line 16933");
    }
    return _t11490;
  }
  Hashtbl$iter(_t11488, globals);
  const _t11487 = String$concat(",", Ref$get(parts_11486));
  return _t11487;
}
function Serialize$serialize_bundle(global_names, native_globals_json, setup_protos, main_proto) {
  const buf_11492 = Buffer$create(4096);
  Buffer$add_string(buf_11492, "{\"version\":1");
  const names_11494 = Dynarray$to_array(global_names);
  Buffer$add_string(buf_11492, ",\"global_names\":[");
  function _t11496(i, name) {
    let _t11497;
    if ((i > 0)) {
      _t11497 = Buffer$add_byte(buf_11492, 44);
    } else {
      _t11497 = undefined;
    }
    _t11497;
    return Buffer$add_string(buf_11492, Serialize$json_escape_string(name));
  }
  Array$iteri(_t11496, names_11494);
  Buffer$add_string(buf_11492, "]");
  Buffer$add_string(buf_11492, ",\"native_globals\":{");
  Buffer$add_string(buf_11492, native_globals_json);
  Buffer$add_string(buf_11492, "}");
  Buffer$add_string(buf_11492, ",\"setup\":[");
  function _t11498(i, proto) {
    let _t11499;
    if ((i > 0)) {
      _t11499 = Buffer$add_byte(buf_11492, 44);
    } else {
      _t11499 = undefined;
    }
    _t11499;
    return Buffer$add_string(buf_11492, Serialize$serialize_prototype(proto));
  }
  List$iteri(_t11498, setup_protos);
  Buffer$add_string(buf_11492, "]");
  Buffer$add_string(buf_11492, ",\"main\":");
  Buffer$add_string(buf_11492, Serialize$serialize_prototype(main_proto));
  Buffer$add_string(buf_11492, "}");
  const _t11495 = Buffer$contents(buf_11492);
  const _t11493 = _t11495;
  return _t11493;
}
function Js_codegen$error(msg) {
  return _trampoline(function() {
    return _h["codegen_error"](msg, function(_t11500) {
      return _bounce(function() {
        return _t11500;
      });
    });
  }, Js_codegen$error);
}
const Js_codegen$js_runtime = "\"use strict\";\nfunction _call(f, args) {\n  while (args.length > 0) {\n    const a = f._arity !== undefined ? f._arity : f.length;\n    if (a === 0) { f = f(); continue; }\n    if (args.length < a) return _partial(f, a, args);\n    const taken = args.splice(0, a);\n    f = f.apply(null, taken);\n  }\n  return f;\n}\nfunction _partial(fn, arity, args) {\n  const p = function() {\n    return _call(fn, args.concat(Array.from(arguments)));\n  };\n  p._arity = arity - args.length;\n  return p;\n}\nfunction _eq(a, b) {\n  if (a === b) return true;\n  if (a == null || b == null) return a === b;\n  if (typeof a !== \"object\") return false;\n  if (Array.isArray(a)) {\n    if (!Array.isArray(b) || a.length !== b.length) return false;\n    for (let i = 0; i < a.length; i++) if (!_eq(a[i], b[i])) return false;\n    return true;\n  }\n  if (\"_arr\" in a && \"_arr\" in b) {\n    if (a._arr.length !== b._arr.length) return false;\n    for (let i = 0; i < a._arr.length; i++) if (!_eq(a._arr[i], b._arr[i])) return false;\n    return true;\n  }\n  if (\"_hd\" in a && \"_hd\" in b) {\n    let ca = a, cb = b;\n    while (ca !== null && cb !== null) {\n      if (!(\"_hd\" in ca) || !(\"_hd\" in cb)) return ca === cb;\n      if (!_eq(ca._hd, cb._hd)) return false;\n      ca = ca._tl; cb = cb._tl;\n    }\n    return ca === cb;\n  }\n  if (\"_tag\" in a) return a._tag === b._tag && _eq(a._val, b._val);\n  if (\"_ref\" in a) return _eq(a._ref, b._ref);\n  const ka = Object.keys(a), kb = Object.keys(b);\n  if (ka.length !== kb.length) return false;\n  for (const k of ka) if (!_eq(a[k], b[k])) return false;\n  return true;\n}\nfunction _compare(a, b) {\n  if (a < b) return -1;\n  if (a > b) return 1;\n  return 0;\n}\nfunction _match_fail(loc) { throw new Error(\"Match failure at \" + loc); }\nfunction _pp(v) {\n  if (v === undefined) return \"()\";\n  if (v === null) return \"[]\";\n  if (typeof v === \"number\") {\n    if (!Number.isInteger(v)) {\n      const s = String(v);\n      return s.includes(\".\") || s.includes(\"e\") ? s : s + \".\";\n    }\n    return String(v);\n  }\n  if (typeof v === \"boolean\") return String(v);\n  if (typeof v === \"string\") return v;\n  if (Array.isArray(v)) return \"(\" + v.map(_pp).join(\", \") + \")\";\n  if (v !== null && typeof v === \"object\") {\n    if (\"_arr\" in v) return \"#[\" + v._arr.map(_pp).join(\"; \") + \"]\";\n    if (\"_hd\" in v) {\n      const r = [];\n      let c = v;\n      while (c !== null && typeof c === \"object\" && \"_hd\" in c) { r.push(_pp(c._hd)); c = c._tl; }\n      return \"[\" + r.join(\"; \") + \"]\";\n    }\n    if (\"_tag\" in v) {\n      if (v._val !== undefined) {\n        const pv = _pp(v._val);\n        if (Array.isArray(v._val) || (typeof v._val === \"object\" && v._val !== null && \"_tag\" in v._val && v._val._val !== undefined))\n          return v._name + \" (\" + pv + \")\";\n        return v._name + \" \" + pv;\n      }\n      return v._name;\n    }\n    if (\"_ref\" in v) return \"ref(\" + _pp(v._ref) + \")\";\n    return \"{ \" + Object.entries(v).map(([k,val]) => k + \" = \" + _pp(val)).join(\"; \") + \" }\";\n  }\n  return String(v);\n}\nfunction _throw_break(v) { throw {_tag: \"_break\", _val: v}; }\nfunction _throw_fold_cont(v) { throw {_tag: \"_fold_cont\", _val: v}; }\nfunction _throw_return(v) { throw {_tag: \"_return\", _val: v}; }\nlet _h = {};\nfunction _bounce(fn) { fn._tramp = true; return fn; }\nconst _trampolining = new Set();\nfunction _trampoline(fn, tag) {\n  if (tag !== undefined && _trampolining.has(tag)) return fn();\n  if (tag !== undefined) _trampolining.add(tag);\n  try {\n    let result = fn();\n    while (typeof result === 'function' && result._tramp) {\n      result = result();\n    }\n    return result;\n  } finally { if (tag !== undefined) _trampolining.delete(tag); }\n}\nfunction _resolve(v) { while (typeof v === 'function' && v._tramp) v = v(); return v; }\n";
const Js_codegen$js_reserved = ({_hd: "abstract", _tl: ({_hd: "arguments", _tl: ({_hd: "await", _tl: ({_hd: "boolean", _tl: ({_hd: "break", _tl: ({_hd: "byte", _tl: ({_hd: "case", _tl: ({_hd: "catch", _tl: ({_hd: "char", _tl: ({_hd: "class", _tl: ({_hd: "const", _tl: ({_hd: "continue", _tl: ({_hd: "debugger", _tl: ({_hd: "default", _tl: ({_hd: "delete", _tl: ({_hd: "do", _tl: ({_hd: "double", _tl: ({_hd: "else", _tl: ({_hd: "enum", _tl: ({_hd: "eval", _tl: ({_hd: "export", _tl: ({_hd: "extends", _tl: ({_hd: "false", _tl: ({_hd: "final", _tl: ({_hd: "finally", _tl: ({_hd: "float", _tl: ({_hd: "for", _tl: ({_hd: "function", _tl: ({_hd: "goto", _tl: ({_hd: "if", _tl: ({_hd: "implements", _tl: ({_hd: "import", _tl: ({_hd: "in", _tl: ({_hd: "instanceof", _tl: ({_hd: "int", _tl: ({_hd: "interface", _tl: ({_hd: "let", _tl: ({_hd: "long", _tl: ({_hd: "native", _tl: ({_hd: "new", _tl: ({_hd: "null", _tl: ({_hd: "package", _tl: ({_hd: "private", _tl: ({_hd: "protected", _tl: ({_hd: "public", _tl: ({_hd: "return", _tl: ({_hd: "short", _tl: ({_hd: "static", _tl: ({_hd: "super", _tl: ({_hd: "switch", _tl: ({_hd: "synchronized", _tl: ({_hd: "this", _tl: ({_hd: "throw", _tl: ({_hd: "throws", _tl: ({_hd: "transient", _tl: ({_hd: "true", _tl: ({_hd: "try", _tl: ({_hd: "typeof", _tl: ({_hd: "undefined", _tl: ({_hd: "var", _tl: ({_hd: "void", _tl: ({_hd: "volatile", _tl: ({_hd: "while", _tl: ({_hd: "with", _tl: ({_hd: "yield", _tl: ({_hd: "of", _tl: null})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})})});
function Js_codegen$is_js_reserved(name) {
  return List$mem(name, Js_codegen$js_reserved);
}
function Js_codegen$mangle_name(name) {
  const buf_11501 = Buffer$create(String$length(name));
  function _t11503(c) {
    let _t11505;
    const _t11504 = c;
    _t11506: {
      if (true) {
        const _c = _t11504;
        if ((_c === 46)) {
          _t11505 = Buffer$add_byte(buf_11501, 36);
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 39)) {
          _t11505 = Buffer$add_string(buf_11501, "$p");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 43)) {
          _t11505 = Buffer$add_string(buf_11501, "$plus");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 45)) {
          _t11505 = Buffer$add_string(buf_11501, "$minus");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 42)) {
          _t11505 = Buffer$add_string(buf_11501, "$star");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 47)) {
          _t11505 = Buffer$add_string(buf_11501, "$slash");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 94)) {
          _t11505 = Buffer$add_string(buf_11501, "$caret");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 61)) {
          _t11505 = Buffer$add_string(buf_11501, "$eq");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 60)) {
          _t11505 = Buffer$add_string(buf_11501, "$lt");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 62)) {
          _t11505 = Buffer$add_string(buf_11501, "$gt");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 33)) {
          _t11505 = Buffer$add_string(buf_11501, "$bang");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 58)) {
          _t11505 = Buffer$add_string(buf_11501, "$colon");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 126)) {
          _t11505 = Buffer$add_string(buf_11501, "$tilde");
          break _t11506;
        }
      }
      if (true) {
        const _c = _t11504;
        if ((_c === 35)) {
          _t11505 = Buffer$add_string(buf_11501, "$hash");
          break _t11506;
        }
      }
      if (true) {
        const c = _t11504;
        _t11505 = Buffer$add_byte(buf_11501, c);
        break _t11506;
      }
      _match_fail("line 16933");
    }
    return _t11505;
  }
  String$iter(_t11503, name);
  const result_11507 = Buffer$contents(buf_11501);
  let _t11509;
  if (Js_codegen$is_js_reserved(result_11507)) {
    _t11509 = ("_mml$" + result_11507);
  } else {
    _t11509 = result_11507;
  }
  const _t11508 = _t11509;
  const _t11502 = _t11508;
  return _t11502;
}
function Js_codegen$create_ctx(type_env) {
  const tbl_11510 = Hashtbl$create(16);
  const _t11511 = ({break_flag_name: "_break_flag", break_val_name: "_break_val", buf: Buffer$create(4096), current_fn_name: ({_tag: 0, _name: "None"}), current_fn_params: null, current_module: ({_tag: 0, _name: "None"}), direct_dispatch_ops: null, fold_cont_pending: false, handler_tail_resume: false, in_cps: false, in_fold_loop: false, in_tail_position: false, indent: 0, scopes: ({_hd: tbl_11510, _tl: null}), tco_used: false, tmp_counter: 0, top_level_exports: null, trywith_ops: null, type_env: type_env});
  return _t11511;
}
function Js_codegen$push_scope(ctx) {
  return (ctx.scopes = ({_hd: Hashtbl$create(8), _tl: ctx.scopes}), undefined);
}
function Js_codegen$pop_scope(ctx) {
  let _t11513;
  const _t11512 = ctx.scopes;
  _t11514: {
    if (_t11512 !== null) {
      const rest = _t11512._tl;
      _t11513 = (ctx.scopes = rest, undefined);
      break _t11514;
    }
    if (_t11512 === null) {
      _t11513 = failwith("pop_scope: empty");
      break _t11514;
    }
    _match_fail("line 16933");
  }
  return _t11513;
}
function Js_codegen$bind_var(ctx, mml_name, js_name) {
  let _t11516;
  const _t11515 = ctx.scopes;
  _t11517: {
    if (_t11515 !== null) {
      const tbl = _t11515._hd;
      _t11516 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, tbl, mml_name, js_name]);
      break _t11517;
    }
    if (_t11515 === null) {
      _t11516 = failwith("bind_var: empty scope");
      break _t11517;
    }
    _match_fail("line 16933");
  }
  return _t11516;
}
function Js_codegen$lookup_var(ctx, name) {
  function search(__x) {
    while (true) {
      let _t11519;
      const _t11518 = __x;
      _t11520: {
        if (_t11518 === null) {
          _t11519 = Js_codegen$mangle_name(name);
          break _t11520;
        }
        if (_t11518 !== null) {
          const tbl = _t11518._hd;
          const rest = _t11518._tl;
          let _t11522;
          const _t11521 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, tbl, name]);
          _t11523: {
            if (_t11521._tag === 1) {
              const js = _t11521._val;
              _t11522 = js;
              break _t11523;
            }
            if (_t11521._tag === 0) {
              const _t11524 = rest;
              __x = _t11524;
              continue;
              _t11522 = undefined;
              break _t11523;
            }
            _match_fail("line 16933");
          }
          _t11519 = _t11522;
          break _t11520;
        }
        _match_fail("line 16933");
      }
      return _t11519;
    }
  }
  const _t11525 = search(ctx.scopes);
  return _t11525;
}
function Js_codegen$fresh_tmp(ctx) {
  const n_11526 = ctx.tmp_counter;
  (ctx.tmp_counter = (n_11526 + 1), undefined);
  const _t11527 = ("_t" + __dict_Show_int.show(n_11526));
  return _t11527;
}
function Js_codegen$dedup_js_params(params) {
  const seen_11528 = Hashtbl$create(8);
  function _t11530(p) {
    let _t11532;
    const _t11531 = _call(Hashtbl$get, [__dict_Hash_string, __dict_Eq_string, seen_11528, p]);
    _t11533: {
      if (_t11531._tag === 1) {
        const n = _t11531._val;
        _t11532 = n;
        break _t11533;
      }
      if (_t11531._tag === 0) {
        _t11532 = 0;
        break _t11533;
      }
      _match_fail("line 16933");
    }
    const count_11534 = _t11532;
    _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, seen_11528, p, (count_11534 + 1)]);
    let _t11536;
    if ((count_11534 === 0)) {
      _t11536 = p;
    } else {
      _t11536 = (p + ("_" + string_of_int((count_11534 + 1))));
    }
    const _t11535 = _t11536;
    return _t11535;
  }
  const _t11529 = List$map(_t11530, params);
  return _t11529;
}
function Js_codegen$emit(ctx, s) {
  return Buffer$add_string(ctx.buf, s);
}
function Js_codegen$emit_indent(ctx) {
  let _loop_var_11537 = 1;
  let _t11539 = undefined;
  let _t11540 = false, _t11541;
  while (true) {
    if (!((_loop_var_11537 <= ctx.indent))) break;
    Buffer$add_string(ctx.buf, "  ");
    (_loop_var_11537 = (_loop_var_11537 + 1), undefined);
    if (_t11540) break;
  }
  _t11539 = _t11540 ? _t11541 : undefined;
  const _t11538 = _t11539;
  return _t11538;
}
function Js_codegen$emit_line(ctx, s) {
  Js_codegen$emit_indent(ctx);
  Js_codegen$emit(ctx, s);
  return Js_codegen$emit(ctx, "\n");
}
function Js_codegen$escape_js_string(s) {
  const buf_11542 = Buffer$create((String$length(s) + 2));
  Buffer$add_byte(buf_11542, 34);
  function _t11544(c) {
    let _t11546;
    const _t11545 = c;
    _t11547: {
      if (true) {
        const _c = _t11545;
        if ((_c === 34)) {
          _t11546 = Buffer$add_string(buf_11542, "\\\"");
          break _t11547;
        }
      }
      if (true) {
        const _c = _t11545;
        if ((_c === 92)) {
          _t11546 = Buffer$add_string(buf_11542, "\\\\");
          break _t11547;
        }
      }
      if (true) {
        const _c = _t11545;
        if ((_c === 10)) {
          _t11546 = Buffer$add_string(buf_11542, "\\n");
          break _t11547;
        }
      }
      if (true) {
        const _c = _t11545;
        if ((_c === 13)) {
          _t11546 = Buffer$add_string(buf_11542, "\\r");
          break _t11547;
        }
      }
      if (true) {
        const _c = _t11545;
        if ((_c === 9)) {
          _t11546 = Buffer$add_string(buf_11542, "\\t");
          break _t11547;
        }
      }
      if (true) {
        const c = _t11545;
        if ((Byte$to_int(c) < 32)) {
          _t11546 = Buffer$add_string(buf_11542, ("\\x" + __fmt_zero_pad(2, __fmt_hex(Byte$to_int(c)))));
          break _t11547;
        }
      }
      if (true) {
        const c = _t11545;
        _t11546 = Buffer$add_byte(buf_11542, c);
        break _t11547;
      }
      _match_fail("line 16933");
    }
    return _t11546;
  }
  String$iter(_t11544, s);
  Buffer$add_byte(buf_11542, 34);
  const _t11543 = Buffer$contents(buf_11542);
  return _t11543;
}
function Js_codegen$tag_for_constructor(type_env, name) {
  let _t11549;
  const _t11548 = List$assoc_opt(name, type_env.constructors);
  _t11550: {
    if (_t11548._tag === 0) {
      _t11549 = Js_codegen$error(("unknown constructor: " + __dict_Show_string.show(name)));
      break _t11550;
    }
    if (_t11548._tag === 1) {
      const info = _t11548._val;
      function _t11551(__p403) {
        let _t11553;
        const _t11552 = __p403;
        _t11554: {
          if (true) {
            const n = _t11552[0];
            _t11553 = (n === info.ctor_type_name);
            break _t11554;
          }
          _match_fail("line 16933");
        }
        return _t11553;
      }
      let _t11556;
      const _t11555 = list_find(_t11551, type_env.variants);
      _t11557: {
        if (true) {
          const variant_def = _t11555[2];
          let _t11559;
          const _t11558 = String$rindex_opt(name, 46);
          _t11560: {
            if (_t11558._tag === 1) {
              const i = _t11558._val;
              _t11559 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
              break _t11560;
            }
            if (_t11558._tag === 0) {
              _t11559 = name;
              break _t11560;
            }
            _match_fail("line 16933");
          }
          const short_name_11561 = _t11559;
          function find_tag(idx, __x) {
            while (true) {
              let _t11564;
              const _t11563 = __x;
              _t11565: {
                if (_t11563 === null) {
                  _t11564 = Js_codegen$error((("constructor " + __dict_Show_string.show(name)) + " not found in variant"));
                  break _t11565;
                }
                if (_t11563 !== null) {
                  const cname = _t11563._hd[0];
                  if ((cname === short_name_11561)) {
                    _t11564 = idx;
                    break _t11565;
                  }
                }
                if (_t11563 !== null) {
                  const rest = _t11563._tl;
                  const _t11566 = (idx + 1);
                  const _t11567 = rest;
                  idx = _t11566;
                  __x = _t11567;
                  continue;
                  _t11564 = undefined;
                  break _t11565;
                }
                _match_fail("line 16933");
              }
              return _t11564;
            }
          }
          const _t11568 = find_tag(0, variant_def);
          const _t11562 = _t11568;
          _t11556 = _t11562;
          break _t11557;
        }
        _match_fail("line 16933");
      }
      _t11549 = _t11556;
      break _t11550;
    }
    _match_fail("line 16933");
  }
  return _t11549;
}
function Js_codegen$short_constructor_name(name) {
  let _t11570;
  const _t11569 = String$rindex_opt(name, 46);
  _t11571: {
    if (_t11569._tag === 1) {
      const i = _t11569._val;
      _t11570 = String$sub(name, (i + 1), ((String$length(name) - i) - 1));
      break _t11571;
    }
    if (_t11569._tag === 0) {
      _t11570 = name;
      break _t11571;
    }
    _match_fail("line 16933");
  }
  return _t11570;
}
function Js_codegen$is_newtype_ctor(type_env, name) {
  let _t11573;
  const _t11572 = List$assoc_opt(name, type_env.constructors);
  _t11574: {
    if (_t11572._tag === 1) {
      const info = _t11572._val;
      _t11573 = List$mem(info.ctor_type_name, type_env.newtypes);
      break _t11574;
    }
    if (_t11572._tag === 0) {
      _t11573 = false;
      break _t11574;
    }
    _match_fail("line 16933");
  }
  return _t11573;
}
function Js_codegen$expr_has_perform(te) {
  while (true) {
    let _t11576;
    const _t11575 = te.expr;
    _t11577: {
      if (_t11575._tag === 29) {
        _t11576 = true;
        break _t11577;
      }
      if (_t11575._tag === 31) {
        _t11576 = true;
        break _t11577;
      }
      if ((_t11575._tag === 8 || _t11575._tag === 28)) {
        const e1 = (_t11575._tag === 8 ? _t11575._val[2] : _t11575._val[0]);
        const e2 = (_t11575._tag === 8 ? _t11575._val[3] : _t11575._val[1]);
        _t11576 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t11577;
      }
      if (_t11575._tag === 12) {
        const cond = _t11575._val[0];
        const e1 = _t11575._val[1];
        const e2 = _t11575._val[2];
        _t11576 = (Js_codegen$expr_has_perform(cond) || (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2)));
        break _t11577;
      }
      if (_t11575._tag === 24) {
        const scrut = _t11575._val[0];
        const arms = _t11575._val[1];
        let _t11586;
        if (Js_codegen$expr_has_perform(scrut)) {
          _t11586 = true;
        } else {
        function _t11578(__p404) {
          let _t11580;
          const _t11579 = __p404;
          _t11581: {
            if (true) {
              const g = _t11579[1];
              const body = _t11579[2];
              let _t11585;
              if (Js_codegen$expr_has_perform(body)) {
                _t11585 = true;
              } else {
              let _t11583;
              const _t11582 = g;
              _t11584: {
                if (_t11582._tag === 1) {
                  const g = _t11582._val;
                  _t11583 = Js_codegen$expr_has_perform(g);
                  break _t11584;
                }
                if (_t11582._tag === 0) {
                  _t11583 = false;
                  break _t11584;
                }
                _match_fail("line 16933");
              }
                _t11585 = _t11583;
              }
              _t11580 = _t11585;
              break _t11581;
            }
            _match_fail("line 16933");
          }
          return _t11580;
        }
          _t11586 = List$exists(_t11578, arms);
        }
        _t11576 = _t11586;
        break _t11577;
      }
      if (_t11575._tag === 9) {
        const fn_e = _t11575._val[2];
        const body = _t11575._val[3];
        _t11576 = (Js_codegen$expr_has_perform(fn_e) || Js_codegen$expr_has_perform(body));
        break _t11577;
      }
      if (_t11575._tag === 37) {
        const bindings = _t11575._val[0];
        const body = _t11575._val[1];
        function _t11587(__p405) {
          let _t11589;
          const _t11588 = __p405;
          _t11590: {
            if (true) {
              const e = _t11588[1];
              _t11589 = Js_codegen$expr_has_perform(e);
              break _t11590;
            }
            _match_fail("line 16933");
          }
          return _t11589;
        }
        _t11576 = (List$exists(_t11587, bindings) || Js_codegen$expr_has_perform(body));
        break _t11577;
      }
      if (_t11575._tag === 10) {
        const body = _t11575._val[1];
        const _t11591 = body;
        te = _t11591;
        continue;
        _t11576 = undefined;
        break _t11577;
      }
      if (_t11575._tag === 11) {
        const fn_ = _t11575._val[0];
        const arg = _t11575._val[1];
        _t11576 = (Js_codegen$expr_has_perform(fn_) || Js_codegen$expr_has_perform(arg));
        break _t11577;
      }
      if (_t11575._tag === 30) {
        const body = _t11575._val[0];
        const arms = _t11575._val[1];
        let _t11596;
        if (Js_codegen$expr_has_perform(body)) {
          _t11596 = true;
        } else {
        function _t11592(arm) {
          let _t11594;
          const _t11593 = arm;
          _t11595: {
            if ((((_t11593._tag === 0 || _t11593._tag === 1) || _t11593._tag === 2) || _t11593._tag === 3)) {
              const e = (((_t11593._tag === 0 || _t11593._tag === 1) || _t11593._tag === 2) ? ((_t11593._tag === 0 || _t11593._tag === 1) ? (_t11593._tag === 0 ? _t11593._val[1] : _t11593._val[3]) : _t11593._val[2]) : _t11593._val[2]);
              _t11594 = Js_codegen$expr_has_perform(e);
              break _t11595;
            }
            _match_fail("line 16933");
          }
          return _t11594;
        }
          _t11596 = List$exists(_t11592, arms);
        }
        _t11576 = _t11596;
        break _t11577;
      }
      if (_t11575._tag === 25) {
        const e1 = _t11575._val[1];
        const e2 = _t11575._val[2];
        _t11576 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t11577;
      }
      if (_t11575._tag === 32) {
        const c = _t11575._val[0];
        const b = _t11575._val[1];
        _t11576 = (Js_codegen$expr_has_perform(c) || Js_codegen$expr_has_perform(b));
        break _t11577;
      }
      if (_t11575._tag === 21) {
        const e1 = _t11575._val[0];
        const e2 = _t11575._val[1];
        _t11576 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t11577;
      }
      if (_t11575._tag === 15) {
        const es = _t11575._val;
        _t11576 = List$exists(Js_codegen$expr_has_perform, es);
        break _t11577;
      }
      if (_t11575._tag === 16) {
        const fields = _t11575._val;
        function _t11597(__p406) {
          let _t11599;
          const _t11598 = __p406;
          _t11600: {
            if (true) {
              const e = _t11598[1];
              _t11599 = Js_codegen$expr_has_perform(e);
              break _t11600;
            }
            _match_fail("line 16933");
          }
          return _t11599;
        }
        _t11576 = List$exists(_t11597, fields);
        break _t11577;
      }
      if (_t11575._tag === 13) {
        const e1 = _t11575._val[1];
        const e2 = _t11575._val[2];
        _t11576 = (Js_codegen$expr_has_perform(e1) || Js_codegen$expr_has_perform(e2));
        break _t11577;
      }
      if (_t11575._tag === 14) {
        const e = _t11575._val[1];
        const _t11601 = e;
        te = _t11601;
        continue;
        _t11576 = undefined;
        break _t11577;
      }
      if (true) {
        _t11576 = false;
        break _t11577;
      }
      _match_fail("line 16933");
    }
    return _t11576;
  }
}
function Js_codegen$all_resumes_are_tail(te) {
  while (true) {
    let _t11603;
    const _t11602 = te.expr;
    _t11604: {
      if (_t11602._tag === 31) {
        _t11603 = true;
        break _t11604;
      }
      if (_t11602._tag === 28) {
        const e2 = _t11602._val[1];
        const _t11605 = e2;
        te = _t11605;
        continue;
        _t11603 = undefined;
        break _t11604;
      }
      if (_t11602._tag === 8) {
        const e1 = _t11602._val[2];
        const e2 = _t11602._val[3];
        _t11603 = ((!Js_codegen$expr_has_perform(e1)) && Js_codegen$all_resumes_are_tail(e2));
        break _t11604;
      }
      if (_t11602._tag === 9) {
        const e2 = _t11602._val[3];
        const _t11606 = e2;
        te = _t11606;
        continue;
        _t11603 = undefined;
        break _t11604;
      }
      if (_t11602._tag === 25) {
        const e1 = _t11602._val[1];
        const e2 = _t11602._val[2];
        _t11603 = ((!Js_codegen$expr_has_perform(e1)) && Js_codegen$all_resumes_are_tail(e2));
        break _t11604;
      }
      if (_t11602._tag === 12) {
        const then_e = _t11602._val[1];
        const else_e = _t11602._val[2];
        _t11603 = (Js_codegen$all_resumes_are_tail(then_e) && Js_codegen$all_resumes_are_tail(else_e));
        break _t11604;
      }
      if (_t11602._tag === 24) {
        const arms = _t11602._val[1];
        function _t11607(__p407) {
          let _t11609;
          const _t11608 = __p407;
          _t11610: {
            if (true) {
              const body = _t11608[2];
              _t11609 = Js_codegen$all_resumes_are_tail(body);
              break _t11610;
            }
            _match_fail("line 16933");
          }
          return _t11609;
        }
        _t11603 = List$forall(_t11607, arms);
        break _t11604;
      }
      if (true) {
        _t11603 = true;
        break _t11604;
      }
      _match_fail("line 16933");
    }
    return _t11603;
  }
}
function Js_codegen$expr_has_unhandled_perform(handled_ops, te) {
  while (true) {
    let _t11612;
    const _t11611 = te.expr;
    _t11613: {
      if (_t11611._tag === 29) {
        const op_name = _t11611._val[0];
        _t11612 = (!List$mem(op_name, handled_ops));
        break _t11613;
      }
      if (_t11611._tag === 31) {
        _t11612 = true;
        break _t11613;
      }
      if ((_t11611._tag === 8 || _t11611._tag === 28)) {
        const e1 = (_t11611._tag === 8 ? _t11611._val[2] : _t11611._val[0]);
        const e2 = (_t11611._tag === 8 ? _t11611._val[3] : _t11611._val[1]);
        _t11612 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t11613;
      }
      if (_t11611._tag === 12) {
        const cond = _t11611._val[0];
        const e1 = _t11611._val[1];
        const e2 = _t11611._val[2];
        _t11612 = (Js_codegen$expr_has_unhandled_perform(handled_ops, cond) || (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2)));
        break _t11613;
      }
      if (_t11611._tag === 24) {
        const scrut = _t11611._val[0];
        const arms = _t11611._val[1];
        let _t11622;
        if (Js_codegen$expr_has_unhandled_perform(handled_ops, scrut)) {
          _t11622 = true;
        } else {
        function _t11614(__p408) {
          let _t11616;
          const _t11615 = __p408;
          _t11617: {
            if (true) {
              const g = _t11615[1];
              const body = _t11615[2];
              let _t11621;
              if (Js_codegen$expr_has_unhandled_perform(handled_ops, body)) {
                _t11621 = true;
              } else {
              let _t11619;
              const _t11618 = g;
              _t11620: {
                if (_t11618._tag === 1) {
                  const g = _t11618._val;
                  _t11619 = Js_codegen$expr_has_unhandled_perform(handled_ops, g);
                  break _t11620;
                }
                if (_t11618._tag === 0) {
                  _t11619 = false;
                  break _t11620;
                }
                _match_fail("line 16933");
              }
                _t11621 = _t11619;
              }
              _t11616 = _t11621;
              break _t11617;
            }
            _match_fail("line 16933");
          }
          return _t11616;
        }
          _t11622 = List$exists(_t11614, arms);
        }
        _t11612 = _t11622;
        break _t11613;
      }
      if (_t11611._tag === 9) {
        const fn_e = _t11611._val[2];
        const body = _t11611._val[3];
        _t11612 = (Js_codegen$expr_has_unhandled_perform(handled_ops, fn_e) || Js_codegen$expr_has_unhandled_perform(handled_ops, body));
        break _t11613;
      }
      if (_t11611._tag === 37) {
        const bindings = _t11611._val[0];
        const body = _t11611._val[1];
        function _t11623(__p409) {
          let _t11625;
          const _t11624 = __p409;
          _t11626: {
            if (true) {
              const e = _t11624[1];
              _t11625 = Js_codegen$expr_has_unhandled_perform(handled_ops, e);
              break _t11626;
            }
            _match_fail("line 16933");
          }
          return _t11625;
        }
        _t11612 = (List$exists(_t11623, bindings) || Js_codegen$expr_has_unhandled_perform(handled_ops, body));
        break _t11613;
      }
      if (_t11611._tag === 10) {
        const body = _t11611._val[1];
        const _t11627 = handled_ops;
        const _t11628 = body;
        handled_ops = _t11627;
        te = _t11628;
        continue;
        _t11612 = undefined;
        break _t11613;
      }
      if (_t11611._tag === 11) {
        const fn_ = _t11611._val[0];
        const arg = _t11611._val[1];
        _t11612 = (Js_codegen$expr_has_unhandled_perform(handled_ops, fn_) || Js_codegen$expr_has_unhandled_perform(handled_ops, arg));
        break _t11613;
      }
      if (_t11611._tag === 30) {
        const body = _t11611._val[0];
        const arms = _t11611._val[1];
        let _t11633;
        if (Js_codegen$expr_has_unhandled_perform(handled_ops, body)) {
          _t11633 = true;
        } else {
        function _t11629(arm) {
          let _t11631;
          const _t11630 = arm;
          _t11632: {
            if ((((_t11630._tag === 0 || _t11630._tag === 1) || _t11630._tag === 2) || _t11630._tag === 3)) {
              const e = (((_t11630._tag === 0 || _t11630._tag === 1) || _t11630._tag === 2) ? ((_t11630._tag === 0 || _t11630._tag === 1) ? (_t11630._tag === 0 ? _t11630._val[1] : _t11630._val[3]) : _t11630._val[2]) : _t11630._val[2]);
              _t11631 = Js_codegen$expr_has_unhandled_perform(handled_ops, e);
              break _t11632;
            }
            _match_fail("line 16933");
          }
          return _t11631;
        }
          _t11633 = List$exists(_t11629, arms);
        }
        _t11612 = _t11633;
        break _t11613;
      }
      if (_t11611._tag === 25) {
        const e1 = _t11611._val[1];
        const e2 = _t11611._val[2];
        _t11612 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t11613;
      }
      if (_t11611._tag === 32) {
        const c = _t11611._val[0];
        const b = _t11611._val[1];
        _t11612 = (Js_codegen$expr_has_unhandled_perform(handled_ops, c) || Js_codegen$expr_has_unhandled_perform(handled_ops, b));
        break _t11613;
      }
      if (_t11611._tag === 21) {
        const e1 = _t11611._val[0];
        const e2 = _t11611._val[1];
        _t11612 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t11613;
      }
      if (_t11611._tag === 15) {
        const es = _t11611._val;
        _t11612 = List$exists(_call(Js_codegen$expr_has_unhandled_perform, [handled_ops]), es);
        break _t11613;
      }
      if (_t11611._tag === 16) {
        const fields = _t11611._val;
        function _t11634(__p410) {
          let _t11636;
          const _t11635 = __p410;
          _t11637: {
            if (true) {
              const e = _t11635[1];
              _t11636 = Js_codegen$expr_has_unhandled_perform(handled_ops, e);
              break _t11637;
            }
            _match_fail("line 16933");
          }
          return _t11636;
        }
        _t11612 = List$exists(_t11634, fields);
        break _t11613;
      }
      if (_t11611._tag === 13) {
        const e1 = _t11611._val[1];
        const e2 = _t11611._val[2];
        _t11612 = (Js_codegen$expr_has_unhandled_perform(handled_ops, e1) || Js_codegen$expr_has_unhandled_perform(handled_ops, e2));
        break _t11613;
      }
      if (_t11611._tag === 14) {
        const e = _t11611._val[1];
        const _t11638 = handled_ops;
        const _t11639 = e;
        handled_ops = _t11638;
        te = _t11639;
        continue;
        _t11612 = undefined;
        break _t11613;
      }
      if (true) {
        _t11612 = false;
        break _t11613;
      }
      _match_fail("line 16933");
    }
    return _t11612;
  }
}
function Js_codegen$is_exportable_name(name) {
  return (!((String$length(name) >= 2) && ((String$get(name, 0) === 95) && (String$get(name, 1) === 95))));
}
function Js_codegen$compile_non_tail(ctx, te) {
  const saved_11640 = ctx.in_tail_position;
  (ctx.in_tail_position = false, undefined);
  const r_11642 = Js_codegen$compile_expr(ctx, te);
  (ctx.in_tail_position = saved_11640, undefined);
  const _t11643 = r_11642;
  const _t11641 = _t11643;
  return _t11641;
}
function Js_codegen$compile_expr(ctx, te) {
  let _t11645;
  const _t11644 = te.expr;
  _t11646: {
    if (_t11644._tag === 0) {
      const n = _t11644._val;
      let _t11647;
      if ((n < 0)) {
        _t11647 = (("(" + __dict_Show_int.show(n)) + ")");
      } else {
        _t11647 = string_of_int(n);
      }
      _t11645 = _t11647;
      break _t11646;
    }
    if (_t11644._tag === 1) {
      const f = _t11644._val;
      const s_11648 = __dict_Show_float.show(f);
      let _t11650;
      if ((String$contains(".", s_11648) || (String$contains("e", s_11648) || String$contains("i", s_11648)))) {
        _t11650 = s_11648;
      } else {
        _t11650 = (s_11648 + ".0");
      }
      const _t11649 = _t11650;
      _t11645 = _t11649;
      break _t11646;
    }
    if (_t11644._tag === 2 && _t11644._val) {
      _t11645 = "true";
      break _t11646;
    }
    if (_t11644._tag === 2 && !_t11644._val) {
      _t11645 = "false";
      break _t11646;
    }
    if (_t11644._tag === 3) {
      const s = _t11644._val;
      _t11645 = Js_codegen$escape_js_string(s);
      break _t11646;
    }
    if (_t11644._tag === 4) {
      const n = _t11644._val;
      _t11645 = string_of_int(n);
      break _t11646;
    }
    if (_t11644._tag === 5) {
      const n = _t11644._val;
      _t11645 = string_of_int(n);
      break _t11646;
    }
    if (_t11644._tag === 6) {
      _t11645 = "undefined";
      break _t11646;
    }
    if (_t11644._tag === 22) {
      _t11645 = "null";
      break _t11646;
    }
    if (_t11644._tag === 7) {
      const name = _t11644._val;
      _t11645 = Js_codegen$lookup_var(ctx, name);
      break _t11646;
    }
    if (_t11644._tag === 8) {
      const name = _t11644._val[0];
      const _scheme = _t11644._val[1];
      const e1 = _t11644._val[2];
      const e2 = _t11644._val[3];
      _t11645 = Js_codegen$compile_let(ctx, name, e1, e2);
      break _t11646;
    }
    if (_t11644._tag === 9) {
      const name = _t11644._val[0];
      const _scheme = _t11644._val[1];
      const fn_expr = _t11644._val[2];
      const body = _t11644._val[3];
      _t11645 = Js_codegen$compile_letrec(ctx, name, fn_expr, body);
      break _t11646;
    }
    if (_t11644._tag === 37) {
      const bindings = _t11644._val[0];
      const body = _t11644._val[1];
      _t11645 = Js_codegen$compile_letrec_and(ctx, bindings, body);
      break _t11646;
    }
    if (_t11644._tag === 10) {
      const param = _t11644._val[0];
      const body = _t11644._val[1];
      const has_return = _t11644._val[2];
      _t11645 = Js_codegen$compile_fun(ctx, param, body, has_return);
      break _t11646;
    }
    if (_t11644._tag === 11) {
      const fn_ = _t11644._val[0];
      const arg = _t11644._val[1];
      _t11645 = Js_codegen$compile_app(ctx, te, fn_, arg);
      break _t11646;
    }
    if (_t11644._tag === 13) {
      const op = _t11644._val[0];
      const e1 = _t11644._val[1];
      const e2 = _t11644._val[2];
      _t11645 = Js_codegen$compile_binop(ctx, op, e1, e2);
      break _t11646;
    }
    if (_t11644._tag === 14) {
      const op = _t11644._val[0];
      const e = _t11644._val[1];
      _t11645 = Js_codegen$compile_unop(ctx, op, e);
      break _t11646;
    }
    if (_t11644._tag === 12) {
      const cond = _t11644._val[0];
      const then_e = _t11644._val[1];
      const else_e = _t11644._val[2];
      _t11645 = Js_codegen$compile_if(ctx, cond, then_e, else_e);
      break _t11646;
    }
    if (_t11644._tag === 15) {
      const exprs = _t11644._val;
      const elts_11651 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), exprs);
      const _t11652 = ("[" + (String$concat(", ", elts_11651) + "]"));
      _t11645 = _t11652;
      break _t11646;
    }
    if (_t11644._tag === 16) {
      const fields = _t11644._val;
      function _t11653(__p411, __p412) {
        let _t11655;
        const _t11654 = __p411;
        _t11656: {
          if (true) {
            const a = _t11654[0];
            let _t11658;
            const _t11657 = __p412;
            _t11659: {
              if (true) {
                const b = _t11657[0];
                _t11658 = String$compare(a, b);
                break _t11659;
              }
              _match_fail("line 16933");
            }
            _t11655 = _t11658;
            break _t11656;
          }
          _match_fail("line 16933");
        }
        return _t11655;
      }
      const sorted_11660 = List$sort(_t11653, fields);
      function _t11662(__p413) {
        let _t11664;
        const _t11663 = __p413;
        _t11665: {
          if (true) {
            const name = _t11663[0];
            const e = _t11663[1];
            const js_name_11666 = Js_codegen$mangle_name(name);
            const v_11668 = Js_codegen$compile_non_tail(ctx, e);
            let _t11670;
            if ((js_name_11666 === name)) {
              _t11670 = (name + (": " + v_11668));
            } else {
              _t11670 = ((__dict_Show_string.show(js_name_11666) + ": ") + __dict_Show_string.show(v_11668));
            }
            const _t11669 = _t11670;
            const _t11667 = _t11669;
            _t11664 = _t11667;
            break _t11665;
          }
          _match_fail("line 16933");
        }
        return _t11664;
      }
      const field_strs_11671 = List$map(_t11662, sorted_11660);
      const _t11672 = ("({" + (String$concat(", ", field_strs_11671) + "})"));
      const _t11661 = _t11672;
      _t11645 = _t11661;
      break _t11646;
    }
    if (_t11644._tag === 17) {
      const base = _t11644._val[0];
      const overrides = _t11644._val[1];
      const base_js_11673 = Js_codegen$compile_non_tail(ctx, base);
      function _t11675(__p414) {
        let _t11677;
        const _t11676 = __p414;
        _t11678: {
          if (true) {
            const name = _t11676[0];
            const e = _t11676[1];
            const js_name_11679 = Js_codegen$mangle_name(name);
            const _t11680 = (js_name_11679 + (": " + Js_codegen$compile_non_tail(ctx, e)));
            _t11677 = _t11680;
            break _t11678;
          }
          _match_fail("line 16933");
        }
        return _t11677;
      }
      const field_strs_11681 = List$map(_t11675, overrides);
      const _t11682 = ("({..." + (base_js_11673 + (", " + (String$concat(", ", field_strs_11681) + "})"))));
      const _t11674 = _t11682;
      _t11645 = _t11674;
      break _t11646;
    }
    if (_t11644._tag === 18) {
      const base = _t11644._val[0];
      const pairs = _t11644._val[1];
      const tmp_11683 = Js_codegen$fresh_tmp(ctx);
      const base_js_11685 = Js_codegen$compile_non_tail(ctx, base);
      function _t11687(__p415) {
        let _t11689;
        const _t11688 = __p415;
        _t11690: {
          if (true) {
            const idx_e = _t11688[0];
            const val_e = _t11688[1];
            const idx_js_11691 = Js_codegen$compile_non_tail(ctx, idx_e);
            const val_js_11693 = Js_codegen$compile_non_tail(ctx, val_e);
            const _t11694 = ((("[" + __dict_Show_string.show(idx_js_11691)) + "]: ") + __dict_Show_string.show(val_js_11693));
            const _t11692 = _t11694;
            _t11689 = _t11692;
            break _t11690;
          }
          _match_fail("line 16933");
        }
        return _t11689;
      }
      const pair_strs_11695 = List$map(_t11687, pairs);
      const _t11696 = (((((((("(" + __dict_Show_string.show(tmp_11683)) + " = {...") + __dict_Show_string.show(base_js_11685)) + ", ") + __dict_Show_string.show(String$concat(", ", pair_strs_11695))) + "}, ") + __dict_Show_string.show(tmp_11683)) + ")");
      const _t11686 = _t11696;
      const _t11684 = _t11686;
      _t11645 = _t11684;
      break _t11646;
    }
    if (_t11644._tag === 19) {
      const e = _t11644._val[0];
      const field = _t11644._val[1];
      const base_11697 = Js_codegen$compile_non_tail(ctx, e);
      const _t11698 = (base_11697 + ("." + Js_codegen$mangle_name(field)));
      _t11645 = _t11698;
      break _t11646;
    }
    if (_t11644._tag === 20) {
      const base_e = _t11644._val[0];
      const idx_e = _t11644._val[1];
      const base_11699 = Js_codegen$compile_non_tail(ctx, base_e);
      const idx_11701 = Js_codegen$compile_non_tail(ctx, idx_e);
      const resolved_11703 = Types$repr(base_e.ty);
      let _t11706;
      const _t11705 = resolved_11703;
      _t11707: {
        if (_t11705._tag === 3) {
          _t11706 = (base_11699 + (".charCodeAt(" + (idx_11701 + ")")));
          break _t11707;
        }
        if (_t11705._tag === 13) {
          _t11706 = (base_11699 + ("._arr[" + (idx_11701 + "]")));
          break _t11707;
        }
        if (true) {
          _t11706 = (base_11699 + ("[" + (idx_11701 + "]")));
          break _t11707;
        }
        _match_fail("line 16933");
      }
      const _t11704 = _t11706;
      const _t11702 = _t11704;
      const _t11700 = _t11702;
      _t11645 = _t11700;
      break _t11646;
    }
    if (_t11644._tag === 21) {
      const hd = _t11644._val[0];
      const tl = _t11644._val[1];
      const hd_js_11708 = Js_codegen$compile_non_tail(ctx, hd);
      const tl_js_11710 = Js_codegen$compile_non_tail(ctx, tl);
      const _t11711 = ("({_hd: " + (hd_js_11708 + (", _tl: " + (tl_js_11710 + "})"))));
      const _t11709 = _t11711;
      _t11645 = _t11709;
      break _t11646;
    }
    if (_t11644._tag === 23) {
      const name = _t11644._val[0];
      const arg = _t11644._val[1];
      let _t11712;
      if (Js_codegen$is_newtype_ctor(ctx.type_env, name)) {
        let _t11714;
        const _t11713 = arg;
        _t11715: {
          if (_t11713._tag === 1) {
            const e = _t11713._val;
            _t11714 = Js_codegen$compile_non_tail(ctx, e);
            break _t11715;
          }
          if (_t11713._tag === 0) {
            _t11714 = "undefined";
            break _t11715;
          }
          _match_fail("line 16933");
        }
        _t11712 = _t11714;
      } else {
        let _t11716;
        if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
          _t11716 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
        } else {
          _t11716 = Js_codegen$tag_for_constructor(ctx.type_env, name);
        }
        const tag_11717 = _t11716;
        const sname_11719 = Js_codegen$short_constructor_name(name);
        let _t11722;
        const _t11721 = arg;
        _t11723: {
          if (_t11721._tag === 1) {
            const e = _t11721._val;
            const v_11724 = Js_codegen$compile_non_tail(ctx, e);
            const _t11725 = (((((("({_tag: " + __dict_Show_int.show(tag_11717)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11719))) + ", _val: ") + __dict_Show_string.show(v_11724)) + "})");
            _t11722 = _t11725;
            break _t11723;
          }
          if (_t11721._tag === 0) {
            _t11722 = (((("({_tag: " + __dict_Show_int.show(tag_11717)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11719))) + "})");
            break _t11723;
          }
          _match_fail("line 16933");
        }
        const _t11720 = _t11722;
        const _t11718 = _t11720;
        _t11712 = _t11718;
      }
      _t11645 = _t11712;
      break _t11646;
    }
    if (_t11644._tag === 24) {
      const scrut = _t11644._val[0];
      const arms = _t11644._val[1];
      const _partial = _t11644._val[2];
      _t11645 = Js_codegen$compile_match(ctx, scrut, arms, te.loc);
      break _t11646;
    }
    if (_t11644._tag === 28) {
      const e1 = _t11644._val[0];
      const e2 = _t11644._val[1];
      _t11645 = Js_codegen$compile_seq(ctx, e1, e2);
      break _t11646;
    }
    if (_t11644._tag === 25) {
      const name = _t11644._val[0];
      const init = _t11644._val[1];
      const body = _t11644._val[2];
      _t11645 = Js_codegen$compile_let_mut(ctx, name, init, body);
      break _t11646;
    }
    if (_t11644._tag === 26) {
      const name = _t11644._val[0];
      const e = _t11644._val[1];
      const js_name_11726 = Js_codegen$lookup_var(ctx, name);
      const v_11728 = Js_codegen$compile_non_tail(ctx, e);
      const _t11729 = ("(" + (js_name_11726 + (" = " + (v_11728 + ", undefined)"))));
      const _t11727 = _t11729;
      _t11645 = _t11727;
      break _t11646;
    }
    if (_t11644._tag === 27) {
      const record_e = _t11644._val[0];
      const field = _t11644._val[1];
      const value_e = _t11644._val[2];
      const base_11730 = Js_codegen$compile_non_tail(ctx, record_e);
      const v_11732 = Js_codegen$compile_non_tail(ctx, value_e);
      const _t11733 = ("(" + (base_11730 + ("." + (Js_codegen$mangle_name(field) + (" = " + (v_11732 + ", undefined)"))))));
      const _t11731 = _t11733;
      _t11645 = _t11731;
      break _t11646;
    }
    if (_t11644._tag === 32) {
      const cond = _t11644._val[0];
      const body = _t11644._val[1];
      _t11645 = Js_codegen$compile_while(ctx, cond, body);
      break _t11646;
    }
    if (_t11644._tag === 33) {
      const value_te = _t11644._val;
      const v_11734 = Js_codegen$compile_non_tail(ctx, value_te);
      let _t11736;
      if (ctx.in_fold_loop) {
        _t11736 = ("_throw_break(" + (v_11734 + ")"));
      } else {
        _t11736 = ("(!" + (ctx.break_flag_name + (" && (" + (ctx.break_val_name + (" = " + (v_11734 + (", " + (ctx.break_flag_name + " = true), undefined)"))))))));
      }
      const _t11735 = _t11736;
      _t11645 = _t11735;
      break _t11646;
    }
    if (_t11644._tag === 34) {
      _t11645 = "(_cont_flag = true, undefined)";
      break _t11646;
    }
    if (_t11644._tag === 35) {
      const value_te = _t11644._val;
      const v_11737 = Js_codegen$compile_non_tail(ctx, value_te);
      const _t11738 = ("_throw_fold_cont(" + (v_11737 + ")"));
      _t11645 = _t11738;
      break _t11646;
    }
    if (_t11644._tag === 36) {
      const fold_te = _t11644._val;
      const result_11739 = Js_codegen$fresh_tmp(ctx);
      (ctx.fold_cont_pending = true, undefined);
      Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_11739)) + ";"));
      Js_codegen$emit_line(ctx, "try {");
      (ctx.indent = (ctx.indent + 1), undefined);
      const fold_js_11741 = Js_codegen$compile_non_tail(ctx, fold_te);
      Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_11739) + " = ") + __dict_Show_string.show(fold_js_11741)) + ";"));
      (ctx.indent = (ctx.indent - 1), undefined);
      Js_codegen$emit_line(ctx, "} catch(_e) {");
      (ctx.indent = (ctx.indent + 1), undefined);
      Js_codegen$emit_line(ctx, (("if (_e && _e._tag === \"_break\") " + __dict_Show_string.show(result_11739)) + " = _e._val;"));
      Js_codegen$emit_line(ctx, "else throw _e;");
      (ctx.indent = (ctx.indent - 1), undefined);
      Js_codegen$emit_line(ctx, "}");
      const _t11742 = result_11739;
      const _t11740 = _t11742;
      _t11645 = _t11740;
      break _t11646;
    }
    if (_t11644._tag === 38) {
      const elts = _t11644._val;
      const elt_strs_11743 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), elts);
      const _t11744 = ("{_arr: [" + (String$concat(", ", elt_strs_11743) + "]}"));
      _t11645 = _t11744;
      break _t11646;
    }
    if (_t11644._tag === 39) {
      const value_te = _t11644._val;
      const v_11745 = Js_codegen$compile_non_tail(ctx, value_te);
      const _t11746 = ("_throw_return(" + (v_11745 + ")"));
      _t11645 = _t11746;
      break _t11646;
    }
    if (_t11644._tag === 29) {
      const op_name = _t11644._val[0];
      const arg = _t11644._val[1];
      let _t11748;
      const _t11747 = List$assoc_opt(op_name, ctx.direct_dispatch_ops);
      _t11749: {
        if (_t11747._tag === 1) {
          const direct_fn = _t11747._val;
          const arg_js_11750 = Js_codegen$compile_non_tail(ctx, arg);
          const _t11751 = (direct_fn + ("(" + (arg_js_11750 + ")")));
          _t11748 = _t11751;
          break _t11749;
        }
        if (_t11747._tag === 0) {
          if (List$mem(op_name, ctx.trywith_ops)) {
            const arg_js_11752 = Js_codegen$compile_non_tail(ctx, arg);
            const result_11754 = Js_codegen$fresh_tmp(ctx);
            Js_codegen$emit_line(ctx, (((("throw {_e: \"" + __dict_Show_string.show(op_name)) + "\", _v: ") + __dict_Show_string.show(arg_js_11752)) + "};"));
            Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(result_11754)) + " = undefined;"));
            const _t11755 = result_11754;
            const _t11753 = _t11755;
            _t11748 = _t11753;
            break _t11749;
          }
        }
        if (_t11747._tag === 0) {
          const arg_js_11756 = Js_codegen$compile_non_tail(ctx, arg);
          const result_11758 = Js_codegen$fresh_tmp(ctx);
          Js_codegen$emit_line(ctx, (((((("const " + __dict_Show_string.show(result_11758)) + " = _trampoline(function() { return _h[\"") + __dict_Show_string.show(op_name)) + "\"](") + __dict_Show_string.show(arg_js_11756)) + ", function(_r) { return _r; }); });"));
          const _t11759 = result_11758;
          const _t11757 = _t11759;
          _t11748 = _t11757;
          break _t11749;
        }
        _match_fail("line 16933");
      }
      _t11645 = _t11748;
      break _t11646;
    }
    if (_t11644._tag === 30) {
      const body = _t11644._val[0];
      const arms = _t11644._val[1];
      _t11645 = Js_codegen$compile_handle(ctx, body, arms);
      break _t11646;
    }
    if (_t11644._tag === 31) {
      const k_expr = _t11644._val[0];
      const val_expr = _t11644._val[1];
      const k_js_11760 = Js_codegen$compile_non_tail(ctx, k_expr);
      const v_js_11762 = Js_codegen$compile_non_tail(ctx, val_expr);
      let _t11764;
      if (ctx.handler_tail_resume) {
        _t11764 = (k_js_11760 + ("(" + (v_js_11762 + ")")));
      } else {
        _t11764 = ("_trampoline(function() { return " + (k_js_11760 + ("(" + (v_js_11762 + "); })"))));
      }
      const _t11763 = _t11764;
      const _t11761 = _t11763;
      _t11645 = _t11761;
      break _t11646;
    }
    _match_fail("line 16933");
  }
  return _t11645;
}
function Js_codegen$compile_let(ctx, name, e1, e2) {
  const v1_11765 = Js_codegen$compile_non_tail(ctx, e1);
  const js_name_11767 = Js_codegen$mangle_name(name);
  let _t11769;
  if ((js_name_11767 === "_")) {
    _t11769 = Js_codegen$fresh_tmp(ctx);
  } else {
    function _t11770(n) {
      (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
      return n;
    }
    _t11769 = _call(_t11770, [(js_name_11767 + ("_" + (string_of_int(ctx.tmp_counter) + "")))]);
  }
  const actual_name_11771 = _t11769;
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, actual_name_11771);
  const result_11773 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_name_11771)) + " = ") + __dict_Show_string.show(v1_11765)) + ";"));
  const v2_11775 = Js_codegen$compile_expr(ctx, e2);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11773)) + " = ") + __dict_Show_string.show(v2_11775)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11776 = result_11773;
  const _t11774 = _t11776;
  const _t11772 = _t11774;
  const _t11768 = _t11772;
  const _t11766 = _t11768;
  return _t11766;
}
function Js_codegen$emit_js_placeholder(ctx, js_name, te) {
  function go(te) {
    while (true) {
      let _t11778;
      const _t11777 = te.expr;
      _t11779: {
        if (_t11777._tag === 21) {
          _t11778 = Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(js_name)) + " = {_hd: null, _tl: null};"));
          break _t11779;
        }
        if (_t11777._tag === 15) {
          const es = _t11777._val;
          function _t11780(_) {
            return "null";
          }
          const nulls_11781 = String$concat(", ", List$map(_t11780, es));
          const _t11782 = Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(js_name)) + " = [") + __dict_Show_string.show(nulls_11781)) + "];"));
          _t11778 = _t11782;
          break _t11779;
        }
        if (_t11777._tag === 16) {
          const fields = _t11777._val;
          function _t11783(__p416, __p417) {
            let _t11785;
            const _t11784 = __p416;
            _t11786: {
              if (true) {
                const a = _t11784[0];
                let _t11788;
                const _t11787 = __p417;
                _t11789: {
                  if (true) {
                    const b = _t11787[0];
                    _t11788 = String$compare(a, b);
                    break _t11789;
                  }
                  _match_fail("line 16933");
                }
                _t11785 = _t11788;
                break _t11786;
              }
              _match_fail("line 16933");
            }
            return _t11785;
          }
          const sorted_11790 = List$sort(_t11783, fields);
          function _t11792(__p418) {
            let _t11794;
            const _t11793 = __p418;
            _t11795: {
              if (true) {
                const name = _t11793[0];
                _t11794 = (Js_codegen$mangle_name(name) + ": null");
                break _t11795;
              }
              _match_fail("line 16933");
            }
            return _t11794;
          }
          const field_strs_11796 = List$map(_t11792, sorted_11790);
          const _t11797 = Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(js_name)) + " = {") + __dict_Show_string.show(String$concat(", ", field_strs_11796))) + "};"));
          const _t11791 = _t11797;
          _t11778 = _t11791;
          break _t11779;
        }
        if (_t11777._tag === 23) {
          const name = _t11777._val[0];
          const payload_opt = _t11777._val[1];
          let _t11798;
          if (Js_codegen$is_newtype_ctor(ctx.type_env, name)) {
            let _t11800;
            const _t11799 = payload_opt;
            _t11801: {
              if (_t11799._tag === 1) {
                const inner = _t11799._val;
                const _t11802 = inner;
                te = _t11802;
                continue;
                _t11800 = undefined;
                break _t11801;
              }
              if (_t11799._tag === 0) {
                _t11800 = Js_codegen$error("cannot create placeholder for nullary newtype constructor");
                break _t11801;
              }
              _match_fail("line 16933");
            }
            _t11798 = _t11800;
          } else {
            let _t11803;
            if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
              _t11803 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
            } else {
              _t11803 = Js_codegen$tag_for_constructor(ctx.type_env, name);
            }
            const tag_11804 = _t11803;
            const sname_11806 = Js_codegen$short_constructor_name(name);
            let _t11809;
            const _t11808 = payload_opt;
            _t11810: {
              if (_t11808._tag === 1) {
                _t11809 = Js_codegen$emit_line(ctx, (((((("let " + __dict_Show_string.show(js_name)) + " = {_tag: ") + __dict_Show_int.show(tag_11804)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11806))) + ", _val: null};"));
                break _t11810;
              }
              if (_t11808._tag === 0) {
                _t11809 = Js_codegen$emit_line(ctx, (((((("let " + __dict_Show_string.show(js_name)) + " = {_tag: ") + __dict_Show_int.show(tag_11804)) + ", _name: ") + __dict_Show_string.show(Js_codegen$escape_js_string(sname_11806))) + "};"));
                break _t11810;
              }
              _match_fail("line 16933");
            }
            const _t11807 = _t11809;
            const _t11805 = _t11807;
            _t11798 = _t11805;
          }
          _t11778 = _t11798;
          break _t11779;
        }
        if (_t11777._tag === 38) {
          const es = _t11777._val;
          function _t11811(_) {
            return "null";
          }
          const nulls_11812 = String$concat(", ", List$map(_t11811, es));
          const _t11813 = Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(js_name)) + " = {_arr: [") + __dict_Show_string.show(nulls_11812)) + "]};"));
          _t11778 = _t11813;
          break _t11779;
        }
        if ((_t11777._tag === 8 || _t11777._tag === 28)) {
          const inner = (_t11777._tag === 8 ? _t11777._val[3] : _t11777._val[1]);
          const _t11814 = inner;
          te = _t11814;
          continue;
          _t11778 = undefined;
          break _t11779;
        }
        if (true) {
          _t11778 = Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(js_name)) + " = null;"));
          break _t11779;
        }
        _match_fail("line 16933");
      }
      return _t11778;
    }
  }
  const _t11815 = go(te);
  return _t11815;
}
function Js_codegen$emit_js_backpatch(ctx, js_name, te) {
  function go(te) {
    while (true) {
      let _t11817;
      const _t11816 = te.expr;
      _t11818: {
        if (_t11816._tag === 21) {
          const computed_11819 = Js_codegen$compile_non_tail(ctx, te);
          const _t11820 = Js_codegen$emit_line(ctx, (((((((__dict_Show_string.show(js_name) + "._hd = ") + __dict_Show_string.show(computed_11819)) + "._hd; ") + __dict_Show_string.show(js_name)) + "._tl = ") + __dict_Show_string.show(computed_11819)) + "._tl;"));
          _t11817 = _t11820;
          break _t11818;
        }
        if (_t11816._tag === 15) {
          const computed_11821 = Js_codegen$compile_non_tail(ctx, te);
          const tmp_11823 = Js_codegen$fresh_tmp(ctx);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(tmp_11823)) + " = ") + __dict_Show_string.show(computed_11821)) + ";"));
          const _t11824 = Js_codegen$emit_line(ctx, (((((("for (let _i = 0; _i < " + __dict_Show_string.show(tmp_11823)) + ".length; _i++) ") + __dict_Show_string.show(js_name)) + "[_i] = ") + __dict_Show_string.show(tmp_11823)) + "[_i];"));
          const _t11822 = _t11824;
          _t11817 = _t11822;
          break _t11818;
        }
        if (_t11816._tag === 16) {
          const computed_11825 = Js_codegen$compile_non_tail(ctx, te);
          const _t11826 = Js_codegen$emit_line(ctx, (((("Object.assign(" + __dict_Show_string.show(js_name)) + ", ") + __dict_Show_string.show(computed_11825)) + ");"));
          _t11817 = _t11826;
          break _t11818;
        }
        if (_t11816._tag === 23) {
          const name = _t11816._val[0];
          if (Js_codegen$is_newtype_ctor(ctx.type_env, name)) {
            const _t11827 = te;
            te = _t11827;
            continue;
            _t11817 = undefined;
            break _t11818;
          }
        }
        if (_t11816._tag === 23) {
          const computed_11828 = Js_codegen$compile_non_tail(ctx, te);
          const tmp_11830 = Js_codegen$fresh_tmp(ctx);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(tmp_11830)) + " = ") + __dict_Show_string.show(computed_11828)) + ";"));
          const _t11831 = Js_codegen$emit_line(ctx, (((((((((((((__dict_Show_string.show(js_name) + "._tag = ") + __dict_Show_string.show(tmp_11830)) + "._tag; ") + __dict_Show_string.show(js_name)) + "._name = ") + __dict_Show_string.show(tmp_11830)) + "._name; if (\"_val\" in ") + __dict_Show_string.show(tmp_11830)) + ") ") + __dict_Show_string.show(js_name)) + "._val = ") + __dict_Show_string.show(tmp_11830)) + "._val;"));
          const _t11829 = _t11831;
          _t11817 = _t11829;
          break _t11818;
        }
        if (_t11816._tag === 38) {
          const computed_11832 = Js_codegen$compile_non_tail(ctx, te);
          const tmp_11834 = Js_codegen$fresh_tmp(ctx);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(tmp_11834)) + " = ") + __dict_Show_string.show(computed_11832)) + ";"));
          const _t11835 = Js_codegen$emit_line(ctx, (((((("for (let _i = 0; _i < " + __dict_Show_string.show(tmp_11834)) + "._arr.length; _i++) ") + __dict_Show_string.show(js_name)) + "._arr[_i] = ") + __dict_Show_string.show(tmp_11834)) + "._arr[_i];"));
          const _t11833 = _t11835;
          _t11817 = _t11833;
          break _t11818;
        }
        if ((_t11816._tag === 8 || _t11816._tag === 28)) {
          const _inner = (_t11816._tag === 8 ? _t11816._val[3] : _t11816._val[1]);
          const computed_11836 = Js_codegen$compile_non_tail(ctx, te);
          const _t11837 = Js_codegen$emit_line(ctx, (((("Object.assign(" + __dict_Show_string.show(js_name)) + ", ") + __dict_Show_string.show(computed_11836)) + ");"));
          _t11817 = _t11837;
          break _t11818;
        }
        if (true) {
          const computed_11838 = Js_codegen$compile_non_tail(ctx, te);
          const _t11839 = Js_codegen$emit_line(ctx, (((("Object.assign(" + __dict_Show_string.show(js_name)) + ", ") + __dict_Show_string.show(computed_11838)) + ");"));
          _t11817 = _t11839;
          break _t11818;
        }
        _match_fail("line 16933");
      }
      return _t11817;
    }
  }
  const _t11840 = go(te);
  return _t11840;
}
function Js_codegen$compile_letrec(ctx, name, fn_expr, body) {
  const js_name_11841 = Js_codegen$mangle_name(name);
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, js_name_11841);
  let _t11844;
  const _t11843 = fn_expr.expr;
  _t11845: {
    if (_t11843._tag === 10) {
      _t11844 = Js_codegen$compile_named_function(ctx, js_name_11841, fn_expr);
      break _t11845;
    }
    if (true) {
      Js_codegen$emit_js_placeholder(ctx, js_name_11841, fn_expr);
      _t11844 = Js_codegen$emit_js_backpatch(ctx, js_name_11841, fn_expr);
      break _t11845;
    }
    _match_fail("line 16933");
  }
  _t11844;
  const result_11846 = Js_codegen$fresh_tmp(ctx);
  const v_11848 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11846)) + " = ") + __dict_Show_string.show(v_11848)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11849 = result_11846;
  const _t11847 = _t11849;
  const _t11842 = _t11847;
  return _t11842;
}
function Js_codegen$compile_letrec_and(ctx, bindings, body) {
  Js_codegen$push_scope(ctx);
  function _t11850(__p419) {
    let _t11852;
    const _t11851 = __p419;
    _t11853: {
      if (true) {
        const name = _t11851[0];
        const te = _t11851[1];
        const js_name_11854 = Js_codegen$mangle_name(name);
        Js_codegen$bind_var(ctx, name, js_name_11854);
        let _t11857;
        const _t11856 = te.expr;
        _t11858: {
          if (_t11856._tag === 10) {
            _t11857 = undefined;
            break _t11858;
          }
          if (true) {
            _t11857 = Js_codegen$emit_js_placeholder(ctx, js_name_11854, te);
            break _t11858;
          }
          _match_fail("line 16933");
        }
        const _t11855 = _t11857;
        _t11852 = _t11855;
        break _t11853;
      }
      _match_fail("line 16933");
    }
    return _t11852;
  }
  List$iter(_t11850, bindings);
  function _t11859(__p420) {
    let _t11861;
    const _t11860 = __p420;
    _t11862: {
      if (true) {
        const name = _t11860[0];
        const fn_expr = _t11860[1];
        const js_name_11863 = Js_codegen$mangle_name(name);
        let _t11866;
        const _t11865 = fn_expr.expr;
        _t11867: {
          if (_t11865._tag === 10) {
            _t11866 = Js_codegen$compile_named_function(ctx, js_name_11863, fn_expr);
            break _t11867;
          }
          if (true) {
            _t11866 = undefined;
            break _t11867;
          }
          _match_fail("line 16933");
        }
        const _t11864 = _t11866;
        _t11861 = _t11864;
        break _t11862;
      }
      _match_fail("line 16933");
    }
    return _t11861;
  }
  List$iter(_t11859, bindings);
  function _t11868(__p421) {
    let _t11870;
    const _t11869 = __p421;
    _t11871: {
      if (true) {
        const name = _t11869[0];
        const te = _t11869[1];
        const js_name_11872 = Js_codegen$mangle_name(name);
        let _t11875;
        const _t11874 = te.expr;
        _t11876: {
          if (_t11874._tag === 10) {
            _t11875 = undefined;
            break _t11876;
          }
          if (true) {
            _t11875 = Js_codegen$emit_js_backpatch(ctx, js_name_11872, te);
            break _t11876;
          }
          _match_fail("line 16933");
        }
        const _t11873 = _t11875;
        _t11870 = _t11873;
        break _t11871;
      }
      _match_fail("line 16933");
    }
    return _t11870;
  }
  List$iter(_t11868, bindings);
  const result_11877 = Js_codegen$fresh_tmp(ctx);
  const v_11879 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_11877)) + " = ") + __dict_Show_string.show(v_11879)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t11880 = result_11877;
  const _t11878 = _t11880;
  return _t11878;
}
function Js_codegen$compile_fun(ctx, param, body, has_return) {
  function collect_params(params, hr, body_expr) {
    while (true) {
      let _t11882;
      const _t11881 = body_expr.expr;
      _t11883: {
        if (_t11881._tag === 10) {
          const p = _t11881._val[0];
          const inner = _t11881._val[1];
          const inner_hr = _t11881._val[2];
          const _t11884 = ({_hd: p, _tl: params});
          const _t11885 = (hr || inner_hr);
          const _t11886 = inner;
          params = _t11884;
          hr = _t11885;
          body_expr = _t11886;
          continue;
          _t11882 = undefined;
          break _t11883;
        }
        if (true) {
          _t11882 = [List$rev(params), hr, body_expr];
          break _t11883;
        }
        _match_fail("line 16933");
      }
      return _t11882;
    }
  }
  let _t11889;
  const _t11888 = collect_params(({_hd: param, _tl: null}), has_return, body);
  _t11890: {
    if (true) {
      const all_params = _t11888[0];
      const has_return = _t11888[1];
      const final_body = _t11888[2];
      const js_params_11891 = Js_codegen$dedup_js_params(List$map(Js_codegen$mangle_name, all_params));
      const fn_name_11893 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_indent(ctx);
      Js_codegen$emit(ctx, (((("function " + __dict_Show_string.show(fn_name_11893)) + "(") + __dict_Show_string.show(String$concat(", ", js_params_11891))) + ") "));
      Js_codegen$emit(ctx, "{\n");
      (ctx.indent = (ctx.indent + 1), undefined);
      Js_codegen$push_scope(ctx);
      function _t11895(mml_name, js_name) {
        return Js_codegen$bind_var(ctx, mml_name, js_name);
      }
      List$iter2(_t11895, all_params, js_params_11891);
      const saved_fn_11896 = ctx.current_fn_name;
      const saved_params_11898 = ctx.current_fn_params;
      const saved_tco_11900 = ctx.tco_used;
      (ctx.current_fn_name = ({_tag: 0, _name: "None"}), undefined);
      (ctx.current_fn_params = null, undefined);
      (ctx.tco_used = false, undefined);
      const saved_ddo_11902 = ctx.direct_dispatch_ops;
      const saved_two_11904 = ctx.trywith_ops;
      (ctx.direct_dispatch_ops = null, undefined);
      (ctx.trywith_ops = null, undefined);
      const is_fold_cb_11906 = ctx.fold_cont_pending;
      (ctx.fold_cont_pending = false, undefined);
      const saved_in_fold_11908 = ctx.in_fold_loop;
      (ctx.in_fold_loop = is_fold_cb_11906, undefined);
      const needs_return_catch_11910 = (has_return && (!is_fold_cb_11906));
      let _t11912;
      if (Js_codegen$expr_has_perform(final_body)) {
        let _t11913;
        if (needs_return_catch_11910) {
          Js_codegen$emit_line(ctx, "try {");
          _t11913 = (ctx.indent = (ctx.indent + 1), undefined);
        } else {
          _t11913 = undefined;
        }
        _t11913;
        Js_codegen$emit_line(ctx, "return _trampoline(function() {");
        (ctx.indent = (ctx.indent + 1), undefined);
        let _t11914;
        if (is_fold_cb_11906) {
          Js_codegen$emit_line(ctx, "try {");
          _t11914 = (ctx.indent = (ctx.indent + 1), undefined);
        } else {
          _t11914 = undefined;
        }
        _t11914;
        function _t11915(v) {
          return Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v)) + ";"));
        }
        Js_codegen$compile_cps(ctx, final_body, _t11915);
        let _t11916;
        if (is_fold_cb_11906) {
          (ctx.indent = (ctx.indent - 1), undefined);
          Js_codegen$emit_line(ctx, "} catch(_e) {");
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$emit_line(ctx, "if (_e && _e._tag === \"_fold_cont\") return _e._val;");
          Js_codegen$emit_line(ctx, "throw _e;");
          (ctx.indent = (ctx.indent - 1), undefined);
          _t11916 = Js_codegen$emit_line(ctx, "}");
        } else {
          _t11916 = undefined;
        }
        _t11916;
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "});");
        let _t11917;
        if (needs_return_catch_11910) {
          (ctx.indent = (ctx.indent - 1), undefined);
          Js_codegen$emit_line(ctx, "} catch(_e) {");
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$emit_line(ctx, "if (_e && _e._tag === \"_return\") return _e._val;");
          Js_codegen$emit_line(ctx, "throw _e;");
          (ctx.indent = (ctx.indent - 1), undefined);
          _t11917 = Js_codegen$emit_line(ctx, "}");
        } else {
          _t11917 = undefined;
        }
        _t11912 = _t11917;
      } else {
        const needs_try_11918 = (is_fold_cb_11906 || has_return);
        let _t11920;
        if (needs_try_11918) {
          Js_codegen$emit_line(ctx, "try {");
          _t11920 = (ctx.indent = (ctx.indent + 1), undefined);
        } else {
          _t11920 = undefined;
        }
        _t11920;
        const v_11921 = Js_codegen$compile_expr(ctx, final_body);
        Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11921)) + ";"));
        let _t11923;
        if (is_fold_cb_11906) {
          (ctx.indent = (ctx.indent - 1), undefined);
          Js_codegen$emit_line(ctx, "} catch(_e) {");
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$emit_line(ctx, "if (_e && _e._tag === \"_fold_cont\") return _e._val;");
          Js_codegen$emit_line(ctx, "throw _e;");
          (ctx.indent = (ctx.indent - 1), undefined);
          _t11923 = Js_codegen$emit_line(ctx, "}");
        } else {
          let _t11924;
          if (has_return) {
            (ctx.indent = (ctx.indent - 1), undefined);
            Js_codegen$emit_line(ctx, "} catch(_e) {");
            (ctx.indent = (ctx.indent + 1), undefined);
            Js_codegen$emit_line(ctx, "if (_e && _e._tag === \"_return\") return _e._val;");
            Js_codegen$emit_line(ctx, "throw _e;");
            (ctx.indent = (ctx.indent - 1), undefined);
            _t11924 = Js_codegen$emit_line(ctx, "}");
          } else {
            _t11924 = undefined;
          }
          _t11923 = _t11924;
        }
        const _t11922 = _t11923;
        const _t11919 = _t11922;
        _t11912 = _t11919;
      }
      _t11912;
      (ctx.in_fold_loop = saved_in_fold_11908, undefined);
      (ctx.direct_dispatch_ops = saved_ddo_11902, undefined);
      (ctx.trywith_ops = saved_two_11904, undefined);
      (ctx.current_fn_name = saved_fn_11896, undefined);
      (ctx.current_fn_params = saved_params_11898, undefined);
      (ctx.tco_used = saved_tco_11900, undefined);
      Js_codegen$pop_scope(ctx);
      (ctx.indent = (ctx.indent - 1), undefined);
      Js_codegen$emit_line(ctx, "}");
      const _t11911 = fn_name_11893;
      const _t11909 = _t11911;
      const _t11907 = _t11909;
      const _t11905 = _t11907;
      const _t11903 = _t11905;
      const _t11901 = _t11903;
      const _t11899 = _t11901;
      const _t11897 = _t11899;
      const _t11894 = _t11897;
      const _t11892 = _t11894;
      _t11889 = _t11892;
      break _t11890;
    }
    _match_fail("line 16933");
  }
  const _t11887 = _t11889;
  return _t11887;
}
function Js_codegen$compile_named_function(ctx, js_name, fn_expr) {
  function collect_params(params, hr, body_expr) {
    while (true) {
      let _t11926;
      const _t11925 = body_expr.expr;
      _t11927: {
        if (_t11925._tag === 10) {
          const p = _t11925._val[0];
          const inner = _t11925._val[1];
          const inner_hr = _t11925._val[2];
          const _t11928 = ({_hd: p, _tl: params});
          const _t11929 = (hr || inner_hr);
          const _t11930 = inner;
          params = _t11928;
          hr = _t11929;
          body_expr = _t11930;
          continue;
          _t11926 = undefined;
          break _t11927;
        }
        if (true) {
          _t11926 = [List$rev(params), hr, body_expr];
          break _t11927;
        }
        _match_fail("line 16933");
      }
      return _t11926;
    }
  }
  let _t11933;
  const _t11932 = fn_expr.expr;
  _t11934: {
    if (_t11932._tag === 10) {
      const param = _t11932._val[0];
      const body = _t11932._val[1];
      const has_return = _t11932._val[2];
      let _t11936;
      const _t11935 = collect_params(({_hd: param, _tl: null}), has_return, body);
      _t11937: {
        if (true) {
          const all_params = _t11935[0];
          const has_return = _t11935[1];
          const final_body = _t11935[2];
          const js_params_11938 = Js_codegen$dedup_js_params(List$map(Js_codegen$mangle_name, all_params));
          Js_codegen$emit_indent(ctx);
          Js_codegen$emit(ctx, (((("function " + __dict_Show_string.show(js_name)) + "(") + __dict_Show_string.show(String$concat(", ", js_params_11938))) + ") "));
          Js_codegen$emit(ctx, "{\n");
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          function _t11940(mml_name, js_nm) {
            return Js_codegen$bind_var(ctx, mml_name, js_nm);
          }
          List$iter2(_t11940, all_params, js_params_11938);
          const saved_fn_11941 = ctx.current_fn_name;
          const saved_params_11943 = ctx.current_fn_params;
          const saved_tco_11945 = ctx.tco_used;
          (ctx.current_fn_name = ({_tag: 1, _name: "Some", _val: js_name}), undefined);
          (ctx.current_fn_params = js_params_11938, undefined);
          (ctx.tco_used = false, undefined);
          (ctx.in_tail_position = true, undefined);
          const saved_ddo_11947 = ctx.direct_dispatch_ops;
          const saved_two_11949 = ctx.trywith_ops;
          (ctx.direct_dispatch_ops = null, undefined);
          (ctx.trywith_ops = null, undefined);
          const body_code_start_11951 = Buffer$length(ctx.buf);
          let _t11953;
          if (Js_codegen$expr_has_perform(final_body)) {
            Js_codegen$emit_line(ctx, "return _trampoline(function() {");
            (ctx.indent = (ctx.indent + 1), undefined);
            function _t11954(v) {
              return Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v)) + ";"));
            }
            Js_codegen$compile_cps(ctx, final_body, _t11954);
            (ctx.indent = (ctx.indent - 1), undefined);
            _t11953 = Js_codegen$emit_line(ctx, (("}, " + __dict_Show_string.show(js_name)) + ");"));
          } else {
            let _t11955;
            if (has_return) {
              Js_codegen$emit_line(ctx, "try {");
              (ctx.indent = (ctx.indent + 1), undefined);
              const v_11956 = Js_codegen$compile_expr(ctx, final_body);
              Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11956)) + ";"));
              (ctx.indent = (ctx.indent - 1), undefined);
              Js_codegen$emit_line(ctx, "} catch(_e) {");
              (ctx.indent = (ctx.indent + 1), undefined);
              Js_codegen$emit_line(ctx, "if (_e && _e._tag === \"_return\") return _e._val;");
              Js_codegen$emit_line(ctx, "throw _e;");
              (ctx.indent = (ctx.indent - 1), undefined);
              const _t11957 = Js_codegen$emit_line(ctx, "}");
              _t11955 = _t11957;
            } else {
              const v_11958 = Js_codegen$compile_expr(ctx, final_body);
              const _t11959 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_11958)) + ";"));
              _t11955 = _t11959;
            }
            _t11953 = _t11955;
          }
          _t11953;
          const tco_was_used_11960 = ctx.tco_used;
          (ctx.direct_dispatch_ops = saved_ddo_11947, undefined);
          (ctx.trywith_ops = saved_two_11949, undefined);
          (ctx.current_fn_name = saved_fn_11941, undefined);
          (ctx.current_fn_params = saved_params_11943, undefined);
          (ctx.tco_used = saved_tco_11945, undefined);
          (ctx.in_tail_position = false, undefined);
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          let _t11962;
          if (tco_was_used_11960) {
            const full_code_11963 = Buffer$contents(ctx.buf);
            const body_code_11965 = String$sub(full_code_11963, body_code_start_11951, (String$length(full_code_11963) - body_code_start_11951));
            const before_body_11967 = String$sub(full_code_11963, 0, body_code_start_11951);
            Buffer$clear(ctx.buf);
            Buffer$add_string(ctx.buf, before_body_11967);
            const indent_str_11969 = String$make(((ctx.indent + 1) * 2), 32);
            Buffer$add_string(ctx.buf, (indent_str_11969 + "while (true) {\n"));
            const body_lines_11971 = String$split("\n", body_code_11965);
            function _t11973(line) {
              let _t11974;
              if ((String$length(line) > 0)) {
                _t11974 = Buffer$add_string(ctx.buf, ("  " + (line + "\n")));
              } else {
                _t11974 = undefined;
              }
              return _t11974;
            }
            List$iter(_t11973, body_lines_11971);
            const _t11972 = Buffer$add_string(ctx.buf, (indent_str_11969 + "}\n"));
            const _t11970 = _t11972;
            const _t11968 = _t11970;
            const _t11966 = _t11968;
            const _t11964 = _t11966;
            _t11962 = _t11964;
          } else {
            _t11962 = undefined;
          }
          _t11962;
          const _t11961 = Js_codegen$emit_line(ctx, "}");
          const _t11952 = _t11961;
          const _t11950 = _t11952;
          const _t11948 = _t11950;
          const _t11946 = _t11948;
          const _t11944 = _t11946;
          const _t11942 = _t11944;
          const _t11939 = _t11942;
          _t11936 = _t11939;
          break _t11937;
        }
        _match_fail("line 16933");
      }
      _t11933 = _t11936;
      break _t11934;
    }
    if (true) {
      const v_11975 = Js_codegen$compile_expr(ctx, fn_expr);
      const _t11976 = Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_name)) + " = ") + __dict_Show_string.show(v_11975)) + ";"));
      _t11933 = _t11976;
      break _t11934;
    }
    _match_fail("line 16933");
  }
  const _t11931 = _t11933;
  return _t11931;
}
function Js_codegen$compile_app(ctx, _te, fn_, arg) {
  function collect_args(expr, acc) {
    while (true) {
      let _t11978;
      const _t11977 = expr.expr;
      _t11979: {
        if (_t11977._tag === 11) {
          const inner_fn = _t11977._val[0];
          const inner_arg = _t11977._val[1];
          const _t11980 = inner_fn;
          const _t11981 = ({_hd: inner_arg, _tl: acc});
          expr = _t11980;
          acc = _t11981;
          continue;
          _t11978 = undefined;
          break _t11979;
        }
        if (true) {
          _t11978 = [expr, acc];
          break _t11979;
        }
        _match_fail("line 16933");
      }
      return _t11978;
    }
  }
  let _t11984;
  const _t11983 = collect_args(fn_, ({_hd: arg, _tl: null}));
  _t11985: {
    if (true) {
      const base_fn = _t11983[0];
      const all_args = _t11983[1];
      const n_11986 = List$length(all_args);
      let _t11989;
      const _t11988 = [ctx.current_fn_name, base_fn.expr];
      _t11990: {
        if (_t11988[0]._tag === 1 && _t11988[1]._tag === 7) {
          const fn_name = _t11988[0]._val;
          const var_name = _t11988[1]._val;
          _t11989 = ((Js_codegen$mangle_name(var_name) === fn_name) && (n_11986 === List$length(ctx.current_fn_params)));
          break _t11990;
        }
        if (true) {
          _t11989 = false;
          break _t11990;
        }
        _match_fail("line 16933");
      }
      const is_self_call_11991 = _t11989;
      let _t11993;
      if ((is_self_call_11991 && ctx.in_tail_position)) {
        (ctx.tco_used = true, undefined);
        function _t11994(a) {
          const tmp_11995 = Js_codegen$fresh_tmp(ctx);
          const v_11997 = Js_codegen$compile_non_tail(ctx, a);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(tmp_11995)) + " = ") + __dict_Show_string.show(v_11997)) + ";"));
          const _t11998 = tmp_11995;
          const _t11996 = _t11998;
          return _t11996;
        }
        const arg_tmps_11999 = List$map(_t11994, all_args);
        function _t12001(param, tmp) {
          return Js_codegen$emit_line(ctx, (((__dict_Show_string.show(param) + " = ") + __dict_Show_string.show(tmp)) + ";"));
        }
        List$iter2(_t12001, ctx.current_fn_params, arg_tmps_11999);
        Js_codegen$emit_line(ctx, "continue;");
        const _t12000 = "undefined";
        _t11993 = _t12000;
      } else {
        const fn_js_12002 = Js_codegen$compile_non_tail(ctx, base_fn);
        const args_js_12004 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), all_args);
        const known_arity_12006 = Js_codegen$count_arrows(base_fn.ty);
        function _t12008(a) {
          let _t12010;
          const _t12009 = a.expr;
          _t12011: {
            if (_t12009._tag === 7) {
              const name = _t12009._val;
              _t12010 = (((String$length(name) >= 7) && (String$sub(name, 0, 7) === "__dict_")) || ((String$length(name) >= 5) && (String$sub(name, 0, 5) === "__ev_")));
              break _t12011;
            }
            if (true) {
              _t12010 = false;
              break _t12011;
            }
            _match_fail("line 16933");
          }
          return _t12010;
        }
        const has_implicit_args_12012 = List$exists(_t12008, all_args);
        let _t12014;
        if ((_eq(known_arity_12006, ({_tag: 1, _name: "Some", _val: n_11986})) && (!has_implicit_args_12012))) {
          _t12014 = (fn_js_12002 + ("(" + (String$concat(", ", args_js_12004) + ")")));
        } else {
          _t12014 = ("_call(" + (fn_js_12002 + (", [" + (String$concat(", ", args_js_12004) + "])"))));
        }
        const _t12013 = _t12014;
        const _t12007 = _t12013;
        const _t12005 = _t12007;
        const _t12003 = _t12005;
        _t11993 = _t12003;
      }
      const _t11992 = _t11993;
      const _t11987 = _t11992;
      _t11984 = _t11987;
      break _t11985;
    }
    _match_fail("line 16933");
  }
  const _t11982 = _t11984;
  return _t11982;
}
function Js_codegen$count_arrows(ty) {
  function go(ty, n) {
    while (true) {
      let _t12016;
      const _t12015 = Types$repr(ty);
      _t12017: {
        if (_t12015._tag === 7) {
          const ret = _t12015._val[2];
          const _t12018 = ret;
          const _t12019 = (n + 1);
          ty = _t12018;
          n = _t12019;
          continue;
          _t12016 = undefined;
          break _t12017;
        }
        if (true) {
          _t12016 = n;
          break _t12017;
        }
        _match_fail("line 16933");
      }
      return _t12016;
    }
  }
  const n_12021 = go(ty, 0);
  let _t12023;
  if ((n_12021 > 0)) {
    _t12023 = ({_tag: 1, _name: "Some", _val: n_12021});
  } else {
    _t12023 = ({_tag: 0, _name: "None"});
  }
  const _t12022 = _t12023;
  const _t12020 = _t12022;
  return _t12020;
}
function Js_codegen$compile_binop(ctx, op, e1, e2) {
  let _t12025;
  const _t12024 = op;
  _t12026: {
    if (_t12024._tag === 11) {
      const a_12027 = Js_codegen$compile_non_tail(ctx, e1);
      const buf_before_12029 = Buffer$length(ctx.buf);
      const b_12031 = Js_codegen$compile_non_tail(ctx, e2);
      let _t12033;
      if ((Buffer$length(ctx.buf) === buf_before_12029)) {
        _t12033 = ("(" + (a_12027 + (" && " + (b_12031 + ")"))));
      } else {
        const stmts_12034 = Buffer$sub(ctx.buf, buf_before_12029, (Buffer$length(ctx.buf) - buf_before_12029));
        Buffer$truncate(ctx.buf, buf_before_12029);
        const result_12036 = Js_codegen$fresh_tmp(ctx);
        Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_12036)) + ";"));
        Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(a_12027)) + ") {"));
        (ctx.indent = (ctx.indent + 1), undefined);
        Buffer$add_string(ctx.buf, stmts_12034);
        Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_12036) + " = ") + __dict_Show_string.show(b_12031)) + ";"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "} else {");
        (ctx.indent = (ctx.indent + 1), undefined);
        Js_codegen$emit_line(ctx, (__dict_Show_string.show(result_12036) + " = false;"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "}");
        const _t12037 = result_12036;
        const _t12035 = _t12037;
        _t12033 = _t12035;
      }
      const _t12032 = _t12033;
      const _t12030 = _t12032;
      const _t12028 = _t12030;
      _t12025 = _t12028;
      break _t12026;
    }
    if (_t12024._tag === 12) {
      const a_12038 = Js_codegen$compile_non_tail(ctx, e1);
      const buf_before_12040 = Buffer$length(ctx.buf);
      const b_12042 = Js_codegen$compile_non_tail(ctx, e2);
      let _t12044;
      if ((Buffer$length(ctx.buf) === buf_before_12040)) {
        _t12044 = ("(" + (a_12038 + (" || " + (b_12042 + ")"))));
      } else {
        const stmts_12045 = Buffer$sub(ctx.buf, buf_before_12040, (Buffer$length(ctx.buf) - buf_before_12040));
        Buffer$truncate(ctx.buf, buf_before_12040);
        const result_12047 = Js_codegen$fresh_tmp(ctx);
        Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_12047)) + ";"));
        Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(a_12038)) + ") {"));
        (ctx.indent = (ctx.indent + 1), undefined);
        Js_codegen$emit_line(ctx, (__dict_Show_string.show(result_12047) + " = true;"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "} else {");
        (ctx.indent = (ctx.indent + 1), undefined);
        Buffer$add_string(ctx.buf, stmts_12045);
        Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_12047) + " = ") + __dict_Show_string.show(b_12042)) + ";"));
        (ctx.indent = (ctx.indent - 1), undefined);
        Js_codegen$emit_line(ctx, "}");
        const _t12048 = result_12047;
        const _t12046 = _t12048;
        _t12044 = _t12046;
      }
      const _t12043 = _t12044;
      const _t12041 = _t12043;
      const _t12039 = _t12041;
      _t12025 = _t12039;
      break _t12026;
    }
    if ((((_t12024._tag === 0 || _t12024._tag === 1) || _t12024._tag === 2) || _t12024._tag === 3)) {
      const resolved_12049 = Types$repr(e1.ty);
      let _t12052;
      const _t12051 = resolved_12049;
      _t12053: {
        if ((_t12051._tag === 0 || _t12051._tag === 1)) {
          const a_12054 = Js_codegen$compile_non_tail(ctx, e1);
          const b_12056 = Js_codegen$compile_non_tail(ctx, e2);
          let _t12059;
          const _t12058 = op;
          _t12060: {
            if (_t12058._tag === 0) {
              _t12059 = "+";
              break _t12060;
            }
            if (_t12058._tag === 1) {
              _t12059 = "-";
              break _t12060;
            }
            if (_t12058._tag === 2) {
              _t12059 = "*";
              break _t12060;
            }
            if (_t12058._tag === 3) {
              _t12059 = "/";
              break _t12060;
            }
            if (true) {
              _t12059 = failwith("assert false");
              break _t12060;
            }
            _match_fail("line 16933");
          }
          const js_op_12061 = _t12059;
          let _t12063;
          if ((_eq(resolved_12049, ({_tag: 0, _name: "TInt"})) && _eq(op, ({_tag: 3, _name: "Div"})))) {
            _t12063 = ("((" + (a_12054 + (" " + (js_op_12061 + (" " + (b_12056 + ") | 0)"))))));
          } else {
            _t12063 = ("(" + (a_12054 + (" " + (js_op_12061 + (" " + (b_12056 + ")"))))));
          }
          const _t12062 = _t12063;
          const _t12057 = _t12062;
          const _t12055 = _t12057;
          _t12052 = _t12055;
          break _t12053;
        }
        if (true) {
          let _t12065;
          const _t12064 = op;
          _t12066: {
            if (_t12064._tag === 0) {
              _t12065 = "+";
              break _t12066;
            }
            if (_t12064._tag === 1) {
              _t12065 = "-";
              break _t12066;
            }
            if (_t12064._tag === 2) {
              _t12065 = "*";
              break _t12066;
            }
            if (_t12064._tag === 3) {
              _t12065 = "/";
              break _t12066;
            }
            if (true) {
              _t12065 = failwith("assert false");
              break _t12066;
            }
            _match_fail("line 16933");
          }
          const method_name_12067 = _t12065;
          const _t12068 = Js_codegen$compile_class_binop(ctx, "Num", method_name_12067, e1, e2);
          _t12052 = _t12068;
          break _t12053;
        }
        _match_fail("line 16933");
      }
      const _t12050 = _t12052;
      _t12025 = _t12050;
      break _t12026;
    }
    if (_t12024._tag === 4) {
      const a_12069 = Js_codegen$compile_non_tail(ctx, e1);
      const b_12071 = Js_codegen$compile_non_tail(ctx, e2);
      const _t12072 = ("(" + (a_12069 + (" % " + (b_12071 + ")"))));
      const _t12070 = _t12072;
      _t12025 = _t12070;
      break _t12026;
    }
    if ((_t12024._tag === 5 || _t12024._tag === 6)) {
      const resolved_12073 = Types$repr(e1.ty);
      let _t12076;
      const _t12075 = resolved_12073;
      _t12077: {
        if (((((((_t12075._tag === 0 || _t12075._tag === 1) || _t12075._tag === 2) || _t12075._tag === 3) || _t12075._tag === 4) || _t12075._tag === 5) || _t12075._tag === 6)) {
          _t12076 = true;
          break _t12077;
        }
        if (true) {
          _t12076 = false;
          break _t12077;
        }
        _match_fail("line 16933");
      }
      const is_primitive_12078 = _t12076;
      const a_12080 = Js_codegen$compile_non_tail(ctx, e1);
      const b_12082 = Js_codegen$compile_non_tail(ctx, e2);
      let _t12084;
      if (is_primitive_12078) {
        let _t12085;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t12085 = "===";
        } else {
          _t12085 = "!==";
        }
        const js_op_12086 = _t12085;
        const _t12087 = ("(" + (a_12080 + (" " + (js_op_12086 + (" " + (b_12082 + ")"))))));
        _t12084 = _t12087;
      } else {
        const eq_call_12088 = ("_eq(" + (a_12080 + (", " + (b_12082 + ")"))));
        let _t12090;
        if (_eq(op, ({_tag: 5, _name: "Eq"}))) {
          _t12090 = eq_call_12088;
        } else {
          _t12090 = ("!" + eq_call_12088);
        }
        const _t12089 = _t12090;
        _t12084 = _t12089;
      }
      const _t12083 = _t12084;
      const _t12081 = _t12083;
      const _t12079 = _t12081;
      const _t12074 = _t12079;
      _t12025 = _t12074;
      break _t12026;
    }
    if ((((_t12024._tag === 7 || _t12024._tag === 8) || _t12024._tag === 9) || _t12024._tag === 10)) {
      const resolved_12091 = Types$repr(e1.ty);
      let _t12094;
      const _t12093 = resolved_12091;
      _t12095: {
        if ((((((_t12093._tag === 0 || _t12093._tag === 1) || _t12093._tag === 3) || _t12093._tag === 4) || _t12093._tag === 5) || _t12093._tag === 15 && _t12093._val.contents._tag === 0)) {
          _t12094 = true;
          break _t12095;
        }
        if (true) {
          _t12094 = false;
          break _t12095;
        }
        _match_fail("line 16933");
      }
      const is_builtin_12096 = _t12094;
      let _t12098;
      if (is_builtin_12096) {
        const a_12099 = Js_codegen$compile_non_tail(ctx, e1);
        const b_12101 = Js_codegen$compile_non_tail(ctx, e2);
        let _t12104;
        const _t12103 = op;
        _t12105: {
          if (_t12103._tag === 7) {
            _t12104 = "<";
            break _t12105;
          }
          if (_t12103._tag === 8) {
            _t12104 = ">";
            break _t12105;
          }
          if (_t12103._tag === 9) {
            _t12104 = "<=";
            break _t12105;
          }
          if (_t12103._tag === 10) {
            _t12104 = ">=";
            break _t12105;
          }
          if (true) {
            _t12104 = failwith("assert false");
            break _t12105;
          }
          _match_fail("line 16933");
        }
        const js_op_12106 = _t12104;
        const _t12107 = ("(" + (a_12099 + (" " + (js_op_12106 + (" " + (b_12101 + ")"))))));
        const _t12102 = _t12107;
        const _t12100 = _t12102;
        _t12098 = _t12100;
      } else {
        let _t12109;
        const _t12108 = op;
        _t12110: {
          if (_t12108._tag === 7) {
            _t12109 = "<";
            break _t12110;
          }
          if (_t12108._tag === 8) {
            _t12109 = ">";
            break _t12110;
          }
          if (_t12108._tag === 9) {
            _t12109 = "<=";
            break _t12110;
          }
          if (_t12108._tag === 10) {
            _t12109 = ">=";
            break _t12110;
          }
          if (true) {
            _t12109 = failwith("assert false");
            break _t12110;
          }
          _match_fail("line 16933");
        }
        const method_name_12111 = _t12109;
        const _t12112 = Js_codegen$compile_class_binop(ctx, "Ord", method_name_12111, e1, e2);
        _t12098 = _t12112;
      }
      const _t12097 = _t12098;
      const _t12092 = _t12097;
      _t12025 = _t12092;
      break _t12026;
    }
    if (_t12024._tag === 13) {
      const a_12113 = Js_codegen$compile_non_tail(ctx, e1);
      const b_12115 = Js_codegen$compile_non_tail(ctx, e2);
      const _t12116 = ("(" + (a_12113 + (" + " + (b_12115 + ")"))));
      const _t12114 = _t12116;
      _t12025 = _t12114;
      break _t12026;
    }
    if (((((_t12024._tag === 14 || _t12024._tag === 15) || _t12024._tag === 16) || _t12024._tag === 17) || _t12024._tag === 18)) {
      const resolved_12117 = Types$repr(e1.ty);
      let _t12120;
      const _t12119 = resolved_12117;
      _t12121: {
        if (_t12119._tag === 0) {
          const a_12122 = Js_codegen$compile_non_tail(ctx, e1);
          const b_12124 = Js_codegen$compile_non_tail(ctx, e2);
          let _t12127;
          const _t12126 = op;
          _t12128: {
            if (_t12126._tag === 14) {
              _t12127 = "&";
              break _t12128;
            }
            if (_t12126._tag === 15) {
              _t12127 = "|";
              break _t12128;
            }
            if (_t12126._tag === 16) {
              _t12127 = "^";
              break _t12128;
            }
            if (_t12126._tag === 17) {
              _t12127 = "<<";
              break _t12128;
            }
            if (_t12126._tag === 18) {
              _t12127 = ">>";
              break _t12128;
            }
            if (true) {
              _t12127 = failwith("assert false");
              break _t12128;
            }
            _match_fail("line 16933");
          }
          const js_op_12129 = _t12127;
          const _t12130 = ("(" + (a_12122 + (" " + (js_op_12129 + (" " + (b_12124 + ")"))))));
          const _t12125 = _t12130;
          const _t12123 = _t12125;
          _t12120 = _t12123;
          break _t12121;
        }
        if (true) {
          let _t12132;
          const _t12131 = op;
          _t12133: {
            if (_t12131._tag === 14) {
              _t12132 = "land";
              break _t12133;
            }
            if (_t12131._tag === 15) {
              _t12132 = "lor";
              break _t12133;
            }
            if (_t12131._tag === 16) {
              _t12132 = "lxor";
              break _t12133;
            }
            if (_t12131._tag === 17) {
              _t12132 = "lsl";
              break _t12133;
            }
            if (_t12131._tag === 18) {
              _t12132 = "lsr";
              break _t12133;
            }
            if (true) {
              _t12132 = failwith("assert false");
              break _t12133;
            }
            _match_fail("line 16933");
          }
          const method_name_12134 = _t12132;
          const _t12135 = Js_codegen$compile_class_binop(ctx, "Bitwise", method_name_12134, e1, e2);
          _t12120 = _t12135;
          break _t12121;
        }
        _match_fail("line 16933");
      }
      const _t12118 = _t12120;
      _t12025 = _t12118;
      break _t12026;
    }
    if (_t12024._tag === 19) {
      const fn_js_12136 = Js_codegen$compile_non_tail(ctx, e2);
      const arg_js_12138 = Js_codegen$compile_non_tail(ctx, e1);
      const _t12139 = ("_call(" + (fn_js_12136 + (", [" + (arg_js_12138 + "])"))));
      const _t12137 = _t12139;
      _t12025 = _t12137;
      break _t12026;
    }
    _match_fail("line 16933");
  }
  return _t12025;
}
function Js_codegen$compile_class_binop(ctx, class_name, method_name, e1, e2) {
  const conc_ty_12140 = Types$repr(e1.ty);
  function _t12142(c) {
    return (c.class_name === class_name);
  }
  let _t12144;
  const _t12143 = List$find(_t12142, ctx.type_env.classes);
  _t12145: {
    if (_t12143._tag === 1) {
      const cd = _t12143._val;
      _t12144 = cd;
      break _t12145;
    }
    if (_t12143._tag === 0) {
      _t12144 = Js_codegen$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t12145;
    }
    _match_fail("line 16933");
  }
  const class_def_12146 = _t12144;
  const num_params_12148 = List$length(class_def_12146.class_params);
  function _t12150(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_12140});
  }
  const partial_12151 = List$init(num_params_12148, _t12150);
  function _t12153(opt) {
    let _t12155;
    const _t12154 = opt;
    _t12156: {
      if (_t12154._tag === 1) {
        const ty = _t12154._val;
        let _t12158;
        const _t12157 = Types$repr(ty);
        _t12159: {
          if (_t12157._tag === 15 && _t12157._val.contents._tag === 0) {
            _t12158 = ({_tag: 0, _name: "None"});
            break _t12159;
          }
          if (true) {
            _t12158 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t12159;
          }
          _match_fail("line 16933");
        }
        _t12155 = _t12158;
        break _t12156;
      }
      if (_t12154._tag === 0) {
        _t12155 = ({_tag: 0, _name: "None"});
        break _t12156;
      }
      _match_fail("line 16933");
    }
    return _t12155;
  }
  const concrete_partial_12160 = List$map(_t12153, partial_12151);
  function _t12162(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_12148) && Types$match_partial_inst(inst.inst_tys, concrete_partial_12160)));
  }
  const matching_12163 = List$filter(_t12162, ctx.type_env.instances);
  let _t12166;
  const _t12165 = matching_12163;
  _t12167: {
    if (_t12165 !== null && _t12165._tl === null) {
      const inst = _t12165._hd;
      const dict_access_12168 = (Js_codegen$mangle_name(inst.inst_dict_name) + ("." + Js_codegen$mangle_name(method_name)));
      const a_12170 = Js_codegen$compile_non_tail(ctx, e1);
      const b_12172 = Js_codegen$compile_non_tail(ctx, e2);
      const _t12173 = ("_call(" + (dict_access_12168 + (", [" + (a_12170 + (", " + (b_12172 + "])"))))));
      const _t12171 = _t12173;
      const _t12169 = _t12171;
      _t12166 = _t12169;
      break _t12167;
    }
    if (_t12165 === null) {
      _t12166 = Js_codegen$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_12140))));
      break _t12167;
    }
    if (true) {
      let _t12175;
      const _t12174 = Types$most_specific_inst(matching_12163);
      _t12176: {
        if (_t12174._tag === 1) {
          const inst = _t12174._val;
          let _t12177;
          if (_eq(inst.inst_constraints, null)) {
            _t12177 = Js_codegen$mangle_name((inst.inst_dict_name + ("$" + method_name)));
          } else {
            _t12177 = (Js_codegen$mangle_name(inst.inst_dict_name) + ("." + Js_codegen$mangle_name(method_name)));
          }
          const dict_access_12178 = _t12177;
          const a_12180 = Js_codegen$compile_non_tail(ctx, e1);
          const b_12182 = Js_codegen$compile_non_tail(ctx, e2);
          const _t12183 = ("_call(" + (dict_access_12178 + (", [" + (a_12180 + (", " + (b_12182 + "])"))))));
          const _t12181 = _t12183;
          const _t12179 = _t12181;
          _t12175 = _t12179;
          break _t12176;
        }
        if (_t12174._tag === 0) {
          _t12175 = Js_codegen$error(((("ambiguous instance for " + __dict_Show_string.show(class_name)) + " method ") + __dict_Show_string.show(method_name)));
          break _t12176;
        }
        _match_fail("line 16933");
      }
      _t12166 = _t12175;
      break _t12167;
    }
    _match_fail("line 16933");
  }
  const _t12164 = _t12166;
  const _t12161 = _t12164;
  const _t12152 = _t12161;
  const _t12149 = _t12152;
  const _t12147 = _t12149;
  const _t12141 = _t12147;
  return _t12141;
}
function Js_codegen$compile_unop(ctx, op, e) {
  let _t12185;
  const _t12184 = op;
  _t12186: {
    if (_t12184._tag === 0) {
      const resolved_12187 = Types$repr(e.ty);
      let _t12190;
      const _t12189 = resolved_12187;
      _t12191: {
        if ((_t12189._tag === 0 || _t12189._tag === 1)) {
          const v_12192 = Js_codegen$compile_non_tail(ctx, e);
          const _t12193 = ("(-" + (v_12192 + ")"));
          _t12190 = _t12193;
          break _t12191;
        }
        if (true) {
          _t12190 = Js_codegen$compile_class_unop(ctx, "Num", "neg", e);
          break _t12191;
        }
        _match_fail("line 16933");
      }
      const _t12188 = _t12190;
      _t12185 = _t12188;
      break _t12186;
    }
    if (_t12184._tag === 1) {
      const v_12194 = Js_codegen$compile_non_tail(ctx, e);
      const _t12195 = ("(!" + (v_12194 + ")"));
      _t12185 = _t12195;
      break _t12186;
    }
    if (_t12184._tag === 2) {
      const resolved_12196 = Types$repr(e.ty);
      let _t12199;
      const _t12198 = resolved_12196;
      _t12200: {
        if (_t12198._tag === 0) {
          const v_12201 = Js_codegen$compile_non_tail(ctx, e);
          const _t12202 = ("(~" + (v_12201 + ")"));
          _t12199 = _t12202;
          break _t12200;
        }
        if (true) {
          _t12199 = Js_codegen$compile_class_unop(ctx, "Bitwise", "lnot", e);
          break _t12200;
        }
        _match_fail("line 16933");
      }
      const _t12197 = _t12199;
      _t12185 = _t12197;
      break _t12186;
    }
    _match_fail("line 16933");
  }
  return _t12185;
}
function Js_codegen$compile_class_unop(ctx, class_name, method_name, e) {
  const conc_ty_12203 = Types$repr(e.ty);
  function _t12205(c) {
    return (c.class_name === class_name);
  }
  let _t12207;
  const _t12206 = List$find(_t12205, ctx.type_env.classes);
  _t12208: {
    if (_t12206._tag === 1) {
      const cd = _t12206._val;
      _t12207 = cd;
      break _t12208;
    }
    if (_t12206._tag === 0) {
      _t12207 = Js_codegen$error((("class " + __dict_Show_string.show(class_name)) + " not found"));
      break _t12208;
    }
    _match_fail("line 16933");
  }
  const class_def_12209 = _t12207;
  const num_params_12211 = List$length(class_def_12209.class_params);
  function _t12213(_) {
    return ({_tag: 1, _name: "Some", _val: conc_ty_12203});
  }
  const partial_12214 = List$init(num_params_12211, _t12213);
  function _t12216(opt) {
    let _t12218;
    const _t12217 = opt;
    _t12219: {
      if (_t12217._tag === 1) {
        const ty = _t12217._val;
        let _t12221;
        const _t12220 = Types$repr(ty);
        _t12222: {
          if (_t12220._tag === 15 && _t12220._val.contents._tag === 0) {
            _t12221 = ({_tag: 0, _name: "None"});
            break _t12222;
          }
          if (true) {
            _t12221 = ({_tag: 1, _name: "Some", _val: Types$repr(ty)});
            break _t12222;
          }
          _match_fail("line 16933");
        }
        _t12218 = _t12221;
        break _t12219;
      }
      if (_t12217._tag === 0) {
        _t12218 = ({_tag: 0, _name: "None"});
        break _t12219;
      }
      _match_fail("line 16933");
    }
    return _t12218;
  }
  const concrete_partial_12223 = List$map(_t12216, partial_12214);
  function _t12225(inst) {
    return ((inst.inst_class === class_name) && ((List$length(inst.inst_tys) === num_params_12211) && Types$match_partial_inst(inst.inst_tys, concrete_partial_12223)));
  }
  const matching_12226 = List$filter(_t12225, ctx.type_env.instances);
  let _t12229;
  const _t12228 = matching_12226;
  _t12230: {
    if (_t12228 !== null && _t12228._tl === null) {
      const inst = _t12228._hd;
      const dict_access_12231 = (Js_codegen$mangle_name(inst.inst_dict_name) + ("." + Js_codegen$mangle_name(method_name)));
      const v_12233 = Js_codegen$compile_non_tail(ctx, e);
      const _t12234 = ("_call(" + (dict_access_12231 + (", [" + (v_12233 + "])"))));
      const _t12232 = _t12234;
      _t12229 = _t12232;
      break _t12230;
    }
    if (_t12228 === null) {
      _t12229 = Js_codegen$error(((("no instance of " + __dict_Show_string.show(class_name)) + " for type ") + __dict_Show_string.show(Types$pp_ty(conc_ty_12203))));
      break _t12230;
    }
    if (true) {
      _t12229 = Js_codegen$error(("ambiguous instance for " + __dict_Show_string.show(class_name)));
      break _t12230;
    }
    _match_fail("line 16933");
  }
  const _t12227 = _t12229;
  const _t12224 = _t12227;
  const _t12215 = _t12224;
  const _t12212 = _t12215;
  const _t12210 = _t12212;
  const _t12204 = _t12210;
  return _t12204;
}
function Js_codegen$compile_if(ctx, cond, then_e, else_e) {
  const c_12235 = Js_codegen$compile_expr(ctx, cond);
  const result_12237 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_12237)) + ";"));
  Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(c_12235)) + ") {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  const t_12239 = Js_codegen$compile_expr(ctx, then_e);
  Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_12237) + " = ") + __dict_Show_string.show(t_12239)) + ";"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "} else {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const e_12241 = Js_codegen$compile_expr(ctx, else_e);
  Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_12237) + " = ") + __dict_Show_string.show(e_12241)) + ";"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  const _t12242 = result_12237;
  const _t12240 = _t12242;
  const _t12238 = _t12240;
  const _t12236 = _t12238;
  return _t12236;
}
function Js_codegen$compile_seq(ctx, e1, e2) {
  const v1_12243 = Js_codegen$compile_non_tail(ctx, e1);
  Js_codegen$emit_line(ctx, (v1_12243 + ";"));
  const _t12244 = Js_codegen$compile_expr(ctx, e2);
  return _t12244;
}
function Js_codegen$compile_let_mut(ctx, name, init, body) {
  const v_12245 = Js_codegen$compile_expr(ctx, init);
  const js_name_12247 = Js_codegen$mangle_name(name);
  const actual_name_12249 = (js_name_12247 + ("_" + string_of_int(ctx.tmp_counter)));
  (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, actual_name_12249);
  Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(actual_name_12249)) + " = ") + __dict_Show_string.show(v_12245)) + ";"));
  const result_12251 = Js_codegen$fresh_tmp(ctx);
  const b_12253 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_12251)) + " = ") + __dict_Show_string.show(b_12253)) + ";"));
  Js_codegen$pop_scope(ctx);
  const _t12254 = result_12251;
  const _t12252 = _t12254;
  const _t12250 = _t12252;
  const _t12248 = _t12250;
  const _t12246 = _t12248;
  return _t12246;
}
function Js_codegen$compile_while(ctx, cond, body) {
  const result_12255 = Js_codegen$fresh_tmp(ctx);
  const break_flag_12257 = Js_codegen$fresh_tmp(ctx);
  const break_val_12259 = Js_codegen$fresh_tmp(ctx);
  const saved_break_flag_12261 = ctx.break_flag_name;
  const saved_break_val_12263 = ctx.break_val_name;
  const saved_in_fold_12265 = ctx.in_fold_loop;
  (ctx.break_flag_name = break_flag_12257, undefined);
  (ctx.break_val_name = break_val_12259, undefined);
  (ctx.in_fold_loop = false, undefined);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_12255)) + " = undefined;"));
  Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(break_flag_12257)) + " = false, ") + __dict_Show_string.show(break_val_12259)) + ";"));
  Js_codegen$emit_line(ctx, "while (true) {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const c_12267 = Js_codegen$compile_expr(ctx, cond);
  Js_codegen$emit_line(ctx, (("if (!(" + __dict_Show_string.show(c_12267)) + ")) break;"));
  const v_body_12269 = Js_codegen$compile_expr(ctx, body);
  Js_codegen$emit_line(ctx, (v_body_12269 + ";"));
  Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(break_flag_12257)) + ") break;"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  Js_codegen$emit_line(ctx, (((((__dict_Show_string.show(result_12255) + " = ") + __dict_Show_string.show(break_flag_12257)) + " ? ") + __dict_Show_string.show(break_val_12259)) + " : undefined;"));
  (ctx.break_flag_name = saved_break_flag_12261, undefined);
  (ctx.break_val_name = saved_break_val_12263, undefined);
  (ctx.in_fold_loop = saved_in_fold_12265, undefined);
  const _t12270 = result_12255;
  const _t12268 = _t12270;
  const _t12266 = _t12268;
  const _t12264 = _t12266;
  const _t12262 = _t12264;
  const _t12260 = _t12262;
  const _t12258 = _t12260;
  const _t12256 = _t12258;
  return _t12256;
}
function Js_codegen$compile_match(ctx, scrut, arms, loc) {
  const scrut_js_12271 = Js_codegen$compile_non_tail(ctx, scrut);
  const scrut_tmp_12273 = Js_codegen$fresh_tmp(ctx);
  const result_12275 = Js_codegen$fresh_tmp(ctx);
  const label_12277 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(result_12275)) + ";"));
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(scrut_tmp_12273)) + " = ") + __dict_Show_string.show(scrut_js_12271)) + ";"));
  Js_codegen$emit_line(ctx, (__dict_Show_string.show(label_12277) + ": {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  function _t12279(__p422) {
    let _t12281;
    const _t12280 = __p422;
    _t12282: {
      if (true) {
        const pat = _t12280[0];
        const guard = _t12280[1];
        const body = _t12280[2];
        let _t12284;
        const _t12283 = Js_codegen$compile_pattern(ctx, scrut_tmp_12273, pat);
        _t12285: {
          if (true) {
            const conds = _t12283[0];
            const bindings = _t12283[1];
            let _t12287;
            const _t12286 = conds;
            _t12288: {
              if (_t12286 === null) {
                _t12287 = "true";
                break _t12288;
              }
              if (true) {
                _t12287 = String$concat(" && ", conds);
                break _t12288;
              }
              _match_fail("line 16933");
            }
            const cond_str_12289 = _t12287;
            Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(cond_str_12289)) + ") {"));
            (ctx.indent = (ctx.indent + 1), undefined);
            Js_codegen$push_scope(ctx);
            function _t12291(__p423) {
              let _t12293;
              const _t12292 = __p423;
              _t12294: {
                if (true) {
                  const mml_name = _t12292[0];
                  const js_expr = _t12292[1];
                  const js_name_12295 = Js_codegen$mangle_name(mml_name);
                  Js_codegen$bind_var(ctx, mml_name, js_name_12295);
                  const _t12296 = Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_name_12295)) + " = ") + __dict_Show_string.show(js_expr)) + ";"));
                  _t12293 = _t12296;
                  break _t12294;
                }
                _match_fail("line 16933");
              }
              return _t12293;
            }
            List$iter(_t12291, bindings);
            let _t12298;
            const _t12297 = guard;
            _t12299: {
              if (_t12297._tag === 1) {
                const g = _t12297._val;
                const guard_js_12300 = Js_codegen$compile_expr(ctx, g);
                Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(guard_js_12300)) + ") {"));
                (ctx.indent = (ctx.indent + 1), undefined);
                const b_12302 = Js_codegen$compile_expr(ctx, body);
                Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_12275) + " = ") + __dict_Show_string.show(b_12302)) + ";"));
                Js_codegen$emit_line(ctx, (("break " + __dict_Show_string.show(label_12277)) + ";"));
                (ctx.indent = (ctx.indent - 1), undefined);
                const _t12303 = Js_codegen$emit_line(ctx, "}");
                const _t12301 = _t12303;
                _t12298 = _t12301;
                break _t12299;
              }
              if (_t12297._tag === 0) {
                const b_12304 = Js_codegen$compile_expr(ctx, body);
                Js_codegen$emit_line(ctx, (((__dict_Show_string.show(result_12275) + " = ") + __dict_Show_string.show(b_12304)) + ";"));
                const _t12305 = Js_codegen$emit_line(ctx, (("break " + __dict_Show_string.show(label_12277)) + ";"));
                _t12298 = _t12305;
                break _t12299;
              }
              _match_fail("line 16933");
            }
            _t12298;
            Js_codegen$pop_scope(ctx);
            (ctx.indent = (ctx.indent - 1), undefined);
            const _t12290 = Js_codegen$emit_line(ctx, "}");
            _t12284 = _t12290;
            break _t12285;
          }
          _match_fail("line 16933");
        }
        _t12281 = _t12284;
        break _t12282;
      }
      _match_fail("line 16933");
    }
    return _t12281;
  }
  List$iter(_t12279, arms);
  Js_codegen$emit_line(ctx, (("_match_fail(\"line " + __dict_Show_int.show(loc.line)) + "\");"));
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  const _t12278 = result_12275;
  const _t12276 = _t12278;
  const _t12274 = _t12276;
  const _t12272 = _t12274;
  return _t12272;
}
function Js_codegen$compile_pattern(ctx, scrutinee, pat) {
  while (true) {
    let _t12307;
    const _t12306 = pat;
    _t12308: {
      if (_t12306._tag === 0) {
        _t12307 = [null, null];
        break _t12308;
      }
      if (_t12306._tag === 1) {
        const name = _t12306._val;
        _t12307 = [null, ({_hd: [name, scrutinee], _tl: null})];
        break _t12308;
      }
      if (_t12306._tag === 2) {
        const n = _t12306._val;
        _t12307 = [({_hd: ((__dict_Show_string.show(scrutinee) + " === ") + __dict_Show_int.show(n)), _tl: null}), null];
        break _t12308;
      }
      if (_t12306._tag === 3) {
        const f = _t12306._val;
        _t12307 = [({_hd: ((__dict_Show_string.show(scrutinee) + " === ") + __dict_Show_string.show(__dict_Show_float.show(f))), _tl: null}), null];
        break _t12308;
      }
      if (_t12306._tag === 4 && _t12306._val) {
        _t12307 = [({_hd: scrutinee, _tl: null}), null];
        break _t12308;
      }
      if (_t12306._tag === 4 && !_t12306._val) {
        _t12307 = [({_hd: ("!" + scrutinee), _tl: null}), null];
        break _t12308;
      }
      if (_t12306._tag === 5) {
        const s = _t12306._val;
        _t12307 = [({_hd: ((__dict_Show_string.show(scrutinee) + " === ") + __dict_Show_string.show(Js_codegen$escape_js_string(s))), _tl: null}), null];
        break _t12308;
      }
      if (_t12306._tag === 6) {
        _t12307 = [null, null];
        break _t12308;
      }
      if (_t12306._tag === 9) {
        _t12307 = [({_hd: (scrutinee + " === null"), _tl: null}), null];
        break _t12308;
      }
      if (_t12306._tag === 8) {
        const hd_pat = _t12306._val[0];
        const tl_pat = _t12306._val[1];
        const hd_expr_12309 = (scrutinee + "._hd");
        const tl_expr_12311 = (scrutinee + "._tl");
        let _t12314;
        const _t12313 = Js_codegen$compile_pattern(ctx, hd_expr_12309, hd_pat);
        _t12315: {
          if (true) {
            const hd_conds = _t12313[0];
            const hd_binds = _t12313[1];
            let _t12317;
            const _t12316 = Js_codegen$compile_pattern(ctx, tl_expr_12311, tl_pat);
            _t12318: {
              if (true) {
                const tl_conds = _t12316[0];
                const tl_binds = _t12316[1];
                const conds_12319 = List$concat(({_hd: (scrutinee + " !== null"), _tl: hd_conds}), tl_conds);
                const _t12320 = [conds_12319, List$concat(hd_binds, tl_binds)];
                _t12317 = _t12320;
                break _t12318;
              }
              _match_fail("line 16933");
            }
            _t12314 = _t12317;
            break _t12315;
          }
          _match_fail("line 16933");
        }
        const _t12312 = _t12314;
        const _t12310 = _t12312;
        _t12307 = _t12310;
        break _t12308;
      }
      if (_t12306._tag === 7) {
        const pats = _t12306._val;
        const all_conds_12321 = Ref$create(null);
        const all_binds_12323 = Ref$create(null);
        function _t12325(i, sub_pat) {
          const elem_expr_12326 = (((__dict_Show_string.show(scrutinee) + "[") + __dict_Show_int.show(i)) + "]");
          let _t12329;
          const _t12328 = Js_codegen$compile_pattern(ctx, elem_expr_12326, sub_pat);
          _t12330: {
            if (true) {
              const c = _t12328[0];
              const b = _t12328[1];
              Ref$set(all_conds_12321, List$concat(Ref$get(all_conds_12321), c));
              _t12329 = Ref$set(all_binds_12323, List$concat(Ref$get(all_binds_12323), b));
              break _t12330;
            }
            _match_fail("line 16933");
          }
          const _t12327 = _t12329;
          return _t12327;
        }
        List$iteri(_t12325, pats);
        const _t12324 = [Ref$get(all_conds_12321), Ref$get(all_binds_12323)];
        const _t12322 = _t12324;
        _t12307 = _t12322;
        break _t12308;
      }
      if (_t12306._tag === 10) {
        const name = _t12306._val[0];
        const arg_pat = _t12306._val[1];
        if (Js_codegen$is_newtype_ctor(ctx.type_env, name)) {
          let _t12332;
          const _t12331 = arg_pat;
          _t12333: {
            if (_t12331._tag === 1) {
              const sub_pat = _t12331._val;
              const _t12334 = ctx;
              const _t12335 = scrutinee;
              const _t12336 = sub_pat;
              ctx = _t12334;
              scrutinee = _t12335;
              pat = _t12336;
              continue;
              _t12332 = undefined;
              break _t12333;
            }
            if (_t12331._tag === 0) {
              _t12332 = [null, null];
              break _t12333;
            }
            _match_fail("line 16933");
          }
          _t12307 = _t12332;
          break _t12308;
        }
      }
      if (_t12306._tag === 10) {
        const name = _t12306._val[0];
        const arg_pat = _t12306._val[1];
        let _t12337;
        if (((String$length(name) > 0) && (String$get(name, 0) === 96))) {
          _t12337 = (__dict_Hash_string.hash(String$sub(name, 1, (String$length(name) - 1))) & 1073741823);
        } else {
          _t12337 = Js_codegen$tag_for_constructor(ctx.type_env, name);
        }
        const tag_12338 = _t12337;
        const conds_12340 = ({_hd: ((__dict_Show_string.show(scrutinee) + "._tag === ") + __dict_Show_int.show(tag_12338)), _tl: null});
        let _t12343;
        const _t12342 = arg_pat;
        _t12344: {
          if (_t12342._tag === 0) {
            _t12343 = [conds_12340, null];
            break _t12344;
          }
          if (_t12342._tag === 1) {
            const sub_pat = _t12342._val;
            const payload_expr_12345 = (scrutinee + "._val");
            let _t12348;
            const _t12347 = Js_codegen$compile_pattern(ctx, payload_expr_12345, sub_pat);
            _t12349: {
              if (true) {
                const sub_conds = _t12347[0];
                const sub_binds = _t12347[1];
                _t12348 = [List$concat(conds_12340, sub_conds), sub_binds];
                break _t12349;
              }
              _match_fail("line 16933");
            }
            const _t12346 = _t12348;
            _t12343 = _t12346;
            break _t12344;
          }
          _match_fail("line 16933");
        }
        const _t12341 = _t12343;
        const _t12339 = _t12341;
        _t12307 = _t12339;
        break _t12308;
      }
      if (_t12306._tag === 11) {
        const field_pats = _t12306._val;
        const all_conds_12350 = Ref$create(null);
        const all_binds_12352 = Ref$create(null);
        function _t12354(__p424) {
          let _t12356;
          const _t12355 = __p424;
          _t12357: {
            if (true) {
              const fname = _t12355[0];
              const sub_pat = _t12355[1];
              const field_expr_12358 = (scrutinee + ("." + Js_codegen$mangle_name(fname)));
              let _t12361;
              const _t12360 = Js_codegen$compile_pattern(ctx, field_expr_12358, sub_pat);
              _t12362: {
                if (true) {
                  const c = _t12360[0];
                  const b = _t12360[1];
                  Ref$set(all_conds_12350, List$concat(Ref$get(all_conds_12350), c));
                  _t12361 = Ref$set(all_binds_12352, List$concat(Ref$get(all_binds_12352), b));
                  break _t12362;
                }
                _match_fail("line 16933");
              }
              const _t12359 = _t12361;
              _t12356 = _t12359;
              break _t12357;
            }
            _match_fail("line 16933");
          }
          return _t12356;
        }
        List$iter(_t12354, field_pats);
        const _t12353 = [Ref$get(all_conds_12350), Ref$get(all_binds_12352)];
        const _t12351 = _t12353;
        _t12307 = _t12351;
        break _t12308;
      }
      if (_t12306._tag === 12) {
        const inner_pat = _t12306._val[0];
        const name = _t12306._val[1];
        let _t12364;
        const _t12363 = Js_codegen$compile_pattern(ctx, scrutinee, inner_pat);
        _t12365: {
          if (true) {
            const conds = _t12363[0];
            const binds = _t12363[1];
            _t12364 = [conds, List$concat(binds, ({_hd: [name, scrutinee], _tl: null}))];
            break _t12365;
          }
          _match_fail("line 16933");
        }
        _t12307 = _t12364;
        break _t12308;
      }
      if (_t12306._tag === 13) {
        const p1 = _t12306._val[0];
        const p2 = _t12306._val[1];
        let _t12367;
        const _t12366 = Js_codegen$compile_pattern(ctx, scrutinee, p1);
        _t12368: {
          if (true) {
            const conds1 = _t12366[0];
            const binds1 = _t12366[1];
            let _t12370;
            const _t12369 = Js_codegen$compile_pattern(ctx, scrutinee, p2);
            _t12371: {
              if (true) {
                const conds2 = _t12369[0];
                const binds2 = _t12369[1];
                let _t12373;
                const _t12372 = conds1;
                _t12374: {
                  if (_t12372 === null) {
                    _t12373 = "true";
                    break _t12374;
                  }
                  if (true) {
                    const cs = _t12372;
                    _t12373 = String$concat(" && ", cs);
                    break _t12374;
                  }
                  _match_fail("line 16933");
                }
                const cond1_12375 = _t12373;
                let _t12378;
                const _t12377 = conds2;
                _t12379: {
                  if (_t12377 === null) {
                    _t12378 = "true";
                    break _t12379;
                  }
                  if (true) {
                    const cs = _t12377;
                    _t12378 = String$concat(" && ", cs);
                    break _t12379;
                  }
                  _match_fail("line 16933");
                }
                const cond2_12380 = _t12378;
                const or_cond_12382 = ("(" + (cond1_12375 + (" || " + (cond2_12380 + ")"))));
                let _t12384;
                if (_eq(binds1, binds2)) {
                  _t12384 = binds1;
                } else {
                  function _t12385(__p425) {
                    let _t12387;
                    const _t12386 = __p425;
                    _t12388: {
                      if (true) {
                        const name = _t12386[0];
                        const expr1 = _t12386[1];
                        const expr2_12389 = List$assoc(name, binds2);
                        let _t12391;
                        if ((expr1 === expr2_12389)) {
                          _t12391 = [name, expr1];
                        } else {
                          _t12391 = [name, (((((("(" + __dict_Show_string.show(cond1_12375)) + " ? ") + __dict_Show_string.show(expr1)) + " : ") + __dict_Show_string.show(expr2_12389)) + ")")];
                        }
                        const _t12390 = _t12391;
                        _t12387 = _t12390;
                        break _t12388;
                      }
                      _match_fail("line 16933");
                    }
                    return _t12387;
                  }
                  _t12384 = List$map(_t12385, binds1);
                }
                const binds_12392 = _t12384;
                const _t12393 = [({_hd: or_cond_12382, _tl: null}), binds_12392];
                const _t12383 = _t12393;
                const _t12381 = _t12383;
                const _t12376 = _t12381;
                _t12370 = _t12376;
                break _t12371;
              }
              _match_fail("line 16933");
            }
            _t12367 = _t12370;
            break _t12368;
          }
          _match_fail("line 16933");
        }
        _t12307 = _t12367;
        break _t12308;
      }
      if (_t12306._tag === 14) {
        const pats = _t12306._val;
        const len_cond_12394 = ((__dict_Show_string.show(scrutinee) + "._arr.length === ") + __dict_Show_int.show(List$length(pats)));
        const all_conds_12396 = Ref$create(({_hd: len_cond_12394, _tl: null}));
        const all_binds_12398 = Ref$create(null);
        function _t12400(i, sub_pat) {
          const elem_expr_12401 = (((__dict_Show_string.show(scrutinee) + "._arr[") + __dict_Show_int.show(i)) + "]");
          let _t12404;
          const _t12403 = Js_codegen$compile_pattern(ctx, elem_expr_12401, sub_pat);
          _t12405: {
            if (true) {
              const c = _t12403[0];
              const b = _t12403[1];
              Ref$set(all_conds_12396, List$concat(Ref$get(all_conds_12396), c));
              _t12404 = Ref$set(all_binds_12398, List$concat(Ref$get(all_binds_12398), b));
              break _t12405;
            }
            _match_fail("line 16933");
          }
          const _t12402 = _t12404;
          return _t12402;
        }
        List$iteri(_t12400, pats);
        const _t12399 = [Ref$get(all_conds_12396), Ref$get(all_binds_12398)];
        const _t12397 = _t12399;
        const _t12395 = _t12397;
        _t12307 = _t12395;
        break _t12308;
      }
      if (_t12306._tag === 16) {
        const tag = _t12306._val[0];
        const arg_pat = _t12306._val[1];
        const num_tag_12406 = (__dict_Hash_string.hash(tag) & 1073741823);
        const conds_12408 = ({_hd: ((__dict_Show_string.show(scrutinee) + "._tag === ") + __dict_Show_int.show(num_tag_12406)), _tl: null});
        let _t12411;
        const _t12410 = arg_pat;
        _t12412: {
          if (_t12410._tag === 0) {
            _t12411 = [conds_12408, null];
            break _t12412;
          }
          if (_t12410._tag === 1) {
            const sub_pat = _t12410._val;
            const payload_expr_12413 = (scrutinee + "._val");
            let _t12416;
            const _t12415 = Js_codegen$compile_pattern(ctx, payload_expr_12413, sub_pat);
            _t12417: {
              if (true) {
                const sub_conds = _t12415[0];
                const sub_binds = _t12415[1];
                _t12416 = [List$concat(conds_12408, sub_conds), sub_binds];
                break _t12417;
              }
              _match_fail("line 16933");
            }
            const _t12414 = _t12416;
            _t12411 = _t12414;
            break _t12412;
          }
          _match_fail("line 16933");
        }
        const _t12409 = _t12411;
        const _t12407 = _t12409;
        _t12307 = _t12407;
        break _t12308;
      }
      if (_t12306._tag === 17) {
        const name = _t12306._val;
        const js_name_12418 = Js_codegen$lookup_var(ctx, name);
        const _t12419 = [({_hd: (((("_eq(" + __dict_Show_string.show(scrutinee)) + ", ") + __dict_Show_string.show(js_name_12418)) + ")"), _tl: null}), null];
        _t12307 = _t12419;
        break _t12308;
      }
      if (_t12306._tag === 18) {
        const inner_pat = _t12306._val[0];
        const _t12420 = ctx;
        const _t12421 = scrutinee;
        const _t12422 = inner_pat;
        ctx = _t12420;
        scrutinee = _t12421;
        pat = _t12422;
        continue;
        _t12307 = undefined;
        break _t12308;
      }
      if (_t12306._tag === 15) {
        const entries = _t12306._val;
        const all_conds_12423 = Ref$create(null);
        const all_binds_12425 = Ref$create(null);
        function _t12427(key_pat) {
          let _t12429;
          const _t12428 = key_pat;
          _t12430: {
            if (_t12428._tag === 2) {
              const n = _t12428._val;
              _t12429 = string_of_int(n);
              break _t12430;
            }
            if (_t12428._tag === 5) {
              const s = _t12428._val;
              _t12429 = Js_codegen$escape_js_string(s);
              break _t12430;
            }
            if (_t12428._tag === 4) {
              const b = _t12428._val;
              let _t12431;
              if (b) {
                _t12431 = "true";
              } else {
                _t12431 = "false";
              }
              _t12429 = _t12431;
              break _t12430;
            }
            if (_t12428._tag === 3) {
              const f = _t12428._val;
              _t12429 = __dict_Show_float.show(f);
              break _t12430;
            }
            if (_t12428._tag === 17) {
              const name = _t12428._val;
              _t12429 = Js_codegen$lookup_var(ctx, name);
              break _t12430;
            }
            if (true) {
              _t12429 = Js_codegen$error("map pattern keys must be literals or pin patterns");
              break _t12430;
            }
            _match_fail("line 16933");
          }
          return _t12429;
        }
        const emit_key_expr_12432 = _t12427;
        function _t12434(__p426) {
          let _t12436;
          const _t12435 = __p426;
          _t12437: {
            if (true) {
              const key_pat = _t12435[0];
              const val_pat = _t12435[1];
              const key_expr_12438 = emit_key_expr_12432(key_pat);
              Ref$set(all_conds_12423, List$concat(Ref$get(all_conds_12423), ({_hd: (((((__dict_Show_string.show(Js_codegen$mangle_name("Map.has")) + "(") + __dict_Show_string.show(key_expr_12438)) + ")(") + __dict_Show_string.show(scrutinee)) + ")"), _tl: null})));
              const val_expr_12440 = (((((__dict_Show_string.show(Js_codegen$mangle_name("Map.get")) + "(") + __dict_Show_string.show(key_expr_12438)) + ")(") + __dict_Show_string.show(scrutinee)) + ")._val");
              let _t12443;
              const _t12442 = Js_codegen$compile_pattern(ctx, val_expr_12440, val_pat);
              _t12444: {
                if (true) {
                  const c = _t12442[0];
                  const b = _t12442[1];
                  Ref$set(all_conds_12423, List$concat(Ref$get(all_conds_12423), c));
                  _t12443 = Ref$set(all_binds_12425, List$concat(Ref$get(all_binds_12425), b));
                  break _t12444;
                }
                _match_fail("line 16933");
              }
              const _t12441 = _t12443;
              const _t12439 = _t12441;
              _t12436 = _t12439;
              break _t12437;
            }
            _match_fail("line 16933");
          }
          return _t12436;
        }
        List$iter(_t12434, entries);
        const _t12433 = [Ref$get(all_conds_12423), Ref$get(all_binds_12425)];
        const _t12426 = _t12433;
        const _t12424 = _t12426;
        _t12307 = _t12424;
        break _t12308;
      }
      _match_fail("line 16933");
    }
    return _t12307;
  }
}
function Js_codegen$compile_handle_trywith(ctx, body, op_arms, return_arm, result) {
  Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(result)) + " = (function() {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  const h_saved_12445 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(h_saved_12445)) + " = _h;"));
  Js_codegen$emit_line(ctx, (("_h = Object.assign({}, " + __dict_Show_string.show(h_saved_12445)) + ", {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  function _t12447(__p427) {
    let _t12449;
    const _t12448 = __p427;
    _t12450: {
      if (true) {
        const op_name = _t12448[0];
        const arg_name = _t12448[1];
        const k_name = _t12448[2];
        const arg_js_12451 = Js_codegen$mangle_name(arg_name);
        const k_js_12453 = Js_codegen$mangle_name(k_name);
        const _t12454 = Js_codegen$emit_line(ctx, (((((((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_12451)) + ", ") + __dict_Show_string.show(k_js_12453)) + ") { throw {_e: \"") + __dict_Show_string.show(op_name)) + "\", _v: ") + __dict_Show_string.show(arg_js_12451)) + "}; },"));
        const _t12452 = _t12454;
        _t12449 = _t12452;
        break _t12450;
      }
      _match_fail("line 16933");
    }
    return _t12449;
  }
  List$iter(_t12447, op_arms);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "});");
  Js_codegen$emit_line(ctx, "try {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const saved_two_12455 = ctx.trywith_ops;
  function _t12457(__p428) {
    let _t12459;
    const _t12458 = __p428;
    _t12460: {
      if (true) {
        const op = _t12458[0];
        _t12459 = op;
        break _t12460;
      }
      _match_fail("line 16933");
    }
    return _t12459;
  }
  const handled_op_names_12461 = List$map(_t12457, op_arms);
  (ctx.trywith_ops = List$concat(handled_op_names_12461, ctx.trywith_ops), undefined);
  const body_needs_cps_12463 = Js_codegen$expr_has_unhandled_perform(handled_op_names_12461, body);
  let _t12465;
  if (body_needs_cps_12463) {
    Js_codegen$emit_line(ctx, "return _trampoline(function() {");
    (ctx.indent = (ctx.indent + 1), undefined);
    function _t12466(body_result) {
      let _t12468;
      const _t12467 = return_arm;
      _t12469: {
        if (_t12467._tag === 1) {
          const ret_name = _t12467._val[0];
          const ret_body = _t12467._val[1];
          const ret_js_12470 = Js_codegen$mangle_name(ret_name);
          const actual_ret_12472 = (ret_js_12470 + ("_" + string_of_int(ctx.tmp_counter)));
          (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, ret_name, actual_ret_12472);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_12472)) + " = ") + __dict_Show_string.show(body_result)) + ";"));
          const v_12474 = Js_codegen$compile_non_tail(ctx, ret_body);
          Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_12474)) + ";"));
          const _t12475 = Js_codegen$pop_scope(ctx);
          const _t12473 = _t12475;
          const _t12471 = _t12473;
          _t12468 = _t12471;
          break _t12469;
        }
        if (_t12467._tag === 0) {
          _t12468 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_result)) + ";"));
          break _t12469;
        }
        _match_fail("line 16933");
      }
      return _t12468;
    }
    Js_codegen$compile_cps(ctx, body, _t12466);
    (ctx.indent = (ctx.indent - 1), undefined);
    _t12465 = Js_codegen$emit_line(ctx, "});");
  } else {
    const body_v_12476 = Js_codegen$compile_non_tail(ctx, body);
    let _t12479;
    const _t12478 = return_arm;
    _t12480: {
      if (_t12478._tag === 1) {
        const ret_name = _t12478._val[0];
        const ret_body = _t12478._val[1];
        const ret_js_12481 = Js_codegen$mangle_name(ret_name);
        const actual_ret_12483 = (ret_js_12481 + ("_" + string_of_int(ctx.tmp_counter)));
        (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
        Js_codegen$push_scope(ctx);
        Js_codegen$bind_var(ctx, ret_name, actual_ret_12483);
        Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_12483)) + " = ") + __dict_Show_string.show(body_v_12476)) + ";"));
        const rv_12485 = Js_codegen$compile_non_tail(ctx, ret_body);
        Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(rv_12485)) + ";"));
        const _t12486 = Js_codegen$pop_scope(ctx);
        const _t12484 = _t12486;
        const _t12482 = _t12484;
        _t12479 = _t12482;
        break _t12480;
      }
      if (_t12478._tag === 0) {
        _t12479 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_v_12476)) + ";"));
        break _t12480;
      }
      _match_fail("line 16933");
    }
    const _t12477 = _t12479;
    _t12465 = _t12477;
  }
  _t12465;
  (ctx.trywith_ops = saved_two_12455, undefined);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "} catch (_exc) {");
  (ctx.indent = (ctx.indent + 1), undefined);
  const first_12487 = Ref$create(true);
  function _t12489(__p429) {
    let _t12491;
    const _t12490 = __p429;
    _t12492: {
      if (true) {
        const op_name = _t12490[0];
        const arg_name = _t12490[1];
        const _k_name = _t12490[2];
        const handler_body = _t12490[3];
        let _t12493;
        if (Ref$get(first_12487)) {
          _t12493 = "if";
        } else {
          _t12493 = "} else if";
        }
        const prefix_12494 = _t12493;
        Ref$set(first_12487, false);
        Js_codegen$emit_line(ctx, (((__dict_Show_string.show(prefix_12494) + " (_exc && _exc._e === \"") + __dict_Show_string.show(op_name)) + "\") {"));
        (ctx.indent = (ctx.indent + 1), undefined);
        Js_codegen$push_scope(ctx);
        const arg_js_12496 = Js_codegen$mangle_name(arg_name);
        Js_codegen$bind_var(ctx, arg_name, arg_js_12496);
        Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(arg_js_12496)) + " = _exc._v;"));
        const v_12498 = Js_codegen$compile_non_tail(ctx, handler_body);
        Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_12498)) + ";"));
        Js_codegen$pop_scope(ctx);
        const _t12499 = (ctx.indent = (ctx.indent - 1), undefined);
        const _t12497 = _t12499;
        const _t12495 = _t12497;
        _t12491 = _t12495;
        break _t12492;
      }
      _match_fail("line 16933");
    }
    return _t12491;
  }
  List$iter(_t12489, op_arms);
  Js_codegen$emit_line(ctx, "} else { throw _exc; }");
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, (("} finally { _h = " + __dict_Show_string.show(h_saved_12445)) + "; }"));
  (ctx.indent = (ctx.indent - 1), undefined);
  const _t12488 = Js_codegen$emit_line(ctx, "})();");
  const _t12464 = _t12488;
  const _t12462 = _t12464;
  const _t12456 = _t12462;
  const _t12446 = _t12456;
  return _t12446;
}
function Js_codegen$compile_handle(ctx, body, arms) {
  const result_12500 = Js_codegen$fresh_tmp(ctx);
  const return_arm_12502 = Ref$create(({_tag: 0, _name: "None"}));
  const provide_ops_12504 = Ref$create(null);
  const try_ops_12506 = Ref$create(null);
  const full_ops_12508 = Ref$create(null);
  function _t12510(arm) {
    let _t12512;
    const _t12511 = arm;
    _t12513: {
      if (_t12511._tag === 0) {
        const name = _t12511._val[0];
        const body = _t12511._val[1];
        _t12512 = Ref$set(return_arm_12502, ({_tag: 1, _name: "Some", _val: [name, body]}));
        break _t12513;
      }
      if (_t12511._tag === 1) {
        const op = _t12511._val[0];
        const arg = _t12511._val[1];
        const k = _t12511._val[2];
        const body = _t12511._val[3];
        _t12512 = Ref$set(full_ops_12508, ({_hd: [op, arg, k, body], _tl: Ref$get(full_ops_12508)}));
        break _t12513;
      }
      if (_t12511._tag === 2) {
        const op = _t12511._val[0];
        const arg = _t12511._val[1];
        const body = _t12511._val[2];
        _t12512 = Ref$set(provide_ops_12504, ({_hd: [op, arg, body], _tl: Ref$get(provide_ops_12504)}));
        break _t12513;
      }
      if (_t12511._tag === 3) {
        const op = _t12511._val[0];
        const arg = _t12511._val[1];
        const body = _t12511._val[2];
        _t12512 = Ref$set(try_ops_12506, ({_hd: [op, arg, body], _tl: Ref$get(try_ops_12506)}));
        break _t12513;
      }
      _match_fail("line 16933");
    }
    return _t12512;
  }
  List$iter(_t12510, arms);
  const provide_ops_12514 = List$rev(Ref$get(provide_ops_12504));
  const try_ops_12516 = List$rev(Ref$get(try_ops_12506));
  const full_ops_12518 = List$rev(Ref$get(full_ops_12508));
  let _t12521;
  const _t12520 = Ref$get(return_arm_12502);
  _t12522: {
    if (_t12520._tag === 1) {
      const rb = _t12520._val[1];
      _t12521 = (!Js_codegen$expr_has_perform(rb));
      break _t12522;
    }
    if (_t12520._tag === 0) {
      _t12521 = true;
      break _t12522;
    }
    _match_fail("line 16933");
  }
  const return_arm_pure_12523 = _t12521;
  let _t12525;
  if ((_eq(full_ops_12518, null) && (_eq(provide_ops_12514, null) && (!_eq(try_ops_12516, null) && return_arm_pure_12523)))) {
    function _t12526(__p430) {
      let _t12528;
      const _t12527 = __p430;
      _t12529: {
        if (true) {
          const op = _t12527[0];
          const arg = _t12527[1];
          const body = _t12527[2];
          _t12528 = [op, arg, "__k_try", body];
          break _t12529;
        }
        _match_fail("line 16933");
      }
      return _t12528;
    }
    const trywith_arms_12530 = List$map(_t12526, try_ops_12516);
    const _t12531 = Js_codegen$compile_handle_trywith(ctx, body, trywith_arms_12530, Ref$get(return_arm_12502), result_12500);
    _t12525 = _t12531;
  } else {
    function _t12532(__p431) {
      let _t12534;
      const _t12533 = __p431;
      _t12535: {
        if (true) {
          const op = _t12533[0];
          _t12534 = op;
          break _t12535;
        }
        _match_fail("line 16933");
      }
      return _t12534;
    }
    const simple_ops_12536 = List$map(_t12532, provide_ops_12514);
    Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(result_12500)) + " = (function() {"));
    (ctx.indent = (ctx.indent + 1), undefined);
    const h_saved_12538 = Js_codegen$fresh_tmp(ctx);
    Js_codegen$emit_line(ctx, (("const " + __dict_Show_string.show(h_saved_12538)) + " = _h;"));
    const saved_direct_ops_12540 = ctx.direct_dispatch_ops;
    function _t12542(__p432) {
      let _t12544;
      const _t12543 = __p432;
      _t12545: {
        if (true) {
          const op_name = _t12543[0];
          const arg_name = _t12543[1];
          const value_body = _t12543[2];
          const direct_fn_12546 = Js_codegen$fresh_tmp(ctx);
          const arg_js_12548 = Js_codegen$mangle_name(arg_name);
          Js_codegen$emit_line(ctx, (((("function " + __dict_Show_string.show(direct_fn_12546)) + "(") + __dict_Show_string.show(arg_js_12548)) + ") {"));
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, arg_name, arg_js_12548);
          const v_12550 = Js_codegen$compile_non_tail(ctx, value_body);
          Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_12550)) + ";"));
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          Js_codegen$emit_line(ctx, "}");
          const _t12551 = (ctx.direct_dispatch_ops = ({_hd: [op_name, direct_fn_12546], _tl: ctx.direct_dispatch_ops}), undefined);
          const _t12549 = _t12551;
          const _t12547 = _t12549;
          _t12544 = _t12547;
          break _t12545;
        }
        _match_fail("line 16933");
      }
      return _t12544;
    }
    List$iter(_t12542, provide_ops_12514);
    function _t12552(__p433) {
      let _t12554;
      const _t12553 = __p433;
      _t12555: {
        if (true) {
          const op = _t12553[0];
          _t12554 = op;
          break _t12555;
        }
        _match_fail("line 16933");
      }
      return _t12554;
    }
    function _t12556(__p434) {
      let _t12558;
      const _t12557 = __p434;
      _t12559: {
        if (true) {
          const op = _t12557[0];
          _t12558 = op;
          break _t12559;
        }
        _match_fail("line 16933");
      }
      return _t12558;
    }
    const shadowed_ops_12560 = List$concat(List$map(_t12552, full_ops_12518), List$map(_t12556, try_ops_12516));
    let _t12562;
    if (!_eq(shadowed_ops_12560, null)) {
      function _t12563(__p435) {
        let _t12565;
        const _t12564 = __p435;
        _t12566: {
          if (true) {
            const op = _t12564[0];
            _t12565 = (!List$mem(op, shadowed_ops_12560));
            break _t12566;
          }
          _match_fail("line 16933");
        }
        return _t12565;
      }
      _t12562 = (ctx.direct_dispatch_ops = List$filter(_t12563, ctx.direct_dispatch_ops), undefined);
    } else {
      _t12562 = undefined;
    }
    _t12562;
    Js_codegen$emit_line(ctx, (("_h = Object.assign({}, " + __dict_Show_string.show(h_saved_12538)) + ", {"));
    (ctx.indent = (ctx.indent + 1), undefined);
    function _t12567(__p436) {
      let _t12569;
      const _t12568 = __p436;
      _t12570: {
        if (true) {
          const op_name = _t12568[0];
          const arg_name = _t12568[1];
          const arg_js_12571 = Js_codegen$mangle_name(arg_name);
          const k_js_12573 = "_k";
          const direct_fn_12575 = List$assoc(op_name, ctx.direct_dispatch_ops);
          const _t12576 = Js_codegen$emit_line(ctx, (((((((((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_12571)) + ", ") + __dict_Show_string.show(k_js_12573)) + ") { return _bounce(function() { return ") + __dict_Show_string.show(k_js_12573)) + "(") + __dict_Show_string.show(direct_fn_12575)) + "(") + __dict_Show_string.show(arg_js_12571)) + ")); }); },"));
          const _t12574 = _t12576;
          const _t12572 = _t12574;
          _t12569 = _t12572;
          break _t12570;
        }
        _match_fail("line 16933");
      }
      return _t12569;
    }
    List$iter(_t12567, provide_ops_12514);
    function _t12577(__p437) {
      let _t12579;
      const _t12578 = __p437;
      _t12580: {
        if (true) {
          const op_name = _t12578[0];
          const arg_name = _t12578[1];
          const fallback_body = _t12578[2];
          const arg_js_12581 = Js_codegen$mangle_name(arg_name);
          const k_js_12583 = "_k";
          Js_codegen$emit_line(ctx, (((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_12581)) + ", ") + __dict_Show_string.show(k_js_12583)) + ") {"));
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, arg_name, arg_js_12581);
          const v_12585 = Js_codegen$compile_non_tail(ctx, fallback_body);
          Js_codegen$emit_line(ctx, (("return _bounce(function() { return " + __dict_Show_string.show(v_12585)) + "; });"));
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          const _t12586 = Js_codegen$emit_line(ctx, "},");
          const _t12584 = _t12586;
          const _t12582 = _t12584;
          _t12579 = _t12582;
          break _t12580;
        }
        _match_fail("line 16933");
      }
      return _t12579;
    }
    List$iter(_t12577, try_ops_12516);
    function _t12587(__p438) {
      let _t12589;
      const _t12588 = __p438;
      _t12590: {
        if (true) {
          const op_name = _t12588[0];
          const arg_name = _t12588[1];
          const k_name = _t12588[2];
          const handler_body = _t12588[3];
          const arg_js_12591 = Js_codegen$mangle_name(arg_name);
          const k_js_12593 = Js_codegen$mangle_name(k_name);
          Js_codegen$emit_line(ctx, (((((("\"" + __dict_Show_string.show(op_name)) + "\": function(") + __dict_Show_string.show(arg_js_12591)) + ", ") + __dict_Show_string.show(k_js_12593)) + ") {"));
          (ctx.indent = (ctx.indent + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, arg_name, arg_js_12591);
          Js_codegen$bind_var(ctx, k_name, k_js_12593);
          const saved_htr_12595 = ctx.handler_tail_resume;
          (ctx.handler_tail_resume = Js_codegen$all_resumes_are_tail(handler_body), undefined);
          const v_12597 = Js_codegen$compile_non_tail(ctx, handler_body);
          (ctx.handler_tail_resume = saved_htr_12595, undefined);
          Js_codegen$emit_line(ctx, (("return _bounce(function() { return " + __dict_Show_string.show(v_12597)) + "; });"));
          Js_codegen$pop_scope(ctx);
          (ctx.indent = (ctx.indent - 1), undefined);
          const _t12598 = Js_codegen$emit_line(ctx, "},");
          const _t12596 = _t12598;
          const _t12594 = _t12596;
          const _t12592 = _t12594;
          _t12589 = _t12592;
          break _t12590;
        }
        _match_fail("line 16933");
      }
      return _t12589;
    }
    List$iter(_t12587, full_ops_12518);
    (ctx.indent = (ctx.indent - 1), undefined);
    Js_codegen$emit_line(ctx, "});");
    let _t12599;
    if (_eq(simple_ops_12536, null)) {
      _t12599 = Js_codegen$expr_has_perform(body);
    } else {
      _t12599 = Js_codegen$expr_has_unhandled_perform(simple_ops_12536, body);
    }
    const body_needs_cps_12600 = _t12599;
    Js_codegen$emit_line(ctx, "try {");
    (ctx.indent = (ctx.indent + 1), undefined);
    let _t12602;
    if (body_needs_cps_12600) {
      Js_codegen$emit_line(ctx, "return _trampoline(function() {");
      (ctx.indent = (ctx.indent + 1), undefined);
      function _t12603(body_result) {
        let _t12605;
        const _t12604 = Ref$get(return_arm_12502);
        _t12606: {
          if (_t12604._tag === 1) {
            const ret_name = _t12604._val[0];
            const ret_body = _t12604._val[1];
            const ret_js_12607 = Js_codegen$mangle_name(ret_name);
            const actual_ret_12609 = (ret_js_12607 + ("_" + string_of_int(ctx.tmp_counter)));
            (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
            Js_codegen$push_scope(ctx);
            Js_codegen$bind_var(ctx, ret_name, actual_ret_12609);
            Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_12609)) + " = ") + __dict_Show_string.show(body_result)) + ";"));
            const v_12611 = Js_codegen$compile_non_tail(ctx, ret_body);
            Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(v_12611)) + ";"));
            const _t12612 = Js_codegen$pop_scope(ctx);
            const _t12610 = _t12612;
            const _t12608 = _t12610;
            _t12605 = _t12608;
            break _t12606;
          }
          if (_t12604._tag === 0) {
            _t12605 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_result)) + ";"));
            break _t12606;
          }
          _match_fail("line 16933");
        }
        return _t12605;
      }
      Js_codegen$compile_cps(ctx, body, _t12603);
      (ctx.indent = (ctx.indent - 1), undefined);
      _t12602 = Js_codegen$emit_line(ctx, "});");
    } else {
      const body_v_12613 = Js_codegen$compile_non_tail(ctx, body);
      let _t12616;
      const _t12615 = Ref$get(return_arm_12502);
      _t12617: {
        if (_t12615._tag === 1) {
          const ret_name = _t12615._val[0];
          const ret_body = _t12615._val[1];
          const ret_js_12618 = Js_codegen$mangle_name(ret_name);
          const actual_ret_12620 = (ret_js_12618 + ("_" + string_of_int(ctx.tmp_counter)));
          (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
          Js_codegen$push_scope(ctx);
          Js_codegen$bind_var(ctx, ret_name, actual_ret_12620);
          Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_ret_12620)) + " = ") + __dict_Show_string.show(body_v_12613)) + ";"));
          const rv_12622 = Js_codegen$compile_non_tail(ctx, ret_body);
          Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(rv_12622)) + ";"));
          const _t12623 = Js_codegen$pop_scope(ctx);
          const _t12621 = _t12623;
          const _t12619 = _t12621;
          _t12616 = _t12619;
          break _t12617;
        }
        if (_t12615._tag === 0) {
          _t12616 = Js_codegen$emit_line(ctx, (("return " + __dict_Show_string.show(body_v_12613)) + ";"));
          break _t12617;
        }
        _match_fail("line 16933");
      }
      const _t12614 = _t12616;
      _t12602 = _t12614;
    }
    _t12602;
    (ctx.indent = (ctx.indent - 1), undefined);
    Js_codegen$emit_line(ctx, (("} finally { _h = " + __dict_Show_string.show(h_saved_12538)) + "; }"));
    (ctx.direct_dispatch_ops = saved_direct_ops_12540, undefined);
    (ctx.indent = (ctx.indent - 1), undefined);
    const _t12601 = Js_codegen$emit_line(ctx, "})();");
    const _t12561 = _t12601;
    const _t12541 = _t12561;
    const _t12539 = _t12541;
    const _t12537 = _t12539;
    _t12525 = _t12537;
  }
  _t12525;
  const _t12524 = result_12500;
  const _t12519 = _t12524;
  const _t12517 = _t12519;
  const _t12515 = _t12517;
  const _t12509 = _t12515;
  const _t12507 = _t12509;
  const _t12505 = _t12507;
  const _t12503 = _t12505;
  const _t12501 = _t12503;
  return _t12501;
}
function Js_codegen$compile_cps(ctx, te, cont) {
  while (true) {
    let _t12624;
    if ((!Js_codegen$expr_has_perform(te))) {
      const v_12625 = Js_codegen$compile_non_tail(ctx, te);
      const _t12626 = cont(v_12625);
      _t12624 = _t12626;
    } else {
      let _t12628;
      const _t12627 = te.expr;
      _t12629: {
        if (_t12627._tag === 29) {
          const op_name = _t12627._val[0];
          const arg = _t12627._val[1];
          _t12628 = Js_codegen$compile_perform_cps(ctx, op_name, arg, cont);
          break _t12629;
        }
        if (_t12627._tag === 30) {
          const v_12630 = Js_codegen$compile_non_tail(ctx, te);
          const _t12631 = cont(v_12630);
          _t12628 = _t12631;
          break _t12629;
        }
        if (_t12627._tag === 31) {
          const k_expr = _t12627._val[0];
          const val_expr = _t12627._val[1];
          const k_js_12632 = Js_codegen$compile_non_tail(ctx, k_expr);
          const v_js_12634 = Js_codegen$compile_non_tail(ctx, val_expr);
          const _t12635 = Js_codegen$emit_line(ctx, (((("return _bounce(function() { return " + __dict_Show_string.show(k_js_12632)) + "(") + __dict_Show_string.show(v_js_12634)) + "); });"));
          const _t12633 = _t12635;
          _t12628 = _t12633;
          break _t12629;
        }
        if (_t12627._tag === 8) {
          const name = _t12627._val[0];
          const e1 = _t12627._val[2];
          const e2 = _t12627._val[3];
          _t12628 = Js_codegen$compile_let_cps(ctx, name, e1, e2, cont);
          break _t12629;
        }
        if (_t12627._tag === 9) {
          const name = _t12627._val[0];
          const fn_expr = _t12627._val[2];
          const body = _t12627._val[3];
          _t12628 = Js_codegen$compile_letrec_cps(ctx, name, fn_expr, body, cont);
          break _t12629;
        }
        if (_t12627._tag === 28) {
          const e1 = _t12627._val[0];
          const e2 = _t12627._val[1];
          _t12628 = Js_codegen$compile_seq_cps(ctx, e1, e2, cont);
          break _t12629;
        }
        if (_t12627._tag === 12) {
          const cond = _t12627._val[0];
          const then_e = _t12627._val[1];
          const else_e = _t12627._val[2];
          _t12628 = Js_codegen$compile_if_cps(ctx, cond, then_e, else_e, cont);
          break _t12629;
        }
        if (_t12627._tag === 24) {
          const scrut = _t12627._val[0];
          const arms = _t12627._val[1];
          const _partial = _t12627._val[2];
          _t12628 = Js_codegen$compile_match_cps(ctx, scrut, arms, te.loc, cont);
          break _t12629;
        }
        if (_t12627._tag === 11) {
          const fn_ = _t12627._val[0];
          const arg = _t12627._val[1];
          _t12628 = Js_codegen$compile_app_cps(ctx, te, fn_, arg, cont);
          break _t12629;
        }
        if (_t12627._tag === 10) {
          const v_12636 = Js_codegen$compile_non_tail(ctx, te);
          const _t12637 = cont(v_12636);
          _t12628 = _t12637;
          break _t12629;
        }
        if (_t12627._tag === 25) {
          const name = _t12627._val[0];
          const init = _t12627._val[1];
          const body = _t12627._val[2];
          let _t12638;
          if (Js_codegen$expr_has_perform(init)) {
            const _t12639 = ctx;
            const _t12640 = init;
            function _t12642(init_v) {
              const js_name_12643 = Js_codegen$mangle_name(name);
              const actual_name_12645 = (js_name_12643 + ("_" + string_of_int(ctx.tmp_counter)));
              (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
              Js_codegen$push_scope(ctx);
              Js_codegen$bind_var(ctx, name, actual_name_12645);
              Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(actual_name_12645)) + " = _resolve(") + __dict_Show_string.show(init_v)) + ");"));
              Js_codegen$compile_cps(ctx, body, cont);
              const _t12646 = Js_codegen$pop_scope(ctx);
              const _t12644 = _t12646;
              return _t12644;
            }
            const _t12641 = _t12642;
            ctx = _t12639;
            te = _t12640;
            cont = _t12641;
            continue;
            _t12638 = undefined;
          } else {
            const v_12647 = Js_codegen$compile_non_tail(ctx, init);
            const js_name_12649 = Js_codegen$mangle_name(name);
            const actual_name_12651 = (js_name_12649 + ("_" + string_of_int(ctx.tmp_counter)));
            (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
            Js_codegen$push_scope(ctx);
            Js_codegen$bind_var(ctx, name, actual_name_12651);
            Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(actual_name_12651)) + " = _resolve(") + __dict_Show_string.show(v_12647)) + ");"));
            Js_codegen$compile_cps(ctx, body, cont);
            const _t12652 = Js_codegen$pop_scope(ctx);
            const _t12650 = _t12652;
            const _t12648 = _t12650;
            _t12638 = _t12648;
          }
          _t12628 = _t12638;
          break _t12629;
        }
        if (_t12627._tag === 32) {
          const cond = _t12627._val[0];
          const body = _t12627._val[1];
          _t12628 = Js_codegen$compile_while_cps(ctx, cond, body, cont);
          break _t12629;
        }
        if (true) {
          const v_12653 = Js_codegen$compile_non_tail(ctx, te);
          const _t12654 = cont(v_12653);
          _t12628 = _t12654;
          break _t12629;
        }
        _match_fail("line 16933");
      }
      _t12624 = _t12628;
    }
    return _t12624;
  }
}
function Js_codegen$compile_while_cps(ctx, cond, body, cont) {
  const loop_fn_12655 = Js_codegen$fresh_tmp(ctx);
  const break_flag_12657 = Js_codegen$fresh_tmp(ctx);
  const break_val_12659 = Js_codegen$fresh_tmp(ctx);
  const saved_break_flag_12661 = ctx.break_flag_name;
  const saved_break_val_12663 = ctx.break_val_name;
  const saved_in_fold_12665 = ctx.in_fold_loop;
  (ctx.break_flag_name = break_flag_12657, undefined);
  (ctx.break_val_name = break_val_12659, undefined);
  (ctx.in_fold_loop = false, undefined);
  Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(break_flag_12657)) + " = false, ") + __dict_Show_string.show(break_val_12659)) + ";"));
  Js_codegen$emit_line(ctx, (("function " + __dict_Show_string.show(loop_fn_12655)) + "() {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  const c_12667 = Js_codegen$compile_non_tail(ctx, cond);
  Js_codegen$emit_line(ctx, (("if (!(" + __dict_Show_string.show(c_12667)) + ")) {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  cont("undefined");
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  function _t12669(body_val) {
    Js_codegen$emit_line(ctx, (__dict_Show_string.show(body_val) + ";"));
    Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(break_flag_12657)) + ") {"));
    (ctx.indent = (ctx.indent + 1), undefined);
    cont(break_val_12659);
    (ctx.indent = (ctx.indent - 1), undefined);
    Js_codegen$emit_line(ctx, "}");
    return Js_codegen$emit_line(ctx, (("return _bounce(" + __dict_Show_string.show(loop_fn_12655)) + ");"));
  }
  Js_codegen$compile_cps(ctx, body, _t12669);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "}");
  Js_codegen$emit_line(ctx, (("return _bounce(" + __dict_Show_string.show(loop_fn_12655)) + ");"));
  (ctx.break_flag_name = saved_break_flag_12661, undefined);
  (ctx.break_val_name = saved_break_val_12663, undefined);
  const _t12668 = (ctx.in_fold_loop = saved_in_fold_12665, undefined);
  const _t12666 = _t12668;
  const _t12664 = _t12666;
  const _t12662 = _t12664;
  const _t12660 = _t12662;
  const _t12658 = _t12660;
  const _t12656 = _t12658;
  return _t12656;
}
function Js_codegen$compile_perform_cps(ctx, op_name, arg, cont) {
  let _t12671;
  const _t12670 = List$assoc_opt(op_name, ctx.direct_dispatch_ops);
  _t12672: {
    if (_t12670._tag === 1) {
      const direct_fn = _t12670._val;
      const arg_js_12673 = Js_codegen$compile_non_tail(ctx, arg);
      const result_var_12675 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_line(ctx, (((((("const " + __dict_Show_string.show(result_var_12675)) + " = ") + __dict_Show_string.show(direct_fn)) + "(") + __dict_Show_string.show(arg_js_12673)) + ");"));
      const _t12676 = cont(result_var_12675);
      const _t12674 = _t12676;
      _t12671 = _t12674;
      break _t12672;
    }
    if (_t12670._tag === 0) {
      if (List$mem(op_name, ctx.trywith_ops)) {
        const arg_js_12677 = Js_codegen$compile_non_tail(ctx, arg);
        const _t12678 = Js_codegen$emit_line(ctx, (((("throw {_e: \"" + __dict_Show_string.show(op_name)) + "\", _v: ") + __dict_Show_string.show(arg_js_12677)) + "};"));
        _t12671 = _t12678;
        break _t12672;
      }
    }
    if (_t12670._tag === 0) {
      const arg_js_12679 = Js_codegen$compile_non_tail(ctx, arg);
      const result_var_12681 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_line(ctx, (((((("return _h[\"" + __dict_Show_string.show(op_name)) + "\"](") + __dict_Show_string.show(arg_js_12679)) + ", function(") + __dict_Show_string.show(result_var_12681)) + ") {"));
      (ctx.indent = (ctx.indent + 1), undefined);
      Js_codegen$emit_line(ctx, "return _bounce(function() {");
      (ctx.indent = (ctx.indent + 1), undefined);
      cont(result_var_12681);
      (ctx.indent = (ctx.indent - 1), undefined);
      Js_codegen$emit_line(ctx, "});");
      (ctx.indent = (ctx.indent - 1), undefined);
      const _t12682 = Js_codegen$emit_line(ctx, "});");
      const _t12680 = _t12682;
      _t12671 = _t12680;
      break _t12672;
    }
    _match_fail("line 16933");
  }
  return _t12671;
}
function Js_codegen$compile_let_cps(ctx, name, e1, e2, cont) {
  let _t12683;
  if (Js_codegen$expr_has_perform(e1)) {
    function _t12684(v1) {
      const js_name_12685 = Js_codegen$mangle_name(name);
      let _t12687;
      if ((js_name_12685 === "_")) {
        _t12687 = Js_codegen$fresh_tmp(ctx);
      } else {
        function _t12688(n) {
          (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
          return n;
        }
        _t12687 = _call(_t12688, [(js_name_12685 + ("_" + string_of_int(ctx.tmp_counter)))]);
      }
      const actual_name_12689 = _t12687;
      Js_codegen$push_scope(ctx);
      Js_codegen$bind_var(ctx, name, actual_name_12689);
      Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_name_12689)) + " = _resolve(") + __dict_Show_string.show(v1)) + ");"));
      Js_codegen$compile_cps(ctx, e2, cont);
      const _t12690 = Js_codegen$pop_scope(ctx);
      const _t12686 = _t12690;
      return _t12686;
    }
    _t12683 = Js_codegen$compile_cps(ctx, e1, _t12684);
  } else {
    const v1_12691 = Js_codegen$compile_non_tail(ctx, e1);
    const js_name_12693 = Js_codegen$mangle_name(name);
    let _t12695;
    if ((js_name_12693 === "_")) {
      _t12695 = Js_codegen$fresh_tmp(ctx);
    } else {
      function _t12696(n) {
        (ctx.tmp_counter = (ctx.tmp_counter + 1), undefined);
        return n;
      }
      _t12695 = _call(_t12696, [(js_name_12693 + ("_" + string_of_int(ctx.tmp_counter)))]);
    }
    const actual_name_12697 = _t12695;
    Js_codegen$push_scope(ctx);
    Js_codegen$bind_var(ctx, name, actual_name_12697);
    Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(actual_name_12697)) + " = _resolve(") + __dict_Show_string.show(v1_12691)) + ");"));
    Js_codegen$compile_cps(ctx, e2, cont);
    const _t12698 = Js_codegen$pop_scope(ctx);
    const _t12694 = _t12698;
    const _t12692 = _t12694;
    _t12683 = _t12692;
  }
  return _t12683;
}
function Js_codegen$compile_letrec_cps(ctx, name, fn_expr, body, cont) {
  const js_name_12699 = Js_codegen$mangle_name(name);
  Js_codegen$push_scope(ctx);
  Js_codegen$bind_var(ctx, name, js_name_12699);
  let _t12702;
  const _t12701 = fn_expr.expr;
  _t12703: {
    if (_t12701._tag === 10) {
      _t12702 = Js_codegen$compile_named_function(ctx, js_name_12699, fn_expr);
      break _t12703;
    }
    if (true) {
      Js_codegen$emit_js_placeholder(ctx, js_name_12699, fn_expr);
      _t12702 = Js_codegen$emit_js_backpatch(ctx, js_name_12699, fn_expr);
      break _t12703;
    }
    _match_fail("line 16933");
  }
  _t12702;
  Js_codegen$compile_cps(ctx, body, cont);
  const _t12700 = Js_codegen$pop_scope(ctx);
  return _t12700;
}
function Js_codegen$compile_seq_cps(ctx, e1, e2, cont) {
  let _t12704;
  if (Js_codegen$expr_has_perform(e1)) {
    function _t12705(v1) {
      Js_codegen$emit_line(ctx, (("_resolve(" + __dict_Show_string.show(v1)) + ");"));
      return Js_codegen$compile_cps(ctx, e2, cont);
    }
    _t12704 = Js_codegen$compile_cps(ctx, e1, _t12705);
  } else {
    const v1_12706 = Js_codegen$compile_non_tail(ctx, e1);
    Js_codegen$emit_line(ctx, (("_resolve(" + __dict_Show_string.show(v1_12706)) + ");"));
    const _t12707 = Js_codegen$compile_cps(ctx, e2, cont);
    _t12704 = _t12707;
  }
  return _t12704;
}
function Js_codegen$compile_if_cps(ctx, cond, then_e, else_e, cont) {
  const c_12708 = Js_codegen$compile_non_tail(ctx, cond);
  Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(c_12708)) + ") {"));
  (ctx.indent = (ctx.indent + 1), undefined);
  Js_codegen$compile_cps(ctx, then_e, cont);
  (ctx.indent = (ctx.indent - 1), undefined);
  Js_codegen$emit_line(ctx, "} else {");
  (ctx.indent = (ctx.indent + 1), undefined);
  Js_codegen$compile_cps(ctx, else_e, cont);
  (ctx.indent = (ctx.indent - 1), undefined);
  const _t12709 = Js_codegen$emit_line(ctx, "}");
  return _t12709;
}
function Js_codegen$compile_match_cps(ctx, scrut, arms, loc, cont) {
  const scrut_js_12710 = Js_codegen$compile_non_tail(ctx, scrut);
  const scrut_tmp_12712 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(scrut_tmp_12712)) + " = ") + __dict_Show_string.show(scrut_js_12710)) + ";"));
  const matched_12714 = Js_codegen$fresh_tmp(ctx);
  Js_codegen$emit_line(ctx, (("let " + __dict_Show_string.show(matched_12714)) + " = false;"));
  function _t12716(__p439) {
    let _t12718;
    const _t12717 = __p439;
    _t12719: {
      if (true) {
        const pat = _t12717[0];
        const guard = _t12717[1];
        const body = _t12717[2];
        let _t12721;
        const _t12720 = Js_codegen$compile_pattern(ctx, scrut_tmp_12712, pat);
        _t12722: {
          if (true) {
            const conds = _t12720[0];
            const bindings = _t12720[1];
            let _t12724;
            const _t12723 = conds;
            _t12725: {
              if (_t12723 === null) {
                _t12724 = "true";
                break _t12725;
              }
              if (true) {
                _t12724 = String$concat(" && ", conds);
                break _t12725;
              }
              _match_fail("line 16933");
            }
            const cond_str_12726 = _t12724;
            Js_codegen$emit_line(ctx, (((("if (!" + __dict_Show_string.show(matched_12714)) + " && ") + __dict_Show_string.show(cond_str_12726)) + ") {"));
            (ctx.indent = (ctx.indent + 1), undefined);
            Js_codegen$push_scope(ctx);
            function _t12728(__p440) {
              let _t12730;
              const _t12729 = __p440;
              _t12731: {
                if (true) {
                  const mml_name = _t12729[0];
                  const js_expr = _t12729[1];
                  const js_nm_12732 = Js_codegen$mangle_name(mml_name);
                  Js_codegen$bind_var(ctx, mml_name, js_nm_12732);
                  const _t12733 = Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_nm_12732)) + " = ") + __dict_Show_string.show(js_expr)) + ";"));
                  _t12730 = _t12733;
                  break _t12731;
                }
                _match_fail("line 16933");
              }
              return _t12730;
            }
            List$iter(_t12728, bindings);
            let _t12735;
            const _t12734 = guard;
            _t12736: {
              if (_t12734._tag === 1) {
                const g = _t12734._val;
                const guard_js_12737 = Js_codegen$compile_non_tail(ctx, g);
                Js_codegen$emit_line(ctx, (("if (" + __dict_Show_string.show(guard_js_12737)) + ") {"));
                (ctx.indent = (ctx.indent + 1), undefined);
                Js_codegen$emit_line(ctx, (__dict_Show_string.show(matched_12714) + " = true;"));
                Js_codegen$compile_cps(ctx, body, cont);
                (ctx.indent = (ctx.indent - 1), undefined);
                const _t12738 = Js_codegen$emit_line(ctx, "}");
                _t12735 = _t12738;
                break _t12736;
              }
              if (_t12734._tag === 0) {
                Js_codegen$emit_line(ctx, (__dict_Show_string.show(matched_12714) + " = true;"));
                _t12735 = Js_codegen$compile_cps(ctx, body, cont);
                break _t12736;
              }
              _match_fail("line 16933");
            }
            _t12735;
            Js_codegen$pop_scope(ctx);
            (ctx.indent = (ctx.indent - 1), undefined);
            const _t12727 = Js_codegen$emit_line(ctx, "}");
            _t12721 = _t12727;
            break _t12722;
          }
          _match_fail("line 16933");
        }
        _t12718 = _t12721;
        break _t12719;
      }
      _match_fail("line 16933");
    }
    return _t12718;
  }
  List$iter(_t12716, arms);
  const _t12715 = Js_codegen$emit_line(ctx, (((("if (!" + __dict_Show_string.show(matched_12714)) + ") _match_fail(\"line ") + __dict_Show_int.show(loc.line)) + "\");"));
  const _t12713 = _t12715;
  const _t12711 = _t12713;
  return _t12711;
}
function Js_codegen$compile_app_cps(ctx, _te, fn_, arg, cont) {
  function collect_args(expr, acc) {
    while (true) {
      let _t12740;
      const _t12739 = expr.expr;
      _t12741: {
        if (_t12739._tag === 11) {
          const inner_fn = _t12739._val[0];
          const inner_arg = _t12739._val[1];
          const _t12742 = inner_fn;
          const _t12743 = ({_hd: inner_arg, _tl: acc});
          expr = _t12742;
          acc = _t12743;
          continue;
          _t12740 = undefined;
          break _t12741;
        }
        if (true) {
          _t12740 = [expr, acc];
          break _t12741;
        }
        _match_fail("line 16933");
      }
      return _t12740;
    }
  }
  let _t12746;
  const _t12745 = collect_args(fn_, ({_hd: arg, _tl: null}));
  _t12747: {
    if (true) {
      const base_fn = _t12745[0];
      const all_args = _t12745[1];
      const fn_js_12748 = Js_codegen$compile_non_tail(ctx, base_fn);
      const args_js_12750 = List$map(_call(Js_codegen$compile_non_tail, [ctx]), all_args);
      const n_12752 = List$length(all_args);
      const known_arity_12754 = Js_codegen$count_arrows(base_fn.ty);
      let _t12756;
      if (_eq(known_arity_12754, ({_tag: 1, _name: "Some", _val: n_12752}))) {
        _t12756 = (fn_js_12748 + ("(" + (String$concat(", ", args_js_12750) + ")")));
      } else {
        _t12756 = ("_call(" + (fn_js_12748 + (", [" + (String$concat(", ", args_js_12750) + "])"))));
      }
      const call_expr_12757 = _t12756;
      const result_var_12759 = Js_codegen$fresh_tmp(ctx);
      Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(result_var_12759)) + " = _resolve(") + __dict_Show_string.show(call_expr_12757)) + ");"));
      const _t12760 = cont(result_var_12759);
      const _t12758 = _t12760;
      const _t12755 = _t12758;
      const _t12753 = _t12755;
      const _t12751 = _t12753;
      const _t12749 = _t12751;
      _t12746 = _t12749;
      break _t12747;
    }
    _match_fail("line 16933");
  }
  const _t12744 = _t12746;
  return _t12744;
}
function Js_codegen$compile_decl(ctx, decl) {
  let _t12762;
  const _t12761 = decl;
  _t12763: {
    if (_t12761._tag === 0) {
      const name = _t12761._val[0];
      const te = _t12761._val[1];
      let _t12764;
      if ((name === "_")) {
        const v_12765 = Js_codegen$compile_expr(ctx, te);
        const _t12766 = Js_codegen$emit_line(ctx, (__dict_Show_string.show(v_12765) + ";"));
        _t12764 = _t12766;
      } else {
        const base_name_12767 = Js_codegen$mangle_name(name);
        let _t12770;
        const _t12769 = ctx.scopes;
        _t12771: {
          if (_t12769 !== null) {
            const tbl = _t12769._hd;
            if (_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, tbl, name])) {
              _t12770 = (Js_codegen$fresh_tmp(ctx) + ("_" + base_name_12767));
              break _t12771;
            }
          }
          if (true) {
            _t12770 = base_name_12767;
            break _t12771;
          }
          _match_fail("line 16933");
        }
        const js_name_12772 = _t12770;
        let _t12775;
        const _t12774 = te.expr;
        _t12776: {
          if (_t12774._tag === 10) {
            Js_codegen$compile_named_function(ctx, js_name_12772, te);
            _t12775 = Js_codegen$bind_var(ctx, name, js_name_12772);
            break _t12776;
          }
          if (true) {
            const v_12777 = Js_codegen$compile_expr(ctx, te);
            Js_codegen$emit_line(ctx, (((("const " + __dict_Show_string.show(js_name_12772)) + " = ") + __dict_Show_string.show(v_12777)) + ";"));
            const _t12778 = Js_codegen$bind_var(ctx, name, js_name_12772);
            _t12775 = _t12778;
            break _t12776;
          }
          _match_fail("line 16933");
        }
        _t12775;
        let _t12779;
        if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
          _t12779 = (ctx.top_level_exports = ({_hd: [name, js_name_12772], _tl: ctx.top_level_exports}), undefined);
        } else {
          _t12779 = undefined;
        }
        const _t12773 = _t12779;
        const _t12768 = _t12773;
        _t12764 = _t12768;
      }
      _t12762 = _t12764;
      break _t12763;
    }
    if (_t12761._tag === 1) {
      const name = _t12761._val[0];
      const te = _t12761._val[1];
      const base_name_12780 = Js_codegen$mangle_name(name);
      let _t12783;
      const _t12782 = ctx.scopes;
      _t12784: {
        if (_t12782 !== null) {
          const tbl = _t12782._hd;
          if (_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, tbl, name])) {
            _t12783 = (Js_codegen$fresh_tmp(ctx) + ("_" + base_name_12780));
            break _t12784;
          }
        }
        if (true) {
          _t12783 = base_name_12780;
          break _t12784;
        }
        _match_fail("line 16933");
      }
      const js_name_12785 = _t12783;
      const v_12787 = Js_codegen$compile_expr(ctx, te);
      Js_codegen$emit_line(ctx, (((("let " + __dict_Show_string.show(js_name_12785)) + " = ") + __dict_Show_string.show(v_12787)) + ";"));
      Js_codegen$bind_var(ctx, name, js_name_12785);
      let _t12789;
      if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
        _t12789 = (ctx.top_level_exports = ({_hd: [name, js_name_12785], _tl: ctx.top_level_exports}), undefined);
      } else {
        _t12789 = undefined;
      }
      const _t12788 = _t12789;
      const _t12786 = _t12788;
      const _t12781 = _t12786;
      _t12762 = _t12781;
      break _t12763;
    }
    if (_t12761._tag === 2) {
      const name = _t12761._val[0];
      const te = _t12761._val[1];
      const base_name_12790 = Js_codegen$mangle_name(name);
      let _t12793;
      const _t12792 = ctx.scopes;
      _t12794: {
        if (_t12792 !== null) {
          const tbl = _t12792._hd;
          if (_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, tbl, name])) {
            _t12793 = (Js_codegen$fresh_tmp(ctx) + ("_" + base_name_12790));
            break _t12794;
          }
        }
        if (true) {
          _t12793 = base_name_12790;
          break _t12794;
        }
        _match_fail("line 16933");
      }
      const js_name_12795 = _t12793;
      Js_codegen$bind_var(ctx, name, js_name_12795);
      let _t12798;
      const _t12797 = te.expr;
      _t12799: {
        if (_t12797._tag === 10) {
          _t12798 = Js_codegen$compile_named_function(ctx, js_name_12795, te);
          break _t12799;
        }
        if (true) {
          Js_codegen$emit_js_placeholder(ctx, js_name_12795, te);
          _t12798 = Js_codegen$emit_js_backpatch(ctx, js_name_12795, te);
          break _t12799;
        }
        _match_fail("line 16933");
      }
      _t12798;
      let _t12800;
      if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
        _t12800 = (ctx.top_level_exports = ({_hd: [name, js_name_12795], _tl: ctx.top_level_exports}), undefined);
      } else {
        _t12800 = undefined;
      }
      const _t12796 = _t12800;
      const _t12791 = _t12796;
      _t12762 = _t12791;
      break _t12763;
    }
    if (_t12761._tag === 3) {
      const bindings = _t12761._val;
      function _t12801(__p441) {
        let _t12803;
        const _t12802 = __p441;
        _t12804: {
          if (true) {
            const name = _t12802[0];
            const te = _t12802[1];
            const base_name_12805 = Js_codegen$mangle_name(name);
            let _t12808;
            const _t12807 = ctx.scopes;
            _t12809: {
              if (_t12807 !== null) {
                const tbl = _t12807._hd;
                if (_call(Hashtbl$has, [__dict_Hash_string, __dict_Eq_string, tbl, name])) {
                  _t12808 = (Js_codegen$fresh_tmp(ctx) + ("_" + base_name_12805));
                  break _t12809;
                }
              }
              if (true) {
                _t12808 = base_name_12805;
                break _t12809;
              }
              _match_fail("line 16933");
            }
            const js_name_12810 = _t12808;
            const _t12811 = [name, js_name_12810, te];
            const _t12806 = _t12811;
            _t12803 = _t12806;
            break _t12804;
          }
          _match_fail("line 16933");
        }
        return _t12803;
      }
      const named_bindings_12812 = List$map(_t12801, bindings);
      function _t12814(__p442) {
        let _t12816;
        const _t12815 = __p442;
        _t12817: {
          if (true) {
            const name = _t12815[0];
            const js_name = _t12815[1];
            const te = _t12815[2];
            Js_codegen$bind_var(ctx, name, js_name);
            let _t12818;
            if (((List$length(ctx.scopes) === 1) && Js_codegen$is_exportable_name(name))) {
              _t12818 = (ctx.top_level_exports = ({_hd: [name, js_name], _tl: ctx.top_level_exports}), undefined);
            } else {
              _t12818 = undefined;
            }
            _t12818;
            let _t12820;
            const _t12819 = te.expr;
            _t12821: {
              if (_t12819._tag === 10) {
                _t12820 = undefined;
                break _t12821;
              }
              if (true) {
                _t12820 = Js_codegen$emit_js_placeholder(ctx, js_name, te);
                break _t12821;
              }
              _match_fail("line 16933");
            }
            _t12816 = _t12820;
            break _t12817;
          }
          _match_fail("line 16933");
        }
        return _t12816;
      }
      List$iter(_t12814, named_bindings_12812);
      function _t12822(__p443) {
        let _t12824;
        const _t12823 = __p443;
        _t12825: {
          if (true) {
            const _name = _t12823[0];
            const js_name = _t12823[1];
            const fn_expr = _t12823[2];
            let _t12827;
            const _t12826 = fn_expr.expr;
            _t12828: {
              if (_t12826._tag === 10) {
                _t12827 = Js_codegen$compile_named_function(ctx, js_name, fn_expr);
                break _t12828;
              }
              if (true) {
                _t12827 = undefined;
                break _t12828;
              }
              _match_fail("line 16933");
            }
            _t12824 = _t12827;
            break _t12825;
          }
          _match_fail("line 16933");
        }
        return _t12824;
      }
      List$iter(_t12822, named_bindings_12812);
      function _t12829(__p444) {
        let _t12831;
        const _t12830 = __p444;
        _t12832: {
          if (true) {
            const _name = _t12830[0];
            const js_name = _t12830[1];
            const te = _t12830[2];
            let _t12834;
            const _t12833 = te.expr;
            _t12835: {
              if (_t12833._tag === 10) {
                _t12834 = undefined;
                break _t12835;
              }
              if (true) {
                _t12834 = Js_codegen$emit_js_backpatch(ctx, js_name, te);
                break _t12835;
              }
              _match_fail("line 16933");
            }
            _t12831 = _t12834;
            break _t12832;
          }
          _match_fail("line 16933");
        }
        return _t12831;
      }
      const _t12813 = List$iter(_t12829, named_bindings_12812);
      _t12762 = _t12813;
      break _t12763;
    }
    if (_t12761._tag === 4) {
      _t12762 = undefined;
      break _t12763;
    }
    if (_t12761._tag === 6) {
      _t12762 = undefined;
      break _t12763;
    }
    if (_t12761._tag === 7) {
      _t12762 = undefined;
      break _t12763;
    }
    if (_t12761._tag === 5) {
      const te = _t12761._val;
      const v_12836 = Js_codegen$compile_expr(ctx, te);
      const _t12837 = Js_codegen$emit_line(ctx, (("_last_val = " + __dict_Show_string.show(v_12836)) + ";"));
      _t12762 = _t12837;
      break _t12763;
    }
    if (_t12761._tag === 8) {
      const name = _t12761._val[0];
      const _scheme = _t12761._val[1];
      const js_name_12838 = Js_codegen$mangle_name(name);
      Js_codegen$emit_line(ctx, (((((((((("if (typeof " + __dict_Show_string.show(js_name_12838)) + " === \"undefined\") { if (globalThis._mmlExterns && globalThis._mmlExterns[") + __dict_Show_string.show(Js_codegen$escape_js_string(name))) + "]) var ") + __dict_Show_string.show(js_name_12838)) + " = globalThis._mmlExterns[") + __dict_Show_string.show(Js_codegen$escape_js_string(name))) + "]; else throw new Error(\"extern \" + ") + __dict_Show_string.show(Js_codegen$escape_js_string(name))) + " + \" not provided\"); }"));
      const _t12839 = Js_codegen$bind_var(ctx, name, js_name_12838);
      _t12762 = _t12839;
      break _t12763;
    }
    if (_t12761._tag === 9) {
      const mod_name = _t12761._val[0];
      const decls = _t12761._val[1];
      const saved_module_12840 = ctx.current_module;
      (ctx.current_module = ({_tag: 1, _name: "Some", _val: mod_name}), undefined);
      Js_codegen$push_scope(ctx);
      List$iter(_call(Js_codegen$compile_decl, [ctx]), decls);
      (ctx.current_module = saved_module_12840, undefined);
      let _t12843;
      const _t12842 = ctx.scopes;
      _t12844: {
        if (_t12842 !== null) {
          const current = _t12842._hd;
          function _t12845(mml_name, js_name) {
            const qualified_12846 = (mod_name + ("." + mml_name));
            let _t12849;
            const _t12848 = ctx.scopes;
            _t12850: {
              if (_t12848 !== null && _t12848._tl !== null) {
                const parent = _t12848._tl._hd;
                _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, parent, qualified_12846, js_name]);
                _t12849 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, parent, mml_name, js_name]);
                break _t12850;
              }
              if (true) {
                _t12849 = undefined;
                break _t12850;
              }
              _match_fail("line 16933");
            }
            const _t12847 = _t12849;
            return _t12847;
          }
          _t12843 = Hashtbl$iter(_t12845, current);
          break _t12844;
        }
        if (_t12842 === null) {
          _t12843 = undefined;
          break _t12844;
        }
        _match_fail("line 16933");
      }
      _t12843;
      const _t12841 = Js_codegen$pop_scope(ctx);
      _t12762 = _t12841;
      break _t12763;
    }
    if (_t12761._tag === 10) {
      const aliases = _t12761._val;
      function _t12851(__p445) {
        let _t12853;
        const _t12852 = __p445;
        _t12854: {
          if (true) {
            const short_name = _t12852[0];
            const qualified_name = _t12852[1];
            const js_name_12855 = Js_codegen$lookup_var(ctx, qualified_name);
            const _t12856 = Js_codegen$bind_var(ctx, short_name, js_name_12855);
            _t12853 = _t12856;
            break _t12854;
          }
          _match_fail("line 16933");
        }
        return _t12853;
      }
      _t12762 = List$iter(_t12851, aliases);
      break _t12763;
    }
    _match_fail("line 16933");
  }
  return _t12762;
}
const Js_codegen$js_builtins = "// --- Builtins ---\nfunction print(v) {\n  const s = (typeof v === \"string\") ? v : _pp(v);\n  if (typeof globalThis._jsOutput === \"function\") globalThis._jsOutput(s);\n  else if (typeof process !== \"undefined\") process.stdout.write(s);\n  return undefined;\n}\nfunction println(v) {\n  const s = (typeof v === \"string\") ? v : _pp(v);\n  if (typeof globalThis._jsOutput === \"function\") globalThis._jsOutput(s + \"\\n\");\n  else if (typeof process !== \"undefined\") process.stdout.write(s + \"\\n\");\n  return undefined;\n}\nfunction string_of_int(n) { return String(n); }\nfunction int_of_string(s) { const n = parseInt(s, 10); if (isNaN(n)) throw new Error(\"int_of_string: \" + s); return n; }\nfunction float_of_int(n) { return n; }\nfunction int_of_float(f) { return Math.trunc(f); }\nfunction float_of_string(s) { const f = parseFloat(s); if (isNaN(f)) throw new Error(\"float_of_string: \" + s); return f; }\nfunction string_of_float(f) {\n  const s = String(f);\n  return s.includes(\".\") || s.includes(\"e\") ? s : s + \".\";\n}\nfunction string_of_bool(b) { return String(b); }\nfunction failwith(msg) { throw new Error(msg); }\nconst not = (b) => !b;\nfunction $caret(a, b) { return a + b; }\nfunction $mod(a, b) { return a % b; }\nfunction __show_value(v) { return _pp(v); }\nfunction copy_continuation(k) { return k; }\nconst ignore = (_) => undefined;\nfunction fst(t) { return t[0]; }\nfunction snd(t) { return t[1]; }\nfunction string_length(s) { return s.length; }\nfunction string_sub(s, start, len) { return s.substring(start, start + len); }\nfunction string_get(s, i) { return s.charCodeAt(i); }\nfunction string_contains(s, sub) { return s.includes(sub); }\nfunction string_concat(sep, parts) {\n  const arr = [];\n  let c = parts;\n  while (c !== null) { arr.push(c._hd); c = c._tl; }\n  return arr.join(sep);\n}\nfunction array_length(a) { return a._arr.length; }\nfunction array_get(a, i) { return a._arr[i]; }\nfunction array_set(a, i, v) { a._arr[i] = v; return undefined; }\nfunction array_make(n, v) { return {_arr: new Array(n).fill(v)}; }\nfunction array_of_list(lst) {\n  const arr = [];\n  let c = lst;\n  while (c !== null) { arr.push(c._hd); c = c._tl; }\n  return {_arr: arr};\n}\nfunction array_to_list(arr) {\n  const a = arr._arr;\n  let result = null;\n  for (let i = a.length - 1; i >= 0; i--) result = {_hd: a[i], _tl: result};\n  return result;\n}\nfunction array_copy(a) { return {_arr: a._arr.slice()}; }\nfunction array_sub(a, start, len) { return {_arr: a._arr.slice(start, start + len)}; }\nfunction __math_pow(a, b) { return Math.pow(a, b); }\nfunction __math_sqrt(x) { return Math.sqrt(x); }\nfunction __math_floor(x) { return Math.floor(x); }\nfunction __math_ceil(x) { return Math.ceil(x); }\nfunction __math_round(x) { return Math.round(x); }\nfunction __math_abs(x) { return Math.abs(x); }\nfunction __math_sin(x) { return Math.sin(x); }\nfunction __math_cos(x) { return Math.cos(x); }\nfunction __math_abs_float(x) { return Math.abs(x); }\nfunction __byte_to_char(b) { return String.fromCharCode(b); }\nfunction __byte_to_int(b) { return b; }\nfunction __byte_of_int(n) { return n & 0xFF; }\nfunction __byte_to_string(b) { return String.fromCharCode(b); }\nfunction __char_to_byte(s) { return s.charCodeAt(0); }\nfunction __rune_to_string(cp) {\n  return String.fromCodePoint(cp);\n}\nfunction __string_to_runes(s) {\n  const cps = Array.from(s).map(c => c.codePointAt(0));\n  let result = null;\n  for (let i = cps.length - 1; i >= 0; i--) result = {_hd: cps[i], _tl: result};\n  return result;\n}\nfunction __rune_to_int(r) { return r; }\nfunction __rune_of_int(n) { return n; }\nfunction __int_to_hex(n) { return n.toString(16); }\nfunction __int_to_oct(n) { return n.toString(8); }\nfunction __int_to_bin(n) { return n.toString(2); }\nfunction __fmt_float(prec, f) { return f.toFixed(prec); }\nfunction __fmt_hex(n) { return n.toString(16); }\nfunction __fmt_hex_upper(n) { return n.toString(16).toUpperCase(); }\nfunction __fmt_oct(n) { return n.toString(8); }\nfunction __fmt_bin(n) { return n.toString(2); }\nfunction __fmt_zero_pad(width, s) { return s.padStart(width, \"0\"); }\nfunction __fmt_pad_left(width, s) { return s.padStart(width, \" \"); }\nfunction __fmt_pad_right(width, s) { return s.padEnd(width, \" \"); }\nfunction __sys_time() { return Date.now() / 1000.0; }\nfunction __sys_exit(code) { if (typeof process !== \"undefined\") process.exit(code); throw new Error(\"exit: \" + code); }\n// --- Module extern stubs ---\n// String module\nfunction String$length(s) { return s.length; }\nfunction String$sub(s, start, len) {\n  if (start < 0 || len < 0 || start + len > s.length)\n    throw new Error(\"String.sub: index out of bounds\");\n  return s.substring(start, start + len);\n}\nfunction String$split(delim, input) {\n  if (delim.length === 0) {\n    let r = null;\n    for (let i = input.length - 1; i >= 0; i--) r = {_hd: input[i], _tl: r};\n    return r;\n  }\n  const parts = input.split(delim);\n  let r = null;\n  for (let i = parts.length - 1; i >= 0; i--) r = {_hd: parts[i], _tl: r};\n  return r;\n}\nfunction String$trim(s) { return s.trim(); }\nfunction String$starts_with(prefix, s) { return s.startsWith(prefix); }\nfunction String$contains(sub, s) { return s.includes(sub); }\nfunction String$replace(old_s, new_s, input) {\n  if (old_s.length === 0) return input;\n  return input.split(old_s).join(new_s);\n}\nfunction String$to_int(s) { const n = parseInt(s,10); return isNaN(n) ? {_tag:0,_name:\"None\"} : {_tag:1,_name:\"Some\",_val:n}; }\nfunction String$to_float(s) { const f = parseFloat(s); return isNaN(f) ? {_tag:0,_name:\"None\"} : {_tag:1,_name:\"Some\",_val:f}; }\nfunction String$uppercase(s) { return s.toUpperCase(); }\nfunction String$lowercase(s) { return s.toLowerCase(); }\nfunction String$get(s, i) {\n  if (i < 0 || i >= s.length) throw new Error(\"String.get: index \" + i + \" out of bounds (length \" + s.length + \")\");\n  return s.charCodeAt(i);\n}\nfunction String$to_bytes(s) {\n  let r = null;\n  for (let i = s.length - 1; i >= 0; i--) r = {_hd: s.charCodeAt(i), _tl: r};\n  return r;\n}\nfunction String$of_bytes(lst) {\n  let r = \"\";\n  let c = lst;\n  while (c !== null) { r += String.fromCharCode(c._hd); c = c._tl; }\n  return r;\n}\nfunction String$to_byte_array(s) {\n  const a = new Array(s.length);\n  for (let i = 0; i < s.length; i++) a[i] = s.charCodeAt(i);\n  return {_arr: a};\n}\nfunction String$of_byte_array(a) {\n  let r = \"\";\n  for (let i = 0; i < a._arr.length; i++) r += String.fromCharCode(a._arr[i]);\n  return r;\n}\nfunction String$to_runes(s) { return __string_to_runes(s); }\nfunction String$of_runes(lst) {\n  let r = \"\";\n  let c = lst;\n  while (c !== null) { r += String.fromCodePoint(c._hd); c = c._tl; }\n  return r;\n}\nfunction String$get_rune(s, n) {\n  const cps = Array.from(s);\n  if (n < 0 || n >= cps.length) throw new Error(\"String.get_rune: index \" + n + \" out of bounds\");\n  return cps[n].codePointAt(0);\n}\nfunction String$of_byte(b) { return String.fromCharCode(b); }\nfunction String$rune_length(s) { return Array.from(s).length; }\nfunction String$make(n, b) {\n  if (n < 0) throw new Error(\"String.make: negative length\");\n  return String.fromCharCode(b).repeat(n);\n}\nfunction String$index_opt(s, b) { const i=s.indexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:\"None\"}:{_tag:1,_name:\"Some\",_val:i}; }\nfunction String$rindex_opt(s, b) { const i=s.lastIndexOf(String.fromCharCode(b)); return i<0?{_tag:0,_name:\"None\"}:{_tag:1,_name:\"Some\",_val:i}; }\nfunction String$concat(sep, lst) { return string_concat(sep, lst); }\nfunction String$compare(a, b) { return a < b ? -1 : a > b ? 1 : 0; }\n// Array module\nfunction Array$make(n, v) { return array_make(n, v); }\nfunction Array$get(a, i) { return array_get(a, i); }\nfunction Array$set(a, i, v) { return array_set(a, i, v); }\nfunction Array$length(a) { return array_length(a); }\nfunction Array$to_list(a) { return array_to_list(a); }\nfunction Array$of_list(l) { return array_of_list(l); }\nfunction Array$copy(a) { return array_copy(a); }\nfunction Array$sub(a, s, l) { return array_sub(a, s, l); }\n// IO module\nfunction IO$read_file(path) {\n  if (typeof globalThis._jsReadFile === \"function\") return globalThis._jsReadFile(path);\n  if (typeof require !== \"undefined\") return require(\"fs\").readFileSync(path,\"utf8\");\n  throw new Error(\"IO.read_file: not available in this environment\");\n}\nfunction IO$write_file(path, data) {\n  if (typeof require !== \"undefined\") { require(\"fs\").writeFileSync(path,data); return undefined; }\n  throw new Error(\"IO.write_file: not available in this environment\");\n}\nfunction IO$append_file(path, data) {\n  if (typeof require !== \"undefined\") { require(\"fs\").appendFileSync(path,data); return undefined; }\n  throw new Error(\"IO.append_file: not available in this environment\");\n}\nfunction IO$read_line(u) {\n  if (typeof require !== \"undefined\") {\n    const buf = Buffer.alloc(1);\n    let line = \"\";\n    const fd = require(\"fs\").openSync(\"/dev/stdin\", \"rs\");\n    while (true) {\n      const n = require(\"fs\").readSync(fd, buf, 0, 1);\n      if (n === 0 || buf[0] === 10) break;\n      line += String.fromCharCode(buf[0]);\n    }\n    return line;\n  }\n  return \"\";\n}\nfunction IO$file_exists(path) {\n  if (typeof require !== \"undefined\") return require(\"fs\").existsSync(path);\n  return false;\n}\n// Sys module\nfunction Sys$args(u) {\n  if (globalThis._jsSysArgs) {\n    const a = globalThis._jsSysArgs;\n    let r = null;\n    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};\n    return r;\n  }\n  if (typeof process !== \"undefined\") {\n    const a = process.argv.slice(1);\n    let r = null;\n    for (let i = a.length - 1; i >= 0; i--) r = {_hd: a[i], _tl: r};\n    return r;\n  }\n  return null;\n}\nfunction Sys$getenv(name) {\n  if (typeof process !== \"undefined\") {\n    const v = process.env[name];\n    return v === undefined ? {_tag:0,_name:\"None\"} : {_tag:1,_name:\"Some\",_val:v};\n  }\n  return {_tag:0,_name:\"None\"};\n}\nfunction Sys$exit(code) { __sys_exit(code); }\nfunction Sys$time(u) { return __sys_time(); }\n// Runtime module (stubs â€” eval not supported in compiled JS)\nfunction Runtime$eval(s) { throw new Error(\"Runtime.eval: not supported in compiled JS\"); }\nfunction Runtime$eval_file(s) { throw new Error(\"Runtime.eval_file: not supported in compiled JS\"); }\n// --- Typeclass primitive externs ---\nfunction __num_add_int(a, b) { return a + b; }\nfunction __num_sub_int(a, b) { return a - b; }\nfunction __num_mul_int(a, b) { return a * b; }\nfunction __num_div_int(a, b) { if (b === 0) throw new Error(\"division by zero\"); return (a / b) | 0; }\nfunction __num_neg_int(a) { return -a; }\nfunction __num_add_float(a, b) { return a + b; }\nfunction __num_sub_float(a, b) { return a - b; }\nfunction __num_mul_float(a, b) { return a * b; }\nfunction __num_div_float(a, b) { return a / b; }\nfunction __num_neg_float(a) { return -a; }\nfunction __eq_int(a, b) { return a === b; }\nfunction __neq_int(a, b) { return a !== b; }\nfunction __eq_float(a, b) { return a === b; }\nfunction __neq_float(a, b) { return a !== b; }\nfunction __eq_string(a, b) { return a === b; }\nfunction __neq_string(a, b) { return a !== b; }\nfunction __eq_bool(a, b) { return a === b; }\nfunction __neq_bool(a, b) { return a !== b; }\nfunction __eq_byte(a, b) { return a === b; }\nfunction __neq_byte(a, b) { return a !== b; }\nfunction __eq_rune(a, b) { return a === b; }\nfunction __neq_rune(a, b) { return a !== b; }\nfunction __lt_int(a, b) { return a < b; }\nfunction __gt_int(a, b) { return a > b; }\nfunction __le_int(a, b) { return a <= b; }\nfunction __ge_int(a, b) { return a >= b; }\nfunction __lt_float(a, b) { return a < b; }\nfunction __gt_float(a, b) { return a > b; }\nfunction __le_float(a, b) { return a <= b; }\nfunction __ge_float(a, b) { return a >= b; }\nfunction __lt_string(a, b) { return a < b; }\nfunction __gt_string(a, b) { return a > b; }\nfunction __le_string(a, b) { return a <= b; }\nfunction __ge_string(a, b) { return a >= b; }\nfunction __lt_byte(a, b) { return a < b; }\nfunction __gt_byte(a, b) { return a > b; }\nfunction __le_byte(a, b) { return a <= b; }\nfunction __ge_byte(a, b) { return a >= b; }\nfunction __lt_rune(a, b) { return a < b; }\nfunction __gt_rune(a, b) { return a > b; }\nfunction __le_rune(a, b) { return a <= b; }\nfunction __ge_rune(a, b) { return a >= b; }\nfunction __band_int(a, b) { return a & b; }\nfunction __bor_int(a, b) { return a | b; }\nfunction __bxor_int(a, b) { return a ^ b; }\nfunction __bshl_int(a, b) { return a << b; }\nfunction __bshr_int(a, b) { return a >> b; }\nfunction __bnot_int(a) { return ~a; }\nfunction __show_int(a) { return String(a); }\nfunction __show_float(a) { return string_of_float(a); }\nfunction __show_bool(a) { return String(a); }\nfunction __show_string(a) { return a; }\nfunction __show_unit(_) { return \"()\"; }\nfunction __show_byte(a) { return \"#\" + a.toString(16).padStart(2, \"0\"); }\nfunction __show_rune(a) { return String.fromCodePoint(a); }\nfunction __index_at_array(i, arr) { if (i < 0 || i >= arr.length) throw new Error(\"array index out of bounds: \" + i + \" (length \" + arr.length + \")\"); return arr[i]; }\nfunction __index_at_string(i, s) { if (i < 0 || i >= s.length) throw new Error(\"string index out of bounds: \" + i + \" (length \" + s.length + \")\"); return s.charCodeAt(i); }\n// --- Canvas builtins (browser only) ---\nfunction Canvas$init(w, h) {\n  if (typeof globalThis._canvasInit === \"function\") globalThis._canvasInit(w, h);\n  return undefined;\n}\nfunction Canvas$clear(color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height); }\n  return undefined;\n}\nfunction Canvas$fill_rect(x, y, w, h, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.fillRect(x, y, w, h); }\n  return undefined;\n}\nfunction Canvas$stroke_rect(x, y, w, h, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.strokeStyle = color; ctx.lineWidth = 1; ctx.strokeRect(x, y, w, h); }\n  return undefined;\n}\nfunction Canvas$fill_circle(x, y, r, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x, y, r, 0, 2*Math.PI); ctx.fill(); }\n  return undefined;\n}\nfunction Canvas$draw_text(text, x, y, color) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.fillStyle = color; ctx.textBaseline = \"top\"; ctx.fillText(text, x, y); }\n  return undefined;\n}\nfunction Canvas$set_font(font) {\n  const ctx = globalThis._canvasCtx;\n  if (ctx) { ctx.font = font; }\n  return undefined;\n}\nfunction Canvas$mouse_x(_) { return globalThis._canvasMouseX || 0; }\nfunction Canvas$mouse_y(_) { return globalThis._canvasMouseY || 0; }\nfunction Canvas$mouse_down(_) { return !!globalThis._canvasMouseDown; }\nfunction Canvas$mouse_clicked(_) { return !!globalThis._canvasMouseClicked; }\nfunction Canvas$key_down(key) { return !!(globalThis._canvasKeysDown && globalThis._canvasKeysDown[key]); }\nfunction Canvas$key_pressed(key) { return !!(globalThis._canvasKeysPressed && globalThis._canvasKeysPressed[key]); }\nfunction Canvas$start_app(init_fn, frame_fn) {\n  globalThis._canvasApp = { initFn: init_fn, frameFn: frame_fn, jsMode: true, call: _call };\n  return undefined;\n}\n";
function Js_codegen$emit_exports(ctx) {
  Js_codegen$emit(ctx, "var _mml_exports = {\"_result\": _last_val, \"_call\": _call, \"_pp\": _pp");
  function _t12857(__p446) {
    let _t12859;
    const _t12858 = __p446;
    _t12860: {
      if (true) {
        const mml_name = _t12858[0];
        const js_name = _t12858[1];
        _t12859 = Js_codegen$emit(ctx, (((", " + __dict_Show_string.show(Js_codegen$escape_js_string(mml_name))) + ": ") + __dict_Show_string.show(js_name)));
        break _t12860;
      }
      _match_fail("line 16933");
    }
    return _t12859;
  }
  List$iter(_t12857, List$rev(ctx.top_level_exports));
  Js_codegen$emit(ctx, "};\n");
  return Js_codegen$emit(ctx, "if (typeof globalThis !== \"undefined\") globalThis._mmlExports = _mml_exports;\n");
}
function Js_codegen$compile_program(type_env, program) {
  const ctx_12861 = Js_codegen$create_ctx(type_env);
  Js_codegen$emit(ctx_12861, Js_codegen$js_runtime);
  Js_codegen$emit(ctx_12861, Js_codegen$js_builtins);
  Js_codegen$emit(ctx_12861, "// --- Compiled MiniML ---\n");
  Js_codegen$emit(ctx_12861, "let _last_val;\n");
  List$iter(_call(Js_codegen$compile_decl, [ctx_12861]), program);
  Js_codegen$emit(ctx_12861, "if (_last_val !== undefined) println(_pp(_last_val));\n");
  Js_codegen$emit_exports(ctx_12861);
  const _t12862 = Buffer$contents(ctx_12861.buf);
  return _t12862;
}
function Js_codegen$compile_program_with_stdlib(type_env, stdlib_programs, user_program) {
  const ctx_12863 = Js_codegen$create_ctx(type_env);
  Js_codegen$emit(ctx_12863, Js_codegen$js_runtime);
  Js_codegen$emit(ctx_12863, Js_codegen$js_builtins);
  Js_codegen$emit(ctx_12863, "// --- Stdlib ---\n");
  function _t12865(__p447) {
    let _t12867;
    const _t12866 = __p447;
    _t12868: {
      if (true) {
        const _te = _t12866[0];
        const prog = _t12866[1];
        function _t12869(decl) {
          const saved_pos_12870 = Buffer$length(ctx_12863.buf);
          const saved_indent_12872 = ctx_12863.indent;
          const _t12874 = (function() {
            const _t12875 = _h;
            _h = Object.assign({}, _t12875, {
              "codegen_error": function(_, __k_try) { throw {_e: "codegen_error", _v: _}; },
            });
            try {
              const __x_12876 = Js_codegen$compile_decl(ctx_12863, decl);
              return __x_12876;
            } catch (_exc) {
              if (_exc && _exc._e === "codegen_error") {
                const _ = _exc._v;
                const full_12877 = Buffer$contents(ctx_12863.buf);
                Buffer$clear(ctx_12863.buf);
                Buffer$add_string(ctx_12863.buf, String$sub(full_12877, 0, saved_pos_12870));
                const _t12878 = (ctx_12863.indent = saved_indent_12872, undefined);
                return _t12878;
              } else { throw _exc; }
            } finally { _h = _t12875; }
          })();
          const _t12873 = _t12874;
          const _t12871 = _t12873;
          return _t12871;
        }
        _t12867 = List$iter(_t12869, prog);
        break _t12868;
      }
      _match_fail("line 16933");
    }
    return _t12867;
  }
  List$iter(_t12865, stdlib_programs);
  Js_codegen$emit(ctx_12863, "// --- Compiled MiniML ---\n");
  Js_codegen$emit(ctx_12863, "let _last_val;\n");
  const stdlib_exports_12879 = ctx_12863.top_level_exports;
  (ctx_12863.top_level_exports = null, undefined);
  List$iter(_call(Js_codegen$compile_decl, [ctx_12863]), user_program);
  Js_codegen$emit(ctx_12863, "if (_last_val !== undefined) println(_pp(_last_val));\n");
  const user_exports_12881 = ctx_12863.top_level_exports;
  (ctx_12863.top_level_exports = user_exports_12881, undefined);
  stdlib_exports_12879;
  undefined;
  Js_codegen$emit_exports(ctx_12863);
  const _t12882 = Buffer$contents(ctx_12863.buf);
  const _t12880 = _t12882;
  const _t12864 = _t12880;
  return _t12864;
}
function Main$list_iter(f, xs) {
  while (true) {
    let _t12884;
    const _t12883 = xs;
    _t12885: {
      if (_t12883 === null) {
        _t12884 = undefined;
        break _t12885;
      }
      if (_t12883 !== null) {
        const x = _t12883._hd;
        const rest = _t12883._tl;
        f(x);
        const _t12886 = f;
        const _t12887 = rest;
        f = _t12886;
        xs = _t12887;
        continue;
        _t12884 = undefined;
        break _t12885;
      }
      _match_fail("line 16933");
    }
    return _t12884;
  }
}
function Main$list_iteri_aux(f, i, xs) {
  while (true) {
    let _t12889;
    const _t12888 = xs;
    _t12890: {
      if (_t12888 === null) {
        _t12889 = undefined;
        break _t12890;
      }
      if (_t12888 !== null) {
        const x = _t12888._hd;
        const rest = _t12888._tl;
        f(i, x);
        const _t12891 = f;
        const _t12892 = (i + 1);
        const _t12893 = rest;
        f = _t12891;
        i = _t12892;
        xs = _t12893;
        continue;
        _t12889 = undefined;
        break _t12890;
      }
      _match_fail("line 16933");
    }
    return _t12889;
  }
}
function Main$list_iteri(f, xs) {
  return Main$list_iteri_aux(f, 0, xs);
}
let Main$native_global_entries = null;
function Main$register_native_ext(idx, name, arity) {
  return (Main$native_global_entries = ({_hd: _call(Serialize$serialize_native_ext, [({show: __show_value}), idx, name, arity]), _tl: Main$native_global_entries}), undefined);
}
function Main$register_native_dict(idx, fields) {
  return (Main$native_global_entries = ({_hd: _call(Serialize$serialize_native_dict, [({show: __show_value}), idx, fields]), _tl: Main$native_global_entries}), undefined);
}
function _t12894_Main$build_native_globals_json(_) {
  return String$concat(",", List$rev(Main$native_global_entries));
}
function Main$add_global(global_names, name) {
  const idx_12895 = Dynarray$length(global_names);
  Dynarray$push(global_names, name);
  const _t12896 = idx_12895;
  return _t12896;
}
function Main$register_builtin(ctx, global_names, name, ty, quant, arity) {
  const scheme_12897 = ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: quant, record_evidences: null, rquant: 0});
  const idx_12899 = Main$add_global(global_names, name);
  Main$register_native_ext(idx_12899, name, arity);
  const stdlib_name_12901 = ("Stdlib." + name);
  const sidx_12903 = Main$add_global(global_names, stdlib_name_12901);
  Main$register_native_ext(sidx_12903, name, arity);
  const vars_12905 = ({_hd: [stdlib_name_12901, scheme_12897], _tl: ({_hd: [name, scheme_12897], _tl: ctx.vars})});
  const __rec_upd_12907 = ctx;
  const _t12908 = ({constraint_tvars: __rec_upd_12907.constraint_tvars, current_eff: __rec_upd_12907.current_eff, current_module: __rec_upd_12907.current_module, inside_handler: __rec_upd_12907.inside_handler, loop_info: __rec_upd_12907.loop_info, mutable_vars: __rec_upd_12907.mutable_vars, return_type: __rec_upd_12907.return_type, return_used: __rec_upd_12907.return_used, type_env: __rec_upd_12907.type_env, vars: vars_12905});
  const _t12906 = [scheme_12897, _t12908];
  const _t12904 = _t12906;
  const _t12902 = _t12904;
  const _t12900 = _t12902;
  const _t12898 = _t12900;
  return _t12898;
}
function Main$register_module_fn(ctx, global_names, mod_name, fn_name, ty, arity) {
  const qualified_12909 = ((mod_name + ".") + fn_name);
  const idx_12911 = Main$add_global(global_names, qualified_12909);
  Main$register_native_ext(idx_12911, qualified_12909, arity);
  const max_gen_12913 = Typechecker$max_tgen_in_ty(ty);
  let _t12915;
  if ((max_gen_12913 >= 0)) {
    _t12915 = ({body: ty, constraints: null, equant: 0, pvquant: 0, quant: (max_gen_12913 + 1), record_evidences: null, rquant: 0});
  } else {
    _t12915 = Types$mono(ty);
  }
  const scheme_12916 = _t12915;
  const vars_12918 = ({_hd: [qualified_12909, scheme_12916], _tl: ctx.vars});
  const __rec_upd_12920 = ctx;
  const _t12921 = ({constraint_tvars: __rec_upd_12920.constraint_tvars, current_eff: __rec_upd_12920.current_eff, current_module: __rec_upd_12920.current_module, inside_handler: __rec_upd_12920.inside_handler, loop_info: __rec_upd_12920.loop_info, mutable_vars: __rec_upd_12920.mutable_vars, return_type: __rec_upd_12920.return_type, return_used: __rec_upd_12920.return_used, type_env: __rec_upd_12920.type_env, vars: vars_12918});
  const _t12919 = [[fn_name, scheme_12916], _t12921];
  const _t12917 = _t12919;
  const _t12914 = _t12917;
  const _t12912 = _t12914;
  const _t12910 = _t12912;
  return _t12910;
}
function Main$register_class_in_ctx(ctx, name, tyvars, methods) {
  const num_params_12922 = List$length(tyvars);
  const class_def_12924 = ({class_fundeps: null, class_methods: methods, class_name: name, class_params: tyvars});
  function _t12926(vars, __p448) {
    let _t12928;
    const _t12927 = __p448;
    _t12929: {
      if (true) {
        const mname = _t12927[0];
        const mty = _t12927[1];
        const max_gen_12930 = Typechecker$max_tgen_in_ty(mty);
        let _t12932;
        if (((max_gen_12930 + 1) > num_params_12922)) {
          _t12932 = (max_gen_12930 + 1);
        } else {
          _t12932 = num_params_12922;
        }
        const quant_12933 = _t12932;
        const _t12934 = ({_hd: [mname, ({body: mty, constraints: null, equant: 0, pvquant: 0, quant: quant_12933, record_evidences: null, rquant: 0})], _tl: vars});
        const _t12931 = _t12934;
        _t12928 = _t12931;
        break _t12929;
      }
      _match_fail("line 16933");
    }
    return _t12928;
  }
  const new_vars_12935 = List$fold(_t12926, ctx.vars, methods);
  const __rec_upd_12937 = ctx.type_env;
  const _t12938 = ({classes: ({_hd: class_def_12924, _tl: ctx.type_env.classes}), constructors: __rec_upd_12937.constructors, effects: __rec_upd_12937.effects, hidden_ctor_types: __rec_upd_12937.hidden_ctor_types, hidden_types: __rec_upd_12937.hidden_types, instances: __rec_upd_12937.instances, modules: __rec_upd_12937.modules, mutable_fields: __rec_upd_12937.mutable_fields, newtypes: __rec_upd_12937.newtypes, records: __rec_upd_12937.records, type_aliases: __rec_upd_12937.type_aliases, type_synonyms: __rec_upd_12937.type_synonyms, variants: __rec_upd_12937.variants});
  const type_env_12939 = _t12938;
  const __rec_upd_12941 = ctx;
  const _t12942 = ({constraint_tvars: __rec_upd_12941.constraint_tvars, current_eff: __rec_upd_12941.current_eff, current_module: __rec_upd_12941.current_module, inside_handler: __rec_upd_12941.inside_handler, loop_info: __rec_upd_12941.loop_info, mutable_vars: __rec_upd_12941.mutable_vars, return_type: __rec_upd_12941.return_type, return_used: __rec_upd_12941.return_used, type_env: type_env_12939, vars: new_vars_12935});
  const _t12940 = _t12942;
  const _t12936 = _t12940;
  const _t12925 = _t12936;
  const _t12923 = _t12925;
  return _t12923;
}
function Main$register_native_instance(ctx, global_names, class_name, tys, methods) {
  const dname_12943 = _call(Types$dict_name, [__dict_Show_string, class_name, tys]);
  const idx_12945 = Main$add_global(global_names, dname_12943);
  function _t12947(__p449) {
    let _t12949;
    const _t12948 = __p449;
    _t12950: {
      if (true) {
        const mname = _t12948[0];
        const ext_name = _t12948[1];
        const arity = _t12948[2];
        _t12949 = [mname, ext_name, arity];
        break _t12950;
      }
      _match_fail("line 16933");
    }
    return _t12949;
  }
  const dict_fields_12951 = List$map(_t12947, methods);
  Main$register_native_dict(idx_12945, dict_fields_12951);
  function _t12953(__p450, __p451) {
    let _t12955;
    const _t12954 = __p450;
    _t12956: {
      if (true) {
        const a = _t12954[0];
        let _t12958;
        const _t12957 = __p451;
        _t12959: {
          if (true) {
            const b = _t12957[0];
            _t12958 = String$compare(a, b);
            break _t12959;
          }
          _match_fail("line 16933");
        }
        _t12955 = _t12958;
        break _t12956;
      }
      _match_fail("line 16933");
    }
    return _t12955;
  }
  const sorted_12960 = List$sort(_t12953, methods);
  function _t12962(__p452) {
    let _t12964;
    const _t12963 = __p452;
    _t12965: {
      if (true) {
        const mname = _t12963[0];
        const ext_name = _t12963[1];
        const arity = _t12963[2];
        const midx_12966 = Main$add_global(global_names, ((dname_12943 + "$") + mname));
        const _t12967 = Main$register_native_ext(midx_12966, ext_name, arity);
        _t12964 = _t12967;
        break _t12965;
      }
      _match_fail("line 16933");
    }
    return _t12964;
  }
  List$iter(_t12962, sorted_12960);
  const inst_12968 = ({inst_class: class_name, inst_constraints: null, inst_dict_name: dname_12943, inst_tys: tys});
  const __rec_upd_12970 = ctx.type_env;
  const _t12971 = ({classes: __rec_upd_12970.classes, constructors: __rec_upd_12970.constructors, effects: __rec_upd_12970.effects, hidden_ctor_types: __rec_upd_12970.hidden_ctor_types, hidden_types: __rec_upd_12970.hidden_types, instances: ({_hd: inst_12968, _tl: ctx.type_env.instances}), modules: __rec_upd_12970.modules, mutable_fields: __rec_upd_12970.mutable_fields, newtypes: __rec_upd_12970.newtypes, records: __rec_upd_12970.records, type_aliases: __rec_upd_12970.type_aliases, type_synonyms: __rec_upd_12970.type_synonyms, variants: __rec_upd_12970.variants});
  const type_env_12972 = _t12971;
  const __rec_upd_12974 = ctx;
  const _t12975 = ({constraint_tvars: __rec_upd_12974.constraint_tvars, current_eff: __rec_upd_12974.current_eff, current_module: __rec_upd_12974.current_module, inside_handler: __rec_upd_12974.inside_handler, loop_info: __rec_upd_12974.loop_info, mutable_vars: __rec_upd_12974.mutable_vars, return_type: __rec_upd_12974.return_type, return_used: __rec_upd_12974.return_used, type_env: type_env_12972, vars: __rec_upd_12974.vars});
  const _t12973 = _t12975;
  const _t12969 = _t12973;
  const _t12961 = _t12969;
  const _t12952 = _t12961;
  const _t12946 = _t12952;
  const _t12944 = _t12946;
  return _t12944;
}
let Main$js_capture_mode = false;
let Main$captured_typed_setups = null;
function Main$compile_setup(ctx, global_names, mutable_globals, source) {
  const tokens_12976 = Lexer$tokenize(source);
  const program_12978 = Parser$parse_program(tokens_12976);
  let _t12981;
  const _t12980 = Typechecker$check_program_in_ctx(ctx, program_12978);
  _t12982: {
    if (true) {
      const ctx2 = _t12980[0];
      const typed_program = _t12980[1];
      const typed_program2_12983 = Typechecker$transform_constraints(ctx2, typed_program);
      let _t12985;
      if (Main$js_capture_mode) {
        (Main$captured_typed_setups = List$concat(Main$captured_typed_setups, ({_hd: [ctx2.type_env, typed_program2_12983], _tl: null})), undefined);
        _t12985 = [ctx2, ({arity: 0, code: Array$of_list(null), constants: Array$of_list(null), line_table: Array$of_list(null), name: "", num_locals: 0})];
      } else {
        const compiled_12986 = Compiler$compile_program_with_globals(ctx2.type_env, global_names, mutable_globals, typed_program2_12983);
        const _t12987 = [ctx2, compiled_12986.main];
        _t12985 = _t12987;
      }
      const _t12984 = _t12985;
      _t12981 = _t12984;
      break _t12982;
    }
    _match_fail("line 16933");
  }
  const _t12979 = _t12981;
  const _t12977 = _t12979;
  return _t12977;
}
function Main$arr(a, b) {
  return ({_tag: 7, _name: "TArrow", _val: [a, ({_tag: 1, _name: "EffEmpty"}), b]});
}
function Main$arr2(a, b, c) {
  return Main$arr(a, Main$arr(b, c));
}
function Main$arr3(a, b, c, d) {
  return Main$arr(a, Main$arr(b, Main$arr(c, d)));
}
function Main$setup_builtins(_) {
  const global_names_12988 = Dynarray$create(256, "");
  const mutable_globals_12990 = Hashtbl$create(8);
  let stdlib_pub_vars_12992 = null;
  const int2_12994 = Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}));
  const bool2_12996 = Main$arr2(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}));
  let ctx_12998 = Typechecker$empty_ctx;
  let _t13001;
  const _t13000 = Main$register_builtin(ctx_12998, global_names_12988, "mod", int2_12994, 0, 2);
  _t13002: {
    if (true) {
      const sch = _t13000[0];
      const ctx2 = _t13000[1];
      (ctx_12998 = ctx2, undefined);
      (stdlib_pub_vars_12992 = ({_hd: ["mod", sch], _tl: stdlib_pub_vars_12992}), undefined);
      let _t13004;
      const _t13003 = Main$register_builtin(ctx_12998, global_names_12988, "print", Main$arr(({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 6, _name: "TUnit"})), 1, 1);
      _t13005: {
        if (true) {
          const sch = _t13003[0];
          const ctx2 = _t13003[1];
          (ctx_12998 = ctx2, undefined);
          (stdlib_pub_vars_12992 = ({_hd: ["print", sch], _tl: stdlib_pub_vars_12992}), undefined);
          let _t13007;
          const _t13006 = Main$register_builtin(ctx_12998, global_names_12988, "failwith", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 16, _name: "TGen", _val: 0})), 1, 1);
          _t13008: {
            if (true) {
              const sch = _t13006[0];
              const ctx2 = _t13006[1];
              (ctx_12998 = ctx2, undefined);
              (stdlib_pub_vars_12992 = ({_hd: ["failwith", sch], _tl: stdlib_pub_vars_12992}), undefined);
              let _t13010;
              const _t13009 = Main$register_builtin(ctx_12998, global_names_12988, "^", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
              _t13011: {
                if (true) {
                  const sch = _t13009[0];
                  const ctx2 = _t13009[1];
                  (ctx_12998 = ctx2, undefined);
                  (stdlib_pub_vars_12992 = ({_hd: ["^", sch], _tl: stdlib_pub_vars_12992}), undefined);
                  let _t13013;
                  const _t13012 = Main$register_builtin(ctx_12998, global_names_12988, "&&", bool2_12996, 0, 2);
                  _t13014: {
                    if (true) {
                      const sch = _t13012[0];
                      const ctx2 = _t13012[1];
                      (ctx_12998 = ctx2, undefined);
                      (stdlib_pub_vars_12992 = ({_hd: ["&&", sch], _tl: stdlib_pub_vars_12992}), undefined);
                      let _t13016;
                      const _t13015 = Main$register_builtin(ctx_12998, global_names_12988, "||", bool2_12996, 0, 2);
                      _t13017: {
                        if (true) {
                          const sch = _t13015[0];
                          const ctx2 = _t13015[1];
                          (ctx_12998 = ctx2, undefined);
                          (stdlib_pub_vars_12992 = ({_hd: ["||", sch], _tl: stdlib_pub_vars_12992}), undefined);
                          let _t13019;
                          const _t13018 = Main$register_builtin(ctx_12998, global_names_12988, "not", Main$arr(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"})), 0, 1);
                          _t13020: {
                            if (true) {
                              const sch = _t13018[0];
                              const ctx2 = _t13018[1];
                              (ctx_12998 = ctx2, undefined);
                              (stdlib_pub_vars_12992 = ({_hd: ["not", sch], _tl: stdlib_pub_vars_12992}), undefined);
                              let _t13022;
                              const _t13021 = Main$register_builtin(ctx_12998, global_names_12988, "phys_equal", Main$arr2(({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 2, _name: "TBool"})), 1, 2);
                              _t13023: {
                                if (true) {
                                  const sch = _t13021[0];
                                  const ctx2 = _t13021[1];
                                  (ctx_12998 = ctx2, undefined);
                                  (stdlib_pub_vars_12992 = ({_hd: ["phys_equal", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                  let _t13025;
                                  const _t13024 = Main$register_builtin(ctx_12998, global_names_12988, "float_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 1, _name: "TFloat"})), 0, 1);
                                  _t13026: {
                                    if (true) {
                                      const sch = _t13024[0];
                                      const ctx2 = _t13024[1];
                                      (ctx_12998 = ctx2, undefined);
                                      (stdlib_pub_vars_12992 = ({_hd: ["float_of_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                      let _t13028;
                                      const _t13027 = Main$register_builtin(ctx_12998, global_names_12988, "int_of_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                      _t13029: {
                                        if (true) {
                                          const sch = _t13027[0];
                                          const ctx2 = _t13027[1];
                                          (ctx_12998 = ctx2, undefined);
                                          (stdlib_pub_vars_12992 = ({_hd: ["int_of_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                          let _t13031;
                                          const _t13030 = Main$register_builtin(ctx_12998, global_names_12988, "string_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                          _t13032: {
                                            if (true) {
                                              const sch = _t13030[0];
                                              const ctx2 = _t13030[1];
                                              (ctx_12998 = ctx2, undefined);
                                              (stdlib_pub_vars_12992 = ({_hd: ["string_of_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                              let _t13034;
                                              const _t13033 = Main$register_builtin(ctx_12998, global_names_12988, "string_of_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                              _t13035: {
                                                if (true) {
                                                  const sch = _t13033[0];
                                                  const ctx2 = _t13033[1];
                                                  (ctx_12998 = ctx2, undefined);
                                                  (stdlib_pub_vars_12992 = ({_hd: ["string_of_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                  let _t13037;
                                                  const _t13036 = Main$register_builtin(ctx_12998, global_names_12988, "string_of_bool", Main$arr(({_tag: 2, _name: "TBool"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                  _t13038: {
                                                    if (true) {
                                                      const sch = _t13036[0];
                                                      const ctx2 = _t13036[1];
                                                      (ctx_12998 = ctx2, undefined);
                                                      (stdlib_pub_vars_12992 = ({_hd: ["string_of_bool", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                      let _t13040;
                                                      const _t13039 = Main$register_builtin(ctx_12998, global_names_12988, "array_get", Main$arr2(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 16, _name: "TGen", _val: 0})), 1, 2);
                                                      _t13041: {
                                                        if (true) {
                                                          const sch = _t13039[0];
                                                          const ctx2 = _t13039[1];
                                                          (ctx_12998 = ctx2, undefined);
                                                          (stdlib_pub_vars_12992 = ({_hd: ["array_get", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                          let _t13043;
                                                          const _t13042 = Main$register_builtin(ctx_12998, global_names_12988, "array_length", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"})), 1, 1);
                                                          _t13044: {
                                                            if (true) {
                                                              const sch = _t13042[0];
                                                              const ctx2 = _t13042[1];
                                                              (ctx_12998 = ctx2, undefined);
                                                              (stdlib_pub_vars_12992 = ({_hd: ["array_length", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                              let _t13046;
                                                              const _t13045 = Main$register_builtin(ctx_12998, global_names_12988, "__byte_to_int", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                              _t13047: {
                                                                if (true) {
                                                                  const sch = _t13045[0];
                                                                  const ctx2 = _t13045[1];
                                                                  (ctx_12998 = ctx2, undefined);
                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__byte_to_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                  let _t13049;
                                                                  const _t13048 = Main$register_builtin(ctx_12998, global_names_12988, "__byte_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 4, _name: "TByte"})), 0, 1);
                                                                  _t13050: {
                                                                    if (true) {
                                                                      const sch = _t13048[0];
                                                                      const ctx2 = _t13048[1];
                                                                      (ctx_12998 = ctx2, undefined);
                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__byte_of_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                      let _t13052;
                                                                      const _t13051 = Main$register_builtin(ctx_12998, global_names_12988, "__byte_to_string", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                      _t13053: {
                                                                        if (true) {
                                                                          const sch = _t13051[0];
                                                                          const ctx2 = _t13051[1];
                                                                          (ctx_12998 = ctx2, undefined);
                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__byte_to_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                          let _t13055;
                                                                          const _t13054 = Main$register_builtin(ctx_12998, global_names_12988, "__rune_to_int", Main$arr(({_tag: 5, _name: "TRune"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                          _t13056: {
                                                                            if (true) {
                                                                              const sch = _t13054[0];
                                                                              const ctx2 = _t13054[1];
                                                                              (ctx_12998 = ctx2, undefined);
                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__rune_to_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                              let _t13058;
                                                                              const _t13057 = Main$register_builtin(ctx_12998, global_names_12988, "__rune_of_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 5, _name: "TRune"})), 0, 1);
                                                                              _t13059: {
                                                                                if (true) {
                                                                                  const sch = _t13057[0];
                                                                                  const ctx2 = _t13057[1];
                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__rune_of_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                  let _t13061;
                                                                                  const _t13060 = Main$register_builtin(ctx_12998, global_names_12988, "__rune_to_string", Main$arr(({_tag: 5, _name: "TRune"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                  _t13062: {
                                                                                    if (true) {
                                                                                      const sch = _t13060[0];
                                                                                      const ctx2 = _t13060[1];
                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__rune_to_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                      let _t13064;
                                                                                      const _t13063 = Main$register_builtin(ctx_12998, global_names_12988, "__math_pow", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                      _t13065: {
                                                                                        if (true) {
                                                                                          const sch = _t13063[0];
                                                                                          const ctx2 = _t13063[1];
                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__math_pow", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                          let _t13067;
                                                                                          const _t13066 = Main$register_builtin(ctx_12998, global_names_12988, "__math_sqrt", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 1);
                                                                                          _t13068: {
                                                                                            if (true) {
                                                                                              const sch = _t13066[0];
                                                                                              const ctx2 = _t13066[1];
                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__math_sqrt", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                              let _t13070;
                                                                                              const _t13069 = Main$register_builtin(ctx_12998, global_names_12988, "__math_floor", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                              _t13071: {
                                                                                                if (true) {
                                                                                                  const sch = _t13069[0];
                                                                                                  const ctx2 = _t13069[1];
                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__math_floor", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                  let _t13073;
                                                                                                  const _t13072 = Main$register_builtin(ctx_12998, global_names_12988, "__math_ceil", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                  _t13074: {
                                                                                                    if (true) {
                                                                                                      const sch = _t13072[0];
                                                                                                      const ctx2 = _t13072[1];
                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__math_ceil", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                      let _t13076;
                                                                                                      const _t13075 = Main$register_builtin(ctx_12998, global_names_12988, "__math_round", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                      _t13077: {
                                                                                                        if (true) {
                                                                                                          const sch = _t13075[0];
                                                                                                          const ctx2 = _t13075[1];
                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__math_round", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                          let _t13079;
                                                                                                          const _t13078 = Main$register_builtin(ctx_12998, global_names_12988, "__fmt_float", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                          _t13080: {
                                                                                                            if (true) {
                                                                                                              const sch = _t13078[0];
                                                                                                              const ctx2 = _t13078[1];
                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__fmt_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                              let _t13082;
                                                                                                              const _t13081 = Main$register_builtin(ctx_12998, global_names_12988, "__fmt_hex", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                              _t13083: {
                                                                                                                if (true) {
                                                                                                                  const sch = _t13081[0];
                                                                                                                  const ctx2 = _t13081[1];
                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__fmt_hex", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                  let _t13085;
                                                                                                                  const _t13084 = Main$register_builtin(ctx_12998, global_names_12988, "__fmt_hex_upper", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                  _t13086: {
                                                                                                                    if (true) {
                                                                                                                      const sch = _t13084[0];
                                                                                                                      const ctx2 = _t13084[1];
                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__fmt_hex_upper", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                      let _t13088;
                                                                                                                      const _t13087 = Main$register_builtin(ctx_12998, global_names_12988, "__fmt_oct", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                      _t13089: {
                                                                                                                        if (true) {
                                                                                                                          const sch = _t13087[0];
                                                                                                                          const ctx2 = _t13087[1];
                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__fmt_oct", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                          let _t13091;
                                                                                                                          const _t13090 = Main$register_builtin(ctx_12998, global_names_12988, "__fmt_bin", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                          _t13092: {
                                                                                                                            if (true) {
                                                                                                                              const sch = _t13090[0];
                                                                                                                              const ctx2 = _t13090[1];
                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__fmt_bin", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                              let _t13094;
                                                                                                                              const _t13093 = Main$register_builtin(ctx_12998, global_names_12988, "__fmt_zero_pad", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                              _t13095: {
                                                                                                                                if (true) {
                                                                                                                                  const sch = _t13093[0];
                                                                                                                                  const ctx2 = _t13093[1];
                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__fmt_zero_pad", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                  let _t13097;
                                                                                                                                  const _t13096 = Main$register_builtin(ctx_12998, global_names_12988, "__fmt_pad_left", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                                  _t13098: {
                                                                                                                                    if (true) {
                                                                                                                                      const sch = _t13096[0];
                                                                                                                                      const ctx2 = _t13096[1];
                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__fmt_pad_left", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                      let _t13100;
                                                                                                                                      const _t13099 = Main$register_builtin(ctx_12998, global_names_12988, "__fmt_pad_right", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 2);
                                                                                                                                      _t13101: {
                                                                                                                                        if (true) {
                                                                                                                                          const sch = _t13099[0];
                                                                                                                                          const ctx2 = _t13099[1];
                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__fmt_pad_right", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                          let _t13103;
                                                                                                                                          const _t13102 = Main$register_builtin(ctx_12998, global_names_12988, "__show_value", Main$arr(({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 3, _name: "TString"})), 1, 1);
                                                                                                                                          _t13104: {
                                                                                                                                            if (true) {
                                                                                                                                              const sch = _t13102[0];
                                                                                                                                              const ctx2 = _t13102[1];
                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__show_value", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                              let _t13106;
                                                                                                                                              const _t13105 = Main$register_builtin(ctx_12998, global_names_12988, "__num_add_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                              _t13107: {
                                                                                                                                                if (true) {
                                                                                                                                                  const sch = _t13105[0];
                                                                                                                                                  const ctx2 = _t13105[1];
                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__num_add_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                  let _t13109;
                                                                                                                                                  const _t13108 = Main$register_builtin(ctx_12998, global_names_12988, "__num_sub_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                  _t13110: {
                                                                                                                                                    if (true) {
                                                                                                                                                      const sch = _t13108[0];
                                                                                                                                                      const ctx2 = _t13108[1];
                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__num_sub_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                      let _t13112;
                                                                                                                                                      const _t13111 = Main$register_builtin(ctx_12998, global_names_12988, "__num_mul_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                      _t13113: {
                                                                                                                                                        if (true) {
                                                                                                                                                          const sch = _t13111[0];
                                                                                                                                                          const ctx2 = _t13111[1];
                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__num_mul_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                          let _t13115;
                                                                                                                                                          const _t13114 = Main$register_builtin(ctx_12998, global_names_12988, "__num_div_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                          _t13116: {
                                                                                                                                                            if (true) {
                                                                                                                                                              const sch = _t13114[0];
                                                                                                                                                              const ctx2 = _t13114[1];
                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__num_div_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                              let _t13118;
                                                                                                                                                              const _t13117 = Main$register_builtin(ctx_12998, global_names_12988, "__num_neg_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                                                                              _t13119: {
                                                                                                                                                                if (true) {
                                                                                                                                                                  const sch = _t13117[0];
                                                                                                                                                                  const ctx2 = _t13117[1];
                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__num_neg_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                  let _t13121;
                                                                                                                                                                  const _t13120 = Main$register_builtin(ctx_12998, global_names_12988, "__num_add_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                                                                                                  _t13122: {
                                                                                                                                                                    if (true) {
                                                                                                                                                                      const sch = _t13120[0];
                                                                                                                                                                      const ctx2 = _t13120[1];
                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__num_add_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                      let _t13124;
                                                                                                                                                                      const _t13123 = Main$register_builtin(ctx_12998, global_names_12988, "__num_sub_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                                                                                                      _t13125: {
                                                                                                                                                                        if (true) {
                                                                                                                                                                          const sch = _t13123[0];
                                                                                                                                                                          const ctx2 = _t13123[1];
                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__num_sub_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                          let _t13127;
                                                                                                                                                                          const _t13126 = Main$register_builtin(ctx_12998, global_names_12988, "__num_mul_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                                                                                                          _t13128: {
                                                                                                                                                                            if (true) {
                                                                                                                                                                              const sch = _t13126[0];
                                                                                                                                                                              const ctx2 = _t13126[1];
                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__num_mul_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                              let _t13130;
                                                                                                                                                                              const _t13129 = Main$register_builtin(ctx_12998, global_names_12988, "__num_div_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 2);
                                                                                                                                                                              _t13131: {
                                                                                                                                                                                if (true) {
                                                                                                                                                                                  const sch = _t13129[0];
                                                                                                                                                                                  const ctx2 = _t13129[1];
                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__num_div_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                  let _t13133;
                                                                                                                                                                                  const _t13132 = Main$register_builtin(ctx_12998, global_names_12988, "__num_neg_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"})), 0, 1);
                                                                                                                                                                                  _t13134: {
                                                                                                                                                                                    if (true) {
                                                                                                                                                                                      const sch = _t13132[0];
                                                                                                                                                                                      const ctx2 = _t13132[1];
                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__num_neg_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                      let _t13136;
                                                                                                                                                                                      const _t13135 = Main$register_builtin(ctx_12998, global_names_12988, "__eq_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                      _t13137: {
                                                                                                                                                                                        if (true) {
                                                                                                                                                                                          const sch = _t13135[0];
                                                                                                                                                                                          const ctx2 = _t13135[1];
                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__eq_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                          let _t13139;
                                                                                                                                                                                          const _t13138 = Main$register_builtin(ctx_12998, global_names_12988, "__neq_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                          _t13140: {
                                                                                                                                                                                            if (true) {
                                                                                                                                                                                              const sch = _t13138[0];
                                                                                                                                                                                              const ctx2 = _t13138[1];
                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__neq_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                              let _t13142;
                                                                                                                                                                                              const _t13141 = Main$register_builtin(ctx_12998, global_names_12988, "__eq_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                              _t13143: {
                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                  const sch = _t13141[0];
                                                                                                                                                                                                  const ctx2 = _t13141[1];
                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__eq_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                  let _t13145;
                                                                                                                                                                                                  const _t13144 = Main$register_builtin(ctx_12998, global_names_12988, "__neq_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                  _t13146: {
                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                      const sch = _t13144[0];
                                                                                                                                                                                                      const ctx2 = _t13144[1];
                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__neq_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                      let _t13148;
                                                                                                                                                                                                      const _t13147 = Main$register_builtin(ctx_12998, global_names_12988, "__eq_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                      _t13149: {
                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                          const sch = _t13147[0];
                                                                                                                                                                                                          const ctx2 = _t13147[1];
                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__eq_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                          let _t13151;
                                                                                                                                                                                                          const _t13150 = Main$register_builtin(ctx_12998, global_names_12988, "__neq_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                          _t13152: {
                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                              const sch = _t13150[0];
                                                                                                                                                                                                              const ctx2 = _t13150[1];
                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__neq_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                              let _t13154;
                                                                                                                                                                                                              const _t13153 = Main$register_builtin(ctx_12998, global_names_12988, "__eq_bool", Main$arr2(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                              _t13155: {
                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                  const sch = _t13153[0];
                                                                                                                                                                                                                  const ctx2 = _t13153[1];
                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__eq_bool", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                  let _t13157;
                                                                                                                                                                                                                  const _t13156 = Main$register_builtin(ctx_12998, global_names_12988, "__neq_bool", Main$arr2(({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                  _t13158: {
                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                      const sch = _t13156[0];
                                                                                                                                                                                                                      const ctx2 = _t13156[1];
                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__neq_bool", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                      let _t13160;
                                                                                                                                                                                                                      const _t13159 = Main$register_builtin(ctx_12998, global_names_12988, "__eq_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                      _t13161: {
                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                          const sch = _t13159[0];
                                                                                                                                                                                                                          const ctx2 = _t13159[1];
                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__eq_byte", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                          let _t13163;
                                                                                                                                                                                                                          const _t13162 = Main$register_builtin(ctx_12998, global_names_12988, "__neq_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                          _t13164: {
                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                              const sch = _t13162[0];
                                                                                                                                                                                                                              const ctx2 = _t13162[1];
                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__neq_byte", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                              let _t13166;
                                                                                                                                                                                                                              const _t13165 = Main$register_builtin(ctx_12998, global_names_12988, "__eq_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                              _t13167: {
                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                  const sch = _t13165[0];
                                                                                                                                                                                                                                  const ctx2 = _t13165[1];
                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__eq_rune", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                  let _t13169;
                                                                                                                                                                                                                                  const _t13168 = Main$register_builtin(ctx_12998, global_names_12988, "__neq_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                  _t13170: {
                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                      const sch = _t13168[0];
                                                                                                                                                                                                                                      const ctx2 = _t13168[1];
                                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__neq_rune", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                      let _t13172;
                                                                                                                                                                                                                                      const _t13171 = Main$register_builtin(ctx_12998, global_names_12988, "__lt_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                      _t13173: {
                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                          const sch = _t13171[0];
                                                                                                                                                                                                                                          const ctx2 = _t13171[1];
                                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__lt_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                          let _t13175;
                                                                                                                                                                                                                                          const _t13174 = Main$register_builtin(ctx_12998, global_names_12988, "__gt_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                          _t13176: {
                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                              const sch = _t13174[0];
                                                                                                                                                                                                                                              const ctx2 = _t13174[1];
                                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__gt_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                              let _t13178;
                                                                                                                                                                                                                                              const _t13177 = Main$register_builtin(ctx_12998, global_names_12988, "__le_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                              _t13179: {
                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                  const sch = _t13177[0];
                                                                                                                                                                                                                                                  const ctx2 = _t13177[1];
                                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__le_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                  let _t13181;
                                                                                                                                                                                                                                                  const _t13180 = Main$register_builtin(ctx_12998, global_names_12988, "__ge_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                  _t13182: {
                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                      const sch = _t13180[0];
                                                                                                                                                                                                                                                      const ctx2 = _t13180[1];
                                                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__ge_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                      let _t13184;
                                                                                                                                                                                                                                                      const _t13183 = Main$register_builtin(ctx_12998, global_names_12988, "__lt_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                      _t13185: {
                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                          const sch = _t13183[0];
                                                                                                                                                                                                                                                          const ctx2 = _t13183[1];
                                                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__lt_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                          let _t13187;
                                                                                                                                                                                                                                                          const _t13186 = Main$register_builtin(ctx_12998, global_names_12988, "__gt_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                          _t13188: {
                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                              const sch = _t13186[0];
                                                                                                                                                                                                                                                              const ctx2 = _t13186[1];
                                                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__gt_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                              let _t13190;
                                                                                                                                                                                                                                                              const _t13189 = Main$register_builtin(ctx_12998, global_names_12988, "__le_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                              _t13191: {
                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                  const sch = _t13189[0];
                                                                                                                                                                                                                                                                  const ctx2 = _t13189[1];
                                                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__le_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                  let _t13193;
                                                                                                                                                                                                                                                                  const _t13192 = Main$register_builtin(ctx_12998, global_names_12988, "__ge_float", Main$arr2(({_tag: 1, _name: "TFloat"}), ({_tag: 1, _name: "TFloat"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                  _t13194: {
                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                      const sch = _t13192[0];
                                                                                                                                                                                                                                                                      const ctx2 = _t13192[1];
                                                                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__ge_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                      let _t13196;
                                                                                                                                                                                                                                                                      const _t13195 = Main$register_builtin(ctx_12998, global_names_12988, "__lt_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                      _t13197: {
                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                          const sch = _t13195[0];
                                                                                                                                                                                                                                                                          const ctx2 = _t13195[1];
                                                                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__lt_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                          let _t13199;
                                                                                                                                                                                                                                                                          const _t13198 = Main$register_builtin(ctx_12998, global_names_12988, "__gt_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                          _t13200: {
                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                              const sch = _t13198[0];
                                                                                                                                                                                                                                                                              const ctx2 = _t13198[1];
                                                                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__gt_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                              let _t13202;
                                                                                                                                                                                                                                                                              const _t13201 = Main$register_builtin(ctx_12998, global_names_12988, "__le_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                              _t13203: {
                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                  const sch = _t13201[0];
                                                                                                                                                                                                                                                                                  const ctx2 = _t13201[1];
                                                                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__le_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                  let _t13205;
                                                                                                                                                                                                                                                                                  const _t13204 = Main$register_builtin(ctx_12998, global_names_12988, "__ge_string", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                  _t13206: {
                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                      const sch = _t13204[0];
                                                                                                                                                                                                                                                                                      const ctx2 = _t13204[1];
                                                                                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__ge_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                      let _t13208;
                                                                                                                                                                                                                                                                                      const _t13207 = Main$register_builtin(ctx_12998, global_names_12988, "__lt_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                      _t13209: {
                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                          const sch = _t13207[0];
                                                                                                                                                                                                                                                                                          const ctx2 = _t13207[1];
                                                                                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__lt_byte", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                          let _t13211;
                                                                                                                                                                                                                                                                                          const _t13210 = Main$register_builtin(ctx_12998, global_names_12988, "__gt_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                          _t13212: {
                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                              const sch = _t13210[0];
                                                                                                                                                                                                                                                                                              const ctx2 = _t13210[1];
                                                                                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__gt_byte", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                              let _t13214;
                                                                                                                                                                                                                                                                                              const _t13213 = Main$register_builtin(ctx_12998, global_names_12988, "__le_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                              _t13215: {
                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                  const sch = _t13213[0];
                                                                                                                                                                                                                                                                                                  const ctx2 = _t13213[1];
                                                                                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__le_byte", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                  let _t13217;
                                                                                                                                                                                                                                                                                                  const _t13216 = Main$register_builtin(ctx_12998, global_names_12988, "__ge_byte", Main$arr2(({_tag: 4, _name: "TByte"}), ({_tag: 4, _name: "TByte"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                  _t13218: {
                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                      const sch = _t13216[0];
                                                                                                                                                                                                                                                                                                      const ctx2 = _t13216[1];
                                                                                                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__ge_byte", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                      let _t13220;
                                                                                                                                                                                                                                                                                                      const _t13219 = Main$register_builtin(ctx_12998, global_names_12988, "__lt_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                      _t13221: {
                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                          const sch = _t13219[0];
                                                                                                                                                                                                                                                                                                          const ctx2 = _t13219[1];
                                                                                                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__lt_rune", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                          let _t13223;
                                                                                                                                                                                                                                                                                                          const _t13222 = Main$register_builtin(ctx_12998, global_names_12988, "__gt_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                          _t13224: {
                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                              const sch = _t13222[0];
                                                                                                                                                                                                                                                                                                              const ctx2 = _t13222[1];
                                                                                                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__gt_rune", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                              let _t13226;
                                                                                                                                                                                                                                                                                                              const _t13225 = Main$register_builtin(ctx_12998, global_names_12988, "__le_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                              _t13227: {
                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                  const sch = _t13225[0];
                                                                                                                                                                                                                                                                                                                  const ctx2 = _t13225[1];
                                                                                                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__le_rune", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                  let _t13229;
                                                                                                                                                                                                                                                                                                                  const _t13228 = Main$register_builtin(ctx_12998, global_names_12988, "__ge_rune", Main$arr2(({_tag: 5, _name: "TRune"}), ({_tag: 5, _name: "TRune"}), ({_tag: 2, _name: "TBool"})), 0, 2);
                                                                                                                                                                                                                                                                                                                  _t13230: {
                                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                                      const sch = _t13228[0];
                                                                                                                                                                                                                                                                                                                      const ctx2 = _t13228[1];
                                                                                                                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__ge_rune", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                      let _t13232;
                                                                                                                                                                                                                                                                                                                      const _t13231 = Main$register_builtin(ctx_12998, global_names_12988, "__band_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                      _t13233: {
                                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                                          const sch = _t13231[0];
                                                                                                                                                                                                                                                                                                                          const ctx2 = _t13231[1];
                                                                                                                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__band_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                          let _t13235;
                                                                                                                                                                                                                                                                                                                          const _t13234 = Main$register_builtin(ctx_12998, global_names_12988, "__bor_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                          _t13236: {
                                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                                              const sch = _t13234[0];
                                                                                                                                                                                                                                                                                                                              const ctx2 = _t13234[1];
                                                                                                                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__bor_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                              let _t13238;
                                                                                                                                                                                                                                                                                                                              const _t13237 = Main$register_builtin(ctx_12998, global_names_12988, "__bxor_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                              _t13239: {
                                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                                  const sch = _t13237[0];
                                                                                                                                                                                                                                                                                                                                  const ctx2 = _t13237[1];
                                                                                                                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__bxor_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                  let _t13241;
                                                                                                                                                                                                                                                                                                                                  const _t13240 = Main$register_builtin(ctx_12998, global_names_12988, "__bshl_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                                  _t13242: {
                                                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                                                      const sch = _t13240[0];
                                                                                                                                                                                                                                                                                                                                      const ctx2 = _t13240[1];
                                                                                                                                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__bshl_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                      let _t13244;
                                                                                                                                                                                                                                                                                                                                      const _t13243 = Main$register_builtin(ctx_12998, global_names_12988, "__bshr_int", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 2);
                                                                                                                                                                                                                                                                                                                                      _t13245: {
                                                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                                                          const sch = _t13243[0];
                                                                                                                                                                                                                                                                                                                                          const ctx2 = _t13243[1];
                                                                                                                                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__bshr_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                          let _t13247;
                                                                                                                                                                                                                                                                                                                                          const _t13246 = Main$register_builtin(ctx_12998, global_names_12988, "__bnot_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                          _t13248: {
                                                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                                                              const sch = _t13246[0];
                                                                                                                                                                                                                                                                                                                                              const ctx2 = _t13246[1];
                                                                                                                                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__bnot_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                              let _t13250;
                                                                                                                                                                                                                                                                                                                                              const _t13249 = Main$register_builtin(ctx_12998, global_names_12988, "__show_int", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                              _t13251: {
                                                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                                                  const sch = _t13249[0];
                                                                                                                                                                                                                                                                                                                                                  const ctx2 = _t13249[1];
                                                                                                                                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__show_int", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                  let _t13253;
                                                                                                                                                                                                                                                                                                                                                  const _t13252 = Main$register_builtin(ctx_12998, global_names_12988, "__show_float", Main$arr(({_tag: 1, _name: "TFloat"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                  _t13254: {
                                                                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                                                                      const sch = _t13252[0];
                                                                                                                                                                                                                                                                                                                                                      const ctx2 = _t13252[1];
                                                                                                                                                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__show_float", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                      let _t13256;
                                                                                                                                                                                                                                                                                                                                                      const _t13255 = Main$register_builtin(ctx_12998, global_names_12988, "__show_bool", Main$arr(({_tag: 2, _name: "TBool"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                      _t13257: {
                                                                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                                                                          const sch = _t13255[0];
                                                                                                                                                                                                                                                                                                                                                          const ctx2 = _t13255[1];
                                                                                                                                                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__show_bool", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                          let _t13259;
                                                                                                                                                                                                                                                                                                                                                          const _t13258 = Main$register_builtin(ctx_12998, global_names_12988, "__show_string", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                          _t13260: {
                                                                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                                                                              const sch = _t13258[0];
                                                                                                                                                                                                                                                                                                                                                              const ctx2 = _t13258[1];
                                                                                                                                                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__show_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                              let _t13262;
                                                                                                                                                                                                                                                                                                                                                              const _t13261 = Main$register_builtin(ctx_12998, global_names_12988, "__show_unit", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                              _t13263: {
                                                                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                                                                  const sch = _t13261[0];
                                                                                                                                                                                                                                                                                                                                                                  const ctx2 = _t13261[1];
                                                                                                                                                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__show_unit", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                                  let _t13265;
                                                                                                                                                                                                                                                                                                                                                                  const _t13264 = Main$register_builtin(ctx_12998, global_names_12988, "__show_byte", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                                  _t13266: {
                                                                                                                                                                                                                                                                                                                                                                    if (true) {
                                                                                                                                                                                                                                                                                                                                                                      const sch = _t13264[0];
                                                                                                                                                                                                                                                                                                                                                                      const ctx2 = _t13264[1];
                                                                                                                                                                                                                                                                                                                                                                      (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                      (stdlib_pub_vars_12992 = ({_hd: ["__show_byte", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                                      let _t13268;
                                                                                                                                                                                                                                                                                                                                                                      const _t13267 = Main$register_builtin(ctx_12998, global_names_12988, "__show_rune", Main$arr(({_tag: 5, _name: "TRune"}), ({_tag: 3, _name: "TString"})), 0, 1);
                                                                                                                                                                                                                                                                                                                                                                      _t13269: {
                                                                                                                                                                                                                                                                                                                                                                        if (true) {
                                                                                                                                                                                                                                                                                                                                                                          const sch = _t13267[0];
                                                                                                                                                                                                                                                                                                                                                                          const ctx2 = _t13267[1];
                                                                                                                                                                                                                                                                                                                                                                          (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                          (stdlib_pub_vars_12992 = ({_hd: ["__show_rune", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                                          let _t13271;
                                                                                                                                                                                                                                                                                                                                                                          const _t13270 = Main$register_builtin(ctx_12998, global_names_12988, "__index_at_array", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 16, _name: "TGen", _val: 0})), 1, 2);
                                                                                                                                                                                                                                                                                                                                                                          _t13272: {
                                                                                                                                                                                                                                                                                                                                                                            if (true) {
                                                                                                                                                                                                                                                                                                                                                                              const sch = _t13270[0];
                                                                                                                                                                                                                                                                                                                                                                              const ctx2 = _t13270[1];
                                                                                                                                                                                                                                                                                                                                                                              (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                              (stdlib_pub_vars_12992 = ({_hd: ["__index_at_array", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                                              let _t13274;
                                                                                                                                                                                                                                                                                                                                                                              const _t13273 = Main$register_builtin(ctx_12998, global_names_12988, "__index_at_string", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"}), ({_tag: 4, _name: "TByte"})), 0, 2);
                                                                                                                                                                                                                                                                                                                                                                              _t13275: {
                                                                                                                                                                                                                                                                                                                                                                                if (true) {
                                                                                                                                                                                                                                                                                                                                                                                  const sch = _t13273[0];
                                                                                                                                                                                                                                                                                                                                                                                  const ctx2 = _t13273[1];
                                                                                                                                                                                                                                                                                                                                                                                  (ctx_12998 = ctx2, undefined);
                                                                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["__index_at_string", sch], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                                                  const copy_ty_13276 = Main$arr(({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 16, _name: "TGen", _val: 0}));
                                                                                                                                                                                                                                                                                                                                                                                  const copy_scheme_13278 = ({body: copy_ty_13276, constraints: null, equant: 0, pvquant: 0, quant: 1, record_evidences: null, rquant: 0});
                                                                                                                                                                                                                                                                                                                                                                                  const cidx_13280 = Main$add_global(global_names_12988, "copy_continuation");
                                                                                                                                                                                                                                                                                                                                                                                  Main$register_native_ext(cidx_13280, "copy_continuation", 1);
                                                                                                                                                                                                                                                                                                                                                                                  const csidx_13282 = Main$add_global(global_names_12988, "Stdlib.copy_continuation");
                                                                                                                                                                                                                                                                                                                                                                                  Main$register_native_ext(csidx_13282, "copy_continuation", 1);
                                                                                                                                                                                                                                                                                                                                                                                  (stdlib_pub_vars_12992 = ({_hd: ["copy_continuation", copy_scheme_13278], _tl: stdlib_pub_vars_12992}), undefined);
                                                                                                                                                                                                                                                                                                                                                                                  const __rec_upd_13284 = ctx_12998;
                                                                                                                                                                                                                                                                                                                                                                                  const _t13285 = ({constraint_tvars: __rec_upd_13284.constraint_tvars, current_eff: __rec_upd_13284.current_eff, current_module: __rec_upd_13284.current_module, inside_handler: __rec_upd_13284.inside_handler, loop_info: __rec_upd_13284.loop_info, mutable_vars: __rec_upd_13284.mutable_vars, return_type: __rec_upd_13284.return_type, return_used: __rec_upd_13284.return_used, type_env: __rec_upd_13284.type_env, vars: ({_hd: ["Stdlib.copy_continuation", copy_scheme_13278], _tl: ({_hd: ["copy_continuation", copy_scheme_13278], _tl: ctx_12998.vars})})});
                                                                                                                                                                                                                                                                                                                                                                                  (ctx_12998 = _t13285, undefined);
                                                                                                                                                                                                                                                                                                                                                                                  const _t13283 = [ctx_12998, global_names_12988, mutable_globals_12990, stdlib_pub_vars_12992];
                                                                                                                                                                                                                                                                                                                                                                                  const _t13281 = _t13283;
                                                                                                                                                                                                                                                                                                                                                                                  const _t13279 = _t13281;
                                                                                                                                                                                                                                                                                                                                                                                  const _t13277 = _t13279;
                                                                                                                                                                                                                                                                                                                                                                                  _t13274 = _t13277;
                                                                                                                                                                                                                                                                                                                                                                                  break _t13275;
                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                              _t13271 = _t13274;
                                                                                                                                                                                                                                                                                                                                                                              break _t13272;
                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                          _t13268 = _t13271;
                                                                                                                                                                                                                                                                                                                                                                          break _t13269;
                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                      _t13265 = _t13268;
                                                                                                                                                                                                                                                                                                                                                                      break _t13266;
                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                  _t13262 = _t13265;
                                                                                                                                                                                                                                                                                                                                                                  break _t13263;
                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                              _t13259 = _t13262;
                                                                                                                                                                                                                                                                                                                                                              break _t13260;
                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                          _t13256 = _t13259;
                                                                                                                                                                                                                                                                                                                                                          break _t13257;
                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                      _t13253 = _t13256;
                                                                                                                                                                                                                                                                                                                                                      break _t13254;
                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                  _t13250 = _t13253;
                                                                                                                                                                                                                                                                                                                                                  break _t13251;
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                              _t13247 = _t13250;
                                                                                                                                                                                                                                                                                                                                              break _t13248;
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                          _t13244 = _t13247;
                                                                                                                                                                                                                                                                                                                                          break _t13245;
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                      _t13241 = _t13244;
                                                                                                                                                                                                                                                                                                                                      break _t13242;
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                  _t13238 = _t13241;
                                                                                                                                                                                                                                                                                                                                  break _t13239;
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                              _t13235 = _t13238;
                                                                                                                                                                                                                                                                                                                              break _t13236;
                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                          _t13232 = _t13235;
                                                                                                                                                                                                                                                                                                                          break _t13233;
                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                      _t13229 = _t13232;
                                                                                                                                                                                                                                                                                                                      break _t13230;
                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                  _t13226 = _t13229;
                                                                                                                                                                                                                                                                                                                  break _t13227;
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                              _t13223 = _t13226;
                                                                                                                                                                                                                                                                                                              break _t13224;
                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                          _t13220 = _t13223;
                                                                                                                                                                                                                                                                                                          break _t13221;
                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                      _t13217 = _t13220;
                                                                                                                                                                                                                                                                                                      break _t13218;
                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                  _t13214 = _t13217;
                                                                                                                                                                                                                                                                                                  break _t13215;
                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                              _t13211 = _t13214;
                                                                                                                                                                                                                                                                                              break _t13212;
                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                          _t13208 = _t13211;
                                                                                                                                                                                                                                                                                          break _t13209;
                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                      _t13205 = _t13208;
                                                                                                                                                                                                                                                                                      break _t13206;
                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                  _t13202 = _t13205;
                                                                                                                                                                                                                                                                                  break _t13203;
                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                              _t13199 = _t13202;
                                                                                                                                                                                                                                                                              break _t13200;
                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                          _t13196 = _t13199;
                                                                                                                                                                                                                                                                          break _t13197;
                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                      _t13193 = _t13196;
                                                                                                                                                                                                                                                                      break _t13194;
                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                  _t13190 = _t13193;
                                                                                                                                                                                                                                                                  break _t13191;
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                              _t13187 = _t13190;
                                                                                                                                                                                                                                                              break _t13188;
                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                          _t13184 = _t13187;
                                                                                                                                                                                                                                                          break _t13185;
                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                      _t13181 = _t13184;
                                                                                                                                                                                                                                                      break _t13182;
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                  _t13178 = _t13181;
                                                                                                                                                                                                                                                  break _t13179;
                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                              _t13175 = _t13178;
                                                                                                                                                                                                                                              break _t13176;
                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                          _t13172 = _t13175;
                                                                                                                                                                                                                                          break _t13173;
                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                      _t13169 = _t13172;
                                                                                                                                                                                                                                      break _t13170;
                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                  _t13166 = _t13169;
                                                                                                                                                                                                                                  break _t13167;
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                                              }
                                                                                                                                                                                                                              _t13163 = _t13166;
                                                                                                                                                                                                                              break _t13164;
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                                          }
                                                                                                                                                                                                                          _t13160 = _t13163;
                                                                                                                                                                                                                          break _t13161;
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                                      }
                                                                                                                                                                                                                      _t13157 = _t13160;
                                                                                                                                                                                                                      break _t13158;
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                                  }
                                                                                                                                                                                                                  _t13154 = _t13157;
                                                                                                                                                                                                                  break _t13155;
                                                                                                                                                                                                                }
                                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                                              }
                                                                                                                                                                                                              _t13151 = _t13154;
                                                                                                                                                                                                              break _t13152;
                                                                                                                                                                                                            }
                                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                                          }
                                                                                                                                                                                                          _t13148 = _t13151;
                                                                                                                                                                                                          break _t13149;
                                                                                                                                                                                                        }
                                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                                      }
                                                                                                                                                                                                      _t13145 = _t13148;
                                                                                                                                                                                                      break _t13146;
                                                                                                                                                                                                    }
                                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                                  }
                                                                                                                                                                                                  _t13142 = _t13145;
                                                                                                                                                                                                  break _t13143;
                                                                                                                                                                                                }
                                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                                              }
                                                                                                                                                                                              _t13139 = _t13142;
                                                                                                                                                                                              break _t13140;
                                                                                                                                                                                            }
                                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                                          }
                                                                                                                                                                                          _t13136 = _t13139;
                                                                                                                                                                                          break _t13137;
                                                                                                                                                                                        }
                                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                                      }
                                                                                                                                                                                      _t13133 = _t13136;
                                                                                                                                                                                      break _t13134;
                                                                                                                                                                                    }
                                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                                  }
                                                                                                                                                                                  _t13130 = _t13133;
                                                                                                                                                                                  break _t13131;
                                                                                                                                                                                }
                                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                                              }
                                                                                                                                                                              _t13127 = _t13130;
                                                                                                                                                                              break _t13128;
                                                                                                                                                                            }
                                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                                          }
                                                                                                                                                                          _t13124 = _t13127;
                                                                                                                                                                          break _t13125;
                                                                                                                                                                        }
                                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                                      }
                                                                                                                                                                      _t13121 = _t13124;
                                                                                                                                                                      break _t13122;
                                                                                                                                                                    }
                                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                                  }
                                                                                                                                                                  _t13118 = _t13121;
                                                                                                                                                                  break _t13119;
                                                                                                                                                                }
                                                                                                                                                                _match_fail("line 16933");
                                                                                                                                                              }
                                                                                                                                                              _t13115 = _t13118;
                                                                                                                                                              break _t13116;
                                                                                                                                                            }
                                                                                                                                                            _match_fail("line 16933");
                                                                                                                                                          }
                                                                                                                                                          _t13112 = _t13115;
                                                                                                                                                          break _t13113;
                                                                                                                                                        }
                                                                                                                                                        _match_fail("line 16933");
                                                                                                                                                      }
                                                                                                                                                      _t13109 = _t13112;
                                                                                                                                                      break _t13110;
                                                                                                                                                    }
                                                                                                                                                    _match_fail("line 16933");
                                                                                                                                                  }
                                                                                                                                                  _t13106 = _t13109;
                                                                                                                                                  break _t13107;
                                                                                                                                                }
                                                                                                                                                _match_fail("line 16933");
                                                                                                                                              }
                                                                                                                                              _t13103 = _t13106;
                                                                                                                                              break _t13104;
                                                                                                                                            }
                                                                                                                                            _match_fail("line 16933");
                                                                                                                                          }
                                                                                                                                          _t13100 = _t13103;
                                                                                                                                          break _t13101;
                                                                                                                                        }
                                                                                                                                        _match_fail("line 16933");
                                                                                                                                      }
                                                                                                                                      _t13097 = _t13100;
                                                                                                                                      break _t13098;
                                                                                                                                    }
                                                                                                                                    _match_fail("line 16933");
                                                                                                                                  }
                                                                                                                                  _t13094 = _t13097;
                                                                                                                                  break _t13095;
                                                                                                                                }
                                                                                                                                _match_fail("line 16933");
                                                                                                                              }
                                                                                                                              _t13091 = _t13094;
                                                                                                                              break _t13092;
                                                                                                                            }
                                                                                                                            _match_fail("line 16933");
                                                                                                                          }
                                                                                                                          _t13088 = _t13091;
                                                                                                                          break _t13089;
                                                                                                                        }
                                                                                                                        _match_fail("line 16933");
                                                                                                                      }
                                                                                                                      _t13085 = _t13088;
                                                                                                                      break _t13086;
                                                                                                                    }
                                                                                                                    _match_fail("line 16933");
                                                                                                                  }
                                                                                                                  _t13082 = _t13085;
                                                                                                                  break _t13083;
                                                                                                                }
                                                                                                                _match_fail("line 16933");
                                                                                                              }
                                                                                                              _t13079 = _t13082;
                                                                                                              break _t13080;
                                                                                                            }
                                                                                                            _match_fail("line 16933");
                                                                                                          }
                                                                                                          _t13076 = _t13079;
                                                                                                          break _t13077;
                                                                                                        }
                                                                                                        _match_fail("line 16933");
                                                                                                      }
                                                                                                      _t13073 = _t13076;
                                                                                                      break _t13074;
                                                                                                    }
                                                                                                    _match_fail("line 16933");
                                                                                                  }
                                                                                                  _t13070 = _t13073;
                                                                                                  break _t13071;
                                                                                                }
                                                                                                _match_fail("line 16933");
                                                                                              }
                                                                                              _t13067 = _t13070;
                                                                                              break _t13068;
                                                                                            }
                                                                                            _match_fail("line 16933");
                                                                                          }
                                                                                          _t13064 = _t13067;
                                                                                          break _t13065;
                                                                                        }
                                                                                        _match_fail("line 16933");
                                                                                      }
                                                                                      _t13061 = _t13064;
                                                                                      break _t13062;
                                                                                    }
                                                                                    _match_fail("line 16933");
                                                                                  }
                                                                                  _t13058 = _t13061;
                                                                                  break _t13059;
                                                                                }
                                                                                _match_fail("line 16933");
                                                                              }
                                                                              _t13055 = _t13058;
                                                                              break _t13056;
                                                                            }
                                                                            _match_fail("line 16933");
                                                                          }
                                                                          _t13052 = _t13055;
                                                                          break _t13053;
                                                                        }
                                                                        _match_fail("line 16933");
                                                                      }
                                                                      _t13049 = _t13052;
                                                                      break _t13050;
                                                                    }
                                                                    _match_fail("line 16933");
                                                                  }
                                                                  _t13046 = _t13049;
                                                                  break _t13047;
                                                                }
                                                                _match_fail("line 16933");
                                                              }
                                                              _t13043 = _t13046;
                                                              break _t13044;
                                                            }
                                                            _match_fail("line 16933");
                                                          }
                                                          _t13040 = _t13043;
                                                          break _t13041;
                                                        }
                                                        _match_fail("line 16933");
                                                      }
                                                      _t13037 = _t13040;
                                                      break _t13038;
                                                    }
                                                    _match_fail("line 16933");
                                                  }
                                                  _t13034 = _t13037;
                                                  break _t13035;
                                                }
                                                _match_fail("line 16933");
                                              }
                                              _t13031 = _t13034;
                                              break _t13032;
                                            }
                                            _match_fail("line 16933");
                                          }
                                          _t13028 = _t13031;
                                          break _t13029;
                                        }
                                        _match_fail("line 16933");
                                      }
                                      _t13025 = _t13028;
                                      break _t13026;
                                    }
                                    _match_fail("line 16933");
                                  }
                                  _t13022 = _t13025;
                                  break _t13023;
                                }
                                _match_fail("line 16933");
                              }
                              _t13019 = _t13022;
                              break _t13020;
                            }
                            _match_fail("line 16933");
                          }
                          _t13016 = _t13019;
                          break _t13017;
                        }
                        _match_fail("line 16933");
                      }
                      _t13013 = _t13016;
                      break _t13014;
                    }
                    _match_fail("line 16933");
                  }
                  _t13010 = _t13013;
                  break _t13011;
                }
                _match_fail("line 16933");
              }
              _t13007 = _t13010;
              break _t13008;
            }
            _match_fail("line 16933");
          }
          _t13004 = _t13007;
          break _t13005;
        }
        _match_fail("line 16933");
      }
      _t13001 = _t13004;
      break _t13002;
    }
    _match_fail("line 16933");
  }
  const _t12999 = _t13001;
  const _t12997 = _t12999;
  const _t12995 = _t12997;
  const _t12993 = _t12995;
  const _t12991 = _t12993;
  const _t12989 = _t12991;
  return _t12989;
}
function Main$setup_classes(ctx, global_names, mutable_globals, stdlib_pub_vars) {
  let ctx_13286 = ctx;
  let setup_protos_13288 = null;
  function _t13290(name) {
    let _t13292;
    const _t13291 = Main$compile_setup(ctx_13286, global_names, mutable_globals, IO$read_file((("stdlib/" + name) + ".mml")));
    _t13293: {
      if (true) {
        const ctx2 = _t13291[0];
        const proto = _t13291[1];
        (ctx_13286 = ctx2, undefined);
        _t13292 = (setup_protos_13288 = ({_hd: proto, _tl: setup_protos_13288}), undefined);
        break _t13293;
      }
      _match_fail("line 16933");
    }
    return _t13292;
  }
  const load_13294 = _t13290;
  load_13294("classes");
  load_13294("option_type");
  load_13294("iter");
  load_13294("map_class");
  load_13294("show");
  function _t13296(__p453) {
    let _t13298;
    const _t13297 = __p453;
    _t13299: {
      if (true) {
        const name = _t13297[0];
        _t13298 = ((name === "None") || (name === "Some"));
        break _t13299;
      }
      _match_fail("line 16933");
    }
    return _t13298;
  }
  const stdlib_constructors_13300 = List$filter(_t13296, ctx_13286.type_env.constructors);
  const stdlib_info_13302 = ({mod_instances: null, mod_name: "Stdlib", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: stdlib_constructors_13300, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: stdlib_pub_vars, mod_submodules: null});
  const __rec_upd_13304 = ctx_13286;
  const __rec_upd_13306 = ctx_13286.type_env;
  const _t13307 = ({classes: __rec_upd_13306.classes, constructors: __rec_upd_13306.constructors, effects: __rec_upd_13306.effects, hidden_ctor_types: __rec_upd_13306.hidden_ctor_types, hidden_types: __rec_upd_13306.hidden_types, instances: __rec_upd_13306.instances, modules: ({_hd: ["Stdlib", stdlib_info_13302], _tl: ctx_13286.type_env.modules}), mutable_fields: __rec_upd_13306.mutable_fields, newtypes: __rec_upd_13306.newtypes, records: __rec_upd_13306.records, type_aliases: __rec_upd_13306.type_aliases, type_synonyms: __rec_upd_13306.type_synonyms, variants: __rec_upd_13306.variants});
  const _t13305 = ({constraint_tvars: __rec_upd_13304.constraint_tvars, current_eff: __rec_upd_13304.current_eff, current_module: __rec_upd_13304.current_module, inside_handler: __rec_upd_13304.inside_handler, loop_info: __rec_upd_13304.loop_info, mutable_vars: __rec_upd_13304.mutable_vars, return_type: __rec_upd_13304.return_type, return_used: __rec_upd_13304.return_used, type_env: _t13307, vars: __rec_upd_13304.vars});
  (ctx_13286 = _t13305, undefined);
  const _t13303 = [ctx_13286, List$rev(setup_protos_13288)];
  const _t13301 = _t13303;
  const _t13295 = _t13301;
  const _t13289 = _t13295;
  const _t13287 = _t13289;
  return _t13287;
}
function Main$setup_modules(ctx, global_names, mutable_globals) {
  let pub_vars_13308 = null;
  let ctx_13310 = ctx;
  let setup_protos_13312 = null;
  function _t13314(__dict_Show_0, mod_name, fn_name, ty, arity) {
    let _t13316;
    const _t13315 = Main$register_module_fn(ctx_13310, global_names, mod_name, fn_name, ty, arity);
    _t13317: {
      if (true) {
        const pv = _t13315[0];
        const ctx2 = _t13315[1];
        (pub_vars_13308 = ({_hd: pv, _tl: pub_vars_13308}), undefined);
        _t13316 = (ctx_13310 = ctx2, undefined);
        break _t13317;
      }
      _match_fail("line 16933");
    }
    return _t13316;
  }
  const register_fn_13318 = _t13314;
  function _t13320(name) {
    let _t13322;
    const _t13321 = Main$compile_setup(ctx_13310, global_names, mutable_globals, IO$read_file((("stdlib/" + name) + ".mml")));
    _t13323: {
      if (true) {
        const ctx2 = _t13321[0];
        const proto = _t13321[1];
        (ctx_13310 = ctx2, undefined);
        _t13322 = (setup_protos_13312 = ({_hd: proto, _tl: setup_protos_13312}), undefined);
        break _t13323;
      }
      _match_fail("line 16933");
    }
    return _t13322;
  }
  const load_13324 = _t13320;
  function _t13326(source) {
    let _t13328;
    const _t13327 = Main$compile_setup(ctx_13310, global_names, mutable_globals, source);
    _t13329: {
      if (true) {
        const ctx2 = _t13327[0];
        const proto = _t13327[1];
        (ctx_13310 = ctx2, undefined);
        _t13328 = (setup_protos_13312 = ({_hd: proto, _tl: setup_protos_13312}), undefined);
        break _t13329;
      }
      _match_fail("line 16933");
    }
    return _t13328;
  }
  const load_source_13330 = _t13326;
  (pub_vars_13308 = null, undefined);
  _call(register_fn_13318, [__dict_Show_int, "String", "length", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "sub", Main$arr3(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 3, _name: "TString"})), 3]);
  _call(register_fn_13318, [__dict_Show_int, "String", "split", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 3, _name: "TString"})})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "String", "trim", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "starts_with", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "String", "contains", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "String", "replace", Main$arr3(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 3]);
  _call(register_fn_13318, [__dict_Show_int, "String", "to_int", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null})]})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "to_float", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 1, _name: "TFloat"}), _tl: null})]})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "uppercase", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "lowercase", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "get", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"}), ({_tag: 4, _name: "TByte"})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "String", "to_bytes", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 4, _name: "TByte"})})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "of_bytes", Main$arr(({_tag: 10, _name: "TList", _val: ({_tag: 4, _name: "TByte"})}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "to_byte_array", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 13, _name: "TArray", _val: ({_tag: 4, _name: "TByte"})})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "of_byte_array", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 4, _name: "TByte"})}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "to_runes", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 5, _name: "TRune"})})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "of_runes", Main$arr(({_tag: 10, _name: "TList", _val: ({_tag: 5, _name: "TRune"})}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "get_rune", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"}), ({_tag: 5, _name: "TRune"})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "String", "of_byte", Main$arr(({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "rune_length", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "String", "make", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 4, _name: "TByte"}), ({_tag: 3, _name: "TString"})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "String", "index_opt", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 4, _name: "TByte"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null})]})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "String", "rindex_opt", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 4, _name: "TByte"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 0, _name: "TInt"}), _tl: null})]})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "String", "concat", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 10, _name: "TList", _val: ({_tag: 3, _name: "TString"})}), ({_tag: 3, _name: "TString"})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "String", "compare", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 0, _name: "TInt"})), 2]);
  const string_info_13332 = ({mod_instances: null, mod_name: "String", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13308, mod_submodules: null});
  const __rec_upd_13334 = ctx_13310;
  const __rec_upd_13336 = ctx_13310.type_env;
  const _t13337 = ({classes: __rec_upd_13336.classes, constructors: __rec_upd_13336.constructors, effects: __rec_upd_13336.effects, hidden_ctor_types: __rec_upd_13336.hidden_ctor_types, hidden_types: __rec_upd_13336.hidden_types, instances: __rec_upd_13336.instances, modules: ({_hd: ["String", string_info_13332], _tl: ctx_13310.type_env.modules}), mutable_fields: __rec_upd_13336.mutable_fields, newtypes: __rec_upd_13336.newtypes, records: __rec_upd_13336.records, type_aliases: __rec_upd_13336.type_aliases, type_synonyms: __rec_upd_13336.type_synonyms, variants: __rec_upd_13336.variants});
  const _t13335 = ({constraint_tvars: __rec_upd_13334.constraint_tvars, current_eff: __rec_upd_13334.current_eff, current_module: __rec_upd_13334.current_module, inside_handler: __rec_upd_13334.inside_handler, loop_info: __rec_upd_13334.loop_info, mutable_vars: __rec_upd_13334.mutable_vars, return_type: __rec_upd_13334.return_type, return_used: __rec_upd_13334.return_used, type_env: _t13337, vars: __rec_upd_13334.vars});
  (ctx_13310 = _t13335, undefined);
  load_source_13330("module String = pub let iter f s = let n = String.length s in let rec go i = if i >= n do () else (f (String.get s i); go (i + 1)) in go 0 end");
  load_13324("list");
  (pub_vars_13308 = null, undefined);
  _call(register_fn_13318, [__dict_Show_int, "Array", "make", Main$arr2(({_tag: 0, _name: "TInt"}), ({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "Array", "get", Main$arr2(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 16, _name: "TGen", _val: 0})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "Array", "set", Main$arr3(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 16, _name: "TGen", _val: 0}), ({_tag: 6, _name: "TUnit"})), 3]);
  _call(register_fn_13318, [__dict_Show_int, "Array", "length", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "Array", "to_list", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 10, _name: "TList", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "Array", "of_list", Main$arr(({_tag: 10, _name: "TList", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "Array", "copy", Main$arr(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "Array", "sub", Main$arr3(({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})}), ({_tag: 0, _name: "TInt"}), ({_tag: 0, _name: "TInt"}), ({_tag: 13, _name: "TArray", _val: ({_tag: 16, _name: "TGen", _val: 0})})), 3]);
  const array_info_13338 = ({mod_instances: null, mod_name: "Array", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13308, mod_submodules: null});
  const __rec_upd_13340 = ctx_13310;
  const __rec_upd_13342 = ctx_13310.type_env;
  const _t13343 = ({classes: __rec_upd_13342.classes, constructors: __rec_upd_13342.constructors, effects: __rec_upd_13342.effects, hidden_ctor_types: __rec_upd_13342.hidden_ctor_types, hidden_types: __rec_upd_13342.hidden_types, instances: __rec_upd_13342.instances, modules: ({_hd: ["Array", array_info_13338], _tl: ctx_13310.type_env.modules}), mutable_fields: __rec_upd_13342.mutable_fields, newtypes: __rec_upd_13342.newtypes, records: __rec_upd_13342.records, type_aliases: __rec_upd_13342.type_aliases, type_synonyms: __rec_upd_13342.type_synonyms, variants: __rec_upd_13342.variants});
  const _t13341 = ({constraint_tvars: __rec_upd_13340.constraint_tvars, current_eff: __rec_upd_13340.current_eff, current_module: __rec_upd_13340.current_module, inside_handler: __rec_upd_13340.inside_handler, loop_info: __rec_upd_13340.loop_info, mutable_vars: __rec_upd_13340.mutable_vars, return_type: __rec_upd_13340.return_type, return_used: __rec_upd_13340.return_used, type_env: _t13343, vars: __rec_upd_13340.vars});
  (ctx_13310 = _t13341, undefined);
  load_13324("array_extra");
  (pub_vars_13308 = null, undefined);
  _call(register_fn_13318, [__dict_Show_int, "IO", "read_file", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "IO", "write_file", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "IO", "append_file", Main$arr2(({_tag: 3, _name: "TString"}), ({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 2]);
  _call(register_fn_13318, [__dict_Show_int, "IO", "read_line", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 3, _name: "TString"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "IO", "file_exists", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 2, _name: "TBool"})), 1]);
  const io_info_13344 = ({mod_instances: null, mod_name: "IO", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13308, mod_submodules: null});
  const __rec_upd_13346 = ctx_13310;
  const __rec_upd_13348 = ctx_13310.type_env;
  const _t13349 = ({classes: __rec_upd_13348.classes, constructors: __rec_upd_13348.constructors, effects: __rec_upd_13348.effects, hidden_ctor_types: __rec_upd_13348.hidden_ctor_types, hidden_types: __rec_upd_13348.hidden_types, instances: __rec_upd_13348.instances, modules: ({_hd: ["IO", io_info_13344], _tl: ctx_13310.type_env.modules}), mutable_fields: __rec_upd_13348.mutable_fields, newtypes: __rec_upd_13348.newtypes, records: __rec_upd_13348.records, type_aliases: __rec_upd_13348.type_aliases, type_synonyms: __rec_upd_13348.type_synonyms, variants: __rec_upd_13348.variants});
  const _t13347 = ({constraint_tvars: __rec_upd_13346.constraint_tvars, current_eff: __rec_upd_13346.current_eff, current_module: __rec_upd_13346.current_module, inside_handler: __rec_upd_13346.inside_handler, loop_info: __rec_upd_13346.loop_info, mutable_vars: __rec_upd_13346.mutable_vars, return_type: __rec_upd_13346.return_type, return_used: __rec_upd_13346.return_used, type_env: _t13349, vars: __rec_upd_13346.vars});
  (ctx_13310 = _t13347, undefined);
  (pub_vars_13308 = null, undefined);
  _call(register_fn_13318, [__dict_Show_int, "Sys", "args", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 10, _name: "TList", _val: ({_tag: 3, _name: "TString"})})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "Sys", "getenv", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 12, _name: "TVariant", _val: ["option", ({_hd: ({_tag: 3, _name: "TString"}), _tl: null})]})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "Sys", "exit", Main$arr(({_tag: 0, _name: "TInt"}), ({_tag: 6, _name: "TUnit"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "Sys", "time", Main$arr(({_tag: 6, _name: "TUnit"}), ({_tag: 1, _name: "TFloat"})), 1]);
  const sys_info_13350 = ({mod_instances: null, mod_name: "Sys", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13308, mod_submodules: null});
  const __rec_upd_13352 = ctx_13310;
  const __rec_upd_13354 = ctx_13310.type_env;
  const _t13355 = ({classes: __rec_upd_13354.classes, constructors: __rec_upd_13354.constructors, effects: __rec_upd_13354.effects, hidden_ctor_types: __rec_upd_13354.hidden_ctor_types, hidden_types: __rec_upd_13354.hidden_types, instances: __rec_upd_13354.instances, modules: ({_hd: ["Sys", sys_info_13350], _tl: ctx_13310.type_env.modules}), mutable_fields: __rec_upd_13354.mutable_fields, newtypes: __rec_upd_13354.newtypes, records: __rec_upd_13354.records, type_aliases: __rec_upd_13354.type_aliases, type_synonyms: __rec_upd_13354.type_synonyms, variants: __rec_upd_13354.variants});
  const _t13353 = ({constraint_tvars: __rec_upd_13352.constraint_tvars, current_eff: __rec_upd_13352.current_eff, current_module: __rec_upd_13352.current_module, inside_handler: __rec_upd_13352.inside_handler, loop_info: __rec_upd_13352.loop_info, mutable_vars: __rec_upd_13352.mutable_vars, return_type: __rec_upd_13352.return_type, return_used: __rec_upd_13352.return_used, type_env: _t13355, vars: __rec_upd_13352.vars});
  (ctx_13310 = _t13353, undefined);
  load_13324("math");
  load_13324("result");
  load_13324("byte");
  load_13324("rune");
  load_13324("map");
  load_13324("set");
  load_13324("enum");
  load_13324("seq");
  load_13324("option");
  load_13324("buffer");
  load_13324("fmt");
  load_13324("hash");
  load_13324("hashtbl");
  load_13324("ref");
  load_13324("dynarray");
  load_13324("compat");
  (pub_vars_13308 = null, undefined);
  _call(register_fn_13318, [__dict_Show_int, "Runtime", "eval", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 1]);
  _call(register_fn_13318, [__dict_Show_int, "Runtime", "eval_file", Main$arr(({_tag: 3, _name: "TString"}), ({_tag: 6, _name: "TUnit"})), 1]);
  const runtime_info_13356 = ({mod_instances: null, mod_name: "Runtime", mod_newtypes: null, mod_opaque_types: null, mod_pub_classes: null, mod_pub_constructors: null, mod_pub_mutable_vars: null, mod_pub_types: null, mod_pub_vars: pub_vars_13308, mod_submodules: null});
  const __rec_upd_13358 = ctx_13310;
  const __rec_upd_13360 = ctx_13310.type_env;
  const _t13361 = ({classes: __rec_upd_13360.classes, constructors: __rec_upd_13360.constructors, effects: __rec_upd_13360.effects, hidden_ctor_types: __rec_upd_13360.hidden_ctor_types, hidden_types: __rec_upd_13360.hidden_types, instances: __rec_upd_13360.instances, modules: ({_hd: ["Runtime", runtime_info_13356], _tl: ctx_13310.type_env.modules}), mutable_fields: __rec_upd_13360.mutable_fields, newtypes: __rec_upd_13360.newtypes, records: __rec_upd_13360.records, type_aliases: __rec_upd_13360.type_aliases, type_synonyms: __rec_upd_13360.type_synonyms, variants: __rec_upd_13360.variants});
  const _t13359 = ({constraint_tvars: __rec_upd_13358.constraint_tvars, current_eff: __rec_upd_13358.current_eff, current_module: __rec_upd_13358.current_module, inside_handler: __rec_upd_13358.inside_handler, loop_info: __rec_upd_13358.loop_info, mutable_vars: __rec_upd_13358.mutable_vars, return_type: __rec_upd_13358.return_type, return_used: __rec_upd_13358.return_used, type_env: _t13361, vars: __rec_upd_13358.vars});
  (ctx_13310 = _t13359, undefined);
  const _t13357 = [ctx_13310, List$rev(setup_protos_13312)];
  const _t13351 = _t13357;
  const _t13345 = _t13351;
  const _t13339 = _t13345;
  const _t13333 = _t13339;
  const _t13331 = _t13333;
  const _t13325 = _t13331;
  const _t13319 = _t13325;
  const _t13313 = _t13319;
  const _t13311 = _t13313;
  const _t13309 = _t13311;
  return _t13309;
}
function Main$run_batch(manifest_file) {
  const _t13362 = (function() {
    const _t13363 = _h;
    _h = Object.assign({}, _t13363, {
      "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
      "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
      "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
      "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
    });
    try {
      const manifest_13364 = IO$read_file(manifest_file);
      function _t13366(s) {
        return (s !== "");
      }
      const files_13367 = List$filter(_t13366, String$split("\n", manifest_13364));
      let _t13370;
      const _t13369 = Main$setup_builtins(undefined);
      _t13371: {
        if (true) {
          const ctx = _t13369[0];
          const global_names = _t13369[1];
          const mutable_globals = _t13369[2];
          const stdlib_pub_vars = _t13369[3];
          let _t13373;
          const _t13372 = Main$setup_classes(ctx, global_names, mutable_globals, stdlib_pub_vars);
          _t13374: {
            if (true) {
              const ctx = _t13372[0];
              const class_protos = _t13372[1];
              let _t13376;
              const _t13375 = Main$setup_modules(ctx, global_names, mutable_globals);
              _t13377: {
                if (true) {
                  const ctx = _t13375[0];
                  const module_protos = _t13375[1];
                  const setup_protos_13378 = List$concat(class_protos, module_protos);
                  const base_gn_len_13380 = Dynarray$length(global_names);
                  const base_native_13382 = Main$native_global_entries;
                  const base_mutable_13384 = Hashtbl$to_list(mutable_globals);
                  function _t13386(filename) {
                    (global_names.count = base_gn_len_13380, undefined);
                    (Main$native_global_entries = base_native_13382, undefined);
                    Hashtbl$clear(mutable_globals);
                    function _t13387(__p454) {
                      let _t13389;
                      const _t13388 = __p454;
                      _t13390: {
                        if (true) {
                          const k = _t13388[0];
                          const v = _t13388[1];
                          _t13389 = _call(Hashtbl$set, [__dict_Hash_string, __dict_Eq_string, mutable_globals, k, v]);
                          break _t13390;
                        }
                        _match_fail("line 16933");
                      }
                      return _t13389;
                    }
                    Main$list_iter(_t13387, base_mutable_13384);
                    const _t13391 = (function() {
                      const _t13392 = _h;
                      _h = Object.assign({}, _t13392, {
                        "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
                        "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
                        "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
                        "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
                        "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
                      });
                      try {
                        const source_13393 = IO$read_file(filename);
                        const tokens_13395 = Lexer$tokenize(source_13393);
                        const program_13397 = Parser$parse_program(tokens_13395);
                        let _t13400;
                        const _t13399 = Typechecker$check_program_in_ctx(ctx, program_13397);
                        _t13401: {
                          if (true) {
                            const ctx2 = _t13399[0];
                            const typed_program = _t13399[1];
                            const typed_program2_13402 = Typechecker$transform_constraints(ctx2, typed_program);
                            const compiled_13404 = Compiler$compile_program_with_globals(ctx2.type_env, global_names, mutable_globals, typed_program2_13402);
                            const ng_json_13406 = _t12894_Main$build_native_globals_json(undefined);
                            const json_13408 = Serialize$serialize_bundle(global_names, ng_json_13406, setup_protos_13378, compiled_13404.main);
                            print(json_13408);
                            const _t13409 = print("===BATCH-SEP===");
                            const _t13407 = _t13409;
                            const _t13405 = _t13407;
                            const _t13403 = _t13405;
                            _t13400 = _t13403;
                            break _t13401;
                          }
                          _match_fail("line 16933");
                        }
                        const _t13398 = _t13400;
                        const _t13396 = _t13398;
                        const _t13394 = _t13396;
                        const x_13410 = _t13394;
                        return x_13410;
                      } catch (_exc) {
                        if (_exc && _exc._e === "lex_error") {
                          const arg = _exc._v;
                          let _t13412;
                          const _t13411 = arg;
                          _t13413: {
                            if (true) {
                              const msg = _t13411[0];
                              const _loc = _t13411[1];
                              print(("COMPILE-ERROR:" + msg));
                              _t13412 = print("===BATCH-SEP===");
                              break _t13413;
                            }
                            _match_fail("line 16933");
                          }
                          return _t13412;
                        } else if (_exc && _exc._e === "parse_error") {
                          const arg = _exc._v;
                          let _t13415;
                          const _t13414 = arg;
                          _t13416: {
                            if (true) {
                              const msg = _t13414[0];
                              const _loc = _t13414[1];
                              print(("COMPILE-ERROR:" + msg));
                              _t13415 = print("===BATCH-SEP===");
                              break _t13416;
                            }
                            _match_fail("line 16933");
                          }
                          return _t13415;
                        } else if (_exc && _exc._e === "type_error") {
                          const arg = _exc._v;
                          let _t13418;
                          const _t13417 = arg;
                          _t13419: {
                            if (true) {
                              const msg = _t13417[0];
                              const _loc = _t13417[1];
                              print(("COMPILE-ERROR:" + msg));
                              _t13418 = print("===BATCH-SEP===");
                              break _t13419;
                            }
                            _match_fail("line 16933");
                          }
                          return _t13418;
                        } else if (_exc && _exc._e === "compile_error") {
                          const msg = _exc._v;
                          print(("COMPILE-ERROR:" + msg));
                          return print("===BATCH-SEP===");
                        } else if (_exc && _exc._e === "unify_error") {
                          const msg = _exc._v;
                          print(("COMPILE-ERROR:" + msg));
                          return print("===BATCH-SEP===");
                        } else { throw _exc; }
                      } finally { _h = _t13392; }
                    })();
                    return _t13391;
                  }
                  const _t13385 = Main$list_iter(_t13386, files_13367);
                  const _t13383 = _t13385;
                  const _t13381 = _t13383;
                  const _t13379 = _t13381;
                  _t13376 = _t13379;
                  break _t13377;
                }
                _match_fail("line 16933");
              }
              _t13373 = _t13376;
              break _t13374;
            }
            _match_fail("line 16933");
          }
          _t13370 = _t13373;
          break _t13371;
        }
        _match_fail("line 16933");
      }
      const _t13368 = _t13370;
      const _t13365 = _t13368;
      const x_13420 = _t13365;
      return x_13420;
    } catch (_exc) {
      if (_exc && _exc._e === "lex_error") {
        const arg = _exc._v;
        let _t13422;
        const _t13421 = arg;
        _t13423: {
          if (true) {
            const msg = _t13421[0];
            const _loc = _t13421[1];
            _t13422 = failwith(msg);
            break _t13423;
          }
          _match_fail("line 16933");
        }
        return _t13422;
      } else if (_exc && _exc._e === "parse_error") {
        const arg = _exc._v;
        let _t13425;
        const _t13424 = arg;
        _t13426: {
          if (true) {
            const msg = _t13424[0];
            const _loc = _t13424[1];
            _t13425 = failwith(msg);
            break _t13426;
          }
          _match_fail("line 16933");
        }
        return _t13425;
      } else if (_exc && _exc._e === "type_error") {
        const arg = _exc._v;
        let _t13428;
        const _t13427 = arg;
        _t13429: {
          if (true) {
            const msg = _t13427[0];
            const _loc = _t13427[1];
            _t13428 = failwith(msg);
            break _t13429;
          }
          _match_fail("line 16933");
        }
        return _t13428;
      } else if (_exc && _exc._e === "compile_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else { throw _exc; }
    } finally { _h = _t13363; }
  })();
  return _t13362;
}
function Main$run_emit_js(args) {
  const _t13430 = (function() {
    const _t13431 = _h;
    _h = Object.assign({}, _t13431, {
      "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
      "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
      "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
      "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
      "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
      "codegen_error": function(msg, __k_try) { throw {_e: "codegen_error", _v: msg}; },
    });
    try {
      (Main$js_capture_mode = true, undefined);
      (Main$captured_typed_setups = null, undefined);
      let _t13433;
      const _t13432 = Main$setup_builtins(undefined);
      _t13434: {
        if (true) {
          const ctx = _t13432[0];
          const global_names = _t13432[1];
          const mutable_globals = _t13432[2];
          const stdlib_pub_vars = _t13432[3];
          let _t13436;
          const _t13435 = Main$setup_classes(ctx, global_names, mutable_globals, stdlib_pub_vars);
          _t13437: {
            if (true) {
              const ctx = _t13435[0];
              const _class_protos = _t13435[1];
              let _t13439;
              const _t13438 = Main$setup_modules(ctx, global_names, mutable_globals);
              _t13440: {
                if (true) {
                  const ctx = _t13438[0];
                  const _module_protos = _t13438[1];
                  let _t13442;
                  const _t13441 = args;
                  _t13443: {
                    if (_t13441 !== null && _t13441._tl !== null) {
                      const file = _t13441._tl._hd;
                      _t13442 = file;
                      break _t13443;
                    }
                    if (true) {
                      _t13442 = failwith("Usage: compiler --emit-js <source-file>");
                      break _t13443;
                    }
                    _match_fail("line 16933");
                  }
                  const filename_13444 = _t13442;
                  const source_13446 = IO$read_file(filename_13444);
                  const tokens_13448 = Lexer$tokenize(source_13446);
                  const program_13450 = Parser$parse_program(tokens_13448);
                  let _t13453;
                  const _t13452 = Typechecker$check_program_in_ctx(ctx, program_13450);
                  _t13454: {
                    if (true) {
                      const ctx2 = _t13452[0];
                      const typed_program = _t13452[1];
                      const typed_program2_13455 = Typechecker$transform_constraints(ctx2, typed_program);
                      const js_13457 = Js_codegen$compile_program_with_stdlib(ctx2.type_env, Main$captured_typed_setups, typed_program2_13455);
                      const _t13458 = print(js_13457);
                      const _t13456 = _t13458;
                      _t13453 = _t13456;
                      break _t13454;
                    }
                    _match_fail("line 16933");
                  }
                  const _t13451 = _t13453;
                  const _t13449 = _t13451;
                  const _t13447 = _t13449;
                  const _t13445 = _t13447;
                  _t13439 = _t13445;
                  break _t13440;
                }
                _match_fail("line 16933");
              }
              _t13436 = _t13439;
              break _t13437;
            }
            _match_fail("line 16933");
          }
          _t13433 = _t13436;
          break _t13434;
        }
        _match_fail("line 16933");
      }
      const x_13459 = _t13433;
      return x_13459;
    } catch (_exc) {
      if (_exc && _exc._e === "lex_error") {
        const arg = _exc._v;
        let _t13461;
        const _t13460 = arg;
        _t13462: {
          if (true) {
            const msg = _t13460[0];
            const _loc = _t13460[1];
            _t13461 = failwith(msg);
            break _t13462;
          }
          _match_fail("line 16933");
        }
        return _t13461;
      } else if (_exc && _exc._e === "parse_error") {
        const arg = _exc._v;
        let _t13464;
        const _t13463 = arg;
        _t13465: {
          if (true) {
            const msg = _t13463[0];
            const _loc = _t13463[1];
            _t13464 = failwith(msg);
            break _t13465;
          }
          _match_fail("line 16933");
        }
        return _t13464;
      } else if (_exc && _exc._e === "type_error") {
        const arg = _exc._v;
        let _t13467;
        const _t13466 = arg;
        _t13468: {
          if (true) {
            const msg = _t13466[0];
            const _loc = _t13466[1];
            _t13467 = failwith(msg);
            break _t13468;
          }
          _match_fail("line 16933");
        }
        return _t13467;
      } else if (_exc && _exc._e === "compile_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else if (_exc && _exc._e === "unify_error") {
        const msg = _exc._v;
        return failwith(msg);
      } else if (_exc && _exc._e === "codegen_error") {
        const msg = _exc._v;
        return failwith(("JS codegen error: " + msg));
      } else { throw _exc; }
    } finally { _h = _t13431; }
  })();
  return _t13430;
}
const args_13470 = Sys$args(undefined);
let _t13473;
const _t13472 = args_13470;
_t13474: {
  if (_t13472 !== null && _t13472._tl !== null && _t13472._tl._hd === "--batch" && _t13472._tl._tl !== null) {
    const f = _t13472._tl._tl._hd;
    _t13473 = ({_tag: 1, _name: "Some", _val: f});
    break _t13474;
  }
  if (true) {
    _t13473 = ({_tag: 0, _name: "None"});
    break _t13474;
  }
  _match_fail("line 16933");
}
const batch_file_13475 = _t13473;
function _t13477(a) {
  return (a === "--emit-js");
}
const emit_js_13478 = List$exists(_t13477, args_13470);
function _t13480(a) {
  return (a === "--no-optimize");
}
const no_optimize_13481 = List$exists(_t13480, args_13470);
let _t13483;
if (no_optimize_13481) {
  _t13483 = Ref$set(Compiler$optimize_enabled, false);
} else {
  _t13483 = undefined;
}
_t13483;
function _t13484(a) {
  return ((a !== "--no-optimize") && (a !== "--emit-js"));
}
const args_13485 = List$filter(_t13484, args_13470);
let _t13488;
const _t13487 = batch_file_13475;
_t13489: {
  if (_t13487._tag === 1) {
    const f = _t13487._val;
    _t13488 = Main$run_batch(f);
    break _t13489;
  }
  if (_t13487._tag === 0) {
    let _t13490;
    if (emit_js_13478) {
      _t13490 = Main$run_emit_js(args_13485);
    } else {
      const _t13491 = (function() {
        const _t13492 = _h;
        _h = Object.assign({}, _t13492, {
          "lex_error": function(arg, __k_try) { throw {_e: "lex_error", _v: arg}; },
          "parse_error": function(arg, __k_try) { throw {_e: "parse_error", _v: arg}; },
          "type_error": function(arg, __k_try) { throw {_e: "type_error", _v: arg}; },
          "compile_error": function(msg, __k_try) { throw {_e: "compile_error", _v: msg}; },
          "unify_error": function(msg, __k_try) { throw {_e: "unify_error", _v: msg}; },
        });
        try {
          let _t13494;
          const _t13493 = args_13485;
          _t13495: {
            if (_t13493 !== null && _t13493._tl !== null && _t13493._tl._hd === "--emit-json" && _t13493._tl._tl !== null) {
              const file = _t13493._tl._tl._hd;
              _t13494 = file;
              break _t13495;
            }
            if (_t13493 !== null && _t13493._tl !== null) {
              const file = _t13493._tl._hd;
              _t13494 = file;
              break _t13495;
            }
            if (true) {
              _t13494 = failwith("Usage: compiler [--emit-json | --emit-js | --batch <manifest>] <source-file>");
              break _t13495;
            }
            _match_fail("line 16933");
          }
          const filename_13496 = _t13494;
          const source_13498 = IO$read_file(filename_13496);
          let _t13501;
          const _t13500 = Main$setup_builtins(undefined);
          _t13502: {
            if (true) {
              const ctx = _t13500[0];
              const global_names = _t13500[1];
              const mutable_globals = _t13500[2];
              const stdlib_pub_vars = _t13500[3];
              let _t13504;
              const _t13503 = Main$setup_classes(ctx, global_names, mutable_globals, stdlib_pub_vars);
              _t13505: {
                if (true) {
                  const ctx = _t13503[0];
                  const class_protos = _t13503[1];
                  let _t13507;
                  const _t13506 = Main$setup_modules(ctx, global_names, mutable_globals);
                  _t13508: {
                    if (true) {
                      const ctx = _t13506[0];
                      const module_protos = _t13506[1];
                      const setup_protos_13509 = List$concat(class_protos, module_protos);
                      const tokens_13511 = Lexer$tokenize(source_13498);
                      const program_13513 = Parser$parse_program(tokens_13511);
                      let _t13516;
                      const _t13515 = Typechecker$check_program_in_ctx(ctx, program_13513);
                      _t13517: {
                        if (true) {
                          const ctx2 = _t13515[0];
                          const typed_program = _t13515[1];
                          const typed_program2_13518 = Typechecker$transform_constraints(ctx2, typed_program);
                          const compiled_13520 = Compiler$compile_program_with_globals(ctx2.type_env, global_names, mutable_globals, typed_program2_13518);
                          const ng_json_13522 = _t12894_Main$build_native_globals_json(undefined);
                          const json_13524 = Serialize$serialize_bundle(global_names, ng_json_13522, setup_protos_13509, compiled_13520.main);
                          const _t13525 = print(json_13524);
                          const _t13523 = _t13525;
                          const _t13521 = _t13523;
                          const _t13519 = _t13521;
                          _t13516 = _t13519;
                          break _t13517;
                        }
                        _match_fail("line 16933");
                      }
                      const _t13514 = _t13516;
                      const _t13512 = _t13514;
                      const _t13510 = _t13512;
                      _t13507 = _t13510;
                      break _t13508;
                    }
                    _match_fail("line 16933");
                  }
                  _t13504 = _t13507;
                  break _t13505;
                }
                _match_fail("line 16933");
              }
              _t13501 = _t13504;
              break _t13502;
            }
            _match_fail("line 16933");
          }
          const _t13499 = _t13501;
          const _t13497 = _t13499;
          const x_13526 = _t13497;
          return x_13526;
        } catch (_exc) {
          if (_exc && _exc._e === "lex_error") {
            const arg = _exc._v;
            let _t13528;
            const _t13527 = arg;
            _t13529: {
              if (true) {
                const msg = _t13527[0];
                const _loc = _t13527[1];
                _t13528 = failwith(msg);
                break _t13529;
              }
              _match_fail("line 16933");
            }
            return _t13528;
          } else if (_exc && _exc._e === "parse_error") {
            const arg = _exc._v;
            let _t13531;
            const _t13530 = arg;
            _t13532: {
              if (true) {
                const msg = _t13530[0];
                const _loc = _t13530[1];
                _t13531 = failwith(msg);
                break _t13532;
              }
              _match_fail("line 16933");
            }
            return _t13531;
          } else if (_exc && _exc._e === "type_error") {
            const arg = _exc._v;
            let _t13534;
            const _t13533 = arg;
            _t13535: {
              if (true) {
                const msg = _t13533[0];
                const _loc = _t13533[1];
                _t13534 = failwith(msg);
                break _t13535;
              }
              _match_fail("line 16933");
            }
            return _t13534;
          } else if (_exc && _exc._e === "compile_error") {
            const msg = _exc._v;
            return failwith(msg);
          } else if (_exc && _exc._e === "unify_error") {
            const msg = _exc._v;
            return failwith(msg);
          } else { throw _exc; }
        } finally { _h = _t13492; }
      })();
      _t13490 = _t13491;
    }
    _t13488 = _t13490;
    break _t13489;
  }
  _match_fail("line 16933");
}
const _t13486 = _t13488;
const _t13482 = _t13486;
const _t13479 = _t13482;
const _t13476 = _t13479;
const _t13471 = _t13476;
const _t13469_Main$__destruct = _t13471;
if (_last_val !== undefined) println(_pp(_last_val));
var _mml_exports = {"_result": _last_val, "_call": _call, "_pp": _pp};
if (typeof globalThis !== "undefined") globalThis._mmlExports = _mml_exports;
